<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We get acquainted with Fabric.js. Part 4</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is a translation of the fourth part of a series of articles on the open Javascript canvas library, Fabric.js. 

 We already know a lot from the p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We get acquainted with Fabric.js. Part 4</h1><div class="post__text post__text-html js-mediator-article">  <i>This is a translation of the fourth part of a series of articles on the open Javascript canvas library, Fabric.js.</i> <br><br>  We already know a lot from the previous parts of the series: ( <a href="http://habrahabr.ru/post/162367/">P1</a> , <a href="http://habrahabr.ru/post/162367/">P2</a> , <a href="http://habrahabr.ru/post/254763/">P3</a> ) from simple manipulations with objects to animations, events, groups and subclasses.  But there are some more interesting and useful things that should be covered. <br><a name="habracut"></a><br><h2>  Free drawing </h2><br>  What <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code></code> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <h2> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> </h2> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <h4> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> </h4> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <h4> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> </h4> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <pre> <code class="hljs lua"><code class="javascript"><code> ,       . Canvas -   <span class="hljs-number"><span class="hljs-number">2</span></span>D ,     .     -    . ,  Fabric   . <br> <br>     ,    <span class="hljs-literal"><span class="hljs-literal">true</span></span></code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> .       ,    <span class="hljs-string"><span class="hljs-string">"mouseup"</span></span>, Fabric   <span class="hljs-string"><span class="hljs-string">"path:created"</span></span>,         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . <span class="hljs-string"><span class="hljs-string">"lockMovementX"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockMovementY"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockRotation"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockScalingX"</span></span>  <span class="hljs-string"><span class="hljs-string">"lockScalingY"</span></span> ‚Äì      .    <code>object.lockMovementX</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   <span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>  <span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>.     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    <span class="hljs-string"><span class="hljs-string">""</span></span>. <br> object.hasBorders = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   <span class="hljs-string"><span class="hljs-string">"borderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"cornerColor"</span></span>,  <span class="hljs-string"><span class="hljs-string">"cornerSize"</span></span>. <br> <code class="javascript">object.set({ borderColor: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, cornerColor: <span class="hljs-string"><span class="hljs-string">'green'</span></span>, cornerSize: <span class="hljs-number"><span class="hljs-number">6</span></span> });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   <span class="hljs-string"><span class="hljs-string">"selection"</span></span>  canvas  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     ,    canvas.         ,       <span class="hljs-string"><span class="hljs-string">"selectable"</span></span>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .      . <br> <br>   <br>       ,     ?  . <br>  <span class="hljs-number"><span class="hljs-number">4</span></span>   canvas,     - <span class="hljs-string"><span class="hljs-string">"selectionColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionBorderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionLineWidth"</span></span>,  <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.selectionColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,255,0,0.3)'</span></span>; canvas.selectionBorderColor = <span class="hljs-string"><span class="hljs-string">'red'</span></span>; canvas.selectionLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span> ‚Äì   .       .    ,    .   ,      ,    -   <code>[<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>]</code>    <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.        <span class="hljs-number"><span class="hljs-number">10</span></span>px,     <span class="hljs-number"><span class="hljs-number">5</span></span>px,  ,   .     <code>[<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>]</code> ,     :      <span class="hljs-number"><span class="hljs-number">2</span></span>px,    <span class="hljs-number"><span class="hljs-number">4</span></span>px,    ,     <span class="hljs-number"><span class="hljs-number">6</span></span>px   .    ,      <code>[<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>   canvas,  Fabric    <span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>,       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: <span class="hljs-string"><span class="hljs-string">'#06538e'</span></span>, width: <span class="hljs-number"><span class="hljs-number">125</span></span>, height: <span class="hljs-number"><span class="hljs-number">125</span></span>, stroke: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, strokeDashArray: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     <span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>     <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <br>   <br> <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> Fabric   UI. ,   ,      .          . ,      - <span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>.          <span class="hljs-string"><span class="hljs-string">"rotatingPointOffset"</span></span>. <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> ,    ,    .    - <span class="hljs-string"><span class="hljs-string">"uniScaleTransform"</span></span>  canvas.   ,     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     <span class="hljs-string"><span class="hljs-string">"centeredScaling"</span></span>  <span class="hljs-string"><span class="hljs-string">"centeredRotation"</span></span> (  <span class="hljs-number"><span class="hljs-number">1.3</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span>    - <span class="hljs-string"><span class="hljs-string">"centerTransform"</span></span>).  ,       .    <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,  ,     <span class="hljs-number"><span class="hljs-number">1.0</span></span>,    /   .    <span class="hljs-number"><span class="hljs-number">1.0</span></span>.    . <br> <br>      <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>.        <span class="hljs-string"><span class="hljs-string">"left"</span></span>  <span class="hljs-string"><span class="hljs-string">"top"</span></span>.       .     ,     , <span class="hljs-string"><span class="hljs-string">" "</span></span>. <br> <br>         ? ,   -.     ,    , <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>     .     -,     originX  <span class="hljs-string"><span class="hljs-string">"center"</span></span>.       ‚Äì  originX  <span class="hljs-string"><span class="hljs-string">"right"</span></span>  ..     <span class="hljs-string"><span class="hljs-string">"position: absolute"</span></span>  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/"><span class="hljs-number"><span class="hljs-number">1</span></span>-  </a> ,          canvas.            <span class="hljs-string"><span class="hljs-string">"backgroundColor"</span></span>. <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.backgroundColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,0,255,0.3)'</span></span>; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setBackgroundImage(<span class="hljs-string"><span class="hljs-string">'../assets/pug.jpg'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setOverlayImage(<span class="hljs-string"><span class="hljs-string">'../assets/jail_cell_bars.png'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî <span class="hljs-number"><span class="hljs-number">2</span></span>D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric <span class="hljs-built_in"><span class="hljs-built_in">package</span></span></a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'canvas'</span></span>); // <span class="hljs-string"><span class="hljs-string">"function"</span></span> &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>); // <span class="hljs-string"><span class="hljs-string">"object"</span></span></code> <br>   ,     <span class="hljs-string"><span class="hljs-string">"hello world"</span></span> .  helloworld.js . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/helloworld.png'</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'Hello world'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">100</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, angle: <span class="hljs-number"><span class="hljs-number">15</span></span> }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   <span class="hljs-number"><span class="hljs-number">200</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>)</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     <span class="hljs-number"><span class="hljs-number">25</span></span> ! <br> <code class="javascript">var fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>), url = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'url'</span></span>), PORT = <span class="hljs-number"><span class="hljs-number">8124</span></span>; var server = http.createServer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request, response)</span></span></span></span> { var params = url.parse(request.url, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); response.writeHead(<span class="hljs-number"><span class="hljs-number">200</span></span>, { <span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'image/png'</span></span> }); canvas.loadFromJSON(params.query.data, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { response.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); }); stream.on(<span class="hljs-string"><span class="hljs-string">'end'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { response.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{<span class="hljs-string"><span class="hljs-string">"objects"</span></span>:[{<span class="hljs-string"><span class="hljs-string">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"rect"</span></span>,<span class="hljs-string"><span class="hljs-string">"left"</span></span>:<span class="hljs-number"><span class="hljs-number">103.85</span></span>,<span class="hljs-string"><span class="hljs-string">"top"</span></span>:<span class="hljs-number"><span class="hljs-number">98.85</span></span>,<span class="hljs-string"><span class="hljs-string">"width"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"height"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"fill"</span></span>:<span class="hljs-string"><span class="hljs-string">"#9ae759"</span></span>,<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"angle"</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span>,<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>:<span class="hljs-number"><span class="hljs-number">0.8</span></span>,<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"rx"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">"ry"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}],<span class="hljs-string"><span class="hljs-string">"background"</span></span>:<span class="hljs-string"><span class="hljs-string">"rgba(0, 0, 0, 0)"</span></span>}</code> <br> URI  : <br> <code class="javascript">%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"objects"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A%<span class="hljs-number"><span class="hljs-number">5</span></span>B%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"type"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rect"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"left"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A103<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"top"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A98<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"width"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"height"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"fill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"%239ae759"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"angle"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A30%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0<span class="hljs-number"><span class="hljs-number">.8</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"rx"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"ry"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">7</span></span>D%<span class="hljs-number"><span class="hljs-number">5</span></span>D%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"background"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rgba(0%2C%200%2C%200%2C%200)"</span></span>%<span class="hljs-number"><span class="hljs-number">7</span></span>D</code> <br>       <span class="hljs-string"><span class="hljs-string">"data"</span></span>.      <span class="hljs-string"><span class="hljs-string">"image/png"</span></span>   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-number"><span class="hljs-number">250</span></span>); var font = new canvas.Font(<span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, __dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Regular.ttf'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Bold.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Italic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'normal'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-BoldItalic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'regular'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">50</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">150</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">200</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); var out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/customfont.png'</span></span>); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/"><span class="hljs-number"><span class="hljs-number">2</span></span>-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code></code> </pre> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <pre> <code class="hljs lua"><code class="javascript"><code> ,       . Canvas -   <span class="hljs-number"><span class="hljs-number">2</span></span>D ,     .     -    . ,  Fabric   . <br> <br>     ,    <span class="hljs-literal"><span class="hljs-literal">true</span></span></code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> .       ,    <span class="hljs-string"><span class="hljs-string">"mouseup"</span></span>, Fabric   <span class="hljs-string"><span class="hljs-string">"path:created"</span></span>,         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . <span class="hljs-string"><span class="hljs-string">"lockMovementX"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockMovementY"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockRotation"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockScalingX"</span></span>  <span class="hljs-string"><span class="hljs-string">"lockScalingY"</span></span> ‚Äì      .    <code>object.lockMovementX</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   <span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>  <span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>.     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    <span class="hljs-string"><span class="hljs-string">""</span></span>. <br> <code class="javascript">object.hasBorders = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> object.hasControls = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   <span class="hljs-string"><span class="hljs-string">"borderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"cornerColor"</span></span>,  <span class="hljs-string"><span class="hljs-string">"cornerSize"</span></span>. <br> <code class="javascript">object.set({ borderColor: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, cornerColor: <span class="hljs-string"><span class="hljs-string">'green'</span></span>, cornerSize: <span class="hljs-number"><span class="hljs-number">6</span></span> });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   <span class="hljs-string"><span class="hljs-string">"selection"</span></span>  canvas  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     ,    canvas.         ,       <span class="hljs-string"><span class="hljs-string">"selectable"</span></span>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .      . <br> <br>   <br>       ,     ?  . <br>  <span class="hljs-number"><span class="hljs-number">4</span></span>   canvas,     - <span class="hljs-string"><span class="hljs-string">"selectionColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionBorderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionLineWidth"</span></span>,  <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.selectionColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,255,0,0.3)'</span></span>; canvas.selectionBorderColor = <span class="hljs-string"><span class="hljs-string">'red'</span></span>; canvas.selectionLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span> ‚Äì   .       .    ,    .   ,      ,    -   <code>[<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>]</code>    <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.        <span class="hljs-number"><span class="hljs-number">10</span></span>px,     <span class="hljs-number"><span class="hljs-number">5</span></span>px,  ,   .     <code>[<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>]</code> ,     :      <span class="hljs-number"><span class="hljs-number">2</span></span>px,    <span class="hljs-number"><span class="hljs-number">4</span></span>px,    ,     <span class="hljs-number"><span class="hljs-number">6</span></span>px   .    ,      <code>[<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>   canvas,  Fabric    <span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>,       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: <span class="hljs-string"><span class="hljs-string">'#06538e'</span></span>, width: <span class="hljs-number"><span class="hljs-number">125</span></span>, height: <span class="hljs-number"><span class="hljs-number">125</span></span>, stroke: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, strokeDashArray: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     <span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>     <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <br>   <br> <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> Fabric   UI. ,   ,      .          . ,      - <span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>.          <span class="hljs-string"><span class="hljs-string">"rotatingPointOffset"</span></span>. <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> ,    ,    .    - <span class="hljs-string"><span class="hljs-string">"uniScaleTransform"</span></span>  canvas.   ,     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     <span class="hljs-string"><span class="hljs-string">"centeredScaling"</span></span>  <span class="hljs-string"><span class="hljs-string">"centeredRotation"</span></span> (  <span class="hljs-number"><span class="hljs-number">1.3</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span>    - <span class="hljs-string"><span class="hljs-string">"centerTransform"</span></span>).  ,       .    <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,  ,     <span class="hljs-number"><span class="hljs-number">1.0</span></span>,    /   .    <span class="hljs-number"><span class="hljs-number">1.0</span></span>.    . <br> <br>      <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>.        <span class="hljs-string"><span class="hljs-string">"left"</span></span>  <span class="hljs-string"><span class="hljs-string">"top"</span></span>.       .     ,     , <span class="hljs-string"><span class="hljs-string">" "</span></span>. <br> <br>         ? ,   -.     ,    , <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>     .     -,     originX  <span class="hljs-string"><span class="hljs-string">"center"</span></span>.       ‚Äì  originX  <span class="hljs-string"><span class="hljs-string">"right"</span></span>  ..     <span class="hljs-string"><span class="hljs-string">"position: absolute"</span></span>  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/"><span class="hljs-number"><span class="hljs-number">1</span></span>-  </a> ,          canvas.            <span class="hljs-string"><span class="hljs-string">"backgroundColor"</span></span>. <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.backgroundColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,0,255,0.3)'</span></span>; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setBackgroundImage(<span class="hljs-string"><span class="hljs-string">'../assets/pug.jpg'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setOverlayImage(<span class="hljs-string"><span class="hljs-string">'../assets/jail_cell_bars.png'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî <span class="hljs-number"><span class="hljs-number">2</span></span>D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric <span class="hljs-built_in"><span class="hljs-built_in">package</span></span></a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'canvas'</span></span>); // <span class="hljs-string"><span class="hljs-string">"function"</span></span> &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>); // <span class="hljs-string"><span class="hljs-string">"object"</span></span></code> <br>   ,     <span class="hljs-string"><span class="hljs-string">"hello world"</span></span> .  helloworld.js . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/helloworld.png'</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'Hello world'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">100</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, angle: <span class="hljs-number"><span class="hljs-number">15</span></span> }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   <span class="hljs-number"><span class="hljs-number">200</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>)</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     <span class="hljs-number"><span class="hljs-number">25</span></span> ! <br> <code class="javascript">var fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>), url = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'url'</span></span>), PORT = <span class="hljs-number"><span class="hljs-number">8124</span></span>; var server = http.createServer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request, response)</span></span></span></span> { var params = url.parse(request.url, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); response.writeHead(<span class="hljs-number"><span class="hljs-number">200</span></span>, { <span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'image/png'</span></span> }); canvas.loadFromJSON(params.query.data, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { response.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); }); stream.on(<span class="hljs-string"><span class="hljs-string">'end'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { response.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{<span class="hljs-string"><span class="hljs-string">"objects"</span></span>:[{<span class="hljs-string"><span class="hljs-string">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"rect"</span></span>,<span class="hljs-string"><span class="hljs-string">"left"</span></span>:<span class="hljs-number"><span class="hljs-number">103.85</span></span>,<span class="hljs-string"><span class="hljs-string">"top"</span></span>:<span class="hljs-number"><span class="hljs-number">98.85</span></span>,<span class="hljs-string"><span class="hljs-string">"width"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"height"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"fill"</span></span>:<span class="hljs-string"><span class="hljs-string">"#9ae759"</span></span>,<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"angle"</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span>,<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>:<span class="hljs-number"><span class="hljs-number">0.8</span></span>,<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"rx"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">"ry"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}],<span class="hljs-string"><span class="hljs-string">"background"</span></span>:<span class="hljs-string"><span class="hljs-string">"rgba(0, 0, 0, 0)"</span></span>}</code> <br> URI  : <br> <code class="javascript">%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"objects"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A%<span class="hljs-number"><span class="hljs-number">5</span></span>B%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"type"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rect"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"left"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A103<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"top"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A98<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"width"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"height"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"fill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"%239ae759"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"angle"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A30%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0<span class="hljs-number"><span class="hljs-number">.8</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"rx"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"ry"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">7</span></span>D%<span class="hljs-number"><span class="hljs-number">5</span></span>D%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"background"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rgba(0%2C%200%2C%200%2C%200)"</span></span>%<span class="hljs-number"><span class="hljs-number">7</span></span>D</code> <br>       <span class="hljs-string"><span class="hljs-string">"data"</span></span>.      <span class="hljs-string"><span class="hljs-string">"image/png"</span></span>   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-number"><span class="hljs-number">250</span></span>); var font = new canvas.Font(<span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, __dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Regular.ttf'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Bold.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Italic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'normal'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-BoldItalic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'regular'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">50</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">150</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">200</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); var out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/customfont.png'</span></span>); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/"><span class="hljs-number"><span class="hljs-number">2</span></span>-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code></code> </pre> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <pre> <code class="hljs lua"><code> ,       . Canvas -   <span class="hljs-number"><span class="hljs-number">2</span></span>D ,     .     -    . ,  Fabric   . <br> <br>     ,    <span class="hljs-literal"><span class="hljs-literal">true</span></span></code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> .       ,    <span class="hljs-string"><span class="hljs-string">"mouseup"</span></span>, Fabric   <span class="hljs-string"><span class="hljs-string">"path:created"</span></span>,         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . <span class="hljs-string"><span class="hljs-string">"lockMovementX"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockMovementY"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockRotation"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockScalingX"</span></span>  <span class="hljs-string"><span class="hljs-string">"lockScalingY"</span></span> ‚Äì      .    <code>object.lockMovementX</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   <span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>  <span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>.     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    <span class="hljs-string"><span class="hljs-string">""</span></span>. <br> <code class="javascript">object.hasBorders = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   <span class="hljs-string"><span class="hljs-string">"borderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"cornerColor"</span></span>,  <span class="hljs-string"><span class="hljs-string">"cornerSize"</span></span>. <br> <code class="javascript">object.set({ borderColor: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, cornerColor: <span class="hljs-string"><span class="hljs-string">'green'</span></span>, cornerSize: <span class="hljs-number"><span class="hljs-number">6</span></span> });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   <span class="hljs-string"><span class="hljs-string">"selection"</span></span>  canvas  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     ,    canvas.         ,       <span class="hljs-string"><span class="hljs-string">"selectable"</span></span>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .      . <br> <br>   <br>       ,     ?  . <br>  <span class="hljs-number"><span class="hljs-number">4</span></span>   canvas,     - <span class="hljs-string"><span class="hljs-string">"selectionColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionBorderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionLineWidth"</span></span>,  <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.selectionColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,255,0,0.3)'</span></span>; canvas.selectionBorderColor = <span class="hljs-string"><span class="hljs-string">'red'</span></span>; canvas.selectionLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span> ‚Äì   .       .    ,    .   ,      ,    -   <code>[<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>]</code>    <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.        <span class="hljs-number"><span class="hljs-number">10</span></span>px,     <span class="hljs-number"><span class="hljs-number">5</span></span>px,  ,   .     <code>[<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>]</code> ,     :      <span class="hljs-number"><span class="hljs-number">2</span></span>px,    <span class="hljs-number"><span class="hljs-number">4</span></span>px,    ,     <span class="hljs-number"><span class="hljs-number">6</span></span>px   .    ,      <code>[<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>   canvas,  Fabric    <span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>,       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: <span class="hljs-string"><span class="hljs-string">'#06538e'</span></span>, width: <span class="hljs-number"><span class="hljs-number">125</span></span>, height: <span class="hljs-number"><span class="hljs-number">125</span></span>, stroke: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, strokeDashArray: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     <span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>     <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <br>   <br> <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> Fabric   UI. ,   ,      .          . ,      - <span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>.          <span class="hljs-string"><span class="hljs-string">"rotatingPointOffset"</span></span>. <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> ,    ,    .    - <span class="hljs-string"><span class="hljs-string">"uniScaleTransform"</span></span>  canvas.   ,     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     <span class="hljs-string"><span class="hljs-string">"centeredScaling"</span></span>  <span class="hljs-string"><span class="hljs-string">"centeredRotation"</span></span> (  <span class="hljs-number"><span class="hljs-number">1.3</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span>    - <span class="hljs-string"><span class="hljs-string">"centerTransform"</span></span>).  ,       .    <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,  ,     <span class="hljs-number"><span class="hljs-number">1.0</span></span>,    /   .    <span class="hljs-number"><span class="hljs-number">1.0</span></span>.    . <br> <br>      <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>.        <span class="hljs-string"><span class="hljs-string">"left"</span></span>  <span class="hljs-string"><span class="hljs-string">"top"</span></span>.       .     ,     , <span class="hljs-string"><span class="hljs-string">" "</span></span>. <br> <br>         ? ,   -.     ,    , <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>     .     -,     originX  <span class="hljs-string"><span class="hljs-string">"center"</span></span>.       ‚Äì  originX  <span class="hljs-string"><span class="hljs-string">"right"</span></span>  ..     <span class="hljs-string"><span class="hljs-string">"position: absolute"</span></span>  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/"><span class="hljs-number"><span class="hljs-number">1</span></span>-  </a> ,          canvas.            <span class="hljs-string"><span class="hljs-string">"backgroundColor"</span></span>. <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.backgroundColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,0,255,0.3)'</span></span>; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setBackgroundImage(<span class="hljs-string"><span class="hljs-string">'../assets/pug.jpg'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setOverlayImage(<span class="hljs-string"><span class="hljs-string">'../assets/jail_cell_bars.png'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî <span class="hljs-number"><span class="hljs-number">2</span></span>D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric <span class="hljs-built_in"><span class="hljs-built_in">package</span></span></a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'canvas'</span></span>); // <span class="hljs-string"><span class="hljs-string">"function"</span></span> &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>); // <span class="hljs-string"><span class="hljs-string">"object"</span></span></code> <br>   ,     <span class="hljs-string"><span class="hljs-string">"hello world"</span></span> .  helloworld.js . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/helloworld.png'</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'Hello world'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">100</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, angle: <span class="hljs-number"><span class="hljs-number">15</span></span> }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   <span class="hljs-number"><span class="hljs-number">200</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>)</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     <span class="hljs-number"><span class="hljs-number">25</span></span> ! <br> <code class="javascript">var fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>), url = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'url'</span></span>), PORT = <span class="hljs-number"><span class="hljs-number">8124</span></span>; var server = http.createServer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request, response)</span></span></span></span> { var params = url.parse(request.url, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); response.writeHead(<span class="hljs-number"><span class="hljs-number">200</span></span>, { <span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'image/png'</span></span> }); canvas.loadFromJSON(params.query.data, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { response.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); }); stream.on(<span class="hljs-string"><span class="hljs-string">'end'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { response.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{<span class="hljs-string"><span class="hljs-string">"objects"</span></span>:[{<span class="hljs-string"><span class="hljs-string">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"rect"</span></span>,<span class="hljs-string"><span class="hljs-string">"left"</span></span>:<span class="hljs-number"><span class="hljs-number">103.85</span></span>,<span class="hljs-string"><span class="hljs-string">"top"</span></span>:<span class="hljs-number"><span class="hljs-number">98.85</span></span>,<span class="hljs-string"><span class="hljs-string">"width"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"height"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"fill"</span></span>:<span class="hljs-string"><span class="hljs-string">"#9ae759"</span></span>,<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"angle"</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span>,<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>:<span class="hljs-number"><span class="hljs-number">0.8</span></span>,<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"rx"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">"ry"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}],<span class="hljs-string"><span class="hljs-string">"background"</span></span>:<span class="hljs-string"><span class="hljs-string">"rgba(0, 0, 0, 0)"</span></span>}</code> <br> URI  : <br> <code class="javascript">%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"objects"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A%<span class="hljs-number"><span class="hljs-number">5</span></span>B%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"type"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rect"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"left"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A103<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"top"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A98<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"width"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"height"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"fill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"%239ae759"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"angle"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A30%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0<span class="hljs-number"><span class="hljs-number">.8</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"rx"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"ry"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">7</span></span>D%<span class="hljs-number"><span class="hljs-number">5</span></span>D%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"background"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rgba(0%2C%200%2C%200%2C%200)"</span></span>%<span class="hljs-number"><span class="hljs-number">7</span></span>D</code> <br>       <span class="hljs-string"><span class="hljs-string">"data"</span></span>.      <span class="hljs-string"><span class="hljs-string">"image/png"</span></span>   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-number"><span class="hljs-number">250</span></span>); var font = new canvas.Font(<span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, __dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Regular.ttf'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Bold.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Italic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'normal'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-BoldItalic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'regular'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">50</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">150</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">200</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); var out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/customfont.png'</span></span>); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/"><span class="hljs-number"><span class="hljs-number">2</span></span>-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> </pre> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <h4> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> </h4> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <h4> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> </h4> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <pre> <code class="hljs lua"><code> ,       . Canvas -   <span class="hljs-number"><span class="hljs-number">2</span></span>D ,     .     -    . ,  Fabric   . <br> <br>     ,    <span class="hljs-literal"><span class="hljs-literal">true</span></span></code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> .       ,    <span class="hljs-string"><span class="hljs-string">"mouseup"</span></span>, Fabric   <span class="hljs-string"><span class="hljs-string">"path:created"</span></span>,         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . <span class="hljs-string"><span class="hljs-string">"lockMovementX"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockMovementY"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockRotation"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockScalingX"</span></span>  <span class="hljs-string"><span class="hljs-string">"lockScalingY"</span></span> ‚Äì      .    <code>object.lockMovementX</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   <span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>  <span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>.     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    <span class="hljs-string"><span class="hljs-string">""</span></span>. <br> <code class="javascript">object.hasBorders = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   <span class="hljs-string"><span class="hljs-string">"borderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"cornerColor"</span></span>,  <span class="hljs-string"><span class="hljs-string">"cornerSize"</span></span>. <br> <code class="javascript">object.set({ borderColor: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, cornerColor: <span class="hljs-string"><span class="hljs-string">'green'</span></span>, cornerSize: <span class="hljs-number"><span class="hljs-number">6</span></span> });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   <span class="hljs-string"><span class="hljs-string">"selection"</span></span>  canvas  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     ,    canvas.         ,       <span class="hljs-string"><span class="hljs-string">"selectable"</span></span>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .      . <br> <br>   <br>       ,     ?  . <br>  <span class="hljs-number"><span class="hljs-number">4</span></span>   canvas,     - <span class="hljs-string"><span class="hljs-string">"selectionColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionBorderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionLineWidth"</span></span>,  <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.selectionColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,255,0,0.3)'</span></span>; canvas.selectionBorderColor = <span class="hljs-string"><span class="hljs-string">'red'</span></span>; canvas.selectionLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span> ‚Äì   .       .    ,    .   ,      ,    -   <code>[<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>]</code>    <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.        <span class="hljs-number"><span class="hljs-number">10</span></span>px,     <span class="hljs-number"><span class="hljs-number">5</span></span>px,  ,   .     <code>[<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>]</code> ,     :      <span class="hljs-number"><span class="hljs-number">2</span></span>px,    <span class="hljs-number"><span class="hljs-number">4</span></span>px,    ,     <span class="hljs-number"><span class="hljs-number">6</span></span>px   .    ,      <code>[<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>   canvas,  Fabric    <span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>,       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: <span class="hljs-string"><span class="hljs-string">'#06538e'</span></span>, width: <span class="hljs-number"><span class="hljs-number">125</span></span>, height: <span class="hljs-number"><span class="hljs-number">125</span></span>, stroke: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, strokeDashArray: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     <span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>     <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <br>   <br> <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> Fabric   UI. ,   ,      .          . ,      - <span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>.          <span class="hljs-string"><span class="hljs-string">"rotatingPointOffset"</span></span>. <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> ,    ,    .    - <span class="hljs-string"><span class="hljs-string">"uniScaleTransform"</span></span>  canvas.   ,     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     <span class="hljs-string"><span class="hljs-string">"centeredScaling"</span></span>  <span class="hljs-string"><span class="hljs-string">"centeredRotation"</span></span> (  <span class="hljs-number"><span class="hljs-number">1.3</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span>    - <span class="hljs-string"><span class="hljs-string">"centerTransform"</span></span>).  ,       .    <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,  ,     <span class="hljs-number"><span class="hljs-number">1.0</span></span>,    /   .    <span class="hljs-number"><span class="hljs-number">1.0</span></span>.    . <br> <br>      <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>.        <span class="hljs-string"><span class="hljs-string">"left"</span></span>  <span class="hljs-string"><span class="hljs-string">"top"</span></span>.       .     ,     , <span class="hljs-string"><span class="hljs-string">" "</span></span>. <br> <br>         ? ,   -.     ,    , <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>     .     -,     originX  <span class="hljs-string"><span class="hljs-string">"center"</span></span>.       ‚Äì  originX  <span class="hljs-string"><span class="hljs-string">"right"</span></span>  ..     <span class="hljs-string"><span class="hljs-string">"position: absolute"</span></span>  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/"><span class="hljs-number"><span class="hljs-number">1</span></span>-  </a> ,          canvas.            <span class="hljs-string"><span class="hljs-string">"backgroundColor"</span></span>. <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.backgroundColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,0,255,0.3)'</span></span>; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setBackgroundImage(<span class="hljs-string"><span class="hljs-string">'../assets/pug.jpg'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setOverlayImage(<span class="hljs-string"><span class="hljs-string">'../assets/jail_cell_bars.png'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî <span class="hljs-number"><span class="hljs-number">2</span></span>D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric <span class="hljs-built_in"><span class="hljs-built_in">package</span></span></a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'canvas'</span></span>); // <span class="hljs-string"><span class="hljs-string">"function"</span></span> &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>); // <span class="hljs-string"><span class="hljs-string">"object"</span></span></code> <br>   ,     <span class="hljs-string"><span class="hljs-string">"hello world"</span></span> .  helloworld.js . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/helloworld.png'</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'Hello world'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">100</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, angle: <span class="hljs-number"><span class="hljs-number">15</span></span> }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   <span class="hljs-number"><span class="hljs-number">200</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>)</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     <span class="hljs-number"><span class="hljs-number">25</span></span> ! <br> <code class="javascript">var fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>), url = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'url'</span></span>), PORT = <span class="hljs-number"><span class="hljs-number">8124</span></span>; var server = http.createServer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request, response)</span></span></span></span> { var params = url.parse(request.url, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); response.writeHead(<span class="hljs-number"><span class="hljs-number">200</span></span>, { <span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'image/png'</span></span> }); canvas.loadFromJSON(params.query.data, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { response.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); }); stream.on(<span class="hljs-string"><span class="hljs-string">'end'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { response.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{<span class="hljs-string"><span class="hljs-string">"objects"</span></span>:[{<span class="hljs-string"><span class="hljs-string">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"rect"</span></span>,<span class="hljs-string"><span class="hljs-string">"left"</span></span>:<span class="hljs-number"><span class="hljs-number">103.85</span></span>,<span class="hljs-string"><span class="hljs-string">"top"</span></span>:<span class="hljs-number"><span class="hljs-number">98.85</span></span>,<span class="hljs-string"><span class="hljs-string">"width"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"height"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"fill"</span></span>:<span class="hljs-string"><span class="hljs-string">"#9ae759"</span></span>,<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"angle"</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span>,<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>:<span class="hljs-number"><span class="hljs-number">0.8</span></span>,<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"rx"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">"ry"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}],<span class="hljs-string"><span class="hljs-string">"background"</span></span>:<span class="hljs-string"><span class="hljs-string">"rgba(0, 0, 0, 0)"</span></span>}</code> <br> URI  : <br> <code class="javascript">%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"objects"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A%<span class="hljs-number"><span class="hljs-number">5</span></span>B%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"type"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rect"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"left"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A103<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"top"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A98<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"width"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"height"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"fill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"%239ae759"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"angle"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A30%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0<span class="hljs-number"><span class="hljs-number">.8</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"rx"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"ry"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">7</span></span>D%<span class="hljs-number"><span class="hljs-number">5</span></span>D%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"background"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rgba(0%2C%200%2C%200%2C%200)"</span></span>%<span class="hljs-number"><span class="hljs-number">7</span></span>D</code> <br>       <span class="hljs-string"><span class="hljs-string">"data"</span></span>.      <span class="hljs-string"><span class="hljs-string">"image/png"</span></span>   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-number"><span class="hljs-number">250</span></span>); var font = new canvas.Font(<span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, __dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Regular.ttf'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Bold.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Italic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'normal'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-BoldItalic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'regular'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">50</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">150</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">200</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); var out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/customfont.png'</span></span>); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/"><span class="hljs-number"><span class="hljs-number">2</span></span>-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> </pre> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <h4> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> </h4> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <pre> <code class="hljs lua"><code> ,       . Canvas -   <span class="hljs-number"><span class="hljs-number">2</span></span>D ,     .     -    . ,  Fabric   . <br> <br>     ,    <span class="hljs-literal"><span class="hljs-literal">true</span></span></code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> .       ,    <span class="hljs-string"><span class="hljs-string">"mouseup"</span></span>, Fabric   <span class="hljs-string"><span class="hljs-string">"path:created"</span></span>,         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . <span class="hljs-string"><span class="hljs-string">"lockMovementX"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockMovementY"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockRotation"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockScalingX"</span></span>  <span class="hljs-string"><span class="hljs-string">"lockScalingY"</span></span> ‚Äì      .    <code>object.lockMovementX</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   <span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>  <span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>.     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    <span class="hljs-string"><span class="hljs-string">""</span></span>. <br> <code class="javascript">object.hasBorders = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   <span class="hljs-string"><span class="hljs-string">"borderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"cornerColor"</span></span>,  <span class="hljs-string"><span class="hljs-string">"cornerSize"</span></span>. <br> <code class="javascript">object.set({ borderColor: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, cornerColor: <span class="hljs-string"><span class="hljs-string">'green'</span></span>, cornerSize: <span class="hljs-number"><span class="hljs-number">6</span></span> });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   <span class="hljs-string"><span class="hljs-string">"selection"</span></span>  canvas  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     ,    canvas.         ,       <span class="hljs-string"><span class="hljs-string">"selectable"</span></span>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .      . <br> <br>   <br>       ,     ?  . <br>  <span class="hljs-number"><span class="hljs-number">4</span></span>   canvas,     - <span class="hljs-string"><span class="hljs-string">"selectionColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionBorderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionLineWidth"</span></span>,  <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.selectionColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,255,0,0.3)'</span></span>; canvas.selectionBorderColor = <span class="hljs-string"><span class="hljs-string">'red'</span></span>; canvas.selectionLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span> ‚Äì   .       .    ,    .   ,      ,    -   <code>[<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>]</code>    <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.        <span class="hljs-number"><span class="hljs-number">10</span></span>px,     <span class="hljs-number"><span class="hljs-number">5</span></span>px,  ,   .     <code>[<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>]</code> ,     :      <span class="hljs-number"><span class="hljs-number">2</span></span>px,    <span class="hljs-number"><span class="hljs-number">4</span></span>px,    ,     <span class="hljs-number"><span class="hljs-number">6</span></span>px   .    ,      <code>[<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>   canvas,  Fabric    <span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>,       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: <span class="hljs-string"><span class="hljs-string">'#06538e'</span></span>, width: <span class="hljs-number"><span class="hljs-number">125</span></span>, height: <span class="hljs-number"><span class="hljs-number">125</span></span>, stroke: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, strokeDashArray: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     <span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>     <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <br>   <br> <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> Fabric   UI. ,   ,      .          . ,      - <span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>.          <span class="hljs-string"><span class="hljs-string">"rotatingPointOffset"</span></span>. <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> ,    ,    .    - <span class="hljs-string"><span class="hljs-string">"uniScaleTransform"</span></span>  canvas.   ,     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     <span class="hljs-string"><span class="hljs-string">"centeredScaling"</span></span>  <span class="hljs-string"><span class="hljs-string">"centeredRotation"</span></span> (  <span class="hljs-number"><span class="hljs-number">1.3</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span>    - <span class="hljs-string"><span class="hljs-string">"centerTransform"</span></span>).  ,       .    <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,  ,     <span class="hljs-number"><span class="hljs-number">1.0</span></span>,    /   .    <span class="hljs-number"><span class="hljs-number">1.0</span></span>.    . <br> <br>      <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>.        <span class="hljs-string"><span class="hljs-string">"left"</span></span>  <span class="hljs-string"><span class="hljs-string">"top"</span></span>.       .     ,     , <span class="hljs-string"><span class="hljs-string">" "</span></span>. <br> <br>         ? ,   -.     ,    , <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>     .     -,     originX  <span class="hljs-string"><span class="hljs-string">"center"</span></span>.       ‚Äì  originX  <span class="hljs-string"><span class="hljs-string">"right"</span></span>  ..     <span class="hljs-string"><span class="hljs-string">"position: absolute"</span></span>  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/"><span class="hljs-number"><span class="hljs-number">1</span></span>-  </a> ,          canvas.            <span class="hljs-string"><span class="hljs-string">"backgroundColor"</span></span>. <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.backgroundColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,0,255,0.3)'</span></span>; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setBackgroundImage(<span class="hljs-string"><span class="hljs-string">'../assets/pug.jpg'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setOverlayImage(<span class="hljs-string"><span class="hljs-string">'../assets/jail_cell_bars.png'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî <span class="hljs-number"><span class="hljs-number">2</span></span>D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric <span class="hljs-built_in"><span class="hljs-built_in">package</span></span></a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'canvas'</span></span>); // <span class="hljs-string"><span class="hljs-string">"function"</span></span> &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>); // <span class="hljs-string"><span class="hljs-string">"object"</span></span></code> <br>   ,     <span class="hljs-string"><span class="hljs-string">"hello world"</span></span> .  helloworld.js . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/helloworld.png'</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'Hello world'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">100</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, angle: <span class="hljs-number"><span class="hljs-number">15</span></span> }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   <span class="hljs-number"><span class="hljs-number">200</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>)</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     <span class="hljs-number"><span class="hljs-number">25</span></span> ! <br> <code class="javascript">var fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>), url = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'url'</span></span>), PORT = <span class="hljs-number"><span class="hljs-number">8124</span></span>; var server = http.createServer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request, response)</span></span></span></span> { var params = url.parse(request.url, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); response.writeHead(<span class="hljs-number"><span class="hljs-number">200</span></span>, { <span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'image/png'</span></span> }); canvas.loadFromJSON(params.query.data, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { response.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); }); stream.on(<span class="hljs-string"><span class="hljs-string">'end'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { response.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{<span class="hljs-string"><span class="hljs-string">"objects"</span></span>:[{<span class="hljs-string"><span class="hljs-string">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"rect"</span></span>,<span class="hljs-string"><span class="hljs-string">"left"</span></span>:<span class="hljs-number"><span class="hljs-number">103.85</span></span>,<span class="hljs-string"><span class="hljs-string">"top"</span></span>:<span class="hljs-number"><span class="hljs-number">98.85</span></span>,<span class="hljs-string"><span class="hljs-string">"width"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"height"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"fill"</span></span>:<span class="hljs-string"><span class="hljs-string">"#9ae759"</span></span>,<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"angle"</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span>,<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>:<span class="hljs-number"><span class="hljs-number">0.8</span></span>,<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"rx"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">"ry"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}],<span class="hljs-string"><span class="hljs-string">"background"</span></span>:<span class="hljs-string"><span class="hljs-string">"rgba(0, 0, 0, 0)"</span></span>}</code> <br> URI  : <br> <code class="javascript">%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"objects"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A%<span class="hljs-number"><span class="hljs-number">5</span></span>B%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"type"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rect"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"left"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A103<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"top"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A98<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"width"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"height"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"fill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"%239ae759"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"angle"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A30%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0<span class="hljs-number"><span class="hljs-number">.8</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"rx"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"ry"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">7</span></span>D%<span class="hljs-number"><span class="hljs-number">5</span></span>D%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"background"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rgba(0%2C%200%2C%200%2C%200)"</span></span>%<span class="hljs-number"><span class="hljs-number">7</span></span>D</code> <br>       <span class="hljs-string"><span class="hljs-string">"data"</span></span>.      <span class="hljs-string"><span class="hljs-string">"image/png"</span></span>   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-number"><span class="hljs-number">250</span></span>); var font = new canvas.Font(<span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, __dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Regular.ttf'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Bold.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Italic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'normal'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-BoldItalic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'regular'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">50</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">150</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">200</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); var out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/customfont.png'</span></span>); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/"><span class="hljs-number"><span class="hljs-number">2</span></span>-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> </pre> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <h4> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> </h4> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <h4> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> </h4> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <h4> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> </h4> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <h4> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> </h4> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <pre> <code class="hljs lua"><code> ,       . Canvas -   <span class="hljs-number"><span class="hljs-number">2</span></span>D ,     .     -    . ,  Fabric   . <br> <br>     ,    <span class="hljs-literal"><span class="hljs-literal">true</span></span></code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> .       ,    <span class="hljs-string"><span class="hljs-string">"mouseup"</span></span>, Fabric   <span class="hljs-string"><span class="hljs-string">"path:created"</span></span>,         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . <span class="hljs-string"><span class="hljs-string">"lockMovementX"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockMovementY"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockRotation"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockScalingX"</span></span>  <span class="hljs-string"><span class="hljs-string">"lockScalingY"</span></span> ‚Äì      .    <code>object.lockMovementX</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   <span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>  <span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>.     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    <span class="hljs-string"><span class="hljs-string">""</span></span>. <br> <code class="javascript">object.hasBorders = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   <span class="hljs-string"><span class="hljs-string">"borderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"cornerColor"</span></span>,  <span class="hljs-string"><span class="hljs-string">"cornerSize"</span></span>. <br> <code class="javascript">object.set({ borderColor: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, cornerColor: <span class="hljs-string"><span class="hljs-string">'green'</span></span>, cornerSize: <span class="hljs-number"><span class="hljs-number">6</span></span> });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   <span class="hljs-string"><span class="hljs-string">"selection"</span></span>  canvas  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     ,    canvas.         ,       <span class="hljs-string"><span class="hljs-string">"selectable"</span></span>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .      . <br> <br>   <br>       ,     ?  . <br>  <span class="hljs-number"><span class="hljs-number">4</span></span>   canvas,     - <span class="hljs-string"><span class="hljs-string">"selectionColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionBorderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionLineWidth"</span></span>,  <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.selectionColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,255,0,0.3)'</span></span>; canvas.selectionBorderColor = <span class="hljs-string"><span class="hljs-string">'red'</span></span>; canvas.selectionLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span> ‚Äì   .       .    ,    .   ,      ,    -   <code>[<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>]</code>    <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.        <span class="hljs-number"><span class="hljs-number">10</span></span>px,     <span class="hljs-number"><span class="hljs-number">5</span></span>px,  ,   .     <code>[<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>]</code> ,     :      <span class="hljs-number"><span class="hljs-number">2</span></span>px,    <span class="hljs-number"><span class="hljs-number">4</span></span>px,    ,     <span class="hljs-number"><span class="hljs-number">6</span></span>px   .    ,      <code>[<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>   canvas,  Fabric    <span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>,       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: <span class="hljs-string"><span class="hljs-string">'#06538e'</span></span>, width: <span class="hljs-number"><span class="hljs-number">125</span></span>, height: <span class="hljs-number"><span class="hljs-number">125</span></span>, stroke: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, strokeDashArray: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     <span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>     <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <br>   <br> <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> Fabric   UI. ,   ,      .          . ,      - <span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>.          <span class="hljs-string"><span class="hljs-string">"rotatingPointOffset"</span></span>. <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> ,    ,    .    - <span class="hljs-string"><span class="hljs-string">"uniScaleTransform"</span></span>  canvas.   ,     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     <span class="hljs-string"><span class="hljs-string">"centeredScaling"</span></span>  <span class="hljs-string"><span class="hljs-string">"centeredRotation"</span></span> (  <span class="hljs-number"><span class="hljs-number">1.3</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span>    - <span class="hljs-string"><span class="hljs-string">"centerTransform"</span></span>).  ,       .    <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,  ,     <span class="hljs-number"><span class="hljs-number">1.0</span></span>,    /   .    <span class="hljs-number"><span class="hljs-number">1.0</span></span>.    . <br> <br>      <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>.        <span class="hljs-string"><span class="hljs-string">"left"</span></span>  <span class="hljs-string"><span class="hljs-string">"top"</span></span>.       .     ,     , <span class="hljs-string"><span class="hljs-string">" "</span></span>. <br> <br>         ? ,   -.     ,    , <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>     .     -,     originX  <span class="hljs-string"><span class="hljs-string">"center"</span></span>.       ‚Äì  originX  <span class="hljs-string"><span class="hljs-string">"right"</span></span>  ..     <span class="hljs-string"><span class="hljs-string">"position: absolute"</span></span>  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/"><span class="hljs-number"><span class="hljs-number">1</span></span>-  </a> ,          canvas.            <span class="hljs-string"><span class="hljs-string">"backgroundColor"</span></span>. <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.backgroundColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,0,255,0.3)'</span></span>; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setBackgroundImage(<span class="hljs-string"><span class="hljs-string">'../assets/pug.jpg'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setOverlayImage(<span class="hljs-string"><span class="hljs-string">'../assets/jail_cell_bars.png'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî <span class="hljs-number"><span class="hljs-number">2</span></span>D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric <span class="hljs-built_in"><span class="hljs-built_in">package</span></span></a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'canvas'</span></span>); // <span class="hljs-string"><span class="hljs-string">"function"</span></span> &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>); // <span class="hljs-string"><span class="hljs-string">"object"</span></span></code> <br>   ,     <span class="hljs-string"><span class="hljs-string">"hello world"</span></span> .  helloworld.js . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/helloworld.png'</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'Hello world'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">100</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, angle: <span class="hljs-number"><span class="hljs-number">15</span></span> }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   <span class="hljs-number"><span class="hljs-number">200</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>)</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     <span class="hljs-number"><span class="hljs-number">25</span></span> ! <br> <code class="javascript">var fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>), url = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'url'</span></span>), PORT = <span class="hljs-number"><span class="hljs-number">8124</span></span>; var server = http.createServer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request, response)</span></span></span></span> { var params = url.parse(request.url, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); response.writeHead(<span class="hljs-number"><span class="hljs-number">200</span></span>, { <span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'image/png'</span></span> }); canvas.loadFromJSON(params.query.data, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { response.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); }); stream.on(<span class="hljs-string"><span class="hljs-string">'end'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { response.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{<span class="hljs-string"><span class="hljs-string">"objects"</span></span>:[{<span class="hljs-string"><span class="hljs-string">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"rect"</span></span>,<span class="hljs-string"><span class="hljs-string">"left"</span></span>:<span class="hljs-number"><span class="hljs-number">103.85</span></span>,<span class="hljs-string"><span class="hljs-string">"top"</span></span>:<span class="hljs-number"><span class="hljs-number">98.85</span></span>,<span class="hljs-string"><span class="hljs-string">"width"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"height"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"fill"</span></span>:<span class="hljs-string"><span class="hljs-string">"#9ae759"</span></span>,<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"angle"</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span>,<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>:<span class="hljs-number"><span class="hljs-number">0.8</span></span>,<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"rx"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">"ry"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}],<span class="hljs-string"><span class="hljs-string">"background"</span></span>:<span class="hljs-string"><span class="hljs-string">"rgba(0, 0, 0, 0)"</span></span>}</code> <br> URI  : <br> <code class="javascript">%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"objects"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A%<span class="hljs-number"><span class="hljs-number">5</span></span>B%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"type"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rect"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"left"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A103<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"top"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A98<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"width"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"height"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"fill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"%239ae759"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"angle"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A30%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0<span class="hljs-number"><span class="hljs-number">.8</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"rx"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"ry"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">7</span></span>D%<span class="hljs-number"><span class="hljs-number">5</span></span>D%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"background"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rgba(0%2C%200%2C%200%2C%200)"</span></span>%<span class="hljs-number"><span class="hljs-number">7</span></span>D</code> <br>       <span class="hljs-string"><span class="hljs-string">"data"</span></span>.      <span class="hljs-string"><span class="hljs-string">"image/png"</span></span>   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-number"><span class="hljs-number">250</span></span>); var font = new canvas.Font(<span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, __dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Regular.ttf'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Bold.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Italic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'normal'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-BoldItalic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'regular'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">50</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">150</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">200</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); var out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/customfont.png'</span></span>); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/"><span class="hljs-number"><span class="hljs-number">2</span></span>-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> </pre> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <pre> <code class="hljs lua"><code> ,       . Canvas -   <span class="hljs-number"><span class="hljs-number">2</span></span>D ,     .     -    . ,  Fabric   . <br> <br>     ,    <span class="hljs-literal"><span class="hljs-literal">true</span></span></code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> .       ,    <span class="hljs-string"><span class="hljs-string">"mouseup"</span></span>, Fabric   <span class="hljs-string"><span class="hljs-string">"path:created"</span></span>,         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . <span class="hljs-string"><span class="hljs-string">"lockMovementX"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockMovementY"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockRotation"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockScalingX"</span></span>  <span class="hljs-string"><span class="hljs-string">"lockScalingY"</span></span> ‚Äì      .    <code>object.lockMovementX</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   <span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>  <span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>.     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    <span class="hljs-string"><span class="hljs-string">""</span></span>. <br> <code class="javascript">object.hasBorders = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   <span class="hljs-string"><span class="hljs-string">"borderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"cornerColor"</span></span>,  <span class="hljs-string"><span class="hljs-string">"cornerSize"</span></span>. <br> <code class="javascript">object.set({ borderColor: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, cornerColor: <span class="hljs-string"><span class="hljs-string">'green'</span></span>, cornerSize: <span class="hljs-number"><span class="hljs-number">6</span></span> });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   <span class="hljs-string"><span class="hljs-string">"selection"</span></span>  canvas  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     ,    canvas.         ,       <span class="hljs-string"><span class="hljs-string">"selectable"</span></span>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .      . <br> <br>   <br>       ,     ?  . <br>  <span class="hljs-number"><span class="hljs-number">4</span></span>   canvas,     - <span class="hljs-string"><span class="hljs-string">"selectionColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionBorderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionLineWidth"</span></span>,  <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.selectionColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,255,0,0.3)'</span></span>; canvas.selectionBorderColor = <span class="hljs-string"><span class="hljs-string">'red'</span></span>; canvas.selectionLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span> ‚Äì   .       .    ,    .   ,      ,    -   <code>[<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>]</code>    <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.        <span class="hljs-number"><span class="hljs-number">10</span></span>px,     <span class="hljs-number"><span class="hljs-number">5</span></span>px,  ,   .     <code>[<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>]</code> ,     :      <span class="hljs-number"><span class="hljs-number">2</span></span>px,    <span class="hljs-number"><span class="hljs-number">4</span></span>px,    ,     <span class="hljs-number"><span class="hljs-number">6</span></span>px   .    ,      <code>[<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>   canvas,  Fabric    <span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>,       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: <span class="hljs-string"><span class="hljs-string">'#06538e'</span></span>, width: <span class="hljs-number"><span class="hljs-number">125</span></span>, height: <span class="hljs-number"><span class="hljs-number">125</span></span>, stroke: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, strokeDashArray: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     <span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>     <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <br>   <br> <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> Fabric   UI. ,   ,      .          . ,      - <span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>.          <span class="hljs-string"><span class="hljs-string">"rotatingPointOffset"</span></span>. <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> ,    ,    .    - <span class="hljs-string"><span class="hljs-string">"uniScaleTransform"</span></span>  canvas.   ,     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     <span class="hljs-string"><span class="hljs-string">"centeredScaling"</span></span>  <span class="hljs-string"><span class="hljs-string">"centeredRotation"</span></span> (  <span class="hljs-number"><span class="hljs-number">1.3</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span>    - <span class="hljs-string"><span class="hljs-string">"centerTransform"</span></span>).  ,       .    <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,  ,     <span class="hljs-number"><span class="hljs-number">1.0</span></span>,    /   .    <span class="hljs-number"><span class="hljs-number">1.0</span></span>.    . <br> <br>      <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>.        <span class="hljs-string"><span class="hljs-string">"left"</span></span>  <span class="hljs-string"><span class="hljs-string">"top"</span></span>.       .     ,     , <span class="hljs-string"><span class="hljs-string">" "</span></span>. <br> <br>         ? ,   -.     ,    , <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>     .     -,     originX  <span class="hljs-string"><span class="hljs-string">"center"</span></span>.       ‚Äì  originX  <span class="hljs-string"><span class="hljs-string">"right"</span></span>  ..     <span class="hljs-string"><span class="hljs-string">"position: absolute"</span></span>  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/"><span class="hljs-number"><span class="hljs-number">1</span></span>-  </a> ,          canvas.            <span class="hljs-string"><span class="hljs-string">"backgroundColor"</span></span>. <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.backgroundColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,0,255,0.3)'</span></span>; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setBackgroundImage(<span class="hljs-string"><span class="hljs-string">'../assets/pug.jpg'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setOverlayImage(<span class="hljs-string"><span class="hljs-string">'../assets/jail_cell_bars.png'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî <span class="hljs-number"><span class="hljs-number">2</span></span>D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric <span class="hljs-built_in"><span class="hljs-built_in">package</span></span></a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'canvas'</span></span>); // <span class="hljs-string"><span class="hljs-string">"function"</span></span> &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>); // <span class="hljs-string"><span class="hljs-string">"object"</span></span></code> <br>   ,     <span class="hljs-string"><span class="hljs-string">"hello world"</span></span> .  helloworld.js . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/helloworld.png'</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'Hello world'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">100</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, angle: <span class="hljs-number"><span class="hljs-number">15</span></span> }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   <span class="hljs-number"><span class="hljs-number">200</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>)</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     <span class="hljs-number"><span class="hljs-number">25</span></span> ! <br> <code class="javascript">var fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>), url = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'url'</span></span>), PORT = <span class="hljs-number"><span class="hljs-number">8124</span></span>; var server = http.createServer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request, response)</span></span></span></span> { var params = url.parse(request.url, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); response.writeHead(<span class="hljs-number"><span class="hljs-number">200</span></span>, { <span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'image/png'</span></span> }); canvas.loadFromJSON(params.query.data, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { response.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); }); stream.on(<span class="hljs-string"><span class="hljs-string">'end'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { response.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{<span class="hljs-string"><span class="hljs-string">"objects"</span></span>:[{<span class="hljs-string"><span class="hljs-string">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"rect"</span></span>,<span class="hljs-string"><span class="hljs-string">"left"</span></span>:<span class="hljs-number"><span class="hljs-number">103.85</span></span>,<span class="hljs-string"><span class="hljs-string">"top"</span></span>:<span class="hljs-number"><span class="hljs-number">98.85</span></span>,<span class="hljs-string"><span class="hljs-string">"width"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"height"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"fill"</span></span>:<span class="hljs-string"><span class="hljs-string">"#9ae759"</span></span>,<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"angle"</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span>,<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>:<span class="hljs-number"><span class="hljs-number">0.8</span></span>,<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"rx"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">"ry"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}],<span class="hljs-string"><span class="hljs-string">"background"</span></span>:<span class="hljs-string"><span class="hljs-string">"rgba(0, 0, 0, 0)"</span></span>}</code> <br> URI  : <br> <code class="javascript">%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"objects"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A%<span class="hljs-number"><span class="hljs-number">5</span></span>B%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"type"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rect"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"left"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A103<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"top"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A98<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"width"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"height"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"fill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"%239ae759"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"angle"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A30%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0<span class="hljs-number"><span class="hljs-number">.8</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"rx"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"ry"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">7</span></span>D%<span class="hljs-number"><span class="hljs-number">5</span></span>D%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"background"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rgba(0%2C%200%2C%200%2C%200)"</span></span>%<span class="hljs-number"><span class="hljs-number">7</span></span>D</code> <br>       <span class="hljs-string"><span class="hljs-string">"data"</span></span>.      <span class="hljs-string"><span class="hljs-string">"image/png"</span></span>   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-number"><span class="hljs-number">250</span></span>); var font = new canvas.Font(<span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, __dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Regular.ttf'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Bold.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Italic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'normal'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-BoldItalic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'regular'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">50</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">150</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">200</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); var out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/customfont.png'</span></span>); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/"><span class="hljs-number"><span class="hljs-number">2</span></span>-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> </pre> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <pre> <code class="hljs lua"><code> ,       . Canvas -   <span class="hljs-number"><span class="hljs-number">2</span></span>D ,     .     -    . ,  Fabric   . <br> <br>     ,    <span class="hljs-literal"><span class="hljs-literal">true</span></span></code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> .       ,    <span class="hljs-string"><span class="hljs-string">"mouseup"</span></span>, Fabric   <span class="hljs-string"><span class="hljs-string">"path:created"</span></span>,         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . <span class="hljs-string"><span class="hljs-string">"lockMovementX"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockMovementY"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockRotation"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockScalingX"</span></span>  <span class="hljs-string"><span class="hljs-string">"lockScalingY"</span></span> ‚Äì      .    <code>object.lockMovementX</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   <span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>  <span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>.     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    <span class="hljs-string"><span class="hljs-string">""</span></span>. <br> <code class="javascript">object.hasBorders = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   <span class="hljs-string"><span class="hljs-string">"borderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"cornerColor"</span></span>,  <span class="hljs-string"><span class="hljs-string">"cornerSize"</span></span>. <br> <code class="javascript">object.set({ borderColor: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, cornerColor: <span class="hljs-string"><span class="hljs-string">'green'</span></span>, cornerSize: <span class="hljs-number"><span class="hljs-number">6</span></span> });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   <span class="hljs-string"><span class="hljs-string">"selection"</span></span>  canvas  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     ,    canvas.         ,       <span class="hljs-string"><span class="hljs-string">"selectable"</span></span>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .      . <br> <br>   <br>       ,     ?  . <br>  <span class="hljs-number"><span class="hljs-number">4</span></span>   canvas,     - <span class="hljs-string"><span class="hljs-string">"selectionColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionBorderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionLineWidth"</span></span>,  <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.selectionColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,255,0,0.3)'</span></span>; canvas.selectionBorderColor = <span class="hljs-string"><span class="hljs-string">'red'</span></span>; canvas.selectionLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span> ‚Äì   .       .    ,    .   ,      ,    -   <code>[<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>]</code>    <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.        <span class="hljs-number"><span class="hljs-number">10</span></span>px,     <span class="hljs-number"><span class="hljs-number">5</span></span>px,  ,   .     <code>[<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>]</code> ,     :      <span class="hljs-number"><span class="hljs-number">2</span></span>px,    <span class="hljs-number"><span class="hljs-number">4</span></span>px,    ,     <span class="hljs-number"><span class="hljs-number">6</span></span>px   .    ,      <code>[<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>   canvas,  Fabric    <span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>,       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: <span class="hljs-string"><span class="hljs-string">'#06538e'</span></span>, width: <span class="hljs-number"><span class="hljs-number">125</span></span>, height: <span class="hljs-number"><span class="hljs-number">125</span></span>, stroke: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, strokeDashArray: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     <span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>     <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <br>   <br> <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> Fabric   UI. ,   ,      .          . ,      - <span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>.          <span class="hljs-string"><span class="hljs-string">"rotatingPointOffset"</span></span>. <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> ,    ,    .    - <span class="hljs-string"><span class="hljs-string">"uniScaleTransform"</span></span>  canvas.   ,     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     <span class="hljs-string"><span class="hljs-string">"centeredScaling"</span></span>  <span class="hljs-string"><span class="hljs-string">"centeredRotation"</span></span> (  <span class="hljs-number"><span class="hljs-number">1.3</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span>    - <span class="hljs-string"><span class="hljs-string">"centerTransform"</span></span>).  ,       .    <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,  ,     <span class="hljs-number"><span class="hljs-number">1.0</span></span>,    /   .    <span class="hljs-number"><span class="hljs-number">1.0</span></span>.    . <br> <br>      <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>.        <span class="hljs-string"><span class="hljs-string">"left"</span></span>  <span class="hljs-string"><span class="hljs-string">"top"</span></span>.       .     ,     , <span class="hljs-string"><span class="hljs-string">" "</span></span>. <br> <br>         ? ,   -.     ,    , <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>     .     -,     originX  <span class="hljs-string"><span class="hljs-string">"center"</span></span>.       ‚Äì  originX  <span class="hljs-string"><span class="hljs-string">"right"</span></span>  ..     <span class="hljs-string"><span class="hljs-string">"position: absolute"</span></span>  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/"><span class="hljs-number"><span class="hljs-number">1</span></span>-  </a> ,          canvas.            <span class="hljs-string"><span class="hljs-string">"backgroundColor"</span></span>. <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.backgroundColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,0,255,0.3)'</span></span>; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setBackgroundImage(<span class="hljs-string"><span class="hljs-string">'../assets/pug.jpg'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setOverlayImage(<span class="hljs-string"><span class="hljs-string">'../assets/jail_cell_bars.png'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî <span class="hljs-number"><span class="hljs-number">2</span></span>D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric <span class="hljs-built_in"><span class="hljs-built_in">package</span></span></a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'canvas'</span></span>); // <span class="hljs-string"><span class="hljs-string">"function"</span></span> &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>); // <span class="hljs-string"><span class="hljs-string">"object"</span></span></code> <br>   ,     <span class="hljs-string"><span class="hljs-string">"hello world"</span></span> .  helloworld.js . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/helloworld.png'</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'Hello world'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">100</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, angle: <span class="hljs-number"><span class="hljs-number">15</span></span> }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   <span class="hljs-number"><span class="hljs-number">200</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>)</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     <span class="hljs-number"><span class="hljs-number">25</span></span> ! <br> <code class="javascript">var fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>), url = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'url'</span></span>), PORT = <span class="hljs-number"><span class="hljs-number">8124</span></span>; var server = http.createServer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request, response)</span></span></span></span> { var params = url.parse(request.url, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); response.writeHead(<span class="hljs-number"><span class="hljs-number">200</span></span>, { <span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'image/png'</span></span> }); canvas.loadFromJSON(params.query.data, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { response.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); }); stream.on(<span class="hljs-string"><span class="hljs-string">'end'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { response.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{<span class="hljs-string"><span class="hljs-string">"objects"</span></span>:[{<span class="hljs-string"><span class="hljs-string">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"rect"</span></span>,<span class="hljs-string"><span class="hljs-string">"left"</span></span>:<span class="hljs-number"><span class="hljs-number">103.85</span></span>,<span class="hljs-string"><span class="hljs-string">"top"</span></span>:<span class="hljs-number"><span class="hljs-number">98.85</span></span>,<span class="hljs-string"><span class="hljs-string">"width"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"height"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"fill"</span></span>:<span class="hljs-string"><span class="hljs-string">"#9ae759"</span></span>,<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"angle"</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span>,<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>:<span class="hljs-number"><span class="hljs-number">0.8</span></span>,<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"rx"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">"ry"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}],<span class="hljs-string"><span class="hljs-string">"background"</span></span>:<span class="hljs-string"><span class="hljs-string">"rgba(0, 0, 0, 0)"</span></span>}</code> <br> URI  : <br> <code class="javascript">%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"objects"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A%<span class="hljs-number"><span class="hljs-number">5</span></span>B%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"type"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rect"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"left"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A103<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"top"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A98<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"width"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"height"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"fill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"%239ae759"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"angle"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A30%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0<span class="hljs-number"><span class="hljs-number">.8</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"rx"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"ry"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">7</span></span>D%<span class="hljs-number"><span class="hljs-number">5</span></span>D%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"background"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rgba(0%2C%200%2C%200%2C%200)"</span></span>%<span class="hljs-number"><span class="hljs-number">7</span></span>D</code> <br>       <span class="hljs-string"><span class="hljs-string">"data"</span></span>.      <span class="hljs-string"><span class="hljs-string">"image/png"</span></span>   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-number"><span class="hljs-number">250</span></span>); var font = new canvas.Font(<span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, __dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Regular.ttf'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Bold.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Italic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'normal'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-BoldItalic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'regular'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">50</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">150</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">200</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); var out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/customfont.png'</span></span>); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/"><span class="hljs-number"><span class="hljs-number">2</span></span>-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> </pre> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <h2> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> </h2> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <pre> <code class="hljs lua"><code> ,       . Canvas -   <span class="hljs-number"><span class="hljs-number">2</span></span>D ,     .     -    . ,  Fabric   . <br> <br>     ,    <span class="hljs-literal"><span class="hljs-literal">true</span></span></code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> .       ,    <span class="hljs-string"><span class="hljs-string">"mouseup"</span></span>, Fabric   <span class="hljs-string"><span class="hljs-string">"path:created"</span></span>,         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . <span class="hljs-string"><span class="hljs-string">"lockMovementX"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockMovementY"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockRotation"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockScalingX"</span></span>  <span class="hljs-string"><span class="hljs-string">"lockScalingY"</span></span> ‚Äì      .    <code>object.lockMovementX</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   <span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>  <span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>.     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    <span class="hljs-string"><span class="hljs-string">""</span></span>. <br> <code class="javascript">object.hasBorders = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   <span class="hljs-string"><span class="hljs-string">"borderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"cornerColor"</span></span>,  <span class="hljs-string"><span class="hljs-string">"cornerSize"</span></span>. <br> <code class="javascript">object.set({ borderColor: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, cornerColor: <span class="hljs-string"><span class="hljs-string">'green'</span></span>, cornerSize: <span class="hljs-number"><span class="hljs-number">6</span></span> });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   <span class="hljs-string"><span class="hljs-string">"selection"</span></span>  canvas  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     ,    canvas.         ,       <span class="hljs-string"><span class="hljs-string">"selectable"</span></span>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .      . <br> <br>   <br>       ,     ?  . <br>  <span class="hljs-number"><span class="hljs-number">4</span></span>   canvas,     - <span class="hljs-string"><span class="hljs-string">"selectionColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionBorderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionLineWidth"</span></span>,  <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.selectionColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,255,0,0.3)'</span></span>; canvas.selectionBorderColor = <span class="hljs-string"><span class="hljs-string">'red'</span></span>; canvas.selectionLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span> ‚Äì   .       .    ,    .   ,      ,    -   <code>[<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>]</code>    <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.        <span class="hljs-number"><span class="hljs-number">10</span></span>px,     <span class="hljs-number"><span class="hljs-number">5</span></span>px,  ,   .     <code>[<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>]</code> ,     :      <span class="hljs-number"><span class="hljs-number">2</span></span>px,    <span class="hljs-number"><span class="hljs-number">4</span></span>px,    ,     <span class="hljs-number"><span class="hljs-number">6</span></span>px   .    ,      <code>[<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>   canvas,  Fabric    <span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>,       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: <span class="hljs-string"><span class="hljs-string">'#06538e'</span></span>, width: <span class="hljs-number"><span class="hljs-number">125</span></span>, height: <span class="hljs-number"><span class="hljs-number">125</span></span>, stroke: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, strokeDashArray: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     <span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>     <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <br>   <br> <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> Fabric   UI. ,   ,      .          . ,      - <span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>.          <span class="hljs-string"><span class="hljs-string">"rotatingPointOffset"</span></span>. <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> ,    ,    .    - <span class="hljs-string"><span class="hljs-string">"uniScaleTransform"</span></span>  canvas.   ,     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     <span class="hljs-string"><span class="hljs-string">"centeredScaling"</span></span>  <span class="hljs-string"><span class="hljs-string">"centeredRotation"</span></span> (  <span class="hljs-number"><span class="hljs-number">1.3</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span>    - <span class="hljs-string"><span class="hljs-string">"centerTransform"</span></span>).  ,       .    <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,  ,     <span class="hljs-number"><span class="hljs-number">1.0</span></span>,    /   .    <span class="hljs-number"><span class="hljs-number">1.0</span></span>.    . <br> <br>      <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>.        <span class="hljs-string"><span class="hljs-string">"left"</span></span>  <span class="hljs-string"><span class="hljs-string">"top"</span></span>.       .     ,     , <span class="hljs-string"><span class="hljs-string">" "</span></span>. <br> <br>         ? ,   -.     ,    , <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>     .     -,     originX  <span class="hljs-string"><span class="hljs-string">"center"</span></span>.       ‚Äì  originX  <span class="hljs-string"><span class="hljs-string">"right"</span></span>  ..     <span class="hljs-string"><span class="hljs-string">"position: absolute"</span></span>  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/"><span class="hljs-number"><span class="hljs-number">1</span></span>-  </a> ,          canvas.            <span class="hljs-string"><span class="hljs-string">"backgroundColor"</span></span>. <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.backgroundColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,0,255,0.3)'</span></span>; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setBackgroundImage(<span class="hljs-string"><span class="hljs-string">'../assets/pug.jpg'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setOverlayImage(<span class="hljs-string"><span class="hljs-string">'../assets/jail_cell_bars.png'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî <span class="hljs-number"><span class="hljs-number">2</span></span>D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric <span class="hljs-built_in"><span class="hljs-built_in">package</span></span></a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'canvas'</span></span>); // <span class="hljs-string"><span class="hljs-string">"function"</span></span> &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>); // <span class="hljs-string"><span class="hljs-string">"object"</span></span></code> <br>   ,     <span class="hljs-string"><span class="hljs-string">"hello world"</span></span> .  helloworld.js . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/helloworld.png'</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'Hello world'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">100</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, angle: <span class="hljs-number"><span class="hljs-number">15</span></span> }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   <span class="hljs-number"><span class="hljs-number">200</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>)</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     <span class="hljs-number"><span class="hljs-number">25</span></span> ! <br> <code class="javascript">var fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>), url = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'url'</span></span>), PORT = <span class="hljs-number"><span class="hljs-number">8124</span></span>; var server = http.createServer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request, response)</span></span></span></span> { var params = url.parse(request.url, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); response.writeHead(<span class="hljs-number"><span class="hljs-number">200</span></span>, { <span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'image/png'</span></span> }); canvas.loadFromJSON(params.query.data, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { response.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); }); stream.on(<span class="hljs-string"><span class="hljs-string">'end'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { response.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{<span class="hljs-string"><span class="hljs-string">"objects"</span></span>:[{<span class="hljs-string"><span class="hljs-string">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"rect"</span></span>,<span class="hljs-string"><span class="hljs-string">"left"</span></span>:<span class="hljs-number"><span class="hljs-number">103.85</span></span>,<span class="hljs-string"><span class="hljs-string">"top"</span></span>:<span class="hljs-number"><span class="hljs-number">98.85</span></span>,<span class="hljs-string"><span class="hljs-string">"width"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"height"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"fill"</span></span>:<span class="hljs-string"><span class="hljs-string">"#9ae759"</span></span>,<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"angle"</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span>,<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>:<span class="hljs-number"><span class="hljs-number">0.8</span></span>,<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"rx"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">"ry"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}],<span class="hljs-string"><span class="hljs-string">"background"</span></span>:<span class="hljs-string"><span class="hljs-string">"rgba(0, 0, 0, 0)"</span></span>}</code> <br> URI  : <br> <code class="javascript">%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"objects"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A%<span class="hljs-number"><span class="hljs-number">5</span></span>B%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"type"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rect"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"left"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A103<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"top"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A98<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"width"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"height"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"fill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"%239ae759"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"angle"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A30%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0<span class="hljs-number"><span class="hljs-number">.8</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"rx"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"ry"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">7</span></span>D%<span class="hljs-number"><span class="hljs-number">5</span></span>D%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"background"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rgba(0%2C%200%2C%200%2C%200)"</span></span>%<span class="hljs-number"><span class="hljs-number">7</span></span>D</code> <br>       <span class="hljs-string"><span class="hljs-string">"data"</span></span>.      <span class="hljs-string"><span class="hljs-string">"image/png"</span></span>   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-number"><span class="hljs-number">250</span></span>); var font = new canvas.Font(<span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, __dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Regular.ttf'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Bold.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Italic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'normal'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-BoldItalic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'regular'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">50</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">150</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">200</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); var out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/customfont.png'</span></span>); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/"><span class="hljs-number"><span class="hljs-number">2</span></span>-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> </pre> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <pre> <code class="hljs lua"><code> ,       . Canvas -   <span class="hljs-number"><span class="hljs-number">2</span></span>D ,     .     -    . ,  Fabric   . <br> <br>     ,    <span class="hljs-literal"><span class="hljs-literal">true</span></span></code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> .       ,    <span class="hljs-string"><span class="hljs-string">"mouseup"</span></span>, Fabric   <span class="hljs-string"><span class="hljs-string">"path:created"</span></span>,         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . <span class="hljs-string"><span class="hljs-string">"lockMovementX"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockMovementY"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockRotation"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockScalingX"</span></span>  <span class="hljs-string"><span class="hljs-string">"lockScalingY"</span></span> ‚Äì      .    <code>object.lockMovementX</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   <span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>  <span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>.     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    <span class="hljs-string"><span class="hljs-string">""</span></span>. <br> <code class="javascript">object.hasBorders = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   <span class="hljs-string"><span class="hljs-string">"borderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"cornerColor"</span></span>,  <span class="hljs-string"><span class="hljs-string">"cornerSize"</span></span>. <br> <code class="javascript">object.set({ borderColor: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, cornerColor: <span class="hljs-string"><span class="hljs-string">'green'</span></span>, cornerSize: <span class="hljs-number"><span class="hljs-number">6</span></span> });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   <span class="hljs-string"><span class="hljs-string">"selection"</span></span>  canvas  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     ,    canvas.         ,       <span class="hljs-string"><span class="hljs-string">"selectable"</span></span>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .      . <br> <br>   <br>       ,     ?  . <br>  <span class="hljs-number"><span class="hljs-number">4</span></span>   canvas,     - <span class="hljs-string"><span class="hljs-string">"selectionColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionBorderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionLineWidth"</span></span>,  <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.selectionColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,255,0,0.3)'</span></span>; canvas.selectionBorderColor = <span class="hljs-string"><span class="hljs-string">'red'</span></span>; canvas.selectionLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span> ‚Äì   .       .    ,    .   ,      ,    -   <code>[<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>]</code>    <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.        <span class="hljs-number"><span class="hljs-number">10</span></span>px,     <span class="hljs-number"><span class="hljs-number">5</span></span>px,  ,   .     <code>[<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>]</code> ,     :      <span class="hljs-number"><span class="hljs-number">2</span></span>px,    <span class="hljs-number"><span class="hljs-number">4</span></span>px,    ,     <span class="hljs-number"><span class="hljs-number">6</span></span>px   .    ,      <code>[<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>   canvas,  Fabric    <span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>,       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: <span class="hljs-string"><span class="hljs-string">'#06538e'</span></span>, width: <span class="hljs-number"><span class="hljs-number">125</span></span>, height: <span class="hljs-number"><span class="hljs-number">125</span></span>, stroke: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, strokeDashArray: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     <span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>     <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <br>   <br> <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> Fabric   UI. ,   ,      .          . ,      - <span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>.          <span class="hljs-string"><span class="hljs-string">"rotatingPointOffset"</span></span>. <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> ,    ,    .    - <span class="hljs-string"><span class="hljs-string">"uniScaleTransform"</span></span>  canvas.   ,     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     <span class="hljs-string"><span class="hljs-string">"centeredScaling"</span></span>  <span class="hljs-string"><span class="hljs-string">"centeredRotation"</span></span> (  <span class="hljs-number"><span class="hljs-number">1.3</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span>    - <span class="hljs-string"><span class="hljs-string">"centerTransform"</span></span>).  ,       .    <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,  ,     <span class="hljs-number"><span class="hljs-number">1.0</span></span>,    /   .    <span class="hljs-number"><span class="hljs-number">1.0</span></span>.    . <br> <br>      <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>.        <span class="hljs-string"><span class="hljs-string">"left"</span></span>  <span class="hljs-string"><span class="hljs-string">"top"</span></span>.       .     ,     , <span class="hljs-string"><span class="hljs-string">" "</span></span>. <br> <br>         ? ,   -.     ,    , <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>     .     -,     originX  <span class="hljs-string"><span class="hljs-string">"center"</span></span>.       ‚Äì  originX  <span class="hljs-string"><span class="hljs-string">"right"</span></span>  ..     <span class="hljs-string"><span class="hljs-string">"position: absolute"</span></span>  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/"><span class="hljs-number"><span class="hljs-number">1</span></span>-  </a> ,          canvas.            <span class="hljs-string"><span class="hljs-string">"backgroundColor"</span></span>. <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.backgroundColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,0,255,0.3)'</span></span>; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setBackgroundImage(<span class="hljs-string"><span class="hljs-string">'../assets/pug.jpg'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setOverlayImage(<span class="hljs-string"><span class="hljs-string">'../assets/jail_cell_bars.png'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî <span class="hljs-number"><span class="hljs-number">2</span></span>D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric <span class="hljs-built_in"><span class="hljs-built_in">package</span></span></a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'canvas'</span></span>); // <span class="hljs-string"><span class="hljs-string">"function"</span></span> &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>); // <span class="hljs-string"><span class="hljs-string">"object"</span></span></code> <br>   ,     <span class="hljs-string"><span class="hljs-string">"hello world"</span></span> .  helloworld.js . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/helloworld.png'</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'Hello world'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">100</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, angle: <span class="hljs-number"><span class="hljs-number">15</span></span> }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   <span class="hljs-number"><span class="hljs-number">200</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>)</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     <span class="hljs-number"><span class="hljs-number">25</span></span> ! <br> <code class="javascript">var fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>), url = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'url'</span></span>), PORT = <span class="hljs-number"><span class="hljs-number">8124</span></span>; var server = http.createServer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request, response)</span></span></span></span> { var params = url.parse(request.url, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); response.writeHead(<span class="hljs-number"><span class="hljs-number">200</span></span>, { <span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'image/png'</span></span> }); canvas.loadFromJSON(params.query.data, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { response.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); }); stream.on(<span class="hljs-string"><span class="hljs-string">'end'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { response.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{<span class="hljs-string"><span class="hljs-string">"objects"</span></span>:[{<span class="hljs-string"><span class="hljs-string">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"rect"</span></span>,<span class="hljs-string"><span class="hljs-string">"left"</span></span>:<span class="hljs-number"><span class="hljs-number">103.85</span></span>,<span class="hljs-string"><span class="hljs-string">"top"</span></span>:<span class="hljs-number"><span class="hljs-number">98.85</span></span>,<span class="hljs-string"><span class="hljs-string">"width"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"height"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"fill"</span></span>:<span class="hljs-string"><span class="hljs-string">"#9ae759"</span></span>,<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"angle"</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span>,<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>:<span class="hljs-number"><span class="hljs-number">0.8</span></span>,<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"rx"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">"ry"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}],<span class="hljs-string"><span class="hljs-string">"background"</span></span>:<span class="hljs-string"><span class="hljs-string">"rgba(0, 0, 0, 0)"</span></span>}</code> <br> URI  : <br> <code class="javascript">%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"objects"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A%<span class="hljs-number"><span class="hljs-number">5</span></span>B%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"type"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rect"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"left"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A103<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"top"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A98<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"width"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"height"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"fill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"%239ae759"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"angle"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A30%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0<span class="hljs-number"><span class="hljs-number">.8</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"rx"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"ry"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">7</span></span>D%<span class="hljs-number"><span class="hljs-number">5</span></span>D%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"background"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rgba(0%2C%200%2C%200%2C%200)"</span></span>%<span class="hljs-number"><span class="hljs-number">7</span></span>D</code> <br>       <span class="hljs-string"><span class="hljs-string">"data"</span></span>.      <span class="hljs-string"><span class="hljs-string">"image/png"</span></span>   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-number"><span class="hljs-number">250</span></span>); var font = new canvas.Font(<span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, __dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Regular.ttf'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Bold.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Italic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'normal'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-BoldItalic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'regular'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">50</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">150</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">200</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); var out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/customfont.png'</span></span>); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/"><span class="hljs-number"><span class="hljs-number">2</span></span>-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> </pre> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <h4> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> </h4> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <pre> <code class="hljs lua"><code> ,       . Canvas -   <span class="hljs-number"><span class="hljs-number">2</span></span>D ,     .     -    . ,  Fabric   . <br> <br>     ,    <span class="hljs-literal"><span class="hljs-literal">true</span></span></code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> .       ,    <span class="hljs-string"><span class="hljs-string">"mouseup"</span></span>, Fabric   <span class="hljs-string"><span class="hljs-string">"path:created"</span></span>,         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . <span class="hljs-string"><span class="hljs-string">"lockMovementX"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockMovementY"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockRotation"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockScalingX"</span></span>  <span class="hljs-string"><span class="hljs-string">"lockScalingY"</span></span> ‚Äì      .    <code>object.lockMovementX</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   <span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>  <span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>.     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    <span class="hljs-string"><span class="hljs-string">""</span></span>. <br> <code class="javascript">object.hasBorders = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   <span class="hljs-string"><span class="hljs-string">"borderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"cornerColor"</span></span>,  <span class="hljs-string"><span class="hljs-string">"cornerSize"</span></span>. <br> <code class="javascript">object.set({ borderColor: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, cornerColor: <span class="hljs-string"><span class="hljs-string">'green'</span></span>, cornerSize: <span class="hljs-number"><span class="hljs-number">6</span></span> });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   <span class="hljs-string"><span class="hljs-string">"selection"</span></span>  canvas  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     ,    canvas.         ,       <span class="hljs-string"><span class="hljs-string">"selectable"</span></span>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .      . <br> <br>   <br>       ,     ?  . <br>  <span class="hljs-number"><span class="hljs-number">4</span></span>   canvas,     - <span class="hljs-string"><span class="hljs-string">"selectionColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionBorderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionLineWidth"</span></span>,  <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.selectionColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,255,0,0.3)'</span></span>; canvas.selectionBorderColor = <span class="hljs-string"><span class="hljs-string">'red'</span></span>; canvas.selectionLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span> ‚Äì   .       .    ,    .   ,      ,    -   <code>[<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>]</code>    <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.        <span class="hljs-number"><span class="hljs-number">10</span></span>px,     <span class="hljs-number"><span class="hljs-number">5</span></span>px,  ,   .     <code>[<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>]</code> ,     :      <span class="hljs-number"><span class="hljs-number">2</span></span>px,    <span class="hljs-number"><span class="hljs-number">4</span></span>px,    ,     <span class="hljs-number"><span class="hljs-number">6</span></span>px   .    ,      <code>[<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>   canvas,  Fabric    <span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>,       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: <span class="hljs-string"><span class="hljs-string">'#06538e'</span></span>, width: <span class="hljs-number"><span class="hljs-number">125</span></span>, height: <span class="hljs-number"><span class="hljs-number">125</span></span>, stroke: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, strokeDashArray: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     <span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>     <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <br>   <br> <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> Fabric   UI. ,   ,      .          . ,      - <span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>.          <span class="hljs-string"><span class="hljs-string">"rotatingPointOffset"</span></span>. <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> ,    ,    .    - <span class="hljs-string"><span class="hljs-string">"uniScaleTransform"</span></span>  canvas.   ,     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     <span class="hljs-string"><span class="hljs-string">"centeredScaling"</span></span>  <span class="hljs-string"><span class="hljs-string">"centeredRotation"</span></span> (  <span class="hljs-number"><span class="hljs-number">1.3</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span>    - <span class="hljs-string"><span class="hljs-string">"centerTransform"</span></span>).  ,       .    <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,  ,     <span class="hljs-number"><span class="hljs-number">1.0</span></span>,    /   .    <span class="hljs-number"><span class="hljs-number">1.0</span></span>.    . <br> <br>      <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>.        <span class="hljs-string"><span class="hljs-string">"left"</span></span>  <span class="hljs-string"><span class="hljs-string">"top"</span></span>.       .     ,     , <span class="hljs-string"><span class="hljs-string">" "</span></span>. <br> <br>         ? ,   -.     ,    , <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>     .     -,     originX  <span class="hljs-string"><span class="hljs-string">"center"</span></span>.       ‚Äì  originX  <span class="hljs-string"><span class="hljs-string">"right"</span></span>  ..     <span class="hljs-string"><span class="hljs-string">"position: absolute"</span></span>  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/"><span class="hljs-number"><span class="hljs-number">1</span></span>-  </a> ,          canvas.            <span class="hljs-string"><span class="hljs-string">"backgroundColor"</span></span>. <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.backgroundColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,0,255,0.3)'</span></span>; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setBackgroundImage(<span class="hljs-string"><span class="hljs-string">'../assets/pug.jpg'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setOverlayImage(<span class="hljs-string"><span class="hljs-string">'../assets/jail_cell_bars.png'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî <span class="hljs-number"><span class="hljs-number">2</span></span>D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric <span class="hljs-built_in"><span class="hljs-built_in">package</span></span></a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'canvas'</span></span>); // <span class="hljs-string"><span class="hljs-string">"function"</span></span> &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>); // <span class="hljs-string"><span class="hljs-string">"object"</span></span></code> <br>   ,     <span class="hljs-string"><span class="hljs-string">"hello world"</span></span> .  helloworld.js . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/helloworld.png'</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'Hello world'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">100</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, angle: <span class="hljs-number"><span class="hljs-number">15</span></span> }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   <span class="hljs-number"><span class="hljs-number">200</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>)</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     <span class="hljs-number"><span class="hljs-number">25</span></span> ! <br> <code class="javascript">var fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>), url = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'url'</span></span>), PORT = <span class="hljs-number"><span class="hljs-number">8124</span></span>; var server = http.createServer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request, response)</span></span></span></span> { var params = url.parse(request.url, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); response.writeHead(<span class="hljs-number"><span class="hljs-number">200</span></span>, { <span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'image/png'</span></span> }); canvas.loadFromJSON(params.query.data, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { response.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); }); stream.on(<span class="hljs-string"><span class="hljs-string">'end'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { response.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{<span class="hljs-string"><span class="hljs-string">"objects"</span></span>:[{<span class="hljs-string"><span class="hljs-string">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"rect"</span></span>,<span class="hljs-string"><span class="hljs-string">"left"</span></span>:<span class="hljs-number"><span class="hljs-number">103.85</span></span>,<span class="hljs-string"><span class="hljs-string">"top"</span></span>:<span class="hljs-number"><span class="hljs-number">98.85</span></span>,<span class="hljs-string"><span class="hljs-string">"width"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"height"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"fill"</span></span>:<span class="hljs-string"><span class="hljs-string">"#9ae759"</span></span>,<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"angle"</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span>,<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>:<span class="hljs-number"><span class="hljs-number">0.8</span></span>,<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"rx"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">"ry"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}],<span class="hljs-string"><span class="hljs-string">"background"</span></span>:<span class="hljs-string"><span class="hljs-string">"rgba(0, 0, 0, 0)"</span></span>}</code> <br> URI  : <br> <code class="javascript">%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"objects"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A%<span class="hljs-number"><span class="hljs-number">5</span></span>B%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"type"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rect"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"left"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A103<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"top"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A98<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"width"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"height"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"fill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"%239ae759"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"angle"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A30%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0<span class="hljs-number"><span class="hljs-number">.8</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"rx"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"ry"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">7</span></span>D%<span class="hljs-number"><span class="hljs-number">5</span></span>D%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"background"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rgba(0%2C%200%2C%200%2C%200)"</span></span>%<span class="hljs-number"><span class="hljs-number">7</span></span>D</code> <br>       <span class="hljs-string"><span class="hljs-string">"data"</span></span>.      <span class="hljs-string"><span class="hljs-string">"image/png"</span></span>   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-number"><span class="hljs-number">250</span></span>); var font = new canvas.Font(<span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, __dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Regular.ttf'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Bold.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Italic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'normal'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-BoldItalic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'regular'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">50</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">150</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">200</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); var out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/customfont.png'</span></span>); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/"><span class="hljs-number"><span class="hljs-number">2</span></span>-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> </pre> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <pre> <code class="hljs lua"><code class="javascript"><code> ,       . Canvas -   <span class="hljs-number"><span class="hljs-number">2</span></span>D ,     .     -    . ,  Fabric   . <br> <br>     ,    <span class="hljs-literal"><span class="hljs-literal">true</span></span></code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> .       ,    <span class="hljs-string"><span class="hljs-string">"mouseup"</span></span>, Fabric   <span class="hljs-string"><span class="hljs-string">"path:created"</span></span>,         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . <span class="hljs-string"><span class="hljs-string">"lockMovementX"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockMovementY"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockRotation"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockScalingX"</span></span>  <span class="hljs-string"><span class="hljs-string">"lockScalingY"</span></span> ‚Äì      .    <code>object.lockMovementX</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   <span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>  <span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>.     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    <span class="hljs-string"><span class="hljs-string">""</span></span>. <br> <code class="javascript">object.hasBorders = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   <span class="hljs-string"><span class="hljs-string">"borderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"cornerColor"</span></span>,  <span class="hljs-string"><span class="hljs-string">"cornerSize"</span></span>. <br> <code class="javascript">object.set({ borderColor: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, cornerColor: <span class="hljs-string"><span class="hljs-string">'green'</span></span>, cornerSize: <span class="hljs-number"><span class="hljs-number">6</span></span> });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   <span class="hljs-string"><span class="hljs-string">"selection"</span></span>  canvas  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     ,    canvas.         ,       <span class="hljs-string"><span class="hljs-string">"selectable"</span></span>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .      . <br> <br>   <br>       ,     ?  . <br>  <span class="hljs-number"><span class="hljs-number">4</span></span>   canvas,     - <span class="hljs-string"><span class="hljs-string">"selectionColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionBorderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionLineWidth"</span></span>,  <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.selectionColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,255,0,0.3)'</span></span>; canvas.selectionBorderColor = <span class="hljs-string"><span class="hljs-string">'red'</span></span>; canvas.selectionLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span> ‚Äì   .       .    ,    .   ,      ,    -   <code>[<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>]</code>    <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.        <span class="hljs-number"><span class="hljs-number">10</span></span>px,     <span class="hljs-number"><span class="hljs-number">5</span></span>px,  ,   .     <code>[<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>]</code> ,     :      <span class="hljs-number"><span class="hljs-number">2</span></span>px,    <span class="hljs-number"><span class="hljs-number">4</span></span>px,    ,     <span class="hljs-number"><span class="hljs-number">6</span></span>px   .    ,      <code>[<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>   canvas,  Fabric    <span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>,       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: <span class="hljs-string"><span class="hljs-string">'#06538e'</span></span>, width: <span class="hljs-number"><span class="hljs-number">125</span></span>, height: <span class="hljs-number"><span class="hljs-number">125</span></span>, stroke: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, strokeDashArray: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     <span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>     <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <br>   <br> <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> Fabric   UI. ,   ,      .          . ,      - <span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>.          <span class="hljs-string"><span class="hljs-string">"rotatingPointOffset"</span></span>. <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> ,    ,    .    - <span class="hljs-string"><span class="hljs-string">"uniScaleTransform"</span></span>  canvas.   ,     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     <span class="hljs-string"><span class="hljs-string">"centeredScaling"</span></span>  <span class="hljs-string"><span class="hljs-string">"centeredRotation"</span></span> (  <span class="hljs-number"><span class="hljs-number">1.3</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span>    - <span class="hljs-string"><span class="hljs-string">"centerTransform"</span></span>).  ,       .    <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,  ,     <span class="hljs-number"><span class="hljs-number">1.0</span></span>,    /   .    <span class="hljs-number"><span class="hljs-number">1.0</span></span>.    . <br> <br>      <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>.        <span class="hljs-string"><span class="hljs-string">"left"</span></span>  <span class="hljs-string"><span class="hljs-string">"top"</span></span>.       .     ,     , <span class="hljs-string"><span class="hljs-string">" "</span></span>. <br> <br>         ? ,   -.     ,    , <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>     .     -,     originX  <span class="hljs-string"><span class="hljs-string">"center"</span></span>.       ‚Äì  originX  <span class="hljs-string"><span class="hljs-string">"right"</span></span>  ..     <span class="hljs-string"><span class="hljs-string">"position: absolute"</span></span>  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/"><span class="hljs-number"><span class="hljs-number">1</span></span>-  </a> ,          canvas.            <span class="hljs-string"><span class="hljs-string">"backgroundColor"</span></span>. <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.backgroundColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,0,255,0.3)'</span></span>; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setBackgroundImage(<span class="hljs-string"><span class="hljs-string">'../assets/pug.jpg'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setOverlayImage(<span class="hljs-string"><span class="hljs-string">'../assets/jail_cell_bars.png'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî <span class="hljs-number"><span class="hljs-number">2</span></span>D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric <span class="hljs-built_in"><span class="hljs-built_in">package</span></span></a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'canvas'</span></span>); // <span class="hljs-string"><span class="hljs-string">"function"</span></span> &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>); // <span class="hljs-string"><span class="hljs-string">"object"</span></span></code> <br>   ,     <span class="hljs-string"><span class="hljs-string">"hello world"</span></span> .  helloworld.js . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/helloworld.png'</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'Hello world'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">100</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, angle: <span class="hljs-number"><span class="hljs-number">15</span></span> }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   <span class="hljs-number"><span class="hljs-number">200</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>)</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     <span class="hljs-number"><span class="hljs-number">25</span></span> ! <br> <code class="javascript">var fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>), url = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'url'</span></span>), PORT = <span class="hljs-number"><span class="hljs-number">8124</span></span>; var server = http.createServer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request, response)</span></span></span></span> { var params = url.parse(request.url, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); response.writeHead(<span class="hljs-number"><span class="hljs-number">200</span></span>, { <span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'image/png'</span></span> }); canvas.loadFromJSON(params.query.data, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { response.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); }); stream.on(<span class="hljs-string"><span class="hljs-string">'end'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { response.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> {<span class="hljs-string"><span class="hljs-string">"objects"</span></span>:[{<span class="hljs-string"><span class="hljs-string">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"rect"</span></span>,<span class="hljs-string"><span class="hljs-string">"left"</span></span>:<span class="hljs-number"><span class="hljs-number">103.85</span></span>,<span class="hljs-string"><span class="hljs-string">"top"</span></span>:<span class="hljs-number"><span class="hljs-number">98.85</span></span>,<span class="hljs-string"><span class="hljs-string">"width"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"height"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"fill"</span></span>:<span class="hljs-string"><span class="hljs-string">"#9ae759"</span></span>,<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"angle"</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span>,<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>:<span class="hljs-number"><span class="hljs-number">0.8</span></span>,<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"rx"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">"ry"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}],<span class="hljs-string"><span class="hljs-string">"background"</span></span>:<span class="hljs-string"><span class="hljs-string">"rgba(0, 0, 0, 0)"</span></span>} <br> URI  : <br> <code class="javascript">%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"objects"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A%<span class="hljs-number"><span class="hljs-number">5</span></span>B%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"type"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rect"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"left"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A103<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"top"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A98<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"width"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"height"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"fill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"%239ae759"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"angle"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A30%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0<span class="hljs-number"><span class="hljs-number">.8</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"rx"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"ry"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">7</span></span>D%<span class="hljs-number"><span class="hljs-number">5</span></span>D%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"background"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rgba(0%2C%200%2C%200%2C%200)"</span></span>%<span class="hljs-number"><span class="hljs-number">7</span></span>D</code> <br>       <span class="hljs-string"><span class="hljs-string">"data"</span></span>.      <span class="hljs-string"><span class="hljs-string">"image/png"</span></span>   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-number"><span class="hljs-number">250</span></span>); var font = new canvas.Font(<span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, __dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Regular.ttf'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Bold.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Italic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'normal'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-BoldItalic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'regular'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">50</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">150</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">200</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); var out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/customfont.png'</span></span>); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/"><span class="hljs-number"><span class="hljs-number">2</span></span>-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code></code> </pre> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <pre> <code class="hljs lua"><code class="javascript"><code> ,       . Canvas -   <span class="hljs-number"><span class="hljs-number">2</span></span>D ,     .     -    . ,  Fabric   . <br> <br>     ,    <span class="hljs-literal"><span class="hljs-literal">true</span></span></code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> .       ,    <span class="hljs-string"><span class="hljs-string">"mouseup"</span></span>, Fabric   <span class="hljs-string"><span class="hljs-string">"path:created"</span></span>,         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . <span class="hljs-string"><span class="hljs-string">"lockMovementX"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockMovementY"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockRotation"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockScalingX"</span></span>  <span class="hljs-string"><span class="hljs-string">"lockScalingY"</span></span> ‚Äì      .    <code>object.lockMovementX</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   <span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>  <span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>.     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    <span class="hljs-string"><span class="hljs-string">""</span></span>. <br> <code class="javascript">object.hasBorders = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   <span class="hljs-string"><span class="hljs-string">"borderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"cornerColor"</span></span>,  <span class="hljs-string"><span class="hljs-string">"cornerSize"</span></span>. <br> <code class="javascript">object.set({ borderColor: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, cornerColor: <span class="hljs-string"><span class="hljs-string">'green'</span></span>, cornerSize: <span class="hljs-number"><span class="hljs-number">6</span></span> });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   <span class="hljs-string"><span class="hljs-string">"selection"</span></span>  canvas  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     ,    canvas.         ,       <span class="hljs-string"><span class="hljs-string">"selectable"</span></span>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .      . <br> <br>   <br>       ,     ?  . <br>  <span class="hljs-number"><span class="hljs-number">4</span></span>   canvas,     - <span class="hljs-string"><span class="hljs-string">"selectionColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionBorderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionLineWidth"</span></span>,  <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.selectionColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,255,0,0.3)'</span></span>; canvas.selectionBorderColor = <span class="hljs-string"><span class="hljs-string">'red'</span></span>; canvas.selectionLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span> ‚Äì   .       .    ,    .   ,      ,    -   <code>[<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>]</code>    <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.        <span class="hljs-number"><span class="hljs-number">10</span></span>px,     <span class="hljs-number"><span class="hljs-number">5</span></span>px,  ,   .     <code>[<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>]</code> ,     :      <span class="hljs-number"><span class="hljs-number">2</span></span>px,    <span class="hljs-number"><span class="hljs-number">4</span></span>px,    ,     <span class="hljs-number"><span class="hljs-number">6</span></span>px   .    ,      <code>[<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>   canvas,  Fabric    <span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>,       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: <span class="hljs-string"><span class="hljs-string">'#06538e'</span></span>, width: <span class="hljs-number"><span class="hljs-number">125</span></span>, height: <span class="hljs-number"><span class="hljs-number">125</span></span>, stroke: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, strokeDashArray: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     <span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>     <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <br>   <br> <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> Fabric   UI. ,   ,      .          . ,      - <span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>.          <span class="hljs-string"><span class="hljs-string">"rotatingPointOffset"</span></span>. <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> ,    ,    .    - <span class="hljs-string"><span class="hljs-string">"uniScaleTransform"</span></span>  canvas.   ,     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     <span class="hljs-string"><span class="hljs-string">"centeredScaling"</span></span>  <span class="hljs-string"><span class="hljs-string">"centeredRotation"</span></span> (  <span class="hljs-number"><span class="hljs-number">1.3</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span>    - <span class="hljs-string"><span class="hljs-string">"centerTransform"</span></span>).  ,       .    <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,  ,     <span class="hljs-number"><span class="hljs-number">1.0</span></span>,    /   .    <span class="hljs-number"><span class="hljs-number">1.0</span></span>.    . <br> <br>      <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>.        <span class="hljs-string"><span class="hljs-string">"left"</span></span>  <span class="hljs-string"><span class="hljs-string">"top"</span></span>.       .     ,     , <span class="hljs-string"><span class="hljs-string">" "</span></span>. <br> <br>         ? ,   -.     ,    , <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>     .     -,     originX  <span class="hljs-string"><span class="hljs-string">"center"</span></span>.       ‚Äì  originX  <span class="hljs-string"><span class="hljs-string">"right"</span></span>  ..     <span class="hljs-string"><span class="hljs-string">"position: absolute"</span></span>  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/"><span class="hljs-number"><span class="hljs-number">1</span></span>-  </a> ,          canvas.            <span class="hljs-string"><span class="hljs-string">"backgroundColor"</span></span>. <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.backgroundColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,0,255,0.3)'</span></span>; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setBackgroundImage(<span class="hljs-string"><span class="hljs-string">'../assets/pug.jpg'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setOverlayImage(<span class="hljs-string"><span class="hljs-string">'../assets/jail_cell_bars.png'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî <span class="hljs-number"><span class="hljs-number">2</span></span>D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric <span class="hljs-built_in"><span class="hljs-built_in">package</span></span></a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'canvas'</span></span>); // <span class="hljs-string"><span class="hljs-string">"function"</span></span> &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>); // <span class="hljs-string"><span class="hljs-string">"object"</span></span></code> <br>   ,     <span class="hljs-string"><span class="hljs-string">"hello world"</span></span> .  helloworld.js . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/helloworld.png'</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'Hello world'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">100</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, angle: <span class="hljs-number"><span class="hljs-number">15</span></span> }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   <span class="hljs-number"><span class="hljs-number">200</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>)</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     <span class="hljs-number"><span class="hljs-number">25</span></span> ! <br> <code class="javascript">var fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>), url = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'url'</span></span>), PORT = <span class="hljs-number"><span class="hljs-number">8124</span></span>; var server = http.createServer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request, response)</span></span></span></span> { var params = url.parse(request.url, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); response.writeHead(<span class="hljs-number"><span class="hljs-number">200</span></span>, { <span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'image/png'</span></span> }); canvas.loadFromJSON(params.query.data, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { response.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); }); stream.on(<span class="hljs-string"><span class="hljs-string">'end'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { response.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{<span class="hljs-string"><span class="hljs-string">"objects"</span></span>:[{<span class="hljs-string"><span class="hljs-string">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"rect"</span></span>,<span class="hljs-string"><span class="hljs-string">"left"</span></span>:<span class="hljs-number"><span class="hljs-number">103.85</span></span>,<span class="hljs-string"><span class="hljs-string">"top"</span></span>:<span class="hljs-number"><span class="hljs-number">98.85</span></span>,<span class="hljs-string"><span class="hljs-string">"width"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"height"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"fill"</span></span>:<span class="hljs-string"><span class="hljs-string">"#9ae759"</span></span>,<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"angle"</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span>,<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>:<span class="hljs-number"><span class="hljs-number">0.8</span></span>,<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"rx"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">"ry"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}],<span class="hljs-string"><span class="hljs-string">"background"</span></span>:<span class="hljs-string"><span class="hljs-string">"rgba(0, 0, 0, 0)"</span></span>}</code> <br> URI  : <br> %<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"objects"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A%<span class="hljs-number"><span class="hljs-number">5</span></span>B%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"type"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rect"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"left"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A103<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"top"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A98<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"width"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"height"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"fill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"%239ae759"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"angle"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A30%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0<span class="hljs-number"><span class="hljs-number">.8</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"rx"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"ry"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">7</span></span>D%<span class="hljs-number"><span class="hljs-number">5</span></span>D%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"background"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rgba(0%2C%200%2C%200%2C%200)"</span></span>%<span class="hljs-number"><span class="hljs-number">7</span></span>D <br>       <span class="hljs-string"><span class="hljs-string">"data"</span></span>.      <span class="hljs-string"><span class="hljs-string">"image/png"</span></span>   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-number"><span class="hljs-number">250</span></span>); var font = new canvas.Font(<span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, __dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Regular.ttf'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Bold.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Italic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'normal'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-BoldItalic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'regular'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">50</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">150</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">200</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); var out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/customfont.png'</span></span>); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/"><span class="hljs-number"><span class="hljs-number">2</span></span>-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code></code> </pre> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <h4> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> </h4> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> <pre> <code class="hljs lua"><code> ,       . Canvas -   <span class="hljs-number"><span class="hljs-number">2</span></span>D ,     .     -    . ,  Fabric   . <br> <br>     ,    <span class="hljs-literal"><span class="hljs-literal">true</span></span></code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> .       ,    <span class="hljs-string"><span class="hljs-string">"mouseup"</span></span>, Fabric   <span class="hljs-string"><span class="hljs-string">"path:created"</span></span>,         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . <span class="hljs-string"><span class="hljs-string">"lockMovementX"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockMovementY"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockRotation"</span></span>, <span class="hljs-string"><span class="hljs-string">"lockScalingX"</span></span>  <span class="hljs-string"><span class="hljs-string">"lockScalingY"</span></span> ‚Äì      .    <code>object.lockMovementX</code>  <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   <span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>  <span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>.     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> ,    <span class="hljs-string"><span class="hljs-string">""</span></span>. <br> <code class="javascript">object.hasBorders = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   <span class="hljs-string"><span class="hljs-string">"borderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"cornerColor"</span></span>,  <span class="hljs-string"><span class="hljs-string">"cornerSize"</span></span>. <br> <code class="javascript">object.set({ borderColor: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, cornerColor: <span class="hljs-string"><span class="hljs-string">'green'</span></span>, cornerSize: <span class="hljs-number"><span class="hljs-number">6</span></span> });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   <span class="hljs-string"><span class="hljs-string">"selection"</span></span>  canvas  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     ,    canvas.         ,       <span class="hljs-string"><span class="hljs-string">"selectable"</span></span>  <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .      . <br> <br>   <br>       ,     ?  . <br>  <span class="hljs-number"><span class="hljs-number">4</span></span>   canvas,     - <span class="hljs-string"><span class="hljs-string">"selectionColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionBorderColor"</span></span>, <span class="hljs-string"><span class="hljs-string">"selectionLineWidth"</span></span>,  <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.selectionColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,255,0,0.3)'</span></span>; canvas.selectionBorderColor = <span class="hljs-string"><span class="hljs-string">'red'</span></span>; canvas.selectionLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span> ‚Äì   .       .    ,    .   ,      ,    -   <code>[<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>]</code>    <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>.        <span class="hljs-number"><span class="hljs-number">10</span></span>px,     <span class="hljs-number"><span class="hljs-number">5</span></span>px,  ,   .     <code>[<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>]</code> ,     :      <span class="hljs-number"><span class="hljs-number">2</span></span>px,    <span class="hljs-number"><span class="hljs-number">4</span></span>px,    ,     <span class="hljs-number"><span class="hljs-number">6</span></span>px   .    ,      <code>[<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   <span class="hljs-string"><span class="hljs-string">"selectionDashArray"</span></span>   canvas,  Fabric    <span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>,       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: <span class="hljs-string"><span class="hljs-string">'#06538e'</span></span>, width: <span class="hljs-number"><span class="hljs-number">125</span></span>, height: <span class="hljs-number"><span class="hljs-number">125</span></span>, stroke: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, strokeDashArray: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     <span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>     <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> . <br> <br>   <br> <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> Fabric   UI. ,   ,      .          . ,      - <span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>.          <span class="hljs-string"><span class="hljs-string">"rotatingPointOffset"</span></span>. <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   <span class="hljs-number"><span class="hljs-number">1.0</span></span></b> ,    ,    .    - <span class="hljs-string"><span class="hljs-string">"uniScaleTransform"</span></span>  canvas.   ,     <code><span class="hljs-literal"><span class="hljs-literal">false</span></span></code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     <span class="hljs-string"><span class="hljs-string">"centeredScaling"</span></span>  <span class="hljs-string"><span class="hljs-string">"centeredRotation"</span></span> (  <span class="hljs-number"><span class="hljs-number">1.3</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span>    - <span class="hljs-string"><span class="hljs-string">"centerTransform"</span></span>).  ,       .    <code><span class="hljs-literal"><span class="hljs-literal">true</span></span></code> ,  ,     <span class="hljs-number"><span class="hljs-number">1.0</span></span>,    /   .    <span class="hljs-number"><span class="hljs-number">1.0</span></span>.    . <br> <br>      <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>.        <span class="hljs-string"><span class="hljs-string">"left"</span></span>  <span class="hljs-string"><span class="hljs-string">"top"</span></span>.       .     ,     , <span class="hljs-string"><span class="hljs-string">" "</span></span>. <br> <br>         ? ,   -.     ,    , <span class="hljs-string"><span class="hljs-string">"originX"</span></span>  <span class="hljs-string"><span class="hljs-string">"originY"</span></span>     .     -,     originX  <span class="hljs-string"><span class="hljs-string">"center"</span></span>.       ‚Äì  originX  <span class="hljs-string"><span class="hljs-string">"right"</span></span>  ..     <span class="hljs-string"><span class="hljs-string">"position: absolute"</span></span>  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/"><span class="hljs-number"><span class="hljs-number">1</span></span>-  </a> ,          canvas.            <span class="hljs-string"><span class="hljs-string">"backgroundColor"</span></span>. <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.backgroundColor = <span class="hljs-string"><span class="hljs-string">'rgba(0,0,255,0.3)'</span></span>; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setBackgroundImage(<span class="hljs-string"><span class="hljs-string">'../assets/pug.jpg'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: <span class="hljs-number"><span class="hljs-number">30</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, left: <span class="hljs-number"><span class="hljs-number">100</span></span> })); canvas.setOverlayImage(<span class="hljs-string"><span class="hljs-string">'../assets/jail_cell_bars.png'</span></span>, canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî <span class="hljs-number"><span class="hljs-number">2</span></span>D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric <span class="hljs-built_in"><span class="hljs-built_in">package</span></span></a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'canvas'</span></span>); // <span class="hljs-string"><span class="hljs-string">"function"</span></span> &gt; typeof <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>); // <span class="hljs-string"><span class="hljs-string">"object"</span></span></code> <br>   ,     <span class="hljs-string"><span class="hljs-string">"hello world"</span></span> .  helloworld.js . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/helloworld.png'</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'Hello world'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">100</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fill: <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>, angle: <span class="hljs-number"><span class="hljs-number">15</span></span> }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   <span class="hljs-number"><span class="hljs-number">200</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>)</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     <span class="hljs-number"><span class="hljs-number">25</span></span> ! <br> <code class="javascript">var fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>), url = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'url'</span></span>), PORT = <span class="hljs-number"><span class="hljs-number">8124</span></span>; var server = http.createServer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request, response)</span></span></span></span> { var params = url.parse(request.url, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); var canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); response.writeHead(<span class="hljs-number"><span class="hljs-number">200</span></span>, { <span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'image/png'</span></span> }); canvas.loadFromJSON(params.query.data, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { response.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); }); stream.on(<span class="hljs-string"><span class="hljs-string">'end'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { response.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{<span class="hljs-string"><span class="hljs-string">"objects"</span></span>:[{<span class="hljs-string"><span class="hljs-string">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"rect"</span></span>,<span class="hljs-string"><span class="hljs-string">"left"</span></span>:<span class="hljs-number"><span class="hljs-number">103.85</span></span>,<span class="hljs-string"><span class="hljs-string">"top"</span></span>:<span class="hljs-number"><span class="hljs-number">98.85</span></span>,<span class="hljs-string"><span class="hljs-string">"width"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"height"</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-string"><span class="hljs-string">"fill"</span></span>:<span class="hljs-string"><span class="hljs-string">"#9ae759"</span></span>,<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>:null,<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>:<span class="hljs-number"><span class="hljs-number">1.39</span></span>,<span class="hljs-string"><span class="hljs-string">"angle"</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span>,<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>:<span class="hljs-number"><span class="hljs-number">0.8</span></span>,<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"rx"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">"ry"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}],<span class="hljs-string"><span class="hljs-string">"background"</span></span>:<span class="hljs-string"><span class="hljs-string">"rgba(0, 0, 0, 0)"</span></span>}</code> <br> URI  : <br> <code class="javascript">%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"objects"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A%<span class="hljs-number"><span class="hljs-number">5</span></span>B%<span class="hljs-number"><span class="hljs-number">7</span></span>B<span class="hljs-string"><span class="hljs-string">"type"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rect"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"left"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A103<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"top"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A98<span class="hljs-number"><span class="hljs-number">.85</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"width"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"height"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A50%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"fill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"%239ae759"</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Anull%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A1<span class="hljs-number"><span class="hljs-number">.39</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"angle"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A30%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0<span class="hljs-number"><span class="hljs-number">.8</span></span>%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Atrue%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>Afalse%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"rx"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"ry"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A0%<span class="hljs-number"><span class="hljs-number">7</span></span>D%<span class="hljs-number"><span class="hljs-number">5</span></span>D%<span class="hljs-number"><span class="hljs-number">2</span></span>C<span class="hljs-string"><span class="hljs-string">"background"</span></span>%<span class="hljs-number"><span class="hljs-number">3</span></span>A<span class="hljs-string"><span class="hljs-string">"rgba(0%2C%200%2C%200%2C%200)"</span></span>%<span class="hljs-number"><span class="hljs-number">7</span></span>D</code> <br>       <span class="hljs-string"><span class="hljs-string">"data"</span></span>.      <span class="hljs-string"><span class="hljs-string">"image/png"</span></span>   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), fabric = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fabric'</span></span>).fabric, canvas = fabric.createCanvasForNode(<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-number"><span class="hljs-number">250</span></span>); var font = new canvas.Font(<span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, __dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Regular.ttf'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Bold.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-Italic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'normal'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); font.addFace(__dirname + <span class="hljs-string"><span class="hljs-string">'/fonts/Ubuntu-BoldItalic.ttf'</span></span>, <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, <span class="hljs-string"><span class="hljs-string">'italic'</span></span>); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'regular'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">50</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">100</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">150</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); text = new fabric.Text(<span class="hljs-string"><span class="hljs-string">'bold italic'</span></span>, { left: <span class="hljs-number"><span class="hljs-number">150</span></span>, top: <span class="hljs-number"><span class="hljs-number">200</span></span>, fontFamily: <span class="hljs-string"><span class="hljs-string">'Ubuntu'</span></span>, fontWeight: <span class="hljs-string"><span class="hljs-string">'bold'</span></span>, fontStyle: <span class="hljs-string"><span class="hljs-string">'italic'</span></span> }); canvas.add(text); var out = fs.createWriteStream(__dirname + <span class="hljs-string"><span class="hljs-string">'/customfont.png'</span></span>); var stream = canvas.createPNGStream(); stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(chunk)</span></span></span></span> { out.<span class="hljs-built_in"><span class="hljs-built_in">write</span></span>(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code><span class="hljs-built_in"><span class="hljs-built_in">path</span></span></code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/"><span class="hljs-number"><span class="hljs-number">2</span></span>-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> </pre> <code><code> ,       . Canvas -   2D ,     .     -    . ,  Fabric   . <br> <br>     ,    true</code>  <code>isDrawingMode</code>  Fabric canvas.          canvas     /. <br> <br>     canvas  ,    <code>isDrawingMode</code>  <code>true</code> .       ,    "mouseup", Fabric   "path:created",         <code>fabric.Path</code> . <br> <br>       ,   <code>isDrawingMode</code>  <code>false</code> ,       canvas.      <code>fabric.Path</code>      : , ,   .. <br> <br>   ,       : <code>freeDrawingBrush.color</code>  <code>freeDrawingBrush.width</code> .       <code>freeDrawingBrush</code> ,   Fabric canvas. <code>freeDrawingBrush.color</code>         . <code>freeDrawingBrush.width</code>     ,    . <br> <img src="https://habrastorage.org/getpro/habr/post_images/50f/50e/0c1/50f50e0c1fafe0d8f78fbfa68fdd8467.png" alt="image"> <br>           ,    .  ,       Fabric image. <br> <br>  <br>   Fabric,        .        canvas,    canvas,     ,   .       . <br> <br>   <br>    canvas    . "lockMovementX", "lockMovementY", "lockRotation", "lockScalingX"  "lockScalingY" ‚Äì      .    <code>object.lockMovementX</code>  <code>true</code> ,      .        .    <code>lockRotation</code>  ,  <code>lockScalingX/lockScalingY</code> ‚Äî .       ,         . <br> <br>  ,  <br>         ,   "hasControls"  "hasBorders".     <code>false</code> ,    "". <br> <code class="javascript">object.hasBorders = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/fb2/f69/46f/fb2f6946fd7717a7828b4674ba005fe2.png" alt="image"> <br> <code class="javascript">object.hasControls = false;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/3c0/9a1/641/3c09a16418bdd7a5d6f2d89ad7519c73.png" alt="image"> <br>        ,   "borderColor", "cornerColor",  "cornerSize". <br> <code class="javascript">object.set({ borderColor: 'red', cornerColor: 'green', cornerSize: 6 });</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/bf9/8bd/a32/bf98bda329d6b715e5fb1d3516b7b8b6.png" alt="image"> <br>   <br>     ,   "selection"  canvas  <code>false</code> .     ,    canvas.         ,       "selectable"  <code>false</code> .      . <br> <br>   <br>       ,     ?  . <br>  4   canvas,     - "selectionColor", "selectionBorderColor", "selectionLineWidth",  "selectionDashArray".  ,  ,     .    : <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.selectionColor = 'rgba(0,255,0,0.3)'; canvas.selectionBorderColor = 'red'; canvas.selectionLineWidth = 5;</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/6bf/fa5/5eb/6bffa55eb762c74545b729b4dc82e96e.png" alt="image"> <br>   - "selectionDashArray" ‚Äì   .       .    ,    .   ,      ,    -   <code>[10, 5]</code>    "selectionDashArray".        10px,     5px,  ,   .     <code>[2, 4, 6]</code> ,     :      2px,    4px,    ,     6px   .    ,      <code>[5, 10]</code> : <br> <img src="https://habrastorage.org/getpro/habr/post_images/574/a6e/b88/574a6eb88e442a6cbd846f910c0dc045.png" alt="image"> <br>   <br>   "selectionDashArray"   canvas,  Fabric    "strokeDashArray",       . <br> <code class="javascript">var rect = new fabric.Rect({ fill: '#06538e', width: 125, height: 125, stroke: 'red', strokeDashArray: [5, 5] }); canvas.add(rect);</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9a3/2c8/fca/9a32c8fcaeaca4b7f54064c91bdf76fd.png" alt="image"> <br>   <br>    ,  Fabric    ,    ,    ,     / .   ,    ,      ,    .    : <br> <img src="https://habrastorage.org/files/208/95f/1cc/20895f1cce4d41498813ec19375e9daa.png"> <br> <br>     Fabric   canvas      . ,     ,  :    ,     "perPixelTargetFind"     <code>true</code> . <br> <br>   <br> <b>   1.0</b> Fabric   UI. ,   ,      .          . ,      - "hasRotatingPoint".          "rotatingPointOffset". <br> <img src="https://habrastorage.org/getpro/habr/post_images/7a9/d57/d24/7a9d57d244c4f0f03348eb165b334c68.png" alt="image"> <br>   <br> , <b>   1.0</b> ,    ,    .    - "uniScaleTransform"  canvas.   ,     <code>false</code> .     .  ,    ,   . <br> <img src="https://habrastorage.org/getpro/habr/post_images/a86/c0b/27c/a86c0b27c94b135745bdb92e22bddc0c.png" alt="image"> <br>     "centeredScaling"  "centeredRotation" (  1.3.4    - "centerTransform").  ,       .    <code>true</code> ,  ,     1.0,    /   .    1.0.    . <br> <br>      "originX"  "originY".        "left"  "top".       .     ,     , " ". <br> <br>         ? ,   -.     ,    , "originX"  "originY"     .     -,     originX  "center".       ‚Äì  originX  "right"  ..     "position: absolute"  CSS. <br> <br>      canvas <br>  , ,   <a href="http://habrahabr.ru/post/162367/">1-  </a> ,          canvas.            "backgroundColor". <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.backgroundColor = 'rgba(0,0,255,0.3)'; canvas.renderAll();</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/4ac/73c/e38/4ac73ce38109378aa465dc3d475d0e49.png" alt="image"> <br> <br>    ,     .      <code>setBackgroundImage</code> ,  url      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setBackgroundImage('../assets/pug.jpg', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/63d/eaa/f1a/63deaaf1a85fd63ac0e57a697cf8e59b.png" alt="image"> <br> <br> ,        .         canvas.   <code>setOverlayImage</code> ,    : url,      . <br> <code class="javascript">canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 })); canvas.setOverlayImage('../assets/jail_cell_bars.png', canvas.renderAll.bind(canvas));</code> <br> <img src="https://habrastorage.org/getpro/habr/post_images/27c/619/d85/27c619d85f94f92a9051cd46e4bc1488.png" alt="image"> <br> <br> Fabric  Node.js <br>     Fabric ‚Äì  ,           ,    !    ,                .      Fabric API     ,       . <br> <br>  ,     Node,      Fabric. <br>  ,    <a href="http://nodejs.org/">Node.js</a> ,       .     ,    ,   .    <a href="http://howtonode.org/how-to-install-nodejs"></a>  <a href="https://github.com/joyent/node/wiki/Installation"> </a> . <br> <br>    Node.js,     <a href="https://github.com/LearnBoost/node-canvas">node-canvas</a> .   ‚Äì  canvas  NodeJS.    <a href="http://cairographics.org/">Cairo</a> ‚Äî 2D  ,   Mac, Linux,  Windows. node-canvas   <a href="https://github.com/LearnBoost/node-canvas/wiki">  </a> ,     . <br> <br> Fabric   Node     (NPM).    ‚Äì  NPM.      <a href="https://github.com/isaacs/npm"> github</a> . <br> <br>   ‚Äì   <a href="https://npmjs.org/package/fabric">Fabric package</a> ,  NPM.   ,  <code>npm install fabric</code> ( <code>npm install -g fabric</code>   ).   ,  ,      node-canvas  Fabric: <br> <code class="javascript">&gt; node ... &gt; typeof require('canvas'); // "function" &gt; typeof require('fabric'); // "object"</code> <br>   ,     "hello world" .  helloworld.js . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, out = fs.createWriteStream(__dirname + '/helloworld.png'); var canvas = fabric.createCanvasForNode(200, 200); var text = new fabric.Text('Hello world', { left: 100, top: 100, fill: '#f55', angle: 15 }); canvas.add(text); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>      <code>node helloworld.js</code> .   helloworld.png  : <br> <img src="https://habrastorage.org/getpro/habr/post_images/58c/84e/6b3/58c84e6b30b220b784dcdbb667ed02ea.png" alt="image"> <br>   ?     . <br> <br>    Fabric ( <code>fabric = require('fabric').fabric</code> ) .    - Fabric canvas,  <code>fabric.createCanvasForNode</code> ,   <code>new fabric.Canvas()</code> .         ,   canvas    (   200200). <br> <br>        ( <code>new fabric.Text()</code> )    canvas ( <code>canvas.add(text)</code> ). <br> <br>    Fabric canvas,     -. ,        canvas?     <code>createPNGStream</code>   canvas.       Node <a href="http://nodejs.org/api/stream.html">stream </a> ,         .     <code>on('data')</code> ,  ( <code>fs.createWriteStream()</code> ),       . <br> <br> <code>fabric.createCanvasForNode</code>  <code>fabric.Canvas#createPNGStream</code> ‚Äì       Node.    -:      ,  ,   ..  ,     canvas    <code>createCanvasForNode</code> , canvas   <code>nodeCanvas</code> ,      node-canvas . <br> <br> Node   Fabric <br>   ,   Node ,         Fabric  JSON ,      .     25 ! <br> <code class="javascript">var fabric = require('fabric').fabric, http = require('http'), url = require('url'), PORT = 8124; var server = http.createServer(function (request, response) { var params = url.parse(request.url, true); var canvas = fabric.createCanvasForNode(200, 200); response.writeHead(200, { 'Content-Type': 'image/png' }); canvas.loadFromJSON(params.query.data, function() { canvas.renderAll(); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { response.write(chunk); }); stream.on('end', function() { response.end(); }); }); }); server.listen(PORT);</code> <br>          .      .   Fabric canvas,    JSON ,         . <br> <br>   ,        . <br> <code class="javascript">{"objects":[{"type":"rect","left":103.85,"top":98.85,"width":50,"height":50,"fill":"#9ae759","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1.39,"scaleY":1.39,"angle":30,"flipX":false,"flipY":false,"opacity":0.8,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}</code> <br> URI  : <br> <code class="javascript">%7B"objects"%3A%5B%7B"type"%3A"rect"%2C"left"%3A103.85%2C"top"%3A98.85%2C"width"%3A50%2C"height"%3A50%2C"fill"%3A"%239ae759"%2C"overlayFill"%3Anull%2C"stroke"%3Anull%2C"strokeWidth"%3A1%2C"strokeDashArray"%3Anull%2C"scaleX"%3A1.39%2C"scaleY"%3A1.39%2C"angle"%3A30%2C"flipX"%3Afalse%2C"flipY"%3Afalse%2C"opacity"%3A0.8%2C"selectable"%3Atrue%2C"hasControls"%3Atrue%2C"hasBorders"%3Atrue%2C"hasRotatingPoint"%3Afalse%2C"transparentCorners"%3Atrue%2C"perPixelTargetFind"%3Afalse%2C"rx"%3A0%2C"ry"%3A0%7D%5D%2C"background"%3A"rgba(0%2C%200%2C%200%2C%200)"%7D</code> <br>       "data".      "image/png"   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/c88/0b4/8f0/c880b48f04a503a88383a991ee67ef2e.png" alt="image"> <br> <br>   ,   Fabric    .     .  ,   canvas,     ,          . <br> <br>   Fabric  Node <br>       Fabric,    .        ( ) ‚Äì   <a href="http://www.w3.org/TR/css3-fonts/">CSS3 @font-face rule</a> .  Fabric  Node ( )    node-canvas <b>Font API</b> ,         . <br> <br>   ,     .     customfont.js , ,      .        <a href="https://www.google.com/fonts/specimen/Ubuntu">Ubuntu</a> . <br> <code class="javascript">var fs = require('fs'), fabric = require('fabric').fabric, canvas = fabric.createCanvasForNode(300, 250); var font = new canvas.Font('Ubuntu', __dirname + '/fonts/Ubuntu-Regular.ttf'); font.addFace(__dirname + '/fonts/Ubuntu-Bold.ttf', 'bold'); font.addFace(__dirname + '/fonts/Ubuntu-Italic.ttf', 'normal', 'italic'); font.addFace(__dirname + '/fonts/Ubuntu-BoldItalic.ttf', 'bold', 'italic'); canvas.contextContainer.addFont(font); //  createPNGStream  createJPEGStream //canvas.contextTop.addFont(font); //  toDataURL  toDataURLWithMultiplier var text = new fabric.Text('regular', { left: 150, top: 50, fontFamily: 'Ubuntu' }); canvas.add(text); text = new fabric.Text('bold', { left: 150, top: 100, fontFamily: 'Ubuntu', fontWeight: 'bold' }); canvas.add(text); text = new fabric.Text('italic', { left: 150, top: 150, fontFamily: 'Ubuntu', fontStyle: 'italic' }); canvas.add(text); text = new fabric.Text('bold italic', { left: 150, top: 200, fontFamily: 'Ubuntu', fontWeight: 'bold', fontStyle: 'italic' }); canvas.add(text); var out = fs.createWriteStream(__dirname + '/customfont.png'); var stream = canvas.createPNGStream(); stream.on('data', function(chunk) { out.write(chunk); });</code> <br>  ,  <code>node customfont.js</code> ,   (customfont.png)   : <br> <img src="https://habrastorage.org/getpro/habr/post_images/54d/3ed/1be/54d3ed1be1d502c22d19011a20da163c.png" alt="image"> <br> <br>      . -    ,  <code>new canvas.Font()</code> ,   ( <code>name</code> )   ( <code>path</code> )       .    font-faces,   <code>font.addFace()</code> .      ( <code>path</code> ),  ( <code>weight</code> )   ( <code>style</code> ). ,     .   ,  <code>canvas.contextContainer.addFont()</code> ( <b>createPNGStream</b>  <b>createJPEGStream</b> ) ,  <code>canvas.contextTop.addFont()</code> ( <b>toDataURL</b>  <b>toDataURLWithMultiplier</b> ). <br> <br>      ,   <b>fontFamily</b>  <code>fabric.Text</code>   .     <b>fontWeight</b>  <b>fontStyle</b>    font faces,   .      <a href="http://habrahabr.ru/post/167119/">2-  </a> . <br> <br>  ,   ,   ,   -,     -,   JSON. <br> <br>         Fabric.  ,    ,   - , , , , ! <br> <br> <a href="http://fabricjs.com/fabric-intro-part-4/"><i> </i> . <br></a></code> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/257401/">https://habr.com/ru/post/257401/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../257383/index.html">Navigation Drawer + Fragments: Finish the Google Guide</a></li>
<li><a href="../257387/index.html">Reverse Engineering TL431, an extremely common chip, which you have not heard</a></li>
<li><a href="../257389/index.html">How we did the cloud automation system of the restaurant business</a></li>
<li><a href="../257393/index.html">Offline data handling in a mobile application using Couchbase Lite</a></li>
<li><a href="../257397/index.html">Layout of responsive emails: a detailed guide (part 2)</a></li>
<li><a href="../257403/index.html">The first 6 lectures of the online school Android developers</a></li>
<li><a href="../257405/index.html">Recognizing users' physical activity with examples on R</a></li>
<li><a href="../257407/index.html">We issue a digital certificate and verify the signature using BouncyCastle</a></li>
<li><a href="../257409/index.html">Discrete Fourier Transform of the Fractal Brownian Motion</a></li>
<li><a href="../257413/index.html">Trojan-Downloader.Win32.Cabby.cemx - Part One - Unpacking</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>