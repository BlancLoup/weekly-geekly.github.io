<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Nature Tips - Cloudy Night Light</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, community! 

 I present my own implementation of the lamp-night lamp in the form of a cloud. The main idea is to make a nightlight with imitati...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Nature Tips - Cloudy Night Light</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/mr/66/st/mr66stql1kimlmtxmkt2ycjyfue.jpeg" alt="image" width="75%"></div><br><br>  Hello, community! <br><br>  I present my own implementation of the lamp-night lamp in the form of a cloud.  The main idea is to make a nightlight with imitations of natural processes and some kind of interactivity.  Nature is the best inspirer! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The basis was taken by cheap ATmega8-16PU microcontroller.  The code is written in C without Arduino and implements several light effects with control from the general illumination of space and with sound control. <br><br>  Details and photos - more ... <br><a name="habracut"></a><br><h3>  Electronic details </h3><br>  The circuit, besides the microcontroller, has 6 monochrome LEDs, one RGB LED, an illumination sensor (photoresistor) and a microphone with an amplifier and RF filter. <br><br>  For a smooth change in the brightness of the LEDs, <abbr title="Pulse width modulation">PWM is</abbr> used.  The PWM frequency is 244 Hz at 64 levels, it happens that some people see it.  Increasing the frequency does not work - you need more CPU time to work.  Therefore, a circuit on a transistor follower with a smoothing capacitor is applied to smoothing the PWM pulses.  The transistor is taken with a large gain, to increase the input resistance and reduce the required capacity.  As a result, 1 microfarad turned out to be quite enough, the pulses are almost completely smoothed.  The advantages are cheaper than a DAC and have a large output current.  The disadvantage of the scheme is the nonlinear dependence of brightness on the PWM level at low levels (up to 15%). <br><br><div class="spoiler">  <b class="spoiler_title">Micro-Cap 9 circuit</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/9h/jx/m-/9hjxm-paag2rkjz7osorqlr_8ke.png" alt="image"><br>  <i>Smoothing scheme PWM.</i>  <i>4 diodes approximately = 1 white LED on IV</i> <br><br><img src="https://habrastorage.org/webt/af/6f/g4/af6fg4lbpq8fxaenzaepivxw-ps.png" alt="image"><br>  <i>Graph of current and voltage on the LED at 56% PWM.</i> <br></div></div><br>  A miniature electret microphone through an amplifier on two transistors with a pulse (RF filter) is connected to the discrete input of the MK, confidently catching sharp sounds - clapping hands. <br><br>  He drew the board and spread it in <a href="https://diptrace.com/rus/download/download-diptrace/">DipTrace</a> , made it LUT, the details are mostly smd.  Etching did in the "ferric chloride killer": Hydrogen peroxide + salt + citric acid, it came out the first time, I recommend.  <a href="https://www.radiokot.ru/lab/hardwork/62/">All amateur ways are written here.</a> <br><br><img src="https://habrastorage.org/webt/6g/m-/05/6gm-05vizzaj1ew1l63b-b6kh5o.jpeg" alt="image"><br>  <i>Fee made by LUT</i> <br><br>  Power made via USB-connector that allows you to connect to any USB-port.  The maximum consumption is 78 mA. <br><br>  In previous versions, there was a micro-button on the cable for mode settings, but then it was removed, so as not to reach it, if the cloud is under the ceiling. <br><br>  There is no USB connection, there is no USB in the MC, and it does not seem to be necessary in the finished product.  For debugging, I used a UART controller, the code implements an exchange with a computer, but it is trite there <s>on my lap</s> . <br><br><img src="https://habrastorage.org/webt/7u/fy/h5/7ufyh5cpydbcvzj50ojtwibyeik.jpeg" width="75%"><br>  <i>During the soldering process</i> <br><br>  LUT, soldering, writing the program, tests and rework, fitting timers and coefficients took 3 weeks. <br><br><img src="https://habrastorage.org/webt/zk/t8/g9/zkt8g9wjyn7ujuyihfg32mn-bc0.jpeg" alt="image"><br>  <i>General form</i> <br><br>  As a result, implemented 3 modes of illumination and light effects.  I tried to make the lava lamp more interesting, but there was also no disco-music music with whistles. <br><br><h3>  Modes: </h3><br>  <b>The main one</b> is a nightlight in the form of a cloud.  Different parts of the cloud in a random order smoothly change the brightness, the change period is also random (4 ... 25 seconds), the type of change - exponential smoothing from the task (I can tell more in the comments).  It looks as a whole, with a share of imagination, like a play of light in a real cloud when it covers the sun.  The maximum level of brightness depends on the level of lighting according to the schedule.  I picked up various dependencies, there was an option with a choice of dependencies on the button, but I stopped on one this. <br><br><img src="https://habrastorage.org/webt/hw/hp/xo/hwhpxotfo5gyf9njb_64kkvdtps.png" alt="image"><br>  <i>Graph of the brightness of the cloud from the ambient light.</i> <br><br>  Since during the outer darkness (night) the cloud almost does not glow, and a short-term bright light may be needed (for example, to rise at night), then for this purpose I invented the ‚ÄúBright Cloud‚Äù submode.  It turns on when you clap your hands together, a microphone is used here, since the buttons are usually out of reach.  The cloud glows at full brightness for a minute, also with overflow, then gradually returns to the main cloud mode according to the illumination. <br><br><img src="https://habrastorage.org/webt/cg/ha/dx/cghadxfnhu9zgmk0x-u3rx9xsp8.gif" alt="image"><br>  <i>Cloud mode, the first sample.</i>  <i>Video accelerated 5 times</i> <br><br>  <b>Thunderstorm</b> - turns on when there is a sharp decrease in external lighting (but not until complete darkness, so as not to hit the eyes in the dark) or three claps.  Random LEDs flash (from one to 4x), with a random pause between flashes.  A little zamorochilsya and made "runs" of lightning in the cloud, when the LEDs flash in a time chain.  It also looks quite like a thunderstorm.  Because of the thunderstorm mode, we had to compromise PWM filtering so that the flashes would be sharp (77 ms).  The duration of the "thunderstorm" depends on the external lighting - the darker, the longer, from 4 to 12 flashes. <br><br>  <b>Dawn</b> - turns on with a sharp increase in ambient light.  The most difficult to set up mode, to get "the natural change of colors of the sun at dawn in a light haze" was not easy.  To balance the RGB LED had to manually almost every level of PWM, and selecting dependencies.  But in the end, I got a more or less interpolation formula.  Dawn lasts 40 seconds, then the transition to normal mode. <br><br><img src="https://habrastorage.org/webt/c_/fl/6b/c_fl6baslbfbbxsagw5bpnou39c.jpeg" alt="image" width="75%"><br>  <i>Dawn</i> <br><br>  Electronics and software for those interested in: <br><br>  <a href="https://yadi.sk/d/WhYIV-gHOH3nxQ">Source archive</a> <br><br>  <a href="https://yadi.sk/i/FGHr4OTnHGlW2w">Scheme in pdf</a> <br><br>  <a href="https://yadi.sk/i/YOm16W1BdmAXsQ">PCB layout, one side</a> <br><br><h3>  Constructive </h3><br>  The construction of the cloud is quite simple; I made it from sintepukh (one cushion 40x40 cm), the board is placed inside on hangers of threads.  The LEDs are arranged as uniformly as possible in the volume, and, well, the RGB-LED is at the bottom, and the photo sensor is at the top. <br><br><img src="https://habrastorage.org/webt/n8/yf/qm/n8yfqmg3dbmhm9oqpelqvnt4xxa.jpeg" width="75%"><br>  <i>In the process of plastering down</i> <br><br>  There were difficulties in fixing sintepukha, as it is covered with silicone to counteract caking.  The lower part of the cloud is supported by narrow strips of adhesive tape on a wire frame. <br><br>  Questions, comments, suggestions, write in the comments. <br><br>  Great weather for everyone! <br><br><img src="https://habrastorage.org/webt/k2/jp/ia/k2jpiamrczanxcsod6-l-rh-nmi.jpeg"></div><p>Source: <a href="https://habr.com/ru/post/428988/">https://habr.com/ru/post/428988/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../428976/index.html">An anthill or a fortress? Building a house for the price of an apartment. Part 2: Heating</a></li>
<li><a href="../428980/index.html">Offline JavaScript Broker</a></li>
<li><a href="../428982/index.html">How to write on D under ARM</a></li>
<li><a href="../428984/index.html">Julia and phase portraits of dynamic systems</a></li>
<li><a href="../428986/index.html">Conference ThinkJava # 8 in Kharkov</a></li>
<li><a href="../428990/index.html">Configuration examples for UIViewControllers using RouteComposer</a></li>
<li><a href="../428992/index.html">Selective bypass blocking on routers with Padavan and Keenetic OS firmware</a></li>
<li><a href="../428994/index.html">Networking on Android using Corutin and Retrofit</a></li>
<li><a href="../428996/index.html">Club of anonymous Santa Clauses 2018-2019 in Habrahabr</a></li>
<li><a href="../428998/index.html">How to use the new experimental Profiler feature in React</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>