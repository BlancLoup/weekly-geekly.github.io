<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Features of the External Type 1 and External Type 2 routes in OSPF. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This topic is a continuation of the topic published here . 

 The topic concerns the redistribution of routes into OSPF from other routing protocols, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Features of the External Type 1 and External Type 2 routes in OSPF. Part 2</h1><div class="post__text post__text-html js-mediator-article"> This topic is a continuation of the topic published <a href="http://habrahabr.ru/blogs/cisconetworks/117099/">here</a> . <br><br>  The topic concerns the redistribution of routes into OSPF from other routing protocols, and considers the features of using E1 and E2 types of routes.  In this part, the conversation will go about how the router chooses routes, if both of them are identical in type, but differ in the redistribution metric, and in the price of the route to the ASBR. <br>  I will remind the topology <br><br><img src="https://habrastorage.org/storage/a5de9619/cf7fe706/747f92d9/fdd17743.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br>  We now configure redistribution so that E2 routes come to R1 but with different metric values: <br><br> <code>R4(config)#router ospf 1 <br> R4(config-router)#redistribute eigrp 100 metric 100 subnets metric-type 2 <br> <br> R5(config)#router ospf 1 <br> R5(config-router)#redistribute eigrp 100 subnets metric-type 2</code> <br> <br>  Check the routing table on R1: <br><br> <code>R1#sh ip rout 6.6.6.6 <br> <br> Routing entry for 6.6.6.6/32 <br> Known via "ospf 1", distance 110, metric 20, type extern 2, forward metric 2 <br> Last update from 10.0.2.2 on FastEthernet1/0, 00:09:08 ago <br> Routing Descriptor Blocks: <br> * 10.0.2.2, from 5.5.5.5, 00:09:08 ago, via FastEthernet1/0 <br> Route metric is 20, traffic share count is 1</code> <br> <br>  As one would expect, R1 chose a route through R5, since the metric of the route through it is 20 + forward metric 2, while the metric through R4 is 100 + forward metric 2. If we set type E1 for both routes, the situation will not change. <br><br>  Up to this point, everything was less obvious.  Consider now what features appear if we change the link price for OSPF, inside Area 0. <br>  Set the ospf cost for the path through R2 to 100: <br><br> <code>R1#conf t <br> Enter configuration commands, one per line. End with CNTL/Z. <br> R1(config)#interface FastEthernet0/0 <br> R1(config-if)#ip ospf cost 100</code> <br> <br>  Now we configure routers so that both ASBRs send E1 routes, but with different metrics, so that the total metrics are the same: <br><br> <code>R4(config-router)#router ospf 1 <br> R4(config-router)#redistribute eigrp 100 metric-type 1 metric 99 subnets <br> <br> R5(config)#router ospf 1 <br> R5(config-router)#redistribute eigrp 100 metric-type 1 metric 198 subnets</code> <br> <br>  And check what appears in the routing table R1: <br><br> <code>R1#sh ip rout 6.6.6.6 <br> <br> Routing entry for 6.6.6.6/32 <br> Known via "ospf 1", distance 110, metric 200, type extern 1 <br> Last update from 10.0.2.2 on FastEthernet1/0, 00:02:46 ago <br> Routing Descriptor Blocks: <br> 10.0.2.2, from 5.5.5.5, 00:02:46 ago, via FastEthernet1/0 <br> Route metric is 200, traffic share count is 1 <br> * 10.0.1.2, from 4.4.4.4, 00:02:46 ago, via FastEthernet0/0 <br> Route metric is 200, traffic share count is 1</code> <br> <br>  As you can see, both routes come with metric 200. For the first path, this is the sum of the link price to R2 + the link price R2-R4 + redistribution metric on R4 (100 + 1 + 99 = 200).  For the second way, respectively, the price of the link to R3 + is the price of the link R3-R5 + redistribution metric to R5 1 + 1 + 198 = 200. Accordingly, both routes fall into the routing table. <br>  Change the type of routes from E1 to E2: <br><br> <code>R4(config)#router ospf 1 <br> R4(config-router)#redistribute eigrp 100 metric-type 2 metric 99 subnets <br> <br> R5(config)#router ospf 1 <br> R5(config-router)#redistribute eigrp 100 metric-type 2 metric 198 subnets</code> <br> <br>  And again, check what appears in the routing table R1: <br><br> <code>R1#sh ip rout 6.6.6.6 <br> <br> Routing entry for 6.6.6.6/32 <br> Known via "ospf 1", distance 110, metric 99, type extern 2, forward metric 101 <br> Last update from 10.0.1.2 on FastEthernet0/0, 00:03:01 ago <br> Routing Descriptor Blocks: <br> * 10.0.1.2, from 4.4.4.4, 00:03:01 ago, via FastEthernet0/0 <br> Route metric is 99, traffic share count is 1</code> <br> <br>  Despite the fact that the total metric is the same for both routes, the router used only the metric that is set when setting up redistribution, ignoring the forward metric. <br>  Set the same cost of redistribution and see what happens: <br><br> <code>R4(config)#router ospf 1 <br> R4(config-router)#redistribute eigrp 100 metric-type 2 metric 1 subnets <br> <br> R5(config)#router ospf 1 <br> R5(config-router)#redistribute eigrp 100 metric-type 2 metric 1 subnets <br> <br> R1#sh ip route 6.6.6.6 <br> <br> Routing entry for 6.6.6.6/32 <br> Known via "ospf 1", distance 110, metric 1, type extern 2, forward metric 2 <br> Last update from 10.0.2.2 on FastEthernet1/0, 00:00:57 ago <br> Routing Descriptor Blocks: <br> * 10.0.2.2, from 5.5.5.5, 00:00:57 ago, via FastEthernet1/0 <br> Route metric is 1, traffic share count is 1</code> <br> <br>  Surprise.  Based on the logic of the previous example, the router should have added both routes to the routing table, since the redistribution metric is the same and equal to 1, and as we have seen, the forward metric is ignored. <br>  In fact, the process of choosing a route is somewhat more complicated. <br>  First, R1 looks at the metric of the routes that came to it.  Since both routes have a redistribution metric of 1, the router needs to determine which ASBR is closer to it by checking the availability of R4 and R5 via the Intra-Area routes. <br>  For this, he looks at the address of the Advertising Router, who sent him an LSA regarding the prefix 6.6.6.6/32: <br><br> <code>R1#sh ip ospf database external 6.6.6.6 <br> <br> OSPF Router with ID (1.1.1.1) (Process ID 1) <br> Type-5 AS External Link States <br> <br> LS age: 353 <br> Options: (No TOS-capability, DC) <br> LS Type: AS External Link <br> Link State ID: 6.6.6.6 (External Network Number ) <br> Advertising Router: 4.4.4.4 <br> LS Seq Number: 8000000B <br> Checksum: 0x87F9 <br> Length: 36 <br> Network Mask: /32 <br> Metric Type: 2 (Larger than any link state path) <br> TOS: 0 <br> Metric: 1 <br> Forward Address: 0.0.0.0 <br> External Route Tag: 0 <br> <br> Routing Bit Set on this LSA <br> LS age: 325 <br> Options: (No TOS-capability, DC) <br> LS Type: AS External Link <br> Link State ID: 6.6.6.6 (External Network Number ) <br> Advertising Router: 5.5.5.5 <br> LS Seq Number: 8000000A <br> Checksum: 0x6B13 <br> Length: 36 <br> Network Mask: /32 <br> Metric Type: 2 (Larger than any link state path) <br> TOS: 0 <br> Metric: 1 <br> Forward Address: 0.0.0.0 <br> External Route Tag: 0</code> <br> <br>  The router sees two Advertising Routers, 4.4.4.4 and 5.5.5.5 and then checks if there are Router LSAs from these routers (the presence of these LSAs indicates that the router is accessible via Intra-Area routes). <br><br> <code>R1#sh ip ospf database router 4.4.4.4 <br> OSPF Router with ID (1.1.1.1) (Process ID 1) <br> <br> R1#sh ip ospf database router 5.5.5.5 <br> OSPF Router with ID (1.1.1.1) (Process ID 1)</code> <br> <br>  The conclusion shows that there are no Intra-Area routes.  Next, the router checks the Inter-Area routes: <br><br> <code>R1#sh ip ospf database asbr-summary 5.5.5.5 <br> OSPF Router with ID (1.1.1.1) (Process ID 1) <br> <br> Summary ASB Link States (Area 0) <br> Routing Bit Set on this LSA <br> LS age: 379 <br> Options: (No TOS-capability, DC, Upward) <br> LS Type: Summary Links(AS Boundary Router) <br> Link State ID: 5.5.5.5 (AS Boundary Router address) <br> Advertising Router: 3.3.3.3 <br> LS Seq Number: 80000009 <br> Checksum: 0x34DE <br> Length: 28 <br> Network Mask: /0 <br> TOS: 0 Metric: 1 <br> <br> R1#sh ip ospf database asbr-summary 4.4.4.4 <br> OSPF Router with ID (1.1.1.1) (Process ID 1) <br> <br> Summary ASB Link States (Area 0) <br> Routing Bit Set on this LSA <br> LS age: 203 <br> Options: (No TOS-capability, DC, Upward) <br> LS Type: Summary Links(AS Boundary Router) <br> Link State ID: 4.4.4.4 (AS Boundary Router address) <br> Advertising Router: 2.2.2.2 <br> LS Seq Number: 80000009 <br> Checksum: 0x809A <br> Length: 28 <br> Network Mask: /0 <br> TOS: 0 Metric: 1</code> <br> <br>  Based on the conclusion, it is clear that ASBRs are available as Inter-Area through 2 different ABRs, and both paths have metric 1. Accordingly, the router needs to determine which of the ABRs is closer to it next. <br>  For this, R1 again makes a check on the Router LSA, and sees that both ABRs as DR have their interfaces 10.0.1.2 and 10.0.2.2, respectively.  Since R1 itself has the same addresses as the DR, it can add costs for these DRs to the metric for ABR: <br><br> <code>R1#sh ip ospf database router 1.1.1.1 <br> OSPF Router with ID (1.1.1.1) (Process ID 1) <br> <br> Router Link States (Area 0) <br> LS age: 1028 <br> Options: (No TOS-capability, DC) <br> LS Type: Router Links <br> Link State ID: 1.1.1.1 <br> Advertising Router: 1.1.1.1 <br> LS Seq Number: 8000000E <br> Checksum: 0xBABB <br> Length: 48 <br> Number of Links: 2 <br> Link connected to: a Transit Network <br> (Link ID) Designated Router address: 10.0.2.2 <br> (Link Data) Router Interface address: 10.0.2.1 <br> Number of TOS metrics: 0 <br> TOS 0 Metrics: 1 <br> <br> Link connected to: a Transit Network <br> (Link ID) Designated Router address: 10.0.1.2 <br> (Link Data) Router Interface address: 10.0.1.1 <br> Number of TOS metrics: 0 <br> TOS 0 Metrics: 100</code> <br> <br>  Accordingly, the cost of the link to 6.6.6.6, through R4 will be equal to the composite metric R1-&gt; R2-&gt; R4-&gt; R6, which is equal to 102, and through R5, the composite metric R1-&gt; R3-&gt; R5-&gt; R6 equal to 3 will be used. In the end, R1 is preferred to the shorter route to the ASBR, and will choose the route R1-&gt; R3-&gt; R5 having a cost of 2. <br>  Thus, it can be concluded that with the same external E2 metric, the router does not set both E2 routes to the routing table, but does one more test for the ASBR metric (this metric on R1 is called forward metric). <br><br><h5>  Let's sum up: </h5><br><br>  1. If there are E1 and E2 routes to the same prefix, the router selects the E1 route, regardless of the metric. <br><br>  2. If there are two routes, both of which are E1, the choice is based on the metric.  If the metrics are the same, then both routes are established. <br><br>  3. If there are two routes, both of which are E2, the router first makes a selection based on the redistribution metric.  If this metric is the same, it makes a choice based on the metric to ASBR (forward metric), if these metrics are also the same, then both routes are set in the routing table. </div><p>Source: <a href="https://habr.com/ru/post/117110/">https://habr.com/ru/post/117110/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../117100/index.html">Illustration of the psychology of modern gadget lovers</a></li>
<li><a href="../117101/index.html">Backdoor on Ubuntu for Amazon EC2, check it out!</a></li>
<li><a href="../117102/index.html">Club Innovators now in Nizhny Novgorod</a></li>
<li><a href="../117103/index.html">Canobuvosti, 86th edition</a></li>
<li><a href="../117109/index.html">Cross-browser inline-block</a></li>
<li><a href="../117111/index.html">Ubuntu 11.04 goes back to classic GNOME by default instead of Unity?</a></li>
<li><a href="../117112/index.html">Registration for WebCamp 2011 is open.</a></li>
<li><a href="../117116/index.html">Using BitTorrent in Java: jBitTorrent API</a></li>
<li><a href="../117117/index.html">Dingoo A320 for $ 49.50</a></li>
<li><a href="../117118/index.html">QR coded Dubai</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>