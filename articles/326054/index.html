<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Azure microservice application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This publication focuses on two microservice applications that are created and deployed in Microsoft Azure Service Fabric and in Azure Container Servi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Azure microservice application</h1><div class="post__text post__text-html js-mediator-article">  This publication focuses on two microservice applications that are created and deployed in Microsoft Azure Service Fabric and in Azure Container Service.  Although the focus is on microservice-based applications running in Azure Service Fabric and Azure Container Service, it should be noted that Azure is an open platform that allows you to run microservice-based applications using various technologies, such as CloudFoundry, RedHat Openshift or Kubernetes . <br><br><img src="https://habrastorage.org/files/e17/9f8/83d/e179f883d7d848cdb70922e359dea87d.jpg"><br><a name="habracut"></a><br><h2>  Azure Service Fabric </h2><br>  Let's start with the <a href="https://azure.microsoft.com/en-us/documentation/services/service-fabric/">Azure Service Fabric</a> microservice platform.  It provides an opportunity to develop and pack reliable scalable microservices in and out of containers, as well as to manage them.  The Service Fabric platform has over 300 users, including companies such as BMW and Schneider Electric. <br><br>  Service Fabric clusters can be prepared for use in virtually any environment, such as <a href="https://azure.microsoft.com/ru-ru/free/%3Fwt.mc_id%3DAID570629_QSG_BLOG_139069">Azure</a> , a local environment, a private cloud, or a solution from other cloud service providers.  The publicly available version of Service Fabric runs under Windows, but there is also a version for Linux available for private preview.  Follow the link to learn more about <a href="https://azure.microsoft.com/en-us/documentation/articles/service-fabric-deploy-anywhere/">deploying a Service Fabric based on Windows Server or Linux</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In addition to the <a href="https://azure.microsoft.com/en-us/documentation/articles/service-fabric-architecture/">main features of the platform</a> , which include rapid deployment, deployment of services, high reliability, high density, health reports, coordinated updates and service endpoint detection for any type of application (Node.js, Java, etc.) in Service Fabric programming models are supported for creating microservices with and without state tracking.  Programming models are currently available for .NET on Windows and for Java on Linux. <br><br>  By contrast, stateful Service Fabric microservices maintain state locally in computing instances.  Due to this, delays in reading and writing are reduced, and the overall architecture is simplified as the components to be moved become smaller.  One of the primary goals of Service Fabric is to maintain data reliability and consistency.  Replication is used for this. <br><br><h2>  Example of using microservices </h2><br>  The TalkTalk streaming and encoding solution was originally created using the Lift and Shift methodology as part of the <a href="https://azure.microsoft.com/ru-ru/free/%3Fwt.mc_id%3DAID570629_QSG_BLOG_139069">Azure</a> infrastructure as a service offering, as it was the easiest way to transfer the entire application to the cloud.  However, in the context of continuous and rapid business growth and the emergence of new requirements, TalkTalk developers began to implement a microservice based approach in some parts of their application, using Azure Service Fabric as a platform. <br><br><img src="https://habrastorage.org/files/e95/5b4/78c/e955b478cd144b45b9e690beee6a7d64.png" align="left" width="500">  Due to this, they were able to simplify the deployment of services, to obtain more flexible scalability of each service, as well as eliminate downtime when updating individual services.  A microservice based application also integrates well with Azure Media Services and Azure Batch. <br><br>  The figure shows the general architecture of a microservice application and the course of processing a coding request in such an application. <br><br>  Below is a description of the role of each microservice in processing a request: <br><br>  <b>Step 1</b> .  The TalkTalk client invokes the <code>EncodeRequest</code> method available to the Activity Web API via the Azure management API. <br><br>  <b>Step 2.</b> The stateless Activity Web API is an Open Web Interface for .NET (OWIN) listener.  It contains the API controller, which provides the ability to create new encoding requests.  Services outside of the Service Fabric use this API for external communication.  He receives calls from the API Management Service. <br><br>  <b>Step 3. The</b> stateful Activity Microservice uses the Secure Queue API in the Service Fabric for inbound operation.  Then this microservice creates an action subject representing the coding work that needs to be performed. <br><br>  <b>Step 4.</b> Microservice ActivityActor presents a list of work items to track the progress of each step and to create the actors of each step.  The created subjects monitor the state, so even in case of failures, the data is not lost due to their replication. <br><br>  <b>Step 5.</b> Microservice ActivityStepActor coordinates the work stages.  Work is being done in other Service Fabric applications.  For example, an application for managing encryption jobs uses Azure Batch to perform the custom encryption step required for TalkTalk set-top boxes.  The application itself for managing encryption jobs contains many microservices and encapsulates the necessary interactions with Azure Batch.  The action step subject communicates with the appropriate services using the service proxy provided by the Service Fabric platform. <br><br>  A stateless ActivityStep microservice provides access to the Service Communication Listener, so other Service Fabric services, such as the Azure Media Services (AMS) job management application (step 6) and the encryption job management application (step 7), can interact with the activity steps. .  This way of working is similar to callbacks: for example, when the Batch service is shutting down, you need to contact ActivityStepActor to complete or update the work phase. <br><br>  During this process, a reminder about each subject is used to periodically save the state of the subject in DocumentDB.  This is done for two purposes: first, to provide the ability to perform arbitrary requests, and second, to organize the protection and backup of data outside the Service Fabric platform. <br><br>  A detailed description of the TalkTalk application based on microservices is available <a href="https://blogs.msdn.microsoft.com/azureservicefabric/2016/03/15/service-fabric-customer-profile-talktalk-tv/">here</a> . <br><br><h2>  Azure Container Service </h2><br>  <a href="https://azure.microsoft.com/en-us/documentation/services/container-service/">Azure Container Service</a> (ACS) is another Azure service that allows you to deploy and run microservice-based applications.  ACS users include Avanade, ESRi, and CloudBees. <br><br>  ACS core functionality allows you to create a cluster for managing container loads, using <a href="https://dcos.io/">DC / OS</a> or <a href="https://docs.docker.com/swarm/">SWARM</a> as an orchestrator.  From the point of view of microservices, you are responsible for choosing the means of detecting and registering services, exchanging information, monitoring, and the like.  This is also the main difference from the Service Fabric, whose capabilities go beyond the cluster and the orchestrator and include integrated services, including service registration and discovery, as well as programming models. <br><br><h4>  Benefits of ACS </h4><br>  Let's start with the obvious: using open source software technology (OSS).  Considering that ACS uses Docker Swarm and Mesosphere DC / OS, then you have all the resources of the OSS community available for these two technologies.  Since these technologies have been available on the market for a long time, you can easily find step-by-step tutorials, training materials, code snippets, and even turnkey solutions for virtually any scenario. <br><br>  Another advantage is the ease of setting up and managing the cluster using Azure.  Those of you who have had to set up a DC / OS or Docker Swarm cluster on bare metal or virtual machines are well aware that this requires much more than just connecting several machines to each other.  You also need to configure various additional components and services, provide access to the endpoints, associate agents with the load balancing subsystem, etc. To automate the configuration of such a cluster, you will have to write a fairly lengthy script.  ACS simplifies cluster setup by applying templates and abstracting all configuration steps. <br><br>  However, setting up a cluster of machines with an orchestrator is only half the battle.  After setting up and running the cluster, you may need to install patches on the machines in the cluster or upgrade them to a later version of SWARM and DC / OS.  Such tasks usually require careful planning.  In the future, ACS will support a fully managed infrastructure so that developers can focus only on workloads in a cluster, without wasting time on tasks related to infrastructure management. <br><br>  You can set up a cluster to work either in the Azure portal or automatically using the Azure Resource Manager template as part of the infrastructure as a service approach.  You will need to provide only the following values: <br><br><ul><li>  orchestratorProfile ‚Äî the orchestrator to be used (DCOS or Swarm); </li><li>  masterProfile - the number of main nodes and the DNS prefix; </li><li>  agentPoolProfiles - the number of agent nodes, the size of the nodes and the DNS prefix; </li><li>  linuxProfile is the username and SSH key to connect to the nodes. </li></ul><br>  The following snippet shows the Azure Resource Manager template for ACS JSON code. <br><br><pre> <code class="javascript hljs">‚Äúresources‚Äù: [ { ‚ÄúapiVersion‚Äù: ‚Äú<span class="hljs-number"><span class="hljs-number">2016</span></span>‚Äì<span class="hljs-number"><span class="hljs-number">03</span></span>‚Äì<span class="hljs-number"><span class="hljs-number">30</span></span>‚Äù, ‚Äútype‚Äù: ‚ÄúMicrosoft.ContainerService/containerServices‚Äù, ‚Äúlocation‚Äù: ‚Äú[resourceGroup().location]‚Äù, ‚Äúname‚Äù:‚Äù[concat(<span class="hljs-string"><span class="hljs-string">'containerservice-'</span></span>,resourceGroup().name)]‚Äù, ‚Äúproperties‚Äù: { ‚ÄúorchestratorProfile‚Äù: { ‚ÄúorchestratorType‚Äù: ‚Äú[variables(<span class="hljs-string"><span class="hljs-string">'orchestratorType'</span></span>)]‚Äù }, ‚ÄúmasterProfile‚Äù: { ‚Äúcount‚Äù: ‚Äú[variables(<span class="hljs-string"><span class="hljs-string">'masterCount'</span></span>)]‚Äù, ‚ÄúdnsPrefix‚Äù: ‚Äú[variables(<span class="hljs-string"><span class="hljs-string">'mastersEndpointDNSNamePrefix'</span></span>)]‚Äù }, ‚ÄúagentPoolProfiles‚Äù: [ { ‚Äúname‚Äù: ‚Äúagentpools‚Äù, ‚Äúcount‚Äù: ‚Äú[variables(<span class="hljs-string"><span class="hljs-string">'agentCount'</span></span>)]‚Äù, ‚ÄúvmSize‚Äù: ‚Äú[variables(<span class="hljs-string"><span class="hljs-string">'agentVMSize'</span></span>)]‚Äù, ‚ÄúdnsPrefix‚Äù: ‚Äú[variables(<span class="hljs-string"><span class="hljs-string">'agentsEndpointDNSNamePrefix'</span></span>)]‚Äù } ], ‚ÄúlinuxProfile‚Äù: { ‚ÄúadminUsername‚Äù: ‚Äú[variables(<span class="hljs-string"><span class="hljs-string">'adminUsername'</span></span>)]‚Äù, ‚Äússh‚Äù: { ‚ÄúpublicKeys‚Äù: [ { ‚ÄúkeyData‚Äù: ‚Äú[variables(<span class="hljs-string"><span class="hljs-string">'sshRSAPublicKey'</span></span>)]‚Äù } ] } } } }</code> </pre> <br>  As a result, you get a fully configured DC / OS cluster or Docker Swarm, in which you can deploy applications.  The figure shows the output of a fully configured DC / OS-based ACS cluster. <br><br><img src="https://habrastorage.org/files/d4d/53a/252/d4d53a2525bb4617ab310b91792ef64f.png" align="left" width="500">  In addition to deployment, ACS integrates with scalable virtual machine sets (VMSS) that will support simple automatic scaling and patch installation for the entire orchestra and the entire infrastructure.  As stated above, in ACS, you can deploy and run absolutely any microservice based application.  Due to this, when deploying with ACS, very high flexibility is achieved.  To run microservice-based applications, you can use any DC / OS or Docker Swarm solutions that you would use in other environments. <br><br>  Consider an example of a microservice based application where DC / OS is used as an orchestrator in Azure Container Service.  Flak.io is an example of an e-commerce application created specifically to demonstrate the capabilities of microservices.  This app: <br><br><ul><li>  uses different technologies </li><li>  Complies with different scale and availability requirements for each service. </li><li>  stores data separately for each service, </li><li>  uses the registration and discovery capabilities of DC / OS services. </li></ul><br>  From the user's point of view, this application allows you to browse products in the catalog and buy them. <br><br>  The application consists of four basic services and interface services: <br><br><ul><li>  <b>The interface is</b> implemented as an AngularJS SPA, provides a landing page for Flakio. </li><li>  <b>The catalog service</b> is responsible for managing product information. </li><li>  <b>The order service</b> is responsible for processing orders.  It should be noted that the product model used in the order service is different from the product model in the catalog service because it belongs to a different context. </li><li>  <b>The recommendation service</b> prepares recommendations by analyzing historical information and real-time data. </li><li>  <b>The notification service</b> is responsible for sending e-mail notifications, as well as for storing and managing e-mail templates. </li></ul><br><br><img src="https://habrastorage.org/files/8a5/d41/711/8a5d41711b784ad7ae863540b9375907.png" align="left" width="500">  The figure shows the overall architecture of Flak.io. <br><br>  The source code for Flak.io is available on <a href="https://github.com/flakio">GitHub</a> . <br><br>  <b>Note.</b>  Flak.io project is not finished yet.  Work continues on the storage of records of events, the creation of recommendations and notification services, but in general this application will provide a fairly complete picture of the design and deployment of the container application based on microservices in ACS. <br><br><h2>  Results </h2><br>  In this publication, we looked at two examples of microservice architectures: for the Service Fabric and for the Azure Container Service.  In general, Service Fabric can be seen as a turnkey solution for building microservice-based applications, in which the Azure Container service can quickly set up a cluster and manage the infrastructure using DC / OS or SWARM so that developers can fully concentrate on writing code.  After preparing the ACS cluster, you can use any convenient technologies for applications based on microservices, as well as the possibilities of the ever-growing Docker and Mesoshpere communities. <br><br><h3>  Useful activities </h3><br>  If you have few articles and would like to communicate remotely or personally with me or colleagues on the creation of microservice and other solutions in Azure, come to us for the following events. <br><br><ol><li>  <b>Record webinar on April 11th</b> .  <a href="https://info.microsoft.com/CE-Azure-WBNR-FY17-03Mar-28-Theuseofcontainersandmikroservisov307264_02OnDemandRegistration.html">New approaches in the cloud architecture: containers and microservices</a> (registration required) </li><li>  <b>April 19, Moscow, mitap</b> .  <a href="https://www.meetup.com/Moscow-Cloud-Computing-Meetup/events/238822625/">Microservices in Azure</a> (registration is required through meetup.com) </li><li>  <b>April 21-23, Moscow, DevCon School</b> .  <a href="https://events.techdays.ru/Modern-Architecture/2017-04/apply">Modern architecture</a> (registration required) </li></ol><br>  <b>If you‚Äôve read this far and want at <a href="https://events.techdays.ru/Modern-Architecture/2017-04/apply">DevCon School: Modern architecture</a> , but you don‚Äôt have a promo code, write me a message explaining why you want to get there.</b>  <b>As usual, I have a few promotional codes for Habra readers</b> . <br><br><h4>  useful links </h4><br><ol><li>  <a href="https://azure.microsoft.com/en-us/documentation/learning-paths/service-fabric/">Getting started with Service Fabric</a> </li><li>  <a href="http://tryazureservicefabric.westus.cloudapp.azure.com/">Service Fabric for free using Party Clusters clusters</a> </li><li>  <a href="https://azure.microsoft.com/en-us/services/container-service/">Azure Container Service</a> </li><li>  <a href="https://mva.microsoft.com/en-US/training-courses/building-distributed-applications-and-microservices-based-apps-on-azure-container-service-16521">Deploying and Running Microservice Based Applications in ACS</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/326054/">https://habr.com/ru/post/326054/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../326044/index.html">Tools for the remote development team</a></li>
<li><a href="../326046/index.html">Everything new is well forgotten old</a></li>
<li><a href="../326048/index.html">Games for HTC Vive that can already be played</a></li>
<li><a href="../326050/index.html">Simplify working with CloudKit, or synchronization in the spirit of Zen</a></li>
<li><a href="../326052/index.html">The book "Swift. Basics of developing applications for iOS and macOS. 3rd ed. supplemented and revised "</a></li>
<li><a href="../326056/index.html">The dark side of using CSS polyfills</a></li>
<li><a href="../326058/index.html">Not only cash desk: how the IT infrastructure of modern stores is arranged</a></li>
<li><a href="../326060/index.html">How to make Telegram and Telephony even faster</a></li>
<li><a href="../326062/index.html">Improving the reliability of Kubernetes: how to quickly notice that the node fell</a></li>
<li><a href="../326064/index.html">Courses Computer Science Club, spring 2017</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>