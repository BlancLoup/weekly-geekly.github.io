<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What is SMT and how it works in applications - pros and cons</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="While I am delighting my graphomaniac biases by writing a detailed technical article about Windows Performance Station, I wanted to share my thoughts ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What is SMT and how it works in applications - pros and cons</h1><div class="post__text post__text-html js-mediator-article">  While I am delighting my graphomaniac biases by writing a detailed technical article about Windows Performance Station, I wanted to share my thoughts about what SMT brings to AMD and Intel processors good and bad, and how Windows Performance Station will help here. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/878/4f3/fe2/8784f3fe216e1b6b82fd2e4ae932ca1e.jpg" alt="image"></div><br>  For those who are interested in this topic, welcome to‚Ä¶ <br><a name="habracut"></a><br><br>  So, first, let's define SMT. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As Wikipedia tells us, SMT (from English simultaneous multithreading) is simultaneous multithreading, i.e.  multiple threads are executed simultaneously, rather than sequentially, as is the case in ‚Äútemporal multithreading‚Äù. <br><br>  Many people know this technology called ‚ÄúIntel Hyper-Threading‚Äù, everything has been written about it for a long time, but so far I have come across the fact that many developers, and, moreover, ordinary people do not understand what the main essence of the ‚Äúsimultaneous‚Äù execution of several commands one processor core and what problems it carries. <br><br>  For a start, let's talk about temporal multithreading.  Before the implementation of SMT technology in the form of "Hyper-Threading" technology was used "temporal multithreading". <br><br>  Everything is simple, let's imagine that we have one pipeline and one worker (CPU Core), which performs operations on numbers and records the result.  Suppose for these operations he needs a screwdriver and a wrench.  The operating system (OS) puts our worker on the conveyor in order one operation for a screwdriver, and behind it one operation for a wrench.  One worker at a time can operate either with a wrench or only with a screwdriver.  Thus, laying out a different number of different blocks, the OS determines the priority of performing certain operations from different applications.  We can indicate the proportion of some blocks to others inside the OS when we indicate the priority of the process.  This is exactly what all task managers do, including  and "Windows Performance Station".  This prioritization extends further to SMT mechanisms and all work with pipelines. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4d3/149/7bd/4d31497bd1e22c14e9b84bcaaad539c5.jpg" alt="image"><br><br>  With the advent of SMT, the situation becomes a bit more complicated. <br><br>  Imagine a conveyor and two workers who have one screwdriver and one wrench for two.  At the same time, each of them can operate either with a screwdriver or with a wrench only.  One conveyor is conventionally divided into two halves along.  SMT allows you to add two numbers to such a conveyor at once, one for working with a screwdriver and the other for working with a wrench, so the actions of these workers look like this: <br><br>  - The first worker receives an operation for a screwdriver, and the second, standing opposite, at the same time, an operation for a wrench, after which both record the result. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/01e/e47/ffb/01ee47ffb29a06bbb1b620c553571329.jpg" alt="image"><br><br>  Based on this, when there is an operation on the pipeline (A and B) on the one hand and (D and E) on the other hand, everything is fine, but when parallelizing the chain of calculations there are two problems: <br><br>  1. On the one side of the conveyor was the action (A and B) = C, and on the other (D and E) = C, <br>  those.  you must first write one C value, and then a second C value, but not simultaneously (control conflict). <br><br>  2. On the one side of the conveyor was the action (A and B) = C, and on the other (A and C) = D, <br>  those.  you must first calculate C, and then calculate D, but not simultaneously (data conflict). <br><br>  Both conflicts cause a delay in the execution of instructions and are solved by sequential execution of commands.  To reduce such delays, elements of a processor called a predictor of transitions and a processor cache were introduced. <br><br>  The predictor of transitions, as the name implies, carries out a prediction :) He predicts the likelihood of the first problem occurring when different transformations must occur on one number. <br><br>  In turn, the processor cache is needed for a quick solution to the second problem, when we stop the solution of the expression (A and C) = D and write the result of execution (A and B) = C in the cache, after which we immediately calculate (A and C) = D. <br><br>  In fairness, it is worth clarifying that the problem of parallelizing the pipeline also appears in multi-core processors without SMT, but multi-core processors do not have a processor idle moment when there are two screwdrivers for two workers, since  in this terminology, each worker has his own screwdriver and his wrench. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/545/e71/905/545e71905dfd0606ec4847163cd4971c.jpg" alt="image"><br><br>  All these dances around the processor guessing how to parallelize current operations lead to serious energy losses and to tangible friezes when starvation of different types of tasks on cores with SMT occurs. <br><br>  In general, it is worth keeping in mind that Intel developed Hyper-Threading simultaneously with the creation of its first multi-core Xeon processors and, in fact, this technology can be considered a kind of compromise when a double pipeline is put on one core. <br><br>  From the presentation of marketers, it is customary to praise how well one core can perform several tasks at the same time and how it improves performance "in some usage scenarios", however, it is customary to conceal the problems inherent in the SMT concept. <br><br>  It is noteworthy that on the Intel site, in a commercial, dual core is shown rather than Hyper-Threading, the one who has finished reading up to this point has probably already guessed why :) <br><br>  Image from video: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/876/3d3/eaa/8763d3eaa0bf736b8db09a390374a8ab.jpg" alt="image"><br><br>  More accurate image: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7c9/266/615/7c9266615fd813150357e8aa15021d59.gif" alt="image"><br><br><div class="oembed">  <a href="https://www.intel.ru/content/www/ru/ru/architecture-and-technology/hyper-threading/hyper-threading-technology.html">https://www.intel.ru/content/www/ru/ru/architecture-and-technology/hyper-threading/hyper-threading-technology.html</a> </div><br><br>  What conclusion can be made here and what to improve? <br><br>  The mapping feature of loading logical cores in Windows OS introduces confusion about the real-world kernel load information with SMT.  If you see that two neighboring kernels are busy ~ 50% this can mean two things: <br>  1) both cores perform two parallel calculations and are 50% loaded (everything is ok here). <br>  2) both cores perform one calculation alternately (as if two workers passed a wrench through each other through clock). <br>  <u>Therefore, if you see that all the cores of your processor with SMT are loaded 50% or more, the load does not increase, most likely this means that the processor utilization is 100%, but it is of the same type of task that it cannot divide to perform on SMT!</u> <br><br>  Together with obvious advantages, SMT brings friezes into tasks that are time-sensitive (video / music playback or FPS in games).  That is why many gamers watch FPS drop when SMT / Hyper-Threading is enabled. <br><br>  As I wrote earlier, the ‚ÄúWindows Performance Station‚Äù application can sort the blocks laid out on the pipeline even at the stage of task processing by the OS kernel.  With the help of priorities and separation of processes by processor cores, you can lay out certain blocks on the pipeline in the right quantity and put blocks of different types for different virtual cores to prevent fasting of different types of tasks.  It is for this dynamic analysis task in the ‚ÄúWindows Performance Station‚Äù that we combined the neural network and the task manager.  As a result, the neural network analyzes the task and decomposes it according to the received data according to different rules, so that each core in the SMT pair performs different tasks. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/066/e47/b8e/066e47b8e20eda2834c511898a7986dd.jpg" alt="image"><br><br>  Through this approach, SMT processors on Windows can work more efficiently with multitasking and multi-threaded processes.  And that is why we are very pleased with the appearance of SMT in the new AMD Ryzen processors. <br><br>  The application "Windows Performance Station" is free and does not contain advertising, it can be downloaded from our website via the link in the spoiler: <br><div class="spoiler">  <b class="spoiler_title">Download</b> <div class="spoiler_text">  <a href="http://winperst.ru/download">winperst.ru/download</a> <br></div></div><br><br>  You can read more about Windows Performance Station in my previous article. <br><div class="spoiler">  <b class="spoiler_title">Windows Performance Station or how I taught the computer to work effectively</b> <div class="spoiler_text">  <a href="https://habrahabr.ru/post/320110/">habrahabr.ru/post/320110</a> <br></div></div><br><br>  Many thanks to all who read to the end. </div><p>Source: <a href="https://habr.com/ru/post/333632/">https://habr.com/ru/post/333632/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../333622/index.html">Dereferencing null pointers is no longer a problem.</a></li>
<li><a href="../333624/index.html">Apple will spend a billion on Chinese data center</a></li>
<li><a href="../333626/index.html">Creating servlets for dummies. Walkthrough</a></li>
<li><a href="../333628/index.html">Analyzing NHL players careers with Survival Regression and Python</a></li>
<li><a href="../333630/index.html">WebStorm 2017.2 - What's new in support for JavaScript, TypeScript, Angular and Sass and work with ESLint, Karma and Mocha</a></li>
<li><a href="../333634/index.html">Galactic hackathon: how to convince young developers to go over to their side</a></li>
<li><a href="../333636/index.html">XBRL: Just About the Difficult - Chapter 1. Introduction</a></li>
<li><a href="../333638/index.html">Education in the online magistracy as an option for professional and career growth</a></li>
<li><a href="../333640/index.html">Emacs + handy window and buffer manager</a></li>
<li><a href="../333642/index.html">Startup eyes of the developer. Which framework is better to choose</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>