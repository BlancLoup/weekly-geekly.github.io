<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Configuring exim + postgresql + dbmail + spamassassin in Gentoo</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There are a lot of articles about configuring exim + mysql + anything else, and just a couple about exim + postgresql and even with broken links, so I...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Configuring exim + postgresql + dbmail + spamassassin in Gentoo</h1><div class="post__text post__text-html js-mediator-article">  There are a lot of articles about configuring exim + mysql + anything else, and just a couple about exim + postgresql and even with broken links, so I decided to share my experience and put together instructions for installing and configuring exim + postgresql + dbmail + spamassassin . <br><a name="habracut"></a><br><h1>  Installing software </h1><br>  Add to postgres exiscan exiscan-acl USE flags then install <br><blockquote> <code>emerge exim virtual/postgresql-server dbmail spamassassin <br></code> </blockquote> <code>emerge exim virtual/postgresql-server dbmail spamassassin <br></code> <br><br><h1>  Customization </h1><br><br><h2>  Postgresql </h2><br>  Configuring postgresql for the first run <br><blockquote> <code>emerge --config postgresql</code> </blockquote> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Run <br><blockquote> <code>/etc/init.d/postgresql start <br></code> </blockquote> <code>/etc/init.d/postgresql start <br></code> <br><br>  Create a user to work with the mail database <br><blockquote> <code>createuser -U postgres -P dbmail</code> </blockquote> <br><br>  Create a database <br><blockquote> <code>createdb -U postgres --owner dbmail dbmail</code> </blockquote> <br><br>  Along with dbmail, there are blanks for the base, unpacking and uploading <br><blockquote> <code>bunzip2 /usr/share/doc/dbmail-2.2.10/create_tables.pgsql.bz2 <br> psql -U dbmail -d dbmail &lt; /usr/share/doc/dbmail-2.2.10/create_tables.pgsql <br></code> </blockquote><br>  In this dump there is no table for working with virtual domains, we will create it <br> <code><code><a href="http://njabl.org/"></a> <a href="http://www.spamcop.net/w3m%3Faction%3Dcheckblock%26ip%3D"></a> <font color="black">CREATE TYPE dtype AS ENUM ( <br> <font color="#A31515">'LOCAL'</font> , <br> <font color="#A31515">'VIRTUAL'</font> , <br> <font color="#A31515">'RELAY'</font> <br> ); <br> <br> ALTER TYPE <font color="#0000ff">public</font> .dtype OWNER TO dbmail; <br> <br> SET default_with_oids = <font color="#0000ff">true</font> ; <br> <br> CREATE TABLE dbmail_domains ( <br> uid integer NOT NULL, <br> domain character varying(128) NOT NULL, <br> type dtype NOT NULL <br> ); <br> <br> INSERT INTO dbmail_domains (uid, domain, type) VALUES (1, <font color="#A31515">'example.com'</font> , <font color="#A31515">'LOCAL'</font> );</font> <br>   . <br> <br> Exim <br> C   exim.conf <br> #!/bin/sh <br> ###################################################################### <br> # Runtime configuration file for Exim # <br> ###################################################################### <br> ####################################################################### <br> # MAIN CONFIGURATION SETTINGS # <br> ###################################################################### <br> <br> primary_hostname = example.com <br> domainlist local_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND \ <br> (type='LOCAL' OR type='VIRTUAL')}} <br> domainlist relay_to_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND type='RELAY'}} <br> hostlist relay_from_hosts = 127.0.0.1: localhost <br> auth_advertise_hosts = * <br> daemon_smtp_ports = 25 <br> log_selector = \ <br> +all_parents \ <br> +lost_incoming_connection \ <br> +received_sender \ <br> +received_recipients \ <br> +smtp_confirmation \ <br> +smtp_syntax_error \ <br> +smtp_protocol_error \ <br> -queue_run <br> acl_smtp_rcpt = acl_check_rcpt <br> acl_smtp_mime = acl_check_mime <br> acl_smtp_data = acl_check_content <br> qualify_domain = example.com <br> allow_domain_literals = false <br> exim_user = mail <br> exim_group = mail <br> never_users = root <br> host_lookup = * <br> #rfc1413_hosts = * <br> rfc1413_query_timeout = 0s <br> ignore_bounce_errors_after = 30m <br> timeout_frozen_after = 3d <br> freeze_tell = postmaster <br> <br> #av_scanner = clamd:/var/run/clamav/clamd.ctl #        <br> spamd_address = 127.0.0.1 783 <br> <br> message_size_limit = 10M <br> smtp_accept_max = 1000 <br> smtp_accept_max_per_connection = 150 <br> smtp_accept_max_per_host = 30 <br> split_spool_directory = true <br> remote_max_parallel = 15 <br> smtp_banner = "Welcome on our mail server!\n\ <br> This system does not accept Unsolicited \ <br> Commercial Email\nand will blacklist \ <br> offenders via our spam processor.\nHave a \ <br> nice day!\n\n${primary_hostname} ESMTP" <br> <br> hide pgsql_servers = localhost/dbmail/dbmail/PasSWorD <br> <br> ###################################################################### <br> # ACL CONFIGURATION # <br> # Specifies access control lists for incoming SMTP mail # <br> ###################################################################### <br> begin acl <br> <br> acl_check_rcpt: <br> <br> warn <br> set acl_m0 = 0s <br> warn <br> hosts = !+relay_from_hosts:!213.243.111.115/32 <br> set acl_m0 = 30s <br> warn <br> condition = ${if and {\ <br> {match{$sender_host_name}\ <br> {\N^[-az]*\d{0,3}[-az]*\.?[-az]*\d{0,3}[-az]*\.\w+$\N}} \ <br> {!eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 1s <br> <br> warn <br> condition = ${if and {\ <br> {match{$sender_helo_name}{\N^\w*\.\w{3}$\N}} \ <br> {eq{$acl_c1}{}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c2}{outblaze_domain}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if or {\ <br> {eq{$sender_address}{}} \ <br> {eq{$acl_m1}{0s}} \ <br> } {yes}{no}} <br> set acl_m0 = 0s <br> <br> warn <br> logwrite = Delay $acl_m0 for $sender_host_name \ <br> [$sender_host_address] with HELO=$sender_helo_name. \ <br> Mail from $sender_address to $local_part@$domain. <br> set acl_m1 = 0s <br> delay = $acl_m0 <br> <br> accept hosts = : <br> <br> deny domains = +local_domains <br> local_parts = ^[.] : ^.*[@%!/|] <br> <br> deny domains = !+local_domains <br> local_parts = ^[./|] : ^.*[@%!] : ^.*/\\.\\./ <br> <br> accept local_parts = postmaster <br> domains = +local_domains <br> <br> require verify = sender <br> <br> deny message = HELO/EHLO required by SMTP RFC <br> condition = ${if eq{$sender_helo_name}{}{yes}{no}} <br> <br> deny message = Go Away! You are spammer. <br> condition = ${if match{$sender_host_name} \ <br> {bezeqint\\.net|net\\.il|dialup|dsl|pool|peer|dhcp} \ <br> {yes}{no}} <br> <br> deny message = message from \ <br> $sender_host_address rejected - see njabl.org <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.njabl.org <br> <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dialups.mail-abuse.org <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = list.dsbl.org <br> deny message = Spam blocked see: \ <br> www.spamcop.net/w3m?action=checkblock&amp;ip=$sender_host_address <br> log_message = found in $dnslist_domain <br> dnslists = bl.spamcop.net <br> deny message = rejected, $sender_host_address \ <br> Open Proxy, see: $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.void.ru <br> <br> accept domains = +local_domains <br> endpass <br> message = unknown user <br> verify = recipient <br> <br> accept domains = +relay_to_domains <br> endpass <br> message = unrouteable address <br> verify = recipient <br> <br> accept hosts = +relay_from_hosts <br> accept authenticated = * <br> deny message = relay not permitted <br> <br> acl_check_mime: <br> <br> warn decode = default <br> <br> deny message = Blacklisted file extension detected ($mime_filename) <br> condition = ${if match \ <br> {${lc:$mime_filename}} \ <br> {\N(\.exe|\.pif|\.bat|\.scr|\.lnk|\.com|\.vbs|\.cpl)$\N} \ <br> {1}{0}} <br> <br> deny message = Sorry, noone speaks chinese here <br> condition = ${if eq{$mime_charset}{gb2312}{1}{0}} <br> <br> accept <br> <br> acl_check_content: <br> # deny message = Virus found ($malware_name) <br> # malware = * <br> <br> warn message = X-Spam-Score: $spam_score ($spam_bar) <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = X-Spam-Report: $spam_report <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = Subject: ***SPAM*** $h_Subject: <br> hosts = !+relay_from_hosts <br> spam = spamd <br> <br> deny message = This message scored $spam_score spam points. <br> spam = spamd:true <br> hosts = !+relay_from_hosts <br> condition = ${if &gt;{$spam_score_int}{120}{1}{0}} <br> <br> accept <br> <br> ###################################################################### <br> # ROUTERS CONFIGURATION # <br> # Specifies how addresses are handled # <br> ###################################################################### <br> # THE ORDER IN WHICH THE ROUTERS ARE DEFINED IS IMPORTANT! # <br> # An address is passed to each router in turn until it is accepted. # <br> ###################################################################### <br> <br> begin routers <br> <br> dnslookup: <br> driver = dnslookup <br> domains = ! +local_domains <br> transport = remote_smtp <br> ignore_target_hosts = 0.0.0.0 : 127.0.0.0/8 <br> no_more <br> <br> dbmailuser: <br> driver = accept <br> condition = ${lookup pgsql{SELECT alias_idnr FROM \ <br> dbmail_aliases WHERE \ <br> alias='${quote_pgsql:$local_part@$domain}' OR \ <br> alias='${quote_pgsql:@$domain}'}{yes}{no}} <br> transport = dbmail_delivery <br> <br> ###################################################################### <br> # TRANSPORTS CONFIGURATION # <br> ###################################################################### <br> # ORDER DOES NOT MATTER # <br> # Only one appropriate transport is called for each delivery. # <br> ###################################################################### <br> <br> begin transports <br> <br> remote_smtp: <br> driver = smtp <br> <br> dbmail_delivery: <br> driver = pipe <br> check_string = <br> command = /usr/sbin/dbmail-smtp -d ${pipe_addresses} <br> group = mail <br> message_prefix = "" <br> message_suffix = "" <br> path="/bin:/sbin:/usr/bin:/usr/sbin" <br> #   <br> address_pipe: <br> driver = pipe <br> return_output <br> <br> address_reply: <br> driver = autoreply <br> <br> ###################################################################### <br> # RETRY CONFIGURATION # <br> ###################################################################### <br> <br> begin retry <br> <br> * quota <br> * * F,2h,15m; G,16h,1h,1.5; F,4d,6h <br> <br> ###################################################################### <br> # REWRITE CONFIGURATION # <br> ###################################################################### <br> <br> begin rewrite <br> <br> ###################################################################### <br> # AUTHENTICATION CONFIGURATION # <br> ###################################################################### <br> <br> begin authenticators <br> <br> auth_plain: <br> driver = plaintext <br> public_name = PLAIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = : <br> server_set_id = $2 <br> <br> #    ,    . <br> auth_login: <br> driver = plaintext <br> public_name = LOGIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = Username:: : Password:: <br> server_set_id = $1 <br> <br> #    " " - TheBat! <br> auth_cram_md5: <br> driver = cram_md5 <br> public_name = CRAM-MD5 <br> server_secret = ${lookup pgsql{SELECT passwd FROM \ <br> dbmail_users WHERE userid \ <br> = '${quote_pgsql:$1}'}{$value}fail} <br> server_set_id = $1 <br> # End of Exim configuration file <br> ###ps  lissyara,       <br> <br> <br> <br> DBMail <br> dbmail.conf          <br> <code># (c) 2000-2006 IC&amp;S, The Netherlands <br> # <br> # Configuration file for DBMAIL <br> <br> [DBMAIL] <br> # <br> # Database settings <br> # <br> <br> # <br> # Supported drivers are mysql, pgsql, sqlite. <br> # <br> driver =pgsql <br> <br> # <br> # Supported drivers are sql, ldap. <br> # <br> authdriver =sql <br> <br> # <br> # Host for database, set to localhost if database is on <br> # the same host as dbmail and you want to use a local <br> # socket for connecting. <br> # <br> host =localhost <br> <br> # <br> # If you want to use TCP/IP for connecting to the database, <br> # and have the database running on a non-standard port. <br> # <br> sqlport =5432 <br> <br> # <br> # When using a local socket connection to the database, fill <br> # in the path to the socket here (eg /var/run/mysql.sock). <br> # <br> sqlsocket = <br> <br> # <br> # Database username. <br> # <br> user =dbmail <br> <br> # <br> # Database password. <br> # <br> pass =PasWoRd <br> <br> # <br> # Database name. <br> # <br> db =dbmail <br> <br> # <br> # Table prefix. Defaults to "dbmail_" if not specified. <br> # <br> table_prefix =dbmail_ <br> <br> # <br> # encoding must match the database/table encoding. <br> # ie latin1, utf8 <br> encoding = utf8 <br> <br> # <br> # messages with unknown encoding will be assumed to have <br> # default_msg_encoding <br> # ie iso8859-1, utf8 <br> default_msg_encoding = utf8 <br> <br> # <br> # Postmaster's email address for use in bounce messages. <br> # <br> #postmaster = DBMAIL-MAILER <br> <br> # <br> # Sendmail executable for forwards, replies, notifies, vacations. <br> # You may use pipes (|) in this command, for example: <br> # dos2unix|/usr/sbin/sendmail works well with Qmail. <br> # You may use quotes (") for executables with unusual names. <br> # <br> sendmail = /usr/sbin/sendmail <br> <br> # <br> # <br> # The following items can be overridden in the service-specific sections. <br> # <br> # <br> <br> # <br> # Trace level to send to syslog. Default is 2 (messages, errors, fatals). <br> # <br> TRACE_SYSLOG = 3 <br> <br> # <br> # Trace level to send to stderr. Default is 0 (fatals). <br> # <br> TRACE_STDERR = 1 <br> <br> # <br> # Root privs are used to open a port, then privs <br> # are dropped down to the user/group specified here. <br> # <br> EFFECTIVE_USER = dbmail <br> EFFECTIVE_GROUP = dbmail <br> <br> # <br> # The IP addresses the services will bind to. <br> # Use * for all local interfaces. <br> # Use 127.0.0.1 for localhost only. <br> # Separate multiple entries with spaces ( ) or commas (,). <br> # <br> BINDIP = * <br> <br> # <br> # Default number of child processes to start. <br> # <br> NCHILDREN = 2 <br> <br> # <br> # Maximum number of child processes allowed. <br> # <br> MAXCHILDREN = 10 <br> <br> # <br> # Unused children to always have availale. <br> # <br> MINSPARECHILDREN = 2 <br> <br> # <br> # Maximum unused children allowed to be active. <br> # <br> MAXSPARECHILDREN = 4 <br> <br> # <br> # Child process is restarted after handling this many connections. <br> # <br> MAXCONNECTS = 10000 <br> <br> # <br> # Child process will restart after this many connection errors. <br> # <br> MAX_ERRORS = 500 <br> <br> # <br> # Idle time allowed before a connection is shut off. <br> # <br> TIMEOUT = 300 <br> <br> # <br> # Idle time allowed before a connection is shut off if you have not logged in yet. <br> # <br> login_timeout = 60 <br> <br> # <br> # If yes, resolves IP addresses to DNS names when logging. <br> # <br> RESOLVE_IP = no <br> <br> # <br> # logfile for stdout messages <br> # <br> logfile = /var/log/dbmail.log <br> <br> # <br> # logfile for stderr messages <br> # <br> errorlog = /var/log/dbmail.err <br> <br> # <br> # directory for storing PID files <br> # <br> pid_directory = /var/run <br> <br> # <br> # directory for storing the daemon statefiles <br> # <br> state_directory = /var/run <br> <br> # <br> # directory for locating libraries (normally has a sane default compiled-in) <br> # <br> #library_directory = /usr/lib/dbmail <br> <br> [SMTP] <br> # In fact, there isn't anything here by default. <br> <br> [LMTP] <br> # <br> # Port to bind to. <br> # <br> PORT = 24 <br> <br> [POP] <br> # <br> # Port to bind to. <br> # <br> PORT = 110 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by POP3. <br> # This requires addition configuration of your MTA <br> # <br> POP_BEFORE_SMTP = no <br> <br> [IMAP] <br> <br> # <br> # Port to bind to. <br> # <br> PORT = 143 <br> <br> # <br> # IMAP prefers a longer timeout than other services. <br> # <br> TIMEOUT = 4000 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by IMAP. <br> # This requires addition configuration of your MTA <br> # <br> IMAP_BEFORE_SMTP = no <br> <br> # <br> # during IDLE, how many seconds between checking the mailbox <br> # status (default: 30) <br> # <br> # idle_timeout = 30 <br> <br> # <br> # Provide a CAPABILITY to override the default <br> # <br> # capability = IMAP4 IMAP4rev1 AUTH=LOGIN ACL NAMESPACE CHILDREN SORT QUOTA THREAD=ORDEREDSUBJECT UNSELECT IDLE <br> <br> [SIEVE] <br> # <br> # Port to bind to. <br> # <br> PORT = 2000 <br> <br> [LDAP] <br> PORT = 389 <br> VERSION = 3 <br> HOSTNAME = ldap <br> BASE_DN = ou=People,dc=mydomain,dc=com <br> <br> # <br> # If your LDAP library supports ldap_initialize(), then you can use the <br> # alternative LDAP server DSN like following. <br> # <br> # URI = ldap://127.0.0.1:389 <br> # URI = ldapi://%2fvar%2frun%2fopenldap%2fldapi/ <br> <br> # <br> # Leave blank for anonymous bind. <br> # example: cn=admin,dc=mydomain,dc=com <br> # <br> BIND_DN = <br> <br> # <br> # Leave blank for anonymous bind. <br> # <br> BIND_PW = <br> SCOPE = SubTree <br> USER_OBJECTCLASS = top,account,dbmailUser <br> FORW_OBJECTCLASS = top,account,dbmailForwardingAddress <br> CN_STRING = uid <br> FIELD_PASSWD = userPassword <br> FIELD_UID = uid <br> FIELD_NID = uidNumber <br> MIN_NID = 10000 <br> MAX_NID = 15000 <br> FIELD_CID = gidNumber <br> MIN_CID = 10000 <br> MAX_CID = 15000 <br> FIELD_MAIL = mail <br> FIELD_QUOTA = mailQuota <br> FIELD_FWDTARGET = mailForwardingAddress <br> <br> [DELIVERY] <br> # <br> # Run Sieve scripts as messages are delivered. <br> # <br> SIEVE = yes <br> <br> # <br> # Use 'user+mailbox@domain' format to deliver to a mailbox. <br> # <br> SUBADDRESS = yes <br> <br> # <br> # Turn on/off the Sieve Vacation extension. <br> # <br> SIEVE_VACATION = yes <br> <br> # <br> # Turn on/off the Sieve Notify extension <br> # <br> SIEVE_NOTIFY = yes <br> <br> # <br> # Turn on/off additional Sieve debugging. <br> # <br> SIEVE_DEBUG = no <br> <br> # <br> # Use the auto_notify table to send email notifications. <br> # <br> AUTO_NOTIFY = no <br> <br> # <br> # Use the auto_reply table to send away messages. <br> # <br> AUTO_REPLY = no <br> # <br> # Defaults to "NEW MAIL NOTIFICATION" <br> # <br> #AUTO_NOTIFY_SUBJECT = <br> <br> # <br> # Defaults to POSTMASTER from the DBMAIL section. <br> # <br> #AUTO_NOTIFY_SENDER = <br> <br> # <br> # If you set this to 'yes' dbmail will check for duplicate <br> # messages in the relevant mailbox during delivery using <br> # the Message-ID header <br> # <br> suppress_duplicates = no <br> <br> # end of configuration file <br> <br> <br></code> <br> <br> Spamassassin <br>    ,         ,          /etc/spamasassin,      ,       nobody <br> <br> local.cf <br> <code>rewrite_header Subject ***SPAM*** <br> report_safe 1 <br> trusted_networks 192.168/16 127/8 <br> # lock_method flock <br> required_score 5.0 <br> use_bayes 1 <br> bayes_auto_learn 1 <br> # bayes_ignore_header X-Bogosity <br> # bayes_ignore_header X-Spam-Flag <br> # bayes_ignore_header X-Spam-Status <br> auto_whitelist_path /etc/mail/spamassassin/auto_whitelist <br> bayes_path /etc/mail/spamassassin/bayes <br> bayes_file_mode 0666 <br> bayes_min_ham_num 1 <br> bayes_min_spam_num 1 <br> auto_learn_threshold_nonspam -2 <br> auto_learn_threshold_spam 5 <br> bayes_learn_to_journal 1 <br> skip_rbl_checks 0 <br> <br> ok_languages ru en <br> ok_locales ru en <br></code> <br> <br>    ..     <br> <code>/etc/init.d/exim start <br> /etc/init.d/spamd start <br> #    pop3      <br> /etc/init.d/dbmail-pop3d <br></code> <br> <br>     ,           <br> <code>rc-update add postgresql default <br> rc-update add exim default <br> rc-update add spamd default <br> rc-update add dbmail-pop3d default <br></code> <br> <br>          ,       <br> <code>dbmail-users -a admin@example.com -s admin@example.com -p plaintext -w 123123 <br></code> <br> <br>   ,        <br></code></code> <blockquote> <code><code><font color="black"><a href="http://njabl.org/"></a> <a href="http://www.spamcop.net/w3m%3Faction%3Dcheckblock%26ip%3D"></a> CREATE TYPE dtype AS ENUM ( <br> <font color="#A31515">'LOCAL'</font> , <br> <font color="#A31515">'VIRTUAL'</font> , <br> <font color="#A31515">'RELAY'</font> <br> ); <br> <br> ALTER TYPE <font color="#0000ff">public</font> .dtype OWNER TO dbmail; <br> <br> SET default_with_oids = <font color="#0000ff">true</font> ; <br> <br> CREATE TABLE dbmail_domains ( <br> uid integer NOT NULL, <br> domain character varying(128) NOT NULL, <br> type dtype NOT NULL <br> ); <br> <br> INSERT INTO dbmail_domains (uid, domain, type) VALUES (1, <font color="#A31515">'example.com'</font> , <font color="#A31515">'LOCAL'</font> ); <br>   . <br> <br> Exim <br> C   exim.conf <br> #!/bin/sh <br> ###################################################################### <br> # Runtime configuration file for Exim # <br> ###################################################################### <br> ####################################################################### <br> # MAIN CONFIGURATION SETTINGS # <br> ###################################################################### <br> <br> primary_hostname = example.com <br> domainlist local_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND \ <br> (type='LOCAL' OR type='VIRTUAL')}} <br> domainlist relay_to_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND type='RELAY'}} <br> hostlist relay_from_hosts = 127.0.0.1: localhost <br> auth_advertise_hosts = * <br> daemon_smtp_ports = 25 <br> log_selector = \ <br> +all_parents \ <br> +lost_incoming_connection \ <br> +received_sender \ <br> +received_recipients \ <br> +smtp_confirmation \ <br> +smtp_syntax_error \ <br> +smtp_protocol_error \ <br> -queue_run <br> acl_smtp_rcpt = acl_check_rcpt <br> acl_smtp_mime = acl_check_mime <br> acl_smtp_data = acl_check_content <br> qualify_domain = example.com <br> allow_domain_literals = false <br> exim_user = mail <br> exim_group = mail <br> never_users = root <br> host_lookup = * <br> #rfc1413_hosts = * <br> rfc1413_query_timeout = 0s <br> ignore_bounce_errors_after = 30m <br> timeout_frozen_after = 3d <br> freeze_tell = postmaster <br> <br> #av_scanner = clamd:/var/run/clamav/clamd.ctl #        <br> spamd_address = 127.0.0.1 783 <br> <br> message_size_limit = 10M <br> smtp_accept_max = 1000 <br> smtp_accept_max_per_connection = 150 <br> smtp_accept_max_per_host = 30 <br> split_spool_directory = true <br> remote_max_parallel = 15 <br> smtp_banner = "Welcome on our mail server!\n\ <br> This system does not accept Unsolicited \ <br> Commercial Email\nand will blacklist \ <br> offenders via our spam processor.\nHave a \ <br> nice day!\n\n${primary_hostname} ESMTP" <br> <br> hide pgsql_servers = localhost/dbmail/dbmail/PasSWorD <br> <br> ###################################################################### <br> # ACL CONFIGURATION # <br> # Specifies access control lists for incoming SMTP mail # <br> ###################################################################### <br> begin acl <br> <br> acl_check_rcpt: <br> <br> warn <br> set acl_m0 = 0s <br> warn <br> hosts = !+relay_from_hosts:!213.243.111.115/32 <br> set acl_m0 = 30s <br> warn <br> condition = ${if and {\ <br> {match{$sender_host_name}\ <br> {\N^[-az]*\d{0,3}[-az]*\.?[-az]*\d{0,3}[-az]*\.\w+$\N}} \ <br> {!eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 1s <br> <br> warn <br> condition = ${if and {\ <br> {match{$sender_helo_name}{\N^\w*\.\w{3}$\N}} \ <br> {eq{$acl_c1}{}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c2}{outblaze_domain}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if or {\ <br> {eq{$sender_address}{}} \ <br> {eq{$acl_m1}{0s}} \ <br> } {yes}{no}} <br> set acl_m0 = 0s <br> <br> warn <br> logwrite = Delay $acl_m0 for $sender_host_name \ <br> [$sender_host_address] with HELO=$sender_helo_name. \ <br> Mail from $sender_address to $local_part@$domain. <br> set acl_m1 = 0s <br> delay = $acl_m0 <br> <br> accept hosts = : <br> <br> deny domains = +local_domains <br> local_parts = ^[.] : ^.*[@%!/|] <br> <br> deny domains = !+local_domains <br> local_parts = ^[./|] : ^.*[@%!] : ^.*/\\.\\./ <br> <br> accept local_parts = postmaster <br> domains = +local_domains <br> <br> require verify = sender <br> <br> deny message = HELO/EHLO required by SMTP RFC <br> condition = ${if eq{$sender_helo_name}{}{yes}{no}} <br> <br> deny message = Go Away! You are spammer. <br> condition = ${if match{$sender_host_name} \ <br> {bezeqint\\.net|net\\.il|dialup|dsl|pool|peer|dhcp} \ <br> {yes}{no}} <br> <br> deny message = message from \ <br> $sender_host_address rejected - see njabl.org <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.njabl.org <br> <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dialups.mail-abuse.org <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = list.dsbl.org <br> deny message = Spam blocked see: \ <br> www.spamcop.net/w3m?action=checkblock&amp;ip=$sender_host_address <br> log_message = found in $dnslist_domain <br> dnslists = bl.spamcop.net <br> deny message = rejected, $sender_host_address \ <br> Open Proxy, see: $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.void.ru <br> <br> accept domains = +local_domains <br> endpass <br> message = unknown user <br> verify = recipient <br> <br> accept domains = +relay_to_domains <br> endpass <br> message = unrouteable address <br> verify = recipient <br> <br> accept hosts = +relay_from_hosts <br> accept authenticated = * <br> deny message = relay not permitted <br> <br> acl_check_mime: <br> <br> warn decode = default <br> <br> deny message = Blacklisted file extension detected ($mime_filename) <br> condition = ${if match \ <br> {${lc:$mime_filename}} \ <br> {\N(\.exe|\.pif|\.bat|\.scr|\.lnk|\.com|\.vbs|\.cpl)$\N} \ <br> {1}{0}} <br> <br> deny message = Sorry, noone speaks chinese here <br> condition = ${if eq{$mime_charset}{gb2312}{1}{0}} <br> <br> accept <br> <br> acl_check_content: <br> # deny message = Virus found ($malware_name) <br> # malware = * <br> <br> warn message = X-Spam-Score: $spam_score ($spam_bar) <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = X-Spam-Report: $spam_report <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = Subject: ***SPAM*** $h_Subject: <br> hosts = !+relay_from_hosts <br> spam = spamd <br> <br> deny message = This message scored $spam_score spam points. <br> spam = spamd:true <br> hosts = !+relay_from_hosts <br> condition = ${if &gt;{$spam_score_int}{120}{1}{0}} <br> <br> accept <br> <br> ###################################################################### <br> # ROUTERS CONFIGURATION # <br> # Specifies how addresses are handled # <br> ###################################################################### <br> # THE ORDER IN WHICH THE ROUTERS ARE DEFINED IS IMPORTANT! # <br> # An address is passed to each router in turn until it is accepted. # <br> ###################################################################### <br> <br> begin routers <br> <br> dnslookup: <br> driver = dnslookup <br> domains = ! +local_domains <br> transport = remote_smtp <br> ignore_target_hosts = 0.0.0.0 : 127.0.0.0/8 <br> no_more <br> <br> dbmailuser: <br> driver = accept <br> condition = ${lookup pgsql{SELECT alias_idnr FROM \ <br> dbmail_aliases WHERE \ <br> alias='${quote_pgsql:$local_part@$domain}' OR \ <br> alias='${quote_pgsql:@$domain}'}{yes}{no}} <br> transport = dbmail_delivery <br> <br> ###################################################################### <br> # TRANSPORTS CONFIGURATION # <br> ###################################################################### <br> # ORDER DOES NOT MATTER # <br> # Only one appropriate transport is called for each delivery. # <br> ###################################################################### <br> <br> begin transports <br> <br> remote_smtp: <br> driver = smtp <br> <br> dbmail_delivery: <br> driver = pipe <br> check_string = <br> command = /usr/sbin/dbmail-smtp -d ${pipe_addresses} <br> group = mail <br> message_prefix = "" <br> message_suffix = "" <br> path="/bin:/sbin:/usr/bin:/usr/sbin" <br> #   <br> address_pipe: <br> driver = pipe <br> return_output <br> <br> address_reply: <br> driver = autoreply <br> <br> ###################################################################### <br> # RETRY CONFIGURATION # <br> ###################################################################### <br> <br> begin retry <br> <br> * quota <br> * * F,2h,15m; G,16h,1h,1.5; F,4d,6h <br> <br> ###################################################################### <br> # REWRITE CONFIGURATION # <br> ###################################################################### <br> <br> begin rewrite <br> <br> ###################################################################### <br> # AUTHENTICATION CONFIGURATION # <br> ###################################################################### <br> <br> begin authenticators <br> <br> auth_plain: <br> driver = plaintext <br> public_name = PLAIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = : <br> server_set_id = $2 <br> <br> #    ,    . <br> auth_login: <br> driver = plaintext <br> public_name = LOGIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = Username:: : Password:: <br> server_set_id = $1 <br> <br> #    " " - TheBat! <br> auth_cram_md5: <br> driver = cram_md5 <br> public_name = CRAM-MD5 <br> server_secret = ${lookup pgsql{SELECT passwd FROM \ <br> dbmail_users WHERE userid \ <br> = '${quote_pgsql:$1}'}{$value}fail} <br> server_set_id = $1 <br> # End of Exim configuration file <br> ###ps  lissyara,       <br> <br> <br> <br> DBMail <br> dbmail.conf          <br> <code># (c) 2000-2006 IC&amp;S, The Netherlands <br> # <br> # Configuration file for DBMAIL <br> <br> [DBMAIL] <br> # <br> # Database settings <br> # <br> <br> # <br> # Supported drivers are mysql, pgsql, sqlite. <br> # <br> driver =pgsql <br> <br> # <br> # Supported drivers are sql, ldap. <br> # <br> authdriver =sql <br> <br> # <br> # Host for database, set to localhost if database is on <br> # the same host as dbmail and you want to use a local <br> # socket for connecting. <br> # <br> host =localhost <br> <br> # <br> # If you want to use TCP/IP for connecting to the database, <br> # and have the database running on a non-standard port. <br> # <br> sqlport =5432 <br> <br> # <br> # When using a local socket connection to the database, fill <br> # in the path to the socket here (eg /var/run/mysql.sock). <br> # <br> sqlsocket = <br> <br> # <br> # Database username. <br> # <br> user =dbmail <br> <br> # <br> # Database password. <br> # <br> pass =PasWoRd <br> <br> # <br> # Database name. <br> # <br> db =dbmail <br> <br> # <br> # Table prefix. Defaults to "dbmail_" if not specified. <br> # <br> table_prefix =dbmail_ <br> <br> # <br> # encoding must match the database/table encoding. <br> # ie latin1, utf8 <br> encoding = utf8 <br> <br> # <br> # messages with unknown encoding will be assumed to have <br> # default_msg_encoding <br> # ie iso8859-1, utf8 <br> default_msg_encoding = utf8 <br> <br> # <br> # Postmaster's email address for use in bounce messages. <br> # <br> #postmaster = DBMAIL-MAILER <br> <br> # <br> # Sendmail executable for forwards, replies, notifies, vacations. <br> # You may use pipes (|) in this command, for example: <br> # dos2unix|/usr/sbin/sendmail works well with Qmail. <br> # You may use quotes (") for executables with unusual names. <br> # <br> sendmail = /usr/sbin/sendmail <br> <br> # <br> # <br> # The following items can be overridden in the service-specific sections. <br> # <br> # <br> <br> # <br> # Trace level to send to syslog. Default is 2 (messages, errors, fatals). <br> # <br> TRACE_SYSLOG = 3 <br> <br> # <br> # Trace level to send to stderr. Default is 0 (fatals). <br> # <br> TRACE_STDERR = 1 <br> <br> # <br> # Root privs are used to open a port, then privs <br> # are dropped down to the user/group specified here. <br> # <br> EFFECTIVE_USER = dbmail <br> EFFECTIVE_GROUP = dbmail <br> <br> # <br> # The IP addresses the services will bind to. <br> # Use * for all local interfaces. <br> # Use 127.0.0.1 for localhost only. <br> # Separate multiple entries with spaces ( ) or commas (,). <br> # <br> BINDIP = * <br> <br> # <br> # Default number of child processes to start. <br> # <br> NCHILDREN = 2 <br> <br> # <br> # Maximum number of child processes allowed. <br> # <br> MAXCHILDREN = 10 <br> <br> # <br> # Unused children to always have availale. <br> # <br> MINSPARECHILDREN = 2 <br> <br> # <br> # Maximum unused children allowed to be active. <br> # <br> MAXSPARECHILDREN = 4 <br> <br> # <br> # Child process is restarted after handling this many connections. <br> # <br> MAXCONNECTS = 10000 <br> <br> # <br> # Child process will restart after this many connection errors. <br> # <br> MAX_ERRORS = 500 <br> <br> # <br> # Idle time allowed before a connection is shut off. <br> # <br> TIMEOUT = 300 <br> <br> # <br> # Idle time allowed before a connection is shut off if you have not logged in yet. <br> # <br> login_timeout = 60 <br> <br> # <br> # If yes, resolves IP addresses to DNS names when logging. <br> # <br> RESOLVE_IP = no <br> <br> # <br> # logfile for stdout messages <br> # <br> logfile = /var/log/dbmail.log <br> <br> # <br> # logfile for stderr messages <br> # <br> errorlog = /var/log/dbmail.err <br> <br> # <br> # directory for storing PID files <br> # <br> pid_directory = /var/run <br> <br> # <br> # directory for storing the daemon statefiles <br> # <br> state_directory = /var/run <br> <br> # <br> # directory for locating libraries (normally has a sane default compiled-in) <br> # <br> #library_directory = /usr/lib/dbmail <br> <br> [SMTP] <br> # In fact, there isn't anything here by default. <br> <br> [LMTP] <br> # <br> # Port to bind to. <br> # <br> PORT = 24 <br> <br> [POP] <br> # <br> # Port to bind to. <br> # <br> PORT = 110 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by POP3. <br> # This requires addition configuration of your MTA <br> # <br> POP_BEFORE_SMTP = no <br> <br> [IMAP] <br> <br> # <br> # Port to bind to. <br> # <br> PORT = 143 <br> <br> # <br> # IMAP prefers a longer timeout than other services. <br> # <br> TIMEOUT = 4000 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by IMAP. <br> # This requires addition configuration of your MTA <br> # <br> IMAP_BEFORE_SMTP = no <br> <br> # <br> # during IDLE, how many seconds between checking the mailbox <br> # status (default: 30) <br> # <br> # idle_timeout = 30 <br> <br> # <br> # Provide a CAPABILITY to override the default <br> # <br> # capability = IMAP4 IMAP4rev1 AUTH=LOGIN ACL NAMESPACE CHILDREN SORT QUOTA THREAD=ORDEREDSUBJECT UNSELECT IDLE <br> <br> [SIEVE] <br> # <br> # Port to bind to. <br> # <br> PORT = 2000 <br> <br> [LDAP] <br> PORT = 389 <br> VERSION = 3 <br> HOSTNAME = ldap <br> BASE_DN = ou=People,dc=mydomain,dc=com <br> <br> # <br> # If your LDAP library supports ldap_initialize(), then you can use the <br> # alternative LDAP server DSN like following. <br> # <br> # URI = ldap://127.0.0.1:389 <br> # URI = ldapi://%2fvar%2frun%2fopenldap%2fldapi/ <br> <br> # <br> # Leave blank for anonymous bind. <br> # example: cn=admin,dc=mydomain,dc=com <br> # <br> BIND_DN = <br> <br> # <br> # Leave blank for anonymous bind. <br> # <br> BIND_PW = <br> SCOPE = SubTree <br> USER_OBJECTCLASS = top,account,dbmailUser <br> FORW_OBJECTCLASS = top,account,dbmailForwardingAddress <br> CN_STRING = uid <br> FIELD_PASSWD = userPassword <br> FIELD_UID = uid <br> FIELD_NID = uidNumber <br> MIN_NID = 10000 <br> MAX_NID = 15000 <br> FIELD_CID = gidNumber <br> MIN_CID = 10000 <br> MAX_CID = 15000 <br> FIELD_MAIL = mail <br> FIELD_QUOTA = mailQuota <br> FIELD_FWDTARGET = mailForwardingAddress <br> <br> [DELIVERY] <br> # <br> # Run Sieve scripts as messages are delivered. <br> # <br> SIEVE = yes <br> <br> # <br> # Use 'user+mailbox@domain' format to deliver to a mailbox. <br> # <br> SUBADDRESS = yes <br> <br> # <br> # Turn on/off the Sieve Vacation extension. <br> # <br> SIEVE_VACATION = yes <br> <br> # <br> # Turn on/off the Sieve Notify extension <br> # <br> SIEVE_NOTIFY = yes <br> <br> # <br> # Turn on/off additional Sieve debugging. <br> # <br> SIEVE_DEBUG = no <br> <br> # <br> # Use the auto_notify table to send email notifications. <br> # <br> AUTO_NOTIFY = no <br> <br> # <br> # Use the auto_reply table to send away messages. <br> # <br> AUTO_REPLY = no <br> # <br> # Defaults to "NEW MAIL NOTIFICATION" <br> # <br> #AUTO_NOTIFY_SUBJECT = <br> <br> # <br> # Defaults to POSTMASTER from the DBMAIL section. <br> # <br> #AUTO_NOTIFY_SENDER = <br> <br> # <br> # If you set this to 'yes' dbmail will check for duplicate <br> # messages in the relevant mailbox during delivery using <br> # the Message-ID header <br> # <br> suppress_duplicates = no <br> <br> # end of configuration file <br> <br> <br></code> <br> <br> Spamassassin <br>    ,         ,          /etc/spamasassin,      ,       nobody <br> <br> local.cf <br> <code>rewrite_header Subject ***SPAM*** <br> report_safe 1 <br> trusted_networks 192.168/16 127/8 <br> # lock_method flock <br> required_score 5.0 <br> use_bayes 1 <br> bayes_auto_learn 1 <br> # bayes_ignore_header X-Bogosity <br> # bayes_ignore_header X-Spam-Flag <br> # bayes_ignore_header X-Spam-Status <br> auto_whitelist_path /etc/mail/spamassassin/auto_whitelist <br> bayes_path /etc/mail/spamassassin/bayes <br> bayes_file_mode 0666 <br> bayes_min_ham_num 1 <br> bayes_min_spam_num 1 <br> auto_learn_threshold_nonspam -2 <br> auto_learn_threshold_spam 5 <br> bayes_learn_to_journal 1 <br> skip_rbl_checks 0 <br> <br> ok_languages ru en <br> ok_locales ru en <br></code> <br> <br>    ..     <br> <code>/etc/init.d/exim start <br> /etc/init.d/spamd start <br> #    pop3      <br> /etc/init.d/dbmail-pop3d <br></code> <br> <br>     ,           <br> <code>rc-update add postgresql default <br> rc-update add exim default <br> rc-update add spamd default <br> rc-update add dbmail-pop3d default <br></code> <br> <br>          ,       <br> <code>dbmail-users -a admin@example.com -s admin@example.com -p plaintext -w 123123 <br></code> <br> <br>   ,        <br></font></code></code> </blockquote> <code><code><a href="http://njabl.org/"></a> <a href="http://www.spamcop.net/w3m%3Faction%3Dcheckblock%26ip%3D"></a> <font color="black">CREATE TYPE dtype AS ENUM ( <br> <font color="#A31515">'LOCAL'</font> , <br> <font color="#A31515">'VIRTUAL'</font> , <br> <font color="#A31515">'RELAY'</font> <br> ); <br> <br> ALTER TYPE <font color="#0000ff">public</font> .dtype OWNER TO dbmail; <br> <br> SET default_with_oids = <font color="#0000ff">true</font> ; <br> <br> CREATE TABLE dbmail_domains ( <br> uid integer NOT NULL, <br> domain character varying(128) NOT NULL, <br> type dtype NOT NULL <br> ); <br> <br> INSERT INTO dbmail_domains (uid, domain, type) VALUES (1, <font color="#A31515">'example.com'</font> , <font color="#A31515">'LOCAL'</font> );</font> <br>   . <br> <br> Exim <br> C   exim.conf <br> #!/bin/sh <br> ###################################################################### <br> # Runtime configuration file for Exim # <br> ###################################################################### <br> ####################################################################### <br> # MAIN CONFIGURATION SETTINGS # <br> ###################################################################### <br> <br> primary_hostname = example.com <br> domainlist local_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND \ <br> (type='LOCAL' OR type='VIRTUAL')}} <br> domainlist relay_to_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND type='RELAY'}} <br> hostlist relay_from_hosts = 127.0.0.1: localhost <br> auth_advertise_hosts = * <br> daemon_smtp_ports = 25 <br> log_selector = \ <br> +all_parents \ <br> +lost_incoming_connection \ <br> +received_sender \ <br> +received_recipients \ <br> +smtp_confirmation \ <br> +smtp_syntax_error \ <br> +smtp_protocol_error \ <br> -queue_run <br> acl_smtp_rcpt = acl_check_rcpt <br> acl_smtp_mime = acl_check_mime <br> acl_smtp_data = acl_check_content <br> qualify_domain = example.com <br> allow_domain_literals = false <br> exim_user = mail <br> exim_group = mail <br> never_users = root <br> host_lookup = * <br> #rfc1413_hosts = * <br> rfc1413_query_timeout = 0s <br> ignore_bounce_errors_after = 30m <br> timeout_frozen_after = 3d <br> freeze_tell = postmaster <br> <br> #av_scanner = clamd:/var/run/clamav/clamd.ctl #        <br> spamd_address = 127.0.0.1 783 <br> <br> message_size_limit = 10M <br> smtp_accept_max = 1000 <br> smtp_accept_max_per_connection = 150 <br> smtp_accept_max_per_host = 30 <br> split_spool_directory = true <br> remote_max_parallel = 15 <br> smtp_banner = "Welcome on our mail server!\n\ <br> This system does not accept Unsolicited \ <br> Commercial Email\nand will blacklist \ <br> offenders via our spam processor.\nHave a \ <br> nice day!\n\n${primary_hostname} ESMTP" <br> <br> hide pgsql_servers = localhost/dbmail/dbmail/PasSWorD <br> <br> ###################################################################### <br> # ACL CONFIGURATION # <br> # Specifies access control lists for incoming SMTP mail # <br> ###################################################################### <br> begin acl <br> <br> acl_check_rcpt: <br> <br> warn <br> set acl_m0 = 0s <br> warn <br> hosts = !+relay_from_hosts:!213.243.111.115/32 <br> set acl_m0 = 30s <br> warn <br> condition = ${if and {\ <br> {match{$sender_host_name}\ <br> {\N^[-az]*\d{0,3}[-az]*\.?[-az]*\d{0,3}[-az]*\.\w+$\N}} \ <br> {!eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 1s <br> <br> warn <br> condition = ${if and {\ <br> {match{$sender_helo_name}{\N^\w*\.\w{3}$\N}} \ <br> {eq{$acl_c1}{}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c2}{outblaze_domain}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if or {\ <br> {eq{$sender_address}{}} \ <br> {eq{$acl_m1}{0s}} \ <br> } {yes}{no}} <br> set acl_m0 = 0s <br> <br> warn <br> logwrite = Delay $acl_m0 for $sender_host_name \ <br> [$sender_host_address] with HELO=$sender_helo_name. \ <br> Mail from $sender_address to $local_part@$domain. <br> set acl_m1 = 0s <br> delay = $acl_m0 <br> <br> accept hosts = : <br> <br> deny domains = +local_domains <br> local_parts = ^[.] : ^.*[@%!/|] <br> <br> deny domains = !+local_domains <br> local_parts = ^[./|] : ^.*[@%!] : ^.*/\\.\\./ <br> <br> accept local_parts = postmaster <br> domains = +local_domains <br> <br> require verify = sender <br> <br> deny message = HELO/EHLO required by SMTP RFC <br> condition = ${if eq{$sender_helo_name}{}{yes}{no}} <br> <br> deny message = Go Away! You are spammer. <br> condition = ${if match{$sender_host_name} \ <br> {bezeqint\\.net|net\\.il|dialup|dsl|pool|peer|dhcp} \ <br> {yes}{no}} <br> <br> deny message = message from \ <br> $sender_host_address rejected - see njabl.org <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.njabl.org <br> <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dialups.mail-abuse.org <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = list.dsbl.org <br> deny message = Spam blocked see: \ <br> www.spamcop.net/w3m?action=checkblock&amp;ip=$sender_host_address <br> log_message = found in $dnslist_domain <br> dnslists = bl.spamcop.net <br> deny message = rejected, $sender_host_address \ <br> Open Proxy, see: $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.void.ru <br> <br> accept domains = +local_domains <br> endpass <br> message = unknown user <br> verify = recipient <br> <br> accept domains = +relay_to_domains <br> endpass <br> message = unrouteable address <br> verify = recipient <br> <br> accept hosts = +relay_from_hosts <br> accept authenticated = * <br> deny message = relay not permitted <br> <br> acl_check_mime: <br> <br> warn decode = default <br> <br> deny message = Blacklisted file extension detected ($mime_filename) <br> condition = ${if match \ <br> {${lc:$mime_filename}} \ <br> {\N(\.exe|\.pif|\.bat|\.scr|\.lnk|\.com|\.vbs|\.cpl)$\N} \ <br> {1}{0}} <br> <br> deny message = Sorry, noone speaks chinese here <br> condition = ${if eq{$mime_charset}{gb2312}{1}{0}} <br> <br> accept <br> <br> acl_check_content: <br> # deny message = Virus found ($malware_name) <br> # malware = * <br> <br> warn message = X-Spam-Score: $spam_score ($spam_bar) <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = X-Spam-Report: $spam_report <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = Subject: ***SPAM*** $h_Subject: <br> hosts = !+relay_from_hosts <br> spam = spamd <br> <br> deny message = This message scored $spam_score spam points. <br> spam = spamd:true <br> hosts = !+relay_from_hosts <br> condition = ${if &gt;{$spam_score_int}{120}{1}{0}} <br> <br> accept <br> <br> ###################################################################### <br> # ROUTERS CONFIGURATION # <br> # Specifies how addresses are handled # <br> ###################################################################### <br> # THE ORDER IN WHICH THE ROUTERS ARE DEFINED IS IMPORTANT! # <br> # An address is passed to each router in turn until it is accepted. # <br> ###################################################################### <br> <br> begin routers <br> <br> dnslookup: <br> driver = dnslookup <br> domains = ! +local_domains <br> transport = remote_smtp <br> ignore_target_hosts = 0.0.0.0 : 127.0.0.0/8 <br> no_more <br> <br> dbmailuser: <br> driver = accept <br> condition = ${lookup pgsql{SELECT alias_idnr FROM \ <br> dbmail_aliases WHERE \ <br> alias='${quote_pgsql:$local_part@$domain}' OR \ <br> alias='${quote_pgsql:@$domain}'}{yes}{no}} <br> transport = dbmail_delivery <br> <br> ###################################################################### <br> # TRANSPORTS CONFIGURATION # <br> ###################################################################### <br> # ORDER DOES NOT MATTER # <br> # Only one appropriate transport is called for each delivery. # <br> ###################################################################### <br> <br> begin transports <br> <br> remote_smtp: <br> driver = smtp <br> <br> dbmail_delivery: <br> driver = pipe <br> check_string = <br> command = /usr/sbin/dbmail-smtp -d ${pipe_addresses} <br> group = mail <br> message_prefix = "" <br> message_suffix = "" <br> path="/bin:/sbin:/usr/bin:/usr/sbin" <br> #   <br> address_pipe: <br> driver = pipe <br> return_output <br> <br> address_reply: <br> driver = autoreply <br> <br> ###################################################################### <br> # RETRY CONFIGURATION # <br> ###################################################################### <br> <br> begin retry <br> <br> * quota <br> * * F,2h,15m; G,16h,1h,1.5; F,4d,6h <br> <br> ###################################################################### <br> # REWRITE CONFIGURATION # <br> ###################################################################### <br> <br> begin rewrite <br> <br> ###################################################################### <br> # AUTHENTICATION CONFIGURATION # <br> ###################################################################### <br> <br> begin authenticators <br> <br> auth_plain: <br> driver = plaintext <br> public_name = PLAIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = : <br> server_set_id = $2 <br> <br> #    ,    . <br> auth_login: <br> driver = plaintext <br> public_name = LOGIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = Username:: : Password:: <br> server_set_id = $1 <br> <br> #    " " - TheBat! <br> auth_cram_md5: <br> driver = cram_md5 <br> public_name = CRAM-MD5 <br> server_secret = ${lookup pgsql{SELECT passwd FROM \ <br> dbmail_users WHERE userid \ <br> = '${quote_pgsql:$1}'}{$value}fail} <br> server_set_id = $1 <br> # End of Exim configuration file <br> ###ps  lissyara,       <br> <br> <br> <br> DBMail <br> dbmail.conf          <br> <code># (c) 2000-2006 IC&amp;S, The Netherlands <br> # <br> # Configuration file for DBMAIL <br> <br> [DBMAIL] <br> # <br> # Database settings <br> # <br> <br> # <br> # Supported drivers are mysql, pgsql, sqlite. <br> # <br> driver =pgsql <br> <br> # <br> # Supported drivers are sql, ldap. <br> # <br> authdriver =sql <br> <br> # <br> # Host for database, set to localhost if database is on <br> # the same host as dbmail and you want to use a local <br> # socket for connecting. <br> # <br> host =localhost <br> <br> # <br> # If you want to use TCP/IP for connecting to the database, <br> # and have the database running on a non-standard port. <br> # <br> sqlport =5432 <br> <br> # <br> # When using a local socket connection to the database, fill <br> # in the path to the socket here (eg /var/run/mysql.sock). <br> # <br> sqlsocket = <br> <br> # <br> # Database username. <br> # <br> user =dbmail <br> <br> # <br> # Database password. <br> # <br> pass =PasWoRd <br> <br> # <br> # Database name. <br> # <br> db =dbmail <br> <br> # <br> # Table prefix. Defaults to "dbmail_" if not specified. <br> # <br> table_prefix =dbmail_ <br> <br> # <br> # encoding must match the database/table encoding. <br> # ie latin1, utf8 <br> encoding = utf8 <br> <br> # <br> # messages with unknown encoding will be assumed to have <br> # default_msg_encoding <br> # ie iso8859-1, utf8 <br> default_msg_encoding = utf8 <br> <br> # <br> # Postmaster's email address for use in bounce messages. <br> # <br> #postmaster = DBMAIL-MAILER <br> <br> # <br> # Sendmail executable for forwards, replies, notifies, vacations. <br> # You may use pipes (|) in this command, for example: <br> # dos2unix|/usr/sbin/sendmail works well with Qmail. <br> # You may use quotes (") for executables with unusual names. <br> # <br> sendmail = /usr/sbin/sendmail <br> <br> # <br> # <br> # The following items can be overridden in the service-specific sections. <br> # <br> # <br> <br> # <br> # Trace level to send to syslog. Default is 2 (messages, errors, fatals). <br> # <br> TRACE_SYSLOG = 3 <br> <br> # <br> # Trace level to send to stderr. Default is 0 (fatals). <br> # <br> TRACE_STDERR = 1 <br> <br> # <br> # Root privs are used to open a port, then privs <br> # are dropped down to the user/group specified here. <br> # <br> EFFECTIVE_USER = dbmail <br> EFFECTIVE_GROUP = dbmail <br> <br> # <br> # The IP addresses the services will bind to. <br> # Use * for all local interfaces. <br> # Use 127.0.0.1 for localhost only. <br> # Separate multiple entries with spaces ( ) or commas (,). <br> # <br> BINDIP = * <br> <br> # <br> # Default number of child processes to start. <br> # <br> NCHILDREN = 2 <br> <br> # <br> # Maximum number of child processes allowed. <br> # <br> MAXCHILDREN = 10 <br> <br> # <br> # Unused children to always have availale. <br> # <br> MINSPARECHILDREN = 2 <br> <br> # <br> # Maximum unused children allowed to be active. <br> # <br> MAXSPARECHILDREN = 4 <br> <br> # <br> # Child process is restarted after handling this many connections. <br> # <br> MAXCONNECTS = 10000 <br> <br> # <br> # Child process will restart after this many connection errors. <br> # <br> MAX_ERRORS = 500 <br> <br> # <br> # Idle time allowed before a connection is shut off. <br> # <br> TIMEOUT = 300 <br> <br> # <br> # Idle time allowed before a connection is shut off if you have not logged in yet. <br> # <br> login_timeout = 60 <br> <br> # <br> # If yes, resolves IP addresses to DNS names when logging. <br> # <br> RESOLVE_IP = no <br> <br> # <br> # logfile for stdout messages <br> # <br> logfile = /var/log/dbmail.log <br> <br> # <br> # logfile for stderr messages <br> # <br> errorlog = /var/log/dbmail.err <br> <br> # <br> # directory for storing PID files <br> # <br> pid_directory = /var/run <br> <br> # <br> # directory for storing the daemon statefiles <br> # <br> state_directory = /var/run <br> <br> # <br> # directory for locating libraries (normally has a sane default compiled-in) <br> # <br> #library_directory = /usr/lib/dbmail <br> <br> [SMTP] <br> # In fact, there isn't anything here by default. <br> <br> [LMTP] <br> # <br> # Port to bind to. <br> # <br> PORT = 24 <br> <br> [POP] <br> # <br> # Port to bind to. <br> # <br> PORT = 110 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by POP3. <br> # This requires addition configuration of your MTA <br> # <br> POP_BEFORE_SMTP = no <br> <br> [IMAP] <br> <br> # <br> # Port to bind to. <br> # <br> PORT = 143 <br> <br> # <br> # IMAP prefers a longer timeout than other services. <br> # <br> TIMEOUT = 4000 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by IMAP. <br> # This requires addition configuration of your MTA <br> # <br> IMAP_BEFORE_SMTP = no <br> <br> # <br> # during IDLE, how many seconds between checking the mailbox <br> # status (default: 30) <br> # <br> # idle_timeout = 30 <br> <br> # <br> # Provide a CAPABILITY to override the default <br> # <br> # capability = IMAP4 IMAP4rev1 AUTH=LOGIN ACL NAMESPACE CHILDREN SORT QUOTA THREAD=ORDEREDSUBJECT UNSELECT IDLE <br> <br> [SIEVE] <br> # <br> # Port to bind to. <br> # <br> PORT = 2000 <br> <br> [LDAP] <br> PORT = 389 <br> VERSION = 3 <br> HOSTNAME = ldap <br> BASE_DN = ou=People,dc=mydomain,dc=com <br> <br> # <br> # If your LDAP library supports ldap_initialize(), then you can use the <br> # alternative LDAP server DSN like following. <br> # <br> # URI = ldap://127.0.0.1:389 <br> # URI = ldapi://%2fvar%2frun%2fopenldap%2fldapi/ <br> <br> # <br> # Leave blank for anonymous bind. <br> # example: cn=admin,dc=mydomain,dc=com <br> # <br> BIND_DN = <br> <br> # <br> # Leave blank for anonymous bind. <br> # <br> BIND_PW = <br> SCOPE = SubTree <br> USER_OBJECTCLASS = top,account,dbmailUser <br> FORW_OBJECTCLASS = top,account,dbmailForwardingAddress <br> CN_STRING = uid <br> FIELD_PASSWD = userPassword <br> FIELD_UID = uid <br> FIELD_NID = uidNumber <br> MIN_NID = 10000 <br> MAX_NID = 15000 <br> FIELD_CID = gidNumber <br> MIN_CID = 10000 <br> MAX_CID = 15000 <br> FIELD_MAIL = mail <br> FIELD_QUOTA = mailQuota <br> FIELD_FWDTARGET = mailForwardingAddress <br> <br> [DELIVERY] <br> # <br> # Run Sieve scripts as messages are delivered. <br> # <br> SIEVE = yes <br> <br> # <br> # Use 'user+mailbox@domain' format to deliver to a mailbox. <br> # <br> SUBADDRESS = yes <br> <br> # <br> # Turn on/off the Sieve Vacation extension. <br> # <br> SIEVE_VACATION = yes <br> <br> # <br> # Turn on/off the Sieve Notify extension <br> # <br> SIEVE_NOTIFY = yes <br> <br> # <br> # Turn on/off additional Sieve debugging. <br> # <br> SIEVE_DEBUG = no <br> <br> # <br> # Use the auto_notify table to send email notifications. <br> # <br> AUTO_NOTIFY = no <br> <br> # <br> # Use the auto_reply table to send away messages. <br> # <br> AUTO_REPLY = no <br> # <br> # Defaults to "NEW MAIL NOTIFICATION" <br> # <br> #AUTO_NOTIFY_SUBJECT = <br> <br> # <br> # Defaults to POSTMASTER from the DBMAIL section. <br> # <br> #AUTO_NOTIFY_SENDER = <br> <br> # <br> # If you set this to 'yes' dbmail will check for duplicate <br> # messages in the relevant mailbox during delivery using <br> # the Message-ID header <br> # <br> suppress_duplicates = no <br> <br> # end of configuration file <br> <br> <br></code> <br> <br> Spamassassin <br>    ,         ,          /etc/spamasassin,      ,       nobody <br> <br> local.cf <br> <code>rewrite_header Subject ***SPAM*** <br> report_safe 1 <br> trusted_networks 192.168/16 127/8 <br> # lock_method flock <br> required_score 5.0 <br> use_bayes 1 <br> bayes_auto_learn 1 <br> # bayes_ignore_header X-Bogosity <br> # bayes_ignore_header X-Spam-Flag <br> # bayes_ignore_header X-Spam-Status <br> auto_whitelist_path /etc/mail/spamassassin/auto_whitelist <br> bayes_path /etc/mail/spamassassin/bayes <br> bayes_file_mode 0666 <br> bayes_min_ham_num 1 <br> bayes_min_spam_num 1 <br> auto_learn_threshold_nonspam -2 <br> auto_learn_threshold_spam 5 <br> bayes_learn_to_journal 1 <br> skip_rbl_checks 0 <br> <br> ok_languages ru en <br> ok_locales ru en <br></code> <br> <br>    ..     <br> <code>/etc/init.d/exim start <br> /etc/init.d/spamd start <br> #    pop3      <br> /etc/init.d/dbmail-pop3d <br></code> <br> <br>     ,           <br> <code>rc-update add postgresql default <br> rc-update add exim default <br> rc-update add spamd default <br> rc-update add dbmail-pop3d default <br></code> <br> <br>          ,       <br> <code>dbmail-users -a admin@example.com -s admin@example.com -p plaintext -w 123123 <br></code> <br> <br>   ,        <br></code></code> <h2> <code><code><a href="http://njabl.org/"></a> <a href="http://www.spamcop.net/w3m%3Faction%3Dcheckblock%26ip%3D"></a> <font color="black">CREATE TYPE dtype AS ENUM ( <br> <font color="#A31515">'LOCAL'</font> , <br> <font color="#A31515">'VIRTUAL'</font> , <br> <font color="#A31515">'RELAY'</font> <br> ); <br> <br> ALTER TYPE <font color="#0000ff">public</font> .dtype OWNER TO dbmail; <br> <br> SET default_with_oids = <font color="#0000ff">true</font> ; <br> <br> CREATE TABLE dbmail_domains ( <br> uid integer NOT NULL, <br> domain character varying(128) NOT NULL, <br> type dtype NOT NULL <br> ); <br> <br> INSERT INTO dbmail_domains (uid, domain, type) VALUES (1, <font color="#A31515">'example.com'</font> , <font color="#A31515">'LOCAL'</font> );</font> <br>   . <br> <br> Exim <br> C   exim.conf <br> #!/bin/sh <br> ###################################################################### <br> # Runtime configuration file for Exim # <br> ###################################################################### <br> ####################################################################### <br> # MAIN CONFIGURATION SETTINGS # <br> ###################################################################### <br> <br> primary_hostname = example.com <br> domainlist local_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND \ <br> (type='LOCAL' OR type='VIRTUAL')}} <br> domainlist relay_to_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND type='RELAY'}} <br> hostlist relay_from_hosts = 127.0.0.1: localhost <br> auth_advertise_hosts = * <br> daemon_smtp_ports = 25 <br> log_selector = \ <br> +all_parents \ <br> +lost_incoming_connection \ <br> +received_sender \ <br> +received_recipients \ <br> +smtp_confirmation \ <br> +smtp_syntax_error \ <br> +smtp_protocol_error \ <br> -queue_run <br> acl_smtp_rcpt = acl_check_rcpt <br> acl_smtp_mime = acl_check_mime <br> acl_smtp_data = acl_check_content <br> qualify_domain = example.com <br> allow_domain_literals = false <br> exim_user = mail <br> exim_group = mail <br> never_users = root <br> host_lookup = * <br> #rfc1413_hosts = * <br> rfc1413_query_timeout = 0s <br> ignore_bounce_errors_after = 30m <br> timeout_frozen_after = 3d <br> freeze_tell = postmaster <br> <br> #av_scanner = clamd:/var/run/clamav/clamd.ctl #        <br> spamd_address = 127.0.0.1 783 <br> <br> message_size_limit = 10M <br> smtp_accept_max = 1000 <br> smtp_accept_max_per_connection = 150 <br> smtp_accept_max_per_host = 30 <br> split_spool_directory = true <br> remote_max_parallel = 15 <br> smtp_banner = "Welcome on our mail server!\n\ <br> This system does not accept Unsolicited \ <br> Commercial Email\nand will blacklist \ <br> offenders via our spam processor.\nHave a \ <br> nice day!\n\n${primary_hostname} ESMTP" <br> <br> hide pgsql_servers = localhost/dbmail/dbmail/PasSWorD <br> <br> ###################################################################### <br> # ACL CONFIGURATION # <br> # Specifies access control lists for incoming SMTP mail # <br> ###################################################################### <br> begin acl <br> <br> acl_check_rcpt: <br> <br> warn <br> set acl_m0 = 0s <br> warn <br> hosts = !+relay_from_hosts:!213.243.111.115/32 <br> set acl_m0 = 30s <br> warn <br> condition = ${if and {\ <br> {match{$sender_host_name}\ <br> {\N^[-az]*\d{0,3}[-az]*\.?[-az]*\d{0,3}[-az]*\.\w+$\N}} \ <br> {!eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 1s <br> <br> warn <br> condition = ${if and {\ <br> {match{$sender_helo_name}{\N^\w*\.\w{3}$\N}} \ <br> {eq{$acl_c1}{}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c2}{outblaze_domain}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if or {\ <br> {eq{$sender_address}{}} \ <br> {eq{$acl_m1}{0s}} \ <br> } {yes}{no}} <br> set acl_m0 = 0s <br> <br> warn <br> logwrite = Delay $acl_m0 for $sender_host_name \ <br> [$sender_host_address] with HELO=$sender_helo_name. \ <br> Mail from $sender_address to $local_part@$domain. <br> set acl_m1 = 0s <br> delay = $acl_m0 <br> <br> accept hosts = : <br> <br> deny domains = +local_domains <br> local_parts = ^[.] : ^.*[@%!/|] <br> <br> deny domains = !+local_domains <br> local_parts = ^[./|] : ^.*[@%!] : ^.*/\\.\\./ <br> <br> accept local_parts = postmaster <br> domains = +local_domains <br> <br> require verify = sender <br> <br> deny message = HELO/EHLO required by SMTP RFC <br> condition = ${if eq{$sender_helo_name}{}{yes}{no}} <br> <br> deny message = Go Away! You are spammer. <br> condition = ${if match{$sender_host_name} \ <br> {bezeqint\\.net|net\\.il|dialup|dsl|pool|peer|dhcp} \ <br> {yes}{no}} <br> <br> deny message = message from \ <br> $sender_host_address rejected - see njabl.org <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.njabl.org <br> <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dialups.mail-abuse.org <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = list.dsbl.org <br> deny message = Spam blocked see: \ <br> www.spamcop.net/w3m?action=checkblock&amp;ip=$sender_host_address <br> log_message = found in $dnslist_domain <br> dnslists = bl.spamcop.net <br> deny message = rejected, $sender_host_address \ <br> Open Proxy, see: $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.void.ru <br> <br> accept domains = +local_domains <br> endpass <br> message = unknown user <br> verify = recipient <br> <br> accept domains = +relay_to_domains <br> endpass <br> message = unrouteable address <br> verify = recipient <br> <br> accept hosts = +relay_from_hosts <br> accept authenticated = * <br> deny message = relay not permitted <br> <br> acl_check_mime: <br> <br> warn decode = default <br> <br> deny message = Blacklisted file extension detected ($mime_filename) <br> condition = ${if match \ <br> {${lc:$mime_filename}} \ <br> {\N(\.exe|\.pif|\.bat|\.scr|\.lnk|\.com|\.vbs|\.cpl)$\N} \ <br> {1}{0}} <br> <br> deny message = Sorry, noone speaks chinese here <br> condition = ${if eq{$mime_charset}{gb2312}{1}{0}} <br> <br> accept <br> <br> acl_check_content: <br> # deny message = Virus found ($malware_name) <br> # malware = * <br> <br> warn message = X-Spam-Score: $spam_score ($spam_bar) <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = X-Spam-Report: $spam_report <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = Subject: ***SPAM*** $h_Subject: <br> hosts = !+relay_from_hosts <br> spam = spamd <br> <br> deny message = This message scored $spam_score spam points. <br> spam = spamd:true <br> hosts = !+relay_from_hosts <br> condition = ${if &gt;{$spam_score_int}{120}{1}{0}} <br> <br> accept <br> <br> ###################################################################### <br> # ROUTERS CONFIGURATION # <br> # Specifies how addresses are handled # <br> ###################################################################### <br> # THE ORDER IN WHICH THE ROUTERS ARE DEFINED IS IMPORTANT! # <br> # An address is passed to each router in turn until it is accepted. # <br> ###################################################################### <br> <br> begin routers <br> <br> dnslookup: <br> driver = dnslookup <br> domains = ! +local_domains <br> transport = remote_smtp <br> ignore_target_hosts = 0.0.0.0 : 127.0.0.0/8 <br> no_more <br> <br> dbmailuser: <br> driver = accept <br> condition = ${lookup pgsql{SELECT alias_idnr FROM \ <br> dbmail_aliases WHERE \ <br> alias='${quote_pgsql:$local_part@$domain}' OR \ <br> alias='${quote_pgsql:@$domain}'}{yes}{no}} <br> transport = dbmail_delivery <br> <br> ###################################################################### <br> # TRANSPORTS CONFIGURATION # <br> ###################################################################### <br> # ORDER DOES NOT MATTER # <br> # Only one appropriate transport is called for each delivery. # <br> ###################################################################### <br> <br> begin transports <br> <br> remote_smtp: <br> driver = smtp <br> <br> dbmail_delivery: <br> driver = pipe <br> check_string = <br> command = /usr/sbin/dbmail-smtp -d ${pipe_addresses} <br> group = mail <br> message_prefix = "" <br> message_suffix = "" <br> path="/bin:/sbin:/usr/bin:/usr/sbin" <br> #   <br> address_pipe: <br> driver = pipe <br> return_output <br> <br> address_reply: <br> driver = autoreply <br> <br> ###################################################################### <br> # RETRY CONFIGURATION # <br> ###################################################################### <br> <br> begin retry <br> <br> * quota <br> * * F,2h,15m; G,16h,1h,1.5; F,4d,6h <br> <br> ###################################################################### <br> # REWRITE CONFIGURATION # <br> ###################################################################### <br> <br> begin rewrite <br> <br> ###################################################################### <br> # AUTHENTICATION CONFIGURATION # <br> ###################################################################### <br> <br> begin authenticators <br> <br> auth_plain: <br> driver = plaintext <br> public_name = PLAIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = : <br> server_set_id = $2 <br> <br> #    ,    . <br> auth_login: <br> driver = plaintext <br> public_name = LOGIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = Username:: : Password:: <br> server_set_id = $1 <br> <br> #    " " - TheBat! <br> auth_cram_md5: <br> driver = cram_md5 <br> public_name = CRAM-MD5 <br> server_secret = ${lookup pgsql{SELECT passwd FROM \ <br> dbmail_users WHERE userid \ <br> = '${quote_pgsql:$1}'}{$value}fail} <br> server_set_id = $1 <br> # End of Exim configuration file <br> ###ps  lissyara,       <br> <br> <br> <br> DBMail <br> dbmail.conf          <br> <code># (c) 2000-2006 IC&amp;S, The Netherlands <br> # <br> # Configuration file for DBMAIL <br> <br> [DBMAIL] <br> # <br> # Database settings <br> # <br> <br> # <br> # Supported drivers are mysql, pgsql, sqlite. <br> # <br> driver =pgsql <br> <br> # <br> # Supported drivers are sql, ldap. <br> # <br> authdriver =sql <br> <br> # <br> # Host for database, set to localhost if database is on <br> # the same host as dbmail and you want to use a local <br> # socket for connecting. <br> # <br> host =localhost <br> <br> # <br> # If you want to use TCP/IP for connecting to the database, <br> # and have the database running on a non-standard port. <br> # <br> sqlport =5432 <br> <br> # <br> # When using a local socket connection to the database, fill <br> # in the path to the socket here (eg /var/run/mysql.sock). <br> # <br> sqlsocket = <br> <br> # <br> # Database username. <br> # <br> user =dbmail <br> <br> # <br> # Database password. <br> # <br> pass =PasWoRd <br> <br> # <br> # Database name. <br> # <br> db =dbmail <br> <br> # <br> # Table prefix. Defaults to "dbmail_" if not specified. <br> # <br> table_prefix =dbmail_ <br> <br> # <br> # encoding must match the database/table encoding. <br> # ie latin1, utf8 <br> encoding = utf8 <br> <br> # <br> # messages with unknown encoding will be assumed to have <br> # default_msg_encoding <br> # ie iso8859-1, utf8 <br> default_msg_encoding = utf8 <br> <br> # <br> # Postmaster's email address for use in bounce messages. <br> # <br> #postmaster = DBMAIL-MAILER <br> <br> # <br> # Sendmail executable for forwards, replies, notifies, vacations. <br> # You may use pipes (|) in this command, for example: <br> # dos2unix|/usr/sbin/sendmail works well with Qmail. <br> # You may use quotes (") for executables with unusual names. <br> # <br> sendmail = /usr/sbin/sendmail <br> <br> # <br> # <br> # The following items can be overridden in the service-specific sections. <br> # <br> # <br> <br> # <br> # Trace level to send to syslog. Default is 2 (messages, errors, fatals). <br> # <br> TRACE_SYSLOG = 3 <br> <br> # <br> # Trace level to send to stderr. Default is 0 (fatals). <br> # <br> TRACE_STDERR = 1 <br> <br> # <br> # Root privs are used to open a port, then privs <br> # are dropped down to the user/group specified here. <br> # <br> EFFECTIVE_USER = dbmail <br> EFFECTIVE_GROUP = dbmail <br> <br> # <br> # The IP addresses the services will bind to. <br> # Use * for all local interfaces. <br> # Use 127.0.0.1 for localhost only. <br> # Separate multiple entries with spaces ( ) or commas (,). <br> # <br> BINDIP = * <br> <br> # <br> # Default number of child processes to start. <br> # <br> NCHILDREN = 2 <br> <br> # <br> # Maximum number of child processes allowed. <br> # <br> MAXCHILDREN = 10 <br> <br> # <br> # Unused children to always have availale. <br> # <br> MINSPARECHILDREN = 2 <br> <br> # <br> # Maximum unused children allowed to be active. <br> # <br> MAXSPARECHILDREN = 4 <br> <br> # <br> # Child process is restarted after handling this many connections. <br> # <br> MAXCONNECTS = 10000 <br> <br> # <br> # Child process will restart after this many connection errors. <br> # <br> MAX_ERRORS = 500 <br> <br> # <br> # Idle time allowed before a connection is shut off. <br> # <br> TIMEOUT = 300 <br> <br> # <br> # Idle time allowed before a connection is shut off if you have not logged in yet. <br> # <br> login_timeout = 60 <br> <br> # <br> # If yes, resolves IP addresses to DNS names when logging. <br> # <br> RESOLVE_IP = no <br> <br> # <br> # logfile for stdout messages <br> # <br> logfile = /var/log/dbmail.log <br> <br> # <br> # logfile for stderr messages <br> # <br> errorlog = /var/log/dbmail.err <br> <br> # <br> # directory for storing PID files <br> # <br> pid_directory = /var/run <br> <br> # <br> # directory for storing the daemon statefiles <br> # <br> state_directory = /var/run <br> <br> # <br> # directory for locating libraries (normally has a sane default compiled-in) <br> # <br> #library_directory = /usr/lib/dbmail <br> <br> [SMTP] <br> # In fact, there isn't anything here by default. <br> <br> [LMTP] <br> # <br> # Port to bind to. <br> # <br> PORT = 24 <br> <br> [POP] <br> # <br> # Port to bind to. <br> # <br> PORT = 110 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by POP3. <br> # This requires addition configuration of your MTA <br> # <br> POP_BEFORE_SMTP = no <br> <br> [IMAP] <br> <br> # <br> # Port to bind to. <br> # <br> PORT = 143 <br> <br> # <br> # IMAP prefers a longer timeout than other services. <br> # <br> TIMEOUT = 4000 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by IMAP. <br> # This requires addition configuration of your MTA <br> # <br> IMAP_BEFORE_SMTP = no <br> <br> # <br> # during IDLE, how many seconds between checking the mailbox <br> # status (default: 30) <br> # <br> # idle_timeout = 30 <br> <br> # <br> # Provide a CAPABILITY to override the default <br> # <br> # capability = IMAP4 IMAP4rev1 AUTH=LOGIN ACL NAMESPACE CHILDREN SORT QUOTA THREAD=ORDEREDSUBJECT UNSELECT IDLE <br> <br> [SIEVE] <br> # <br> # Port to bind to. <br> # <br> PORT = 2000 <br> <br> [LDAP] <br> PORT = 389 <br> VERSION = 3 <br> HOSTNAME = ldap <br> BASE_DN = ou=People,dc=mydomain,dc=com <br> <br> # <br> # If your LDAP library supports ldap_initialize(), then you can use the <br> # alternative LDAP server DSN like following. <br> # <br> # URI = ldap://127.0.0.1:389 <br> # URI = ldapi://%2fvar%2frun%2fopenldap%2fldapi/ <br> <br> # <br> # Leave blank for anonymous bind. <br> # example: cn=admin,dc=mydomain,dc=com <br> # <br> BIND_DN = <br> <br> # <br> # Leave blank for anonymous bind. <br> # <br> BIND_PW = <br> SCOPE = SubTree <br> USER_OBJECTCLASS = top,account,dbmailUser <br> FORW_OBJECTCLASS = top,account,dbmailForwardingAddress <br> CN_STRING = uid <br> FIELD_PASSWD = userPassword <br> FIELD_UID = uid <br> FIELD_NID = uidNumber <br> MIN_NID = 10000 <br> MAX_NID = 15000 <br> FIELD_CID = gidNumber <br> MIN_CID = 10000 <br> MAX_CID = 15000 <br> FIELD_MAIL = mail <br> FIELD_QUOTA = mailQuota <br> FIELD_FWDTARGET = mailForwardingAddress <br> <br> [DELIVERY] <br> # <br> # Run Sieve scripts as messages are delivered. <br> # <br> SIEVE = yes <br> <br> # <br> # Use 'user+mailbox@domain' format to deliver to a mailbox. <br> # <br> SUBADDRESS = yes <br> <br> # <br> # Turn on/off the Sieve Vacation extension. <br> # <br> SIEVE_VACATION = yes <br> <br> # <br> # Turn on/off the Sieve Notify extension <br> # <br> SIEVE_NOTIFY = yes <br> <br> # <br> # Turn on/off additional Sieve debugging. <br> # <br> SIEVE_DEBUG = no <br> <br> # <br> # Use the auto_notify table to send email notifications. <br> # <br> AUTO_NOTIFY = no <br> <br> # <br> # Use the auto_reply table to send away messages. <br> # <br> AUTO_REPLY = no <br> # <br> # Defaults to "NEW MAIL NOTIFICATION" <br> # <br> #AUTO_NOTIFY_SUBJECT = <br> <br> # <br> # Defaults to POSTMASTER from the DBMAIL section. <br> # <br> #AUTO_NOTIFY_SENDER = <br> <br> # <br> # If you set this to 'yes' dbmail will check for duplicate <br> # messages in the relevant mailbox during delivery using <br> # the Message-ID header <br> # <br> suppress_duplicates = no <br> <br> # end of configuration file <br> <br> <br></code> <br> <br> Spamassassin <br>    ,         ,          /etc/spamasassin,      ,       nobody <br> <br> local.cf <br> <code>rewrite_header Subject ***SPAM*** <br> report_safe 1 <br> trusted_networks 192.168/16 127/8 <br> # lock_method flock <br> required_score 5.0 <br> use_bayes 1 <br> bayes_auto_learn 1 <br> # bayes_ignore_header X-Bogosity <br> # bayes_ignore_header X-Spam-Flag <br> # bayes_ignore_header X-Spam-Status <br> auto_whitelist_path /etc/mail/spamassassin/auto_whitelist <br> bayes_path /etc/mail/spamassassin/bayes <br> bayes_file_mode 0666 <br> bayes_min_ham_num 1 <br> bayes_min_spam_num 1 <br> auto_learn_threshold_nonspam -2 <br> auto_learn_threshold_spam 5 <br> bayes_learn_to_journal 1 <br> skip_rbl_checks 0 <br> <br> ok_languages ru en <br> ok_locales ru en <br></code> <br> <br>    ..     <br> <code>/etc/init.d/exim start <br> /etc/init.d/spamd start <br> #    pop3      <br> /etc/init.d/dbmail-pop3d <br></code> <br> <br>     ,           <br> <code>rc-update add postgresql default <br> rc-update add exim default <br> rc-update add spamd default <br> rc-update add dbmail-pop3d default <br></code> <br> <br>          ,       <br> <code>dbmail-users -a admin@example.com -s admin@example.com -p plaintext -w 123123 <br></code> <br> <br>   ,        <br></code></code> </h2> <code><code><a href="http://njabl.org/"></a> <a href="http://www.spamcop.net/w3m%3Faction%3Dcheckblock%26ip%3D"></a> <font color="black">CREATE TYPE dtype AS ENUM ( <br> <font color="#A31515">'LOCAL'</font> , <br> <font color="#A31515">'VIRTUAL'</font> , <br> <font color="#A31515">'RELAY'</font> <br> ); <br> <br> ALTER TYPE <font color="#0000ff">public</font> .dtype OWNER TO dbmail; <br> <br> SET default_with_oids = <font color="#0000ff">true</font> ; <br> <br> CREATE TABLE dbmail_domains ( <br> uid integer NOT NULL, <br> domain character varying(128) NOT NULL, <br> type dtype NOT NULL <br> ); <br> <br> INSERT INTO dbmail_domains (uid, domain, type) VALUES (1, <font color="#A31515">'example.com'</font> , <font color="#A31515">'LOCAL'</font> );</font> <br>   . <br> <br> Exim <br> C   exim.conf <br> #!/bin/sh <br> ###################################################################### <br> # Runtime configuration file for Exim # <br> ###################################################################### <br> ####################################################################### <br> # MAIN CONFIGURATION SETTINGS # <br> ###################################################################### <br> <br> primary_hostname = example.com <br> domainlist local_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND \ <br> (type='LOCAL' OR type='VIRTUAL')}} <br> domainlist relay_to_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND type='RELAY'}} <br> hostlist relay_from_hosts = 127.0.0.1: localhost <br> auth_advertise_hosts = * <br> daemon_smtp_ports = 25 <br> log_selector = \ <br> +all_parents \ <br> +lost_incoming_connection \ <br> +received_sender \ <br> +received_recipients \ <br> +smtp_confirmation \ <br> +smtp_syntax_error \ <br> +smtp_protocol_error \ <br> -queue_run <br> acl_smtp_rcpt = acl_check_rcpt <br> acl_smtp_mime = acl_check_mime <br> acl_smtp_data = acl_check_content <br> qualify_domain = example.com <br> allow_domain_literals = false <br> exim_user = mail <br> exim_group = mail <br> never_users = root <br> host_lookup = * <br> #rfc1413_hosts = * <br> rfc1413_query_timeout = 0s <br> ignore_bounce_errors_after = 30m <br> timeout_frozen_after = 3d <br> freeze_tell = postmaster <br> <br> #av_scanner = clamd:/var/run/clamav/clamd.ctl #        <br> spamd_address = 127.0.0.1 783 <br> <br> message_size_limit = 10M <br> smtp_accept_max = 1000 <br> smtp_accept_max_per_connection = 150 <br> smtp_accept_max_per_host = 30 <br> split_spool_directory = true <br> remote_max_parallel = 15 <br> smtp_banner = "Welcome on our mail server!\n\ <br> This system does not accept Unsolicited \ <br> Commercial Email\nand will blacklist \ <br> offenders via our spam processor.\nHave a \ <br> nice day!\n\n${primary_hostname} ESMTP" <br> <br> hide pgsql_servers = localhost/dbmail/dbmail/PasSWorD <br> <br> ###################################################################### <br> # ACL CONFIGURATION # <br> # Specifies access control lists for incoming SMTP mail # <br> ###################################################################### <br> begin acl <br> <br> acl_check_rcpt: <br> <br> warn <br> set acl_m0 = 0s <br> warn <br> hosts = !+relay_from_hosts:!213.243.111.115/32 <br> set acl_m0 = 30s <br> warn <br> condition = ${if and {\ <br> {match{$sender_host_name}\ <br> {\N^[-az]*\d{0,3}[-az]*\.?[-az]*\d{0,3}[-az]*\.\w+$\N}} \ <br> {!eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 1s <br> <br> warn <br> condition = ${if and {\ <br> {match{$sender_helo_name}{\N^\w*\.\w{3}$\N}} \ <br> {eq{$acl_c1}{}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c2}{outblaze_domain}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if or {\ <br> {eq{$sender_address}{}} \ <br> {eq{$acl_m1}{0s}} \ <br> } {yes}{no}} <br> set acl_m0 = 0s <br> <br> warn <br> logwrite = Delay $acl_m0 for $sender_host_name \ <br> [$sender_host_address] with HELO=$sender_helo_name. \ <br> Mail from $sender_address to $local_part@$domain. <br> set acl_m1 = 0s <br> delay = $acl_m0 <br> <br> accept hosts = : <br> <br> deny domains = +local_domains <br> local_parts = ^[.] : ^.*[@%!/|] <br> <br> deny domains = !+local_domains <br> local_parts = ^[./|] : ^.*[@%!] : ^.*/\\.\\./ <br> <br> accept local_parts = postmaster <br> domains = +local_domains <br> <br> require verify = sender <br> <br> deny message = HELO/EHLO required by SMTP RFC <br> condition = ${if eq{$sender_helo_name}{}{yes}{no}} <br> <br> deny message = Go Away! You are spammer. <br> condition = ${if match{$sender_host_name} \ <br> {bezeqint\\.net|net\\.il|dialup|dsl|pool|peer|dhcp} \ <br> {yes}{no}} <br> <br> deny message = message from \ <br> $sender_host_address rejected - see njabl.org <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.njabl.org <br> <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dialups.mail-abuse.org <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = list.dsbl.org <br> deny message = Spam blocked see: \ <br> www.spamcop.net/w3m?action=checkblock&amp;ip=$sender_host_address <br> log_message = found in $dnslist_domain <br> dnslists = bl.spamcop.net <br> deny message = rejected, $sender_host_address \ <br> Open Proxy, see: $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.void.ru <br> <br> accept domains = +local_domains <br> endpass <br> message = unknown user <br> verify = recipient <br> <br> accept domains = +relay_to_domains <br> endpass <br> message = unrouteable address <br> verify = recipient <br> <br> accept hosts = +relay_from_hosts <br> accept authenticated = * <br> deny message = relay not permitted <br> <br> acl_check_mime: <br> <br> warn decode = default <br> <br> deny message = Blacklisted file extension detected ($mime_filename) <br> condition = ${if match \ <br> {${lc:$mime_filename}} \ <br> {\N(\.exe|\.pif|\.bat|\.scr|\.lnk|\.com|\.vbs|\.cpl)$\N} \ <br> {1}{0}} <br> <br> deny message = Sorry, noone speaks chinese here <br> condition = ${if eq{$mime_charset}{gb2312}{1}{0}} <br> <br> accept <br> <br> acl_check_content: <br> # deny message = Virus found ($malware_name) <br> # malware = * <br> <br> warn message = X-Spam-Score: $spam_score ($spam_bar) <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = X-Spam-Report: $spam_report <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = Subject: ***SPAM*** $h_Subject: <br> hosts = !+relay_from_hosts <br> spam = spamd <br> <br> deny message = This message scored $spam_score spam points. <br> spam = spamd:true <br> hosts = !+relay_from_hosts <br> condition = ${if &gt;{$spam_score_int}{120}{1}{0}} <br> <br> accept <br> <br> ###################################################################### <br> # ROUTERS CONFIGURATION # <br> # Specifies how addresses are handled # <br> ###################################################################### <br> # THE ORDER IN WHICH THE ROUTERS ARE DEFINED IS IMPORTANT! # <br> # An address is passed to each router in turn until it is accepted. # <br> ###################################################################### <br> <br> begin routers <br> <br> dnslookup: <br> driver = dnslookup <br> domains = ! +local_domains <br> transport = remote_smtp <br> ignore_target_hosts = 0.0.0.0 : 127.0.0.0/8 <br> no_more <br> <br> dbmailuser: <br> driver = accept <br> condition = ${lookup pgsql{SELECT alias_idnr FROM \ <br> dbmail_aliases WHERE \ <br> alias='${quote_pgsql:$local_part@$domain}' OR \ <br> alias='${quote_pgsql:@$domain}'}{yes}{no}} <br> transport = dbmail_delivery <br> <br> ###################################################################### <br> # TRANSPORTS CONFIGURATION # <br> ###################################################################### <br> # ORDER DOES NOT MATTER # <br> # Only one appropriate transport is called for each delivery. # <br> ###################################################################### <br> <br> begin transports <br> <br> remote_smtp: <br> driver = smtp <br> <br> dbmail_delivery: <br> driver = pipe <br> check_string = <br> command = /usr/sbin/dbmail-smtp -d ${pipe_addresses} <br> group = mail <br> message_prefix = "" <br> message_suffix = "" <br> path="/bin:/sbin:/usr/bin:/usr/sbin" <br> #   <br> address_pipe: <br> driver = pipe <br> return_output <br> <br> address_reply: <br> driver = autoreply <br> <br> ###################################################################### <br> # RETRY CONFIGURATION # <br> ###################################################################### <br> <br> begin retry <br> <br> * quota <br> * * F,2h,15m; G,16h,1h,1.5; F,4d,6h <br> <br> ###################################################################### <br> # REWRITE CONFIGURATION # <br> ###################################################################### <br> <br> begin rewrite <br> <br> ###################################################################### <br> # AUTHENTICATION CONFIGURATION # <br> ###################################################################### <br> <br> begin authenticators <br> <br> auth_plain: <br> driver = plaintext <br> public_name = PLAIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = : <br> server_set_id = $2 <br> <br> #    ,    . <br> auth_login: <br> driver = plaintext <br> public_name = LOGIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = Username:: : Password:: <br> server_set_id = $1 <br> <br> #    " " - TheBat! <br> auth_cram_md5: <br> driver = cram_md5 <br> public_name = CRAM-MD5 <br> server_secret = ${lookup pgsql{SELECT passwd FROM \ <br> dbmail_users WHERE userid \ <br> = '${quote_pgsql:$1}'}{$value}fail} <br> server_set_id = $1 <br> # End of Exim configuration file <br> ###ps  lissyara,       <br> <br> <br> <br> DBMail <br> dbmail.conf          <br> <code># (c) 2000-2006 IC&amp;S, The Netherlands <br> # <br> # Configuration file for DBMAIL <br> <br> [DBMAIL] <br> # <br> # Database settings <br> # <br> <br> # <br> # Supported drivers are mysql, pgsql, sqlite. <br> # <br> driver =pgsql <br> <br> # <br> # Supported drivers are sql, ldap. <br> # <br> authdriver =sql <br> <br> # <br> # Host for database, set to localhost if database is on <br> # the same host as dbmail and you want to use a local <br> # socket for connecting. <br> # <br> host =localhost <br> <br> # <br> # If you want to use TCP/IP for connecting to the database, <br> # and have the database running on a non-standard port. <br> # <br> sqlport =5432 <br> <br> # <br> # When using a local socket connection to the database, fill <br> # in the path to the socket here (eg /var/run/mysql.sock). <br> # <br> sqlsocket = <br> <br> # <br> # Database username. <br> # <br> user =dbmail <br> <br> # <br> # Database password. <br> # <br> pass =PasWoRd <br> <br> # <br> # Database name. <br> # <br> db =dbmail <br> <br> # <br> # Table prefix. Defaults to "dbmail_" if not specified. <br> # <br> table_prefix =dbmail_ <br> <br> # <br> # encoding must match the database/table encoding. <br> # ie latin1, utf8 <br> encoding = utf8 <br> <br> # <br> # messages with unknown encoding will be assumed to have <br> # default_msg_encoding <br> # ie iso8859-1, utf8 <br> default_msg_encoding = utf8 <br> <br> # <br> # Postmaster's email address for use in bounce messages. <br> # <br> #postmaster = DBMAIL-MAILER <br> <br> # <br> # Sendmail executable for forwards, replies, notifies, vacations. <br> # You may use pipes (|) in this command, for example: <br> # dos2unix|/usr/sbin/sendmail works well with Qmail. <br> # You may use quotes (") for executables with unusual names. <br> # <br> sendmail = /usr/sbin/sendmail <br> <br> # <br> # <br> # The following items can be overridden in the service-specific sections. <br> # <br> # <br> <br> # <br> # Trace level to send to syslog. Default is 2 (messages, errors, fatals). <br> # <br> TRACE_SYSLOG = 3 <br> <br> # <br> # Trace level to send to stderr. Default is 0 (fatals). <br> # <br> TRACE_STDERR = 1 <br> <br> # <br> # Root privs are used to open a port, then privs <br> # are dropped down to the user/group specified here. <br> # <br> EFFECTIVE_USER = dbmail <br> EFFECTIVE_GROUP = dbmail <br> <br> # <br> # The IP addresses the services will bind to. <br> # Use * for all local interfaces. <br> # Use 127.0.0.1 for localhost only. <br> # Separate multiple entries with spaces ( ) or commas (,). <br> # <br> BINDIP = * <br> <br> # <br> # Default number of child processes to start. <br> # <br> NCHILDREN = 2 <br> <br> # <br> # Maximum number of child processes allowed. <br> # <br> MAXCHILDREN = 10 <br> <br> # <br> # Unused children to always have availale. <br> # <br> MINSPARECHILDREN = 2 <br> <br> # <br> # Maximum unused children allowed to be active. <br> # <br> MAXSPARECHILDREN = 4 <br> <br> # <br> # Child process is restarted after handling this many connections. <br> # <br> MAXCONNECTS = 10000 <br> <br> # <br> # Child process will restart after this many connection errors. <br> # <br> MAX_ERRORS = 500 <br> <br> # <br> # Idle time allowed before a connection is shut off. <br> # <br> TIMEOUT = 300 <br> <br> # <br> # Idle time allowed before a connection is shut off if you have not logged in yet. <br> # <br> login_timeout = 60 <br> <br> # <br> # If yes, resolves IP addresses to DNS names when logging. <br> # <br> RESOLVE_IP = no <br> <br> # <br> # logfile for stdout messages <br> # <br> logfile = /var/log/dbmail.log <br> <br> # <br> # logfile for stderr messages <br> # <br> errorlog = /var/log/dbmail.err <br> <br> # <br> # directory for storing PID files <br> # <br> pid_directory = /var/run <br> <br> # <br> # directory for storing the daemon statefiles <br> # <br> state_directory = /var/run <br> <br> # <br> # directory for locating libraries (normally has a sane default compiled-in) <br> # <br> #library_directory = /usr/lib/dbmail <br> <br> [SMTP] <br> # In fact, there isn't anything here by default. <br> <br> [LMTP] <br> # <br> # Port to bind to. <br> # <br> PORT = 24 <br> <br> [POP] <br> # <br> # Port to bind to. <br> # <br> PORT = 110 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by POP3. <br> # This requires addition configuration of your MTA <br> # <br> POP_BEFORE_SMTP = no <br> <br> [IMAP] <br> <br> # <br> # Port to bind to. <br> # <br> PORT = 143 <br> <br> # <br> # IMAP prefers a longer timeout than other services. <br> # <br> TIMEOUT = 4000 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by IMAP. <br> # This requires addition configuration of your MTA <br> # <br> IMAP_BEFORE_SMTP = no <br> <br> # <br> # during IDLE, how many seconds between checking the mailbox <br> # status (default: 30) <br> # <br> # idle_timeout = 30 <br> <br> # <br> # Provide a CAPABILITY to override the default <br> # <br> # capability = IMAP4 IMAP4rev1 AUTH=LOGIN ACL NAMESPACE CHILDREN SORT QUOTA THREAD=ORDEREDSUBJECT UNSELECT IDLE <br> <br> [SIEVE] <br> # <br> # Port to bind to. <br> # <br> PORT = 2000 <br> <br> [LDAP] <br> PORT = 389 <br> VERSION = 3 <br> HOSTNAME = ldap <br> BASE_DN = ou=People,dc=mydomain,dc=com <br> <br> # <br> # If your LDAP library supports ldap_initialize(), then you can use the <br> # alternative LDAP server DSN like following. <br> # <br> # URI = ldap://127.0.0.1:389 <br> # URI = ldapi://%2fvar%2frun%2fopenldap%2fldapi/ <br> <br> # <br> # Leave blank for anonymous bind. <br> # example: cn=admin,dc=mydomain,dc=com <br> # <br> BIND_DN = <br> <br> # <br> # Leave blank for anonymous bind. <br> # <br> BIND_PW = <br> SCOPE = SubTree <br> USER_OBJECTCLASS = top,account,dbmailUser <br> FORW_OBJECTCLASS = top,account,dbmailForwardingAddress <br> CN_STRING = uid <br> FIELD_PASSWD = userPassword <br> FIELD_UID = uid <br> FIELD_NID = uidNumber <br> MIN_NID = 10000 <br> MAX_NID = 15000 <br> FIELD_CID = gidNumber <br> MIN_CID = 10000 <br> MAX_CID = 15000 <br> FIELD_MAIL = mail <br> FIELD_QUOTA = mailQuota <br> FIELD_FWDTARGET = mailForwardingAddress <br> <br> [DELIVERY] <br> # <br> # Run Sieve scripts as messages are delivered. <br> # <br> SIEVE = yes <br> <br> # <br> # Use 'user+mailbox@domain' format to deliver to a mailbox. <br> # <br> SUBADDRESS = yes <br> <br> # <br> # Turn on/off the Sieve Vacation extension. <br> # <br> SIEVE_VACATION = yes <br> <br> # <br> # Turn on/off the Sieve Notify extension <br> # <br> SIEVE_NOTIFY = yes <br> <br> # <br> # Turn on/off additional Sieve debugging. <br> # <br> SIEVE_DEBUG = no <br> <br> # <br> # Use the auto_notify table to send email notifications. <br> # <br> AUTO_NOTIFY = no <br> <br> # <br> # Use the auto_reply table to send away messages. <br> # <br> AUTO_REPLY = no <br> # <br> # Defaults to "NEW MAIL NOTIFICATION" <br> # <br> #AUTO_NOTIFY_SUBJECT = <br> <br> # <br> # Defaults to POSTMASTER from the DBMAIL section. <br> # <br> #AUTO_NOTIFY_SENDER = <br> <br> # <br> # If you set this to 'yes' dbmail will check for duplicate <br> # messages in the relevant mailbox during delivery using <br> # the Message-ID header <br> # <br> suppress_duplicates = no <br> <br> # end of configuration file <br> <br> <br></code> <br> <br> Spamassassin <br>    ,         ,          /etc/spamasassin,      ,       nobody <br> <br> local.cf <br> <code>rewrite_header Subject ***SPAM*** <br> report_safe 1 <br> trusted_networks 192.168/16 127/8 <br> # lock_method flock <br> required_score 5.0 <br> use_bayes 1 <br> bayes_auto_learn 1 <br> # bayes_ignore_header X-Bogosity <br> # bayes_ignore_header X-Spam-Flag <br> # bayes_ignore_header X-Spam-Status <br> auto_whitelist_path /etc/mail/spamassassin/auto_whitelist <br> bayes_path /etc/mail/spamassassin/bayes <br> bayes_file_mode 0666 <br> bayes_min_ham_num 1 <br> bayes_min_spam_num 1 <br> auto_learn_threshold_nonspam -2 <br> auto_learn_threshold_spam 5 <br> bayes_learn_to_journal 1 <br> skip_rbl_checks 0 <br> <br> ok_languages ru en <br> ok_locales ru en <br></code> <br> <br>    ..     <br> <code>/etc/init.d/exim start <br> /etc/init.d/spamd start <br> #    pop3      <br> /etc/init.d/dbmail-pop3d <br></code> <br> <br>     ,           <br> <code>rc-update add postgresql default <br> rc-update add exim default <br> rc-update add spamd default <br> rc-update add dbmail-pop3d default <br></code> <br> <br>          ,       <br> <code>dbmail-users -a admin@example.com -s admin@example.com -p plaintext -w 123123 <br></code> <br> <br>   ,        <br></code></code> <blockquote> <code><code><a href="http://njabl.org/"></a> <a href="http://www.spamcop.net/w3m%3Faction%3Dcheckblock%26ip%3D"></a> <font color="black">CREATE TYPE dtype AS ENUM ( <br> <font color="#A31515">'LOCAL'</font> , <br> <font color="#A31515">'VIRTUAL'</font> , <br> <font color="#A31515">'RELAY'</font> <br> ); <br> <br> ALTER TYPE <font color="#0000ff">public</font> .dtype OWNER TO dbmail; <br> <br> SET default_with_oids = <font color="#0000ff">true</font> ; <br> <br> CREATE TABLE dbmail_domains ( <br> uid integer NOT NULL, <br> domain character varying(128) NOT NULL, <br> type dtype NOT NULL <br> ); <br> <br> INSERT INTO dbmail_domains (uid, domain, type) VALUES (1, <font color="#A31515">'example.com'</font> , <font color="#A31515">'LOCAL'</font> );</font> <br>   . <br> <br> Exim <br> C   exim.conf <br> #!/bin/sh <br> ###################################################################### <br> # Runtime configuration file for Exim # <br> ###################################################################### <br> ####################################################################### <br> # MAIN CONFIGURATION SETTINGS # <br> ###################################################################### <br> <br> primary_hostname = example.com <br> domainlist local_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND \ <br> (type='LOCAL' OR type='VIRTUAL')}} <br> domainlist relay_to_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND type='RELAY'}} <br> hostlist relay_from_hosts = 127.0.0.1: localhost <br> auth_advertise_hosts = * <br> daemon_smtp_ports = 25 <br> log_selector = \ <br> +all_parents \ <br> +lost_incoming_connection \ <br> +received_sender \ <br> +received_recipients \ <br> +smtp_confirmation \ <br> +smtp_syntax_error \ <br> +smtp_protocol_error \ <br> -queue_run <br> acl_smtp_rcpt = acl_check_rcpt <br> acl_smtp_mime = acl_check_mime <br> acl_smtp_data = acl_check_content <br> qualify_domain = example.com <br> allow_domain_literals = false <br> exim_user = mail <br> exim_group = mail <br> never_users = root <br> host_lookup = * <br> #rfc1413_hosts = * <br> rfc1413_query_timeout = 0s <br> ignore_bounce_errors_after = 30m <br> timeout_frozen_after = 3d <br> freeze_tell = postmaster <br> <br> #av_scanner = clamd:/var/run/clamav/clamd.ctl #        <br> spamd_address = 127.0.0.1 783 <br> <br> message_size_limit = 10M <br> smtp_accept_max = 1000 <br> smtp_accept_max_per_connection = 150 <br> smtp_accept_max_per_host = 30 <br> split_spool_directory = true <br> remote_max_parallel = 15 <br> smtp_banner = "Welcome on our mail server!\n\ <br> This system does not accept Unsolicited \ <br> Commercial Email\nand will blacklist \ <br> offenders via our spam processor.\nHave a \ <br> nice day!\n\n${primary_hostname} ESMTP" <br> <br> hide pgsql_servers = localhost/dbmail/dbmail/PasSWorD <br> <br> ###################################################################### <br> # ACL CONFIGURATION # <br> # Specifies access control lists for incoming SMTP mail # <br> ###################################################################### <br> begin acl <br> <br> acl_check_rcpt: <br> <br> warn <br> set acl_m0 = 0s <br> warn <br> hosts = !+relay_from_hosts:!213.243.111.115/32 <br> set acl_m0 = 30s <br> warn <br> condition = ${if and {\ <br> {match{$sender_host_name}\ <br> {\N^[-az]*\d{0,3}[-az]*\.?[-az]*\d{0,3}[-az]*\.\w+$\N}} \ <br> {!eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 1s <br> <br> warn <br> condition = ${if and {\ <br> {match{$sender_helo_name}{\N^\w*\.\w{3}$\N}} \ <br> {eq{$acl_c1}{}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c2}{outblaze_domain}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if or {\ <br> {eq{$sender_address}{}} \ <br> {eq{$acl_m1}{0s}} \ <br> } {yes}{no}} <br> set acl_m0 = 0s <br> <br> warn <br> logwrite = Delay $acl_m0 for $sender_host_name \ <br> [$sender_host_address] with HELO=$sender_helo_name. \ <br> Mail from $sender_address to $local_part@$domain. <br> set acl_m1 = 0s <br> delay = $acl_m0 <br> <br> accept hosts = : <br> <br> deny domains = +local_domains <br> local_parts = ^[.] : ^.*[@%!/|] <br> <br> deny domains = !+local_domains <br> local_parts = ^[./|] : ^.*[@%!] : ^.*/\\.\\./ <br> <br> accept local_parts = postmaster <br> domains = +local_domains <br> <br> require verify = sender <br> <br> deny message = HELO/EHLO required by SMTP RFC <br> condition = ${if eq{$sender_helo_name}{}{yes}{no}} <br> <br> deny message = Go Away! You are spammer. <br> condition = ${if match{$sender_host_name} \ <br> {bezeqint\\.net|net\\.il|dialup|dsl|pool|peer|dhcp} \ <br> {yes}{no}} <br> <br> deny message = message from \ <br> $sender_host_address rejected - see njabl.org <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.njabl.org <br> <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dialups.mail-abuse.org <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = list.dsbl.org <br> deny message = Spam blocked see: \ <br> www.spamcop.net/w3m?action=checkblock&amp;ip=$sender_host_address <br> log_message = found in $dnslist_domain <br> dnslists = bl.spamcop.net <br> deny message = rejected, $sender_host_address \ <br> Open Proxy, see: $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.void.ru <br> <br> accept domains = +local_domains <br> endpass <br> message = unknown user <br> verify = recipient <br> <br> accept domains = +relay_to_domains <br> endpass <br> message = unrouteable address <br> verify = recipient <br> <br> accept hosts = +relay_from_hosts <br> accept authenticated = * <br> deny message = relay not permitted <br> <br> acl_check_mime: <br> <br> warn decode = default <br> <br> deny message = Blacklisted file extension detected ($mime_filename) <br> condition = ${if match \ <br> {${lc:$mime_filename}} \ <br> {\N(\.exe|\.pif|\.bat|\.scr|\.lnk|\.com|\.vbs|\.cpl)$\N} \ <br> {1}{0}} <br> <br> deny message = Sorry, noone speaks chinese here <br> condition = ${if eq{$mime_charset}{gb2312}{1}{0}} <br> <br> accept <br> <br> acl_check_content: <br> # deny message = Virus found ($malware_name) <br> # malware = * <br> <br> warn message = X-Spam-Score: $spam_score ($spam_bar) <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = X-Spam-Report: $spam_report <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = Subject: ***SPAM*** $h_Subject: <br> hosts = !+relay_from_hosts <br> spam = spamd <br> <br> deny message = This message scored $spam_score spam points. <br> spam = spamd:true <br> hosts = !+relay_from_hosts <br> condition = ${if &gt;{$spam_score_int}{120}{1}{0}} <br> <br> accept <br> <br> ###################################################################### <br> # ROUTERS CONFIGURATION # <br> # Specifies how addresses are handled # <br> ###################################################################### <br> # THE ORDER IN WHICH THE ROUTERS ARE DEFINED IS IMPORTANT! # <br> # An address is passed to each router in turn until it is accepted. # <br> ###################################################################### <br> <br> begin routers <br> <br> dnslookup: <br> driver = dnslookup <br> domains = ! +local_domains <br> transport = remote_smtp <br> ignore_target_hosts = 0.0.0.0 : 127.0.0.0/8 <br> no_more <br> <br> dbmailuser: <br> driver = accept <br> condition = ${lookup pgsql{SELECT alias_idnr FROM \ <br> dbmail_aliases WHERE \ <br> alias='${quote_pgsql:$local_part@$domain}' OR \ <br> alias='${quote_pgsql:@$domain}'}{yes}{no}} <br> transport = dbmail_delivery <br> <br> ###################################################################### <br> # TRANSPORTS CONFIGURATION # <br> ###################################################################### <br> # ORDER DOES NOT MATTER # <br> # Only one appropriate transport is called for each delivery. # <br> ###################################################################### <br> <br> begin transports <br> <br> remote_smtp: <br> driver = smtp <br> <br> dbmail_delivery: <br> driver = pipe <br> check_string = <br> command = /usr/sbin/dbmail-smtp -d ${pipe_addresses} <br> group = mail <br> message_prefix = "" <br> message_suffix = "" <br> path="/bin:/sbin:/usr/bin:/usr/sbin" <br> #   <br> address_pipe: <br> driver = pipe <br> return_output <br> <br> address_reply: <br> driver = autoreply <br> <br> ###################################################################### <br> # RETRY CONFIGURATION # <br> ###################################################################### <br> <br> begin retry <br> <br> * quota <br> * * F,2h,15m; G,16h,1h,1.5; F,4d,6h <br> <br> ###################################################################### <br> # REWRITE CONFIGURATION # <br> ###################################################################### <br> <br> begin rewrite <br> <br> ###################################################################### <br> # AUTHENTICATION CONFIGURATION # <br> ###################################################################### <br> <br> begin authenticators <br> <br> auth_plain: <br> driver = plaintext <br> public_name = PLAIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = : <br> server_set_id = $2 <br> <br> #    ,    . <br> auth_login: <br> driver = plaintext <br> public_name = LOGIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = Username:: : Password:: <br> server_set_id = $1 <br> <br> #    " " - TheBat! <br> auth_cram_md5: <br> driver = cram_md5 <br> public_name = CRAM-MD5 <br> server_secret = ${lookup pgsql{SELECT passwd FROM \ <br> dbmail_users WHERE userid \ <br> = '${quote_pgsql:$1}'}{$value}fail} <br> server_set_id = $1 <br> # End of Exim configuration file <br> ###ps  lissyara,       <br> <br> <br> <br> DBMail <br> dbmail.conf          <br> <code># (c) 2000-2006 IC&amp;S, The Netherlands <br> # <br> # Configuration file for DBMAIL <br> <br> [DBMAIL] <br> # <br> # Database settings <br> # <br> <br> # <br> # Supported drivers are mysql, pgsql, sqlite. <br> # <br> driver =pgsql <br> <br> # <br> # Supported drivers are sql, ldap. <br> # <br> authdriver =sql <br> <br> # <br> # Host for database, set to localhost if database is on <br> # the same host as dbmail and you want to use a local <br> # socket for connecting. <br> # <br> host =localhost <br> <br> # <br> # If you want to use TCP/IP for connecting to the database, <br> # and have the database running on a non-standard port. <br> # <br> sqlport =5432 <br> <br> # <br> # When using a local socket connection to the database, fill <br> # in the path to the socket here (eg /var/run/mysql.sock). <br> # <br> sqlsocket = <br> <br> # <br> # Database username. <br> # <br> user =dbmail <br> <br> # <br> # Database password. <br> # <br> pass =PasWoRd <br> <br> # <br> # Database name. <br> # <br> db =dbmail <br> <br> # <br> # Table prefix. Defaults to "dbmail_" if not specified. <br> # <br> table_prefix =dbmail_ <br> <br> # <br> # encoding must match the database/table encoding. <br> # ie latin1, utf8 <br> encoding = utf8 <br> <br> # <br> # messages with unknown encoding will be assumed to have <br> # default_msg_encoding <br> # ie iso8859-1, utf8 <br> default_msg_encoding = utf8 <br> <br> # <br> # Postmaster's email address for use in bounce messages. <br> # <br> #postmaster = DBMAIL-MAILER <br> <br> # <br> # Sendmail executable for forwards, replies, notifies, vacations. <br> # You may use pipes (|) in this command, for example: <br> # dos2unix|/usr/sbin/sendmail works well with Qmail. <br> # You may use quotes (") for executables with unusual names. <br> # <br> sendmail = /usr/sbin/sendmail <br> <br> # <br> # <br> # The following items can be overridden in the service-specific sections. <br> # <br> # <br> <br> # <br> # Trace level to send to syslog. Default is 2 (messages, errors, fatals). <br> # <br> TRACE_SYSLOG = 3 <br> <br> # <br> # Trace level to send to stderr. Default is 0 (fatals). <br> # <br> TRACE_STDERR = 1 <br> <br> # <br> # Root privs are used to open a port, then privs <br> # are dropped down to the user/group specified here. <br> # <br> EFFECTIVE_USER = dbmail <br> EFFECTIVE_GROUP = dbmail <br> <br> # <br> # The IP addresses the services will bind to. <br> # Use * for all local interfaces. <br> # Use 127.0.0.1 for localhost only. <br> # Separate multiple entries with spaces ( ) or commas (,). <br> # <br> BINDIP = * <br> <br> # <br> # Default number of child processes to start. <br> # <br> NCHILDREN = 2 <br> <br> # <br> # Maximum number of child processes allowed. <br> # <br> MAXCHILDREN = 10 <br> <br> # <br> # Unused children to always have availale. <br> # <br> MINSPARECHILDREN = 2 <br> <br> # <br> # Maximum unused children allowed to be active. <br> # <br> MAXSPARECHILDREN = 4 <br> <br> # <br> # Child process is restarted after handling this many connections. <br> # <br> MAXCONNECTS = 10000 <br> <br> # <br> # Child process will restart after this many connection errors. <br> # <br> MAX_ERRORS = 500 <br> <br> # <br> # Idle time allowed before a connection is shut off. <br> # <br> TIMEOUT = 300 <br> <br> # <br> # Idle time allowed before a connection is shut off if you have not logged in yet. <br> # <br> login_timeout = 60 <br> <br> # <br> # If yes, resolves IP addresses to DNS names when logging. <br> # <br> RESOLVE_IP = no <br> <br> # <br> # logfile for stdout messages <br> # <br> logfile = /var/log/dbmail.log <br> <br> # <br> # logfile for stderr messages <br> # <br> errorlog = /var/log/dbmail.err <br> <br> # <br> # directory for storing PID files <br> # <br> pid_directory = /var/run <br> <br> # <br> # directory for storing the daemon statefiles <br> # <br> state_directory = /var/run <br> <br> # <br> # directory for locating libraries (normally has a sane default compiled-in) <br> # <br> #library_directory = /usr/lib/dbmail <br> <br> [SMTP] <br> # In fact, there isn't anything here by default. <br> <br> [LMTP] <br> # <br> # Port to bind to. <br> # <br> PORT = 24 <br> <br> [POP] <br> # <br> # Port to bind to. <br> # <br> PORT = 110 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by POP3. <br> # This requires addition configuration of your MTA <br> # <br> POP_BEFORE_SMTP = no <br> <br> [IMAP] <br> <br> # <br> # Port to bind to. <br> # <br> PORT = 143 <br> <br> # <br> # IMAP prefers a longer timeout than other services. <br> # <br> TIMEOUT = 4000 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by IMAP. <br> # This requires addition configuration of your MTA <br> # <br> IMAP_BEFORE_SMTP = no <br> <br> # <br> # during IDLE, how many seconds between checking the mailbox <br> # status (default: 30) <br> # <br> # idle_timeout = 30 <br> <br> # <br> # Provide a CAPABILITY to override the default <br> # <br> # capability = IMAP4 IMAP4rev1 AUTH=LOGIN ACL NAMESPACE CHILDREN SORT QUOTA THREAD=ORDEREDSUBJECT UNSELECT IDLE <br> <br> [SIEVE] <br> # <br> # Port to bind to. <br> # <br> PORT = 2000 <br> <br> [LDAP] <br> PORT = 389 <br> VERSION = 3 <br> HOSTNAME = ldap <br> BASE_DN = ou=People,dc=mydomain,dc=com <br> <br> # <br> # If your LDAP library supports ldap_initialize(), then you can use the <br> # alternative LDAP server DSN like following. <br> # <br> # URI = ldap://127.0.0.1:389 <br> # URI = ldapi://%2fvar%2frun%2fopenldap%2fldapi/ <br> <br> # <br> # Leave blank for anonymous bind. <br> # example: cn=admin,dc=mydomain,dc=com <br> # <br> BIND_DN = <br> <br> # <br> # Leave blank for anonymous bind. <br> # <br> BIND_PW = <br> SCOPE = SubTree <br> USER_OBJECTCLASS = top,account,dbmailUser <br> FORW_OBJECTCLASS = top,account,dbmailForwardingAddress <br> CN_STRING = uid <br> FIELD_PASSWD = userPassword <br> FIELD_UID = uid <br> FIELD_NID = uidNumber <br> MIN_NID = 10000 <br> MAX_NID = 15000 <br> FIELD_CID = gidNumber <br> MIN_CID = 10000 <br> MAX_CID = 15000 <br> FIELD_MAIL = mail <br> FIELD_QUOTA = mailQuota <br> FIELD_FWDTARGET = mailForwardingAddress <br> <br> [DELIVERY] <br> # <br> # Run Sieve scripts as messages are delivered. <br> # <br> SIEVE = yes <br> <br> # <br> # Use 'user+mailbox@domain' format to deliver to a mailbox. <br> # <br> SUBADDRESS = yes <br> <br> # <br> # Turn on/off the Sieve Vacation extension. <br> # <br> SIEVE_VACATION = yes <br> <br> # <br> # Turn on/off the Sieve Notify extension <br> # <br> SIEVE_NOTIFY = yes <br> <br> # <br> # Turn on/off additional Sieve debugging. <br> # <br> SIEVE_DEBUG = no <br> <br> # <br> # Use the auto_notify table to send email notifications. <br> # <br> AUTO_NOTIFY = no <br> <br> # <br> # Use the auto_reply table to send away messages. <br> # <br> AUTO_REPLY = no <br> # <br> # Defaults to "NEW MAIL NOTIFICATION" <br> # <br> #AUTO_NOTIFY_SUBJECT = <br> <br> # <br> # Defaults to POSTMASTER from the DBMAIL section. <br> # <br> #AUTO_NOTIFY_SENDER = <br> <br> # <br> # If you set this to 'yes' dbmail will check for duplicate <br> # messages in the relevant mailbox during delivery using <br> # the Message-ID header <br> # <br> suppress_duplicates = no <br> <br> # end of configuration file <br> <br> <br></code> <br> <br> Spamassassin <br>    ,         ,          /etc/spamasassin,      ,       nobody <br> <br> local.cf <br> <code>rewrite_header Subject ***SPAM*** <br> report_safe 1 <br> trusted_networks 192.168/16 127/8 <br> # lock_method flock <br> required_score 5.0 <br> use_bayes 1 <br> bayes_auto_learn 1 <br> # bayes_ignore_header X-Bogosity <br> # bayes_ignore_header X-Spam-Flag <br> # bayes_ignore_header X-Spam-Status <br> auto_whitelist_path /etc/mail/spamassassin/auto_whitelist <br> bayes_path /etc/mail/spamassassin/bayes <br> bayes_file_mode 0666 <br> bayes_min_ham_num 1 <br> bayes_min_spam_num 1 <br> auto_learn_threshold_nonspam -2 <br> auto_learn_threshold_spam 5 <br> bayes_learn_to_journal 1 <br> skip_rbl_checks 0 <br> <br> ok_languages ru en <br> ok_locales ru en <br></code> <br> <br>    ..     <br> <code>/etc/init.d/exim start <br> /etc/init.d/spamd start <br> #    pop3      <br> /etc/init.d/dbmail-pop3d <br></code> <br> <br>     ,           <br> <code>rc-update add postgresql default <br> rc-update add exim default <br> rc-update add spamd default <br> rc-update add dbmail-pop3d default <br></code> <br> <br>          ,       <br> <code>dbmail-users -a admin@example.com -s admin@example.com -p plaintext -w 123123 <br></code> <br> <br>   ,        <br></code></code> </blockquote> <code><code><a href="http://njabl.org/"></a> <a href="http://www.spamcop.net/w3m%3Faction%3Dcheckblock%26ip%3D"></a> <font color="black">CREATE TYPE dtype AS ENUM ( <br> <font color="#A31515">'LOCAL'</font> , <br> <font color="#A31515">'VIRTUAL'</font> , <br> <font color="#A31515">'RELAY'</font> <br> ); <br> <br> ALTER TYPE <font color="#0000ff">public</font> .dtype OWNER TO dbmail; <br> <br> SET default_with_oids = <font color="#0000ff">true</font> ; <br> <br> CREATE TABLE dbmail_domains ( <br> uid integer NOT NULL, <br> domain character varying(128) NOT NULL, <br> type dtype NOT NULL <br> ); <br> <br> INSERT INTO dbmail_domains (uid, domain, type) VALUES (1, <font color="#A31515">'example.com'</font> , <font color="#A31515">'LOCAL'</font> );</font> <br>   . <br> <br> Exim <br> C   exim.conf <br> #!/bin/sh <br> ###################################################################### <br> # Runtime configuration file for Exim # <br> ###################################################################### <br> ####################################################################### <br> # MAIN CONFIGURATION SETTINGS # <br> ###################################################################### <br> <br> primary_hostname = example.com <br> domainlist local_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND \ <br> (type='LOCAL' OR type='VIRTUAL')}} <br> domainlist relay_to_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND type='RELAY'}} <br> hostlist relay_from_hosts = 127.0.0.1: localhost <br> auth_advertise_hosts = * <br> daemon_smtp_ports = 25 <br> log_selector = \ <br> +all_parents \ <br> +lost_incoming_connection \ <br> +received_sender \ <br> +received_recipients \ <br> +smtp_confirmation \ <br> +smtp_syntax_error \ <br> +smtp_protocol_error \ <br> -queue_run <br> acl_smtp_rcpt = acl_check_rcpt <br> acl_smtp_mime = acl_check_mime <br> acl_smtp_data = acl_check_content <br> qualify_domain = example.com <br> allow_domain_literals = false <br> exim_user = mail <br> exim_group = mail <br> never_users = root <br> host_lookup = * <br> #rfc1413_hosts = * <br> rfc1413_query_timeout = 0s <br> ignore_bounce_errors_after = 30m <br> timeout_frozen_after = 3d <br> freeze_tell = postmaster <br> <br> #av_scanner = clamd:/var/run/clamav/clamd.ctl #        <br> spamd_address = 127.0.0.1 783 <br> <br> message_size_limit = 10M <br> smtp_accept_max = 1000 <br> smtp_accept_max_per_connection = 150 <br> smtp_accept_max_per_host = 30 <br> split_spool_directory = true <br> remote_max_parallel = 15 <br> smtp_banner = "Welcome on our mail server!\n\ <br> This system does not accept Unsolicited \ <br> Commercial Email\nand will blacklist \ <br> offenders via our spam processor.\nHave a \ <br> nice day!\n\n${primary_hostname} ESMTP" <br> <br> hide pgsql_servers = localhost/dbmail/dbmail/PasSWorD <br> <br> ###################################################################### <br> # ACL CONFIGURATION # <br> # Specifies access control lists for incoming SMTP mail # <br> ###################################################################### <br> begin acl <br> <br> acl_check_rcpt: <br> <br> warn <br> set acl_m0 = 0s <br> warn <br> hosts = !+relay_from_hosts:!213.243.111.115/32 <br> set acl_m0 = 30s <br> warn <br> condition = ${if and {\ <br> {match{$sender_host_name}\ <br> {\N^[-az]*\d{0,3}[-az]*\.?[-az]*\d{0,3}[-az]*\.\w+$\N}} \ <br> {!eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 1s <br> <br> warn <br> condition = ${if and {\ <br> {match{$sender_helo_name}{\N^\w*\.\w{3}$\N}} \ <br> {eq{$acl_c1}{}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c2}{outblaze_domain}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if or {\ <br> {eq{$sender_address}{}} \ <br> {eq{$acl_m1}{0s}} \ <br> } {yes}{no}} <br> set acl_m0 = 0s <br> <br> warn <br> logwrite = Delay $acl_m0 for $sender_host_name \ <br> [$sender_host_address] with HELO=$sender_helo_name. \ <br> Mail from $sender_address to $local_part@$domain. <br> set acl_m1 = 0s <br> delay = $acl_m0 <br> <br> accept hosts = : <br> <br> deny domains = +local_domains <br> local_parts = ^[.] : ^.*[@%!/|] <br> <br> deny domains = !+local_domains <br> local_parts = ^[./|] : ^.*[@%!] : ^.*/\\.\\./ <br> <br> accept local_parts = postmaster <br> domains = +local_domains <br> <br> require verify = sender <br> <br> deny message = HELO/EHLO required by SMTP RFC <br> condition = ${if eq{$sender_helo_name}{}{yes}{no}} <br> <br> deny message = Go Away! You are spammer. <br> condition = ${if match{$sender_host_name} \ <br> {bezeqint\\.net|net\\.il|dialup|dsl|pool|peer|dhcp} \ <br> {yes}{no}} <br> <br> deny message = message from \ <br> $sender_host_address rejected - see njabl.org <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.njabl.org <br> <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dialups.mail-abuse.org <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = list.dsbl.org <br> deny message = Spam blocked see: \ <br> www.spamcop.net/w3m?action=checkblock&amp;ip=$sender_host_address <br> log_message = found in $dnslist_domain <br> dnslists = bl.spamcop.net <br> deny message = rejected, $sender_host_address \ <br> Open Proxy, see: $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.void.ru <br> <br> accept domains = +local_domains <br> endpass <br> message = unknown user <br> verify = recipient <br> <br> accept domains = +relay_to_domains <br> endpass <br> message = unrouteable address <br> verify = recipient <br> <br> accept hosts = +relay_from_hosts <br> accept authenticated = * <br> deny message = relay not permitted <br> <br> acl_check_mime: <br> <br> warn decode = default <br> <br> deny message = Blacklisted file extension detected ($mime_filename) <br> condition = ${if match \ <br> {${lc:$mime_filename}} \ <br> {\N(\.exe|\.pif|\.bat|\.scr|\.lnk|\.com|\.vbs|\.cpl)$\N} \ <br> {1}{0}} <br> <br> deny message = Sorry, noone speaks chinese here <br> condition = ${if eq{$mime_charset}{gb2312}{1}{0}} <br> <br> accept <br> <br> acl_check_content: <br> # deny message = Virus found ($malware_name) <br> # malware = * <br> <br> warn message = X-Spam-Score: $spam_score ($spam_bar) <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = X-Spam-Report: $spam_report <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = Subject: ***SPAM*** $h_Subject: <br> hosts = !+relay_from_hosts <br> spam = spamd <br> <br> deny message = This message scored $spam_score spam points. <br> spam = spamd:true <br> hosts = !+relay_from_hosts <br> condition = ${if &gt;{$spam_score_int}{120}{1}{0}} <br> <br> accept <br> <br> ###################################################################### <br> # ROUTERS CONFIGURATION # <br> # Specifies how addresses are handled # <br> ###################################################################### <br> # THE ORDER IN WHICH THE ROUTERS ARE DEFINED IS IMPORTANT! # <br> # An address is passed to each router in turn until it is accepted. # <br> ###################################################################### <br> <br> begin routers <br> <br> dnslookup: <br> driver = dnslookup <br> domains = ! +local_domains <br> transport = remote_smtp <br> ignore_target_hosts = 0.0.0.0 : 127.0.0.0/8 <br> no_more <br> <br> dbmailuser: <br> driver = accept <br> condition = ${lookup pgsql{SELECT alias_idnr FROM \ <br> dbmail_aliases WHERE \ <br> alias='${quote_pgsql:$local_part@$domain}' OR \ <br> alias='${quote_pgsql:@$domain}'}{yes}{no}} <br> transport = dbmail_delivery <br> <br> ###################################################################### <br> # TRANSPORTS CONFIGURATION # <br> ###################################################################### <br> # ORDER DOES NOT MATTER # <br> # Only one appropriate transport is called for each delivery. # <br> ###################################################################### <br> <br> begin transports <br> <br> remote_smtp: <br> driver = smtp <br> <br> dbmail_delivery: <br> driver = pipe <br> check_string = <br> command = /usr/sbin/dbmail-smtp -d ${pipe_addresses} <br> group = mail <br> message_prefix = "" <br> message_suffix = "" <br> path="/bin:/sbin:/usr/bin:/usr/sbin" <br> #   <br> address_pipe: <br> driver = pipe <br> return_output <br> <br> address_reply: <br> driver = autoreply <br> <br> ###################################################################### <br> # RETRY CONFIGURATION # <br> ###################################################################### <br> <br> begin retry <br> <br> * quota <br> * * F,2h,15m; G,16h,1h,1.5; F,4d,6h <br> <br> ###################################################################### <br> # REWRITE CONFIGURATION # <br> ###################################################################### <br> <br> begin rewrite <br> <br> ###################################################################### <br> # AUTHENTICATION CONFIGURATION # <br> ###################################################################### <br> <br> begin authenticators <br> <br> auth_plain: <br> driver = plaintext <br> public_name = PLAIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = : <br> server_set_id = $2 <br> <br> #    ,    . <br> auth_login: <br> driver = plaintext <br> public_name = LOGIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = Username:: : Password:: <br> server_set_id = $1 <br> <br> #    " " - TheBat! <br> auth_cram_md5: <br> driver = cram_md5 <br> public_name = CRAM-MD5 <br> server_secret = ${lookup pgsql{SELECT passwd FROM \ <br> dbmail_users WHERE userid \ <br> = '${quote_pgsql:$1}'}{$value}fail} <br> server_set_id = $1 <br> # End of Exim configuration file <br> ###ps  lissyara,       <br> <br></code> <br> <br> DBMail <br> dbmail.conf          <br> <code># (c) 2000-2006 IC&amp;S, The Netherlands <br> # <br> # Configuration file for DBMAIL <br> <br> [DBMAIL] <br> # <br> # Database settings <br> # <br> <br> # <br> # Supported drivers are mysql, pgsql, sqlite. <br> # <br> driver =pgsql <br> <br> # <br> # Supported drivers are sql, ldap. <br> # <br> authdriver =sql <br> <br> # <br> # Host for database, set to localhost if database is on <br> # the same host as dbmail and you want to use a local <br> # socket for connecting. <br> # <br> host =localhost <br> <br> # <br> # If you want to use TCP/IP for connecting to the database, <br> # and have the database running on a non-standard port. <br> # <br> sqlport =5432 <br> <br> # <br> # When using a local socket connection to the database, fill <br> # in the path to the socket here (eg /var/run/mysql.sock). <br> # <br> sqlsocket = <br> <br> # <br> # Database username. <br> # <br> user =dbmail <br> <br> # <br> # Database password. <br> # <br> pass =PasWoRd <br> <br> # <br> # Database name. <br> # <br> db =dbmail <br> <br> # <br> # Table prefix. Defaults to "dbmail_" if not specified. <br> # <br> table_prefix =dbmail_ <br> <br> # <br> # encoding must match the database/table encoding. <br> # ie latin1, utf8 <br> encoding = utf8 <br> <br> # <br> # messages with unknown encoding will be assumed to have <br> # default_msg_encoding <br> # ie iso8859-1, utf8 <br> default_msg_encoding = utf8 <br> <br> # <br> # Postmaster's email address for use in bounce messages. <br> # <br> #postmaster = DBMAIL-MAILER <br> <br> # <br> # Sendmail executable for forwards, replies, notifies, vacations. <br> # You may use pipes (|) in this command, for example: <br> # dos2unix|/usr/sbin/sendmail works well with Qmail. <br> # You may use quotes (") for executables with unusual names. <br> # <br> sendmail = /usr/sbin/sendmail <br> <br> # <br> # <br> # The following items can be overridden in the service-specific sections. <br> # <br> # <br> <br> # <br> # Trace level to send to syslog. Default is 2 (messages, errors, fatals). <br> # <br> TRACE_SYSLOG = 3 <br> <br> # <br> # Trace level to send to stderr. Default is 0 (fatals). <br> # <br> TRACE_STDERR = 1 <br> <br> # <br> # Root privs are used to open a port, then privs <br> # are dropped down to the user/group specified here. <br> # <br> EFFECTIVE_USER = dbmail <br> EFFECTIVE_GROUP = dbmail <br> <br> # <br> # The IP addresses the services will bind to. <br> # Use * for all local interfaces. <br> # Use 127.0.0.1 for localhost only. <br> # Separate multiple entries with spaces ( ) or commas (,). <br> # <br> BINDIP = * <br> <br> # <br> # Default number of child processes to start. <br> # <br> NCHILDREN = 2 <br> <br> # <br> # Maximum number of child processes allowed. <br> # <br> MAXCHILDREN = 10 <br> <br> # <br> # Unused children to always have availale. <br> # <br> MINSPARECHILDREN = 2 <br> <br> # <br> # Maximum unused children allowed to be active. <br> # <br> MAXSPARECHILDREN = 4 <br> <br> # <br> # Child process is restarted after handling this many connections. <br> # <br> MAXCONNECTS = 10000 <br> <br> # <br> # Child process will restart after this many connection errors. <br> # <br> MAX_ERRORS = 500 <br> <br> # <br> # Idle time allowed before a connection is shut off. <br> # <br> TIMEOUT = 300 <br> <br> # <br> # Idle time allowed before a connection is shut off if you have not logged in yet. <br> # <br> login_timeout = 60 <br> <br> # <br> # If yes, resolves IP addresses to DNS names when logging. <br> # <br> RESOLVE_IP = no <br> <br> # <br> # logfile for stdout messages <br> # <br> logfile = /var/log/dbmail.log <br> <br> # <br> # logfile for stderr messages <br> # <br> errorlog = /var/log/dbmail.err <br> <br> # <br> # directory for storing PID files <br> # <br> pid_directory = /var/run <br> <br> # <br> # directory for storing the daemon statefiles <br> # <br> state_directory = /var/run <br> <br> # <br> # directory for locating libraries (normally has a sane default compiled-in) <br> # <br> #library_directory = /usr/lib/dbmail <br> <br> [SMTP] <br> # In fact, there isn't anything here by default. <br> <br> [LMTP] <br> # <br> # Port to bind to. <br> # <br> PORT = 24 <br> <br> [POP] <br> # <br> # Port to bind to. <br> # <br> PORT = 110 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by POP3. <br> # This requires addition configuration of your MTA <br> # <br> POP_BEFORE_SMTP = no <br> <br> [IMAP] <br> <br> # <br> # Port to bind to. <br> # <br> PORT = 143 <br> <br> # <br> # IMAP prefers a longer timeout than other services. <br> # <br> TIMEOUT = 4000 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by IMAP. <br> # This requires addition configuration of your MTA <br> # <br> IMAP_BEFORE_SMTP = no <br> <br> # <br> # during IDLE, how many seconds between checking the mailbox <br> # status (default: 30) <br> # <br> # idle_timeout = 30 <br> <br> # <br> # Provide a CAPABILITY to override the default <br> # <br> # capability = IMAP4 IMAP4rev1 AUTH=LOGIN ACL NAMESPACE CHILDREN SORT QUOTA THREAD=ORDEREDSUBJECT UNSELECT IDLE <br> <br> [SIEVE] <br> # <br> # Port to bind to. <br> # <br> PORT = 2000 <br> <br> [LDAP] <br> PORT = 389 <br> VERSION = 3 <br> HOSTNAME = ldap <br> BASE_DN = ou=People,dc=mydomain,dc=com <br> <br> # <br> # If your LDAP library supports ldap_initialize(), then you can use the <br> # alternative LDAP server DSN like following. <br> # <br> # URI = ldap://127.0.0.1:389 <br> # URI = ldapi://%2fvar%2frun%2fopenldap%2fldapi/ <br> <br> # <br> # Leave blank for anonymous bind. <br> # example: cn=admin,dc=mydomain,dc=com <br> # <br> BIND_DN = <br> <br> # <br> # Leave blank for anonymous bind. <br> # <br> BIND_PW = <br> SCOPE = SubTree <br> USER_OBJECTCLASS = top,account,dbmailUser <br> FORW_OBJECTCLASS = top,account,dbmailForwardingAddress <br> CN_STRING = uid <br> FIELD_PASSWD = userPassword <br> FIELD_UID = uid <br> FIELD_NID = uidNumber <br> MIN_NID = 10000 <br> MAX_NID = 15000 <br> FIELD_CID = gidNumber <br> MIN_CID = 10000 <br> MAX_CID = 15000 <br> FIELD_MAIL = mail <br> FIELD_QUOTA = mailQuota <br> FIELD_FWDTARGET = mailForwardingAddress <br> <br> [DELIVERY] <br> # <br> # Run Sieve scripts as messages are delivered. <br> # <br> SIEVE = yes <br> <br> # <br> # Use 'user+mailbox@domain' format to deliver to a mailbox. <br> # <br> SUBADDRESS = yes <br> <br> # <br> # Turn on/off the Sieve Vacation extension. <br> # <br> SIEVE_VACATION = yes <br> <br> # <br> # Turn on/off the Sieve Notify extension <br> # <br> SIEVE_NOTIFY = yes <br> <br> # <br> # Turn on/off additional Sieve debugging. <br> # <br> SIEVE_DEBUG = no <br> <br> # <br> # Use the auto_notify table to send email notifications. <br> # <br> AUTO_NOTIFY = no <br> <br> # <br> # Use the auto_reply table to send away messages. <br> # <br> AUTO_REPLY = no <br> # <br> # Defaults to "NEW MAIL NOTIFICATION" <br> # <br> #AUTO_NOTIFY_SUBJECT = <br> <br> # <br> # Defaults to POSTMASTER from the DBMAIL section. <br> # <br> #AUTO_NOTIFY_SENDER = <br> <br> # <br> # If you set this to 'yes' dbmail will check for duplicate <br> # messages in the relevant mailbox during delivery using <br> # the Message-ID header <br> # <br> suppress_duplicates = no <br> <br> # end of configuration file <br> <br> <br></code> <br> <br> Spamassassin <br>    ,         ,          /etc/spamasassin,      ,       nobody <br> <br> local.cf <br> <code>rewrite_header Subject ***SPAM*** <br> report_safe 1 <br> trusted_networks 192.168/16 127/8 <br> # lock_method flock <br> required_score 5.0 <br> use_bayes 1 <br> bayes_auto_learn 1 <br> # bayes_ignore_header X-Bogosity <br> # bayes_ignore_header X-Spam-Flag <br> # bayes_ignore_header X-Spam-Status <br> auto_whitelist_path /etc/mail/spamassassin/auto_whitelist <br> bayes_path /etc/mail/spamassassin/bayes <br> bayes_file_mode 0666 <br> bayes_min_ham_num 1 <br> bayes_min_spam_num 1 <br> auto_learn_threshold_nonspam -2 <br> auto_learn_threshold_spam 5 <br> bayes_learn_to_journal 1 <br> skip_rbl_checks 0 <br> <br> ok_languages ru en <br> ok_locales ru en <br></code> <br> <br>    ..     <br> <code>/etc/init.d/exim start <br> /etc/init.d/spamd start <br> #    pop3      <br> /etc/init.d/dbmail-pop3d <br></code> <br> <br>     ,           <br> <code>rc-update add postgresql default <br> rc-update add exim default <br> rc-update add spamd default <br> rc-update add dbmail-pop3d default <br></code> <br> <br>          ,       <br> <code>dbmail-users -a admin@example.com -s admin@example.com -p plaintext -w 123123 <br></code> <br> <br>   ,        <br></code> <h2> <code><code><a href="http://njabl.org/"></a> <a href="http://www.spamcop.net/w3m%3Faction%3Dcheckblock%26ip%3D"></a> <font color="black">CREATE TYPE dtype AS ENUM ( <br> <font color="#A31515">'LOCAL'</font> , <br> <font color="#A31515">'VIRTUAL'</font> , <br> <font color="#A31515">'RELAY'</font> <br> ); <br> <br> ALTER TYPE <font color="#0000ff">public</font> .dtype OWNER TO dbmail; <br> <br> SET default_with_oids = <font color="#0000ff">true</font> ; <br> <br> CREATE TABLE dbmail_domains ( <br> uid integer NOT NULL, <br> domain character varying(128) NOT NULL, <br> type dtype NOT NULL <br> ); <br> <br> INSERT INTO dbmail_domains (uid, domain, type) VALUES (1, <font color="#A31515">'example.com'</font> , <font color="#A31515">'LOCAL'</font> );</font> <br>   . <br> <br> Exim <br> C   exim.conf <br> #!/bin/sh <br> ###################################################################### <br> # Runtime configuration file for Exim # <br> ###################################################################### <br> ####################################################################### <br> # MAIN CONFIGURATION SETTINGS # <br> ###################################################################### <br> <br> primary_hostname = example.com <br> domainlist local_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND \ <br> (type='LOCAL' OR type='VIRTUAL')}} <br> domainlist relay_to_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND type='RELAY'}} <br> hostlist relay_from_hosts = 127.0.0.1: localhost <br> auth_advertise_hosts = * <br> daemon_smtp_ports = 25 <br> log_selector = \ <br> +all_parents \ <br> +lost_incoming_connection \ <br> +received_sender \ <br> +received_recipients \ <br> +smtp_confirmation \ <br> +smtp_syntax_error \ <br> +smtp_protocol_error \ <br> -queue_run <br> acl_smtp_rcpt = acl_check_rcpt <br> acl_smtp_mime = acl_check_mime <br> acl_smtp_data = acl_check_content <br> qualify_domain = example.com <br> allow_domain_literals = false <br> exim_user = mail <br> exim_group = mail <br> never_users = root <br> host_lookup = * <br> #rfc1413_hosts = * <br> rfc1413_query_timeout = 0s <br> ignore_bounce_errors_after = 30m <br> timeout_frozen_after = 3d <br> freeze_tell = postmaster <br> <br> #av_scanner = clamd:/var/run/clamav/clamd.ctl #        <br> spamd_address = 127.0.0.1 783 <br> <br> message_size_limit = 10M <br> smtp_accept_max = 1000 <br> smtp_accept_max_per_connection = 150 <br> smtp_accept_max_per_host = 30 <br> split_spool_directory = true <br> remote_max_parallel = 15 <br> smtp_banner = "Welcome on our mail server!\n\ <br> This system does not accept Unsolicited \ <br> Commercial Email\nand will blacklist \ <br> offenders via our spam processor.\nHave a \ <br> nice day!\n\n${primary_hostname} ESMTP" <br> <br> hide pgsql_servers = localhost/dbmail/dbmail/PasSWorD <br> <br> ###################################################################### <br> # ACL CONFIGURATION # <br> # Specifies access control lists for incoming SMTP mail # <br> ###################################################################### <br> begin acl <br> <br> acl_check_rcpt: <br> <br> warn <br> set acl_m0 = 0s <br> warn <br> hosts = !+relay_from_hosts:!213.243.111.115/32 <br> set acl_m0 = 30s <br> warn <br> condition = ${if and {\ <br> {match{$sender_host_name}\ <br> {\N^[-az]*\d{0,3}[-az]*\.?[-az]*\d{0,3}[-az]*\.\w+$\N}} \ <br> {!eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 1s <br> <br> warn <br> condition = ${if and {\ <br> {match{$sender_helo_name}{\N^\w*\.\w{3}$\N}} \ <br> {eq{$acl_c1}{}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c2}{outblaze_domain}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if or {\ <br> {eq{$sender_address}{}} \ <br> {eq{$acl_m1}{0s}} \ <br> } {yes}{no}} <br> set acl_m0 = 0s <br> <br> warn <br> logwrite = Delay $acl_m0 for $sender_host_name \ <br> [$sender_host_address] with HELO=$sender_helo_name. \ <br> Mail from $sender_address to $local_part@$domain. <br> set acl_m1 = 0s <br> delay = $acl_m0 <br> <br> accept hosts = : <br> <br> deny domains = +local_domains <br> local_parts = ^[.] : ^.*[@%!/|] <br> <br> deny domains = !+local_domains <br> local_parts = ^[./|] : ^.*[@%!] : ^.*/\\.\\./ <br> <br> accept local_parts = postmaster <br> domains = +local_domains <br> <br> require verify = sender <br> <br> deny message = HELO/EHLO required by SMTP RFC <br> condition = ${if eq{$sender_helo_name}{}{yes}{no}} <br> <br> deny message = Go Away! You are spammer. <br> condition = ${if match{$sender_host_name} \ <br> {bezeqint\\.net|net\\.il|dialup|dsl|pool|peer|dhcp} \ <br> {yes}{no}} <br> <br> deny message = message from \ <br> $sender_host_address rejected - see njabl.org <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.njabl.org <br> <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dialups.mail-abuse.org <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = list.dsbl.org <br> deny message = Spam blocked see: \ <br> www.spamcop.net/w3m?action=checkblock&amp;ip=$sender_host_address <br> log_message = found in $dnslist_domain <br> dnslists = bl.spamcop.net <br> deny message = rejected, $sender_host_address \ <br> Open Proxy, see: $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.void.ru <br> <br> accept domains = +local_domains <br> endpass <br> message = unknown user <br> verify = recipient <br> <br> accept domains = +relay_to_domains <br> endpass <br> message = unrouteable address <br> verify = recipient <br> <br> accept hosts = +relay_from_hosts <br> accept authenticated = * <br> deny message = relay not permitted <br> <br> acl_check_mime: <br> <br> warn decode = default <br> <br> deny message = Blacklisted file extension detected ($mime_filename) <br> condition = ${if match \ <br> {${lc:$mime_filename}} \ <br> {\N(\.exe|\.pif|\.bat|\.scr|\.lnk|\.com|\.vbs|\.cpl)$\N} \ <br> {1}{0}} <br> <br> deny message = Sorry, noone speaks chinese here <br> condition = ${if eq{$mime_charset}{gb2312}{1}{0}} <br> <br> accept <br> <br> acl_check_content: <br> # deny message = Virus found ($malware_name) <br> # malware = * <br> <br> warn message = X-Spam-Score: $spam_score ($spam_bar) <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = X-Spam-Report: $spam_report <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = Subject: ***SPAM*** $h_Subject: <br> hosts = !+relay_from_hosts <br> spam = spamd <br> <br> deny message = This message scored $spam_score spam points. <br> spam = spamd:true <br> hosts = !+relay_from_hosts <br> condition = ${if &gt;{$spam_score_int}{120}{1}{0}} <br> <br> accept <br> <br> ###################################################################### <br> # ROUTERS CONFIGURATION # <br> # Specifies how addresses are handled # <br> ###################################################################### <br> # THE ORDER IN WHICH THE ROUTERS ARE DEFINED IS IMPORTANT! # <br> # An address is passed to each router in turn until it is accepted. # <br> ###################################################################### <br> <br> begin routers <br> <br> dnslookup: <br> driver = dnslookup <br> domains = ! +local_domains <br> transport = remote_smtp <br> ignore_target_hosts = 0.0.0.0 : 127.0.0.0/8 <br> no_more <br> <br> dbmailuser: <br> driver = accept <br> condition = ${lookup pgsql{SELECT alias_idnr FROM \ <br> dbmail_aliases WHERE \ <br> alias='${quote_pgsql:$local_part@$domain}' OR \ <br> alias='${quote_pgsql:@$domain}'}{yes}{no}} <br> transport = dbmail_delivery <br> <br> ###################################################################### <br> # TRANSPORTS CONFIGURATION # <br> ###################################################################### <br> # ORDER DOES NOT MATTER # <br> # Only one appropriate transport is called for each delivery. # <br> ###################################################################### <br> <br> begin transports <br> <br> remote_smtp: <br> driver = smtp <br> <br> dbmail_delivery: <br> driver = pipe <br> check_string = <br> command = /usr/sbin/dbmail-smtp -d ${pipe_addresses} <br> group = mail <br> message_prefix = "" <br> message_suffix = "" <br> path="/bin:/sbin:/usr/bin:/usr/sbin" <br> #   <br> address_pipe: <br> driver = pipe <br> return_output <br> <br> address_reply: <br> driver = autoreply <br> <br> ###################################################################### <br> # RETRY CONFIGURATION # <br> ###################################################################### <br> <br> begin retry <br> <br> * quota <br> * * F,2h,15m; G,16h,1h,1.5; F,4d,6h <br> <br> ###################################################################### <br> # REWRITE CONFIGURATION # <br> ###################################################################### <br> <br> begin rewrite <br> <br> ###################################################################### <br> # AUTHENTICATION CONFIGURATION # <br> ###################################################################### <br> <br> begin authenticators <br> <br> auth_plain: <br> driver = plaintext <br> public_name = PLAIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = : <br> server_set_id = $2 <br> <br> #    ,    . <br> auth_login: <br> driver = plaintext <br> public_name = LOGIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = Username:: : Password:: <br> server_set_id = $1 <br> <br> #    " " - TheBat! <br> auth_cram_md5: <br> driver = cram_md5 <br> public_name = CRAM-MD5 <br> server_secret = ${lookup pgsql{SELECT passwd FROM \ <br> dbmail_users WHERE userid \ <br> = '${quote_pgsql:$1}'}{$value}fail} <br> server_set_id = $1 <br> # End of Exim configuration file <br> ###ps  lissyara,       <br> <br></code> <br> <br> DBMail <br> dbmail.conf          <br> <code># (c) 2000-2006 IC&amp;S, The Netherlands <br> # <br> # Configuration file for DBMAIL <br> <br> [DBMAIL] <br> # <br> # Database settings <br> # <br> <br> # <br> # Supported drivers are mysql, pgsql, sqlite. <br> # <br> driver =pgsql <br> <br> # <br> # Supported drivers are sql, ldap. <br> # <br> authdriver =sql <br> <br> # <br> # Host for database, set to localhost if database is on <br> # the same host as dbmail and you want to use a local <br> # socket for connecting. <br> # <br> host =localhost <br> <br> # <br> # If you want to use TCP/IP for connecting to the database, <br> # and have the database running on a non-standard port. <br> # <br> sqlport =5432 <br> <br> # <br> # When using a local socket connection to the database, fill <br> # in the path to the socket here (eg /var/run/mysql.sock). <br> # <br> sqlsocket = <br> <br> # <br> # Database username. <br> # <br> user =dbmail <br> <br> # <br> # Database password. <br> # <br> pass =PasWoRd <br> <br> # <br> # Database name. <br> # <br> db =dbmail <br> <br> # <br> # Table prefix. Defaults to "dbmail_" if not specified. <br> # <br> table_prefix =dbmail_ <br> <br> # <br> # encoding must match the database/table encoding. <br> # ie latin1, utf8 <br> encoding = utf8 <br> <br> # <br> # messages with unknown encoding will be assumed to have <br> # default_msg_encoding <br> # ie iso8859-1, utf8 <br> default_msg_encoding = utf8 <br> <br> # <br> # Postmaster's email address for use in bounce messages. <br> # <br> #postmaster = DBMAIL-MAILER <br> <br> # <br> # Sendmail executable for forwards, replies, notifies, vacations. <br> # You may use pipes (|) in this command, for example: <br> # dos2unix|/usr/sbin/sendmail works well with Qmail. <br> # You may use quotes (") for executables with unusual names. <br> # <br> sendmail = /usr/sbin/sendmail <br> <br> # <br> # <br> # The following items can be overridden in the service-specific sections. <br> # <br> # <br> <br> # <br> # Trace level to send to syslog. Default is 2 (messages, errors, fatals). <br> # <br> TRACE_SYSLOG = 3 <br> <br> # <br> # Trace level to send to stderr. Default is 0 (fatals). <br> # <br> TRACE_STDERR = 1 <br> <br> # <br> # Root privs are used to open a port, then privs <br> # are dropped down to the user/group specified here. <br> # <br> EFFECTIVE_USER = dbmail <br> EFFECTIVE_GROUP = dbmail <br> <br> # <br> # The IP addresses the services will bind to. <br> # Use * for all local interfaces. <br> # Use 127.0.0.1 for localhost only. <br> # Separate multiple entries with spaces ( ) or commas (,). <br> # <br> BINDIP = * <br> <br> # <br> # Default number of child processes to start. <br> # <br> NCHILDREN = 2 <br> <br> # <br> # Maximum number of child processes allowed. <br> # <br> MAXCHILDREN = 10 <br> <br> # <br> # Unused children to always have availale. <br> # <br> MINSPARECHILDREN = 2 <br> <br> # <br> # Maximum unused children allowed to be active. <br> # <br> MAXSPARECHILDREN = 4 <br> <br> # <br> # Child process is restarted after handling this many connections. <br> # <br> MAXCONNECTS = 10000 <br> <br> # <br> # Child process will restart after this many connection errors. <br> # <br> MAX_ERRORS = 500 <br> <br> # <br> # Idle time allowed before a connection is shut off. <br> # <br> TIMEOUT = 300 <br> <br> # <br> # Idle time allowed before a connection is shut off if you have not logged in yet. <br> # <br> login_timeout = 60 <br> <br> # <br> # If yes, resolves IP addresses to DNS names when logging. <br> # <br> RESOLVE_IP = no <br> <br> # <br> # logfile for stdout messages <br> # <br> logfile = /var/log/dbmail.log <br> <br> # <br> # logfile for stderr messages <br> # <br> errorlog = /var/log/dbmail.err <br> <br> # <br> # directory for storing PID files <br> # <br> pid_directory = /var/run <br> <br> # <br> # directory for storing the daemon statefiles <br> # <br> state_directory = /var/run <br> <br> # <br> # directory for locating libraries (normally has a sane default compiled-in) <br> # <br> #library_directory = /usr/lib/dbmail <br> <br> [SMTP] <br> # In fact, there isn't anything here by default. <br> <br> [LMTP] <br> # <br> # Port to bind to. <br> # <br> PORT = 24 <br> <br> [POP] <br> # <br> # Port to bind to. <br> # <br> PORT = 110 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by POP3. <br> # This requires addition configuration of your MTA <br> # <br> POP_BEFORE_SMTP = no <br> <br> [IMAP] <br> <br> # <br> # Port to bind to. <br> # <br> PORT = 143 <br> <br> # <br> # IMAP prefers a longer timeout than other services. <br> # <br> TIMEOUT = 4000 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by IMAP. <br> # This requires addition configuration of your MTA <br> # <br> IMAP_BEFORE_SMTP = no <br> <br> # <br> # during IDLE, how many seconds between checking the mailbox <br> # status (default: 30) <br> # <br> # idle_timeout = 30 <br> <br> # <br> # Provide a CAPABILITY to override the default <br> # <br> # capability = IMAP4 IMAP4rev1 AUTH=LOGIN ACL NAMESPACE CHILDREN SORT QUOTA THREAD=ORDEREDSUBJECT UNSELECT IDLE <br> <br> [SIEVE] <br> # <br> # Port to bind to. <br> # <br> PORT = 2000 <br> <br> [LDAP] <br> PORT = 389 <br> VERSION = 3 <br> HOSTNAME = ldap <br> BASE_DN = ou=People,dc=mydomain,dc=com <br> <br> # <br> # If your LDAP library supports ldap_initialize(), then you can use the <br> # alternative LDAP server DSN like following. <br> # <br> # URI = ldap://127.0.0.1:389 <br> # URI = ldapi://%2fvar%2frun%2fopenldap%2fldapi/ <br> <br> # <br> # Leave blank for anonymous bind. <br> # example: cn=admin,dc=mydomain,dc=com <br> # <br> BIND_DN = <br> <br> # <br> # Leave blank for anonymous bind. <br> # <br> BIND_PW = <br> SCOPE = SubTree <br> USER_OBJECTCLASS = top,account,dbmailUser <br> FORW_OBJECTCLASS = top,account,dbmailForwardingAddress <br> CN_STRING = uid <br> FIELD_PASSWD = userPassword <br> FIELD_UID = uid <br> FIELD_NID = uidNumber <br> MIN_NID = 10000 <br> MAX_NID = 15000 <br> FIELD_CID = gidNumber <br> MIN_CID = 10000 <br> MAX_CID = 15000 <br> FIELD_MAIL = mail <br> FIELD_QUOTA = mailQuota <br> FIELD_FWDTARGET = mailForwardingAddress <br> <br> [DELIVERY] <br> # <br> # Run Sieve scripts as messages are delivered. <br> # <br> SIEVE = yes <br> <br> # <br> # Use 'user+mailbox@domain' format to deliver to a mailbox. <br> # <br> SUBADDRESS = yes <br> <br> # <br> # Turn on/off the Sieve Vacation extension. <br> # <br> SIEVE_VACATION = yes <br> <br> # <br> # Turn on/off the Sieve Notify extension <br> # <br> SIEVE_NOTIFY = yes <br> <br> # <br> # Turn on/off additional Sieve debugging. <br> # <br> SIEVE_DEBUG = no <br> <br> # <br> # Use the auto_notify table to send email notifications. <br> # <br> AUTO_NOTIFY = no <br> <br> # <br> # Use the auto_reply table to send away messages. <br> # <br> AUTO_REPLY = no <br> # <br> # Defaults to "NEW MAIL NOTIFICATION" <br> # <br> #AUTO_NOTIFY_SUBJECT = <br> <br> # <br> # Defaults to POSTMASTER from the DBMAIL section. <br> # <br> #AUTO_NOTIFY_SENDER = <br> <br> # <br> # If you set this to 'yes' dbmail will check for duplicate <br> # messages in the relevant mailbox during delivery using <br> # the Message-ID header <br> # <br> suppress_duplicates = no <br> <br> # end of configuration file <br> <br> <br></code> <br> <br> Spamassassin <br>    ,         ,          /etc/spamasassin,      ,       nobody <br> <br> local.cf <br> <code>rewrite_header Subject ***SPAM*** <br> report_safe 1 <br> trusted_networks 192.168/16 127/8 <br> # lock_method flock <br> required_score 5.0 <br> use_bayes 1 <br> bayes_auto_learn 1 <br> # bayes_ignore_header X-Bogosity <br> # bayes_ignore_header X-Spam-Flag <br> # bayes_ignore_header X-Spam-Status <br> auto_whitelist_path /etc/mail/spamassassin/auto_whitelist <br> bayes_path /etc/mail/spamassassin/bayes <br> bayes_file_mode 0666 <br> bayes_min_ham_num 1 <br> bayes_min_spam_num 1 <br> auto_learn_threshold_nonspam -2 <br> auto_learn_threshold_spam 5 <br> bayes_learn_to_journal 1 <br> skip_rbl_checks 0 <br> <br> ok_languages ru en <br> ok_locales ru en <br></code> <br> <br>    ..     <br> <code>/etc/init.d/exim start <br> /etc/init.d/spamd start <br> #    pop3      <br> /etc/init.d/dbmail-pop3d <br></code> <br> <br>     ,           <br> <code>rc-update add postgresql default <br> rc-update add exim default <br> rc-update add spamd default <br> rc-update add dbmail-pop3d default <br></code> <br> <br>          ,       <br> <code>dbmail-users -a admin@example.com -s admin@example.com -p plaintext -w 123123 <br></code> <br> <br>   ,        <br></code> </h2> <code><code><a href="http://njabl.org/"></a> <a href="http://www.spamcop.net/w3m%3Faction%3Dcheckblock%26ip%3D"></a> <font color="black">CREATE TYPE dtype AS ENUM ( <br> <font color="#A31515">'LOCAL'</font> , <br> <font color="#A31515">'VIRTUAL'</font> , <br> <font color="#A31515">'RELAY'</font> <br> ); <br> <br> ALTER TYPE <font color="#0000ff">public</font> .dtype OWNER TO dbmail; <br> <br> SET default_with_oids = <font color="#0000ff">true</font> ; <br> <br> CREATE TABLE dbmail_domains ( <br> uid integer NOT NULL, <br> domain character varying(128) NOT NULL, <br> type dtype NOT NULL <br> ); <br> <br> INSERT INTO dbmail_domains (uid, domain, type) VALUES (1, <font color="#A31515">'example.com'</font> , <font color="#A31515">'LOCAL'</font> );</font> <br>   . <br> <br> Exim <br> C   exim.conf <br> #!/bin/sh <br> ###################################################################### <br> # Runtime configuration file for Exim # <br> ###################################################################### <br> ####################################################################### <br> # MAIN CONFIGURATION SETTINGS # <br> ###################################################################### <br> <br> primary_hostname = example.com <br> domainlist local_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND \ <br> (type='LOCAL' OR type='VIRTUAL')}} <br> domainlist relay_to_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND type='RELAY'}} <br> hostlist relay_from_hosts = 127.0.0.1: localhost <br> auth_advertise_hosts = * <br> daemon_smtp_ports = 25 <br> log_selector = \ <br> +all_parents \ <br> +lost_incoming_connection \ <br> +received_sender \ <br> +received_recipients \ <br> +smtp_confirmation \ <br> +smtp_syntax_error \ <br> +smtp_protocol_error \ <br> -queue_run <br> acl_smtp_rcpt = acl_check_rcpt <br> acl_smtp_mime = acl_check_mime <br> acl_smtp_data = acl_check_content <br> qualify_domain = example.com <br> allow_domain_literals = false <br> exim_user = mail <br> exim_group = mail <br> never_users = root <br> host_lookup = * <br> #rfc1413_hosts = * <br> rfc1413_query_timeout = 0s <br> ignore_bounce_errors_after = 30m <br> timeout_frozen_after = 3d <br> freeze_tell = postmaster <br> <br> #av_scanner = clamd:/var/run/clamav/clamd.ctl #        <br> spamd_address = 127.0.0.1 783 <br> <br> message_size_limit = 10M <br> smtp_accept_max = 1000 <br> smtp_accept_max_per_connection = 150 <br> smtp_accept_max_per_host = 30 <br> split_spool_directory = true <br> remote_max_parallel = 15 <br> smtp_banner = "Welcome on our mail server!\n\ <br> This system does not accept Unsolicited \ <br> Commercial Email\nand will blacklist \ <br> offenders via our spam processor.\nHave a \ <br> nice day!\n\n${primary_hostname} ESMTP" <br> <br> hide pgsql_servers = localhost/dbmail/dbmail/PasSWorD <br> <br> ###################################################################### <br> # ACL CONFIGURATION # <br> # Specifies access control lists for incoming SMTP mail # <br> ###################################################################### <br> begin acl <br> <br> acl_check_rcpt: <br> <br> warn <br> set acl_m0 = 0s <br> warn <br> hosts = !+relay_from_hosts:!213.243.111.115/32 <br> set acl_m0 = 30s <br> warn <br> condition = ${if and {\ <br> {match{$sender_host_name}\ <br> {\N^[-az]*\d{0,3}[-az]*\.?[-az]*\d{0,3}[-az]*\.\w+$\N}} \ <br> {!eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 1s <br> <br> warn <br> condition = ${if and {\ <br> {match{$sender_helo_name}{\N^\w*\.\w{3}$\N}} \ <br> {eq{$acl_c1}{}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c2}{outblaze_domain}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if or {\ <br> {eq{$sender_address}{}} \ <br> {eq{$acl_m1}{0s}} \ <br> } {yes}{no}} <br> set acl_m0 = 0s <br> <br> warn <br> logwrite = Delay $acl_m0 for $sender_host_name \ <br> [$sender_host_address] with HELO=$sender_helo_name. \ <br> Mail from $sender_address to $local_part@$domain. <br> set acl_m1 = 0s <br> delay = $acl_m0 <br> <br> accept hosts = : <br> <br> deny domains = +local_domains <br> local_parts = ^[.] : ^.*[@%!/|] <br> <br> deny domains = !+local_domains <br> local_parts = ^[./|] : ^.*[@%!] : ^.*/\\.\\./ <br> <br> accept local_parts = postmaster <br> domains = +local_domains <br> <br> require verify = sender <br> <br> deny message = HELO/EHLO required by SMTP RFC <br> condition = ${if eq{$sender_helo_name}{}{yes}{no}} <br> <br> deny message = Go Away! You are spammer. <br> condition = ${if match{$sender_host_name} \ <br> {bezeqint\\.net|net\\.il|dialup|dsl|pool|peer|dhcp} \ <br> {yes}{no}} <br> <br> deny message = message from \ <br> $sender_host_address rejected - see njabl.org <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.njabl.org <br> <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dialups.mail-abuse.org <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = list.dsbl.org <br> deny message = Spam blocked see: \ <br> www.spamcop.net/w3m?action=checkblock&amp;ip=$sender_host_address <br> log_message = found in $dnslist_domain <br> dnslists = bl.spamcop.net <br> deny message = rejected, $sender_host_address \ <br> Open Proxy, see: $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.void.ru <br> <br> accept domains = +local_domains <br> endpass <br> message = unknown user <br> verify = recipient <br> <br> accept domains = +relay_to_domains <br> endpass <br> message = unrouteable address <br> verify = recipient <br> <br> accept hosts = +relay_from_hosts <br> accept authenticated = * <br> deny message = relay not permitted <br> <br> acl_check_mime: <br> <br> warn decode = default <br> <br> deny message = Blacklisted file extension detected ($mime_filename) <br> condition = ${if match \ <br> {${lc:$mime_filename}} \ <br> {\N(\.exe|\.pif|\.bat|\.scr|\.lnk|\.com|\.vbs|\.cpl)$\N} \ <br> {1}{0}} <br> <br> deny message = Sorry, noone speaks chinese here <br> condition = ${if eq{$mime_charset}{gb2312}{1}{0}} <br> <br> accept <br> <br> acl_check_content: <br> # deny message = Virus found ($malware_name) <br> # malware = * <br> <br> warn message = X-Spam-Score: $spam_score ($spam_bar) <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = X-Spam-Report: $spam_report <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = Subject: ***SPAM*** $h_Subject: <br> hosts = !+relay_from_hosts <br> spam = spamd <br> <br> deny message = This message scored $spam_score spam points. <br> spam = spamd:true <br> hosts = !+relay_from_hosts <br> condition = ${if &gt;{$spam_score_int}{120}{1}{0}} <br> <br> accept <br> <br> ###################################################################### <br> # ROUTERS CONFIGURATION # <br> # Specifies how addresses are handled # <br> ###################################################################### <br> # THE ORDER IN WHICH THE ROUTERS ARE DEFINED IS IMPORTANT! # <br> # An address is passed to each router in turn until it is accepted. # <br> ###################################################################### <br> <br> begin routers <br> <br> dnslookup: <br> driver = dnslookup <br> domains = ! +local_domains <br> transport = remote_smtp <br> ignore_target_hosts = 0.0.0.0 : 127.0.0.0/8 <br> no_more <br> <br> dbmailuser: <br> driver = accept <br> condition = ${lookup pgsql{SELECT alias_idnr FROM \ <br> dbmail_aliases WHERE \ <br> alias='${quote_pgsql:$local_part@$domain}' OR \ <br> alias='${quote_pgsql:@$domain}'}{yes}{no}} <br> transport = dbmail_delivery <br> <br> ###################################################################### <br> # TRANSPORTS CONFIGURATION # <br> ###################################################################### <br> # ORDER DOES NOT MATTER # <br> # Only one appropriate transport is called for each delivery. # <br> ###################################################################### <br> <br> begin transports <br> <br> remote_smtp: <br> driver = smtp <br> <br> dbmail_delivery: <br> driver = pipe <br> check_string = <br> command = /usr/sbin/dbmail-smtp -d ${pipe_addresses} <br> group = mail <br> message_prefix = "" <br> message_suffix = "" <br> path="/bin:/sbin:/usr/bin:/usr/sbin" <br> #   <br> address_pipe: <br> driver = pipe <br> return_output <br> <br> address_reply: <br> driver = autoreply <br> <br> ###################################################################### <br> # RETRY CONFIGURATION # <br> ###################################################################### <br> <br> begin retry <br> <br> * quota <br> * * F,2h,15m; G,16h,1h,1.5; F,4d,6h <br> <br> ###################################################################### <br> # REWRITE CONFIGURATION # <br> ###################################################################### <br> <br> begin rewrite <br> <br> ###################################################################### <br> # AUTHENTICATION CONFIGURATION # <br> ###################################################################### <br> <br> begin authenticators <br> <br> auth_plain: <br> driver = plaintext <br> public_name = PLAIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = : <br> server_set_id = $2 <br> <br> #    ,    . <br> auth_login: <br> driver = plaintext <br> public_name = LOGIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = Username:: : Password:: <br> server_set_id = $1 <br> <br> #    " " - TheBat! <br> auth_cram_md5: <br> driver = cram_md5 <br> public_name = CRAM-MD5 <br> server_secret = ${lookup pgsql{SELECT passwd FROM \ <br> dbmail_users WHERE userid \ <br> = '${quote_pgsql:$1}'}{$value}fail} <br> server_set_id = $1 <br> # End of Exim configuration file <br> ###ps  lissyara,       <br> <br></code> <br> <br> DBMail <br> dbmail.conf          <br> <code># (c) 2000-2006 IC&amp;S, The Netherlands <br> # <br> # Configuration file for DBMAIL <br> <br> [DBMAIL] <br> # <br> # Database settings <br> # <br> <br> # <br> # Supported drivers are mysql, pgsql, sqlite. <br> # <br> driver =pgsql <br> <br> # <br> # Supported drivers are sql, ldap. <br> # <br> authdriver =sql <br> <br> # <br> # Host for database, set to localhost if database is on <br> # the same host as dbmail and you want to use a local <br> # socket for connecting. <br> # <br> host =localhost <br> <br> # <br> # If you want to use TCP/IP for connecting to the database, <br> # and have the database running on a non-standard port. <br> # <br> sqlport =5432 <br> <br> # <br> # When using a local socket connection to the database, fill <br> # in the path to the socket here (eg /var/run/mysql.sock). <br> # <br> sqlsocket = <br> <br> # <br> # Database username. <br> # <br> user =dbmail <br> <br> # <br> # Database password. <br> # <br> pass =PasWoRd <br> <br> # <br> # Database name. <br> # <br> db =dbmail <br> <br> # <br> # Table prefix. Defaults to "dbmail_" if not specified. <br> # <br> table_prefix =dbmail_ <br> <br> # <br> # encoding must match the database/table encoding. <br> # ie latin1, utf8 <br> encoding = utf8 <br> <br> # <br> # messages with unknown encoding will be assumed to have <br> # default_msg_encoding <br> # ie iso8859-1, utf8 <br> default_msg_encoding = utf8 <br> <br> # <br> # Postmaster's email address for use in bounce messages. <br> # <br> #postmaster = DBMAIL-MAILER <br> <br> # <br> # Sendmail executable for forwards, replies, notifies, vacations. <br> # You may use pipes (|) in this command, for example: <br> # dos2unix|/usr/sbin/sendmail works well with Qmail. <br> # You may use quotes (") for executables with unusual names. <br> # <br> sendmail = /usr/sbin/sendmail <br> <br> # <br> # <br> # The following items can be overridden in the service-specific sections. <br> # <br> # <br> <br> # <br> # Trace level to send to syslog. Default is 2 (messages, errors, fatals). <br> # <br> TRACE_SYSLOG = 3 <br> <br> # <br> # Trace level to send to stderr. Default is 0 (fatals). <br> # <br> TRACE_STDERR = 1 <br> <br> # <br> # Root privs are used to open a port, then privs <br> # are dropped down to the user/group specified here. <br> # <br> EFFECTIVE_USER = dbmail <br> EFFECTIVE_GROUP = dbmail <br> <br> # <br> # The IP addresses the services will bind to. <br> # Use * for all local interfaces. <br> # Use 127.0.0.1 for localhost only. <br> # Separate multiple entries with spaces ( ) or commas (,). <br> # <br> BINDIP = * <br> <br> # <br> # Default number of child processes to start. <br> # <br> NCHILDREN = 2 <br> <br> # <br> # Maximum number of child processes allowed. <br> # <br> MAXCHILDREN = 10 <br> <br> # <br> # Unused children to always have availale. <br> # <br> MINSPARECHILDREN = 2 <br> <br> # <br> # Maximum unused children allowed to be active. <br> # <br> MAXSPARECHILDREN = 4 <br> <br> # <br> # Child process is restarted after handling this many connections. <br> # <br> MAXCONNECTS = 10000 <br> <br> # <br> # Child process will restart after this many connection errors. <br> # <br> MAX_ERRORS = 500 <br> <br> # <br> # Idle time allowed before a connection is shut off. <br> # <br> TIMEOUT = 300 <br> <br> # <br> # Idle time allowed before a connection is shut off if you have not logged in yet. <br> # <br> login_timeout = 60 <br> <br> # <br> # If yes, resolves IP addresses to DNS names when logging. <br> # <br> RESOLVE_IP = no <br> <br> # <br> # logfile for stdout messages <br> # <br> logfile = /var/log/dbmail.log <br> <br> # <br> # logfile for stderr messages <br> # <br> errorlog = /var/log/dbmail.err <br> <br> # <br> # directory for storing PID files <br> # <br> pid_directory = /var/run <br> <br> # <br> # directory for storing the daemon statefiles <br> # <br> state_directory = /var/run <br> <br> # <br> # directory for locating libraries (normally has a sane default compiled-in) <br> # <br> #library_directory = /usr/lib/dbmail <br> <br> [SMTP] <br> # In fact, there isn't anything here by default. <br> <br> [LMTP] <br> # <br> # Port to bind to. <br> # <br> PORT = 24 <br> <br> [POP] <br> # <br> # Port to bind to. <br> # <br> PORT = 110 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by POP3. <br> # This requires addition configuration of your MTA <br> # <br> POP_BEFORE_SMTP = no <br> <br> [IMAP] <br> <br> # <br> # Port to bind to. <br> # <br> PORT = 143 <br> <br> # <br> # IMAP prefers a longer timeout than other services. <br> # <br> TIMEOUT = 4000 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by IMAP. <br> # This requires addition configuration of your MTA <br> # <br> IMAP_BEFORE_SMTP = no <br> <br> # <br> # during IDLE, how many seconds between checking the mailbox <br> # status (default: 30) <br> # <br> # idle_timeout = 30 <br> <br> # <br> # Provide a CAPABILITY to override the default <br> # <br> # capability = IMAP4 IMAP4rev1 AUTH=LOGIN ACL NAMESPACE CHILDREN SORT QUOTA THREAD=ORDEREDSUBJECT UNSELECT IDLE <br> <br> [SIEVE] <br> # <br> # Port to bind to. <br> # <br> PORT = 2000 <br> <br> [LDAP] <br> PORT = 389 <br> VERSION = 3 <br> HOSTNAME = ldap <br> BASE_DN = ou=People,dc=mydomain,dc=com <br> <br> # <br> # If your LDAP library supports ldap_initialize(), then you can use the <br> # alternative LDAP server DSN like following. <br> # <br> # URI = ldap://127.0.0.1:389 <br> # URI = ldapi://%2fvar%2frun%2fopenldap%2fldapi/ <br> <br> # <br> # Leave blank for anonymous bind. <br> # example: cn=admin,dc=mydomain,dc=com <br> # <br> BIND_DN = <br> <br> # <br> # Leave blank for anonymous bind. <br> # <br> BIND_PW = <br> SCOPE = SubTree <br> USER_OBJECTCLASS = top,account,dbmailUser <br> FORW_OBJECTCLASS = top,account,dbmailForwardingAddress <br> CN_STRING = uid <br> FIELD_PASSWD = userPassword <br> FIELD_UID = uid <br> FIELD_NID = uidNumber <br> MIN_NID = 10000 <br> MAX_NID = 15000 <br> FIELD_CID = gidNumber <br> MIN_CID = 10000 <br> MAX_CID = 15000 <br> FIELD_MAIL = mail <br> FIELD_QUOTA = mailQuota <br> FIELD_FWDTARGET = mailForwardingAddress <br> <br> [DELIVERY] <br> # <br> # Run Sieve scripts as messages are delivered. <br> # <br> SIEVE = yes <br> <br> # <br> # Use 'user+mailbox@domain' format to deliver to a mailbox. <br> # <br> SUBADDRESS = yes <br> <br> # <br> # Turn on/off the Sieve Vacation extension. <br> # <br> SIEVE_VACATION = yes <br> <br> # <br> # Turn on/off the Sieve Notify extension <br> # <br> SIEVE_NOTIFY = yes <br> <br> # <br> # Turn on/off additional Sieve debugging. <br> # <br> SIEVE_DEBUG = no <br> <br> # <br> # Use the auto_notify table to send email notifications. <br> # <br> AUTO_NOTIFY = no <br> <br> # <br> # Use the auto_reply table to send away messages. <br> # <br> AUTO_REPLY = no <br> # <br> # Defaults to "NEW MAIL NOTIFICATION" <br> # <br> #AUTO_NOTIFY_SUBJECT = <br> <br> # <br> # Defaults to POSTMASTER from the DBMAIL section. <br> # <br> #AUTO_NOTIFY_SENDER = <br> <br> # <br> # If you set this to 'yes' dbmail will check for duplicate <br> # messages in the relevant mailbox during delivery using <br> # the Message-ID header <br> # <br> suppress_duplicates = no <br> <br> # end of configuration file <br> <br> <br></code> <br> <br> Spamassassin <br>    ,         ,          /etc/spamasassin,      ,       nobody <br> <br> local.cf <br> <code>rewrite_header Subject ***SPAM*** <br> report_safe 1 <br> trusted_networks 192.168/16 127/8 <br> # lock_method flock <br> required_score 5.0 <br> use_bayes 1 <br> bayes_auto_learn 1 <br> # bayes_ignore_header X-Bogosity <br> # bayes_ignore_header X-Spam-Flag <br> # bayes_ignore_header X-Spam-Status <br> auto_whitelist_path /etc/mail/spamassassin/auto_whitelist <br> bayes_path /etc/mail/spamassassin/bayes <br> bayes_file_mode 0666 <br> bayes_min_ham_num 1 <br> bayes_min_spam_num 1 <br> auto_learn_threshold_nonspam -2 <br> auto_learn_threshold_spam 5 <br> bayes_learn_to_journal 1 <br> skip_rbl_checks 0 <br> <br> ok_languages ru en <br> ok_locales ru en <br></code> <br> <br>    ..     <br> <code>/etc/init.d/exim start <br> /etc/init.d/spamd start <br> #    pop3      <br> /etc/init.d/dbmail-pop3d <br></code> <br> <br>     ,           <br> <code>rc-update add postgresql default <br> rc-update add exim default <br> rc-update add spamd default <br> rc-update add dbmail-pop3d default <br></code> <br> <br>          ,       <br> <code>dbmail-users -a admin@example.com -s admin@example.com -p plaintext -w 123123 <br></code> <br> <br>   ,        <br></code> <blockquote> <code><code><code><a href="http://njabl.org/"></a> <a href="http://www.spamcop.net/w3m%3Faction%3Dcheckblock%26ip%3D"></a> <font color="black">CREATE TYPE dtype AS ENUM ( <br> <font color="#A31515">'LOCAL'</font> , <br> <font color="#A31515">'VIRTUAL'</font> , <br> <font color="#A31515">'RELAY'</font> <br> ); <br> <br> ALTER TYPE <font color="#0000ff">public</font> .dtype OWNER TO dbmail; <br> <br> SET default_with_oids = <font color="#0000ff">true</font> ; <br> <br> CREATE TABLE dbmail_domains ( <br> uid integer NOT NULL, <br> domain character varying(128) NOT NULL, <br> type dtype NOT NULL <br> ); <br> <br> INSERT INTO dbmail_domains (uid, domain, type) VALUES (1, <font color="#A31515">'example.com'</font> , <font color="#A31515">'LOCAL'</font> );</font> <br>   . <br> <br> Exim <br> C   exim.conf <br> #!/bin/sh <br> ###################################################################### <br> # Runtime configuration file for Exim # <br> ###################################################################### <br> ####################################################################### <br> # MAIN CONFIGURATION SETTINGS # <br> ###################################################################### <br> <br> primary_hostname = example.com <br> domainlist local_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND \ <br> (type='LOCAL' OR type='VIRTUAL')}} <br> domainlist relay_to_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND type='RELAY'}} <br> hostlist relay_from_hosts = 127.0.0.1: localhost <br> auth_advertise_hosts = * <br> daemon_smtp_ports = 25 <br> log_selector = \ <br> +all_parents \ <br> +lost_incoming_connection \ <br> +received_sender \ <br> +received_recipients \ <br> +smtp_confirmation \ <br> +smtp_syntax_error \ <br> +smtp_protocol_error \ <br> -queue_run <br> acl_smtp_rcpt = acl_check_rcpt <br> acl_smtp_mime = acl_check_mime <br> acl_smtp_data = acl_check_content <br> qualify_domain = example.com <br> allow_domain_literals = false <br> exim_user = mail <br> exim_group = mail <br> never_users = root <br> host_lookup = * <br> #rfc1413_hosts = * <br> rfc1413_query_timeout = 0s <br> ignore_bounce_errors_after = 30m <br> timeout_frozen_after = 3d <br> freeze_tell = postmaster <br> <br> #av_scanner = clamd:/var/run/clamav/clamd.ctl #        <br> spamd_address = 127.0.0.1 783 <br> <br> message_size_limit = 10M <br> smtp_accept_max = 1000 <br> smtp_accept_max_per_connection = 150 <br> smtp_accept_max_per_host = 30 <br> split_spool_directory = true <br> remote_max_parallel = 15 <br> smtp_banner = "Welcome on our mail server!\n\ <br> This system does not accept Unsolicited \ <br> Commercial Email\nand will blacklist \ <br> offenders via our spam processor.\nHave a \ <br> nice day!\n\n${primary_hostname} ESMTP" <br> <br> hide pgsql_servers = localhost/dbmail/dbmail/PasSWorD <br> <br> ###################################################################### <br> # ACL CONFIGURATION # <br> # Specifies access control lists for incoming SMTP mail # <br> ###################################################################### <br> begin acl <br> <br> acl_check_rcpt: <br> <br> warn <br> set acl_m0 = 0s <br> warn <br> hosts = !+relay_from_hosts:!213.243.111.115/32 <br> set acl_m0 = 30s <br> warn <br> condition = ${if and {\ <br> {match{$sender_host_name}\ <br> {\N^[-az]*\d{0,3}[-az]*\.?[-az]*\d{0,3}[-az]*\.\w+$\N}} \ <br> {!eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 1s <br> <br> warn <br> condition = ${if and {\ <br> {match{$sender_helo_name}{\N^\w*\.\w{3}$\N}} \ <br> {eq{$acl_c1}{}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c2}{outblaze_domain}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if or {\ <br> {eq{$sender_address}{}} \ <br> {eq{$acl_m1}{0s}} \ <br> } {yes}{no}} <br> set acl_m0 = 0s <br> <br> warn <br> logwrite = Delay $acl_m0 for $sender_host_name \ <br> [$sender_host_address] with HELO=$sender_helo_name. \ <br> Mail from $sender_address to $local_part@$domain. <br> set acl_m1 = 0s <br> delay = $acl_m0 <br> <br> accept hosts = : <br> <br> deny domains = +local_domains <br> local_parts = ^[.] : ^.*[@%!/|] <br> <br> deny domains = !+local_domains <br> local_parts = ^[./|] : ^.*[@%!] : ^.*/\\.\\./ <br> <br> accept local_parts = postmaster <br> domains = +local_domains <br> <br> require verify = sender <br> <br> deny message = HELO/EHLO required by SMTP RFC <br> condition = ${if eq{$sender_helo_name}{}{yes}{no}} <br> <br> deny message = Go Away! You are spammer. <br> condition = ${if match{$sender_host_name} \ <br> {bezeqint\\.net|net\\.il|dialup|dsl|pool|peer|dhcp} \ <br> {yes}{no}} <br> <br> deny message = message from \ <br> $sender_host_address rejected - see njabl.org <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.njabl.org <br> <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dialups.mail-abuse.org <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = list.dsbl.org <br> deny message = Spam blocked see: \ <br> www.spamcop.net/w3m?action=checkblock&amp;ip=$sender_host_address <br> log_message = found in $dnslist_domain <br> dnslists = bl.spamcop.net <br> deny message = rejected, $sender_host_address \ <br> Open Proxy, see: $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.void.ru <br> <br> accept domains = +local_domains <br> endpass <br> message = unknown user <br> verify = recipient <br> <br> accept domains = +relay_to_domains <br> endpass <br> message = unrouteable address <br> verify = recipient <br> <br> accept hosts = +relay_from_hosts <br> accept authenticated = * <br> deny message = relay not permitted <br> <br> acl_check_mime: <br> <br> warn decode = default <br> <br> deny message = Blacklisted file extension detected ($mime_filename) <br> condition = ${if match \ <br> {${lc:$mime_filename}} \ <br> {\N(\.exe|\.pif|\.bat|\.scr|\.lnk|\.com|\.vbs|\.cpl)$\N} \ <br> {1}{0}} <br> <br> deny message = Sorry, noone speaks chinese here <br> condition = ${if eq{$mime_charset}{gb2312}{1}{0}} <br> <br> accept <br> <br> acl_check_content: <br> # deny message = Virus found ($malware_name) <br> # malware = * <br> <br> warn message = X-Spam-Score: $spam_score ($spam_bar) <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = X-Spam-Report: $spam_report <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = Subject: ***SPAM*** $h_Subject: <br> hosts = !+relay_from_hosts <br> spam = spamd <br> <br> deny message = This message scored $spam_score spam points. <br> spam = spamd:true <br> hosts = !+relay_from_hosts <br> condition = ${if &gt;{$spam_score_int}{120}{1}{0}} <br> <br> accept <br> <br> ###################################################################### <br> # ROUTERS CONFIGURATION # <br> # Specifies how addresses are handled # <br> ###################################################################### <br> # THE ORDER IN WHICH THE ROUTERS ARE DEFINED IS IMPORTANT! # <br> # An address is passed to each router in turn until it is accepted. # <br> ###################################################################### <br> <br> begin routers <br> <br> dnslookup: <br> driver = dnslookup <br> domains = ! +local_domains <br> transport = remote_smtp <br> ignore_target_hosts = 0.0.0.0 : 127.0.0.0/8 <br> no_more <br> <br> dbmailuser: <br> driver = accept <br> condition = ${lookup pgsql{SELECT alias_idnr FROM \ <br> dbmail_aliases WHERE \ <br> alias='${quote_pgsql:$local_part@$domain}' OR \ <br> alias='${quote_pgsql:@$domain}'}{yes}{no}} <br> transport = dbmail_delivery <br> <br> ###################################################################### <br> # TRANSPORTS CONFIGURATION # <br> ###################################################################### <br> # ORDER DOES NOT MATTER # <br> # Only one appropriate transport is called for each delivery. # <br> ###################################################################### <br> <br> begin transports <br> <br> remote_smtp: <br> driver = smtp <br> <br> dbmail_delivery: <br> driver = pipe <br> check_string = <br> command = /usr/sbin/dbmail-smtp -d ${pipe_addresses} <br> group = mail <br> message_prefix = "" <br> message_suffix = "" <br> path="/bin:/sbin:/usr/bin:/usr/sbin" <br> #   <br> address_pipe: <br> driver = pipe <br> return_output <br> <br> address_reply: <br> driver = autoreply <br> <br> ###################################################################### <br> # RETRY CONFIGURATION # <br> ###################################################################### <br> <br> begin retry <br> <br> * quota <br> * * F,2h,15m; G,16h,1h,1.5; F,4d,6h <br> <br> ###################################################################### <br> # REWRITE CONFIGURATION # <br> ###################################################################### <br> <br> begin rewrite <br> <br> ###################################################################### <br> # AUTHENTICATION CONFIGURATION # <br> ###################################################################### <br> <br> begin authenticators <br> <br> auth_plain: <br> driver = plaintext <br> public_name = PLAIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = : <br> server_set_id = $2 <br> <br> #    ,    . <br> auth_login: <br> driver = plaintext <br> public_name = LOGIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = Username:: : Password:: <br> server_set_id = $1 <br> <br> #    " " - TheBat! <br> auth_cram_md5: <br> driver = cram_md5 <br> public_name = CRAM-MD5 <br> server_secret = ${lookup pgsql{SELECT passwd FROM \ <br> dbmail_users WHERE userid \ <br> = '${quote_pgsql:$1}'}{$value}fail} <br> server_set_id = $1 <br> # End of Exim configuration file <br> ###ps  lissyara,       <br> <br></code> <br> <br> DBMail <br> dbmail.conf          <br> # (c) 2000-2006 IC&amp;S, The Netherlands <br> # <br> # Configuration file for DBMAIL <br> <br> [DBMAIL] <br> # <br> # Database settings <br> # <br> <br> # <br> # Supported drivers are mysql, pgsql, sqlite. <br> # <br> driver =pgsql <br> <br> # <br> # Supported drivers are sql, ldap. <br> # <br> authdriver =sql <br> <br> # <br> # Host for database, set to localhost if database is on <br> # the same host as dbmail and you want to use a local <br> # socket for connecting. <br> # <br> host =localhost <br> <br> # <br> # If you want to use TCP/IP for connecting to the database, <br> # and have the database running on a non-standard port. <br> # <br> sqlport =5432 <br> <br> # <br> # When using a local socket connection to the database, fill <br> # in the path to the socket here (eg /var/run/mysql.sock). <br> # <br> sqlsocket = <br> <br> # <br> # Database username. <br> # <br> user =dbmail <br> <br> # <br> # Database password. <br> # <br> pass =PasWoRd <br> <br> # <br> # Database name. <br> # <br> db =dbmail <br> <br> # <br> # Table prefix. Defaults to "dbmail_" if not specified. <br> # <br> table_prefix =dbmail_ <br> <br> # <br> # encoding must match the database/table encoding. <br> # ie latin1, utf8 <br> encoding = utf8 <br> <br> # <br> # messages with unknown encoding will be assumed to have <br> # default_msg_encoding <br> # ie iso8859-1, utf8 <br> default_msg_encoding = utf8 <br> <br> # <br> # Postmaster's email address for use in bounce messages. <br> # <br> #postmaster = DBMAIL-MAILER <br> <br> # <br> # Sendmail executable for forwards, replies, notifies, vacations. <br> # You may use pipes (|) in this command, for example: <br> # dos2unix|/usr/sbin/sendmail works well with Qmail. <br> # You may use quotes (") for executables with unusual names. <br> # <br> sendmail = /usr/sbin/sendmail <br> <br> # <br> # <br> # The following items can be overridden in the service-specific sections. <br> # <br> # <br> <br> # <br> # Trace level to send to syslog. Default is 2 (messages, errors, fatals). <br> # <br> TRACE_SYSLOG = 3 <br> <br> # <br> # Trace level to send to stderr. Default is 0 (fatals). <br> # <br> TRACE_STDERR = 1 <br> <br> # <br> # Root privs are used to open a port, then privs <br> # are dropped down to the user/group specified here. <br> # <br> EFFECTIVE_USER = dbmail <br> EFFECTIVE_GROUP = dbmail <br> <br> # <br> # The IP addresses the services will bind to. <br> # Use * for all local interfaces. <br> # Use 127.0.0.1 for localhost only. <br> # Separate multiple entries with spaces ( ) or commas (,). <br> # <br> BINDIP = * <br> <br> # <br> # Default number of child processes to start. <br> # <br> NCHILDREN = 2 <br> <br> # <br> # Maximum number of child processes allowed. <br> # <br> MAXCHILDREN = 10 <br> <br> # <br> # Unused children to always have availale. <br> # <br> MINSPARECHILDREN = 2 <br> <br> # <br> # Maximum unused children allowed to be active. <br> # <br> MAXSPARECHILDREN = 4 <br> <br> # <br> # Child process is restarted after handling this many connections. <br> # <br> MAXCONNECTS = 10000 <br> <br> # <br> # Child process will restart after this many connection errors. <br> # <br> MAX_ERRORS = 500 <br> <br> # <br> # Idle time allowed before a connection is shut off. <br> # <br> TIMEOUT = 300 <br> <br> # <br> # Idle time allowed before a connection is shut off if you have not logged in yet. <br> # <br> login_timeout = 60 <br> <br> # <br> # If yes, resolves IP addresses to DNS names when logging. <br> # <br> RESOLVE_IP = no <br> <br> # <br> # logfile for stdout messages <br> # <br> logfile = /var/log/dbmail.log <br> <br> # <br> # logfile for stderr messages <br> # <br> errorlog = /var/log/dbmail.err <br> <br> # <br> # directory for storing PID files <br> # <br> pid_directory = /var/run <br> <br> # <br> # directory for storing the daemon statefiles <br> # <br> state_directory = /var/run <br> <br> # <br> # directory for locating libraries (normally has a sane default compiled-in) <br> # <br> #library_directory = /usr/lib/dbmail <br> <br> [SMTP] <br> # In fact, there isn't anything here by default. <br> <br> [LMTP] <br> # <br> # Port to bind to. <br> # <br> PORT = 24 <br> <br> [POP] <br> # <br> # Port to bind to. <br> # <br> PORT = 110 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by POP3. <br> # This requires addition configuration of your MTA <br> # <br> POP_BEFORE_SMTP = no <br> <br> [IMAP] <br> <br> # <br> # Port to bind to. <br> # <br> PORT = 143 <br> <br> # <br> # IMAP prefers a longer timeout than other services. <br> # <br> TIMEOUT = 4000 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by IMAP. <br> # This requires addition configuration of your MTA <br> # <br> IMAP_BEFORE_SMTP = no <br> <br> # <br> # during IDLE, how many seconds between checking the mailbox <br> # status (default: 30) <br> # <br> # idle_timeout = 30 <br> <br> # <br> # Provide a CAPABILITY to override the default <br> # <br> # capability = IMAP4 IMAP4rev1 AUTH=LOGIN ACL NAMESPACE CHILDREN SORT QUOTA THREAD=ORDEREDSUBJECT UNSELECT IDLE <br> <br> [SIEVE] <br> # <br> # Port to bind to. <br> # <br> PORT = 2000 <br> <br> [LDAP] <br> PORT = 389 <br> VERSION = 3 <br> HOSTNAME = ldap <br> BASE_DN = ou=People,dc=mydomain,dc=com <br> <br> # <br> # If your LDAP library supports ldap_initialize(), then you can use the <br> # alternative LDAP server DSN like following. <br> # <br> # URI = ldap://127.0.0.1:389 <br> # URI = ldapi://%2fvar%2frun%2fopenldap%2fldapi/ <br> <br> # <br> # Leave blank for anonymous bind. <br> # example: cn=admin,dc=mydomain,dc=com <br> # <br> BIND_DN = <br> <br> # <br> # Leave blank for anonymous bind. <br> # <br> BIND_PW = <br> SCOPE = SubTree <br> USER_OBJECTCLASS = top,account,dbmailUser <br> FORW_OBJECTCLASS = top,account,dbmailForwardingAddress <br> CN_STRING = uid <br> FIELD_PASSWD = userPassword <br> FIELD_UID = uid <br> FIELD_NID = uidNumber <br> MIN_NID = 10000 <br> MAX_NID = 15000 <br> FIELD_CID = gidNumber <br> MIN_CID = 10000 <br> MAX_CID = 15000 <br> FIELD_MAIL = mail <br> FIELD_QUOTA = mailQuota <br> FIELD_FWDTARGET = mailForwardingAddress <br> <br> [DELIVERY] <br> # <br> # Run Sieve scripts as messages are delivered. <br> # <br> SIEVE = yes <br> <br> # <br> # Use 'user+mailbox@domain' format to deliver to a mailbox. <br> # <br> SUBADDRESS = yes <br> <br> # <br> # Turn on/off the Sieve Vacation extension. <br> # <br> SIEVE_VACATION = yes <br> <br> # <br> # Turn on/off the Sieve Notify extension <br> # <br> SIEVE_NOTIFY = yes <br> <br> # <br> # Turn on/off additional Sieve debugging. <br> # <br> SIEVE_DEBUG = no <br> <br> # <br> # Use the auto_notify table to send email notifications. <br> # <br> AUTO_NOTIFY = no <br> <br> # <br> # Use the auto_reply table to send away messages. <br> # <br> AUTO_REPLY = no <br> # <br> # Defaults to "NEW MAIL NOTIFICATION" <br> # <br> #AUTO_NOTIFY_SUBJECT = <br> <br> # <br> # Defaults to POSTMASTER from the DBMAIL section. <br> # <br> #AUTO_NOTIFY_SENDER = <br> <br> # <br> # If you set this to 'yes' dbmail will check for duplicate <br> # messages in the relevant mailbox during delivery using <br> # the Message-ID header <br> # <br> suppress_duplicates = no <br> <br> # end of configuration file <br> <br> <br> <br> <br> Spamassassin <br>    ,         ,          /etc/spamasassin,      ,       nobody <br> <br> local.cf <br> <code>rewrite_header Subject ***SPAM*** <br> report_safe 1 <br> trusted_networks 192.168/16 127/8 <br> # lock_method flock <br> required_score 5.0 <br> use_bayes 1 <br> bayes_auto_learn 1 <br> # bayes_ignore_header X-Bogosity <br> # bayes_ignore_header X-Spam-Flag <br> # bayes_ignore_header X-Spam-Status <br> auto_whitelist_path /etc/mail/spamassassin/auto_whitelist <br> bayes_path /etc/mail/spamassassin/bayes <br> bayes_file_mode 0666 <br> bayes_min_ham_num 1 <br> bayes_min_spam_num 1 <br> auto_learn_threshold_nonspam -2 <br> auto_learn_threshold_spam 5 <br> bayes_learn_to_journal 1 <br> skip_rbl_checks 0 <br> <br> ok_languages ru en <br> ok_locales ru en <br></code> <br> <br>    ..     <br> <code>/etc/init.d/exim start <br> /etc/init.d/spamd start <br> #    pop3      <br> /etc/init.d/dbmail-pop3d <br></code> <br> <br>     ,           <br> <code>rc-update add postgresql default <br> rc-update add exim default <br> rc-update add spamd default <br> rc-update add dbmail-pop3d default <br></code> <br> <br>          ,       <br> <code>dbmail-users -a admin@example.com -s admin@example.com -p plaintext -w 123123 <br></code> <br> <br>   ,        <br></code></code> </blockquote> <code><code><a href="http://njabl.org/"></a> <a href="http://www.spamcop.net/w3m%3Faction%3Dcheckblock%26ip%3D"></a> <font color="black">CREATE TYPE dtype AS ENUM ( <br> <font color="#A31515">'LOCAL'</font> , <br> <font color="#A31515">'VIRTUAL'</font> , <br> <font color="#A31515">'RELAY'</font> <br> ); <br> <br> ALTER TYPE <font color="#0000ff">public</font> .dtype OWNER TO dbmail; <br> <br> SET default_with_oids = <font color="#0000ff">true</font> ; <br> <br> CREATE TABLE dbmail_domains ( <br> uid integer NOT NULL, <br> domain character varying(128) NOT NULL, <br> type dtype NOT NULL <br> ); <br> <br> INSERT INTO dbmail_domains (uid, domain, type) VALUES (1, <font color="#A31515">'example.com'</font> , <font color="#A31515">'LOCAL'</font> );</font> <br>   . <br> <br> Exim <br> C   exim.conf <br> #!/bin/sh <br> ###################################################################### <br> # Runtime configuration file for Exim # <br> ###################################################################### <br> ####################################################################### <br> # MAIN CONFIGURATION SETTINGS # <br> ###################################################################### <br> <br> primary_hostname = example.com <br> domainlist local_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND \ <br> (type='LOCAL' OR type='VIRTUAL')}} <br> domainlist relay_to_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND type='RELAY'}} <br> hostlist relay_from_hosts = 127.0.0.1: localhost <br> auth_advertise_hosts = * <br> daemon_smtp_ports = 25 <br> log_selector = \ <br> +all_parents \ <br> +lost_incoming_connection \ <br> +received_sender \ <br> +received_recipients \ <br> +smtp_confirmation \ <br> +smtp_syntax_error \ <br> +smtp_protocol_error \ <br> -queue_run <br> acl_smtp_rcpt = acl_check_rcpt <br> acl_smtp_mime = acl_check_mime <br> acl_smtp_data = acl_check_content <br> qualify_domain = example.com <br> allow_domain_literals = false <br> exim_user = mail <br> exim_group = mail <br> never_users = root <br> host_lookup = * <br> #rfc1413_hosts = * <br> rfc1413_query_timeout = 0s <br> ignore_bounce_errors_after = 30m <br> timeout_frozen_after = 3d <br> freeze_tell = postmaster <br> <br> #av_scanner = clamd:/var/run/clamav/clamd.ctl #        <br> spamd_address = 127.0.0.1 783 <br> <br> message_size_limit = 10M <br> smtp_accept_max = 1000 <br> smtp_accept_max_per_connection = 150 <br> smtp_accept_max_per_host = 30 <br> split_spool_directory = true <br> remote_max_parallel = 15 <br> smtp_banner = "Welcome on our mail server!\n\ <br> This system does not accept Unsolicited \ <br> Commercial Email\nand will blacklist \ <br> offenders via our spam processor.\nHave a \ <br> nice day!\n\n${primary_hostname} ESMTP" <br> <br> hide pgsql_servers = localhost/dbmail/dbmail/PasSWorD <br> <br> ###################################################################### <br> # ACL CONFIGURATION # <br> # Specifies access control lists for incoming SMTP mail # <br> ###################################################################### <br> begin acl <br> <br> acl_check_rcpt: <br> <br> warn <br> set acl_m0 = 0s <br> warn <br> hosts = !+relay_from_hosts:!213.243.111.115/32 <br> set acl_m0 = 30s <br> warn <br> condition = ${if and {\ <br> {match{$sender_host_name}\ <br> {\N^[-az]*\d{0,3}[-az]*\.?[-az]*\d{0,3}[-az]*\.\w+$\N}} \ <br> {!eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 1s <br> <br> warn <br> condition = ${if and {\ <br> {match{$sender_helo_name}{\N^\w*\.\w{3}$\N}} \ <br> {eq{$acl_c1}{}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c2}{outblaze_domain}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if or {\ <br> {eq{$sender_address}{}} \ <br> {eq{$acl_m1}{0s}} \ <br> } {yes}{no}} <br> set acl_m0 = 0s <br> <br> warn <br> logwrite = Delay $acl_m0 for $sender_host_name \ <br> [$sender_host_address] with HELO=$sender_helo_name. \ <br> Mail from $sender_address to $local_part@$domain. <br> set acl_m1 = 0s <br> delay = $acl_m0 <br> <br> accept hosts = : <br> <br> deny domains = +local_domains <br> local_parts = ^[.] : ^.*[@%!/|] <br> <br> deny domains = !+local_domains <br> local_parts = ^[./|] : ^.*[@%!] : ^.*/\\.\\./ <br> <br> accept local_parts = postmaster <br> domains = +local_domains <br> <br> require verify = sender <br> <br> deny message = HELO/EHLO required by SMTP RFC <br> condition = ${if eq{$sender_helo_name}{}{yes}{no}} <br> <br> deny message = Go Away! You are spammer. <br> condition = ${if match{$sender_host_name} \ <br> {bezeqint\\.net|net\\.il|dialup|dsl|pool|peer|dhcp} \ <br> {yes}{no}} <br> <br> deny message = message from \ <br> $sender_host_address rejected - see njabl.org <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.njabl.org <br> <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dialups.mail-abuse.org <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = list.dsbl.org <br> deny message = Spam blocked see: \ <br> www.spamcop.net/w3m?action=checkblock&amp;ip=$sender_host_address <br> log_message = found in $dnslist_domain <br> dnslists = bl.spamcop.net <br> deny message = rejected, $sender_host_address \ <br> Open Proxy, see: $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.void.ru <br> <br> accept domains = +local_domains <br> endpass <br> message = unknown user <br> verify = recipient <br> <br> accept domains = +relay_to_domains <br> endpass <br> message = unrouteable address <br> verify = recipient <br> <br> accept hosts = +relay_from_hosts <br> accept authenticated = * <br> deny message = relay not permitted <br> <br> acl_check_mime: <br> <br> warn decode = default <br> <br> deny message = Blacklisted file extension detected ($mime_filename) <br> condition = ${if match \ <br> {${lc:$mime_filename}} \ <br> {\N(\.exe|\.pif|\.bat|\.scr|\.lnk|\.com|\.vbs|\.cpl)$\N} \ <br> {1}{0}} <br> <br> deny message = Sorry, noone speaks chinese here <br> condition = ${if eq{$mime_charset}{gb2312}{1}{0}} <br> <br> accept <br> <br> acl_check_content: <br> # deny message = Virus found ($malware_name) <br> # malware = * <br> <br> warn message = X-Spam-Score: $spam_score ($spam_bar) <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = X-Spam-Report: $spam_report <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = Subject: ***SPAM*** $h_Subject: <br> hosts = !+relay_from_hosts <br> spam = spamd <br> <br> deny message = This message scored $spam_score spam points. <br> spam = spamd:true <br> hosts = !+relay_from_hosts <br> condition = ${if &gt;{$spam_score_int}{120}{1}{0}} <br> <br> accept <br> <br> ###################################################################### <br> # ROUTERS CONFIGURATION # <br> # Specifies how addresses are handled # <br> ###################################################################### <br> # THE ORDER IN WHICH THE ROUTERS ARE DEFINED IS IMPORTANT! # <br> # An address is passed to each router in turn until it is accepted. # <br> ###################################################################### <br> <br> begin routers <br> <br> dnslookup: <br> driver = dnslookup <br> domains = ! +local_domains <br> transport = remote_smtp <br> ignore_target_hosts = 0.0.0.0 : 127.0.0.0/8 <br> no_more <br> <br> dbmailuser: <br> driver = accept <br> condition = ${lookup pgsql{SELECT alias_idnr FROM \ <br> dbmail_aliases WHERE \ <br> alias='${quote_pgsql:$local_part@$domain}' OR \ <br> alias='${quote_pgsql:@$domain}'}{yes}{no}} <br> transport = dbmail_delivery <br> <br> ###################################################################### <br> # TRANSPORTS CONFIGURATION # <br> ###################################################################### <br> # ORDER DOES NOT MATTER # <br> # Only one appropriate transport is called for each delivery. # <br> ###################################################################### <br> <br> begin transports <br> <br> remote_smtp: <br> driver = smtp <br> <br> dbmail_delivery: <br> driver = pipe <br> check_string = <br> command = /usr/sbin/dbmail-smtp -d ${pipe_addresses} <br> group = mail <br> message_prefix = "" <br> message_suffix = "" <br> path="/bin:/sbin:/usr/bin:/usr/sbin" <br> #   <br> address_pipe: <br> driver = pipe <br> return_output <br> <br> address_reply: <br> driver = autoreply <br> <br> ###################################################################### <br> # RETRY CONFIGURATION # <br> ###################################################################### <br> <br> begin retry <br> <br> * quota <br> * * F,2h,15m; G,16h,1h,1.5; F,4d,6h <br> <br> ###################################################################### <br> # REWRITE CONFIGURATION # <br> ###################################################################### <br> <br> begin rewrite <br> <br> ###################################################################### <br> # AUTHENTICATION CONFIGURATION # <br> ###################################################################### <br> <br> begin authenticators <br> <br> auth_plain: <br> driver = plaintext <br> public_name = PLAIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = : <br> server_set_id = $2 <br> <br> #    ,    . <br> auth_login: <br> driver = plaintext <br> public_name = LOGIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = Username:: : Password:: <br> server_set_id = $1 <br> <br> #    " " - TheBat! <br> auth_cram_md5: <br> driver = cram_md5 <br> public_name = CRAM-MD5 <br> server_secret = ${lookup pgsql{SELECT passwd FROM \ <br> dbmail_users WHERE userid \ <br> = '${quote_pgsql:$1}'}{$value}fail} <br> server_set_id = $1 <br> # End of Exim configuration file <br> ###ps  lissyara,       <br> <br></code> <br> <br> DBMail <br> dbmail.conf          <br> <code># (c) 2000-2006 IC&amp;S, The Netherlands <br> # <br> # Configuration file for DBMAIL <br> <br> [DBMAIL] <br> # <br> # Database settings <br> # <br> <br> # <br> # Supported drivers are mysql, pgsql, sqlite. <br> # <br> driver =pgsql <br> <br> # <br> # Supported drivers are sql, ldap. <br> # <br> authdriver =sql <br> <br> # <br> # Host for database, set to localhost if database is on <br> # the same host as dbmail and you want to use a local <br> # socket for connecting. <br> # <br> host =localhost <br> <br> # <br> # If you want to use TCP/IP for connecting to the database, <br> # and have the database running on a non-standard port. <br> # <br> sqlport =5432 <br> <br> # <br> # When using a local socket connection to the database, fill <br> # in the path to the socket here (eg /var/run/mysql.sock). <br> # <br> sqlsocket = <br> <br> # <br> # Database username. <br> # <br> user =dbmail <br> <br> # <br> # Database password. <br> # <br> pass =PasWoRd <br> <br> # <br> # Database name. <br> # <br> db =dbmail <br> <br> # <br> # Table prefix. Defaults to "dbmail_" if not specified. <br> # <br> table_prefix =dbmail_ <br> <br> # <br> # encoding must match the database/table encoding. <br> # ie latin1, utf8 <br> encoding = utf8 <br> <br> # <br> # messages with unknown encoding will be assumed to have <br> # default_msg_encoding <br> # ie iso8859-1, utf8 <br> default_msg_encoding = utf8 <br> <br> # <br> # Postmaster's email address for use in bounce messages. <br> # <br> #postmaster = DBMAIL-MAILER <br> <br> # <br> # Sendmail executable for forwards, replies, notifies, vacations. <br> # You may use pipes (|) in this command, for example: <br> # dos2unix|/usr/sbin/sendmail works well with Qmail. <br> # You may use quotes (") for executables with unusual names. <br> # <br> sendmail = /usr/sbin/sendmail <br> <br> # <br> # <br> # The following items can be overridden in the service-specific sections. <br> # <br> # <br> <br> # <br> # Trace level to send to syslog. Default is 2 (messages, errors, fatals). <br> # <br> TRACE_SYSLOG = 3 <br> <br> # <br> # Trace level to send to stderr. Default is 0 (fatals). <br> # <br> TRACE_STDERR = 1 <br> <br> # <br> # Root privs are used to open a port, then privs <br> # are dropped down to the user/group specified here. <br> # <br> EFFECTIVE_USER = dbmail <br> EFFECTIVE_GROUP = dbmail <br> <br> # <br> # The IP addresses the services will bind to. <br> # Use * for all local interfaces. <br> # Use 127.0.0.1 for localhost only. <br> # Separate multiple entries with spaces ( ) or commas (,). <br> # <br> BINDIP = * <br> <br> # <br> # Default number of child processes to start. <br> # <br> NCHILDREN = 2 <br> <br> # <br> # Maximum number of child processes allowed. <br> # <br> MAXCHILDREN = 10 <br> <br> # <br> # Unused children to always have availale. <br> # <br> MINSPARECHILDREN = 2 <br> <br> # <br> # Maximum unused children allowed to be active. <br> # <br> MAXSPARECHILDREN = 4 <br> <br> # <br> # Child process is restarted after handling this many connections. <br> # <br> MAXCONNECTS = 10000 <br> <br> # <br> # Child process will restart after this many connection errors. <br> # <br> MAX_ERRORS = 500 <br> <br> # <br> # Idle time allowed before a connection is shut off. <br> # <br> TIMEOUT = 300 <br> <br> # <br> # Idle time allowed before a connection is shut off if you have not logged in yet. <br> # <br> login_timeout = 60 <br> <br> # <br> # If yes, resolves IP addresses to DNS names when logging. <br> # <br> RESOLVE_IP = no <br> <br> # <br> # logfile for stdout messages <br> # <br> logfile = /var/log/dbmail.log <br> <br> # <br> # logfile for stderr messages <br> # <br> errorlog = /var/log/dbmail.err <br> <br> # <br> # directory for storing PID files <br> # <br> pid_directory = /var/run <br> <br> # <br> # directory for storing the daemon statefiles <br> # <br> state_directory = /var/run <br> <br> # <br> # directory for locating libraries (normally has a sane default compiled-in) <br> # <br> #library_directory = /usr/lib/dbmail <br> <br> [SMTP] <br> # In fact, there isn't anything here by default. <br> <br> [LMTP] <br> # <br> # Port to bind to. <br> # <br> PORT = 24 <br> <br> [POP] <br> # <br> # Port to bind to. <br> # <br> PORT = 110 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by POP3. <br> # This requires addition configuration of your MTA <br> # <br> POP_BEFORE_SMTP = no <br> <br> [IMAP] <br> <br> # <br> # Port to bind to. <br> # <br> PORT = 143 <br> <br> # <br> # IMAP prefers a longer timeout than other services. <br> # <br> TIMEOUT = 4000 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by IMAP. <br> # This requires addition configuration of your MTA <br> # <br> IMAP_BEFORE_SMTP = no <br> <br> # <br> # during IDLE, how many seconds between checking the mailbox <br> # status (default: 30) <br> # <br> # idle_timeout = 30 <br> <br> # <br> # Provide a CAPABILITY to override the default <br> # <br> # capability = IMAP4 IMAP4rev1 AUTH=LOGIN ACL NAMESPACE CHILDREN SORT QUOTA THREAD=ORDEREDSUBJECT UNSELECT IDLE <br> <br> [SIEVE] <br> # <br> # Port to bind to. <br> # <br> PORT = 2000 <br> <br> [LDAP] <br> PORT = 389 <br> VERSION = 3 <br> HOSTNAME = ldap <br> BASE_DN = ou=People,dc=mydomain,dc=com <br> <br> # <br> # If your LDAP library supports ldap_initialize(), then you can use the <br> # alternative LDAP server DSN like following. <br> # <br> # URI = ldap://127.0.0.1:389 <br> # URI = ldapi://%2fvar%2frun%2fopenldap%2fldapi/ <br> <br> # <br> # Leave blank for anonymous bind. <br> # example: cn=admin,dc=mydomain,dc=com <br> # <br> BIND_DN = <br> <br> # <br> # Leave blank for anonymous bind. <br> # <br> BIND_PW = <br> SCOPE = SubTree <br> USER_OBJECTCLASS = top,account,dbmailUser <br> FORW_OBJECTCLASS = top,account,dbmailForwardingAddress <br> CN_STRING = uid <br> FIELD_PASSWD = userPassword <br> FIELD_UID = uid <br> FIELD_NID = uidNumber <br> MIN_NID = 10000 <br> MAX_NID = 15000 <br> FIELD_CID = gidNumber <br> MIN_CID = 10000 <br> MAX_CID = 15000 <br> FIELD_MAIL = mail <br> FIELD_QUOTA = mailQuota <br> FIELD_FWDTARGET = mailForwardingAddress <br> <br> [DELIVERY] <br> # <br> # Run Sieve scripts as messages are delivered. <br> # <br> SIEVE = yes <br> <br> # <br> # Use 'user+mailbox@domain' format to deliver to a mailbox. <br> # <br> SUBADDRESS = yes <br> <br> # <br> # Turn on/off the Sieve Vacation extension. <br> # <br> SIEVE_VACATION = yes <br> <br> # <br> # Turn on/off the Sieve Notify extension <br> # <br> SIEVE_NOTIFY = yes <br> <br> # <br> # Turn on/off additional Sieve debugging. <br> # <br> SIEVE_DEBUG = no <br> <br> # <br> # Use the auto_notify table to send email notifications. <br> # <br> AUTO_NOTIFY = no <br> <br> # <br> # Use the auto_reply table to send away messages. <br> # <br> AUTO_REPLY = no <br> # <br> # Defaults to "NEW MAIL NOTIFICATION" <br> # <br> #AUTO_NOTIFY_SUBJECT = <br> <br> # <br> # Defaults to POSTMASTER from the DBMAIL section. <br> # <br> #AUTO_NOTIFY_SENDER = <br> <br> # <br> # If you set this to 'yes' dbmail will check for duplicate <br> # messages in the relevant mailbox during delivery using <br> # the Message-ID header <br> # <br> suppress_duplicates = no <br> <br> # end of configuration file <br> <br> <br></code> <br> <br> Spamassassin <br>    ,         ,          /etc/spamasassin,      ,       nobody <br> <br> local.cf <br> <code>rewrite_header Subject ***SPAM*** <br> report_safe 1 <br> trusted_networks 192.168/16 127/8 <br> # lock_method flock <br> required_score 5.0 <br> use_bayes 1 <br> bayes_auto_learn 1 <br> # bayes_ignore_header X-Bogosity <br> # bayes_ignore_header X-Spam-Flag <br> # bayes_ignore_header X-Spam-Status <br> auto_whitelist_path /etc/mail/spamassassin/auto_whitelist <br> bayes_path /etc/mail/spamassassin/bayes <br> bayes_file_mode 0666 <br> bayes_min_ham_num 1 <br> bayes_min_spam_num 1 <br> auto_learn_threshold_nonspam -2 <br> auto_learn_threshold_spam 5 <br> bayes_learn_to_journal 1 <br> skip_rbl_checks 0 <br> <br> ok_languages ru en <br> ok_locales ru en <br></code> <br> <br>    ..     <br> <code>/etc/init.d/exim start <br> /etc/init.d/spamd start <br> #    pop3      <br> /etc/init.d/dbmail-pop3d <br></code> <br> <br>     ,           <br> <code>rc-update add postgresql default <br> rc-update add exim default <br> rc-update add spamd default <br> rc-update add dbmail-pop3d default <br></code> <br> <br>          ,       <br> <code>dbmail-users -a admin@example.com -s admin@example.com -p plaintext -w 123123 <br></code> <br> <br>   ,        <br></code> <h2> <code><code><a href="http://njabl.org/"></a> <a href="http://www.spamcop.net/w3m%3Faction%3Dcheckblock%26ip%3D"></a> <font color="black">CREATE TYPE dtype AS ENUM ( <br> <font color="#A31515">'LOCAL'</font> , <br> <font color="#A31515">'VIRTUAL'</font> , <br> <font color="#A31515">'RELAY'</font> <br> ); <br> <br> ALTER TYPE <font color="#0000ff">public</font> .dtype OWNER TO dbmail; <br> <br> SET default_with_oids = <font color="#0000ff">true</font> ; <br> <br> CREATE TABLE dbmail_domains ( <br> uid integer NOT NULL, <br> domain character varying(128) NOT NULL, <br> type dtype NOT NULL <br> ); <br> <br> INSERT INTO dbmail_domains (uid, domain, type) VALUES (1, <font color="#A31515">'example.com'</font> , <font color="#A31515">'LOCAL'</font> );</font> <br>   . <br> <br> Exim <br> C   exim.conf <br> #!/bin/sh <br> ###################################################################### <br> # Runtime configuration file for Exim # <br> ###################################################################### <br> ####################################################################### <br> # MAIN CONFIGURATION SETTINGS # <br> ###################################################################### <br> <br> primary_hostname = example.com <br> domainlist local_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND \ <br> (type='LOCAL' OR type='VIRTUAL')}} <br> domainlist relay_to_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND type='RELAY'}} <br> hostlist relay_from_hosts = 127.0.0.1: localhost <br> auth_advertise_hosts = * <br> daemon_smtp_ports = 25 <br> log_selector = \ <br> +all_parents \ <br> +lost_incoming_connection \ <br> +received_sender \ <br> +received_recipients \ <br> +smtp_confirmation \ <br> +smtp_syntax_error \ <br> +smtp_protocol_error \ <br> -queue_run <br> acl_smtp_rcpt = acl_check_rcpt <br> acl_smtp_mime = acl_check_mime <br> acl_smtp_data = acl_check_content <br> qualify_domain = example.com <br> allow_domain_literals = false <br> exim_user = mail <br> exim_group = mail <br> never_users = root <br> host_lookup = * <br> #rfc1413_hosts = * <br> rfc1413_query_timeout = 0s <br> ignore_bounce_errors_after = 30m <br> timeout_frozen_after = 3d <br> freeze_tell = postmaster <br> <br> #av_scanner = clamd:/var/run/clamav/clamd.ctl #        <br> spamd_address = 127.0.0.1 783 <br> <br> message_size_limit = 10M <br> smtp_accept_max = 1000 <br> smtp_accept_max_per_connection = 150 <br> smtp_accept_max_per_host = 30 <br> split_spool_directory = true <br> remote_max_parallel = 15 <br> smtp_banner = "Welcome on our mail server!\n\ <br> This system does not accept Unsolicited \ <br> Commercial Email\nand will blacklist \ <br> offenders via our spam processor.\nHave a \ <br> nice day!\n\n${primary_hostname} ESMTP" <br> <br> hide pgsql_servers = localhost/dbmail/dbmail/PasSWorD <br> <br> ###################################################################### <br> # ACL CONFIGURATION # <br> # Specifies access control lists for incoming SMTP mail # <br> ###################################################################### <br> begin acl <br> <br> acl_check_rcpt: <br> <br> warn <br> set acl_m0 = 0s <br> warn <br> hosts = !+relay_from_hosts:!213.243.111.115/32 <br> set acl_m0 = 30s <br> warn <br> condition = ${if and {\ <br> {match{$sender_host_name}\ <br> {\N^[-az]*\d{0,3}[-az]*\.?[-az]*\d{0,3}[-az]*\.\w+$\N}} \ <br> {!eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 1s <br> <br> warn <br> condition = ${if and {\ <br> {match{$sender_helo_name}{\N^\w*\.\w{3}$\N}} \ <br> {eq{$acl_c1}{}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c2}{outblaze_domain}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if or {\ <br> {eq{$sender_address}{}} \ <br> {eq{$acl_m1}{0s}} \ <br> } {yes}{no}} <br> set acl_m0 = 0s <br> <br> warn <br> logwrite = Delay $acl_m0 for $sender_host_name \ <br> [$sender_host_address] with HELO=$sender_helo_name. \ <br> Mail from $sender_address to $local_part@$domain. <br> set acl_m1 = 0s <br> delay = $acl_m0 <br> <br> accept hosts = : <br> <br> deny domains = +local_domains <br> local_parts = ^[.] : ^.*[@%!/|] <br> <br> deny domains = !+local_domains <br> local_parts = ^[./|] : ^.*[@%!] : ^.*/\\.\\./ <br> <br> accept local_parts = postmaster <br> domains = +local_domains <br> <br> require verify = sender <br> <br> deny message = HELO/EHLO required by SMTP RFC <br> condition = ${if eq{$sender_helo_name}{}{yes}{no}} <br> <br> deny message = Go Away! You are spammer. <br> condition = ${if match{$sender_host_name} \ <br> {bezeqint\\.net|net\\.il|dialup|dsl|pool|peer|dhcp} \ <br> {yes}{no}} <br> <br> deny message = message from \ <br> $sender_host_address rejected - see njabl.org <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.njabl.org <br> <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dialups.mail-abuse.org <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = list.dsbl.org <br> deny message = Spam blocked see: \ <br> www.spamcop.net/w3m?action=checkblock&amp;ip=$sender_host_address <br> log_message = found in $dnslist_domain <br> dnslists = bl.spamcop.net <br> deny message = rejected, $sender_host_address \ <br> Open Proxy, see: $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.void.ru <br> <br> accept domains = +local_domains <br> endpass <br> message = unknown user <br> verify = recipient <br> <br> accept domains = +relay_to_domains <br> endpass <br> message = unrouteable address <br> verify = recipient <br> <br> accept hosts = +relay_from_hosts <br> accept authenticated = * <br> deny message = relay not permitted <br> <br> acl_check_mime: <br> <br> warn decode = default <br> <br> deny message = Blacklisted file extension detected ($mime_filename) <br> condition = ${if match \ <br> {${lc:$mime_filename}} \ <br> {\N(\.exe|\.pif|\.bat|\.scr|\.lnk|\.com|\.vbs|\.cpl)$\N} \ <br> {1}{0}} <br> <br> deny message = Sorry, noone speaks chinese here <br> condition = ${if eq{$mime_charset}{gb2312}{1}{0}} <br> <br> accept <br> <br> acl_check_content: <br> # deny message = Virus found ($malware_name) <br> # malware = * <br> <br> warn message = X-Spam-Score: $spam_score ($spam_bar) <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = X-Spam-Report: $spam_report <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = Subject: ***SPAM*** $h_Subject: <br> hosts = !+relay_from_hosts <br> spam = spamd <br> <br> deny message = This message scored $spam_score spam points. <br> spam = spamd:true <br> hosts = !+relay_from_hosts <br> condition = ${if &gt;{$spam_score_int}{120}{1}{0}} <br> <br> accept <br> <br> ###################################################################### <br> # ROUTERS CONFIGURATION # <br> # Specifies how addresses are handled # <br> ###################################################################### <br> # THE ORDER IN WHICH THE ROUTERS ARE DEFINED IS IMPORTANT! # <br> # An address is passed to each router in turn until it is accepted. # <br> ###################################################################### <br> <br> begin routers <br> <br> dnslookup: <br> driver = dnslookup <br> domains = ! +local_domains <br> transport = remote_smtp <br> ignore_target_hosts = 0.0.0.0 : 127.0.0.0/8 <br> no_more <br> <br> dbmailuser: <br> driver = accept <br> condition = ${lookup pgsql{SELECT alias_idnr FROM \ <br> dbmail_aliases WHERE \ <br> alias='${quote_pgsql:$local_part@$domain}' OR \ <br> alias='${quote_pgsql:@$domain}'}{yes}{no}} <br> transport = dbmail_delivery <br> <br> ###################################################################### <br> # TRANSPORTS CONFIGURATION # <br> ###################################################################### <br> # ORDER DOES NOT MATTER # <br> # Only one appropriate transport is called for each delivery. # <br> ###################################################################### <br> <br> begin transports <br> <br> remote_smtp: <br> driver = smtp <br> <br> dbmail_delivery: <br> driver = pipe <br> check_string = <br> command = /usr/sbin/dbmail-smtp -d ${pipe_addresses} <br> group = mail <br> message_prefix = "" <br> message_suffix = "" <br> path="/bin:/sbin:/usr/bin:/usr/sbin" <br> #   <br> address_pipe: <br> driver = pipe <br> return_output <br> <br> address_reply: <br> driver = autoreply <br> <br> ###################################################################### <br> # RETRY CONFIGURATION # <br> ###################################################################### <br> <br> begin retry <br> <br> * quota <br> * * F,2h,15m; G,16h,1h,1.5; F,4d,6h <br> <br> ###################################################################### <br> # REWRITE CONFIGURATION # <br> ###################################################################### <br> <br> begin rewrite <br> <br> ###################################################################### <br> # AUTHENTICATION CONFIGURATION # <br> ###################################################################### <br> <br> begin authenticators <br> <br> auth_plain: <br> driver = plaintext <br> public_name = PLAIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = : <br> server_set_id = $2 <br> <br> #    ,    . <br> auth_login: <br> driver = plaintext <br> public_name = LOGIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = Username:: : Password:: <br> server_set_id = $1 <br> <br> #    " " - TheBat! <br> auth_cram_md5: <br> driver = cram_md5 <br> public_name = CRAM-MD5 <br> server_secret = ${lookup pgsql{SELECT passwd FROM \ <br> dbmail_users WHERE userid \ <br> = '${quote_pgsql:$1}'}{$value}fail} <br> server_set_id = $1 <br> # End of Exim configuration file <br> ###ps  lissyara,       <br> <br></code> <br> <br> DBMail <br> dbmail.conf          <br> <code># (c) 2000-2006 IC&amp;S, The Netherlands <br> # <br> # Configuration file for DBMAIL <br> <br> [DBMAIL] <br> # <br> # Database settings <br> # <br> <br> # <br> # Supported drivers are mysql, pgsql, sqlite. <br> # <br> driver =pgsql <br> <br> # <br> # Supported drivers are sql, ldap. <br> # <br> authdriver =sql <br> <br> # <br> # Host for database, set to localhost if database is on <br> # the same host as dbmail and you want to use a local <br> # socket for connecting. <br> # <br> host =localhost <br> <br> # <br> # If you want to use TCP/IP for connecting to the database, <br> # and have the database running on a non-standard port. <br> # <br> sqlport =5432 <br> <br> # <br> # When using a local socket connection to the database, fill <br> # in the path to the socket here (eg /var/run/mysql.sock). <br> # <br> sqlsocket = <br> <br> # <br> # Database username. <br> # <br> user =dbmail <br> <br> # <br> # Database password. <br> # <br> pass =PasWoRd <br> <br> # <br> # Database name. <br> # <br> db =dbmail <br> <br> # <br> # Table prefix. Defaults to "dbmail_" if not specified. <br> # <br> table_prefix =dbmail_ <br> <br> # <br> # encoding must match the database/table encoding. <br> # ie latin1, utf8 <br> encoding = utf8 <br> <br> # <br> # messages with unknown encoding will be assumed to have <br> # default_msg_encoding <br> # ie iso8859-1, utf8 <br> default_msg_encoding = utf8 <br> <br> # <br> # Postmaster's email address for use in bounce messages. <br> # <br> #postmaster = DBMAIL-MAILER <br> <br> # <br> # Sendmail executable for forwards, replies, notifies, vacations. <br> # You may use pipes (|) in this command, for example: <br> # dos2unix|/usr/sbin/sendmail works well with Qmail. <br> # You may use quotes (") for executables with unusual names. <br> # <br> sendmail = /usr/sbin/sendmail <br> <br> # <br> # <br> # The following items can be overridden in the service-specific sections. <br> # <br> # <br> <br> # <br> # Trace level to send to syslog. Default is 2 (messages, errors, fatals). <br> # <br> TRACE_SYSLOG = 3 <br> <br> # <br> # Trace level to send to stderr. Default is 0 (fatals). <br> # <br> TRACE_STDERR = 1 <br> <br> # <br> # Root privs are used to open a port, then privs <br> # are dropped down to the user/group specified here. <br> # <br> EFFECTIVE_USER = dbmail <br> EFFECTIVE_GROUP = dbmail <br> <br> # <br> # The IP addresses the services will bind to. <br> # Use * for all local interfaces. <br> # Use 127.0.0.1 for localhost only. <br> # Separate multiple entries with spaces ( ) or commas (,). <br> # <br> BINDIP = * <br> <br> # <br> # Default number of child processes to start. <br> # <br> NCHILDREN = 2 <br> <br> # <br> # Maximum number of child processes allowed. <br> # <br> MAXCHILDREN = 10 <br> <br> # <br> # Unused children to always have availale. <br> # <br> MINSPARECHILDREN = 2 <br> <br> # <br> # Maximum unused children allowed to be active. <br> # <br> MAXSPARECHILDREN = 4 <br> <br> # <br> # Child process is restarted after handling this many connections. <br> # <br> MAXCONNECTS = 10000 <br> <br> # <br> # Child process will restart after this many connection errors. <br> # <br> MAX_ERRORS = 500 <br> <br> # <br> # Idle time allowed before a connection is shut off. <br> # <br> TIMEOUT = 300 <br> <br> # <br> # Idle time allowed before a connection is shut off if you have not logged in yet. <br> # <br> login_timeout = 60 <br> <br> # <br> # If yes, resolves IP addresses to DNS names when logging. <br> # <br> RESOLVE_IP = no <br> <br> # <br> # logfile for stdout messages <br> # <br> logfile = /var/log/dbmail.log <br> <br> # <br> # logfile for stderr messages <br> # <br> errorlog = /var/log/dbmail.err <br> <br> # <br> # directory for storing PID files <br> # <br> pid_directory = /var/run <br> <br> # <br> # directory for storing the daemon statefiles <br> # <br> state_directory = /var/run <br> <br> # <br> # directory for locating libraries (normally has a sane default compiled-in) <br> # <br> #library_directory = /usr/lib/dbmail <br> <br> [SMTP] <br> # In fact, there isn't anything here by default. <br> <br> [LMTP] <br> # <br> # Port to bind to. <br> # <br> PORT = 24 <br> <br> [POP] <br> # <br> # Port to bind to. <br> # <br> PORT = 110 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by POP3. <br> # This requires addition configuration of your MTA <br> # <br> POP_BEFORE_SMTP = no <br> <br> [IMAP] <br> <br> # <br> # Port to bind to. <br> # <br> PORT = 143 <br> <br> # <br> # IMAP prefers a longer timeout than other services. <br> # <br> TIMEOUT = 4000 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by IMAP. <br> # This requires addition configuration of your MTA <br> # <br> IMAP_BEFORE_SMTP = no <br> <br> # <br> # during IDLE, how many seconds between checking the mailbox <br> # status (default: 30) <br> # <br> # idle_timeout = 30 <br> <br> # <br> # Provide a CAPABILITY to override the default <br> # <br> # capability = IMAP4 IMAP4rev1 AUTH=LOGIN ACL NAMESPACE CHILDREN SORT QUOTA THREAD=ORDEREDSUBJECT UNSELECT IDLE <br> <br> [SIEVE] <br> # <br> # Port to bind to. <br> # <br> PORT = 2000 <br> <br> [LDAP] <br> PORT = 389 <br> VERSION = 3 <br> HOSTNAME = ldap <br> BASE_DN = ou=People,dc=mydomain,dc=com <br> <br> # <br> # If your LDAP library supports ldap_initialize(), then you can use the <br> # alternative LDAP server DSN like following. <br> # <br> # URI = ldap://127.0.0.1:389 <br> # URI = ldapi://%2fvar%2frun%2fopenldap%2fldapi/ <br> <br> # <br> # Leave blank for anonymous bind. <br> # example: cn=admin,dc=mydomain,dc=com <br> # <br> BIND_DN = <br> <br> # <br> # Leave blank for anonymous bind. <br> # <br> BIND_PW = <br> SCOPE = SubTree <br> USER_OBJECTCLASS = top,account,dbmailUser <br> FORW_OBJECTCLASS = top,account,dbmailForwardingAddress <br> CN_STRING = uid <br> FIELD_PASSWD = userPassword <br> FIELD_UID = uid <br> FIELD_NID = uidNumber <br> MIN_NID = 10000 <br> MAX_NID = 15000 <br> FIELD_CID = gidNumber <br> MIN_CID = 10000 <br> MAX_CID = 15000 <br> FIELD_MAIL = mail <br> FIELD_QUOTA = mailQuota <br> FIELD_FWDTARGET = mailForwardingAddress <br> <br> [DELIVERY] <br> # <br> # Run Sieve scripts as messages are delivered. <br> # <br> SIEVE = yes <br> <br> # <br> # Use 'user+mailbox@domain' format to deliver to a mailbox. <br> # <br> SUBADDRESS = yes <br> <br> # <br> # Turn on/off the Sieve Vacation extension. <br> # <br> SIEVE_VACATION = yes <br> <br> # <br> # Turn on/off the Sieve Notify extension <br> # <br> SIEVE_NOTIFY = yes <br> <br> # <br> # Turn on/off additional Sieve debugging. <br> # <br> SIEVE_DEBUG = no <br> <br> # <br> # Use the auto_notify table to send email notifications. <br> # <br> AUTO_NOTIFY = no <br> <br> # <br> # Use the auto_reply table to send away messages. <br> # <br> AUTO_REPLY = no <br> # <br> # Defaults to "NEW MAIL NOTIFICATION" <br> # <br> #AUTO_NOTIFY_SUBJECT = <br> <br> # <br> # Defaults to POSTMASTER from the DBMAIL section. <br> # <br> #AUTO_NOTIFY_SENDER = <br> <br> # <br> # If you set this to 'yes' dbmail will check for duplicate <br> # messages in the relevant mailbox during delivery using <br> # the Message-ID header <br> # <br> suppress_duplicates = no <br> <br> # end of configuration file <br> <br> <br></code> <br> <br> Spamassassin <br>    ,         ,          /etc/spamasassin,      ,       nobody <br> <br> local.cf <br> <code>rewrite_header Subject ***SPAM*** <br> report_safe 1 <br> trusted_networks 192.168/16 127/8 <br> # lock_method flock <br> required_score 5.0 <br> use_bayes 1 <br> bayes_auto_learn 1 <br> # bayes_ignore_header X-Bogosity <br> # bayes_ignore_header X-Spam-Flag <br> # bayes_ignore_header X-Spam-Status <br> auto_whitelist_path /etc/mail/spamassassin/auto_whitelist <br> bayes_path /etc/mail/spamassassin/bayes <br> bayes_file_mode 0666 <br> bayes_min_ham_num 1 <br> bayes_min_spam_num 1 <br> auto_learn_threshold_nonspam -2 <br> auto_learn_threshold_spam 5 <br> bayes_learn_to_journal 1 <br> skip_rbl_checks 0 <br> <br> ok_languages ru en <br> ok_locales ru en <br></code> <br> <br>    ..     <br> <code>/etc/init.d/exim start <br> /etc/init.d/spamd start <br> #    pop3      <br> /etc/init.d/dbmail-pop3d <br></code> <br> <br>     ,           <br> <code>rc-update add postgresql default <br> rc-update add exim default <br> rc-update add spamd default <br> rc-update add dbmail-pop3d default <br></code> <br> <br>          ,       <br> <code>dbmail-users -a admin@example.com -s admin@example.com -p plaintext -w 123123 <br></code> <br> <br>   ,        <br></code> </h2> <code><code><a href="http://njabl.org/"></a> <a href="http://www.spamcop.net/w3m%3Faction%3Dcheckblock%26ip%3D"></a> <font color="black">CREATE TYPE dtype AS ENUM ( <br> <font color="#A31515">'LOCAL'</font> , <br> <font color="#A31515">'VIRTUAL'</font> , <br> <font color="#A31515">'RELAY'</font> <br> ); <br> <br> ALTER TYPE <font color="#0000ff">public</font> .dtype OWNER TO dbmail; <br> <br> SET default_with_oids = <font color="#0000ff">true</font> ; <br> <br> CREATE TABLE dbmail_domains ( <br> uid integer NOT NULL, <br> domain character varying(128) NOT NULL, <br> type dtype NOT NULL <br> ); <br> <br> INSERT INTO dbmail_domains (uid, domain, type) VALUES (1, <font color="#A31515">'example.com'</font> , <font color="#A31515">'LOCAL'</font> );</font> <br>   . <br> <br> Exim <br> C   exim.conf <br> #!/bin/sh <br> ###################################################################### <br> # Runtime configuration file for Exim # <br> ###################################################################### <br> ####################################################################### <br> # MAIN CONFIGURATION SETTINGS # <br> ###################################################################### <br> <br> primary_hostname = example.com <br> domainlist local_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND \ <br> (type='LOCAL' OR type='VIRTUAL')}} <br> domainlist relay_to_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND type='RELAY'}} <br> hostlist relay_from_hosts = 127.0.0.1: localhost <br> auth_advertise_hosts = * <br> daemon_smtp_ports = 25 <br> log_selector = \ <br> +all_parents \ <br> +lost_incoming_connection \ <br> +received_sender \ <br> +received_recipients \ <br> +smtp_confirmation \ <br> +smtp_syntax_error \ <br> +smtp_protocol_error \ <br> -queue_run <br> acl_smtp_rcpt = acl_check_rcpt <br> acl_smtp_mime = acl_check_mime <br> acl_smtp_data = acl_check_content <br> qualify_domain = example.com <br> allow_domain_literals = false <br> exim_user = mail <br> exim_group = mail <br> never_users = root <br> host_lookup = * <br> #rfc1413_hosts = * <br> rfc1413_query_timeout = 0s <br> ignore_bounce_errors_after = 30m <br> timeout_frozen_after = 3d <br> freeze_tell = postmaster <br> <br> #av_scanner = clamd:/var/run/clamav/clamd.ctl #        <br> spamd_address = 127.0.0.1 783 <br> <br> message_size_limit = 10M <br> smtp_accept_max = 1000 <br> smtp_accept_max_per_connection = 150 <br> smtp_accept_max_per_host = 30 <br> split_spool_directory = true <br> remote_max_parallel = 15 <br> smtp_banner = "Welcome on our mail server!\n\ <br> This system does not accept Unsolicited \ <br> Commercial Email\nand will blacklist \ <br> offenders via our spam processor.\nHave a \ <br> nice day!\n\n${primary_hostname} ESMTP" <br> <br> hide pgsql_servers = localhost/dbmail/dbmail/PasSWorD <br> <br> ###################################################################### <br> # ACL CONFIGURATION # <br> # Specifies access control lists for incoming SMTP mail # <br> ###################################################################### <br> begin acl <br> <br> acl_check_rcpt: <br> <br> warn <br> set acl_m0 = 0s <br> warn <br> hosts = !+relay_from_hosts:!213.243.111.115/32 <br> set acl_m0 = 30s <br> warn <br> condition = ${if and {\ <br> {match{$sender_host_name}\ <br> {\N^[-az]*\d{0,3}[-az]*\.?[-az]*\d{0,3}[-az]*\.\w+$\N}} \ <br> {!eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 1s <br> <br> warn <br> condition = ${if and {\ <br> {match{$sender_helo_name}{\N^\w*\.\w{3}$\N}} \ <br> {eq{$acl_c1}{}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c2}{outblaze_domain}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if or {\ <br> {eq{$sender_address}{}} \ <br> {eq{$acl_m1}{0s}} \ <br> } {yes}{no}} <br> set acl_m0 = 0s <br> <br> warn <br> logwrite = Delay $acl_m0 for $sender_host_name \ <br> [$sender_host_address] with HELO=$sender_helo_name. \ <br> Mail from $sender_address to $local_part@$domain. <br> set acl_m1 = 0s <br> delay = $acl_m0 <br> <br> accept hosts = : <br> <br> deny domains = +local_domains <br> local_parts = ^[.] : ^.*[@%!/|] <br> <br> deny domains = !+local_domains <br> local_parts = ^[./|] : ^.*[@%!] : ^.*/\\.\\./ <br> <br> accept local_parts = postmaster <br> domains = +local_domains <br> <br> require verify = sender <br> <br> deny message = HELO/EHLO required by SMTP RFC <br> condition = ${if eq{$sender_helo_name}{}{yes}{no}} <br> <br> deny message = Go Away! You are spammer. <br> condition = ${if match{$sender_host_name} \ <br> {bezeqint\\.net|net\\.il|dialup|dsl|pool|peer|dhcp} \ <br> {yes}{no}} <br> <br> deny message = message from \ <br> $sender_host_address rejected - see njabl.org <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.njabl.org <br> <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dialups.mail-abuse.org <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = list.dsbl.org <br> deny message = Spam blocked see: \ <br> www.spamcop.net/w3m?action=checkblock&amp;ip=$sender_host_address <br> log_message = found in $dnslist_domain <br> dnslists = bl.spamcop.net <br> deny message = rejected, $sender_host_address \ <br> Open Proxy, see: $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.void.ru <br> <br> accept domains = +local_domains <br> endpass <br> message = unknown user <br> verify = recipient <br> <br> accept domains = +relay_to_domains <br> endpass <br> message = unrouteable address <br> verify = recipient <br> <br> accept hosts = +relay_from_hosts <br> accept authenticated = * <br> deny message = relay not permitted <br> <br> acl_check_mime: <br> <br> warn decode = default <br> <br> deny message = Blacklisted file extension detected ($mime_filename) <br> condition = ${if match \ <br> {${lc:$mime_filename}} \ <br> {\N(\.exe|\.pif|\.bat|\.scr|\.lnk|\.com|\.vbs|\.cpl)$\N} \ <br> {1}{0}} <br> <br> deny message = Sorry, noone speaks chinese here <br> condition = ${if eq{$mime_charset}{gb2312}{1}{0}} <br> <br> accept <br> <br> acl_check_content: <br> # deny message = Virus found ($malware_name) <br> # malware = * <br> <br> warn message = X-Spam-Score: $spam_score ($spam_bar) <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = X-Spam-Report: $spam_report <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = Subject: ***SPAM*** $h_Subject: <br> hosts = !+relay_from_hosts <br> spam = spamd <br> <br> deny message = This message scored $spam_score spam points. <br> spam = spamd:true <br> hosts = !+relay_from_hosts <br> condition = ${if &gt;{$spam_score_int}{120}{1}{0}} <br> <br> accept <br> <br> ###################################################################### <br> # ROUTERS CONFIGURATION # <br> # Specifies how addresses are handled # <br> ###################################################################### <br> # THE ORDER IN WHICH THE ROUTERS ARE DEFINED IS IMPORTANT! # <br> # An address is passed to each router in turn until it is accepted. # <br> ###################################################################### <br> <br> begin routers <br> <br> dnslookup: <br> driver = dnslookup <br> domains = ! +local_domains <br> transport = remote_smtp <br> ignore_target_hosts = 0.0.0.0 : 127.0.0.0/8 <br> no_more <br> <br> dbmailuser: <br> driver = accept <br> condition = ${lookup pgsql{SELECT alias_idnr FROM \ <br> dbmail_aliases WHERE \ <br> alias='${quote_pgsql:$local_part@$domain}' OR \ <br> alias='${quote_pgsql:@$domain}'}{yes}{no}} <br> transport = dbmail_delivery <br> <br> ###################################################################### <br> # TRANSPORTS CONFIGURATION # <br> ###################################################################### <br> # ORDER DOES NOT MATTER # <br> # Only one appropriate transport is called for each delivery. # <br> ###################################################################### <br> <br> begin transports <br> <br> remote_smtp: <br> driver = smtp <br> <br> dbmail_delivery: <br> driver = pipe <br> check_string = <br> command = /usr/sbin/dbmail-smtp -d ${pipe_addresses} <br> group = mail <br> message_prefix = "" <br> message_suffix = "" <br> path="/bin:/sbin:/usr/bin:/usr/sbin" <br> #   <br> address_pipe: <br> driver = pipe <br> return_output <br> <br> address_reply: <br> driver = autoreply <br> <br> ###################################################################### <br> # RETRY CONFIGURATION # <br> ###################################################################### <br> <br> begin retry <br> <br> * quota <br> * * F,2h,15m; G,16h,1h,1.5; F,4d,6h <br> <br> ###################################################################### <br> # REWRITE CONFIGURATION # <br> ###################################################################### <br> <br> begin rewrite <br> <br> ###################################################################### <br> # AUTHENTICATION CONFIGURATION # <br> ###################################################################### <br> <br> begin authenticators <br> <br> auth_plain: <br> driver = plaintext <br> public_name = PLAIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = : <br> server_set_id = $2 <br> <br> #    ,    . <br> auth_login: <br> driver = plaintext <br> public_name = LOGIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = Username:: : Password:: <br> server_set_id = $1 <br> <br> #    " " - TheBat! <br> auth_cram_md5: <br> driver = cram_md5 <br> public_name = CRAM-MD5 <br> server_secret = ${lookup pgsql{SELECT passwd FROM \ <br> dbmail_users WHERE userid \ <br> = '${quote_pgsql:$1}'}{$value}fail} <br> server_set_id = $1 <br> # End of Exim configuration file <br> ###ps  lissyara,       <br> <br></code> <br> <br> DBMail <br> dbmail.conf          <br> <code># (c) 2000-2006 IC&amp;S, The Netherlands <br> # <br> # Configuration file for DBMAIL <br> <br> [DBMAIL] <br> # <br> # Database settings <br> # <br> <br> # <br> # Supported drivers are mysql, pgsql, sqlite. <br> # <br> driver =pgsql <br> <br> # <br> # Supported drivers are sql, ldap. <br> # <br> authdriver =sql <br> <br> # <br> # Host for database, set to localhost if database is on <br> # the same host as dbmail and you want to use a local <br> # socket for connecting. <br> # <br> host =localhost <br> <br> # <br> # If you want to use TCP/IP for connecting to the database, <br> # and have the database running on a non-standard port. <br> # <br> sqlport =5432 <br> <br> # <br> # When using a local socket connection to the database, fill <br> # in the path to the socket here (eg /var/run/mysql.sock). <br> # <br> sqlsocket = <br> <br> # <br> # Database username. <br> # <br> user =dbmail <br> <br> # <br> # Database password. <br> # <br> pass =PasWoRd <br> <br> # <br> # Database name. <br> # <br> db =dbmail <br> <br> # <br> # Table prefix. Defaults to "dbmail_" if not specified. <br> # <br> table_prefix =dbmail_ <br> <br> # <br> # encoding must match the database/table encoding. <br> # ie latin1, utf8 <br> encoding = utf8 <br> <br> # <br> # messages with unknown encoding will be assumed to have <br> # default_msg_encoding <br> # ie iso8859-1, utf8 <br> default_msg_encoding = utf8 <br> <br> # <br> # Postmaster's email address for use in bounce messages. <br> # <br> #postmaster = DBMAIL-MAILER <br> <br> # <br> # Sendmail executable for forwards, replies, notifies, vacations. <br> # You may use pipes (|) in this command, for example: <br> # dos2unix|/usr/sbin/sendmail works well with Qmail. <br> # You may use quotes (") for executables with unusual names. <br> # <br> sendmail = /usr/sbin/sendmail <br> <br> # <br> # <br> # The following items can be overridden in the service-specific sections. <br> # <br> # <br> <br> # <br> # Trace level to send to syslog. Default is 2 (messages, errors, fatals). <br> # <br> TRACE_SYSLOG = 3 <br> <br> # <br> # Trace level to send to stderr. Default is 0 (fatals). <br> # <br> TRACE_STDERR = 1 <br> <br> # <br> # Root privs are used to open a port, then privs <br> # are dropped down to the user/group specified here. <br> # <br> EFFECTIVE_USER = dbmail <br> EFFECTIVE_GROUP = dbmail <br> <br> # <br> # The IP addresses the services will bind to. <br> # Use * for all local interfaces. <br> # Use 127.0.0.1 for localhost only. <br> # Separate multiple entries with spaces ( ) or commas (,). <br> # <br> BINDIP = * <br> <br> # <br> # Default number of child processes to start. <br> # <br> NCHILDREN = 2 <br> <br> # <br> # Maximum number of child processes allowed. <br> # <br> MAXCHILDREN = 10 <br> <br> # <br> # Unused children to always have availale. <br> # <br> MINSPARECHILDREN = 2 <br> <br> # <br> # Maximum unused children allowed to be active. <br> # <br> MAXSPARECHILDREN = 4 <br> <br> # <br> # Child process is restarted after handling this many connections. <br> # <br> MAXCONNECTS = 10000 <br> <br> # <br> # Child process will restart after this many connection errors. <br> # <br> MAX_ERRORS = 500 <br> <br> # <br> # Idle time allowed before a connection is shut off. <br> # <br> TIMEOUT = 300 <br> <br> # <br> # Idle time allowed before a connection is shut off if you have not logged in yet. <br> # <br> login_timeout = 60 <br> <br> # <br> # If yes, resolves IP addresses to DNS names when logging. <br> # <br> RESOLVE_IP = no <br> <br> # <br> # logfile for stdout messages <br> # <br> logfile = /var/log/dbmail.log <br> <br> # <br> # logfile for stderr messages <br> # <br> errorlog = /var/log/dbmail.err <br> <br> # <br> # directory for storing PID files <br> # <br> pid_directory = /var/run <br> <br> # <br> # directory for storing the daemon statefiles <br> # <br> state_directory = /var/run <br> <br> # <br> # directory for locating libraries (normally has a sane default compiled-in) <br> # <br> #library_directory = /usr/lib/dbmail <br> <br> [SMTP] <br> # In fact, there isn't anything here by default. <br> <br> [LMTP] <br> # <br> # Port to bind to. <br> # <br> PORT = 24 <br> <br> [POP] <br> # <br> # Port to bind to. <br> # <br> PORT = 110 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by POP3. <br> # This requires addition configuration of your MTA <br> # <br> POP_BEFORE_SMTP = no <br> <br> [IMAP] <br> <br> # <br> # Port to bind to. <br> # <br> PORT = 143 <br> <br> # <br> # IMAP prefers a longer timeout than other services. <br> # <br> TIMEOUT = 4000 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by IMAP. <br> # This requires addition configuration of your MTA <br> # <br> IMAP_BEFORE_SMTP = no <br> <br> # <br> # during IDLE, how many seconds between checking the mailbox <br> # status (default: 30) <br> # <br> # idle_timeout = 30 <br> <br> # <br> # Provide a CAPABILITY to override the default <br> # <br> # capability = IMAP4 IMAP4rev1 AUTH=LOGIN ACL NAMESPACE CHILDREN SORT QUOTA THREAD=ORDEREDSUBJECT UNSELECT IDLE <br> <br> [SIEVE] <br> # <br> # Port to bind to. <br> # <br> PORT = 2000 <br> <br> [LDAP] <br> PORT = 389 <br> VERSION = 3 <br> HOSTNAME = ldap <br> BASE_DN = ou=People,dc=mydomain,dc=com <br> <br> # <br> # If your LDAP library supports ldap_initialize(), then you can use the <br> # alternative LDAP server DSN like following. <br> # <br> # URI = ldap://127.0.0.1:389 <br> # URI = ldapi://%2fvar%2frun%2fopenldap%2fldapi/ <br> <br> # <br> # Leave blank for anonymous bind. <br> # example: cn=admin,dc=mydomain,dc=com <br> # <br> BIND_DN = <br> <br> # <br> # Leave blank for anonymous bind. <br> # <br> BIND_PW = <br> SCOPE = SubTree <br> USER_OBJECTCLASS = top,account,dbmailUser <br> FORW_OBJECTCLASS = top,account,dbmailForwardingAddress <br> CN_STRING = uid <br> FIELD_PASSWD = userPassword <br> FIELD_UID = uid <br> FIELD_NID = uidNumber <br> MIN_NID = 10000 <br> MAX_NID = 15000 <br> FIELD_CID = gidNumber <br> MIN_CID = 10000 <br> MAX_CID = 15000 <br> FIELD_MAIL = mail <br> FIELD_QUOTA = mailQuota <br> FIELD_FWDTARGET = mailForwardingAddress <br> <br> [DELIVERY] <br> # <br> # Run Sieve scripts as messages are delivered. <br> # <br> SIEVE = yes <br> <br> # <br> # Use 'user+mailbox@domain' format to deliver to a mailbox. <br> # <br> SUBADDRESS = yes <br> <br> # <br> # Turn on/off the Sieve Vacation extension. <br> # <br> SIEVE_VACATION = yes <br> <br> # <br> # Turn on/off the Sieve Notify extension <br> # <br> SIEVE_NOTIFY = yes <br> <br> # <br> # Turn on/off additional Sieve debugging. <br> # <br> SIEVE_DEBUG = no <br> <br> # <br> # Use the auto_notify table to send email notifications. <br> # <br> AUTO_NOTIFY = no <br> <br> # <br> # Use the auto_reply table to send away messages. <br> # <br> AUTO_REPLY = no <br> # <br> # Defaults to "NEW MAIL NOTIFICATION" <br> # <br> #AUTO_NOTIFY_SUBJECT = <br> <br> # <br> # Defaults to POSTMASTER from the DBMAIL section. <br> # <br> #AUTO_NOTIFY_SENDER = <br> <br> # <br> # If you set this to 'yes' dbmail will check for duplicate <br> # messages in the relevant mailbox during delivery using <br> # the Message-ID header <br> # <br> suppress_duplicates = no <br> <br> # end of configuration file <br> <br> <br></code> <br> <br> Spamassassin <br>    ,         ,          /etc/spamasassin,      ,       nobody <br> <br> local.cf <br> <code>rewrite_header Subject ***SPAM*** <br> report_safe 1 <br> trusted_networks 192.168/16 127/8 <br> # lock_method flock <br> required_score 5.0 <br> use_bayes 1 <br> bayes_auto_learn 1 <br> # bayes_ignore_header X-Bogosity <br> # bayes_ignore_header X-Spam-Flag <br> # bayes_ignore_header X-Spam-Status <br> auto_whitelist_path /etc/mail/spamassassin/auto_whitelist <br> bayes_path /etc/mail/spamassassin/bayes <br> bayes_file_mode 0666 <br> bayes_min_ham_num 1 <br> bayes_min_spam_num 1 <br> auto_learn_threshold_nonspam -2 <br> auto_learn_threshold_spam 5 <br> bayes_learn_to_journal 1 <br> skip_rbl_checks 0 <br> <br> ok_languages ru en <br> ok_locales ru en <br></code> <br> <br>    ..     <br> <code>/etc/init.d/exim start <br> /etc/init.d/spamd start <br> #    pop3      <br> /etc/init.d/dbmail-pop3d <br></code> <br> <br>     ,           <br> <code>rc-update add postgresql default <br> rc-update add exim default <br> rc-update add spamd default <br> rc-update add dbmail-pop3d default <br></code> <br> <br>          ,       <br> <code>dbmail-users -a admin@example.com -s admin@example.com -p plaintext -w 123123 <br></code> <br> <br>   ,        <br></code> <blockquote> <code><code><code><a href="http://njabl.org/"></a> <a href="http://www.spamcop.net/w3m%3Faction%3Dcheckblock%26ip%3D"></a> <font color="black">CREATE TYPE dtype AS ENUM ( <br> <font color="#A31515">'LOCAL'</font> , <br> <font color="#A31515">'VIRTUAL'</font> , <br> <font color="#A31515">'RELAY'</font> <br> ); <br> <br> ALTER TYPE <font color="#0000ff">public</font> .dtype OWNER TO dbmail; <br> <br> SET default_with_oids = <font color="#0000ff">true</font> ; <br> <br> CREATE TABLE dbmail_domains ( <br> uid integer NOT NULL, <br> domain character varying(128) NOT NULL, <br> type dtype NOT NULL <br> ); <br> <br> INSERT INTO dbmail_domains (uid, domain, type) VALUES (1, <font color="#A31515">'example.com'</font> , <font color="#A31515">'LOCAL'</font> );</font> <br>   . <br> <br> Exim <br> C   exim.conf <br> #!/bin/sh <br> ###################################################################### <br> # Runtime configuration file for Exim # <br> ###################################################################### <br> ####################################################################### <br> # MAIN CONFIGURATION SETTINGS # <br> ###################################################################### <br> <br> primary_hostname = example.com <br> domainlist local_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND \ <br> (type='LOCAL' OR type='VIRTUAL')}} <br> domainlist relay_to_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND type='RELAY'}} <br> hostlist relay_from_hosts = 127.0.0.1: localhost <br> auth_advertise_hosts = * <br> daemon_smtp_ports = 25 <br> log_selector = \ <br> +all_parents \ <br> +lost_incoming_connection \ <br> +received_sender \ <br> +received_recipients \ <br> +smtp_confirmation \ <br> +smtp_syntax_error \ <br> +smtp_protocol_error \ <br> -queue_run <br> acl_smtp_rcpt = acl_check_rcpt <br> acl_smtp_mime = acl_check_mime <br> acl_smtp_data = acl_check_content <br> qualify_domain = example.com <br> allow_domain_literals = false <br> exim_user = mail <br> exim_group = mail <br> never_users = root <br> host_lookup = * <br> #rfc1413_hosts = * <br> rfc1413_query_timeout = 0s <br> ignore_bounce_errors_after = 30m <br> timeout_frozen_after = 3d <br> freeze_tell = postmaster <br> <br> #av_scanner = clamd:/var/run/clamav/clamd.ctl #        <br> spamd_address = 127.0.0.1 783 <br> <br> message_size_limit = 10M <br> smtp_accept_max = 1000 <br> smtp_accept_max_per_connection = 150 <br> smtp_accept_max_per_host = 30 <br> split_spool_directory = true <br> remote_max_parallel = 15 <br> smtp_banner = "Welcome on our mail server!\n\ <br> This system does not accept Unsolicited \ <br> Commercial Email\nand will blacklist \ <br> offenders via our spam processor.\nHave a \ <br> nice day!\n\n${primary_hostname} ESMTP" <br> <br> hide pgsql_servers = localhost/dbmail/dbmail/PasSWorD <br> <br> ###################################################################### <br> # ACL CONFIGURATION # <br> # Specifies access control lists for incoming SMTP mail # <br> ###################################################################### <br> begin acl <br> <br> acl_check_rcpt: <br> <br> warn <br> set acl_m0 = 0s <br> warn <br> hosts = !+relay_from_hosts:!213.243.111.115/32 <br> set acl_m0 = 30s <br> warn <br> condition = ${if and {\ <br> {match{$sender_host_name}\ <br> {\N^[-az]*\d{0,3}[-az]*\.?[-az]*\d{0,3}[-az]*\.\w+$\N}} \ <br> {!eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 1s <br> <br> warn <br> condition = ${if and {\ <br> {match{$sender_helo_name}{\N^\w*\.\w{3}$\N}} \ <br> {eq{$acl_c1}{}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c2}{outblaze_domain}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if or {\ <br> {eq{$sender_address}{}} \ <br> {eq{$acl_m1}{0s}} \ <br> } {yes}{no}} <br> set acl_m0 = 0s <br> <br> warn <br> logwrite = Delay $acl_m0 for $sender_host_name \ <br> [$sender_host_address] with HELO=$sender_helo_name. \ <br> Mail from $sender_address to $local_part@$domain. <br> set acl_m1 = 0s <br> delay = $acl_m0 <br> <br> accept hosts = : <br> <br> deny domains = +local_domains <br> local_parts = ^[.] : ^.*[@%!/|] <br> <br> deny domains = !+local_domains <br> local_parts = ^[./|] : ^.*[@%!] : ^.*/\\.\\./ <br> <br> accept local_parts = postmaster <br> domains = +local_domains <br> <br> require verify = sender <br> <br> deny message = HELO/EHLO required by SMTP RFC <br> condition = ${if eq{$sender_helo_name}{}{yes}{no}} <br> <br> deny message = Go Away! You are spammer. <br> condition = ${if match{$sender_host_name} \ <br> {bezeqint\\.net|net\\.il|dialup|dsl|pool|peer|dhcp} \ <br> {yes}{no}} <br> <br> deny message = message from \ <br> $sender_host_address rejected - see njabl.org <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.njabl.org <br> <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dialups.mail-abuse.org <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = list.dsbl.org <br> deny message = Spam blocked see: \ <br> www.spamcop.net/w3m?action=checkblock&amp;ip=$sender_host_address <br> log_message = found in $dnslist_domain <br> dnslists = bl.spamcop.net <br> deny message = rejected, $sender_host_address \ <br> Open Proxy, see: $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.void.ru <br> <br> accept domains = +local_domains <br> endpass <br> message = unknown user <br> verify = recipient <br> <br> accept domains = +relay_to_domains <br> endpass <br> message = unrouteable address <br> verify = recipient <br> <br> accept hosts = +relay_from_hosts <br> accept authenticated = * <br> deny message = relay not permitted <br> <br> acl_check_mime: <br> <br> warn decode = default <br> <br> deny message = Blacklisted file extension detected ($mime_filename) <br> condition = ${if match \ <br> {${lc:$mime_filename}} \ <br> {\N(\.exe|\.pif|\.bat|\.scr|\.lnk|\.com|\.vbs|\.cpl)$\N} \ <br> {1}{0}} <br> <br> deny message = Sorry, noone speaks chinese here <br> condition = ${if eq{$mime_charset}{gb2312}{1}{0}} <br> <br> accept <br> <br> acl_check_content: <br> # deny message = Virus found ($malware_name) <br> # malware = * <br> <br> warn message = X-Spam-Score: $spam_score ($spam_bar) <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = X-Spam-Report: $spam_report <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = Subject: ***SPAM*** $h_Subject: <br> hosts = !+relay_from_hosts <br> spam = spamd <br> <br> deny message = This message scored $spam_score spam points. <br> spam = spamd:true <br> hosts = !+relay_from_hosts <br> condition = ${if &gt;{$spam_score_int}{120}{1}{0}} <br> <br> accept <br> <br> ###################################################################### <br> # ROUTERS CONFIGURATION # <br> # Specifies how addresses are handled # <br> ###################################################################### <br> # THE ORDER IN WHICH THE ROUTERS ARE DEFINED IS IMPORTANT! # <br> # An address is passed to each router in turn until it is accepted. # <br> ###################################################################### <br> <br> begin routers <br> <br> dnslookup: <br> driver = dnslookup <br> domains = ! +local_domains <br> transport = remote_smtp <br> ignore_target_hosts = 0.0.0.0 : 127.0.0.0/8 <br> no_more <br> <br> dbmailuser: <br> driver = accept <br> condition = ${lookup pgsql{SELECT alias_idnr FROM \ <br> dbmail_aliases WHERE \ <br> alias='${quote_pgsql:$local_part@$domain}' OR \ <br> alias='${quote_pgsql:@$domain}'}{yes}{no}} <br> transport = dbmail_delivery <br> <br> ###################################################################### <br> # TRANSPORTS CONFIGURATION # <br> ###################################################################### <br> # ORDER DOES NOT MATTER # <br> # Only one appropriate transport is called for each delivery. # <br> ###################################################################### <br> <br> begin transports <br> <br> remote_smtp: <br> driver = smtp <br> <br> dbmail_delivery: <br> driver = pipe <br> check_string = <br> command = /usr/sbin/dbmail-smtp -d ${pipe_addresses} <br> group = mail <br> message_prefix = "" <br> message_suffix = "" <br> path="/bin:/sbin:/usr/bin:/usr/sbin" <br> #   <br> address_pipe: <br> driver = pipe <br> return_output <br> <br> address_reply: <br> driver = autoreply <br> <br> ###################################################################### <br> # RETRY CONFIGURATION # <br> ###################################################################### <br> <br> begin retry <br> <br> * quota <br> * * F,2h,15m; G,16h,1h,1.5; F,4d,6h <br> <br> ###################################################################### <br> # REWRITE CONFIGURATION # <br> ###################################################################### <br> <br> begin rewrite <br> <br> ###################################################################### <br> # AUTHENTICATION CONFIGURATION # <br> ###################################################################### <br> <br> begin authenticators <br> <br> auth_plain: <br> driver = plaintext <br> public_name = PLAIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = : <br> server_set_id = $2 <br> <br> #    ,    . <br> auth_login: <br> driver = plaintext <br> public_name = LOGIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = Username:: : Password:: <br> server_set_id = $1 <br> <br> #    " " - TheBat! <br> auth_cram_md5: <br> driver = cram_md5 <br> public_name = CRAM-MD5 <br> server_secret = ${lookup pgsql{SELECT passwd FROM \ <br> dbmail_users WHERE userid \ <br> = '${quote_pgsql:$1}'}{$value}fail} <br> server_set_id = $1 <br> # End of Exim configuration file <br> ###ps  lissyara,       <br> <br></code> <br> <br> DBMail <br> dbmail.conf          <br> <code># (c) 2000-2006 IC&amp;S, The Netherlands <br> # <br> # Configuration file for DBMAIL <br> <br> [DBMAIL] <br> # <br> # Database settings <br> # <br> <br> # <br> # Supported drivers are mysql, pgsql, sqlite. <br> # <br> driver =pgsql <br> <br> # <br> # Supported drivers are sql, ldap. <br> # <br> authdriver =sql <br> <br> # <br> # Host for database, set to localhost if database is on <br> # the same host as dbmail and you want to use a local <br> # socket for connecting. <br> # <br> host =localhost <br> <br> # <br> # If you want to use TCP/IP for connecting to the database, <br> # and have the database running on a non-standard port. <br> # <br> sqlport =5432 <br> <br> # <br> # When using a local socket connection to the database, fill <br> # in the path to the socket here (eg /var/run/mysql.sock). <br> # <br> sqlsocket = <br> <br> # <br> # Database username. <br> # <br> user =dbmail <br> <br> # <br> # Database password. <br> # <br> pass =PasWoRd <br> <br> # <br> # Database name. <br> # <br> db =dbmail <br> <br> # <br> # Table prefix. Defaults to "dbmail_" if not specified. <br> # <br> table_prefix =dbmail_ <br> <br> # <br> # encoding must match the database/table encoding. <br> # ie latin1, utf8 <br> encoding = utf8 <br> <br> # <br> # messages with unknown encoding will be assumed to have <br> # default_msg_encoding <br> # ie iso8859-1, utf8 <br> default_msg_encoding = utf8 <br> <br> # <br> # Postmaster's email address for use in bounce messages. <br> # <br> #postmaster = DBMAIL-MAILER <br> <br> # <br> # Sendmail executable for forwards, replies, notifies, vacations. <br> # You may use pipes (|) in this command, for example: <br> # dos2unix|/usr/sbin/sendmail works well with Qmail. <br> # You may use quotes (") for executables with unusual names. <br> # <br> sendmail = /usr/sbin/sendmail <br> <br> # <br> # <br> # The following items can be overridden in the service-specific sections. <br> # <br> # <br> <br> # <br> # Trace level to send to syslog. Default is 2 (messages, errors, fatals). <br> # <br> TRACE_SYSLOG = 3 <br> <br> # <br> # Trace level to send to stderr. Default is 0 (fatals). <br> # <br> TRACE_STDERR = 1 <br> <br> # <br> # Root privs are used to open a port, then privs <br> # are dropped down to the user/group specified here. <br> # <br> EFFECTIVE_USER = dbmail <br> EFFECTIVE_GROUP = dbmail <br> <br> # <br> # The IP addresses the services will bind to. <br> # Use * for all local interfaces. <br> # Use 127.0.0.1 for localhost only. <br> # Separate multiple entries with spaces ( ) or commas (,). <br> # <br> BINDIP = * <br> <br> # <br> # Default number of child processes to start. <br> # <br> NCHILDREN = 2 <br> <br> # <br> # Maximum number of child processes allowed. <br> # <br> MAXCHILDREN = 10 <br> <br> # <br> # Unused children to always have availale. <br> # <br> MINSPARECHILDREN = 2 <br> <br> # <br> # Maximum unused children allowed to be active. <br> # <br> MAXSPARECHILDREN = 4 <br> <br> # <br> # Child process is restarted after handling this many connections. <br> # <br> MAXCONNECTS = 10000 <br> <br> # <br> # Child process will restart after this many connection errors. <br> # <br> MAX_ERRORS = 500 <br> <br> # <br> # Idle time allowed before a connection is shut off. <br> # <br> TIMEOUT = 300 <br> <br> # <br> # Idle time allowed before a connection is shut off if you have not logged in yet. <br> # <br> login_timeout = 60 <br> <br> # <br> # If yes, resolves IP addresses to DNS names when logging. <br> # <br> RESOLVE_IP = no <br> <br> # <br> # logfile for stdout messages <br> # <br> logfile = /var/log/dbmail.log <br> <br> # <br> # logfile for stderr messages <br> # <br> errorlog = /var/log/dbmail.err <br> <br> # <br> # directory for storing PID files <br> # <br> pid_directory = /var/run <br> <br> # <br> # directory for storing the daemon statefiles <br> # <br> state_directory = /var/run <br> <br> # <br> # directory for locating libraries (normally has a sane default compiled-in) <br> # <br> #library_directory = /usr/lib/dbmail <br> <br> [SMTP] <br> # In fact, there isn't anything here by default. <br> <br> [LMTP] <br> # <br> # Port to bind to. <br> # <br> PORT = 24 <br> <br> [POP] <br> # <br> # Port to bind to. <br> # <br> PORT = 110 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by POP3. <br> # This requires addition configuration of your MTA <br> # <br> POP_BEFORE_SMTP = no <br> <br> [IMAP] <br> <br> # <br> # Port to bind to. <br> # <br> PORT = 143 <br> <br> # <br> # IMAP prefers a longer timeout than other services. <br> # <br> TIMEOUT = 4000 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by IMAP. <br> # This requires addition configuration of your MTA <br> # <br> IMAP_BEFORE_SMTP = no <br> <br> # <br> # during IDLE, how many seconds between checking the mailbox <br> # status (default: 30) <br> # <br> # idle_timeout = 30 <br> <br> # <br> # Provide a CAPABILITY to override the default <br> # <br> # capability = IMAP4 IMAP4rev1 AUTH=LOGIN ACL NAMESPACE CHILDREN SORT QUOTA THREAD=ORDEREDSUBJECT UNSELECT IDLE <br> <br> [SIEVE] <br> # <br> # Port to bind to. <br> # <br> PORT = 2000 <br> <br> [LDAP] <br> PORT = 389 <br> VERSION = 3 <br> HOSTNAME = ldap <br> BASE_DN = ou=People,dc=mydomain,dc=com <br> <br> # <br> # If your LDAP library supports ldap_initialize(), then you can use the <br> # alternative LDAP server DSN like following. <br> # <br> # URI = ldap://127.0.0.1:389 <br> # URI = ldapi://%2fvar%2frun%2fopenldap%2fldapi/ <br> <br> # <br> # Leave blank for anonymous bind. <br> # example: cn=admin,dc=mydomain,dc=com <br> # <br> BIND_DN = <br> <br> # <br> # Leave blank for anonymous bind. <br> # <br> BIND_PW = <br> SCOPE = SubTree <br> USER_OBJECTCLASS = top,account,dbmailUser <br> FORW_OBJECTCLASS = top,account,dbmailForwardingAddress <br> CN_STRING = uid <br> FIELD_PASSWD = userPassword <br> FIELD_UID = uid <br> FIELD_NID = uidNumber <br> MIN_NID = 10000 <br> MAX_NID = 15000 <br> FIELD_CID = gidNumber <br> MIN_CID = 10000 <br> MAX_CID = 15000 <br> FIELD_MAIL = mail <br> FIELD_QUOTA = mailQuota <br> FIELD_FWDTARGET = mailForwardingAddress <br> <br> [DELIVERY] <br> # <br> # Run Sieve scripts as messages are delivered. <br> # <br> SIEVE = yes <br> <br> # <br> # Use 'user+mailbox@domain' format to deliver to a mailbox. <br> # <br> SUBADDRESS = yes <br> <br> # <br> # Turn on/off the Sieve Vacation extension. <br> # <br> SIEVE_VACATION = yes <br> <br> # <br> # Turn on/off the Sieve Notify extension <br> # <br> SIEVE_NOTIFY = yes <br> <br> # <br> # Turn on/off additional Sieve debugging. <br> # <br> SIEVE_DEBUG = no <br> <br> # <br> # Use the auto_notify table to send email notifications. <br> # <br> AUTO_NOTIFY = no <br> <br> # <br> # Use the auto_reply table to send away messages. <br> # <br> AUTO_REPLY = no <br> # <br> # Defaults to "NEW MAIL NOTIFICATION" <br> # <br> #AUTO_NOTIFY_SUBJECT = <br> <br> # <br> # Defaults to POSTMASTER from the DBMAIL section. <br> # <br> #AUTO_NOTIFY_SENDER = <br> <br> # <br> # If you set this to 'yes' dbmail will check for duplicate <br> # messages in the relevant mailbox during delivery using <br> # the Message-ID header <br> # <br> suppress_duplicates = no <br> <br> # end of configuration file <br> <br> <br></code> <br> <br> Spamassassin <br>    ,         ,          /etc/spamasassin,      ,       nobody <br> <br> local.cf <br> rewrite_header Subject ***SPAM*** <br> report_safe 1 <br> trusted_networks 192.168/16 127/8 <br> # lock_method flock <br> required_score 5.0 <br> use_bayes 1 <br> bayes_auto_learn 1 <br> # bayes_ignore_header X-Bogosity <br> # bayes_ignore_header X-Spam-Flag <br> # bayes_ignore_header X-Spam-Status <br> auto_whitelist_path /etc/mail/spamassassin/auto_whitelist <br> bayes_path /etc/mail/spamassassin/bayes <br> bayes_file_mode 0666 <br> bayes_min_ham_num 1 <br> bayes_min_spam_num 1 <br> auto_learn_threshold_nonspam -2 <br> auto_learn_threshold_spam 5 <br> bayes_learn_to_journal 1 <br> skip_rbl_checks 0 <br> <br> ok_languages ru en <br> ok_locales ru en <br> <br> <br>    ..     <br> <code>/etc/init.d/exim start <br> /etc/init.d/spamd start <br> #    pop3      <br> /etc/init.d/dbmail-pop3d <br></code> <br> <br>     ,           <br> <code>rc-update add postgresql default <br> rc-update add exim default <br> rc-update add spamd default <br> rc-update add dbmail-pop3d default <br></code> <br> <br>          ,       <br> <code>dbmail-users -a admin@example.com -s admin@example.com -p plaintext -w 123123 <br></code> <br> <br>   ,        <br></code></code> </blockquote> <code><code><a href="http://njabl.org/"></a> <a href="http://www.spamcop.net/w3m%3Faction%3Dcheckblock%26ip%3D"></a> <font color="black">CREATE TYPE dtype AS ENUM ( <br> <font color="#A31515">'LOCAL'</font> , <br> <font color="#A31515">'VIRTUAL'</font> , <br> <font color="#A31515">'RELAY'</font> <br> ); <br> <br> ALTER TYPE <font color="#0000ff">public</font> .dtype OWNER TO dbmail; <br> <br> SET default_with_oids = <font color="#0000ff">true</font> ; <br> <br> CREATE TABLE dbmail_domains ( <br> uid integer NOT NULL, <br> domain character varying(128) NOT NULL, <br> type dtype NOT NULL <br> ); <br> <br> INSERT INTO dbmail_domains (uid, domain, type) VALUES (1, <font color="#A31515">'example.com'</font> , <font color="#A31515">'LOCAL'</font> );</font> <br>   . <br> <br> Exim <br> C   exim.conf <br> #!/bin/sh <br> ###################################################################### <br> # Runtime configuration file for Exim # <br> ###################################################################### <br> ####################################################################### <br> # MAIN CONFIGURATION SETTINGS # <br> ###################################################################### <br> <br> primary_hostname = example.com <br> domainlist local_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND \ <br> (type='LOCAL' OR type='VIRTUAL')}} <br> domainlist relay_to_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND type='RELAY'}} <br> hostlist relay_from_hosts = 127.0.0.1: localhost <br> auth_advertise_hosts = * <br> daemon_smtp_ports = 25 <br> log_selector = \ <br> +all_parents \ <br> +lost_incoming_connection \ <br> +received_sender \ <br> +received_recipients \ <br> +smtp_confirmation \ <br> +smtp_syntax_error \ <br> +smtp_protocol_error \ <br> -queue_run <br> acl_smtp_rcpt = acl_check_rcpt <br> acl_smtp_mime = acl_check_mime <br> acl_smtp_data = acl_check_content <br> qualify_domain = example.com <br> allow_domain_literals = false <br> exim_user = mail <br> exim_group = mail <br> never_users = root <br> host_lookup = * <br> #rfc1413_hosts = * <br> rfc1413_query_timeout = 0s <br> ignore_bounce_errors_after = 30m <br> timeout_frozen_after = 3d <br> freeze_tell = postmaster <br> <br> #av_scanner = clamd:/var/run/clamav/clamd.ctl #        <br> spamd_address = 127.0.0.1 783 <br> <br> message_size_limit = 10M <br> smtp_accept_max = 1000 <br> smtp_accept_max_per_connection = 150 <br> smtp_accept_max_per_host = 30 <br> split_spool_directory = true <br> remote_max_parallel = 15 <br> smtp_banner = "Welcome on our mail server!\n\ <br> This system does not accept Unsolicited \ <br> Commercial Email\nand will blacklist \ <br> offenders via our spam processor.\nHave a \ <br> nice day!\n\n${primary_hostname} ESMTP" <br> <br> hide pgsql_servers = localhost/dbmail/dbmail/PasSWorD <br> <br> ###################################################################### <br> # ACL CONFIGURATION # <br> # Specifies access control lists for incoming SMTP mail # <br> ###################################################################### <br> begin acl <br> <br> acl_check_rcpt: <br> <br> warn <br> set acl_m0 = 0s <br> warn <br> hosts = !+relay_from_hosts:!213.243.111.115/32 <br> set acl_m0 = 30s <br> warn <br> condition = ${if and {\ <br> {match{$sender_host_name}\ <br> {\N^[-az]*\d{0,3}[-az]*\.?[-az]*\d{0,3}[-az]*\.\w+$\N}} \ <br> {!eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 1s <br> <br> warn <br> condition = ${if and {\ <br> {match{$sender_helo_name}{\N^\w*\.\w{3}$\N}} \ <br> {eq{$acl_c1}{}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c2}{outblaze_domain}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if or {\ <br> {eq{$sender_address}{}} \ <br> {eq{$acl_m1}{0s}} \ <br> } {yes}{no}} <br> set acl_m0 = 0s <br> <br> warn <br> logwrite = Delay $acl_m0 for $sender_host_name \ <br> [$sender_host_address] with HELO=$sender_helo_name. \ <br> Mail from $sender_address to $local_part@$domain. <br> set acl_m1 = 0s <br> delay = $acl_m0 <br> <br> accept hosts = : <br> <br> deny domains = +local_domains <br> local_parts = ^[.] : ^.*[@%!/|] <br> <br> deny domains = !+local_domains <br> local_parts = ^[./|] : ^.*[@%!] : ^.*/\\.\\./ <br> <br> accept local_parts = postmaster <br> domains = +local_domains <br> <br> require verify = sender <br> <br> deny message = HELO/EHLO required by SMTP RFC <br> condition = ${if eq{$sender_helo_name}{}{yes}{no}} <br> <br> deny message = Go Away! You are spammer. <br> condition = ${if match{$sender_host_name} \ <br> {bezeqint\\.net|net\\.il|dialup|dsl|pool|peer|dhcp} \ <br> {yes}{no}} <br> <br> deny message = message from \ <br> $sender_host_address rejected - see njabl.org <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.njabl.org <br> <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dialups.mail-abuse.org <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = list.dsbl.org <br> deny message = Spam blocked see: \ <br> www.spamcop.net/w3m?action=checkblock&amp;ip=$sender_host_address <br> log_message = found in $dnslist_domain <br> dnslists = bl.spamcop.net <br> deny message = rejected, $sender_host_address \ <br> Open Proxy, see: $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.void.ru <br> <br> accept domains = +local_domains <br> endpass <br> message = unknown user <br> verify = recipient <br> <br> accept domains = +relay_to_domains <br> endpass <br> message = unrouteable address <br> verify = recipient <br> <br> accept hosts = +relay_from_hosts <br> accept authenticated = * <br> deny message = relay not permitted <br> <br> acl_check_mime: <br> <br> warn decode = default <br> <br> deny message = Blacklisted file extension detected ($mime_filename) <br> condition = ${if match \ <br> {${lc:$mime_filename}} \ <br> {\N(\.exe|\.pif|\.bat|\.scr|\.lnk|\.com|\.vbs|\.cpl)$\N} \ <br> {1}{0}} <br> <br> deny message = Sorry, noone speaks chinese here <br> condition = ${if eq{$mime_charset}{gb2312}{1}{0}} <br> <br> accept <br> <br> acl_check_content: <br> # deny message = Virus found ($malware_name) <br> # malware = * <br> <br> warn message = X-Spam-Score: $spam_score ($spam_bar) <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = X-Spam-Report: $spam_report <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = Subject: ***SPAM*** $h_Subject: <br> hosts = !+relay_from_hosts <br> spam = spamd <br> <br> deny message = This message scored $spam_score spam points. <br> spam = spamd:true <br> hosts = !+relay_from_hosts <br> condition = ${if &gt;{$spam_score_int}{120}{1}{0}} <br> <br> accept <br> <br> ###################################################################### <br> # ROUTERS CONFIGURATION # <br> # Specifies how addresses are handled # <br> ###################################################################### <br> # THE ORDER IN WHICH THE ROUTERS ARE DEFINED IS IMPORTANT! # <br> # An address is passed to each router in turn until it is accepted. # <br> ###################################################################### <br> <br> begin routers <br> <br> dnslookup: <br> driver = dnslookup <br> domains = ! +local_domains <br> transport = remote_smtp <br> ignore_target_hosts = 0.0.0.0 : 127.0.0.0/8 <br> no_more <br> <br> dbmailuser: <br> driver = accept <br> condition = ${lookup pgsql{SELECT alias_idnr FROM \ <br> dbmail_aliases WHERE \ <br> alias='${quote_pgsql:$local_part@$domain}' OR \ <br> alias='${quote_pgsql:@$domain}'}{yes}{no}} <br> transport = dbmail_delivery <br> <br> ###################################################################### <br> # TRANSPORTS CONFIGURATION # <br> ###################################################################### <br> # ORDER DOES NOT MATTER # <br> # Only one appropriate transport is called for each delivery. # <br> ###################################################################### <br> <br> begin transports <br> <br> remote_smtp: <br> driver = smtp <br> <br> dbmail_delivery: <br> driver = pipe <br> check_string = <br> command = /usr/sbin/dbmail-smtp -d ${pipe_addresses} <br> group = mail <br> message_prefix = "" <br> message_suffix = "" <br> path="/bin:/sbin:/usr/bin:/usr/sbin" <br> #   <br> address_pipe: <br> driver = pipe <br> return_output <br> <br> address_reply: <br> driver = autoreply <br> <br> ###################################################################### <br> # RETRY CONFIGURATION # <br> ###################################################################### <br> <br> begin retry <br> <br> * quota <br> * * F,2h,15m; G,16h,1h,1.5; F,4d,6h <br> <br> ###################################################################### <br> # REWRITE CONFIGURATION # <br> ###################################################################### <br> <br> begin rewrite <br> <br> ###################################################################### <br> # AUTHENTICATION CONFIGURATION # <br> ###################################################################### <br> <br> begin authenticators <br> <br> auth_plain: <br> driver = plaintext <br> public_name = PLAIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = : <br> server_set_id = $2 <br> <br> #    ,    . <br> auth_login: <br> driver = plaintext <br> public_name = LOGIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = Username:: : Password:: <br> server_set_id = $1 <br> <br> #    " " - TheBat! <br> auth_cram_md5: <br> driver = cram_md5 <br> public_name = CRAM-MD5 <br> server_secret = ${lookup pgsql{SELECT passwd FROM \ <br> dbmail_users WHERE userid \ <br> = '${quote_pgsql:$1}'}{$value}fail} <br> server_set_id = $1 <br> # End of Exim configuration file <br> ###ps  lissyara,       <br> <br></code> <br> <br> DBMail <br> dbmail.conf          <br> <code># (c) 2000-2006 IC&amp;S, The Netherlands <br> # <br> # Configuration file for DBMAIL <br> <br> [DBMAIL] <br> # <br> # Database settings <br> # <br> <br> # <br> # Supported drivers are mysql, pgsql, sqlite. <br> # <br> driver =pgsql <br> <br> # <br> # Supported drivers are sql, ldap. <br> # <br> authdriver =sql <br> <br> # <br> # Host for database, set to localhost if database is on <br> # the same host as dbmail and you want to use a local <br> # socket for connecting. <br> # <br> host =localhost <br> <br> # <br> # If you want to use TCP/IP for connecting to the database, <br> # and have the database running on a non-standard port. <br> # <br> sqlport =5432 <br> <br> # <br> # When using a local socket connection to the database, fill <br> # in the path to the socket here (eg /var/run/mysql.sock). <br> # <br> sqlsocket = <br> <br> # <br> # Database username. <br> # <br> user =dbmail <br> <br> # <br> # Database password. <br> # <br> pass =PasWoRd <br> <br> # <br> # Database name. <br> # <br> db =dbmail <br> <br> # <br> # Table prefix. Defaults to "dbmail_" if not specified. <br> # <br> table_prefix =dbmail_ <br> <br> # <br> # encoding must match the database/table encoding. <br> # ie latin1, utf8 <br> encoding = utf8 <br> <br> # <br> # messages with unknown encoding will be assumed to have <br> # default_msg_encoding <br> # ie iso8859-1, utf8 <br> default_msg_encoding = utf8 <br> <br> # <br> # Postmaster's email address for use in bounce messages. <br> # <br> #postmaster = DBMAIL-MAILER <br> <br> # <br> # Sendmail executable for forwards, replies, notifies, vacations. <br> # You may use pipes (|) in this command, for example: <br> # dos2unix|/usr/sbin/sendmail works well with Qmail. <br> # You may use quotes (") for executables with unusual names. <br> # <br> sendmail = /usr/sbin/sendmail <br> <br> # <br> # <br> # The following items can be overridden in the service-specific sections. <br> # <br> # <br> <br> # <br> # Trace level to send to syslog. Default is 2 (messages, errors, fatals). <br> # <br> TRACE_SYSLOG = 3 <br> <br> # <br> # Trace level to send to stderr. Default is 0 (fatals). <br> # <br> TRACE_STDERR = 1 <br> <br> # <br> # Root privs are used to open a port, then privs <br> # are dropped down to the user/group specified here. <br> # <br> EFFECTIVE_USER = dbmail <br> EFFECTIVE_GROUP = dbmail <br> <br> # <br> # The IP addresses the services will bind to. <br> # Use * for all local interfaces. <br> # Use 127.0.0.1 for localhost only. <br> # Separate multiple entries with spaces ( ) or commas (,). <br> # <br> BINDIP = * <br> <br> # <br> # Default number of child processes to start. <br> # <br> NCHILDREN = 2 <br> <br> # <br> # Maximum number of child processes allowed. <br> # <br> MAXCHILDREN = 10 <br> <br> # <br> # Unused children to always have availale. <br> # <br> MINSPARECHILDREN = 2 <br> <br> # <br> # Maximum unused children allowed to be active. <br> # <br> MAXSPARECHILDREN = 4 <br> <br> # <br> # Child process is restarted after handling this many connections. <br> # <br> MAXCONNECTS = 10000 <br> <br> # <br> # Child process will restart after this many connection errors. <br> # <br> MAX_ERRORS = 500 <br> <br> # <br> # Idle time allowed before a connection is shut off. <br> # <br> TIMEOUT = 300 <br> <br> # <br> # Idle time allowed before a connection is shut off if you have not logged in yet. <br> # <br> login_timeout = 60 <br> <br> # <br> # If yes, resolves IP addresses to DNS names when logging. <br> # <br> RESOLVE_IP = no <br> <br> # <br> # logfile for stdout messages <br> # <br> logfile = /var/log/dbmail.log <br> <br> # <br> # logfile for stderr messages <br> # <br> errorlog = /var/log/dbmail.err <br> <br> # <br> # directory for storing PID files <br> # <br> pid_directory = /var/run <br> <br> # <br> # directory for storing the daemon statefiles <br> # <br> state_directory = /var/run <br> <br> # <br> # directory for locating libraries (normally has a sane default compiled-in) <br> # <br> #library_directory = /usr/lib/dbmail <br> <br> [SMTP] <br> # In fact, there isn't anything here by default. <br> <br> [LMTP] <br> # <br> # Port to bind to. <br> # <br> PORT = 24 <br> <br> [POP] <br> # <br> # Port to bind to. <br> # <br> PORT = 110 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by POP3. <br> # This requires addition configuration of your MTA <br> # <br> POP_BEFORE_SMTP = no <br> <br> [IMAP] <br> <br> # <br> # Port to bind to. <br> # <br> PORT = 143 <br> <br> # <br> # IMAP prefers a longer timeout than other services. <br> # <br> TIMEOUT = 4000 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by IMAP. <br> # This requires addition configuration of your MTA <br> # <br> IMAP_BEFORE_SMTP = no <br> <br> # <br> # during IDLE, how many seconds between checking the mailbox <br> # status (default: 30) <br> # <br> # idle_timeout = 30 <br> <br> # <br> # Provide a CAPABILITY to override the default <br> # <br> # capability = IMAP4 IMAP4rev1 AUTH=LOGIN ACL NAMESPACE CHILDREN SORT QUOTA THREAD=ORDEREDSUBJECT UNSELECT IDLE <br> <br> [SIEVE] <br> # <br> # Port to bind to. <br> # <br> PORT = 2000 <br> <br> [LDAP] <br> PORT = 389 <br> VERSION = 3 <br> HOSTNAME = ldap <br> BASE_DN = ou=People,dc=mydomain,dc=com <br> <br> # <br> # If your LDAP library supports ldap_initialize(), then you can use the <br> # alternative LDAP server DSN like following. <br> # <br> # URI = ldap://127.0.0.1:389 <br> # URI = ldapi://%2fvar%2frun%2fopenldap%2fldapi/ <br> <br> # <br> # Leave blank for anonymous bind. <br> # example: cn=admin,dc=mydomain,dc=com <br> # <br> BIND_DN = <br> <br> # <br> # Leave blank for anonymous bind. <br> # <br> BIND_PW = <br> SCOPE = SubTree <br> USER_OBJECTCLASS = top,account,dbmailUser <br> FORW_OBJECTCLASS = top,account,dbmailForwardingAddress <br> CN_STRING = uid <br> FIELD_PASSWD = userPassword <br> FIELD_UID = uid <br> FIELD_NID = uidNumber <br> MIN_NID = 10000 <br> MAX_NID = 15000 <br> FIELD_CID = gidNumber <br> MIN_CID = 10000 <br> MAX_CID = 15000 <br> FIELD_MAIL = mail <br> FIELD_QUOTA = mailQuota <br> FIELD_FWDTARGET = mailForwardingAddress <br> <br> [DELIVERY] <br> # <br> # Run Sieve scripts as messages are delivered. <br> # <br> SIEVE = yes <br> <br> # <br> # Use 'user+mailbox@domain' format to deliver to a mailbox. <br> # <br> SUBADDRESS = yes <br> <br> # <br> # Turn on/off the Sieve Vacation extension. <br> # <br> SIEVE_VACATION = yes <br> <br> # <br> # Turn on/off the Sieve Notify extension <br> # <br> SIEVE_NOTIFY = yes <br> <br> # <br> # Turn on/off additional Sieve debugging. <br> # <br> SIEVE_DEBUG = no <br> <br> # <br> # Use the auto_notify table to send email notifications. <br> # <br> AUTO_NOTIFY = no <br> <br> # <br> # Use the auto_reply table to send away messages. <br> # <br> AUTO_REPLY = no <br> # <br> # Defaults to "NEW MAIL NOTIFICATION" <br> # <br> #AUTO_NOTIFY_SUBJECT = <br> <br> # <br> # Defaults to POSTMASTER from the DBMAIL section. <br> # <br> #AUTO_NOTIFY_SENDER = <br> <br> # <br> # If you set this to 'yes' dbmail will check for duplicate <br> # messages in the relevant mailbox during delivery using <br> # the Message-ID header <br> # <br> suppress_duplicates = no <br> <br> # end of configuration file <br> <br> <br></code> <br> <br> Spamassassin <br>    ,         ,          /etc/spamasassin,      ,       nobody <br> <br> local.cf <br> <code>rewrite_header Subject ***SPAM*** <br> report_safe 1 <br> trusted_networks 192.168/16 127/8 <br> # lock_method flock <br> required_score 5.0 <br> use_bayes 1 <br> bayes_auto_learn 1 <br> # bayes_ignore_header X-Bogosity <br> # bayes_ignore_header X-Spam-Flag <br> # bayes_ignore_header X-Spam-Status <br> auto_whitelist_path /etc/mail/spamassassin/auto_whitelist <br> bayes_path /etc/mail/spamassassin/bayes <br> bayes_file_mode 0666 <br> bayes_min_ham_num 1 <br> bayes_min_spam_num 1 <br> auto_learn_threshold_nonspam -2 <br> auto_learn_threshold_spam 5 <br> bayes_learn_to_journal 1 <br> skip_rbl_checks 0 <br> <br> ok_languages ru en <br> ok_locales ru en <br></code> <br> <br>    ..     <br> <code>/etc/init.d/exim start <br> /etc/init.d/spamd start <br> #    pop3      <br> /etc/init.d/dbmail-pop3d <br></code> <br> <br>     ,           <br> <code>rc-update add postgresql default <br> rc-update add exim default <br> rc-update add spamd default <br> rc-update add dbmail-pop3d default <br></code> <br> <br>          ,       <br> <code>dbmail-users -a admin@example.com -s admin@example.com -p plaintext -w 123123 <br></code> <br> <br>   ,        <br></code> <blockquote> <code><code><code><a href="http://njabl.org/"></a> <a href="http://www.spamcop.net/w3m%3Faction%3Dcheckblock%26ip%3D"></a> <font color="black">CREATE TYPE dtype AS ENUM ( <br> <font color="#A31515">'LOCAL'</font> , <br> <font color="#A31515">'VIRTUAL'</font> , <br> <font color="#A31515">'RELAY'</font> <br> ); <br> <br> ALTER TYPE <font color="#0000ff">public</font> .dtype OWNER TO dbmail; <br> <br> SET default_with_oids = <font color="#0000ff">true</font> ; <br> <br> CREATE TABLE dbmail_domains ( <br> uid integer NOT NULL, <br> domain character varying(128) NOT NULL, <br> type dtype NOT NULL <br> ); <br> <br> INSERT INTO dbmail_domains (uid, domain, type) VALUES (1, <font color="#A31515">'example.com'</font> , <font color="#A31515">'LOCAL'</font> );</font> <br>   . <br> <br> Exim <br> C   exim.conf <br> #!/bin/sh <br> ###################################################################### <br> # Runtime configuration file for Exim # <br> ###################################################################### <br> ####################################################################### <br> # MAIN CONFIGURATION SETTINGS # <br> ###################################################################### <br> <br> primary_hostname = example.com <br> domainlist local_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND \ <br> (type='LOCAL' OR type='VIRTUAL')}} <br> domainlist relay_to_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND type='RELAY'}} <br> hostlist relay_from_hosts = 127.0.0.1: localhost <br> auth_advertise_hosts = * <br> daemon_smtp_ports = 25 <br> log_selector = \ <br> +all_parents \ <br> +lost_incoming_connection \ <br> +received_sender \ <br> +received_recipients \ <br> +smtp_confirmation \ <br> +smtp_syntax_error \ <br> +smtp_protocol_error \ <br> -queue_run <br> acl_smtp_rcpt = acl_check_rcpt <br> acl_smtp_mime = acl_check_mime <br> acl_smtp_data = acl_check_content <br> qualify_domain = example.com <br> allow_domain_literals = false <br> exim_user = mail <br> exim_group = mail <br> never_users = root <br> host_lookup = * <br> #rfc1413_hosts = * <br> rfc1413_query_timeout = 0s <br> ignore_bounce_errors_after = 30m <br> timeout_frozen_after = 3d <br> freeze_tell = postmaster <br> <br> #av_scanner = clamd:/var/run/clamav/clamd.ctl #        <br> spamd_address = 127.0.0.1 783 <br> <br> message_size_limit = 10M <br> smtp_accept_max = 1000 <br> smtp_accept_max_per_connection = 150 <br> smtp_accept_max_per_host = 30 <br> split_spool_directory = true <br> remote_max_parallel = 15 <br> smtp_banner = "Welcome on our mail server!\n\ <br> This system does not accept Unsolicited \ <br> Commercial Email\nand will blacklist \ <br> offenders via our spam processor.\nHave a \ <br> nice day!\n\n${primary_hostname} ESMTP" <br> <br> hide pgsql_servers = localhost/dbmail/dbmail/PasSWorD <br> <br> ###################################################################### <br> # ACL CONFIGURATION # <br> # Specifies access control lists for incoming SMTP mail # <br> ###################################################################### <br> begin acl <br> <br> acl_check_rcpt: <br> <br> warn <br> set acl_m0 = 0s <br> warn <br> hosts = !+relay_from_hosts:!213.243.111.115/32 <br> set acl_m0 = 30s <br> warn <br> condition = ${if and {\ <br> {match{$sender_host_name}\ <br> {\N^[-az]*\d{0,3}[-az]*\.?[-az]*\d{0,3}[-az]*\.\w+$\N}} \ <br> {!eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 1s <br> <br> warn <br> condition = ${if and {\ <br> {match{$sender_helo_name}{\N^\w*\.\w{3}$\N}} \ <br> {eq{$acl_c1}{}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c2}{outblaze_domain}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if or {\ <br> {eq{$sender_address}{}} \ <br> {eq{$acl_m1}{0s}} \ <br> } {yes}{no}} <br> set acl_m0 = 0s <br> <br> warn <br> logwrite = Delay $acl_m0 for $sender_host_name \ <br> [$sender_host_address] with HELO=$sender_helo_name. \ <br> Mail from $sender_address to $local_part@$domain. <br> set acl_m1 = 0s <br> delay = $acl_m0 <br> <br> accept hosts = : <br> <br> deny domains = +local_domains <br> local_parts = ^[.] : ^.*[@%!/|] <br> <br> deny domains = !+local_domains <br> local_parts = ^[./|] : ^.*[@%!] : ^.*/\\.\\./ <br> <br> accept local_parts = postmaster <br> domains = +local_domains <br> <br> require verify = sender <br> <br> deny message = HELO/EHLO required by SMTP RFC <br> condition = ${if eq{$sender_helo_name}{}{yes}{no}} <br> <br> deny message = Go Away! You are spammer. <br> condition = ${if match{$sender_host_name} \ <br> {bezeqint\\.net|net\\.il|dialup|dsl|pool|peer|dhcp} \ <br> {yes}{no}} <br> <br> deny message = message from \ <br> $sender_host_address rejected - see njabl.org <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.njabl.org <br> <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dialups.mail-abuse.org <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = list.dsbl.org <br> deny message = Spam blocked see: \ <br> www.spamcop.net/w3m?action=checkblock&amp;ip=$sender_host_address <br> log_message = found in $dnslist_domain <br> dnslists = bl.spamcop.net <br> deny message = rejected, $sender_host_address \ <br> Open Proxy, see: $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.void.ru <br> <br> accept domains = +local_domains <br> endpass <br> message = unknown user <br> verify = recipient <br> <br> accept domains = +relay_to_domains <br> endpass <br> message = unrouteable address <br> verify = recipient <br> <br> accept hosts = +relay_from_hosts <br> accept authenticated = * <br> deny message = relay not permitted <br> <br> acl_check_mime: <br> <br> warn decode = default <br> <br> deny message = Blacklisted file extension detected ($mime_filename) <br> condition = ${if match \ <br> {${lc:$mime_filename}} \ <br> {\N(\.exe|\.pif|\.bat|\.scr|\.lnk|\.com|\.vbs|\.cpl)$\N} \ <br> {1}{0}} <br> <br> deny message = Sorry, noone speaks chinese here <br> condition = ${if eq{$mime_charset}{gb2312}{1}{0}} <br> <br> accept <br> <br> acl_check_content: <br> # deny message = Virus found ($malware_name) <br> # malware = * <br> <br> warn message = X-Spam-Score: $spam_score ($spam_bar) <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = X-Spam-Report: $spam_report <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = Subject: ***SPAM*** $h_Subject: <br> hosts = !+relay_from_hosts <br> spam = spamd <br> <br> deny message = This message scored $spam_score spam points. <br> spam = spamd:true <br> hosts = !+relay_from_hosts <br> condition = ${if &gt;{$spam_score_int}{120}{1}{0}} <br> <br> accept <br> <br> ###################################################################### <br> # ROUTERS CONFIGURATION # <br> # Specifies how addresses are handled # <br> ###################################################################### <br> # THE ORDER IN WHICH THE ROUTERS ARE DEFINED IS IMPORTANT! # <br> # An address is passed to each router in turn until it is accepted. # <br> ###################################################################### <br> <br> begin routers <br> <br> dnslookup: <br> driver = dnslookup <br> domains = ! +local_domains <br> transport = remote_smtp <br> ignore_target_hosts = 0.0.0.0 : 127.0.0.0/8 <br> no_more <br> <br> dbmailuser: <br> driver = accept <br> condition = ${lookup pgsql{SELECT alias_idnr FROM \ <br> dbmail_aliases WHERE \ <br> alias='${quote_pgsql:$local_part@$domain}' OR \ <br> alias='${quote_pgsql:@$domain}'}{yes}{no}} <br> transport = dbmail_delivery <br> <br> ###################################################################### <br> # TRANSPORTS CONFIGURATION # <br> ###################################################################### <br> # ORDER DOES NOT MATTER # <br> # Only one appropriate transport is called for each delivery. # <br> ###################################################################### <br> <br> begin transports <br> <br> remote_smtp: <br> driver = smtp <br> <br> dbmail_delivery: <br> driver = pipe <br> check_string = <br> command = /usr/sbin/dbmail-smtp -d ${pipe_addresses} <br> group = mail <br> message_prefix = "" <br> message_suffix = "" <br> path="/bin:/sbin:/usr/bin:/usr/sbin" <br> #   <br> address_pipe: <br> driver = pipe <br> return_output <br> <br> address_reply: <br> driver = autoreply <br> <br> ###################################################################### <br> # RETRY CONFIGURATION # <br> ###################################################################### <br> <br> begin retry <br> <br> * quota <br> * * F,2h,15m; G,16h,1h,1.5; F,4d,6h <br> <br> ###################################################################### <br> # REWRITE CONFIGURATION # <br> ###################################################################### <br> <br> begin rewrite <br> <br> ###################################################################### <br> # AUTHENTICATION CONFIGURATION # <br> ###################################################################### <br> <br> begin authenticators <br> <br> auth_plain: <br> driver = plaintext <br> public_name = PLAIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = : <br> server_set_id = $2 <br> <br> #    ,    . <br> auth_login: <br> driver = plaintext <br> public_name = LOGIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = Username:: : Password:: <br> server_set_id = $1 <br> <br> #    " " - TheBat! <br> auth_cram_md5: <br> driver = cram_md5 <br> public_name = CRAM-MD5 <br> server_secret = ${lookup pgsql{SELECT passwd FROM \ <br> dbmail_users WHERE userid \ <br> = '${quote_pgsql:$1}'}{$value}fail} <br> server_set_id = $1 <br> # End of Exim configuration file <br> ###ps  lissyara,       <br> <br></code> <br> <br> DBMail <br> dbmail.conf          <br> <code># (c) 2000-2006 IC&amp;S, The Netherlands <br> # <br> # Configuration file for DBMAIL <br> <br> [DBMAIL] <br> # <br> # Database settings <br> # <br> <br> # <br> # Supported drivers are mysql, pgsql, sqlite. <br> # <br> driver =pgsql <br> <br> # <br> # Supported drivers are sql, ldap. <br> # <br> authdriver =sql <br> <br> # <br> # Host for database, set to localhost if database is on <br> # the same host as dbmail and you want to use a local <br> # socket for connecting. <br> # <br> host =localhost <br> <br> # <br> # If you want to use TCP/IP for connecting to the database, <br> # and have the database running on a non-standard port. <br> # <br> sqlport =5432 <br> <br> # <br> # When using a local socket connection to the database, fill <br> # in the path to the socket here (eg /var/run/mysql.sock). <br> # <br> sqlsocket = <br> <br> # <br> # Database username. <br> # <br> user =dbmail <br> <br> # <br> # Database password. <br> # <br> pass =PasWoRd <br> <br> # <br> # Database name. <br> # <br> db =dbmail <br> <br> # <br> # Table prefix. Defaults to "dbmail_" if not specified. <br> # <br> table_prefix =dbmail_ <br> <br> # <br> # encoding must match the database/table encoding. <br> # ie latin1, utf8 <br> encoding = utf8 <br> <br> # <br> # messages with unknown encoding will be assumed to have <br> # default_msg_encoding <br> # ie iso8859-1, utf8 <br> default_msg_encoding = utf8 <br> <br> # <br> # Postmaster's email address for use in bounce messages. <br> # <br> #postmaster = DBMAIL-MAILER <br> <br> # <br> # Sendmail executable for forwards, replies, notifies, vacations. <br> # You may use pipes (|) in this command, for example: <br> # dos2unix|/usr/sbin/sendmail works well with Qmail. <br> # You may use quotes (") for executables with unusual names. <br> # <br> sendmail = /usr/sbin/sendmail <br> <br> # <br> # <br> # The following items can be overridden in the service-specific sections. <br> # <br> # <br> <br> # <br> # Trace level to send to syslog. Default is 2 (messages, errors, fatals). <br> # <br> TRACE_SYSLOG = 3 <br> <br> # <br> # Trace level to send to stderr. Default is 0 (fatals). <br> # <br> TRACE_STDERR = 1 <br> <br> # <br> # Root privs are used to open a port, then privs <br> # are dropped down to the user/group specified here. <br> # <br> EFFECTIVE_USER = dbmail <br> EFFECTIVE_GROUP = dbmail <br> <br> # <br> # The IP addresses the services will bind to. <br> # Use * for all local interfaces. <br> # Use 127.0.0.1 for localhost only. <br> # Separate multiple entries with spaces ( ) or commas (,). <br> # <br> BINDIP = * <br> <br> # <br> # Default number of child processes to start. <br> # <br> NCHILDREN = 2 <br> <br> # <br> # Maximum number of child processes allowed. <br> # <br> MAXCHILDREN = 10 <br> <br> # <br> # Unused children to always have availale. <br> # <br> MINSPARECHILDREN = 2 <br> <br> # <br> # Maximum unused children allowed to be active. <br> # <br> MAXSPARECHILDREN = 4 <br> <br> # <br> # Child process is restarted after handling this many connections. <br> # <br> MAXCONNECTS = 10000 <br> <br> # <br> # Child process will restart after this many connection errors. <br> # <br> MAX_ERRORS = 500 <br> <br> # <br> # Idle time allowed before a connection is shut off. <br> # <br> TIMEOUT = 300 <br> <br> # <br> # Idle time allowed before a connection is shut off if you have not logged in yet. <br> # <br> login_timeout = 60 <br> <br> # <br> # If yes, resolves IP addresses to DNS names when logging. <br> # <br> RESOLVE_IP = no <br> <br> # <br> # logfile for stdout messages <br> # <br> logfile = /var/log/dbmail.log <br> <br> # <br> # logfile for stderr messages <br> # <br> errorlog = /var/log/dbmail.err <br> <br> # <br> # directory for storing PID files <br> # <br> pid_directory = /var/run <br> <br> # <br> # directory for storing the daemon statefiles <br> # <br> state_directory = /var/run <br> <br> # <br> # directory for locating libraries (normally has a sane default compiled-in) <br> # <br> #library_directory = /usr/lib/dbmail <br> <br> [SMTP] <br> # In fact, there isn't anything here by default. <br> <br> [LMTP] <br> # <br> # Port to bind to. <br> # <br> PORT = 24 <br> <br> [POP] <br> # <br> # Port to bind to. <br> # <br> PORT = 110 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by POP3. <br> # This requires addition configuration of your MTA <br> # <br> POP_BEFORE_SMTP = no <br> <br> [IMAP] <br> <br> # <br> # Port to bind to. <br> # <br> PORT = 143 <br> <br> # <br> # IMAP prefers a longer timeout than other services. <br> # <br> TIMEOUT = 4000 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by IMAP. <br> # This requires addition configuration of your MTA <br> # <br> IMAP_BEFORE_SMTP = no <br> <br> # <br> # during IDLE, how many seconds between checking the mailbox <br> # status (default: 30) <br> # <br> # idle_timeout = 30 <br> <br> # <br> # Provide a CAPABILITY to override the default <br> # <br> # capability = IMAP4 IMAP4rev1 AUTH=LOGIN ACL NAMESPACE CHILDREN SORT QUOTA THREAD=ORDEREDSUBJECT UNSELECT IDLE <br> <br> [SIEVE] <br> # <br> # Port to bind to. <br> # <br> PORT = 2000 <br> <br> [LDAP] <br> PORT = 389 <br> VERSION = 3 <br> HOSTNAME = ldap <br> BASE_DN = ou=People,dc=mydomain,dc=com <br> <br> # <br> # If your LDAP library supports ldap_initialize(), then you can use the <br> # alternative LDAP server DSN like following. <br> # <br> # URI = ldap://127.0.0.1:389 <br> # URI = ldapi://%2fvar%2frun%2fopenldap%2fldapi/ <br> <br> # <br> # Leave blank for anonymous bind. <br> # example: cn=admin,dc=mydomain,dc=com <br> # <br> BIND_DN = <br> <br> # <br> # Leave blank for anonymous bind. <br> # <br> BIND_PW = <br> SCOPE = SubTree <br> USER_OBJECTCLASS = top,account,dbmailUser <br> FORW_OBJECTCLASS = top,account,dbmailForwardingAddress <br> CN_STRING = uid <br> FIELD_PASSWD = userPassword <br> FIELD_UID = uid <br> FIELD_NID = uidNumber <br> MIN_NID = 10000 <br> MAX_NID = 15000 <br> FIELD_CID = gidNumber <br> MIN_CID = 10000 <br> MAX_CID = 15000 <br> FIELD_MAIL = mail <br> FIELD_QUOTA = mailQuota <br> FIELD_FWDTARGET = mailForwardingAddress <br> <br> [DELIVERY] <br> # <br> # Run Sieve scripts as messages are delivered. <br> # <br> SIEVE = yes <br> <br> # <br> # Use 'user+mailbox@domain' format to deliver to a mailbox. <br> # <br> SUBADDRESS = yes <br> <br> # <br> # Turn on/off the Sieve Vacation extension. <br> # <br> SIEVE_VACATION = yes <br> <br> # <br> # Turn on/off the Sieve Notify extension <br> # <br> SIEVE_NOTIFY = yes <br> <br> # <br> # Turn on/off additional Sieve debugging. <br> # <br> SIEVE_DEBUG = no <br> <br> # <br> # Use the auto_notify table to send email notifications. <br> # <br> AUTO_NOTIFY = no <br> <br> # <br> # Use the auto_reply table to send away messages. <br> # <br> AUTO_REPLY = no <br> # <br> # Defaults to "NEW MAIL NOTIFICATION" <br> # <br> #AUTO_NOTIFY_SUBJECT = <br> <br> # <br> # Defaults to POSTMASTER from the DBMAIL section. <br> # <br> #AUTO_NOTIFY_SENDER = <br> <br> # <br> # If you set this to 'yes' dbmail will check for duplicate <br> # messages in the relevant mailbox during delivery using <br> # the Message-ID header <br> # <br> suppress_duplicates = no <br> <br> # end of configuration file <br> <br> <br></code> <br> <br> Spamassassin <br>    ,         ,          /etc/spamasassin,      ,       nobody <br> <br> local.cf <br> <code>rewrite_header Subject ***SPAM*** <br> report_safe 1 <br> trusted_networks 192.168/16 127/8 <br> # lock_method flock <br> required_score 5.0 <br> use_bayes 1 <br> bayes_auto_learn 1 <br> # bayes_ignore_header X-Bogosity <br> # bayes_ignore_header X-Spam-Flag <br> # bayes_ignore_header X-Spam-Status <br> auto_whitelist_path /etc/mail/spamassassin/auto_whitelist <br> bayes_path /etc/mail/spamassassin/bayes <br> bayes_file_mode 0666 <br> bayes_min_ham_num 1 <br> bayes_min_spam_num 1 <br> auto_learn_threshold_nonspam -2 <br> auto_learn_threshold_spam 5 <br> bayes_learn_to_journal 1 <br> skip_rbl_checks 0 <br> <br> ok_languages ru en <br> ok_locales ru en <br></code> <br> <br>    ..     <br> /etc/init.d/exim start <br> /etc/init.d/spamd start <br> #    pop3      <br> /etc/init.d/dbmail-pop3d <br> <br> <br>     ,           <br> <code>rc-update add postgresql default <br> rc-update add exim default <br> rc-update add spamd default <br> rc-update add dbmail-pop3d default <br></code> <br> <br>          ,       <br> <code>dbmail-users -a admin@example.com -s admin@example.com -p plaintext -w 123123 <br></code> <br> <br>   ,        <br></code></code> </blockquote> <code><code><a href="http://njabl.org/"></a> <a href="http://www.spamcop.net/w3m%3Faction%3Dcheckblock%26ip%3D"></a> <font color="black">CREATE TYPE dtype AS ENUM ( <br> <font color="#A31515">'LOCAL'</font> , <br> <font color="#A31515">'VIRTUAL'</font> , <br> <font color="#A31515">'RELAY'</font> <br> ); <br> <br> ALTER TYPE <font color="#0000ff">public</font> .dtype OWNER TO dbmail; <br> <br> SET default_with_oids = <font color="#0000ff">true</font> ; <br> <br> CREATE TABLE dbmail_domains ( <br> uid integer NOT NULL, <br> domain character varying(128) NOT NULL, <br> type dtype NOT NULL <br> ); <br> <br> INSERT INTO dbmail_domains (uid, domain, type) VALUES (1, <font color="#A31515">'example.com'</font> , <font color="#A31515">'LOCAL'</font> );</font> <br>   . <br> <br> Exim <br> C   exim.conf <br> #!/bin/sh <br> ###################################################################### <br> # Runtime configuration file for Exim # <br> ###################################################################### <br> ####################################################################### <br> # MAIN CONFIGURATION SETTINGS # <br> ###################################################################### <br> <br> primary_hostname = example.com <br> domainlist local_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND \ <br> (type='LOCAL' OR type='VIRTUAL')}} <br> domainlist relay_to_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND type='RELAY'}} <br> hostlist relay_from_hosts = 127.0.0.1: localhost <br> auth_advertise_hosts = * <br> daemon_smtp_ports = 25 <br> log_selector = \ <br> +all_parents \ <br> +lost_incoming_connection \ <br> +received_sender \ <br> +received_recipients \ <br> +smtp_confirmation \ <br> +smtp_syntax_error \ <br> +smtp_protocol_error \ <br> -queue_run <br> acl_smtp_rcpt = acl_check_rcpt <br> acl_smtp_mime = acl_check_mime <br> acl_smtp_data = acl_check_content <br> qualify_domain = example.com <br> allow_domain_literals = false <br> exim_user = mail <br> exim_group = mail <br> never_users = root <br> host_lookup = * <br> #rfc1413_hosts = * <br> rfc1413_query_timeout = 0s <br> ignore_bounce_errors_after = 30m <br> timeout_frozen_after = 3d <br> freeze_tell = postmaster <br> <br> #av_scanner = clamd:/var/run/clamav/clamd.ctl #        <br> spamd_address = 127.0.0.1 783 <br> <br> message_size_limit = 10M <br> smtp_accept_max = 1000 <br> smtp_accept_max_per_connection = 150 <br> smtp_accept_max_per_host = 30 <br> split_spool_directory = true <br> remote_max_parallel = 15 <br> smtp_banner = "Welcome on our mail server!\n\ <br> This system does not accept Unsolicited \ <br> Commercial Email\nand will blacklist \ <br> offenders via our spam processor.\nHave a \ <br> nice day!\n\n${primary_hostname} ESMTP" <br> <br> hide pgsql_servers = localhost/dbmail/dbmail/PasSWorD <br> <br> ###################################################################### <br> # ACL CONFIGURATION # <br> # Specifies access control lists for incoming SMTP mail # <br> ###################################################################### <br> begin acl <br> <br> acl_check_rcpt: <br> <br> warn <br> set acl_m0 = 0s <br> warn <br> hosts = !+relay_from_hosts:!213.243.111.115/32 <br> set acl_m0 = 30s <br> warn <br> condition = ${if and {\ <br> {match{$sender_host_name}\ <br> {\N^[-az]*\d{0,3}[-az]*\.?[-az]*\d{0,3}[-az]*\.\w+$\N}} \ <br> {!eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 1s <br> <br> warn <br> condition = ${if and {\ <br> {match{$sender_helo_name}{\N^\w*\.\w{3}$\N}} \ <br> {eq{$acl_c1}{}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c2}{outblaze_domain}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if or {\ <br> {eq{$sender_address}{}} \ <br> {eq{$acl_m1}{0s}} \ <br> } {yes}{no}} <br> set acl_m0 = 0s <br> <br> warn <br> logwrite = Delay $acl_m0 for $sender_host_name \ <br> [$sender_host_address] with HELO=$sender_helo_name. \ <br> Mail from $sender_address to $local_part@$domain. <br> set acl_m1 = 0s <br> delay = $acl_m0 <br> <br> accept hosts = : <br> <br> deny domains = +local_domains <br> local_parts = ^[.] : ^.*[@%!/|] <br> <br> deny domains = !+local_domains <br> local_parts = ^[./|] : ^.*[@%!] : ^.*/\\.\\./ <br> <br> accept local_parts = postmaster <br> domains = +local_domains <br> <br> require verify = sender <br> <br> deny message = HELO/EHLO required by SMTP RFC <br> condition = ${if eq{$sender_helo_name}{}{yes}{no}} <br> <br> deny message = Go Away! You are spammer. <br> condition = ${if match{$sender_host_name} \ <br> {bezeqint\\.net|net\\.il|dialup|dsl|pool|peer|dhcp} \ <br> {yes}{no}} <br> <br> deny message = message from \ <br> $sender_host_address rejected - see njabl.org <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.njabl.org <br> <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dialups.mail-abuse.org <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = list.dsbl.org <br> deny message = Spam blocked see: \ <br> www.spamcop.net/w3m?action=checkblock&amp;ip=$sender_host_address <br> log_message = found in $dnslist_domain <br> dnslists = bl.spamcop.net <br> deny message = rejected, $sender_host_address \ <br> Open Proxy, see: $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.void.ru <br> <br> accept domains = +local_domains <br> endpass <br> message = unknown user <br> verify = recipient <br> <br> accept domains = +relay_to_domains <br> endpass <br> message = unrouteable address <br> verify = recipient <br> <br> accept hosts = +relay_from_hosts <br> accept authenticated = * <br> deny message = relay not permitted <br> <br> acl_check_mime: <br> <br> warn decode = default <br> <br> deny message = Blacklisted file extension detected ($mime_filename) <br> condition = ${if match \ <br> {${lc:$mime_filename}} \ <br> {\N(\.exe|\.pif|\.bat|\.scr|\.lnk|\.com|\.vbs|\.cpl)$\N} \ <br> {1}{0}} <br> <br> deny message = Sorry, noone speaks chinese here <br> condition = ${if eq{$mime_charset}{gb2312}{1}{0}} <br> <br> accept <br> <br> acl_check_content: <br> # deny message = Virus found ($malware_name) <br> # malware = * <br> <br> warn message = X-Spam-Score: $spam_score ($spam_bar) <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = X-Spam-Report: $spam_report <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = Subject: ***SPAM*** $h_Subject: <br> hosts = !+relay_from_hosts <br> spam = spamd <br> <br> deny message = This message scored $spam_score spam points. <br> spam = spamd:true <br> hosts = !+relay_from_hosts <br> condition = ${if &gt;{$spam_score_int}{120}{1}{0}} <br> <br> accept <br> <br> ###################################################################### <br> # ROUTERS CONFIGURATION # <br> # Specifies how addresses are handled # <br> ###################################################################### <br> # THE ORDER IN WHICH THE ROUTERS ARE DEFINED IS IMPORTANT! # <br> # An address is passed to each router in turn until it is accepted. # <br> ###################################################################### <br> <br> begin routers <br> <br> dnslookup: <br> driver = dnslookup <br> domains = ! +local_domains <br> transport = remote_smtp <br> ignore_target_hosts = 0.0.0.0 : 127.0.0.0/8 <br> no_more <br> <br> dbmailuser: <br> driver = accept <br> condition = ${lookup pgsql{SELECT alias_idnr FROM \ <br> dbmail_aliases WHERE \ <br> alias='${quote_pgsql:$local_part@$domain}' OR \ <br> alias='${quote_pgsql:@$domain}'}{yes}{no}} <br> transport = dbmail_delivery <br> <br> ###################################################################### <br> # TRANSPORTS CONFIGURATION # <br> ###################################################################### <br> # ORDER DOES NOT MATTER # <br> # Only one appropriate transport is called for each delivery. # <br> ###################################################################### <br> <br> begin transports <br> <br> remote_smtp: <br> driver = smtp <br> <br> dbmail_delivery: <br> driver = pipe <br> check_string = <br> command = /usr/sbin/dbmail-smtp -d ${pipe_addresses} <br> group = mail <br> message_prefix = "" <br> message_suffix = "" <br> path="/bin:/sbin:/usr/bin:/usr/sbin" <br> #   <br> address_pipe: <br> driver = pipe <br> return_output <br> <br> address_reply: <br> driver = autoreply <br> <br> ###################################################################### <br> # RETRY CONFIGURATION # <br> ###################################################################### <br> <br> begin retry <br> <br> * quota <br> * * F,2h,15m; G,16h,1h,1.5; F,4d,6h <br> <br> ###################################################################### <br> # REWRITE CONFIGURATION # <br> ###################################################################### <br> <br> begin rewrite <br> <br> ###################################################################### <br> # AUTHENTICATION CONFIGURATION # <br> ###################################################################### <br> <br> begin authenticators <br> <br> auth_plain: <br> driver = plaintext <br> public_name = PLAIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = : <br> server_set_id = $2 <br> <br> #    ,    . <br> auth_login: <br> driver = plaintext <br> public_name = LOGIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = Username:: : Password:: <br> server_set_id = $1 <br> <br> #    " " - TheBat! <br> auth_cram_md5: <br> driver = cram_md5 <br> public_name = CRAM-MD5 <br> server_secret = ${lookup pgsql{SELECT passwd FROM \ <br> dbmail_users WHERE userid \ <br> = '${quote_pgsql:$1}'}{$value}fail} <br> server_set_id = $1 <br> # End of Exim configuration file <br> ###ps  lissyara,       <br> <br></code> <br> <br> DBMail <br> dbmail.conf          <br> <code># (c) 2000-2006 IC&amp;S, The Netherlands <br> # <br> # Configuration file for DBMAIL <br> <br> [DBMAIL] <br> # <br> # Database settings <br> # <br> <br> # <br> # Supported drivers are mysql, pgsql, sqlite. <br> # <br> driver =pgsql <br> <br> # <br> # Supported drivers are sql, ldap. <br> # <br> authdriver =sql <br> <br> # <br> # Host for database, set to localhost if database is on <br> # the same host as dbmail and you want to use a local <br> # socket for connecting. <br> # <br> host =localhost <br> <br> # <br> # If you want to use TCP/IP for connecting to the database, <br> # and have the database running on a non-standard port. <br> # <br> sqlport =5432 <br> <br> # <br> # When using a local socket connection to the database, fill <br> # in the path to the socket here (eg /var/run/mysql.sock). <br> # <br> sqlsocket = <br> <br> # <br> # Database username. <br> # <br> user =dbmail <br> <br> # <br> # Database password. <br> # <br> pass =PasWoRd <br> <br> # <br> # Database name. <br> # <br> db =dbmail <br> <br> # <br> # Table prefix. Defaults to "dbmail_" if not specified. <br> # <br> table_prefix =dbmail_ <br> <br> # <br> # encoding must match the database/table encoding. <br> # ie latin1, utf8 <br> encoding = utf8 <br> <br> # <br> # messages with unknown encoding will be assumed to have <br> # default_msg_encoding <br> # ie iso8859-1, utf8 <br> default_msg_encoding = utf8 <br> <br> # <br> # Postmaster's email address for use in bounce messages. <br> # <br> #postmaster = DBMAIL-MAILER <br> <br> # <br> # Sendmail executable for forwards, replies, notifies, vacations. <br> # You may use pipes (|) in this command, for example: <br> # dos2unix|/usr/sbin/sendmail works well with Qmail. <br> # You may use quotes (") for executables with unusual names. <br> # <br> sendmail = /usr/sbin/sendmail <br> <br> # <br> # <br> # The following items can be overridden in the service-specific sections. <br> # <br> # <br> <br> # <br> # Trace level to send to syslog. Default is 2 (messages, errors, fatals). <br> # <br> TRACE_SYSLOG = 3 <br> <br> # <br> # Trace level to send to stderr. Default is 0 (fatals). <br> # <br> TRACE_STDERR = 1 <br> <br> # <br> # Root privs are used to open a port, then privs <br> # are dropped down to the user/group specified here. <br> # <br> EFFECTIVE_USER = dbmail <br> EFFECTIVE_GROUP = dbmail <br> <br> # <br> # The IP addresses the services will bind to. <br> # Use * for all local interfaces. <br> # Use 127.0.0.1 for localhost only. <br> # Separate multiple entries with spaces ( ) or commas (,). <br> # <br> BINDIP = * <br> <br> # <br> # Default number of child processes to start. <br> # <br> NCHILDREN = 2 <br> <br> # <br> # Maximum number of child processes allowed. <br> # <br> MAXCHILDREN = 10 <br> <br> # <br> # Unused children to always have availale. <br> # <br> MINSPARECHILDREN = 2 <br> <br> # <br> # Maximum unused children allowed to be active. <br> # <br> MAXSPARECHILDREN = 4 <br> <br> # <br> # Child process is restarted after handling this many connections. <br> # <br> MAXCONNECTS = 10000 <br> <br> # <br> # Child process will restart after this many connection errors. <br> # <br> MAX_ERRORS = 500 <br> <br> # <br> # Idle time allowed before a connection is shut off. <br> # <br> TIMEOUT = 300 <br> <br> # <br> # Idle time allowed before a connection is shut off if you have not logged in yet. <br> # <br> login_timeout = 60 <br> <br> # <br> # If yes, resolves IP addresses to DNS names when logging. <br> # <br> RESOLVE_IP = no <br> <br> # <br> # logfile for stdout messages <br> # <br> logfile = /var/log/dbmail.log <br> <br> # <br> # logfile for stderr messages <br> # <br> errorlog = /var/log/dbmail.err <br> <br> # <br> # directory for storing PID files <br> # <br> pid_directory = /var/run <br> <br> # <br> # directory for storing the daemon statefiles <br> # <br> state_directory = /var/run <br> <br> # <br> # directory for locating libraries (normally has a sane default compiled-in) <br> # <br> #library_directory = /usr/lib/dbmail <br> <br> [SMTP] <br> # In fact, there isn't anything here by default. <br> <br> [LMTP] <br> # <br> # Port to bind to. <br> # <br> PORT = 24 <br> <br> [POP] <br> # <br> # Port to bind to. <br> # <br> PORT = 110 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by POP3. <br> # This requires addition configuration of your MTA <br> # <br> POP_BEFORE_SMTP = no <br> <br> [IMAP] <br> <br> # <br> # Port to bind to. <br> # <br> PORT = 143 <br> <br> # <br> # IMAP prefers a longer timeout than other services. <br> # <br> TIMEOUT = 4000 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by IMAP. <br> # This requires addition configuration of your MTA <br> # <br> IMAP_BEFORE_SMTP = no <br> <br> # <br> # during IDLE, how many seconds between checking the mailbox <br> # status (default: 30) <br> # <br> # idle_timeout = 30 <br> <br> # <br> # Provide a CAPABILITY to override the default <br> # <br> # capability = IMAP4 IMAP4rev1 AUTH=LOGIN ACL NAMESPACE CHILDREN SORT QUOTA THREAD=ORDEREDSUBJECT UNSELECT IDLE <br> <br> [SIEVE] <br> # <br> # Port to bind to. <br> # <br> PORT = 2000 <br> <br> [LDAP] <br> PORT = 389 <br> VERSION = 3 <br> HOSTNAME = ldap <br> BASE_DN = ou=People,dc=mydomain,dc=com <br> <br> # <br> # If your LDAP library supports ldap_initialize(), then you can use the <br> # alternative LDAP server DSN like following. <br> # <br> # URI = ldap://127.0.0.1:389 <br> # URI = ldapi://%2fvar%2frun%2fopenldap%2fldapi/ <br> <br> # <br> # Leave blank for anonymous bind. <br> # example: cn=admin,dc=mydomain,dc=com <br> # <br> BIND_DN = <br> <br> # <br> # Leave blank for anonymous bind. <br> # <br> BIND_PW = <br> SCOPE = SubTree <br> USER_OBJECTCLASS = top,account,dbmailUser <br> FORW_OBJECTCLASS = top,account,dbmailForwardingAddress <br> CN_STRING = uid <br> FIELD_PASSWD = userPassword <br> FIELD_UID = uid <br> FIELD_NID = uidNumber <br> MIN_NID = 10000 <br> MAX_NID = 15000 <br> FIELD_CID = gidNumber <br> MIN_CID = 10000 <br> MAX_CID = 15000 <br> FIELD_MAIL = mail <br> FIELD_QUOTA = mailQuota <br> FIELD_FWDTARGET = mailForwardingAddress <br> <br> [DELIVERY] <br> # <br> # Run Sieve scripts as messages are delivered. <br> # <br> SIEVE = yes <br> <br> # <br> # Use 'user+mailbox@domain' format to deliver to a mailbox. <br> # <br> SUBADDRESS = yes <br> <br> # <br> # Turn on/off the Sieve Vacation extension. <br> # <br> SIEVE_VACATION = yes <br> <br> # <br> # Turn on/off the Sieve Notify extension <br> # <br> SIEVE_NOTIFY = yes <br> <br> # <br> # Turn on/off additional Sieve debugging. <br> # <br> SIEVE_DEBUG = no <br> <br> # <br> # Use the auto_notify table to send email notifications. <br> # <br> AUTO_NOTIFY = no <br> <br> # <br> # Use the auto_reply table to send away messages. <br> # <br> AUTO_REPLY = no <br> # <br> # Defaults to "NEW MAIL NOTIFICATION" <br> # <br> #AUTO_NOTIFY_SUBJECT = <br> <br> # <br> # Defaults to POSTMASTER from the DBMAIL section. <br> # <br> #AUTO_NOTIFY_SENDER = <br> <br> # <br> # If you set this to 'yes' dbmail will check for duplicate <br> # messages in the relevant mailbox during delivery using <br> # the Message-ID header <br> # <br> suppress_duplicates = no <br> <br> # end of configuration file <br> <br> <br></code> <br> <br> Spamassassin <br>    ,         ,          /etc/spamasassin,      ,       nobody <br> <br> local.cf <br> <code>rewrite_header Subject ***SPAM*** <br> report_safe 1 <br> trusted_networks 192.168/16 127/8 <br> # lock_method flock <br> required_score 5.0 <br> use_bayes 1 <br> bayes_auto_learn 1 <br> # bayes_ignore_header X-Bogosity <br> # bayes_ignore_header X-Spam-Flag <br> # bayes_ignore_header X-Spam-Status <br> auto_whitelist_path /etc/mail/spamassassin/auto_whitelist <br> bayes_path /etc/mail/spamassassin/bayes <br> bayes_file_mode 0666 <br> bayes_min_ham_num 1 <br> bayes_min_spam_num 1 <br> auto_learn_threshold_nonspam -2 <br> auto_learn_threshold_spam 5 <br> bayes_learn_to_journal 1 <br> skip_rbl_checks 0 <br> <br> ok_languages ru en <br> ok_locales ru en <br></code> <br> <br>    ..     <br> <code>/etc/init.d/exim start <br> /etc/init.d/spamd start <br> #    pop3      <br> /etc/init.d/dbmail-pop3d <br></code> <br> <br>     ,           <br> <code>rc-update add postgresql default <br> rc-update add exim default <br> rc-update add spamd default <br> rc-update add dbmail-pop3d default <br></code> <br> <br>          ,       <br> <code>dbmail-users -a admin@example.com -s admin@example.com -p plaintext -w 123123 <br></code> <br> <br>   ,        <br></code> <blockquote> <code><code><code><a href="http://njabl.org/"></a> <a href="http://www.spamcop.net/w3m%3Faction%3Dcheckblock%26ip%3D"></a> <font color="black">CREATE TYPE dtype AS ENUM ( <br> <font color="#A31515">'LOCAL'</font> , <br> <font color="#A31515">'VIRTUAL'</font> , <br> <font color="#A31515">'RELAY'</font> <br> ); <br> <br> ALTER TYPE <font color="#0000ff">public</font> .dtype OWNER TO dbmail; <br> <br> SET default_with_oids = <font color="#0000ff">true</font> ; <br> <br> CREATE TABLE dbmail_domains ( <br> uid integer NOT NULL, <br> domain character varying(128) NOT NULL, <br> type dtype NOT NULL <br> ); <br> <br> INSERT INTO dbmail_domains (uid, domain, type) VALUES (1, <font color="#A31515">'example.com'</font> , <font color="#A31515">'LOCAL'</font> );</font> <br>   . <br> <br> Exim <br> C   exim.conf <br> #!/bin/sh <br> ###################################################################### <br> # Runtime configuration file for Exim # <br> ###################################################################### <br> ####################################################################### <br> # MAIN CONFIGURATION SETTINGS # <br> ###################################################################### <br> <br> primary_hostname = example.com <br> domainlist local_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND \ <br> (type='LOCAL' OR type='VIRTUAL')}} <br> domainlist relay_to_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND type='RELAY'}} <br> hostlist relay_from_hosts = 127.0.0.1: localhost <br> auth_advertise_hosts = * <br> daemon_smtp_ports = 25 <br> log_selector = \ <br> +all_parents \ <br> +lost_incoming_connection \ <br> +received_sender \ <br> +received_recipients \ <br> +smtp_confirmation \ <br> +smtp_syntax_error \ <br> +smtp_protocol_error \ <br> -queue_run <br> acl_smtp_rcpt = acl_check_rcpt <br> acl_smtp_mime = acl_check_mime <br> acl_smtp_data = acl_check_content <br> qualify_domain = example.com <br> allow_domain_literals = false <br> exim_user = mail <br> exim_group = mail <br> never_users = root <br> host_lookup = * <br> #rfc1413_hosts = * <br> rfc1413_query_timeout = 0s <br> ignore_bounce_errors_after = 30m <br> timeout_frozen_after = 3d <br> freeze_tell = postmaster <br> <br> #av_scanner = clamd:/var/run/clamav/clamd.ctl #        <br> spamd_address = 127.0.0.1 783 <br> <br> message_size_limit = 10M <br> smtp_accept_max = 1000 <br> smtp_accept_max_per_connection = 150 <br> smtp_accept_max_per_host = 30 <br> split_spool_directory = true <br> remote_max_parallel = 15 <br> smtp_banner = "Welcome on our mail server!\n\ <br> This system does not accept Unsolicited \ <br> Commercial Email\nand will blacklist \ <br> offenders via our spam processor.\nHave a \ <br> nice day!\n\n${primary_hostname} ESMTP" <br> <br> hide pgsql_servers = localhost/dbmail/dbmail/PasSWorD <br> <br> ###################################################################### <br> # ACL CONFIGURATION # <br> # Specifies access control lists for incoming SMTP mail # <br> ###################################################################### <br> begin acl <br> <br> acl_check_rcpt: <br> <br> warn <br> set acl_m0 = 0s <br> warn <br> hosts = !+relay_from_hosts:!213.243.111.115/32 <br> set acl_m0 = 30s <br> warn <br> condition = ${if and {\ <br> {match{$sender_host_name}\ <br> {\N^[-az]*\d{0,3}[-az]*\.?[-az]*\d{0,3}[-az]*\.\w+$\N}} \ <br> {!eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 1s <br> <br> warn <br> condition = ${if and {\ <br> {match{$sender_helo_name}{\N^\w*\.\w{3}$\N}} \ <br> {eq{$acl_c1}{}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c2}{outblaze_domain}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if or {\ <br> {eq{$sender_address}{}} \ <br> {eq{$acl_m1}{0s}} \ <br> } {yes}{no}} <br> set acl_m0 = 0s <br> <br> warn <br> logwrite = Delay $acl_m0 for $sender_host_name \ <br> [$sender_host_address] with HELO=$sender_helo_name. \ <br> Mail from $sender_address to $local_part@$domain. <br> set acl_m1 = 0s <br> delay = $acl_m0 <br> <br> accept hosts = : <br> <br> deny domains = +local_domains <br> local_parts = ^[.] : ^.*[@%!/|] <br> <br> deny domains = !+local_domains <br> local_parts = ^[./|] : ^.*[@%!] : ^.*/\\.\\./ <br> <br> accept local_parts = postmaster <br> domains = +local_domains <br> <br> require verify = sender <br> <br> deny message = HELO/EHLO required by SMTP RFC <br> condition = ${if eq{$sender_helo_name}{}{yes}{no}} <br> <br> deny message = Go Away! You are spammer. <br> condition = ${if match{$sender_host_name} \ <br> {bezeqint\\.net|net\\.il|dialup|dsl|pool|peer|dhcp} \ <br> {yes}{no}} <br> <br> deny message = message from \ <br> $sender_host_address rejected - see njabl.org <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.njabl.org <br> <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dialups.mail-abuse.org <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = list.dsbl.org <br> deny message = Spam blocked see: \ <br> www.spamcop.net/w3m?action=checkblock&amp;ip=$sender_host_address <br> log_message = found in $dnslist_domain <br> dnslists = bl.spamcop.net <br> deny message = rejected, $sender_host_address \ <br> Open Proxy, see: $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.void.ru <br> <br> accept domains = +local_domains <br> endpass <br> message = unknown user <br> verify = recipient <br> <br> accept domains = +relay_to_domains <br> endpass <br> message = unrouteable address <br> verify = recipient <br> <br> accept hosts = +relay_from_hosts <br> accept authenticated = * <br> deny message = relay not permitted <br> <br> acl_check_mime: <br> <br> warn decode = default <br> <br> deny message = Blacklisted file extension detected ($mime_filename) <br> condition = ${if match \ <br> {${lc:$mime_filename}} \ <br> {\N(\.exe|\.pif|\.bat|\.scr|\.lnk|\.com|\.vbs|\.cpl)$\N} \ <br> {1}{0}} <br> <br> deny message = Sorry, noone speaks chinese here <br> condition = ${if eq{$mime_charset}{gb2312}{1}{0}} <br> <br> accept <br> <br> acl_check_content: <br> # deny message = Virus found ($malware_name) <br> # malware = * <br> <br> warn message = X-Spam-Score: $spam_score ($spam_bar) <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = X-Spam-Report: $spam_report <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = Subject: ***SPAM*** $h_Subject: <br> hosts = !+relay_from_hosts <br> spam = spamd <br> <br> deny message = This message scored $spam_score spam points. <br> spam = spamd:true <br> hosts = !+relay_from_hosts <br> condition = ${if &gt;{$spam_score_int}{120}{1}{0}} <br> <br> accept <br> <br> ###################################################################### <br> # ROUTERS CONFIGURATION # <br> # Specifies how addresses are handled # <br> ###################################################################### <br> # THE ORDER IN WHICH THE ROUTERS ARE DEFINED IS IMPORTANT! # <br> # An address is passed to each router in turn until it is accepted. # <br> ###################################################################### <br> <br> begin routers <br> <br> dnslookup: <br> driver = dnslookup <br> domains = ! +local_domains <br> transport = remote_smtp <br> ignore_target_hosts = 0.0.0.0 : 127.0.0.0/8 <br> no_more <br> <br> dbmailuser: <br> driver = accept <br> condition = ${lookup pgsql{SELECT alias_idnr FROM \ <br> dbmail_aliases WHERE \ <br> alias='${quote_pgsql:$local_part@$domain}' OR \ <br> alias='${quote_pgsql:@$domain}'}{yes}{no}} <br> transport = dbmail_delivery <br> <br> ###################################################################### <br> # TRANSPORTS CONFIGURATION # <br> ###################################################################### <br> # ORDER DOES NOT MATTER # <br> # Only one appropriate transport is called for each delivery. # <br> ###################################################################### <br> <br> begin transports <br> <br> remote_smtp: <br> driver = smtp <br> <br> dbmail_delivery: <br> driver = pipe <br> check_string = <br> command = /usr/sbin/dbmail-smtp -d ${pipe_addresses} <br> group = mail <br> message_prefix = "" <br> message_suffix = "" <br> path="/bin:/sbin:/usr/bin:/usr/sbin" <br> #   <br> address_pipe: <br> driver = pipe <br> return_output <br> <br> address_reply: <br> driver = autoreply <br> <br> ###################################################################### <br> # RETRY CONFIGURATION # <br> ###################################################################### <br> <br> begin retry <br> <br> * quota <br> * * F,2h,15m; G,16h,1h,1.5; F,4d,6h <br> <br> ###################################################################### <br> # REWRITE CONFIGURATION # <br> ###################################################################### <br> <br> begin rewrite <br> <br> ###################################################################### <br> # AUTHENTICATION CONFIGURATION # <br> ###################################################################### <br> <br> begin authenticators <br> <br> auth_plain: <br> driver = plaintext <br> public_name = PLAIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = : <br> server_set_id = $2 <br> <br> #    ,    . <br> auth_login: <br> driver = plaintext <br> public_name = LOGIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = Username:: : Password:: <br> server_set_id = $1 <br> <br> #    " " - TheBat! <br> auth_cram_md5: <br> driver = cram_md5 <br> public_name = CRAM-MD5 <br> server_secret = ${lookup pgsql{SELECT passwd FROM \ <br> dbmail_users WHERE userid \ <br> = '${quote_pgsql:$1}'}{$value}fail} <br> server_set_id = $1 <br> # End of Exim configuration file <br> ###ps  lissyara,       <br> <br></code> <br> <br> DBMail <br> dbmail.conf          <br> <code># (c) 2000-2006 IC&amp;S, The Netherlands <br> # <br> # Configuration file for DBMAIL <br> <br> [DBMAIL] <br> # <br> # Database settings <br> # <br> <br> # <br> # Supported drivers are mysql, pgsql, sqlite. <br> # <br> driver =pgsql <br> <br> # <br> # Supported drivers are sql, ldap. <br> # <br> authdriver =sql <br> <br> # <br> # Host for database, set to localhost if database is on <br> # the same host as dbmail and you want to use a local <br> # socket for connecting. <br> # <br> host =localhost <br> <br> # <br> # If you want to use TCP/IP for connecting to the database, <br> # and have the database running on a non-standard port. <br> # <br> sqlport =5432 <br> <br> # <br> # When using a local socket connection to the database, fill <br> # in the path to the socket here (eg /var/run/mysql.sock). <br> # <br> sqlsocket = <br> <br> # <br> # Database username. <br> # <br> user =dbmail <br> <br> # <br> # Database password. <br> # <br> pass =PasWoRd <br> <br> # <br> # Database name. <br> # <br> db =dbmail <br> <br> # <br> # Table prefix. Defaults to "dbmail_" if not specified. <br> # <br> table_prefix =dbmail_ <br> <br> # <br> # encoding must match the database/table encoding. <br> # ie latin1, utf8 <br> encoding = utf8 <br> <br> # <br> # messages with unknown encoding will be assumed to have <br> # default_msg_encoding <br> # ie iso8859-1, utf8 <br> default_msg_encoding = utf8 <br> <br> # <br> # Postmaster's email address for use in bounce messages. <br> # <br> #postmaster = DBMAIL-MAILER <br> <br> # <br> # Sendmail executable for forwards, replies, notifies, vacations. <br> # You may use pipes (|) in this command, for example: <br> # dos2unix|/usr/sbin/sendmail works well with Qmail. <br> # You may use quotes (") for executables with unusual names. <br> # <br> sendmail = /usr/sbin/sendmail <br> <br> # <br> # <br> # The following items can be overridden in the service-specific sections. <br> # <br> # <br> <br> # <br> # Trace level to send to syslog. Default is 2 (messages, errors, fatals). <br> # <br> TRACE_SYSLOG = 3 <br> <br> # <br> # Trace level to send to stderr. Default is 0 (fatals). <br> # <br> TRACE_STDERR = 1 <br> <br> # <br> # Root privs are used to open a port, then privs <br> # are dropped down to the user/group specified here. <br> # <br> EFFECTIVE_USER = dbmail <br> EFFECTIVE_GROUP = dbmail <br> <br> # <br> # The IP addresses the services will bind to. <br> # Use * for all local interfaces. <br> # Use 127.0.0.1 for localhost only. <br> # Separate multiple entries with spaces ( ) or commas (,). <br> # <br> BINDIP = * <br> <br> # <br> # Default number of child processes to start. <br> # <br> NCHILDREN = 2 <br> <br> # <br> # Maximum number of child processes allowed. <br> # <br> MAXCHILDREN = 10 <br> <br> # <br> # Unused children to always have availale. <br> # <br> MINSPARECHILDREN = 2 <br> <br> # <br> # Maximum unused children allowed to be active. <br> # <br> MAXSPARECHILDREN = 4 <br> <br> # <br> # Child process is restarted after handling this many connections. <br> # <br> MAXCONNECTS = 10000 <br> <br> # <br> # Child process will restart after this many connection errors. <br> # <br> MAX_ERRORS = 500 <br> <br> # <br> # Idle time allowed before a connection is shut off. <br> # <br> TIMEOUT = 300 <br> <br> # <br> # Idle time allowed before a connection is shut off if you have not logged in yet. <br> # <br> login_timeout = 60 <br> <br> # <br> # If yes, resolves IP addresses to DNS names when logging. <br> # <br> RESOLVE_IP = no <br> <br> # <br> # logfile for stdout messages <br> # <br> logfile = /var/log/dbmail.log <br> <br> # <br> # logfile for stderr messages <br> # <br> errorlog = /var/log/dbmail.err <br> <br> # <br> # directory for storing PID files <br> # <br> pid_directory = /var/run <br> <br> # <br> # directory for storing the daemon statefiles <br> # <br> state_directory = /var/run <br> <br> # <br> # directory for locating libraries (normally has a sane default compiled-in) <br> # <br> #library_directory = /usr/lib/dbmail <br> <br> [SMTP] <br> # In fact, there isn't anything here by default. <br> <br> [LMTP] <br> # <br> # Port to bind to. <br> # <br> PORT = 24 <br> <br> [POP] <br> # <br> # Port to bind to. <br> # <br> PORT = 110 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by POP3. <br> # This requires addition configuration of your MTA <br> # <br> POP_BEFORE_SMTP = no <br> <br> [IMAP] <br> <br> # <br> # Port to bind to. <br> # <br> PORT = 143 <br> <br> # <br> # IMAP prefers a longer timeout than other services. <br> # <br> TIMEOUT = 4000 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by IMAP. <br> # This requires addition configuration of your MTA <br> # <br> IMAP_BEFORE_SMTP = no <br> <br> # <br> # during IDLE, how many seconds between checking the mailbox <br> # status (default: 30) <br> # <br> # idle_timeout = 30 <br> <br> # <br> # Provide a CAPABILITY to override the default <br> # <br> # capability = IMAP4 IMAP4rev1 AUTH=LOGIN ACL NAMESPACE CHILDREN SORT QUOTA THREAD=ORDEREDSUBJECT UNSELECT IDLE <br> <br> [SIEVE] <br> # <br> # Port to bind to. <br> # <br> PORT = 2000 <br> <br> [LDAP] <br> PORT = 389 <br> VERSION = 3 <br> HOSTNAME = ldap <br> BASE_DN = ou=People,dc=mydomain,dc=com <br> <br> # <br> # If your LDAP library supports ldap_initialize(), then you can use the <br> # alternative LDAP server DSN like following. <br> # <br> # URI = ldap://127.0.0.1:389 <br> # URI = ldapi://%2fvar%2frun%2fopenldap%2fldapi/ <br> <br> # <br> # Leave blank for anonymous bind. <br> # example: cn=admin,dc=mydomain,dc=com <br> # <br> BIND_DN = <br> <br> # <br> # Leave blank for anonymous bind. <br> # <br> BIND_PW = <br> SCOPE = SubTree <br> USER_OBJECTCLASS = top,account,dbmailUser <br> FORW_OBJECTCLASS = top,account,dbmailForwardingAddress <br> CN_STRING = uid <br> FIELD_PASSWD = userPassword <br> FIELD_UID = uid <br> FIELD_NID = uidNumber <br> MIN_NID = 10000 <br> MAX_NID = 15000 <br> FIELD_CID = gidNumber <br> MIN_CID = 10000 <br> MAX_CID = 15000 <br> FIELD_MAIL = mail <br> FIELD_QUOTA = mailQuota <br> FIELD_FWDTARGET = mailForwardingAddress <br> <br> [DELIVERY] <br> # <br> # Run Sieve scripts as messages are delivered. <br> # <br> SIEVE = yes <br> <br> # <br> # Use 'user+mailbox@domain' format to deliver to a mailbox. <br> # <br> SUBADDRESS = yes <br> <br> # <br> # Turn on/off the Sieve Vacation extension. <br> # <br> SIEVE_VACATION = yes <br> <br> # <br> # Turn on/off the Sieve Notify extension <br> # <br> SIEVE_NOTIFY = yes <br> <br> # <br> # Turn on/off additional Sieve debugging. <br> # <br> SIEVE_DEBUG = no <br> <br> # <br> # Use the auto_notify table to send email notifications. <br> # <br> AUTO_NOTIFY = no <br> <br> # <br> # Use the auto_reply table to send away messages. <br> # <br> AUTO_REPLY = no <br> # <br> # Defaults to "NEW MAIL NOTIFICATION" <br> # <br> #AUTO_NOTIFY_SUBJECT = <br> <br> # <br> # Defaults to POSTMASTER from the DBMAIL section. <br> # <br> #AUTO_NOTIFY_SENDER = <br> <br> # <br> # If you set this to 'yes' dbmail will check for duplicate <br> # messages in the relevant mailbox during delivery using <br> # the Message-ID header <br> # <br> suppress_duplicates = no <br> <br> # end of configuration file <br> <br> <br></code> <br> <br> Spamassassin <br>    ,         ,          /etc/spamasassin,      ,       nobody <br> <br> local.cf <br> <code>rewrite_header Subject ***SPAM*** <br> report_safe 1 <br> trusted_networks 192.168/16 127/8 <br> # lock_method flock <br> required_score 5.0 <br> use_bayes 1 <br> bayes_auto_learn 1 <br> # bayes_ignore_header X-Bogosity <br> # bayes_ignore_header X-Spam-Flag <br> # bayes_ignore_header X-Spam-Status <br> auto_whitelist_path /etc/mail/spamassassin/auto_whitelist <br> bayes_path /etc/mail/spamassassin/bayes <br> bayes_file_mode 0666 <br> bayes_min_ham_num 1 <br> bayes_min_spam_num 1 <br> auto_learn_threshold_nonspam -2 <br> auto_learn_threshold_spam 5 <br> bayes_learn_to_journal 1 <br> skip_rbl_checks 0 <br> <br> ok_languages ru en <br> ok_locales ru en <br></code> <br> <br>    ..     <br> <code>/etc/init.d/exim start <br> /etc/init.d/spamd start <br> #    pop3      <br> /etc/init.d/dbmail-pop3d <br></code> <br> <br>     ,           <br> rc-update add postgresql default <br> rc-update add exim default <br> rc-update add spamd default <br> rc-update add dbmail-pop3d default <br> <br> <br>          ,       <br> <code>dbmail-users -a admin@example.com -s admin@example.com -p plaintext -w 123123 <br></code> <br> <br>   ,        <br></code></code> </blockquote> <code><code><a href="http://njabl.org/"></a> <a href="http://www.spamcop.net/w3m%3Faction%3Dcheckblock%26ip%3D"></a> <font color="black">CREATE TYPE dtype AS ENUM ( <br> <font color="#A31515">'LOCAL'</font> , <br> <font color="#A31515">'VIRTUAL'</font> , <br> <font color="#A31515">'RELAY'</font> <br> ); <br> <br> ALTER TYPE <font color="#0000ff">public</font> .dtype OWNER TO dbmail; <br> <br> SET default_with_oids = <font color="#0000ff">true</font> ; <br> <br> CREATE TABLE dbmail_domains ( <br> uid integer NOT NULL, <br> domain character varying(128) NOT NULL, <br> type dtype NOT NULL <br> ); <br> <br> INSERT INTO dbmail_domains (uid, domain, type) VALUES (1, <font color="#A31515">'example.com'</font> , <font color="#A31515">'LOCAL'</font> );</font> <br>   . <br> <br> Exim <br> C   exim.conf <br> #!/bin/sh <br> ###################################################################### <br> # Runtime configuration file for Exim # <br> ###################################################################### <br> ####################################################################### <br> # MAIN CONFIGURATION SETTINGS # <br> ###################################################################### <br> <br> primary_hostname = example.com <br> domainlist local_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND \ <br> (type='LOCAL' OR type='VIRTUAL')}} <br> domainlist relay_to_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND type='RELAY'}} <br> hostlist relay_from_hosts = 127.0.0.1: localhost <br> auth_advertise_hosts = * <br> daemon_smtp_ports = 25 <br> log_selector = \ <br> +all_parents \ <br> +lost_incoming_connection \ <br> +received_sender \ <br> +received_recipients \ <br> +smtp_confirmation \ <br> +smtp_syntax_error \ <br> +smtp_protocol_error \ <br> -queue_run <br> acl_smtp_rcpt = acl_check_rcpt <br> acl_smtp_mime = acl_check_mime <br> acl_smtp_data = acl_check_content <br> qualify_domain = example.com <br> allow_domain_literals = false <br> exim_user = mail <br> exim_group = mail <br> never_users = root <br> host_lookup = * <br> #rfc1413_hosts = * <br> rfc1413_query_timeout = 0s <br> ignore_bounce_errors_after = 30m <br> timeout_frozen_after = 3d <br> freeze_tell = postmaster <br> <br> #av_scanner = clamd:/var/run/clamav/clamd.ctl #        <br> spamd_address = 127.0.0.1 783 <br> <br> message_size_limit = 10M <br> smtp_accept_max = 1000 <br> smtp_accept_max_per_connection = 150 <br> smtp_accept_max_per_host = 30 <br> split_spool_directory = true <br> remote_max_parallel = 15 <br> smtp_banner = "Welcome on our mail server!\n\ <br> This system does not accept Unsolicited \ <br> Commercial Email\nand will blacklist \ <br> offenders via our spam processor.\nHave a \ <br> nice day!\n\n${primary_hostname} ESMTP" <br> <br> hide pgsql_servers = localhost/dbmail/dbmail/PasSWorD <br> <br> ###################################################################### <br> # ACL CONFIGURATION # <br> # Specifies access control lists for incoming SMTP mail # <br> ###################################################################### <br> begin acl <br> <br> acl_check_rcpt: <br> <br> warn <br> set acl_m0 = 0s <br> warn <br> hosts = !+relay_from_hosts:!213.243.111.115/32 <br> set acl_m0 = 30s <br> warn <br> condition = ${if and {\ <br> {match{$sender_host_name}\ <br> {\N^[-az]*\d{0,3}[-az]*\.?[-az]*\d{0,3}[-az]*\.\w+$\N}} \ <br> {!eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 1s <br> <br> warn <br> condition = ${if and {\ <br> {match{$sender_helo_name}{\N^\w*\.\w{3}$\N}} \ <br> {eq{$acl_c1}{}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c2}{outblaze_domain}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if or {\ <br> {eq{$sender_address}{}} \ <br> {eq{$acl_m1}{0s}} \ <br> } {yes}{no}} <br> set acl_m0 = 0s <br> <br> warn <br> logwrite = Delay $acl_m0 for $sender_host_name \ <br> [$sender_host_address] with HELO=$sender_helo_name. \ <br> Mail from $sender_address to $local_part@$domain. <br> set acl_m1 = 0s <br> delay = $acl_m0 <br> <br> accept hosts = : <br> <br> deny domains = +local_domains <br> local_parts = ^[.] : ^.*[@%!/|] <br> <br> deny domains = !+local_domains <br> local_parts = ^[./|] : ^.*[@%!] : ^.*/\\.\\./ <br> <br> accept local_parts = postmaster <br> domains = +local_domains <br> <br> require verify = sender <br> <br> deny message = HELO/EHLO required by SMTP RFC <br> condition = ${if eq{$sender_helo_name}{}{yes}{no}} <br> <br> deny message = Go Away! You are spammer. <br> condition = ${if match{$sender_host_name} \ <br> {bezeqint\\.net|net\\.il|dialup|dsl|pool|peer|dhcp} \ <br> {yes}{no}} <br> <br> deny message = message from \ <br> $sender_host_address rejected - see njabl.org <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.njabl.org <br> <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dialups.mail-abuse.org <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = list.dsbl.org <br> deny message = Spam blocked see: \ <br> www.spamcop.net/w3m?action=checkblock&amp;ip=$sender_host_address <br> log_message = found in $dnslist_domain <br> dnslists = bl.spamcop.net <br> deny message = rejected, $sender_host_address \ <br> Open Proxy, see: $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.void.ru <br> <br> accept domains = +local_domains <br> endpass <br> message = unknown user <br> verify = recipient <br> <br> accept domains = +relay_to_domains <br> endpass <br> message = unrouteable address <br> verify = recipient <br> <br> accept hosts = +relay_from_hosts <br> accept authenticated = * <br> deny message = relay not permitted <br> <br> acl_check_mime: <br> <br> warn decode = default <br> <br> deny message = Blacklisted file extension detected ($mime_filename) <br> condition = ${if match \ <br> {${lc:$mime_filename}} \ <br> {\N(\.exe|\.pif|\.bat|\.scr|\.lnk|\.com|\.vbs|\.cpl)$\N} \ <br> {1}{0}} <br> <br> deny message = Sorry, noone speaks chinese here <br> condition = ${if eq{$mime_charset}{gb2312}{1}{0}} <br> <br> accept <br> <br> acl_check_content: <br> # deny message = Virus found ($malware_name) <br> # malware = * <br> <br> warn message = X-Spam-Score: $spam_score ($spam_bar) <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = X-Spam-Report: $spam_report <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = Subject: ***SPAM*** $h_Subject: <br> hosts = !+relay_from_hosts <br> spam = spamd <br> <br> deny message = This message scored $spam_score spam points. <br> spam = spamd:true <br> hosts = !+relay_from_hosts <br> condition = ${if &gt;{$spam_score_int}{120}{1}{0}} <br> <br> accept <br> <br> ###################################################################### <br> # ROUTERS CONFIGURATION # <br> # Specifies how addresses are handled # <br> ###################################################################### <br> # THE ORDER IN WHICH THE ROUTERS ARE DEFINED IS IMPORTANT! # <br> # An address is passed to each router in turn until it is accepted. # <br> ###################################################################### <br> <br> begin routers <br> <br> dnslookup: <br> driver = dnslookup <br> domains = ! +local_domains <br> transport = remote_smtp <br> ignore_target_hosts = 0.0.0.0 : 127.0.0.0/8 <br> no_more <br> <br> dbmailuser: <br> driver = accept <br> condition = ${lookup pgsql{SELECT alias_idnr FROM \ <br> dbmail_aliases WHERE \ <br> alias='${quote_pgsql:$local_part@$domain}' OR \ <br> alias='${quote_pgsql:@$domain}'}{yes}{no}} <br> transport = dbmail_delivery <br> <br> ###################################################################### <br> # TRANSPORTS CONFIGURATION # <br> ###################################################################### <br> # ORDER DOES NOT MATTER # <br> # Only one appropriate transport is called for each delivery. # <br> ###################################################################### <br> <br> begin transports <br> <br> remote_smtp: <br> driver = smtp <br> <br> dbmail_delivery: <br> driver = pipe <br> check_string = <br> command = /usr/sbin/dbmail-smtp -d ${pipe_addresses} <br> group = mail <br> message_prefix = "" <br> message_suffix = "" <br> path="/bin:/sbin:/usr/bin:/usr/sbin" <br> #   <br> address_pipe: <br> driver = pipe <br> return_output <br> <br> address_reply: <br> driver = autoreply <br> <br> ###################################################################### <br> # RETRY CONFIGURATION # <br> ###################################################################### <br> <br> begin retry <br> <br> * quota <br> * * F,2h,15m; G,16h,1h,1.5; F,4d,6h <br> <br> ###################################################################### <br> # REWRITE CONFIGURATION # <br> ###################################################################### <br> <br> begin rewrite <br> <br> ###################################################################### <br> # AUTHENTICATION CONFIGURATION # <br> ###################################################################### <br> <br> begin authenticators <br> <br> auth_plain: <br> driver = plaintext <br> public_name = PLAIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = : <br> server_set_id = $2 <br> <br> #    ,    . <br> auth_login: <br> driver = plaintext <br> public_name = LOGIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = Username:: : Password:: <br> server_set_id = $1 <br> <br> #    " " - TheBat! <br> auth_cram_md5: <br> driver = cram_md5 <br> public_name = CRAM-MD5 <br> server_secret = ${lookup pgsql{SELECT passwd FROM \ <br> dbmail_users WHERE userid \ <br> = '${quote_pgsql:$1}'}{$value}fail} <br> server_set_id = $1 <br> # End of Exim configuration file <br> ###ps  lissyara,       <br> <br></code> <br> <br> DBMail <br> dbmail.conf          <br> <code># (c) 2000-2006 IC&amp;S, The Netherlands <br> # <br> # Configuration file for DBMAIL <br> <br> [DBMAIL] <br> # <br> # Database settings <br> # <br> <br> # <br> # Supported drivers are mysql, pgsql, sqlite. <br> # <br> driver =pgsql <br> <br> # <br> # Supported drivers are sql, ldap. <br> # <br> authdriver =sql <br> <br> # <br> # Host for database, set to localhost if database is on <br> # the same host as dbmail and you want to use a local <br> # socket for connecting. <br> # <br> host =localhost <br> <br> # <br> # If you want to use TCP/IP for connecting to the database, <br> # and have the database running on a non-standard port. <br> # <br> sqlport =5432 <br> <br> # <br> # When using a local socket connection to the database, fill <br> # in the path to the socket here (eg /var/run/mysql.sock). <br> # <br> sqlsocket = <br> <br> # <br> # Database username. <br> # <br> user =dbmail <br> <br> # <br> # Database password. <br> # <br> pass =PasWoRd <br> <br> # <br> # Database name. <br> # <br> db =dbmail <br> <br> # <br> # Table prefix. Defaults to "dbmail_" if not specified. <br> # <br> table_prefix =dbmail_ <br> <br> # <br> # encoding must match the database/table encoding. <br> # ie latin1, utf8 <br> encoding = utf8 <br> <br> # <br> # messages with unknown encoding will be assumed to have <br> # default_msg_encoding <br> # ie iso8859-1, utf8 <br> default_msg_encoding = utf8 <br> <br> # <br> # Postmaster's email address for use in bounce messages. <br> # <br> #postmaster = DBMAIL-MAILER <br> <br> # <br> # Sendmail executable for forwards, replies, notifies, vacations. <br> # You may use pipes (|) in this command, for example: <br> # dos2unix|/usr/sbin/sendmail works well with Qmail. <br> # You may use quotes (") for executables with unusual names. <br> # <br> sendmail = /usr/sbin/sendmail <br> <br> # <br> # <br> # The following items can be overridden in the service-specific sections. <br> # <br> # <br> <br> # <br> # Trace level to send to syslog. Default is 2 (messages, errors, fatals). <br> # <br> TRACE_SYSLOG = 3 <br> <br> # <br> # Trace level to send to stderr. Default is 0 (fatals). <br> # <br> TRACE_STDERR = 1 <br> <br> # <br> # Root privs are used to open a port, then privs <br> # are dropped down to the user/group specified here. <br> # <br> EFFECTIVE_USER = dbmail <br> EFFECTIVE_GROUP = dbmail <br> <br> # <br> # The IP addresses the services will bind to. <br> # Use * for all local interfaces. <br> # Use 127.0.0.1 for localhost only. <br> # Separate multiple entries with spaces ( ) or commas (,). <br> # <br> BINDIP = * <br> <br> # <br> # Default number of child processes to start. <br> # <br> NCHILDREN = 2 <br> <br> # <br> # Maximum number of child processes allowed. <br> # <br> MAXCHILDREN = 10 <br> <br> # <br> # Unused children to always have availale. <br> # <br> MINSPARECHILDREN = 2 <br> <br> # <br> # Maximum unused children allowed to be active. <br> # <br> MAXSPARECHILDREN = 4 <br> <br> # <br> # Child process is restarted after handling this many connections. <br> # <br> MAXCONNECTS = 10000 <br> <br> # <br> # Child process will restart after this many connection errors. <br> # <br> MAX_ERRORS = 500 <br> <br> # <br> # Idle time allowed before a connection is shut off. <br> # <br> TIMEOUT = 300 <br> <br> # <br> # Idle time allowed before a connection is shut off if you have not logged in yet. <br> # <br> login_timeout = 60 <br> <br> # <br> # If yes, resolves IP addresses to DNS names when logging. <br> # <br> RESOLVE_IP = no <br> <br> # <br> # logfile for stdout messages <br> # <br> logfile = /var/log/dbmail.log <br> <br> # <br> # logfile for stderr messages <br> # <br> errorlog = /var/log/dbmail.err <br> <br> # <br> # directory for storing PID files <br> # <br> pid_directory = /var/run <br> <br> # <br> # directory for storing the daemon statefiles <br> # <br> state_directory = /var/run <br> <br> # <br> # directory for locating libraries (normally has a sane default compiled-in) <br> # <br> #library_directory = /usr/lib/dbmail <br> <br> [SMTP] <br> # In fact, there isn't anything here by default. <br> <br> [LMTP] <br> # <br> # Port to bind to. <br> # <br> PORT = 24 <br> <br> [POP] <br> # <br> # Port to bind to. <br> # <br> PORT = 110 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by POP3. <br> # This requires addition configuration of your MTA <br> # <br> POP_BEFORE_SMTP = no <br> <br> [IMAP] <br> <br> # <br> # Port to bind to. <br> # <br> PORT = 143 <br> <br> # <br> # IMAP prefers a longer timeout than other services. <br> # <br> TIMEOUT = 4000 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by IMAP. <br> # This requires addition configuration of your MTA <br> # <br> IMAP_BEFORE_SMTP = no <br> <br> # <br> # during IDLE, how many seconds between checking the mailbox <br> # status (default: 30) <br> # <br> # idle_timeout = 30 <br> <br> # <br> # Provide a CAPABILITY to override the default <br> # <br> # capability = IMAP4 IMAP4rev1 AUTH=LOGIN ACL NAMESPACE CHILDREN SORT QUOTA THREAD=ORDEREDSUBJECT UNSELECT IDLE <br> <br> [SIEVE] <br> # <br> # Port to bind to. <br> # <br> PORT = 2000 <br> <br> [LDAP] <br> PORT = 389 <br> VERSION = 3 <br> HOSTNAME = ldap <br> BASE_DN = ou=People,dc=mydomain,dc=com <br> <br> # <br> # If your LDAP library supports ldap_initialize(), then you can use the <br> # alternative LDAP server DSN like following. <br> # <br> # URI = ldap://127.0.0.1:389 <br> # URI = ldapi://%2fvar%2frun%2fopenldap%2fldapi/ <br> <br> # <br> # Leave blank for anonymous bind. <br> # example: cn=admin,dc=mydomain,dc=com <br> # <br> BIND_DN = <br> <br> # <br> # Leave blank for anonymous bind. <br> # <br> BIND_PW = <br> SCOPE = SubTree <br> USER_OBJECTCLASS = top,account,dbmailUser <br> FORW_OBJECTCLASS = top,account,dbmailForwardingAddress <br> CN_STRING = uid <br> FIELD_PASSWD = userPassword <br> FIELD_UID = uid <br> FIELD_NID = uidNumber <br> MIN_NID = 10000 <br> MAX_NID = 15000 <br> FIELD_CID = gidNumber <br> MIN_CID = 10000 <br> MAX_CID = 15000 <br> FIELD_MAIL = mail <br> FIELD_QUOTA = mailQuota <br> FIELD_FWDTARGET = mailForwardingAddress <br> <br> [DELIVERY] <br> # <br> # Run Sieve scripts as messages are delivered. <br> # <br> SIEVE = yes <br> <br> # <br> # Use 'user+mailbox@domain' format to deliver to a mailbox. <br> # <br> SUBADDRESS = yes <br> <br> # <br> # Turn on/off the Sieve Vacation extension. <br> # <br> SIEVE_VACATION = yes <br> <br> # <br> # Turn on/off the Sieve Notify extension <br> # <br> SIEVE_NOTIFY = yes <br> <br> # <br> # Turn on/off additional Sieve debugging. <br> # <br> SIEVE_DEBUG = no <br> <br> # <br> # Use the auto_notify table to send email notifications. <br> # <br> AUTO_NOTIFY = no <br> <br> # <br> # Use the auto_reply table to send away messages. <br> # <br> AUTO_REPLY = no <br> # <br> # Defaults to "NEW MAIL NOTIFICATION" <br> # <br> #AUTO_NOTIFY_SUBJECT = <br> <br> # <br> # Defaults to POSTMASTER from the DBMAIL section. <br> # <br> #AUTO_NOTIFY_SENDER = <br> <br> # <br> # If you set this to 'yes' dbmail will check for duplicate <br> # messages in the relevant mailbox during delivery using <br> # the Message-ID header <br> # <br> suppress_duplicates = no <br> <br> # end of configuration file <br> <br> <br></code> <br> <br> Spamassassin <br>    ,         ,          /etc/spamasassin,      ,       nobody <br> <br> local.cf <br> <code>rewrite_header Subject ***SPAM*** <br> report_safe 1 <br> trusted_networks 192.168/16 127/8 <br> # lock_method flock <br> required_score 5.0 <br> use_bayes 1 <br> bayes_auto_learn 1 <br> # bayes_ignore_header X-Bogosity <br> # bayes_ignore_header X-Spam-Flag <br> # bayes_ignore_header X-Spam-Status <br> auto_whitelist_path /etc/mail/spamassassin/auto_whitelist <br> bayes_path /etc/mail/spamassassin/bayes <br> bayes_file_mode 0666 <br> bayes_min_ham_num 1 <br> bayes_min_spam_num 1 <br> auto_learn_threshold_nonspam -2 <br> auto_learn_threshold_spam 5 <br> bayes_learn_to_journal 1 <br> skip_rbl_checks 0 <br> <br> ok_languages ru en <br> ok_locales ru en <br></code> <br> <br>    ..     <br> <code>/etc/init.d/exim start <br> /etc/init.d/spamd start <br> #    pop3      <br> /etc/init.d/dbmail-pop3d <br></code> <br> <br>     ,           <br> <code>rc-update add postgresql default <br> rc-update add exim default <br> rc-update add spamd default <br> rc-update add dbmail-pop3d default <br></code> <br> <br>          ,       <br> <code>dbmail-users -a admin@example.com -s admin@example.com -p plaintext -w 123123 <br></code> <br> <br>   ,        <br></code> <blockquote> <code><code><code><a href="http://njabl.org/"></a> <a href="http://www.spamcop.net/w3m%3Faction%3Dcheckblock%26ip%3D"></a> <font color="black">CREATE TYPE dtype AS ENUM ( <br> <font color="#A31515">'LOCAL'</font> , <br> <font color="#A31515">'VIRTUAL'</font> , <br> <font color="#A31515">'RELAY'</font> <br> ); <br> <br> ALTER TYPE <font color="#0000ff">public</font> .dtype OWNER TO dbmail; <br> <br> SET default_with_oids = <font color="#0000ff">true</font> ; <br> <br> CREATE TABLE dbmail_domains ( <br> uid integer NOT NULL, <br> domain character varying(128) NOT NULL, <br> type dtype NOT NULL <br> ); <br> <br> INSERT INTO dbmail_domains (uid, domain, type) VALUES (1, <font color="#A31515">'example.com'</font> , <font color="#A31515">'LOCAL'</font> );</font> <br>   . <br> <br> Exim <br> C   exim.conf <br> #!/bin/sh <br> ###################################################################### <br> # Runtime configuration file for Exim # <br> ###################################################################### <br> ####################################################################### <br> # MAIN CONFIGURATION SETTINGS # <br> ###################################################################### <br> <br> primary_hostname = example.com <br> domainlist local_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND \ <br> (type='LOCAL' OR type='VIRTUAL')}} <br> domainlist relay_to_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND type='RELAY'}} <br> hostlist relay_from_hosts = 127.0.0.1: localhost <br> auth_advertise_hosts = * <br> daemon_smtp_ports = 25 <br> log_selector = \ <br> +all_parents \ <br> +lost_incoming_connection \ <br> +received_sender \ <br> +received_recipients \ <br> +smtp_confirmation \ <br> +smtp_syntax_error \ <br> +smtp_protocol_error \ <br> -queue_run <br> acl_smtp_rcpt = acl_check_rcpt <br> acl_smtp_mime = acl_check_mime <br> acl_smtp_data = acl_check_content <br> qualify_domain = example.com <br> allow_domain_literals = false <br> exim_user = mail <br> exim_group = mail <br> never_users = root <br> host_lookup = * <br> #rfc1413_hosts = * <br> rfc1413_query_timeout = 0s <br> ignore_bounce_errors_after = 30m <br> timeout_frozen_after = 3d <br> freeze_tell = postmaster <br> <br> #av_scanner = clamd:/var/run/clamav/clamd.ctl #        <br> spamd_address = 127.0.0.1 783 <br> <br> message_size_limit = 10M <br> smtp_accept_max = 1000 <br> smtp_accept_max_per_connection = 150 <br> smtp_accept_max_per_host = 30 <br> split_spool_directory = true <br> remote_max_parallel = 15 <br> smtp_banner = "Welcome on our mail server!\n\ <br> This system does not accept Unsolicited \ <br> Commercial Email\nand will blacklist \ <br> offenders via our spam processor.\nHave a \ <br> nice day!\n\n${primary_hostname} ESMTP" <br> <br> hide pgsql_servers = localhost/dbmail/dbmail/PasSWorD <br> <br> ###################################################################### <br> # ACL CONFIGURATION # <br> # Specifies access control lists for incoming SMTP mail # <br> ###################################################################### <br> begin acl <br> <br> acl_check_rcpt: <br> <br> warn <br> set acl_m0 = 0s <br> warn <br> hosts = !+relay_from_hosts:!213.243.111.115/32 <br> set acl_m0 = 30s <br> warn <br> condition = ${if and {\ <br> {match{$sender_host_name}\ <br> {\N^[-az]*\d{0,3}[-az]*\.?[-az]*\d{0,3}[-az]*\.\w+$\N}} \ <br> {!eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 1s <br> <br> warn <br> condition = ${if and {\ <br> {match{$sender_helo_name}{\N^\w*\.\w{3}$\N}} \ <br> {eq{$acl_c1}{}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c2}{outblaze_domain}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if or {\ <br> {eq{$sender_address}{}} \ <br> {eq{$acl_m1}{0s}} \ <br> } {yes}{no}} <br> set acl_m0 = 0s <br> <br> warn <br> logwrite = Delay $acl_m0 for $sender_host_name \ <br> [$sender_host_address] with HELO=$sender_helo_name. \ <br> Mail from $sender_address to $local_part@$domain. <br> set acl_m1 = 0s <br> delay = $acl_m0 <br> <br> accept hosts = : <br> <br> deny domains = +local_domains <br> local_parts = ^[.] : ^.*[@%!/|] <br> <br> deny domains = !+local_domains <br> local_parts = ^[./|] : ^.*[@%!] : ^.*/\\.\\./ <br> <br> accept local_parts = postmaster <br> domains = +local_domains <br> <br> require verify = sender <br> <br> deny message = HELO/EHLO required by SMTP RFC <br> condition = ${if eq{$sender_helo_name}{}{yes}{no}} <br> <br> deny message = Go Away! You are spammer. <br> condition = ${if match{$sender_host_name} \ <br> {bezeqint\\.net|net\\.il|dialup|dsl|pool|peer|dhcp} \ <br> {yes}{no}} <br> <br> deny message = message from \ <br> $sender_host_address rejected - see njabl.org <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.njabl.org <br> <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dialups.mail-abuse.org <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = list.dsbl.org <br> deny message = Spam blocked see: \ <br> www.spamcop.net/w3m?action=checkblock&amp;ip=$sender_host_address <br> log_message = found in $dnslist_domain <br> dnslists = bl.spamcop.net <br> deny message = rejected, $sender_host_address \ <br> Open Proxy, see: $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.void.ru <br> <br> accept domains = +local_domains <br> endpass <br> message = unknown user <br> verify = recipient <br> <br> accept domains = +relay_to_domains <br> endpass <br> message = unrouteable address <br> verify = recipient <br> <br> accept hosts = +relay_from_hosts <br> accept authenticated = * <br> deny message = relay not permitted <br> <br> acl_check_mime: <br> <br> warn decode = default <br> <br> deny message = Blacklisted file extension detected ($mime_filename) <br> condition = ${if match \ <br> {${lc:$mime_filename}} \ <br> {\N(\.exe|\.pif|\.bat|\.scr|\.lnk|\.com|\.vbs|\.cpl)$\N} \ <br> {1}{0}} <br> <br> deny message = Sorry, noone speaks chinese here <br> condition = ${if eq{$mime_charset}{gb2312}{1}{0}} <br> <br> accept <br> <br> acl_check_content: <br> # deny message = Virus found ($malware_name) <br> # malware = * <br> <br> warn message = X-Spam-Score: $spam_score ($spam_bar) <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = X-Spam-Report: $spam_report <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = Subject: ***SPAM*** $h_Subject: <br> hosts = !+relay_from_hosts <br> spam = spamd <br> <br> deny message = This message scored $spam_score spam points. <br> spam = spamd:true <br> hosts = !+relay_from_hosts <br> condition = ${if &gt;{$spam_score_int}{120}{1}{0}} <br> <br> accept <br> <br> ###################################################################### <br> # ROUTERS CONFIGURATION # <br> # Specifies how addresses are handled # <br> ###################################################################### <br> # THE ORDER IN WHICH THE ROUTERS ARE DEFINED IS IMPORTANT! # <br> # An address is passed to each router in turn until it is accepted. # <br> ###################################################################### <br> <br> begin routers <br> <br> dnslookup: <br> driver = dnslookup <br> domains = ! +local_domains <br> transport = remote_smtp <br> ignore_target_hosts = 0.0.0.0 : 127.0.0.0/8 <br> no_more <br> <br> dbmailuser: <br> driver = accept <br> condition = ${lookup pgsql{SELECT alias_idnr FROM \ <br> dbmail_aliases WHERE \ <br> alias='${quote_pgsql:$local_part@$domain}' OR \ <br> alias='${quote_pgsql:@$domain}'}{yes}{no}} <br> transport = dbmail_delivery <br> <br> ###################################################################### <br> # TRANSPORTS CONFIGURATION # <br> ###################################################################### <br> # ORDER DOES NOT MATTER # <br> # Only one appropriate transport is called for each delivery. # <br> ###################################################################### <br> <br> begin transports <br> <br> remote_smtp: <br> driver = smtp <br> <br> dbmail_delivery: <br> driver = pipe <br> check_string = <br> command = /usr/sbin/dbmail-smtp -d ${pipe_addresses} <br> group = mail <br> message_prefix = "" <br> message_suffix = "" <br> path="/bin:/sbin:/usr/bin:/usr/sbin" <br> #   <br> address_pipe: <br> driver = pipe <br> return_output <br> <br> address_reply: <br> driver = autoreply <br> <br> ###################################################################### <br> # RETRY CONFIGURATION # <br> ###################################################################### <br> <br> begin retry <br> <br> * quota <br> * * F,2h,15m; G,16h,1h,1.5; F,4d,6h <br> <br> ###################################################################### <br> # REWRITE CONFIGURATION # <br> ###################################################################### <br> <br> begin rewrite <br> <br> ###################################################################### <br> # AUTHENTICATION CONFIGURATION # <br> ###################################################################### <br> <br> begin authenticators <br> <br> auth_plain: <br> driver = plaintext <br> public_name = PLAIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = : <br> server_set_id = $2 <br> <br> #    ,    . <br> auth_login: <br> driver = plaintext <br> public_name = LOGIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = Username:: : Password:: <br> server_set_id = $1 <br> <br> #    " " - TheBat! <br> auth_cram_md5: <br> driver = cram_md5 <br> public_name = CRAM-MD5 <br> server_secret = ${lookup pgsql{SELECT passwd FROM \ <br> dbmail_users WHERE userid \ <br> = '${quote_pgsql:$1}'}{$value}fail} <br> server_set_id = $1 <br> # End of Exim configuration file <br> ###ps  lissyara,       <br> <br></code> <br> <br> DBMail <br> dbmail.conf          <br> <code># (c) 2000-2006 IC&amp;S, The Netherlands <br> # <br> # Configuration file for DBMAIL <br> <br> [DBMAIL] <br> # <br> # Database settings <br> # <br> <br> # <br> # Supported drivers are mysql, pgsql, sqlite. <br> # <br> driver =pgsql <br> <br> # <br> # Supported drivers are sql, ldap. <br> # <br> authdriver =sql <br> <br> # <br> # Host for database, set to localhost if database is on <br> # the same host as dbmail and you want to use a local <br> # socket for connecting. <br> # <br> host =localhost <br> <br> # <br> # If you want to use TCP/IP for connecting to the database, <br> # and have the database running on a non-standard port. <br> # <br> sqlport =5432 <br> <br> # <br> # When using a local socket connection to the database, fill <br> # in the path to the socket here (eg /var/run/mysql.sock). <br> # <br> sqlsocket = <br> <br> # <br> # Database username. <br> # <br> user =dbmail <br> <br> # <br> # Database password. <br> # <br> pass =PasWoRd <br> <br> # <br> # Database name. <br> # <br> db =dbmail <br> <br> # <br> # Table prefix. Defaults to "dbmail_" if not specified. <br> # <br> table_prefix =dbmail_ <br> <br> # <br> # encoding must match the database/table encoding. <br> # ie latin1, utf8 <br> encoding = utf8 <br> <br> # <br> # messages with unknown encoding will be assumed to have <br> # default_msg_encoding <br> # ie iso8859-1, utf8 <br> default_msg_encoding = utf8 <br> <br> # <br> # Postmaster's email address for use in bounce messages. <br> # <br> #postmaster = DBMAIL-MAILER <br> <br> # <br> # Sendmail executable for forwards, replies, notifies, vacations. <br> # You may use pipes (|) in this command, for example: <br> # dos2unix|/usr/sbin/sendmail works well with Qmail. <br> # You may use quotes (") for executables with unusual names. <br> # <br> sendmail = /usr/sbin/sendmail <br> <br> # <br> # <br> # The following items can be overridden in the service-specific sections. <br> # <br> # <br> <br> # <br> # Trace level to send to syslog. Default is 2 (messages, errors, fatals). <br> # <br> TRACE_SYSLOG = 3 <br> <br> # <br> # Trace level to send to stderr. Default is 0 (fatals). <br> # <br> TRACE_STDERR = 1 <br> <br> # <br> # Root privs are used to open a port, then privs <br> # are dropped down to the user/group specified here. <br> # <br> EFFECTIVE_USER = dbmail <br> EFFECTIVE_GROUP = dbmail <br> <br> # <br> # The IP addresses the services will bind to. <br> # Use * for all local interfaces. <br> # Use 127.0.0.1 for localhost only. <br> # Separate multiple entries with spaces ( ) or commas (,). <br> # <br> BINDIP = * <br> <br> # <br> # Default number of child processes to start. <br> # <br> NCHILDREN = 2 <br> <br> # <br> # Maximum number of child processes allowed. <br> # <br> MAXCHILDREN = 10 <br> <br> # <br> # Unused children to always have availale. <br> # <br> MINSPARECHILDREN = 2 <br> <br> # <br> # Maximum unused children allowed to be active. <br> # <br> MAXSPARECHILDREN = 4 <br> <br> # <br> # Child process is restarted after handling this many connections. <br> # <br> MAXCONNECTS = 10000 <br> <br> # <br> # Child process will restart after this many connection errors. <br> # <br> MAX_ERRORS = 500 <br> <br> # <br> # Idle time allowed before a connection is shut off. <br> # <br> TIMEOUT = 300 <br> <br> # <br> # Idle time allowed before a connection is shut off if you have not logged in yet. <br> # <br> login_timeout = 60 <br> <br> # <br> # If yes, resolves IP addresses to DNS names when logging. <br> # <br> RESOLVE_IP = no <br> <br> # <br> # logfile for stdout messages <br> # <br> logfile = /var/log/dbmail.log <br> <br> # <br> # logfile for stderr messages <br> # <br> errorlog = /var/log/dbmail.err <br> <br> # <br> # directory for storing PID files <br> # <br> pid_directory = /var/run <br> <br> # <br> # directory for storing the daemon statefiles <br> # <br> state_directory = /var/run <br> <br> # <br> # directory for locating libraries (normally has a sane default compiled-in) <br> # <br> #library_directory = /usr/lib/dbmail <br> <br> [SMTP] <br> # In fact, there isn't anything here by default. <br> <br> [LMTP] <br> # <br> # Port to bind to. <br> # <br> PORT = 24 <br> <br> [POP] <br> # <br> # Port to bind to. <br> # <br> PORT = 110 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by POP3. <br> # This requires addition configuration of your MTA <br> # <br> POP_BEFORE_SMTP = no <br> <br> [IMAP] <br> <br> # <br> # Port to bind to. <br> # <br> PORT = 143 <br> <br> # <br> # IMAP prefers a longer timeout than other services. <br> # <br> TIMEOUT = 4000 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by IMAP. <br> # This requires addition configuration of your MTA <br> # <br> IMAP_BEFORE_SMTP = no <br> <br> # <br> # during IDLE, how many seconds between checking the mailbox <br> # status (default: 30) <br> # <br> # idle_timeout = 30 <br> <br> # <br> # Provide a CAPABILITY to override the default <br> # <br> # capability = IMAP4 IMAP4rev1 AUTH=LOGIN ACL NAMESPACE CHILDREN SORT QUOTA THREAD=ORDEREDSUBJECT UNSELECT IDLE <br> <br> [SIEVE] <br> # <br> # Port to bind to. <br> # <br> PORT = 2000 <br> <br> [LDAP] <br> PORT = 389 <br> VERSION = 3 <br> HOSTNAME = ldap <br> BASE_DN = ou=People,dc=mydomain,dc=com <br> <br> # <br> # If your LDAP library supports ldap_initialize(), then you can use the <br> # alternative LDAP server DSN like following. <br> # <br> # URI = ldap://127.0.0.1:389 <br> # URI = ldapi://%2fvar%2frun%2fopenldap%2fldapi/ <br> <br> # <br> # Leave blank for anonymous bind. <br> # example: cn=admin,dc=mydomain,dc=com <br> # <br> BIND_DN = <br> <br> # <br> # Leave blank for anonymous bind. <br> # <br> BIND_PW = <br> SCOPE = SubTree <br> USER_OBJECTCLASS = top,account,dbmailUser <br> FORW_OBJECTCLASS = top,account,dbmailForwardingAddress <br> CN_STRING = uid <br> FIELD_PASSWD = userPassword <br> FIELD_UID = uid <br> FIELD_NID = uidNumber <br> MIN_NID = 10000 <br> MAX_NID = 15000 <br> FIELD_CID = gidNumber <br> MIN_CID = 10000 <br> MAX_CID = 15000 <br> FIELD_MAIL = mail <br> FIELD_QUOTA = mailQuota <br> FIELD_FWDTARGET = mailForwardingAddress <br> <br> [DELIVERY] <br> # <br> # Run Sieve scripts as messages are delivered. <br> # <br> SIEVE = yes <br> <br> # <br> # Use 'user+mailbox@domain' format to deliver to a mailbox. <br> # <br> SUBADDRESS = yes <br> <br> # <br> # Turn on/off the Sieve Vacation extension. <br> # <br> SIEVE_VACATION = yes <br> <br> # <br> # Turn on/off the Sieve Notify extension <br> # <br> SIEVE_NOTIFY = yes <br> <br> # <br> # Turn on/off additional Sieve debugging. <br> # <br> SIEVE_DEBUG = no <br> <br> # <br> # Use the auto_notify table to send email notifications. <br> # <br> AUTO_NOTIFY = no <br> <br> # <br> # Use the auto_reply table to send away messages. <br> # <br> AUTO_REPLY = no <br> # <br> # Defaults to "NEW MAIL NOTIFICATION" <br> # <br> #AUTO_NOTIFY_SUBJECT = <br> <br> # <br> # Defaults to POSTMASTER from the DBMAIL section. <br> # <br> #AUTO_NOTIFY_SENDER = <br> <br> # <br> # If you set this to 'yes' dbmail will check for duplicate <br> # messages in the relevant mailbox during delivery using <br> # the Message-ID header <br> # <br> suppress_duplicates = no <br> <br> # end of configuration file <br> <br> <br></code> <br> <br> Spamassassin <br>    ,         ,          /etc/spamasassin,      ,       nobody <br> <br> local.cf <br> <code>rewrite_header Subject ***SPAM*** <br> report_safe 1 <br> trusted_networks 192.168/16 127/8 <br> # lock_method flock <br> required_score 5.0 <br> use_bayes 1 <br> bayes_auto_learn 1 <br> # bayes_ignore_header X-Bogosity <br> # bayes_ignore_header X-Spam-Flag <br> # bayes_ignore_header X-Spam-Status <br> auto_whitelist_path /etc/mail/spamassassin/auto_whitelist <br> bayes_path /etc/mail/spamassassin/bayes <br> bayes_file_mode 0666 <br> bayes_min_ham_num 1 <br> bayes_min_spam_num 1 <br> auto_learn_threshold_nonspam -2 <br> auto_learn_threshold_spam 5 <br> bayes_learn_to_journal 1 <br> skip_rbl_checks 0 <br> <br> ok_languages ru en <br> ok_locales ru en <br></code> <br> <br>    ..     <br> <code>/etc/init.d/exim start <br> /etc/init.d/spamd start <br> #    pop3      <br> /etc/init.d/dbmail-pop3d <br></code> <br> <br>     ,           <br> <code>rc-update add postgresql default <br> rc-update add exim default <br> rc-update add spamd default <br> rc-update add dbmail-pop3d default <br></code> <br> <br>          ,       <br> dbmail-users -a admin@example.com -s admin@example.com -p plaintext -w 123123 <br> <br> <br>   ,        <br></code></code> </blockquote> <code><code><a href="http://njabl.org/"></a> <a href="http://www.spamcop.net/w3m%3Faction%3Dcheckblock%26ip%3D"></a> <font color="black">CREATE TYPE dtype AS ENUM ( <br> <font color="#A31515">'LOCAL'</font> , <br> <font color="#A31515">'VIRTUAL'</font> , <br> <font color="#A31515">'RELAY'</font> <br> ); <br> <br> ALTER TYPE <font color="#0000ff">public</font> .dtype OWNER TO dbmail; <br> <br> SET default_with_oids = <font color="#0000ff">true</font> ; <br> <br> CREATE TABLE dbmail_domains ( <br> uid integer NOT NULL, <br> domain character varying(128) NOT NULL, <br> type dtype NOT NULL <br> ); <br> <br> INSERT INTO dbmail_domains (uid, domain, type) VALUES (1, <font color="#A31515">'example.com'</font> , <font color="#A31515">'LOCAL'</font> );</font> <br>   . <br> <br> Exim <br> C   exim.conf <br> #!/bin/sh <br> ###################################################################### <br> # Runtime configuration file for Exim # <br> ###################################################################### <br> ####################################################################### <br> # MAIN CONFIGURATION SETTINGS # <br> ###################################################################### <br> <br> primary_hostname = example.com <br> domainlist local_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND \ <br> (type='LOCAL' OR type='VIRTUAL')}} <br> domainlist relay_to_domains = ${lookup pgsql{SELECT domain FROM dbmail_domains \ <br> WHERE domain='${domain}' AND type='RELAY'}} <br> hostlist relay_from_hosts = 127.0.0.1: localhost <br> auth_advertise_hosts = * <br> daemon_smtp_ports = 25 <br> log_selector = \ <br> +all_parents \ <br> +lost_incoming_connection \ <br> +received_sender \ <br> +received_recipients \ <br> +smtp_confirmation \ <br> +smtp_syntax_error \ <br> +smtp_protocol_error \ <br> -queue_run <br> acl_smtp_rcpt = acl_check_rcpt <br> acl_smtp_mime = acl_check_mime <br> acl_smtp_data = acl_check_content <br> qualify_domain = example.com <br> allow_domain_literals = false <br> exim_user = mail <br> exim_group = mail <br> never_users = root <br> host_lookup = * <br> #rfc1413_hosts = * <br> rfc1413_query_timeout = 0s <br> ignore_bounce_errors_after = 30m <br> timeout_frozen_after = 3d <br> freeze_tell = postmaster <br> <br> #av_scanner = clamd:/var/run/clamav/clamd.ctl #        <br> spamd_address = 127.0.0.1 783 <br> <br> message_size_limit = 10M <br> smtp_accept_max = 1000 <br> smtp_accept_max_per_connection = 150 <br> smtp_accept_max_per_host = 30 <br> split_spool_directory = true <br> remote_max_parallel = 15 <br> smtp_banner = "Welcome on our mail server!\n\ <br> This system does not accept Unsolicited \ <br> Commercial Email\nand will blacklist \ <br> offenders via our spam processor.\nHave a \ <br> nice day!\n\n${primary_hostname} ESMTP" <br> <br> hide pgsql_servers = localhost/dbmail/dbmail/PasSWorD <br> <br> ###################################################################### <br> # ACL CONFIGURATION # <br> # Specifies access control lists for incoming SMTP mail # <br> ###################################################################### <br> begin acl <br> <br> acl_check_rcpt: <br> <br> warn <br> set acl_m0 = 0s <br> warn <br> hosts = !+relay_from_hosts:!213.243.111.115/32 <br> set acl_m0 = 30s <br> warn <br> condition = ${if and {\ <br> {match{$sender_host_name}\ <br> {\N^[-az]*\d{0,3}[-az]*\.?[-az]*\d{0,3}[-az]*\.\w+$\N}} \ <br> {!eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 1s <br> <br> warn <br> condition = ${if and {\ <br> {match{$sender_helo_name}{\N^\w*\.\w{3}$\N}} \ <br> {eq{$acl_c1}{}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c0}{outblaze_helo}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if and {\ <br> {!match{$sender_host_name}{\N.+.outblaze.com$\N}} \ <br> {eq{$acl_c2}{outblaze_domain}} \ <br> }{yes}{no}} <br> set acl_m0 = 99s <br> <br> warn <br> condition = ${if or {\ <br> {eq{$sender_address}{}} \ <br> {eq{$acl_m1}{0s}} \ <br> } {yes}{no}} <br> set acl_m0 = 0s <br> <br> warn <br> logwrite = Delay $acl_m0 for $sender_host_name \ <br> [$sender_host_address] with HELO=$sender_helo_name. \ <br> Mail from $sender_address to $local_part@$domain. <br> set acl_m1 = 0s <br> delay = $acl_m0 <br> <br> accept hosts = : <br> <br> deny domains = +local_domains <br> local_parts = ^[.] : ^.*[@%!/|] <br> <br> deny domains = !+local_domains <br> local_parts = ^[./|] : ^.*[@%!] : ^.*/\\.\\./ <br> <br> accept local_parts = postmaster <br> domains = +local_domains <br> <br> require verify = sender <br> <br> deny message = HELO/EHLO required by SMTP RFC <br> condition = ${if eq{$sender_helo_name}{}{yes}{no}} <br> <br> deny message = Go Away! You are spammer. <br> condition = ${if match{$sender_host_name} \ <br> {bezeqint\\.net|net\\.il|dialup|dsl|pool|peer|dhcp} \ <br> {yes}{no}} <br> <br> deny message = message from \ <br> $sender_host_address rejected - see njabl.org <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.njabl.org <br> <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dialups.mail-abuse.org <br> deny message = rejected because $sender_host_address \ <br> is in a black list at $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = list.dsbl.org <br> deny message = Spam blocked see: \ <br> www.spamcop.net/w3m?action=checkblock&amp;ip=$sender_host_address <br> log_message = found in $dnslist_domain <br> dnslists = bl.spamcop.net <br> deny message = rejected, $sender_host_address \ <br> Open Proxy, see: $dnslist_domain\n$dnslist_text <br> log_message = found in $dnslist_domain <br> dnslists = dnsbl.void.ru <br> <br> accept domains = +local_domains <br> endpass <br> message = unknown user <br> verify = recipient <br> <br> accept domains = +relay_to_domains <br> endpass <br> message = unrouteable address <br> verify = recipient <br> <br> accept hosts = +relay_from_hosts <br> accept authenticated = * <br> deny message = relay not permitted <br> <br> acl_check_mime: <br> <br> warn decode = default <br> <br> deny message = Blacklisted file extension detected ($mime_filename) <br> condition = ${if match \ <br> {${lc:$mime_filename}} \ <br> {\N(\.exe|\.pif|\.bat|\.scr|\.lnk|\.com|\.vbs|\.cpl)$\N} \ <br> {1}{0}} <br> <br> deny message = Sorry, noone speaks chinese here <br> condition = ${if eq{$mime_charset}{gb2312}{1}{0}} <br> <br> accept <br> <br> acl_check_content: <br> # deny message = Virus found ($malware_name) <br> # malware = * <br> <br> warn message = X-Spam-Score: $spam_score ($spam_bar) <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = X-Spam-Report: $spam_report <br> hosts = !+relay_from_hosts <br> spam = spamd:true <br> <br> warn message = Subject: ***SPAM*** $h_Subject: <br> hosts = !+relay_from_hosts <br> spam = spamd <br> <br> deny message = This message scored $spam_score spam points. <br> spam = spamd:true <br> hosts = !+relay_from_hosts <br> condition = ${if &gt;{$spam_score_int}{120}{1}{0}} <br> <br> accept <br> <br> ###################################################################### <br> # ROUTERS CONFIGURATION # <br> # Specifies how addresses are handled # <br> ###################################################################### <br> # THE ORDER IN WHICH THE ROUTERS ARE DEFINED IS IMPORTANT! # <br> # An address is passed to each router in turn until it is accepted. # <br> ###################################################################### <br> <br> begin routers <br> <br> dnslookup: <br> driver = dnslookup <br> domains = ! +local_domains <br> transport = remote_smtp <br> ignore_target_hosts = 0.0.0.0 : 127.0.0.0/8 <br> no_more <br> <br> dbmailuser: <br> driver = accept <br> condition = ${lookup pgsql{SELECT alias_idnr FROM \ <br> dbmail_aliases WHERE \ <br> alias='${quote_pgsql:$local_part@$domain}' OR \ <br> alias='${quote_pgsql:@$domain}'}{yes}{no}} <br> transport = dbmail_delivery <br> <br> ###################################################################### <br> # TRANSPORTS CONFIGURATION # <br> ###################################################################### <br> # ORDER DOES NOT MATTER # <br> # Only one appropriate transport is called for each delivery. # <br> ###################################################################### <br> <br> begin transports <br> <br> remote_smtp: <br> driver = smtp <br> <br> dbmail_delivery: <br> driver = pipe <br> check_string = <br> command = /usr/sbin/dbmail-smtp -d ${pipe_addresses} <br> group = mail <br> message_prefix = "" <br> message_suffix = "" <br> path="/bin:/sbin:/usr/bin:/usr/sbin" <br> #   <br> address_pipe: <br> driver = pipe <br> return_output <br> <br> address_reply: <br> driver = autoreply <br> <br> ###################################################################### <br> # RETRY CONFIGURATION # <br> ###################################################################### <br> <br> begin retry <br> <br> * quota <br> * * F,2h,15m; G,16h,1h,1.5; F,4d,6h <br> <br> ###################################################################### <br> # REWRITE CONFIGURATION # <br> ###################################################################### <br> <br> begin rewrite <br> <br> ###################################################################### <br> # AUTHENTICATION CONFIGURATION # <br> ###################################################################### <br> <br> begin authenticators <br> <br> auth_plain: <br> driver = plaintext <br> public_name = PLAIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = : <br> server_set_id = $2 <br> <br> #    ,    . <br> auth_login: <br> driver = plaintext <br> public_name = LOGIN <br> server_condition = ${lookup pgsql{SELECT user_idnr FROM \ <br> dbmail_users WHERE userid = \ <br> '${quote_pgsql:$1}' AND passwd = \ <br> '${quote_pgsql:$2}'}{yes}{no}} <br> server_prompts = Username:: : Password:: <br> server_set_id = $1 <br> <br> #    " " - TheBat! <br> auth_cram_md5: <br> driver = cram_md5 <br> public_name = CRAM-MD5 <br> server_secret = ${lookup pgsql{SELECT passwd FROM \ <br> dbmail_users WHERE userid \ <br> = '${quote_pgsql:$1}'}{$value}fail} <br> server_set_id = $1 <br> # End of Exim configuration file <br> ###ps  lissyara,       <br> <br></code> <br> <br> DBMail <br> dbmail.conf          <br> <code># (c) 2000-2006 IC&amp;S, The Netherlands <br> # <br> # Configuration file for DBMAIL <br> <br> [DBMAIL] <br> # <br> # Database settings <br> # <br> <br> # <br> # Supported drivers are mysql, pgsql, sqlite. <br> # <br> driver =pgsql <br> <br> # <br> # Supported drivers are sql, ldap. <br> # <br> authdriver =sql <br> <br> # <br> # Host for database, set to localhost if database is on <br> # the same host as dbmail and you want to use a local <br> # socket for connecting. <br> # <br> host =localhost <br> <br> # <br> # If you want to use TCP/IP for connecting to the database, <br> # and have the database running on a non-standard port. <br> # <br> sqlport =5432 <br> <br> # <br> # When using a local socket connection to the database, fill <br> # in the path to the socket here (eg /var/run/mysql.sock). <br> # <br> sqlsocket = <br> <br> # <br> # Database username. <br> # <br> user =dbmail <br> <br> # <br> # Database password. <br> # <br> pass =PasWoRd <br> <br> # <br> # Database name. <br> # <br> db =dbmail <br> <br> # <br> # Table prefix. Defaults to "dbmail_" if not specified. <br> # <br> table_prefix =dbmail_ <br> <br> # <br> # encoding must match the database/table encoding. <br> # ie latin1, utf8 <br> encoding = utf8 <br> <br> # <br> # messages with unknown encoding will be assumed to have <br> # default_msg_encoding <br> # ie iso8859-1, utf8 <br> default_msg_encoding = utf8 <br> <br> # <br> # Postmaster's email address for use in bounce messages. <br> # <br> #postmaster = DBMAIL-MAILER <br> <br> # <br> # Sendmail executable for forwards, replies, notifies, vacations. <br> # You may use pipes (|) in this command, for example: <br> # dos2unix|/usr/sbin/sendmail works well with Qmail. <br> # You may use quotes (") for executables with unusual names. <br> # <br> sendmail = /usr/sbin/sendmail <br> <br> # <br> # <br> # The following items can be overridden in the service-specific sections. <br> # <br> # <br> <br> # <br> # Trace level to send to syslog. Default is 2 (messages, errors, fatals). <br> # <br> TRACE_SYSLOG = 3 <br> <br> # <br> # Trace level to send to stderr. Default is 0 (fatals). <br> # <br> TRACE_STDERR = 1 <br> <br> # <br> # Root privs are used to open a port, then privs <br> # are dropped down to the user/group specified here. <br> # <br> EFFECTIVE_USER = dbmail <br> EFFECTIVE_GROUP = dbmail <br> <br> # <br> # The IP addresses the services will bind to. <br> # Use * for all local interfaces. <br> # Use 127.0.0.1 for localhost only. <br> # Separate multiple entries with spaces ( ) or commas (,). <br> # <br> BINDIP = * <br> <br> # <br> # Default number of child processes to start. <br> # <br> NCHILDREN = 2 <br> <br> # <br> # Maximum number of child processes allowed. <br> # <br> MAXCHILDREN = 10 <br> <br> # <br> # Unused children to always have availale. <br> # <br> MINSPARECHILDREN = 2 <br> <br> # <br> # Maximum unused children allowed to be active. <br> # <br> MAXSPARECHILDREN = 4 <br> <br> # <br> # Child process is restarted after handling this many connections. <br> # <br> MAXCONNECTS = 10000 <br> <br> # <br> # Child process will restart after this many connection errors. <br> # <br> MAX_ERRORS = 500 <br> <br> # <br> # Idle time allowed before a connection is shut off. <br> # <br> TIMEOUT = 300 <br> <br> # <br> # Idle time allowed before a connection is shut off if you have not logged in yet. <br> # <br> login_timeout = 60 <br> <br> # <br> # If yes, resolves IP addresses to DNS names when logging. <br> # <br> RESOLVE_IP = no <br> <br> # <br> # logfile for stdout messages <br> # <br> logfile = /var/log/dbmail.log <br> <br> # <br> # logfile for stderr messages <br> # <br> errorlog = /var/log/dbmail.err <br> <br> # <br> # directory for storing PID files <br> # <br> pid_directory = /var/run <br> <br> # <br> # directory for storing the daemon statefiles <br> # <br> state_directory = /var/run <br> <br> # <br> # directory for locating libraries (normally has a sane default compiled-in) <br> # <br> #library_directory = /usr/lib/dbmail <br> <br> [SMTP] <br> # In fact, there isn't anything here by default. <br> <br> [LMTP] <br> # <br> # Port to bind to. <br> # <br> PORT = 24 <br> <br> [POP] <br> # <br> # Port to bind to. <br> # <br> PORT = 110 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by POP3. <br> # This requires addition configuration of your MTA <br> # <br> POP_BEFORE_SMTP = no <br> <br> [IMAP] <br> <br> # <br> # Port to bind to. <br> # <br> PORT = 143 <br> <br> # <br> # IMAP prefers a longer timeout than other services. <br> # <br> TIMEOUT = 4000 <br> <br> # <br> # If yes, allows SMTP access from the host IP connecting by IMAP. <br> # This requires addition configuration of your MTA <br> # <br> IMAP_BEFORE_SMTP = no <br> <br> # <br> # during IDLE, how many seconds between checking the mailbox <br> # status (default: 30) <br> # <br> # idle_timeout = 30 <br> <br> # <br> # Provide a CAPABILITY to override the default <br> # <br> # capability = IMAP4 IMAP4rev1 AUTH=LOGIN ACL NAMESPACE CHILDREN SORT QUOTA THREAD=ORDEREDSUBJECT UNSELECT IDLE <br> <br> [SIEVE] <br> # <br> # Port to bind to. <br> # <br> PORT = 2000 <br> <br> [LDAP] <br> PORT = 389 <br> VERSION = 3 <br> HOSTNAME = ldap <br> BASE_DN = ou=People,dc=mydomain,dc=com <br> <br> # <br> # If your LDAP library supports ldap_initialize(), then you can use the <br> # alternative LDAP server DSN like following. <br> # <br> # URI = ldap://127.0.0.1:389 <br> # URI = ldapi://%2fvar%2frun%2fopenldap%2fldapi/ <br> <br> # <br> # Leave blank for anonymous bind. <br> # example: cn=admin,dc=mydomain,dc=com <br> # <br> BIND_DN = <br> <br> # <br> # Leave blank for anonymous bind. <br> # <br> BIND_PW = <br> SCOPE = SubTree <br> USER_OBJECTCLASS = top,account,dbmailUser <br> FORW_OBJECTCLASS = top,account,dbmailForwardingAddress <br> CN_STRING = uid <br> FIELD_PASSWD = userPassword <br> FIELD_UID = uid <br> FIELD_NID = uidNumber <br> MIN_NID = 10000 <br> MAX_NID = 15000 <br> FIELD_CID = gidNumber <br> MIN_CID = 10000 <br> MAX_CID = 15000 <br> FIELD_MAIL = mail <br> FIELD_QUOTA = mailQuota <br> FIELD_FWDTARGET = mailForwardingAddress <br> <br> [DELIVERY] <br> # <br> # Run Sieve scripts as messages are delivered. <br> # <br> SIEVE = yes <br> <br> # <br> # Use 'user+mailbox@domain' format to deliver to a mailbox. <br> # <br> SUBADDRESS = yes <br> <br> # <br> # Turn on/off the Sieve Vacation extension. <br> # <br> SIEVE_VACATION = yes <br> <br> # <br> # Turn on/off the Sieve Notify extension <br> # <br> SIEVE_NOTIFY = yes <br> <br> # <br> # Turn on/off additional Sieve debugging. <br> # <br> SIEVE_DEBUG = no <br> <br> # <br> # Use the auto_notify table to send email notifications. <br> # <br> AUTO_NOTIFY = no <br> <br> # <br> # Use the auto_reply table to send away messages. <br> # <br> AUTO_REPLY = no <br> # <br> # Defaults to "NEW MAIL NOTIFICATION" <br> # <br> #AUTO_NOTIFY_SUBJECT = <br> <br> # <br> # Defaults to POSTMASTER from the DBMAIL section. <br> # <br> #AUTO_NOTIFY_SENDER = <br> <br> # <br> # If you set this to 'yes' dbmail will check for duplicate <br> # messages in the relevant mailbox during delivery using <br> # the Message-ID header <br> # <br> suppress_duplicates = no <br> <br> # end of configuration file <br> <br> <br></code> <br> <br> Spamassassin <br>    ,         ,          /etc/spamasassin,      ,       nobody <br> <br> local.cf <br> <code>rewrite_header Subject ***SPAM*** <br> report_safe 1 <br> trusted_networks 192.168/16 127/8 <br> # lock_method flock <br> required_score 5.0 <br> use_bayes 1 <br> bayes_auto_learn 1 <br> # bayes_ignore_header X-Bogosity <br> # bayes_ignore_header X-Spam-Flag <br> # bayes_ignore_header X-Spam-Status <br> auto_whitelist_path /etc/mail/spamassassin/auto_whitelist <br> bayes_path /etc/mail/spamassassin/bayes <br> bayes_file_mode 0666 <br> bayes_min_ham_num 1 <br> bayes_min_spam_num 1 <br> auto_learn_threshold_nonspam -2 <br> auto_learn_threshold_spam 5 <br> bayes_learn_to_journal 1 <br> skip_rbl_checks 0 <br> <br> ok_languages ru en <br> ok_locales ru en <br></code> <br> <br>    ..     <br> <code>/etc/init.d/exim start <br> /etc/init.d/spamd start <br> #    pop3      <br> /etc/init.d/dbmail-pop3d <br></code> <br> <br>     ,           <br> <code>rc-update add postgresql default <br> rc-update add exim default <br> rc-update add spamd default <br> rc-update add dbmail-pop3d default <br></code> <br> <br>          ,       <br> <code>dbmail-users -a admin@example.com -s admin@example.com -p plaintext -w 123123 <br></code> <br> <br>   ,        <br></code> <br></div><p>Source: <a href="https://habr.com/ru/post/37195/">https://habr.com/ru/post/37195/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../371933/index.html">IRobot Roomba 980 Robot Vacuum Cleaner</a></li>
<li><a href="../371935/index.html">Life after death: how to set up accounts</a></li>
<li><a href="../371941/index.html">Linus Torvalds introduced the Linux Kernel 4.5 release. Codename "Blurry Fish Butt"</a></li>
<li><a href="../371943/index.html">Indian students made a robotic bike with GPS and GSM</a></li>
<li><a href="../371947/index.html">What does installing SSD in Mac mini?</a></li>
<li><a href="../371951/index.html">Rain: to go or run? [Vert Dider Voice]</a></li>
<li><a href="../371953/index.html">The monkey driving the wheelchair and the VR avatar by the power of thought is real</a></li>
<li><a href="../371955/index.html">Digital medicine: are consumers ready for mobile check-ins and telemedicine?</a></li>
<li><a href="../371957/index.html">PwC Blockchain Market Research: Application Potential and Key Trends</a></li>
<li><a href="../371959/index.html">The story of one project. Rating and Anonymizer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>