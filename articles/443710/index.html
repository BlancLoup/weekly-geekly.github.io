<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Java Challengers # 4: Comparing objects with equals () and hashCode ()</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Java Challengers # 4: Comparing objects with equals () and hashCode () 


 In the run-up to the launch of the new Java developer flow , we continue to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Java Challengers # 4: Comparing objects with equals () and hashCode ()</h1><div class="post__text post__text-html js-mediator-article"><h1 id="java-challengers-4-sravnenie-obektov-s-equals-i-hashcode">  Java Challengers # 4: Comparing objects with equals () and hashCode () </h1><br><p>  <em>In the run-up to the launch of the new <a href="https://otus.pw/Ldcc/">Java developer</a> flow <a href="https://otus.pw/Ldcc/">,</a> we continue to translate a series of Java Challengers articles, the previous parts of which can be found in the links below:</em> </p><br><ul><li>  <a href="https://habr.com/ru/company/otus/blog/428307/">Overloading methods in JVM</a> </li><li>  <a href="https://habr.com/ru/company/otus/blog/428449/">String comparison</a> </li><li>  <a href="https://habr.com/ru/company/otus/blog/429120/">Polyformism and inheritance</a> </li></ul><br><p>  <em>Go!</em> </p><br><p> In this article, you will learn how the <code>equals()</code> and <code>hashCode()</code> methods are related to each other and how they are used when comparing objects. </p><br><p><img src="https://habrastorage.org/webt/rb/gb/ql/rbgbqlpkahbapfkuwacmvy_r-ri.png" alt="equals-hashcode"></p><a name="habracut"></a><br><p>  Without using <code>equals()</code> and <code>hashCode()</code> to compare the state of two objects, we need to write a lot of " <code>if</code> " comparisons, comparing each field of the object.  This approach makes the code confusing and difficult to read.  Working together, these two methods help to create more flexible and consistent code. </p><br><p>  The source code for the article is <a href="https://github.com/rafadelnero/javaworld-challengers">here</a> . </p><br><h2 id="pereopredelenie-equals-i-hashcode">  Override equals () and hashCode () </h2><br><p>  Method overriding (method overriding) is a technique in which the behavior of the parent class or interface is rewritten (redefined) in a subclass (see <a href="https://habr.com/company/otus/blog/429120/">Java Challengers # 3: Polymorphism and Inheritance</a> , <a href="https://www.javaworld.com/article/3290403/core-java/java-challengers-3-polymorphism-and-inheritance.html">eng</a> ).  In Java, each object has the <code>equals()</code> and <code>hashCode()</code> methods and they must be redefined for proper operation. </p><br><p>  To understand how the <code>equals()</code> and <code>hashCode()</code> override works, let's examine their implementation in Java base classes.  Below is the <code>equals()</code> method of the <code>Object</code> class.  The method checks whether the current instance matches the passed <code>obj</code> object. </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object obj)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> == obj); }</code> </pre> <br><p>  Now let's take a look at the <code>hashCode()</code> method in the <code>Object</code> class. </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@HotSpotIntrinsicCandidate</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">native</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hashCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;</code> </pre> <br><p>  This is a native method that is written in another language, such as C, and it returns some numeric code associated with the memory address of the object.  (If you are not writing JDK code, then it is not important to know exactly how this method works.) <br>  <em><strong>Translator's note:</strong> the value associated with the address is not entirely correct ( <a href="https://habr.com/ru/company/otus/blog/443710/">thanks to</a> <a href="https://habr.com/ru/users/vladimir_dolzhenko/" class="user_link">vladimir_dolzhenko</a> ).</em>  <em>HotSpot JVM uses pseudo-random numbers by default.</em>  <em>The implementation description of hashCode () for HotSpot is <a href="https://habr.com/ru/post/165683/">here</a> and <a href="https://habr.com/ru/company/mailru/blog/321306/">here</a> .</em> </p><br><p>  If the <code>equals()</code> and <code>hashCode()</code> methods are not overridden, the <code>Object</code> class methods described above will be called instead.  In this case, the methods do not fulfill the real goal of <code>equals()</code> and <code>hashCode()</code> , which is to check whether objects have the same state. </p><br><p>  As a rule, when <code>equals()</code> is overridden, <code>hashCode()</code> also overridden. </p><br><h2 id="sravnenie-obektov-s-equals">  Comparing objects with equals () </h2><br><p>  The <code>equals()</code> method is used to compare objects.  To determine whether objects are the same or not, <code>equals()</code> compares the field values ‚Äã‚Äãof the objects: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EqualsAndHashCodeExample</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String... args)</span></span></span></span>{ System.out.println(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Simpson(<span class="hljs-string"><span class="hljs-string">"Homer"</span></span>, <span class="hljs-number"><span class="hljs-number">35</span></span>, <span class="hljs-number"><span class="hljs-number">120</span></span>) .equals(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Simpson(<span class="hljs-string"><span class="hljs-string">"Homer"</span></span>,<span class="hljs-number"><span class="hljs-number">35</span></span>,<span class="hljs-number"><span class="hljs-number">120</span></span>))); System.out.println(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Simpson(<span class="hljs-string"><span class="hljs-string">"Bart"</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">120</span></span>) .equals(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Simpson(<span class="hljs-string"><span class="hljs-string">"El Barto"</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">45</span></span>))); System.out.println(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Simpson(<span class="hljs-string"><span class="hljs-string">"Lisa"</span></span>, <span class="hljs-number"><span class="hljs-number">54</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>) .equals(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object())); } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Simpson</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> age; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> weight; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Simpson</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> age, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> weight)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = name; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.age = age; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.weight = weight; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object o)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// 1 if (this == o) { return true; } // 2 if (o == null || getClass() != o.getClass()) { return false; } // 3 Simpson simpson = (Simpson) o; return age == simpson.age &amp;&amp; weight == simpson.weight &amp;&amp; name.equals(simpson.name); } } }</span></span></code> </pre> <br><p>  Let's look at the <code>equals()</code> method.  The first comparison compares the current instance of <code>this</code> object with the passed <code>o</code> object.  If this is the same object, then <code>equals()</code> returns <code>true</code> . </p><br><p>  In the second comparison, it is checked whether the object passed in is <code>null</code> and what type it is.  If the transferred object is of a different type, then the objects are not equal. </p><br><p>  Finally, <code>equals()</code> compares the fields of objects.  If two objects have the same field values, then the objects are the same. </p><br><h2 id="analiz-variantov-sravneniya-obektov">  Analysis of options for comparing objects </h2><br><p>  Now let's look at the options for comparing objects in the <code>main()</code> method.  First, we compare two <code>Simpson</code> objects: </p><br><pre> <code class="java hljs">System.out.println( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Simpson(<span class="hljs-string"><span class="hljs-string">"Homer"</span></span>, <span class="hljs-number"><span class="hljs-number">35</span></span>, <span class="hljs-number"><span class="hljs-number">120</span></span>).equals( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Simpson(<span class="hljs-string"><span class="hljs-string">"Homer"</span></span>, <span class="hljs-number"><span class="hljs-number">35</span></span>, <span class="hljs-number"><span class="hljs-number">120</span></span>)));</code> </pre> <br><p>  The fields of these objects have the same values, so the result will be <code>true</code> . </p><br><p>  Then again compare two <code>Simpson</code> objects: </p><br><pre> <code class="java hljs">System.out.println( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Simpson(<span class="hljs-string"><span class="hljs-string">"Bart"</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">45</span></span>).equals( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Simpson(<span class="hljs-string"><span class="hljs-string">"El Barto"</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">45</span></span>)));</code> </pre> <br><p>  The objects here are similar, but the meanings of the names are different: <em>Bart</em> and <em>El Barto</em> .  Therefore, the result will be <code>false</code> . </p><br><p>  Finally, let's compare the <code>Simpson</code> object and an instance of the <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Objects.html"><code>Object</code></a> class: </p><br><pre> <code class="java hljs">System.out.println( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Simpson(<span class="hljs-string"><span class="hljs-string">"Lisa"</span></span>, <span class="hljs-number"><span class="hljs-number">54</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>).equals( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object()));</code> </pre> <br><p>  In this case, the result will be <code>false</code> , since the object types differ. </p><br><h2 id="equals-v-sravnenii-s-">  equals () versus <code>==</code> </h2><br><p>  At first glance, it seems that the <code>==</code> operator and the <code>equals()</code> method do the same thing, but, in fact, they work differently.  The <code>==</code> operator compares whether two references point to the same object.  For example: </p><br><pre> <code class="java hljs">Simpson homer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Simpson(<span class="hljs-string"><span class="hljs-string">"Homer"</span></span>, <span class="hljs-number"><span class="hljs-number">35</span></span>, <span class="hljs-number"><span class="hljs-number">120</span></span>); Simpson homer2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Simpson(<span class="hljs-string"><span class="hljs-string">"Homer"</span></span>, <span class="hljs-number"><span class="hljs-number">35</span></span>, <span class="hljs-number"><span class="hljs-number">120</span></span>); System.out.println(homer == homer2);</code> </pre> <br><p>  We created two different instances of <code>Simpson</code> using the <code>new</code> operator.  Therefore, the variables <code>homer</code> and <code>homer2</code> will point to different objects in the <a href="https://www.baeldung.com/java-stack-heap">heap</a> .  Thus, as a result, we get <code>false</code> . </p><br><p>  In the following example, use the override method <code>equals()</code> : </p><br><pre> <code class="java hljs">System.out.println(homer.equals(homer2));</code> </pre> <br><p>  In this case, the fields will be compared.  Since the field values ‚Äã‚Äãof both <code>Simpson</code> objects are the same, the result will be <code>true</code> . </p><br><h2 id="identifikaciya-obektov-s-hashcode">  Identifying objects with hashCode () </h2><br><p>  To optimize performance when comparing objects, use the <code>hashCode()</code> method.  The <code>hashCode()</code> method returns a unique identifier for each object, which makes it easier to compare object states. </p><br><p>  If the hash code of the object does not match the hash code of another object, then you can not run the <code>equals()</code> method: you just know that the two objects do not match.  On the other hand, if the hash code is the same, then you need to run the <code>equals()</code> method to determine if the field values ‚Äã‚Äãmatch. </p><br><p>  Consider a practical example with <code>hashCode()</code> . </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HashcodeConcept</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String... args)</span></span></span><span class="hljs-function"> </span></span>{ Simpson homer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Simpson(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"Homer"</span></span>); Simpson bart = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Simpson(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"Homer"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> isHashcodeEquals = homer.hashCode() == bart.hashCode(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isHashcodeEquals) { System.out.println(<span class="hljs-string"><span class="hljs-string">"   equals."</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { System.out.println(<span class="hljs-string"><span class="hljs-string">"    equals, .. "</span></span> + <span class="hljs-string"><span class="hljs-string">" ,  ,     ."</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Simpson</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id; String name; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Simpson</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, String name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.id = id; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = name; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object o)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> == o) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (o == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || getClass() != o.getClass()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; Simpson simpson = (Simpson) o; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> id == simpson.id &amp;&amp; name.equals(simpson.name); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hashCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> id; } } }</code> </pre> <br><p>  The <code>hashCode()</code> method, which always returns the same value, is valid, but not effective.  In this case, the comparison will always return <code>true</code> , so the <code>equals()</code> method will always be executed.  In this case, there is no performance improvement. </p><br><h2 id="ispolzovanie-equals-i-hashcode-s-kollekciyami">  Using equals () and hashCode () with collections </h2><br><p>  Classes that implement the <code>Set</code> (set) interface should prevent the addition of duplicate elements.  Below are some classes that implement the <code>Set</code> interface: </p><br><ul><li>  <a href="https://docs.oracle.com/javase/7/docs/api/java/util/HashSet.html">Hashset</a> </li><li>  <a href="https://docs.oracle.com/javase/7/docs/api/java/util/TreeSet.html">Treeset</a> </li><li>  <a href="https://docs.oracle.com/javase/7/docs/api/java/util/LinkedHashSet.html">LinkedHashSet</a> </li><li>  <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CopyOnWriteArraySet.html">CopyOnWriteArraySet</a> </li></ul><br><p>  Only unique elements can be added to the <code>Set</code> .  Thus, if you want to add an element, for example, in a <code>HashSet</code> , you must first use the <code>equals()</code> and <code>hashCode()</code> methods to make sure that this element is unique.  If the <code>equals()</code> and <code>hashCode()</code> methods were not overridden, you risk inserting duplicate values. </p><br><p>  Let's look at part of the implementation of the <code>add()</code> method in <code>HashSet</code> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; key.equals(k)))) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; p = e;</code> </pre> <br><p>  Before adding a new item, <code>HashSet</code> checks if an item exists in this collection.  If the object matches, the new element will not be inserted. </p><br><p>  The <code>equals()</code> and <code>hashCode()</code> methods are used not only in <code>Set</code> .  These methods are also required for <a href="https://docs.oracle.com/javase/8/docs/api/java/util/HashMap.html">HashMap</a> , <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Hashtable.html">Hashtable</a> , and <a href="https://docs.oracle.com/javase/8/docs/api/java/util/LinkedHashMap.html">LinkedHashMap</a> .  As a rule, if you see a collection with the prefix <em>"Hash"</em> , you can be sure that its correct operation requires redefinition of the <code>hashCode()</code> and <code>equals()</code> methods. </p><br><h2 id="rekomendacii-po-ispolzovaniyu-equals-i-hashcode">  Recommendations for using equals () and hashCode () </h2><br><p>  Run the <code>equals()</code> method only on objects with the same hash code.  <em>Do not use</em> <code>equals()</code> if the hash code is different. </p><br><p>  Table 1. Comparison of hash codes </p><br><table><thead><tr><th>  If comparing hashCode () ... </th><th>  That ... </th></tr></thead><tbody><tr><td>  returns <code>true</code> </td><td>  execute <code>equals()</code> </td></tr><tr><td>  returns <code>false</code> </td><td>  do not perform <code>equals()</code> </td></tr></tbody></table><br><p>  This principle is mainly used in the <code>Set</code> or <code>Hash</code> collections for performance reasons. </p><br><h2 id="pravila-sravneniya-obektov">  Rules for comparing objects </h2><br><p>  When the <code>hashCode()</code> comparison returns <code>false</code> , the <code>equals()</code> method <em>must also return</em> <code>false</code> .  If the hash code is different, then the objects are definitely not equal. </p><br><p>  Table 2. Comparison of objects with hashCode () </p><br><table><thead><tr><th>  When comparing <code>hashCode()</code> returns ... </th><th>  The <code>equals()</code> method should return ... </th></tr></thead><tbody><tr><td> <code>true</code> </td> <td>  <code>true</code> or <code>false</code> </td></tr><tr><td> <code>false</code> </td> <td> <code>false</code> </td> </tr></tbody></table><br><p>  When the <code>equals()</code> method returns <code>true</code> , it means that objects are equal <em>in all values ‚Äã‚Äãand attributes</em> .  In this case, the hash code comparison should also be true. </p><br><p>  Table 3. Comparing objects with equals () </p><br><table><thead><tr><th>  When the <code>equals()</code> method returns ... </th><th>  The <code>hashCode()</code> method should return ... </th></tr></thead><tbody><tr><td> <code>true</code> </td> <td> <code>true</code> </td> </tr><tr><td> <code>false</code> </td> <td>  <code>true</code> or <code>false</code> </td></tr></tbody></table><br><h2 id="reshite-zadachku-na-equals-i-hashcode">  Solve the problem on equals () and hashCode () </h2><br><p>  It's time to test your knowledge of the <code>equals()</code> and <code>hashCode()</code> methods.  The task is to find out the result of several <code>equals()</code> and the final size of the <code>Set</code> collection. </p><br><p>  To get started, carefully review the following code: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EqualsHashCodeChallenge</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String... args)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Simpson(<span class="hljs-string"><span class="hljs-string">"Bart"</span></span>).equals(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Simpson(<span class="hljs-string"><span class="hljs-string">"Bart"</span></span>))); Simpson overriddenHomer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Simpson(<span class="hljs-string"><span class="hljs-string">"Homer"</span></span>) { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hashCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-number"><span class="hljs-number">43</span></span> + <span class="hljs-number"><span class="hljs-number">777</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>; } }; System.out.println(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Simpson(<span class="hljs-string"><span class="hljs-string">"Homer"</span></span>).equals(overriddenHomer)); Set set = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet(Set.of(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Simpson(<span class="hljs-string"><span class="hljs-string">"Homer"</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Simpson(<span class="hljs-string"><span class="hljs-string">"Marge"</span></span>))); set.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Simpson(<span class="hljs-string"><span class="hljs-string">"Homer"</span></span>)); set.add(overriddenHomer); System.out.println(set.size()); } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Simpson</span></span></span><span class="hljs-class"> </span></span>{ String name; Simpson(String name) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = name; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object obj)</span></span></span><span class="hljs-function"> </span></span>{ Simpson otherSimpson = (Simpson) obj; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name.equals(otherSimpson.name) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.hashCode() == otherSimpson.hashCode(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hashCode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-number"><span class="hljs-number">43</span></span> + <span class="hljs-number"><span class="hljs-number">777</span></span>); } } }</code> </pre> <br><p>  First, analyze the code, think about what the result will be.  And only then run the code.  The goal is to improve your code analysis skills and learn basic Java concepts so you can make your code better. </p><br><p>  What will be the result ?. </p><br><pre> <code class="plaintext hljs">A) true true 4 B) true false 3 C) true false 2 D) false true 3</code> </pre> <br><h2 id="chto-proizoshlo-ponimanie-equals-i-hashcode">  What happened?  Understanding equals () and hashCode () </h2><br><p>  In the first comparison, the result of <code>equals()</code> is <code>true</code> , because the states of the objects are the same, and the <code>hashCode()</code> method returns the same value for both objects. </p><br><p>  In the second comparison, the <code>hashCode()</code> method was redefined for the <code>hashCode()</code> variable.  For both <code>Simpson</code> objects, the name is <em>"Homer"</em> , but for <code>overriddenHomer</code> the <code>hashCode()</code> method returns a different value.  In this case, the result of the <code>equals()</code> method will be <code>false</code> , since it contains a comparison with the hash code. </p><br><p>  You must have understood that there will be three <code>Simpson</code> objects in the collection.  Let's break it down. </p><br><p>  The first object in the set will be inserted as usual: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Simpson(<span class="hljs-string"><span class="hljs-string">"Homer"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// </span></span></code> </pre> <br><p>  The following object will also be inserted in the usual order, because it contains a value that is different from the previous object: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Simpson(<span class="hljs-string"><span class="hljs-string">"Marge"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// </span></span></code> </pre> <br><p>  Finally, the next <code>Simpson</code> object has the same name value as the first object.  In this case, the object will not be inserted: </p><br><pre> <code class="java hljs">set.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Simpson(<span class="hljs-string"><span class="hljs-string">"Homer"</span></span>)); <span class="hljs-comment"><span class="hljs-comment">//  </span></span></code> </pre> <br><p>  As we know, the <code>overridenHomer</code> object uses a different hash code value, as opposed to a regular <code>Simpson("Homer")</code> instance <code>Simpson("Homer")</code> .  For this reason, this item will be inserted into the collection: </p><br><pre> <code class="java hljs">set.add(overriddenHomer); <span class="hljs-comment"><span class="hljs-comment">// </span></span></code> </pre> <br><h2 id="otvet">  Answer </h2><br><p>  The correct answer is B. The output will be: </p><br><pre> <code class="plaintext hljs">true false 3</code> </pre> <br><h2 id="chastye-oshibki-s-equals-i-hashcode">  Common errors with equals () and hashCode () </h2><br><ul><li>  The absence of the <code>hashCode()</code> override along with the <code>equals()</code> override or vice versa. </li><li>  No override of <code>equals()</code> and <code>hashCode()</code> when using hash collections, such as <code>HashSet</code> . </li><li>  Returning a constant value in the <code>hashCode()</code> method instead of returning a unique code for each object. </li><li>  Equivalent usage <code>==</code> and <code>equals()</code> .  The <code>==</code> operator compares object references, while the <code>equals()</code> method compares object values. </li></ul><br><h2 id="chto-nuzhno-pomnit-o-equals-i-hashcode">  Things to remember about equals () and hashCode () </h2><br><ul><li>  It is recommended to always override the <code>equals()</code> and <code>hashCode()</code> methods in your POJOs ( <a href="https://ru.wikipedia.org/wiki/POJO">rus.</a> , <a href="https://en.wikipedia.org/wiki/Plain_old_Java_object">Eng.</a> ) </li><li>  Use an efficient algorithm to create a unique hash code. </li><li>  When overriding the <code>equals()</code> method, always override the <code>hashCode()</code> method. </li><li>  The <code>equals()</code> method should compare the full state of objects (values ‚Äã‚Äãfrom fields). </li><li>  The <code>hashCode()</code> method can be the identifier (ID) of the POJO. </li><li>  If the result of comparing the hash code of two objects is <code>false</code> , then the <code>equals()</code> method must also be <code>false</code> . </li><li>  If <code>equals()</code> and <code>hashCode()</code> not overridden when using hash collections, then the collection will have duplicate elements. </li></ul><br><h2 id="izuchite-bolshe-o-java">  Learn more about Java. </h2><br><ul><li>  See more examples of working with <a href="https://www.javaworld.com/article/2073250/basic-java-hashcode-and-equals-demonstrations.html">equals () and hashCode ()</a> (eng.). </li><li>  See <a href="https://devgym.oracle.com/pls/apex/dg/competition/java">Java Dev Gym</a> and <a href="https://nobugsproject.com/">NoBugsProject</a> by Rafael Del Nero. </li></ul><br><p>  <em>Traditionally, I wait for your comments and invite you to <a href="https://otus.pw/1vpS/">an open lesson</a> , which our teacher, <a href="https://otus.pw/tIuP/">Sergey Petrelevich</a> , will conduct on March 18</em> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/443710/">https://habr.com/ru/post/443710/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../443698/index.html">Google has stopped "strangling goose": DuckDuckGo is included in the list of standard Chrome search engines for 60 countries</a></li>
<li><a href="../443702/index.html">How to delegate simple reports to the robot. Writing a bot in Python and Google BigQuery</a></li>
<li><a href="../443704/index.html">According to the results of the IPO of 2019, 5,000 new millionaires may appear in Silicon Valley</a></li>
<li><a href="../443706/index.html">3 million users added to Telegram per day</a></li>
<li><a href="../443708/index.html">Mission "Chang'e-4" - the third lunar day. Rover "Yuytu-2" in search of ... stones</a></li>
<li><a href="../443712/index.html">Yandex and some media sites suffered from a DNS attack from Roskomnadzor</a></li>
<li><a href="../443718/index.html">Fantasy game with 300 thousand races</a></li>
<li><a href="../443722/index.html">Design and naming of queues</a></li>
<li><a href="../443726/index.html">Features settings Palo Alto Networks: SSL VPN</a></li>
<li><a href="../443728/index.html">Google Plus stops working. So what?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>