<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to develop a cloud service: ensure smooth operation and add features</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If we use the well-known comparison, the development of cloud service is a task similar to replacing the engine on a flying plane. But there is no alt...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to develop a cloud service: ensure smooth operation and add features</h1><div class="post__text post__text-html js-mediator-article">  If we use the well-known comparison, the development of cloud service is a task similar to replacing the engine on a flying plane.  But there is no alternative - you will hopelessly fall behind if you do not constantly change.  Service <a href="http://www.moysklad.ru/">MoySklad is</a> constantly changing for 7 years.  In this post we will talk about how this happens. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/18b/df8/6de/18bdf86de9823432a66332c9ef2df6b8.jpg" alt="image"><br><br><a name="habracut"></a><br><h4>  Loads </h4><br>  If your service works in B2B (that is, for companies, and not for individual users), it is quite simple to predict its load.  She has no unexpected jumps like habraeffekta.  If we talk about our region - trade - during the year there are two well-known peaks: before the New Year holidays and on March 8.  The peaks are several tens of percent (and not several times). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/59a/635/4ee/59a6354ee1688b0ecd288de8c2dfdb13.png" alt="image"><br><br>  Since the load varies little (in the picture - the actual load schedule of one of the servers), there is no great need for elasticity, which is provided by various PaaS.  Therefore, instead of Amazon EC2 or other cloud hosting sites, we rent regular physical dedicated servers.  Apparently, with a stable high load, this is the optimal solution. <br><br>  If everything goes well, the user base grows continuously.  This is a constant trend, each month the load and the volume of bases increases by 5-10%.  In practice, this means that every few months we must either install new servers or improve the architecture of the service (or both). <br><br>  But the main reason for which you need to have a solid margin for the load - this is an error.  Some bugs appear on the production site along with updates.  Most of all, I remembered the exotic problem, when the stack of traces in the log did not catastrophically slow down the application on the server with AMD processors.  (On servers with Intel, everything worked fine.) <br><br>  Other mistakes wait patiently for their chance.  In practice, most of the problems we brought exotic patterns that looped the code for printing documents.  Therefore, we have determined the minimum performance margin for all servers and components - by 2-3 times.  In most cases, it allows users to work normally, even if there are any problems inside. <br><br>  In my opinion, there is no need to immediately prepare the architecture for super-high loads.  In the B2B world, nothing happens instantly, and with smooth growth there is time to gradually adapt the architecture to the growing load. <br><br>  MoySklad was launched as one monolithic Java EE application and one database.  A few years after launch, the only database server stopped coping with the load.  We said ‚Äúok‚Äù and divided the base into several physical servers.  After some time, the application itself approached the load limit.  We said ‚Äúok‚Äù and carried out long and hard tasks to a separate server - data import and export, API.  After some time, we split the main application into several servers. <br><br>  You do not have to spend too much time preparing yourself for future ultrahigh loads.  Most likely, then all the same, everything will have to be redone. <br><br><h4>  Technology </h4><br>  The development of architecture is most helped or hampered by technology.  The right technology makes life simple and enjoyable.  Wrong bring pain and suffering. <br><br>  I will give an example.  To merge several JVMs into a cluster, we used the <a href="http://infinispan.org/">Infinispan</a> distributed cache in JBoss.  Up to a certain point, everything went well, but then (perhaps due to an increase in load) regular failures began.  The problem was that about once a week, Infinispan was losing contact between individual Java machines. <br><br>  Infinispan has a huge amount of settings, and on the Internet there are tips on how to tweak these settings to solve the same or similar problems.  We spent several months trying out reasonable options.  Kesh continued to fall off regularly. <br><br>  The solution was simple.  In one week, we moved the implementation of the cache from Infinispan to <a href="http://hazelcast.com/">Hazelcast</a> .  This implementation started immediately. <br><br>  If the technology does not work, it is best to replace it as soon as possible. <br><br><h4>  Releases </h4><br>  An important task of product development is to keep it balanced.  What does it mean? <br><br>  Like any fairly mature product, MyWarehouse has a hefty backlog of things that should have been done a long time ago.  So voluminous that working with him is quite difficult.  In the next release, you can pull new features more or less randomly, but how much is the optimal approach? <br><br>  Seriously reduce chaos helps understanding that all features are clearly divided into three groups. <br><br>  1) Platform features.  Outwardly, they do not give users anything, and often interfere, because their release is potentially associated with the most severe glitches and brakes.  However, if you constantly do not implement improvements to the platform, soon enough the product staggers on thin legs and collapses heavily under the ever-increasing load. <br><br>  2) Recycling functionality.  They do not give new opportunities, but they put in order what was done crookedly.  Recycling cause massive suffering among users who are accustomed to work in the old way.  Still, it is necessary to do them, because without them the product will quickly become hopelessly confusing and accessible for development only for the chosen ones - geeks. <br><br>  3) Really new features.  Yes, minimum is more, minimum viable product taxis, users buy a solution to their problems, and not a set of features, so on.  But in the end, a particular product is chosen precisely because of the set of possibilities that more or less accurately correspond to the user's tasks.  New features should appear continuously. <br><br>  These three groups of features are easier to balance.  You just need to organize the development in three parallel threads.  How best to group them into releases? <br><br>  The main advice from our experience is to never combine new features and platform changes in one update.  Such combined releases are too complex, difficult to prepare and difficult to test.  Therefore, we divide releases into platform and functional ones. <br><br>  The feature of platform releases is under a heavy load, on real user data, something can go wrong.  Therefore, we make them roll back.  If problems arise, the old version returns in a few minutes and the development team starts preparing a second attempt. <br><br>  Functional releases are harder to roll back.  As a rule, they require changes in the database schema and data conversions, so returning the old version will not be so easy.  But this is not necessary - it is easier to test a functional release. <br><br>  Small life hacking: better to roll out massive updates on the weekend.  On Saturday, and especially Sunday, the service is several times smaller than the users. <br><br><h4>  Results </h4><br>  We showed our approaches and techniques for the continuous development of a successful cloud service.  Once again I will repeat three important rules of work in the conditions of constant updates: <br><br>  1. The main reason for which it is necessary to have a substantial supply of resources under load is possible development errors, and not a hypothetical future increase in the number of users.  It is not worth spending time on proactively preparing for future ultrahigh loads. <br>  2. There is no point in trying to get external libraries and components to work for too long: if the technology does not work, it is best to replace it as soon as possible. <br>  3. If you have already done everything and are ready for updates, never combine new features and platform changes in one release. </div><p>Source: <a href="https://habr.com/ru/post/230991/">https://habr.com/ru/post/230991/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../230977/index.html">Chinese Internet giant Alibaba chose the New York Stock Exchange (NYSE) for an IPO</a></li>
<li><a href="../230979/index.html">Happy sys admin</a></li>
<li><a href="../230981/index.html">Summer update on "Freelance"</a></li>
<li><a href="../230985/index.html">September 1 - again for courses</a></li>
<li><a href="../230987/index.html">Sleep Biohacking: Science-Confirmed Tips</a></li>
<li><a href="../230993/index.html">Batch convert office documents to PDF, JPG, TIFF and PNG</a></li>
<li><a href="../230995/index.html">Android cipher / Simplocker aims for English-speaking users</a></li>
<li><a href="../230999/index.html">Linux games appeared on GOG.com</a></li>
<li><a href="../231001/index.html">Understanding the intricacies of BYOD policy is a serious plus for a summary.</a></li>
<li><a href="../231003/index.html">Microsoft boosts Internet Explorer immunity to use-after-free attacks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>