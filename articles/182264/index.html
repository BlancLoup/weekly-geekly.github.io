<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DevOps Engineer Tools: Librarian</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is intended for those who use or plan to start using the configuration management system Opscode Chef . 

 The main task of implementing ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>DevOps Engineer Tools: Librarian</h1><div class="post__text post__text-html js-mediator-article">  This article is intended for those who use or plan to start using the configuration management system <a href="http://www.opscode.com/chef/">Opscode Chef</a> . <br><br>  The main task of implementing any configuration management system, be it <a href="http://www.opscode.com/chef/">Chef</a> , <a href="https://puppetlabs.com/puppet/puppet-open-source/">Puppet</a> or something else, is to repeat and update the environment of all environments used in software development (dev, CI, QA, stage, production).  It follows that the configuration description itself must be uniquely stored and updated.  Unfortunately, the versioning capabilities that Chef has are quite limited.  Therefore, in conjunction with Chef, <a href="http://rubygems.org/gems/librarian">Librarian has</a> recently been actively used.  But before we talk about him, let's talk a bit about the cookbooks. <br><a name="habracut"></a><br>  Kukbuki (in more detail about what it is, you can read <a href="http://docs.opscode.com/essentials_cookbooks.html">here</a> ) can be divided into 3 types: <br><ol><li>  kukbuki from <a href="http://community.opscode.com/cookbooks">community.opscode.com</a> ; </li><li>  Kukbuki from GitHub and other places; </li><li>  own project kukbuk. </li></ol><br>  In your project, all the cookbooks can be in the cookbooks folder under the version control system.  And if for own kukbuk is the only reasonable way, then for kukbuk of the first two types, this solution seems rather strange.  For the simple reason that you need to check for updates, manage dependencies and update such kukbuki in "manual" mode.  In addition, if you take a cookbook and simply add it to the cookbooks folder, remembering where you got it from will be extremely difficult.  Cookbooks with GitHub can be stored as git submodules, but this does not solve most of the problems listed here. <br><br>  Moreover, if any of the cookbooks you use have dependencies (they are written in the cookbook metadata.rb file), then you will have to manually add dependencies to the project. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      All these problems can be avoided by using <a href="https://github.com/applicationsonline/librarian-chef">Librarian</a> .  This is a tool that helps manage the dependencies and versions of your cookbooks. <br><br>  There is a similar project that does almost the same thing, <a href="http://berkshelf.com/">Berkshelf</a> .  It appeared later Librarian, pulls with it a bunch of dependencies, has 2 times less installations ( <a href="http://rubygems.org/gems/berkshelf">judging by rubygems</a> ), but it is slightly better documented.  The choice of one of them is exclusively a matter of taste.  You can switch to another tool at any time, because the dependency description files are identical.  We use Librarian, but what is written further is almost completely relevant for Berkshelf. <br><br>  Imagine a very simple project that uses quite a few cookbooks.  Let's start using librarian with the help of the <code>init</code> command, which creates the initial <code>Cheffile</code> file - it will contain the description of the cookbooks you use. <br><br><pre> <code class="bash hljs">$ librarian-chef init create Cheffile $ cat Cheffile site <span class="hljs-string"><span class="hljs-string">'http://community.opscode.com/api/v1'</span></span></code> </pre><br><br>  Add one line to our file and execute <code>librarian-chef install</code> <br><br><pre> <code class="bash hljs">$ cat Cheffile site <span class="hljs-string"><span class="hljs-string">'http://community.opscode.com/api/v1'</span></span> cookbook <span class="hljs-string"><span class="hljs-string">'lvm'</span></span> $ librarian-chef install Installing lvm (0.8.6)</code> </pre><br><br>  This command will put all the necessary cookies in the cookbooks folder and create the <code>Cheffile.lock</code> file. <br><br><pre> <code class="bash hljs">$ ls cookbooks lvm $ cat Cheffile.lock SITE remote: http://community.opscode.com/api/v1 specs: lvm (0.8.6) DEPENDENCIES lvm (&gt;= 0)</code> </pre><br><br>  We store local for the project kukbuki in inhouse-cookbooks folder.  These are those cookbooks that are specific to this particular project.  In <code>Cheffile</code> we add the following: <br><br><pre> <code class="ruby hljs">cookbook <span class="hljs-string"><span class="hljs-string">'project42'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:path</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'inhouse-cookbooks/project42'</span></span></code> </pre><br><br>  Also in <code>Cheffile</code> you can refer to specific revisions of the kukbuk in the gita. <br><br><pre> <code class="ruby hljs">cookbook <span class="hljs-string"><span class="hljs-string">"postgresql"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:git</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"git@github.com:express42-cookbooks/postgresql.git"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:ref</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"0.1.4"</span></span> cookbook <span class="hljs-string"><span class="hljs-string">"newrelic"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:git</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"git@github.com:heavywater/chef-newrelic.git"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:ref</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"b2309495b367da4bfe6f1761876b5d58e2455d6a"</span></span></code> </pre><br><br>  This combination of features makes it easy and convenient to always collect the same cookbooks in the cookbooks folder. <br><br>  It should be clearly understood that the current "slice" of all Kukbooks is stored in the Cheffile.lock file, and the Cheffile file is only a "hint" about how to collect Cheffile.lock, and it alone is not enough for versioning the Kukbooks.  If you do not have Cheffile.lock, then depending on what time you executed the <code>librarian-chef install</code> command, Cheffile.lock will be different for you.  Even if you explicitly record all the versions of the kukbooks used in the Cheffile (which is not strongly recommended to do), then the kukbooks that will be assembled by dependencies may differ. <br><br>  Moreover, if you explicitly indicate the versions of the books you need, updating the books will become much more difficult. <br><br>  But what if you need to update some kind of Kukbook?  For example, we learned that the lvm version of the book came out, with some changes we needed.  Then we do the following: <br><br><pre> <code class="bash hljs">$ librarian-chef update lvm</code> </pre><br><br>  This command will update the kvbuk lvm to the latest available.  Moreover, it will update all dependencies of the kvbuk lvm, if necessary.  We recommend doing <code>git diff Cheffile.lock</code> after this to make sure that exactly what you wanted has changed.  By the way, if you register in Cheffile a version for a cookbook on which lvm depends, then lvm may not be updated, and you will have to wonder for a long time why this happens. <br><br>  You can also understand this this way: Cheffile is the description of the necessary requirements for the version of the cookbooks at the current moment, and Cheffile.lock is a slice that satisfies these requirements for the current moment. <br><br>  And one more thing that should not be forgotten when working with librarian.  Each time before <code>librarian-chef install</code> recipe to a chef-server, you need to do <code>git pull</code> and <code>librarian-chef install</code> .  Because if someone has uploaded a more recent recipe, nothing will automatically change in your local cookbooks folder. <br><br>  Perhaps this approach may seem somewhat complicated, but worth it.  After all, it always guarantees the current cut of kukbuk, automatic dependency management, as well as the flexibility of using local kukbuk, kukbuk from the Opscode site and kukbuk from various git-repositories, including the github. </div><p>Source: <a href="https://habr.com/ru/post/182264/">https://habr.com/ru/post/182264/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../182248/index.html">Market Overview of IT Distribution in Ukraine: Corporate Sector</a></li>
<li><a href="../182252/index.html">Normal PHP support in ctags</a></li>
<li><a href="../182256/index.html">Russian Code Cup 2013 - analysis of tasks of the 3rd qualifying round</a></li>
<li><a href="../182260/index.html">Poll ‚ÄúHow do you minify external styles and scripts in ASP.NET?‚Äù</a></li>
<li><a href="../182262/index.html">DVRs become part of the standard equipment of police</a></li>
<li><a href="../182268/index.html">Computex 2013. Day two. ASUS, Thermaltake and ADATA</a></li>
<li><a href="../182270/index.html">Asterisk Conference - create through mail</a></li>
<li><a href="../182274/index.html">Attempt to take habrainterviyu from the former scenery</a></li>
<li><a href="../182276/index.html">7 methods of project portfolio analysis</a></li>
<li><a href="../182278/index.html">DevConf 2013 will be held on June 14 - a JavaScript section program is formed</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>