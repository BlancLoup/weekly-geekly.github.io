<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SQLAlchemy rocks!</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today I worked on my blog's modelbooks and decided to attach a comment count to Entry (this is a blog entry). I have implemented the data representati...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SQLAlchemy rocks!</h1><div class="post__text post__text-html js-mediator-article">  Today I worked on my blog's modelbooks and decided to attach a comment count to Entry (this is a blog entry).  I have implemented the data representation in the application using <a href="http://sqlalchemy.org/">SQLAlchemy</a> , let me remind you that this is the implementation of the <a href="http://www.martinfowler.com/eaaCatalog/dataMapper.html">Data Mapper</a> , in contrast to the current implementations of the data source layer, which are currently fashionable (mainly due to Django and Rails). <br><br>  I have no accumulator in the entries_table table to count comments, so I have to count count on comments every time.  But how to do it right? <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  Download on demand </h1><br><br>  The first thing that comes to mind is to make the Entry.comments_count attribute loadable on demand (lazy-loading attribute) and hang up a query on it :: <br><br> <code>SELECT COUNT(*) FROM comments_table WHERE comments_table.entry_id == &lt;ENTRY_ID&gt; <br></code> <br><br>  Everything is simple, we turn to the attribute - the request occurs, we do not appeal - it does not.  But what if the appeal happens too often, for example, as it is now done on my homepage on the blog (the number of comments to each post is indicated).  This will require n + 1 request, where n is the number of records per page.  Not very good ... <br><br><h1>  We join tables </h1><br><br>  And now the most interesting: SQLAlchemy is able to map classes not only to separate tables, but also to JOINs and even SELECTs.  That is all we need to do is compile a SQL query :: <br><br> <code>SELECT &lt;  entries_table&gt;, COUNT(comments_table.id) <br> FROM entries_table <br> LEFT OUTER JOIN comments_table <br> ON entries_table.id == comments_table.entry_id <br> GROUP BY entries_table.id <br></code> <br><br>  Here is what it looks like using the metadata description ( <a href="http://www.martinfowler.com/eaaCatalog/metadataMapping.html">Metadata mapping</a> ) SQLAlchemy :: <br><br> <code>entries_with_comments = select( <br> [ <br> entries_table, <br> func.count(comments_table.c.id).label("comments_count") <br> ], <br> from_obj=[entries_table.outerjoin(comments_table)], <br> group_by=[c for c in entries_table.c] <br> ).alias("entries_with_comments") <br></code> <br><br>  It's pretty simple.  Now map the classic Entry to this SELECT :: <br><br> <code>mapper(Entry, schema.entries_with_comments, <br> primary_key=[schema.entries_with_comments.c.id], <br> ) <br></code> <br><br>  All is ready!  Now, when getting Entry entries, we will have an attribute for each instance comments_count.  And all this for one request. <br><br>  Django.orm and Rails with their ActiveRecord nervously smoking on the sidelines;). </div><p>Source: <a href="https://habr.com/ru/post/51321/">https://habr.com/ru/post/51321/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../51305/index.html">Search engine optimization. Part 1 - internal factors</a></li>
<li><a href="../51313/index.html">Psd - trick with file size</a></li>
<li><a href="../51315/index.html">Overview of SSL certificates: types, choices, benefits.</a></li>
<li><a href="../51318/index.html">Translator</a></li>
<li><a href="../51319/index.html">Qt - translation difficulties</a></li>
<li><a href="../51322/index.html">Free replacement for powerful Alcohol, Nero and other virtual drive programs</a></li>
<li><a href="../51327/index.html">The system of separation of access rights in the web application</a></li>
<li><a href="../51328/index.html">Introduction to jabber bots</a></li>
<li><a href="../51330/index.html">Stylization of form elements. We improve one of the solutions.</a></li>
<li><a href="../51331/index.html">Problem with loading avatars in profile settings</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>