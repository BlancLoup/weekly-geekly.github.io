<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Browser history sniffing using favicon</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The method allows you to determine the websites visited by the user by querying website icons from the page. The idea of ‚Äã‚Äãthis method came to my mind...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Browser history sniffing using favicon</h1><div class="post__text post__text-html js-mediator-article">  The method allows you to determine the websites visited by the user by querying website icons from the page.  The idea of ‚Äã‚Äãthis method came to my mind when discussing the possibilities of analyzing user behavior on its website with a friend.  We discussed which metrics you need and which you do not need to collect about its visitors.  I thought it would be nice to know what other sites are used by its visitors.  The old, but known <a href="http://jeremiahgrossman.blogspot.ru/2006/08/i-know-where-youve-been.html">method</a> with CSS-styles immediately came to mind. <br><br>  That method is based on the use of the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/getComputedStyle">getComputedStyle</a> element's DOM method.  Being called from HTMLAnchorElement, it allows you to distinguish between: visited and the usual state of links to popular sites. <br><br>  The bug has long been closed and it can no longer be used. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      My method is based on the fact that the favicon.ico of the sites visited by the user will most likely be in his cache and, accordingly, load faster than those sites where he has never been.  Browsers very aggressively cache favicon.ico, which only increases the reliability of this method. <br><br>  Below is the full source code of the proof-of-concept implementation of this method.  It can be used to demonstrate that you are visiting habrahabr.ru, but have never been to hornet.com. <br><a name="habracut"></a><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> diffTreshold = <span class="hljs-number"><span class="hljs-number">200</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  ,   ,  ,    . var body = document.querySelector('body'); var testResults = []; var testCases = [ 'hornet.com', 'habrahabr.ru' ]; testCases.forEach(test); function test (host) { var start = new Date(); var img = new Image(); img.src = 'http://'+host+'/favicon.ico'; img.onload = function () { saveResult(host, start, new Date()); } body.appendChild(img); } function saveResult (host, start, end) { var diff = end - start; testResults.push({ host: host, start: start, end: end, diff: diff, visited: diff &lt;= diffTreshold }); }</span></span></code> </pre> <br><br>  This code gives not very accurate results, because it uses the diffTreshold constant, which is chosen empirically.  This variable is the number of milliseconds that have elapsed from the beginning of the download of the image to the end of it, which should be considered a hit in the browser cache. <br><br>  A more accurate method should be based on calculating the average value between the minimum and maximum image loading time, while one of the links should lead to the site icon that is non-existent in the cache.  Then, anything less than this average can be considered a cache hit and, therefore, indicate that the user was on the specified site. <br><br>  This method also has one drawback that I have not solved: after the first such test, its subsequent launches will make the results useless. <br><br>  It may seem that the very need for such a sniffing of history is dubious, but for owners of online stores or landing pages, it can be useful to show the user relevant advertising, based on knowledge of which competitor or partner sites he has already visited. <br><br>  UPD: <br>  I was surprised that this post became worthy of an invite.  Apparently, this is really a very interesting topic.  I will try to implement this method in the form of a finished library. </div><p>Source: <a href="https://habr.com/ru/post/259073/">https://habr.com/ru/post/259073/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../259057/index.html">SMS chat on my knees</a></li>
<li><a href="../259065/index.html">Digest news of the gaming industry</a></li>
<li><a href="../259067/index.html">Simple Web Service with Jetty Embedded</a></li>
<li><a href="../259069/index.html">Memory Optimization DataTable</a></li>
<li><a href="../259071/index.html">New to Wolfram SystemModeler: FMI Import</a></li>
<li><a href="../259075/index.html">Creating AUX input for Kenwood GX806EF2 radio with i2c bus grab</a></li>
<li><a href="../259077/index.html">Encryption of personal correspondence. Friday post</a></li>
<li><a href="../259081/index.html">24 hours PASS - review of the SQL conference reports</a></li>
<li><a href="../259083/index.html">Online development event for Windows 10, June 10, from industry veterans</a></li>
<li><a href="../259085/index.html">John Forbes Nash died</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>