<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>There was no sadness, updates pumped up (Arch)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Based on this post . 


 About Archlinux goes a lot of rumors, including not entirely truthful. In particular, well-established public opinion says th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>There was no sadness, updates pumped up (Arch)</h1><div class="post__text post__text-html js-mediator-article"><p>  <em>Based on <a href="https://habrahabr.ru/post/343906/">this post</a> .</em> </p><br><p>  About Archlinux goes a lot of rumors, including not entirely truthful.  In particular, well-established public opinion says that Arch often breaks during updates, as the bleeding edge.  In practice, this is one of the most enduring and maintainable systems, which can live for years without reinstalling, while updating almost every day. </p><br><p>  Sometimes, about one or two times a year, problems still arise.  Some malicious bug manages to leak into the repository, after the update the system breaks down, and you as a user can do little about it - you need to roll back. </p><br><h2 id="situaciya">  Situation </h2><br><p>  With the next update, everything breaks down <del>  to crap dog </del>  .  The level of possible problems varies from "fonts become ugly" to "network stopped working", and even "the kernel does not see disk partitions."  Many users of Archa are able to deal with this problem anyway, and in this article I will tell you how I do it. </p><a name="habracut"></a><br><h2 id="vozvrat-kontrolya-nad-sistemoy">  Return control system </h2><br><p>  For repairs, we need a console and a working network.  If there is - well.  If not, there is an easy and fast way to get them guaranteed.  Boot from the bootable USB flash drive, mount our disk partitions, read the system: </p><br><pre><code class="hljs perl">arch-<span class="hljs-keyword"><span class="hljs-keyword">chroot</span></span> /mnt</code> </pre> <br><p>  Everything, we are in the console of our system, and we have a network. <br>  <strong>And the presence of a bootable flash drive in archiver's arsenal is almost mandatory.</strong> </p><br><h2 id="algoritm-remonta">  Repair algorithm </h2><br><ol><li>  We are convinced that the problem is insoluble on its own. </li><li>  We determine the cause of the problem and the date of the problem update. </li><li>  Substitute /etc/pacman.d/mirrorlist </li><li>  <strong>Perform pacman -Syyuu</strong> </li></ol><br><p>  The system is repaired! </p><br><h3 id="kak-eto-rabotaet">  How it works </h3><br><p>  There is a special update server called <a href="https://wiki.archlinux.org/index.php/Arch_Linux_Archive">Arch Linux Archive</a> (formerly called Arch Linux Rollback Machine), which stores snapshots of all repositories for each individual date. </p><br><p>  You can select the desired date by specifying the server name in the mirrorlist file in a special way.  The easiest way is to backup the old file, create a new one and add a single line there <em>(in the example, December 1, 2017 is set)</em> </p><br><pre> <code class="hljs pgsql">## ## Arch Linux repository mirrorlist ## <span class="hljs-keyword"><span class="hljs-keyword">Generated</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-number"><span class="hljs-number">2042</span></span><span class="hljs-number"><span class="hljs-number">-01</span></span><span class="hljs-number"><span class="hljs-number">-01</span></span> ## <span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>=https://archive.archlinux.org/repos/<span class="hljs-number"><span class="hljs-number">2017</span></span>/<span class="hljs-number"><span class="hljs-number">12</span></span>/<span class="hljs-number"><span class="hljs-number">01</span></span>/$repo/os/$arch</code> </pre> <br><p>  After that, the <strong>pacman-Syyuu</strong> command <strong>will</strong> forcefully update the package database to the one that corresponds to the selected date, and forcefully reinstall all packages in the system, the versions of which do not correspond to this date. </p><br><p>  <strong>Our task is to determine the nearest date, rolling back on which the working system gives, find out which packages were updated the next day, and find out which of these packages caused a breakdown</strong> . </p><br><p>  Let's get started! </p><br><h3 id="opredelenie-nuzhnoy-daty">  Determining the desired date </h3><br><p>  If the system was updated not so long ago, you can step by step reduce the date in the mirrorlist, each time performing <strong>pacman -Syyuu</strong> and checking if the problem has disappeared.  The advantage of this approach is that it is highly likely to immediately calculate a specific package and add it to /etc/pacman.conf in the IgnorePkg line - until better times. </p><br><p>  If a month has passed since the last update, say, a month, then iteratively divide the time interval in half.  First, roll back a fortnight.  If the problem has disappeared, then we are updated a quarter of a month in advance; if not, then a quarter of a month ago.  And so on.  <strong>This method allows you to determine the exact moment of failure that occurred during the last year, in just 9 date changes.</strong> </p><br><h3 id="opredelenie-paketa-vinovnika">  Identifying the culprit package </h3><br><p>  So, let's say - we have not been updated for a week, pacman reports that there are 200 non-updated packages.  After the upgrade, the system crashes. </p><br><p>  Roll back for a day, several packages are "updated" to an earlier version.  Check - the system is still broken. </p><br><p>  Roll back for another day, a few more packages reduce the version.  The system is broken. </p><br><p>  Another day, the next three packages are "updated" and vice versa hurray, the problem has disappeared! <br>  Now we know for sure that one of these three packages is to blame.  Suppose it is <em>linux</em> , <em>linux-headers</em> and <em>gnome-shell</em> .  Since <em>linux-headers</em> pull after <em>linux</em> , we don‚Äôt take them into account, this is a dependency.  So we have only two options. </p><br><p>  Next we add the candidates in /etc/pacman.conf one by one. <br>  Let's start with the <em>linux</em> package: </p><br><pre> <code class="hljs vhdl"># Pacman won<span class="hljs-symbol"><span class="hljs-symbol">'t</span></span> upgrade packages listed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> IgnorePkg <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> members <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> IgnoreGroup IgnorePkg = linux #IgnoreGroup =</code> </pre> <br><p>  After that, we update the system through <strong>pacman -Syu</strong> and see if the problem has disappeared.  If it disappeared, it is precisely because the package-culprit is written in pacman.conf as forbidden to upgrade.  If it does not disappear, it rolls back to the working system again, enter the next candidate in IgnorePkg and repeat the cycle. </p><br><h3 id="punkt-kotoryy-dolzhen-byt-pervym">  Item which must be first </h3><br><p>  And whose, actually, is a bug?  This article is devoted to problems at the level of the entire distribution.  There is no point in rolling back to old versions of packages if the problem is not caused by their updates.  Therefore, the first thing we do is google the error in all possible ways, setting up the output only for fresh records.  If the problem is common, then with great probability you will stumble upon a fresh thread on any official distribution forum where you will find all the details - the exact date of the problem update, the name of the problem package, and even technical reasons (which actually broke under the hood). </p><br><p>  Take the example above.  Suppose we found out that our system does not boot into graphics mode after updating the <em>gnome-shell</em> package to version 3.26.2 </p><br><p>  What to do next? </p><br><p>  First we make the system work - we roll back to the date a day before the harmful update and add the <em>gnome-shell</em> to IgnorePkg (alternatively, add the whole <em>gnome</em> group to the IgnoreGroup so that the gnome is not partially updated). </p><br><p>  Next, <a href="http://goo.gl/MPPUYX">we are trying to</a> find the answer to the question in Google - "is this my personal problem or do others have it, too?"  If there is no such problem on the Internet, it may be a sign that the bug is too fresh.  We are waiting for confidence for several days, sometimes repeating search queries in different combinations.  If the problem is that the problem package really climbed into the repository - <em>it will definitely come out on the Internet</em> !  Archa has a huge user base, and people will write bug reports and ask questions on the forums. </p><br><p>  If within a few days you do not see any mention of the problem, I have bad news for you.  With a probability close to 100%, you broke the system yourself.  Remember your actions, analyze logs, understand what happened.  In general, such a case (when some kind of update leads to a breakdown, but this is not a bug) is typical of situations that are always covered in the news in the heading "when updating, manual intervention is required."  This happens when the next update introduces such a major change to the system that the means of the update itself cannot be correctly implemented. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/344000/">https://habr.com/ru/post/344000/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../343984/index.html">What you need to know about chat bots?</a></li>
<li><a href="../343988/index.html">Dart: how to start acquaintance with the language?</a></li>
<li><a href="../343992/index.html">Report from mitapa Autumn Postgres in Raiffeisenbank</a></li>
<li><a href="../343994/index.html">How we decided to introduce Tomato in the company</a></li>
<li><a href="../343996/index.html">Case: Smart Search mobile browser promotion through Vlogera</a></li>
<li><a href="../344002/index.html">METRO IS</a></li>
<li><a href="../344004/index.html">Sean Barrett: How I Got into the Video Game Industry</a></li>
<li><a href="../344006/index.html">8 educational projects</a></li>
<li><a href="../344008/index.html">Convolution network in python. Part 1. Determination of the basic parameters of the model</a></li>
<li><a href="../344010/index.html">The beginning of a new era of cryptocurrency? CME Group exchanges issue bitcoin futures</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>