<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Side effect: we check Firebird with PVS-Studio</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Now we are busy with a big task. We want to compare four code analyzers: Cppcheck, PVS-Studio and Visual Studio 2013 (built-in code analyzer). For thi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Side effect: we check Firebird with PVS-Studio</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/cc0/e8b/bdb/cc0e8bbdb7c4dcd2357dd6a3cc5d4e04.png" alt="Firebird and PVS-Studio" align="left"><br>  Now we are busy with a big task.  We want to compare four code analyzers: Cppcheck, PVS-Studio and Visual Studio 2013 (built-in code analyzer).  For this, we decided to check at least 10 open projects and analyze the reports that the analyzers will issue.  This is a very time consuming task and until it is completed.  But since a number of projects have already been verified, then you can write articles about some of them.  What I'm going to do now.  First of all, I will describe what was interesting to find with PVS-Studio in Firebird. <br><a name="habracut"></a><br><h2>  Firebird </h2><br>  Firebird (FirebirdSQL) is a compact, cross-platform, free database management system (DBMS) running on Linux, Microsoft Windows and various Unix platforms. <br><br>  Website: <a href="http://www.firebirdsql.org/">http://www.firebirdsql.org/</a> <br><br>  Wikipedia description: <a href="http://www.viva64.com/go.php%3Furl%3D1348">Firebird</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's see what interesting can be found in the code of this project, using <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> . <br><br><h2>  Uninitialized variables </h2><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> UCHAR* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> UCHAR* sdl, sdl_arg* arg)</span></span></span><span class="hljs-function"> </span></span>{ SLONG n, count, variable, value, sdl_operator; .... <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (op) { .... <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> isc_sdl_add: sdl_operator = op_add; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> isc_sdl_subtract: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!sdl_operator) sdl_operator = op_subtract; ...... }</code> </pre> <br>  V614 Uninitialized variable 'sdl_operator' used.  sdl.cpp 404 <br><br>  It seems to me that the 'break' operator between "case isc_sdl_add:" and "case isc_sdl_subtract:" is missing on purpose.  It does not take into account the case when we immediately fall into the "case isc_sdl_subtract:".  If this happens, the 'sdl_operator' variable will not yet be initialized. <br><br>  Another similar situation.  The variable 'fieldNode' may remain uninitialized if "field == false". <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> blb::move(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> FieldNode* fieldNode; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (field) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((fieldNode = ExprNode::as&lt;FieldNode&gt;(field))) .... } .... <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> USHORT id = fieldNode-&gt;fieldId; .... }</code> </pre> <br>  V614 Potentially uninitialized pointer 'fieldNode' used.  blb.cpp 1043 <br><br>  That is why it is bad in a function to give the same name to different variables: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">realign</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (....) { UCHAR* p = buffer + field-&gt;fld_offset; .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> burp_fld* field = relation-&gt;rel_fields; field; field = field-&gt;fld_next) { .... UCHAR* p = buffer + FB_ALIGN(p - buffer, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(SSHORT)); ........ }</code> </pre> <br>  V573 Uninitialized variable 'p' was used.  The variable was used to initialize itself.  restore.cpp 17535 <br><br>  When initializing the second variable 'p', we wanted to use the value of the first variable 'p'.  And it turned out that the second, still uninitialized variable is used. <br><br>  For the authors of the project.  See also here: restore.cpp 17536 <br><br><h2>  Dangerous string comparison (vulnerability) </h2><br>  Please note that the result of the memcmp () function is placed in a variable of the 'SSHORT' type.  'SSHORT' is nothing more than a synonym for the type of 'short'. <br><pre> <code class="cpp hljs">SSHORT TextType::compare( ULONG len1, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> UCHAR* str1, ULONG len2, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> UCHAR* str2) { .... SSHORT cmp = <span class="hljs-built_in"><span class="hljs-built_in">memcmp</span></span>(str1, str2, MIN(len1, len2)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cmp == <span class="hljs-number"><span class="hljs-number">0</span></span>) cmp = (len1 &lt; len2 ? <span class="hljs-number"><span class="hljs-number">-1</span></span> : (len1 &gt; len2 ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cmp; }</code> </pre> <br>  V642 Saving the 'memcmp' function result inside the 'short' type variable is inappropriate.  Breaking the program's logic.  texttype.cpp 338 <br><br>  Do you wonder what is wrong here? <br><br>  Let's remember that the memcmp () function returns a value of type 'int'.  But the result is placed in a variable of type 'short'.  Loss of high bit values ‚Äã‚Äãoccurs.  Is it dangerous! <br><br>  The function returns the following values: less than zero, zero, or greater than zero.  By "greater than zero" can be meant anything.  This can be 1, 2 or 19472341. You cannot save the result of the memcmp () function into a variable that is smaller than the size of the 'int' type. <br><br>  The problem may seem far-fetched.  But this is the real problem of vulnerability.  This vulnerability was recognized as a similar error in the MySQL code: <a href="http://www.viva64.com/go.php%3Furl%3D1004">Security vulnerability in MySQL / MariaDB sql / password.c</a> .  There the result was placed in a variable of the type 'char'.  The 'short' type is not much better in terms of security. <br><br>  Similar dangerous comparisons can be found here: <ul><li>  cvt2.cpp 256 </li><li>  cvt2.cpp 522 </li></ul><br><h2>  Typos </h2><br>  Typos are everywhere and always.  As a rule, most of them are quickly in the process of testing.  But still, you can find typos in almost any project. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Parser::parseAux() { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (yyps-&gt;errflag != yyps-&gt;errflag) <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> yyerrlab; .... }</code> </pre> <br>  V501 There are identical sub-expressions to the left and the right! ‚Äù= 'Operator: yyps-&gt; errflag! = Yyps-&gt; errflag parse.cpp 23523 <br><br>  I think comments are not needed.  And here, probably, was used Copy-Paste: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CMP_node_match</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> qli_nod* node1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> qli_nod* node2)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (node1-&gt;nod_desc.dsc_dtype != node2-&gt;nod_desc.dsc_dtype || node2-&gt;nod_desc.dsc_scale != node2-&gt;nod_desc.dsc_scale || node2-&gt;nod_desc.dsc_length != node2-&gt;nod_desc.dsc_length) .... }</code> </pre> <br>  V501 There are identical sub-expressions "node2-&gt; nod_desc.dsc_scale"!  compile.cpp 156 <br><br>  V501 There are identical sub-expressions "node2-&gt; nod_desc.dsc_length"!  compile.cpp 157 <br><br>  It turns out that in the CMP_node_match () function the members of the class 'nod_desc.dsc_scale' and 'nod_desc.dsc_length' are incorrectly compared. <br><br>  Another typo authors of the project can see here: compile.cpp 183 <br><br><h2>  Strange cycles </h2><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> processing_state </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add_row</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TEXT* tabname)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> i = n_cols; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (--i &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (colnumber[i] == ~<span class="hljs-number"><span class="hljs-number">0u</span></span>) { bldr-&gt;remove(fbStatus, i); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ISQL_errmsg(fbStatus)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (SKIP); } } msg.assignRefNoIncr(bldr-&gt;getMetadata(fbStatus)); .... }</code> </pre> <br>  V547 Expression '- i&gt; = 0' is always true.  Unsigned type value is always&gt; = 0. isql.cpp 3421 <br><br>  The variable 'i' is of type 'unsigned'.  This means that the variable 'i' is always greater than or equal to 0. As a result, the condition (--i&gt; = 0) does not make sense.  It is always true. <br><br>  On the contrary, this cycle will end earlier than necessary: <br><pre> <code class="cpp hljs">SLONG LockManager::queryData(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> srq* lock_srq = (SRQ) SRQ_ABS_PTR(data_header.srq_backward); lock_srq != &amp;data_header; lock_srq = (SRQ) SRQ_ABS_PTR(lock_srq-&gt;srq_backward)) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> lbl* <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> lock = ....; CHECK(lock-&gt;lbl_series == series); data = lock-&gt;lbl_data; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } .... }</code> </pre> <br>  What is this suspicious 'break'? <br><br>  Another similar situation here: pag.cpp 217 <br><br><h2>  Classic </h2><br>  As always, there are a lot of classic flaws associated with pointers.  At the beginning, the pointer is dereferenced, and then checked for equality to zero.  This may not always lead to an error, but this is a bad and dangerous code.  I will show only one example.  The remaining places will list in a separate list. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CCH_down_grade_dbb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">* ast_object)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-function"><span class="hljs-function">SyncLockGuard </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bcbSync</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( &amp;bcb-&gt;bcb_syncObject, SYNC_EXCLUSIVE, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"CCH_down_grade_dbb"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; bcb-&gt;bcb_flags &amp;= ~BCB_exclusive; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bcb &amp;&amp; bcb-&gt;bcb_count) .... }</code> </pre> <br>  V595 'bcb ‚Äô  Check lines: 271, 274. cch.cpp 271 <br><br>  In the beginning, the 'bcb' pointer is dereferenced in the expression "bcb-&gt; bcb_flags &amp; = ....".  The following test shows that 'bcb' may be zero. <br><br>  List of such places (31 warnings): <a href="http://www.viva64.com/external-pictures/txt/firebird-V595.txt">firebird-V595.txt</a> <br><br><h2>  Shift operators </h2><br>  Since Firebird is going to be built by different compilers for different platforms, then it is worth correcting the changes that lead to undefined behavior.  They may well prove themselves over time in a negative way. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ULONG END_BUCKET = (~<span class="hljs-number"><span class="hljs-number">0</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br>  V610 Undefined behavior.  Check the shift operator '&lt;&lt;.  The left operand '(~ 0)' is negative.  ods.h 337 <br><br>  You can not move negative numbers.  More: " <a href="http://www.viva64.com/ru/b/0142/">Without knowing the ford, do not climb into the water. Part three</a> ." <br><br>  Here it is better to do this: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ULONG END_BUCKET = (~<span class="hljs-number"><span class="hljs-number">0u</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br>  And two more bad shifts: <ul><li>  exprnodes.cpp 6185 </li><li>  array.cpp 845 </li></ul><br><h2>  Senseless checks </h2><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> processing_state </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add_row</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TEXT* tabname)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> varLength, scale; .... scale = msg-&gt;getScale(fbStatus, i); .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (scale &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) .... }</code> </pre> <br>  V547 Expression 'scale &lt;0' is always false.  Unsigned type value is never &lt;0. isql.cpp 3716 <br><br>  The variable 'scale' is of type 'unsigned'.  A comparison (scale &lt;0) does not make sense. <br><br>  Similarly: isql.cpp 4437 <br><br>  Let's look at another function: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_switches</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> .... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(**argv != </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'n'</span></span></span></span><span class="hljs-function"><span class="hljs-params"> || **argv != </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'N'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">fprintf</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">stderr</span></span>, <span class="hljs-string"><span class="hljs-string">"-sqlda : "</span></span> <span class="hljs-string"><span class="hljs-string">"Deprecated Feature: you must use XSQLDA\n "</span></span>); print_switches(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } .... }</code> </pre> <br>  Command line arguments are incorrectly processed.  The condition (** argv! = 'N' || ** argv! = 'N') is always satisfied. <br><br><h2>  miscellanea </h2><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> FB_CARG Why::UtlInterface::getPerfCounters( ...., ISC_INT64* counters) { <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> n = <span class="hljs-number"><span class="hljs-number">0</span></span>; .... <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(counters, <span class="hljs-number"><span class="hljs-number">0</span></span>, n * <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(ISC_INT64)); .... }</code> </pre> <br>  V575 The 'memset' function processes '0' elements.  Inspect the third argument.  perf.cpp 487 <br><br>  It seems that the variable 'n' in the body of the function forgot to assign a value other than zero. <br><br>  The convert () function takes the length of the string as the third argument: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">ULONG </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ULONG srcLen, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> UCHAR* src, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ULONG dstLen, UCHAR* dst, ULONG* badInputPos = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">NULL</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ignoreTrailingSpaces = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>;</code> </pre> <br>  However, the function is used incorrectly: <br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">string</span></span> IntlUtil::escapeAttribute(....) { .... ULONG l; UCHAR* uc = (UCHAR*)(&amp;l); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ULONG uSize = cs-&gt;getConvToUnicode().convert(size, p, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(uc), uc); .... }</code> </pre> <br>  V579  It is possibly a mistake.  Inspect the third argument.  intlutil.cpp 668 <br><br>  We are dealing with a <a href="http://www.viva64.com/ru/t/0002/">64-bit error</a> that will manifest itself in Win64. <br><br>  The expression 'sizeof (uc)' returns the size of the pointer, not the size of the buffer.  This is not a problem if the size of the pointer coincides with the size of a variable of type 'unsigned long'.  The pointer size is the same as the 'long' size if we are programming for Linux.  There will be no problems in Win32. <br><br>  The error occurs when we compile the application for Win64.  The convert () function will think that the buffer size is 8 bytes (pointer size).  Actually, the buffer size is 4 bytes. <br><br>  Note.  Perhaps there are other 64-bit errors in the program.  But I have not studied the appropriate diagnostics.  It's boring to write about them and without knowing the program it is difficult to understand whether there will be an error or not.  The described 64-bit problem was found indirectly when studying general-purpose warnings. <br><br><h2>  Conclusion </h2><br>  The reader is probably interested to know what was found in this project using Cppcheck and VS2013.  Yes, these analyzers have found something that PVS-Studio failed.  But quite a bit.  PVS-Studio has shown itself to be the leader on this project.  More information can be found in the comparison article, which we will begin to write soon. </div><p>Source: <a href="https://habr.com/ru/post/213423/">https://habr.com/ru/post/213423/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../213411/index.html">Unpacking, editing and packaging of DVR firmware and IP cameras from Xiong Mai</a></li>
<li><a href="../213413/index.html">The trouble with web security or the most secure bank of America</a></li>
<li><a href="../213415/index.html">Google Maps v2 for Android: Pop-up window with full redraw and input event support</a></li>
<li><a href="../213417/index.html">Smart video player or just gesture recognition</a></li>
<li><a href="../213419/index.html">How Dropbox helped get a stolen phone back (detective)</a></li>
<li><a href="../213425/index.html">Remote service block multifunction BDS-M</a></li>
<li><a href="../213427/index.html">Payler launched a new site</a></li>
<li><a href="../213429/index.html">Corporate portals and e-commerce: What to do?</a></li>
<li><a href="../213433/index.html">American scientists have created artificial muscle fibers from ordinary fishing line</a></li>
<li><a href="../213437/index.html">WiDi talks and shows. Telebreeze experience</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>