<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Web components: review and use in production</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! I use web components in frontend development. In this article I will describe all the features of the web components, as well as how they can b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Web components: review and use in production</h1><div class="post__text post__text-html js-mediator-article"><p>  Hello!  I use web components in frontend development.  In this article I will describe all the features of the web components, as well as how they can be used today, taking into account not yet high support. </p><br><p>  Briefly about web components: this is a set of technologies that allow you to use the component approach with encapsulating styles and scripts on the web natively, without connecting any libraries or fireworks.  If you're wondering what the standards offer instead of the usual already React or Angular, and how to use it when developing for old browsers, I ask for cat. </p><br><p><img src="https://habrastorage.org/webt/tu/ey/gt/tueygtwxjcmcjfelgeozsvrlwcg.png"></p><a name="habracut"></a><br><p>  The list of materials for detailed study is at the end of the article. </p><br><p>  Content: </p><br><ul><li>  <a href="https://habr.com/ru/post/346670/">Introduction</a> </li><li>  <a href="https://habr.com/ru/post/346670/">Theory</a> </li><li>  <a href="https://habr.com/ru/post/346670/">Practice</a> </li><li>  <a href="https://habr.com/ru/post/346670/">findings</a> </li><li>  <a href="https://habr.com/ru/post/346670/">Resources</a> </li></ul><br><h1 id="vstuplenie">  Introduction </h1><br><p>  I work as a front-end developer of services in one of the major international campaigns and currently rewriting the project frontend a second time. </p><br><p>  In the first version, written according to the canons of 1C-Bitrix, meat from scripts and styles in a variety of templates awaited me.  The scripts, of course, were on jQuery, and the styles, of course, were absolutely chaotic, without any structure or order.  In connection with the move to a new platform, there was a chance to completely rewrite the project.  To restore order, we developed our own component system using the BEM methodology.  For each instance of the BEM block in the markup, after loading the page, one object of the corresponding class is created, which begins to control the logic.  Thus, everything is rather strictly systematized - the blocks (logic and styles) are reusable and isolated from each other. </p><br><p>  After a year of support and refinement of the project revealed a number of shortcomings of such a system.  The markup, on the basis of which my pseudo-components work, is kept on attentiveness and the developer's ‚Äúhonest word‚Äù: JS hopes that the layout designer has correctly placed all the necessary elements and prescribed classes for them.  If a component modifies its DOM, which contains other BEM blocks, or the markup is loaded via ajax, the components of this markup must be initialized manually.  It all seemed simple with daily work until a second person appeared on the project.  The documentation, unfortunately, although it was quite voluminous, but covered only the basic principles (the volume in this case was a minus).  In life, the step to the left or the step to the right broke the established "principles", and reading the finished components only made confusion, since they were written in different ways and at different times. </p><br><p>  All this, as well as a potential increase in the number of problems in the development of the planned transition to SPA / PWA, pushed for the next processing of the front.  Bicycles, which, in particular, is my component system, are very useful during learning something (in my case - JS), but in a quality project with several developers something more reliable and structured is needed.  Currently (however, long ago) we have a lot of frameworks on the web, among which there is something to choose: Preact offers a small size and maximum similarity in development with React I already know, Angular beckons with built-in lovely TypeScript, Vue looks because of the angle and boasts of its simplicity, and much more.  Stand alone stands out: it turns out, you can write reusable web components, with wired logic and styles that will not have to be artificially (due to BEM and additional JS-a) to be associated with the already written markup.  And all this should work out of the box.  Miracle, is not it? </p><br><p>  Because of my wild love for standards and faith in a bright future, as well as the similarity of the existing system of components with web components (one JS class per one ‚Äúcomponent‚Äù with isolated logic), it was decided to try to use web components.  Most strained support for this business in browsers: web components are too young to cover a wide range of browsers, and even more so to cover browsers that need to be supported by a commercial product (for example, Android 4.4 stock browser and Internet Explorer 11).  Mentally, some level of pain and limitations that I could expect and a framework in which I agree to fit into the development was adopted, and I immersed myself in learning theories and practical experiments: how to write the front on web components and roll it out into production so that it worked. </p><br><p>  The necessary theoretical minimum for reading the article: pure JavaScript at the level of basic manipulations with the DOM tree, understanding the syntax of classes in ES2015, plus familiarity with any of the frameworks from the category of React.js / Angular / Vue.js. </p><br><h1 id="teoriya">  Theory </h1><br><h2 id="obzor">  Overview </h2><br><p>  Web components are a collection of standards that allow you to make declaratively described, reusable ‚Äúwidgets‚Äù with isolated styles and scripts in the form of your own tags.  Standards evolve independently, and are connected into web components quite arbitrarily - in principle, you can use each of the technologies used separately.  But together they are as effective as possible. </p><br><p>  Usually, all four standards ‚Äî Custom Elements, Shadow DOM, Templates (HTML Templates), and HTML Imports ‚Äî are treated separately, and then merged together.  Since individually they are weakly useful, we will consider all the possibilities of standards cumulatively, adding them to the already studied earlier. </p><br><p> It is worth recalling that web components are a rather young technology, and standards have undergone many changes.  For us, this is mainly expressed in several versions of the Custom Elements and Shadow DOM standards - <code>v0</code> and <code>v1</code> .  <code>v0</code> is not currently relevant.  We will only consider <code>v1</code> .  Be careful when searching for additional materials!  Versions <code>v1</code> formed only in 2016, which means that all articles and videos until 2016 are guaranteed to speak about the old version of the specification. </p><br><h2 id="polzovatelskie-elementy-custom-elements">  Custom Elements </h2><br><p>  Custom elements are the ability to create new HTML tags with arbitrary names and behavior, for example, <code>&lt;youtube-player src=""&gt;&lt;/youtube-player&gt;</code> or <code>&lt;yandex-map lat="34.86974" lon="-111.76099" zoom="7"&gt;&lt;/yandex-map&gt;</code> . </p><br><h3 id="registraciya-polzovatelskogo-elementa">  Register a custom item </h3><br><p>  Of course, we can ‚Äúcreate‚Äù our own tags (for example, browsers will correctly handle the <code>&lt;noname&gt;&lt;/noname&gt;</code> ), but in the DOM tree, the element is registered as an object of the <code>HTMLUnknownElement</code> class and has no default behavior.  "Revive" each such element will have to manually. </p><br><p>  The specification of custom elements allows you to register new tags and set their behavior in accordance with the life cycle - creating, inserting into the DOM, changing attributes, deleting from the DOM.  In order to prevent possible conflict of new HTML standard tags and custom tags, the names of the latter must contain at least one hyphen - for example, <code>&lt;custom-tag&gt;&lt;/custom-tag&gt;</code> or <code>&lt;my-awesome-tag&gt;&lt;/my-awesome-tag&gt;</code> .  Also, custom tags currently cannot be self-closing, even tags without content must be paired. </p><br><p>  Since the best way of training is practice, we will write an element that is similar in functionality to the <a href="https://codepen.io/anon/pen/eyjpJg"><code>&lt;summary&gt;</code></a> element.  Let's call it <code>&lt;x-spoiler&gt;</code> . </p><br><p>  When you add such an element to a DOM tree, it will also become an object of the <code>HTMLUnknownElement</code> class.  In order to register an item as custom, and add its <code>customElements</code> behavior to it, you need to use the <code>define</code> method of the global <code>customElements</code> object.  The first argument is the name of the tag, the second is the class that describes the behavior.  The class should extend the class <code>HTMLElement</code> so that our element has all the qualities and capabilities of other HTML elements.  Total: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XSpoiler</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTMLElement</span></span></span><span class="hljs-class"> </span></span>{} customElements.define(<span class="hljs-string"><span class="hljs-string">"x-spoiler"</span></span>, XSpoiler);</code> </pre> <br><p>  After that, the browser will recreate all the <code>x-spoiler</code> tags in the markup as objects of the <code>XSpoiler</code> class, and not <code>HTMLUnknownElement</code> .  All new <code>x-spoiler</code> tags that are added to the document via <code>innerHTML</code> , <code>insertAdjacentHTML</code> , <code>append</code> or other methods for working with HTML are immediately created based on the <code>XSpoiler</code> class.  You can also create such DOM elements through <code>document.createElement</code> . </p><br><p>  If you try to register an item with an already registered name or based on an already registered class, we will get an exception. </p><br><p>  The tag name and class name do not have to be the same.  Therefore, we can, if necessary, register two custom elements with the same class name under different tags. </p><br><p>  Now the user element is, of course, registered, but it does nothing useful.  To really liven up our custom item, consider its life cycle. </p><br><h3 id="zhiznennyy-cikl-polzovatelskogo-elementa">  The life cycle of a custom item </h3><br><p>  We can add callback methods to create an element, add it to the DOM, change attributes, delete an element from the DOM, and change the parent document.  We will use this to implement the spoiler logic: the component will contain a button with the text ‚ÄúCollapse‚Äù / ‚ÄúExpand‚Äù and a section with the original contents of the tag.  Section visibility will be controlled by clicking on the button or attribute value.  Button text can also be customized via attributes. </p><br><p>  The callback for creating an element is the class constructor.  To make it work correctly, you must first call the parent constructor via <code>super</code> .  In the constructor, you can set the markup, hang event handlers, do some other preparatory work.  In the constructor, as in other methods, <code>this</code> will refer to the DOM element itself, and due to the fact that our custom element extends the <code>HTMLElement</code> , <code>this</code> has methods such as <code>querySelector</code> and properties such as <code>classList</code> . </p><br><p>  Add values ‚Äã‚Äãfor the button texts in the constructor, markup of the component and attach the handler to the click on the button, which will change the presence of the <code>opened</code> attribute. </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XSpoiler</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTMLElement</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.text = { <span class="hljs-string"><span class="hljs-string">"when-close"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"when-open"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.innerHTML = <span class="hljs-string"><span class="hljs-string">` &lt;button type="button"&gt;</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.text[</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">"when-close"</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">&lt;/button&gt; &lt;section style="display: none;"&gt;</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.innerHTML}</span></span></span><span class="hljs-string">&lt;/section&gt; `</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">"button"</span></span>).addEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> opened = (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getAttribute(<span class="hljs-string"><span class="hljs-string">"opened"</span></span>) !== <span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (opened) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.removeAttribute(<span class="hljs-string"><span class="hljs-string">"opened"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setAttribute(<span class="hljs-string"><span class="hljs-string">"opened"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); } }); } }</code> </pre> <br><p>  Let us analyze in detail each part of the constructor. </p><br><p>  <code>super()</code> calls the constructor of the class <code>HTMLElement</code> .  This is in this case a mandatory action if we need an element constructor. </p><br><p>  <code>this.text</code> - since <code>this</code> is an object, we can add our own properties.  In this case, I will store in the <code>text</code> object auxiliary texts that are displayed on the button. </p><br><p>  <code>this.innerHTML</code> set the markup of our DOM element.  In this case, we use the text specified slightly above. </p><br><p>  <code>this.querySelector("button").addEventListener</code> will add a <code>click</code> event handler that sets or removes the <code>opened</code> attribute.  We will work with it as a logical value - the spoiler is either open or closed, therefore, the attribute is either there or not.  In the handler, we will check the presence of the attribute through comparison with <code>null</code> , and then either set or delete the attribute. </p><br><p>  Now when you click on the created button, the <code>opened</code> attribute will change.  So far, changing the attribute does nothing.  Before turning to this topic, we modify the code a bit. </p><br><p>  Remember that the <code>&lt;button&gt;</code> has a <code>disabled</code> attribute that disables the button?  If we write it in the markup, the button will cease to be active; if we delete it, it will again become clickable.  We can work with an attribute from JavaScript code using <code>getAttribute</code> , <code>setAttribute</code> and <code>removeAttribute</code> methods.  But this is not very convenient, we need three methods for working with attributes, they are long, and, moreover, they work only with strings (the attribute value is always a string).  Therefore, in the DOM-elements is often used "reflection" of attributes in the same properties.  So, the <code>button.disabled</code> property returns the presence or absence of an attribute.  Now compare the two approaches, through direct work with attributes and through properties: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   : // : const isDisabled = button.getAttribute("disabled") !== null; // : const isDisabled = button.disabled; //  : // : button.setAttribute("disabled", ""); // : button.disabled = true; //  : // : button.removeAttribute("disabled"); // : button.disabled = false; //    : // : if (button.getAttribute("disabled") !== null) { button.removeAttribute("disabled"); } else { button.setAttribute("disabled", ""); } // : button.disabled = !button.disabled;</span></span></code> </pre> <br><p>  Agree, work through the properties is much more convenient?  We implement the same mechanism with our attribute <code>opened</code> , so that its value can be easily obtained and installed.  To do this, we use the possibility of getters and setters of properties in classes: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XSpoiler</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTMLElement</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.text = { <span class="hljs-string"><span class="hljs-string">"when-close"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"when-open"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.innerHTML = <span class="hljs-string"><span class="hljs-string">` &lt;button type="button"&gt;</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.text[</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">"when-close"</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">&lt;/button&gt; &lt;section style="display: none;"&gt;</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.innerHTML}</span></span></span><span class="hljs-string">&lt;/section&gt; `</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">"button"</span></span>).addEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.opened = !<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.opened; }); } get opened() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getAttribute(<span class="hljs-string"><span class="hljs-string">"opened"</span></span>) !== <span class="hljs-literal"><span class="hljs-literal">null</span></span>); } set opened(state) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!!state) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setAttribute(<span class="hljs-string"><span class="hljs-string">"opened"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.removeAttribute(<span class="hljs-string"><span class="hljs-string">"opened"</span></span>); } } }</code> </pre> <br><p>  For string properties (as for embedded <code>id</code> on any elements and <code>href</code> on links), the getter and setter will look a bit simpler, but the idea is preserved. </p><br><p>  You can also add that such a "reflection" may not always be useful in terms of performance.  For example, the <code>value</code> attribute works differently for form elements. </p><br><p>  Now we have an attribute, it can change its value when a button is clicked, but no more useful action occurs.  We could add useful code to hide and display the element directly in the click handler, but then it would be very problematic to change the element's visibility, for example, with another, external JS code. </p><br><p>  Instead, you can attach a handler to change the value of the attributes using the <code>attributeChangedCallback</code> method.  It will be called each time the attribute is changed, so it will be possible to control the component through the attributes both from the inside and the outside. </p><br><p>  The method applies three parameters: attribute name, old value, new value.  Since calling this method to change absolutely ALL attributes would be irrational from the point of view of performance, it only works when the properties that are listed in the <code>observedAttributes</code> static class of the current class are changed. </p><br><p>  Our component should respond to the change of three attributes - <code>opened</code> , <code>text-when-open</code> and <code>text-when-close</code> .  The first will affect the display of the spoiler, and the other two will control the button text.  First of all, add the names of these attributes to our class in the <code>observedAttributes</code> static array: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> get observedAttributes() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">"opened"</span></span>, <span class="hljs-string"><span class="hljs-string">"text-when-open"</span></span>, <span class="hljs-string"><span class="hljs-string">"text-when-close"</span></span>, ] }</code> </pre> <br><p>  Now we add the <code>attributeChangedCallback</code> method itself, which, depending on the attribute that was changed, will either change the visibility of the content and display the button text, or change the button text and display it if necessary.  To do this, use the <code>switch</code> on the first argument of the method. </p><br><pre> <code class="javascript hljs">attributeChangedCallback(attrName, oldVal, newVal) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (attrName) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"opened"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> opened = newVal !== <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> button = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">"button"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> content = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">"section"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> display = opened ? <span class="hljs-string"><span class="hljs-string">"block"</span></span> : <span class="hljs-string"><span class="hljs-string">"none"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> text = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.text[opened ? <span class="hljs-string"><span class="hljs-string">"when-open"</span></span> : <span class="hljs-string"><span class="hljs-string">"when-close"</span></span>]; content.style.display = display; button.textContent = text; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"text-when-open"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.text[<span class="hljs-string"><span class="hljs-string">"when-open"</span></span>] = newVal; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.opened) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">"button"</span></span>).textContent = newVal; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"text-when-close"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.text[<span class="hljs-string"><span class="hljs-string">"when-close"</span></span>] = newVal; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.opened) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">"button"</span></span>).textContent = newVal; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre> <br><p>  Notice that the <code>attributeChangedCallback</code> method works even when the required attributes are initially present on the element.  That is, if our component is inserted into the markup immediately with the <code>opened</code> attribute, the spoiler will indeed be opened, since  <code>attributeChangedCallback</code> will work immediately after the <code>constructor</code> .  Therefore, no additional work on processing the initial value of the attributes in the constructor is necessary (unless, of course, the attribute is traceable). </p><br><p>  Now our component really works!  When a button is clicked, the value of the <code>opened</code> attribute changes, then the <code>attributeChangedCallback</code> callback is activated, which in turn controls the visibility of the content.  State management is through attributes and <code>attributeChangedCallback</code> allows you to control the initial state (we can add <code>opened</code> to the markup immediately if we want to show an open spoiler) or control the state from the outside (any other JS code can set or remove an attribute from our element and it will be processed correctly) .  As a bonus, we can customize the text of the control button.  <em>View</em> <a href="https://codepen.io/dartess/embed/rpwWoe/%3Fheight%3D265%26amp%3Btheme-id%3D0%26amp%3Bdefault-tab%3Djs,result%26amp%3Bembed-version%3D2">demo result</a> <em>in fresh Chrome</em> ! </p><br><p>  The main functionality is ready; these are the most frequently used features of user elements.  Now consider those callbacks that are used less frequently. </p><br><p>  When the element is inserted into the DOM tree, the <code>connectedCallback</code> method is triggered.  If the element was already in the markup at the time of registration, or it is created by inserting an HTML line, the <code>constructor</code> will work sequentially, if necessary, <code>attributeChangedCallback</code> , and then <code>connectedCallback</code> .  This callback can be used if, for example, you need to know the information about the parent in the DOM tree, or we want to optimize our component and put off some kind of heavy code just before the element is used.  However, there are two things to remember: first, if the <code>constructor</code> triggered once for one element, then <code>connectedCallback</code> triggered every time an element is inserted into the DOM, and second, <code>attributeChangedCallback</code> can trigger before <code>connectedCallback</code> , so if you postpone the creation of markup from constructor to <code>connectedCallback</code> , this can lead to an error.  The method can be used to assign event handlers or for other heavy operations, such as connecting to a server. </p><br><p>  In the same way that you can track the insertion of an element in the DOM, you can track and delete.  The <code>disconnectedCallback</code> method is responsible for this.  It works, for example, when an element is removed from the DOM using the <code>remove()</code> method.  Note: if an element is removed from the DOM tree, but you have a link to the element, it can again be inserted into the DOM, and the <code>connectedCallback</code> will re-activate.  When deleting, you can, for example, stop updating the data in the component, delete the timers, delete event handlers assigned to <code>connectedCallback</code> , or close the connection to the server.  Please note that <code>disconnectedCallback</code> does not guarantee the execution of its code - for example, when a user closes a page, the method will not be called. </p><br><p>  The most rarely used callback is the <code>adoptedCallback</code> method.  It is triggered when the element changes the property <code>ownerDocument</code> .  This happens, for example, if you create a new window and move an element into it. </p><br><h3 id="vzaimodeystvie-s-polzovatelskim-elementom">  User Element Interaction </h3><br><p>  The component, as we already understood, is controlled by the value of the attributes directly or through properties.  But in order to transfer data from a component to the outside, you can use <code>CustomEvents</code> .  In the case of our component, it will be rational to add a state change event so that it can be listened to and responded.  To do this, add the <code>events</code> property with two <code>CustomEvent</code> objects in the <code>CustomEvent</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.events = { <span class="hljs-string"><span class="hljs-string">"close"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomEvent(<span class="hljs-string"><span class="hljs-string">"x-spoiler.changed"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">bubbles</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">detail</span></span>: {<span class="hljs-attr"><span class="hljs-attr">opened</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>}, }), <span class="hljs-string"><span class="hljs-string">"open"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomEvent(<span class="hljs-string"><span class="hljs-string">"x-spoiler.changed"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">bubbles</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">detail</span></span>: {<span class="hljs-attr"><span class="hljs-attr">opened</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}, }), };</code> </pre> <br><p>  We also edit <code>attributeChangedCallback</code> so that when a <code>opened</code> sent an event: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dispatchEvent(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.events[opened ? <span class="hljs-string"><span class="hljs-string">"open"</span></span> : <span class="hljs-string"><span class="hljs-string">"close"</span></span>]);</code> </pre> <br><p>  Now we can listen to events of interest to us in order to learn about the changing state of the spoiler. </p><br><p>  New <a href="https://codepen.io/dartess/embed/qpjxmN/%3Fheight%3D265%26amp%3Btheme-id%3D0%26amp%3Bdefault-tab%3Djs,result%26amp%3Bembed-version%3D2">demo</a> . </p><br><h3 id="eschyo-nemnogo-o-customelements">  More about customElements </h3><br><p>  When registering an item, we used the <code>define</code> method of the global <code>customElements</code> object.  In addition, he has two more useful methods. </p><br><p>  <code>customElements.get(name)</code> will return the constructor of the custom element registered under the name <code>name</code> , if there is one, or <code>undefined</code> . </p><br><p>  <code>customElements.whenDefined(name)</code> will return a promise that will be executed successfully when an element with the name <code>name</code> is registered, or immediately if the element is already registered.  This is especially convenient with the use of <code>await</code> , but that's another topic. </p><br><h3 id="rasshirenie-polzovatelskih-elementov">  Extend custom items </h3><br><p>  We can inherit from the user element class to create new custom elements based on existing ones.  For example, we can expand our spoiler and add some functionality to it if necessary.  It is important to remember to call the same method of the parent class via <code>super.methodName()</code> , if necessary (in the case of the constructor and <code>super()</code> this is mandatory). </p><br><h3 id="rasshirenie-standartnyh-elementov">  Extension of standard elements </h3><br><p>  The specification also allows extensions to standard HTML tags.  For example, you need your own implementation of the button, but at the same time you want to keep the existing functionality of browser buttons, for example, to work correctly with the attributes <code>disabled</code> , <code>tabindex</code> , <code>type</code> and others.  However, there are a number of features. </p><br><p>  First, when declaring a class, you need to extend the class of the tag you need.  In the case of a button, this will be the <code>HTMLButtonElement</code> class.  A complete list of classes can be found <a href="https://html.spec.whatwg.org/multipage/indices.html">in the specification</a> . </p><br><p>  Secondly, when registering an element with a third parameter, you must pass an object of options, which indicates which particular tag you want to expand (the same class can correspond to several tags). </p><br><p>  Thirdly, such a custom element is created as a regular tag that needs to be expanded, but with an <code>is</code> attribute equal to the name of the custom element.  If the element is created through <code>document.createElement</code> , <code>is</code> passed as a property of the second argument. </p><br><p>  It will look like this: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FancyButton</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTMLButtonElement</span></span></span><span class="hljs-class"> </span></span>{ } customElements.define(<span class="hljs-string"><span class="hljs-string">"fancy-button"</span></span>, FancyButton, {<span class="hljs-attr"><span class="hljs-attr">extends</span></span>: <span class="hljs-string"><span class="hljs-string">"button"</span></span>});</code> </pre> <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//    document.createElement let button = document.createElement("button", {is: "fancy-button"});</span></span></code> </pre> <br><pre> <code class="html hljs xml"><span class="hljs-comment"><span class="hljs-comment">&lt;!--    HTML --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">is</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fancy-button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">disabled</span></span></span><span class="hljs-tag">&gt;</span></span>Fancy button!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3 id="stilizaciya-elementov-do-registracii">  Styling elements before registration </h3><br><p>  In the meantime, how the user gets the HTML markup, and how the JavaScript code will be downloaded and executed, it will take some time.  To somehow stylize custom elements that are drawn in the DOM, but have not yet been registered and do not work properly, you can use the pseudo-class <code>:defined</code> .  The simplest use case is to hide all unregistered user elements: </p><br><pre> <code class="css hljs">*<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:not(</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:defined)</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">display</span></span>: none; }</code> </pre> <br><h3 id="itogo">  Total </h3><br><p>  We made a reusable web component based on custom element technology.  However, he has many drawbacks.  So, for example, we have no isolation of styles: the rule <code>section {display: block !important}</code> will easily break the logic of our component.  In general, hanging styles directly in JS is a bad tone.  It is also difficult to change the contents of the spoiler: our button, section and click handler will disappear when installing new content via <code>innerHTML</code> .  In order to really change the content, you will need to know and take into account the structure of the component.  And also the markup is stored right here in the constructor.  All this is clearly not what we want from a simple reusable component.  In order to fix all these disadvantages, we will use other specifications. </p><br><h2 id="tenevoy-dom-shadow-dom">  Shadow DOM (Shadow DOM) </h2><br><p>  The shadow DOM specification will solve the problem of isolating styles and layouts from the environment and internal content. </p><br><h3 id="inkapsulyaciya-dom">  DOM Encapsulation </h3><br><p>  The standard DOM model we are used to assumes that all descendants of an element are accessible through <code>childNodes</code> , they can be found via <code>querySelector()</code> , and so on.  DOM - pass through, wherever there is a paragraph of text, it will always be found through <code>document.querySelectorAll("p")</code> .  However, it is possible to display not what is in the DOM tree, but any other markup, and so that it is ignored by the usual <code>childNode</code> and <code>querySelector</code> .  The simplest example of this behavior would be a <code>&lt;video&gt;</code> with several <code>&lt;source&gt;</code> inside.  We add only <code>&lt;source&gt;</code> to the DOM, and we see a full-fledged video player, with its own isolated markup (blocks, buttons, and so on).  Everything we see on the screen is located in the shadow DOM.  How it works? </p><br><p>         DOM    <code>attachShadow()</code> .      DOM-      : Shadow DOM, Light DOM  Flattened DOM.  Consider them separately. </p><br><p> Light DOM ‚Äî  ,     DOM- :  ,     <code>innerHTML</code> , <code>childNodes</code>      <code>querySelectorAll</code> . </p><br><p> Shadow DOM ‚Äî  DOM-,     <code>shadowRoot</code> .    <code>attachShadow</code>  <code>shadowRoot</code> ,     -    <code>innerHTML</code> , <code>appendChild</code>      DOM,    <code>this.shadowRoot</code> . </p><br><p> Flattened DOM ‚Äî    Shadow DOM  Light DOM.  ,       .   ,       Shadow DOM.    Light DOM   <code>element.innerHTML</code> ,  Shadow DOM   <code>element.shadowRoot.innerHTML</code> ,   Flattened DOM      . Flattened DOM    Shadow DOM         .  , Light DOM      .  For example: </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x-demo</span></span></span><span class="hljs-tag">&gt;</span></span>!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">x-demo</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Demo</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTMLElement</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.attachShadow({<span class="hljs-attr"><span class="hljs-attr">mode</span></span>: <span class="hljs-string"><span class="hljs-string">"open"</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shadowRoot.innerHTML = <span class="hljs-string"><span class="hljs-string">"  ..."</span></span>; } } customElements.define(<span class="hljs-string"><span class="hljs-string">"x-demo"</span></span>, Demo);</code> </pre> <br><p>         DOM, ..     ¬´!¬ª.      ,  ,     ¬´  ...¬ª. </p><br><p>  :   Shadow DOM      ,    Shadow DOM  .      <code>open</code> .       Shadow DOM   <code>shadowRoot</code> . </p><br><p>    .       <code>&lt;slot&gt;</code>    <code>name</code>  Shadow DOM   <code>slot</code>  Light DOM.  ,    Flattened DOM    Lignt DOM.   :  (    0,   1  )   <code>slot</code>  -   Light DOM      <code>&lt;slot&gt;</code>     <code>name</code>  Shadow DOM.   -  <code>&lt;slot&gt;</code>    ,     Shadow DOM.    <code>&lt;slot&gt;</code>   <code>name</code> ,      Light DOM   <code>slot</code> . </p><br><p>  ,     Shadow DOM  Light DOM   Shadow DOM     <code>&lt;slot&gt;</code>  ,    Light DOM      <code>&lt;slot&gt;</code> . </p><br><p>        :    ¬´¬ª (  )  Shadow DOM,    Light DOM    <code>&lt;slot&gt;</code> .    : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.attachShadow({<span class="hljs-attr"><span class="hljs-attr">mode</span></span>: <span class="hljs-string"><span class="hljs-string">"open"</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shadowRoot.innerHTML = <span class="hljs-string"><span class="hljs-string">` &lt;button type="button"&gt;</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-string"><span class="hljs-subst">.text[</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">"when-close"</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">&lt;/button&gt; &lt;section style="display: none;"&gt;&lt;slot&gt;&lt;/slot&gt;&lt;/section&gt; `</span></span>;</code> </pre> <br><p>         Shadow DOM,    <code>this.querySelector("button")</code>  <code>this.shadowRoot.querySelector("button")</code> .        <code>section</code> . </p><br><p>       , ,  <code>textContent</code>  .           .    ,    ,    . <a href="https://codepen.io/dartess/embed/ppwZqR/%3Fheight%3D265%26amp%3Btheme-id%3D0%26amp%3Bdefault-tab%3Djs,result%26amp%3Bembed-version%3D2"></a> . </p><br><p>   :    ,       ¬´¬ª   DOM-  Light DOM.     ,  ,   : <a href="https://codepen.io/dartess/pen/VyWBoR%3Feditors%3D1010"></a> . </p><br><p>    ,    Light DOM        <code>slot</code> ,     <code>&lt;slot&gt;</code>   <code>name</code> ( ).     Light DOM   <code>slot</code> ,    Shadow DOM   <code>&lt;slot&gt;</code> ,     <code>name</code> ( ).           <code>slot</code>  - ,   <code>&lt;slot&gt;</code>      ( ). </p><br><h3 id="inkapsulyaciya-stiley">   </h3><br><p>   DOM   Light DOM / Shadow DOM  ,     . </p><br><p>         .   Shadow DOM   <code>&lt;style&gt;</code> ,        Shadow DOM.  ,  </p><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">section</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">50%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">50%</span></span>; }</code> </pre> <br><p>       <code>section</code> ,    Shadow DOM.      :  <code>section</code>  Shadow DOM       .       .         ,       . </p><br><p>          :  <code>:host</code> .     .      ,     .     , ,     . </p><br><p> ,      ,        ,     .    Shadow DOM   <code>attributeChangedCallback</code> . <a href="https://codepen.io/dartess/embed/GyEXEo/%3Fheight%3D265%26amp%3Btheme-id%3D0%26amp%3Bdefault-tab%3Djs,result%26amp%3Bembed-version%3D2"></a> . </p><br><p>            - .   :  <code>:host-context(.red)</code>       ,        <code>.red</code> .    ,      ,     . </p><br><p>       Light DOM,    .     <code>::slotted</code> ,       ,    -   Light DOM.         ,    .  Example: </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name-badge</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span>Eric Bidelman<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"title"</span></span></span><span class="hljs-tag">&gt;</span></span> Digital Jedi, <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"company"</span></span></span><span class="hljs-tag">&gt;</span></span>Google<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name-badge</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css"> </span><span class="hljs-selector-pseudo"><span class="css"><span class="hljs-selector-pseudo">::slotted(h2)</span></span></span><span class="css"> { </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">margin</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">font-weight</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">300</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">color</span></span></span><span class="css">: red; } </span><span class="hljs-selector-pseudo"><span class="css"><span class="hljs-selector-pseudo">::slotted(.title)</span></span></span><span class="css"> { </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">color</span></span></span><span class="css">: orange; } </span><span class="hljs-comment"><span class="css"><span class="hljs-comment">/*    (      ). ::slotted(.company), ::slotted(.title .company) { text-transform: uppercase; } */</span></span></span><span class="css"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">slot</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">slot</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p> ,    -       ,    <code>:host</code>  <code>:host-context</code> . </p><br><p>         ‚Äî         <code>:host</code>  .  ,        <code>:host</code> .      . </p><br><p>     Shadow DOM   <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_variables">  CSS</a> , , ,     ,     . </p><br><h3 id="vzaimodeystvie-s-tenevym-dom">    DOM </h3><br><p>     DOM      DOM  ,     .      ,    DOM, ,  <code>&lt;video&gt;</code> . </p><br><p>    DOM   JavaScript-  ,   DOM     <code>{mode: "open"}</code> . </p><br><h3 id="chto-eschyo">  ? </h3><br><p>        ¬´¬ª Shadow DOM,   <code>mode</code>   <code>closed</code> .   Shadow DOM     <code>shadowRoot</code> ,    <code>null</code> .    <code>shadowRoot</code>    <code>attachShadow()</code> ,      ,    <code>shadowRoot</code>      -   .      Shadow DOM,        . </p><br><p>  <code>&lt;slot&gt;</code>   <code>slotchange</code> ,         Light DOM,    .  ,       . </p><br><p>   <code>&lt;slot&gt;</code>   <code>assignedNodes</code> ,    DOM-  Light DOM,      .        DOM-       <code>{flatten: true}</code> ,       (      ). </p><br><p>          Light DOM   <code>assignedSlot</code> ,   ,    . </p><br><h2 id="shablony-html-templates">  (HTML Templates) </h2><br><p>       ,         HTML. </p><br><p>     Shadow DOM    . -    ,      <code>innerHTML</code>       ,   -   . </p><br><p>      <code>&lt;template&gt;</code> ,    HTML Templates.        ,       ,    <em>  </em> .  ,       DOM-,  ,   <code>&lt;script&gt;</code>   ,  <code>&lt;link&gt;</code>       ,       ,       <code>querySelector</code>   . </p><br><p>    DOM- <code>&lt;template&gt;</code>   <code>content</code> ,   <code>DocumentFragment</code> ,   .   ,           <code>appendChild</code> . </p><br><p>     ,       Shadow DOM: <a href="https://codepen.io/dartess/embed/YYQRYJ/%3Fheight%3D265%26amp%3Btheme-id%3D0%26amp%3Bdefault-tab%3Dhtml,result%26amp%3Bembed-version%3D2"></a> . </p><br><p>  ,   ¬´¬ª       .         :    ,    . ,   DOM-,   .         . </p><br><h2 id="html-importy-html-imports"> HTML- (HTML Imports) </h2><br><p>         . ,    ,        ,  ,   .    HTML-   :      HTML-,      (, , )       <code>&lt;link rel="import" href="x-spoiler.html"&gt;</code> . </p><br><p>  ,   html-      <code>&lt;template&gt;</code>   <code>&lt;script&gt;</code>       .     ,   ,    <code>&lt;script&gt;</code>     .        html-    , ,     : ,    ,        DOM  ,  ,      <code>document.getElementById</code> .     DOM-  html-    <code>import</code>   <code>link</code> .       <code>&lt;link&gt;</code> id,     ,   <code>import</code>    <code>template</code> ,   .       <code>&lt;script&gt;</code>   <code>const ownerDocument = document.currentScript.ownerDocument</code> ,   ,     ,    <code>&lt;template&gt;</code>  <code>ownerDocument</code> ,    <code>document</code> . <a href="https://codepen.io/dartess/embed/dJRwRx/%3Fheight%3D265%26amp%3Btheme-id%3D0%26amp%3Bdefault-tab%3Dhtml%26amp%3Bembed-version%3D2"> </a> .       ! </p><br><p>    ,     . ,       (   ),    <code>&lt;link rel="import"&gt;</code>  .       .   , ,     ,     . </p><br><h1 id="praktika">  Practice </h1><br><h2 id="chto-ispolzovat">   </h2><br><p>        .  HTML-      : </p><br><ol><li>  ¬´ ¬ª.   ‚Äî  .     <code>app.html</code> ,    ,   ?   ,      20 .     ,         ,   ,   ,   .   ,      .      ,                ,       . </li><li>   ,             .    100 ,         ,    n-  . ,    ,  ,   . </li><li>      ,      HTTP/2.      HTTP/2  ,    . </li><li>       <code>document.currentScript</code> .  ,      IE11     .  ,      ,   id    id,       <code>&lt;template&gt;</code> , ,  ,   . </li><li> Firefox         HTML-   ,     . ,  -      ,    Firefox,       ,   . </li></ol><br><p> ,   ,       . ,     .        ,     HTML-.         . </p><br><h2 id="kak-ispolzovat">  How to use </h2><br><p>     ,   <code>IE</code> , <code>Edge 12</code>  <code>Safari 7-</code> .      . </p><br><p>      v1 ( <code>Chrome 54+</code> , <code>Safari 10.1+</code> )   DOM v1 ( <code>Chrome 53+</code> , <code>Safari 10+</code> ).     . </p><br><p>       <a href="https://github.com/WebComponents/webcomponentsjs">WebComponents/webcomponentsjs</a> .      ,     , <code>webcomponents-sd-ce.js</code> ,         DOM,       HTML-. </p><br><p>    ,  ,      : <a href="https://github.com/webcomponents/custom-elements"> </a> ,   ‚Äî <a href="https://github.com/webcomponents/shadydom">ShadyDOM</a>   ‚Äî <a href="https://github.com/webcomponents/shadycss">ShadyCSS</a>   DOM.        .        : <a href="https://github.com/webcomponents/template"><code>  &lt;template&gt;</code></a> . </p><br><p>             ‚Äî <code>Promise</code> ,  <code>CustomEvent</code> , <code>Object.assign()</code> , <code>Array.from()</code>    .     -       ,       <a href="https://github.com/webcomponents/webcomponents-platform">webcomponents-platform</a>      <a href="https://github.com/stefanpenner/es6-promise"> es6-promise</a> ,   <a href=""></a>   <a href="https://polyfill.io/v2/docs/">polyfill.io</a> . </p><br><p><del>       <code>Element.prototype.insertAdjacentHTML</code>     ,       .   ,   -         ,   <a href="https://github.com/webcomponents/custom-elements/issues/104">issue</a> . </del> UPD: . </p><br><p>     ,    ,            .    ( ) <a href="https://codepen.io/dartess/pen/zpZQaZ"> </a> . </p><br><p>        <a href="https://github.com/WebReflection/document-register-element">WebReflection</a> ,                <a href="https://codepen.io/anon/pen/goGBdR%3Feditors%3D1010"></a> (  Firefox). ,   ,  ,              . </p><br><p>        ,    <code>Babel</code> ,      . </p><br><p> ,  : </p><br><ul><li>  <a href="https://babeljs.io/">Babel</a> </li><li> <a href=""> Promise  .</a> </li><li> <a href="">     DOM</a> </li><li> <a href=""> </a> </li></ul><br><h2 id="ogranicheniya-s-kotorymi-pridyotsya-smiritsya"> ,     </h2><br><h3 id="ogranicheniya-podderzhki-standarta">    </h3><br><p>        .         . : </p><br><ul><li> Internet Explorer 11+ </li><li> Edge 12+ </li><li> Firefox 35+ </li><li> Chrome 26+ </li><li> Safari 6.1+ </li><li> iOS- 8+ </li><li> Android browser 4.4+ </li></ul><br><p>       : </p><br><ul><li>    (HTML-), <code>&lt;button is="fancy-button"&gt;button&lt;/button&gt;</code> .                 <code>WebComponents</code> . </li><li>  <code>adoptedCallback</code> <a href="https://github.com/webcomponents/custom-elements">  </a> . </li><li>  <code>:defined</code> <a href="https://github.com/webcomponents/custom-elements">  </a> , ,        . </li><li>  <code>:host-context</code> <a href="https://github.com/webcomponents/shadycss/issues/74">   Safari,     </a> . </li><li> []  <code>assignedNodes</code>   <code>&lt;slot&gt;</code>  ,       .   <a href="https://github.com/webcomponents/shadydom/issues/195">issue</a> ,      . </li></ul><br><p>  ,      ,       .       ,    . </p><br><h3 id="ogranicheniya-polifila-polzovatelskih-elementov">     </h3><br><p>   ‚Äî       .   Babel    <code>extends</code>      ,  Chrome    , ,       ES5-.   ,   <code>custom-elements-es5-adapter.js</code>  <a href="https://github.com/webcomponents/webcomponentsjs">  </a> ,        ,     .  , <em></em> .    ES5-,      - (  ),    (  ). </p><br><p>         DOM ,     : </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"custom-elements-adapter-test"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> (</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (isNative(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.customElements.define) === </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">false</span></span></span><span class="javascript">) { </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">// ,  Element.prototype.remove()   , //        , //  .parentNode.removeChild() document.getElementById("custom-elements-adapter-test").remove(); } function isNative(fn) { return (/\{\s*\[native code\]\s*\}/).test('' + fn); } })(); </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/1.0.22/custom-elements-es5-adapter.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>   ,  ‚Äî .    ‚Äî        ,     .    ‚Äî     ,       . </p><br><p>    <a href="https://github.com/github/babel-plugin-transform-custom-element-classes">babel-plugin-transform-custom-element-classes</a> .          <code>es5-adapter</code> ,         IE11    ,        <code>Reflect.construct</code> . ,  ,   ,      .  ,   ,    ‚Äî       <em> </em> .       : ,          <code>babel-polyfill</code> .     . ,    . </p><br><p>    ‚Äî <a href="https://github.com/WebReflection/babel-plugin-transform-builtin-classes">babel-plugin-transform-builtin-classes</a>    <code>WebReflection</code> .       ,   ,    IE11 - ,     .   ,           <code>WebComponents</code> .     ‚Äî <del>     </del> <a href="https://github.com/WebReflection/babel-plugin-transform-builtin-classes/issues/1">      WebReflection,    WebComponents</a> .       . </p><br><p>    ,   ,      ‚Äî  Babel 7,      .    <a href="https://twitter.com/left_pad/status/940723982638157829"></a>     .        ,         Chrome (     ),   IE11,       <code>Reflect.construct</code> . </p><br><p> :        DOM ES5-,    ,     .     ,   ‚Äî     . </p><br><p>     <code>constructor</code> :  IE  Safari     <code>HTMLUnknownElementConstructor</code> ,      .      . </p><br><p>   <a href="https://github.com/webcomponents/custom-elements">  </a> . </p><br><h3 id="ogranicheniya-polifila-tenevogo-dom">    DOM </h3><br><p>    ,    . -,        <code>ShadyCSS.prepareTemplate()</code> ,      ,  ‚Äî   ,     .     <code>&lt;template id="x-spoiler"&gt;</code>    <code>&lt;x-spoiler&gt;</code> ,    <code>ShadyCSS.prepareTemplate(document.getElementById("x-spoiler"), "x-spoiler")</code> . </p><br><p>         : <code>ShadyCSS.styleElement(this)</code> ; </p><br><p>             <code>:host()</code> : <code>:host(.zot)</code>  <code>:host(.zot:not(.bar))</code>  ,  <code>:host(.zot:not(.bar:nth-child(2)))</code> ‚Äî  . </p><br><p>      <code>::slotted</code> :       . ,  <code>::slotted(span)</code>       ,     <code>.header ::slotted(span)</code> . </p><br><p>  <a href="https://github.com/webcomponents/shadycss">  </a> . </p><br><h3 id="ogranicheniya-polifila-shablonov">    </h3><br><p>   ‚Äî     <code>&lt;template&gt;</code> .   ,       <code>DOMContentLoaded</code> ,   ,  <code>customElements.define()</code> ,     DOM-,      <code>content</code>   <code>template</code> .  :   <code>customElements.define()</code>    <code>DOMContentLoaded</code> ,       <code>customElements.define()</code> .      .    : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { HTMLTemplateElement.bootstrap(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) { }</code> </pre> <br><p>   <code>&lt;template&gt;</code>   DOM  ,      :   <code>&lt;template&gt;</code>     DOM-     .       . </p><br><p>           <code>&lt;script&gt;</code> :     ,     <code>&lt;template&gt;</code>        - :  IE      .      . ,    -     . </p><br><h2 id="sborka-s-pomoschyu-gulp">    gulp </h2><br><p> ,  ,       :      <code>html</code> .      <code>&lt;script&gt;</code> ,   .      (   )  <code>&lt;template&gt;</code> ,     DOM        HTML.  <code>&lt;template&gt;</code>    <code>id</code> ,     .      DOM,     <code>&lt;style&gt;</code>  ,    CSS.       ,     HTML        ,  ,      <code>&lt;style&gt;</code> ,   css. </p><br><p>      ,      ,        .  For this we need: </p><br><ul><li>       <code>templates.html</code> </li><li>      <code>PostCSS</code> </li><li>       <code>app.js</code> </li><li>      <code>Babel</code> </li></ul><br><p>           <code>gulp</code> ,         ,   <code>gulpfile</code> ,    .          <a href="https://github.com/dartess/web-components-demo/tree/gulp"> github</a> .     : </p><br><p>     <code>src</code> .   <code>html</code> -  (,   ),  <code>scaffolding.js</code>   js-   <code>components</code>    -. </p><br><p> <code>index.html</code>   <code>@@templates</code> ,       -,   -,  ,  es5-  ,   <code>app.js</code>  -,          . </p><br><p> <code>scaffolding.js</code>            ,    DOM (     ). </p><br><p>    .     :    . </p><br><p>  <code>scripts</code>   <code>&lt;script&gt;</code>   <code>app.js</code> : </p><br><pre> <code class="javascript hljs">gulp.task(<span class="hljs-string"><span class="hljs-string">"scripts"</span></span>, () =&gt; <span class="hljs-comment"><span class="hljs-comment">//    gulp.src("src/components/*.html") //       .pipe(concat("app.js")) //  .     , //  jsdom,    api //    &lt;script&gt;     .pipe(insert.transform(content =&gt; { const document = (new JSDOM(content)).window.document; const scriptsTags = document.querySelectorAll("script"); const scriptsContents = Array.prototype.map.call(scriptsTags, tag =&gt; tag.textContent); return scriptsContents.join(""); })) //   scaffolding.js .pipe(gap.prependFile("src/scaffolding.js")) //    Babel .pipe(babel({ presets: ["env"] })) //   .pipe(gulp.dest("dist")) )</span></span></code> </pre> <br><p>  <code>templates</code>   ,   <code>&lt;template&gt;</code>          : </p><br><pre> <code class="javascript hljs">gulp.task(<span class="hljs-string"><span class="hljs-string">"templates"</span></span>, () =&gt; <span class="hljs-comment"><span class="hljs-comment">//      gulp.src("src/components/*.html") //      jsdom,    &lt;template&gt; //     data-, ,    //  .     .pipe(insert.transform((content, file) =&gt; { const componentName = path.basename(file.path, ".html"); const document = (new JSDOM(content)).window.document; const templatesTags = document.querySelectorAll("template"); templatesTags.forEach(template =&gt; template.setAttribute("data-component", componentName)); const templatesHTML = Array.prototype.map.call(templatesTags, tag =&gt; tag.outerHTML); return templatesHTML.join(""); })) //        .pipe(concat("templates.html")) //   gulp-html-postcss,     html  &lt;style&gt; .pipe(postcss([ autoprefixer() ])) //   ‚Äî  html  css .pipe(htmlmin({ collapseWhitespace: true, conservativeCollapse: true, minifyCSS: true, })) //   .pipe(gulp.dest("dist")) );</span></span></code> </pre> <br><p>        html-    <code>@@templates</code>   <code>templates.html</code> ,    <code>templates</code> .        gulp,      . ,      php      <code>include</code> .        gulp   . </p><br><p>     ,       ,  <code>data</code> -? Gulp    .      ,      ,    <code>ShadyCSS.prepareTemplate()</code> . ,      <code>scaffolding.js</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelectorAll(<span class="hljs-string"><span class="hljs-string">"template[data-component]"</span></span>).forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">template</span></span></span><span class="hljs-function"> =&gt;</span></span> { ShadyCSS.prepareTemplate(template, template.dataset[<span class="hljs-string"><span class="hljs-string">"component"</span></span>]); });</code> </pre> <br><p>  That's all!     -,  gulp         .         . </p><br><h2 id="bazovyy-komponent">   </h2><br><p>   ,       .         ,    ,    <code>HTMLElement</code> .      <code>x-component</code> ,   ,       .      (  ,     ): </p><br><p>  <code>$</code>  <code>$$</code> .     <code>querySelector</code>  <code>querySelectorAll</code>  Light DOM.     Chrome DevTools,        <code>jQuery</code> . </p><br><p>  <code>fireEvent</code> ,        .     <code>CustomEvent</code>    ,    ,        <code>dispatchEvent</code> .         ,          c       . </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  this.dispatchEvent(new CustomEvent(`x-timer.ended`, { bubbles: true })); //  this.fireEvent(`x-timer.ended`);</span></span></code> </pre> <br><p>  <code>is</code>  <code>localName</code> ,   ‚Äî   .  ,       ,      (    ). </p><br><p>  <code>getTemplateCopy</code>    -    <code>id</code> . </p><br><p>  <code>makeShadowRoot</code>          DOM.      ,  <code>id</code>         (  <code>this.is</code> )       <code>getTemplateCopy</code> .        DOM ( <code>ShadyCSS.styleElement(this);</code> ),        .      <code>$</code>  <code>$$</code>   <code>shadowRoot</code> . </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  ShadyCSS.styleElement(this); this.attachShadow({ mode: "open" }); const template = document.getElementById("x-spoiler"); const templateClone = template.content.cloneNode(true); templateClone.querySelector("button").textContent = this.text["when-close"]; this.shadowRoot.appendChild(templateClone); //  this.makeShadowRoot(); this.shadowRoot.$("button").textContent = this.text["when-close"];</span></span></code> </pre> <br><p>       . ,      <code>properties</code> ,  ,      /     ,   (        ),            .    ,      : </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ,  get opened() { return this.getAttribute("opened") !== null; } set opened(value) { if (!!value) { this.setAttribute("opened", ""); } else { this.removeAttribute("opened"); } } // ,  properties = { opened: { type: Boolean, }, }</span></span></code> </pre> <br><p>  , -  <a href="https://www.polymer-project.org/2.0/docs/devguide/properties"> </a>    . </p><br><p>        -   <a href="https://github.com/dartess/web-components-demo/pull/1/files"></a> , <a href="https://github.com/dartess/web-components-demo/tree/gulp%2Bbasic"> </a>     . </p><br><p> ,        ‚Äî      ,         ,       (      ). </p><br><h2 id="vtoraya-sborka-bez-polifilov">  ,   </h2><br><p> , ,       ,      -   IE11,     ,      ?   Chrome,   ,   es5-   es5-  -.  Not order. </p><br><p>   ,   JS   ,  -    (  ‚Äî    ES),   <em></em> .      ,    ‚Äî .       ? , .     ,       ,     ,    2018    75%.        . </p><br><p> -,  ,       ES5  ES6 . , , Babel   scaffolding.js        .     : </p><br><pre> <code class="javascript hljs">gulp.task(<span class="hljs-string"><span class="hljs-string">"scripts-es5"</span></span>, buildJS.bind(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"es5"</span></span>)); gulp.task(<span class="hljs-string"><span class="hljs-string">"scripts-es6"</span></span>, buildJS.bind(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"es6"</span></span>)); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildJS</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">mode</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gulp.src(<span class="hljs-string"><span class="hljs-string">"src/components/*.html"</span></span>) .pipe(concat(<span class="hljs-string"><span class="hljs-string">`app-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${mode}</span></span></span><span class="hljs-string">.js`</span></span>)) .pipe(insert.transform(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">content</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">document</span></span> = (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JSDOM(content)).window.document; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> scriptsTags = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelectorAll(<span class="hljs-string"><span class="hljs-string">"script"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> scriptsContents = <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.prototype.map.call(scriptsTags, tag =&gt; tag.textContent); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> scriptsContents.join(<span class="hljs-string"><span class="hljs-string">""</span></span>); })) .pipe(gulpif(mode === <span class="hljs-string"><span class="hljs-string">'es5'</span></span>, gap.prependFile(<span class="hljs-string"><span class="hljs-string">"src/scaffolding.js"</span></span>))) .pipe(gulpif(mode === <span class="hljs-string"><span class="hljs-string">'es5'</span></span>, babel({<span class="hljs-attr"><span class="hljs-attr">presets</span></span>: [<span class="hljs-string"><span class="hljs-string">"env"</span></span>]}))) .pipe(uglify()) .pipe(gulp.dest(<span class="hljs-string"><span class="hljs-string">"dist"</span></span>)) }</code> </pre> <br><p>     , <code>app-es5.js</code>  <code>app-es6.js</code> .         ,           .          ,  ÃÅ     ,          . </p><br><p>     .    ,           150  !    .  ,      ,       .             ,     .           .       html: </p><br><pre> <code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wcReady = (<span class="hljs-string"><span class="hljs-string">"attachShadow"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.documentElement) &amp;&amp; (<span class="hljs-string"><span class="hljs-string">'customElements'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scripts; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (wcReady) { scripts = [ <span class="hljs-string"><span class="hljs-string">"./app-es6.js"</span></span> ]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { scripts = [ <span class="hljs-string"><span class="hljs-string">"https://cdn.polyfill.io/v2/polyfill.js?features=default"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/1.0.22/webcomponents-sd-ce.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://cdn.jsdelivr.net/npm/template-mb@2.0.6/template.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"./app-es5.js"</span></span> ]; } scripts.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">script</span></span></span><span class="hljs-function">) </span></span>{ insertScript(script); }); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">insertScript</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">src</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> script = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'script'</span></span>); script.src = src; script.async = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.head.appendChild(script); } })();</code> </pre> <br><p>         .    :   ,   -  bower      es-5  . ,          ,            . </p><br><p>   <a href="https://github.com/dartess/web-components-demo"> </a> . </p><br><h2 id="polymer"> Polymer </h2><br><p>   -,    <a href="https://www.polymer-project.org/">Polymer</a> .  ,      -    -    <code>Polymer.Element</code> .      ,      -,     . </p><br><p>   ,  -,     Polymer.    - <a href="https://www.webcomponents.org/">webcomponents.org</a>       Polymer,       .         ,      Polymer. </p><br><p>     Polymer    , ,  Polymer,      ,     -. Polymer      -, , , jQuery       DOM  JS. </p><br><p>  Polymer   HTML-. </p><br><p>     Polymer,    -,    ,        . </p><br><p>     Polymer       API    . , , ,        HTML- (  ES6 ),  HTML- (   ).   ,    ,        .        ,     . </p><br><p>         Polymer,        . ,  ,  ,       Polymer. </p><br><h2 id="posle-vnedreniya">   </h2><br><p>    ,                   ‚Äî , , .      .      .        ,      ( ,     )   . , ,   <code>PostCSS</code> ,      .  ‚Äî  IDE       PostCSS-   <code>&lt;style&gt;</code> .        . </p><br><p>      ,       <code>node-sass</code> .      ,     <code>&lt;style&gt;&lt;/style&gt;</code> ,   . </p><br><h1 id="vyvody">  findings </h1><br><p>   ‚Äî       ,     ,        ,        -.           ,      - ,  <a href="https://custom-elements-everywhere.com/">-   </a> . </p><br><p> ,     (,  <a href="https://tabatkins.github.io/specs/css-shadow-parts/"></a>    <code>::part</code>  <code>::theme</code>     DOM   ).  - ‚Äî  ,        .       -        Polymer   ‚Äî ,  -     Polymer,     . </p><br><h1 id="resursy">  Resources </h1><br><ul><li> <a href="https://developers.google.com/web/fundamentals/web-components/">Google Web Fundamentals</a> <br><ul><li> <a href="https://developers.google.com/web/fundamentals/web-components/customelements">  v1</a> </li><li> <a href="https://developers.google.com/web/fundamentals/web-components/shadowdom"> DOM v1</a> </li><li> <a href="https://developers.google.com/web/fundamentals/web-components/best-practices"> </a> </li><li>  <a href="https://developers.google.com/web/fundamentals/web-components/examples/">Examples</a> </li></ul></li><li>  Specs <br><ul><li> <a href="https://www.w3.org/TR/custom-elements/">  v1</a> </li><li> <a href="https://www.w3.org/TR/shadow-dom/"> DOM v1</a> </li><li>  <a href="https://www.w3.org/TR/html-templates/">Templates</a> </li><li> <a href="https://www.w3.org/TR/html-imports/">HTML-</a> </li></ul></li><li>  <br><ul><li> <a href="https://github.com/webcomponents/webcomponentsjs">   webcomponents</a> </li><li> <a href="https://github.com/webcomponents/custom-elements">  v1</a> </li><li> <a href="https://github.com/webcomponents/shadydom"> DOM v1,  DOM</a> </li><li> <a href="https://github.com/webcomponents/shadycss"> DOM v1,  </a> </li><li>  <a href="https://github.com/webcomponents/template">Templates</a> </li><li> <a href="https://github.com/webcomponents/html-imports">HTML-</a> </li><li> <a href="https://github.com/WebReflection/document-register-element/">     WebReflection</a> </li></ul></li><li> <a href="https://custom-elements-everywhere.com/"> -  </a> </li><li> <a href="https://www.polymer-project.org/">Polymer</a> </li><li> <a href="https://www.webcomponents.org/"> -</a> </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/346670/">https://habr.com/ru/post/346670/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346658/index.html">How to develop and produce IoT devices in Russia</a></li>
<li><a href="../346660/index.html">[Video] Reports from the iOS developer Red Hot Chili Apples</a></li>
<li><a href="../346662/index.html">Autopilot on AT91SAM7</a></li>
<li><a href="../346666/index.html">ICO regulation. Estonia</a></li>
<li><a href="../346668/index.html">Networks and neighbors: methods of survival of machine learning in the ‚Äúwild‚Äù. Open Workshop AI @ MIPT</a></li>
<li><a href="../346672/index.html">Single Sign-On, or Dancing Six</a></li>
<li><a href="../346676/index.html">Testing components with Puppeteer and Jest</a></li>
<li><a href="../346680/index.html">Bobaos - access to the KNX TP / UART bus with the Raspberry Pi</a></li>
<li><a href="../346682/index.html">Digital events in Moscow from January 15 to 21</a></li>
<li><a href="../346684/index.html">Running in bags, blindfolded, back to front</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>