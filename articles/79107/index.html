<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Configuring Debian / Ubuntu as Mac Storage</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I have long been a user of Apple products. An old MacBook completely copes with the tasks that are assigned to it. Mostly entertaining, of course. But...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Configuring Debian / Ubuntu as Mac Storage</h1><div class="post__text post__text-html js-mediator-article">  I have long been a user of Apple products.  An old MacBook completely copes with the tasks that are assigned to it.  Mostly entertaining, of course.  But lately there has not been enough space on a 40 gig hard drive.  And finally, my hands were itching to set up my home server as storage.  Some time worked on ftp, but it was not convenient.  It was decided to finally set up Appletalk, no wonder he is there and at the same time to tame TimeMachine to it :-) <br><a name="habracut"></a><br>  The configuration of all this can be divided into several stages: <br>  1. Install Appletalk <br>  2. Setting up AppleTalk <br>  3. Installing Avahi <br>  4. Configure Avahi <br>  5. Configure TimeMachine <br><br>  Well, let's get started. <br><br><h4>  1. Install AppleTalk </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Netatalk package - opensource Appletalk service implementation (AFP server).  Mac OS X requires encryption support, but the standard build of this package does not support encryption.  Therefore it is necessary to rebuild this package. <br><br>  <a href="">Here</a> you can download the already correctly assembled package, and go to step 2. <br><br>  But it is better to assemble yourself by executing these commands: <br>  Download raw: <br> <code>cd /tmp <br> sudo apt-get build-dep netatalk <br> sudo apt-get source netatalk <br> cd netatalk-2* <br></code> <br>  Install what you need to build: <br> <code>sudo apt-get install cracklib2-dev fakeroot libssl-dev</code> <br>  We collect: <br> <code>sudo DEB_BUILD_OPTIONS=ssl <br> sudo export DEB_BUILD_OPTIONS <br> sudo dpkg-buildpackage -rfakeroot</code> <br>  And, if everything is in order, install: <br> <code>sudo dpkg -i ../netatalk_2*.deb</code> <br>  Everything is not as scary as it seemed.  So that when updating the system, the correct package is not replaced by a newer but not correct package for the netatalk package: <br> <code>echo "netatalk hold" | sudo dpkg --set-selections</code> <br>  Everything, now we will pass to setup. <br><br><h4>  2. Setting up AppleTalk </h4><br><br>  First you need to disable those services that are not needed to solve the current task.  Here is the section in the / etc / default / netatalk file to this: <br> <code>ATALKD_RUN=no <br> PAPD_RUN=no <br> CNID_METAD_RUN=yes <br> AFPD_RUN=yes <br> TIMELORD_RUN=no <br> A2BOOT_RUN=no</code> <br> <br>  Now it's time for the main configuration file /etc/netatalk/afpd.conf and add this line below: <br> <code>- -transall -uamlist uams_randnum.so,uams_dhx2.so,uams_guest.so -nosavepassword -advertise_ssh</code> <br> <br>  Now we are going to configure the resources that will be shared by afp.  This is configured in the /etc/netatalk/AppleVolumes.default file <br>  Line: <br> <code>/home/torrent/downloads "Torrent-Downloads" allow:username,nobody rolist:nobody cnidscheme:cdb options:usedots</code> <br>  Shares the folder / home / torrent / downloads under the name Torrent-Downloads for user username and guest user.  And the Guest can only read from this folder. <br><br>  Line: <br> <code>/home/username/TimeMachine "TimeMachine" allow:username1,username2 cnidscheme:cdb options:usedots,upriv</code> <br>  sharing resource for TimeMachine. <br><br>  After editing configs, restart netatalk: <br> <code>sudo /etc/init.d/netatalk restart</code> <br> <br><h4>  Avahi installation </h4><br>  After the above steps, you can use Finder to access shared resources.  But every time it‚Äôs not convenient to use this menu, you need to make sure that the afp server is visible in the Finder resource menu. <br>  For this we need Avahi.  Avahi is a daemon providing online services like Bonjour. <br><br>  Installing avahi is simple: <br> <code>sudo apt-get install avahi-daemon <br> sudo apt-get install libnss-mdns</code> <br> <br>  In the /etc/nsswitch.conf file in the line, starting with hosts, you need to add mdns at the end, like this: <br> <code>hosts: files mdns4_minimal [NOTFOUND=return] dns mdns4 mdns</code> <br> <br><h4>  4. Configure Avahi </h4><br>  Create a /etc/avahi/services/afpd.service file with the content: <br> <code>&lt;?xml version="1.0" standalone='no'?&gt;&lt;!--*-nxml-*--&gt; <br> &lt;!DOCTYPE service-group SYSTEM "avahi-service.dtd"&gt; <br> &lt;service-group&gt; <br> &lt;name replace-wildcards="yes"&gt;%h&lt;/name&gt; <br> &lt;service&gt; <br> &lt;type&gt;_afpovertcp._tcp&lt;/type&gt; <br> &lt;port&gt;548&lt;/port&gt; <br> &lt;/service&gt; <br> &lt;service&gt; <br> &lt;type&gt;_device-info._tcp&lt;/type&gt; <br> &lt;port&gt;0&lt;/port&gt; <br> &lt;txt-record&gt;model=Xserve&lt;/txt-record&gt; <br> &lt;/service&gt; <br> &lt;/service-group&gt;</code> <br> <br>  And restart avahi: <br> <code>sudo /etc/init.d/avahi-daemon restart</code> <br> <br>  Now the vault should have appeared in the left sidebar of the Finder. <br><br><h4>  5. Configure TimeMachine </h4><br>  In the poppy console you need to run the command: <br> <code>defaults write com.apple.systempreferences TMShowUnsupportedNetworkVolumes 1</code> <br> <br>  That's all. </div><p>Source: <a href="https://habr.com/ru/post/79107/">https://habr.com/ru/post/79107/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../79095/index.html">I am surprised by these potsreoty</a></li>
<li><a href="../79099/index.html">Top 5 Fun Gift Online Stores</a></li>
<li><a href="../79100/index.html">Store widgets with information and news graphics for online publications</a></li>
<li><a href="../79104/index.html">Adobe flash player VS cp1251 encoding</a></li>
<li><a href="../79106/index.html">Virustotal uploader 2.0</a></li>
<li><a href="../79109/index.html">Wishmart.RU</a></li>
<li><a href="../79110/index.html">About consciousness and artificial intelligence</a></li>
<li><a href="../79111/index.html">Utel - Provider vs Legal entities</a></li>
<li><a href="../79112/index.html">WiMAX Base Station</a></li>
<li><a href="../79115/index.html">Yandex.Maps and 120 km / h</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>