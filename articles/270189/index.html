<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>[Translation] Working with files in the programming language D</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is a translation of Gary Willoughby's article ‚Äú Working with files in the D programming language, ‚Äù published September 28, 2015. 

 This post wa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>[Translation] Working with files in the programming language D</h1><div class="post__text post__text-html js-mediator-article">  <i>This is a translation of Gary Willoughby's article ‚Äú <a href="http://nomad.so/2015/09/working-with-files-in-the-d-programming-language/">Working with files in the D programming language,</a> ‚Äù published September 28, 2015.</i> <br><br>  This post was inspired by an article written a few weeks ago and titled <a href="http://devdungeon.com/content/working-files-go">Working with Files in Go</a> .  In this article, the author describes many ways to interact with files, dwelling in detail on the features of the <a href="https://golang.org/">Go</a> language.  And I thought to write a companion post, this time describing how to work with files in the <a href="http://dlang.org/">D</a> language. <br><br>  Interaction with files is one of the fundamental tasks of any programming language, and although the solution of such problems is a common phenomenon, it may not always be obvious exactly how some problems are solved in the D language. . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Some of the code examples below use the so-called Uniform Function Call Syntax (UFCS).  Let him not confuse you: his simple explanation can be found <a href="http://nomad.so/2013/08/alternative-function-syntax-in-d/">here</a> (for the <em>time being, too, English - approx. Transl.</em> ). <br><a name="habracut"></a><br><h2>  Read and write </h2><br><h3>  Open and close files </h3><br>  The following code shows how to open and close files in a safe way.  Generally speaking, D provides thin wrappers around the functions of the standard <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8_(%25D1%258F%25D0%25B7%25D1%258B%25D0%25BA_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F)">C</a> library; however, working with file descriptors is not safe and leads to errors for many reasons.  <code>File</code> type provides safe operation, automatic file closing and other convenient features.  The underlying descriptor is stored with <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25BE%25D0%25B4%25D1%2581%25D1%2587%25D1%2591%25D1%2582_%25D1%2581%25D1%2581%25D1%258B%25D0%25BB%25D0%25BE%25D0%25BA">reference counting</a> , so when the last <code>File</code> variable is out of scope, the descriptor is automatically closed. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> core.stdc.errno; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.exception; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.stdio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">//   File ‚Äî     ,   //    fopen   C. // // r ‚Äî    .   . // w ‚Äî     .      //   ,    ,  //   . // a ‚Äî       .   //      ,   . //    . //    ,  . // r+ ‚Äî     (  ). //   . // w+ ‚Äî         (  //  ).       , //   ,    . // a+ ‚Äî     (  ),   //       . //       , //        . //    ,  . auto file = File("test.txt", "r"); //   ,     , //  . file.close(); // . .:  -      ,   //     ,     // Go' defer: // scope(exit) file.close(); } catch (ErrnoException ex) { switch(ex.errno) { case EPERM: case EACCES: //   break; case ENOENT: //    break; default: //    break; } } }</span></span></code> </pre><br>  If an exception is thrown, an error has occurred with access to the file, and to find out what went wrong, you can access the <code>errno</code> property of this exception. <br><br>  Since the <code>File</code> type is a wrapper around a C language function, the returned error code will be one of the constants defined in <code>core.stdc.errno</code> .  This is the main way to access files and handle errors.  Extended information can be collected using the <code>std.file.getAttributes</code> function, which returns an unsigned integer.  This number contains several <a href="https://ru.wikipedia.org/wiki/%25D0%2591%25D0%25B8%25D1%2582%25D0%25BE%25D0%25B2%25D0%25BE%25D0%25B5_%25D0%25BF%25D0%25BE%25D0%25BB%25D0%25B5">bit flags</a> that are set differently depending on the operating system.  More information about these flags can be found <a href="http://dlang.org/phobos/std_file.html">here</a> . <br><br>  <a href="http://dlang.org/phobos/std_stdio.html">Documentation</a> <br><br><h3>  Looking for position in file </h3><br>  Sometimes before you start reading or writing, you need to go to a specific position in the file.  The following example shows how to change a position from different starting points. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.exception; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.stdio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> file = File(<span class="hljs-string"><span class="hljs-string">"test.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"r"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   10    . file.seek(10, SEEK_SET); //   2     . file.seek(-2, SEEK_CUR); //   4     . file.seek(-4, SEEK_END); //    . auto pos = file.tell(); //     . file.rewind(); } catch (ErrnoException ex) { //   } }</span></span></code> </pre><br>  <a href="http://dlang.org/phobos/std_stdio.html">Documentation</a> <br><br><h3>  Write the bytes to the file. </h3><br>  This example shows how to write bytes to a file. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.exception; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.stdio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { byte[] data = [<span class="hljs-number"><span class="hljs-number">0x68</span></span>, <span class="hljs-number"><span class="hljs-number">0x65</span></span>, <span class="hljs-number"><span class="hljs-number">0x6c</span></span>, <span class="hljs-number"><span class="hljs-number">0x6c</span></span>, <span class="hljs-number"><span class="hljs-number">0x6f</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> file = File(<span class="hljs-string"><span class="hljs-string">"test.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"w"</span></span>); file.rawWrite(data); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ErrnoException ex) { <span class="hljs-comment"><span class="hljs-comment">//   } }</span></span></code> </pre><br>  <a href="http://dlang.org/phobos/std_stdio.html">Documentation</a> <br><br><h3>  Quick write to file </h3><br>  Sometimes it‚Äôs great to just dump the data buffer to a file and leave the library open and close.  The following example shows how this is done. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.file; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { write(<span class="hljs-string"><span class="hljs-string">"test.txt"</span></span>, [<span class="hljs-number"><span class="hljs-number">0x68</span></span>, <span class="hljs-number"><span class="hljs-number">0x65</span></span>, <span class="hljs-number"><span class="hljs-number">0x6c</span></span>, <span class="hljs-number"><span class="hljs-number">0x6c</span></span>, <span class="hljs-number"><span class="hljs-number">0x6f</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (FileException ex) { <span class="hljs-comment"><span class="hljs-comment">//   } }</span></span></code> </pre><br>  This is writing a byte array to a file, but it could just as easily have been a string. <br><br>  <a href="http://dlang.org/phobos/std_file.html">Documentation</a> <br><br><h3>  Write lines to file </h3><br>  When working with files, there is always a lot of writing and reading lines from a file.  The following are various ways to write a string to a file. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.exception; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.stdio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> file = File(<span class="hljs-string"><span class="hljs-string">"test.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"w"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  . file.write("1: Lorem ipsum\n"); //  ,      . file.writeln("2: Lorem ipsum"); //   . file.writef("3: %s", "Lorem ipsum\n"); //   ,      . file.writefln("4: %s", "Lorem ipsum"); } catch (ErrnoException ex) { //   } }</span></span></code> </pre><br>  These methods may be more convenient depending on different scenarios. <br><br>  <a href="http://dlang.org/phobos/std_stdio.html">Documentation</a> <br><br><h3>  Using I / O Buffer Before Writing To File </h3><br>  As an optimization technique, it is sometimes necessary to write data to a buffer in RAM before writing to a file in order to save on <a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D0%25B2%25D0%25BE%25D0%25B4-%25D0%25B2%25D1%258B%25D0%25B2%25D0%25BE%25D0%25B4">I / O to disk</a> .  The following example shows one of the many ways to create and write such a buffer. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.file; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.outbuffer; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> buffer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OutBuffer(); ubyte[] data = [<span class="hljs-number"><span class="hljs-number">0x68</span></span>, <span class="hljs-number"><span class="hljs-number">0x65</span></span>, <span class="hljs-number"><span class="hljs-number">0x6c</span></span>, <span class="hljs-number"><span class="hljs-number">0x6c</span></span>, <span class="hljs-number"><span class="hljs-number">0x6f</span></span>]; buffer.write(data); buffer.write(<span class="hljs-string"><span class="hljs-string">' '</span></span>); buffer.write(<span class="hljs-string"><span class="hljs-string">"world"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { write(<span class="hljs-string"><span class="hljs-string">"test.txt"</span></span>, buffer.toBytes()); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (FileException ex) { <span class="hljs-comment"><span class="hljs-comment">//   } }</span></span></code> </pre><br>  Using the buffer in this way allows you to quickly write data to memory before writing to disk.  This saves time in the absence of small stages of writing to a disc and reduces wear on the disc itself. <br><br>  <a href="http://dlang.org/phobos/std_outbuffer.html">Documentation</a> <br><br><h3>  Read bytes from the file </h3><br>  The following example shows how to read bytes from a file. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.exception; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.stdio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { byte[] buffer; buffer.length = <span class="hljs-number"><span class="hljs-number">1024</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> file = File(<span class="hljs-string"><span class="hljs-string">"test.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"r"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> data = file.rawRead(buffer); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ErrnoException ex) { <span class="hljs-comment"><span class="hljs-comment">//   } }</span></span></code> </pre><br>  When reading bytes in this way, you must provide a buffer that will accept read data.  In this example, a <a href="http://dlang.org/arrays.html">dynamic array is</a> used for such a buffer and 1024 bytes are allocated before reading.  The <code>rawRead</code> method fills the buffer and returns a <a href="http://dlang.org/d-array-article.html">slice of</a> this buffer.  The buffer length is the maximum number of bytes that will be read. <br><br>  <a href="http://dlang.org/phobos/std_stdio.html">Documentation</a> <br><br><h3>  Quick read from file </h3><br>  Sometimes it is great to just read the data from the file and leave the library to open and close the file.  Below is how to do it. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.file; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> data = cast(byte[]) read(<span class="hljs-string"><span class="hljs-string">"test.txt"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (FileException ex) { <span class="hljs-comment"><span class="hljs-comment">//   } }</span></span></code> </pre><br>  As a result, an array of type <a href="https://ru.wikipedia.org/wiki/Void">void is</a> returned.  It can be <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25B8%25D0%25B2%25D0%25B5%25D0%25B4%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25B0">reduced</a> to some more useful type.  In this example, it has been cast to a "byte array" type. <br><br>  <a href="http://dlang.org/phobos/std_file.html">Documentation</a> <br><br><h3>  Read n bytes from file </h3><br>  In this example, the <code>read</code> function is used again, but this time with the second parameter specifying the maximum number of bytes to read.  If the file is less than the specified limit, only the data from the file will be returned. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.file; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> data = cast(byte[]) read(<span class="hljs-string"><span class="hljs-string">"test.txt"</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (FileException ex) { <span class="hljs-comment"><span class="hljs-comment">//   } }</span></span></code> </pre><br>  As in the previous cases, the result can be converted to other types of arrays. <br><br>  <a href="http://dlang.org/phobos/std_file.html">Documentation</a> <br><br><h3>  Reading a file in chunks </h3><br>  In the following example, the file is read in portions of 1024 bytes. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.exception; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.stdio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> file = File(<span class="hljs-string"><span class="hljs-string">"test.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"r"</span></span>); foreach (buffer; file.byChunk(<span class="hljs-number"><span class="hljs-number">1024</span></span>)) { <span class="hljs-comment"><span class="hljs-comment">//   buffer } } catch (ErrnoException ex) { //   } }</span></span></code> </pre><br>  The <code>byChunk</code> method returns an <a href="http://dlang.org/phobos/std_range.html">input</a> byte <a href="http://dlang.org/phobos/std_range.html">range</a> that reads only a specified portion of a file descriptor at a time.  In this case, each call will return a maximum of 1024 bytes.  For each call, the buffer is used again, so if you need to save data between calls, you need to copy it. <br><br>  <a href="http://dlang.org/phobos/std_stdio.html">Documentation</a> <br><br><h3>  We read lines from the file </h3><br>  These examples show how to read lines from a file. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.exception; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.stdio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> file = File(<span class="hljs-string"><span class="hljs-string">"test.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"r"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> line; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((line = file.readln()) !is null) { <span class="hljs-comment"><span class="hljs-comment">//   line } } catch (ErrnoException ex) { //   } }</span></span></code> </pre><br>  Although the above example is convenient for reading lines from a file, it has one drawback: the <code>readln</code> function allocates a new buffer to read each line. <br><br>  Because of this, due to a possible performance problem, there is an <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B3%25D1%2580%25D1%2583%25D0%25B7%25D0%25BA%25D0%25B0_%25D0%25BF%25D1%2580%25D0%25BE%25D1%2586%25D0%25B5%25D0%25B4%25D1%2583%25D1%2580_%25D0%25B8_%25D1%2584%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25B9">overloaded method</a> that takes a buffer as a parameter: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.exception; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.stdio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> file = File(<span class="hljs-string"><span class="hljs-string">"test.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"r"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] buffer; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (file.readln(buffer)) { <span class="hljs-comment"><span class="hljs-comment">//   buffer } } catch (ErrnoException ex) { //   } }</span></span></code> </pre><br>  This buffer can then be used again for each row read (which improves performance).  The disadvantage of this method is that if you need to save data between calls, you have to copy it.  D lets you decide which is best. <br><br>  <a href="http://dlang.org/phobos/std_stdio.html">Documentation</a> <br><br><h3>  We read the file as a range of lines </h3><br>  Reading a file as a range allows you to use a variety of typical algorithms defined in the <a href="http://dlang.org/phobos/index.html">Phobos</a> library.  The example below shows how this is done. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.exception; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.stdio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> file = File(<span class="hljs-string"><span class="hljs-string">"test.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"r"</span></span>); foreach (line; file.byLine) { <span class="hljs-comment"><span class="hljs-comment">//   line } } catch (ErrnoException ex) { //   } }</span></span></code> </pre><br>  The <code>byLine</code> method returns an input range that reads one line at a time from a file descriptor.  With each call, the buffer is used again, so if you need to save data between calls, you must copy it.  However, there is a convenient <code>byLineCopy</code> method that does this automatically. <br><br>  <a href="http://dlang.org/phobos/std_stdio.html">Documentation</a> <br><br><h3>  Fast reading of the whole file as one line </h3><br>  The following shows how to read the entire file into a single variable of type "string". <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.file; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.utf; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    UTF8-. auto utf8Data = readText("test.txt"); //    UTF16-. auto utf16Data = readText!(wstring)("test.txt"); //    utf32-.. auto utf32Data = readText!(dstring)("test.txt"); } catch (UTFException ex) { //    } catch (FileException ex) { //   } }</span></span></code> </pre><br>  This code reads and checks the text file.  Conversion of encodings (character widths) is not performed.  If the width of characters in the file does not match the specified string type, validation will fail. <br><br>  <a href="http://dlang.org/phobos/std_file.html">Documentation</a> <br><br><h2>  Basic operations </h2><br><h3>  Creating an empty file </h3><br>  The following code creates an empty file (if it does not already exist) when initializing a <code>File</code> type structure.  If a file with the same name already exists, its contents are deleted, and the file is considered empty. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.exception; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { File(<span class="hljs-string"><span class="hljs-string">"test.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"w"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ErrnoException ex) { <span class="hljs-comment"><span class="hljs-comment">//   } }</span></span></code> </pre><br>  <a href="http://dlang.org/phobos/std_stdio.html">Documentation</a> <br><br><h3>  Check for the existence of a file </h3><br>  This code simply checks if the file exists. <br><br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.file; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (exists(<span class="hljs-string"><span class="hljs-string">"test.txt"</span></span>)) { <span class="hljs-comment"><span class="hljs-comment">//   } }</span></span></code> </pre><br>  <a href="http://dlang.org/phobos/std_file.html">Documentation</a> <br><br><h3>  Rename and move file </h3><br>  This code renames and / or moves the file.  If the target file exists, it will be overwritten. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.file; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { rename(<span class="hljs-string"><span class="hljs-string">"source.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"destination.txt"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (FileException ex) { <span class="hljs-comment"><span class="hljs-comment">//   } }</span></span></code> </pre><br>  <a href="http://dlang.org/phobos/std_file.html">Documentation</a> <br><br><h3>  Copy file </h3><br>  This code copies the file.  If the target file exists, it will be overwritten. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.file; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { copy(<span class="hljs-string"><span class="hljs-string">"source.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"destination.txt"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (FileException ex) { <span class="hljs-comment"><span class="hljs-comment">//   } }</span></span></code> </pre><br>  <a href="http://dlang.org/phobos/std_file.html">Documentation</a> <br><br><h3>  Delete file </h3><br>  This code simply deletes the file. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.file; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { remove(<span class="hljs-string"><span class="hljs-string">"test.txt"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (FileException ex) { <span class="hljs-comment"><span class="hljs-comment">//   } }</span></span></code> </pre><br>  <a href="http://dlang.org/phobos/std_file.html">Documentation</a> <br><br><h3>  Getting file information </h3><br>  This code receives information about the file just as you would have done with the <a href="https://en.wikipedia.org/wiki/Stat_(system_call)">stat</a> command ( <em>English: sorry, there is no Russian-language article in Wikipedia</em> ) in a <a href="https://ru.wikipedia.org/wiki/POSIX">POSIX-compatible</a> operating system.  Below is shown getting only cross-platform information.  Other information is available depending on the operating system; it can be obtained by decoding the <code>attributes</code> property. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.file; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.stdio : writefln; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> file = DirEntry(<span class="hljs-string"><span class="hljs-string">"test.txt"</span></span>); writefln(<span class="hljs-string"><span class="hljs-string">" : %s"</span></span>, file.name); writefln(<span class="hljs-string"><span class="hljs-string">" : %s"</span></span>, file.isDir); writefln(<span class="hljs-string"><span class="hljs-string">" : %s"</span></span>, file.isFile); writefln(<span class="hljs-string"><span class="hljs-string">"  : %s"</span></span>, file.isSymlink); writefln(<span class="hljs-string"><span class="hljs-string">"  : %s"</span></span>, file.size); writefln(<span class="hljs-string"><span class="hljs-string">"  : %s"</span></span>, file.timeLastAccessed); writefln(<span class="hljs-string"><span class="hljs-string">"  : %s"</span></span>, file.timeLastModified); writefln(<span class="hljs-string"><span class="hljs-string">": %b"</span></span>, file.attributes); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (FileException ex) { <span class="hljs-comment"><span class="hljs-comment">//   } }</span></span></code> </pre><br>  <a href="http://dlang.org/phobos/std_file.html">Documentation</a> <br><br><h3>  Truncate existing file </h3><br>  This code truncates the existing file to 100 bytes.  If the source file is smaller, truncation does not occur. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.file; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> file = <span class="hljs-string"><span class="hljs-string">"test.txt"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> size = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.exists() &amp;&amp; file.isFile()) { write(file, read(file, size)); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (FileException ex) { <span class="hljs-comment"><span class="hljs-comment">//   } }</span></span></code> </pre><br>  <a href="http://dlang.org/phobos/std_file.html">Documentation</a> <br><br><h2>  Archiving </h2><br><h3>  Create zip archive </h3><br>  Based on the following examples, this code shows how to create a zip archive. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.file; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.outbuffer; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.zip; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArchiveMember(); file.name = <span class="hljs-string"><span class="hljs-string">"test.txt"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OutBuffer(); data.write(<span class="hljs-string"><span class="hljs-string">"Lorem ipsum"</span></span>); file.expandedData = data.toBytes(); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> zip = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ZipArchive(); zip.addMember(file); write(<span class="hljs-string"><span class="hljs-string">"test.zip"</span></span>, zip.build()); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ZipException ex) { <span class="hljs-comment"><span class="hljs-comment">//   } }</span></span></code> </pre><br>  <a href="http://dlang.org/phobos/std_zip.html">Documentation</a> <br><br><h3>  Zip archive reading </h3><br>  The following example shows how to read a zip archive. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.file; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.zip; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> zip = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ZipArchive(read(<span class="hljs-string"><span class="hljs-string">"test.zip"</span></span>)); foreach (filename, member; zip.directory) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> data = zip.expand(member); <span class="hljs-comment"><span class="hljs-comment">//   data } } catch (ZipException ex) { //   } }</span></span></code> </pre><br>  <a href="http://dlang.org/phobos/std_zip.html">Documentation</a> <br><br><h2>  Data compression </h2><br><h3>  Write compressed data to file </h3><br>  The following example shows how to compress data before sending it to a file. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.file; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.zlib; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> data = compress(<span class="hljs-string"><span class="hljs-string">"Lorem ipsum dolor sit amet"</span></span>); write(<span class="hljs-string"><span class="hljs-string">"test.dat"</span></span>, data); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ZlibException ex) { <span class="hljs-comment"><span class="hljs-comment">//   } }</span></span></code> </pre><br>  In the previous example, the string is compressed, but you can compress any data.  The <code>std.zlib</code> module uses the C language <a href="http://www.zlib.net/">Zlib</a> library. <br><br>  <a href="http://dlang.org/phobos/std_zlib.html">Documentation</a> <br><br><h3>  Reading compressed data from a file </h3><br>  The following shows how to read compressed data from a file. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.file; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.zlib; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> data = uncompress(read(<span class="hljs-string"><span class="hljs-string">"test.dat"</span></span>)); <span class="hljs-comment"><span class="hljs-comment">//    } catch (ZlibException ex) { //   } }</span></span></code> </pre><br>  <a href="http://dlang.org/phobos/std_zlib.html">Documentation</a> <br><br><h2>  POSIX operations </h2><br><h3>  Change file permissions </h3><br>  This code modifies file permissions on <a href="https://ru.wikipedia.org/wiki/POSIX">POSIX-compatible</a> operating systems, such as <a href="https://ru.wikipedia.org/wiki/Linux">Linux</a> or <a href="https://ru.wikipedia.org/wiki/Mac_OS">Mac OS</a> .  The <a href="http://dlang.org/phobos/index.html">Phobos</a> library does not have a cross-platform solution for this task, so we can only use POSIX-specific <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25B2%25D1%258B%25D0%25B7%25D0%25BE%25D0%25B2">system calls</a> . <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> core.stdc.errno; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> core.sys.posix.sys.stat; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.conv; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> file = <span class="hljs-string"><span class="hljs-string">"test.txt"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> result = chmod(file.toStringz(), octal!(<span class="hljs-number"><span class="hljs-number">666</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result != <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(errno) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> EPERM: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> EACCES: <span class="hljs-comment"><span class="hljs-comment">//   break; case ENOENT: //    break; default: //    break; } } }</span></span></code> </pre><br>  The <code>chmod</code> system call works exactly the same as the <code>chmod</code> from <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25BC%25D0%25B0%25D0%25BD%25D0%25B4%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25BE%25D0%25B1%25D0%25BE%25D0%25BB%25D0%25BE%25D1%2587%25D0%25BA%25D0%25B0_UNIX">the Unix shell</a> .  The file name and its new <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25B0%25D0%25B2%25D0%25B0_%25D0%25B4%25D0%25BE%25D1%2581%25D1%2582%25D1%2583%25D0%25BF%25D0%25B0">permissions</a> (expressed as an <a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D0%25BE%25D1%2581%25D1%258C%25D0%25BC%25D0%25B5%25D1%2580%25D0%25B8%25D1%2587%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2581%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2581%25D1%2587%25D0%25B8%25D1%2581%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F">octal</a> number) are indicated.  To modify a file this way, you need permissions on the operation itself.  To do this, you need to be the owner of the file or <a href="https://ru.wikipedia.org/wiki/Root">superuser</a> . <br><br>  <a href="https://ru.wikipedia.org/wiki/Chmod">Documentation</a> <br><br><h3>  File ownership change </h3><br>  This code changes the ownership of the file on POSIX-compatible systems.  When you become the owner, you can change the permissions of the file without being the superuser. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> core.stdc.errno; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> core.sys.posix.pwd; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> core.sys.posix.unistd; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> username = <span class="hljs-string"><span class="hljs-string">"gary"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> file = <span class="hljs-string"><span class="hljs-string">"test.txt"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> record = getpwnam(username.toStringz()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (record !is null) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> user = record.pw_uid; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> group = record.pw_gid; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> result = chown(file.toStringz(), user, group); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result != <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(errno) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> EPERM: <span class="hljs-comment"><span class="hljs-comment">//   break; default: //    break; } } } }</span></span></code> </pre><br>  The <code>chown</code> system call works exactly the same as the Unix shell's <code>chown</code> command.  The file name and its new owner and group are indicated.  To change the owner of the file, your program must have superuser rights. <br><br>  <a href="https://en.wikipedia.org/wiki/Chown">Documentation</a> <br><br><h3>  Creating hard and symbolic links </h3><br>  Sometimes in POSIX-compatible systems, you may need to create a <a href="https://ru.wikipedia.org/wiki/%25D0%2596%25D1%2591%25D1%2581%25D1%2582%25D0%25BA%25D0%25B0%25D1%258F_%25D1%2581%25D1%2581%25D1%258B%25D0%25BB%25D0%25BA%25D0%25B0">hard</a> or <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D0%25BC%25D0%25B2%25D0%25BE%25D0%25BB%25D1%258C%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2581%25D1%2581%25D1%258B%25D0%25BB%25D0%25BA%25D0%25B0">symbolic</a> link.  The following example shows how to create a hard link. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> core.stdc.errno; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> core.sys.posix.unistd; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> file = <span class="hljs-string"><span class="hljs-string">"test.txt"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> linked = <span class="hljs-string"><span class="hljs-string">"link.txt"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> result = link(file.toStringz(), linked.toStringz()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result != <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(errno) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> EPERM: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> EACCES: <span class="hljs-comment"><span class="hljs-comment">//   break; case EEXIST: //       break; case ENOENT: //    default: //    break; } } }</span></span></code> </pre><br>  To create a symbolic link, replace the line <br> <code>auto result = link(file.toStringz(), linked.toStringz());</code> <br>  by string <br> <code>auto result = symlink(file.toStringz(), linked.toStringz());</code> <br> <br><h2>  Conclusion </h2><br>  Rarely, there is one canonical way of working with files, and developers like to perform different file tasks in their own, special way.  I hope this article showed the power and convenience of the D language and allowed us to select the convenient functions of the standard library for working with files. </div><p>Source: <a href="https://habr.com/ru/post/270189/">https://habr.com/ru/post/270189/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270175/index.html">Microsoft will refuse to support digital certificates based on SHA-1</a></li>
<li><a href="../270179/index.html">The most important argument against MySQL?</a></li>
<li><a href="../270181/index.html">Android and iOS applications send user data to third parties much more often than is commonly believed.</a></li>
<li><a href="../270185/index.html">CLion 1.2: even more features and benefits</a></li>
<li><a href="../270187/index.html">Build your own failover cloud based on OpenNebula with Ceph, MariaDB Galera Cluster and OpenvSwitch</a></li>
<li><a href="../270191/index.html">On the thirtieth anniversary of the first C ++ compiler: look for errors in Cfront</a></li>
<li><a href="../270193/index.html">Not a flux</a></li>
<li><a href="../270195/index.html">The book "The Perfect Programmer. How to become a software development professional?</a></li>
<li><a href="../270197/index.html">SAP - ABAP. Modifying a summary line in the ALV grid</a></li>
<li><a href="../270199/index.html">Translation agreement with Apple Developer Program License Agreement</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>