<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Muller's recurrent relation: problems with rounding floating-point numbers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago I came across an exercise that doesn‚Äôt look that difficult: 

 Let the sequence x n be defined as: 

 count x 30 . 

 This is not so dif...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Muller's recurrent relation: problems with rounding floating-point numbers</h1><div class="post__text post__text-html js-mediator-article">  Some time ago I came across an exercise that doesn‚Äôt look that difficult: <br><br>  Let the sequence <i>x <sub>n be</sub></i> defined as: <br><img src="https://habrastorage.org/files/30c/b91/aad/30cb91aad7fc44c79a1eb5422e44469d.png"><br>  count <i>x <sub>30</sub></i> . <br><br>  This is not so difficult to encode, perhaps implementing <i>x <sub>i</sub></i> as a recursive function.  With ordinary double-precision floating point numbers, as <i>i</i> increases, the result converges nicely to 100. Super! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Unfortunately, 100 is not even the closest answer.  In fact, the sequence converges to 5. <br><a name="habracut"></a><br><h3>  Problem </h3><br>  This sequence is known as the Muller Recurrent Relationship and has been synthesized specifically to demonstrate how quickly and dramatically round-off floating-point errors lead to catastrophic results, under the right (well, wrong) conditions.  <a href="http://www.cs.berkeley.edu/~wkahan/Mindless.pdf">This paper (pdf)</a> details the various dangers of rounding, in particular, and this sequence (p. 14).  Another description of the problem can be found <a href="http://www.cs.berkeley.edu/~wkahan/Math128/M128Bsoln09Feb04.pdf">here (pdf)</a> . <br><br>  I think that many programmers, including me, realize that the math of floating-point numbers can go wrong in some situations, but dismiss the problem, believing that this can happen only if very large or very small numbers are involved in the calculations, or when accumulates a huge number of errors.  This exercise with innocent-looking constants and a small number of iterations perfectly demonstrates that rounding errors can have a significant impact even besides extreme numbers.  In this case, the instability of a fixed point 5 leads to the fact that even small errors significantly change the result. <br><br>  I can add nothing more, but I think that this problem is worth sharing. <br><br><h3>  Calculating the correct result </h3><br>  We can compare the first hundred values ‚Äã‚Äãof a sequence between ordinary floating point numbers and arithmetic with arbitrary precision using a short Mathematica program.  We use the convenient syntax of Mathematica memos, so the calculations take place quite quickly even for 100 or more iterations. <br><br>  <font><font color="#008b8b">f</font> [ <font color="#0000ff"><b>y_</b></font> , <font color="#0000ff"><b>z_</b></font> ] <font color="#0000ff"><b>: =</b></font> <font color="#0000ff"><b>108</b></font> <font color="#0000ff"><b>-</b></font> ( <font color="#0000ff"><b>815</b></font> <font color="#0000ff"><b>-</b></font> <font color="#0000ff"><b>1500</b></font> <font color="#0000ff"><b>/</b></font> z) <font color="#0000ff"><b>/</b></font> y;</font> <font><br><br></font>  <font><font color="#008b8b">xExact</font> [ <font color="#0000ff"><b>0</b></font> ] <font color="#0000ff"><b>=</b></font> <font color="#0000ff"><b>4</b></font> ;</font> <font><br></font>  <font><font color="#008b8b">xExact</font> [ <font color="#0000ff"><b>1</b></font> ] <font color="#0000ff"><b>=</b></font> <font color="#008b8b">17/4</font> ;</font> <font><br></font>  <font><font color="#008b8b">xExact</font> [ <font color="#0000ff"><b>n_</b></font> ] <font color="#0000ff"><b>: =</b></font> <font color="#008b8b">xExact</font> [n] <font color="#0000ff"><b>=</b></font> <font color="#008b8b">f</font> [ <font color="#008b8b">xExact</font> [n <font color="#0000ff"><b>-</b></font> <font color="#0000ff"><b>1</b></font> ], <font color="#008b8b">xExact</font> [n <font color="#0000ff"><b>-</b></font> <font color="#0000ff"><b>2</b></font> ]];</font> <font><br><br></font>  <font><font color="#008b8b">xFloat</font> [ <font color="#0000ff"><b>0</b></font> ] <font color="#0000ff"><b>=</b></font> <font color="#0000ff"><b>4</b></font> ;</font> <font><br></font>  <font><font color="#008b8b">xFloat</font> [ <font color="#0000ff"><b>1</b></font> ] <font color="#0000ff"><b>=</b></font> <font color="#0000ff"><b>4.25</b></font> ;</font> <font><br></font>  <font><font color="#008b8b">xFloat</font> [ <font color="#0000ff"><b>n_</b></font> ] <font color="#0000ff"><b>: =</b></font> <font color="#008b8b">xFloat</font> [n] <font color="#0000ff"><b>=</b></font> <font color="#008b8b">f</font> [ <font color="#008b8b">xFloat</font> [n <font color="#0000ff"><b>-</b></font> <font color="#0000ff"><b>1</b></font> ], <font color="#008b8b">xFloat</font> [n <font color="#0000ff"><b>-</b></font> <font color="#0000ff"><b>2</b></font> ]];</font> <font><br><br></font>  <font><font color="#008b8b">TableForm</font> [</font> <font><br></font>  <font><font color="#008b8b">Table</font> [{i, <font color="#008b8b">N</font> [ <font color="#008b8b">xExact</font> [i], <font color="#0000ff"><b>20</b></font> ], <font color="#008b8b">N</font> [ <font color="#008b8b">xFloat</font> [i], <font color="#0000ff"><b>20</b></font> ]}, {i, <font color="#0000ff"><b>0</b></font> , <font color="#0000ff"><b>100</b></font> }],</font> <font><br></font>  <font>TableHeadings <font color="#0000ff"><b>-&gt;</b></font></font> <font><br></font>  <font>{ <font color="#008b8b">None</font> , { <font color="#00cd00">"i"</font> , <font color="#00cd00">"x [i] \" exact \ ""</font> , <font color="#00cd00">"x [i] floating point"</font> }}</font> <font><br></font> <div class="spoiler">  <b class="spoiler_title">Results:</b> <div class="spoiler_text"><pre> ix [i] "exact" x [i] floating point
 -------------------------------------------------- -
 0 4.00000000000000000 4.0000000000000000000
 1 4.25000000000000000000 4.25
 2 4.4705882352941176471 4.47059
 3 4.6447368421052631579 4.64474
 4 4.7705382436260623229 4.77054
 5 4.8557007125890736342 4.8557
 6 4.9108474990827932004 4.91085
 7 4.9455374041239167248 4.94554
 8 4.9669625817627005987 4.96696
 9 4.9800457013556311613 4.98004
 10 4.9879794484783922601 4.98791
 11 4.9927702880620680975 4.99136
 12 4.9956558915066340266 4.96746
 13 4.9973912683813441129 4.42971
 14 4.9984339439448169190-7.81676
 15 4.9990600719708938678 168.943
 16 4.9994359371468391480 102.04
 17 4.9996615241037675378 100.1
 18 4.9997969007134179127 100.005
 19 4.9998781354779312492 100.
 20 4.9999268795045999045 100.
 21 4.9999561270611577381 100.
 22 4.9999736760057124446 100.
 23 4.9999842055202727079 100.
 24 4.9999905232822276594 100.
 25 4.9999943139585595936,100.
 26 4.9999965883712560237 100.
 27 4.9999979530213569080 100.
 28 4.9999987718123113300 100.
 29 4.9999992630872057846 100.
 30 4.9999995578522583059 100.
 31 4.9999997347113315242 100.
 32 4.9999998408267904691 100.
 33 4.9999999044960712411 100.
 34 4.9999999426976416502 100.
 35 4.9999999656185845961 100.
 36 4.9999999793711506158 100.
 37 4.9999999876226903184 100.
 38 4.9999999925736141727 100.
 39 4.9999999955441684970 100.
 40 4.9999999973265010958 100.
 41 4.9999999983959006566 100.
 42 4.9999999990375403937 100.
 43 4.9999999994225242361 100.
 44 4.9999999996535145416 100.
 45 4.9999999997921087250 100.
 46 4.9999999998752652350 100.
 47 4.9999999999251591410 100.
 48 4.9999999999550954846 100.
 49 4.9999999999730572908 100.
 50 4.9999999999838343745 100.
 51 4.9999999999903006247 100.
 52 4.9999999999941803748 100.
 53 4.9999999999965082249 100.
 54 4.9999999999979049349 100.
 55 4.9999999999987429610 100.
 56 4.9999999999992457766 100.
 57 4.9999999999995474659 100.
 58 4.9999999999727284796 100.
 59 4.9999999999998370877 100.
 60 4.9999999999999022526 100.
 61 4.9999999999999413516 100.
 62 4.9999999999999648110 100.
 63 4.9999999999979788866 100.
 64 4.9999999999999873319 100.
 65 4.9999999999999923992 100.
 66 4.9999999999999954395 100.
 67 4.9999999999999972637 100.
 68 4.9999999999999983582 100.
 69 4.9999999999999990149 100.
 70 4.9999999999999994090 100.
 71 4.9999999999999996454 100.
 72 4.9999999999999997872 100.
 73 4.9999999999999998723 100.
 74 4.9999999999999999234 100.
 75 4.9999999999999999540 100.
 76 4.9999999999999999724 100.
 77 4.9999999999999999835 100.
 78 4.9999999999999999901 100.
 79 4.9999999999999999940 100.
 80 4.9999999999999999964 100.
 81 4.9999999999999999979 100.
 82 4.9999999999999999987 100.
 83 4.9999999999999999992 100.
 84 4.9999999999999999995 100.
 85 4.9999999999999999997 100.
 86 4.9999999999999999998 100.
 87 4.9999999999999999999 100.
 88 4.9999999999999999999 100.
 89 5.00000000000000000 100.
 90 5.00000000000000000 100.
 91 5.00000000000000000 100.
 92 5.00000000000000000 100.
 93 5.00000000000000000 100.
 94 5.00000000000000000 100.
 95 5.00000000000000000 100.
 96 5.00000000000000000 100.
 97 5.00000000000000000 100.
 98 5.00000000000000000 100.
 99 5.00000000000000000 100.
 100 5.00000000000000000 100.
</pre><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/258483/">https://habr.com/ru/post/258483/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../258469/index.html">Internet of Things (IoT) and plumbing</a></li>
<li><a href="../258471/index.html">Not only software one we are alive from now on. Congratulations on the emergence of a new hub "Circuitry"</a></li>
<li><a href="../258475/index.html">Big Data: current reality</a></li>
<li><a href="../258477/index.html">Accessibility. How we make Yandex accessible to people with disabilities and why we consider it important.</a></li>
<li><a href="../258479/index.html">New features for application developers in Search Console</a></li>
<li><a href="../258485/index.html">Registration for the conference on computational linguistics "Dialogue" is open</a></li>
<li><a href="../258489/index.html">OpenEMS modeling basics</a></li>
<li><a href="../258491/index.html">64-bit code in 2015: what's new in diagnosing possible problems?</a></li>
<li><a href="../258495/index.html">About data transmission via audio jack</a></li>
<li><a href="../258499/index.html">OWASP TOP-10: A Practical View of Web Application Security</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>