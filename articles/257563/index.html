<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Street dirt and pedestrian traffic simulation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="With the arrival of spring and rain on the street, one problem is becoming increasingly common. This one: 



 I think familiar to all the inhabitants...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Street dirt and pedestrian traffic simulation</h1><div class="post__text post__text-html js-mediator-article">  With the arrival of spring and rain on the street, one problem is becoming increasingly common.  This one: <br><br><img src="https://habrastorage.org/files/f5b/fb2/cfb/f5bfb2cfbfd740ab850556dbd3d6ce0a.jpg"><br><br>  I think familiar to all the inhabitants of our cities.  Eternally trampled lawns turning into a mud swamp after each rain, through which pedestrians selflessly continue to make their way.  Pachkaya while clothing and carrying mud porridge on the pavement. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It is obvious that people here are generally not to blame, such is our nature - to always look for the shortest path.  And it would be nice if the layout of public areas to meet this aspiration.  But this, alas, is not so, and architects and planners with perseverance continue to draw paths and sidewalks along a ruler and with intersections at right angles, and pedestrians cut those corners wherever possible by trampling grass and spreading dirt. <br><br>  Somehow I walked along the track and sluggishly pondered about the fact that once again I would have to either go around or get my shoes dirty.  From a disturbance like ‚Äúthat's what fools design it for,‚Äù the thought flowed smoothly onto a bike heard about a certain science city, where the paths in the courtyards were not done at first, and then they simply asphalted people‚Äôs footpaths that were convenient for people.  And from there, thought migrated to the idea of ‚Äã‚Äã"why not do the same thing, but on the computer?".  Develop a program that, according to a given map, will predict where people will trample lawns and where it would be nice to make asphalt pavement? <br><br>  Under the cut - a description of the algorithm and a couple of examples of its work for real St. Petersburg courtyards. <br><a name="habracut"></a><br><br>  To begin with, we will look at how local authorities responsible for landscaping deal with the problem of walking on lawns. <br><br>  <b>Option One: put fences</b> <br>  In most cases, an inefficient way.  The fence will be broken sooner or later.  In the photo below it was broken and hung back many times already, throwing out money for nothing. <br><br><img src="https://habrastorage.org/files/41e/d80/e6c/41ed80e6cd374ceaae9858faf50e8ca0.JPG"><br><br>  <b>Option Two: admit error and correct</b> <br>  Yes, it also happens.  In this regard, I like the courtyards around Moskovsky Prospekt ‚Äî the paths there have been turned into normal paths, and no one walks the lawns anymore ‚Äî there is simply no need for that.  However, it all depends on the enthusiasm of local authorities - someone does, someone writes formal replies, promises to make it in 5 years when there will be money, and most often they are trying to fight according to the first method. <br><br><img src="https://habrastorage.org/files/8f5/cfc/f49/8f5cfcf49e674303a6ce029df53d9ab9.JPG"><br><br>  <b>Well, option three: to foresee and correct problems at the design stage.</b> <br>  Honestly, I have no idea what designers and developers are doing for this.  Judging by the schemes I have seen - nothing, they mold everything based solely on aesthetic considerations.  I would be happy if someone with experience in this field can say something in the comments. <br>  This option we will do. <br><br>  <b>Formulation of the problem</b> <br>  So what do we have?  And we have a map of the area on which there are: <br><ul><li>  Plots with varying degrees of terrain and attractiveness for pedestrians (paths, lawns) </li><li>  Obstacles (houses, fences) </li><li>  Places between which pedestrians move - entrances, stalls, shops - anything.  They will be called <i>pedestrian generators.</i> </li></ul><br>  It is necessary to predict exactly where pedestrians will walk on the lawns, so that on the basis of this it could be decided to create normal roads on the site. <br><br>  We immediately note two boundary cases that usually come to mind first as a solution.  The first one is a complete graph, that is, we simply take and connect each generator with each one, building roads in a straight line.  In words, simply, pedestrians will, of course, be comfortable, but in the end the whole yard will be rolled up into the asphalt, which is expensive and unaesthetic.  The second case is the minimum spanning tree of the graph, the peaks in which will be the generators.  Unfortunately, people are still not robots and do not walk on minimal spanning trees, which was shown by researchers to work "Modeling the Evolution of Human Trail Systems" (D. Helbing, J. Keltsch, P. Molnar.) The illustration to this statement can Serve the following image: <br><img src="https://habrastorage.org/files/3e9/9e6/168/3e99e6168fd44b8d8aea1bef36a93595.png"><br>  The system of full paths is shown on the left, and the system of paths between the points indicated as a result of experiments from the above-mentioned work is shown on the right.  It can be seen that it is neither complete nor spanning tree. <br><br>  As a result of some thoughts and study of articles on the simulation of pedestrian traffic, the following algorithm was invented and implemented. <br><br>  <b>Algorithm</b> <br><br>  <i>Training.</i> <br>  The map of the considered area of ‚Äã‚Äãthe territory is presented in the GeoJSON format.  On it are manually marked pedestrian generators and cross-sections of the landscape. <br><br>  <i>Initialization.</i>  Based on the map, the navigation graph <i>G (V, E)</i> is constructed.  The vertices of the graph <i>V</i> are the set of points of the terrain.  In this paper, the simplest method for constructing this set is chosen: a rectangular grid is superimposed on the map, its nodes become the vertices of the graph.  If a person can pass between two adjacent grid nodes, such nodes are connected by edges that make up the set <i>E.</i>  The initial weight of each edge e is represented as the difference of two components: a fixed <i>Wconst (e)</i> , determined by the type of terrain, and a variable <i>Wvar (e)</i> , which will be called later extrudedness.  Initially, it is zero.  Some types of terrain (hard surface tracks) may not have a variable component. <br>  Trampling is limited to zero (untouched lawn) from below, and from above, <i>Wmax</i> , selected so that even the most trampled path still is a little less attractive than a similar track. <br>  In addition, for each pedestrian <i>p, the</i> coefficient of decency <i>k (p)</i> is introduced.  This coefficient is used to simulate various categories of pedestrians - both ‚Äúdecent‚Äù, who always prefer to walk only along the paths, even if the final distance is much larger, and those who like to walk are always straight.  The formula for calculating the weight <i>W (e, p) of the</i> edge <i>e</i> for a pedestrian <i>p</i> is: <br><img src="https://habrastorage.org/files/b64/d4f/c96/b64d4fc961944850811ae15bd8267c4d.png"><br>  In this case, if the value of <i>k (p)&gt; 1, the</i> short straightened paths for this pedestrian will be more attractive, since the role of the <i>Wvar</i> component in the formula will be higher.  When <i>k &lt;1, you</i> get a ‚Äúdecent‚Äù pedestrian who will try to walk along the paths more often. <br><br>  <i>Simulation.</i> <br>  <i>P</i> pedestrians are evenly distributed on the generators.  Goals for them are selected randomly from the list of other generators.  The coefficient of decency <i>k (p)</i> is selected as follows: <br><img src="https://habrastorage.org/files/0b3/08a/107/0b308a10734d447689258cd10828c11c.png"><br>  Here <i>Kbad</i> is an obligatory share of dishonest pedestrians (to speed up the convergence of the algorithm, we assume that there is always a certain proportion of people in the community who <i>want to</i> move in the most direct and short ways), <i>N</i> is the normal distribution.  The values ‚Äã‚Äãof the coefficients are chosen empirically, the value 0.1 is selected for <i>Kbad</i> . <br><br>  At each step of the simulation, the following actions are performed: <br>  1) pedestrians walk a certain distance depending on a given speed of movement; <br>  2) trampling by the pedestrians of the graph edges increases by a fixed value of <i>‚àÜWped</i> for each pedestrian passing through them; <br>  3) pedestrians that have reached their goal are replaced with new ones; <br>  4) trampling of all edges of the graph is reduced by a fixed value <i>‚àÜWtime</i> (overgrowing with time). <br>  Thus, the total change in trampling for the edge e after the simulation step i looks like: <br><img src="https://habrastorage.org/files/db9/880/08c/db988008cc70448f9937608d33b06738.png"><br>  Here <i>Pcount (e, i)</i> is the number of pedestrians who passed at the <i>i</i> step along the edge <i>e</i> . <br>  Pedestrians pave a route using the heuristic algorithm A * c to straighten the paths (initially I used the banal Dijkstra, but on rectangular grids he likes to generate rather unnatural-looking paths).  The simulation continues either until convergence, until the map of paths stops changing, or a specified number of steps.  After the completion of the simulation, the map with the distribution of trampling demonstrates the areas where pedestrians most often go off the tracks to the ground, and which should be paved with a hard surface. <br><br>  <b>Work example</b> <br><br>  As an example of work, I will cite the same yard, which encouraged me to create this program.  This is the neighborhood of a residential building on Gagarin Avenue in St. Petersburg, in which I used to live and where I regularly walked around.  Actually there is a photo of my porch above, where the fence is tied with a ribbon, so my acquaintance with the blasphemy of planners and architects started right from the exit to the street. <br><br>  This is how this house looks from the satellite.  The house itself is in the middle, to the left and to the right of it are panel five-storey buildings.  On the right is a marked map of the area indicating the outlines of houses and obstacles. <br><br><img src="https://habrastorage.org/files/d81/83c/a0c/d8183ca0c80e4d1d929b4072d05bfea1.png"><br><br>  The scale and outlines of the obstacles are unfortunately rather approximate, since none of the cartographic services known to me contained a detailed plan for this yard, and the satellite images are not detailed enough. <br><br>  As a result of the simulation, after several hundred iterations, such a picture was drawn.  Black marks the programmed lawn trampling points: <br><br><img src="https://habrastorage.org/files/347/857/568/3478575681c741c2a0a551a9a8a213c2.png"><br><br>  For comparison, photos from reality that correspond to the numbered areas: <br><br>  <b>1 trail diagonally to the corner of the house</b> <br><img src="https://habrastorage.org/files/54e/c9a/642/54ec9a642b454f5dbe6699f01924bb76.jpg"><br><br>  <b>2 - path along the whole house</b> <br><img src="https://habrastorage.org/files/3ac/aea/4a1/3acaea4a18844deb91a56b0828ff2378.jpg"><br><br>  <b>3 - photo from the beginning of the article, trails from the entrance</b> <br><img src="https://habrastorage.org/files/41e/d80/e6c/41ed80e6cd374ceaae9858faf50e8ca0.JPG"><br><br>  In general, you can see that the predictions of the program are quite accurate. <br><br>  <b>Example 2</b> <br><br>  Well, I confess, I cheated a little and it was in this courtyard that I customized the parameters of the algorithm so as to get an option close to reality.  The parameters mainly related to the behavior of pedestrians - the speed of movement, the rate of overgrowing of the trails, the number of pedestrians, etc. <br><br>  Having adjusted the parameters on this and a couple of other neighboring courtyards, I took up another glaring example of design idiocy - Victory Park.  Several years ago, this park underwent redevelopment, in particular, for some reason, instead of a convenient wide road leading through the park from houses to the metro station, they made a huge round lawn, and let the road bypass. <br><br>  So, the prediction of the program: <br><br><img src="https://habrastorage.org/files/a06/772/eef/a06772eef67e45f4a06f8783540f3b9b.jpg"><br><br>  And a real satellite image (of course the unhappy lawn impatient citizens trampled so that it became visible even from space): <br><br><img src="https://habrastorage.org/files/d79/742/58e/d7974258ed0d4c7f84f0231195f1cd07.png"><br><br>  Of course, there are no smaller paths in this picture, but they are there (in fact, they are even more than the program predicted, but in general the configuration is very similar, I have enough photos, but I‚Äôm not going to upload them anyway, and so brute force).  Again, a certain discrepancy is due to the inaccuracy of the map - at the time of writing the original article, which was never published, there was still no new map of the park after reconstruction in any map services, it was necessary to draw it from memory and sketches. <br><br>  <b>findings</b> <br><br>  And the conclusions are very simple.  If somehow we managed to introduce such a tool to the place where we are engaged in designing courtyards, it would be better to live and the grass would become greener.  I myself recently moved to the ‚ÄúBaltic Pearl‚Äù - a new and modern microdistrict of St. Petersburg - and just grab my head when I see how yard passes are made there.  From the satellite probably looks beautiful, but absolutely non-functional.  The first photo in the article is from there.  Sending appeals to local authorities does not help - officially that area has not yet been transferred to the city, and no one is responsible for it.  It was necessary to do right from the start. <br><br>  But since I like to write code and don‚Äôt really like to impose it on someone, I don‚Äôt have a clue if I can do something with this situation, and if so, how.  Can someone from the browsers tell? <br><br>  <b>UPD:</b> in the comments ask about the code and the ability to run on their data.  For now, the implementation is more likely some kind of proof-of-concept, with a not very friendly interface.  Since this topic has caused interest, I will finish it in some more human form and post it a little later. <br><br>  <b>UPD 2:</b> completed, the application is available on <a href="http://antroadplanner.ru/">antroadplanner.ru Frontend</a> is not my specialty, so usability is lame in both legs.  But you can drive on your data. </div><p>Source: <a href="https://habr.com/ru/post/257563/">https://habr.com/ru/post/257563/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../257549/index.html">How I went to the clouds</a></li>
<li><a href="../257551/index.html">File formats for programs on FASM under Windows</a></li>
<li><a href="../257555/index.html">Frogger HD and numerical modeling of waves in the pond</a></li>
<li><a href="../257557/index.html">Choosing a cloud hosting: where to start?</a></li>
<li><a href="../257561/index.html">A new backup tool in InfoboxCloud: specify the appropriate time and backup schedule</a></li>
<li><a href="../257565/index.html">Why is the demonstration of video analytics in offices so different from the real work in life?</a></li>
<li><a href="../257571/index.html">"The problem of the doorbell" or when you think you know everything</a></li>
<li><a href="../257573/index.html">Amazon plans to use Tesla batteries in its data center</a></li>
<li><a href="../257579/index.html">Veeam Availability Suite 8.0 Update 2: support for vSphere 6, Veeam Endpoint Backup FREE, and more</a></li>
<li><a href="../257581/index.html">The ‚ÄúLedger‚Äù of Nutanix Bible is now available in Russian.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>