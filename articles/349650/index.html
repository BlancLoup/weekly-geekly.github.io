<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Continuous transitions between common elements: from RecyclerView to ViewPager</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Using transitions in Material Design gives the application visual continuity. While the user walks through the application, the interface elements in ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Continuous transitions between common elements: from RecyclerView to ViewPager</h1><div class="post__text post__text-html js-mediator-article"><p>  Using transitions in Material Design gives the application visual continuity.  While the user walks through the application, the interface elements in it change state.  The animations of transitions of relevant elements from one screen to another underline the idea that interfaces are tangible. </p><br><p>  The purpose of this article is to provide guidelines and implementations for certain continuous transitions between fragments of the Android OS.  We will show how to make the transition from the image to the RecyclerView into the image inside the ViewPager and vice versa, using ‚Äúshared elements‚Äù to determine how and what elements are involved in the transition.  We will also handle the difficult case of going back to the grid after paging on the page to an element that was originally outside the screen in the grid. </p><br><p>  Here is the result we want to achieve (animated version under the cut). </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/r1/ul/mb/r1ulmbab5cqg7juqhth6lntnvzm.png"></div><br><p>  If you want to skip the explanation and start learning the code right away, you will find it <a href="https://github.com/google/android-transition-examples/tree/master/GridToPager">here</a> . </p><br><p>  From the translator.  Further, there will be quite a lot of code and gifs (by estimation, megabytes at 20). </p><a name="habracut"></a><br><p><img src="https://habrastorage.org/webt/gg/lp/aw/gglpaw-wv2kl5cdiw78kgj8k2ja.gif"></p><br><h2>  What are common elements? </h2><br><p>  A transition using a common element defines how the views that are present on two fragments move between them.  For example, a picture that is shown in the ImageView, and in fragment A and fragment B, changes from A to B when B becomes visible. </p><br><p>  There are many previously published examples that explain how common elements work, and how to implement a basic transition between fragments.  In this article, the basics are omitted, and instead the conversation will go about the features of the implementation of the transition to the ViewPager and back.  However, if you want to learn more about transitions, I recommend starting reading about transitions on <a href="https://developer.android.com/training/material/animations.html">the Android developer site</a> and take time to view <a href="https://www.youtube.com/watch%3Fv%3D4L4fLrWDvAU">this presentation</a> on Google I / O 2016. </p><br><h2>  Difficulties </h2><br><h3 id="mapping-obschih-elementov">  Mapping common items </h3><br><p>  We want to provide seamless back and forth transitions.  This is both a transition from the grid to the details screen (in the original pager, and the term ‚Äúpage‚Äù will be used below), and a transition back to the relevant image in the grid when the user has scrolled through the page to another image. </p><br><p>  In order to do this, we need to find a way to dynamically reassign the mapping of common elements in order to provide the Android transition system with everything needed to do the magic! </p><br><h3 id="otlozhennaya-zagruzka">  Delayed loading </h3><br><p>  Transitions of common elements have powerful functionality, but it is still difficult to work with elements that need to be loaded before we can go to them.  The transition may simply not work as expected, if the views in the target fragment have not yet completed layout and are not loaded, for example, images. </p><br><p>  There are two areas in this project in which load time affects transitions between common elements: </p><br><ol><li>  The ViewPager takes several milliseconds to load its nested fragments.  It also takes time to upload a picture to the displayed fragment of the page (which can also include the time to download the picture over the network). </li><li>  RecyclerView also faces latency when loading images into its views. </li></ol><br><h2>  Design demo application </h2><br><h3 id="bazovaya-struktura">  Basic structure </h3><br><p>  Before we dive into the very pulp of transitions, let's discuss a little the structure of the demo application. </p><br><p><img src="https://habrastorage.org/webt/cq/lz/jb/cqlzjbsrwygyb1sk2rmvouc437e.png"></p><br><p>  MainActivity loads a GridFragment to display a RecyclerView consisting of images.  The RecyclerView adapter loads a list of images (an immutable array defined in the ItemData class) and manages onClick events by replacing the GridFragment fragment with an ImagePagerFragment fragment on the screen. </p><br><p>  The ImagePagerFragment adapter loads nested ImageFragments to display individual images while the user scrolls through the pages. </p><br><p>  <strong>Note</strong> : The demo application implementation uses the <a href="https://github.com/bumptech/glide">Glide</a> library to load images asynchronously into the view.  Pictures in the demo application are delivered with it.  However, you can easily correct the ImageData class for storing URLs pointing to images on the Internet. </p><br><h3 id="sinhronizaciya-vybrannoy-i-pokazannoy-poziciy">  Sync selected and displayed positions </h3><br><p>  To transfer the position of the selected picture between the fragments, we will use the MainActivity as a synchronization point. </p><br><p>  When clicking on an element or changing a page, the corresponding element number is transferred to MainActivity. </p><br><p>  The saved position is then used in several places: </p><br><ul><li>  To determine which page to display in the ViewPager. </li><li>  When returning to the grid and auto-scrolling to the position to make sure that the selected item is visible. </li><li>  And of course, for binding conversion handlers, as we will see in the next section. </li></ul><br><h2>  Conversion setup </h2><br><p>  As mentioned earlier, we need to find a way to dynamically change the mapping of common elements in order to give the transition system everything that is necessary for witchcraft. </p><br><p> Using static mapping using the <code>transitionName</code> attributes for an ImageView in XML markup does not work, since we are dealing with a set of views that use the same layout (for example, views collected by the RecyclerView adapter or viewers collected by ImageFragment). </p><br><p>  To achieve this, we will use the methods provided by the transition system. </p><br><ol><li>  We set the transition ID for the images by calling <code>setTransitionName</code> .  This will allow the view to be associated with a unique transition name.  <code>setTransitionName</code> is called when a view is binded in the RecyclerView adapter in the GridFragment grid, as well as in onCreateView in the ImageFragment.  In both places we use unique names or links to images as an identifier for the presentation. </li><li>  We customize <code>SharedElementCallbacks</code> to intercept <code>onMapSharedElements</code> and fix the mapping of common element names to the views.  This will be done when exiting the GridFragment and when entering the ImagePagerFragment. </li></ol><br><h3 id="nastroyka-tranzakcii-fragmentmanager">  Configuring the FragmentManager transaction </h3><br><p>  To initiate a transition to replace fragments, we first tweak something in preparation for the FragmentManager transaction.  We need to inform the system that we have a transition with common elements. </p><br><pre> <code class="java hljs">fragment.getFragmentManager() .beginTransaction() .setReorderingAllowed(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-comment"><span class="hljs-comment">// setAllowOptimization before 26.1.0 .addSharedElement(imageView, imageView.getTransitionName()) .replace(R.id.fragment_container, new ImagePagerFragment(), ImagePagerFragment.class.getSimpleName()) .addToBackStack(null) .commit();</span></span></code> </pre> <br><p>  In the code above, <code>setReorderingAllowed</code> to <code>true</code> .  This allows you to reorder state changes of the fragments to make the transition look better.  For the added fragment, <code>onCreate(Bundle)</code> will be called before the <code>onDestroy</code> call <code>onDestroy</code> the deleted fragment, which will allow you to create and place a common interface element before the transition begins. </p><br><h3 id="perehod-kartinki">  Transition pictures </h3><br><p>  To determine how the image is transformed during the animation of the transition to a new location, we will set up the TransitionSet in the XML file and load it into the ImagePagerFragment. </p><br><p> <code>&lt;ImagePagerFragment.java&gt;</code> </p> <br><pre> <code class="java hljs">Transition transition = TransitionInflater.from(getContext()) .inflateTransition(R.transition.image_shared_element_transition); setSharedElementEnterTransition(transition);</code> </pre> <br><p> <code>&lt;image_shared_element_transition.xml&gt;</code> </p> <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">transitionSet</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:duration</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"375"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:interpolator</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@android:interpolator/fast_out_slow_in"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:transitionOrdering</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"together"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">changeClipBounds</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">changeTransform</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">changeBounds</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">transitionSet</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3 id="izmenenie-sootvetstviya-obschih-elementov">  Changing the compliance of common elements </h3><br><p>  Let's start with the changes when exiting the GridFragment.  To do this, we will call <code>setExitSharedElementCallback()</code> and pass in it a <code>SharedElementCallback</code> which will map the names of the transitions to the views that we would like to include in the transition. </p><br><p>  It is important to note that this handler will be called upon output from the fragment during the processing of the fragment transaction, as well as upon entering the fragment, when it is pushed out of the backstack (during reverse navigation).  We use this behavior to make the mapping match the common views and fix the transition so as to handle the case when the view has changed after paging through the pages with pictures. </p><br><p>  In this special case, we are interested only in the transition of one ImageView from the grid to the fragment that now shows the ViewPager, so you only need to change the mapping for the <u>first</u> named element obtained in the <code>onMapSharedElements</code> handler. </p><br><p> <code>&lt;GridFragment.java&gt;</code> </p> <br><pre> <code class="java hljs">setExitSharedElementCallback( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SharedElementCallback() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onMapSharedElements</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( List&lt;String&gt; names, Map&lt;String, View&gt; sharedElements)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  ViewHolder   . RecyclerView.ViewHolder selectedViewHolder = recyclerView .findViewHolderForAdapterPosition(MainActivity.currentPosition); if (selectedViewHolder == null || selectedViewHolder.itemView == null) { return; } //        ImageView. sharedElements .put(names.get(0), selectedViewHolder.itemView.findViewById(R.id.card_image)); } });</span></span></code> </pre> <br><p>  We also need to change the mapping of common elements when entering the ImagePagerFragment. <br>  To do this, we call <code>setEnterSharedElementCallback()</code> . </p><br><pre> <code class="java hljs">setEnterSharedElementCallback( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SharedElementCallback() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onMapSharedElements</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( List&lt;String&gt; names, Map&lt;String, View&gt; sharedElements)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  ImageView    ( ImageFragment, //     ).   ,  // instantiateItem   . //           //     . Fragment currentFragment = (Fragment) viewPager.getAdapter() .instantiateItem(viewPager, MainActivity.currentPosition); View view = currentFragment.getView(); if (view == null) { return; } //        ImageView. sharedElements.put(names.get(0), view.findViewById(R.id.image)); } });</span></span></code> </pre> <br><h3 id="otkladyvanie-perehoda">  Postpone transition </h3><br><p>  Images that we would like to move during the transition process take some time to load into the grid and onto the page.  In order for everything to work correctly, we need to postpone the transition until the moment when the participating views are ready (for example, when layout is completed for them and pictures are loaded). </p><br><p>  To do this, we call <code>postponeEnterTransition()</code> in the <code>onCreateView()</code> method of our fragments, and when the picture is loaded, we start the transition by calling <code>startPostponedEnterTransition()</code> . </p><br><p>  <strong>Note</strong> : "defer" is called for both the grid and the page to provide forward and backward transitions when navigating the application. </p><br><p>  Since we use <em>Glide</em> to load images, we set up handlers that will trigger the transition after loading images. </p><br><p>  This must be done in two places: </p><br><ol><li>  When a picture is loaded into an ImageFragment, the parent ImagePagerFragment is called to start the transition. </li><li>  When returning to the grid, the transition starts when the selected image is loaded. </li></ol><br><p>  This is how ImageFragment loads a picture and notifies its parent of readiness. </p><br><p>  Note that the <code>postponeEnterTransition</code> call is made in the ImagePagerFragment, although <code>startPostponedEnterTransition</code> is called from a child ImageFragment </p><br><pre> <code class="java hljs">Glide.with(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) .load(arguments.getInt(KEY_IMAGE_RES)) <span class="hljs-comment"><span class="hljs-comment">//   .listener(new RequestListener&lt;Drawable&gt;() { @Override public boolean onLoadFailed(@Nullable GlideException e, Object model, Target&lt;Drawable&gt; target, boolean isFirstResource) { getParentFragment().startPostponedEnterTransition(); return false; } @Override public boolean onResourceReady(Drawable resource, Object model, Target&lt;Drawable&gt; target, DataSource dataSource, boolean isFirstResource) { getParentFragment().startPostponedEnterTransition(); return false; } }) .into((ImageView) view.findViewById(R.id.image));</span></span></code> </pre> <br><p>  As you can see, we also cause the start of the delayed transition in case the loading of the picture failed.  This is to prevent the UI from stalling when loading fails. </p><br><h2>  Final touches </h2><br><p>  To make our transitions even smoother, we would like to darken the elements of the grid when the image goes to the page screen. </p><br><p>  To achieve this, we will create a TransitionSet and use it as a transition to exit the GridFragment. </p><br><pre> <code class="java hljs">setExitTransition(TransitionInflater.from(getContext()) .inflateTransition(R.transition.grid_exit_transition));</code> </pre> <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">transitionSet</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:duration</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"375"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:interpolator</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@android:interpolator/fast_out_slow_in"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:startDelay</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"25"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fade</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">targets</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:targetId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@id/card_view"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fade</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">transitionSet</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Here's what the transition will look like after setting up the output animation: </p><br><p><img src="https://habrastorage.org/webt/hp/op/z2/hpopz24_dyxsdz9hqw16otkcoeu.gif"></p><br><p>  As you can see, the transition is not fully polished yet.  The dimming animation starts for all grid cards, including the one that contains the image that moves to the page. </p><br><p>  To fix this, we exclude the selected card from the exit transition before committing the fragment transaction to the GridAdapter. </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// view -  ,    ,  . ((TransitionSet) fragment.getExitTransition()).excludeTarget(view, true);</span></span></code> </pre> <br><p>  After this change, the animation looks much better (the selected card is not obscured as part of the exit transition, unlike other cards): </p><br><p><img src="https://habrastorage.org/webt/tj/tq/3j/tjtq3jq2wyyslxw1f283vwwsiq8.gif"></p><br><p>  And the final touch, we configure the GridFragment to scroll and display a card, which we switch to when navigating backward from the page (this is done in <code>onViewCreated</code> ): </p><br><pre> <code class="java hljs">recyclerView.addOnLayoutChangeListener( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OnLayoutChangeListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onLayoutChange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View view, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> left, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> top, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> right, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bottom, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> oldLeft, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> oldTop, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> oldRight, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> oldBottom)</span></span></span><span class="hljs-function"> </span></span>{ recyclerView.removeOnLayoutChangeListener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> RecyclerView.LayoutManager layoutManager = recyclerView.getLayoutManager(); View viewAtPosition = layoutManager.findViewByPosition(MainActivity.currentPosition); <span class="hljs-comment"><span class="hljs-comment">//   ,       null (.. //      layout-)   //    . if (viewAtPosition == null || layoutManager.isViewPartiallyVisible(viewAtPosition, false, true)){ recyclerView.post(() -&gt; layoutManager.scrollToPosition(MainActivity.currentPosition)); } } });</span></span></code> </pre> <br><h3 id="podvodya-itogi">  Summing up </h3><br><p>  In this article, we implemented a smooth transition from RecyclerView to ViewPager and back. </p><br><p>  We showed how to postpone the transition and start it after all views are ready.  We also remap the common elements in order to provide a transition animation when the common views change dynamically as we navigate through the application. </p><br><p>  These changes in the transitions between fragments of our application made them visually more continuous for the user. </p><br><p><img src="https://habrastorage.org/webt/2a/en/os/2aenostia-2x5h5dnwozanwpafu.gif"></p><br><p>  The code of the demo application is <a href="https://github.com/google/android-transition-examples/tree/master/GridToPager">attached</a> . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/349650/">https://habr.com/ru/post/349650/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../349638/index.html">‚ÄúOf course, it‚Äôs risky, but you can use it with proper precautions‚Äù: Chris Talinger on Graal</a></li>
<li><a href="../349640/index.html">Mosdroid Avito - Announcement</a></li>
<li><a href="../349642/index.html">DEV Labs 2018. Online conference for Java developers. March, 3rd</a></li>
<li><a href="../349644/index.html">Sort Lists by CSS</a></li>
<li><a href="../349646/index.html">[Video] Speeches from the Yandex.Money PieMn mit about agile and coaching</a></li>
<li><a href="../349652/index.html">How to make Java code simpler and clearer</a></li>
<li><a href="../349656/index.html">VLFs - Forgotten Enemy</a></li>
<li><a href="../349658/index.html">Case "Monitoring of the business loan portfolio of the bank with the help of three-dimensional visualization"</a></li>
<li><a href="../349660/index.html">Methods for constructing test functions</a></li>
<li><a href="../349662/index.html">We invite you to give lectures on the gaming industry on March 1 at VSBI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>