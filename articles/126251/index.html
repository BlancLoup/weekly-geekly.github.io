<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Work with WebMoney API</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="WebMoney Transfer has long been for many the usual way of payment on the Internet. One of the advantages of the system is a rich API for interacting w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Work with WebMoney API</h1><div class="post__text post__text-html js-mediator-article">  WebMoney Transfer has long been for many the usual way of payment on the Internet.  One of the advantages of the system is a rich API for interacting with third-party services software.  Through it, you can get the status of your bills, make money transfers, bill clients for payment, control their payment, return payments without commission, work with payments with protection, receive information from other users' certificates, send messages via internal WM mail.  The WebMoney site has good <a href="http://www.webmoney.ru/rus/developers/interfaces/xml/index.shtml">API documentation</a> . <br><br>  Your submissive servant has written the module Business :: WebMoney, which is distributed under a free license and received the status of the official Perl-interface of the system. <br><a name="habracut"></a><br><h4>  Connecting Business :: WebMoney - everything, as usual, without surprises </h4><br>  First install the module from CPAN: <br><br><pre> # perl -MCPAN -e 'install Business :: WebMoney'
</pre><br>  After installing the module, add the line to the script that will use the API: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> use Business :: WebMoney;
</pre><br>  The module requires a private key and certificate, which are exported from the browser as a PKCS12 file (.p12) after registering with WebMoney Keeper Light.  Keys from WebMoney Keeper Classic are not suitable - the module does not support working with them (although there is a workaround - see the last paragraph).  The path to the p12 file and its password are specified as constructor parameters: <br><br><pre> my $ wm = Business :: WebMoney-&gt; new (
         p12_file =&gt; '/path/to/your/certificate.p12',
         p12_pass =&gt; 'certificate_password',
 );
</pre><br><h4>  The first check is how much money we have left. </h4><br>  First, let's see which wallets we have, and how much money they have in them: <br><br><pre> my $ res = $ wm-&gt; get_balance (
         reqn =&gt; ++ $ reqn,
         wmid =&gt; '123456789012',
 ) or die $ wm-&gt; errstr;
</pre><br>  The reqn parameter is in all requests to interfaces.  This is an integer that must be greater than the last money transfer request.  In your application, you must provide some way to fulfill this condition.  Either save the last used reqn for transferring money in the database, or implement some other mechanism to ensure this condition, for example, attach to the current time. <br><br>  The wmid parameter is your Webmoney ID.  If your main WMID has access to other WMIDs, then you can watch the wallets of any of them.  The get_balance method returns a link to the list of wallets, for each of which its name is obtained (pursename field), currency (desc field) and the rest of money (amount field). <br><br><h4>  For an online store - we will issue an invoice, check the payment, refund the money </h4><br>  The easiest way to make an online store is to use the WebMoney Merchant service: register, get the code for the form, install it on the site.  In case of successful payment, you will receive an http request from the Merchant system server with the payment number, amount, currency, and md5 security convolution.  In case of emergency situations, there will be unprocessed situations.  For example, if for some reason the http-request for a successful payment fails, then you will receive a complaint from the client that he paid the money and the service was not provided to him.  This means that you need to periodically check the payment of bills on the initiative of the server of the online store.  Or a situation when it is impossible to fulfill a customer‚Äôs order and it‚Äôs necessary to return the money  All this can be automated using the WebMoney API. <br><br>  To begin with, we will issue an invoice (when using Merchant, this is done automatically, and this step should be skipped): <br><br><pre> my $ res = $ wm-&gt; invoice (
         reqn =&gt; ++ $ reqn,
         orderid =&gt; $ orderid,
         customerwmid =&gt; $ contragent_wmid,
         storepurse =&gt; $ my_purse,
         amount =&gt; 1,000,000
         desc =&gt; 'Pay a million and you will be happy'
 ) or die $ wm-&gt; errstr;
</pre><br>  Orderid is the account number in our own database.  Customerwmid is the WMID of the buyer who is billed.  storepurse - a wallet for which we are waiting for money.  amount - amount, desc - description. <br><br>  Now we will periodically request a list of invoices issued by us for the time interval $ datestart - $ datefinish, and monitor the payment on them: <br><br><pre> my $ res = $ wm-&gt; get_out_invoices (
         reqn =&gt; ++ $ reqn,
         purse =&gt; $ my_purse,
         datestart =&gt; $ datestart,
         datefinish =&gt; $ datefinish,
 ) or die $ res-&gt; errstr;
</pre><br>  The link to the array of hashes is returned, we check the state field for everyone.  If there is 0, then the bill has not yet been paid.  If 2, then the bill is paid - you can provide a service, if we have not already done so.  1 - the bill was paid with protection, 3 - refused to pay.  The wmtranid field is the transaction ID for which the invoice was paid.  He is still useful to us. <br><br>  If we want to return money for undelivered service, it‚Äôs enough to call the money_back method: <br><br><pre> my $ res = $ wm-&gt; money_back (
         reqn =&gt; ++ $ reqn,
         inwmtranid =&gt; $ wmtranid,
         amount =&gt; $ amount,
 ) or die $ wm-&gt; errstr;
</pre><br>  We transfer it to the inwmtranid ID field of the transaction with which we were paid money, and in the amount - the amount of payment.  Money will be returned to the buyer, and (attention!) 0.8% without commission. <br><br>  And finally, we‚Äôll give thanks for the purchase (of course, this is just a demonstration of opportunities. No need to spam customers): <br><br><pre> my $ res = $ wm-&gt; message (
         reqn =&gt; ++ $ reqn,
         receiverwmid =&gt; $ contragent_wmid,
         msgsubj =&gt; 'Message Subject',
         msgtext =&gt; 'Message text',
 ) or die $ wm-&gt; errstr;
</pre><br><h4>  API Access Connection </h4><br>  To gain access to most of the listed functions, you must have a personal passport and write a letter via WebMoney internal mail to WM Technical Support with a request to connect and a list of IPs from which access will be made. <br><br><h4>  Key Security </h4><br>  In most cases, you can do without putting the main keys to the wallet on the combat server.  This can be achieved through the mechanism of powers of attorney WebMoney.  You can create a separate WMID, delegate to it the authority to invoice and control payment on behalf of the main WMID, and even if the key is compromised, your money will be safe. </div><p>Source: <a href="https://habr.com/ru/post/126251/">https://habr.com/ru/post/126251/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../126243/index.html">AVCHD. Porting camcorder time codes to video subtitles</a></li>
<li><a href="../126245/index.html">Adding application settings to Settings</a></li>
<li><a href="../126247/index.html">Antipattern presentation of itself ‚ÄúMBA interested in friends‚Äù</a></li>
<li><a href="../126248/index.html">Using semantic annotation to identify requirements</a></li>
<li><a href="../126250/index.html">Practice interviewing or how I moved to the capital</a></li>
<li><a href="../126255/index.html">Watchman syndrome</a></li>
<li><a href="../126258/index.html">oAuth for iOS apps</a></li>
<li><a href="../126260/index.html">Tenacious programs</a></li>
<li><a href="../126261/index.html">Video Tour to the Data Center: Heat Recovery</a></li>
<li><a href="../126262/index.html">Library to simplify HTTP requests</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>