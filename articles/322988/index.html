<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Browser frontend optimization</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Optimization is necessary to increase the speed of loading and operation of sites, which ultimately increases user satisfaction. 


- From the point o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Browser frontend optimization</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/files/7f7/d27/6b1/7f7d276b1a8645e1bab538770361e6c1.jpg" alt="enter image description here"></p><br><p>  Optimization is necessary to increase the speed of loading and operation of sites, which ultimately increases user satisfaction. </p><br><ul><li>  From the point of view of User Experience (UX), the frontend should provide fast loading and operation of web pages. </li><li>  And from the point of view of the Developer Experience (DX), we want the front end to work fast too, be easy to use, and generally be an example to follow. </li></ul><br><p>  All this makes users and developers happier, and at the same time significantly improves the ranking of sites by search engines.  For example, Google pays special attention to optimizing the frontend.  If you have struggled long enough to get your site to earn more points in <a href="https://developers.google.com/speed/pagespeed/insights/">Google Pagespeed Insights</a> , then we hope this article will help you better understand what all this is for and what is the variety of frontend optimization strategies. </p><a name="habracut"></a><br><h3 id="predystoriya">  Prehistory </h3><br><p>  Recently, our entire development team began using ReactJS.  It made me think about how we need to develop our frontend.  Soon I realized that in our approach the browser should play one of the main roles. </p><br><h3 id="opisanie-podhoda">  Description of the approach </h3><br><h4 id="vo-pervyh">  First of all </h4><br><p>  We do not have the ability to control the browser or strongly influence its behavior.  But having understood how it works, we can optimize the code transmitted to it.  Fortunately, browsers are built on fairly stable and <a href="https://developers.google.com/web/fundamentals/">well-documented</a> principles that are unlikely to change much in the long run. </p><br><p>  So we can confidently set goals in front of which we will strive to achieve. </p><br><h4 id="vo-vtoryh">  Secondly </h4><br><p>  Although browsers are not in our power, we can manage code, stack, architecture, and patterns.  They change faster and provide us with a wider range of possibilities. </p><br><h4 id="dalee">  Further </h4><br><p>  I started by thinking about how I see the code, which should be our team.  And based on this vision, I formulated an opinion on how to approach the writing of code.  In this article we will consider all the necessary aspects of the browser. </p><br><h3 id="chto-delaet-brauzer">  What the browser does </h3><br><p>  Let's look at the work of the browser on the example of execution of a simple code: </p><br><pre><code class="hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>The "Click the button" page<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"styles.css"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> Click the button. <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag">&gt;</span></span>Click me<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> button = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.querySelector(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"button"</span></span></span><span class="javascript">); button.style.fontWeight = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"bold"</span></span></span><span class="javascript">; button.addEventListener(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"click"</span></span></span><span class="javascript">, </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> (</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ alert(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Well done."</span></span></span><span class="javascript">); }); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3 id="kak-renderitsya-stranica-v-brauzere">  How to render a page in the browser </h3><br><p>  After receiving the HTML code, the browser parses the document and converts it into a presentation that is clear to itself.  It is universal for all browsers and is defined by <a href="https://www.w3.org/TR/html5/dom.html">the HTML5 DOM specification</a> .  Further, the browser performs a series of actions, after which a web page is displayed on the screen.  In general terms, the procedure is as follows: </p><br><ol><li>  Based on the resulting HTML, a DOM tree (Document Object Model) is built. </li><li>  Based on the resulting CSS, a CSSOM tree (CSS Object Model) is built. </li><li>  With reference to built DOM and CSSOM, scripts are executed. </li><li>  Based on DOM and CSSOM, a rendering tree is formed. </li><li>  Based on the rendering tree, a page layout is generated indicating the size and coordinates of all elements. </li><li>  The page is rendered - displayed on the screen. </li></ol><br><p><img src="https://habrastorage.org/files/4f6/a53/6cf/4f6a536cfa8b4a45a6810c160c206cdb.png" alt="enter image description here"></p><br><h3 id="pervyy-etap-html">  Step One: HTML </h3><br><p>  The browser reads the markup from top to bottom and converts the nodes of the DOM tree. </p><br><p><img src="https://habrastorage.org/files/828/b00/3ce/828b003cee6940bd8fec134b960d95d0.png" alt="enter image description here"></p><br><h3 id="strategii-optimizacii-dostavki-html">  HTML delivery optimization strategies </h3><br><ul><li>  Styles - first of all, scripts - at the last. </li></ul><br><p>  Of course, there are exceptions to any rule, but in general, you need to load styles as early as possible, and scripts as late as possible.  Since we need to complete HTML and CSS parsing before executing the scripts, we deliver the styles early in order to process them before the time comes to compile and execute the scripts. </p><br><p>  Below we look at how you can customize the delivery of styles and scripts as part of optimization. </p><br><ul><li>  Minification and compression. </li></ul><br><p>  These procedures apply to all data: HTML, CSS, JavaScript, images, and other resources.  When minifying, we delete ‚Äúredundant‚Äù characters: spaces, comments, semicolons, and so on.  When compressing, duplicate pieces of data in the code and resources are replaced with pointers to the ‚Äúoriginal‚Äù, original, instances of the pieces.  We will actively use file compression, and the client part will be responsible for unpacking them. </p><br><p>  The use of minification and compression will reduce the amount of data by about <a href="https://css-tricks.com/the-difference-between-minification-and-gzipping/">80‚Äì90%</a> . </p><br><ul><li>  Increased availability. </li></ul><br><p>  In this case, it‚Äôs not about speeding up the page load, but about taking care of users with a slow connection.  Your pages should be accessible to all users, regardless of the speed of their channels!  For page elements, use ARIA attributes, provide images with text descriptions using the <code>alt</code> tag and use <a href="http://www.clarissapeterson.com/2012/11/html5-accessibility/">other means</a> . </p><br><p>  To understand what else can be done on the page to increase its availability, you will be helped by tools like <a href="http://wave.webaim.org/">WAVE</a> . </p><br><h3 id="vtoroy-etap-css">  Stage Two: CSS </h3><br><p>  When detecting style nodes (external, internal or embedded styles), the browser stops rendering DOM and builds a CSSOM tree based on these nodes.  Therefore, they say about CSS that it blocks rendering.  Here are some of the advantages and disadvantages of <a href="https://vineetgupta22.wordpress.com/2011/07/09/inline-vs-internal-vs-external-css/">different types of styles</a> . </p><br><pre> <code class="hljs xml">//   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"styles.css"</span></span></span><span class="hljs-tag">&gt;</span></span> //   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css"> </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">h1</span></span></span><span class="css"> { </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">font-size</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">18px</span></span></span><span class="css">; } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span> //   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"background-color: blue;"</span></span></span><span class="hljs-tag">&gt;</span></span>Click me<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  CSSOM nodes are created in the same way as DOM nodes.  They will be merged later, and at this stage it looks like this: </p><br><p><img src="https://habrastorage.org/files/776/b00/6cb/776b006cbe7f4a15931aed4baa515996.png" alt="enter image description here"></p><br><p>  Building a CSSOM tree blocks the page rendering process.  Therefore, within the rendering tree, it is necessary to load styles as early as possible and minimize their size as much as possible.  Where this will be effective, it is necessary to apply delayed loading of styles. </p><br><h3 id="strategii-optimizacii-dostavki-css">  CSS delivery optimization strategies </h3><br><ul><li>  Use of <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/%40media">media attributes</a> . </li></ul><br><p>  With the help of media attributes, we determine the conditions that must be met to load certain styles.  For example, media attributes allow you to load different styles depending on the screen resolution on the client device, and so on. </p><br><p>  Today, mobile devices are much inferior in performance to "full-fledged" computers, so to ensure good performance and download speed, we must transfer them data as little as possible.  For example, using media attributes, you can make it so that styles for mobile devices will be transmitted first, and then for desktops and laptops.  With this approach, styles will be loaded without blocking the loading of the page itself. </p><br><pre> <code class="hljs xml">//  CSS        . // media="all" ‚Äî    .   ,        -. <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"mobile-styles.css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">media</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"all"</span></span></span><span class="hljs-tag">&gt;</span></span> //  CSS               . <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"desktop-styles.css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">media</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"min-width: 590px"</span></span></span><span class="hljs-tag">&gt;</span></span> //  -  CSS         (print view). <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css"> @</span><span class="hljs-keyword"><span class="css"><span class="hljs-keyword">media</span></span></span><span class="css"> print { </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">img</span></span></span><span class="css"> { </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">display</span></span></span><span class="css">: none; } } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><ul><li>  Postponed loading of CSS. </li></ul><br><p>  If you have styles that can be painlessly loaded and processed after the first useful screen is displayed, then using the script you can postpone their loading.  These can be styles for data that are located below the first useful screen, that is, to see them, you need to scroll through the page.  You can also postpone the loading of styles for data, the correctness of which is not critical until the page begins to respond to user actions, that is, it does not become interactive. </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"main.css"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"main"</span></span></span><span class="hljs-tag">&gt;</span></span> Important above the fold content. <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"secondary"</span></span></span><span class="hljs-tag">&gt;</span></span> Below the fold content. Stuff you won't see until after page loads and you scroll down. <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.onload = </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> (</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">// load secondary.css } </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Examples of implementing deferred loading of styles: <br>  <a href="https://jakearchibald.com/2016/link-in-body/">https://jakearchibald.com/2016/link-in-body/</a> <br>  <a href="https://www.giftofspeed.com/defer-loading-css/">https://www.giftofspeed.com/defer-loading-css/</a> </p><br><ul><li>  Decreased specificity. </li></ul><br><p>  The high level of specificity of styles has two obvious drawbacks.  Firstly, we have to transfer more data related to elements and styles over the network, and secondly, the load on client devices that have to process all this increases. </p><br><pre> <code class="hljs objectivec"><span class="hljs-comment"><span class="hljs-comment">//    ==  .header .nav .menu .link a.navItem { font-size: 18px; } //    ==  a.navItem { font-size: 18px; }</span></span></code> </pre> <br><ul><li>  Delivery is only necessary. </li></ul><br><p>  For many, this will be obvious, but still.  If you have at least some experience developing the frontend, then you probably know that one of the key problems of CSS is the unpredictable increase in the size of styles.  They seem to be specially designed to grow constantly.  Therefore, it is recommended to use tools like <a href="https://github.com/giakki/uncss">UnCSS</a> , which help to remove all unnecessary from CSS.  There are a lot of web tools. </p><br><h3 id="tretiy-etap-javascript">  Stage Three: JavaScript </h3><br><p>  The browser builds DOM / CSSOM nodes until it encounters external or internal JavaScript scripts. </p><br><pre> <code class="hljs xml">//   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"app.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> //   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> alert(</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"Oh, hello"</span></span></span><span class="actionscript">); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  The fact is that the script may want to access previous HTML and styles, or even convert them.  Therefore, the browser suspends the parsing of nodes, completes the construction of the CSSOM tree, executes the script, and then resumes the parsing.  Therefore, it is said that JavaScript blocks parsing. </p><br><p>  Each browser is equipped with a preloading scanner, which checks if the scripts are mentioned in the DOM, and preloads them.  At the same time, the loaded scripts will be executed in the prescribed order, but only after the previous CSS nodes are formed.  Suppose we have such a script: </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> button = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">"button"</span></span>); button.style.fontWeight = <span class="hljs-string"><span class="hljs-string">"bold"</span></span>; button.addEventListener(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ alert(<span class="hljs-string"><span class="hljs-string">"Well done."</span></span>); });</code> </pre> <br><p>  This script will have this effect on our DOM and CSSOM: </p><br><p><img src="https://habrastorage.org/files/d9e/620/609/d9e6206092904c06bfb7034e296313af.png" alt="enter image description here"></p><br><p>  JavaScript delivery optimization strategies <br>  Optimization of work with scripts is one of the main tasks, the solution of which on most sites leaves much to be desired. </p><br><ul><li>  Asynchronous loading scripts. </li></ul><br><p>  If you assign the async attribute to the script, the browser will load it in another thread with a lower priority without blocking the page load.  As soon as the script is loaded, the browser will execute it. </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"async-script.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">async</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Since we do not know when exactly the script will be executed, two situations are possible: </p><br><ol><li>  The script runs a long time after the page has finished loading.  The situation is not very good if the inoperability of the script can affect the user experience of your product. </li><li>  The script runs until the page loads.  In this case, it may simply not get access to the necessary elements of DOM / CSSOM, which is fraught with failure. </li></ol><br><p><img src="https://habrastorage.org/files/d92/0f1/a0c/d920f1a0c0c14faaa97389ffc8d53537.png" alt="enter image description here"></p><br><p>  The <code>async</code> attribute is recommended for use with scripts that do not affect the DOM or CSSOM.  Also, asynchronous loading is ideal for external scripts that do not depend on code and are non-critical for UX.  Vivid examples: analytics and tracking scripts, although this is not an exhaustive list at all. </p><br><ul><li>  Delayed loading of scripts. </li></ul><br><p>  The <code>defer</code> attribute <code>defer</code> similar to <code>async</code> in the sense that using it does not block page loading.  But the scripts will be executed in the order of appearance in the code only after the HTML parsing is completed. </p><br><p><img src="https://habrastorage.org/files/f61/223/046/f612230461d843599690318870b2bf6d.png" alt="enter image description here"></p><br><p>  This is a good solution for scripts that affect the rendering tree, but non-critical for downloading content for the first meaningful screen, and for which work does not need to run the preceding scripts. </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"defer-script.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">defer</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Another good use case for delayed load strategies.  You can also use something like <code>addEventListener</code> .  Useful <a href="http://stackoverflow.com/questions/588040/window-onload-vs-document-onload">thread</a> on the topic. </p><br><pre> <code class="hljs lua">//    DOM   , ,     . window.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { }; //     DOM,          . document.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { }; //   jQuery $(document).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { });</code> </pre> <br><p>  Unfortunately, <code>async</code> and <code>defer</code> useless in the case of embedded scripts, because by default browsers compile and execute them as soon as they are encountered in the code.  If the script is embedded in HTML, then it starts immediately, and applying the <code>async</code> and <code>defer</code> to external resources allows us to abstract or delay the transfer of scripts to DOM / CSSOM. </p><br><ul><li>  Clone nodes before subsequent manipulations. </li></ul><br><p>  This approach can be resorted to only under one condition: if the introduction of numerous changes in the DOM leads to undesirable results.  In this case, first try to clone the entire DOM node, make the necessary changes to the clone, and then replace the original clone.  So you will avoid numerous redrawing and reduce the load on the processor and memory.  In addition, cloning will protect you from <a href="https://en.wikipedia.org/wiki/Flash_of_unstyled_content">FOUC</a> (Flashes of Unstyled Content) and making spontaneous changes. </p><br><pre> <code class="hljs coffeescript"><span class="hljs-regexp"><span class="hljs-regexp">//</span></span>      . var element = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">".my-node"</span></span>); var elementClone = element.cloneNode(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>)    , (<span class="hljs-literal"><span class="hljs-literal">false</span></span>)     elementClone.textContent = <span class="hljs-string"><span class="hljs-string">"I've been manipulated..."</span></span>; elementClone.children[<span class="hljs-number"><span class="hljs-number">0</span></span>].textContent = <span class="hljs-string"><span class="hljs-string">"...efficiently!"</span></span>; elementClone.style.backgroundColor = <span class="hljs-string"><span class="hljs-string">"green"</span></span>; element.parentNode.replaceChild(elementClone, element);</code> </pre> <br><p>  But remember that when you clone a node, you do not clone event listeners.  Although in some cases this may be the goal.  Once, when we did not have jQuery-methods <code>.on()</code> and <code>.off()</code> , and listeners did not know how to call named functions, we used this approach to reset listeners. </p><br><ul><li>  Using Preload / Prefetch / Prerender / Preconnect attributes. </li></ul><br><p>  These attributes have ‚Äútalking‚Äù names, so it makes no sense to explain what they are doing.  But they appeared relatively recently and are not yet supported by all browsers.  For this reason, most developers are now hardly interested in these attributes.  You can read more about them here: <br>  <a href="https://css-tricks.com/prefetching-preloading-prebrowsing/">https://css-tricks.com/prefetching-preloading-prebrowsing/</a> <br>  <a href="https://www.keycdn.com/blog/resource-hints/">https://www.keycdn.com/blog/resource-hints/</a> </p><br><h3 id="chetvyortyy-etap-derevo-renderinga">  Stage Four: Tree Rendering </h3><br><p>  All nodes are read - you can combine DOM and CSSOM.  The browser proceeds to the formation of a rendering tree.  Metaphorically speaking, nodes are ‚Äúwords‚Äù, object models are ‚Äúsentences‚Äù, and tree is ‚Äúpage‚Äù. </p><br><p><img src="https://habrastorage.org/files/336/c72/d9d/336c72d9d0e5433fbb648a272221e16e.png" alt="enter image description here"></p><br><h3 id="pyatyy-etap-maket-stranicy">  Fifth stage: page layout </h3><br><p>  After the rendering tree is formed, the browser proceeds to the layout.  To do this, it determines the size and coordinates of all elements on the page. </p><br><p><img src="https://habrastorage.org/files/16d/c97/46e/16dc9746e95d41a1bc891cf45be10ddf.png" alt="enter image description here"></p><br><h3 id="shestoy-etap-vyvod-na-ekran">  Sixth Stage: Display </h3><br><p>  The last stage, the page appears on the screen. </p><br><p><img src="https://habrastorage.org/files/a78/98e/839/a7898e839f4c499094b4dee4df82dd8c.png" alt="enter image description here"></p><br><p>  The total duration of all these stages is from tenths of a second to several seconds.  And we need to make the pages load even faster. </p><br><p>  If any JavaScript makes a change to any part of the page, then the steps of forming the rendering tree and layout are performed again and then displayed on the screen.  Fortunately, modern browsers can redraw not the whole page, but only the changed part.  But we cannot rely on them when it comes to performance. </p><br><p>  However, it is obvious that JavaScript is largely dependent on events on the client side.  We need him to manipulate our DOM, that's what he will do.  The main thing - to prevent or reduce unwanted side effects. </p><br><p>  By the way, I recommend to familiarize yourself with the <a href="https://vimeo.com/44182484">performance of</a> Tali Garciel.  It was in 2012, but the information presented in it is still relevant.  You can also read a great <a href="https://www.html5rocks.com/en/tutorials/internals/howbrowserswork/">browser tutorial</a> . </p><br><p>  For a more detailed study of the issue, study <a href="https://www.w3.org/TR/html5/">the HTML5 specification</a> . </p><br><h3 id="kak-brauzery-sovershayut-setevye-vyzovy">  How browsers make network calls </h3><br><p>  Let's now talk about how best to transfer the data needed to render the page to the browser. </p><br><p>  When the browser makes a request to the URL, the server sends some HTML code in response.  Let's go from simple to complex.  Suppose this is the HTML code of our page: </p><br><pre> <code class="hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>The "Click the button" page<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> Button under construction... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  There is such a thing as ‚ÄúCritical Rendering Path‚Äù (CRP).  It characterizes the number of procedures required to render a page.  At the moment, our CRP scheme looks like this: </p><br><p><img src="https://habrastorage.org/files/14a/e79/f73/14ae79f733654e2387bd25db6aed7141.png" alt="enter image description here"></p><br><p>  The browser makes a GET request, waits until we send back one kilobyte of the HTML code of our page (we have not added CSS or JavaScript yet), then builds a DOM tree and renders the page. </p><br><h3 id="dlina-kriticheskogo-puti">  Critical path length </h3><br><p>  CRP has three parameters (metrics).  The first one is the length.  Obviously, it should be as small as possible. </p><br><p>  To get the HTML needed to render the page, the browser communicates with the server (round trip).  He doesn‚Äôt need anything else, that is, now the length of CRP is 1. </p><br><p>  Let's complicate the task and add internal styles and javascript. </p><br><pre> <code class="hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>The "Click the button" page<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css"> </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">button</span></span></span><span class="css"> { </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">color</span></span></span><span class="css">: white; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">background-color</span></span></span><span class="css">: blue; } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag">&gt;</span></span>Click me<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> button = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.querySelector(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"button"</span></span></span><span class="javascript">); button.addEventListener(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"click"</span></span></span><span class="javascript">, </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> (</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ alert(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Well done."</span></span></span><span class="javascript">); }); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  The scheme of our CRP has changed: </p><br><p><img src="https://habrastorage.org/files/168/034/f97/168034f9784c4a47baeba0a0ece739cc.png" alt="enter image description here"></p><br><p>  Due to the emergence of internal styles and scripts that need to be processed, the critical path has increased by two new stages: the construction of a CSSOM tree and the execution of scripts.  Fortunately, we do not make any external requests, so they have no effect on the path length. </p><br><p>  But not everything is so simple.  Please note that the size of our HTML has increased to 2 Kb.  And this can (and will) backfire. </p><br><h3 id="razmer-kriticheski-vazhnyh-resursov">  Size of critical resources </h3><br><p>  This is the second parameter of the critical rendering path.  It is measured in the number of bytes that need to be transferred to the browser for rendering the page.  Note: this is not about all the resources that will eventually be uploaded to the page, but only about those that are needed to display a page with which users can interact.  As you understand, the size of these resources should be as small as possible. </p><br><p>  If you think that you can get rid of external resources without any problems, making them only internal or embedded, then you are mistaken.  This approach scales very poorly.  If you place all the resources they need into modern pages, they will become very heavy, and browsers will hardly process them.  There is one <a href="https://www.ctheu.com/2015/08/17/react-inline-styles-vs-css-stupid-benchmark/">interesting article</a> in which analyzed the performance of pages created using ReactJS (external styles are not used, only embedded).  It turned out that the size of the DOM is quadrupled, and the DOM tree is built twice as long, and it also takes one and a half times more time for the page to respond to user actions. </p><br><p>  In addition, external resources can be cached.  Therefore, if the user came back to the page or previously visited pages that use the same resources (like <code>my global.css</code> ), the browser will pull them from the cache, and will not query over the network.  From this we only benefit.  So let's use styles and scripts as external resources. </p><br><p>  At the moment we have one external CSS file, one external JavaScript file and one asynchronously loaded external JavaScript file. </p><br><pre> <code class="hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>The "Click the button" page<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"styles.css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">media</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"all"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"analytics.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">async</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> // async <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag">&gt;</span></span>Click me<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"app.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  This is how our critical path has changed: </p><br><p><img src="https://habrastorage.org/files/67c/09b/56d/67c09b56d1cb4298b61ee969b5e0b884.png" alt="enter image description here"></p><br><p>  In response to its request, the browser receives the page and builds a DOM tree.  As soon as it stumbles upon any external source, the preloading scanner begins to work.  It initiates the download of all external resources that can only be found in HTML.  At the same time CSS and JavaScript are assigned a higher priority than other resources. </p><br><p>  The scanner finds <code>styles.css</code> and <code>app.js</code> and creates one more critical path to download them.  At the same time, the scanner does not pay attention to <code>analytics.js</code> , because this script has the <code>async</code> attribute.  Of course, the browser will download it, but only in a different thread and with low priority.  Loading this script does not block the rendering of the page, so it does not change the length of the critical path.  By the way, Google‚Äôs algorithms, which rank sites according to the degree of optimization, pay attention to this. </p><br><h3 id="fayly-s-kriticheski-vazhnymi-resursami">  Files with Critical Resources </h3><br><p>  The third and final parameter of our critical path is the number of files that the browser must download for the subsequent rendering of the page.  Now there are three: HTML, CSS and JavaScript (asynchronously loaded script is not considered).  As the logic dictates, the smaller the size of files with critical resources, the better. </p><br><h3 id="i-snova-o-dline-puti">  And again about the length of the path </h3><br><p>  So, in our example, the browser for page rendering should download three files (HTML, CSS and JavaScript), and it will do it in just two sessions of data exchange with the server (round trip).  ,           ? </p><br><h3 id="ogranichenie-http1h">  HTTP/1. </h3><br><p>  HTTP/1.1     ,        .           ,  Chrome ‚Äî ,  Edge ‚Äî .   ,        <a href="http://sgdev-blog.blogspot.co.uk/2014/01/maximum-concurrent-connection-to-same.html">  </a> . </p><br><p>   ‚Äî          . </p><br><p>  <strong>Attention!</strong>   CSS       .      DNS       . </p><br><h3 id="http2"> HTTP/2 </h3><br><p>            HTTP/2,          .        ,   . </p><br><p>       HTTP/2 <a href="http2-test"> </a> . </p><br><h3 id="ogranichenie-na-obyom-peredavaemyh-dannyh-v-ramkah-odnogo-round-trip">         round trip </h3><br><p>   ! </p><br><p>        <a href="https://hpbn.co/building-blocks-of-tcp/"> TCP  </a>   14       .     -,   HTML, CSS  . </p><br><p>   HTML-      14 ,       round trip.  ,             . </p><br><h3 id="bolshe-kilobayt">   </h3><br><p>        . </p><br><pre> <code class="hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>The "Click the button" page<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"styles.css"</span></span></span><span class="hljs-tag">&gt;</span></span> // 14kb <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"main.css"</span></span></span><span class="hljs-tag">&gt;</span></span> // 2kb <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"secondary.css"</span></span></span><span class="hljs-tag">&gt;</span></span> // 2kb <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"framework.css"</span></span></span><span class="hljs-tag">&gt;</span></span> // 2kb <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"app.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> // 2kb <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag">&gt;</span></span>Click me<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"modules.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> // 2kb <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"analytics.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> // 2kb <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"modernizr.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> // 2kb <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p> ,       CSS  JavaScript,   ,   <em> </em> . </p><br><p> ,     HTML      gzip.     2        round trip.     DOM-         ‚Äî HTML. </p><br><p><img src="https://habrastorage.org/files/40d/cc8/73c/40dcc873c74b4408b9887913e12469f8.png" alt="enter image description here"></p><br><p> <code> CRP:  ‚Äì 1,   ‚Äì 1,   ‚Äì 2 </code> </p> <br><p>    CSS-,          (CSS  JavaScript)      .   : CSS-  14 ,           . </p><br><p><img src="https://habrastorage.org/files/167/c96/3eb/167c963ebff74fa7958e025b569f33bd.png" alt="enter image description here"></p><br><p> <code> CRP:  ‚Äì 2,   ‚Äì 2,   ‚Äì 16 </code> </p> <br><p>    .    12 ,          round trip.     ,       HTTP/2,    ‚Äî Chrome,       . </p><br><p><img src="https://habrastorage.org/files/6dd/6c8/c7d/6dd6c8c7dce041119a12bb2e2f037704.png" alt="enter image description here"></p><br><p> <code> CRP:  ‚Äì 3,   ‚Äì 8,   ‚Äì 28 </code> </p> <br><p>      DOM. </p><br><p><img src="https://habrastorage.org/files/d58/4d3/f68/d584d3f68ef44c72986d4a6f435b017f.png" alt="enter image description here"></p><br><p> <code> CRP:  ‚Äì 4,   ‚Äì 9,   ‚Äì 30 </code> </p> <br><p>            ,         30 . ,           ,        . </p><br><h3 id="strategii-optimizacii-raboty-brauzera-s-setyu">       </h3><br><ul><li> PageSpeed Insights. </li></ul><br><p>    <a href="https://developers.google.com/speed/pagespeed/insights/">PageSpeed Insights</a>   ,      .       <code>audit</code>  Chrome Developer Tools. </p><br><ul><li>  Chrome Developer Tools. </li></ul><br><p>     .          ,     <a href="https://developers.google.com/web/tools/chrome-devtools/network-performance/understanding-resource-timing">  Google</a> . </p><br><ul><li>     ,   ‚Äî   . </li></ul><br><p> ,     Macbook Pro  SSD 1     32 .          ,       :      .      <code>network</code>   Chrome Developer Tools. </p><br><ul><li>  / . </li></ul><br><p>              CSSOM-,    . ,          round trip,            .    ,       . </p><br><ul><li>        (above the fold)   header. </li></ul><br><p>     ,  :  CSS  JavaScript      ,      ,     DOM      ,    . </p><br><p>       ,    ,    ,      .               . </p><br><ul><li> /  . </li></ul><br><p>    .       . </p><br><ul><li>       . </li></ul><br><p>    ¬´¬ª JavaScript     ,     ,    ,          .    <a href="https://varvy.com/pagespeed/defer-images.html"> </a> . </p><br><ul><li>   . </li></ul><br><p> - ¬´¬ª        -       .       ,   -  -    . ,     ,         <a href="https://css-tricks.com/fout-foit-foft/">FOIT</a> (Flash Of Invisible Text). </p><br><ul><li>    JavaScript/ CSS. </li></ul><br><p>         ?  -     HTML-.    /      , , <a href="https://css-tricks.com/using-svg/">SVG</a> . </p><br><ul><li> CDN. </li></ul><br><p>        ,          ,    ,      . </p><br><p>    ,      .     <a href="https://classroom.udacity.com/courses/ud884/lessons/1464158641/concepts/14734291220923">    Udacity</a> ,    <a href="https://developers.google.com/web/fundamentals/performance/">  </a> .         <a href="https://hpbn.co/">High Performance Browser Networking</a> . </p><br><h3 id="summiruem">  </h3><br><p>       (Critical Render Path).     ,        -. CRP   : </p><br><ol><li>    . </li><li>      . </li><li>    ( round trip   ,    ). </li></ol><br><p>             ,      Google PageSpeed Insights      . </p><br><p>   ,     CRP    DOM     ,      .     . </p><br><p> ,          ,        .            . </p><br><p>                .        2000    CMS,      .  . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/322988/">https://habr.com/ru/post/322988/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../322976/index.html">The book "Linux in practice"</a></li>
<li><a href="../322978/index.html">The birth of a new algorithm called Broo and comparison with Brotli and the rest</a></li>
<li><a href="../322980/index.html">Why learning is a new procrastination</a></li>
<li><a href="../322982/index.html">11 steps to a good online store. Delivery</a></li>
<li><a href="../322984/index.html">Again about floating point numbers</a></li>
<li><a href="../322990/index.html">Writing mnemonic editor for SCADA-system on Fabric.js</a></li>
<li><a href="../322992/index.html">Diverse and motivating "English online"</a></li>
<li><a href="../322994/index.html">Stories of small business in Krasnodar: insane team of freelancers and a lot of courage</a></li>
<li><a href="../322996/index.html">Internet counterintelligence in action: create a personal information security management system</a></li>
<li><a href="../322998/index.html">Free ASP.NET Core Training Courses at the Microsoft Virtual Academy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>