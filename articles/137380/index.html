<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Data Backup in MySQL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Backing up the database is such a thing that you always have to configure for already running projects directly on live production servers. 
 This sit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Data Backup in MySQL</h1><div class="post__text post__text-html js-mediator-article">  Backing up the database is such a thing that you always have to configure for already running projects directly on live production servers. <br>  This situation is easily explained.  At the very beginning, any project is still empty and there is simply nothing to copy.  In the phase of rapid development of the head of a few developers are busy exclusively screwing chips and ruches, as well as fixing critical bugs with a deadline of "day before".  And only when the project "takes off", comes the realization that the main value of the system is the accumulated database, and its failure will be a disaster. <br>  This review article is for those whose projects have already reached this point, but the roast rooster has not yet pecked. <br><a name="habracut"></a><br><h3>  1. Copying base files </h3><br>  You can copy the MySQL database if you temporarily turn off the MySQL server and simply copy the files from the <i>/ var / lib / mysql / db /</i> folder.  If the server is not turned off, for obvious reasons, data loss and corruption is likely.  For large loaded bases, this probability is close to 100%.  In addition, when you first start with a ‚Äúdirty‚Äù copy of the database, the MySQL server will begin the process of checking the entire database, which may take hours. <br><br>  In most ‚Äúlive‚Äù projects, regular shutdown of the database server for a long time is unacceptable.  A trick based on file system snapshots is used to solve this problem.  Snapshot is something like a ‚Äúphoto‚Äù of a file system at a certain point in time, taken without actually copying the data (and therefore quickly).  Similarly, ‚Äúlazy copying‚Äù of objects works in many modern programming languages. <br>  The general scheme of actions is as follows: all tables are locked, the database file cache is reset, file system snapshot is made, tables are unlocked.  After that, the files are quietly copied from the snapshot, after which it is destroyed.  The ‚Äúblocking‚Äù part of such a process takes a time of the order of seconds, which is already tolerable.  As a reckoning for a while, while snapshot is ‚Äúalive‚Äù, the performance of file operations is reduced, which primarily beats the speed of write operations to the database. <br><br>  Some file systems, such as ZFS, support snapshot removal natively.  If you are not using ZFS, but you have an LVM volume manager on your server, you can also <a href="http://www.mysqlperformanceblog.com/2006/08/21/using-lvm-for-mysql-backup-and-replication-setup/">copy the MySQL database through snapshot</a> .  Finally, under * nix, you can use the <a href="http://www.r1soft.com/tools/linux-hot-copy/">R1Soft Hot Copy</a> snapshot driver, but this method will not work in the openvz container ( <a href="http://badan.wordpress.com/2011/05/12/how-to-setup-mysql-replication-with-virtually-no-downtime-without-locking-tables-without-lvm/">the MySQL backup process is described here</a> ). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For MyISAM databases, there is an official freeware utility <a href="http://dev.mysql.com/doc/refman/5.1/en/mysqlhotcopy.html">mysqlhotcopy</a> that ‚Äúcorrectly‚Äù copies MyISAM database files without stopping the server.  There is a <a href="http://www.innodb.com/wp/products/hot-backup/order/">similar utility for InnoDB</a> , but it is paid, although it has more features. <br><br>  Copying files is the fastest way to transfer the entire database from one server to another. <br><br><h3>  2. Copying via text files </h3><br>  In order to read into the backup data from the production-base, it is not necessary to jerk files.  You can select data by request and save it to a text file.  To do this, use the SQL command <a href="http://dev.mysql.com/doc/refman/5.1/en/select-into.html">SELECT INTO OUTFILE</a> and its pair <a href="http://dev.mysql.com/doc/refman/5.1/en/load-data.html">LOAD DATA INFILE</a> .  Unloading is done line by line (you can select to save only the desired line, as in the usual SELECT).  The structure of tables is not specified anywhere - a programmer should take care of this.  It should also take care to include SELECT INTO OUTFILE commands in the transaction, if necessary to ensure data integrity.  In practice, SELECT INTO OUTFILE is used for partial backup of very large tables that cannot be copied in any other way. <br><br>  In most cases, the <a href="http://dev.mysql.com/doc/refman/5.1/en/mysqldump.html">mysqldump</a> utility created by Igor Romanenko is much more convenient.  The mysqldump utility generates a file containing all the SQL commands necessary to fully restore the database on another server.  Separate options can achieve compatibility of this file with almost any DBMS (not just MySQL), in addition, there is the possibility of uploading data in CSV and XML formats.  To recover data from these formats, there is a <a href="http://dev.mysql.com/doc/refman/5.1/en/mysqlimport.html">mysqlimport</a> utility. <br><br>  The mysqldump console utility.  There are its add-ins and analogs that allow you to manage backups through a web interface, for example, the Ukrainian tool <a href="http://sypex.net/ru/products/dumper/features/">Sypex Dumper</a> (their representative is <a href="http://habrahabr.ru/users/zapimir/" class="user_link">zapimir</a> in Habr√©). <br><br>  The disadvantages of universal backup utilities to text files are the relatively low performance and the inability to make incremental backups. <br><br><h3>  3. Incremental backups </h3><br>  Traditionally, it is recommended to keep 10 backups: one for each day of the week, as well as two-week, monthly and quarterly backups - this will allow you to roll back deep enough if any data is corrupted. <br>  Backups should not be stored exactly on the same disk as the live database, and not on the same server.  In case of fires and other disasters, it is best to rent a couple of units in a nearby data center. <br><br>  These requirements can be a problem for large databases.  Pumping a backup of a 100-gigabyte base on a 100-mb network will take about three hours, with which the channel will be completely blocked. <br>  Incremental backups allow to partially solve this problem, when a full backup is done, say, only on Sundays, and only data added or modified over the past 24 hours are written on other days.  The difficulty is how to identify these same "data that changed in a day." <br><br>  Here, out of competition, the <a href="http://www.percona.com/software/percona-xtrabackup/">Percona XtraBackup</a> system, which contains a modified InnoDB engine, analyzes the MySQL binary logs and extracts the necessary information from them.  Almost the same features have paid InnoDB Hot Backup, mentioned above. <br><br>  A common problem with any backups is that they always lag behind.  In the event of a fatal failure of the main server, it will be possible to restore the system only with some ‚Äúrollback‚Äù in time, which will very much disappoint its users.  If the system somehow affected the financial flows, such a "rollback" can literally fly into a pretty penny. <br><br><h3>  4. Replication </h3><br>  MySQL replication system is designed to avoid undoing.  The idea of ‚Äã‚Äãreplication is based on the fact that, in addition to the ‚Äúmain‚Äù server (‚ÄúWizard‚Äù), MySQL slave servers (‚Äúslaves‚Äù) are constantly running, which receive incremental backups from the wizard in real time.  Thus, the rollback time is reduced almost to the network lag.  In the event of a master crash, you can quickly assign one of the slaves to the ‚Äúnew master‚Äù and redirect clients to it.  In addition, slaves can process read requests for data (SELECTs);  This can be used to perform some calculations or reduce the load on the master.  MySQL supports out-of-box replication, the process of <a href="http://habrahabr.ru/blogs/mysql/56702/">setting up replication in MySQL is</a> well described by the user <a href="http://habrahabr.ru/users/whisk/" class="user_link">whisk</a> .  It is possible to launch <a href="http://www.itnotes.org.ua/administration/mysql/master_master_replication_db.html">Master-Master configurations</a> , and with the help of external hardware-software systems - and load balancing between masters.  Just do not forget about the limitations imposed by the <a href="http://habrahabr.ru/blogs/nosql/136398/">CAP-theorem</a> . <br><br>  Replication is great, but you need to use it for its intended purpose.  A replica is a complete copy of the database, but it is <b>not a backup copy</b> !  Obviously, if you perform DROP TABLE or UPDATE users SET password = ‚ÄúHaha!‚Äù On the wizard, the changes will be immediately copied to the slave, and it will be impossible to roll them back. <br><br>  Replication can be combined with backup at the database file level, stopping the slave, not the master. <br><br><h3>  Instead of conclusion </h3><br>  The main thing to remember is that the backup in each case is individual.  It can not be set up once and forget.  The administrator must at least once a month try to restore the base from scratch from backups.  In living developing projects, the database structure is constantly changing, so sooner or later, some data will no longer fall into the backup simply because they forgot to correct the scripts.  If it is detected at the time of the fall of the main base, the value of such backups will be zero. </div><p>Source: <a href="https://habr.com/ru/post/137380/">https://habr.com/ru/post/137380/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../137375/index.html">A constant pointer to a non-constant object is:</a></li>
<li><a href="../137376/index.html">Google launched a website for developers: JavaScript vs. Dart</a></li>
<li><a href="../137377/index.html">Existing reality tree</a></li>
<li><a href="../137378/index.html">Firefox 10 is released</a></li>
<li><a href="../137379/index.html">Parser PSD files on CoffeeScript</a></li>
<li><a href="../137382/index.html">Humble Bundle for Android</a></li>
<li><a href="../137385/index.html">What's the point?</a></li>
<li><a href="../137388/index.html">Open Server - a professional Windows web developer tool.</a></li>
<li><a href="../137392/index.html">Update the ranking of the best applications for Windows Phone 7</a></li>
<li><a href="../137394/index.html">How we solved the task of implementing a trial mode in the PVS-Studio code analyzer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>