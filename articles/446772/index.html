<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Do not open ports in the world - you will be broken (risks)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Again and again, after the audit, on my recommendations to hide the ports behind the white-list, I meet with a wall of misunderstanding. Even very coo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Do not open ports in the world - you will be broken (risks)</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/an/nt/sv/anntsvhkknayqt3ewhpeum57bj4.jpeg" alt="image"></p><br><p>  Again and again, after the audit, on my recommendations to hide the ports behind the white-list, I meet with a wall of misunderstanding.  Even very cool admins / DevOps ask: "Why?!?" </p><br><p>  I propose to consider the risks in descending order of probability of occurrence and damage. </p><br><ol><li>  Configuration error </li><li>  DDoS over IP </li><li>  Brutfors </li><li>  Service Vulnerabilities </li><li>  Kernel stack vulnerabilities </li><li>  Strengthen DDoS attacks <a name="habracut"></a></li></ol><br><h2 id="oshibka-konfiguracii">  Configuration error </h2><br><p>  The most typical and dangerous situation.  As it happens.  The developer needs to quickly test the hypothesis, he raises a temporary server with mysql / redis / mongodb / elastic.  The password, of course, is complex, it uses it everywhere.  It opens the service to the world - it is convenient for him to connect from his PC to the PC without these VPNs.  And iptables syntax is too lazy to remember, anyway the server is temporary.  A couple of days of development - it turned out great, you can show the customer.  The customer likes it; there is no time to redo it; </p><br><p>  An example is intentionally exaggerated in order to walk on all the rakes: </p><br><ol><li>  Nothing is more permanent than temporary - I do not like this phrase, but according to subjective feelings, 20-40% of such temporary servers remain for a long time. </li><li>  A complex universal password that is used in many services is evil.  Because one of the services where this password was used could have been cracked.  One way or another, the bases of the hacked services flock to the one that is used for [brute force] *. <br>  It should be added that redis, mongodb and elastic after installation are generally available without authentication, and often replenish the <a href="https://habr.com/en/post/443132/">collection of open databases</a> . </li><li>  It may seem that in a couple of days no one will scoop your 3306 port.  It's a delusion!  Masscan is an excellent scanner, and can scan at 10M ports per second.  And on the Internet only 4 billion IPv4.  Accordingly, all the 3306th ports on the Internet are in 7 minutes.  Charles!!!  Seven minutes! <br>  "But who cares?"  - you will object.  So I am surprised looking at the statistics of the dropped packets.  From where in a day 40 thousand attempts of a scan from 3 thousand unique IP?  Now they are crawling all and sundry, from Mommy hackers to governments.  It is very simple to check - take any VPS for $ 3-5 from any ** low-cost airline, turn on drop-packet logging and check the log in a day. </li></ol><br><div class="spoiler">  <b class="spoiler_title">Enable logging</b> <div class="spoiler_text"><p>  In /etc/iptables/rules.v4 add at the end: <br>  -A INPUT -j LOG --log-prefix "[FW - ALL]" --log-level 4 </p><br><p>  And in /etc/rsyslog.d/10-iptables.conf <br>  : msg, contains, "[FW -" /var/log/iptables.log <br>  &amp; stop </p></div></div><br><h2 id="ddos-po-ip">  DDoS over IP </h2><br><p>  If the attacker knows your IP, he can pause your server for several hours or days.  Not all low-cost hostings have DDoS protection and your server will simply be disconnected from the network.  If you hid the server behind the CDN, do not forget to change the IP, otherwise the hacker will google it and DDoS'it your server to bypass the CDN (a very popular error). </p><br><h2 id="uyazvimosti-servisov">  Service Vulnerabilities </h2><br><p>  In all popular software, sooner or later errors are found, even in the most tested and most critical ones.  In the environment of IBeshnikov, there is such a half-joke - the security of the infrastructure can be safely assessed by the time of the last update.  If your infrastructure is rich in ports protruding into the world, and you have not updated it for a year, then any security person will tell you, without looking, that you are full of holes, and most likely have already been hacked. <br>  It is also worth mentioning that all known vulnerabilities were once unknown.  Imagine a hacker who found such a vulnerability, and scanned the entire Internet in 7 minutes for its presence ... Here's a new virus epidemic) We need to be updated, but it can harm the product, you say.  And you will be right if the packages are not installed from the official OS repositories.  From experience, updates from the official repository rarely break the prod. </p><br><h2 id="brutfors">  Brutfors </h2><br><p>  As described above, there is a base with half a billion passwords that are conveniently typed from the keyboard.  In other words, if you have not generated a password, but typed nearby characters on the keyboard, be sure * - you will be knocked out. </p><br><h2 id="uyazvimosti-steka-yadra">  Kernel stack vulnerabilities. </h2><br><p>  It happens **** and such that it doesn't even matter which service opens the port when the network's kernel stack itself is vulnerable.  That is absolutely any tcp / udp-socket on a two-year-old system is vulnerable to vulnerabilities leading to DDoS. </p><br><h2 id="usilenie-ddos-atak">  Strengthen DDoS attacks </h2><br><p>  It will not bring damage directly, but it can clog your channel, increase the load on the system, your IP will fall into some black-list *****, and an abuzz from the hoster will arrive. </p><br><p>  Do you really need all these risks?  Add your home and work IP to the white-list.  Even if it is dynamic - log in through the host admin admin, via the web console, and just add one more. </p><br><p>  I have been engaged in building and protecting IT infrastructure for 15 years.  I worked out a rule that I highly recommend to everyone - <strong>not a single port should stick in the world without a white-list</strong> . </p><br><p>  For example, the most secure web server *** is the one with 80 and 443 open for CDN / WAF only.  And the service ports (ssh, netdata, bacula, phpmyadmin) should be at least behind the white-list, and even better for the VPN.  Otherwise, you risk being compromised. </p><br><p>  That's all I wanted to say.  Keep your ports closed! </p><br><hr><br><ul><li>  (1) <strong>UPD1</strong> : <a href="https://haveibeenpwned.com/Passwords">Here</a> you can check your cool universal password ( <strong>do not do this without replacing this password with random ones in all services</strong> ), did it not light up in the merged database.  <a href="https://haveibeenpwned.com/">And here</a> you can see how many services were hacked, where your email appeared, and, accordingly, find out if your cool universal password has been compromised. </li><li>  (2) To its credit, Amazon has a minimum of scans on LightSail.  Apparently, somehow filtered. </li><li>  (3) An even more secure web server is one that is behind a dedicated firewall, its WAF, but this is public VPS / Dedicated. </li><li>  (4) Segmentsmak. </li><li>  (5) Firehol. </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/446772/">https://habr.com/ru/post/446772/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../446760/index.html">Top 3D Expo 2019 Topics: 3D Metal Printing, Anton Sotov, Samara University</a></li>
<li><a href="../446762/index.html">6. Check Point Getting Started R80.20. Getting Started in SmartConsole</a></li>
<li><a href="../446764/index.html">WASI Standard: Running WebAssembly Outside the Web</a></li>
<li><a href="../446768/index.html">Nominative typing in TypeScript or how to protect your interface from foreign identifiers</a></li>
<li><a href="../446770/index.html">12 JavaScript tricks that aren't found in most tutorials</a></li>
<li><a href="../446774/index.html">Low poly characters design</a></li>
<li><a href="../446776/index.html">Proof-of-work effective</a></li>
<li><a href="../446780/index.html">How to create a dark theme and do no harm. Experience team Yandex. Mail</a></li>
<li><a href="../446782/index.html">Yo ho ho and a bottle of rum</a></li>
<li><a href="../446784/index.html">Backlog Grooming Grooming Backlog</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>