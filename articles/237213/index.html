<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Boot into Vim or Vim with PID 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the answer to a great article from Pascal Bourguignon, in which he talks about how to run Emacs with PID 1 . 

 As we all know, nobody uses Em...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Boot into Vim or Vim with PID 1</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/0c9/f08/2ef/0c9f082ef3da491890ecadc49552e641.png" alt="Boot to Vim (boot window)"><br><br>  This is the answer to a great article from Pascal Bourguignon, in which he talks about <a href="http://www.informatimago.com/linux/emacs-on-user-mode-linux.html">how to run Emacs with PID 1</a> . <br><br>  As we all know, nobody uses Emacs. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The proposal above seems to hint that this is the beginning of the next holy war.  Please start.  If you want to tell me something, all my contacts are in my blog. <br><br>  In fact, joking aside.  I think this is a great article, and after reading it, I wanted to see if I could do something similar with Vim.  Not in Linux user mode, but in reality creating an ISO to boot.  You can say, ‚Äúboot into Vim‚Äù, if you so wish. <br><a name="habracut"></a><br>  It is, indeed, quite simple.  Compile Vim statically, set <code>init=</code> to boot, and you're done. <br><br>  We will use a small (9Mb) distribution of the <a href="http://distro.ibiblio.org/tinycorelinux/">Tiny Core, Core edition</a> and configure it so that the download goes straight to our statically assembled Vim. <br><br><h3>  We collect Vim </h3><br>  Please follow my other manual on <a href="https://raymii.org/s/blog/Statically_cross_compiled_vim_for_x86_x86-64_and_mips.html">how to build a statically linked Vim</a> .  As a result, you will receive an executable file that we will use later in this guide. <br><br><h3>  Training </h3><br>  You will need several tools to build the ISO, namely <code>cpio</code> , <code>tar</code> , <code>gzip</code> , <code>advdef</code> and <code>mkisofs</code> .  They can most likely be installed using your package manager, if they are not already installed.  Please do it for a start. <br><br>  First, create a directory to build: <br><br><pre> <code class="bash hljs">mkdir vim-as-pid-1 <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> vim-as-pid-1</code> </pre> <br><br>  Also create a couple of directories to build an ISO: <br><br><pre> <code class="bash hljs">mkdir /tmp/isomount mkdir extract</code> </pre> <br><br>  Download the latest version of Tiny Core, Core edition (without GUI): <br><br><pre> <code class="bash hljs">wget http://distro.ibiblio.org/tinycorelinux/5.x/x86/release/Core-current.iso</code> </pre> <br><br>  Copy the files from the downloaded ISO: <br><br><pre> <code class="bash hljs">mount Core-current.iso /tmp/isomount/ -o loop,ro cp -a /tmp/isomount/boot /tmp/</code> </pre> <br><br>  These commands will create the <code>/tmp/boot</code> with the bootloader and the <code>core.gz</code> file.  Do not forget to unmount it: <br><br><pre> <code class="bash hljs">umount /tmp/isomount</code> </pre> <br><br>  We will use the <code>/tmp/boot</code> further when we put everything together in an ISO file. <br><br><h3>  Change ISO file </h3><br><br>  Go to the directory where <code>core.gz</code> will be extracted - the root directory of the file system: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> extract</code> </pre> <br><br>  Use <code>zcat</code> and <code>cpio</code> to extract the file system root from <code>core.gz</code> : <br><br><pre> <code class="bash hljs">zcat /tmp/boot/core.gz | cpio -i -H newc -d</code> </pre> <br><br>  We now have the extracted filesystem root directory: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ls bin dev etc home init lib linuxrc mnt opt proc root run sbin sys tmp usr var</span></span></code> </pre> <br><br>  Place the Vim executable compiled in the previous step in the <code>bin/</code> directory <br><br><pre> <code class="bash hljs">cp ~/vim bin/</code> </pre> <br><br>  You can also make different settings, for example, edit the message of the loader.  It is located in a file named <code>boot.msg</code> in the <code>/tmp/boot/isolinux/</code> directory: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vim /tmp/boot/isolinux/boot.msg ^L _ ( - Boot to Vim //\ Vim as Pid 1, because Awesome! v_/_ https://raymii.org/ Press &lt;Enter&gt; to begin or F2, F3, or F4 to view boot options.</span></span></code> </pre> <br><br><h3>  Change inittab </h3><br><br>  To load directly into Vim, we need to change the initialization configuration.  Edit the following file: <br><br><pre> <code class="bash hljs">vim etc/inittab</code> </pre> <br><br>  Change these lines: <br><br><pre> <code class="bash hljs">::sysinit:/etc/init.d/rcS tty1::respawn:/sbin/getty 38400 tty1</code> </pre> <br><br>  on: <br><br><pre> <code class="bash hljs">::sysinit:/bin/vim tty1::respawn:/bin/vim</code> </pre> <br><br><h3>  We collect new ISO </h3><br>  Make sure that we are still in the directory named <code>extract</code> .  Next, we‚Äôll use the following command to build a new <code>tinycore.gz</code> file, which our ISO will use as <code>initramfs</code> : <br><br><pre> <code class="bash hljs">find | cpio -o -H newc | gzip -2 &gt; ../tinycore.gz</code> </pre> <br><br>  Copy it to a file called <code>core.gz</code> to the <code>/tmp/boot</code> , which we copied earlier: <br><br><pre> <code class="bash hljs">cp ../tinycore.gz /tmp/boot/core.gz</code> </pre> <br><br>  Create a new directory for the files that will be in the new ISO: <br><br><pre> <code class="bash hljs">mkdir /tmp/newiso</code> </pre> <br><br>  Copy the <code>/tmp/boot</code> directory into it: <br><br><pre> <code class="bash hljs">cp -a /tmp/boot /tmp/newiso/</code> </pre> <br><br>  We assemble ISO using <code>mkisofs</code> : <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /tmp/ mkisofs -l -J -R -V Boot_To_Vim -no-emul-boot -boot-load-size 4 -boot-info-table -b boot/isolinux/isolinux.bin -c boot/isolinux/boot.cat -o Boot_to_Vim.iso newiso</code> </pre> <br><br>  You now have a file in <code>/tmp</code> called <code>Boot_to_Vim.iso</code> : <br><br><pre> <code class="bash hljs">ls -la /tmp/Boot_to_Vim.iso -rw-r--r-- 1 root root 11044864 Sep 17 08:05 /tmp/Boot_to_Vim.iso</code> </pre> <br><br>  You can use it to boot in a virtual machine or to burn to disk.  If you exit Vim, it will start again. <br><br><img src="https://habrastorage.org/files/042/381/13f/04238113fe104c2ca4bab5122ab4a512.png" alt="Boot to vim"><br><br>  You can call the real shell by typing <code>:!sh</code> in command mode.  To turn off use the command <code>:!halt</code> . <br><br>  More information on Tiny Core remastering can be found <a href="http://wiki.tinycorelinux.net/wiki:remastering">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/237213/">https://habr.com/ru/post/237213/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../237199/index.html">Towards Rust 1.0</a></li>
<li><a href="../237201/index.html">CUSTIS Open Seminars: Sixth Season</a></li>
<li><a href="../237203/index.html">The story of one geek</a></li>
<li><a href="../237207/index.html">Analysis of Simplelocker-a - extortion virus for Android</a></li>
<li><a href="../237209/index.html">These entertaining regional settings</a></li>
<li><a href="../237215/index.html">How to create an effective form of gathering contacts: everything you wanted to know, but were afraid to ask</a></li>
<li><a href="../237217/index.html">A bit about iptables, iproute2 and emulation of network problems</a></li>
<li><a href="../237219/index.html">Let's play a game</a></li>
<li><a href="../237221/index.html">SDR / SDN - how the new architecture is implemented in a real cellular network</a></li>
<li><a href="../237225/index.html">BitTorrent Bleep: protected instant messenger from BitTorrent</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>