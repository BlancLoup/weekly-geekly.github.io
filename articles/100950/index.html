<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The MQV protocol is good old Diffie-Hellman, but not quite</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For more than 30 years, the Diffie-Hellman key distribution protocol has been pleasing the eye of a simple cryptomaniac for its simplicity and reliabi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The MQV protocol is good old Diffie-Hellman, but not quite</h1><div class="post__text post__text-html js-mediator-article">  For more than 30 years, the Diffie-Hellman key distribution protocol has been pleasing the eye of a simple cryptomaniac for its simplicity and reliability.  For those who have spent the last 30 years studying more fun than learning cryptographic protocols, I explain. <br>  The Diffie-Hellman protocol was published in 1976 and marked the beginning of an era of asymmetric cryptography.  Its essence is ingeniously simple: Alice and Bob want to get a common key for a symmetric cryptosystem.  To do this, they agree, choose two large numbers g and p.  These numbers are known to both of them and it makes no sense to keep them secret.  Then Alice secretly generates a large secret number a, and Bob - a large number b.  And then simple arithmetic takes over.  Alice sends Bob the number <br><img src="https://habrastorage.org/storage/habraeffect/0d/6d/0d6de5b0742e7321cd6221753e90f17e.jpg" alt="image">  . <br>  Bob in turn sends Alice <br><img src="https://habrastorage.org/storage/habraeffect/30/cd/30cdbebc69e0fc6003e505174af18431.jpg" alt="image">  . <br><a name="habracut"></a><br>  Now, to get the shared key Alice calculates <img src="https://habrastorage.org/storage/habraeffect/30/c8/30c8406bceff84944b75b14f6d514329.jpg" alt="image">  and Bob finds <img src="https://habrastorage.org/storage/habraeffect/08/29/08292cb2e36cc10c8201219cafcfc0d3.jpg" alt="image">  . <br>  It is easy to verify that <img src="https://habrastorage.org/storage/habraeffect/d2/2b/d22bb6c80d5e77389738186f36e416bb.jpg" alt="image">  because <br><img src="https://habrastorage.org/storage/habraeffect/a6/c3/a6c33fddbcd4a3a2ee6fcec6aae6dd33.jpg" alt="image">  . <br>  The genius of the idea is that it will not take long for Alice and Bob to get the key K, while the attacker needs to be able to solve a discrete logarithm problem in order to find K. <br>  Fearing to tire the reader with well-known facts, I turn right to the point.  And what if to abstract from the theory and to pass to practice?  Then we get the following. <br><br>  The Diffie-Hellman protocol perfectly opposes a passive attack, but in the case of the ‚Äúman in the middle‚Äù attack, he will not stand.  In fact, neither Alice nor Bob can reliably determine who their interlocutor is in the protocol, so it is quite possible to imagine the following situation in which Bob and Alice established contact with Mallory, who Alice impersonating Bob, and Bob appears to be Alice.  And then, instead of the Diffie-Hellman protocol, we get something similar to the following: <br><table><tbody><tr><td>  <b>Step</b> <br></td><td>  <b>Alice</b> <br></td><td>  <b>Mallory</b> <br></td><td>  <b>Bean</b> <br></td></tr><tr><td>  one <br></td><td><img src="https://habrastorage.org/storage/habraeffect/35/54/35545eba74e6de5256b33ee19583e019.jpg" alt="image"><img src="https://habrastorage.org/storage/habraeffect/62/1a/621a4069d9c9aba834e06daf4a95c892.jpg" alt="image"><br></td><td><img src="https://habrastorage.org/storage/habraeffect/35/54/35545eba74e6de5256b33ee19583e019.jpg" alt="image"><br></td><td></td></tr><tr><td>  2 <br></td><td><img src="https://habrastorage.org/storage/habraeffect/d9/34/d934ba043a66f89117a77914afd0ae7b.jpg" alt="image"><img src="https://habrastorage.org/storage/habraeffect/70/6c/706c2e1eef7cbe7170bc622a1bf49b21.jpg" alt="image"><br><img src="https://habrastorage.org/storage/habraeffect/08/8b/088bb83d4cc3f904714a9fe3e308e021.jpg" alt="image"><br></td><td><img src="https://habrastorage.org/storage/habraeffect/d9/34/d934ba043a66f89117a77914afd0ae7b.jpg" alt="image"><br><img src="https://habrastorage.org/storage/habraeffect/08/8b/088bb83d4cc3f904714a9fe3e308e021.jpg" alt="image"><br></td><td></td></tr><tr><td>  3 <br></td><td></td><td><img src="https://habrastorage.org/storage/habraeffect/d9/34/d934ba043a66f89117a77914afd0ae7b.jpg" alt="image"><img src="https://habrastorage.org/storage/habraeffect/62/1a/621a4069d9c9aba834e06daf4a95c892.jpg" alt="image"><br></td><td><img src="https://habrastorage.org/storage/habraeffect/d9/34/d934ba043a66f89117a77914afd0ae7b.jpg" alt="image"><br></td></tr><tr><td>  four <br></td><td></td><td><img src="https://habrastorage.org/storage/habraeffect/ae/b4/aeb4ff47f76faa61ac3c0468d6ad0f97.jpg" alt="image"><img src="https://habrastorage.org/storage/habraeffect/70/6c/706c2e1eef7cbe7170bc622a1bf49b21.jpg" alt="image"><br><img src="https://habrastorage.org/storage/habraeffect/b5/15/b51509e3575c614c57ee5dacc7050e30.jpg" alt="image"><br></td><td><img src="https://habrastorage.org/storage/habraeffect/ae/b4/aeb4ff47f76faa61ac3c0468d6ad0f97.jpg" alt="image"><br><img src="https://habrastorage.org/storage/habraeffect/b5/15/b51509e3575c614c57ee5dacc7050e30.jpg" alt="image"><br></td></tr></tbody></table><br><br>  That is, Mallory gets one key shared with Alice (who believes that this is Bob), and one key shared with Bob (who believes that this is Alice).  And, therefore, he can receive from Alice any message for Bob to decrypt him with the key <img src="https://habrastorage.org/storage/habraeffect/08/8b/088bb83d4cc3f904714a9fe3e308e021.jpg" alt="image">  read key encrypt <img src="https://habrastorage.org/storage/habraeffect/b5/15/b51509e3575c614c57ee5dacc7050e30.jpg" alt="image">  and pass to bob.  Thus, forgery can go unnoticed for a very long time. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  EDS as protection </h4><br>  How to deal with such vulnerabilities?  The most logical and simple answer: mutual authentication is needed.  And here comes to the aid of digital signature. <br>  If Bob has Alice‚Äôs public key and he‚Äôs one hundred percent sure that it‚Äôs really Alice‚Äôs key, then to defend against the man-in-the-middle attack, Alice just needs to sign the number in step 1 with her private key. Now, Mallory can try to pass herself for Alice, but he will not be able to forge her signature, and Bob will immediately begin to be tormented by ‚Äúvague doubts‚Äù. <br>  It would seem that a solution was found, the protocol was improved, the vulnerability was removed.  But ... As always, there is one thing.  And in this case, the role of such is the excessive increase in the size of messages by adding a signature.  The following table demonstrates this effect: <br><table><tbody><tr><td>  <b>Algorithms</b> <br></td><td>  <b>Message size</b> <br></td><td>  <b>Signature size</b> <br></td><td>  <b>Overall size</b> <br></td></tr><tr><td>  Diffie-Hellman + DSA-signature <br></td><td>  1024 bits <br></td><td>  320 bits <br></td><td>  1344 bits <br></td></tr><tr><td>  Diffie-Hellman + RSA-signature <br></td><td>  1024 <br></td><td>  1024 <br></td><td>  2048 <br></td></tr><tr><td>  Diffie-Hellman (on elliptic curves) + RSA-signature <br></td><td>  160 <br></td><td>  1024 <br></td><td>  1184 <br></td></tr><tr><td>  Diffie-Hellman (on elliptic curves) + DSA-signature (on elliptic curves) <br></td><td>  160 <br></td><td>  320 <br></td><td>  480 <br></td></tr></tbody></table><br><br>  As can be seen from this table, the size of messages increases by several times.  It would seem, and God is with them with these extra 320 bits, who will be harmed by them?  But in cryptography they do not tolerate half measures.  That is why the MQV protocol was devised, which relieves Diffie-Hellman from vulnerability and does not use EDS. <br><br><h4>  MQV protocol </h4><br>  So, the MQV protocol is a key distribution protocol that supports mutual authentication of the parties and thereby eliminates the vulnerability to the man-in-the-middle attack inherent in classic Diffie-Hellman.  Among other things, no additional information, like e-signature, is used to authenticate users, which significantly reduces the size of transmitted messages. <br><table><tbody><tr><td>  <b>Protocol</b> <br></td><td>  <b>Message size</b> <br></td></tr><tr><td>  Mqv <br></td><td>  1024 bits <br></td></tr><tr><td>  MQV (on elliptic curves) <br></td><td>  160 bits <br></td></tr></tbody></table><br>  Now about the protocol itself. <br>  Alice and Bob each have their own key pair, consisting of public and private keys: <img src="https://habrastorage.org/storage/habraeffect/fd/c7/fdc7a05b31acb99d7ded7bec7a3a1ce9.jpg" alt="image">  and <img src="https://habrastorage.org/storage/habraeffect/1a/bc/1abc3c332094d4c83a7b397c6058fd27.jpg" alt="image">  .  Of course, Bob is aware of Alice‚Äôs public key, and that, in turn, is Bob‚Äôs public key. <br>  Next, Alice and Bob generate a session key pair: <img src="https://habrastorage.org/storage/habraeffect/d7/a5/d7a53ef24f7f1986cb0d3156e1a9e8b6.jpg" alt="image">  and <img src="https://habrastorage.org/storage/habraeffect/27/b2/27b266bff69a2d1378658b539529e4c9.jpg" alt="image">  . <br>  Then there is an exchange as in the classic Diffie-Hellman protocol: <br>  Alice to Bob: <img src="https://habrastorage.org/storage/habraeffect/8e/45/8e45512beef494801643ce0c012d2f27.jpg" alt="image"><br>  Bob to Alice: <img src="https://habrastorage.org/storage/habraeffect/97/c0/97c0828b923ff2c905615f7f00ae85e2.jpg" alt="image"><br>  Now Alice knows: A, B, C, D, <i>a</i> , <img src="https://habrastorage.org/storage/habraeffect/29/41/294152e0df6c4e49bf6735c3393a691f.jpg" alt="image">  . <br>  And Bob is known: A, B, C, D, <i>b</i> , <img src="https://habrastorage.org/storage/habraeffect/ec/fe/ecfe375fee06d7e2a21308a5e8b1b25d.jpg" alt="image">  . <br>  To get the common key K, they must do the following. <br><br>  Alice: <br>  Selects the number l equal to the message size in bits divided by 2. So if EC-MQV is used and the message length is 160 bits, then l = 80. <br>  1. Sets <img src="https://habrastorage.org/storage/habraeffect/87/67/87675aafd2181d7b32862ea6acf4100f.jpg" alt="image"><br>  2. Finds <img src="https://habrastorage.org/storage/habraeffect/1f/30/1f30b06ab49e9ea03513ad98c9a078b6.jpg" alt="image"><br>  3. Sets <img src="https://habrastorage.org/storage/habraeffect/e8/b6/e8b6905919f7fc46d2d16d98adcceab9.jpg" alt="image"><br>  4. Calculates <img src="https://habrastorage.org/storage/habraeffect/97/75/97758ce33570e003294b1df043ded0c0.jpg" alt="image"><br>  5. Finds <img src="https://habrastorage.org/storage/habraeffect/59/a2/59a29ec892390c71d1eb8482d07d53fd.jpg" alt="image"><br>  6. Calculates <img src="https://habrastorage.org/storage/habraeffect/7f/ac/7fac4ac4eb92d013aa00793a324355aa.jpg" alt="image"><br>  Bob performs the same actions, but with his private keys: <br>  1. Sets <img src="https://habrastorage.org/storage/habraeffect/0c/17/0c1770920c75e47d3feaeda02979ec48.jpg" alt="image"><br>  2. Finds <img src="https://habrastorage.org/storage/habraeffect/ec/65/ec652a606da02b69cf4bbc45a7a8cd66.jpg" alt="image"><br>  3. Sets <img src="https://habrastorage.org/storage/habraeffect/ff/7e/ff7ecd81f83a9f9362049be0728d6975.jpg" alt="image"><br>  4. Calculates <img src="https://habrastorage.org/storage/habraeffect/ea/07/ea07619570d593b68f2522abb57d78b2.jpg" alt="image"><br>  5. Finds <img src="https://habrastorage.org/storage/habraeffect/34/e7/34e7b3fe1d8e77ca61a8efb6ceab10d3.jpg" alt="image"><br>  6. Calculates <img src="https://habrastorage.org/storage/habraeffect/ab/f0/abf0bd303695231ffcbbd5ef99d8add9.jpg" alt="image"><br>  The resulting numbers are <img src="https://habrastorage.org/storage/habraeffect/13/02/13028d5ca1f3511450e9165bd3d8fc94.jpg" alt="image">  and there is a shared secret key.  Make sure of this: <br><img src="https://habrastorage.org/storage/habraeffect/9b/45/9b4582d7fc926d54f388654ba5a034cc.jpg" alt="image">  because <img src="https://habrastorage.org/storage/habraeffect/ad/fe/adfe9fe8a9c82025fd402a631ca6a837.jpg" alt="image">  and <img src="https://habrastorage.org/storage/habraeffect/5f/2a/5f2ad441f7f9f1aa31bf13a337d47e2e.jpg" alt="image">  ; <br><img src="https://habrastorage.org/storage/habraeffect/c6/82/c682d291a4902bfaa15625842e4b235e.jpg" alt="image">  because <img src="https://habrastorage.org/storage/habraeffect/59/a2/59a29ec892390c71d1eb8482d07d53fd.jpg" alt="image">  ; <br><img src="https://habrastorage.org/storage/habraeffect/89/c1/89c161f166904151951e3e20fcaae273.jpg" alt="image">  because <img src="https://habrastorage.org/storage/habraeffect/10/a0/10a0d932ad1d52e9bee6582dc0dcaf5a.jpg" alt="image">  and <img src="https://habrastorage.org/storage/habraeffect/c3/3d/c33dd998bd6f22c10f2a960188eccf0b.jpg" alt="image">  ; <br><img src="https://habrastorage.org/storage/habraeffect/f3/45/f345fa90c70757c2b77b9bdfd9d6913b.jpg" alt="image">  because <img src="https://habrastorage.org/storage/habraeffect/34/e7/34e7b3fe1d8e77ca61a8efb6ceab10d3.jpg" alt="image">  ; <br><img src="https://habrastorage.org/storage/habraeffect/8d/32/8d32359581b2b0766380f2e15885201e.jpg" alt="image">  . <br>  Note that the transformation keys use the secret keys of both Alice and Bob.  Those.  Any protocol user can be sure that in addition to the person with whom he wants to establish a connection, no one will be able to get the shared key. <br>  Despite the seeming complexity, the MQV protocol does not lose anything in comparison with the scheme using an EDS, because the same operation of raising to a power modulo a prime number is used both there and there.  The benefit of using the protocol is as follows.  This is, firstly, resistance to the man-in-the-middle attack, secondly, the small size of messages, and, thirdly, a convenient implementation of the protocol, which saves the user from having to sign each message sent. <br><br>  upd: <br>  Literature <br>  1. N. Smart "cryptography" (the most complete description of the MQV protocol in Russian from all I have met). <br>  2. Bolotov A. and others. ‚ÄúAn elementary introduction to elliptic cryptography‚Äù (description of the protocol on elliptic curves). <br>  3. Well, the link to <a href="http://en.wikipedia.org/wiki/MQV">Wikipedia</a> . </div><p>Source: <a href="https://habr.com/ru/post/100950/">https://habr.com/ru/post/100950/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../100938/index.html">Overview of on-line services for converting Latex formulas into pictures</a></li>
<li><a href="../100941/index.html">Strange bug in Opera 10.60 and its possible solution</a></li>
<li><a href="../100942/index.html">British robot with rat brains</a></li>
<li><a href="../100944/index.html">Did you connect the telescope to a computer?</a></li>
<li><a href="../100949/index.html">Overview of Free XML Editors</a></li>
<li><a href="../100951/index.html">USB over IP or AnywhereUSB</a></li>
<li><a href="../100952/index.html">Migrating from RAID1 to RAID5 in mdadm without data loss</a></li>
<li><a href="../100953/index.html">Topological sorting</a></li>
<li><a href="../100956/index.html">Literate implementation of Google Ajax Search</a></li>
<li><a href="../100959/index.html">Ten tips for novice programmers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>