<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Extending wget features</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. 

 So I became a full user Habr. I want to thank the person who gave me an invite for this article: 
 Not long ago, I began to comprehend worki...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Extending wget features</h1><div class="post__text post__text-html js-mediator-article">  Hello. <br><br><h6>  <i>So I became a full user Habr.</i>  <i>I want to thank the person who gave me an invite for this article:</i> </h6><br>  Not long ago, I began to comprehend working with Linux (in particular, Ubuntu 8.10), and I had the task of automatically downloading files through the list.  ‚ÄúWget -i‚Äù is certainly a good thing, but I wanted more, namely: <br><ol><li>  Downloading a list of links from a file </li><li>  Downloading multiple files at once </li><li>  Transfer failed downloads to a separate list for further retries. </li></ol><br>  So there is a need for a slightly more advanced tool for downloading files than wget can offer.  I decided to implement it with bash.  The truth may prevent the lack of experience in writing bash-scripts, but just came the weekend and the hours spent on the material on the topic were not in vain. <br><a name="habracut"></a><br>  The result of my work was the following script: <br><br>  <b>Update:</b> Thanks to the advice, <a href="https://habrahabr.ru/users/zencd/" class="user_link">zencd</a> used the <i>wait</i> command to <i>wait</i> for the downloads to complete. <br>  <b>Update 2:</b> <a href="https://habrahabr.ru/users/shulc/" class="user_link">shulc</a> indicated an error: replaced <i>#! / Binbash</i> with <i>#! / Bin / sh</i> .  <a href="https://habrahabr.ru/users/darkk/" class="user_link">darkk</a> prompted <i>mktemp</i> to create temporary files. <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">#!/bin/sh <br> log_dir= <font color="#A31515">"${PWD}/log"</font> <br> list_dir= <font color="#A31515">"${PWD}/list"</font> <br> output_dir=${PWD} <br> # download_list -     <br> download_list= <font color="#A31515">"${list_dir}/download.lst"</font> <br> #  active_list    <br> active_list= <font color="#A31515">"${list_dir}/active.lst"</font> <br> #  done_list    <br> done_list= <font color="#A31515">"${list_dir}/done.lst"</font> <br> #  error_list    <br> error_list= <font color="#A31515">"${list_dir}/error.lst"</font> <br> # $timeout -        <br> timeout=5 <br> <br> #   $1   $2   $3,      <br> # move_line line source_file dest_file <br> move_line() <br> { <br> tmp_file=`mktemp -t downloader.XX` <br> echo $1 &gt;&gt; $3 <br> cat $2 | grep -v $1 &gt; $tmp_file <br> mv $tmp_file $2 <br> } <br> <br> #  ,  $1     <br> download_thread() <br> { <br> thread=$1 <br> #  ,   download.lst  error.lst    <br> <font color="#0000ff">while</font> [ -s $download_list ] || [ -s $error_list ] <br> <font color="#0000ff">do</font> <br> #  download.lst  -      error.lst <br> <font color="#0000ff">if</font> [ ! -s $download_list ] <br> then <br> read url &lt; $error_list <br> move_line $url $error_list $download_list <br> sleep $timeout <br> fi <br> read url &lt; $download_list <br> move_line $url $download_list $active_list <br> echo <font color="#A31515">"[Thread ${thread}]Starting download: $url"</font> <br> #   <br> wget -c -o <font color="#A31515">"${log_dir}/wget_thread${thread}.log"</font> -O <font color="#A31515">"${output_dir}/$(basename "</font> $url <font color="#A31515">")"</font> $url <br> #    wget ( 0 -  ) <br> <font color="#0000ff">if</font> [ $? -eq 0 ] <br> then <br> #     <br> move_line $url $active_list $done_list <br> echo <font color="#A31515">"[Thread ${thread}]Download successful: $url"</font> <br> <font color="#0000ff">else</font> <br> #   -       <br> move_line $url $active_list $error_list <br> echo <font color="#A31515">"[Thread ${thread}]Error download: $url"</font> <br> fi <br> done <br> <font color="#0000ff">return</font> 0 <br> } <br> <br> #         active.lst <br> stop_script() <br> { <br> #        <br> kill -9 `ps ax | grep $0 | grep -v <font color="#A31515">"grep"</font> | awk <font color="#A31515">'{print $1}'</font> | grep -v $$` <br> #      active.lst <br> <font color="#0000ff">while</font> [ -s $active_list ] <br> <font color="#0000ff">do</font> <br> read url &lt; $active_list <br> move_line $url $active_list $download_list <br> kill -9 `ps ax | grep $url | grep -v <font color="#A31515">"grep"</font> | awk <font color="#A31515">'{print $1}'</font> ` <br> done <br> } <br> <br> <font color="#0000ff">case</font> <font color="#A31515">"$1"</font> <font color="#0000ff">in</font> <br> <font color="#A31515">"stop"</font> ) <br> echo <font color="#A31515">"Stoping downloader..."</font> <br> stop_script <br> echo <font color="#A31515">"Done..."</font> <br> ;; <br> <font color="#A31515">"start"</font> ) <br> #        <br> <font color="#0000ff">if</font> [ ! -e $download_list ]; <br> then <br> echo <font color="#A31515">"[Error] There is no ${list_dir}/download.lst file"</font> <br> exit <br> fi <br> echo <font color="#A31515">"Starting downloader..."</font> <br> #          <br> stop_script <br> #    -    $2,  1  <br> <font color="#0000ff">if</font> [ -z $2 ] <br> then <br> threads=1 <br> <font color="#0000ff">else</font> <br> threads=$2 <br> fi <br> #     <br> i=1 <br> <font color="#0000ff">while</font> [ $i -le $threads ] <br> <font color="#0000ff">do</font> <br> download_thread $i &amp; <br> downloader_pid= <font color="#A31515">"${downloader_pid} $!"</font> <br> sleep 1 <br> i=`expr $i + 1` <br> done <br> <font color="#0000ff">if</font> [ ! -e $error_list ]; then touch $error_list; fi <br> #     <br> wait $downloader_pid <br> #  ... <br> echo <font color="#A31515">"All completed"</font> <br> ;; <br> * ) <br> echo <font color="#A31515">"Usage:"</font> <br> echo <font color="#A31515">"\t$0 start [number of threads]"</font> <br> echo <font color="#A31515">"\t$0 stop"</font> <br> ;; <br> esac <br> <br> <font color="#0000ff">return</font> 0</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  For the script to work, it is necessary to make it executable and create a file "./list/download.lst" with a list of links to download. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Run: <br> <code>sh downloader start [  ]</code> <br>  or, as <a href="https://habrahabr.ru/users/mezomish/" class="user_link">Mezomish</a> correctly noted, so: <br> <code>./downloader start [  ]</code> <br> <br>  Parameter after 'start' is optional (if you do not specify it - ‚Äú1‚Äù is used). <br>  Those.  `sh downloader start 2` will launch the script while simultaneously downloading 2 files. <br><br>  Stop: <br> <code>sh downloader stop</code> <br>  or <br> <code>./downloader stop</code> <br> <br>  At the end of the script using the "Ctrl + C" downloads do not end, because  work in the background, so you need to run the above command command to stop downloading. <br><br>  I decided not to clutter up the script, but in principle, it is not difficult to work with lists (show - display on the screen, add - add download, wipe - clean).  And so he is working, albeit with minimal functionality. <br><br>  Because  this is my first bash script, any comments / suggestions / recommendations are very welcome. <br><br>  Then I will briefly describe the principles of the script, so that those who wish can more easily modify it to fit their needs. <br><br>  The constants are: <br>  log_dir - folder with wget logs (default "./log") <br>  list_dir - folder with lists download_list, active_list, done_list, error_list (by default "./list") <br>  output_dir - folder where downloaded files will be saved (by default ".") <br>  download_list list of download links <br>  active_list - list of active downloads <br>  done_list - list of completed downloads <br>  error_list - list of failed downloads <br>  timeout - time before trying to download a failed download <br><br>  At the beginning of work, the script stops its previously running copies, as well as downloads from active_list (of course, if any) with their transfer to download_list.  This is done in case the script is rerun before the download is completed by the previously launched process.  Further in the loop, the required number of background downloads is created.  Each such background thread is implemented by the download_thread () function.  Her job is to download files from the list until the download_list and error_list are empty.  Thus, the main part of the script, checking these files, will find out whether the jump is over.  Before running wget, the link is transferred from the download_list file to the active_list file.  After wget completes, the link is transferred, either to done_list (if the return code was '0'), or to error_list (if the return code was not equal to '0'). <br>  After everything has been downloaded (download_list and error_list are empty), the script completes its work. <br><br>  That's all.  If you wish, anyone who is a little familiar with scripting can add to it the functions you need. </div><p>Source: <a href="https://habr.com/ru/post/51302/">https://habr.com/ru/post/51302/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../51283/index.html">Malware on car windows</a></li>
<li><a href="../51292/index.html">Google Book Search archive on mobile</a></li>
<li><a href="../51294/index.html">Unpredictable symbolic (symbolic) links in Windows.</a></li>
<li><a href="../51295/index.html">wTorrent'a modding</a></li>
<li><a href="../51297/index.html">Unnecessary indents in lists</a></li>
<li><a href="../51305/index.html">Search engine optimization. Part 1 - internal factors</a></li>
<li><a href="../51313/index.html">Psd - trick with file size</a></li>
<li><a href="../51315/index.html">Overview of SSL certificates: types, choices, benefits.</a></li>
<li><a href="../51318/index.html">Translator</a></li>
<li><a href="../51319/index.html">Qt - translation difficulties</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>