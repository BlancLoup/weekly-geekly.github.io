<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to build a scalable infrastructure on Storage Spaces</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We often wrote about clusters in a box and Windows Storage Spaces and the most common question is how to choose the right disk configuration? 

 The t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to build a scalable infrastructure on Storage Spaces</h1><div class="post__text post__text-html js-mediator-article">  We often wrote about clusters in a box and Windows Storage Spaces and the most common question is how to choose the right disk configuration? <br><br>  The traditional question usually looks like this: <br><br>  <i>- I want 100500 IOPS!</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      or: <br><br>  <i>- I want 20 terabytes.</i> <br><br>  Then it turns out that IOPS actually need not so much and you can get by with a few SSDs, but with 20 terabytes (4 disks in modern times) they want to do pretty well, and in reality it will turn out multi-level storage. <br><br>  How to approach this correctly and plan ahead? <br><br>  You need to consistently answer several key questions, for example: <ul><li>  The priority of data integrity protection (for example, in case of disk failure). </li><li>  Performance is required, but not at the cost of protection. </li><li>  Moderate capacity requirement. </li><li>  The size of the budget for building a mixed solution. </li><li>  Ease of management and monitoring. </li></ul><br><img src="https://habrastorage.org/files/3a4/186/db0/3a4186db0d3a4cfb98f25800c0a1c10f.png"><br><a name="habracut"></a><br>  <b>The process of creating storage on Storage Spaces</b> <br>  Main technologies: <br><ul><li>  <i>Storage Spaces -</i> Virtualized storage: fault tolerant and productive. </li><li>  <i>Failover Clustering -</i> High availability storage access. </li><li>  <i>Scale-Out File Server (SOFS) and Cluster Shared Volumes (CSV) -</i> Scalable and unified access to the repository. </li><li>  <i>SMB3 -</i> Failover and performance protocol using SMB Multichannel, SMB Direct, and SMB Client Redirection. </li><li>  <i>System Center, PowerShell, and In-box Windows Tooling -</i> Manage / Configure / Maintain. </li></ul><br><br>  <i>Advantages of Storage Spaces: A</i> flexible and inexpensive data storage solution based entirely on mass hardware and Microsoft software. <br><br>  The material assumes familiarity with the basics of Storage Spaces (available <a href="http://social.technet.microsoft.com/wiki/contents/articles/15198.storage-spaces-overview.aspx">here</a> and <a href="https://technet.microsoft.com/en-us/library/hh831739.aspx">here</a> ). <br><br>  Steps: <br><table><tbody><tr><td width="50">  one <br></td><td width="200">  Decision evaluation <br></td><td>  Determine the key requirements for the solution, the characteristics of a successful installation. <br></td></tr><tr><td>  2 <br></td><td>  SDS Design (Advance) <br></td><td>  Selection of existing units (hardware and software) for the requirements, the choice of topology and configurations. <br></td></tr><tr><td>  3 <br></td><td>  Test deployment <br></td><td>  Check the selected solution in a real environment, possibly at a reduced scale (Proof-of-Concept, PoC). <br></td></tr><tr><td>  four <br></td><td>  Validation <br></td><td>  The check for compliance with the requirements of paragraph 1. Usually begins with a synthetic load (SQLIO, Iometer, etc.), the final check is carried out in a real environment. <br></td></tr><tr><td>  five <br></td><td>  Optimization <br></td><td>  According to the results of the previous steps and the revealed difficulties, adjustment and optimization of the solution (add / remove / replace hardware blocks, modify the topology, reconfigure the software, etc.), return to step 4 <br></td></tr><tr><td>  6 <br></td><td>  Deployment (in a real environment) <br></td><td>  After optimization of the initial decision to the formulated requirements, there comes a period of implementation of the final version in the real operating environment. <br></td></tr><tr><td>  7 <br></td><td>  The working process <br></td><td>  Phase of operation.  Monitoring, troubleshooting, upgrading, scaling, etc. <br></td></tr></tbody></table><br><br>  The first step was described above. <br><br>  <b>Defining Software Defined Storage Architecture (Advance)</b> <br><br>  Highlights: <br><ul><li>  Job tiring. </li><li>  Counting the number of HDD and SSD. </li><li>  Optimize the ratio of SSD: HDD. </li><li>  Determination of the required number of disk shelves. </li><li>  Requirements for SAS HBA and cable infrastructure. </li><li>  Determine the number of storage servers and configurations. </li><li>  Determining the number of disk pools (Pool). </li><li>  Configuring pools. </li><li>  Count the number of virtual disks. </li><li>  Definition of virtual disk configurations. </li><li>  Calculate the optimal size of the virtual disk. </li></ul><br><br>  <b>General principles</b> <br><br>  You must install all updates and patches (as well as firmware). <br><br>  Try to make the configuration symmetrical and complete. <br><br>  Consider possible failures and create a plan to eliminate the consequences. <br><br><img src="https://habrastorage.org/files/40b/2cc/771/40b2cc771cb844d9a493d2d24cc06d27.png"><br>  <i>Why firmware is important</i> <br><br>  <b>Key Requirements: Tiring</b> <br><br>  Multi-level storage (tearing) significantly increases the overall performance of the storage system.  However, SSD drives have a relatively small capacity and a high price per gigabyte and somewhat increase the complexity of managing the storage. <br><br>  Usually, the tearing is still used, and the ‚Äúhot‚Äù data is placed on the productive level of SSD disks. <br><br><img src="https://habrastorage.org/files/e41/1b4/2bc/e411b42bc77848c6be46a7d517866a33.png"><br><br>  <b>Key requirements: type and number of hard drives</b> <br><br>  The type, capacity and number of disks should reflect the desired capacity of the storage system.  SAS and NL-SAS drives are supported, but expensive SAS 10 / 15K drives are not often needed when using tiring with a storage level on an SSD. <br><br>  A typical choice *: 2-4 TB NL-SAS, model from one manufacturer with the latest stable firmware version. <br><br>  <i>* Typical values ‚Äã‚Äãreflect current recommendations for working with virtualized tasks.</i>  <i>Other types of load require additional work.</i> <br><br>  Capacity calculation: <br><br><img src="https://habrastorage.org/files/965/1d8/682/9651d86821054cbeabdc257f2a885a6f.png"><br><br>  Where: <br>  a) Number of hard drives. <br>  b) Number of disks - the nearest nearest even value to the resulting number. <br>  c) Typical data block size (in gigabytes). <br>  d) Reserve for capacity expansion. <br>  e) Data integrity loss.  Two-way mirror, three-way mirror, parity and other array types offer a different margin of "durability". <br>  f) Each disk in Storage Spaces stores a copy of metadata (about pools, virtual disks) +, if necessary, provide a reserve for fast rebuild technology. <br>  g) Disk capacity in gigabytes. <br><br>  Performance calculation: <br><br><img src="https://habrastorage.org/files/bc2/600/222/bc260022224c41198127ef691b849dc6.png"><br><br>  Where: <br>  a) Number of hard drives. <br>  b) Number of disks - the nearest nearest even value to the resulting number. <br>  c) The number of IOPS that is planned to be obtained from the level of hard drives. <br>  d) Record percentage. <br>  e) Penalty on recording, which is different for different array levels used, which must be taken into account (for the system as a whole, for example, for 2-way mirror 1, the write operation causes 2 recordings on the disks, for 3-way mirror there are already 3 records). <br>  f) Estimate disk performance for writing. <br>  g) Evaluation of disk performance for reading. <br><br>  <i>* Calculations are given for the starting point of system planning</i> . <br><br>  <b>Key requirements: type and number of SSD</b> <br><br>  With the hard drives sorted out, it's time to count the SSD.  Their type, quantity and volume is based on the desired maximum performance of the disk subsystem. <br><br>  Increasing the capacity of the SSD level allows you to move more tasks to the fast level using the integrated tiering engine. <br><br>  Since the number of columns (Columns, data parallelization technology) in a virtual disk should be the same for both levels, increasing the number of SSDs usually allows you to create more columns and increase HDD level performance. <br><br>  A typical choice: 200-1600 GB on MLC-memory, model from one manufacturer with the latest stable firmware version. <br><br>  Performance calculation *: <br><br><img src="https://habrastorage.org/files/1a2/54a/8c7/1a254a8c76264f7da63ea87eb503e54c.png"><br><br>  Where: <br>  a) The number of SSD drives. <br>  b) SSD number - the nearest nearest even value to the resulting number. <br>  c) The number of IOPS that you plan to receive from the SSD level. <br>  d) Record percentage. <br>  e) The penalty for writing is different for different levels of the array, it is necessary to take into account when planning. <br>  f) Estimate the performance of SSD write. <br>  g) Estimation of SSD performance for reading. <br><br>  * Only for a starting point.  Usually, the number of SSDs significantly exceeds the required minimum for performance due to additional factors. <br><br>  The recommended minimum number of SSD in the shelves: <br><table><tbody><tr><td>  Array type <br></td><td>  24 Disk JBOD (2 Columns) <br></td><td>  60 disk JBOD (4 columns) <br></td></tr><tr><td>  Two-way mirror <br></td><td>  four <br></td><td>  eight <br></td></tr><tr><td>  Three-way mirror <br></td><td>  6 <br></td><td>  12 <br></td></tr></tbody></table><br><br>  <b>Key requirements: SSD: HDD ratio</b> <br><br>  Matching is the balance of performance, capacity and cost.  Adding SSD improves performance (most operations occur at the SSD level, increasing the number of columns in virtual disks, etc.), but significantly increases the cost and reduces the potential capacity (instead of a capacious disk, a small SSD is placed). <br><br>  Typical choices: SSD: HDD *: 1: 4 - 1: 6 <br><br>  <i>* By quantity, not capacity.</i> <br><br><img src="https://habrastorage.org/files/7d2/422/81e/7d242281e1564d4bb7a7414856b796bf.png"><br><br>  <b>Key Requirements: Number and Configuration of Disk Shelves (JBOD)</b> <br><br>  Disk shelves differ in many ways - the number of disks to be installed, the number of SAS ports, etc. <br><br>  Using multiple shelves allows you to consider their availability in fault tolerance schemes (using the enclosure awareness feature), but also increases the disk space required for Fast Rebuild. <br><br>  The configuration should be symmetrical in all shelves (meaning cable connection and location of disks). <br><br>  A typical choice: the number of shelves&gt; = 2, IO modules in the shelf - 2, a single model, the latest firmware versions and the symmetrical arrangement of the disks in all the shelves. <br><br><img src="https://habrastorage.org/files/f66/3fa/a3a/f663faa3ae1d4754854d7f676873a5e9.png"><br><br>  Usually, the number of disk shelves is selected from the total number of disks, taking into account the margin for expansion and fault tolerance, taking into account the shelves (using the enclosure awareness function) and / or adding SAS paths for throughput and fault tolerance. <br><br>  Payment: <br><br><img src="https://habrastorage.org/files/780/581/d8f/780581d8fb2a49ad9a18dd2099a7c3e0.png"><br><br>  Where: <br>  a) Amount of JBOD. <br>  b) Rounded up. <br>  c) The number of HDD. <br>  d) SSD count. <br>  e) Free drive slots. <br>  f) Maximum number of disks in JBOD. <br><br>  <b>Key requirements: SAS HBA and cables</b> <br><br>  The SAS cable topology must connect each storage server to the JBOD shelves using at least one SAS path (that is, one SAS port in the server falls on one SAS port in each JBOD). <br><br>  Depending on the number and type of disks in the JBOD shelves, the total performance can easily reach the limit of one 4x 6G SAS port (~ 2.2 GB / s). <br><br>  Recommended: <br><ul><li>  Number of SAS ports per server&gt; = 2. </li><li>  Number of SAS HBA per server&gt; = 1. </li><li>  Latest SAS HBA firmware versions. </li><li>  Multiple SAS paths to JBOD shelves. </li><li>  Windows MPIO settings: Round-Robin. </li></ul><br><br>  <b>Key requirements: storage server configuration</b> <br><br>  Here it is necessary to take into account such features as server performance, number in a cluster for fault tolerance and serviceability, load characteristics (total IOPS, throughput, etc.), use of unloading technologies (RDMA), number of SAS ports per JBOD and multipath requirements . <br><br>  2-4 servers are recommended;  2 x processor 6+ cores;  memory&gt; = 64 GB;  two local hard drives in the mirror;  two ports 1+ GbE for control and two ports 10+ GbE RDMA for data exchange;  BMC port is either dedicated or combined with 1GbE and supports IPMI 2.0 and / or SMASH;  SAS HBA from the previous paragraph. <br><br>  <b>Key requirements: number of disk pools</b> <br><br>  At this step, we take into account that pools are units for both management and fault tolerance.  A failed disk in the pool affects all virtual disks located on the pool, each disk in the pool contains metadata. <br><br>  Increase the number of pools: <br><ul><li>  Increases the reliability of the system, as the number of elements of fault tolerance increases. </li><li>  Increases the number of disks for backup space (i.e. extra penalty), since Fast Rebuild works at the pool level. </li><li>  Increases the complexity of system management. </li><li>  Reduces the number of columns in the Virtual Disk (Virtual Drive, VD), reducing performance, because the VD can not stretch across multiple pools. </li><li>  Reduces time to handle pool metadata, such as a virtual disk rebuild or pool control transfer in the event of a cluster failure (performance improvement). </li></ul><br><br>  Typical choice: <br><ul><li>  The number of pools from 1 to the number of disk shelves. </li><li>  Disks / Pool &lt;= 80 </li></ul><br><br>  <b>Key requirements: pool configuration</b> <br><br>  The pool contains default data for the corresponding VDs and several settings that affect the storage behavior: <br><br><table><tbody><tr><td>  Option <br></td><td>  Description <br></td></tr><tr><td>  RepairPolicy <br></td><td>  Sequential vs Parallel (respectively, lower load on the IO, but slowly, or high load on the IO, but quickly) <br></td></tr><tr><td>  RetireMissingPhysicalDisks <br></td><td>  With the Fast Rebuild option, the dropped out disks do not cause the pool to be restored if the Auto value is set (if the value is Always, the pool rebuilding is always started using the Spare disk, but not immediately, but 5 minutes after the first unsuccessful attempt to write to this disk). <br></td></tr><tr><td>  IsPowerProtected <br></td><td>  True means that all write operations are considered complete without confirmation from the disk.  A power outage can cause data corruption if there is no protection (a similar technology has appeared on hard drives). <br></td></tr></tbody></table><br><br>  Typical choice: <br><ul><li>  Hot Spares: No </li><li>  Fast Rebuild: Yes </li><li>  RepairPolicy: Parallel (default) </li><li>  RetireMissingPhysicalDisks: Auto (default, MS recommended) </li><li>  IsPowerProtected: False (default, but if enabled - performance increases significantly) </li></ul><br><br>  <b>Key requirements: number of virtual disks (VD)</b> <br><br>  Take into account the following features: <br><ul><li>  The ratio of SMB folders serving clients to the CSV layer and the corresponding VD;  should be 1: 1: 1. </li><li>  Each virtual disk with a tearing has a dedicated WBC cache;  increasing the number of VDs can improve performance for some tasks (other things being equal). </li><li>  Increasing the number of VD increases the complexity of management. </li><li>  Increasing the number of loaded VDs facilitates the distribution of the load of the failed node to other elements of the cluster. </li></ul><br><br><img src="https://habrastorage.org/files/e04/a84/ac3/e04a84ac31904033acdd4e570a342d87.png"><br><br>  A typical choice of VD numbers: 2-4 per storage server. <br><br>  <b>Key requirements: virtual disk configuration (VD)</b> <br><br>  Three types of array are available - Simply, Mirror and Parity, but only Mirror is recommended for virtualization tasks. <br><br>  3-way mirroring, compared to 2-way, doubles protection against disk failure at the cost of a slight decrease in performance (higher recording penalty), a decrease in available space and a corresponding increase in cost. <br><br><img src="https://habrastorage.org/files/d8c/b1f/533/d8cb1f533c164304a19b41b2079cd231.png"><br><br>  Comparison of types of mirroring: <br><table><tbody><tr><td>  Number of pools <br></td><td>  Mirror type <br></td><td>  Overhead <br></td><td>  Pool stability <br></td><td>  System stability <br></td></tr><tr><td rowspan="2">  one <br></td><td>  2-way <br></td><td>  50% <br></td><td>  1 disc <br></td><td>  1 disc <br></td></tr><tr><td>  3-way <br></td><td>  67% <br></td><td>  2 disks <br></td><td>  2 disks <br></td></tr><tr><td rowspan="2">  2 <br></td><td>  2-way <br></td><td>  50% <br></td><td>  1 disc <br></td><td>  2 disks <br></td></tr><tr><td>  3-way <br></td><td>  67% <br></td><td>  2 disks <br></td><td>  4 discs <br></td></tr><tr><td rowspan="2">  3 <br></td><td>  2-way <br></td><td>  50% <br></td><td>  1 disc <br></td><td>  3 disks <br></td></tr><tr><td>  3-way <br></td><td>  67% <br></td><td>  2 disks <br></td><td>  6 discs <br></td></tr><tr><td rowspan="2">  four <br></td><td>  2-way <br></td><td>  50% <br></td><td>  1 disc <br></td><td>  4 discs <br></td></tr><tr><td>  3-way <br></td><td>  67% <br></td><td>  2 disks <br></td><td>  8 discs <br></td></tr></tbody></table><br><br>  Microsoft for Cloud Platform System (CPS) recommends a 3-way mirror. <br><br>  Key requirements: number of columns <br><br>  Usually, an increase in the number of columns increases the performance of the VD, but delays may also increase (more columns - more disks that should confirm the operation).  The formula for calculating the maximum number of columns in a particular mirrored VD: <br><br><img src="https://habrastorage.org/files/98c/515/c12/98c515c1207840c7b59e211900cc7402.png"><br><br>  Where: <br>  a) Rounding down. <br>  b) The number of disks in a smaller level (usually the number of SSDs). <br>  c) Fault tolerance by disk.  For 2-way mirror it is 1 disk, for 3-way mirror it is 2 disks. <br>  d) The number of copies of the data.  For a 2-way mirror it is 2, for a 3-way mirror it is 3. <br><br>  If the maximum number of columns is selected and a disk failure has occurred, then the pool does not have the required number of disks to match the number of columns and, accordingly, fast rebuild will be unavailable. <br><br>  The usual choice is 4-6 (1 less than the calculated maximum for Fast Rebuild operation).  This feature is only available in PowerShell; when building through a graphical interface, the system will choose the maximum possible number of columns, up to 8. <br><br>  <b>Key Requirements: Virtual Disk Options</b> <br><br><table><tbody><tr><td width="200">  Virtual Disk option <br></td><td>  Considerations <br></td></tr><tr><td>  Interleave <br></td><td>  For random loads (virtualized, for example), the block size must be greater than or equal to the largest active request, since any query larger than this will be split into several operations, which will reduce performance. <br></td></tr><tr><td>  WBC cache size <br></td><td>  The default value is 1 GB, which is a reasonable balance between performance and fault tolerance for most tasks (increasing the cache size increases the transfer time in case of failures; when CSV volume is transferred, a reset and restore procedure is required, as well as problems due to denial of service) . <br></td></tr><tr><td>  IsEnclosureAware <br></td><td>  Improved protection against failures, if possible - it is recommended to use.  For activation, it is necessary to match the number of disk shelves to the array level (available only through PowerShell).  For a 3-way mirror you need 3 shelves, for dual parity 4, etc.  This feature allows you to experience a complete loss of the disk shelf. <br></td></tr></tbody></table><br><br>  Typical choice: <br><br>  Interleave: 256K (default) <br>  WBC Size: 1GB (default) <br>  IsEnclosureAware: use whenever possible. <br><br>  <b>Key requirements: virtual disk size</b> <br><br>  Obtaining the optimal VD size on the pool requires calculations for each storage level and summing up the optimal sizes of the VD levels.  It is also necessary to reserve space for Fast Rebuild and metadata, as well as for internal rounding during calculations (buried in the depths of the Storage Spaces stack, so we simply reserve). <br><br>  Formula: <br><br><img src="https://habrastorage.org/files/817/74a/e8d/81774ae8df70437ea20a67f5081e6163.png"><br><br>  Where: <br>  a) A conservative approach, leaves a few more unallocated space in the pool than is necessary for Fast Rebuild to work.  The value in GiB (the power of 2, GB is a derivative of a power of 10). <br>  b) Value in GiB. <br>  c) Backup Space for Storage Spaces metadata (all disks in the pool contain metadata from both pool and virtual disks). <br>  d) Backup space for Fast Rebuild:&gt; = size of one disk (+ 8GiB) for each level in the pool in the disk shelf. <br>  e) The size of the storage level and so rounded up into several ‚Äútiles‚Äù (Spaces splits each disk in a pool into pieces called ‚Äútiles‚Äù that are used to build an array), the tile size is equal to the size of the Storage Spaces unit (1GiB) multiplied by number of columns;  therefore, we round the size down to the nearest whole so as not to highlight the excess. <br>  f) Cache size per write, in GiB, for the desired level (1 for SSD level, 0 for HDD level). <br>  g) The number of disks in a particular pool level. <br><br>  <b>Spaces-Based SDS: Next Steps</b> <br><br><img src="https://habrastorage.org/files/0a0/4ca/b26/0a04cab267a94ec48cc53db0ad79e449.png"><br><br>  We decided on the initial estimates, move on.  Changes and improvements (and they will appear) in the results we will make on the basis of testing. <br><br>  <b>Example!</b> <br><br>  <b>What do you want to get?</b> <br><ul><li>  High level of fault tolerance. </li><li>  Target performance: 100K IOPS with SSD level, 10K IOPS with HDD level with random load in 64K blocks with 60/40 read record </li><li>  Capacity - 1000 virtual machines, 40GB each and 15% of the reserve. </li></ul><br><br>  Equipment: <br><br>  2/4/6 / 8TB drives <br>  IOPS (R / W): 140/130 R / W IOPS (declared specifications: 175 MB / s, 4.16ms) <br><br>  SSD with 200/400/800 / 1600GB capacity <br>  Iops <br>  Read: 7000 IOPS @ 460MB / s (stated: 120K) <br>  Write: 5500 IOPS @ 360MB / s (40K stated) <br><br>  SSDs in real-world tasks show significantly different figures from the declared ones :) <br><br>  Disk shelves - 60 disks, two SAS modules, 4 ports on each <a href="http://www.etegro.ru/configurator/storage/jbod/js300g3">ETegro Fastor JS300</a> . <br><br>  <b>Input data</b> <br><br>  Tiering is required because high performance is required. <br><br>  High reliability and not very big capacity is required, we use 3-way mirroring. <br><br>  Drive selection (based on performance and budget requirements): 4TB HDD and 800GB MLC SSD <br><br>  Calculations: <br><br>  <i>Spindles by capacity</i> : <br><br><img src="https://habrastorage.org/files/02b/c50/39c/02bc5039cec247e6a65a83c77b3f3aaa.png"><br><br>  <i>Performance spindles (we want to get 10K IOPS)</i> : <br><br><img src="https://habrastorage.org/files/afe/d73/8d0/afed738d0b5549f19748fd8d24ed81bf.png"><br><br>  The total capacity significantly exceeds the initial estimates, as it is necessary to meet the performance requirements. <br><br>  <i>SSD level:</i> <br><br><img src="https://habrastorage.org/files/1c2/e0b/d6a/1c2e0bd6a14446ad91b17933bdf99459.png"><br><br>  <i>The ratio of SSD: HDD:</i> <br><br><img src="https://habrastorage.org/files/954/af5/424/954af54246e0485f8e23914b37fb941c.png"><br><br>  <i>Number of disk shelves:</i> <br><br><img src="https://habrastorage.org/files/ef6/b15/7ad/ef6b157ad98c49ddbe66b277f1da3e55.png"><br><br>  <i>The location of the disks in the shelves:</i> <br><br>  Increase the number of disks to get a symmetrical distribution and an optimal SSD: HDD ratio.  For ease of expansion it is also recommended to fill the disk shelves completely. <br><br>  SSD: 32 -&gt; 36 <br>  HDD: 136 -&gt; 144 (SSD: HDD 1: 4) <br>  SSD / Enclosure: 12 <br>  HDD / Enclosure: 48 <br><br>  <i>SAS cables</i> <br><br>  For a fault-tolerant connection and maximizing bandwidth, you need to connect each disk shelf with two cables (two ways from the server to each shelf).  Total 6 SAS ports per server. <br><br>  <i>Number of servers</i> <br><br>  Based on the requirements for fault tolerance, IO, budget and the requirements of the multipath organization, we take 3 servers. <br><br>  <i>Number of pools</i> <br><br>  The number of disks in the pool must be equal to or less than 80; we take 3 pools (180/80 = 2.25). <br><br>  HDDs / Pool: 48 <br>  SSDs / Pool: 12 <br><br>  <i>Pool configuration</i> <br><br>  Hot Spares: No <br>  Fast Rebuild: Yes (reserve enough space) <br>  RepairPolicy: Parallel (default) <br>  RetireMissingPhysicalDisks: Always <br>  IsPowerProtected: False (default) <br><br>  <i>Number of virtual disks</i> <br><br>  Based on the requirements, we use 2 VD for each server, for a total of 6 equally distributed in pools (2 per pool). <br><br>  <i>Virtual Disk Configuration</i> <br><br>  Based on the requirements for resistance to data loss (for example, it is not possible to replace a failed disk within a few days) and load, we use the following settings: <br><br>  Resiliency: 3-way mirroring <br>  Interleave: 256K (default) <br>  WBC Size: 1GB (default) <br>  IsEnclosureAware: $ true <br><br>  <i>Number of columns</i> <br><br><img src="https://habrastorage.org/files/c10/e77/3de/c10e773de8394f1fbbfecea7756aba9a.png"><br><br>  <i>Virtual disk size and storage levels</i> <br><br><img src="https://habrastorage.org/files/4a7/531/d83/4a7531d8336646eda7277a2f0200d14f.png"><br><br>  <b>Total:</b> <br><br>  Storage Servers: 3 <br>  SAS ports / server: 6 <br>  SAS paths from the server to each shelf: 2 <br>  Disk shelves: 3 <br>  Number of pools: 3 <br>  Number of VD: 6 <br>  Virtual Disks / Pool: 2 <br>  HDD: 144 @ 4TB (~ 576TB of raw space), 48 / shelf, 48 / pool, 16 / shelf / pool <br>  SSD: 36 @ 800GB (~ 28TB of raw space), 12 / shelf, 12 / pool, 4 / shelf / pool <br>  Size of Virtual Disk: SSD Tier + HDD Tier = 1110GB + 27926GB = 28.4TB <br>  General useful capacity: (28.4) * 6 = 170TB <br>  Overhead: (1 - 170 / (576 + 28)) = 72% <br><br><img src="https://habrastorage.org/files/77a/9be/874/77a9be874afb4661820b2c1f75638a3b.png"></div><p>Source: <a href="https://habr.com/ru/post/257089/">https://habr.com/ru/post/257089/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../257073/index.html">Mini API on Lumen</a></li>
<li><a href="../257077/index.html">Contests HackQuest and Hash Runner: warm up the brains before PHDays</a></li>
<li><a href="../257079/index.html">Checking FreeCAD source code and its ‚Äúbad‚Äù dependencies</a></li>
<li><a href="../257083/index.html">BUILD 2015 news: Visual Studio Code, Visual Studio 2015 RC, Team Foundation Server 2015 RC, Visual Studio 2013 Update 5</a></li>
<li><a href="../257087/index.html">Search, find and do not blow off</a></li>
<li><a href="../257091/index.html">Store 300 million objects in the CLR process</a></li>
<li><a href="../257093/index.html">SourceTalk (source code discussion service): release</a></li>
<li><a href="../257095/index.html">Happy birthday google</a></li>
<li><a href="../257097/index.html">7 things that every designer should know about the design of accessible sites</a></li>
<li><a href="../257101/index.html">Cyclomatic complexity: CSS logic</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>