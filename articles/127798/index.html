<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MVC again</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello haboobschestvu 

 Once I came across an article with a habr link . After trying that system, I came to the conclusion that it had many flaws, an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MVC again</h1><div class="post__text post__text-html js-mediator-article">  Hello haboobschestvu <br><br>  Once I came across an article with a habr <a href="http://habrahabr.ru/blogs/php/31270/">link</a> .  After trying that system, I came to the conclusion that it had many flaws, and the translation of the original article was not fully present.  Yes, the article is old-fashioned, but at the same time I wanted to write my own small framework for creating simple and medium complexity sites.  So as to carry with you 2-3 megabytes of a serious framework for creating a business card site I consider blasphemy (though not always). <br><br>  In general, I decided to correct the glaring flaws and share the result with haberdalers. <br><a name="habracut"></a><br>  So what was refined? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      1. Got rid of using the Registry class.  Why do we need it if PHP5 has such wonderful methods as __set and __get? <br><br>  2. Instead of PDO, I wrote a class called by me as Active Records, which allows you to communicate with the database through a layer.  I will not give the source code, since the quality of the code is not so hot there and needs refactoring.  But if need be - add. <br><br>  3. The Template class was rewritten a bit, the ability to make nested templates was added.  Now it looks like this: <br><br><blockquote>  <font color="#000000">&lt;? php</font> <br><br>  <font color="#000000">class</font> Template <font color="#009900">{</font> <br><br>  <font color="#000000">private</font> <font color="#000088">$ vars</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br><br>  <font color="#000000">function</font> __set <font color="#009900">(</font> <font color="#000088">$ varname</font> <font color="#339933">,</font> <font color="#000088">$ value</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">vars</font> <font color="#009900">[</font> <font color="#000088">$ varname</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$ value</font> <font color="#339933">;</font> <br>  <font color="#b1b100">return</font> <font color="#009900">true</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#000000">function</font> show <font color="#009900">(</font> <font color="#000088">$ name</font> <font color="#339933">,</font> <font color="#000088">$ data</font> <font color="#339933">=</font> <font color="#009900">false</font> <font color="#339933">,</font> <font color="#000088">$ display</font> <font color="#339933">=</font> <font color="#009900">true</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#000088">$ path</font> <font color="#339933">=</font> site_path <font color="#339933">.</font>  <font color="#0000ff">'views'</font> <font color="#339933">.</font>  DIRSEP <font color="#339933">.</font>  <font color="#000088">$ name</font> <font color="#339933">.</font>  <font color="#0000ff">'.php'</font> <font color="#339933">;</font> <br><br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">file_exists</font> <font color="#009900">(</font> <font color="#000088">$ path</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#990000">trigger_error</font> <font color="#009900">(</font> <font color="#0000ff">'Template `'</font> <font color="#339933">.</font> <font color="#000088">$ name</font> <font color="#339933">.</font> <font color="#0000ff">'` does not exist.'</font> <font color="#339933">,</font> <font color="#009900">E_USER_NOTICE</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#b1b100">return</font> <font color="#009900">false</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$ data</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#666666">// fill with data</font> <br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#990000">is_array</font> <font color="#009900">(</font> <font color="#000088">$ data</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$ data</font> <font color="#b1b100">as</font> <font color="#000088">$ key</font> <font color="#339933">=&gt;</font> <font color="#000088">$ value</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> __set <font color="#009900">(</font> <font color="#000088">$ key</font> <font color="#339933">,</font> <font color="#000088">$ value</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#990000">extract</font> <font color="#009900">(</font> <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">vars</font> <font color="#009900">)</font> <font color="#339933">;</font> <br><br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$ display</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#b1b100">include</font> <font color="#009900">(</font> <font color="#000088">$ path</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#009900">{</font> <br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#990000">is_file</font> <font color="#009900">(</font> <font color="#000088">$ path</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#990000">ob_start</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#b1b100">include</font> <font color="#000088">$ path</font> <font color="#339933">;</font> <br>  <font color="#000088">$ contents</font> <font color="#339933">=</font> <font color="#990000">ob_get_contents</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#990000">ob_end_clean</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#b1b100">return</font> <font color="#000088">$ contents</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br>  <font color="#b1b100">return</font> <font color="#009900">false</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#000000">?&gt;</font> <br></blockquote><br><br>  4. The router was changed, support for several parameters in the URL appeared.  Although I suspect that the router is still with flaws, which I will eventually eliminate.  But while it works :) <br><br><blockquote>  <font color="#000000">&lt;? php</font> <br><br>  <font color="#000000">class</font> Router <font color="#009900">{</font> <br><br>  <font color="#000000">public</font> <font color="#000088">$ path</font> <font color="#339933">;</font> <br>  <font color="#000000">private</font> <font color="#000088">$ args</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br><br>  <font color="#000000">function</font> setPath <font color="#009900">(</font> <font color="#000088">$ path</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#000088">$ path</font> <font color="#339933">=</font> <font color="#990000">trim</font> <font color="#009900">(</font> <font color="#000088">$ path</font> <font color="#339933">,</font> <font color="#0000ff">'/ \\'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ path</font> <font color="#339933">. =</font> DIRSEP <font color="#339933">;</font> <br><br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">is_dir</font> <font color="#009900">(</font> <font color="#000088">$ path</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  throw <font color="#000000">new</font> Exception <font color="#009900">(</font> <font color="#0000ff">'Invalid controller path: `'</font> <font color="#339933">.</font> <font color="#000088">$ path</font> <font color="#339933">.</font> <font color="#0000ff">'`'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br>  <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">path</font> <font color="#339933">=</font> <font color="#000088">$ path</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#000000">function</font> delegate <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#666666">// analize path</font> <br>  <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">getController</font> <font color="#009900">(</font> <font color="#000088">$ file</font> <font color="#339933">,</font> <font color="#000088">$ controller</font> <font color="#339933">,</font> <font color="#000088">$ action</font> <font color="#339933">,</font> <font color="#000088">$ args</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#666666">// is file available?</font> <br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">is_readable</font> <font color="#009900">(</font> <font color="#000088">$ file</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#990000">trigger_error</font> <font color="#009900">(</font> <font color="#0000ff">'File `'</font> <font color="#339933">.</font> <font color="#000088">$ file</font> <font color="#339933">.</font> <font color="#0000ff">'` not found'</font> <font color="#339933">,</font> <font color="#009900">E_USER_ERROR</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br>  <font color="#b1b100">include</font> <font color="#009900">(</font> <font color="#000088">$ file</font> <font color="#009900">)</font> <font color="#339933">;</font> <br><br>  <font color="#666666">// create controller</font> <br>  <font color="#000088">$ class</font> <font color="#339933">=</font> <font color="#0000ff">'Controller_'</font> <font color="#339933">.</font>  <font color="#000088">$ controller</font> <font color="#339933">;</font> <br>  <font color="#000088">$ controller</font> <font color="#339933">=</font> <font color="#000000">new</font> <font color="#000088">$ class</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br><br>  <font color="#666666">// action is available in object?</font> <br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">is_callable</font> <font color="#009900">(</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#000088">$ controller</font> <font color="#339933">,</font> <font color="#000088">$ action</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#990000">trigger_error</font> <font color="#009900">(</font> <font color="#0000ff">'No method `'</font> <font color="#339933">.</font> <font color="#000088">$ action</font> <font color="#339933">.</font> <font color="#0000ff">'` was found in class'</font> <font color="#339933">,</font> <font color="#009900">E_USER_ERROR</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br>  <font color="#666666">// call action</font> <br>  <font color="#990000">call_user_func_array</font> <font color="#009900">(</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#000088">$ controller</font> <font color="#339933">,</font> <font color="#000088">$ action</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#000088">$ args</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#000000">private</font> <font color="#000000">function</font> getController <font color="#009900">(</font> <font color="#339933">&amp;</font> <font color="#000088">$ file</font> <font color="#339933">,</font> <font color="#339933">&amp;</font> <font color="#000088">$ controller</font> <font color="#339933">,</font> <font color="#339933">&amp;</font> <font color="#000088">$ action</font> <font color="#339933">,</font> <font color="#339933">&amp;</font> <font color="#000088">$ args</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#000088">$ route</font> <font color="#339933">=</font> <font color="#009900">(</font> <font color="#990000">empty</font> <font color="#009900">(</font> <font color="#000088">$ _GET</font> <font color="#009900">[</font> <font color="#0000ff">'route'</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#009900">)</font> ?  <font color="#0000ff">'index'</font> <font color="#339933">:</font> <font color="#000088">$ _GET</font> <font color="#009900">[</font> <font color="#0000ff">'route'</font> <font color="#009900">]</font> <font color="#339933">;</font> <br>  <font color="#666666">// split called url</font> <br>  <font color="#000088">$ route</font> <font color="#339933">=</font> <font color="#990000">trim</font> <font color="#009900">(</font> <font color="#000088">$ route</font> <font color="#339933">,</font> <font color="#0000ff">'/ \\'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ parts</font> <font color="#339933">=</font> <font color="#990000">explode</font> <font color="#009900">(</font> <font color="#0000ff">'/'</font> <font color="#339933">,</font> <font color="#000088">$ route</font> <font color="#009900">)</font> <font color="#339933">;</font> <br><br>  <font color="#666666">// find right controller</font> <br>  <font color="#000088">$ cmd_path</font> <font color="#339933">=</font> <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">path</font> <font color="#339933">;</font> <br><br>  <font color="#666666">// set default controller name (will be found if found another)</font> <br>  <font color="#000088">$ controller</font> <font color="#339933">=</font> <font color="#0000ff">'index'</font> <font color="#339933">;</font> <br><br>  <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$ parts</font> <font color="#b1b100">as</font> <font color="#000088">$ part</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#000088">$ fullpath</font> <font color="#339933">=</font> <font color="#000088">$ cmd_path</font> <font color="#339933">.</font>  <font color="#000088">$ part</font> <font color="#339933">;</font> <br>  <font color="#666666">// is dir?</font> <br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#990000">is_dir</font> <font color="#009900">(</font> <font color="#000088">$ fullpath</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#000088">$ cmd_path</font> <font color="#339933">. =</font> <font color="#000088">$ part</font> <font color="#339933">.</font>  DIRSEP <font color="#339933">;</font> <br>  <font color="#990000">array_shift</font> <font color="#009900">(</font> <font color="#000088">$ parts</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#b1b100">continue</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#666666">// is file?</font> <br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#990000">is_file</font> <font color="#009900">(</font> <font color="#000088">$ fullpath</font> <font color="#339933">.</font> <font color="#0000ff">'.php'</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#000088">$ controller</font> <font color="#339933">=</font> <font color="#000088">$ part</font> <font color="#339933">;</font> <br>  <font color="#990000">array_shift</font> <font color="#009900">(</font> <font color="#000088">$ parts</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#b1b100">break</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#666666">// get action method in controller</font> <br>  <font color="#000088">$ action</font> <font color="#339933">=</font> <font color="#009900">(</font> <font color="#990000">isset</font> <font color="#009900">(</font> <font color="#000088">$ parts</font> <font color="#009900">[</font> <font color="#cc66cc">0</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#339933">&amp;&amp;</font> <font color="#339933">!</font> <font color="#990000">is_numeric</font> <font color="#009900">(</font> <font color="#000088">$ parts</font> <font color="#009900">[</font> <font color="#cc66cc">0</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#009900">)</font> ?  <font color="#990000">array_shift</font> <font color="#009900">(</font> <font color="#000088">$ parts</font> <font color="#009900">)</font> <font color="#339933">:</font> <font color="#0000ff">'index'</font> <font color="#339933">;</font> <br>  <font color="#000088">$ file</font> <font color="#339933">=</font> <font color="#000088">$ cmd_path</font> <font color="#339933">.</font>  <font color="#000088">$ controller</font> <font color="#339933">.</font>  <font color="#0000ff">'.php'</font> <font color="#339933">;</font> <br>  <font color="#000088">$ args</font> <font color="#339933">=</font> <font color="#000088">$ parts</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br>  <font color="#000000">?&gt;</font> <br></blockquote><br><br>  5. Added the Loader class, in which the model will be loaded (implemented), libraries (implemented).  In the future, I think, to tie in there and the loading of helpers. <br><br><blockquote>  <font color="#000000">&lt;? php</font> <br><br>  <font color="#000000">class</font> loader <font color="#009900">{</font> <br><br>  <font color="#000000">public</font> <font color="#000088">$ instance</font> <font color="#339933">;</font> <br>  <font color="#000000">public</font> <font color="#000088">$ vars</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br><br>  <font color="#000000">function</font> __construct <font color="#009900">(</font> <font color="#000088">$ parent</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">instance</font> <font color="#339933">=</font> <font color="#000088">$ parent</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#000000">function</font> model <font color="#009900">(</font> <font color="#000088">$ model_name</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#000088">$ filename</font> <font color="#339933">=</font> <font color="#990000">strtolower</font> <font color="#009900">(</font> <font color="#000088">$ model_name</font> <font color="#009900">)</font> <font color="#339933">.</font>  <font color="#0000ff">'.php'</font> <font color="#339933">;</font> <br>  <font color="#000088">$ file</font> <font color="#339933">=</font> site_path <font color="#339933">.</font>  <font color="#0000ff">'models'</font> <font color="#339933">.</font>  DIRSEP <font color="#339933">.</font>  <font color="#000088">$ filename</font> <font color="#339933">;</font> <br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">file_exists</font> <font color="#009900">(</font> <font color="#000088">$ file</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#b1b100">return</font> <font color="#009900">false</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br>  <font color="#b1b100">include</font> <font color="#009900">(</font> <font color="#000088">$ file</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">instance</font> <font color="#339933">-&gt;</font> <font color="#000088">$ model_name</font> <font color="#339933">=</font> <font color="#000000">new</font> <font color="#000088">$ model_name</font> <font color="#009900">(</font> <font color="#000000">new</font> ActiveRecords <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#000000">function</font> library <font color="#009900">(</font> <font color="#000088">$ name</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#000088">$ filename</font> <font color="#339933">=</font> <font color="#990000">strtolower</font> <font color="#009900">(</font> <font color="#000088">$ name</font> <font color="#009900">)</font> <font color="#339933">.</font>  <font color="#0000ff">'.php'</font> <font color="#339933">;</font> <br>  <font color="#000088">$ file</font> <font color="#339933">=</font> site_path <font color="#339933">.</font>  <font color="#0000ff">'libraries'</font> <font color="#339933">.</font>  DIRSEP <font color="#339933">.</font>  <font color="#000088">$ filename</font> <font color="#339933">;</font> <br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">file_exists</font> <font color="#009900">(</font> <font color="#000088">$ file</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#b1b100">return</font> <font color="#009900">false</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br>  <font color="#b1b100">include</font> <font color="#009900">(</font> <font color="#000088">$ file</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">instance</font> <font color="#339933">-&gt;</font> <font color="#000088">$ name</font> <font color="#339933">=</font> <font color="#000000">new</font> <font color="#000088">$ name</font> <font color="#009900">(</font> <font color="#000000">new</font> ActiveRecords <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#000000">?&gt;</font> <br></blockquote><br><br>  Here, as we see, the aforementioned ActiveRecords class (which is currently singletone) is passed to any model or library.  Due to this, work with the database becomes available in models and libraries (which is to be expected from the MVC concept).  But there are restrictions on the names of models and libraries - it is impossible, for example, to use a model with the name load. <br><br>  The very same base class of the model, from which all the subsequent ones in the project are inherited, looks like this: <br><br><blockquote>  <font color="#000000">&lt;? php</font> <br><br>  <font color="#000000">class</font> Model <font color="#009900">{</font> <br><br>  <font color="#000000">var</font> <font color="#000088">$ db</font> <font color="#339933">;</font> <br><br>  <font color="#000000">function</font> __construct <font color="#009900">(</font> <font color="#000088">$ db</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">db</font> <font color="#339933">=</font> <font color="#000088">$ db</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#000000">?&gt;</font> <br></blockquote><br><br>  6. In view of the above changes, the base controller class, from which all subsequent controllers are inherited, now looks like this: <br><br><blockquote>  <font color="#000000">&lt;? php</font> <br><br>  <font color="#000000">class</font> Controller_Base <font color="#009900">{</font> <br><br>  <font color="#000000">public</font> <font color="#000088">$ template</font> <font color="#339933">;</font> <br>  <font color="#000000">public</font> <font color="#000088">$ load</font> <font color="#339933">;</font> <br><br>  <font color="#000000">function</font> __construct <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">template</font> <font color="#339933">=</font> <font color="#000000">new</font> Template <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">load</font> <font color="#339933">=</font> <font color="#000000">new</font> loader <font color="#009900">(</font> <font color="#000088">$ this</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#000000">function</font> __set <font color="#009900">(</font> <font color="#000088">$ varname</font> <font color="#339933">,</font> <font color="#000088">$ value</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#000088">$ varname</font> <font color="#339933">=</font> <font color="#000088">$ value</font> <font color="#339933">;</font> <br>  <font color="#b1b100">return</font> <font color="#009900">true</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#000000">?&gt;</font> <br></blockquote><br><br>  Thus, the Loader and Template classes are available in each controller.  And we can write similar things in code: <br><br><blockquote>  <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">load</font> <font color="#339933">-&gt;</font> <font color="#004000">model</font> <font color="#009900">(</font> 'links' <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">links</font> <font color="#339933">-&gt;</font> <font color="#004000">add</font> <font color="#009900">(</font> ' <font color="#000000">new</font> ' <font color="#009900">)</font> <font color="#339933">;</font> </blockquote><br><br>  Ie all the methods of the model become available in this type: <br><br><blockquote>  <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#009900">[</font> model name <font color="#009900">]</font> <font color="#339933">-&gt;</font> <font color="#009900">[</font> method name in model <font color="#009900">]</font> </blockquote><br><br>  7. Also, small changes were added to the startup script ‚Äî session initialization (later I plan to add sessions from the database), along with the __autoload function, the redirect function that is often used is added: <br><br><blockquote>  <font color="#000000">function</font> redirect <font color="#009900">(</font> <font color="#000088">$ url</font> <font color="#009900">)</font> <br>  <font color="#009900">{</font> <br>  <font color="#990000">Header</font> <font color="#009900">(</font> <font color="#0000ff">"Location:"</font> <font color="#339933">.</font> <font color="#000088">$ Url</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> </blockquote><br><br>  as well as a connection to the database (I'm not sure here, can it make sense to bring the connection to the database to the Active Records class?) <br><br>  8. And most importantly, our main index.php file, which handles all requests.  Now it looks like this: <br><br><blockquote>  <font color="#000000">&lt;? php</font> <br><br>  <font color="#b1b100">require</font> <font color="#0000ff">'includes / start.php'</font> <font color="#339933">;</font> <br>  <font color="#000088">$ router</font> <font color="#339933">=</font> <font color="#000000">new</font> Router <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ router</font> <font color="#339933">-&gt;</font> <font color="#004000">setPath</font> <font color="#009900">(</font> site_path <font color="#339933">.</font> <font color="#0000ff">'controllers'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ router</font> <font color="#339933">-&gt;</font> <font color="#004000">delegate</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br><br>  <font color="#000000">?&gt;</font> </blockquote><br><br>  The source code of the framework can be downloaded here: <a href="">link</a> .  I draw your attention to the fact that here the source code is not out of the box.  Only some code is given, except for the base kernel, which is required as an example of use. <br><br>  I will be glad to your comments, comments and instructions. <br><br>  PS And yes - the most important thing.  A working example of a small resource created using a resource is a <a href="http://coophome.org.ua/bookmarkstore/">link</a> .  The service allows you to store links by category online.  Written for themselves, as the existing repository for several reasons are not satisfied.  In addition, it was necessary to test the kernel on something. </div><p>Source: <a href="https://habr.com/ru/post/127798/">https://habr.com/ru/post/127798/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../127792/index.html">Upgrading Microsoft SQL Server Databases</a></li>
<li><a href="../127793/index.html">Easy linux management over twitter</a></li>
<li><a href="../127794/index.html">Automated backups for DB2 on * nix</a></li>
<li><a href="../127795/index.html">Convergence - Possible Replacement Certification Authority System</a></li>
<li><a href="../127796/index.html">Configure authorization using the key in mobile putty</a></li>
<li><a href="../127799/index.html">Bar coding: software implementation in C #</a></li>
<li><a href="../127802/index.html">We filter people or how to block one person on video</a></li>
<li><a href="../127804/index.html">Docblox - PHP 5.3+ Compatible Documentation System</a></li>
<li><a href="../127805/index.html">Why IT companies are crumbling</a></li>
<li><a href="../127806/index.html">Alert the emergence of a new topic on Habrahabr using Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>