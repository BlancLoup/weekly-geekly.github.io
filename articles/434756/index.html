<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The future of Kubernetes is behind virtual machines</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Fortune telling 

 In my work, Kubernetes has already played an important role, and in the future it will become even more important. But 2018 is comi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The future of Kubernetes is behind virtual machines</h1><div class="post__text post__text-html js-mediator-article">  <b>Fortune telling</b> <br><br>  In my work, Kubernetes has already played an important role, and in the future it will become even more important.  But 2018 is coming to an end, so let's forget about modesty and make a bold prediction: <br><blockquote>  <b>The future of Kubernetes is virtual machines, not containers</b> </blockquote>  According to the Chinese horoscope, 2018 was the year of the dog, but in technology it was the year of Kubernetes.  Many are just now learning about this revolutionary technology, and IT departments are everywhere trying to develop a ‚ÄúKubernetes strategy‚Äù [1].  Some organizations have already transferred large workloads to Kubernetes. <br><br>  <i>[1] If you are trying to develop a Kubernetes strategy, you have already failed, but this is a topic for another article.</i> <br><a name="habracut"></a><br>  In other words, at each stage of the ‚ÄúGartner hype cycle‚Äù for Kubernetes there are a lot of people.  Some were stuck in a hollow of frustration or drowned in a pit of despair. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/2d1/1c3/5cc/2d11c35cc85a9c572e535142bf018277.png"><br>  <i><font color="gray">Jeremykemp, <a href="">Wikipedia</a> .</font></i>  <i><font color="gray"><a href="">CC CC-SA 3.0</a></font></i> <br><br>  I am a big fan of containers and will not say that <a href="https://chrisshort.net/docker-inc-is-dead/">containers are dead</a> .  Docker in 2013 gave us a shell for Linux Containers: an amazing new way to create, package, share, and deploy applications.  He appeared at the right time, as we began to take seriously the continuous delivery.  Their model was ideal for the delivery chain and contributed to the emergence of the PaaS platform, and then CaaS. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/330/55a/94d/33055a94d32a0087206df9a0f9cc06f1.png"><br><br>  Engineers from Google saw that the IT community was finally ready for containers.  Google has been using containers for a long time and in a sense they can be considered inventors of containerization.  They began to develop Kubernetes.  As is now known, this is the free reincarnation of Google‚Äôs own Borg platform. <br><br>  Soon Kubernetes support was provided by all the big clouds (GKE, AKS, EKS).  On-premise services also quickly raised Kubernetes-based platforms (Pivotal Container Service, Openshift, etc.). <br><br><h1>  Soft multi-hindrance </h1><br>  It was necessary to solve one annoying problem, which can be considered a lack of containers ... this is multi-tenancy. <br><br>  Linux containers were not created as secure isolated environments (like Solaris Zones or FreeBSD Jails).  Instead, they were built on a common kernel model, which uses kernel functions to provide basic process isolation.  As <a href="https://blog.jessfraz.com/post/containers-zones-jails-vms/">Jesse Frazel</a> would <a href="https://blog.jessfraz.com/post/containers-zones-jails-vms/">say</a> , ‚Äúcontainers are not the real thing.‚Äù <br><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: static; visibility: visible; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="1015407561187655680"></twitter-widget><blockquote class="twitter-tweet" data-lang="en_US" data-twitter-extracted-i1550739552573922586="true"><p lang="en" dir="ltr">  containers are not things </p>  - jessie frazelle ‚Äç (@jessfraz) <a href="https://twitter.com/jessfraz/status/1015407561187655680%3Fref_src%3Dtwsrc%255Etfw">July 7, 2018</a> </blockquote><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>  This is exacerbated by the fact that most Kubernetes components are not aware of tenants.  Of course, you have <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/">the namespace</a> and <a href="https://kubernetes.io/docs/concepts/policy/pod-security-policy/">security policy Pod</a> , but in the API there is no such thing.  Also as in internal components, such as <code>kubelet</code> or <code>kube-proxy</code> .  This leads to the fact that in Kubernetes the soft tenancy model is implemented. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eef/e54/556/eefe545564f03e8b6813e8bc83ed0188.png"><br>  <i><font color="gray">Kubernetes architecture</font></i> <br><br>  Abstractions seep further.  Platform on top of containers inherits many aspects of soft leases.  Platforms on top of multi-tenant virtual machines inherit this hard lease (VMware, Amazon Web Services, OpenStack, etc.). <br><br>  The Kubernetes soft rental model puts service providers and distributions in a strange position.  The Kubernetes cluster itself becomes the ‚Äúhard lease‚Äù line.  Even within an organization, there are many reasons for requiring a rigid lease between users (or applications).  Since public clouds provide fully managed Kubernetes as a service, it is fairly easy for customers to take their own cluster and use the cluster boundary as an isolation point. <br><br>  Some Kubernetes distributions, such as <a href="https://pivotal.io/platform/pivotal-container-service">Pivotal Container Service (PKS)</a> , are well aware of this <a href="https://content.pivotal.io/youtube-uberflip/kubernetes-one-cluster-or-many-3">rental problem</a> and use a similar model, providing the same Kubernetes as a service that can be obtained from a public cloud, but in its own data center. <br><br>  This led to the emergence of the ‚Äúmany clusters‚Äù model, instead of ‚Äúone large common cluster‚Äù.  Often, GKE customers from Google have dozens of Kubernetes clusters deployed for several teams.  Often, each developer gets his cluster.  This behavior generates a shocking number of instances (Kubesprawl). <br><br>  As an option, operators raise their own Kubernetes clusters in their own data centers to take on additional work to manage multiple clusters, or agree to softly rent one or two large clusters. <br><br>  Usually the smallest cluster is four machines (or virtual machines).  One (or three for HA) for Kubernetes Master, three for Kubernetes Workers.  A lot of money is spent on systems that are mostly idle. <br><br>  Therefore, you need to somehow move Kubernetes in the direction of a rigid multi-rent.  The Kubernetes community is well aware of this need.  A <a href="https://groups.google.com/forum/">multi-rental working group has</a> already been established.  She is working hard on this problem, and they have several models and suggestions on how to work with each model. <br><br>  Jesse Frasel wrote a <a href="https://blog.jessfraz.com/post/hard-multi-tenancy-in-kubernetes/">blog post</a> on this topic, which is great because she is much smarter than me, so I can refer to her and save myself from ten years of hard work trying to reach her level.  If you have not read that post, read right now. <br><br><h1>  Just very small VMs optimized for speed ... </h1><br><blockquote>  Kata Containers is an open source project and community working to create a standard implementation of lightweight virtual machines that look and work like containers, but provide workload isolation and VM security benefits. </blockquote>  Jesse suggests using VM container technology, such as <a href="https://katacontainers.io/">Kata containers</a> .  They offer VM level isolation, but work like containers.  This allows Kubernetes to give each ‚Äútenant‚Äù (we assume a tenant in the namespace) with its own set of Kubernetes system services running in nested VM containers (VM container inside a virtual machine provided by the IaaS infrastructure). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/157/3ce/1b6/1573ce1b64d7607f5cb9ca0d09caef6e.png"><br>  <i><font color="gray">Image of Jesse Frazel: Hard Multi-Trend in Kubernetes</font></i> <br><br>  This is an elegant Kubernetes multi-rent solution.  Her proposal goes even further, so that Kubernetes uses VM sub-containers for workloads (Pods) running on Kubernetes, which provides a significant increase in resource utilization. <br><br>  We still have at least one optimization.  Create a suitable hypervisor for the underlying infrastructure provider or cloud provider.  If the VM container is a first-level abstraction provided by IaaS, then we will further increase resource utilization.  The minimum number of VMs to start the Kubernetes cluster is reduced to one machine (or three for HA) to accommodate the Kubernetes management system available to the ‚Äúsuperuser‚Äù. <br><br><h1>  Resource-optimized multi-rent (cost) </h1><br>  Deploying Kubernetes with two namespaces and several running applications will look something like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ffc/4e2/d7f/ffc4e2d7ffb239fa1e0822e3d20afcd2.png"><br><blockquote>  Note: There are other loads on the same IaaS infrastructure.  Since these are VM containers, they have the same isolation level as normal cloud VMs.  Therefore, they can run on a single hypervisor with minimal risk. </blockquote>  Initially, no infrastructure is deployed in the cloud, so for the superuser the costs are zero. <br><br>  The superuser requests the Kubernetes cluster from the cloud.  The cloud service provider creates a virtual container with one container (or three for HA), on which the main API and system services of Kubernetes work.  The superuser can deploy modules in the system namespace or create new spaces to delegate access to other users. <br><br>  The superuser creates two namespaces <code>foo</code> and <code>bar</code> .  Kubernetes requests from the cloud two VM containers for each level of name space management (Kubernetes API and System Services).  The superuser delegates access to these namespaces to some users, each of them starts up some workloads (modules), and the appropriate management levels request VM containers for these workloads. <br><br>  At all stages, the superuser pays only for the resources actually consumed.  The cloud service provider controls these resources and they are available to any cloud user. <br><br><h1>  I don't really say anything new ... </h1><br>  Cloud service providers are already working in this direction.  You can see this by watching the events in the communities (perhaps Amazon has quietly done it with Fargate). <br><br>  The first tip is <a href="https://github.com/virtual-kubelet/virtual-kubelet">Virtual Kubelet</a> , an open source tool for disguising as a kubelet.  It connects Kubernetes with other APIs, which allows Kubernetes to request VM containers from a standard scheduler in the cloud. <br><br>  Other leads are a large number of new technologies for VM containerization, like the already mentioned Kata containers, as well as <a href="https://aws.amazon.com/blogs/opensource/firecracker-open-source-secure-fast-microvm-serverless/">Firecracker</a> from Amazon and <a href="https://github.com/google/gvisor">gvisor</a> from Google. <br><br><h1>  Conclusion </h1><br>  If you correctly implement the improvements in the model of a hard lease, then you will find the Holy Grail of the Kubernetes virtualization.  Complete isolation of workloads and no extra costs. <br><br>  If you do not use the public cloud, you still get the benefits of higher resource utilization, which pays off with lower hardware requirements. <br><br>  Hopefully, VMware and OpenStack will pay attention and release hypervisors based on lightweight VM containers and the corresponding Virtual Kubelet implementations. </div><p>Source: <a href="https://habr.com/ru/post/434756/">https://habr.com/ru/post/434756/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../434744/index.html">Samsung SSD 860 QVO 1 TB and 4 TB: the first consumer SATA QLC (part 2)</a></li>
<li><a href="../434746/index.html">BLE under the microscope 4</a></li>
<li><a href="../434748/index.html">Mail.ru plans to buy music licensing partner for $ 100 million</a></li>
<li><a href="../434750/index.html">How to take control of network infrastructure. Part two. Cleaning and documentation</a></li>
<li><a href="../434752/index.html">Robomoroz: the future of the main character of the New Year</a></li>
<li><a href="../434758/index.html">Facebook Moderator's Guide: Over 1,400 pages of controversial slides</a></li>
<li><a href="../434760/index.html">Digest news from the world of PostgreSQL. New Year's Eve (shortened) issue ‚Ññ13</a></li>
<li><a href="../434762/index.html">Notes phytochemist. Green Banana, or Do not forget to feed the microbiota</a></li>
<li><a href="../434770/index.html">Renewable energy: words and their meaning</a></li>
<li><a href="../434774/index.html">5 lessons that we learned by writing over 300,000 lines of infrastructure code</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>