<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ionic Framework - working with the camera</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="According to the survey results from the first topic, I continue a series of articles on the Ionic Framework (hereinafter referred to as IF). Today we...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ionic Framework - working with the camera</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/16c/14e/530/16c14e530af9913b0feb642fe8698b70.png" alt="image"><br><br>  According to the survey results from the <a href="http://habrahabr.ru/post/255653/">first topic, I</a> continue a series of articles on the <i>Ionic Framework</i> (hereinafter referred to as IF).  Today we will talk about working with the camera device and in addition consider the work with localStorage.  As a basis, we take the application from the previous topic and add the necessary functionality. <br><br><ul><li>  <a href="https://habr.com/ru/post/256387/">Adding ngCordova</a> </li><li>  <a href="https://habr.com/ru/post/256387/">Connecting the plug-in to work with the camera</a> </li><li>  <a href="https://habr.com/ru/post/256387/">Creating a service for working with the camera</a> </li><li>  <a href="https://habr.com/ru/post/256387/">Editing templates</a> </li><li>  <a href="https://habr.com/ru/post/256387/">Adding routes, controllers and factories</a> </li><li>  <a href="https://habr.com/ru/post/256387/">Conclusion</a> </li></ul><br><a name="habracut"></a><br><h3><a name="ngcordova"></a>  Adding ngCordova </h3><br>  For the installed plugins to work, you must add the ngCordova module.  It is put simply (for a start we will update our tools, a lot of time has passed since the publication of the first article ...): 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="bash hljs">sudo npm i -g cordova ionic bower bower install ngCordova</code> </pre> <br>  Next, ngCordova connects to <i>index.html</i> : <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"lib/ngCordova/dist/ng-cordova.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  and depending on the application (app.js): <br><br><pre> <code class="javascript hljs">angular.module(<span class="hljs-string"><span class="hljs-string">'starter'</span></span>, [<span class="hljs-string"><span class="hljs-string">'ionic'</span></span>, <span class="hljs-string"><span class="hljs-string">'ngCordova'</span></span>, <span class="hljs-string"><span class="hljs-string">'starter.controllers'</span></span>, <span class="hljs-string"><span class="hljs-string">'starter.services'</span></span>])</code> </pre><br>  otherwise the train will not be able ... It is also advisable to connect a couple more plug-ins to work with the FS device: <br><br><pre> <code class="bash hljs">ionic plugin add cordova-plugin-file ionic plugin add cordova-plugin-file-transfer</code> </pre><br>  In theory, it would be possible to connect only file-transfer, since  along with him he also pulls the file, but sometimes this method is fraught with the appearance of incomprehensible bugs ... <br><br><h3><a name="pluginadd"></a>  Connecting the plug-in to work with the camera </h3><br>  In order for IF to be able to access the device's camera, you need to add a <a href="https://www.npmjs.com/package/cordova-plugin-camera">plug-</a> in to the <i>Cordova</i> project <a href="https://www.npmjs.com/package/cordova-plugin-camera">that implements this functionality</a> : <br><br><pre> <code class="bash hljs">ionic plugin add cordova-plugin-camera</code> </pre><br>  The plugin provides the only method: <br><br><pre> <code class="javascript hljs">navigator.camera.getPicture(SuccessCallback, ErrorCallback, Options);</code> </pre><br>  Where SuccessCallback and ErrorCallback are our handler functions in which we are free to write whatever we want, but the Options object is much more interesting to consider: <br><br><div class="spoiler">  <b class="spoiler_title">Camera Settings</b> <div class="spoiler_text"><ul><li>  quality (Number): The quality of the saved image, in the range from 0 to 100, where 100 is uncompressed mode.  The default value is 50. </li><li>  destinationType (Number): The format of the return value.  The default is FILEURI.  The setting is determined by the navigator.camera.DestinationType types: <br><pre> <code class="javascript hljs">Camera.DestinationType = { <span class="hljs-attr"><span class="hljs-attr">DATA_URL</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-comment"><span class="hljs-comment">//    base64 FILE_URI : 1, // URI  NATIVE_URI : 2 // URI     (assets-library://  iOS  content://  Android) };</span></span></code> </pre></li><li>  sourceType (Number): The source of the image.  Default is CAMERA.  The setting is determined by the navigator.camera.PictureSourceType types: <br><pre> <code class="javascript hljs">Camera.PictureSourceType = { <span class="hljs-attr"><span class="hljs-attr">PHOTOLIBRARY</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">CAMERA</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">SAVEDPHOTOALBUM</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span> };</code> </pre></li><li>  allowEdit (Boolean): Enables simple edit mode before passing to a function. </li><li>  encodingType (Number): File format.  By default, "you have a JPEG."  The configuration is determined by the navigator.camera.EncodingType types: <br><pre> <code class="javascript hljs">Camera.EncodingType = { <span class="hljs-attr"><span class="hljs-attr">JPEG</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-comment"><span class="hljs-comment">// JPEG PNG : 1 // PNG };</span></span></code> </pre></li><li>  targetWidth (Number): Width.  No comments.  To scale.  It is better to use in conjunction with the coefficient with targetHeight. </li><li>  targetHeight (Number): Height. </li><li>  mediaType (Number): The type of multimedia content.  The default is PICTURE.  Works with PictureSourceType PHOTOLIBRARY or SAVEDPHOTOALBUM.  The setting is determined by the types nagivator.camera.MediaType: <br><pre> <code class="javascript hljs">Camera.MediaType = { <span class="hljs-attr"><span class="hljs-attr">PICTURE</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-comment"><span class="hljs-comment">//  . VIDEO: 1, //   (  FILE_URI) ALLMEDIA : 2 //   };</span></span></code> </pre></li><li>  correctOrientation (Boolean): Rotate the image to compensate for the orientation of the device during shooting. </li><li>  saveToPhotoAlbum (Boolean): Save to album after shooting. </li><li>  popoverOptions: iOS-only parameter specifying the location of the popover on the iPad.  The setting is determined in CameraPopoverOptions. </li><li>  cameraDirection (Number): Camera to use (front or rear).  The default is BACK.  The setting is determined by the navigator.camera.Direction types: <br><pre> <code class="javascript hljs">Camera.Direction = { <span class="hljs-attr"><span class="hljs-attr">BACK</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-comment"><span class="hljs-comment">// Use the back-facing camera FRONT : 1 // Use the front-facing camera };</span></span></code> </pre></li></ul><br><br>  That's basically all you can tell ... <br></div></div><br><br><h3><a name="service"></a>  Creating a service for working with the camera </h3><br>  Let's make service for our convenience so that work with the camera is comfortable.  To do this, I propose to implement a factory with a <i>promise</i> object that will handle camera events using our callbacks.  Open the <i>services.js</i> file (in the last topic, we have already made a factory of cities there) and bring it to this form: <br><br><div class="spoiler">  <b class="spoiler_title">services.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs">angular.module(<span class="hljs-string"><span class="hljs-string">'starter.services'</span></span>, []) .factory(<span class="hljs-string"><span class="hljs-string">'Cities'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... }).factory('Cam', function($q) { return { getPic: function(opt) { var q = $q.defer(); navigator.camera.getPicture(function(res) { q.resolve(res); }, function(err) { q.reject(err); }, opt); return q.promise; } }; });</span></span></code> </pre><br></div></div><br>  So, in this setting, using Angular <i><a href="https://docs.angularjs.org/api/ng/service/%24q">$ q.defer</a> ()</i> , we return the <i>promise</i> , which we later pass to the event handlers from the camera (SuccessCallback, ErrorCallback) and the settings object (Options).  Do not close the file, we will return to it! <br><br><h3><a name="templates"></a>  Editing templates </h3><br>  Open the file <i>tabs.html</i> and add another <i>tab</i> .  I got this: <br><br><pre> <code class="html hljs xml"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ion-tab</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Options"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">icon-off</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ion-gear-a"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">icon-on</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ion-gear-a"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#/tab/opt"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ion-nav-view</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tab-opt"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ion-nav-view</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ion-tab</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Now in the folder with templates we will create another template (for example, <i>tab-opt.html</i> ) and make a small form of application user settings, for example: <br><br><div class="spoiler">  <b class="spoiler_title">tab-opt.html</b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ion-view</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">view-title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ion-content</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"padding"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"list-item"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"full-image"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{user.ava || './img/ionic.png'}}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"item item-input"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">i</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"icon ion-person placeholder-icon"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">i</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-model</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"user.name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-keyup</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"setUser();"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"item item-input item-select"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"input-label"</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">select</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-model</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"user.city"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-change</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"setUser();"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-repeat</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"city in cities"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"city.id"</span></span></span><span class="hljs-tag">&gt;</span></span>{{city.name}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">select</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button button-full button-positive"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"getPic(1);"</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button button-full button-calm"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"getPic(0);"</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ion-content</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ion-view</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  As you can see, we tied the user model to the fields and when the html field value changes, the corresponding object field will change in the model.  Also for events when the key is released (by the way, you can use debounce here) and for changing the choice of the city, the setUser handler was attached, this will be described in the next step.  Can't wait to run and see?  But we have not yet configured routing, controllers, and working with localStorage, so we'll have to wait a bit more ... <br><br><h3><a name="totaladding"></a>  Adding routes, controllers and factories </h3><br>  Let's take the start routes.  Open <i>app.js</i> and add routing for our new tab: <br><br><div class="spoiler">  <b class="spoiler_title">hint</b> <div class="spoiler_text"><pre> <code class="javascript hljs">.state(<span class="hljs-string"><span class="hljs-string">'tab.opt'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/opt'</span></span>, <span class="hljs-attr"><span class="hljs-attr">views</span></span>: { <span class="hljs-string"><span class="hljs-string">'tab-opt'</span></span>: { <span class="hljs-attr"><span class="hljs-attr">templateUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'templates/tab-opt.html'</span></span>, <span class="hljs-attr"><span class="hljs-attr">controller</span></span>: <span class="hljs-string"><span class="hljs-string">'OptCtrl'</span></span> } } })</code> </pre><br></div></div><br>  Ok, now let's go to <i>controllers.js</i> and add the necessary controller: <br><br><div class="spoiler">  <b class="spoiler_title">OptCtrl</b> <div class="spoiler_text"><pre> <code class="javascript hljs">.controller(<span class="hljs-string"><span class="hljs-string">'OptCtrl'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$scope, $ionicPopup, Cities, Cam, LS</span></span></span><span class="hljs-function">) </span></span>{ $scope.cities = Cities.all(); $scope.user = LS.getIt(<span class="hljs-string"><span class="hljs-string">'user'</span></span>) || {}; $scope.showAlert = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">title, text</span></span></span><span class="hljs-function">) </span></span>{ $ionicPopup.alert({ <span class="hljs-attr"><span class="hljs-attr">title</span></span>: title, <span class="hljs-attr"><span class="hljs-attr">template</span></span>: text }); }; $scope.setUser = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ LS.setIt(<span class="hljs-string"><span class="hljs-string">'user'</span></span>, $scope.user); }; $scope.getPic = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> opt = { <span class="hljs-attr"><span class="hljs-attr">sourceType</span></span>: source }; Cam.getPic(opt).then(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function">) </span></span>{ $scope.user.ava = res; $scope.setUser(); }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function">) </span></span>{ $scope.showAlert(<span class="hljs-string"><span class="hljs-string">""</span></span>, err); }); } })</code> </pre><br></div></div><br>  Oops, what kind of LS in controller dependencies !?  Do not be afraid of anything, this is just a method for working with <i>localStorage</i> , and it is time to implement it ( <i>services.js</i> ): <br><br><div class="spoiler">  <b class="spoiler_title">LS</b> <div class="spoiler_text"><pre> <code class="javascript hljs">.factory(<span class="hljs-string"><span class="hljs-string">'LS'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">getIt</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> it = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { it = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(localStorage.getItem(item)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> it; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(e) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.err(e); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> it; } }, <span class="hljs-attr"><span class="hljs-attr">setIt</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item, obj</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { localStorage.setItem(item, <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(obj)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(e) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.err(e); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } }; })</code> </pre><br></div></div><br>  And we should add more cities, add your own: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">555312</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">desc</span></span>: <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-attr"><span class="hljs-attr">emblem</span></span>: <span class="hljs-string"><span class="hljs-string">'https://upload.wikimedia.org/wikipedia/commons/8/8f/Coat_of_Arms_of_Ivanovo_oblast.png'</span></span> }</code> </pre><br>  You are now probably thinking "why so many gestures?".  And imagine that a user set up a city (automatically saved in localStorage) and when you restart the application, it will immediately be thrown over to the weather in your hometown, cool!  The final touch, change two of our controller, written in the last article: <br><br><div class="spoiler">  <b class="spoiler_title">CityCtrl, CityDetailCtrl</b> <div class="spoiler_text"><pre> <code class="javascript hljs">.controller(<span class="hljs-string"><span class="hljs-string">'CityCtrl'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$scope, Cities, LS</span></span></span><span class="hljs-function">) </span></span>{ $scope.cities = Cities.all(); $scope.user = LS.getIt(<span class="hljs-string"><span class="hljs-string">'user'</span></span>) || {}; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($scope.user.city) { <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location.href = <span class="hljs-string"><span class="hljs-string">'#/tab/city/'</span></span>+$scope.user.city; } }) .controller(<span class="hljs-string"><span class="hljs-string">'CityDetailCtrl'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$scope, $http, $stateParams, $ionicPopup, $ionicLoading</span></span></span><span class="hljs-function">) </span></span>{ $scope.data = {}; $scope.id = $stateParams.id; $scope.showAlert = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">title, text</span></span></span><span class="hljs-function">) </span></span>{ $ionicPopup.alert({ <span class="hljs-attr"><span class="hljs-attr">title</span></span>: title, <span class="hljs-attr"><span class="hljs-attr">template</span></span>: text }); }; $scope.refresh = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $ionicLoading.show(); $http.get(<span class="hljs-string"><span class="hljs-string">'http://api.openweathermap.org/data/2.5/forecast/daily?id='</span></span>+$scope.id+<span class="hljs-string"><span class="hljs-string">'&amp;appid=2de143494c0b295cca9337e1e96b00e0'</span></span>) .success(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data, status, headers, config</span></span></span><span class="hljs-function">) </span></span>{ $scope.data = data; $ionicLoading.hide(); $scope.$broadcast(<span class="hljs-string"><span class="hljs-string">'scroll.refreshComplete'</span></span>); }) .error(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data, status, headers, config</span></span></span><span class="hljs-function">) </span></span>{ $ionicLoading.hide(); $scope.showAlert(status, data); $scope.$broadcast(<span class="hljs-string"><span class="hljs-string">'scroll.refreshComplete'</span></span>); }); }; $scope.refresh(); })</code> </pre><br></div></div><br>  We added a condition for the user to be thrown onto a customized city, and also <i><a href="http://ionicframework.com/docs/api/service/%24ionicLoading/">implicitly</a></i> indicated in the dependencies the <i><a href="http://ionicframework.com/docs/api/service/%24ionicLoading/">$ ionicLoading</a></i> components to show the waiting window during the request.  I hope I did not miss anything, everything is ready, you know what to do (ionic serve --lab, if you forgot): <br><br><div class="spoiler">  <b class="spoiler_title">It works!</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/ed6/7ca/604/ed67ca6049ce4b5b9eead72b82ec9fd4.png"><br></div></div><br><br><h3><a name="summary"></a>  Conclusion </h3><br>  In principle, at the moment, it is becoming more and more convenient to work with IF, so I can safely say that this is one of the best frameworks for prototyping, and even for production applications.  Dare!  In the next article I want to describe creating a chat using socket.io and working with something else interesting.  If you have any difficulties, questions or suggestions for the following articles - you are welcome to BOS! </div><p>Source: <a href="https://habr.com/ru/post/256387/">https://habr.com/ru/post/256387/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../256377/index.html">Hacken und minen</a></li>
<li><a href="../256379/index.html">First sales experience at Unity Asset Store</a></li>
<li><a href="../256381/index.html">RS analysis (analysis of the fractal structure of time series)</a></li>
<li><a href="../256383/index.html">Get a grant for network security training in the Netherlands</a></li>
<li><a href="../256385/index.html">How we taught iPhone football clubs to recognize</a></li>
<li><a href="../256389/index.html">Scrum sprint simulation. We solve problems of interaction with the client and within the team.</a></li>
<li><a href="../256393/index.html">How to make Xamarin Studio a little better?</a></li>
<li><a href="../256397/index.html">Transferring a project from iOS designers to developers</a></li>
<li><a href="../256401/index.html">Compare Visual Studio Community 2013 with Visual Studio 2013 Express. Features of the license agreement</a></li>
<li><a href="../256403/index.html">We unify the behavior of LINQ to IEnumerable and LINQ to IQueriable in terms of working with null values. Part two. Its implementation of IQueryProvider</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>