<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How dangerous is DRM-protection, or Video-virus part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recollections  After I read the post about how TipTop could not watch a movie , I immediately remembered a similar incident. Once I opened a regular m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How dangerous is DRM-protection, or Video-virus part 2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/2e3/faf/18b/2e3faf18be5c9594ae6cd172dfec4b08.png" alt="image" align="right"><h3>  Recollections </h3>  After I read the post about how <a href="http://habrahabr.ru/blogs/infosecurity/86221/">TipTop could not watch a movie</a> , I immediately remembered a similar incident.  Once I opened a regular mp3 file, instead of starting to play, to my surprise, an unknown web page opened.  The most interesting thing is that the page was opened in Internet Explorer (despite the fact that another browser was installed by default), and yet on that page, the author of the file could add some special exploit for IE. <br><br>  At that moment I did not think about the page with the exploit and instead of carefully analyzing the file and understanding what the problem was, I just deleted it.  The only thing I thought about when I saw the unusual behavior of the system is that someone rather original spins up his site.  Several years have passed, but since then I have not seen such cases.  After reading the article about the video virus, I decided that at least this time not to miss the opportunity to find out how safe are some of the most innocent and common files in the world. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Video File </h3>  And since dear <a href="http://habrahabr.ru/blogs/infosecurity/86221/">TipTop, I left a comment</a> indicating the link to the file, I did not waste time and quickly downloaded the torrent file.  But I was not alone - at the same time with me the same video file was downloaded by about 15 more people who, I thought, also want to analyze it.  But now I realized that most likely most of them had other intentions and did not know that today there will be no kin ¬©. <br><br>  After the download was completed, knowing that other players cannot play this file, I immediately opened it in Windows Media Player, and the first thing I saw was the message: ‚ÄúDownload media usage rights‚Äù: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/336/5bd/204/3365bd20487150dc6f036e9feb9e2a29.png" alt="image"></div><br><br>  After that, a more convincing message appeared offering to download the License-Installer file, which, by the way, was already checked by the antivirus and turned out to be 100% clean: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/244/846/1bf/2448461bfacaa8bed9bb126956d17ba9.png" alt="image"></div><br><br>  After carefully reviewing the message, I clicked on the 'Download Now' button and, in anticipation of any reaction from the antivirus, I saw a familiar window offering to download the file from <u>license.compress.to</u> server: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f72/da6/58a/f72da658ac8b2c9ab3ab31c4a24d2e06.png"></div><br><br>  And then the first question arose, if the first window shows the server <u>free-license.imgpop.com</u> , then why this wonderful file offers to download the license from the <u>license.compress.to</u> server?  To find out what the problem is, I visited both sites, hoping to find something tasty there, but, as was to be expected, I did not find anything there. <br><br><br><h3>  DRM protection </h3>  After that, the first thing that came to mind was to ‚Äúlaunch a sniffer‚Äù, but abstained (and did it right) - having decided to open the file in the Hex editor.  I opened a file in the Hex-editor that weighed 150 MB and, to my luck, everything was very simple, because already on the 20th line I found this piece of text: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee7/23e/9bb/ee723e9bb7fa0ce9deec3d3cac21e00b.png" alt="image"></div><br><br>  It has become much more interesting.  Opened the page <u>https: //free-license.imgpop.com/venuf.php? Id = Movie_0001.wmv</u> , which redirected (HTTP / 1.1 302) to the page: <u>https: //free-license.imgpop.com/venuf/index .htm</u> , and there I saw a familiar picture, just a little bigger, and even in the browser: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ae1/d78/7ab/ae1d787ab558ef256e965a172b1c1135.png" alt="image"></div><br><br>  So far everything was going well and wanting to experiment a bit, I decided to change the link from the video file to my own.  But, after seeing that after changing the line, even WMP cannot open the file and not knowing what to do, asked Google if it could tell what the line was, <i>WRMHEADER version = '2.0.0.0'</i> , which (among many others) found using a hex editor? <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5f2/fae/27c/5f2fae27c3c861f4b5cc4b06804ae3d6.png" alt="image"></div><br><br>  The answer was short and clear as daylight - I am dealing with DRM protection of video files.  That is, I discovered how using legal and fairly convincing methods, attackers can successfully and with certainty spread malicious files, because: firstly, no antivirus will find that the video file is infected, and secondly, most users trust Microsoft and will definitely launch such files. <br><br>  Moreover, WMP is not the only player that can open DRM protected files.  I did not find a complete list of players, but I can say with confidence that Nero ShowTime supports DRM, only unlike WMP, it reacts more carefully ... only if you confirm license downloading, does the web page open in IE (although it is not a browser default). <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2e0/ea0/bd8/2e0ea0bd835ddde8e650ccc1c71f8e75.png" alt="image"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/900/d2a/f76/900d2af76794932df24280c08f0f8029.png" alt="image"></div><br><br>  And now the most interesting thing: if you change the file extension from <b>.wmv</b> to <b>.asf</b> or to <b>.wma</b> , nothing changes, that is, the players will still play the media file and most dangerous, in most cases, the .wma files will be opened in Windows Media Player.  By the way, I forgot to say, after I opened the video file in the Hex editor, for convenience, I deleted unnecessary bytes and as a result the file size became 5.31KB. <br><br><br><h3>  Internet Explorer </h3> Probably many people think that ‚ÄúThere is no danger in this!  I will not download any licenses!  Anyway, where does Internet Explorer, WMP and video files come from? ‚Äù  At first, I also thought so, because there is a ‚ÄúCancel‚Äù button, but as it turned out, there is a danger and not a small one, and ‚ÄúCancel‚Äù will not save anyone if the file is opened in WMP.  And Internet Explorer is the same browser, web browsing software ... <br><br>  I found information about how to crack DRM-protection, but did not.  Firstly, I did not know whether it would be possible to change the link, and secondly, I chose the easier way.  <b>Added a</b> line in the <b>hosts</b> file: <br> <code>127.0.0.1 free-license.imgpop.com</code> <br> <br>  I created the <b>venuf.php</b> file <b>at the</b> root of the local server and opened a video using WMP - after a few seconds the following message appeared: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a7/d99/b55/5a7d99b55ba8ddfb0360248c0cb55387.png" alt="image"></div><br><br>  Next, using <i>alert ()</i> , I decided to try if it supports JavaScript - as a result I received an empty page.  I thought that really didn‚Äôt work, but having connected my intuition, I quickly changed the <i>alert ()</i> function to <i>document.write ()</i> .  The result caused a smile: this time the page was not empty, so Windows Media Player supports JavaScript. <br><br>  Now, the thought that the media player could open web pages, but also supports JavaScript, did not give me rest.  Wanting to find out what kind of player this is, he added a line in the <b>venuf.php</b> file: <br> <code>echo $_SERVER['HTTP_USER_AGENT'];</code> <br>  and even though I have MSIE 8.0 installed, I received the following message: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b4b/8c8/89f/b4b8c889fbd31deb95dead1fc6a02fb7.png" alt="image"></div><br><br>  Finally, I decided to test one exploit for MSIE, written in JavaScript, causing a denial of service to the browser.  I added an exploit to the page, opened the video file and I did not have time to blink, as Windows states that "Windows Media Player stopped working": <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/13f/e87/94e/13fe8794e1db4b54fbd79ec02c7c2091.png" alt="image"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d56/4c2/291/d564c229119a6205d2e285bebf69f55c.png" alt="image"></div><br><br>  As you understand, trying to play a video file, WMP forcibly disconnected, which means that it is vulnerable to an MSIE exploit.  I checked only one exploit, but that was enough to change my ideas about the <b>security of media files</b> . <br><br><br><h3>  Instead of postscript </h3>  Having written the last lines of this article, suddenly one idea came to me: download, install and test one of the most popular multimedia players - <b>Winamp</b> .  What I did ... And when I tried to play the file, the following message appeared: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3cf/52e/e0d/3cf52ee0d9fa970a541028c2d8761e16.png" alt="image"></div><br><br>  I was <s>almost</s> sure that everything would be the same as with Nero ShowTime, but curiosity made me click on the 'Yes' button ... Instead of launching IE, I saw the following: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b3e/021/89a/b3e02189ab333e58750c4c0b041d65ce.png" alt="image"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5f0/deb/08e/5f0deb08e1ac5962c5b54b14e945f8af.png" alt="image"></div><br><br>  I did not immediately understand what the problem was, thinking that anything could happen, but after a few seconds, I remembered that the exploit code for MSIE remained in the file <b>venuf.php</b> .  Next, using the <i>$ HTTP_USER_AGENT</i> variable, <i>I</i> found out that Winamp uses <s>MSIE 7</s> Internet Explorer as well as WMP for its own purposes: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bab/401/b81/bab401b816fea5d86ea119ec3adb5e49.png" alt="image"></div><br><br>  True, unlike Windows Media Player, Winamp does not warn you from where the license file will be downloaded, but allows you to use the right click and see the source code of the page ... and also for it, the alerts work: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ab/cb0/74c/3abcb074c573ca279090f963dc9a8071.png" alt="image"></div><br><br><br><h3>  Conclusion </h3>  At first glance, not everything is as scary as it seems, but I want to draw your attention to the fact that by opening such a file, the user will not be able to stop the launch of the exploit at all, and the antivirus program cannot help, because if this is a new exploit, then most likely, it is not yet added to the antivirus database. <br><br>  Simply, do not forget that not all users have other audio and video players installed.  And also, I do not believe that a user who waited 2 hours (at best) to download a long-awaited file, having seen that it is not playing, will simply delete it, and no ‚Äúdo not open files in this player!‚Äù Will not help . <br><br><br>  <b>UPD:</b> <h3>  Protection </h3>  To significantly reduce the risk of possible attacks, I recommend disabling the license for DRM-protected files in WMP.  To do this, open the <i>Options</i> (Options) and in the <i>Privacy</i> tab, uncheck the box ‚Äú <i>Get licenses automatically for protected content</i> ‚Äù (Download free usage right when I play or sync a file): <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d14/c9f/1f2/d14c9f1f24f163625e6bd13c6a231c24.png" alt="image"></div><br><br>  Now, when you open the file, WMP will ask if you really want to open a web page to get a license: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/15b/a28/15d/15ba2815d2a9142399aebebba4123ec4.png" alt="image"></div><br><br>  Despite the fact that the developers warn about the danger and know that 'web pages may contain elements that may be dangerous for the computer' - they still turned off this option by default.  Strange, isn't it? <br><br>  <b>UPD 2:</b> ( <i>Many thanks to Dragonizer Habrayuzer for the <a href="http://habrahabr.ru/blogs/infosecurity/89676/">remark</a></i> ) <br><blockquote>  Although the User Agent is defined as MSIE 7.0, in fact it is not.  The fact is that WMP opens web pages in compatibility mode, which means that: <br>  ‚Ä¢ In the browser version line, the web browser is denoted as MSIE 7.0, not MSIE 8.0; <br>  ‚Ä¢ Conditional comments and version vectors recognize the web browser as IE 7, not IE 8; </blockquote></div><p>Source: <a href="https://habr.com/ru/post/89676/">https://habr.com/ru/post/89676/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../89651/index.html">Nokia N900. We continue to understand or "Hack your Nokia N900"</a></li>
<li><a href="../89656/index.html">Gamlist - your list of games</a></li>
<li><a href="../89657/index.html">About the site metro29.ru</a></li>
<li><a href="../89669/index.html">Tenders are the way to a healthy economy</a></li>
<li><a href="../89675/index.html">UGC kills professional photographers</a></li>
<li><a href="../89677/index.html">Scanword every day</a></li>
<li><a href="../89681/index.html">The results of the competition for the best design of Habra-T-shirts</a></li>
<li><a href="../89683/index.html">What creates masterpieces</a></li>
<li><a href="../89685/index.html">Today‚Äôs Gmail vowel issues</a></li>
<li><a href="../89688/index.html">Rubinius 1.0.0-rc4 released</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>