<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I implemented the first rule of doing business in Russia</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=""one. Keep the server abroad ¬ª 
 (c) 9.5 rules for conducting a safe business in Russia 

 The prologue. 

 We are a small company of 10 employees, ha...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I implemented the first rule of doing business in Russia</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/fb7/77a/be8/fb777abe88d8289919b131e915fb335a.jpg" alt="image"><br>  <i>"one.</i>  <i>Keep the server abroad ¬ª</i> <i><br></i>  <i>(c) 9.5 rules for conducting a safe business in Russia</i> <br><br>  <b>The prologue.</b> <br><br>  We are a small company of 10 employees, half of which occasionally work remotely. <br>  What we had initially: a server with Windows and terminal access, which stood in the office.  All users had laptops.  We do not have any particularly confidential information, except for information important for business. <br>  At one point, I was finally ‚Äúfinished off‚Äù by paranoia and it was decided to bring the server out of the office. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  <b>1)</b> We rented two servers: one in Germany, the second in the Netherlands. <br>  The configurations are the same: Intel Xeon Quad Core E3-1230 3.20 GHz / 8GB / 2x 1TB. <br>  The prerequisites were: IP-KVM 24x7, guarantee of technical support response up to 4 hours around the clock, next-business day server replacement warranty (NBD) and unlimited traffic. <br>  Additional software requirements: Windows 2008 standard, Windows 2008 enterprise, terminal licenses and MS Office (Word, Excel, PowerPoint) <br>  These wishes and determined quite immodest budget: 756 euros / month. <br><br>  Hosters leave unnamed.  I can only say that because of the desire to pay via Webmoney (ie, not by credit cards), I had to turn to resellers. <br><br>  <b>2)</b> Setting up both servers at the initial stage was completely identical.  After gaining access to the servers, the entire first day was spent on the OS update.  After it was installed Hyper-V. <br>  A virtual machine was immediately created on CentOS, which became the router: it was her ‚Äúwhite‚Äù IP.  All other machines (including the host system) worked on the "gray" addresses. <br>  To carry out this focus with IP, constantly connected IP-KVM came in handy.  In this case, embedded IPMI and iLo on each of the servers. <br>  Open VPN server was raised on the router, only he was accessible from the outside.  All other ports were closed. <br>  Also on the router raised NAT and proxy server. <br><br>  <b>3)</b> A virtual server with Windows 2008 Standard was created on the first server for all available memory, which became our new office server. <br>  7 GB for simultaneous work of 10 people in the terminal - more than comfortable conditions.  Internet users office server is available only through a proxy. <br>  Dr.Web works, licenses for which we got by subscription from the network to which our office is connected. <br>  Standard office software suite: MS Office, Acrobat Reader, PDF Creator, WinRAR, InfranView, KeePass, Chrome, Firefox. <br>  To prevent users from getting confused, a Bginfo file was attached to autoload for everyone, which changes the color of the desktop and writes on it what kind of server it is. <br><br>  <b>4)</b> On the second server, everything is a bit more interesting. <br>  On the host server is Windows 2008 Enterprise, which allows you to install up to 4 virtualok for free with Windows 2008 Standard. <br>  Thus, it is, in fact, a server for an accountant: four virtual machines work here - CRM / billing, 1C8 (we switch to it), 1C7 (we work with it), client-bank. <br>  All four servers are separated from each other: they are located in different Hyper-V virtual networks that cannot see each other. <br>  This is done so that in a situation where some of the machines pick up some infection, the infection does not spread beyond it. <br>  From the same machines, we send reports to the tax office through MeDOC and ‚ÄúFarewell zvitnist‚Äù.  Tax sees that reports come from the IP of our office and not from Europe, as traffic from the ‚Äúaccounting‚Äù servers is routed through the VPN tunnel to the office. <br>  Just like on the office virtual machine, on servers with 1C, the Internet is accessible through a proxy, Dr.Webs and standard software work. <br>  In 1C 7th, the key works through the Usb-over-network, with 1C 8 we use the software key. <br>  Internet is disabled on the client bank server: access is only available to the banks' servers.  The bank also sees our office IP and not the real IP of the server. <br><br>  <b>5)</b> All of these servers are accessible via Remote Desktop (RDP) after logging in to the Open VPN server (either of the two). <br>  And one more fruit of my paranoia: when connecting to the Open VPN server, it is impossible to see any server in your network. <br>  By RDP, servers can only be accessed via a non-standard port that ‚Äúflushes‚Äù (DNAT) to the RDP port of the corresponding virtual machine. <br><br>  <b>6)</b> In the office we have a Wi-Fi router D Link DIR-320.  We reflash it, and then set up an OpenVPN client on it. <br>  The DIR-320 includes a USB printer, to which all virtuals can print through a tunnel. <br>  Employees from the office can work without changing anything on their laptops. <br>  Employees who want to work remotely have been given Open VPN keys and the following instructions: how to set up a tunnel on MacOS / Windows, how to go to the remote desktop, how to print to an office printer, how to print to a home printer, and so on. <br><br>  <b>7)</b> The most important is backup. <br>  Since there is nothing on the host systems except Hyper-V, they are not backed up. <br>  On Friday afternoon, all employees receive a mailing (a reminder of the event from the Google Calendar) asking them not to forget to close all applications and save all documents. <br>  On the night from Friday to Saturday, the Power Shell ‚Äì script turns off all virtuals, copies their VHD images to a separate folder, and from where it copies to a backup server through the VPN tunnel + to my server in Ukraine. <br>  But this is only half the battle. <br>  Every day a script is launched on all virtual machines that archives the data that has changed during the day;  and every week - archives all user data (really everything - from documents to 1C-databases). <br>  Archiving takes place based on this instruction: <a href="http://habrahabr.ru/blogs/personal/82185/">habrahabr.ru/blogs/personal/82185</a> , but we make archives password-protected, multi-volume and with the addition of information for recovery.  The archives are made up into premium accounts of DropBox and Google Drive and through these services fall on both servers (+ director on a laptop). <br><br>  <b>What we have in the end:</b> <br>  - Upon request, I can recover any document for any day. <br>  - All archives with a password of hundreds of random characters.  Even if DropBox will show someone all their files again, it will be extremely difficult to open my archive. <br>  - In case of any force majeure with one of the DCs, I, in less than an hour, will be able to run a copy of the server a week ago on another server in another country + roll changes from the archives. <br><br>  Everything described has been working for us for almost a year.  There are no particular complaints, except that the software update on four servers takes four times longer :). <br>  Data from backup archives was restored a couple of times on demand - it works like a clock. <br>  For the test, imitated the DC shutdown several times: raised all servers from backup on one of the servers.  Everything works, except for 1C8 with a software key, it is important to make a completely similar configuration on the new server. <br>  The accountant once ‚Äúflew‚Äù the laptop, - the work was restored in half an hour, simply issuing a new one and setting up shortcuts for connecting to servers. <br>  Data centers were not available several times for half an hour due to the upgrade of routers, but this was never the case during working hours. <br>  Also, once there was an attack on the DC in the Netherlands: everything ‚Äúlagged‚Äù for about an hour during working hours. <br>  Theoretically, it would be possible to still tweak encrypted filesystems and spread servers across different continents, but in our case I do not see any point in this. <br><br><br>  I hope this information was interesting.  I would be glad if it is useful to someone. <br>  If you decide to repeat this configuration, do not hesitate to ask: I will be happy to help with the advice and reveal any unclear details. </div><p>Source: <a href="https://habr.com/ru/post/157899/">https://habr.com/ru/post/157899/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../157883/index.html">Incremental GPS track mapping algorithm to a road graph</a></li>
<li><a href="../157885/index.html">Monitor with a 21: 9 aspect ratio from LG</a></li>
<li><a href="../157889/index.html">Webinar: ‚ÄúHR branding for startups‚Äù right now!</a></li>
<li><a href="../157891/index.html">MasterCard payment cards with display and keyboard</a></li>
<li><a href="../157895/index.html">Domain me.ga no longer belongs to Kim Dotky</a></li>
<li><a href="../157901/index.html">FAS Russia collects additional information about the "short" numbers</a></li>
<li><a href="../157903/index.html">123D Design by Autodesk</a></li>
<li><a href="../157905/index.html">Announced Slax 7, a new version of the live distribution</a></li>
<li><a href="../157907/index.html">FAS took the scam on short numbers</a></li>
<li><a href="../157909/index.html">MTI has created an implant that uses an ear snail instead of a battery.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>