<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>VPN for mobile devices at the network level</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In RuNet, there is still surprisingly little material about such an old and simple, but convenient, secure and especially relevant in connection with ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>VPN for mobile devices at the network level</h1><div class="post__text post__text-html js-mediator-article">  In RuNet, there is still surprisingly little material about such an old and simple, but convenient, secure and especially relevant in connection with the development of the Internet of things technology, like mobile VPN (virtual private network).  In this article I will describe how and why you can configure access to your private network to any device with a SIM card without having to configure specialized software on it. <br><img src="https://habrastorage.org/webt/vn/it/qi/vnitqitwtv8qnzwhufihgww6h0g.png"><br><a name="habracut"></a><br><h2>  Tasks and limitations </h2><br>  To begin, answer the question "why?".  VPN as a technology is used to solve a variety of network tasks, united by a common feature - isolated data transfer between two devices through a large number of intermediate nodes.  On the basis of this, more complex solutions are already being built and those very different tasks are being solved.  In the usual, usual case, a fixed-line operator‚Äôs network is used to build a VPN (there is <a href="https://habr.com/ru/post/273679/">excellent material for</a> those who want details) or many different network protocols (GRE, IPSec, L2TP and others are the same author <a href="https://habr.com/ru/post/170895/">about this</a> ) and software products that work with them (Cisco AnyConnect, OpenVPN, TOR - well, you yourself know), but using them on a specific terminal device immediately puts forward a number of requirements for it, the failure of which leads to certain restrictions. <br><br>  The first serious limitation is that the device should be able to work with at least one of these protocols at the hardware and software levels.  Most often this is determined by software that is easy to find for a laptop or smartphone, but there are cases where the task is too simple from a hardware point of view, or its software has limitations: the water meter wants to use a VPN to transfer its unfortunate byte of readings Once a month, no less than you want to use VPN to edit your LinkedIn profile. <br><br>  Another important limitation is the need for customization.  It works both for the ‚Äústupid‚Äù devices from the first paragraph, and for classic smartphones and computers that are not aware of the previous limitation.  And if with the first ones everything is relatively simple and depends on the amount of time spent on setting up, then with the second ones there are options.  Often, organizations use VPN for security purposes in order to protect the service terminal device from going out to the public network without proper corporate protection or from transferring service data through public channels.  End users may, for whatever reasons, disable or forget to enable VPN, with the result that many company security systems may be ‚Äúoverboard‚Äù. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Both of these restrictions are easily removed if access to the VPN is provided at the network level.  In the case of mobile communications, this can be implemented using a ‚Äúmobile VPN‚Äù.  A device of any complexity capable of transmitting data will transmit it to the correct network.  No matter what settings are made on the device, with a properly configured network, it will in any case pass them to the right place and nowhere else. <br><br>  And as a nice bonus, the device will receive an address from the internal network that is remotely configured, and access to it will be possible to get only from within this network (or physically).  For a certain class of devices, this is very important. <br><br><h2>  How it works </h2><br><h3>  PS Core </h3><br>  It would seem that VPN is a classic service of all telecom operators for the B2B segment, and why in that case to focus on this?  The thing is how the data network for devices connected via GPRS, HSPA, LTE or other mobile communication technology is arranged.  There are no usual for all network administrators vlan, no switches, not even routers in their usual meaning.  But there is a radio access network (RAN) and packet core (PS Core). <br><br><img src="https://habrastorage.org/webt/_d/yn/mx/_dynmxtvymlk1yu5fwschjzwlsa.png"><br>  <i>Simplified diagram of the mobile operator's packet network.</i>  <i>It is slightly different for LTE, but the general meaning remains the same.</i> <br><br>  In general, each device with a SIM card registered in the packet network (passed the GPRS attach procedure or similar), before starting to transfer data somewhere, must initiate the creation of a data transfer session (PDP context) on the packet core network router, GGSN .  Details and purpose of these processes are very well described here in <a href="https://habr.com/ru/post/81385/">this article</a> .  What is important for us: when initiating a session in a request to the GGSN, among others are the parameters that many have seen in their phones or even dealt with them when setting up, for example, usb modems.  These are three fields: APN, login and password.  APN (access point) is a very important entity in the logic of the GGSN: depending on which APN the session is initiated with, the GGSN acts differently.  As a result of successful processing of the user's request, the GGSN must activate the data transfer session and inform the device of its parameters, in particular, the IP address and DNS addresses issued to the device.  There are a number of important very important features: <br><br><ul><li>  In a request to initiate a session, the device never requests which IP address it would like to receive; </li><li>  In addition to the ‚ÄúAPN‚Äù, ‚Äúlogin‚Äù and ‚Äúpassword‚Äù fields specified in the device settings, the GGSN request also sends the subscriber‚Äôs phone number (MSISDN) (hereinafter ‚Äúsubscriber‚Äù is the end user, one device with a SIM card, and "Client" - the customer organization of the service, which includes subscribers); </li><li>  When a session is activated, the GGSN creates an entry in its routing table about the new IP address.  All subscribers to GGSN are indicated by entries in the routing table with the prefix / 32, i.e.  1 subscriber - 1 entry in the table.  GGSN is a very productive router; </li><li>  The operator‚Äôs network may, at different stages (on both SGSN and GGSN), for various reasons, change the APN field in the session initiation request.  This allows in some cases to reduce, and in some even eliminate the configuration of network parameters on devices with a SIM card. </li></ul><br>  The first three points immediately raise the question: what kind of IP address is given to the subscriber? <br>  This is determined by the settings of the APN with which the request to activate the session came.  About 99% of data transfer users in mobile networks use regular Internet access.  These are known to all access points internet.mts.ru, internet.beeline.ru and so on.  In the case of Internet access, GGSN issues addresses according to the classic DHCP principle from the gray subnets set in the settings.  When they enter the public network, they are closed by the classic NAT (or, more precisely, by its version, which is PAT). <br><br>  But GGSN is capable of more.  To select an IP address, he can make an AAA request to the authorization server (Radius, for example).  Such logic is configured for individual APNs depending on their purpose.  The easiest case is a permanent public IP address service.  Such addresses, as a rule, are assigned to subscribers in the billing (BSS) of the operator, and depending on the IT architecture they fall into one or another database, to which the GGSN requests.  Due to the fact that he knows the MSISDN (telephone number) of the subscriber, which will be contained in the request, such a database will be quite simple and can contain only a bunch of numbers and addresses.  In addition, if the client plans to use one SIM card to connect several devices (if the SIM card is in the WiFi router of the remote office, for example), this table may also contain the so-called ‚Äúframed route‚Äù - the prefix of the network located ‚Äú for a SIM card that will be announced to all devices on the network using dynamic routing protocols. <br><br>
<h3>  Not a single GGSN </h3><br>  In addition to issuing addresses, you also need to deliver subscriber traffic to customer networks, each to its own.  Everything here works much more traditionally.  On GGSN, traffic specialized for working with a VPN APN is routed to a separate operator‚Äôs network router (it can be called differently, sometimes a VPN router), which in turn performs the function of a classic PE in L3VPN scheme.  It adds the necessary labels, headers, and this is all and sends all this traffic flow through the routers of the transport network to the pre-configured junctions or tunnels to the client‚Äôs network.  This part is much more traditional and has been described in other places many times, so I will not focus on it in this material. <br><br>  With all these details, there can be several ways to organize a mobile VPN, and they will differ from each other in a combination of the following features: <br><br><ul><li>  IP addresses, as already described, can be issued dynamically (each time a different address from a given subnet) and statically (each time the same address for a particular subscriber), which is determined by both / or APN settings and / or Radius server settings ; </li><li>  IP addresses can be issued by a Radius server under the control of an operator or under the control of a client; </li><li>  Devices connected to a mobile VPN can communicate either only with each other or have access to the client‚Äôs usual L3VPN network through a direct interface (VPN port) with an operator or through tunneling over the Internet; </li><li>  In some cases, the use of a login and password for successful activation of the session may be necessary, and sometimes it is not even necessary to fill in the ‚ÄúAPN‚Äù field. </li></ul><br>  There are several dozens of such combinations with different types of tunneling, balancing traffic between the access channels to the "main" VPN client and the principle of issuing addresses.  For most cases, the general scheme is as follows: <br><br><img src="https://habrastorage.org/webt/47/ez/7d/47ez7dugxs7whtjaghvrapuihcs.png"><br><br>  As a result, after a fairly quick registration process in the network and obtaining an IP address, the device gets access to the client‚Äôs network, and the client‚Äôs network gets access to the device.  At the same time, the subscriber is isolated from all other subscribers of the operator who are not related to a particular client, he does not need any additional settings, and all traffic is unconditionally sent to the client‚Äôs network, where it is processed in accordance with the client‚Äôs internal policies. </div><p>Source: <a href="https://habr.com/ru/post/444946/">https://habr.com/ru/post/444946/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../444932/index.html">How not to understand the principles of the development of architecture SOLID</a></li>
<li><a href="../444934/index.html">Adapt AutoMapper for yourself</a></li>
<li><a href="../444936/index.html">ZXHN H118N firmware from Dom.ru without soldering and programmer</a></li>
<li><a href="../444938/index.html">Useful and not very public services</a></li>
<li><a href="../444942/index.html">As I visited the legendary School 42: "pool", seals and the Internet instead of teachers</a></li>
<li><a href="../444950/index.html">Termux step by step (Part 1)</a></li>
<li><a href="../444956/index.html">To work on the bike. Another opinion</a></li>
<li><a href="../444958/index.html">Buy an electronic device and get the data for free: personal information remains on the donated gadgets</a></li>
<li><a href="../444960/index.html">Phone deep space: how NASA accelerates interplanetary communications</a></li>
<li><a href="../444962/index.html">Clouds and powder keg Open Source</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>