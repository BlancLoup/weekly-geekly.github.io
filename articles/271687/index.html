<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Httplug - abstraction from HTTP client for PHP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last year, PHP-FIG adopted the PSR-7 standard, which describes how to work with HTTP messages. Good article about this standard and its application wa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Httplug - abstraction from HTTP client for PHP</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/files/62c/705/db3/62c705db391f4f4fb70d53e477fae364.png" alt="HTTPlug"></p><br><p>  Last year, PHP-FIG adopted the <a href="http://www.php-fig.org/psr/psr-7/">PSR-7</a> standard, which describes how to work with HTTP messages.  Good <a href="http://habrahabr.ru/post/250343/">article about this standard and its application</a> was on Habr√©.  And although PSR-7 is a big step forward, it lacks a logical continuation ‚Äî a common HTTP client interface.  The creation of the missing component took the group <a href="http.org/en/latest/index.html">PHP-HTTP</a> . </p><a name="habracut"></a><br><h4>  Problem </h4><br><p>  Using the PSR-7 interfaces, you can abstract away from the specific implementation of HTTP requests and responses.  But only as long as you do not need to make a request yourself.  Here you will still have to be tightly tied to any implementations.  When writing an application it is natural.  When writing a library - absolutely not good.  For example, our site interacts with five third-party services using official and unofficial libraries and the SDK.  And each one uses its own HTTP client.  Someone Guzzle, someone cURL, someone just file_get_contents.  Five different HTTP clients in one application!  Each has its own characteristics, its own limitations, its own customization capabilities.  Would it be great to replace this zoo with a single client that would be used by all application components and libraries? </p><br><h4>  Httplug </h4><br><p>  The main development of the group is a set of <a href="httplug">Httplug</a> interfaces, allowing libraries to abstract away from the specific HTTP client used in the application.  There are already several client implementations (sockets, cURL) and adapters (Guzzle, React).  In addition, the project has developed many auxiliary packages, including a package for symfony. </p><br><p>  And what does all this give developers? </p><br><h4>  Application in libraries </h4><br><p>  If you are writing a library that needs to fulfill HTTP requests, you no longer need to bind to a specific client.  Instead, in ‚Äúcomposer.json‚Äù you can specify: </p><br><pre><code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"require"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"php-http/client-implementation"</span></span>: <span class="hljs-string"><span class="hljs-string">"^1.0"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"require-dev"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"php-http/curl-client"</span></span>: <span class="hljs-string"><span class="hljs-string">"^1.4"</span></span> } }</code> </pre> <br><p>  <strong><code>php-http/client-implementation</code></strong> indicates that your library requires an HTTP client, <strong><code>php-http/curl-client</code></strong> ‚Äî <a href="http.org/en/latest/clients.html">any</a> implementation that you can use during debugging and which will pull up all the interfaces and classes required for development.  Debugging may also require the implementation of a PSR-7, such as <a href="http/psr7">guzzlehttp / psr7</a> . </p><br><p>  Suppose your library should work with some API, and the main component is the client of this API: </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApiClient</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *  HTTP. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $httpClient; <span class="hljs-comment"><span class="hljs-comment">/** *   HTTP. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $requestFactory; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpClient $httpClient, RequestFactory $requestFactory)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;httpClient = $httpClient; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;requestFactory = $requestFactory; }</code> </pre> <br><p>  Here: </p><br><ul><li>  <a href="httplug/blob/v1.0.0/src/HttpClient.php">HttpClient</a> - actually, HTTP client ( <a href="httplug">php-http / httplug package</a> ); </li><li>  <a href="http/message-factory/blob/v1.0.1/src/RequestFactory.php">RequestFactory</a> is a factory that allows you to create PSR-7 requests ( <a href="http/message-factory">php-http / message-factory</a> package). </li></ul><br><p>  Now that you need to make a request, you can write something like this: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $uri * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $payload   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apiCall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($uri, $payload)</span></span></span><span class="hljs-function"> </span></span>{ $request = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;requestFactory-&gt;createRequest(<span class="hljs-string"><span class="hljs-string">'POST'</span></span>, $uri, [<span class="hljs-string"><span class="hljs-string">'content-type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'foo/bar'</span></span>], $payload); $response = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;httpClient-&gt;sendRequest($request); <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br><p>  Here, by and large, and all that is required.  Now your library does not depend on a specific client, and its user will be able to choose the one that suits him best.  Let's see how this is done. </p><br><h3>  Application use </h3><br><p>  To use the library described above, the application developer will need to select <a href="http.org/en/latest/clients.html">one of the</a> client implementations, the PSR-7 implementation, and connect them with your library: </p><br><pre> <code class="hljs ruby">$ composer <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> php-http/guzzle6-adapter $ composer <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> /</code> </pre> <br><p>  <code>guzzle6-adapter</code> will automatically <code>guzzlehttp/psr7</code> up <code>guzzlehttp/psr7</code> , so it's not necessary to specify it separately. </p><br><p>  You also need <a href="http/message">php-http / message</a> as a bridge to <code>guzzlehttp/psr7</code> : </p><br><pre> <code class="hljs ruby">$ composer <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> php-http/message</code> </pre> <br><p>  Next, you need to create a client, adapter, query factory and transfer the last two to the ApiClient constructor: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">GuzzleHttp</span></span>\<span class="hljs-title"><span class="hljs-title">Client</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">GuzzleClient</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Adapter</span></span>\<span class="hljs-title"><span class="hljs-title">Guzzle6</span></span>\<span class="hljs-title"><span class="hljs-title">Client</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">GuzzleAdapter</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Message</span></span>\<span class="hljs-title"><span class="hljs-title">MessageFactory</span></span>\<span class="hljs-title"><span class="hljs-title">GuzzleMessageFactory</span></span>; $config = [ <span class="hljs-comment"><span class="hljs-comment">// ... ]; $guzzle = new GuzzleClient($config); $adapter = new GuzzleAdapter($guzzle); $apiClient = new ApiClient($adapter, new GuzzleMessageFactory);</span></span></code> </pre> <br><p>  ApiClient is ready to go.  The same object ($ adapter) can be passed to all components that need an HTTP client. </p><br><p>  If in the future there is a need to replace Guzzle with something else, then only this part of the code will need to be rewritten.  The rest of the code that works with HTTP will not have to be touched. </p><br><h4>  What else is interesting? </h4><br><p>  Fully available packages and their capabilities can be found in the <a href="http.org/en/latest/index.html">official documentation</a> , I will only note some interesting ones in my opinion. </p><br><h5>  Asynchronous requests </h5><br><p>  The special <a href="httplug/blob/v1.0.0/src/HttpAsyncClient.php">HttpAsyncClient</a> interface allows <a href="httplug/blob/v1.0.0/src/HttpAsyncClient.php">you</a> to execute requests asynchronously using the <a href="http.org/en/latest/components/promise.html">promise</a> mechanism. </p><br><h5>  Autodiscovery implementations (Discovery) </h5><br><p>  <a href="http.org/en/latest/discovery.html">The</a> <a href="http://docs.puli.io/en/latest/index.html">Puli-</a> based <a href="http.org/en/latest/discovery.html">Autodiscover system</a> allows you to retrieve client objects and factories without reference to specific implementations: </p><br><pre> <code class="php hljs">$httpClient = HttpClientDiscovery::find();</code> </pre> <br><h5>  System extensions (plug-ins) </h5><br><p>  Allows you to add end-to-end functionality to all or just some HTTP clients.  Here are some examples: </p><br><ul><li>  <a href="http.org/en/latest/plugins/cache.html">caching</a> ; </li><li>  <a href="http.org/en/latest/plugins/cookie.html">cookies</a> ; </li><li>  <a href="http.org/en/latest/plugins/error.html">conversion of 4xx and 5xx statuses into exceptions</a> ; </li><li>  <a href="http.org/en/latest/plugins/headers.html">header management</a> ; </li><li>  <a href="http.org/en/latest/plugins/logger.html">journaling</a> ; </li></ul><br><h5>  HttplugBundle </h5><br><p>  <a href="http.org/en/latest/integrations/symfony-bundle.html">A symfony package</a> that includes support for multiple clients, extensions, and the symfony debug panel. </p><br><h3>  Finally </h3><br><p>  The project is at the beginning of its path, but is already quite stable for use in combat conditions.  The guys set an ambitious goal - to achieve the adoption of their development as a recommendation PSR. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/271687/">https://habr.com/ru/post/271687/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../271677/index.html">Bitwise sorting with a human face</a></li>
<li><a href="../271679/index.html">What's new in the field of data storage</a></li>
<li><a href="../271681/index.html">Young hackers 414s</a></li>
<li><a href="../271683/index.html">Come November 26th to Visual Studio Workshop</a></li>
<li><a href="../271685/index.html">Spreadsheets under the hood</a></li>
<li><a href="../271689/index.html">Developing your own solution: risks and responsibilities</a></li>
<li><a href="../271693/index.html">We write software for generating music card data. Part one: parse the MIDI file</a></li>
<li><a href="../271695/index.html">Developer Economics Tenth Study</a></li>
<li><a href="../271697/index.html">Machine Learning Hackathon: Come. To train a model. To win</a></li>
<li><a href="../271699/index.html">Professional test on the knowledge of the realities of the market for customized development and digital communications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>