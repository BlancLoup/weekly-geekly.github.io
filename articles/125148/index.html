<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>KnockoutJS: Ajax grid view from scratch to 40 lines</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently on Habr√© there are more and more references to KnockoutJS, and I will not stay away from this trend. 
 Today I will talk about how to do your...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>KnockoutJS: Ajax grid view from scratch to 40 lines</h1><div class="post__text post__text-html js-mediator-article">  Recently on Habr√© there are more and more references to KnockoutJS, and I will not stay away from this trend. <br>  Today I will talk about how to do your own Ajax Grid View with filtering and navigating through the pages by writing, with very little code. <br>  Starting to write this article, I felt a little awkward, and even now the feeling did not go away.  The thing is that the library itself is simple, the MVVM pattern is simple, and I will tell simple things.  I am sure that in the near future Knockout will receive a fairly large spread.  And it is embarrassing to me that in a year or so, someone stumbling upon this article will be discouraged by the simplicity of the material presented.  Just like any of you are now, who opened the article on jQuery from 2007. <br><br>  Who was not afraid of the alleged accordion, you are welcome under Habrakat. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As expected, let's set ourselves a task that we need to solve. <br>  Imagine yourself as a front-end developer who needs to display a list of people (name, gender, age) and let them search by these parameters.  A list of people is displayed page by page.  And this thing looks like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/258/058/944/2580589443bfc8b772e414a39cd6ac6b.png" alt="Interface for viewing information about people"><br><br>  For us, the entire backend has already been created and all interfaces are already known.  So I just bring them here. <br><br><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-function">ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">List</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">FilterParams filterParams, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pageNumber = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br>  The output is a ListResult object consisting of an array of ‚Äúsearch result‚Äù and data for switching pages (the number of the current page and how many pages there are). <br>  In the code, it all looks like this: <br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FilterParams</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>? AgeFrom { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>? AgeTo { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> ShowMale { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> ShowFemale { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Gender { Male, Female } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PagingData</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> PageNumber { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TotalPagesCount { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Person</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FirstName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> LastName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Age { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Gender Gender { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ListResult</span></span> { IEnumerable&lt;Person&gt; Data { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } PagingData Paging { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br><br>  Now we can concentrate on solving our problem.  I propose to begin our research with markup.  There is nothing new for those already familiar with Knockout, everything should be clear for beginners too. <br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TableRow"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">data-bind</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text: FirstName"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">data-bind</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text: LastName"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">data-bind</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text: Gender"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">data-bind</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text: Age"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">thead</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> First name<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> Last name<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> Gender<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> Age<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">thead</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-bind</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"template: { name: 'TableRow', foreach: rows }"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  So, we have a template for one record.  In the table, we have a static header, and tbody is filled in from the rows array.  Now we need to describe the view model, which can fill this table with data.  In the beginning I will give the code, and then I will explain it. <br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> viewModel = { <span class="hljs-attr"><span class="hljs-attr">rows</span></span>: ko.observableArray() }; ko.dependentObservable(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/AjaxGrid/List'</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-attr"><span class="hljs-attr">context</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rows(data.Data); } }); }, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); ko.applyBindings(viewModel);</code> </pre><br><br>  ViewModel contains only one field - rows.  At the beginning it is empty.  Then we create a dependentObservable that will be executed upon initialization.  At run time, it will make an AJAX request to the server, and the Data field values ‚Äã‚Äãfrom the response will be assigned to the rows field.  KO will track the change in the rows field and fill the table with incoming entries.  You can read more about dependentObservable in the <a href="http://knockoutjs.com/documentation/dependentObservables.html">official documentation</a> or in <a href="http://habrahabr.ru/blogs/javascript/124931/">this comment</a> . <br><br>  The next step is to add a page switch.  Let's start with the viewModel <br><pre> <code class="hljs actionscript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> viewModel = { rows: ko.observableArray(), paging: { PageNumber: ko.observable(<span class="hljs-number"><span class="hljs-number">1</span></span>), TotalPagesCount: ko.observable(<span class="hljs-number"><span class="hljs-number">0</span></span>), next: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pn = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.PageNumber(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pn &lt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.TotalPagesCount()) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.PageNumber(pn + <span class="hljs-number"><span class="hljs-number">1</span></span>); } }, back: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pn = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.PageNumber(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pn &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.PageNumber(pn - <span class="hljs-number"><span class="hljs-number">1</span></span>); } } } };</code> </pre><br><br>  In this example, the essence of the ViewModel in the MVVM pattern is very clearly visible.  The model consists of two properties <i>PageNumber</i> and <i>TotalPagesCount</i> .  And in the view of this model, there are already methods <i>next ()</i> and <i>back ()</i> .  If we need the <i>isFirstPage</i> or <i>isLastPage properties</i> , they will also be declared in the viewModel.  Thus, the king (Model) is surrounded by an obliging and changeable suite (ViewModel). <br><br>  Displaying the page selector is trivial. <br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"PagingPanel"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> Page &lt;span data-bind=</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"text: PageNumber"</span></span></span><span class="javascript"> /&gt; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">of</span></span></span><span class="javascript"> &lt;span data-bind=</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"text: TotalPagesCount"</span></span></span><span class="javascript"> /&gt;. &lt;br /&gt; </span><span class="xml"><span class="hljs-tag"><span class="javascript"><span class="xml"><span class="hljs-tag">&lt;</span></span></span><span class="hljs-name"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag"> </span></span></span><span class="hljs-attr"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag">=</span></span></span><span class="hljs-string"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"#next"</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag"> </span></span></span><span class="hljs-attr"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">data-bind</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag">=</span></span></span><span class="hljs-string"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"click: back"</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="hljs-tag"><span class="javascript"><span class="xml"><span class="hljs-tag">&lt;&lt;/</span></span></span><span class="hljs-attr"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">a</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></span><span class="javascript"> &lt;a href=</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"#next"</span></span></span><span class="javascript"> data-bind=</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"click: next"</span></span></span><span class="javascript">&gt;&gt;</span><span class="xml"><span class="hljs-tag"><span class="javascript"><span class="xml"><span class="hljs-tag">&lt;/</span></span></span><span class="hljs-name"><span class="javascript"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span></span><span class="javascript"><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></span><span class="javascript"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-bind</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"template: { name: 'PagingPanel', data: paging }"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Thus, we will simply display which page of how many are displayed and the buttons forward and back.  It remains for a little, to teach our grid view to update the data when switching pages. <br><br>  To do this, we need to modify our dependentObservable a bit: <br><pre> <code class="hljs kotlin">ko.dependentObservable(function () { $.ajax({ url: <span class="hljs-string"><span class="hljs-string">'/AjaxGrid/List'</span></span>, type: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>: {pageNumber: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.paging.PageNumber()} context: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, success: function (<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rows(<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.Data); } }); }, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);</code> </pre><br><br>  We have added the value of the PageNumber field to an AJAX request.  Now Knockout knows that our dependentObservable should be ‚Äúrecalculated‚Äù for any change in the PageNumber () property.  Thus, when the user presses the button further, the viewModel catches this event (data-bind = "click: next"), and simply increments the PageNumber value by one.  After that, KO sees that a PageNumber change has occurred, which means you need to exceed dependentObservable.  That, in turn, sends an AJAX request, and the incoming data is put in viewModel.rows, which causes a complete redraw of the table contents. <br><br>  Now it's time to add filtering.  We will use an approach similar to page switching.  All search parameters will be observable and their values ‚Äã‚Äãwill be sent when a query is sent.  Those.  any change in filtering conditions will result in a request to the server. <br><br><pre> <code class="hljs actionscript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> viewModel = { filterParams: { ShowMale: ko.observable(<span class="hljs-literal"><span class="hljs-literal">true</span></span>), ShowFemale: ko.observable(<span class="hljs-literal"><span class="hljs-literal">true</span></span>), AgeFrom: ko.observable(), AgeTo: ko.observable() }, rows: ko.observableArray(), paging: { PageNumber: ko.observable(<span class="hljs-number"><span class="hljs-number">1</span></span>), TotalPagesCount: ko.observable(<span class="hljs-number"><span class="hljs-number">0</span></span>), next: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pn = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.PageNumber(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pn &lt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.TotalPagesCount()) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.PageNumber(pn + <span class="hljs-number"><span class="hljs-number">1</span></span>); } }, back: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pn = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.PageNumber(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pn &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.PageNumber(pn - <span class="hljs-number"><span class="hljs-number">1</span></span>); } } } };</code> </pre><br><br>  And the actual view of the filter panel: <br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"FiltrationPanel"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="xml"><span class="xml"> Age from </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"3"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">data-bind</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"value: AgeFrom"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> to </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"3"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">data-bind</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"value: AgeTo"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">br</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">label</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"checkbox"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">data-bind</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"checked: ShowMale"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">Show male</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">label</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">br</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">label</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"checkbox"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">data-bind</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"checked: ShowFemale"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">Show female</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">label</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-bind</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"template: { name: 'FiltrationPanel', data: filterParams }"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  And we need to support our dependentObservable a bit: <br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">ko</span></span>.dependentObservable(function () { var <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> = ko.utils.unwrapObservable(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filterParams</span></span></span><span class="hljs-class">); // </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Dependent</span></span></span><span class="hljs-class"> observable will react only on page number change. </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">.pageNumber = this.paging.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PageNumber</span></span></span><span class="hljs-class">(); $.ajax({ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">url</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">url</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">: '</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">POST</span></span></span><span class="hljs-class">', </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">context</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">success</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">function</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rows</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Data</span></span></span><span class="hljs-class">); </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">paging</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PageNumber</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Paging</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PageNumber</span></span></span><span class="hljs-class">); </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">paging</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TotalPagesCount</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Paging</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TotalPagesCount</span></span></span><span class="hljs-class">); } }); }, this); ko.dependentObservable(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">function</span></span></span><span class="hljs-class"> () { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">var</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ko</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">toJS</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filterParams</span></span></span><span class="hljs-class">); // </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Reset</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">page</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">number</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">when</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">any</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">filtration</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">parameters</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">change</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">paging</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PageNumber(1)</span></span></span><span class="hljs-class">; }, this);</span></span></code> </pre><br><br>  <s>A little explanation is needed here.</s>  <s>String <i>var data = ko.toJS (this.filterParams);</i></s>  <s>gets a JS object from the filterParams field, and the values ‚Äã‚Äãof all observables are obtained.</s>  <s>Thus, KO will recalculate our dependentObservable if any filter condition is changed.</s>  <s>I also added a second dependentObservable, which will reset the current page number to 1 when filtering conditions change.</s>  <s>Thus, when changing filters, we must request the first page.</s> <br><br>  In fact, in a strikethrough paragraph, the decision was made that led to two requests to the server when the filter conditions changed.  The first was caused by the change itself, the second - by setting pageNumber to one.  To correct the situation, we fixed the line <br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = ko.toJS(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.filterParams);</code> </pre><br>  on <br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = ko.utils.unwrapObservable(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.filterParams);</code> </pre><br><br>  In this <i>unwrapObservable</i> will give the same result as the <i>toJS</i> method, except that dependentObservable will be recalculated when <i>filterParams</i> changes. <br><br>  Thus, only the change of the page number initiates a request to the server, and it can be caused by switching pages or by changing filter conditions. <br><br>  Also, when we receive a response from the server, we update the values ‚Äã‚Äãin the paging field in case the number of pages or the current number has changed (for example, we have requested page 10, and there are only 5 of them). <br><br>  In fact, we have already decided the task we have set ourselves.  However, I propose to abstract a bit from it and think.  We solved quite a specific task.  But our ViewModel almost does not know about the task itself.  She knows only about the URL, where to get the data and filtering options.  Everything.  This means that our code can be made reusable.  I will turn our viewModel into a class with url and filtrationParams arguments: <br><br><pre> <code class="hljs actionscript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> AjaxGridViewModel = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(url, filterParams)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rows= ko.observableArray(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.filterParams = filterParams; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.paging = { PageNumber: ko.observable(<span class="hljs-number"><span class="hljs-number">1</span></span>), TotalPagesCount: ko.observable(<span class="hljs-number"><span class="hljs-number">0</span></span>), next: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pn = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.PageNumber(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pn &lt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.TotalPagesCount()) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.PageNumber(pn + <span class="hljs-number"><span class="hljs-number">1</span></span>); }, back: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pn = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.PageNumber(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pn &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.PageNumber(pn - <span class="hljs-number"><span class="hljs-number">1</span></span>); } }; ko.dependentObservable(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data = ko.utils.unwrapObservable(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.filterParams); <span class="hljs-comment"><span class="hljs-comment">// Dependent observable will react only on page number change. data.pageNumber = this.paging.PageNumber(); $.ajax({ url: url, type: 'POST', data: data, context: this, success: function (data) { this.rows(data.Data); this.paging.PageNumber(data.Paging.PageNumber); this.paging.TotalPagesCount(data.Paging.TotalPagesCount); } }); }, this); ko.dependentObservable(function () { var data = ko.toJS(this.filterParams); // Reset page number when any filtration parameters change this.paging.PageNumber(1); }, this); };</span></span></code> </pre><br><br>  All this code takes exactly 39 lines.  If we recall the title, we are left alone to initialize: <br><pre> <code class="hljs cs">ko.applyBindings(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AjaxGridViewModel(<span class="hljs-string"><span class="hljs-string">'/Ajax/List'</span></span>, { ShowMale: ko.observable(<span class="hljs-literal"><span class="hljs-literal">true</span></span>), ShowFemale: ko.observable(<span class="hljs-literal"><span class="hljs-literal">true</span></span>), AgeFrom: ko.observable(), AgeTo: ko.observable() });</code> </pre><br><br>  As you can see, the whole picture spoils the second argument.  Instead of writing an object in one line, let's think about the nature of it.  Actually, this is a copy-paste of the <i>FilterParams</i> object <i>described</i> in C #.  Its fields are used only in View, and in ViewModel we obviously do not explicitly use them.  This allows us to select this class from our ViewModel. <br><br>  In this example, I used ASP.NET MVC.  And I solved this problem very simply: <br><pre> <code class="hljs pgsql">C#: <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> ActionResult <span class="hljs-keyword"><span class="hljs-keyword">Index</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">View</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> FilterParams()); } CSHTML: ko.applyBindings(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> AjaxGridViewModel(<span class="hljs-string"><span class="hljs-string">'@Url.Action("List")'</span></span>, @Html.ToJSON(Model)))</code> </pre><br><br>  That is, I simply pass an instance of the class with default filtering settings to View, and View serializes it into a JS object.  Thus, we have simplified the task of supporting the code.  There remains only one uncompiled place where this object is used - template FiltrationPanel. <br><br>  But that's not all.  Initially, the <i>filtrationParams</i> field contained observable values.  And now we fed him a simple JS object.  We need to wrap all the fields of this object in ko.observable ().  For this there is a plugin <a href="http://knockoutjs.com/documentation/plugins-mapping.html">ko.mapping</a> . <br><br>  We use this plugin in the second line of our class AjaxGridViewModel: <br><br><pre> <code class="hljs actionscript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> AjaxGridViewModel = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(url, filterParams)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rows= ko.observableArray(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.filterParams = ko.mapping.fromJS(filterParams); ...</code> </pre><br><br>  This is exactly all. <br><br>  And now why was it even necessary when there is a jqGrid and others.  The bottom line is that these are all heavyweight controls adapted for displaying tables.  They have a lot of opportunities, but they are quite narrowly focused.  And we created a reusable viewModel and an absolutely lightweight view.  We can use tables, lists, anything.  However, only the server code and html knows what data is displayed.  And that is flexibility.  We got a handy tool for displaying data with filtering and leafing pages.  It is not enough code and we will fully understand how it works.  Great, isn't it? <br><br>  Thanks to everyone who mastered the article.  I hope it was interesting and useful.  If you are interested, you can download the source code of the final version of the example on ASP.NET MVC 3 via <a href="http://bit.ly/oA9OEc">this link</a> . <br><br>  Thanks again for your attention.  I will be glad to questions and constructive criticism. <br><br>  <b>UPDATE</b> : fixed a problem with two requests to the server when filtering conditions changed. </div><p>Source: <a href="https://habr.com/ru/post/125148/">https://habr.com/ru/post/125148/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../125139/index.html">Giant claw for a game a la crane machine with Ardunio controller</a></li>
<li><a href="../125142/index.html">Trojan changes numbers in online banking</a></li>
<li><a href="../125144/index.html">Catch good luck with Radmin: a contest for system administrators!</a></li>
<li><a href="../125145/index.html">Innovative laboratory comments on the information that officials will be taken from iPad</a></li>
<li><a href="../125147/index.html">Asterisk + UniMRCP + VoiceNavigator. Synthesis and speech recognition in Asterisk. Part 2</a></li>
<li><a href="../125150/index.html">Fast Automated Installation of Ruby on Rails on IIS 7</a></li>
<li><a href="../125151/index.html">Java SE 7 Released</a></li>
<li><a href="../125152/index.html">Windows.Git.Cygwin.SSH.Gitolite and User Guide</a></li>
<li><a href="../125153/index.html">Symform offers to exchange 150gb local disk for 100gb cloud storage</a></li>
<li><a href="../125154/index.html">Microbash</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>