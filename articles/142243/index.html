<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How would I do BusyIndicator</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In response to a recent post about BusyIndicator decided to share his experience / vision of this problem. The article presents, in my opinion, a simp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How would I do BusyIndicator</h1><div class="post__text post__text-html js-mediator-article">  In response to a recent post about BusyIndicator decided to share his experience / vision of this problem.  The article presents, in my opinion, a simpler implementation of the employment control indicator.  Now anyone can take advantage of ready-made products from venerable developer offices, but the problem of "Leaky Abstraction" at the same time becomes very relevant.  The use of ready-made indicators in an unnatural way for them inevitably leads to disastrous results.  Therefore, it is very important to present "how it works." <br><a name="habracut"></a><br><h4>  Otma3ka </h4><br><ul><li>  <s>w</s> Kodil, being inspired by the next post about " <a href="http://habrahabr.ru/post/141731/">BusyIndicator</a> " </li><li>  In a fit of fierce enthusiasm, wrote the code without thinking about the "Best Practice Guides" </li><li>  Actually, it was interesting how well I learned the lessons and update my internal " <a href="http://designingwebinterfaces.com/wrong-way-ux">10k Clock</a> " </li><li>  Due to the aforementioned and catastrophic lack of time, the code does not shine with elegance </li><li>  Also, the code is not universal;  it may be difficult to embed it into an existing application architecture. </li><li>  But simply and clearly (to me at least), and most importantly [hehe] there is no REFLECTION [/ hehe] </li></ul><br><br><h4>  Formulation of the problem </h4><br>  So <s>yes, but ...</s> given: <br><ul><li>  The main window, which houses some form of data entry <br><img src="https://habrastorage.org/storage2/525/b07/98e/525b0798e098bde656ec8fd7061dd0a7.png"></li><li>  The form in the window is an instance of the <b><i>BaseAdornableControl</i></b> class <b><i>: UserControl</i></b> (or successor), which has the property <b><i>public BusyAdorner BusyAdorner</i></b> </li><li>  In the setter of this property, a busy indicator is attached / detached. </li><li>  The DataContext of the main window is assigned an instance value of the demo ViewModel (‚Äúand we will call this variable <s>Pi with a dearie</s> ‚Äú <b><i>SimpleBusyAdornerDemoViewModel</i></b> ) </li><li>  ViewModel has a single Bulin property IsBusy and instead of an event of changing this property there is an Action [bool] </li><li>  I didn‚Äôt bother with the event for simplicity (I didn‚Äôt want to declare an additional class for the handler and its argument) </li><li>  The logic is: when changing the value of IsBusy, <b><i>Action [bool] IsBusyChanged is jerked</i></b> with the new value of IsBusy as an argument </li><li>  Subscribing to <b><i>Action [bool] IsBusyChanged exhibits a</i></b> value for the <b><i>BaseAdornableControl BusyAdorner</i></b> property of the <b><i>BaseAdornableControl</i></b> instance either in <b>null</b> (detach the adapter) or in a non-null value (attach the adapter) </li><li>  Again, for simplicity, I put a button in the window that inverts the <b><i>IsBusy</i></b> value in the ViewModel, but WE KNOW THAT THE ViewModel MUST BE WITH YOU, for example, when sending a request to a web service and receiving a response </li></ul><br><br><h4>  Main window </h4><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Window</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MyBusyAdorner.MainWindow"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:views</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"clr-namespace:MyBusyAdorner.Views"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:adorners</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"clr-namespace:MyBusyAdorner.Adorners"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MainWindow"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"350"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"525"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.RowDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Auto"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.RowDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">views:BaseAdornableControl</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AdornableControl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BusyAdorner</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{x:Null}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"15"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Attach/Detach"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Button_Click"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Window</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows.Controls; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows.Data; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows.Documents; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows.Input; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows.Media; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows.Media.Imaging; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows.Navigation; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows.Shapes; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> MyBusyAdorner.ViewModels; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> MyBusyAdorner.Adorners; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">MyBusyAdorner</span></span> { <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Interaction logic for MainWindow.xaml </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> public partial class MainWindow : Window { private SimpleBusyAdornerDemoViewModel _viewModel; public MainWindow() { InitializeComponent(); DataContext = _viewModel = new SimpleBusyAdornerDemoViewModel(); _viewModel.IsBusyChanged = new Action</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;bool&gt;</span></span></span><span class="hljs-comment">((newValue) =&gt; { AttachDetachBusyAdorner(newValue); }); } private void AttachDetachBusyAdorner(bool isBusy) { AdornableControl.BusyAdorner = isBusy ? new BusyAdorner(AdornableControl) : null; } private void Button_Click(object sender, RoutedEventArgs e) { _viewModel.IsBusy = !_viewModel.IsBusy; } } }</span></span></code> </pre><br>  It's simple.  In the window is the form that we want to mark.  Under it is a button that changes the value of the <b><i>IsBusy</i></b> property in the ViewModel.  As I already wrote, this button imitates the beginning and end of work of a certain task (asynchronous).  How the logic of interaction between the asynchronous task and the ViewModel is implemented is not important in this case.  We will assume that the <a href="http://msdn.microsoft.com/en-us/library/dd460717.aspx">TPL</a> library has been used (by the way, this is my macDonnalds - 'cause I'm Lovin it ...).  In the designer of the main window, the subscription to the Action is modified <b><i>IsBusy</i></b> .  In this case, there is only one handler, so I can use Action.  Otherwise, it would not be possible to do without a delegate.  So, in the handler, the <b><i>BusyAdorner</i></b> value of <b><i>AdornableControl</i></b> : null is set to detach the indicator, not null to attach. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Busyadorner </h4><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows.Documents; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows.Media; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">MyBusyAdorner.Adorners</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">BusyAdorner</span></span> : <span class="hljs-title"><span class="hljs-title">Adorner</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BusyAdorner</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">UIElement adornedElement</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">adornedElement</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnRender</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DrawingContext drawingContext</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> adornedControl = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.AdornedElement <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> FrameworkElement; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (adornedControl == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; Rect rect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rect(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>, adornedControl.ActualWidth, adornedControl.ActualHeight); <span class="hljs-comment"><span class="hljs-comment">// Some arbitrary drawing implements. SolidColorBrush renderBrush = new SolidColorBrush(Colors.Green); renderBrush.Opacity = 0.2; Pen renderPen = new Pen(new SolidColorBrush(Colors.Navy), 1.5); double renderRadius = 5.0; double dist = 15; double cntrX = rect.Width / 2; double cntrY = rect.Height / 2; double left = cntrX - dist; double right = cntrX + dist; double top = cntrY - dist; double bottom = cntrY + dist; // Draw four circles near to center. drawingContext.PushTransform(new RotateTransform(45, cntrX, cntrY)); drawingContext.DrawEllipse(renderBrush, renderPen, new Point { X = left, Y = top}, renderRadius, renderRadius); drawingContext.DrawEllipse(renderBrush, renderPen, new Point { X = right, Y = top }, renderRadius, renderRadius); drawingContext.DrawEllipse(renderBrush, renderPen, new Point { X = right, Y = bottom }, renderRadius, renderRadius); drawingContext.DrawEllipse(renderBrush, renderPen, new Point { X = left, Y = bottom }, renderRadius, renderRadius); } } }</span></span></code> </pre><br>  It is understood that this is a kind of "twist", <s>generating terrible memorials</s> indicating the employment of the ViewModel.  In this case, the picture will be static, but for the rotational dynamics there is not enough timer to update the angle of the <b><i>RotateTransform</i></b> .  Here you can give free rein to the animation.  You can, by the way, use the same TASK from the TPL to smoothly change the angle of rotation of the pattern (HMM ... Task as <a href="http://habrahabr.ru/post/136878/">Game Loop? You have to try!</a> ). <br>  So, it will look like this: <br><img src="https://habrastorage.org/storage2/976/087/d50/976087d505a59358d0af14dc599838e6.png"><br>  Not God knows what, but as a demonstration of the concept will come down. <br><br><h4>  BaseAdornableControl </h4><br><pre> <code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!--    ... ..     --&gt;</span></span></code> </pre><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows.Controls; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows.Data; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows.Documents; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows.Input; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows.Media; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows.Media.Imaging; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows.Navigation; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows.Shapes; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> MyBusyAdorner.Adorners; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">MyBusyAdorner.Views</span></span> { <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Interaction logic for BaseAdornableControl.xaml </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> public partial class BaseAdornableControl : UserControl { #region [Fields] //private List</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;Adorner&gt;</span></span></span><span class="hljs-comment"> _adorners = new List</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;Adorner&gt;</span></span></span><span class="hljs-comment">(); private BusyAdorner _busyAdorner; #endregion [/Fields] #region [Properties] public BusyAdorner BusyAdorner { get { return _busyAdorner; } set { DetachBusyAdorner(); _busyAdorner = value; if (value != null) { AttachBusyAdorner(); } } } private void AttachBusyAdorner() { if (_busyAdorner == null) return; var adornerLayer = AdornerLayer.GetAdornerLayer(this); adornerLayer.Add(_busyAdorner); } private void DetachBusyAdorner() { var adornerLayer = AdornerLayer.GetAdornerLayer(this); if (adornerLayer != null &amp;&amp; _busyAdorner != null) { adornerLayer.Remove(_busyAdorner); } } #endregion [/Properties] public BaseAdornableControl() { InitializeComponent(); this.Unloaded += new RoutedEventHandler(BaseAdornableControl_Unloaded); } void BaseAdornableControl_Unloaded(object sender, RoutedEventArgs e) { DetachBusyAdorner(); } } }</span></span></code> </pre><br>  <b>Important note</b> .  Before unloading the control wrapped in the adorner, it is necessary, away from sin (memory leaks), to disconnect the adorner.  The logic of the AdornerLayer is quite complex, and with a loss of vigilance you can ogresti.  In general, I warned you ... <br><br><h4>  SimpleBusyAdornerDemoViewModel </h4><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.ComponentModel; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">MyBusyAdorner.ViewModels</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SimpleBusyAdornerDemoViewModel</span></span> : <span class="hljs-title"><span class="hljs-title">INotifyPropertyChanged</span></span> { <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> [Fields] private bool _isBusy; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> [/Fields] #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> [Properties] public bool IsBusy { get { return _isBusy; } set { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (value != _isBusy) { _isBusy = value; RaisePropertyChanged("IsBusy"); RaiseIsBusyChanged(); } } } public Action&lt;bool&gt; IsBusyChanged { get; set; } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> [/Properties] #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> [Private Methods] private void RaiseIsBusyChanged() { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (IsBusyChanged != null) { IsBusyChanged(_isBusy); } } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> [/Private Methods] #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> [INotifyPropertyChanged] public event PropertyChangedEventHandler PropertyChanged; private void RaisePropertyChanged(string propertyName) { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (PropertyChanged != null) { PropertyChanged(this, new PropertyChangedEventArgs(propertyName)); } } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> [/INotifyPropertyChanged] } }</span></span></code> </pre><br>  Nothing special for those familiar with the MVVM pattern, except ‚ÄúWTF-code‚Äù with Action instead of <b><i>event</i></b> . <br><br><h4>  Additional feature - BusyAdornerManager </h4><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.ObjectModel; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> MyBusyAdorner.Adorners; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows.Documents; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">MyBusyAdorner.Services</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">BusyAdornerManager</span></span> { <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> [Fieds] private List&lt;BusyAdorner&gt; _adorners; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> [/Fieds] #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> [Public Methods] public void AddBusyAdorner(UIElement adornedElement) { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (adornedElement == null) return; var adorner = new BusyAdorner(adornedElement); _adorners.Add(adorner); } public void RemoveAllAdorners(UIElement adornedElement) { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (adornedElement == null) return; var adornerLayer = AdornerLayer.GetAdornerLayer(adornedElement); foreach (var adorner in adornerLayer.GetAdorners(adornerLayer)) { adornerLayer.Remove(adorner); } } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> [/Public Methods] #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> Singleton private static volatile BusyAdornerManager instance; private static object syncRoot = new Object(); private BusyAdornerManager() { } public static BusyAdornerManager Instance { get { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (instance == null) { lock (syncRoot) { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (instance == null) instance = new BusyAdornerManager(); } } return instance; } } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> } }</span></span></code> </pre><br>  This is a service designed to facilitate the hanging of adorners on arbitrary controls.  Kakulka too, it was possible to make it not a singleton, but simply a static class, but there is no list of adrenners there. <br><h4>  Conclusion </h4><br>  To spread on git or else where I don‚Äôt see the point, and I don‚Äôt want to, frankly, bother with such a trifle.  For me this post is a snippet, an attempt to bring thoughts / knowledge in order, as well as a ticket to the ‚Äúhabreview board‚Äù.  But maybe <i>someone</i> will be useful.  So we criticize on health, but let's not talk about ‚Äúcode-style-guides‚Äù without holivars ... OK? <br><br><h4>  <b>UPD</b> </h4><br>  To the question <b>of the overhead of inheritance</b> ... View for a form is generally a UserControl.  Is it possible to write in XAML, for example, UserControlEx or the same BaseAdornableControl instead of UserControl - a big overhead? <br><br>  To the question <b>of using the pure MVVM approach</b> ... It is easy to add to the BaseAdornableControl DependencyProperty and knit it to the IsBusy ViewModel'and.  In the handler for changing this property, do the same that I have specified outside.  This is much safer than building crutches with reflex to the internal property of the ‚Äú3rd Party‚Äù product.  Who knows what third-party developers will think to change inside themselves? <br><br>  To the question <b>of binding the adorner directly to the ViewModel property</b> ... As I wrote in the comment, you will have to have a DependencyProperty in it, and for this you need to inherit the Adorner from Framework Element, for example.  And just this will be a very serious overhead, especially if the adner is constantly in memory. <br>  For interest, look for the Visifire code.  Or at least SNOOP'om walk on the tree BarChart'a.  There, for each bar in the chart, one or two intermediate canvases are created.  In addition, DataPoint is inherited from FrameworkElement, either to have the opportunity to bind DataPoint to something, or to set the <b>Color</b> property (which, by the way, is not Color, but Brush).  And the joke is that not these DataPoint'y, they are FrameworkElement'y, end up on the canvas in the chart.  On them another collection of FrameworkElements is created anew, which is drawn.  As a result, the Visifire charts are starting to slow down already on 600+ elements.  For comparison: Dynamic Data Display -&gt; Line Chart -&gt; 60k elements (especially with smooth graphics) -&gt; is normally drawn. <br>  So, the decision to directly bind the adrenners to the ViewModel will just lead to a completely unnecessary overhead. <br><br><h4>  UPD2 </h4><br>  On the <b>use of <a href="http://wpftoolkit.codeplex.com/wikipage%3Ftitle%3DBusyIndicator%26referringTitle%3DHome">the ToolKit indicator</a></b> ... <br>  There are comments ... read.  For example, the code: <br><pre> <code class="cs hljs">BackgroundWorker worker = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BackgroundWorker(); worker.DoWork += (o, ea) =&gt; { <span class="hljs-comment"><span class="hljs-comment">//long-running-process code System.Threading.Thread.Sleep(10000); DispatchService.Dispatch((Action)(() =&gt; { //update the UI code goes here // ... })); }; worker.RunWorkerCompleted += (o, ea) =&gt; { this.ResetIsBusy(); //here the BusyIndicator.IsBusy is set to FALSE }; this.SetIsBusy(); //here the BusyIndicator.IsBusy is set to TRUE worker.RunWorkerAsync();</span></span></code> </pre><br>  The indicator presented there is essentially a specialized dialogue designed to notify the user about the progress of the asynchronous task.  This dialog is done alone for the entire window / application.  The indicator presented here can be hung to each control separately, without fear of large memory consumption.  Just different categories. </div><p>Source: <a href="https://habr.com/ru/post/142243/">https://habr.com/ru/post/142243/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../142238/index.html">ZFConf 2010: How It Was (video reports)</a></li>
<li><a href="../142239/index.html">1C products - service, sale from Infors</a></li>
<li><a href="../142240/index.html">SVG stacks</a></li>
<li><a href="../142241/index.html">Optimization of flatpages project on django under the minimum system requirements. Joke article</a></li>
<li><a href="../142242/index.html">Compression without loss of information. Part one</a></li>
<li><a href="../142244/index.html">Do you really want to use the cancel button in your apps?</a></li>
<li><a href="../142245/index.html">Visual monitoring of a large number of objects (for example, IPTV channels) using Arduino</a></li>
<li><a href="../142247/index.html">The Pirate Bay: and .torrent files have not gone anywhere</a></li>
<li><a href="../142248/index.html">Media Piracy in Developing Economies</a></li>
<li><a href="../142249/index.html">Domain.RUS application filed with ICANN</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>