<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using Lisp in Production</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At Grammarly, the core of our business - the central language engine - is written in Common Lisp. Now the engine processes more than a thousand senten...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using Lisp in Production</h1><div class="post__text post__text-html js-mediator-article">  At Grammarly, the core of our business - the central language engine - is written in Common Lisp.  Now the engine processes more than a thousand sentences per second, it scales horizontally and reliably serves us in production for almost 3 years. <br><br>  We noticed that there are almost no posts about deploying Lisp software in a modern cloud infrastructure, so we decided that sharing our experience would be a good idea.  The runtime and Lisp programming environment provide several unique, somewhat unusual, possibilities for supporting production systems (for the impatient, they are described in the last part). <br><br><h4>  Wut Lisp? !! </h4><br><img src="https://habrastorage.org/files/d37/fa5/6ef/d37fa56ef80e48e09778c89bd1e2732d.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Contrary to popular belief, Lisp is an incredibly practical language for creating production systems.  In general, there are a lot of Lisp-systems around us: when you search for a ticket to Hipmunk or go to the subway in London, Lisp programs are used. <br><a name="habracut"></a><br>  Our Lisp services conceptually represent a classic AI application that functions on a huge amount of knowledge created by linguists and researchers.  Its main resource used is the CPU, and it is one of the largest consumers of computing resources in our network. <br><br>  The system runs on ordinary Linux images deployed in AWS.  We use <a href="http://sbcl.org/">SBCL</a> for production and <a href="http://www.clozure.com/clozure-cl.html">CCL</a> on most developers' machines.  One of the nice moments when using Lisp is that you have a choice of several well-developed implementations with different pros and cons: in our case, we optimized the speed of the server and the compilation speed when developing (why this is critical for us is described later). <br><br><h4>  A stranger in a strange land </h4><br><img src="https://habrastorage.org/files/a58/1e3/79f/a581e379f9104d7d8a763583a51b98b9.jpg"><br><br>  At Grammarly, we use a variety of programming languages ‚Äã‚Äãto develop our services: in addition to languages ‚Äã‚Äãfor JVM and Javascript, we also write in Erlang, Python, and Go.  Proper encapsulation of services allows us to use the language or platform that is best suited for the task.  This approach has a certain price to maintain, but we value choice and freedom more than rules and patterns. <br><br>  We also try to rely on simple, non-language, infrastructure utilities.  This approach frees us from many problems in integrating this whole zoo technology into our platform.  For example, statsd is an excellent example of an incredibly simple and useful service that is very easy to use.  The other is Graylog2, it provides a smart <a href="https://www.graylog.org/resources/gelf-2/">specification</a> for logging, and despite the fact that there was no ready-made library to work with from CL, it was very easy to assemble from what is available in the Lisp ecosystem.  Here is all the code you need (and almost all of it is just word for word translation of the specification): <br><br><pre><code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">defun</span></span> graylog (<span class="hljs-name"><span class="hljs-name">message</span></span> <span class="hljs-symbol"><span class="hljs-symbol">&amp;key</span></span> level backtrace file line-no) (<span class="hljs-name"><span class="hljs-name">let</span></span> ((<span class="hljs-name"><span class="hljs-name">msg</span></span> (<span class="hljs-name"><span class="hljs-name">salza2</span></span><span class="hljs-symbol"><span class="hljs-symbol">:compress-data</span></span> (<span class="hljs-name"><span class="hljs-name">babel</span></span><span class="hljs-symbol"><span class="hljs-symbol">:string-to-octets</span></span> (<span class="hljs-name"><span class="hljs-name">json</span></span><span class="hljs-symbol"><span class="hljs-symbol">:encode-json-to-string</span></span> #{ <span class="hljs-symbol"><span class="hljs-symbol">:version</span></span> <span class="hljs-string"><span class="hljs-string">"1.0"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:facility</span></span> <span class="hljs-string"><span class="hljs-string">"lisp"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:host</span></span> *hostname* :|short_message| message :|full_message| backtrace <span class="hljs-symbol"><span class="hljs-symbol">:timestamp</span></span> (<span class="hljs-name"><span class="hljs-name">local-time</span></span><span class="hljs-symbol"><span class="hljs-symbol">:timestamp-to-unix</span></span> (<span class="hljs-name"><span class="hljs-name">local-time</span></span><span class="hljs-symbol"><span class="hljs-symbol">:now</span></span>)) <span class="hljs-symbol"><span class="hljs-symbol">:level</span></span> level <span class="hljs-symbol"><span class="hljs-symbol">:file</span></span> file <span class="hljs-symbol"><span class="hljs-symbol">:line</span></span> line-no }) <span class="hljs-symbol"><span class="hljs-symbol">:encoding</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:utf-8</span></span>) 'salza2<span class="hljs-symbol"><span class="hljs-symbol">:zlib-compressor</span></span>))) (<span class="hljs-name"><span class="hljs-name">usocket</span></span><span class="hljs-symbol"><span class="hljs-symbol">:socket-send</span></span> (<span class="hljs-name"><span class="hljs-name">usocket</span></span><span class="hljs-symbol"><span class="hljs-symbol">:socket-connect</span></span> *graylog-host* *graylog-port* <span class="hljs-symbol"><span class="hljs-symbol">:protocol</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:datagram</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:element-type</span></span> '(unsigned-byte <span class="hljs-number"><span class="hljs-number">8</span></span>)) msg (<span class="hljs-name"><span class="hljs-name">length</span></span> msg))))</code> </pre> <br>  The lack of libraries in the ecosystem is one of the frequent complaints about Lisp.  As you can see, 5 libraries are used only in this example for such things as encoding, compression, Unix-time retrieval and connection socket. <br><br>  Lisp libraries do exist, but, as with all library integrations, we run into problems.  For example, to connect Jenkins CI, we had to use xUnit and it was not very easy to find specifications for it.  Fortunately, one <a href="http://stackoverflow.com/questions/442556/spec-for-junit-xml-output">question on Stackoverflow helped</a> - in the end, we built it into our own test library <a href="">should-test</a> . <br><br>  Another example is using <a href="https://www.hdfgroup.org/HDF5/">HDF5</a> to exchange machine learning models: we spent some time adapting the <a href="https://github.com/HDFGroup/hdf5-cffi">hdf5-cffi</a> low-level library to our realities, but we had to spend much more time updating our AMI (Amazon Machine Image) to support the current version of the C library. <br><br>  Another principle that we follow in the Grammarly platform is the maximum decomposition of various services to ensure horizontal scalability and functional independence - this is <a href="http://tech.grammarly.com/blog/posts/Decoupling-A-Monolithic-Server-Application.html">my colleague's post</a> .  Thus, we do not need to interact with databases in critical parts of our language core services.  However, we use MySQL, Postgres, Redis, and Mongo for internal storage, and we successfully used <a href="http://clsql.b9.com/">CLSQL</a> , <a href="http://marijnhaverbeke.nl/postmodern/">postmodern</a> , <a href="https://github.com/vseloved/cl-redis">cl-redis,</a> and <a href="https://github.com/fons/cl-mongo">cl-mongo</a> to access them from Lisp. <br><br>  We use <a href="https://www.quicklisp.org/">Quicklisp</a> to manage external dependencies and a simple library source packaging system with a project for our own libraries and forks.  The Quicklisp repository contains more than 1000 Lisp libraries: not a super huge number, but quite sufficient to meet all the needs of our production. <br><br>  For deployment in production, we use a universal stack: the application is tested and assembled using <b>Jenkins</b> , delivered to the server thanks to <b>Rundeck</b> and launched there via <b>Upstart</b> as a normal Unix process. <br><br>  In general, the problems we face when integrating Lisp applications into the cloud world do not radically differ from those that we see in many other technologies.  If you want to use Lisp in production and enjoy writing Lisp code, there is no real technical reason not to do this! <br><br><h4>  The hardest bug I've ever debugged </h4><br><img src="https://habrastorage.org/files/bc7/3a4/01a/bc73a401a9eb43e6835ba0f09bc79fca.jpg"><br><br>  However ideal this story may be, not everything is just about rainbows and unicorns. <br><br>  We created an esoteric application (even by the standards of the Lisp-world) and in the process rested on some of the limitations of the platform.  One such surprise was the exhaustion of memory at compile time.  We rely heavily on macros, and the largest of them are expanded into thousands of lines of low-level code.  It turned out that the SBCL compiler implements many optimizations, thanks to which we can enjoy fairly fast generated code, but some of them require exponential time and memory.  Unfortunately, there is no way to turn them off or adjust them.  Despite this, there is a well-known general solution, <a href="http://random-state.net/log/3390120648.html">the call-with- * style</a> , which allows you to sacrifice a little efficiency for the sake of better modularity (which turned out to be decisive in our case) and debugging. <br><br>  Adjusting the garbage collector to reduce delays and improve resource utilization in our system turned out to be a less unexpected problem, unlike taming the compiler.  SBCL provides a generation-based garbage collector, although not as sophisticated as the JVM.  We had to adjust the size of generations and it turned out that the use of a larger heap was the best option: our application consumes 2-4 gigabytes of memory, but we launched it with a heap of 25G, which automatically increased the size of the first generation.  Another setting we had to make, much less obvious, was the launch of GC programmatically every N minutes.  With an increased heap, we noticed a gradual increase in memory usage over periods of tens of minutes, which is why more and more time was spent on GC and application performance decreased.  Our approach with periodic GC brought the system to a more stable state with almost constant memory consumption.  On the left, you can see how the system is executed without our settings, and on the right, the effect of a periodic GC. <br><br><img src="https://habrastorage.org/files/582/695/810/582695810356425f86b6190abd12d6d8.jpg"><br><br>  Of all these difficulties, the most unpleasant bug I encountered was a network bug.  As usually happens in such situations, the bug was not in the application, but in the <a href="http://lisp-univ-etc.blogspot.com/2013/04/errors-in-your-platform.html">underlying platform</a> (this time - SBCL).  And, moreover, I ran into it twice in two different services, but for the first time I could not calculate it, so I had to go around it. <br><br>  When we first started the launch of our service at significant workloads in production, after some time of normal operation, all the servers suddenly began to slow down and eventually became unavailable.  After a lengthy investigation with suspicion of input data, we found that the problem was in the race in the low-level SBCL network code, specifically in the way that the function of the socket was <a href="http://www.lehman.cuny.edu/cgi-bin/man-cgi%3Fgetprotobyname">called getprotobyname</a> , which was not thread-safe.  It was a very unlikely race, so it only showed itself in a high-load network service, when this function was called tens of thousands of times.  It knocked out one workflow after another, gradually introducing the system into a coma. <br><br>  Here is the fix on which we stopped, unfortunately, it cannot be used in a wider context as a library.  (The bug was sent to the SBCL team and was fixed, but we still use this hack, just in case :) <br><br><pre> <code class="lisp hljs">#+unix (<span class="hljs-name"><span class="hljs-name">defun</span></span> sb-bsd-sockets<span class="hljs-symbol"><span class="hljs-symbol">:get-protocol-by-name</span></span> (<span class="hljs-name"><span class="hljs-name">name</span></span>) (<span class="hljs-name"><span class="hljs-name">case</span></span> (<span class="hljs-name"><span class="hljs-name">mkeyw</span></span> name) (<span class="hljs-symbol"><span class="hljs-symbol">:tcp</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>) (<span class="hljs-symbol"><span class="hljs-symbol">:udp</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>)))</code> </pre><br><br><h4>  Back to the future </h4><br><img src="https://habrastorage.org/files/8a1/834/ab1/8a1834ab197145e2a931863a4ce52a52.jpg"><br><br>  Common Lisp systems implement many of the ideas of legendary Lisp machines.  One of the most outstanding is the interactive environment of SLIME.  While the industry is expecting the ripening of LightTable and similar tools, Lisp programmers have been quietly enjoying these features in SLIME for many years.  Behold the power of this to the teeth of an armed and functioning combat station <a href="https://www.youtube.com/playlist%3Flist%3DPL2VAYZE_4wRKKr5pJzfYD1w4tKCXARs5y">in action</a> . <br><br>  But SLIME is not just Lisp's approach to IDE.  Being a client-server application, it allows you to run your backend on a remote machine and connect to it from your local Emacs (or Vim, if you have no choice, with SLIMV).  Java programmers may think about JConsole, but here you are not constrained by a predefined set of operations and can make any introspection or change that you want.  We could not catch the race in the socket function without these features. <br><br>  Moreover, the remote console is not the only useful utility provided by SLIME.  Like many IDEs, it can go into the source code of functions, but unlike Java or Python, I have SBCL source code on my machine, so I often look at the source code for the implementation, and this helps a lot in studying what is happening. ‚Äù under the hood. "  For the case of a socket bug, this was also an important part of the debugging process. <br><br>  Finally, another super useful utility for introspection and debug, which we use is <a href="http://clhs.lisp.se/Body/m_tracec.htm">TRACE</a> .  It completely changed my approach to debugging programs, now instead of tedious code execution step by step, I can analyze the whole picture.  This tool also helped us localize our socket bug. <br><br>  With <b>trace,</b> you specify a function to trace, execute code, and Lisp prints all calls to this function and its arguments and all the results it returns.  It's something like a stack stack, but you don't need a full stack and you dynamically get a stream of traces without stopping the application.  <b>A trace</b> is like a <b>print</b> on steroids, which allows you to quickly get into the insides of a code of any complexity and track complex paths for executing a program.  Its only drawback is that you cannot traverse macros. <br><br>  Here is a fragment of the trace that I made literally today to make sure that a JSON request to one of our services is formed correctly and returns the desired result: <br><br><pre> <code class="lisp hljs"><span class="hljs-number"><span class="hljs-number">0</span></span>: (<span class="hljs-name"><span class="hljs-name">GET-DEPS</span></span> (<span class="hljs-string"><span class="hljs-string">"you think that's bad, hehe, i remember once i had an old 100MHZ dell unit i was using as a server in my room"</span></span>)) <span class="hljs-number"><span class="hljs-number">1</span></span>: (<span class="hljs-name"><span class="hljs-name">JSON</span></span><span class="hljs-symbol"><span class="hljs-symbol">:ENCODE-JSON-TO-STRING</span></span> #&lt;HASH-TABLE <span class="hljs-symbol"><span class="hljs-symbol">:TEST</span></span> EQL <span class="hljs-symbol"><span class="hljs-symbol">:COUNT</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> {<span class="hljs-number"><span class="hljs-number">1037</span></span>DD9383}&gt;) <span class="hljs-number"><span class="hljs-number">2</span></span>: (<span class="hljs-name"><span class="hljs-name">JSON</span></span><span class="hljs-symbol"><span class="hljs-symbol">:ENCODE-JSON-TO-STRING</span></span> <span class="hljs-string"><span class="hljs-string">"action"</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span>: JSON:ENCODE-JSON-TO-STRING returned <span class="hljs-string"><span class="hljs-string">"\"action\""</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: (<span class="hljs-name"><span class="hljs-name">JSON</span></span><span class="hljs-symbol"><span class="hljs-symbol">:ENCODE-JSON-TO-STRING</span></span> <span class="hljs-string"><span class="hljs-string">"sentences"</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span>: JSON:ENCODE-JSON-TO-STRING returned <span class="hljs-string"><span class="hljs-string">"\"sentences\""</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: JSON:ENCODE-JSON-TO-STRING returned <span class="hljs-string"><span class="hljs-string">"{\"action\":\"deps\",\"sentences\":[\"you think that's bad, hehe, i remember once i had an old 100MHZ dell unit i was using as a server in my room\"]}"</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: GET-DEPS returned (((<span class="hljs-string"><span class="hljs-string">"nsubj"</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) (<span class="hljs-string"><span class="hljs-string">"ccomp"</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-string"><span class="hljs-string">"nsubj"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) (<span class="hljs-string"><span class="hljs-string">"ccomp"</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) (<span class="hljs-string"><span class="hljs-string">"acomp"</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) (<span class="hljs-string"><span class="hljs-string">"punct"</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) (<span class="hljs-string"><span class="hljs-string">"intj"</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>) (<span class="hljs-string"><span class="hljs-string">"punct"</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>) (<span class="hljs-string"><span class="hljs-string">"nsubj"</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>) (<span class="hljs-string"><span class="hljs-string">"root"</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span>) (<span class="hljs-string"><span class="hljs-string">"advmod"</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>) (<span class="hljs-string"><span class="hljs-string">"nsubj"</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>) (<span class="hljs-string"><span class="hljs-string">"ccomp"</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>) (<span class="hljs-string"><span class="hljs-string">"det"</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span>) (<span class="hljs-string"><span class="hljs-string">"amod"</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span>) (<span class="hljs-string"><span class="hljs-string">"nn"</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span>) (<span class="hljs-string"><span class="hljs-string">"nn"</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>) (<span class="hljs-string"><span class="hljs-string">"dobj"</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>) (<span class="hljs-string"><span class="hljs-string">"nsubj"</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>) (<span class="hljs-string"><span class="hljs-string">"aux"</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span>) (<span class="hljs-string"><span class="hljs-string">"rcmod"</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>) (<span class="hljs-string"><span class="hljs-string">"prep"</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span>) (<span class="hljs-string"><span class="hljs-string">"det"</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span>) (<span class="hljs-string"><span class="hljs-string">"pobj"</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span>) (<span class="hljs-string"><span class="hljs-string">"prep"</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span>) (<span class="hljs-string"><span class="hljs-string">"poss"</span></span> <span class="hljs-number"><span class="hljs-number">26</span></span> <span class="hljs-number"><span class="hljs-number">25</span></span>) (<span class="hljs-string"><span class="hljs-string">"pobj"</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">26</span></span>))) ((<span class="hljs-name"><span class="hljs-name">&lt;you</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>&gt; &lt;think <span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">9</span></span>&gt; &lt;that <span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">14</span></span>&gt; &lt;'s <span class="hljs-number"><span class="hljs-number">14</span></span>,<span class="hljs-number"><span class="hljs-number">16</span></span>&gt; &lt;bad <span class="hljs-number"><span class="hljs-number">17</span></span>,<span class="hljs-number"><span class="hljs-number">20</span></span>&gt; &lt;, <span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">21</span></span>&gt; &lt;hehe <span class="hljs-number"><span class="hljs-number">22</span></span>,<span class="hljs-number"><span class="hljs-number">26</span></span>&gt; &lt;, <span class="hljs-number"><span class="hljs-number">26</span></span>,<span class="hljs-number"><span class="hljs-number">27</span></span>&gt; &lt;i <span class="hljs-number"><span class="hljs-number">28</span></span>,<span class="hljs-number"><span class="hljs-number">29</span></span>&gt; &lt;remember <span class="hljs-number"><span class="hljs-number">30</span></span>,<span class="hljs-number"><span class="hljs-number">38</span></span>&gt; &lt;once <span class="hljs-number"><span class="hljs-number">39</span></span>,<span class="hljs-number"><span class="hljs-number">43</span></span>&gt; &lt;i <span class="hljs-number"><span class="hljs-number">44</span></span>,<span class="hljs-number"><span class="hljs-number">45</span></span>&gt; &lt;had <span class="hljs-number"><span class="hljs-number">46</span></span>,<span class="hljs-number"><span class="hljs-number">49</span></span>&gt; &lt;an <span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-number"><span class="hljs-number">52</span></span>&gt; &lt;old <span class="hljs-number"><span class="hljs-number">53</span></span>,<span class="hljs-number"><span class="hljs-number">56</span></span>&gt; &lt;100MHZ <span class="hljs-number"><span class="hljs-number">57</span></span>,<span class="hljs-number"><span class="hljs-number">63</span></span>&gt; &lt;dell <span class="hljs-number"><span class="hljs-number">64</span></span>,<span class="hljs-number"><span class="hljs-number">68</span></span>&gt; &lt;unit <span class="hljs-number"><span class="hljs-number">69</span></span>,<span class="hljs-number"><span class="hljs-number">73</span></span>&gt; &lt;i <span class="hljs-number"><span class="hljs-number">74</span></span>,<span class="hljs-number"><span class="hljs-number">75</span></span>&gt; &lt;was <span class="hljs-number"><span class="hljs-number">76</span></span>,<span class="hljs-number"><span class="hljs-number">79</span></span>&gt; &lt;using <span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">85</span></span>&gt; &lt;as <span class="hljs-number"><span class="hljs-number">86</span></span>,<span class="hljs-number"><span class="hljs-number">88</span></span>&gt; &lt;a <span class="hljs-number"><span class="hljs-number">89</span></span>,<span class="hljs-number"><span class="hljs-number">90</span></span>&gt; &lt;server <span class="hljs-number"><span class="hljs-number">91</span></span>,<span class="hljs-number"><span class="hljs-number">97</span></span>&gt; &lt;in <span class="hljs-number"><span class="hljs-number">98</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>&gt; &lt;my <span class="hljs-number"><span class="hljs-number">101</span></span>,<span class="hljs-number"><span class="hljs-number">103</span></span>&gt; &lt;room <span class="hljs-number"><span class="hljs-number">104</span></span>,<span class="hljs-number"><span class="hljs-number">108</span></span>&gt;))</code> </pre><br>  So, to debug our horrible socket bug, I had to dig deep into the SBCL network code and examine the functions being called, then connect via SLIME to the dying server and try to trace these functions one by one.  And when I received a call that did not return - that was it.  As a result, after finding out in the manual that the function is not thread-safe and that I encountered several mentions about this in the comments of the SBCL source code, I was convinced of my hypothesis. <br><br>  This article is about the fact that Lisp proved to be a surprisingly reliable platform for one of our most critical projects.  It fully complies with the general requirements of a modern cloud infrastructure, and despite the fact that this stack is not very well known and popular, it has its strengths - you only need to learn how to use them.  What can we say about the power of the Lisp-approach to solving complex problems, for which we love him so much.  But this is a completely different story ... <br><br>  <i>Note</i>  <i>translator:</i> <br>  I am doubly glad that people from the CIS write about the use of Common Lisp in production, and even people from the CIS write, because we have practically no experience with this stack.  I hope after reading this article, someone will pay attention to this very undervalued technology. </div><p>Source: <a href="https://habr.com/ru/post/262225/">https://habr.com/ru/post/262225/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262195/index.html">Multiboot in wysiwyg editor</a></li>
<li><a href="../262207/index.html">Telnet and echo - who is right, who is wrong</a></li>
<li><a href="../262211/index.html">Deploying Qt Applications on Windows</a></li>
<li><a href="../262213/index.html">Analysis of tonality in social media in Russian using the RussianSentimentAnalyzer API</a></li>
<li><a href="../262221/index.html">Customize the build of a Flex 4.14 project using flexmojos 7. *</a></li>
<li><a href="../262229/index.html">Geolocation plus mobile communications and the updated AltegroCloud API</a></li>
<li><a href="../262231/index.html">We test Jet9 - fault-tolerant hosting sites with geographic optimization</a></li>
<li><a href="../262233/index.html">VirtualBox 5.0 release</a></li>
<li><a href="../262235/index.html">We write our simplified OpenGL on Rust - part 3 (rasterizer)</a></li>
<li><a href="../262239/index.html">Critical way of rendering web pages</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>