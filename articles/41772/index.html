<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Server validation of user data</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good time, habrocheloveki! 
 I would like to raise the topic of server validation of user data. Searching on Habr√© topics of this subject and googling...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Server validation of user data</h1><div class="post__text post__text-html js-mediator-article"><h1>  Good time, habrocheloveki! </h1><br>  I would like to raise the topic of server validation of user data.  Searching on Habr√© topics of this subject and googling, I came to the conclusion that people often invent their own bikes to implement the validation mechanism.  In this article I want to talk about a simple and beautiful solution that has been successfully used in several projects. <br><a name="habracut"></a><br><h1>  Problem </h1><br>  I often notice that developers are actively using exceptions to report data validation errors.  I will demonstrate with an example (since C # is closer to me, I will use it): <br><blockquote><code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">void</font> Validate( <font color="#0000ff">string</font> userName, <font color="#0000ff">string</font> userPassword) <br> { <br> <font color="#0000ff">if</font> ( <font color="#008000">/*  */</font> ) <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> InvalidUsernameException(); <br> <font color="#0000ff">if</font> ( <font color="#008000">/* */</font> ) <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> InvalidPasswordException(); <br> }</font></code> </blockquote> <br>  Further it is used like this: <br><blockquote> <code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">void</font> RegisterUser ( <font color="#0000ff">string</font> username, <font color="#0000ff">string</font> password) { <br> <font color="#0000ff">try</font> { <br> ValidateUser(username, password); <br> } <br> <br> <font color="#0000ff">catch</font> (InvalidUsernameException ex) { <br> <font color="#008000">//   </font> <br> } <br> <br> <font color="#0000ff">catch</font> (InvalidPasswordException ex) { <br> <font color="#008000">//   </font> <br> } <br> <br> <font color="#008000">//-  </font> <br> }</font> <br></code> </blockquote><br>  <b>What is wrong with this example?</b> <br>  - exceptions are used at the business validation stage.  It is important to remember that data validation errors! = Application errors; <br>  - the use of exceptions at the stage of business validation may lead to the fall of the application.  This can happen, for example, if a person forgets to write another <font color="#0000ff">catch block</font> for new validation rules; <br>  - the code looks ugly; <br>  - this solution is difficult to test and maintain. <br><br><h1>  Decision </h1><br>  The mechanism of data validation can be implemented using the <a href="http://ru.wikipedia.org/wiki/Composite">Composite</a> pattern <a href="http://ru.wikipedia.org/wiki/Composite">(linker)</a> . <br>  We will need the actual object itself a validator, which directly checks the data for compliance with certain rules, a composite validator that encapsulates a collection of validators, as well as an additional class used in <br>  as the repository of the validation result and error collection - <b>ValidationResult</b> .  Consider the last one first: <br><blockquote> <code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> ValidationResult{ <br> <font color="#0000ff">private</font> <font color="#0000ff">bool</font> isSucceedResult = <font color="#0000ff">true</font> ; <br> <font color="#0000ff">private</font> <font color="#0000ff">readonly</font> <font color="#2B91AF">List</font> &lt;ResultCode&gt; resultCodes = <font color="#0000ff">new</font> <font color="#2B91AF">List</font> (); <br> <br> <font color="#0000ff">protected</font> ValidationResult() { <br> } <br> <br> <font color="#0000ff">public</font> ValidationResult(ResultCode code) { <br> isSucceedResult = <font color="#0000ff">false</font> ; <br> resultCodes.Add(code); <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> ValidationResult SuccessResult { <br> <font color="#0000ff">get</font> { <font color="#0000ff">return</font> <font color="#0000ff">new</font> ValidationResult(); } <br> } <br> <br> <font color="#0000ff">public</font> <font color="#2B91AF">List</font> &lt;ResultCode&gt; GetResultCodes { <br> <font color="#0000ff">get</font> { <font color="#0000ff">return</font> resultCodes; } <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">bool</font> IsSucceed { <br> <font color="#0000ff">get</font> { <font color="#0000ff">return</font> isSucceedResult; } <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> AddError(ResultCode code) { <br> isSucceedResult = <font color="#0000ff">false</font> ; <br> resultCodes.Add(code); <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> Merge(ValidationResult result) { <br> resultCodes.AddRange(result.resultCodes); <br> isSucceedResult &amp;= result.isSucceedResult; <br> } <br> }</font> <br></code> </blockquote><br>  We now go directly to the validation mechanism.  We need to create a base class <b>Validator</b> , from which all validators will be inherited: <br><blockquote> <code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">abstract</font> <font color="#0000ff">class</font> Validator { <br> <font color="#0000ff">public</font> <font color="#0000ff">abstract</font> ValidationResult Validate(); <br> }</font></code> </blockquote> <br>  For validator objects there is 1 method that starts the verification procedure and returns the result. <br><br>  <b>CompositeValidator</b> is a class containing a collection of validators and a triggering mechanism for checking all child objects: <br><blockquote> <code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> CompositeValidator : Validator { <br> <font color="#0000ff">private</font> <font color="#0000ff">readonly</font> <font color="#2B91AF">List</font> &lt;Validator&gt; validators = <font color="#0000ff">new</font> <font color="#2B91AF">List</font> (); <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> Add(Validator validator) { <br> validators.Add(validator); <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> Remove(Validator validator) { <br> validators.Remove(validator); <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> ValidationResult Validate() { <br> ValidationResult result = ValidationResult.SuccessResult; <br> <font color="#0000ff">foreach</font> (Validator validator <font color="#0000ff">in</font> validators) { <br> result.Merge(validator.Validate()); <br> } <br> <font color="#0000ff">return</font> result; <br> } <br> } <br> <br></font></code> </blockquote><br>  Using these classes, we were able to create validators with specific rules, combine them and get the test results. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <br><h1>  Using </h1><br>  We will rewrite the example given at the beginning of the article using this mechanism.  In our case, we need to create 2 validators that check the username and password for compliance with certain rules. <br>  Create an object to check the username <b>UserNameValidator</b> : <br><blockquote> <code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> UserNameValidator: Validator { <br> <font color="#0000ff">private</font> <font color="#0000ff">readonly</font> <font color="#0000ff">string</font> userName; <br> <br> <font color="#0000ff">public</font> UserNameValidator( <font color="#0000ff">string</font> userName) { <br> <font color="#0000ff">this</font> .userName= userName; <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> ValidationResult Validate() { <br> <font color="#0000ff">if</font> ( <font color="#008000">/*     ,  userName = null*/</font> ) { <br> <font color="#0000ff">return</font> <font color="#0000ff">new</font> ValidationResult(ResultCode.UserNameIncorrect); <br> } <br> <br> <font color="#0000ff">return</font> ValidationResult.SuccessResult; <br> } <br> } <br></font> <br></code> </blockquote><br>  Similarly, we get the <b>UserPasswordValidator</b> . <br><br>  Now we have everything to use the new data validation mechanism: <br><blockquote> <code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">ValidationResult</font> ValidateUser( <font color="#0000ff">string</font> userName, <font color="#0000ff">string</font> userPassword) <br> { <br> CompositeValidator validator = <font color="#0000ff">new</font> CompositeValidator(); <br> validator.add( <font color="#0000ff">new</font> UserNameValidator(userName)); <br> validator.add( <font color="#0000ff">new</font> UserPasswordValidator(userPassword)); <br> <br> <font color="#0000ff">return</font> validator.Validate(); <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> RegisterUser ( <font color="#0000ff">string</font> username, <font color="#0000ff">string</font> password) { <br> ValidationResult result = ValidateUser(username, password); <br> <br> <font color="#0000ff">if</font> (result.IsSucceed) { <br> <font color="#008000">// </font> <br> } <br> <br> <font color="#0000ff">else</font> { <br> <font color="#008000">//   result.GetResultCodes()    </font> <br> } <br> <br> }</font> <br></code> </blockquote><br><h1>  findings </h1><br>  <b>What advantages have we gained using this approach:</b> <br>  - extensibility.  Adding new validators is cheap; <br>  - testability.  All validators can be modularly tested, which eliminates errors in the overall validation process; <br>  - maintainability.  Validators can be separated into a separate assembly and used in many projects with minor modifications; <br>  - beauty and correctness.  This code looks prettier, sleeker and more correct, of the original version, exceptions are not used for business validation. <br><br><h1>  Conclusion </h1><br>  <b>In the future, you can apply several improvements to the validation mechanism, namely:</b> <br>  - encapsulate all validators in one assembly and create a factory that will return a ready-made validation mechanism for various conditions (validation of data for user registration, verification of data upon authorization, etc.); <br>  - The base class Validator can be replaced by the interface, as you like; <br>  - Validation rules can be stored in one place, for more convenient management; <br>  - You can write a validation error handler that will match the error codes and messages displayed to users on the UI, in this case, the process of adding new validators is further simplified.  Also, there is no problem localizing messages. <br><br><h1>  PS </h1><br>  Please do not kick for possible mistakes in spelling and presentation.  I tried very hard) <br>  I am pleased to hear criticism and suggestions about the implementation and architecture. <br><br><blockquote>  <font color="gray">* All source code was highlighted with <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"><font color="gray">Source Code Highlighter</font></a> .</font> </blockquote></div><p>Source: <a href="https://habr.com/ru/post/41772/">https://habr.com/ru/post/41772/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../417709/index.html">Where and how do developers rate their employers? Services assessment companies in the IT industry</a></li>
<li><a href="../41771/index.html">Lightsaber for wii</a></li>
<li><a href="../417711/index.html">What to read on Swift in Russian?</a></li>
<li><a href="../417715/index.html">Goodbye google maps</a></li>
<li><a href="../417717/index.html">What was the Earth like when it was as hot on it as promised in 2100?</a></li>
<li><a href="../417721/index.html">Graphic processors in solving modern IT problems</a></li>
<li><a href="../417723/index.html">Using the KOMPAS-3D API ‚Üí Lesson 11 ‚Üí Simple Text Labels</a></li>
<li><a href="../417725/index.html">How ‚ÄúFlant‚Äù Hires Employees</a></li>
<li><a href="../417727/index.html">Blue Origin has returned to Earth and reusable level, and the crew capsule</a></li>
<li><a href="../417729/index.html">The Intel Core i7-8086K (Part 2)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>