<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Documentation for the mod_xml_radius module from FreeSWITCH</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Delving into the network, I did not find the documentation. The task is to configure this module, so that later it can be transferred to support. Acco...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Documentation for the mod_xml_radius module from FreeSWITCH</h1><div class="post__text post__text-html js-mediator-article">  Delving into the network, I did not find the documentation.  The task is to configure this module, so that later it can be transferred to support.  Accordingly, the source code was studied and the text below was written.  I hope he will help someone.  The text is written so that it would be clear already working with FreeSWITCH.  Therefore, I advise you not to start acquaintance with FreeSWITCH from this text. <br><a name="habracut"></a><br>  Separately, I want to note that some (very small) changes were made to the source code of the module, in more detail at the end of the publication. <br><br>  The module at the moment (10/14/2014) has practically no documentation.  All the fabrications below have been obtained on the basis of the fact of studying the sources, thematic mailing lists and documentation residues (including the change history) <a href="https://wiki.freeswitch.org/wiki/Mod_xml_radius">wiki.freeswitch.org/wiki/Mod_xml_radius</a> . <br><br>  Debug does not turn on from the console (why - HZ, did not understand).  To include it in the module configuration file, an example of which comes with the source code, add a section: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">global</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"debug"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"7"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">global</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  The value can be any other than 0 (checked as a Boolean variable). <br><br>  If in the configuration file of the module such sections are defined as: auth_invite and auth_reg (in the initial module only the presence of the auth_invite section is checked and the parameters are loaded and they are obviously not normal, very similar to the author‚Äôs copy-paste and forgot to change the variable name in two places), then the module bindit processing requests for the global configuration section <pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"xml-handler-bindings"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"directory"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre>  on its own function of working with events and requests using the standard mod_xml_curl mechanism (see the corresponding documentation on the Frisvich website).  In this case, real work occurs only if the sip_auth_method field of the event being processed is defined and has the value ‚ÄúINVITE‚Äù or ‚ÄúREGISTER‚Äù.  In this case, an XML config is returned to the switch, according to which the switch can authenticate itself. <br><br>  The module fills RADIUS requests according to its own config and the dictionaries supplied in the kit.  Each value of the name of the parameter string is assigned a value from a channel variable (Channel variable) specified by the value of the variable (and if there is no such variable, the value from variable_secondary) in accordance with the format string. <br><br>  The module defines its own handlers for global switch events .on_routing and .on_reporting: <br><br><pre> <code class="cs hljs"><span class="hljs-number"><span class="hljs-number">1135</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> switch_state_handler_table_t state_handlers = { <span class="hljs-number"><span class="hljs-number">1136</span></span> <span class="hljs-comment"><span class="hljs-comment">/*.on_init */</span></span> NULL, <span class="hljs-number"><span class="hljs-number">1137</span></span> <span class="hljs-comment"><span class="hljs-comment">/*.on_routing */</span></span> mod_xml_radius_accounting_start, <span class="hljs-number"><span class="hljs-number">1138</span></span> <span class="hljs-comment"><span class="hljs-comment">/*.on_execute */</span></span> NULL, <span class="hljs-number"><span class="hljs-number">1139</span></span> <span class="hljs-comment"><span class="hljs-comment">/*.on_hangup */</span></span> NULL, <span class="hljs-number"><span class="hljs-number">1140</span></span> <span class="hljs-comment"><span class="hljs-comment">/*.on_exchange_media */</span></span> NULL, <span class="hljs-number"><span class="hljs-number">1141</span></span> <span class="hljs-comment"><span class="hljs-comment">/*.on_soft_execute */</span></span> NULL, <span class="hljs-number"><span class="hljs-number">1142</span></span> <span class="hljs-comment"><span class="hljs-comment">/*.on_consume_media */</span></span> NULL, <span class="hljs-number"><span class="hljs-number">1143</span></span> <span class="hljs-comment"><span class="hljs-comment">/*.on_hibernate */</span></span> NULL, <span class="hljs-number"><span class="hljs-number">1144</span></span> <span class="hljs-comment"><span class="hljs-comment">/*.on_reset */</span></span> NULL, <span class="hljs-number"><span class="hljs-number">1145</span></span> <span class="hljs-comment"><span class="hljs-comment">/*.on_park */</span></span> NULL, <span class="hljs-number"><span class="hljs-number">1146</span></span> <span class="hljs-comment"><span class="hljs-comment">/*.on_reporting */</span></span> mod_xml_radius_accounting_end <span class="hljs-number"><span class="hljs-number">1147</span></span> };</code> </pre><br>  Events are generated at the moment when the channel status changes to ROUTING and REPORTING, respectively.  In the acct_start and acct_end sections of the configuration file, at least one trigger condition (condition) must be defined, otherwise an error is generated when loading the config section (not a fact, you need to check, because the code does not confirm this, this information was found somewhere in network).  These handlers send RADIUS information on these switch events, which are obtained from the channel variables.  Each value of the name of the parameter line of the corresponding section of the configuration file is assigned a value from the channel variable specified by the variable value (and if it is not in the channel variables, then from variable_secondary) in accordance with the format value. <br><br>  In the case of calling radius_auth (an application that can be called from the configuration file), the authorization result in RADIUS is returned (as text): 0 if the authentication is successful, and a negative value (which was returned by RADIUS) if not.  The result of the execution is written to the channel variable radius_auth_result.  Also, if the AV pairs came in the RADIUS response, the application creates and populates the corresponding channel variables <u>without adding the</u> leading radius_ in the variable names (at least I did not find the radius_ addition code). <br><br>  Separately, according to my changes to the source of the module.  They make cosmetic changes in messages debag and correct the fact that IMHO is a misprint of the author.  diff to module in below.  Unfortunately, I can‚Äôt say in which version of the source I work (I‚Äôm not good at using git).  At the time of writing, the current version of the letter, diff is formed using git diff from the root source folder. <br><br><pre> <code class="diff hljs">diff --git a/src/mod/xml_int/mod_xml_radius/mod_xml_radius.cb/src/mod/xml_int/mod_xml_radius/mod_xml_radius.c index bc75843..94e127a 100644 --- a/src/mod/xml_int/mod_xml_radius/mod_xml_radius.c +++ b/src/mod/xml_int/mod_xml_radius/mod_xml_radius.c @@ -201,7 +201,7 @@ switch_status_t do_config() goto err; } } else { - switch_log_printf(SWITCH_CHANNEL_LOG, SWITCH_LOG_INFO, "Could not find 'auth_invite' section in config file.\n"); + switch_log_printf(SWITCH_CHANNEL_LOG, SWITCH_LOG_INFO, "Could not find 'auth_reg' section in config file.\n"); } if ((tmp = switch_xml_child(cfg, "global")) != NULL ) { @@ -741,7 +741,7 @@ switch_xml_t mod_xml_radius_auth_reg(switch_event_t *params) { switch_log_printf(SWITCH_CHANNEL_LOG, SWITCH_LOG_ERROR, "mod_xml_radius: starting registration authentication\n"); } - if ( mod_xml_radius_new_handle(&amp;new_handle, globals.auth_invite_configs) != SWITCH_STATUS_SUCCESS ) { + if ( mod_xml_radius_new_handle(&amp;new_handle, globals.auth_reg_configs) != SWITCH_STATUS_SUCCESS ) { switch_log_printf(SWITCH_CHANNEL_LOG, SWITCH_LOG_ERROR, "Failed to load radius handle for registration authentication\n"); goto err; } @@ -849,7 +849,7 @@ static switch_xml_t mod_xml_radius_directory_search(const char *section, const c switch_log_printf(SWITCH_CHANNEL_LOG, SWITCH_LOG_ERROR, "mod_xml_radius: starting authentication\n"); switch_event_serialize(params, &amp;event_buf, SWITCH_TRUE); switch_log_printf(SWITCH_CHANNEL_LOG, SWITCH_LOG_ERROR, "Event: %s \n", event_buf); - switch_log_printf(SWITCH_CHANNEL_LOG, SWITCH_LOG_ERROR, "Section: %s \nTag: %s\nKey_name: %s\nKey_value: %s\n", + switch_log_printf(SWITCH_CHANNEL_LOG, SWITCH_LOG_ERROR, "\nSection: %s \nTag: %s\nKey_name: %s\nKey_value: %s\n", section, tag_name, key_name, key_value); } @@ -1087,7 +1087,7 @@ SWITCH_STANDARD_APP(radius_auth_handle) temp = NULL; if ( result != 0 ) { - switch_log_printf(SWITCH_CHANNEL_LOG, SWITCH_LOG_ERROR, "mod_xml_radius: Failed to authenticate\n"); + switch_log_printf(SWITCH_CHANNEL_LOG, SWITCH_LOG_ERROR, "mod_xml_radius: Failed to authenticate, authentication result: %d \n", result); goto err; } @@ -1169,7 +1169,7 @@ SWITCH_MODULE_LOAD_FUNCTION(mod_xml_radius_load) return SWITCH_STATUS_TERM; } - if ( globals.auth_invite_configs ) { + if ( globals.auth_invite_configs &amp;&amp; globals.auth_reg_configs ) { status = switch_xml_bind_search_function(mod_xml_radius_directory_search, switch_xml_parse_section_string("directory"), NULL); }</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/240339/">https://habr.com/ru/post/240339/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../240325/index.html">Why and how to use data visualization?</a></li>
<li><a href="../240327/index.html">Good practice in symfony 2 (from personal experience)</a></li>
<li><a href="../240329/index.html">25 PHP developers you can subscribe to</a></li>
<li><a href="../240333/index.html">WinJS 3.0 - release for all platforms</a></li>
<li><a href="../240337/index.html">Startup: "Idea", "Implementation", "Sales" ...</a></li>
<li><a href="../240341/index.html">How to search for clients for a small regional web studio</a></li>
<li><a href="../240343/index.html">How Ebean made friends with Gradle and made peace with IntelliJ Idea</a></li>
<li><a href="../240345/index.html">New 0day vulnerability in Windows is exploited in-the-wild</a></li>
<li><a href="../240347/index.html">Why do business hackathons?</a></li>
<li><a href="../240349/index.html">Expressive JavaScript: Functions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>