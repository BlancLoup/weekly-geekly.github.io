<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Is your favorite C so fast or the native implementation of linear algebra on D</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A library like OpenBLAS (Basic Linear Algebra Subprograms) is well known to those involved in machine learning systems and computer vision. OpenBLAS i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Is your favorite C so fast or the native implementation of linear algebra on D</h1><div class="post__text post__text-html js-mediator-article">  A library like OpenBLAS (Basic Linear Algebra Subprograms) is well known to those involved in machine learning systems and computer vision.  OpenBLAS is written in C and is used everywhere where work with matrices is needed.  It also has several alternative implementations such as Eigen and two closed implementations from Intel and Apple.  All of them are written in C / C ++. <br><br>  Currently, OpenBLAS is used in matrix manipulations in languages ‚Äã‚Äãsuch as Julia and Python (NumPy).  OpenBLAS is extremely well optimized and much of it is generally <a href="">written</a> in assembly language. <br><br>  However, is pure C so good for computing, as is commonly believed? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Meet <a href="http://code.dlang.org/packages/mir">Mir GLAS</a> !  Native implementation of the library of linear algebra on pure D without a single insert in an assembler! <br><a name="habracut"></a><br>  To compile the Mir GLAS library we need an <a href="https://github.com/ldc-developers/ldc">LDC</a> compiler (LLVM D Compiler).  The DMD compiler is not officially supported.  It does not support AVX and AVX2 instructions. <br><br>  Test configuration will consist of: <br><table><tbody><tr><td>  CPU </td><td>  2.2 GHz Core i7 (I7-4770HQ) </td></tr><tr><td>  L3 cache </td><td>  6 MB </td></tr><tr><td>  Ram </td><td>  16 GB of 1600 MHz DDR3L SDRAM </td></tr><tr><td>  Model Identifier </td><td>  MacBookPro11,2 </td></tr><tr><td>  OS </td><td>  OS X 10.11.6 </td></tr><tr><td>  Mir GLAS </td><td>  0.18.0, single thread </td></tr><tr><td>  Openblas </td><td>  0.2.18, single thread </td></tr><tr><td>  Eigen </td><td>  3.3-rc1, single thread (sequential configurations) </td></tr><tr><td>  Intel MKL </td><td>  2017.0.098, single thread (sequential configurations) </td></tr><tr><td>  Apple accelerate </td><td>  OS X 10.11.6, single thread (sequential configurations) </td></tr></tbody></table><br>  ¬ªThe code of the test itself can be obtained <a href="">here</a> . <br>  ¬ªMir GLAS based on <a href="https://habrahabr.ru/post/277715/">mir.ndslice</a> library <br><br>  Mir GLAS can be easily used in any language that supports C ABI.  This is done elementary: <br><br><pre><code class="hljs objectivec"><span class="hljs-comment"><span class="hljs-comment">// Performs: c := alpha axb + beta c // glas is a pointer to a GlasContext glas.gemm(alpha, a, b, beta, c);</span></span></code> </pre> <br>  For comparison, OpenBLAS will need to write the following code: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cblas_sgemm</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> CBLAS_LAYOUT layout, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> CBLAS_TRANSPOSE TransA, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> CBLAS_TRANSPOSE TransB, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> M, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> N, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> K, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> alpha, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *A, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> lda, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *B, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ldb, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> beta, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *C, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ldc)</span></span></span></span></code> </pre><br>  During the test, the following values ‚Äã‚Äãof variables were established: <br><table><tbody><tr><td>  openBLAS </td><td>  OPENBLAS_NUM_THREADS = 1 </td></tr><tr><td>  Accelerate (Apple) </td><td>  VECLIB_MAXIMUM_THREADS = 1 </td></tr><tr><td>  Intel MKL </td><td>  MKL_NUM_THREADS = 1 </td></tr></tbody></table><br>  Eigen compiled with the flags `EIGEN_TEST_AVX` and` EIGEN_TEST_FMA`: <br><br><pre> <code class="hljs pgsql">mkdir build_dir cd build_dir cmake -DCMAKE_BUILD_TYPE=<span class="hljs-keyword"><span class="hljs-keyword">Release</span></span> -DEIGEN_TEST_AVX=<span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> -DEIGEN_TEST_FMA=<span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> .. make OpenBLAS</code> </pre> <br>  Results (more is better): <br><br><img src="https://habrastorage.org/files/33e/525/97d/33e52597d7384a57b3ceee7dbfa6d546.png"><br><img src="https://habrastorage.org/files/d52/2ea/451/d522ea45104649afa844946be05973b7.png"><br><img src="https://habrastorage.org/files/399/18b/f12/39918bf129654a788fdd1a304c2c8423.png"><br><img src="https://habrastorage.org/files/1fa/a37/d91/1faa37d9183d4febaf3ba471fe892f1c.png"><br><img src="https://habrastorage.org/files/02a/3eb/53c/02a3eb53c85c4e2692117fdaa6ebf406.png"><br><img src="https://habrastorage.org/files/b07/cff/8e9/b07cff8e9269473fbb3d53634a1b52b8.png"><br><img src="https://habrastorage.org/files/e53/891/e0a/e53891e0a8cf478b82bae8e2b85203c7.png"><br><img src="https://habrastorage.org/files/10a/d72/1a3/10ad721a3e304ce2bfc54819034e86ee.png"><br><br>  Results: <br><br>  - Mir GLAS significantly ahead of OpenBLAS and Apple Accelerate in all respects. <br>  - Mir GLAS is almost twice as fast as Eigen and Apple Accelerate when working with matrices. <br>  ‚ÄúMir GLAS turns out to be comparable to proprietary Intel MKL, which is the fastest of its kind. <br>  ‚ÄúThanks to its design, Mir GLAS can easily be adapted for new architectures. <br><br>  <b>PS</b> At the moment, the computer vision system <a href="https://github.com/ljubobratovicrelja/dcv">DCV is</a> actively developing on the basis of GLAS. <br><br>  PPS The original author is present in the comments under the nickname <b>9il</b> <br><br>  The original article is located on the <a href="http://blog.mir.dlang.io/glas/benchmark/openblas/2016/09/23/glas-gemm-benchmark.html">author‚Äôs</a> blog. </div><p>Source: <a href="https://habr.com/ru/post/311568/">https://habr.com/ru/post/311568/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../311556/index.html">DDoS attacks and protection against them - how much does it cost Russian companies?</a></li>
<li><a href="../311558/index.html">AI Cradle</a></li>
<li><a href="../311560/index.html">Shared pointers and multithreading. And again about them, again</a></li>
<li><a href="../311562/index.html">Microcircuits from different sides: Nanometer ASIC, MIPSfpga and Connected MCU workshops in Russia, Ukraine and Kazakhstan</a></li>
<li><a href="../311566/index.html">Dot the ss</a></li>
<li><a href="../311572/index.html">"Write letters": Three techniques of layout of good emails</a></li>
<li><a href="../311574/index.html">Techleads Meetup in Badoo</a></li>
<li><a href="../311576/index.html">The history of creating an application for finding nannies in Ireland and an electronic waiter</a></li>
<li><a href="../311578/index.html">Processing voice requests in Telegram using Yandex SpeechKit Cloud</a></li>
<li><a href="../311580/index.html">New management features: Intel RealSense and GestureWorks Fusion</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>