<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Object-Global Mapping or "ORM for globals." Direct Access with the Cach√© Globals Proxy Framework</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Imagine the task: given the GlobalsDB or Cach√© dataset with their notorious globals; It is necessary to provide means of direct access GlobalsAPI, so ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Object-Global Mapping or "ORM for globals." Direct Access with the Cach√© Globals Proxy Framework</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/b4a/321/9d3/b4a3219d355a4b5e986bc5596340d43a.png"><br><br>  Imagine the task: given the GlobalsDB or Cach√© dataset with their notorious globals;  It is necessary to provide means of direct access GlobalsAPI, so that in nodes of a global type ‚Äú^ n (‚Äú Japan ‚Äù,‚Äú Yamato ‚Äù) = $ lb (‚Äú R.Keanu ‚Äù, 1000)" 0 to n;  the second indexes are the names of the ships, also with restrictions.  And the values ‚Äã‚Äãfor these indices would be the names of the captains and the number of their subordinates, of course, also with restrictions. <br><br>  Immediately I will inform you that it is impossible to do this only with GlobalsAPI.  Cach√© GlobalsProxy Framework offers a fast and versatile solution for such tasks.  By combining Object-Globals Mapping (OGM) technology with GlobalsAPI methods, it is possible to process global data using objects (proxy classes) representing global nodes in the same way as ORM to relational databases - using objects representing tables. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Cach√© GlobalsProxy Framework main features: <br><ol><li>  Means of creating descriptions of data structures and their limitations (metadata) of the global. </li><li>  Automated data validation. </li><li>  Generating proxy classes based on metadata. </li><li>  CRUD operations on data in the global using proxy classes. </li></ol><br>  All of this should generally increase the speed of development of software products that imply the use of GlobalsAPI for direct access to the globals of the GlobalsDB and Cach√© databases. <br><br><div class="spoiler">  <b class="spoiler_title">For entry into the topic, I recommend to get acquainted with:</b> <div class="spoiler_text">  <a href="https://habrahabr.ru/company/intersystems/blog/228869/">habrahabr.ru/company/intersystems/blog/228869</a> - Intersystems Cach√©: Globals API for .NET <br>  <a href="https://habrahabr.ru/company/intersystems/blog/184882/">habrahabr.ru/company/intersystems/blog/184882</a> GlobalsDB is a universal NoSQL database. <br>  <a href="https://habrahabr.ru/company/intersystems/blog/263791/">habrahabr.ru/company/intersystems/blog/263791</a> Globals - quads swords for data storage. </div></div><br><h4>  Problematics </h4><br>  When working with high-performance GlobalsAPI directly with globals, there is no need for metadata for them - this provides the extreme flexibility of data storage and reduces the cost of processor time for validation. <br><br>  However, the fact that the availability of metadata is not necessary does not negate the fact that they are present in one form or another and, naturally, they must be taken into account.  Also, at the moment there are no generally accepted rules for the organization of global metadata, respectively, developers have to invent their own ways of describing data structures, restrictions, semantics, decide where to store all this and how to work with it in the future. <br><br>  However, even having figured it out, developers will also have to independently validate the data, because GlobalsAPI does not contain methods for processing them with any metadata at all, that is, only using it can lead to a violation of logical integrity. <br><br>  Software development using GlobalsAPI is inconvenient and difficult, therefore, long and expensive.  This can play a crucial role in a situation where it would be possible to sacrifice some of the productivity, but speed up development. <br><br>  The Cach√© GlobalsProxy Framework provides the means to create a global description and, based on it, provides data processing using proxy classes while hiding the GlobalsAPI methods and logic of working with global metadata, in particular automating validation.  All this, with a relatively insignificant loss of productivity, speeds up development many times over. <br><br><h4>  Providing global metadata </h4><br>  In order to be able to validate the data and present the nodes of the global proxy classes, the global description is first needed.  For its storage is intended a specialized global - meta-global.  Thus, data and metadata are stored side by side and accessible using the same API (step towards cross-platform). <br><br>  For the description of the global version of the specification of the meta-global, which has the following form: <div class="spoiler">  <b class="spoiler_title">Meta-global specification:</b> <div class="spoiler_text">  // Under semantics is meant the value / name of the entity in the subject area. <br>  ^ meta = $ lb (&lt;name of the global, the meta information of which is described&gt;, &lt;semantics of the global&gt;) <br>  ^ meta ("Indexes", &lt;index number = 1..N&gt;) = $ lb (&lt;index semantics&gt;, &lt;&lt; type &gt;&gt;) <br><br>  ^ meta (‚ÄúValues‚Äù, &lt;for a node accessible by number of indices = [1; N]&gt;) = $ lb (&lt;semantics of a node&gt;) <br>  ^ meta ("Values", &lt;for the node available by the number of indices = [1; N], &lt;value ‚Ññ = 1..V&gt;) <br>  = $ lb (&lt;semantics of value&gt;, &lt;&lt; type &gt;&gt;) <br><br>  ^ meta (‚ÄúStructs‚Äù, &lt;structure identifier = 1..S&gt;) = $ lb (&lt;structure semantics&gt;) <br>  ^ meta (‚ÄúStructs‚Äù, &lt;for structure with id = [1; S]&gt;, &lt;value ‚Ññ = 1..C&gt;) <br>  = $ lb (&lt;semantics of value&gt;, &lt;&lt; type &gt;&gt;) <br><br>  &lt;&lt; type &gt;&gt; = <br>  &lt;&lt; * string &gt;&gt; = ("string", &lt;maximum length&gt;, &lt;minimum length&gt;, &lt;default&gt;) <br>  &lt;&lt; * integer &gt;&gt; = ("integer", &lt;minimum&gt;, &lt;maximum&gt;, &lt;default&gt;) <br>  &lt;&lt; * valid &gt;&gt; = ("double", &lt;minimum&gt;, &lt;maximum&gt;, &lt;default&gt;) <br>  &lt;&lt; ** structure &gt;&gt; = ("struct", &lt;structure identifier&gt;) <br>  &lt;&lt; list &gt;&gt; = ("list", &lt;&lt; type &gt;&gt;, &lt;minimum of elements&gt;, &lt;maximum of elements&gt;) <br>  &lt;&lt; array of bytes &gt;&gt; = ("byte", &lt;maximum size&gt;) <br><br>  * Is a valid index type. <br>  ** - the structure can be used as an index type, provided that in it and in all structures nested in it, the types allowed for the indexes are contained. </div></div><br>  For example: <br>  Create a meta-global "^ nMeta" describing the global "^ n" with data on the naval forces of the countries: <br><div class="spoiler">  <b class="spoiler_title">Created meta-global</b> <div class="spoiler_text"><table><tbody><tr><td>  ^ nMeta </td><td>  = </td><td>  ("N", "Navies") </td></tr><tr><td>  <i>Or, ‚ÄúnMeta‚Äù describes the global ‚Äún‚Äù, which stores information about Navies.</i> </td></tr><tr><td>  ^ nMeta ("Indexes") </td><td>  = </td><td>  $ lb (3) </td></tr><tr><td>  <i>Or, the number of indices in this global "3"</i> </td></tr><tr><td>  ^ nMeta ("Indexes", 1) </td><td>  = </td><td>  $ lb ("Country", "string", 0,255, "Country") </td></tr><tr><td>  <i>Or, the first global index stores information about ‚ÄúCountry‚Äù, its type is ‚Äústring‚Äù. Similarly:</i> </td></tr><tr><td>  ^ nMeta ("Indexes", 2) </td><td>  = </td><td>  $ lb (‚ÄúShipClass‚Äù, ‚Äústruct‚Äù, ‚ÄúClassification‚Äù) </td></tr><tr><td>  ^ nMeta ("Indexes", 3) </td><td>  = </td><td>  $ lb ("Name", "string", 0.255, "Name") </td></tr><tr><td>  ^ nMeta ("Structs") </td><td>  = </td><td>  $ lb (2) </td></tr><tr><td>  <i>The number of definitions of structures is 2-mind</i> </td></tr><tr><td>  ^ nMeta ("Structs", "Classification") </td><td>  = </td><td>  $ lb (2) </td></tr><tr><td>  <i>Declaring a ‚ÄúClassification‚Äù Structure with 2 Names</i> </td></tr><tr><td>  ^ nMeta ("Structs", "Classification", 1) </td><td>  = </td><td>  $ lb ("ClassType", "string", 0.255, "ClassType") </td></tr><tr><td>  <i>Or, the value ‚Äú1‚Äù of the ‚ÄúClassification‚Äù structure stores information about ‚ÄúClassType‚Äù, its type is ‚Äústring‚Äù. Similarly:</i> </td></tr><tr><td>  ^ nMeta ("Structs", "Classification", 2) </td><td>  = </td><td>  $ lb ("Rank", "integer", 0,10,0) </td></tr><tr><td>  ^ nMeta ("Structs", "ContactInfo") </td><td>  = </td><td>  $ lb (2) </td></tr><tr><td>  ^ nMeta ("Structs", "ContactInfo", 1) </td><td>  = </td><td>  $ lb ("Name", "string", 0,255, "") </td></tr><tr><td>  ^ nMeta ("Structs", "ContactInfo", 2) </td><td>  = </td><td>  $ lb (Phone, Integer, 1111111,9999999,1111111) </td></tr><tr><td>  ^ nMeta ("Values", 1) </td><td>  = </td><td>  $ lb (2, "Manufacturer") </td></tr><tr><td>  <i>Or in the nodes accessible by the number of indexes "1", information is stored on the "Manufacturer" with the number of characteristics "2"</i> </td></tr><tr><td>  ^ nMeta ("Values", 1,1) </td><td>  = </td><td>  $ lb ("Charge", "struct", "ContactInfo") </td></tr><tr><td>  <i>Or at the nodes of level ‚Äú1‚Äù the value number ‚Äú1‚Äù stores information about ‚ÄúCharge‚Äù, type ‚Äústruct‚Äù. Similarly:</i> </td></tr><tr><td>  ^ nMeta ("Values", 1,2) </td><td>  = </td><td>  $ lb ("Ports", "list", "struct", 2, 0.1000) </td></tr><tr><td>  ^ nMeta ("Values", 2) </td><td>  = </td><td>  $ lb ("ShipCounter") </td></tr><tr><td>  ^ nMeta ("Values", 2,1) </td><td>  = </td><td>  $ lb ("Count", "integer", 0.100500.0) </td></tr><tr><td>  ^ nMeta ("Values", 3) </td><td>  = </td><td>  $ lb (‚ÄúShipInfo‚Äù) </td></tr><tr><td>  ^ nMeta ("Values", 3.1) </td><td>  = </td><td>  $ lb ("Captain", "struct", 2) </td></tr><tr><td>  ^ nMeta ("Values", 3.2) </td><td>  = </td><td>  $ lb ("StuffCount", "integer", 1,5000,1) </td></tr><tr><td>  ^ nMeta ("Values", 3.3) </td><td>  = </td><td>  $ lb ("Efficienty", "double", 0,1,0) </td></tr></tbody></table></div></div>  Fill global "^ n" according to the created description: <br><div class="spoiler">  <b class="spoiler_title">Filled global</b> <div class="spoiler_text"><table><tbody><tr><td>  ^ n ("Japan") </td><td>  = </td><td>  $ lb ($ lb (‚ÄúAkihito‚Äù, 1534598), $ lb ($ lb (‚ÄúTokyo‚Äù, 5645122), $ lb (‚ÄúMiaon‚Äù, 645122))) </td></tr><tr><td>  ^ n ("Japan", "Battleship", 3) </td><td>  = </td><td>  $ lb (1) </td></tr><tr><td>  ^ n ("Japan", "Battleship", 3, "Kawachi") </td><td>  = </td><td>  $ lb ($ lb ("IO Jaiodeen", 124234), 999, .7) </td></tr><tr><td>  ^ n ("Japan", "Battleship", 10) </td><td>  = </td><td>  $ lb (1) </td></tr><tr><td>  ^ n ("Japan", "Battleship", 10, "Yamato") </td><td>  = </td><td>  $ lb ($ lb ("LA Myolin", 142323), 2350, .6) </td></tr><tr><td>  ^ n ("Japan", "Carry", 4, "Hosho") </td><td>  = </td><td>  $ lb ($ lb ("AM Harusimo", 134254), 548, .8) </td></tr><tr><td>  ^ n ("Japan", "Carry", 7) </td><td>  = </td><td>  $ lb (1) </td></tr><tr><td>  ^ n ("Japan", "Destroyer", 5, "Hatsuharu") </td><td>  = </td><td>  $ lb ($ lb ("WC Hawanio", 98034), 212, .65) </td></tr><tr><td>  ^ n ("Japan", "Destroyer", 7) </td><td>  = </td><td>  $ lb (1) </td></tr><tr><td>  ^ n ("USA") </td><td>  = </td><td>  $ lb ($ lb ("O.Barack", 1534598), $ lb ($ lb ("NH2", 4568976), $ lb ("MnP1", 987654))) </td></tr><tr><td>  ^ n ("USA", "Carry", 4) </td><td>  = </td><td>  $ lb (1) </td></tr><tr><td>  ^ n ("USA", "Carry", 4, "Langey") </td><td>  = </td><td>  $ lb ($ lb ("RC Adams", 9832723), 521, .65) </td></tr><tr><td>  ^ n ("USA", "Carry", 4, "Saipan") </td><td>  = </td><td>  $ lb ($ lb ("PD Strong", 5234542), 1751, .75) </td></tr><tr><td>  ^ n ("USA", "Carry", 7) </td><td>  = </td><td>  $ lb (1) </td></tr><tr><td>  ^ n (‚ÄúUSA‚Äù, ‚ÄúDestroyer‚Äù, 5) </td><td>  = </td><td>  $ lb (1) </td></tr><tr><td>  ^ n ("USA", "Destroyer", 5, "Nikolas") </td><td>  = </td><td>  $ lb ($ lb ("JC Denton", 5443123), 168, .75) </td></tr><tr><td>  ^ n ("USA", "Destroyer", 6) </td><td>  = </td><td>  $ lb (1) </td></tr><tr><td>  ^ n ("USA", "Destroyer", 6, "Farragut") </td><td>  = </td><td>  $ lb ($ lb ("OC Ohara", 1233422), 195, .8) </td></tr><tr><td>  ^ n ("USA", "Kruiser", 4) </td><td>  = </td><td>  $ lb (1) </td></tr><tr><td>  ^ n ("USA", "Kruiser", 4, "Omaha") </td><td>  = </td><td>  $ lb ($ lb ("PA Jenson", 1342344), 458, .65) </td></tr></tbody></table></div></div><br>  It can be noted that using this variant of the meta-global specification, the structure, semantics and restrictions on the global indexes and values ‚Äã‚Äãare uniquely set, as if it is assumed that the global data structure cannot be stored, thereby losing the storage flexibility.  So it is in some sense, but it is only within the framework of one meta-global ... Nothing prevents to create several meta-globals for the same global. <br><br><h4>  Object Global Mapping </h4><br>  Now that we have provided global metadata, according to OGM technology, the nodes of the global tree must be represented by proxy classes.  So, from the example above, nodes with semantics (ShipInfo), which store values ‚Äã‚Äãabout ships and are available by three indices, will be presented: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ShipInfoProxy</span></span> { <span class="hljs-comment"><span class="hljs-comment">//,    public String Country; public Classification ShipClass; public String Name; //,     public ContactInfo Captain; public Int32 StuffCount; public Double Efficienty; ... } public class ShipInfoProxyKey { //,    public String Country; public Classification ShipClass; public String Name; ... }</span></span></code> </pre> <br>  Each proxy class has its own manager, which is designed to provide CRUD operations with data, while hiding the logic of working with global and metadata (in particular, data validation). <br><br>  The ShipInfoProxy proxy class, in the context of this global, will correspond to the ShipInfoProxyManager &lt;ShipInfoProxy, ShipInfoProxyKey&gt; manager, the general view of which is: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ProxyManager</span></span>&lt;<span class="hljs-title"><span class="hljs-title">ProxyT</span></span>, <span class="hljs-title"><span class="hljs-title">ProxyKeyT</span></span>&gt; <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">ProxyT</span></span> : <span class="hljs-title"><span class="hljs-title">class</span></span> <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">ProxyKeyT</span></span> : <span class="hljs-title"><span class="hljs-title">class</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Validate; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProxyManager</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EntityMeta meta, TrueNodeReference globalRef, List&lt;IStructManager&gt; structsManagers = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ProxyT </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ArrayList keys</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ProxyT </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> key</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ProxyT </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ProxyKeyT key</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;ProxyT&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetAll</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Delete</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ProxyKeyT key</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ProxyT entity</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;ProxyT&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetByKeyMask</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> key</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;ProxyT&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetByKeyMask</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ProxyKeyT key</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre>  Where, captain obvious, as if alluding to us: <br>  <i>void Save (ProxyT entity)</i> - saves or replaces data in the global. <br>  <i>ProxyT Get (ProxyKeyT key)</i> - reads data from the global node by the specified key; <br>  <i>void Delete (ProxyKeyT key)</i> - removes a node from the global by the specified key. <br>  <i>public List &lt;'ProxyT&gt; GetAll ()</i> - reads values ‚Äã‚Äãfrom all nodes; <br>  But this rotation is a special method of data acquisition, which allows to get data from nodes, without specifying some indices of these nodes: <br>  <i>List &lt;'ProxyT&gt; GetByKeyMask (ProxyKeyT key)</i> - reads data from all global nodes whose indexes correspond to the mask specified by the key. <br><br>  All global node managers are accessible from a special context class that is responsible for their initialization: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">NaviesContext</span></span> : <span class="hljs-title"><span class="hljs-title">CacheEXTREMEcontext</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ProxyManager&lt;ManufacturerProxy, ManufacturerProxyKey&gt; ManufacturerManager; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ProxyManager&lt;ShipCounterProxy, ShipCounterProxyKey&gt; ShipCounterManager; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ProxyManager&lt;ShipInfoProxy, ShipInfoProxyKey&gt; ShipInfoManager; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WowsNiceContext</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">InterSystems.Globals.Connection conn</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">conn, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"nMeta"</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ManufacturerManager = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProxyManager&lt;ManufacturerProxy,ManufacturerProxyKey&gt; (<span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.entitiesMeta[<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(ManufacturerProxy).Name], <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.globalRef, <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.structsManagers); ... <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.structsManagers.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StructManager&lt;Classification&gt; (<span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.globalMeta.GetLocalStructs()[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.structsManagers)); ... } }</code> </pre> <br><h4>  Cach√© GlobalsProxy Framework </h4><br>  The Cach√© GlobalsProxy framework consists of the CacheExtremeProxy.dll dynamic link library and a metadata editor utility.  To fully use it, namely to edit the data of the global, you need to do, conditionally, in 3 simple steps: <br><br><h5>  1. Creating Metadata </h5><br>  You can go the hard way, create metadata from the code, using the specially created GlobalMeta class, and then write them to the meta-global: <div class="spoiler">  <b class="spoiler_title">Creating metadata in code</b> <div class="spoiler_text"><pre> <code class="cs hljs">StructValMeta structV = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StructValMeta(<span class="hljs-string"><span class="hljs-string">"ContactInfo"</span></span>, <span class="hljs-string"><span class="hljs-string">" ContactInfo "</span></span> , <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;ValueMeta&gt;(){ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringValMeta(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList(){<span class="hljs-string"><span class="hljs-string">"Name"</span></span>,<span class="hljs-string"><span class="hljs-string">"String"</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>}) ,<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IntValMeta(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList(){<span class="hljs-string"><span class="hljs-string">"Phone"</span></span>,<span class="hljs-string"><span class="hljs-string">"Integer"</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">9999999</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>}) }); GlobalMeta gm = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GlobalMeta(<span class="hljs-string"><span class="hljs-string">"n"</span></span>, <span class="hljs-string"><span class="hljs-string">"Navies"</span></span>); gm.AddStruct(structVal); gm.AddKeyMeta(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringValMeta(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList{<span class="hljs-string"><span class="hljs-string">"Country"</span></span>,<span class="hljs-string"><span class="hljs-string">"String"</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>}),<span class="hljs-string"><span class="hljs-string">"Manufacturer"</span></span>); gm.SetValuesMeta(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;ValueMeta&gt;(){ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StructValMeta (<span class="hljs-string"><span class="hljs-string">"Charge"</span></span>, structV) ,<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ListValMeta(<span class="hljs-string"><span class="hljs-string">"Ports"</span></span>, structV) }); gm.AddKeyMeta(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StructValMeta (<span class="hljs-string"><span class="hljs-string">"ClassInfo"</span></span>, <span class="hljs-string"><span class="hljs-string">"Classification"</span></span> , <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;ValueMeta&gt;(){...}), <span class="hljs-string"><span class="hljs-string">" ClassType"</span></span>); ... <span class="hljs-comment"><span class="hljs-comment">//   - new MetaReaderWriter(dbConnection).SaveMeta(gm);</span></span></code> </pre></div></div><br>  And you can go a simple way, create metadata using the attached auxiliary application of the metadata editor: <br><br><img src="https://habrastorage.org/files/f52/5d3/496/f525d34966e649f5891c2cd159a412d4.jpg"><br><br>  Yes ... there is still "old school" - the way to create a meta-global using COS. <br><br><h5>  2. Generation of context and proxy classes </h5><br>  And again, you can go a relatively complicated way - code.  Fill in a special class GlobalMeta (can be read from a previously created meta-global) and use a special class generator: <div class="spoiler">  <b class="spoiler_title">Generating context from code</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// - GlobalMeta meta = new MetaReader(conn).GetMeta("nMeta"); //   - ContextGenerator gen = new ContextGenerator(meta,"NaviesNamespace","ContextFile.cs"); gen.GenerateCSharpCode();</span></span></code> </pre> </div></div><br>  And you can, all the same, use the auxiliary editor application: <br><br><img src="https://habrastorage.org/files/38b/0f2/c77/38b0f2c779834755aedbac6777f4d4a6.jpg"><br><br><h5>  3. Connection and initialization </h5><br>  We connect the CecheExtremeProxy.dll library to the project, add the generated file with the context and proxy classes.  Next, create connections with the database and use it to initialize the class-context. <br><br><h5>  four. ??????? </h5><br><br><h5>  5. PROFIT! </h5><br>  Now, metadata is available in the process of writing software code (of course, if the development environment supports InteliSense analogue), which doesn‚Äôt hurt that ‚Äúwhat and where?‚Äù Is stored.  Managers hide in themselves all the logic of working with the global and metadata, and, in particular, automatically validate the data.  From all this, you can almost forget that direct access is used. <br><br><h4>  Examples of using </h4><br><div class="spoiler">  <b class="spoiler_title">First we create connections with the base.</b> <div class="spoiler_text"><pre> <code class="cs hljs"> conn = ConnectionContext.GetConnection(); conn.Connect(_namespace, _user, _password);</code> </pre></div></div>  Next, you need to initialize the context: <pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//    - NaviesContext Navies = new NaviesContext(conn);</span></span></code> </pre>  Suppose we want to keep information about the new naval force.  To do this, fill in the fields of the corresponding instance of the proxy class and pass it to the save method of the corresponding manager: <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//    - ManufacturerProxy manufacter = new ManufacturerProxy(); manufacter.Country = "Great Britan"; manufacter.Charge = new ContactInfo(Name: "D. Cameron", Phone: 1112233); manufacter.Ports = new List&lt;ContactInfo&gt; { new ContactInfo("Portsmun",2223344) , new ContactInfo("Dartford",3334455) }; // try { Navies.ManufacturerManager.Save(manufacter); } catch (Exception ex) { MessageBox.Show(ex.Message); }</span></span></code> </pre>  Then, if the data is correct, the following entry appears in the global: <br>  ^ n ("Great Britan") = $ lb ($ lb ("D. Cameron", 1112233), $ lb ($ lb ("Portsmun", 2223344), $ lb ("Dartford", 3334455))) <br><br>  In case of incorrect data: <br><img src="https://habrastorage.org/files/006/f83/64a/006f8364a32744f7ad796b445457e030.jpg"><br><br><div class="spoiler">  <b class="spoiler_title">For comparison, to save a similar entry standard GlobalsAPI.</b> <div class="spoiler_text">  And this is without checking the correctness of the entered data: <br><br><pre> <code class="cs hljs">NodeReference r = conn.CreateNodeReference(<span class="hljs-string"><span class="hljs-string">"wowsNice"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//       GlobalsAPI ValueList manufacturer = conn.CreateList(2); ValueList charge = conn.CreateList(2); charge.Append(new object[] { "D.Cameron", 1112233 }); ValueList ports = conn.CreateList(); ValueList port1 = conn.CreateList(2); port1.Append(new object[] { "Portsmun", 2223344 }); ValueList port2 = conn.CreateList(2); port2.Append(new object[] { "Dartford", 3334455 }); ports.Append(port1); ports.Append(port2); manufacturer.Append(charge); manufacturer.Append(ports); // c   GlobalsAPI r.Set(manufacturer, new object[] { "Great Britan2" });</span></span></code> </pre></div></div><br>  To access data in the nodes, an instance of the corresponding key-class is used: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//   -      ManufacturerProxyKey key = new ManufacturerProxyKey("Great Britan"); ManufacturerProxy readed = Navies.ManufacturerManager.Get(key); // Navies.ManufacturerManager.Kill(key);</span></span></code> </pre>  Suppose we want to get all the ships on one condition - they must be of the 4th rank.  To do this, fill in the remaining fields of the key class instance with empty values: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//       List&lt;ShipInfoProxy&gt; allFourRankShips; ShipInfoProxyKey keyMask = new ShipInfoProxyKey(); keyMask.Country = ""; keyMask.ShipClass = new Classification{ ClassType = "", Rank = 4 }; keyMask.Name = ""; allFourRankShips = Navies.ShipInfoManager.GetByKeyMask(keyMask);</span></span></code> </pre><h5>  Testing </h5><br>  Test bench: acer aspire 5553g-n936g50mn. <br>  Scenario: deleting a global, creating a global, writing in an object way (without validation), clearing the global, writing in the standard way. <br>  Notes: single-threaded application, tester loaded 25% of the processor, writing to the hard disk. <br><br>  Given the few under-optimizations for saving 2,000,000 records like this: <br><br>  ^ wowsTest (kruis, 0, [3, 0], 1) = $ lb ($ lb ($ lb (1, 111111), $ lb (2, 111111)), $ lb (3, 2, 1), $ lb (1, 2, 3), 1000, $ c (6,6,6)) <br>  [...] - in object view, this is structure <br><br>  Results: <br>  Object 00: 01m: 00s.1959, Native: 00: 00m: 29s.7478 obj / native = 2.023 <br>  Cach√© GlobalsProxy Framework for recording without validation took 2 times longer than GlobalsAPI.  With validation - in 3. <br><br><h4>  Conclusion </h4><br>  At this stage, the Cach√© GlobalsProxy Framework is a working prototype, the use of which speeds up the software development process, which implies the use of direct access to the globals of the GlobalsDB and Cach√© databases. <br><br>  Cach√© GlobalsProxy Framework completely encapsulates the logic of working with the global GlobalsAPI tools, as well as the logic of working with metadata, in particular, automating validation. <br><br>  Eventually: <br><ol><li>  Ensures logical data integrity.  Now it is impossible to record anything and anywhere, since at first validation will be automatically done to the data, and only with its success will they be saved. </li><li>  The software development process using GlobalAPI is accelerated many times. </li></ol>  Buns: <br><ol><li>  Creating your own types (structures) including indexes. </li><li>  Partial key data retrieval. </li></ol><br>  Of the minuses should be noted slowdown, but in some projects it is quite possible to sacrifice part of it in favor of development speed. <br><br><h4>  Development </h4><br>  At the moment, within the context of a global context, its data scheme is uniquely defined.  This is accomplished by creating multiple contexts with different data schemes for the same global, which is a bit inconvenient.  In the future, the various global data schemes will be combined in one context. <br><br>  It is also planned to organize a combination of indices.  In addition to storing data, for example, for all 3 indices, it is possible to additionally use a combination of 2 out of 3 of these indices and store different structures for them, again within the same context. <br><br>  Project in open access <a href="https://github.com/SMihand/Cache-GlobalsProxy-Framework">on github</a> (GlobalsDB distribution kit is attached) <br><br><h4>  Guilty: </h4>  Gaydarzhi V.I.  - for participating in the search for the project's theme and, most importantly, for believing in its favor. <br>  Vityuk V.R.  - for complicity in the specification and the creation of a metadata editor. <br>  Kruchok S.I.  - for the review. <br>  Ancestors - for food and a roof over your head. <br>  Nikolashin N.R.  - for the review and most importantly - for the lack of faith in the project. </div><p>Source: <a href="https://habr.com/ru/post/306310/">https://habr.com/ru/post/306310/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../306298/index.html">Telegram writes in the syslog messages inserted from the clipboard, including in secret chats</a></li>
<li><a href="../306300/index.html">Simple sweet apps with Kivy</a></li>
<li><a href="../306304/index.html">Reflective Metaprogramming on Go: loop for each by means of the reflect package</a></li>
<li><a href="../306306/index.html">The digest of fresh materials from the world of the frontend for the last two weeks ‚Ññ220 (July 11 - 24, 2016)</a></li>
<li><a href="../306308/index.html">Cambium ePMP 2000. Solving the problem of interference at base stations</a></li>
<li><a href="../306312/index.html">After logging on a VK user, you can get control of his page.</a></li>
<li><a href="../306318/index.html">Infectious distribution of advertising in social networks</a></li>
<li><a href="../306322/index.html">10 techniques used by manipulators (and how to deal with them)</a></li>
<li><a href="../306324/index.html">Implementation of the Bailey ‚Äî Borwein ‚Äî Plaff algorithm on Golang</a></li>
<li><a href="../306326/index.html">Help Desk and Service Desk - when is Excel and CRM insufficient? Really important functions of accounting systems</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>