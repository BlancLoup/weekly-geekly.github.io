<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>xinetd + netcat ‚Üí pitfalls</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you need to do something on a remote server, but you are too lazy to bother with writing a network service, xinetd comes to the rescue. 

 The ease...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>xinetd + netcat ‚Üí pitfalls</h1><div class="post__text post__text-html js-mediator-article">  If you need to do something on a remote server, but you are too lazy to bother with writing a network service, xinetd comes to the rescue. <br><br>  The ease of writing servers for xinetd is attractive, it is really simple: we write a simple script in any language that works with stdin and stdout (in the simplest case, this is a regular <a href="http://ru.wikipedia.org/wiki/REPL">REPL</a> ) and we get a console utility and a network server in one bottle at the same time. <br>  After one minute of editing the xinetd config, we get a working server to which you can connect via telnet or netcat and see the result on the console. <br><br> <a href="http://www.troubleshooters.com/codecorn/sockets/index.htm"><img src="https://habrastorage.org/getpro/habr/post_images/f79/e01/56d/f79e0156d83b5758e2b65ee7b6df781f.png" alt="image"></a> <br><a name="habracut"></a><br>  Everything is easy and beautiful.  But since there is a (remote) console utility, I want to go further - automate the work with it.  Do not drive hundreds of requests with your hands and not search for the same on the screen as it worked.  That is, speaking the network language, you need a client part. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here, naturally, I want to use netcat (nc): we write a simple script that will issue commands to stdout and interpret the answers received from stdin and connect it to netcat, thus turning it into a network client (although the script itself will not know about it). <br><br>  Having such ‚Äúserver-side‚Äù and ‚Äúclient-side‚Äù scripts, with a bonus, we are able to launch them locally.  Not to mention the fact that in coding we did not write a single line concerning the work with the network. <br><br>  In most cases, this is enough to work happily ever after. <br><br>  But there are <i>nuances</i> . <br><br>  Having written with joy several such remote utilities, I found that <i>sometimes the</i> process of communication written in this way by the client and server hangs. <br><br>  There was nothing to google on this topic, I had to figure it out myself, I present the results to you. <br><br><h4>  Who is guilty? </h4><br>  How xinetd works: opens a socket, hooks it to standard I / O streams, and starts an external programmer. <br><br>  How netcat works (-e, for example): opens a socket, hooks it to standard I / O streams and starts an external programmer. <br><br>  That is the same. <br><br>  Accordingly, if both programmers are sharpened to work with the terminal, no one checks the possibility of writing or reading.  If you need to read, just read;  need to write - just write. <br>  Only instead of the terminal there is already a network socket, and no one works with the network. <br><br>  With enough traffic, there may be a situation of dragons devouring each other from the tail: the reading buffers on both sides are full, but according to the logic of the work cycles, both sides just want to say something to each other. <br>  As a result, both processes hang in write () forever. <br><br>  Attempts to solve the problem cheaply by subtracting the maximum amount of data do not cure the problem, but only postpone it. <br><br>  But most of all in this story I was disappointed by netcat. <br>  Not finding any calls in strace nc to set up a non-blocking socket mode, I looked in apt-get source and ... didn‚Äôt find anything like that. <br>  Netcat works with sockets in a synchronous mode, provoking the possibility of a hangup, even without any ‚Äúexternal program written for the console‚Äù. <br>  Sadness adds the fact that netcat is in fact a standard, although, in fact, unsuitable for use in the general case. <br><br><h4>  What to do? </h4><br>  There are two ways out: <br><br>  1. Write a server for xinetd, considering that this is a network (fcntl O_NONBLOCK, select to stdin and stdout and all that), but then xinetd is lost as a simple wrapper for simple things.  You can already write a full server. <br><br>  2. Write a synchronous client that will wait for the server's response and prevent buffer overflows for reading and writing - here netcat is lost and you have to do something with performance so that you can send several requests at the same time without overflowing the buffer and be able to process several at the same time replies. <br><br>  In my case, I chose a semi-second synchronous option: <br>  ‚Ä¢ send 10 requests <br>  ‚Ä¢ while there is something to send {send one request;  read one answer} <br>  ‚Ä¢ read 10 replies <br>  ... what worked in my particular case, but as a general solution, of course, is no good. </div><p>Source: <a href="https://habr.com/ru/post/114853/">https://habr.com/ru/post/114853/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../114845/index.html">Transformation and translation of websites into other languages ‚Äã‚Äãon the fly using Nginx</a></li>
<li><a href="../114847/index.html">JavaOne Oracle Develop Russia Conference</a></li>
<li><a href="../114848/index.html">Streaming video for iPad / iPod / iPhone on Bash is cheap and good</a></li>
<li><a href="../114850/index.html">What do those who write Linux earn?</a></li>
<li><a href="../114852/index.html">Bulk mailing through Exim or how not to get into spam</a></li>
<li><a href="../114858/index.html">Swedish Masters in IT</a></li>
<li><a href="../114859/index.html">TortoiseHG 2.0 and Mercurial 1.8</a></li>
<li><a href="../114861/index.html">Setting up the Sonatype Nexus repository for proxying Maven artifacts</a></li>
<li><a href="../114863/index.html">We are looking for experts!</a></li>
<li><a href="../114865/index.html">What is a Western MBA and what it is eaten with (1 year in one post)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>