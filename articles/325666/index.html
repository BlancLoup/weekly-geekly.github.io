<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Import Substitution in I2P: Signature in accordance with GOST R 34.10-2012</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Elliptical cryptography, possessing high resilience and high prevalence, has always caused a lot of controversy and speculation about possible bookmar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Import Substitution in I2P: Signature in accordance with GOST R 34.10-2012</h1><div class="post__text post__text-html js-mediator-article">  Elliptical cryptography, possessing high resilience and high prevalence, has always caused a lot of controversy and speculation about possible bookmarks for different curves and signature schemes.  At the same time, no one could give an example of such a bookmark or prove their absence.  Therefore, in contrast to symmetric cryptography, where leadership unconditionally belongs to AES, asymmetric cryptography is used of different types, depending on preferences, technical or legal requirements.  Additional types of address signatures in I2P provide more choice and flexibility for applications.  GOST is supported in openssl via the EVP interface, but in version 1.1 it is excluded from the standard delivery, in addition the existing implementation assumes the storage and transmission of public keys and signatures in DER format, and I2P works directly with numbers, determining the necessary parameters from the signature type. <br><a name="habracut"></a><br><h2>  Types of signatures in I2P </h2><br>  There are currently <a href="https://geti2p.net/spec/common-structures">9 types of signatures</a> in I2P, where the type of signature is indicated, then the type of hash and, if necessary, the curve or its set of parameters. <br><br><ol><li>  ECDSA_SHA256_P256 </li><li>  ECDSA_SHA384_P384 </li><li>  ECDSA_SHA512_P521 </li><li>  RSA_SHA256_2048 </li><li>  RSA_SHA384_3072 </li><li>  RSA_SHA512_4096 </li><li>  EdDSA_SHA512_Ed25519 </li><li>  EdDSA_SHA512_Ed25519ph </li></ol><br>  Also, old addresses use type 0 - DSA_SHA1, which is considered obsolete. <br>  It is recommended to use types 1 and 7. <br><br>  For GOST, we, at my request, have two types: <br>  9 - GOSTR3410_GOSTR3411_256_CRYPTO_PRO_A <br>  10 - GOSTR3410_GOSTR3411_512_TC26_A <br>  for 256 and 512-bit keys, respectively. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The length of the public key for 9 is 64 bytes (32 bytes for each coordinate of the point) and 128 bytes for 10. <br><br><h2>  Signature implementation GOST R 34.10 </h2><br>  It is assumed that a hash of 256 or 512 bits is signed and verified.  Detailed and with examples described <a href="http://protect.gost.ru/document.aspx%3Fcontrol%3D7%26id%3D180151">here</a> . <br><br>  The usual elliptic curve is used, so functions from the cryptographic library can be used to work with it.  In particular, it is EC_GROUP_ * and EC_POINT_ * from openssl, the main of which is: <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EC_POINT_mul</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> EC_GROUP *group, EC_POINT *r, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> BIGNUM *n, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> EC_POINT *q, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> BIGNUM *m, BN_CTX *ctx)</span></span></span></span></code> </pre> <br>  used for both multiplying a base point by a number, or an arbitrary point, depending on the parameters. <br><br>  For a curve, 6 parameters are specified: p is the modulus, a and b are the coefficients of the curve equation, P (x, y) is the base point, q is a prime number, multiplying by which the base point gives zero. <br><br>  p and q should be large and close to the maximum, because p limits the range of all numbers, and q - the range of secret keys.  The base point and q are calculated simultaneously. <br>  As a rule, well-known and well-tested parameter sets are used. <br><br>  In our implementation, we will use 2 sets of parameters: <br><br><ul><li>  GostR3410_2001_CryptoPro_A_ParamSet (OID 1.2.643.2.2.35.1) for 256-bit keys, borrowed from GOST R 34.10-2001; </li><li>  id-tc26-gost-3410-12-512-paramSetA (OID 1.2.643.7.1.2.1.2.1) for 512-bit keys developed by TK26 (tc26.ru) specially for GOST R 34.10-2012. </li></ul><br>  Unlike the curve, the signature scheme in GOST is its own, therefore the ECDSA_sign and ECDSA_verify functions cannot be used and you should implement a signature and signature verification in your code. <br><br>  For the signature (r, s), a random number k is selected, and the point R = k * P is calculated, the x coordinate of which becomes the signature component r.  Component s = r * d + h * k, where d is the secret key, h is the hash of the message signature in Big Endian. <br><br>  To verify the signature, multiply both sides of the equality by the base point P. <br><br>  Indeed, s * P = r * d * P + h * k * P = r * Q + h * R, where Q is the public key.  In this equality, we do not know the point R, and although it is possible to restore the coordinate y by r, this is an extremely slow operation.  Therefore, we rewrite the equality in the form h * R = s * P - r * Q, then <br>  R = (s * P -r * Q) / h and the comparison only x coordinates. <br><br><div class="spoiler">  <b class="spoiler_title">In the i2pd code it looks like this</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> GOSTR3410Curve::Verify (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> EC_POINT * pub, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BIGNUM * digest, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BIGNUM * r, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BIGNUM * s) { BN_CTX * ctx = BN_CTX_new (); BN_CTX_start (ctx); BIGNUM * q = BN_CTX_get (ctx); EC_GROUP_get_order(m_Group, q, ctx); BIGNUM * h = BN_CTX_get (ctx); BN_mod (h, digest, q, ctx); <span class="hljs-comment"><span class="hljs-comment">// h = digest % q BN_mod_inverse (h, h, q, ctx); // 1/h mod q BIGNUM * z1 = BN_CTX_get (ctx); BN_mod_mul (z1, s, h, q, ctx); // z1 = s/h BIGNUM * z2 = BN_CTX_get (ctx); BN_sub (z2, q, r); // z2 = -r BN_mod_mul (z2, z2, h, q, ctx); // z2 = -r/h EC_POINT * C = EC_POINT_new (m_Group); EC_POINT_mul (m_Group, C, z1, pub, z2, ctx); // z1*P + z2*pub BIGNUM * x = BN_CTX_get (ctx); GetXY (C, x, nullptr); // Cx BN_mod (x, x, q, ctx); // Cx % q bool ret = !BN_cmp (x, r); // Cx = r ? EC_POINT_free (C); BN_CTX_end (ctx); BN_CTX_free (ctx); return ret; }</span></span></code> </pre><br></div></div><br><h2>  Hash function GOST R 34.11-2012 (stribog) </h2><br>  Although you can use any function for signing a message that hashes a suitable size, for example, SHA256 / SHA512, we will use the standard GOST R 34.11-2012 prescribed by the standard, including for compatibility with existing implementations.  Unlike the signature, the hash is much simpler. <br><br>  Detailed <a href="http://protect.gost.ru/document1.aspx%3Fcontrol%3D31%26id%3D180209">description and examples</a> .  Note the main points: <br><br><ul><li>  The original message is divided into blocks of 64 bytes.  If the message is not a multiple of 64, then the first block is supplemented on the left with zero and single bytes. </li><li>  Each block is hashed separately, taking into account the hash of the previous block.  For the very first block, the initialization vector (iv) is set as the previous hash.  Passing through the blocks is carried out <b>in the reverse order</b> - from the last to the first. </li><li>  Each block is "encrypted" by 12 rounds with specified keys, each round is the application of three transformations S, P, L using specified tables and XOR with a round key. </li><li>  S is a byte-wise replacement, P is the hash transposition as 8x8 matrices, L is the multiplication by the given matrix. </li><li>  A 256-bit hash is the left half of a 512-bit hash, but the other iv is used, so it‚Äôs impossible to calculate them at the same time. </li></ul><br><h2>  Signature by external crypto-provider using I2CP protocol </h2><br>  If the address is connected to the router via the <a href="https://geti2p.net/spec/i2cp">I2CP</a> protocol, then knowledge of the secret key of the signature by the router is not required. <br><br>  Instead, the router sends a RequestLeaseSetMessage message (or RequestVariableLeaseSetMessage), waiting for a reply with a CreateLeaseSetMessage message containing a LeaseSet signed by the private key of the address.  As you can see from the protocol description, in older versions of I2P it was required to transfer this key in the message, this is no longer required. <br>  Thus, an application that implements an I2P address can use the API to sign one of the existing cryptographic providers with GOST, allowing you to effectively integrate the I2P solution into the existing infrastructure. <br><br><h2>  Implementation </h2><br>  Currently <a href="https://github.com/PurpleI2P/i2pd">i2pd</a> fully supports signature types 9 and 10. Any client addresses will work with addresses on i2pd.  <a href="">An example of</a> use.  The server addresses require support from the floodfills, or an independent I2P network can be built with netid other than 2. In the main network, it is necessary to wait for it to be <a href="https://geti2p.net/spec/proposals/134-gost">implemented in Java</a> or <a href="https://geti2p.net/spec/proposals/137-optional-sigtypes">an additional parameter floodfill</a> . </div><p>Source: <a href="https://habr.com/ru/post/325666/">https://habr.com/ru/post/325666/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325654/index.html">Open machine learning course. Theme 7. Teaching without a teacher: PCA and clustering</a></li>
<li><a href="../325656/index.html">Summer is coming - it's time to apply to the summer school (internship) of Intel</a></li>
<li><a href="../325658/index.html">Symfony Flex, what your symfony 4 application will look like</a></li>
<li><a href="../325660/index.html">The State of Reactive in JS: A Practical Review of FRP Libraries</a></li>
<li><a href="../325664/index.html">How I learned to create my mobile apps</a></li>
<li><a href="../325668/index.html">Connect to FireBird from Python and monitor the fact of writing to the database</a></li>
<li><a href="../325672/index.html">‚ÄúApache Ignite is a high-tech product‚Äù: GridGain Systems about in-memory computing, open source, the Russian market and not only</a></li>
<li><a href="../325676/index.html">Huawei USG 6300. Basic firewall configuration out of the box</a></li>
<li><a href="../325678/index.html">Write on C as a gentleman</a></li>
<li><a href="../325682/index.html">The fraudster pulled out of two companies $ 100 million with the help of social engineering</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>