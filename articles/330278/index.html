<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unity: save system for any project</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Games need to be saved. There can be a great number of saved entities. For example, in recent releases of TES and Fallout, the game remembers the loca...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unity: save system for any project</h1><div class="post__text post__text-html js-mediator-article">  Games need to be saved.  There can be a great number of saved entities.  For example, in recent releases of TES and Fallout, the game remembers the location of each rolled bottle.  A decision is needed to: <br><br>  1) Written once and use in any project for any entities.  Well, as far as possible. <br>  2) Created the essence - and it is saved by itself, with a minimum of additional efforts. <br><a name="habracut"></a><br>  The decision came from the camp of singltons.  Are you tired of writing the same singleton code?  <b>And yet there is a generic singleton.</b> <br><br><div class="spoiler">  <b class="spoiler_title">Here's how it looks for MonoBehaviour</b> <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">GenericSingleton</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> GenericSingleton&lt;T&gt; instance; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> GenericSingleton&lt;T&gt; Instance { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (instance &amp;&amp; instance != <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) { Destroy(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } instance = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TestSingletoneA</span></span> : <span class="hljs-title"><span class="hljs-title">GenericSingleton</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TestSingletoneA</span></span>&gt; { <span class="hljs-comment"><span class="hljs-comment">// Use this for initialization void Start () { Debug.Log("A"); } }</span></span></code> </pre><br></div></div><br>  Those.  You can make a Generic class whose static fields will be unique for each input type. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And this is our case.  Because the behavior of the saved object is completely identical, only the saved models differ.  And the type of model just acts as an input. <br><br>  <b>Here is the model interface code.</b>  It is remarkable that the SetValues ‚Äã‚Äãmethod takes as its argument only a model of the same (or derived) type.  Isn't it a miracle? <br><br><div class="spoiler">  <b class="spoiler_title">AbstractModel</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Voloshin Game Framework: basic scripts supposed to be reusable </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> namespace VGF { //[System.Serializable] public interface AbstractModel</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;T&gt;</span></span></span><span class="hljs-comment"> where T : AbstractModel</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;T&gt;</span></span></span><span class="hljs-comment">, new() { </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Copy fields from target </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="model"&gt;</span></span></span><span class="hljs-comment">Source model</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> void SetValues(T model); } public static class AbstratModelMethods { </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Initialize model with source, even if model is null </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;typeparam name="T"&gt;</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/typeparam&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="model"&gt;</span></span></span><span class="hljs-comment">Target model, can be null</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="source"&gt;</span></span></span><span class="hljs-comment">Source model</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> public static void InitializeWith</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;T&gt;</span></span></span><span class="hljs-comment">(this T model, T source) where T: AbstractModel</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;T&gt;</span></span></span><span class="hljs-comment">, new () { //model = new T(); if (source == null) return; model.SetValues(source); } } }</span></span></code> </pre><br></div></div><br>  The model also needs a generic controller, but the following nuance is associated with it, so for the time being we‚Äôll omit it. <br><br>  From these classes ‚Äî the abstract model and the generalized controller ‚Äî you can inherit everything that is saved and loaded.  I wrote a model, inherited the controller - and forgot, everything works.  Fine! <br><br>  <b>And what to do with saving and loading?</b>  After all, you need to save and load everything at once.  And to write for each new entity the code to save and load in some SaveLoadManager is tedious and easy to forget. <br><br>  And here come to the aid of statics. <br><br>  1) Abstract class with protected save and load functions <br>  2) He has a static collection All, where each instance of the descendant class is added during initialization. <br>  3) And static public functions of preservation and loading, inside of which all instances from All are searched and specific methods of preservation and loading are called. <br><br>  And so what code is obtained as a result. <br><br><div class="spoiler">  <b class="spoiler_title">SaveLoadBehaviour</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">VGF</span></span> { <span class="hljs-comment"><span class="hljs-comment">/* Why abstract class instead of interface? * 1) Incapsulate all save, load, init, loadinit functions inside class, make them protected, mnot public * 2) Create static ALL collection and static ALL methods * */</span></span> <span class="hljs-comment"><span class="hljs-comment">//</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> create a similar abstract class for non-mono classes. For example, PlayerController needs not to be a MonoBehaviour /// &lt;summary&gt; /// Abstract class for all MonoBehaiour classes that support save and load /// &lt;/summary&gt; public abstract class SaveLoadBehaviour : CachedBehaviour { /// &lt;summary&gt; /// Collection that stores all SaveLoad classes in purpose of providing auto registration and collective save and load /// &lt;/summary&gt; static List&lt;SaveLoadBehaviour&gt; AllSaveLoadObjects = new List&lt;SaveLoadBehaviour&gt;(); protected override void Awake() { base.Awake(); Add(this); } static void Add(SaveLoadBehaviour item) { if (AllSaveLoadObjects.Contains(item)) { Debug.LogError(item + " element is already in All list"); } else AllSaveLoadObjects.Add(item); } public static void LoadAll() { foreach (var item in AllSaveLoadObjects) { if (item == null) { Debug.LogError("empty element in All list"); continue; } else item.Load(); } } public static void SaveAll() { Debug.Log(AllSaveLoadObjects.Count); foreach (var item in AllSaveLoadObjects) { if (item == null) { Debug.LogError("empty element in All list"); continue; } else item.Save(); } } public static void LoadInitAll() { foreach (var item in AllSaveLoadObjects) { if (item == null) { Debug.LogError("empty element in All list"); continue; } else item.LoadInit(); } } protected abstract void Save(); protected abstract void Load(); protected abstract void Init(); protected abstract void LoadInit(); } }</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">GenericModelBehaviour &lt;T&gt;</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">VGF</span></span> { <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Controller for abstract models, providing save, load, reset model </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;typeparam name="T"&gt;</span></span></span><span class="hljs-comment">AbstractModel child type</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/typeparam&gt;</span></span></span><span class="hljs-comment"> public class GenericModelBehaviour</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;T&gt;</span></span></span><span class="hljs-comment"> : SaveLoadBehaviour where T: AbstractModel</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;T&gt;</span></span></span><span class="hljs-comment">, new() { [SerializeField] protected T InitModel; //[SerializeField] protected T CurrentModel, SavedModel; protected override void Awake() { base.Awake(); //Init(); } void Start() { Init(); } protected override void Init() { //Debug.Log(InitModel); if (InitModel == null) return; //Debug.Log(gameObject.name + " : Init current model"); if (CurrentModel == null) CurrentModel = new T(); CurrentModel.InitializeWith(InitModel); //Debug.Log(CurrentModel); //Debug.Log("Init saved model"); SavedModel = new T(); SavedModel.InitializeWith(InitModel); } protected override void Load() { //Debug.Log(gameObject.name + " saved"); LoadFrom(SavedModel); } protected override void LoadInit() { LoadFrom(InitModel); } void LoadFrom(T source) { if (source == null) return; CurrentModel.SetValues(source); } protected override void Save() { //Debug.Log(gameObject.name + " saved"); if (CurrentModel == null) return; if (SavedModel == null) SavedModel.InitializeWith(CurrentModel); else SavedModel.SetValues(CurrentModel); } } }</span></span></code> </pre> <br></div></div><br>  Examples of specific classes inherited: <br><br><div class="spoiler">  <b class="spoiler_title">AbstractAliveController: GenericModelBehaviour</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AbstractAliveController</span></span> : <span class="hljs-title"><span class="hljs-title">GenericModelBehaviour</span></span>&lt;<span class="hljs-title"><span class="hljs-title">AliveModelTransform</span></span>&gt;, <span class="hljs-title"><span class="hljs-title">IAlive</span></span> { <span class="hljs-comment"><span class="hljs-comment">//</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> create separate unity implementation where put all the [SerializeField] attributes [SerializeField] bool Immortal; static Dictionary&lt;Transform, AbstractAliveController&gt; All = new Dictionary&lt;Transform, AbstractAliveController&gt;(); public static bool GetAliveControllerForTransform(Transform tr, out AbstractAliveController aliveController) { return All.TryGetValue(tr, out aliveController); } DamageableController[] BodyParts; public bool IsAlive { get { return Immortal || CurrentModel.HealthCurrent &gt; 0; } } public bool IsAvailable { get { return IsAlive &amp;&amp; myGO.activeSelf; } } public virtual Vector3 Position { get { return myTransform.position; } } public static event Action&lt;AbstractAliveController&gt; OnDead; /// &lt;summary&gt; /// Sends the current health of this alive controller /// &lt;/summary&gt; public event Action&lt;int&gt; OnDamaged; //</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> create 2 inits protected override void Awake() { base.Awake(); All.Add(myTransform, this); } protected override void Init() { InitModel.Position = myTransform.position; InitModel.Rotation = myTransform.rotation; base.Init(); BodyParts = GetComponentsInChildren&lt;DamageableController&gt;(); foreach (var bp in BodyParts) bp.OnDamageTaken += TakeDamage; } protected override void Save() { CurrentModel.Position = myTransform.position; CurrentModel.Rotation = myTransform.rotation; base.Save(); } protected override void Load() { base.Load(); LoadTransform(); } protected override void LoadInit() { base.LoadInit(); LoadTransform(); } void LoadTransform() { myTransform.position = CurrentModel.Position; myTransform.rotation = CurrentModel.Rotation; myGO.SetActive(true); } public void Respawn() { LoadInit(); } public void TakeDamage(int damage) { if (Immortal) return; CurrentModel.HealthCurrent -= damage; OnDamaged.CallEventIfNotNull(CurrentModel.HealthCurrent); if (CurrentModel.HealthCurrent &lt;= 0) { OnDead.CallEventIfNotNull(this); Die(); } } public int CurrentHealth { get { return CurrentModel == null? InitModel.HealthCurrent: CurrentModel.HealthCurrent; } } protected abstract void Die(); }</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">AliveModelTransform: AbstractModel</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">VGF.Action3d</span></span> { [System.Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AliveModelTransform</span></span> : <span class="hljs-title"><span class="hljs-title">AliveModelBasic</span></span>, <span class="hljs-title"><span class="hljs-title">AbstractModel</span></span>&lt;<span class="hljs-title"><span class="hljs-title">AliveModelTransform</span></span>&gt; { [HideInInspector] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 Position; [HideInInspector] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Quaternion Rotation; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetValues</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">AliveModelTransform model</span></span></span><span class="hljs-function">)</span></span> { Position = model.Position; Rotation = model.Rotation; <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.SetValues(model); } } }</code> </pre> <br></div></div><br>  <b>Disadvantages of the solution and how to fix them.</b> <br><br>  1) All is saved (overwritten).  Even that which has not been changed. <br><br>  Possible solution: check before saving the equality of the fields in the original and current models and save only when necessary. <br><br>  2) Download from file.  From json, for example.  Here is a list of models.  How can the loader know which class to create for this json text? <br><br>  Possible solution: make the dictionary &lt;System.Type, string&gt; where to register types with hardcode.  When loading from json, a string type identifier is taken and an object of the required class is instantiated.  When saving, the object checks if there is a key of its type in the dictionary, and issues a message / error / exception.  This will allow an outside programmer to remember to add a new type to the dictionary. <br><br>  You can see my code with this and other good solutions here (projects in the initial stage): <br><br>  ‚Üí <a href="https://github.com/Y-Voloshin/FPSProject">FPSProject</a> <br>  ‚Üí <a href="https://github.com/Y-Voloshin/GingerSpace">Incredible cosmic adventures of quirky catminders</a> <br><br>  <b>Comments, improvements, tips are welcome.</b> <b><br></b>  <b>Suggestions for help and co-creation are welcome.</b> <b><br></b>  <b>Job offers are highly welcome.</b> <br><br>  <b>UPD:</b> <br>  I see, questions arise a la <b>‚ÄúWhat is the profit from your decision?</b>  <b>It's the same to do models, to do serialization. ‚Äù</b> <br>  I answer: <br>  You came to checkpoint or click save.  A button or checkpoint told the class manager to save the game state.  What does the manager do? <br><br>  <u>Bad option 1:</u> <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Entity1.Save; Entity2.Save; Entity3.Save; ... EntityInfinity.Save; }</code> </pre> <br>  <u>Bad version 2:</u> Every SaveLoadBehaviour subscribes to the manager's OnSave event.  Or registers itself in some kind of "container". <br>  Bad, because SaveLoadBehaviour needs to know about the existence of a manager / container.  I tried to make the classes as autonomous as possible, and all the knowledge about their connections was stored in the manager himself. <br><br>  <u>Bad option 3: the</u> manager, during initialization, searches for all stored components. <br>  1) The search function may differ between platforms.  GameObject.FindObjectsOfType () is applicable only for MonoBehaviour, but what if we do shared logic?  Implementation should be as flexible and cross-platform as possible. <br>  2) If we decide to rewrite the manager from scratch (for another game, for example), then we must not forget to insert the search function. <br><br>  <u>My good option:</u> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">GameManager</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { AbstractSaveLoadBehaviour.SaveAll(); } }</code> </pre> <br><br>  I was also asked <b>what to do if we want to put several saveloadbehaviour on one game object?</b>  How are they going to load in one gameobject? <br><br>  Here is the solution that came to my mind: <br><ol><li>  In each SaveloadBehaviour in the save and load function add an event call. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (OnSaveSendToMainBehaviour == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//   } else OnSaveSendToMainBehaviour(savedModel) }</span></span></code> </pre></li><li>  The main controller of the entity, which, when initialized, searches for all components of SaveLoadBehaviour and subscribes to their events. </li><li>  If it exists, it aggregates events from all storage controllers, collects their models and saves them to the file itself, individually. </li><li>  To check that all controllers have already sent everything, you can make a counter. <br><pre> <code class="cs hljs">voidOnSaveModelFromDependentController(model partModel) { currentSaveCount++; model.AddPArtModel(partModel); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentSaveCount == TotalSaveCount) Save(model); }</code> </pre> </li><li>  And even the addition of such a uber controller can be automated.  Every saveloadbehaviour on Awake or Start seeks if there are others.  If it is, it searches for the uber controller and adds it, if necessary. <br>  And the uber controller on Awake or Start subscribes to all. <br>  Double subscriptions will not happen, because  the uber controller will be added only once, and its Awake / Start will also be called only once. </li></ol></div><p>Source: <a href="https://habr.com/ru/post/330278/">https://habr.com/ru/post/330278/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../330240/index.html">Methods of working with "heavy" XML</a></li>
<li><a href="../330244/index.html">The fee for publishing the game via Steam Direct is set at $ 100</a></li>
<li><a href="../330248/index.html">Welcome</a></li>
<li><a href="../330250/index.html">IBM Watson and Cybersecurity: A Rapid Response Service That Works Round the Clock</a></li>
<li><a href="../330252/index.html">Must-Have 3: Game Interfaces and Assets for Designer and Artist</a></li>
<li><a href="../330280/index.html">Finished off: how companies use gamification in recruitment</a></li>
<li><a href="../330282/index.html">Machine learning and data analysis: solving practical problems with the winners of the industrial hackathon LC</a></li>
<li><a href="../330284/index.html">Memory leaks in Android and how to localize them</a></li>
<li><a href="../330286/index.html">HP DL120 G7 - the second life of the server</a></li>
<li><a href="../330288/index.html">Swift Playgrounds 1.5. Programming Sphero and more.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>