<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Collecting information about workstations via Powershell</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Collecting information about workstations via Powershell . 

 This post will be devoted to the work of writing scripts on Powershell . Further, I assu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Collecting information about workstations via Powershell</h1><div class="post__text post__text-html js-mediator-article">  Collecting information about workstations via <b>Powershell</b> . <br><br>  This post will be devoted to the work of writing scripts on <b>Powershell</b> .  Further, I assume that the reader has already encountered scripting in windows environments.  So: <br><br>  I had the task to collect some information on user workstations in the organization.  All stations in AD and users too, which simplifies the task.  There is a container where all the stations are located, so you need to go through all, taking the information of interest, and display the result.  If so, then write the script.  When writing, I try to do the script in parts.  IMHO for me is easier and more understandable. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      1. Need a list of stations.  It can easily be taken from AD with this command: <br><br>  <b>Get-ADComputer -filter * -SearchBase "OU = Computers, ou = some-OU, dc = some-dc, dc = en"</b> <br><br>  It will return all objects from the container with all properties, etc.  I did not need everything and I chose from them those that are not turned off ( <b>Diasabled</b> ).  We put in the pipeline cmdlet <br><br>  <b>Where-Object {$ _. Enabled -eq $ true}</b> <br><br>  which selects objects whose <b>enable</b> property is <b>true</b> , that is, they are enabled.  Next, I do not need all the properties of each object, so I will only select the Name property, putting the cmdlet in the pipeline <br><br>  Select-Object -Property Name <br><br>  The list is still useful, so let's create an array of <b>$ enablePCs</b> from it.  The ultimate team will be like this <br><br>  <b>$ enablePCs = Get-ADComputer -filter * -SearchBase "OU = Computers, ou = ru-moscow, ou = cee, dc = alico, dc = corp" |</b>  <b>Where-Object {$ _. Enabled -eq $ true} |</b>  <b>Select-Object -Property Name</b> <br><br>  Now, if you type in the console <b>$ enablePCs</b> , the output will be a list of the names of all computers. <br><br>  Further, you might think that you can work with this list, but no.  Parts of these computers are long gone, some are off.  So, you need to handle sort the list below.  I went along the following path: If the name of the workstation cannot be resolved to the ip address, it means that there is no such station anymore, if it succeeds, then you can ping it.  If not pinged, then most likely the station is turned off.  Thus, you can make a list of currently active stations in order not to try to <s>talk to the wall</s> to contact inactive hosts.  To resolve, I used the <b>resolve</b> method for the <b>[System.net.dns]</b> function.  It turned out this line: <br><br>  <b>$ dnsresult = [System.Net.Dns] :: resolve ("$ computername")</b> <br><br>  About <b>$ computername</b> will be written below.  After, you need to extract the actual IP address from the result <br><br>  <b>$ ipaddress = $ dnsresult.AddressList</b> <br><br>  Next, we check the address for accessibility using the standard system function <b>[system.net.nnetworkinformation.ping]</b> applying the <b>send</b> method to it.  The command is as follows: <br><br>  <b>$ pingfunc = (New-Object system.net.networkinformation.ping) .send ("$ ipaddress")</b> <br><br>  The command returns the result, and if its status is <b>success</b> , the workstation is available and you can access it.  There is already to your taste, any available actions within your administrator's powers.  For example, I‚Äôll show how I checked which workstation has <b>Chrome</b> installed: <br><br>  <b>$ chrome = dir "\\ $ ipaddress \ C $ \ Program Files (x86) \ Google \ Chrome \ Application \ chrome.exe"</b> <b><br></b>  <b>if ($ chrome -ne $ null) {write-host "Host $ computername is reacheble, use Chrome, and have ip $ ipaddress"</b> <b><br></b>  <b>$ sumchrome ++}</b> <b><br></b>  <b>else {write-host "$ computername is reacheble, do not use Chrome, and have ip $ ipaddress"</b> <b><br></b>  <b>$ pcwithoutchrome ++}</b> <br><br>  The <b>$ sumchrome</b> and <b>$ pcwithoutchrome variables</b> are needed to count the total number of stations.  Now, first look at the logic of the entire script. <br><br>  &lt;img src = " <img src="//habrastorage.org/files/a23/6ed/18d/a236ed18d0074bf68ee8f6b93c48ac34.jpg">  "alt =" image "/&gt; <br><br>  Now a complete script with comments. <br><br>  $ enablePCs = Get-ADComputer -filter * -SearchBase "OU = Computers, ou = someou, dc = somedomain, dc = corp" |  Where-Object {$ _. Enabled -eq $ true} |  Select-Object -Property Name <br>  $ sumunresolvePC = 0 <br>  $ sumchrome = 0 <br>  $ sumreacheblePC = 0 <br>  $ sumunreacheblePC = 0 <br>  $ pcwithoutchrome = 0 <br><br>  foreach ($ i in $ enablePCs) # start the object processing loop in the $ enablePCs array <br>  { <br>  $ error.Clear () # clear the Powershell error buffer <br>  $ erroractionpreference = "silentlycontinue" # suppress console error output <br>  $ dnsresult = 0 <br>  $ computername = $ i.name # retrieve the name of the station <br>  $ dnsresult = [System.Net.Dns] :: resolve ("$ computername") <br><br>  if (! $ error) # condition if the previous command was not completed with an error <br>  { <br>  $ ipaddress = $ dnsresult.AddressList <br>  $ pingfunc = (New-Object system.net.networkinformation.ping) .send ("$ ipaddress") #ping <br>  if ($ pingfunc.Status -eq "success") <br>  { <br>  $ sumreacheblepc ++ # plus the total number of available stations <br>  $ chrome = dir \\ $ ipaddress \ C $ \ Program Files (x86) \ Google \ Chrome \ Application \ chrome.exe # check for Chrome <br>  If ($ chrome -ne $ null) {write-host "Host $ computername is reachable, use Chrome, and have ip $ ipaddress" <br><br>  $ sumchrome ++ # plus the number of stations with chrome <br>  } <br>  else { <br>  Write-host "$ computername is reachable, do not use Chrome, and have ip $ ipaddress" <br>  $ pcwithoutchrome ++ # plus the number of stations without chrome <br>  } <br><br>  } <br>  else { <br>  $ sumunreacheblePC ++ # plus the number of inaccessible stations <br>  Write-Host "Host $ computername is unreachable now ip $ ipaddress" <br><br>  } <br>  } <br><br>  else <br>  {$ sumunresolvePC ++ # plus the number of unresolved stations <br>  write "I cannot resolve $ computername :("} <br>  } <br>  Write-Host "Total enabled PC =" $ enablePCs.count <br>  Write-Host "Total PC with Chrome = $ sumchrome" <br>  Write-Host "Total reachable PC = $ sumreacheblePC" <br>  Write-Host "Total Unreachable PC = $ sumunreacheblePC" <br>  Write-Host "Total PC Without Chrome = $ pcwithoutchrome" <br>  write-host "Total unresolved PC = $ sumunresolvepc" <br><br><br>  Well that's all.  I described the availability of Chrome as an example.  There you can also include a lot of checks and other useful things that can not be written in logonscript.  I just began to learn powershell itself, if there are ideas on optimization, write, discuss. </div><p>Source: <a href="https://habr.com/ru/post/245899/">https://habr.com/ru/post/245899/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../245889/index.html">Simple lock-free objects for two threads</a></li>
<li><a href="../245891/index.html">10 new free online courses on Stepic</a></li>
<li><a href="../245893/index.html">PHP Namespaces</a></li>
<li><a href="../245895/index.html">Introduction to cross-platform game development on haxe, flow, snow, luxe</a></li>
<li><a href="../245897/index.html">Video of Badoo reports from the Highload 2014 conference</a></li>
<li><a href="../245901/index.html">Introduction to .NET Core</a></li>
<li><a href="../245903/index.html">How to strengthen password protection "12345" from brute-force attack</a></li>
<li><a href="../245907/index.html">AppCode 3.1 and Swift: fast execution of your brilliant ideas</a></li>
<li><a href="../245909/index.html">Building a frontend with ErgoJS</a></li>
<li><a href="../245911/index.html">How to just make friends Symfony2 and RequireJS on the example of SPA</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>