<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Sum of iconCaption points in the cluster LoadingObjectManager</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Suppose you use api Yandex maps. 

 Suppose you need to draw a lot of points, each of which contains a number on itself - the amount of something that...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Sum of iconCaption points in the cluster LoadingObjectManager</h1><div class="post__text post__text-html js-mediator-article">  Suppose you use api Yandex maps. <br><br>  Suppose you need to draw a lot of points, each of which contains a number on itself - the amount of something that is on this point.  It contains this number, for example, in iconContent (you can in iconCaption). <br><a name="habracut"></a><br>  In this case, when using ObjectManager, and more specifically LoadingObjectManager, points are unloaded in the format: <br><br><pre><code class="php hljs">{<span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Feature"</span></span>, <span class="hljs-string"><span class="hljs-string">"id"</span></span>: {$id}, <span class="hljs-string"><span class="hljs-string">"geometry"</span></span>: {<span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Point"</span></span>, <span class="hljs-string"><span class="hljs-string">"coordinates"</span></span>: [{$xp},{$yp}]}, <span class="hljs-string"><span class="hljs-string">"properties"</span></span>: {<span class="hljs-string"><span class="hljs-string">"iconContent"</span></span>: <span class="hljs-string"><span class="hljs-string">"{$summ}"</span></span>, <span class="hljs-string"><span class="hljs-string">"hintContent"</span></span>: <span class="hljs-string"><span class="hljs-string">"{$name}, {$address}"</span></span>}}</code> </pre> <br>  This summ is a number that is displayed if one point is visible.  But on the cluster - the number is different, and this is the sum of the points in this cluster.  But, in order not to mislead users, it is advisable to write there not the sum of points, but the sum of the summ of these points. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To do this, override clusterIconLayout and clusterIconShape in objectManager: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> objectManager = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ymaps.LoadingObjectManager(<span class="hljs-string"><span class="hljs-string">'_url_____spatial_mysql_?bbox=%b'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">clusterize</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">clusterHasBalloon</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">clusterIconLayout</span></span>: ymaps.templateLayoutFactory.createClass(<span class="hljs-string"><span class="hljs-string">'&lt;div class="outercluster"&gt;&lt;div class="cluster" id="counter-$[id]"&gt;&lt;/div&gt;&lt;/div&gt;'</span></span>,{ <span class="hljs-attr"><span class="hljs-attr">build</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.constructor.superclass.build.call(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); i=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(o <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getData().properties.geoObjects) { i+=<span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getData().properties.geoObjects[o].properties.iconContent); } $(<span class="hljs-string"><span class="hljs-string">'#counter-'</span></span>+<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getData().id).html(i); } }), <span class="hljs-attr"><span class="hljs-attr">clusterIconShape</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'Circle'</span></span>,<span class="hljs-comment"><span class="hljs-comment">//   islands#orangeClusterIcons coordinates: [0, 0], radius: 25//   css  }, geoObjectOpenBalloonOnClick: false, gridSize: 32 });</span></span></code> </pre><br>  I made the CSS for the resulting circle look something like an orange preset (as far as my CSS curvature allowed me): <br><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.outercluster</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">position</span></span>: absolute; <span class="hljs-attribute"><span class="hljs-attribute">left</span></span>: -<span class="hljs-number"><span class="hljs-number">25px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">top</span></span>: -<span class="hljs-number"><span class="hljs-number">25px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">border-radius</span></span>: <span class="hljs-number"><span class="hljs-number">50%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">50px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">50px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">background</span></span>: <span class="hljs-number"><span class="hljs-number">#FFFFFF</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">border</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">padding-top</span></span>: <span class="hljs-number"><span class="hljs-number">2px</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.cluster</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">border-radius</span></span>: <span class="hljs-number"><span class="hljs-number">50%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">46px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">46px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">background</span></span>: <span class="hljs-number"><span class="hljs-number">#FFFFFF</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">border</span></span>: <span class="hljs-number"><span class="hljs-number">6px</span></span> solid orange; <span class="hljs-attribute"><span class="hljs-attribute">text-align</span></span>: center; <span class="hljs-attribute"><span class="hljs-attribute">padding-top</span></span>: <span class="hljs-number"><span class="hljs-number">5px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin-left</span></span>: <span class="hljs-number"><span class="hljs-number">2px</span></span>; }</code> </pre><br>  Now in the cluster we need the amount.  Of course, the cluster can be drawn in any form, as far as the hands and imagination allow. <br><br><h3>  PS </h3><br>  On the server side, points are stored in mysql, one of the fields in the point table is of type point and the SPATIAL index on it. <br><br>  The request is formed approximately as follows: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, address, summ, X(point) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> xp, Y(point) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> yp <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> points <span class="hljs-keyword"><span class="hljs-keyword">FORCE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> (point) <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> MBRContains(GeomFromText( <span class="hljs-string"><span class="hljs-string">'LINESTRING({$carr[0]} {$carr[1]},{$carr[2]} {$carr[3]})'</span></span> ),point)</code> </pre> <br>  where carr is the array resulting from filtering $ _GET ['bbox']: <br><br><pre> <code class="php hljs">$carr=<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_GET[<span class="hljs-string"><span class="hljs-string">'bbox'</span></span>])) { $coords=explode(<span class="hljs-string"><span class="hljs-string">','</span></span>,$_GET[<span class="hljs-string"><span class="hljs-string">'bbox'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(count($coords)==<span class="hljs-number"><span class="hljs-number">4</span></span>) { $carr=<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($coords <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $c) { $carr[]=floatval($c); } } }</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/349356/">https://habr.com/ru/post/349356/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../349342/index.html">Instructor's Manual for the book ‚ÄúProgramming: Principles and Practice Using C ++‚Äù</a></li>
<li><a href="../349344/index.html">FastTrack Training. "Network Basics". Understanding Cisco Architecture. Eddie Martin December 2012</a></li>
<li><a href="../349348/index.html">The way to manage color schemes "Swift" "iOS" applications</a></li>
<li><a href="../349350/index.html">Setting up the development environment: coffee grounds (Part 2)</a></li>
<li><a href="../349354/index.html">Develop isomorphic RealWorld applications with SSR and Progressive Enhancement. Part 2 - Hello World</a></li>
<li><a href="../349358/index.html">Apache Ignite - database cache</a></li>
<li><a href="../349360/index.html">Bitcoin will not be a new digital money: about the drug business, transaction costs and gold</a></li>
<li><a href="../349362/index.html">SVG masks and wow effects: magic with simple words</a></li>
<li><a href="../349364/index.html">OOP without "O"</a></li>
<li><a href="../349366/index.html">Web components. Part 1: Custom Elements</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>