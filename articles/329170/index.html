<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Domestic processor from the company ELVIS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! Our article about the domestic processor Multiklet, has caused quite a lot of interest. True, for some reason, many have decided that this is a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Domestic processor from the company ELVIS</h1><div class="post__text post__text-html js-mediator-article"><img width="400" src="https://habrastorage.org/web/9d2/b75/a25/9d2b75a254234ab29db339121d56cc0a.png" align="right"><br>  Hello!  Our <a href="https://habrahabr.ru/company/embox/blog/265059/">article</a> about the domestic processor Multiklet, has caused quite a lot of interest.  True, for some reason, many have decided that this is an article from the Multiklet itself. <br><br>  In this article we will talk about domestic manufacturers of processors (microcontrollers).  Now this topic is quite popular: for example, the <a href="http://osday.ru/">OSDay</a> conference was devoted to <a href="http://osday.ru/">this</a> .  In general, this time we got a board from the company "Electronic Computing Information Systems" <a href="http://multicore.ru/">ELVIS</a> .  We dragged our <a href="https://github.com/embox/embox">Embox there</a> and decided that it would be interesting for Habr users to learn about this epic. <br><a name="habracut"></a><br>  So, the processor, or rather the system on a chip (SOC), or more precisely ‚Äúthe MICROSHEME INTEGRAL <a href="http://multicore.ru/index.php%3Fid%3D1335">1892BM14YA</a> ‚Äù, as stated in <a href="http://multicore.ru/mc/data_sheets/Manual_1892VM14YA.pdf">the user manual</a> , has: <br><br><ul><li>  two Cortex-A9 cores or, as stated in the documentation, a standard multiprocessor central processing unit (MPU) in the form of a 2-core ARM Cortex-A9 MPCore co-cluster with SIMD co-processors Neon; </li><li>  two DSP cores Elcore-30M </li><li>  ARM MALI-300 integrated graphics hardware accelerator core; </li><li>  the core of the hardware-software video accelerator ‚ÄúVELcore-01‚Äù; </li><li>  ... </li></ul><br>  We were interested in the core Cortex-A9, the rest, unfortunately, never ‚Äúfelt‚Äù.  We already had some support for Cortex-A9 for the i.MX6 and vexpress-a9 (qemu) platforms, so we hoped that we would make it all right away.  Looking ahead to say that almost happened. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Unpacking </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/web/792/5d5/670/7925d56703c746d7a7f9c184f707ad78.png"></div><br>  So, the <a href="http://multicore.ru/index.php%3Fid%3D1354">Salyut-EL24D2</a> board came to us, in appearance quite decently made, and we already happily wanted to supply power, but then we found out that there is a power connector, but we do not observe a connector for the console (UART). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/94d/835/ced/94d835ced9a24ec5809ece7db08d77c6.png"></div><br>  Considering that the bundled was a USB adapter with RX / TX / GND / 3V3 / 5V outputs, it was most logical to start searching for a port with the same names.  A quick glance at the board didn‚Äôt find any suitable inscriptions on the pins. <br><br><div style="text-align:center;"><img width="400" src="https://habrastorage.org/web/aa4/86b/b4e/aa486bb4e5a842f1a0e012a6ff11a9d2.png"></div><br>  In addition to RS-485 in the manual in the list of connectors is XP3 connector, which is compatible with RaspberryPi, containing the RS-232 interface.  It turned out that it is his and uses u-boot.  As we were told in technical support, ‚Äúon the Salyut-EL24D1, the console is by default outputted to a port on the same Raspberry Pi connector (UART0).  On the DB9, the UART3 is displayed. ‚Äù  They also clarified that the RS232 is a 12-volt interface, and the UART (three-volt interface) is derived on XP3 <br><br>  Having coped with this task, we saw the Linux console (we will not list the entire listing), and found that the heatsink included in the delivery is clearly needed, because without it, the processor is very hot. <br><br><img src="https://habrastorage.org/web/37d/2cd/7fb/37d2cd7fb3414edd908657246ece7fcb.png"><br><br><h3>  U-boot issues </h3><br>  After the apparent success, we started to launch Embox because, as mentioned above, we had support for the Cortex-A9, which means we lacked only the correct memory card and the UART driver to see our console. <br><br>  The memory card and description of the UART were found in the documentation, some drivers were written, but they found that the installed u-boot does not have network support, that is, you can download from the SD card, how Linux starts, or through the UART console, that is, very slowly. <br>  The support service confirmed to us that the support question was confirmed that there is no network support, since drivers are not ported to the u-boot. <br><br><div class="spoiler">  <b class="spoiler_title">A small digression to the account of the support service</b> <div class="spoiler_text">  We had the telephone number of the head of the support service, but attempts to find him on the spot were in vain.  On the other hand, he responded to the post office quickly and to the point, which is much more important. </div></div><br>  The next major problem was the cache and other settings that remain after the u-boot, for example, enabled address translation. <br><br>  The problem was the following: the assembler program simply recording something in the UART worked, and even a small Embox (several tens of kilobytes) didn‚Äôt output anything with the same driver, and in general behaved very well.  As a result, it turned out that after filling the image into memory, it is necessary to reset the cache.  We contacted the support service, after some correspondence, they reproduced the situation, suggested rebuilding the u-boot with an additional flag, flashing it in spi-flash, and additionally using the dcache flush command. <br><br>  With the included MMU, problems also arose.  In fact, the first thing we do in our loader is turning off address translation.  Enabled, if I understand correctly, the MMU was, just to enable caching, in large ARMs, if I understand correctly, caching is defined in page descriptors.  Why do I need to include a cache in the U-boot, to be honest I don‚Äôt know, but it is possible to speed up the boot. <br><br><h3>  Drivers </h3><br>  After dancing with the Embox cache, ‚Äútook off‚Äù, outputted a command line in which you could execute commands, because, as already mentioned, we had support for cortex-a9, and the standard Cortex-A9 includes the interrupt controller and timers, well, the ARMv7 standard contains work with MMU and caches.  In general, I wanted to make a network card to try at least some interesting functionality. <br><br>  The manual was a description of the network card, but of course I wanted to borrow the code as much as possible, or to have at least as an example.  There was no indication of what kind of IP core this was; the documentation in the documentation was called ‚ÄúGEMAC‚Äù.  On the Internet, the source code for this network card was stubbornly not found.  We were told in the support service that this is in fact a network card from Arasan, and the drivers were suggested to be viewed in Linux, the source code of which is available ( <a href="">link</a> ), since now this network card is not supported in the vanilla kernel. <br><br>  For the sake of interest, we looked at what else was modified in this Linux.  By running the grep command, we got the following output: <br><br><div class="spoiler">  <b class="spoiler_title">Conclusion</b> <div class="spoiler_text"><code>~/elvees/mcom02-buildroot-v2.1-2016-08-30/linux $ grep -rn ELVEES <br> arch/arm/plat-mcom/platsmp.c:2: * Copyright 2015 ELVEES NeoTek CJSC <br> arch/arm/mach-vip1/vip1.c:2: * Copyright 2015 ELVEES NeoTek CJSC <br> arch/arm/mach-vip1/vip1.c:99:DT_MACHINE_START(VIP1, "ELVEES VIP-1 (Flattened Device Tree)") <br> arch/arm/mach-mcom02/mcom02.c:2: * Copyright 2015 ELVEES NeoTek CJSC <br> arch/arm/mach-mcom02/mcom02.c:99:DT_MACHINE_START(MCOM02, "ELVEES MCom-02 (Flattened Device Tree)") <br> drivers/uio/uio_delcore30m.c:4: * Copyright 2016 ELVEES NeoTek JSC <br> drivers/mtd/nand/arasan_nfc.c:4: * Copyright (C) 2015 ELVEES NeoTek CJSC <br> drivers/media/i2c/soc_camera/ov2715.c:2: * Copyright 2015 ELVEES NeoTek CJSC <br> drivers/media/platform/soc_camera/vinc/math/math.h:2: * Copyright 2016 ELVEES NeoTek JSC <br> drivers/media/platform/soc_camera/vinc/vinc-neon.h:2: * Copyright 2016 ELVEES NeoTek JSC <br> drivers/media/platform/soc_camera/vinc/vinc-neon.c:2: * Copyright 2016 ELVEES NeoTek JSC <br> drivers/media/platform/soc_camera/vinc/vinc-driver.c:2: * Copyright 2015 ELVEES NeoTek CJSC <br> drivers/net/ethernet/arasan/arasan_gemac.c:2: * Copyright 2015 ELVEES NeoTek CJSC <br> drivers/net/ethernet/arasan/arasan_gemac.h:2: * Copyright 2015 ELVEES NeoTek CJSC <br> include/uapi/linux/vinc.h:2: * Copyright 2015 ELVEES NeoTek CJSC <br> include/uapi/linux/vpoutfb.h:2: * Copyright 2016 ELVEES NeoTek JSC</code> <br> </div></div><br>  As you can see, ELVIS uses third-party IP-cores for many of its blocks, and the blocks are sometimes so new that you have to modify the drivers yourself. <br><br>  Having started developing a driver, we couldn‚Äôt understand for a long time why we didn‚Äôt see anything in its registers, checked the base address, we were dumb, until we were told by those support that it was necessary to apply a frequency to this module.  The energy saving control module or, as described in the manual, the PMCTR controller allows you to control not only the power supply, but also the clock frequency of the device.  As a result, reading and writing registers started to work, but the PHYs did not light up the lights, that is, there was no link, and the PHY itself did not respond to any MII interface. <br><br>  In the support service we were offered to do the same as in Linux, but it was completely incomprehensible what we had forgotten about this.  That is, there was a suspicion of the reset function, or rather, the need to install the corresponding GPIO into one, but it was not easy to determine which GPIO controller is used by which leg, for us programmers who do not like to read the documentation completely.  Fortunately, the port and contact number was suggested in support (PORTB1).  Searching through the configuration prompted us to use the dwapb_gpio driver.  After correctly implementing the GPIO interface and submitting the unit to this port, the link caught fire, the PHY showed up on the seventh port of MII.  Further there were no significant problems, of course there were the usual problems with errors in implementation, but there were no special ones, as a result, the network card worked. <br><br>  To check the performance run telnet: <br><br><img src="https://habrastorage.org/web/854/bb6/b1f/854bb6b1f0f04bccb372e5fd42aac4c6.png"><br><br>  Actually, everything works quite perfectly. <br><br><h3>  findings </h3><br>  Of course, the processor from ELVIS cannot be compared with Multiklet, too unequal weight categories among companies.  But it is worth noting that the completeness of the solution is also completely different.  Of course, you can refer to the already ready software, for Cortex-A9, but even its refinement is a significant and resource-intensive problem, which Elvis solves, albeit not ideally, but quite sanity.  Or take a support service: it is also far from ideal and global companies, but still you can achieve results from it in a reasonable time. <br><br>  Therefore, with all the pros, focus on the cons. <br><br>  The main disadvantage, in my opinion, is that the purchased blocks are used.  This is an absolute advantage to enter the market, but the Cortex-A9 can hardly be called a domestic processor.  I understand perfectly well that there are two more DSP cores, but still the basis is third-party blocks with very low added value, as we like to say lately.  That is, the money from this microcircuit is mainly developed by the engineers of the companies from which these cores were purchased (ARM, ARASAN and others), and which develop the corresponding software. <br>  If we compare it with the same i.MX 6, the consumption is significantly higher, although the ELVIS company said that it is necessary to switch off unnecessary blocks, and then the consumption will be comparable.  Probably, it is, because the processor cores are the same. <br><br>  The price, to put it mildly, is high.  In ELVIS, of course, they say that the overall performance of the microcircuit is also very high, but I doubt that having several DSP cores can increase it so much to make it attractive compared to the same i.MX 6. That is, I admit that there are a number of tasks for which the price is not important, for example, avionics, but it is not clear why there are DSP cores. <br><br>  Unclear target market.  As stated in the previous paragraph, due to the high price and high performance, the class of tasks for which the use of this chip would be justified, except for those places where only domestic equipment can be used, is incomprehensible (very narrow).  The references to cameras with pattern recognition and counting the number of visitors who, as I know, exist, do not convince me personally, as well as statements that a queue of western buyers has already lined up. <br><br>  On this let me finish.  In general, I personally like that, albeit with difficulties, domestic microelectronics is developing. <br><br>  Traditionally, all that is written in the article can be reproduced <a href="https://github.com/embox/embox">from source</a> . <br><br>  <b>PS</b> In the minuses there was a personal opinion, I think <a href="http://multicore.ru/">ELVIS</a> will have worthy answers to my claims :) <br><br><div class="spoiler">  <b class="spoiler_title">As in the case of the previous test (Multiklet), we contacted the company and received the following comments, we give it literally:</b> <div class="spoiler_text">  Below are the comments of our developers to the wording: ‚Äúrather strange settings that remain after the u-boot‚Äù, ‚ÄúWith the MMU turned on, problems also arose,‚Äù and ‚ÄúAfter the dances in the cache‚Äù. <br><br>  On any Cortex-A9, after executing the 'go' command in the U-Boot cache and the MMU remain on.  This is correct and correct behavior.  The 'go' command is not intended to start the OS.  On iMX6, with which you worked, the option CONFIG_SYS_DCACHE_OFF was apparently enabled in the configuration file.  At the same time, U-Boot does not initialize the MMU and does not include the data cache. <br><br>  Booting the OS via U-Boot is performed using the 'bootm' command.  This command loads an OS image from memory.  The image in U-Boot format must be in memory.  Such an image contains the OS_TYPE field, through which U-Boot determines the necessary procedure for preparing to boot a particular OS.  In order for your OS to boot correctly, U-Boot must _know_ about the procedure for preparing to boot your OS.  See, for example, do_bootm_linux () and cleanup_before_linux (). <br><br>  We reached into the hands of the board that you had on testing and checked it for processor consumption. <br><br>  When running under Linux Buildroot 2.2 without a load at room temperature, the processor without a radiator warms up to about 43 degrees (the lid is warm, the finger is not burned).  Turning off DSP and VPU slightly reduces CPU consumption and the temperature on its case. <br><br>  Under load tests, the processor managed to warm up to 55-57 degrees (the finger from the cover is hot, but for the processor it is quite normal temperature). <br><br>  The working temperature of the processor 189214 to 85 degrees.  That is, for the Salyut-EL24D2 debug module, when the air temperature is below 50 degrees, additional cooling of the processor is not necessary. </div></div><br>  Regarding the temperature, I admit that the temperature of 50 degrees might well have seemed uncomfortable for such a convolutional measuring instrument like a finger :) <br><br>  In addition, in those support we were informed that ‚Äúas of today, this support is already integrated into U-Boot, will be in the next release of Buildroot‚Äù </div><p>Source: <a href="https://habr.com/ru/post/329170/">https://habr.com/ru/post/329170/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329154/index.html">Online ticket office: first results</a></li>
<li><a href="../329156/index.html">Two words about abstract forces ruling Worlds</a></li>
<li><a href="../329160/index.html">Unreal engine 4. Sequencer instead of Matinee</a></li>
<li><a href="../329166/index.html">Bug in NTFS, or how to hang the whole system</a></li>
<li><a href="../329168/index.html">Pygest # 9. Releases, articles, interesting projects from the world of Python [May 8, 2017 - May 22, 2017]</a></li>
<li><a href="../329174/index.html">Load testing: where to start and where to look</a></li>
<li><a href="../329176/index.html">From dependent types to homotopic type theory on Scala + Shapeless + ProvingGround</a></li>
<li><a href="../329178/index.html">PostgreSQL Diagnostic Techniques - Vladimir Borodin and Ildus Kurbangaliev</a></li>
<li><a href="../329180/index.html">We write an analogue of Paint on Objective-C</a></li>
<li><a href="../329182/index.html">Seminar "Modernization of engineering systems in the existing data center", May 31, Moscow</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>