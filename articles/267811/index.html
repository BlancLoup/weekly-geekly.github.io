<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PHP and OData: we are moving from bicycles to technology from Microsoft</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today it is fashionable to do API and many of us have already implemented some API in PHP. One of the tasks of the REST API is to give away data sets ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PHP and OData: we are moving from bicycles to technology from Microsoft</h1><div class="post__text post__text-html js-mediator-article">  Today it is fashionable to do API and many of us have already implemented some API in PHP.  One of the tasks of the REST API is to give away data sets in order to ultimately display them in a table.  To do this, among other things, you have to solve such problems: <br><br><ul><li>  validate the request </li><li>  filter the data </li><li>  sort the data </li><li>  request and give not all columns, but only some, </li><li>  implement pagination. </li></ul><br>  I do not know about you, but I see that this is often done by bicycle decisions.  The tasks are not complicated in appearance, but in order to solve them qualitatively, you have to spend a lot of time on developing, documenting and explaining to colleagues how your invention works.  I will talk about how you can accomplish these tasks very technologically with OData. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c4a/6ac/43a/c4a6ac43ae7c2332e4c490fc3e0c1b26.jpg" alt="image"><br><a name="habracut"></a><br>  I understand that many people who are friends with LAMP are strangers to the enemy fronts of all kinds of Microsoft and Windows.  But let's first see what OData is. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  What is OData </h4><br>  As written <a href="http://www.odata.org/">on the official website</a> , <br><blockquote>  OData - the best way to REST </blockquote><br>  Here is a short definition that does not differ by modesty.  It also says that it is an open protocol and that you can use it to make the RESTful API simple and standard.  Then you will see that some of this is true and that there is power in it. <br><br>  It is noteworthy that this standard is promoted not only by Microsoft.  The standard is approved by <a href="https://www.oasis-open.org/committees/tc_home.php%3Fwg_abbrev%3Dodata">OASIS</a> .  The standard is universally used in Microsoft products and <a href="http://www.odata.org/ecosystem/">in many large systems of</a> other companies. <br><br><h4>  How is OData useful? </h4><br>  If you have implemented data exchange between the client and server parts of your application using the OData protocol, then those who will use the protocol just need to give a link to your service.  Colleagues who will use your service, just read the standard <a href="http://www.odata.org/documentation/odata-version-2-0/uri-conventions/">URL format</a> to access your collections. <br><br>  In addition, you have the opportunity to save time on the development of the frontend.  To do this, you can get ready-made libraries that can work with OData.  For example, <a href="http://demos.telerik.com/kendo-ui/grid/remote-data-binding">Kendo UI</a> or free <a href="http://openui5.org/">OpenUI5</a> from SAP. <br><br>  This allows for roughly an hour to create a good technological framework for the application, where it remains to add business-specific logic to your task. <br><br><h4>  But why then OData is not used in PHP projects </h4><br>  Or almost not used.  Indeed, I diligently googled on PHP + OData, but found not so much.  And what I found made me break my head - how to make it work. <br><br>  From the point of view of implementation, two important components can be distinguished: the client (requests data) and the server (gives data).  Next, we will discuss the implementation of the server part. <br><br>  What was found.  There is an excellent project from Microsoft, with open source, it is laid out right on the githaba: <a href="https://github.com/MSOpenTech/odataphpprod">odataphpprod</a> .  In fact, this is a framework for creating a server part for PHP, which works using the OData protocol. <br><br>  I tried to use it and immediately ran into two obstacles.  First, the project did not work on Linux, although the readme of the project says that both systems are supported - Windows and Linux.  To make the project work on Linux, I had to edit the source files where the files are connected - there is a mess in the paths and registers.  Secondly, in order to realize a simple return of the list, I had to read not the shortest <a href="https://github.com/MSOpenTech/odataphpprod/tree/master/Docs">instruction</a> . <br><br>  In addition, over the past 3 years there has not been a single commit in this project. <br><br>  I continued the search, but did not find other worthy implementations, except for the fork of the aforementioned project.  Fork is called <a href="https://github.com/POData/POData">POData</a> .  The readme of this project says that PHP developers are poor, because they do not have good tools for working with OData, but the library is taken to level this misunderstanding and bring the advantages of OData to the masses.  I tried to use this fork, it went much better with it.  The project earned on Linux without any extra effort.  There is also a step by step simple dock, how to use the project together with the Zend Framework. <br><br>  I tried to use POData for my needs, but in this case I ran into minor troubles.  In particular, it was not possible to make friends with POData with a grid from OpenUI5, until I made several minor edits to POData.  And a lot of code I had to write myself.  And most of this code is quite reusable and could be part of the framework. <br><br>  In general, I see two reasons why PHP developers are still not friends with OData: <br><br><ul><li>  entry threshold - add a lot of code, documentation is not very simple, few step-by-step examples, </li><li>  rawish tools. </li></ul><br><h4>  My attempt to lower the threshold of entry and the example of an OData service </h4><br>  As I already mentioned above, a lot of code that has to be implemented to work with POData is quite reusable and will most likely be transferred from project to project without changes.  Therefore, I <a href="https://github.com/Qeti/SimplePOData">moved</a> this code to a separate library, <a href="https://github.com/Qeti/SimplePOData">SimplePOData</a> .  These are the implementation of IQueryProvider (for relational SQL databases such as MySQL) and IService. <br><br>  Next is an example of building a server part in pure PHP without using any frameworks, except perhaps POData itself. <br><br><h5>  Step 0. Install the necessary libraries </h5><br>  Create a <code>www/odata-example</code> directory for the first project with OData.  Create a file <code>composer.json</code> with the following contents: <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"require"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"qeti/simple-podata"</span></span>: <span class="hljs-string"><span class="hljs-string">"&gt;=0.9.1"</span></span> } }</code> </pre><br>  A small lyrical digression.  The POData / POData project on a githaba is, by and large, a good working draft.  But, judging by the githab data, active work on it ended two years ago.  To use the project for my own needs, I made minor improvements, sent pull requests, but the author of the project hasn‚Äôt yet responded, even when I tried to contact him through a social network.  I hope he gets in touch.  But for now, I have registered my own fork, Qeti / POData, into SimplePOData, where I committed my changes to it.  For convenience, everything is added to Packagist.  If the author of POData contacts and actively accepts the changes, there will be no sense in another fork and I will switch to his fork. <br><br>  So, to install the necessary packages, run from the console: <br><br><pre> <code class="bash hljs">composer install</code> </pre><br><h5>  Step 1. Work with URL </h5><br>  Metadata description will be available at <code><a href="http://localhost/odata-example/odata.svc/"></a> localhost/odata-example/odata.svc$metadata</code>  <code><a href="http://localhost/odata-example/odata.svc/"></a> localhost/odata-example/odata.svc$metadata</code> . <br>  So, we need to make all requests to our OData service ( <code><a href=""></a> localhost/odata-example/odata.svc</code>  <code><a href=""></a> localhost/odata-example/odata.svc</code> ) went to <code>index.php</code> .  To do this, in the root of the project, place the <code>.htaccess</code> file with the following contents: <br><br><pre> <code class="apache hljs"><span class="hljs-section"><span class="hljs-section">&lt;IfModule mod_rewrite.c&gt;</span></span> <span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteEngine</span></span></span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span> RewriteRule (\.svc.*) index.php &lt;/IfModule&gt;</code> </pre><br>  POData will take care of the rest of the work on parsing the URL. <br><br><h5>  Step 2. Implement the <code>IHTTPRequest</code> </h5><br>  We need to implement the <code>IHTTPRequest</code> interface.  This class will use POData to get URL parameters.  The implementation may vary depending on the framework used.  We will go in the simple way and we will transfer in the designer $ _GET.  Create a file <code>RequestAdapter.php</code> with the following contents: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">POData</span></span>\<span class="hljs-title"><span class="hljs-title">Common</span></span>\<span class="hljs-title"><span class="hljs-title">ODataConstants</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">POData</span></span>\<span class="hljs-title"><span class="hljs-title">OperationContext</span></span>\<span class="hljs-title"><span class="hljs-title">HTTPRequestMethod</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">POData</span></span>\<span class="hljs-title"><span class="hljs-title">OperationContext</span></span>\<span class="hljs-title"><span class="hljs-title">IHTTPRequest</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RequestAdapter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IHTTPRequest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $request; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($request)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request = $request; } <span class="hljs-comment"><span class="hljs-comment">/** * get the raw incoming url * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string RequestURI called by User with the value of QueryString */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRawUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $_SERVER[<span class="hljs-string"><span class="hljs-string">'REQUEST_SCHEME'</span></span>] . <span class="hljs-string"><span class="hljs-string">'://'</span></span> . $_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_HOST'</span></span>] . <span class="hljs-string"><span class="hljs-string">'/'</span></span> . $_SERVER[<span class="hljs-string"><span class="hljs-string">'REQUEST_URI'</span></span>]; } <span class="hljs-comment"><span class="hljs-comment">/** * get the specific request headers * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $key The header name * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string|null value of the header, NULL if header is absent. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRequestHeader</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($key)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request[$key])) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $headers = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request[$key]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Returns the Query String Parameters (QSPs) as an array of KEY-VALUE pairs. If a QSP appears twice * it will have two entries in this array * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array[] */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getQueryParameters</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $data = []; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_array(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request)) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $value) { $data[] = [$key =&gt; $value]; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $data; } <span class="hljs-comment"><span class="hljs-comment">/** * Get the HTTP method/verb of the HTTP Request * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> HTTPRequestMethod */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMethod</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HTTPRequestMethod(<span class="hljs-string"><span class="hljs-string">'GET'</span></span>); } }</code> </pre><br><h5>  Step 3. Implement the <code>IOperationContext</code> </h5><br>  This class is even simpler; it has to implement only two methods ‚Äî return request and response objects.  The request object is an instance of the above class.  The response object is an instance of <code>OutgoingResponse</code> , which is already implemented in POData so you can not deal with this class at this stage.  Create an <code>OperationContextAdapter.php</code> file: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">POData</span></span>\<span class="hljs-title"><span class="hljs-title">OperationContext</span></span>\<span class="hljs-title"><span class="hljs-title">IHTTPRequest</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">POData</span></span>\<span class="hljs-title"><span class="hljs-title">OperationContext</span></span>\<span class="hljs-title"><span class="hljs-title">IOperationContext</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">POData</span></span>\<span class="hljs-title"><span class="hljs-title">OperationContext</span></span>\<span class="hljs-title"><span class="hljs-title">Web</span></span>\<span class="hljs-title"><span class="hljs-title">OutgoingResponse</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OperationContextAdapter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IOperationContext</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> RequestAdapter; */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $request; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $response; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> yii\base\Request $request */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($request)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RequestAdapter($request); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;response = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OutgoingResponse(); } <span class="hljs-comment"><span class="hljs-comment">/** * Gets the Web request context for the request being sent. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> OutgoingResponse reference of OutgoingResponse object */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">outgoingResponse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;response; } <span class="hljs-comment"><span class="hljs-comment">/** * Gets the Web request context for the request being received. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> IHTTPRequest reference of IncomingRequest object */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">incomingRequest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request; } }</code> </pre><br><h5>  Step 4. Implementing <code>IQueryProvider</code> </h5><br>  The task of this class is to select data from your source.  As far as I understand from the documentation for the framework, the developers propose to implement in this class not only the functionality for extracting data, but the mapping of the data source with the names of tables and columns in the database.  In principle, in most cases, the names of the tables will clearly correspond to the name of the services in the URLs.  Therefore, the necessary methods are implemented in SimplePOData, but a restriction is imposed.  The service name in the <code>DocumentHasProduct</code> URL will be converted to the name of the <code>document_has_product</code> table.  If this does not suit you, you can override the <code>getTableName()</code> method. <br><br>  All you have to do is implement a method for getting a set of rows and a method for getting one value from your data source.  In our example, we will work with PDO.  Create a <code>QueryProvider.php</code> file: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">qeti</span></span>\<span class="hljs-title"><span class="hljs-title">SimplePOData</span></span>\<span class="hljs-title"><span class="hljs-title">BaseQueryProvider</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QueryProvider</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseQueryProvider</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(\PDO $db)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::__construct($db); } <span class="hljs-comment"><span class="hljs-comment">/** * Get associated array with rows * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $sql SQL query * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> array $parameters Parameters for SQL query * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> mixed[]|null */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">queryAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($sql, $parameters = null)</span></span></span><span class="hljs-function"> </span></span>{ $statement = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db-&gt;prepare($sql); $statement-&gt;execute($parameters); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $statement-&gt;fetchAll(PDO::FETCH_ASSOC); } <span class="hljs-comment"><span class="hljs-comment">/** * Get one value * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $sql SQL query * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> array $parameters Parameters for SQL query * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> mixed|null */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">queryScalar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($sql, $parameters = null)</span></span></span><span class="hljs-function"> </span></span>{ $statement = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db-&gt;prepare($sql); $statement-&gt;execute($parameters); $data = $statement-&gt;fetchAll(PDO::FETCH_COLUMN); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($data) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $data[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } }</code> </pre><br><h5>  Step 5. Classes describing data </h5><br>  We dealt with the basic things, we proceed to the description of specific data.  For example, create a product table in the database: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> product ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>, added_at <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOW</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">250</span></span>), weight <span class="hljs-built_in"><span class="hljs-built_in">DECIMAL</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>), code <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">45</span></span>) );</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Add test data to it.</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>,<span class="hljs-string"><span class="hljs-string">`added_at`</span></span>,<span class="hljs-string"><span class="hljs-string">`name`</span></span>,<span class="hljs-string"><span class="hljs-string">`weight`</span></span>,<span class="hljs-string"><span class="hljs-string">`code`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-string"><span class="hljs-string">'2013-05-07 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'Kedi'</span></span>,<span class="hljs-number"><span class="hljs-number">2.9200</span></span>,<span class="hljs-string"><span class="hljs-string">'Ked-25'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>,<span class="hljs-string"><span class="hljs-string">`added_at`</span></span>,<span class="hljs-string"><span class="hljs-string">`name`</span></span>,<span class="hljs-string"><span class="hljs-string">`weight`</span></span>,<span class="hljs-string"><span class="hljs-string">`code`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-string"><span class="hljs-string">'2009-08-05 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'Kedi'</span></span>,<span class="hljs-number"><span class="hljs-number">10.9100</span></span>,<span class="hljs-string"><span class="hljs-string">'Ked-51'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>,<span class="hljs-string"><span class="hljs-string">`added_at`</span></span>,<span class="hljs-string"><span class="hljs-string">`name`</span></span>,<span class="hljs-string"><span class="hljs-string">`weight`</span></span>,<span class="hljs-string"><span class="hljs-string">`code`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">13</span></span>,<span class="hljs-string"><span class="hljs-string">'2003-02-27 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'Kedi'</span></span>,<span class="hljs-number"><span class="hljs-number">11.7300</span></span>,<span class="hljs-string"><span class="hljs-string">'Ked-17'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>,<span class="hljs-string"><span class="hljs-string">`added_at`</span></span>,<span class="hljs-string"><span class="hljs-string">`name`</span></span>,<span class="hljs-string"><span class="hljs-string">`weight`</span></span>,<span class="hljs-string"><span class="hljs-string">`code`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">29</span></span>,<span class="hljs-string"><span class="hljs-string">'2014-12-19 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'Kedi'</span></span>,<span class="hljs-number"><span class="hljs-number">7.6100</span></span>,<span class="hljs-string"><span class="hljs-string">'Ked-29'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>,<span class="hljs-string"><span class="hljs-string">`added_at`</span></span>,<span class="hljs-string"><span class="hljs-string">`name`</span></span>,<span class="hljs-string"><span class="hljs-string">`weight`</span></span>,<span class="hljs-string"><span class="hljs-string">`code`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">33</span></span>,<span class="hljs-string"><span class="hljs-string">'2003-07-05 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'Kedi'</span></span>,<span class="hljs-number"><span class="hljs-number">11.8700</span></span>,<span class="hljs-string"><span class="hljs-string">'Ked-99'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>,<span class="hljs-string"><span class="hljs-string">`added_at`</span></span>,<span class="hljs-string"><span class="hljs-string">`name`</span></span>,<span class="hljs-string"><span class="hljs-string">`weight`</span></span>,<span class="hljs-string"><span class="hljs-string">`code`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">36</span></span>,<span class="hljs-string"><span class="hljs-string">'2015-09-15 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'Kedi'</span></span>,<span class="hljs-number"><span class="hljs-number">11.0000</span></span>,<span class="hljs-string"><span class="hljs-string">'Ked-89'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>,<span class="hljs-string"><span class="hljs-string">`added_at`</span></span>,<span class="hljs-string"><span class="hljs-string">`name`</span></span>,<span class="hljs-string"><span class="hljs-string">`weight`</span></span>,<span class="hljs-string"><span class="hljs-string">`code`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">40</span></span>,<span class="hljs-string"><span class="hljs-string">'2004-01-25 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'Kedi'</span></span>,<span class="hljs-number"><span class="hljs-number">14.8800</span></span>,<span class="hljs-string"><span class="hljs-string">'Ked-83'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>,<span class="hljs-string"><span class="hljs-string">`added_at`</span></span>,<span class="hljs-string"><span class="hljs-string">`name`</span></span>,<span class="hljs-string"><span class="hljs-string">`weight`</span></span>,<span class="hljs-string"><span class="hljs-string">`code`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">47</span></span>,<span class="hljs-string"><span class="hljs-string">'2006-04-23 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'Kedi'</span></span>,<span class="hljs-number"><span class="hljs-number">1.2100</span></span>,<span class="hljs-string"><span class="hljs-string">'Ked-62'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>,<span class="hljs-string"><span class="hljs-string">`added_at`</span></span>,<span class="hljs-string"><span class="hljs-string">`name`</span></span>,<span class="hljs-string"><span class="hljs-string">`weight`</span></span>,<span class="hljs-string"><span class="hljs-string">`code`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">51</span></span>,<span class="hljs-string"><span class="hljs-string">'2012-12-08 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'Kedi'</span></span>,<span class="hljs-number"><span class="hljs-number">12.4000</span></span>,<span class="hljs-string"><span class="hljs-string">'Ked-86'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>,<span class="hljs-string"><span class="hljs-string">`added_at`</span></span>,<span class="hljs-string"><span class="hljs-string">`name`</span></span>,<span class="hljs-string"><span class="hljs-string">`weight`</span></span>,<span class="hljs-string"><span class="hljs-string">`code`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">54</span></span>,<span class="hljs-string"><span class="hljs-string">'2010-06-09 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'Kedi'</span></span>,<span class="hljs-number"><span class="hljs-number">6.3800</span></span>,<span class="hljs-string"><span class="hljs-string">'Ked-61'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>,<span class="hljs-string"><span class="hljs-string">`added_at`</span></span>,<span class="hljs-string"><span class="hljs-string">`name`</span></span>,<span class="hljs-string"><span class="hljs-string">`weight`</span></span>,<span class="hljs-string"><span class="hljs-string">`code`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">58</span></span>,<span class="hljs-string"><span class="hljs-string">'2010-04-25 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'Kedi'</span></span>,<span class="hljs-number"><span class="hljs-number">8.8900</span></span>,<span class="hljs-string"><span class="hljs-string">'Ked-74'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>,<span class="hljs-string"><span class="hljs-string">`added_at`</span></span>,<span class="hljs-string"><span class="hljs-string">`name`</span></span>,<span class="hljs-string"><span class="hljs-string">`weight`</span></span>,<span class="hljs-string"><span class="hljs-string">`code`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">106</span></span>,<span class="hljs-string"><span class="hljs-string">'2004-04-11 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'Kedi'</span></span>,<span class="hljs-number"><span class="hljs-number">6.7100</span></span>,<span class="hljs-string"><span class="hljs-string">'Ked-44'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>,<span class="hljs-string"><span class="hljs-string">`added_at`</span></span>,<span class="hljs-string"><span class="hljs-string">`name`</span></span>,<span class="hljs-string"><span class="hljs-string">`weight`</span></span>,<span class="hljs-string"><span class="hljs-string">`code`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">134</span></span>,<span class="hljs-string"><span class="hljs-string">'2001-02-07 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'Kedi'</span></span>,<span class="hljs-number"><span class="hljs-number">2.3200</span></span>,<span class="hljs-string"><span class="hljs-string">'Ked-29'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>,<span class="hljs-string"><span class="hljs-string">`added_at`</span></span>,<span class="hljs-string"><span class="hljs-string">`name`</span></span>,<span class="hljs-string"><span class="hljs-string">`weight`</span></span>,<span class="hljs-string"><span class="hljs-string">`code`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">153</span></span>,<span class="hljs-string"><span class="hljs-string">'2002-01-13 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'Kedi'</span></span>,<span class="hljs-number"><span class="hljs-number">7.3300</span></span>,<span class="hljs-string"><span class="hljs-string">'Ked-80'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>,<span class="hljs-string"><span class="hljs-string">`added_at`</span></span>,<span class="hljs-string"><span class="hljs-string">`name`</span></span>,<span class="hljs-string"><span class="hljs-string">`weight`</span></span>,<span class="hljs-string"><span class="hljs-string">`code`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">156</span></span>,<span class="hljs-string"><span class="hljs-string">'2014-03-20 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'Kedi'</span></span>,<span class="hljs-number"><span class="hljs-number">10.9600</span></span>,<span class="hljs-string"><span class="hljs-string">'Ked-30'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>,<span class="hljs-string"><span class="hljs-string">`added_at`</span></span>,<span class="hljs-string"><span class="hljs-string">`name`</span></span>,<span class="hljs-string"><span class="hljs-string">`weight`</span></span>,<span class="hljs-string"><span class="hljs-string">`code`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">165</span></span>,<span class="hljs-string"><span class="hljs-string">'2003-07-11 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'Kedi'</span></span>,<span class="hljs-number"><span class="hljs-number">2.5300</span></span>,<span class="hljs-string"><span class="hljs-string">'Ked-90'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>,<span class="hljs-string"><span class="hljs-string">`added_at`</span></span>,<span class="hljs-string"><span class="hljs-string">`name`</span></span>,<span class="hljs-string"><span class="hljs-string">`weight`</span></span>,<span class="hljs-string"><span class="hljs-string">`code`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">176</span></span>,<span class="hljs-string"><span class="hljs-string">'2010-09-26 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'Kedi'</span></span>,<span class="hljs-number"><span class="hljs-number">7.0100</span></span>,<span class="hljs-string"><span class="hljs-string">'Ked-38'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>,<span class="hljs-string"><span class="hljs-string">`added_at`</span></span>,<span class="hljs-string"><span class="hljs-string">`name`</span></span>,<span class="hljs-string"><span class="hljs-string">`weight`</span></span>,<span class="hljs-string"><span class="hljs-string">`code`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">182</span></span>,<span class="hljs-string"><span class="hljs-string">'2007-05-07 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'Kedi'</span></span>,<span class="hljs-number"><span class="hljs-number">3.8900</span></span>,<span class="hljs-string"><span class="hljs-string">'Ked-6'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>,<span class="hljs-string"><span class="hljs-string">`added_at`</span></span>,<span class="hljs-string"><span class="hljs-string">`name`</span></span>,<span class="hljs-string"><span class="hljs-string">`weight`</span></span>,<span class="hljs-string"><span class="hljs-string">`code`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">194</span></span>,<span class="hljs-string"><span class="hljs-string">'2004-03-21 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'Kedi'</span></span>,<span class="hljs-number"><span class="hljs-number">3.1000</span></span>,<span class="hljs-string"><span class="hljs-string">'Ked-20'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>,<span class="hljs-string"><span class="hljs-string">`added_at`</span></span>,<span class="hljs-string"><span class="hljs-string">`name`</span></span>,<span class="hljs-string"><span class="hljs-string">`weight`</span></span>,<span class="hljs-string"><span class="hljs-string">`code`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">205</span></span>,<span class="hljs-string"><span class="hljs-string">'2000-06-02 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'Kedi'</span></span>,<span class="hljs-number"><span class="hljs-number">12.9500</span></span>,<span class="hljs-string"><span class="hljs-string">'Ked-20'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>,<span class="hljs-string"><span class="hljs-string">`added_at`</span></span>,<span class="hljs-string"><span class="hljs-string">`name`</span></span>,<span class="hljs-string"><span class="hljs-string">`weight`</span></span>,<span class="hljs-string"><span class="hljs-string">`code`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">212</span></span>,<span class="hljs-string"><span class="hljs-string">'2002-02-20 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'Kedi'</span></span>,<span class="hljs-number"><span class="hljs-number">2.5300</span></span>,<span class="hljs-string"><span class="hljs-string">'Ked-62'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>,<span class="hljs-string"><span class="hljs-string">`added_at`</span></span>,<span class="hljs-string"><span class="hljs-string">`name`</span></span>,<span class="hljs-string"><span class="hljs-string">`weight`</span></span>,<span class="hljs-string"><span class="hljs-string">`code`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">220</span></span>,<span class="hljs-string"><span class="hljs-string">'2000-10-19 00:00:00'</span></span>,<span class="hljs-string"><span class="hljs-string">'Kedi'</span></span>,<span class="hljs-number"><span class="hljs-number">8.4000</span></span>,<span class="hljs-string"><span class="hljs-string">'Ked-31'</span></span>);</code> </pre><br></div></div><br>  And describe the class for this table, create a file <code>models/Product.php</code> : <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">models</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">qeti</span></span>\<span class="hljs-title"><span class="hljs-title">SimplePOData</span></span>\<span class="hljs-title"><span class="hljs-title">EntityTrait</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// This trait contains method for fields mapping (between database table and this class) use EntityTrait; public $id; public $added_at; public $name; public $weight; public $code; }</span></span></code> </pre><br>  As you can see, all that is in this class is the enumeration of the fields of the product table and the connection of the <code>EntityTrait</code> trait, which implements the mapping of the names of the properties of the class and the fields of the base.  In this implementation, the names of the database fields exactly match the name of the class properties.  Those who are not satisfied for some reason, can simply make another implementation of the static <code>fromRecord()</code> method. <br><br><h5>  Step 6. Metadata </h5><br>  Now we need to describe our data so that the service understands what kind of data it is and how it is related to each other. <br><br>  Create a file <code>models/MetadataProvider.php</code> : <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">models</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">POData</span></span>\<span class="hljs-title"><span class="hljs-title">Providers</span></span>\<span class="hljs-title"><span class="hljs-title">Metadata</span></span>\<span class="hljs-title"><span class="hljs-title">Type</span></span>\<span class="hljs-title"><span class="hljs-title">EdmPrimitiveType</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">POData</span></span>\<span class="hljs-title"><span class="hljs-title">Providers</span></span>\<span class="hljs-title"><span class="hljs-title">Metadata</span></span>\<span class="hljs-title"><span class="hljs-title">SimpleMetadataProvider</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MetadataProvider</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MetaNamespace = <span class="hljs-string"><span class="hljs-string">"Data"</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Description of service * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> IMetadataProvider */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $metadata = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SimpleMetadataProvider(<span class="hljs-string"><span class="hljs-string">'Data'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::MetaNamespace); $metadata-&gt;addResourceSet(<span class="hljs-string"><span class="hljs-string">'Products'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::createProductEntityType($metadata)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $metadata; } <span class="hljs-comment"><span class="hljs-comment">/** * Describtion of Products */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProductEntityType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SimpleMetadataProvider $metadata)</span></span></span><span class="hljs-function"> </span></span>{ $et = $metadata-&gt;addEntityType(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \ReflectionClass(<span class="hljs-string"><span class="hljs-string">'\models\Product'</span></span>), <span class="hljs-string"><span class="hljs-string">'Products'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::MetaNamespace); $metadata-&gt;addKeyProperty($et, <span class="hljs-string"><span class="hljs-string">'id'</span></span>, EdmPrimitiveType::INT32); $metadata-&gt;addPrimitiveProperty($et, <span class="hljs-string"><span class="hljs-string">'added_at'</span></span>, EdmPrimitiveType::DATETIME); $metadata-&gt;addPrimitiveProperty($et, <span class="hljs-string"><span class="hljs-string">'name'</span></span>, EdmPrimitiveType::STRING); $metadata-&gt;addPrimitiveProperty($et, <span class="hljs-string"><span class="hljs-string">'weight'</span></span>, EdmPrimitiveType::DECIMAL); $metadata-&gt;addPrimitiveProperty($et, <span class="hljs-string"><span class="hljs-string">'code'</span></span>, EdmPrimitiveType::STRING); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $et; } }</code> </pre><br>  Here we described that we have a Products collection ( <code><a href="http://localhost/odata-example/odata.svc/Products"></a> localhost/odata-example/odata.svc/Products</code>  <code><a href="http://localhost/odata-example/odata.svc/Products"></a> localhost/odata-example/odata.svc/Products</code> ) and what are the fields in it. <br>  <code>addKeyProperty()</code> defines a key field.  This field is used to filter when you select a specific entry by requesting <code><a href="http://localhost/odata-example/odata.svc/Products"></a> localhost/odata-example/odata.svc/Products(1)</code>  <code><a href="http://localhost/odata-example/odata.svc/Products"></a> localhost/odata-example/odata.svc/Products(1)</code> .  <code>addPrimitiveProperty()</code> defines a regular field. <br><br><h5>  Step 7. index.php </h5><br>  Well that's all.  It remains to create <code>index.php</code> , in which you need to connect the created classes, create a connection to the database and ask POData to process the request. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">POData</span></span>\<span class="hljs-title"><span class="hljs-title">OperationContext</span></span>\<span class="hljs-title"><span class="hljs-title">ServiceHost</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">qeti</span></span>\<span class="hljs-title"><span class="hljs-title">SimplePOData</span></span>\<span class="hljs-title"><span class="hljs-title">DataService</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/vendor/autoload.php'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/OperationContextAdapter.php'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/RequestAdapter.php'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/QueryProvider.php'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/models/MetadataProvider.php'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/models/Product.php'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// DB Connection $dsn = 'mysql:dbname=yourdbname;host=127.0.0.1'; $user = 'username'; $password = 'password; $db = new \PDO($dsn, $user, $password); // Realisation of QueryProvider $db-&gt;queryProviderClassName = '\\QueryProvider'; // Controller $op = new OperationContextAdapter($_GET); $host = new ServiceHost($op); $host-&gt;setServiceUri("/odata.svc/"); $service = new DataService($db, \models\MetadataProvider::create()); $service-&gt;setHost($host); $service-&gt;handleRequest(); $odataResponse = $op-&gt;outgoingResponse(); // Headers for response foreach ($odataResponse-&gt;getHeaders() as $headerName =&gt; $headerValue) { if (!is_null($headerValue)) { header($headerName . ': ' . $headerValue); } } // Body of response echo $odataResponse-&gt;getStream();</span></span></code> </pre><br><h4>  What is the result? </h4><br>  As a result of the above, we get a service that can handle such requests. <br><br> <code>odata.svc</code> <br>  Returns a list of collections. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:atom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2005/Atom"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:app</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2007/app"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2007/app"</span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xml:base</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://localhost:80/OData-base-example/odata.svc"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">workspace</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">atom:title</span></span></span><span class="hljs-tag">&gt;</span></span>Default<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">atom:title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">collection</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Products"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">atom:title</span></span></span><span class="hljs-tag">&gt;</span></span>Products<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">atom:title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">collection</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">workspace</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  <code>odata.svc/$metadata</code> returns a description of the entities. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">edmx:Edmx</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:edmx</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/ado/2007/06/edmx"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">edmx:DataServices</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:m</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/ado/2007/08/dataservices/metadata"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:edmx</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/ado/2007/06/edmx"</span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">m:DataServiceVersion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Schema</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:d</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/ado/2007/08/dataservices"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:m</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/ado/2007/08/dataservices/metadata"</span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/ado/2007/05/edm"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Namespace</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Data"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EntityType</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Products"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyRef</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"id"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"id"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Edm.Int32"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Nullable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"added_at"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Edm.DateTime"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Nullable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Edm.String"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Nullable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"weight"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Edm.Decimal"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Nullable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"code"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Edm.String"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Nullable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EntityType</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EntityContainer</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Data"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">m:IsDefaultEntityContainer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EntitySet</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Products"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">EntityType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Data.Products"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EntityContainer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Schema</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">edmx:DataServices</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">edmx:Edmx</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  <code>odata.svc/Products</code> returns all records from the Products collection.  If this is a large collection, then you should not call it that way - it is better to limit the selection.  For example, if you call <code>odata.svc/Products?&amp;$format=json&amp;$filter=id le 5&amp;$orderby=id desc</code> , <br>  then the following will happen.  Records with id no more than 5 will be selected, data will be sorted by id in reverse order.  The result will be given in json format: <br><br><pre> <code class="hljs json">{<span class="hljs-attr"><span class="hljs-attr">"odata.metadata"</span></span>:<span class="hljs-string"><span class="hljs-string">"http://localhost:80/odata-example/odata.svc/$metadata#Products"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: [{<span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-attr"><span class="hljs-attr">"added_at"</span></span>:<span class="hljs-string"><span class="hljs-string">"2006-07-14T00:00:00"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Kon"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"weight"</span></span>:<span class="hljs-string"><span class="hljs-string">"14.1700"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"code"</span></span>:<span class="hljs-string"><span class="hljs-string">"Kon-59"</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-attr"><span class="hljs-attr">"added_at"</span></span>:<span class="hljs-string"><span class="hljs-string">"2014-03-16T00:00:00"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Kon"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"weight"</span></span>:<span class="hljs-string"><span class="hljs-string">"2.4100"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"code"</span></span>:<span class="hljs-string"><span class="hljs-string">"Kon-89"</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-attr"><span class="hljs-attr">"added_at"</span></span>:<span class="hljs-string"><span class="hljs-string">"2009-07-23T00:00:00"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Bicycle"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"weight"</span></span>:<span class="hljs-string"><span class="hljs-string">"4.3100"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"code"</span></span>:<span class="hljs-string"><span class="hljs-string">"Bic-18"</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-attr"><span class="hljs-attr">"added_at"</span></span>:<span class="hljs-string"><span class="hljs-string">"2000-03-25T00:00:00"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Samokat"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"weight"</span></span>:<span class="hljs-string"><span class="hljs-string">"8.0200"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"code"</span></span>:<span class="hljs-string"><span class="hljs-string">"Sam-96"</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-attr"><span class="hljs-attr">"added_at"</span></span>:<span class="hljs-string"><span class="hljs-string">"2006-10-22T00:00:00"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Kolyaska"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"weight"</span></span>:<span class="hljs-string"><span class="hljs-string">"10.1300"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"code"</span></span>:<span class="hljs-string"><span class="hljs-string">"Kol-97"</span></span>}]}</code> </pre><br>  As for <code>$filter</code> , here it is worth paying special attention that conditions can be complicated, use brackets, and, or operators and much more.  When parsing the conditions, the necessary checks are performed and the possibility of introducing SQL injections is excluded. <br><br>  Example of organizing pagination and selecting only specified columns: <code>odata.svc/Products?$skip=10&amp;$top=5&amp;$format=json&amp;$select=id,name&amp;$inlinecount=allpages</code> <br><br><pre> <code class="xml hljs">{"odata.metadata":"http://localhost:80/odata-example/odata.svc/$metadata#Products", "odata.count":"1002", "value": [{"id":11,"name":"Motoroller"}, {"id":12,"name":"Kolyaska"}, {"id":13,"name":"Kedi"}, {"id":14,"name":"Roliki"}, {"id":15,"name":"Doska"}]}</code> </pre><br>  When specifying <code>$inlinecount=allpages</code> you receive in the response in the odata.count field the number of records in the sample, as if the LIMIT operator was not used in the SQL query. <br><br> <code>odata.svc/Products(5)?$format=json</code> <br>  Returns product data with id = 5 <br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"odata.metadata"</span></span>:<span class="hljs-string"><span class="hljs-string">"http://localhost:80/odata-example/odata.svc/$metadata#Products/@Element"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"added_at"</span></span>:<span class="hljs-string"><span class="hljs-string">"2006-10-22T00:00:00"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Kolyaska"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"weight"</span></span>:<span class="hljs-string"><span class="hljs-string">"10.1300"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"code"</span></span>:<span class="hljs-string"><span class="hljs-string">"Kol-97"</span></span> }</code> </pre><br>  <code>odata.svc/Products/$count</code> - the number of records. <br><br><h4>  Those who do not want to make save-pastes </h4><br>  If you are interested in using OData in your PHP project, you want to make an example, but you don‚Äôt want to copy-paste, you can do even easier.  The above example <a href="https://github.com/Qeti/OData-base-example">is on a githaba</a> - follow the instructions in the readme. <br><br><h4>  Bonus </h4><br>  And if you want a live confirmation that now you can program anything without getting a ready implementation of the frontend, take a look at <a href="https://github.com/Qeti/OpenUI5-OData-Table-Example">this example</a> .  You can sort by columns, use pagination - everything works.  Here is what it will look like: <br><br><img src="http://storage6.static.itmages.ru/i/15/0927/h_1443390096_5556674_2f3954b932.png" alt="image"><br><br><h4>  Summary </h4><br><h5>  What good </h5><br><ul><li>  It turns out that the working implementation of the server part of OData is in PHP. </li><li>  It allows you to save a lot of power when developing a frontend. </li><li>  Ready implementation of primary validation, filtering and data sorting, pagination. </li><li>  Protection against SQL injection. </li></ul><br><h5>  What are the cons </h5><br><ul><li>  So far, POData has support for GET requests only. </li><li>  At the moment there are not enough examples of use. </li></ul><br>  Personally, having weighed the pros and cons, I tend to think that the technology should be used in my projects.  If something is missing in POData (for example, INSERT, UPDATE, DELETE operations), then it‚Äôs easy to add the missing one.  I hope that you will be able to benefit from the material. <br><br>  I would like to get more feedback.  Will you work with OData in your projects?  What do you think of the above? </div><p>Source: <a href="https://habr.com/ru/post/267811/">https://habr.com/ru/post/267811/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267795/index.html">The digest of interesting materials for the mobile # 122 developer (September 21-27)</a></li>
<li><a href="../267797/index.html">Console of the 21st century: mosh, tmux, fish</a></li>
<li><a href="../267799/index.html">New PHP, Part 2: Scalar types</a></li>
<li><a href="../267801/index.html">CSS games. Part 2: StarCraft</a></li>
<li><a href="../267803/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ178 (September 21 - 27, 2015)</a></li>
<li><a href="../267813/index.html">Deploy infrastructure for development in the cloud InfoboxCloud. Part 1: Starting Gitlab</a></li>
<li><a href="../267815/index.html">We connect Intel devices for the Internet of things to Microsoft Azure IoT Suite</a></li>
<li><a href="../267817/index.html">Operation BATMAN: Adding Core Modules to Yocto on Intel Edison</a></li>
<li><a href="../267819/index.html">Escene ES330-N / ES330-PN IP Phones Review with Escene ESM 32 Expansion Module</a></li>
<li><a href="../267823/index.html">Who has not connected to the web? We connect remote regions with balloons, drones and an armada of satellites</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>