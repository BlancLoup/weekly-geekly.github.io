<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>9 circles of warehouse automation Lamoda</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Our warehouse is the size of two Red Squares and is 5 floors high and works all year round and never sleeps - 24/7,364 days a year (the only day off i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>9 circles of warehouse automation Lamoda</h1><div class="post__text post__text-html js-mediator-article">  Our warehouse is the size of two Red Squares and is 5 floors high and works all year round and never sleeps - 24/7,364 days a year (the only day off is January 1).  We have stored and maintained more than 8,000,000 products, every day more than 300 operators are replacing them.  They work with products coming from all over the world and collect orders for users from four countries: Russia, Ukraine, Belarus and Kazakhstan.  On such a scale, business requires flawless automation. <br><br>  Under the cut, I, Pasha Finkelstein - team leader of the development and automation of the warehouse - I will tell you what the open source solution can grow if you attach a good development team and a very specific business problem to it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/07f/fc8/d44/07ffc8d44536a1ea90fb4755eb2ee06a.jpg"><br><a name="habracut"></a><br><h2>  The basic logic of the work </h2><br>  Three main processes of any warehouse: acceptance of the goods, their storage and shipment.  Simplified, the cycle of our warehouse looks like this: primary identification, quality control, placement, selection and reservation for an order, search, sorting, packaging, transfer to the delivery service.  When the customer returns the product, the cycle repeats.  Each physical entity involved in these processes has its own informational representation, for example: truck, product, cabinet cell, parcel, packaging material, container, etc.  All significant movements and changes in the status of the goods are transmitted to the accounting systems and absolutely every action with the goods inside the warehouse is logged. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      WMS (Warehouse Management System) controls the life cycle of each item in stock from the moment a truck arrives at the warehouse to the shipment of goods to the customer. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/58e/269/41b/58e26941b0d48719f1330c7d91511db9.jpg"><br><br><h2>  Specific automation fashion </h2><br>  Our company works in the field of fashion and lifestyle, which puts certain tasks in the warehouse: the goods can be fragile (glasses, watches), non-standard size (winter boots or jewelry), premium (in special packaging) - or have other specific characteristics that warehouse must take into account.  Therefore, the use of manual labor in storage areas can not be completely abandoned. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/396/543/c82/396543c82a6d780bb26781e69a6acdec.jpg"><br><br>  All other processes are automated - receiving goods, moving to the shipping area, sorting, packaging and preparing for shipment.  Each of these processes requires special equipment and an operational process.  Magic happens when all these processes stick together and start working together - thanks to our systems. <br><br>  Any mistake in the automation of the warehouse - whether it is an interface that contributes to operator errors, a non-optimal process, etc.  - This is a delay in shipping, the entire complex is simple, huge losses.  In addition, with each mistake we form a negative customer experience.  Therefore, it is important for us that the warehouse works like a clock. <br><br><h2>  Open source and the way to own development </h2><br>  At the opening stage, we used an external warehouse.  As volumes grew, we began to realize that we needed complete control over operational processes and a high rate of change in these processes, so we decided to move towards our own warehouse and development. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/077/011/038/0770110384fcb3e136948883f60de8c8.jpg"><br><br><blockquote>  The main question that then arose before us is the elaboration of operational processes in all details.  To the point where and how employees go, how many scans they do, etc.  And over these processes it was necessary to deploy a WMS that manages operations and automates routine operations. </blockquote><br>  To begin with, we took an open source solution in Java and afterwards decided to put together our own development team, especially since there is already a suitable basis.  We increased functionality, then we took on the core of the system: we got rid of legacy and fat client, refactored, developed new services to support operational processes. <br><br><h2>  Automation Stages </h2><br>  The main changes were made by ‚Äúwaves‚Äù, along with the restructuring of the processes themselves. <br><br><blockquote>  To date, he has experienced nine stages of modernization, and we do not plan to dwell on this. </blockquote><br><ul><li>  At the first and second stages, we automated the processes of shipment of orders - we added pipelines, logic for sorting goods, automated sorting of orders by pallets. <br></li><li>  At the third and fourth stages, we focused on the acceptance processes: we learned how to separate the flows of incoming goods according to different types and storage zones. <br></li><li>  The fifth phase added automated elevators between floors - work began in the storage area. <br></li><li>  The sixth phase was the most responsible when we closed the acceptance and shipment zones, thus looping all the automation. <br></li><li>  In the seventh and eighth phases, we made changes to the processes in the receiving zone and added new zones, elevators and conveyors: we scaled the existing automation. <br></li><li>  In the ninth phase, a new building was attached to the warehouse and integrated with the existing automation system. <br></li></ul><br><h2>  Implementation </h2><br>  Our core technologies: Java, Postgres, Wildfly, Redis, ActiveMQ. <br><br>  WMS is written in Java 8. But not so long ago we corrected the last module, which prevented the transition to Java 11, will be updated in the near future. <br><br>  Under WMS reserved server rack, installed directly in stock.  This gives us much more confidence that the WMS will work even if electricity and / or the Internet is turned off.  The only thing that will suffer - messages to the accounting system will come with a delay.  WildFly is used as an application server, but not yet the latest version.  Migration to the latter is also in the plans.  Everything has already been written for the move, but we did not have time to conduct functional and load testing, and the load is relatively high before the new year.  Also used proven ActiveMQ. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xw/qe/ue/xwqeueu8jlnqlc4gthjnscjbs54.jpeg"></div><br>  We store the data in PostgreSQL.  The main entity in our system, obviously, is the product.  Sometimes warehouse staff think up workarounds to simplify their work, for example, they scan the same bar code 50 times, and the product itself is simply thrown by hand without scanning, without going into details, whether it is jeans or T-shirts, so we entered labels identifying a specific unit. product, supporting it in the infrastructure.  Information about these units is stored in a 2-terabyte PostgreSQL database. <br><br>  Most of the space there is not even the goods, but the audit of the actions of warehouse workers.  Being a critical system for a business, the warehouse must know why something appeared in the system or disappeared - we cannot allow non-traceable changes.  Right now we are thinking of bringing this part of the database to a separate entity in MongoDB. <br><br>  Warehouse workers' workstations are thin web clients.  Somewhere at the start of automation, it all worked on the principle of a fat client, which created certain difficulties, in particular, with large releases that included changes in the interface: about 150 workstations had to be updated manually.  This and the fact that we could not be released without idle time, put restrictions on us - we could deploy no more than twice a week, early in the morning, when the night shift ends working, which cannot be called a convenient schedule.  Now we have transferred the WMS to the web and by the end of the year we will finally give up fat clients, which will make it very easy for us to change the user interface.  The web and the clustering added at one of the stages remove the restrictions on the frequency and time of releases - now users will learn about releases only if something went wrong. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ccd/d87/54e/ccdd8754eb96b3dd528300dca4f35e4b.png"><br><br>  There is also an interesting "exotic" in our warehouse.  For example, the Haskell mentioned in the <a href="https%253A%252F%252Fdocs.google.com%252Fspreadsheets%252Fd%252F1tV4uowMRiCRfPQd5X_LvMu3GTMTfcg0AxLxel_Y7UWQ%252Fpubhtml%253Fgid%253D0%2526single%253Dtrue">Technoradar</a> on which the item sorter visualization backend is written (this is a machine that can make goods from one parcel together and give them to the operator for assembly).  There is a purely computational problem, which is conveniently solved in a functional style.  Naturally, no one is going to use Haskell for any large-scale projects. <br><br>  Another element of the warehouse, which we mentioned in the <a href="https://habr.com/company/lamoda/blog/428411/">article on Tekhnoradar,</a> is a samopisnaya <a href="https://habr.com/company/lamoda/blog/428411/">state</a> machine, which ‚Äúmonitors‚Äù the correct sequence of actions with each product.  It, like the entire system, developed iteratively, starting with a simple set of constraints.  Now it is a very handy thing, deeply integrated into our system.  We hope in the near future to put it in <a href="https://github.com/lamoda">open source</a> - perhaps it will be useful not only to us. <br><br><h2>  Automation equipment </h2><br>  What kind of automation without equipment!  The entire warehouse is entangled by a network of conveyors. <br><br>  The above-mentioned item sorter works at the shipment stage, allowing you to decompose tens of thousands of units assembled from the stock of goods for specific orders.  At one time, the sorter saved our operators from having to travel with a trolley throughout the warehouse to collect the necessary goods.  Orders are fragmented, each operator collects goods only from his own floor (saving time on movements), and the sorter ensures that products from different floors get into the necessary orders automatically.  Changing the operational process 4 times faster order assembly and significantly reduced the number of errors. <br><br>  All automated equipment is provided by our partner.  They have their own system responsible for managing specific units, which is located in the server rack next to our WMS.  Integration is set up between systems on a fairly high-level protocol - we communicate using SOAP.  From our operational processes inside the WMS, we refer to their system when, for example, we need to move the container with the goods from point A to point B. Ie  From the point of view of our system, all this automation looks pretty simple, despite its real internal complexity. <br><br>  Of course, this apparent simplicity did not work right away.  In the early stages of automation, we had a ‚Äúmutual lapping‚Äù of technologies.  Once the conveyor literally burned our goods - the speed of the conveyor belt was too high, it ‚Äúburned‚Äù the goods and it burned down, which blocked the assembly of other orders.  Perhaps the hardest story happened at the start of automation, when we started the first phase.  Yesterday, the warehouse was completely manual, and today, after switching the knife switch, it should become automatic.  But it didn‚Äôt work: due to an error in the integration of the system, they misinterpreted each other‚Äôs messages, which resulted in several days of idle storage and multi-million losses for us. <br><br>  Now the partner is present in our warehouse, planning equipment placement with us when it comes to a new round of automation, helps to test new units. <br><br><h2>  Team and scrumban </h2><br>  The development of this whole system is now engaged in a team of 12 people.  At one of the last stages in the peaks of modernization, when separately automated processes had to unite into something whole, up to 20 developers alone participated (that stage required 132 person-months and included more than 1500 commits).  But as far as the end of large-scale transformations, some people decided to study Go or Python and switched to other development teams. <br><br>  In the team, we have ‚Äúclassic‚Äù product managers who combine product and product functions from the IT side (on average, one PM for 5-6 people).  His task is to communicate with our main customer - a warehouse represented by its director and the department of development of operational processes.  For our part, we are more concerned with technical modernization ‚Äî choosing the right stack, updates, etc.  - and the guys from the warehouse think about process optimization. <br><br>  Sometimes we ourselves devote time to "R &amp; D in the field."  In the literal sense, we arrive at the warehouse, communicate with senior shifts, with ordinary operators, clarify what problems they have, with which it is convenient and inconvenient to work.  In other words, we conduct user experience research. <br><br>  Thanks to this approach, for example, we have transformed the interface of the workplace of an employee who accepts goods.  Initially, it was an enterprise complex interface with many fields, buttons and abbreviations instead of text explanations.  But we tried to optimize the process, as well as the design, making it more similar to the main Google search page - not so beautiful, but very functional.  The simpler the interface and the smaller the operator‚Äôs options, where to click and what to scan, the fewer errors (and time spent on correcting them). <br><br><blockquote>  And the accumulated knowledge on the optimization of parts now overtakes us at the most unexpected moments: once our team sat in an institution and at one moment almost all the participants saw the sequence of actions of the cashier.  After 40 seconds, a colleague voiced a common thought: ‚ÄúNot very optimal, you can simplify.‚Äù </blockquote><br>  Although the relationship between the roles in the team is quite classic, we chose scrumban as a development methodology. <br><br>  We experimented a lot with methodologies, while the ‚Äúintroductory‚Äù data were non-standard.  For example, we had rather rare releases.  The above-mentioned limitation of two releases per week was acted on the part of the processes, but in fact we deplored much less often - on average once every two weeks.  In addition, we had the hardware part of warehouse automation, the development of which is carried out by an external company on clean waterfall, where all changes are written two years in advance with all the necessary documentation.  However, we ourselves could not follow their example: we needed to make some changes to the system on a regular basis, and it was pointless to force the customer to write detailed tasks for each of them. <br><br>  So scrumban is a compromise that suits everyone.  We use an iterative process, but the sprint for us is the release.  Once a month we meet with the customer and deal with release planning: we discuss what we roll out on what week.  A kanban is implemented inside the sprint - with backlog of tasks, progress, etc.  True, this process is gradually changing - for example, we have no kanban boards.  Just when one developer finishes his task, he is given the next one from the pool in accordance with the plans for the next release and the competencies of the developer himself. <br><br>  We like this approach.  It provides the necessary flexibility within iterations, and the business customer gives predictability of the dates by which certain commits will be implemented.  And we are not as important as this methodology is called.  The main thing is that everything works. <br><br><h2>  Not like everyone else - on the example of inventory and monitoring </h2><br>  Developing operational processes, we were repelled by the needs of our industry; therefore, we have quite a few individual features. <br><br>  A good example is inventory.  By law, it must be performed in a warehouse once a year, but our business requirements determine more closely monitoring the flow.  Firstly, we want to reflect on the site up-to-date information on the availability of goods, and secondly, our B2B partners, fashion brands, require the same up-to-date information.  Therefore, our inventory takes place daily, 364 days a year, shelf after shelf in the entire 5-storey complex of several buildings.  And this process is fully supported by our WMS - on a ready-made solution it would be hard to implement this. <br><br>  Now inventory is in the process of the next update to improve the efficiency of this process. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1bc/923/dc8/1bc923dc8f88e94e0be0b0099b0f7eca.jpg"><br><br>  Another example of its own design is monitoring.  It is implemented through a web client and allows you to display and track very interesting metrics.  Moreover, it is important for us to visualize these metrics.  In fact, monitoring is a warehouse drawn in a simple graphic, where we clearly see where everything works well and where problems are observed (up to a particular operator).  The main thing is that with such an idea we can understand why these problems arise. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3f1/3ac/373/3f13ac3730e932a0a73bbf8e7a2eb9d0.png"><br><br><h2>  KPI Warehouse Workers and Redis </h2><br>  The introduction of new technologies, updates, refactoring is all great.  But our WMS works in a real business, so it‚Äôs not only these tasks that have to be solved here.  Part of our work is protection from internal ‚Äúhackers‚Äù - resourceful warehouse staff who invent new ways to perform KPI to bypass the task. <br><br>  For example, not so long ago we had to add Redis to the stack in order to exclude users from logging into the system from several workstations at the same time and implement a session timeout.  The fact is that warehouse workers have guessed that working under one login and getting a bonus for overfulfilling KPI is much more beneficial than increasing their own productivity. <br><br>  Since the solution of the business problem required changes in various parts of the system, from a technical point of view it was a very interesting person. <br><br>  On this surprises from the warehouse staff are not over.  Almost immediately after the release of the session, PostgreSQL began to fall.  We searched for the reasons for the unexpected degradation of the base for several days, until we discovered that the matter was, again, in resourcefulness.  One girl often went to smoke.  When she left the workplace, she was knocked out of the session, and to log back in, you need to find a senior shift and scan his badge.  Cutting her wanderings around the warehouse, she simply tore off the barcode from one of the carts and fixed the scanner button with tape, setting the barcode to constant scanning.  And it could go unnoticed for a long time, if the bar code was not from a cart in which 800 units of goods lay.  With each scan, a huge SQL query was generated for validating products, which ‚Äúkilled‚Äù the base with such ‚Äúinternal DDoS‚Äù.  We had to take care of the restrictions on the number of scans per unit of time and on the number of goods in the cart. <br><br>  Such stories have accumulated quite a lot, and we are constantly faced with new ones.  In this case, the system must adapt each time to new conditions.  In such situations, one cannot restrict oneself to administrative methods - what happened once may well be repeated. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/55e/0d0/918/55e0d0918af62003dda046cc44fdb98a.jpg"><br><br><h2>  Where are we going next? </h2><br>  Process optimization and warehouse automation, it seems, is impossible to complete.  It has been in the company for 5 years, and, as I said above, even after stage 9, we are not going to stop.  The company continues to expand both in B2C and B2B, so that in the near future we are planning another big project - opening another warehouse, this will require either large-scale rewriting of the existing system, or creating a similar one from scratch in a new place.  And this is a new interesting challenge at the intersection of business, physical facilities, operational processes and technical solutions. </div><p>Source: <a href="https://habr.com/ru/post/432394/">https://habr.com/ru/post/432394/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../432380/index.html">Six years of life with an iPhone that does not distract me</a></li>
<li><a href="../432382/index.html">AI in the game Hase und Igel: minimax for three</a></li>
<li><a href="../432384/index.html">Study: 22% of Tumblr users go to a porn site, especially young girls</a></li>
<li><a href="../432386/index.html">Round Table "IT Project Architect", September 2018</a></li>
<li><a href="../432392/index.html">We had old school games and some mushrooms: mission completed</a></li>
<li><a href="../432398/index.html">STM32 bootloader DFU mode using CubeMX. Instructions step by step, step by step</a></li>
<li><a href="../432400/index.html">CS: GO game became free</a></li>
<li><a href="../432402/index.html">Hey HR, where's my souvenir?</a></li>
<li><a href="../432404/index.html">Backup for Linux does not write letters</a></li>
<li><a href="../432406/index.html">DEV Labs 2018. Online MAP for C ++ developers. December 15</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>