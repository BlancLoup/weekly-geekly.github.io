<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Bookmarklet: analysis of essential points, part two, loadable</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recall that a bookmarklet is a small javascript code stored in browser bookmarks and designed to perform any tasks on the current web page. 

 As note...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Bookmarklet: analysis of essential points, part two, loadable</h1><div class="post__text post__text-html js-mediator-article">  Recall that a bookmarklet is a small javascript code stored in browser bookmarks and designed to perform any tasks on the current web page. <br><br>  As noted in the <a href="http://habrahabr.ru/company/theonlypage/blog/234427/">previous post, the</a> bookmarklet can be divided into 3 interacting parts: <br><ol><li>  The first part, a small, up to 2000 characters javascript code, which is stored in browser bookmarks and, in the simplest case, can do all the work, but usually serves to <i>initiate the</i> work of the bookmarklet. </li><li>  The second, <i>loadable</i> part of the bookmarklet: javascript code that is <i>loaded</i> into the current document during the bookmarklet <i>initiation</i> process and provides the main functionality. </li><li>  The third, <i>backup</i> part of the bookmarklet that works if you load javascript into the current document failed. </li></ol><br>  The first part of the bookmarklet was thoroughly disassembled in the previous post on the live example of the bookmarklet of the web service <a href="http://www.theonlypage.com/">TheOnlyPage</a> (a service for storing bookmarks, notes and html fragments) <br><br>  This time we will focus on the loaded part of the bookmarklet. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The variety of possible actions of the <i>loading</i> part of the bookmarklet is immense, therefore we will consider only the most significant moments. <br><a name="habracut"></a><br>  This time we will not examine the source code line by line, but analyze some problem points and the best ways to solve them.  Thus, you will get the following set of individual nodes for creating a <i>downloadable</i> part of the bookmarklet: <br><br><ol><li>  Wrap - Isolation of the bookmarklet code from the external environment </li><li>  Turn on and off the load on / off indicator </li><li>  Reset CSS styles </li><li>  Loading libraries </li></ol><br>  For clarity, we will illustrate the material in question, referring to the work of the bookmarklet of the web service <a href="http://www.theonlypage.com/">TheOnlyPage</a> .  Detailed information on how to install this bookmarklet can be obtained in <a href="http://help.theonlypage.com/ru_bookmarklet.html">the web service help system.</a> <br><br><h2>  Wrap - isolation of the bookmarklet from the external environment </h2><br>  In a <a href="http://habrahabr.ru/company/theonlypage/blog/234427/">previous publication,</a> we already said that the javascript code of the bookmarklet must be placed inside an anonymous function.  The same is true for the code of the second, <i>loadable</i> part of the bookmarklet.  This code should be wrapped in an anonymous function approximately as follows: <br><br><pre><code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">window, undefined</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     })(window);</span></span></code> </pre> <br>  The anonymous function contains 2 parameters <code>window</code> and <code>undefined</code> , which is done so that instead of the reusable global variables <code>window</code> and <code>undefined</code> , the local variables <code>window</code> and <code>undefined</code> are used in the body of the function, which are easily compressed using javascript minifiers. <br>  Calling an anonymous function passes only one parameter: the <code>window</code> .  The second parameter automatically takes the required value <code>undefined</code> , <i>without being passed</i> to the function. <br><br><h2>  Turn on and off the load on / off indicator </h2><br>  After the second, <i>downloadable</i> part of the bookmarklet is successfully downloaded, it's time to turn off <i>the download indicator</i> , which in the bookmarklet of the web service <a href="http://www.theonlypage.com/">TheOnlyPage</a> looks like this: <img src="https://habrastorage.org/getpro/habr/post_images/b02/c9b/c55/b02c9bc55795d380f1e4edcda70225dd.gif" alt="image">  . <br>  The simple action to disable the load indicator is as follows: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// id  : theonlypageAjaxLoaderGif var image = window.document.getElementById('theonlypageAjaxLoaderGif'); //   image.parentNode.removeChild(image);</span></span></code> </pre><br>  When adding additional visual elements to the current document, it makes sense to wrap them in a common container.  In the bookmarklet of the web service <a href="http://www.theonlypage.com/">TheOnlyPage</a> it is implemented like this: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   div var veil = window.document.createElement('div'); //    id veil.id = 'theonlypageContainer'; // , ,   ‚Ä¶ // ‚Ä¶    // ‚Ä¶    //       window.document.body.appendChild(veil);</span></span></code> </pre><br>  As already mentioned in the <a href="http://habrahabr.ru/company/theonlypage/blog/234427/">previous publication,</a> <b>an important point</b> is the use of unique <code>id</code> on a foreign web page.  For this <code>id</code> you can use the name of the web service.  In our case, it is <code>theonlypageContainer</code> . <br><br>  If markup elements added by a bookmarklet are placed in a container marked with a specific <code>id</code> , then when reloading, you can implement a bookmarklet <i>shutdown</i> mechanism: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> veil = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.document.getElementById(<span class="hljs-string"><span class="hljs-string">'theonlypageContainer'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(veil){ <span class="hljs-comment"><span class="hljs-comment">//        //      veil.parentNode.removeChild(veil); //     return; }</span></span></code> </pre><br>  All visual elements from the current page are deleted and the bookmarklet is turned off.  In this way, the mechanism of on / off bookmarklet is realized by successively clicking on the bookmarklet link in the browser bookmarks bar. <br><br><h2>  Reset CSS styles </h2><br>  When you embed your markup elements in someone else‚Äôs document, you need to keep in mind that these elements can inherit the CSS properties of the current document.  And, as a result, our <code>div</code> will, for example, have completely unnecessary indents, and our <code>iframe</code> inside it, for example, completely inappropriate shadows. <br><br>  To get rid of possible rounding, colors, indents, animation effects and other unnecessary properties, we need to reset the styles of each created element as follows: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     CSS    var ResetCSS = "animation:none;animation-delay:0;animation-direction:normal;animation-duration:0;animation-fill-mode:none;animation-iteration-count:1;animation-name:none;animation-play-state:running;animation-timing-function:ease;backface-visibility:visible;background:0;background-attachment:scroll;background-clip:border-box;background-color:transparent;background-image:none;background-origin:padding-box;background-position:0 0;background-position-x:0;background-position-y:0;background-repeat:repeat;background-size:auto auto;border:0;border-style:none;border-width:medium;border-color:inherit;border-bottom:0;border-bottom-color:inherit;border-bottom-left-radius:0;border-bottom-right-radius:0;border-bottom-style:none;border-bottom-width:medium;border-collapse:separate;border-image:none;border-left:0;border-left-color:inherit;border-left-style:none;border-left-width:medium;border-radius:0;border-right:0;border-right-color:inherit;border-right-style:none;border-right-width:medium;border-spacing:0;border-top:0;border-top-color:inherit;border-top-left-radius:0;border-top-right-radius:0;border-top-style:none;border-top-width:medium;bottom:auto;box-shadow:none;box-sizing:content-box;caption-side:top;clear:none;clip:auto;color:inherit;columns:auto;column-count:auto;column-fill:balance;column-gap:normal;column-rule:medium none currentColor;column-rule-color:currentColor;column-rule-style:none;column-rule-width:none;column-span:1;column-width:auto;content:normal;counter-increment:none;counter-reset:none;cursor:auto;direction:ltr;display:inline;empty-cells:show;float:none;font:normal;font-family:inherit;font-size:medium;font-style:normal;font-variant:normal;font-weight:normal;height:auto;hyphens:none;left:auto;letter-spacing:normal;line-height:normal;list-style:none;list-style-image:none;list-style-position:outside;list-style-type:disc;margin:0;margin-bottom:0;margin-left:0;margin-right:0;margin-top:0;max-height:none;max-width:none;min-height:0;min-width:0;opacity:1;orphans:0;outline:0;outline-color:invert;outline-style:none;outline-width:medium;overflow:visible;overflow-x:visible;overflow-y:visible;padding:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;page-break-after:auto;page-break-before:auto;page-break-inside:auto;perspective:none;perspective-origin:50% 50%;position:static;right:auto;tab-size:8;table-layout:auto;text-align:inherit;text-align-last:auto;text-decoration:none;text-decoration-color:inherit;text-decoration-line:none;text-decoration-style:solid;text-indent:0;text-shadow:none;text-transform:none;top:auto;transform:none;transform-style:flat;transition:none;transition-delay:0s;transition-duration:0s;transition-property:none;transition-timing-function:ease;unicode-bidi:normal;vertical-align:baseline;visibility:visible;white-space:normal;widows:0;width:auto;word-spacing:normal;z-index:auto;"; //  ,      ‚Ä¶ // ‚Ä¶   CSS    ‚Ä¶ // ‚Ä¶    CSS      veil.style.cssText = ResetCSS + 'position:absolute ;background-color:rgba(0,0,0,.2); cursor:pointer; ';</span></span></code> </pre><br><br><h2>  Loading libraries </h2><br>  <a href="http://www.theonlypage.com/">TheOnlyPage downloadable</a> part of the bookmarklet <a href="http://www.theonlypage.com/">does</a> not use additional libraries, however, if necessary, it is easy to use additional libraries. <br><br>  Consider the most widely requested option - loading the <b>jQuery</b> library <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//    jQuery var v = "1.11.1"; if (window.jQuery===undefined||window.jQuery.fn.jquery&lt;v){ //   jQuery     jQuery   //   //       var script=document.createElement('script'); //       script.src="https://ajax.googleapis.com/ajax/libs/jquery/"+v+"/jquery.min.js"; script.async=true; //     var entry=document.getElementsByTagName('script')[0]; entry.parentNode.insertBefore(script,entry); script.onload=script.onreadystatechange=function(){ var readyState=script.readyState; if (!readyState||/complete|loaded/.test(script.readyState)){ //    //        main(); //     ... // ...      script.onload = null; script.onreadystatechange = null; } }; }else{ main(); } var main=function(){ //       }</span></span></code> </pre><br><br>  <b>An important point</b> , which has already been noted in the <a href="http://habrahabr.ru/company/theonlypage/blog/234427/">previous publication,</a> if the downloadable javascript code has the address protocol: <code>http://</code> then errors will occur when working on the current page, the address protocol of which is: <code>https://</code> .  The reason for this is: restrictions imposed on <i>mixed active content</i> ( <i>mixed active content</i> ), which prohibit downloading code from unprotected addresses into a document protected by TLS (SSL).  There are 2 ways to ensure that the javascript code always loads normally: <br><ol><li>  or place it at the address with the <code>https://</code> protocol </li><li>  or use a special <code>//</code> notation, for example: <br> <code>script.src='//ajax.googleapis.com/ajax/libs/jquery/v.1.11.1/jquery.min.js'</code> <br>  which means using the same protocol as the parent document.  Then, depending on the protocol of the current web page <code>http://</code> or <code>https://</code> , the corresponding address will be used: <br> <code><a href=""></a> ajax.googleapis.com/ajax/libs/jquery/v.1.11.1/jquery.min.js</code> <br>  or <br> <code><a href=""></a> ajax.googleapis.com/ajax/libs/jquery/v.1.11.1/jquery.min.js</code> </li> </ol><br>  By the way, if you intend to use the <b>jQuery</b> library, then you should pay attention to the following <b>important point</b> : to avoid possible conflicts, it is unacceptable to use the <code>$</code> abbreviation of the <code>jQuery</code> global variable, since the global variable <code>$</code> likely to be already used in the scripts of the current document, not as an alias for <code>jQuery</code> , but like another global variable, for example from the library <b>Prototype.JS</b> .  Therefore, we use only <code>jQuery</code> , without abbreviations. <br><br>  We covered all the basic elements of the <i>downloadable part of the bookmarklet</i> , but there are two more topics for discussion: <br><ol><li>  cross-domain messaging with the server; </li><li>  Authentication of web service users when working with a bookmarklet. </li></ol><br>  However, these topics require a separate place and time, and separate publications will be devoted to them. </div><p>Source: <a href="https://habr.com/ru/post/236315/">https://habr.com/ru/post/236315/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../236299/index.html">Review of the "hybrid" DVR with touch control</a></li>
<li><a href="../236301/index.html">Smart Watch Moto 360: a full analysis of iFixit (and 3 out of 10 scale of repairability)</a></li>
<li><a href="../236307/index.html">HTC One firmware in fastboot</a></li>
<li><a href="../236309/index.html">Finding simple on hard: tips & tricks</a></li>
<li><a href="../236313/index.html">Microsoft buys development company Minecraft for $ 2 billion</a></li>
<li><a href="../236317/index.html">Zenfone 4 Review</a></li>
<li><a href="../236319/index.html">New features of Google Search in site links</a></li>
<li><a href="../236321/index.html">Formula E: Electric Car Racing</a></li>
<li><a href="../236323/index.html">Thermostat Nest has become even smarter</a></li>
<li><a href="../236325/index.html">Message Passing in F #. Application MailboxProcessor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>