<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The most popular words in two terabytes of code</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello friends! I analyzed 2TB code here and got the most popular words in different programming languages. The results can be viewed in the form of ta...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The most popular words in two terabytes of code</h1><div class="post__text post__text-html js-mediator-article">  Hello friends!  I analyzed 2TB code here and got the most popular words in different programming languages.  The results can be viewed in the form of tag clouds and a simple list: <br><br> <a href="https://anvaka.github.io/common-words/"><img src="https://habrastorage.org/getpro/habr/post_images/06f/f07/f67/06ff07f670675ae589a0c7e55e75441f.png" alt="image"></a> <br>  The site is <a href="https://anvaka.github.io/common-words/">here</a> , and its source can be read on <a href="https://github.com/anvaka/common-words">github</a> . <br><br>  Under the cat described in detail about how the data was collected, how the site was built and how the clouds fit.  And a little bit of observation. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Enjoy reading! <br><a name="habracut"></a><br><h3>  Observations </h3><br><ul><li>  The most popular text in all programming languages ‚Äã‚Äãwas the text from licenses.  Among all Java languages ‚Äã‚Äãwon here.  Of the 966 most popular words, 127 were about the license: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/68b/091/465/68b0914653bd65766207bb98f9a7f885.png" alt="image"><br><br>  Probably, the culture of adding licenses to each .java file is much stronger than in other languages.  Have you seen the official <a href="https://docs.oracle.com/javase/tutorial/getStarted/application/examples/HelloWorldApp.java">hello world</a> ? <br><br></li><li> <code>Lua</code> is the only programming language in which an obscene word has entered the top.  <a href="https://anvaka.github.io/common-words/">Can you find</a> <br><br></li><li>  In Go, the most popular word was <code>err</code> .  There are no exceptions in this language? </li></ul><br><h3>  How? </h3><br>  I collected the data using BigQuery.  Google, together with GitHub, posted a full snapshot of the sources on a public date set <a href="https://bigquery.cloud.google.com/dataset/bigquery-public-data:github_repos">github_repos</a> .  The index was built at the end of 2016. <br><br>  When building clouds, I impose some restrictions on the data: <br><br><ul><li>  The maximum length of a string with a word should not exceed 120 characters.  This helps to get rid of the generated code (for example, in minified javascript). </li><li>  Punctuation ( <code>, ; : .</code> ), Operators ( <code>+ - * ...</code> ) and numbers are ignored.  For example, the string <code>a + b + 42</code> will be counted as two words <code>a</code> and <code>b</code> </li><li>  Since the text of the licenses overloaded the visualizations, I removed all the lines in which there are marker words that are specific to the licenses (for example, <code>license</code> , <code>noninfringement</code> <a href="">and so on ...</a> ) </li><li>  The register of words is taken into account.  <code>This</code> and <code>this</code> are considered two different words. </li></ul><br><h4>  How was the data collected? </h4><br>  BigQuery is an awesome platform.  The contents of all files from the githab are stored in plain text <a href="https://bigquery.cloud.google.com/dataset/bigquery-public-data:github_repos">in tables</a> . <br><br><table><tbody><tr><th>  File </th><th>  Content </th></tr><tr><td>  File 1.h </td><td>  // File 1 content \ n # ifndef FOO \ n # define FOO ... </td></tr><tr><td>  File 2.h </td><td>  // File 2 content \ n # ifndef BAR \ n # define BAR ... </td></tr></tbody></table><br>  BigQuery allows you to write an ordinary SQL query and execute it with amazing speed. <br><br>  At first I decided to break the contents of all files into words, and then use <code>GROUP BY</code> to count them. <br><br><table><tbody><tr><th>  Word </th><th>  How many times have I met </th></tr><tr><td>  File </td><td>  2 </td></tr><tr><td>  content </td><td>  2 </td></tr><tr><td>  ... </td><td>  ... </td></tr></tbody></table><br>  Unfortunately, this approach takes the word out of context.  I really wanted to show words with examples of how they are used: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aed/5e1/3b3/aed5e13b3d02c7d53a85b03662709050.gif" alt="image"></div><br>  How to be?  Instead of a simple word break, I created an intermediate table, where the files are broken line by line: <br><table><tbody><tr><th>  Line </th><th>  How many times did I meet a string </th></tr><tr><td>  // File 1 content </td><td>  one </td></tr><tr><td>  #ifndef FOO </td><td>  one </td></tr><tr><td>  #ifndef FOO </td><td>  one </td></tr><tr><td>  ... </td><td>  ... </td></tr></tbody></table><br>  Such intermediate storage reduces the size of the processed data from ~ 2TB to ~ 12GB. <br><br>  Now, to get the most popular words from this table, we can break each line into individual words, but at the same time keep the original line: <br><table><tbody><tr><th>  Line </th><th>  Word </th></tr><tr><td>  // File 1 content </td><td>  File </td></tr><tr><td>  // File 1 content </td><td>  content </td></tr><tr><td>  #ifndef FOO </td><td>  ifndef </td></tr><tr><td>  #define FOO </td><td>  FOO </td></tr><tr><td>  ... </td><td>  ... </td></tr></tbody></table><br>  It would seem that almost nothing has changed.  But, in this interpretation, we can use window functions to get the top 10 lines for each word ( <code>SELECT ... OVER (PARTITION BY ...)</code> - <a href="http://stackoverflow.com/questions/176964/select-top-10-records-for-each-category">as in this question on StackOverflow</a> ). <br><br>  The current request code can be found here: <a href="">extract_words.sql</a> . <br><br>  <i>By the way ...</i> My SQL is at a very basic level.  Because if you, dear reader, find an error, or know a more suitable way - please let me know. <br><br><h4>  How to draw a tag cloud? </h4><br>  At the heart of all tag developers I know is this algorithm: <br><br><blockquote> <code>   `w`: <br>  1.  `w`    (x, y) <br>  2.       -   1.</code> </blockquote> <br>  This code can run indefinitely, because we either stop trying after several iterations, or reduce the font size until the word fits. <br><br>  For simplicity, words can be thought of as rectangles.  We are trying to place all the rectangles on the screen so that no rectangle crosses the occupied pixels on the screen. <br><br>  The most resource-intensive part of this algorithm is intersection checking.  Especially at the end, when all the free space is basically already taken, finding a new area where you can insert a word becomes very difficult (and sometimes not possible). <br><br>  Different implementations are trying to speed up this part of the algorithm by indexing the occupied space. <br><br><ul><li>  Some use <a href="https://en.wikipedia.org/wiki/Summed_area_table">Summed area table</a> .  This is a special data structure that allows you to say or cross a new rectangle on the screen in <code>O(1)</code> time.  Unfortunately, the structure needs to be updated after changes on the screen, which gives mediocre performance. <br><br></li><li>  I saw some use varieties of R-trees to index the occupied space.  In this approach, the search for intersections is slower than with Summed Area Tables, but maintaining the index is faster.  However, the implementation of R-trees is not the most trivial task. </li></ul><br>  I wanted to try something different.  Instead of indexing the occupied space, I wanted to have an index of the free area.  So you can immediately select a large rectangle in which there is guaranteed a place for a new arrival. <br><br>  For the index, I used a <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B2%25D0%25BE_%25D0%25BA%25D0%25B2%25D0%25B0%25D0%25B4%25D1%2580%25D0%25B0%25D0%25BD%25D1%2582%25D0%25BE%25D0%25B2">quad tree</a> .  Each intermediate tree node stores information about how many free / occupied pixels there are.  So you can instantly sweep aside quadrants in which there are not enough free pixels. <br><br>  The easiest way to see it in the picture.  Here is the quad-tree of the JS logo: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a96/501/994/a96501994718abad930f536d16077df8.png" alt="image"><br><br>  White empty rectangles are free space.  If you need to add a new rectangle which is smaller than any of these empty rectangles - we can safely draw it there. <br><br>  This approach gives good results, but can lead to visual artifacts.  After all, no new rectangle can be located at the intersection of quadrants: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/083/a51/9e3/083a519e3b832b1fb3920668c494b286.gif" alt="image"><br><br>  Moreover, what if none of the free quadrants are large enough?  And if the adjacent quadrants are combined, then there is enough space? <br><br>  The union of free quadrants was my next step.  I just "expand" quads to the left / right of the target.  This slows down the build time a little, but reduces artifacts and gives better results: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/51f/34e/b67/51f34eb6755198a13b308235bf01d276.gif" alt="image"><br><br>  <i>By the way ...</i> My handler code is not available with the site.  It was quickly written and is difficult to use in other contexts.  If you need a good handler, look at <br>  <a href="https://github.com/amueller/word_cloud">amueller / word_cloud</a> <br><br><h3>  How was the site made? </h3><br><h4>  Text rendering </h4><br>  In general, <a href="https://twitter.com/anvaka/status/801869174502879232">I was pleased with the speed of</a> building a tag cloud.  But in the context of my site this speed was not enough. <br><br>  I used SVG to draw words on the screen.  The rendering of so many text-based SVG elements can easily block the UI stream for a few seconds.  Where are the positions for the tag cloud? <br><br>  Fortunately, you can remove the stacker offline.  Instead of counting the positions of the words on the fly, when the browser opens the page, I decided to count the positions once, save them to a file, and then draw them statically.  This allows us to focus on optimizing the UI flow. <br><br>  In order not to block the browser for long periods of time, you need to break all the work into small pieces, and perform it asynchronously.  At one iteration of the event loop, we add N words and exit the function so that the browser can handle other events.  At the next iteration, we add more words, and so on. <br><br>  For these purposes, I wrote <a href="https://github.com/anvaka/rafor">anvaka / rafor</a> .  This library is an adaptive, asynchronous `for` loop based on <code>requestAnimationFrame()</code> .  All iterations are performed at different stages of the event cycle, and thereby reduces the load on the UI stream.  The initial loading of the site looks smoother. <br><br><h4>  Navigation and Zoom </h4><br>  Using the mouse, keyboard, or touch-screen, you can zoom in, delete a map, and move it around the screen, just like Google Maps does.  All this is done using the <a href="https://github.com/anvaka/panzoom">panzoom</a> library. <br><br><h4>  Application model </h4><br>  I use <a href="https://vuejs.org/">vue.js</a> for UI.  It is easy to use and quick to use.  It is especially cool to have vue components in separate files - you don't often have to switch between js / markup / styles.  Hot-reload makes development especially enjoyable. <br><br>  Application state is stored in a single <a href="">appState</a> object.  When you select a programming language, words and their context are loaded asynchronously. <br><br>  For the exchange of events between components, I use my mini-library <a href="https://github.com/anvaka/ngraph.events">ngraph.events</a> .  Initially, I made it for a speedy exchange of events in my graph libraries.  But here it works fine as a dispatcher. <br><br>  Finally, <a href="https://github.com/anvaka/query-state">anvaka / query-state</a> binds the query string to bidirectional binding to the choice of programming language. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6c7/cbe/a10/6c7cbea10f4cd10e6b64205eaea71a8d.gif" alt="image"><br><br><h3>  Finally </h3><br>  This project has been my evening hobby for the past two months.  Despite all the flaws of the tag clouds, I was very interested. <br><br>  I sincerely hope that you enjoyed this study too :)! <br><br>  Thank you, dear reader, for your attention.  And special thanks to my soul mate for her endless support and hints. </div><p>Source: <a href="https://habr.com/ru/post/320256/">https://habr.com/ru/post/320256/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../320244/index.html">CodingFuture + Puppet. Part VI: Topical Blacklists and Secure Knock</a></li>
<li><a href="../320246/index.html">Designer folder designer. Create backups</a></li>
<li><a href="../320248/index.html">Focusing on security: building a cloud-managed network using Cisco Meraki MX equipment</a></li>
<li><a href="../320250/index.html">The future of mobile is not applications, but browsers</a></li>
<li><a href="../320252/index.html">Interaction between Blue Print (Interface, Cast To)</a></li>
<li><a href="../320258/index.html">We become professional PHP developers. Part 4: Teamwork in practice</a></li>
<li><a href="../320260/index.html">Return H.264 support in Vivaldi in openSUSE Leap 42.2</a></li>
<li><a href="../320262/index.html">RIGHT kitchen</a></li>
<li><a href="../320264/index.html">We write a wrapper over the API, make a PIP packet out of it, connect Travis CI testing and look at open source licenses</a></li>
<li><a href="../320266/index.html">JunOS update on EX4500 switches in VirtualChassis - what could go wrong? Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>