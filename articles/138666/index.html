<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Fair DOCX generation in PHP. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, dear habrasoobschestvu! Once there was an interesting material on the generation of doc-files using PHP. Unfortunately, I didn‚Äôt find anything ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Fair DOCX generation in PHP. Part 1</h1><div class="post__text post__text-html js-mediator-article"><img src="http://www.habrastorage.com/images/phpdocigi.png" alt="image" align="left">  Hello, dear habrasoobschestvu!  Once there was an <a href="http://habrahabr.ru/blogs/php/136999/">interesting material</a> on the generation of doc-files using PHP.  Unfortunately, I didn‚Äôt find anything else on this topic.  At that time, I developed my own solution. <br>  It was to generate <b>.docx</b> files.  The arguments were as follows: <br><br><ul><li>  The year 2012, and this format appeared already in 2007 </li><li>  Generating .docx is undoubtedly simpler than .doc, because .docx = .zip, and .doc is a binary file </li><li>  A crutch with HTML generation and renaming to doc will not work for more or less self-respecting projects. </li><li>  Using the method below, we will easily generate Excel, and generally anything. </li></ul><br>  Details under the cut. <a name="habracut"></a><br><br><h4>  File structure </h4><br><img src="http://www.habrastorage.com/images/ukuuku.png" alt="image" align="left"><img src="http://www.habrastorage.com/images/word.png" alt="image" align="left">  Take your any .docx file and rename it to .zip and then open.  And you will see the structure of the docx file.  Yes Yes!  This is a regular zip archive.  I will briefly say that the most interesting thing for us lies in the word folder.  Here, in the root are the general settings of the document. <br>  The most interesting thing for us in the word folder is the document.xml file, which is a file with the contents of Office Open XML.  That it contains the contents of the document itself.  More information about this format can be found on the <a href="http://en.wikipedia.org/wiki/Office_Open_XML">English Wikipedia</a> .  The _rels folder contains the document.xml.rels file.  It will be useful to us in the future to describe the links of attached files within the document.  The media folder may still exist if there are images in your document.  The names of the remaining files seem to speak for themselves. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Learning to generate .docx </h4><br>  So, as we have already decided, .docx is just a regular zip archive, so the solution suggests itself: the document generator class must be an heir of the ZipArchive class, which is available out of the box.  And the rest is a matter of technique.  Below is a class for creating an empty .docx file (do not forget to enable zlib and use UTF-8 encoding). <br><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Word</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZipArchive</span></span></span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      private $files; //    public $path; public function __construct($filename, $template_path = '/template/' ){ //    $this-&gt;path = dirname(__FILE__) . $template_path; //     ,   . if ($this-&gt;open($filename, ZIPARCHIVE::CREATE) !== TRUE) { die("Unable to open &lt;$filename&gt;\n"); } //   $this-&gt;files = array( "word/_rels/document.xml.rels", "word/theme/theme1.xml", "word/fontTable.xml", "word/settings.xml", "word/styles.xml", "word/document.xml", "word/stylesWithEffects.xml", "word/webSettings.xml", "_rels/.rels", "docProps/app.xml", "docProps/core.xml", "[Content_Types].xml" ); //      foreach( $this-&gt;files as $f ) $this-&gt;addFile($this-&gt;path . $f , $f ); } //   public function create(){ $this-&gt;close(); } } $w = new Word( "Example.docx" ); $w-&gt;create();</span></span></code> </pre> <br>  The file Example.docx should appear near the script. At the same time, do not forget to create the file structure itself.  To get it, we use the notorious MS Office and Winrar.  After assembly, try to open in through MS Office.  In case of minor errors in the XML, the Word will warn you that the document contains errors, but will also suggest correcting them.  If the document is collected completely wrong, the Word will only curse and refuse to open. <br><br><h4>  Paste the text </h4><br>  To obtain the required XML text, I used the same lamer approach: I typed text in a Word, extracted the insides, and studied.  Here is what XML I got for the usual paragraph: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">w:pw:rsidR="00BB20FC"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">w:rsidRPr</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"00357A74"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">w:rsidRDefault</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"00357A74"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">w:rsidP</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"00BB20FC"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">w:pPr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">w:jc</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">w:val</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"left"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">w:rPr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">w:sz</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">w:val</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"28"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">w:lang</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">w:val</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en-US"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">w:rPr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">w:pPr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">w:rw:rsidRPr="00357A74"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">w:rPr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">w:sz</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">w:val</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"28"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">w:lang</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">w:val</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en-US"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">w:rPr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">w:t</span></span></span><span class="hljs-tag">&gt;</span></span>{TEXT}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">w:t</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">w:r</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">w:p</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  It is easy to understand <b>what</b> needs to be changed to get the desired alignment and text size.  We insert our text into the w: t tag, but without line breaks! <br>  We introduce the assign method into our class, and the generator becomes like this: <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Word</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZipArchive</span></span></span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      private $files; //    public $path; //   protected $content; public function __construct($filename, $template_path = '/template/' ){ //    $this-&gt;path = dirname(__FILE__) . $template_path; //     ,   . if ($this-&gt;open($filename, ZIPARCHIVE::CREATE) !== TRUE) { die("Unable to open &lt;$filename&gt;\n"); } //   $this-&gt;files = array( "word/_rels/document.xml.rels", "word/theme/theme1.xml", "word/fontTable.xml", "word/settings.xml", "word/styles.xml", "word/stylesWithEffects.xml", "word/webSettings.xml", "_rels/.rels", "docProps/app.xml", "docProps/core.xml", "[Content_Types].xml" ); //      foreach( $this-&gt;files as $f ) $this-&gt;addFile($this-&gt;path . $f , $f ); } //   public function assign( $text = '' ){ //    $p = file_get_contents( $this-&gt;path . 'p.xml' ); //       $text_array = explode( "\n", $text ); foreach( $text_array as $str ) $this-&gt;content .= str_replace( '{TEXT}', $str, $p ); } //   public function create(){ //   $this-&gt;addFromString("word/document.xml", str_replace( '{CONTENT}', $this-&gt;content, file_get_contents( $this-&gt;path . "word/document.xml" ) ) ); $this-&gt;close(); } } $w = new Word( ".docx" ); $w-&gt;assign(' .   .'); $w-&gt;create();</span></span></code> </pre><br>  That's basically it.  Next time we learn to embed images. <br>  Simple, isn't it?  <a href="">All code with an example</a> . <br>  <b>UPD.</b>  Made a code highlighting. <br>  <b>UPD 2.</b> Read the <a href="http://habrahabr.ru/post/140012/">sequel</a> . </div><p>Source: <a href="https://habr.com/ru/post/138666/">https://habr.com/ru/post/138666/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../138655/index.html">Speech by Sergei Belousov in Chelyabinsk</a></li>
<li><a href="../138657/index.html">Jelastic + Luna = mini Github</a></li>
<li><a href="../138658/index.html">Performance shared_ptr and C ++ 11: why I don‚Äôt believe libraries</a></li>
<li><a href="../138660/index.html">Don't die please</a></li>
<li><a href="../138664/index.html">IP Multipathing on Solaris 10</a></li>
<li><a href="../138667/index.html">Stack programming languages</a></li>
<li><a href="../138668/index.html">HTML5 canvas bilinear pixel distortion</a></li>
<li><a href="../138669/index.html">StoreBirds - New Design</a></li>
<li><a href="../138670/index.html">Wireless HD-video and sound transmission over Wi-Fi, digest - spring'12</a></li>
<li><a href="../138672/index.html">Canonical introduced Ubuntu for Android (UPD)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>