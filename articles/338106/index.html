<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Nuklear + - mini cross-platform GUI</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nuklear + (reads "Nuklear cross", means "cross-platform Nuklear") is an add-on to the Nuklear GUI library, which allows you to abstract from the outpu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Nuklear + - mini cross-platform GUI</h1><div class="post__text post__text-html js-mediator-article"><p><img align="left" src="https://habrastorage.org/web/af4/74a/914/af474a914b344f46bb0411d02cd3549e.png">  <a href="https://github.com/DeXP/nuklear_cross">Nuklear +</a> (reads "Nuklear cross", means "cross-platform Nuklear") is an add-on to the <a href="https://github.com/vurtun/nuklear">Nuklear</a> GUI library, which allows you to abstract from the output driver and interaction with the operating system.  You need to write one simple code, and then it will be able to compile for all supported platforms. </p><br><p>  I already wrote on Habr article " <a href="https://habrahabr.ru/post/319106/">Nuklear - the perfect GUI for micro-projects?</a> ".  Then the task was simple - to make a small cross-platform utility with a GUI, which would look about the same in Windows and Linux.  But ever since I have not been let go of the question, is it possible to do something more or less complicated on Nuklear?  Is it possible to make a real project entirely on it that will be used? </p><a name="habracut"></a><br><p>  <a href="https://wordlase.dexp.in/">Wordlase Web Demo</a> </p><br><p> That is why my next game, <a href="http://store.steampowered.com/app/602930/Wordlase/">Wordlase</a> , I did on pure Nuklear.  And without any OpenGL there.  Even the background pictures of my type are <code>nk_image</code> .  Ultimately, this made it possible to select a rendering driver, right down to pure X11 or GDI +. </p><br><p>  Even in my <a href="https://habrahabr.ru/post/319106/">last article,</a> I laid the foundations of <a href="https://github.com/DeXP/nuklear_cross">Nuklear +</a> - a library designed to hide all the "dirt" from the programmer and allow him to focus on creating the interface.  The library can download fonts, images, create an operating system window and the rendering context. </p><br><p>  The full code example is in the <a href="https://github.com/DeXP/nuklear_cross">Readme on GitHub</a> .  There you can see that the code is pretty simple.  I also transferred my <a href="https://github.com/DeXP/dxBin2h">dxBin2h</a> and <a href="https://github.com/DeXP/nuklear-webdemo">nuklear-webdemo</a> projects to Nuklear +.  And it was very easy to do this - all initialization is replaced with one call to <code>nkc_init</code> , events are handled by <code>nkc_poll_events</code> , <code>nkc_render</code> function <code>nkc_render</code> , and <code>nkc_shutdown</code> is called as the destructor. </p><br><p> <a href="https://dexp.github.io/nuklear-webdemo"><img src="https://habrastorage.org/web/8d1/236/667/8d12366677db4cfe89268f4443ac86c3.png" alt="Nuklear demo"></a> </p><br><p>  But back to Wordlase, on the example of which this publication was built.  Recently, the game has a <a href="https://wordlase.dexp.in/">web demo</a> .  I did not write any specific web code for the game - this is a pure C89 application compiled with <a href="https://kripken.github.io/emscripten-site/">Emscripten</a> .  And if you completely follow the example from the Readme Nuklear + (namely, use <code>nkc_set_main_loop</code> ), then the web version of the application will be obtained absolutely for free, without any extra costs. </p><br><h3 id="bekend-i-frontend">  Backend and Frontend </h3><br><p>  The most interesting part of Nuklear + are supported frontends and backends.  In this case, the frontend is the part responsible for interacting with the OS and drawing the window.  Those.  directly what the user sees.  Implementations are in the <a href="https://github.com/DeXP/nuklear_cross/tree/master/nkc_frontend">nkc_frontend</a> folder.  Currently supported: SDL, GLFW, X11, GDI +.  They are not equivalent.  For example, GDI + uses WinAPI even for rendering fonts and loading images, i.e.  Get exactly the same picture in other operating systems will be problematic.  The implementation is also not the same everywhere.  For example, the X11 implementation is not yet able to change the screen resolution in full screen mode (I will be glad to see Pull Request) </p><br><p>  Selecting a frontend for your application is simple - you need to set the preprocessor variable <code>NKCD=NKC_x</code> , where <code>x</code> is one of: SDL, GLFW, XLIB, GDIP.  For example: <code>gcc -DNKCD=NKC_GLFW main.c</code> </p><br><p>  The backend in this case directly draws.  The implementation is in the <a href="https://github.com/DeXP/nuklear_cross/tree/master/nuklear_drivers">nuklear_drivers</a> folder.  Drawing with any version of OpenGL produces approximately the same image on all operating systems and frontends.  After all, <a href="https://github.com/nothings/stb">stb_image</a> is always used to load images there, and the font is rendered using standard Nuklear tools (also based on stb).  At the same time, the pure X11 driver does not even know how to download fonts.  So do not forget to test your application for the selected pair of backend + frontend. </p><br><p>  For example: <em>Wordlase, GLFW3, OpenGL 2, Windows</em> <br> <a href=""><img src="https://habrastorage.org/web/d81/f02/298/d81f02298d974dc9ad67e903926d5c0e.jpg" alt="Wordlase, GLFW3, OpenGL 2, Windows"></a> </p><br><p>  Or: <em>Wordlase, SDL2, OpenGL ES, Linux</em> <br> <a href=""><img src="https://habrastorage.org/web/b49/776/063/b4977606303840b180c474f10d104653.jpg" alt="Wordlase, SDL2, OpenGL ES, Linux"></a> </p><br><p>  The default backend is OpenGL2, if available.  You can set <code>NKC_USE_OPENGL=3</code> for OpenGL 3, and <code>NKC_USE_OPENGL=NGL_ES2</code> for OpenGL ES 2.0.  To use the pure X11 paint constant, the <code>NKC_USE_OPENGL</code> constant is not <code>NKC_USE_OPENGL</code> .  Also, OpenGL options do not affect GDI + - there is always drawing by its own means. </p><br><p>  Here is a screenshot with GDI +: <em>Wordlase, GDI +, without OpenGL, Windows</em> </p><br><p> <a href=""><img src="https://habrastorage.org/web/e47/097/fd6/e47097fd606d4751be3824128e49d1c6.jpg" alt="Wordlase, GDI +, without OpenGL, Windows"></a> </p><br><p>  This backend fully supports translucent images, the picture is close to the original.  The difference in the font: hinting, anti-aliasing, and even the size (I will also be happy to pull Request for automatic adjustment of the size of the GDI + font to the size of stb_ttf). </p><br><p>  And the worst case is the clean X11 renderer, which until my <a href="https://github.com/vurtun/nuklear/pull/512">pull request</a> didn't even know how to upload pictures.  <em>Wordlase, X11, without OpenGL, Linux</em> : </p><br><p> <a href=""><img src="https://habrastorage.org/web/b46/a9d/cb9/b46a9dcb9a734d66893c35773ea8a299.jpg" alt="Wordlase, X11, without OpenGL, Linux"></a> </p><br><p>  There are already quite a few differences: the logo, the sun's rays, the sharper edge of the girl, the font.  Why?  The background in the game on the fly is made up of several translucent PNGs.  But pure X11 only supports bit transparency, just like GIF.  Also, the X11 renderer works very slowly on large images with transparency.  And if you turn off transparency in the engine, the picture becomes even worse.  <em>Wordlase, X11, without OpenGL, without transparency</em> : </p><br><p> <a href=""><img src="https://habrastorage.org/web/e5f/54e/569/e5f54e5698d448888397db00eb48ac17.jpg" alt="Wordlase, X11, no OpenGL, no transparency"></a> </p><br><p>  So why do we need the GDI + and X11 renderers, if they are so ugly?  Because they are bad only for large images with transparency.  And if you make a small utility, where pictures are used only as icons for the user interface, then these renderers become a good option at all, because  have a minimum amount of dependencies.  I also used pure X11 on a weak system, where OpenGL is only software.  In this case, X11 is faster than OpenGL.  Hint: if instead of a heap of translucent PNGs you use one large JPEG, then X11 will work quickly and correctly. </p><br><p>  An example of a good use of a clean X11 backend is the main Wordlase game window.  There are almost no large pictures there, but there are several interface icons that are quite correctly displayed: </p><br><p><img src="https://habrastorage.org/web/2cc/92e/fe6/2cc92efe6d754d6593bc19554d993875.png" alt="Wordlase, X11, gameplay"></p><br><p>  Ok, the drawing tool is selected, the OS window is created.  Now is the time to do the GUI! </p><br><h3 id="fishki-nuklear">  Nuklear chips </h3><br><p>  The very first in <a href="https://wordlase.dexp.in/">Wordlase</a> is the language selection screen: </p><br><p><img src="https://habrastorage.org/web/875/895/0ef/8758950efdaa40caa4b80cdc2a84053f.jpg" alt="Wordlase, language selection screen"></p><br><p>  Two interesting techniques are immediately visible here: a few pictures against the window and the centering of the widgets. </p><br><p>  Placing a picture on the background of the window is quite simple: </p><br><pre> <code class="hljs lisp">nk_layout_space_push(<span class="hljs-name"><span class="hljs-name">ctx</span></span>, nk_rect(<span class="hljs-name"><span class="hljs-name">x</span></span>, y, width, height))<span class="hljs-comment"><span class="hljs-comment">; nk_image(ctx, img);</span></span></code> </pre> <br><p>  <code>x</code> and <code>y</code> - position on the screen, <code>width</code> and <code>height</code> - the size of the image. </p><br><p>  Centering is more difficult because  not supported by Nuklear directly.  You need to calculate the position yourself: </p><br><pre> <code class="hljs go"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( nk_begin(ctx, WIN_TITLE, nk_rect(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, winWidth, winHeight), NK_WINDOW_NO_SCROLLBAR) ) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-comment"><span class="hljs-comment">/* 0.2 are a space skip on button's left and right, 0.6 - button */</span></span> static <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> float ratio[] = {<span class="hljs-number"><span class="hljs-number">0.2f</span></span>, <span class="hljs-number"><span class="hljs-number">0.6f</span></span>, <span class="hljs-number"><span class="hljs-number">0.2f</span></span>}; <span class="hljs-comment"><span class="hljs-comment">/* 0.2+0.6+0.2=1 */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* Just make vertical skip with calculated height of static row */</span></span> nk_layout_row_static(ctx, (winHeight - (BUTTON_HEIGHT+VSPACE_SKIP)*langCount )/<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> ); nk_layout_row(ctx, NK_DYNAMIC, BUTTON_HEIGHT, <span class="hljs-number"><span class="hljs-number">3</span></span>, ratio); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;langCount; i++){ nk_spacing(ctx, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* skip 0.2 left */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( nk_button_image_label(ctx, image, caption, NK_TEXT_CENTERED) ){ loadLang(nkcHandle, ctx, i); } nk_spacing(ctx, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* skip 0.2 right */</span></span> } } nk_end(ctx);</code> </pre> <br><p>  The next cool thing is the choice of themes in the settings: </p><br><p><img src="https://habrastorage.org/web/8e9/4d7/ff6/8e94d7ff6b1a492897740dad6287f193.jpg" alt="Wordlase, the choice of themes"></p><br><p>  Implementing is also easy: </p><br><pre> <code class="hljs matlab"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nk_combo_begin_color(ctx, themeColors[s.curTheme], nk_vec2(nk_widget_width(ctx), (LINE_HEIGHT+<span class="hljs-number"><span class="hljs-number">5</span></span>)*WTHEME_COUNT) ) ){ int <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>; nk_layout_row_dynamic(ctx, LINE_HEIGHT, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>&lt;WTHEME_COUNT; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( nk_button_color(ctx, themeColors[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>]) ){ nk_combo_close(ctx); changeGUItheme(nkcHandle, s.curTheme); } nk_combo_end(ctx); }</code> </pre> <br><p>  The main thing here is to understand that the pop-up combo field is the same window as the main one.  And you can have anything there. </p><br><p>  The most difficult-looking window is the main game window: </p><br><p><img src="https://habrastorage.org/web/c85/d3a/585/c85d3a5850e04b87baf4239c279b1073.jpg" alt="Wordlase, the main game window"></p><br><p>  In fact, there is also nothing complicated.  On the screen only 4 rows: </p><br><ol><li>  Top line with level selection ( <code>nk_property_int</code> widget) </li><li>  Word List ( <code>nk_group_scrolled</code> ) </li><li>  Buttons of the current word </li><li>  Prompt string </li></ol><br><p>  The only incomprehensible point here is setting the exact dimensions of the elements.  This is done using the ratio of the series: </p><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> ratio[] = { (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)BUTTON_HEIGHT/winWidth, <span class="hljs-comment"><span class="hljs-comment">/* square button */</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)BUTTON_HEIGHT/winWidth, <span class="hljs-comment"><span class="hljs-comment">/* square button */</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)topWordSpace/winWidth, (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)WORD_WIDTH/winWidth }; nk_layout_row(ctx, NK_DYNAMIC, BUTTON_HEIGHT, <span class="hljs-number"><span class="hljs-number">4</span></span>, ratio);</code> </pre> <br><p>  <code>BUTTON_HEIGHT</code> and <code>WORD_WIDTH</code> - constants, measured in pixels;  <code>topWordSpace</code> calculated as the screen width minus the width of all other elements. </p><br><p>  And the last difficult looking window is statistics: </p><br><p><img src="https://habrastorage.org/web/a7a/a8d/214/a7aa8d214fab443e81ede832db3d040f.jpg" alt="Wordlase, statistics"></p><br><p>  The location of the elements is regulated by grouping.  After all, you can always say Nuklear: "there will be 2 widgets in this row."  But the group is also a widget.  Those.  you can simply create a group using <code>nk_group_begin</code> and <code>nk_group_end</code> , and then position <code>nk_group_end</code> inside it as inside a regular window ( <code>nk_layout_row</code> , etc.). </p><br><h3 id="zaklyuchenie">  Conclusion </h3><br><p>  Nuklear is ready even for commercial games and applications.  And Nuklear + can make their creation more enjoyable. </p><br><h3 id="poleznye-ssylki">  useful links </h3><br><ul><li>  <a href="http://store.steampowered.com/app/602930/Wordlase/">Wordlase on Steam</a> </li><li>  <a href="https://wordlase.dexp.in/">Wordlase web demo</a> </li><li>  <a href="https://github.com/DeXP/nuklear_cross">Nuklear + GitHub repository</a> </li><li>  <a href="https://github.com/vurtun/nuklear">Nuklear GitHub repository</a> </li><li>  <a href="https://dexp.github.io/nuklear-webdemo">Nuklear web demo</a> </li><li>  <a href="https://dexp.in/articles/nuklear-cross/">This publication is in English.</a> </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/338106/">https://habr.com/ru/post/338106/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../338092/index.html">Joseph "Lick" Liclider: "Intergalactic Computer Network" (1963)</a></li>
<li><a href="../338098/index.html">We pull video from YouTube and distribute via WebRTC in real-time</a></li>
<li><a href="../338100/index.html">Remote desktop + distributed commands =?</a></li>
<li><a href="../338102/index.html">As I was interviewing for the position of Junior .Net Developer</a></li>
<li><a href="../338104/index.html">My experience in conducting Java courses for new employees</a></li>
<li><a href="../338108/index.html">5 rules for working with amounts</a></li>
<li><a href="../338110/index.html">Do WAFs dream about statistical analyzers?</a></li>
<li><a href="../338114/index.html">The digest of interesting materials for the mobile developer # 221 (September 11-17)</a></li>
<li><a href="../338116/index.html">Reverse engineering of the first smart watch Seiko UC-2000</a></li>
<li><a href="../338118/index.html">How to write your first Linux device driver. Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>