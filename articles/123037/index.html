<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SMS about incoming messages Vkontakte</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="INTRODUCTION 
 Once upon a time, my classmate and I were thinking about how to make money. Then, we didn‚Äôt come up with anything but sending advertisi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SMS about incoming messages Vkontakte</h1><div class="post__text post__text-html js-mediator-article"><img src="http://i23.fastpic.ru/big/2011/0627/b7/2826f2348229f15d6420c51829005fb7.jpg" alt="image" align="left"><h4>  INTRODUCTION </h4><br>  Once upon a time, my classmate and I were thinking about how to make money.  Then, we didn‚Äôt come up with anything but sending advertising sms.  It didn‚Äôt work out because we didn‚Äôt have the knowledge and skills.  But the desire to recognize the picture and send sms for free (although in our region the Internet was oh how expensive) remained. <br><br><h4>  CAPHCHA OF MY OPERATOR </h4><br>  Having installed PHP, I decided to start exploring it with some problem.  It was then remembered school years.  Now I have a mobile operator Tele2, the cheapest in my region.  This means that we will work with him.  I went to the site <a href="http://www.sms.tele2.ru/">free shipment</a> .  I saw how things are with SMS.  Pretty simple pictures. <br><a name="habracut"></a><br><img src="http://i23.fastpic.ru/big/2011/0627/b9/5a142e60d152c6186b285734c2bea9b9.png" alt="image"><br><br>  But it was enough to look at them under a microscope ... I must say right away that I did everything in the simplest, first available way, which it was just me and six months ago that seemed the simplest. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Yes, pictures.  On closer examination, it turned out that the value of the background color is rarely less than 0x7FFFFF.  Great, then you can get rid of the noise and see what happens.  But how?  The first thing I came across in my tutorial is the GDlib library.  With this library, you can very easily determine or set the color of a pixel.  Replaced the color of each background pixel to black. <br><br><img src="http://i23.fastpic.ru/big/2011/0627/af/4d01b3f086a8a3f2c904988ce7fd6daf.png" alt="image"><br><br>  So, not bad.  Only here clearly some kind of interference remains around the numbers.  In fact, captcha has almost always numbers in different colors.  Moreover, the numbers are always six.  That is, it suffices to find the six most popular colors, and paint the remaining colors with black. <br><br><img src="http://i23.fastpic.ru/big/2011/0627/7a/4e9cb48d4c779426fe33b62692fd047a.png" alt="image"><br><br>  It turned out that all the numbers are separate.  After all, this is only a plus. <br>  Now we divide the whole picture into six parts.  Each part will contain a number, and a little black background.  To do this, we find the highest and the lowest coordinates in y, and the most left and right coordinates in x. <br><br><img src="http://i23.fastpic.ru/big/2011/0627/7c/b4fd2eeea2c76e34a6055f7efd6cbb7c.png" alt="image"><br><br>  But the numbers at an angle and a different size.  For good it is necessary to rotate them and lead to the same size.  And it can be easier.  Each digit has its own width and height, in my opinion, as unique a parameter as the angle of rotation relative to the vertical axis.  We confine ourselves to this one parameter, without rotating anything. <br><br>  We were able to get six digits from one picture, but we need to recognize them.  And what would recognize it is necessary to compare with something.  While there was nothing to compare with.  At least a small base of standards was needed.  It was decided to write a script that downloads a dozen images that were further recognized by a person (me or mom).  After recognition, standards were obtained that were preserved in a certain way. <br><br><img src="http://i23.fastpic.ru/big/2011/0627/c8/5da431d242c09bac3fda28024d89efc8.png" alt="image"><br><br>  We have ten folders with the names 0,1,2,3,4,5,6,7,8 and 9. Inside each of them are directories that correspond to the geometric dimensions of the recognized digit.  This is where the image of the reference figure will remain. <br><br>  Now you can easily recognize.  Each new captcha was getting rid of noise, broken into six numbers.  Each figure, passing through the directories that corresponded to its geometric size, was compared with the standards.  The comparison is stupid - by the number of matched pixels. <br><br>  The result was a rather long, but working script.  Recognition with a 90% chance lasts an average of five seconds.  By reducing the base of the standards, we will reduce the recognition time, but also reduce the probability. <br><br><h4>  ANNEX OF MY SOCIAL NETWORK </h4><br>  All I could send sms.  I wanted to screw this opportunity somewhere.  Where? <br>  The choice fell on the social network, which I use the contact.  The idea was simple.  Send SMS about new messages.  Of course, everything could have been done using VK_api, but for sending one SMS, 0.1 votes are deducted from the application (approximately 1 ruble).  And the devil knows how to throw these voices there. <br>  So, I need to: <br><br><ul><li>  get access to your own messages; </li><li>  view unread; </li><li>  identify the sender of the message; </li><li>  create SMS text, like: "Message sender", "Message content"; </li><li>  actually send SMS to your number; </li><li>  Mark a message as read. </li></ul><br>  Still, the very first step is to create a standalone application.  Because  Only such an application can access private messages.  For a long time I was looking for where to create it.  The link <a href="http://vkontakte.ru/editapp%3Fact%3Dcreate%26site%3D1">by which it is necessary to go is</a> not immediately striking <a href="http://vkontakte.ru/editapp%3Fact%3Dcreate%26site%3D1">to create such applications</a> . <br><br>  To be able to work with user messages, you first need to get <em>accesss_token</em> .  This process is described on <a href="http://vkontakte.ru/developers.php%3Fid%3D-1_37230422%26s%3D1">the developer page</a> .  We allow our application to access messages at any time (scope = messages, offline).  In general, we get approximately the following line: <br><br><pre><code class="tex hljs">http://api.vkontakte.ru/oauth/authorize?client_id=__&amp;scope=messages,offline&amp;redirect_uri=http://api.vkontakte.ru/blank.html &amp;display=page&amp;response_type=token</code> </pre> <br>  Enter it into the browser.  Allow the application access.  And safely copy the accesss_token to some file. <br><br><img src="http://i23.fastpic.ru/big/2011/0627/56/3cedfbb869b0f86d367dcdcc4e9eeb56.png" alt="image"><br><br>  Further easier. <br>  We get all unread messages: <br><br><pre> <code class="tex hljs">https://api.vkontakte.ru/method/messages.get?out=0&amp;offset=0&amp;count=1000&amp;filters=1&amp;preview_lengt=0&amp;time_offset=0 &amp;access_token=__</code> </pre><br>  After processing the <em>json_decode</em> response, we get an object containing the sender ID, message ID, message content and a bunch of useless information for us.  Based on the sender's identifier, we will determine his first and last name: <br><br><pre> <code class="tex hljs">https://api.vkontakte.ru/method/getProfiles?uid=_&amp;fields=first_name,last_name &amp;access_token=__</code> </pre><br>  In advance, we will write down the phone number in some file, so that it does not store it in the source code.  Everything is ready to send SMS.  We send (in source code function <em>send_sms_VK</em> ).  It remains to mark the message sent as read: <br><br><pre> <code class="tex hljs">https://api.vkontakte.ru/method/messages.markAsRead?mids=_ &amp;access_token=__</code> </pre><br>  Let's put all this into a loop that every five seconds will look if someone has written a message to us. <br><br><h4>  CONCLUSION </h4><br>  All my code is posted <a href="http://codepad.org/rrlBq0rQ">here</a> .  It leaves much to be desired and needs some work.  There are no small checks, but still he is working.  I recall: <br><pre> <code class="php hljs"> $dir_were_expamples=<span class="hljs-string"><span class="hljs-string">"C:\\www\\TEST_DIR2"</span></span>;<span class="hljs-comment"><span class="hljs-comment">//      $file_were_access_token="access_token.txt";//    access_token $file_were_tel_nomber="tel.txt";//         </span></span></code> </pre><br>  The archived sample folder is located <a href="http://www.onlinedisk.ru/file/687559/">here</a> . <br>  Files <em>access_token.txt</em> and <em>tel.txt</em> must be created and filled in advance. <br>  The number format should be <em>xxxxxxxxxxxx</em> (ten digits).  Example 0001234567. <br><br>  Have a nice summer everyone. </div><p>Source: <a href="https://habr.com/ru/post/123037/">https://habr.com/ru/post/123037/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../123032/index.html">Dotjs: execution of local scripts on any site</a></li>
<li><a href="../123033/index.html">PageBreaker extension for MODX - pagination of texts</a></li>
<li><a href="../123034/index.html">Brainfuck BAT Interpreter</a></li>
<li><a href="../123035/index.html">Blurring Gaussian Images with SVG</a></li>
<li><a href="../123036/index.html">Space Odyssey 2011</a></li>
<li><a href="../123039/index.html">HTML Captcha without using images</a></li>
<li><a href="../123040/index.html">How to safely go to GTD</a></li>
<li><a href="../123042/index.html">Why don't girls play video games?</a></li>
<li><a href="../123044/index.html">Mango - for all developers!</a></li>
<li><a href="../123046/index.html">Legit: sexy git CLI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>