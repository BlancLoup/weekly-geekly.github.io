<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We create package for Atom</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Below I give an example of writing my own package for Atom. 
 We will create a package to generate marionettejs files based on the library I wrote abo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We create package for Atom</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/a98/789/39a/a9878939a0934af795a89ae101ac8eb6.gif"><br>  Below I give an example of writing my own package for Atom. <a name="habracut"></a><br>  We will create a package to generate marionettejs files based on the library I wrote about <a href="https://habrahabr.ru/post/273779/">earlier</a> . <br>  To create a package, I suggest using <a href="https://github.com/atom/package-generator">package-generator</a> (should be installed as a package in your Atom): <br><ul><li> Go to the menu item <code>Packages-&gt;Package Generator-&gt;Generate Atom Package</code> </li><li>  Enter the name.  In my case <code>atom-marionettejs-cli</code> </li><li>  Enter </li></ul><br>  Open our package for editing. <br>  <code>Preferences-&gt;Packages</code> -&gt; find your package, open it, <code>View Code</code> <br>  Fine.  Now edit the menu. <br>  Go to <code>./menus/package-generator.cson</code> , look into the <a href="https://atom.io/docs/latest/hacking-atom-package-word-count">documentation</a> and customize for yourself. <br><div class="spoiler">  <b class="spoiler_title">My package-generator.cson</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'context-menu'</span></span>: <span class="hljs-string"><span class="hljs-string">'atom-text-editor'</span></span>: [ { <span class="hljs-string"><span class="hljs-string">'label'</span></span>: <span class="hljs-string"><span class="hljs-string">'Generate marionettejs application'</span></span> <span class="hljs-string"><span class="hljs-string">'command'</span></span>: <span class="hljs-string"><span class="hljs-string">'atom-marionettejs-cli:generate-app'</span></span> } ] <span class="hljs-string"><span class="hljs-string">'menu'</span></span>: [ { <span class="hljs-string"><span class="hljs-string">'label'</span></span>: <span class="hljs-string"><span class="hljs-string">'Packages'</span></span> <span class="hljs-string"><span class="hljs-string">'submenu'</span></span>: [ <span class="hljs-string"><span class="hljs-string">'label'</span></span>: <span class="hljs-string"><span class="hljs-string">'MarionetteJS CLI'</span></span> <span class="hljs-string"><span class="hljs-string">'submenu'</span></span>: [ { <span class="hljs-string"><span class="hljs-string">'label'</span></span>: <span class="hljs-string"><span class="hljs-string">'Generate marionettejs application'</span></span> <span class="hljs-string"><span class="hljs-string">'command'</span></span>: <span class="hljs-string"><span class="hljs-string">'atom-marionettejs-cli:generate-app'</span></span> } { <span class="hljs-string"><span class="hljs-string">'label'</span></span>: <span class="hljs-string"><span class="hljs-string">'Generate marionettejs file'</span></span> <span class="hljs-string"><span class="hljs-string">'command'</span></span>: <span class="hljs-string"><span class="hljs-string">'atom-marionettejs-cli:generate-file'</span></span> } { <span class="hljs-string"><span class="hljs-string">'label'</span></span>: <span class="hljs-string"><span class="hljs-string">'Set type'</span></span> <span class="hljs-string"><span class="hljs-string">'command'</span></span>: <span class="hljs-string"><span class="hljs-string">'atom-marionettejs-cli:set-type'</span></span> } ] ] } ]</code> </pre> <br></div></div><br>  And so, we want the user to be able to select the file that he wants to generate from the list.  To do this, use the <a href="https://github.com/atom/atom-space-pen-views">SelectListView</a> : <br><div class="spoiler">  <b class="spoiler_title">View code itself</b> <div class="spoiler_text"><pre> <code class="javascript hljs">{SelectListView} = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">'atom-space-pen-views'</span></span> items = <span class="hljs-string"><span class="hljs-string">'type'</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">'ES6'</span></span> command: <span class="hljs-string"><span class="hljs-string">'es6'</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">'CommonJS'</span></span> command: <span class="hljs-string"><span class="hljs-string">'cjs'</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">'RequireJS'</span></span> command: <span class="hljs-string"><span class="hljs-string">'rjs'</span></span> } ], <span class="hljs-string"><span class="hljs-string">'file'</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">'Layout'</span></span> command: <span class="hljs-string"><span class="hljs-string">'--layout'</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">'Collection'</span></span> command: <span class="hljs-string"><span class="hljs-string">'--collection'</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">'Model'</span></span> command: <span class="hljs-string"><span class="hljs-string">'--model'</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">'Router'</span></span> command: <span class="hljs-string"><span class="hljs-string">'--router'</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">'Object'</span></span> command: <span class="hljs-string"><span class="hljs-string">'--object'</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">'Item View'</span></span> command: <span class="hljs-string"><span class="hljs-string">'--itemView'</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">'Collection View'</span></span> command: <span class="hljs-string"><span class="hljs-string">'--collectionView'</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">'Composite View'</span></span> command: <span class="hljs-string"><span class="hljs-string">'--compositeView'</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">'Behavior'</span></span> command: <span class="hljs-string"><span class="hljs-string">'--behavior'</span></span> }, ] <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AtomMarionettejsCliView</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SelectListView</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mode</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">null</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">viewForItem</span></span></span><span class="hljs-class">: (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">item</span></span></span><span class="hljs-class">) -&gt; "&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">li</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">command</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">'#{item.command}'</span></span>&gt;#{item.label}&lt;<span class="hljs-regexp"><span class="hljs-regexp">/li&gt;" showModalPanel: (@mode) -&gt; @panel ?= atom.workspace.addModalPanel(item: this, visible: false) @addClass('overlay from-top') @setItems(items[@mode]) @panel.show() @focusFilterEditor() cancelled: -&gt; @panel.hide() getCommand: -&gt; selectedItem = this.getSelectedItemView(); return selectedItem.data().command;</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Here is the live view.</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/e70/81e/7c1/e7081e7c131c4b98b223a5651701d16c.png"><br></div></div><br>  Now consider our main file ( <code>./lib/atom-marionettejs-cli</code> ).  By the way, if you want everything to work, and the main file is in a different place or contains a different name, just change the line in your <code>package.json</code> <br> <code>"main": "./lib/atom-marionettejs-cli"</code> <br>  During package activation, we will create our view and attach subscriptions to events that will triggered when clicking on a menu item: <br><pre> <code class="hljs python"><span class="hljs-meta"><span class="hljs-meta">... </span></span>{ <span class="hljs-string"><span class="hljs-string">'label'</span></span>: <span class="hljs-string"><span class="hljs-string">'Generate marionettejs application'</span></span> <span class="hljs-string"><span class="hljs-string">'command'</span></span>: <span class="hljs-string"><span class="hljs-string">'atom-marionettejs-cli:generate-app'</span></span> } ...</code> </pre> <br><pre> <code class="hljs coffeescript">activate: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> -&gt;</span></span> @modalPanel = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AtomMarionettejsCliView() @subscriptions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CompositeDisposable @subscriptions = atom.commands.add <span class="hljs-string"><span class="hljs-string">'atom-workspace'</span></span>, <span class="hljs-string"><span class="hljs-string">'atom-marionettejs-cli:generate-app'</span></span>: <span class="hljs-function"><span class="hljs-function">=&gt;</span></span> @attach(<span class="hljs-string"><span class="hljs-string">'app'</span></span>) <span class="hljs-string"><span class="hljs-string">'atom-marionettejs-cli:generate-file'</span></span>: <span class="hljs-function"><span class="hljs-function">=&gt;</span></span> @attach(<span class="hljs-string"><span class="hljs-string">'file'</span></span>) <span class="hljs-string"><span class="hljs-string">'atom-marionettejs-cli:set-type'</span></span>: <span class="hljs-function"><span class="hljs-function">=&gt;</span></span> @attach(<span class="hljs-string"><span class="hljs-string">'type'</span></span>)</code> </pre> <br>  Now we need to somehow handle the event per click in our list. <br><pre> <code class="hljs kotlin"><span class="hljs-meta"><span class="hljs-meta">@modalPanel</span></span>.confirmed = -&gt; path = getPath() command = <span class="hljs-meta"><span class="hljs-meta">@getCommand()</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-meta"><span class="hljs-meta">@mode</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-string"><span class="hljs-string">'file'</span></span> fileName = filePrefix + command args = [<span class="hljs-string"><span class="hljs-string">'g'</span></span>, command, fileName, path] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> args = [<span class="hljs-string"><span class="hljs-string">'s'</span></span>, command]; cli.run(args); <span class="hljs-meta"><span class="hljs-meta">@panel</span></span>.hide()</code> </pre> <br>  The <code>confirmed</code> method is our SelectListView method.  It is brought here, so as not to spread the CLI call ( <code>cli.run()</code> ) across different files. <br><div class="spoiler">  <b class="spoiler_title">Main file code</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">AtomMarionettejsCliView = require <span class="hljs-string"><span class="hljs-string">'./atom-marionettejs-cli-view'</span></span> {CompositeDisposable, BufferedNodeProcess} = require <span class="hljs-string"><span class="hljs-string">'atom'</span></span> filePrefix = <span class="hljs-string"><span class="hljs-string">'marionette-'</span></span> cli = require <span class="hljs-string"><span class="hljs-string">'marionette-cli/lib/cli'</span></span> getPath = -&gt; editor = atom.workspace.getActivePaneItem() file = editor?.buffer.file projectPath = atom.project.getPaths()[<span class="hljs-number"><span class="hljs-number">0</span></span>] # <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> opened file <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> project doesn<span class="hljs-string"><span class="hljs-string">'t exist if !file &amp;&amp; !projectPath throw new Error ('</span></span><span class="hljs-keyword"><span class="hljs-keyword">Create</span></span> project <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-keyword"><span class="hljs-keyword">some</span></span> fil<span class="hljs-string"><span class="hljs-string">e') # get path of opened file path = editor?.buffer.file.path # if no opened tabs if !path return projectPath regexp = /(.*\/).*/g # get path to file regexp.exec(path)[1] module.exports = modalPanel: null mode: null subscriptions: null activate: () -&gt; @modalPanel = new AtomMarionettejsCliView() @subscriptions = new CompositeDisposable @subscriptions = atom.commands.add '</span></span>atom-workspac<span class="hljs-string"><span class="hljs-string">e', '</span></span>atom-marionettejs-cli:generate-app<span class="hljs-string"><span class="hljs-string">': =&gt; @attach('</span></span>app<span class="hljs-string"><span class="hljs-string">') '</span></span>atom-marionettejs-cli:generate-fil<span class="hljs-string"><span class="hljs-string">e': =&gt; @attach('</span></span>fil<span class="hljs-string"><span class="hljs-string">e') '</span></span>atom-marionettejs-cli:<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>-typ<span class="hljs-string"><span class="hljs-string">e': =&gt; @attach('</span></span>typ<span class="hljs-string"><span class="hljs-string">e') @modalPanel.confirmed = -&gt; path = getPath() command = @getCommand(); if @mode is '</span></span>fil<span class="hljs-string"><span class="hljs-string">e' fileName = filePrefix + command args = ['</span></span>g<span class="hljs-string"><span class="hljs-string">', command, fileName, path] else args = ['</span></span>s<span class="hljs-string"><span class="hljs-string">', command]; cli.run(args); @panel.hide() deactivate: -&gt; @modalPanel.destroy() @subscriptions.dispose() attach: (@mode) -&gt; switch @mode when '</span></span>app<span class="hljs-string"><span class="hljs-string">' @generateApp() when '</span></span>fil<span class="hljs-string"><span class="hljs-string">e', '</span></span>typ<span class="hljs-string"><span class="hljs-string">e' @modalPanel.showModalPanel(@mode) generateApp: -&gt; appPath = getPath() + '</span></span>/app<span class="hljs-string"><span class="hljs-string">' cli.run(['</span></span><span class="hljs-built_in"><span class="hljs-built_in">new</span></span><span class="hljs-string"><span class="hljs-string">', appPath]);</span></span></code> </pre><br></div></div><br>  Some small tips: <br><ul><li>  use the console for debugging ( <code>View-&gt;Developer-&gt;Toggle Developer Tools</code> ) </li><li>  After making changes to the files, reload the window ( <code>View-&gt;Developer-&gt;Reload Window</code> ), then check the performance of the code </li><li>  when using third-party libraries, an error like <code>Refused to evaluate a string as JavaScript because 'unsafe-eval'...</code>  <a href="https://github.com/atom/loophole">Loophole</a> can be used to combat it. </li></ul><br>  We write documentation, put in order <code>package.json</code> and can be released. <br><pre> <code class="hljs pgsql">git <span class="hljs-keyword"><span class="hljs-keyword">commit</span></span> -am <span class="hljs-string"><span class="hljs-string">'first release'</span></span> apm publish <span class="hljs-comment"><span class="hljs-comment">--tag v0.1.0 minor</span></span></code> </pre> <br>  Repository on <a href="https://github.com/denar90/atom-marionettejs-cli">Github</a> <br>  Package at <a href="https://atom.io/packages/atom-marionettejs-cli">atom.io</a> <br>  Thanks for attention. <br>  PS Do not judge strictly, it was my first experience with <code>coffeescript</code> . <br></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/280057/">https://habr.com/ru/post/280057/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../280043/index.html">VolgaCTF 2016 sails the sail</a></li>
<li><a href="../280045/index.html">Yota application for Windows Phone - from Novosibirsk to St. Petersburg</a></li>
<li><a href="../280047/index.html">How we wanted to do something with iBeacons</a></li>
<li><a href="../280049/index.html">JPoint 2016 Student Day - the first reports</a></li>
<li><a href="../280051/index.html">Logical showcase for accessing big data</a></li>
<li><a href="../280059/index.html">Model alignment: what you need to know about creating strategies for trading on the exchange. Part II</a></li>
<li><a href="../280063/index.html">Work with C-unions (union) in Rust FFI</a></li>
<li><a href="../280065/index.html">Fbi Detected: How I Discovered FBI Agents</a></li>
<li><a href="../280071/index.html">Introduction to PHP 7: What's added, what's removed</a></li>
<li><a href="../280073/index.html">Damn! Cloud computers! Choosing a thin client for Parallels VDI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>