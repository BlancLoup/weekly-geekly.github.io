<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Making fun of Google Cast, or a mouse for the TV</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As soon as I found out about such a wonderful thing as Chromecast, I immediately ran to buy it, because to turn your TV into SmartTV (well, or at wors...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Making fun of Google Cast, or a mouse for the TV</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/cd7/fdd/2f7/cd7fdd2f7a4e430ba8fcac6b130655bb.jpg"><br><br>  As soon as I found out about such a wonderful thing as Chromecast, I immediately ran to buy it, because to turn your TV into SmartTV (well, or at worst, not to poke more HDMI for watching movies) for two thousand rubles is a very fun prospect.  However, an even more fun prospect is to start programming for it. <br><br>  Most of the tasks for Khromkast that are being implemented now are the simplest video player applications.  Shaped injustice for an environment that can perform HTML5 at the level of fresh Chrome.  But bad luck: there are no mouse events in this environment, which is logical.  But this is not a problem for us. <br><a name="habracut"></a><br>  So, first we will create the simplest Sender App and Reciever App.  Instructions for this are in the official documentation.  In short, for this you need: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Sign up <a href="https://cast.google.com/publish">here</a> , register your Chromecast and your app; </li><li>  Create an HTML-application Sender for Chrome ( <a href="https://developers.google.com/cast/docs/chrome_sender">instruction</a> ); </li><li>  Create an HTML Reciever application for a Cast device ( <a href="https://developers.google.com/cast/docs/custom_receiver">instruction</a> ). </li></ul><br><br>  There is a small cheat that will allow you to avoid the extra step of uploading the created Receiver application to external hosting.  When you register your Chromecast and add an application (you can register it on any left page on any left domain, as long as it opens), you can open your application debug as described <a href="https://developers.google.com/cast/docs/debugging">here</a> , and then simply enter in the JS console: <br><br><pre><code class="javascript hljs">location.href = <span class="hljs-string"><span class="hljs-string">'http://IP---/'</span></span></code> </pre> <br>  and thus open the Receiver application page from the local web server. <br><br>  Well, let's proceed, actually, to the experiment itself.  All the magic of our application will be that we will transfer from Chrome the coordinates of the mouse pointer using the standard Google Cast API method to send a message.  The bottom line is that the connection between Receiver and Sender applications goes through your local WiFi (and, apparently, WebSockets), so the data transfer delay is minimal. <br><br>  To start: <br><br>  Actually, the function that creates magic in the Sender application: <br><div class="spoiler">  <b class="spoiler_title">Js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$(<span class="hljs-string"><span class="hljs-string">'body'</span></span>).data(<span class="hljs-string"><span class="hljs-string">'casting'</span></span>)) { $(<span class="hljs-string"><span class="hljs-string">'body'</span></span>).data(<span class="hljs-string"><span class="hljs-string">'casting'</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>).on(<span class="hljs-string"><span class="hljs-string">'mousemove'</span></span>, (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.session.sendMessage(namespace, { <span class="hljs-attr"><span class="hljs-attr">x</span></span>: e.clientX, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: e.clientY }, (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{}), (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{})); }).throttle(<span class="hljs-number"><span class="hljs-number">10</span></span>)).on(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.session.sendMessage(namespace, { <span class="hljs-attr"><span class="hljs-attr">event</span></span>: <span class="hljs-string"><span class="hljs-string">'click'</span></span> }, (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{}), (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{})); }); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">CoffeeScript</b> <div class="spoiler_text"><pre> <code class="coffeescript hljs">-&gt; <span class="hljs-keyword"><span class="hljs-keyword">unless</span></span> (body = $(<span class="hljs-string"><span class="hljs-string">'body'</span></span>)).data <span class="hljs-string"><span class="hljs-string">'casting'</span></span> body .data <span class="hljs-string"><span class="hljs-string">'casting'</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span> .<span class="hljs-literal"><span class="hljs-literal">on</span></span> <span class="hljs-string"><span class="hljs-string">'mousemove'</span></span>, <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function"> -&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.session.sendMessage namespace, { x: e.clientX, y: e.clientY }, (<span class="hljs-function"><span class="hljs-function">-&gt;</span></span>), (<span class="hljs-function"><span class="hljs-function">-&gt;</span></span>) ).throttle(<span class="hljs-number"><span class="hljs-number">10</span></span>) .<span class="hljs-literal"><span class="hljs-literal">on</span></span> <span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-function"><span class="hljs-function">-&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.session.sendMessage namespace, { event: <span class="hljs-string"><span class="hljs-string">'click'</span></span>}, (<span class="hljs-function"><span class="hljs-function">-&gt;</span></span>), (<span class="hljs-function"><span class="hljs-function">-&gt;</span></span>)</code> </pre><br></div></div><br><br>  The magic throttle function in this case is borrowed from <a href="http://sugarjs.com/">Sugar.JS</a> .  As many have guessed, it limits the call to the callback no more than once every 10 ms in order not to flood our Chromecast.  Namespace is just a unique string, the name that is given to the data channel.  In my case, this is 'urn: x-cast: com.google.cast.magnum.remote_control'. <br><br>  We need to call this function at the moment when we establish a session of communication with the Cast device, i.e.  1) inside the sessionListener (in the case of a page refresh, if the connection has already been established), as well as 2) in the success callback in the requestSession. <br><br>  So, Sender now sends data about the coordinates of the mouse pointer, it remains to somehow handle them in Receiver: <br><div class="spoiler">  <b class="spoiler_title">Js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cursor = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'div'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cursor.style.position = <span class="hljs-string"><span class="hljs-string">'absolute'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cursor.classList.add(<span class="hljs-string"><span class="hljs-string">'magnum-cursor'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.appendChild(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cursor); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.messageBus = receiverManager.getCastMessageBus(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.namespace, cast.receiver.CastMessageBus.MessageType.JSON); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.messageBus.onMessage = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_this</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.data.x &amp;&amp; e.data.y) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> element; _this.cursor.style.left = e.data.x + <span class="hljs-string"><span class="hljs-string">'px'</span></span>; _this.cursor.style.top = e.data.y + <span class="hljs-string"><span class="hljs-string">'px'</span></span>; element = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.elementFromPoint(e.data.x - <span class="hljs-number"><span class="hljs-number">1</span></span>, e.data.y - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_this.currentHover !== element) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_this.currentHover) { _this.currentHover.dispatchEvent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Event(<span class="hljs-string"><span class="hljs-string">'mouseleave'</span></span>)); _this.currentHover.classList.remove(<span class="hljs-string"><span class="hljs-string">'hover'</span></span>); } _this.currentHover = element; _this.currentHover.dispatchEvent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Event(<span class="hljs-string"><span class="hljs-string">'mouseenter'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _this.currentHover.classList.add(<span class="hljs-string"><span class="hljs-string">'hover'</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.data.event) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _this.currentHover.dispatchEvent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Event(e.data.event)); } }; })(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">CoffeeScript</b> <div class="spoiler_text"><pre> <code class="coffeescript hljs"> @messageBus = receiverManager.getCastMessageBus @namespace, cast.receiver.CastMessageBus.MessageType.JSON @messageBus.onMessage = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e)</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> e.data.x &amp;&amp; e.data.y @cursor.style.left = e.data.x + <span class="hljs-string"><span class="hljs-string">'px'</span></span> @cursor.style.top = e.data.y + <span class="hljs-string"><span class="hljs-string">'px'</span></span> <span class="hljs-comment"><span class="hljs-comment"># we should get neighboor pixel; otherwise we will get cursor element forever. element = document.elementFromPoint e.data.x - 1, e.data.y - 1 if @currentHover != element if @currentHover @currentHover.dispatchEvent new Event('mouseleave') @currentHover.classList.remove 'hover' @currentHover = element @currentHover.dispatchEvent new Event('mouseenter') @currentHover.classList.add 'hover' else if e.data.event @currentHover.dispatchEvent new Event(e)</span></span></code> </pre><br></div></div><br><br>  We create receiverManager in advance according to the documentation.  The cursor is just a div element that will run around the screen, replacing the cursor with us.  Actually, on this we did everything. <br><br>  A complete ready-made example can be viewed <a href="https://github.com/sandrew/gcast_mouse">on my github</a> .  Waiting for your comments. <br><br>  PS: If the topic is interesting, and if I'm not too lazy, in the next issue I will tell you how to make a 3D console for your Google Cast application from your smartphone (just like the LG Magic Remote, and even cooler, because it's interactive). </div><p>Source: <a href="https://habr.com/ru/post/249189/">https://habr.com/ru/post/249189/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../249177/index.html">Unity 2D: working with sprites in different display resolutions</a></li>
<li><a href="../249179/index.html">TM represents TM Feed</a></li>
<li><a href="../249181/index.html">Attack "Man In The Middle" (MITM) in Wi-Fi network</a></li>
<li><a href="../249183/index.html">Microservices (Microservices)</a></li>
<li><a href="../249187/index.html">IronBrain educational web service (beta)</a></li>
<li><a href="../249191/index.html">Algorithm for processing orthogonal FCM signals</a></li>
<li><a href="../249193/index.html">On the subject domain modeling in terms of OOP</a></li>
<li><a href="../249195/index.html">Ember.js philosophy</a></li>
<li><a href="../249199/index.html">First steps in changing the Vivaldi browser interface</a></li>
<li><a href="../249201/index.html">Arduino controls in the basement temperature, humidity and flooding and provides data to a web page.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>