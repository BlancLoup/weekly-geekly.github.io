<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Reverse engineering and writing a bot for a flash game on Go</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will explain how to decompile a flash application and then extract the algorithm for signing requests to the game server. And how on...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Reverse engineering and writing a bot for a flash game on Go</h1><div class="post__text post__text-html js-mediator-article"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/768/021/94d/76802194d4479e8679de7e25c6dafb92.png" alt="image" align="left"></a>  In this article I will explain how to decompile a flash application and then extract the algorithm for signing requests to the game server.  And how on the basis of this information to write a game bot on <a href="http://golang.org/">Go</a> . <br>  It all started with the fact that I was looking for a strategy to play with my android smartphone.  Found a good game called "Throne rush".  Then it turned out that there is a browser client that makes some actions more convenient.  But nevertheless game process obviously demanded automation.  I used the excellent tool <a href="http://www.free-decompiler.com/flash/">JPEXS Free Flash Decompiler</a> , which will be discussed further. <br><a name="habracut"></a><br>  The source code of the project on <a href="https://github.com/peinguin/ThroneRushBot">github</a> . <br><br>  So, the task is to emulate the work of the native client. <br><div class="spoiler">  <b class="spoiler_title">Firebug'm looking communication flash applications</b> <div class="spoiler_text"><pre><code class="hljs ruby">POST <span class="hljs-symbol"><span class="hljs-symbol">https:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/epicwar-facebook.progrestar.net/rpc</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ Accept text/html</span></span>,application/xhtml+xml,application/xml;q=<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">9</span></span>,*<span class="hljs-regexp"><span class="hljs-regexp">/*;q=0.8 Accept-Encoding gzip, deflate Accept-Language uk Connection keep-alive Cookie __utma=252078920.1702705582.1400051769.1400051769.1400051769.1; __utmz=252078920.1400051769.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none) Host epicwar-facebook.progrestar.net User-Agent Mozilla/</span></span><span class="hljs-number"><span class="hljs-number">5.0</span></span> (X11; Ubuntu; Linux x86_64; <span class="hljs-symbol"><span class="hljs-symbol">rv:</span></span><span class="hljs-number"><span class="hljs-number">29.0</span></span>) Gecko/<span class="hljs-number"><span class="hljs-number">20100101</span></span> Firefox/<span class="hljs-number"><span class="hljs-number">29.0</span></span> Content-Length <span class="hljs-number"><span class="hljs-number">1913</span></span> Content-Type application/json; charset=UTF-<span class="hljs-number"><span class="hljs-number">8</span></span> X-Auth-Application-Id <span class="hljs-number"><span class="hljs-number">1424411677784893</span></span> X-Auth-Network-Ident facebook X-Auth-Session-Id 0n5nkrp20i8sf9 X-Auth-Session-Init <span class="hljs-number"><span class="hljs-number">1</span></span> X-Auth-Signature <span class="hljs-number"><span class="hljs-number">57</span></span>d0320e91c26cd8e56152d3aad1a809 X-Auth-Token <span class="hljs-number"><span class="hljs-number">6514</span></span>a97ae525f196b8060337380e0cbb X-Auth-User-Id <span class="hljs-number"><span class="hljs-number">675063875</span></span> X-Env-Library-Version <span class="hljs-number"><span class="hljs-number">0</span></span> X-Request-Id <span class="hljs-number"><span class="hljs-number">1</span></span> X-Requested-With XMLHttpRequest X-Server-Time <span class="hljs-number"><span class="hljs-number">1400219523</span></span> {<span class="hljs-string"><span class="hljs-string">"calls"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>[{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"registration"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{<span class="hljs-string"><span class="hljs-string">"user"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{<span class="hljs-string"><span class="hljs-string">"locale"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"en"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"id"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"675063875"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"birthday"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"1970-1-1"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"referrer"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{<span class="hljs-string"><span class="hljs-string">"type"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"bookmark"</span></span></span></span>},<span class="hljs-string"><span class="hljs-string">"lastName"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">""</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"city"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:null</span></span>,<span class="hljs-string"><span class="hljs-string">"country"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:null</span></span>,<span class="hljs-string"><span class="hljs-string">"firstName"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">""</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"sex"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"female"</span></span></span></span>},<span class="hljs-string"><span class="hljs-string">"friendIds"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:[]</span></span>},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"registration"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"boostGetAll"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"boostGetAll"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getTime"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getTime"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getSelfInfo"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getSelfInfo"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getDynamicParams"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getDynamicParams"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getArmyQueue"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getArmyQueue"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getBuildings"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getBuildings"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"heroesGetList"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"heroesGetList"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getResearchQueue"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getResearchQueue"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getMissions"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getMissions"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getQuests"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getQuests"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getProtections"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getProtections"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getInvitedBy"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getInvitedBy"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getInvitedUsers"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getInvitedUsers"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getBonusCrystals"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getBonusCrystals"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getSettings"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getSettings"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"promoGetHalfBilling"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"promoGetHalfBilling"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"giftGetAvailable"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"giftGetAvailable"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"giftGetReceivers"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"giftGetReceivers"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"cloverGetAll"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"cloverGetAll"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"paymentsCount"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"paymentsCount"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"cemeteryGet"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"cemeteryGet"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getNotices"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getNotices"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"allianceGetMessages"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"allianceGetMessages"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getGlobalNews"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"getGlobalNews"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"battleGetActive"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"battleGetActive"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"spellList"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"spellList"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"spellProductionQueue"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"spellProductionQueue"</span></span></span></span>},{<span class="hljs-string"><span class="hljs-string">"name"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"state"</span></span></span></span>,<span class="hljs-string"><span class="hljs-string">"args"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span>{},<span class="hljs-string"><span class="hljs-string">"ident"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span><span class="hljs-string"><span class="hljs-symbol"><span class="hljs-string">"state"</span></span></span></span>}],<span class="hljs-string"><span class="hljs-string">"session"</span></span><span class="hljs-symbol"><span class="hljs-symbol">:null</span></span>}</code> </pre> <br></div></div><br>  There is a problem with X-Auth-Signature.  I did not know where to get it from.  Obviously, this is some kind of hash of something.  But what and what, is unknown.  ‚ÄúFFDec‚Äù helped me in this.  Opensource program, which is written by java, works under Linux.  Perfect for this job. <br>  In the html code you can see which file is loaded. <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">object</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"flash-app"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://epicwar-a.akamaihd.net/facebook/static/assets/Start.swf?v=13"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"application/x-shockwave-flash"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  But in reality, this is not what is needed.  We look flashvars.  There "preloader = https% 3A% 2F% 2Fepicwar-a.akamaihd.net% 2Ffacebook% 2Fv042% 2FFbLoader.swf% 3Fv% 3D2".  But this is again not the case.  And the necessary code, I do not remember exactly how I understood it, in fact, here <a href="">https://epicwar-a.akamaihd.net/facebook/v042/EpicWar.swf</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We decompile. <br><div class="spoiler">  <b class="spoiler_title">Program window</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/451/5f2/30e/4515f230e8e354828213a1ddf8314b6a.png"><br></div></div><br>  In fact, there is export. <br><div class="spoiler">  <b class="spoiler_title">Here is the decompiled code</b> <div class="spoiler_text"><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createHeaders</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(param1:RpcEntryBase)</span></span></span><span class="hljs-function"> : Object </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loc5_:String = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loc2_:String = SocialAdapter.instance.flashVars[<span class="hljs-string"><span class="hljs-string">"session_key"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loc3_:Object = { <span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>:<span class="hljs-string"><span class="hljs-string">"application/json; charset=UTF-8"</span></span>, <span class="hljs-string"><span class="hljs-string">"X-Request-Id"</span></span>:++<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.unionRequestID, <span class="hljs-string"><span class="hljs-string">"X-Auth-Network-Ident"</span></span>:Env.NETWORK, <span class="hljs-string"><span class="hljs-string">"X-Auth-Application-Id"</span></span>:SocialAdapter.instance.app_id, <span class="hljs-string"><span class="hljs-string">"X-Auth-User-Id"</span></span>:SocialAdapter.instance.getPlayer().id, <span class="hljs-string"><span class="hljs-string">"X-Auth-Session-Id"</span></span>:Env.sessionKey }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(_loc2_ != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _loc3_[<span class="hljs-string"><span class="hljs-string">"X-Auth-Session-Key"</span></span>] = _loc2_; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loc4_:Object = param1.headers; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(_loc4_ != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(_loc5_ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _loc4_) { _loc3_[_loc5_] = _loc4_[_loc5_]; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _loc3_; } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createAuthSignature</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(param1:Object, param2:RpcEntryBase)</span></span></span><span class="hljs-function"> : ByteArray </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loc5_:ByteArray = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loc3_:Object = param2.request.getFormattedData(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loc4_:ByteArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ByteArray(); _loc4_.writeUTFBytes(param1[<span class="hljs-string"><span class="hljs-string">"X-Request-Id"</span></span>]); _loc4_.writeUTFBytes(<span class="hljs-string"><span class="hljs-string">":"</span></span>); _loc4_.writeUTFBytes(SocialAdapter.instance.authentication_key); _loc4_.writeUTFBytes(<span class="hljs-string"><span class="hljs-string">":"</span></span>); _loc4_.writeUTFBytes(param1[<span class="hljs-string"><span class="hljs-string">"X-Auth-Session-Id"</span></span>]); _loc4_.writeUTFBytes(<span class="hljs-string"><span class="hljs-string">":"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(_loc3_ <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> ByteArray) { _loc5_ = _loc3_ <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ByteArray; _loc5_.position = <span class="hljs-number"><span class="hljs-number">0</span></span>; _loc4_.writeBytes(_loc5_,<span class="hljs-number"><span class="hljs-number">0</span></span>,_loc5_.length); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(_loc3_ <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> String) { _loc4_.writeUTFBytes(_loc3_ <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> String); } _loc4_.writeUTFBytes(<span class="hljs-string"><span class="hljs-string">":"</span></span>); _loc4_.writeUTFBytes(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.createFingerprint(param1)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _loc4_; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createFingerprint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(param1:Object)</span></span></span><span class="hljs-function"> : String </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loc4_:String = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loc5_:* = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loc6_:* = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loc7_:String = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loc2_:Array = []; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loc3_:* = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(_loc4_ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> param1) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(_loc4_.indexOf(<span class="hljs-string"><span class="hljs-string">"X-Env"</span></span>) != <span class="hljs-number"><span class="hljs-number">-1</span></span>) { _loc7_ = _loc4_.substr(<span class="hljs-number"><span class="hljs-number">6</span></span>); _loc2_.push( { <span class="hljs-string"><span class="hljs-string">"key"</span></span>:_loc7_.toUpperCase(), <span class="hljs-string"><span class="hljs-string">"value"</span></span>:param1[_loc4_] }); } } _loc2_.sortOn(<span class="hljs-string"><span class="hljs-string">"key"</span></span>); _loc5_ = _loc2_.length; _loc6_ = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(_loc6_ &lt; _loc5_) { _loc3_ = _loc3_ + (_loc2_[_loc6_].key + <span class="hljs-string"><span class="hljs-string">"="</span></span> + _loc2_[_loc6_].value); _loc6_++; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _loc3_; } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addHeaders</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(param1:URLRequest, param2:RpcEntryBase)</span></span></span><span class="hljs-function"> : void </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loc4_:String = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loc3_:Object = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.createHeaders(param2); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loc5_:ByteArray = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.createAuthSignature(_loc3_,param2); _loc3_[<span class="hljs-string"><span class="hljs-string">"X-Auth-Signature"</span></span>] = MD5.hashBytes(_loc5_); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(_loc4_ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _loc3_) { param1.requestHeaders.push(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> URLRequestHeader(_loc4_,_loc3_[_loc4_].toString())); } }</code> </pre><br></div></div><br>  It's simple.  Normal md5.  Below is the code on Go. <br><div class="spoiler">  <b class="spoiler_title">Network</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> network <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> <span class="hljs-string"><span class="hljs-string">"strings"</span></span> <span class="hljs-string"><span class="hljs-string">"bytes"</span></span> <span class="hljs-string"><span class="hljs-string">"crypto/md5"</span></span> <span class="hljs-string"><span class="hljs-string">"io"</span></span> <span class="hljs-string"><span class="hljs-string">"encoding/hex"</span></span> <span class="hljs-string"><span class="hljs-string">"strconv"</span></span> <span class="hljs-string"><span class="hljs-string">"io/ioutil"</span></span> <span class="hljs-string"><span class="hljs-string">"log"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SERVER_URL = <span class="hljs-string"><span class="hljs-string">"https://epicwar-facebook.progrestar.net/rpc/"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> APP_ID = <span class="hljs-string"><span class="hljs-string">"1424411677784893"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> AUTH_KEY = <span class="hljs-string"><span class="hljs-string">"6514a97ae525f196b8060337380e0cbb"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> NETWORK = <span class="hljs-string"><span class="hljs-string">"facebook"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _unionRequestID <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _uid <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _sid <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createFingerprint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(headers </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">map</span></span></span></span><span class="hljs-function"><span class="hljs-params">[</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">]</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fingerprint bytes.Buffer preparedHeaders := []Pair{} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> header, _ := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> headers{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(strings.Index(header, <span class="hljs-string"><span class="hljs-string">"X-Env"</span></span>) != <span class="hljs-number"><span class="hljs-number">-1</span></span>){ preparedHeaders = <span class="hljs-built_in"><span class="hljs-built_in">append</span></span>(preparedHeaders, Pair{ key : strings.ToUpper(header[<span class="hljs-number"><span class="hljs-number">6</span></span>:<span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(header)]), value : headers[header]}) } } sortByKey(preparedHeaders) count := <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(preparedHeaders); i := <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i &lt; count { fingerprint.WriteString(preparedHeaders[i].key) fingerprint.WriteString(<span class="hljs-string"><span class="hljs-string">"="</span></span>) fingerprint.WriteString(preparedHeaders[i].value) i++; } res := fingerprint.String() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createAuthSignature</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(headers </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">map</span></span></span></span><span class="hljs-function"><span class="hljs-params">[</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">]</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, postData </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span> { h := md5.New() io.WriteString(h, headers[<span class="hljs-string"><span class="hljs-string">"X-Request-Id"</span></span>]) io.WriteString(h, <span class="hljs-string"><span class="hljs-string">":"</span></span>) io.WriteString(h, AUTH_KEY); io.WriteString(h, <span class="hljs-string"><span class="hljs-string">":"</span></span>); io.WriteString(h, headers[<span class="hljs-string"><span class="hljs-string">"X-Auth-Session-Id"</span></span>]); io.WriteString(h, <span class="hljs-string"><span class="hljs-string">":"</span></span>); io.WriteString(h, postData); io.WriteString(h, <span class="hljs-string"><span class="hljs-string">":"</span></span>); io.WriteString(h, createFingerprint(headers)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hex.EncodeToString(h.Sum(<span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createHeaders</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">map</span></span></span></span><span class="hljs-function"><span class="hljs-params">[</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">]</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { _unionRequestID = _unionRequestID + <span class="hljs-number"><span class="hljs-number">1</span></span> headers := <span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>{ <span class="hljs-string"><span class="hljs-string">"X-Request-Id"</span></span>:strconv.Itoa(_unionRequestID), <span class="hljs-string"><span class="hljs-string">"X-Auth-Network-Ident"</span></span>:NETWORK, <span class="hljs-string"><span class="hljs-string">"X-Auth-Application-Id"</span></span>:APP_ID, <span class="hljs-string"><span class="hljs-string">"X-Auth-User-Id"</span></span>:_uid, <span class="hljs-string"><span class="hljs-string">"X-Auth-Session-Id"</span></span>:_sid, <span class="hljs-string"><span class="hljs-string">"X-Env-Library-Version"</span></span>: <span class="hljs-string"><span class="hljs-string">"0"</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> headers } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addHeaders</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(req *http.Request, postData </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { headers := createHeaders(); headers[<span class="hljs-string"><span class="hljs-string">"X-Auth-Signature"</span></span>] = createAuthSignature(headers, postData); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> index, header := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> headers { req.Header.Add(index, header) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Post</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(postData []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> []</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">byte</span></span></span></span> { client := &amp;http.Client{} req, err := http.NewRequest(<span class="hljs-string"><span class="hljs-string">"POST"</span></span>, SERVER_URL, bytes.NewReader(postData)) addHeaders(req, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>(postData)) resp, err := client.Do(req) <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> resp.Body.Close() body, err := ioutil.ReadAll(resp.Body) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span>){ log.Fatal(err) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> body } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Uid </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Sid </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { _unionRequestID = <span class="hljs-number"><span class="hljs-number">0</span></span> _uid = Uid _sid = Sid }</code> </pre><br></div></div><br>  As you can see, I do not send extra headers.  In the action script code, the RpcClientBase class is inherited by the RpcClient class from ‚Äúcom.progrestar.game.server.rpc‚Äù and appends more headers.  For example, "X-Env-Library-Version" I took from there.  Without it does not work. <br><br><div class="spoiler">  <b class="spoiler_title">Query generation functions</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> bot <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"log"</span></span> <span class="hljs-string"><span class="hljs-string">"encoding/json"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFormattedData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(calls Calls)</span></span></span><span class="hljs-function"> []</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">byte</span></span></span></span> { data, err := json.Marshal(Request{Calls:calls, Session: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>}) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span>){ log.Fatal(err) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStartBoard</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> []</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">byte</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getFormattedData(Calls{ Call{Name:<span class="hljs-string"><span class="hljs-string">"getSelfInfo"</span></span>,Args:<span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{}{},Ident:<span class="hljs-string"><span class="hljs-string">"getSelfInfo"</span></span>}, Call{Name:<span class="hljs-string"><span class="hljs-string">"getBuildings"</span></span>,Args:<span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{}{},Ident:<span class="hljs-string"><span class="hljs-string">"getBuildings"</span></span>}}) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">collectResource</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(building </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint64</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> []</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">byte</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getFormattedData(Calls{ Call{ Name:<span class="hljs-string"><span class="hljs-string">"collectResource"</span></span>, Args:<span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{BuildingId <span class="hljs-keyword"><span class="hljs-keyword">uint64</span></span> <span class="hljs-string"><span class="hljs-string">`json:"buildingId"`</span></span>}{BuildingId:building}, Ident:<span class="hljs-string"><span class="hljs-string">"group_0_body"</span></span>}, Call{Name:<span class="hljs-string"><span class="hljs-string">"state"</span></span>, Args: <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{}{}, Ident:<span class="hljs-string"><span class="hljs-string">"group_1_body"</span></span>}}) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">upgradeBuilding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(building </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint64</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> []</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">byte</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getFormattedData(Calls{ Call{ Name:<span class="hljs-string"><span class="hljs-string">"upgradeBuilding"</span></span>, Args:<span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{BuildingId <span class="hljs-keyword"><span class="hljs-keyword">uint64</span></span> <span class="hljs-string"><span class="hljs-string">`json:"buildingId"`</span></span>}{BuildingId:building}, Ident:<span class="hljs-string"><span class="hljs-string">"group_0_body"</span></span>}, Call{Name:<span class="hljs-string"><span class="hljs-string">"state"</span></span>, Args: <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span>{}{}, Ident:<span class="hljs-string"><span class="hljs-string">"group_1_body"</span></span>}}) }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Data structures</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> bot <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Unit <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Id <span class="hljs-keyword"><span class="hljs-keyword">uint64</span></span> <span class="hljs-string"><span class="hljs-string">`json:"id"`</span></span> Amount <span class="hljs-keyword"><span class="hljs-keyword">uint64</span></span> <span class="hljs-string"><span class="hljs-string">`json:"amount"`</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Building <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Id <span class="hljs-keyword"><span class="hljs-keyword">uint64</span></span> <span class="hljs-string"><span class="hljs-string">`json:"id"`</span></span> TypeId <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> <span class="hljs-string"><span class="hljs-string">`json:"typeId"`</span></span> Flip <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> <span class="hljs-string"><span class="hljs-string">`json:"flip"`</span></span> Level <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> <span class="hljs-string"><span class="hljs-string">`json:"level"`</span></span> X <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> <span class="hljs-string"><span class="hljs-string">`json:"x"`</span></span> Y <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> <span class="hljs-string"><span class="hljs-string">`json:"y"`</span></span> Completed <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> <span class="hljs-string"><span class="hljs-string">`json:"completed"`</span></span> Volume <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> <span class="hljs-string"><span class="hljs-string">`json:"volume"`</span></span> StateTimestamp <span class="hljs-keyword"><span class="hljs-keyword">uint64</span></span> <span class="hljs-string"><span class="hljs-string">`json:"stateTimestamp"`</span></span> Hitpoints <span class="hljs-keyword"><span class="hljs-keyword">uint64</span></span> <span class="hljs-string"><span class="hljs-string">`json:"hitpoints"`</span></span> CompleteTime <span class="hljs-keyword"><span class="hljs-keyword">uint64</span></span> <span class="hljs-string"><span class="hljs-string">`json:"completeTime"`</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Player <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Units []Unit Buildings []Building Stars <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> <span class="hljs-comment"><span class="hljs-comment">//interlan game currency Level uint Builders int //Builder house lvl GoldCapacity uint32 FoodCapacity uint32 Food uint32 Gold uint32 CastleLvl uint } type Result struct { Ident string `json:"ident"` Result map[string]interface{} `json:"result"` } type Error struct { Name string `json:"name"` Description string `json:"description"` Call `json:"call"` } type Response struct{ Date float64 `json:"date"` Results []Result `json:"results"` Error Error `json:"error"` } type BuildingDependency struct { CastleLvl uint Cost uint32 } type BuildingDependencies []BuildingDependency type Buildings struct { Wall BuildingDependencies } type Call struct { Ident string `json:"ident"` Args interface {} `json:"args"` Name string `json:"name"` } type Calls []Call type Request struct { Calls Calls `json:"calls"` Session interface{} `json:"session"` }</span></span></code> </pre><br></div></div><br>  Part of reverse engineering is over.  Now part of the logic of the bot.  I left the opportunity to play in the native client.  To do this in the browser, go to <a href="http://localhost:8080/original">http: // localhost: 8080 / original</a> . <br><div class="spoiler">  <b class="spoiler_title">Module code</b> <div class="spoiler_text"><pre> <code class="actionscript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">package</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">main</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">import</span></span></span><span class="hljs-class"> ( "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">net</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">http</span></span></span><span class="hljs-class">" "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">log</span></span></span><span class="hljs-class">" "./</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">utils</span></span></span><span class="hljs-class">" ) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Pair</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> {</span></span> Key string Value string } func original(Uid string) { flashvars := []Pair{ Pair{<span class="hljs-string"><span class="hljs-string">"fb_source"</span></span>, <span class="hljs-string"><span class="hljs-string">"bookmark"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"ref"</span></span>, <span class="hljs-string"><span class="hljs-string">"bookmarks"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"count"</span></span>, <span class="hljs-string"><span class="hljs-string">"0"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"fb_bmpos"</span></span>, <span class="hljs-string"><span class="hljs-string">"2_0"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"code"</span></span>, <span class="hljs-string"><span class="hljs-string">"AQA9KrPoSxjyTjNoG9B1mUHoZ8ooUxusmPWV6Aa17SfgHIkSVubBwLxCKC5EO7fkfIiC9LvnrDOY35pzlPwyasKVe6q1dcOZzvyQeTmrlf-rhjjMH0FZGh0PWwMp0k3IqZTg1tKunkFFGMALgo4Vf8vSzGFG2r8DiJq5-N7K-5MIg7j3VnR0A0-EzaM5kATvrM5FmI1XWmxHbHFmHpS52rKuTvSuH27Ipwt4p2V2DGayvPDjnvvfs6d5-hdaCtoxoOvBJDfecDakToecSzr3kAU6zF4QiMCIC1MtihaH_3C7a9BeLdVqMhr4w4q33WqEso0"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"sys_id"</span></span>, <span class="hljs-string"><span class="hljs-string">"4"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"network"</span></span>, <span class="hljs-string"><span class="hljs-string">"facebook"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"uid"</span></span>, Uid}, Pair{<span class="hljs-string"><span class="hljs-string">"app_id"</span></span>, <span class="hljs-string"><span class="hljs-string">"1424411677784893"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"interface_lang"</span></span>, <span class="hljs-string"><span class="hljs-string">"uk"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"access_token"</span></span>, <span class="hljs-string"><span class="hljs-string">"CAAUPfrARez0BAKDb5H1uds5kLg3794HyPAbTYRZAA1H2i43NPl8sSjpxl77gIqDapYZB4QxWrZAK1H6VQUVAFbWuTWr4VYbXagirvciMba7FhyYKSUboICrvSJKYgBndShSZA0n4ZA5JRZBqigVbMRdCsHrjl8AQEmcWfbJqkHflqmv8XEBarKEVJRfLp56ksLZCO7TBzkfVQZDZD"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"auth_key"</span></span>, <span class="hljs-string"><span class="hljs-string">"6514a97ae525f196b8060337380e0cbb"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"requestLoadingInfoTimeout"</span></span>, <span class="hljs-string"><span class="hljs-string">"3000"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"ref"</span></span>, <span class="hljs-string"><span class="hljs-string">"bookmark"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"rpc_url"</span></span>, <span class="hljs-string"><span class="hljs-string">"https%3A%2F%2Fepicwar-facebook.progrestar.net%2Frpc%2F"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"preloader_asset"</span></span>, <span class="hljs-string"><span class="hljs-string">"preloader%2Fpreloader_dwarf.swf"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"browser"</span></span>, <span class="hljs-string"><span class="hljs-string">"chrome"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"country_code"</span></span>, <span class="hljs-string"><span class="hljs-string">"UA"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"geoip_city"</span></span>, <span class="hljs-string"><span class="hljs-string">"Kiev"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"index_version"</span></span>, <span class="hljs-string"><span class="hljs-string">"1398240421"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"static_url"</span></span>, <span class="hljs-string"><span class="hljs-string">"https%3A%2F%2Fepicwar-a.akamaihd.net%2F"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"preloader"</span></span>, <span class="hljs-string"><span class="hljs-string">"https%3A%2F%2Fepicwar-a.akamaihd.net%2Ffacebook%2Fv042%2FFbLoader.swf%3Fv%3D2"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"rpc_url"</span></span>, <span class="hljs-string"><span class="hljs-string">"https%3A%2F%2Fepicwar-facebook.progrestar.net%2Frpc%2F"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"stat_url"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://stat.progrestar.net/collector/client/"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"error_url"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://error.progrestar.net/client/"</span></span>}, } t := utils.Template(<span class="hljs-string"><span class="hljs-string">"original"</span></span>) http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/original"</span></span>, func (w http.ResponseWriter, r *http.Request) { err := t.Execute(w, struct{Flashvars []Pair}{Flashvars: flashvars}) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != nil { log.Fatal(<span class="hljs-string"><span class="hljs-string">"There was an error:"</span></span>, err) } }) }</code> -rhjjMH0FZGh0PWwMp0k3IqZTg1tKunkFFGMALgo4Vf8vSzGFG2r8DiJq5-N7K-5MIg7j3VnR0A0-EzaM5kATvrM5FmI1XWmxHbHFmHpS52rKuTvSuH27Ipwt4p2V2DGayvPDjnvvfs6d5-hdaCtoxoOvBJDfecDakToecSzr3kAU6zF4QiMCIC1MtihaH_3C7a9BeLdVqMhr4w4q33WqEso0"}, <code class="actionscript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">package</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">main</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">import</span></span></span><span class="hljs-class"> ( "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">net</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">http</span></span></span><span class="hljs-class">" "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">log</span></span></span><span class="hljs-class">" "./</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">utils</span></span></span><span class="hljs-class">" ) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Pair</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> {</span></span> Key string Value string } func original(Uid string) { flashvars := []Pair{ Pair{<span class="hljs-string"><span class="hljs-string">"fb_source"</span></span>, <span class="hljs-string"><span class="hljs-string">"bookmark"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"ref"</span></span>, <span class="hljs-string"><span class="hljs-string">"bookmarks"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"count"</span></span>, <span class="hljs-string"><span class="hljs-string">"0"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"fb_bmpos"</span></span>, <span class="hljs-string"><span class="hljs-string">"2_0"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"code"</span></span>, <span class="hljs-string"><span class="hljs-string">"AQA9KrPoSxjyTjNoG9B1mUHoZ8ooUxusmPWV6Aa17SfgHIkSVubBwLxCKC5EO7fkfIiC9LvnrDOY35pzlPwyasKVe6q1dcOZzvyQeTmrlf-rhjjMH0FZGh0PWwMp0k3IqZTg1tKunkFFGMALgo4Vf8vSzGFG2r8DiJq5-N7K-5MIg7j3VnR0A0-EzaM5kATvrM5FmI1XWmxHbHFmHpS52rKuTvSuH27Ipwt4p2V2DGayvPDjnvvfs6d5-hdaCtoxoOvBJDfecDakToecSzr3kAU6zF4QiMCIC1MtihaH_3C7a9BeLdVqMhr4w4q33WqEso0"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"sys_id"</span></span>, <span class="hljs-string"><span class="hljs-string">"4"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"network"</span></span>, <span class="hljs-string"><span class="hljs-string">"facebook"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"uid"</span></span>, Uid}, Pair{<span class="hljs-string"><span class="hljs-string">"app_id"</span></span>, <span class="hljs-string"><span class="hljs-string">"1424411677784893"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"interface_lang"</span></span>, <span class="hljs-string"><span class="hljs-string">"uk"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"access_token"</span></span>, <span class="hljs-string"><span class="hljs-string">"CAAUPfrARez0BAKDb5H1uds5kLg3794HyPAbTYRZAA1H2i43NPl8sSjpxl77gIqDapYZB4QxWrZAK1H6VQUVAFbWuTWr4VYbXagirvciMba7FhyYKSUboICrvSJKYgBndShSZA0n4ZA5JRZBqigVbMRdCsHrjl8AQEmcWfbJqkHflqmv8XEBarKEVJRfLp56ksLZCO7TBzkfVQZDZD"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"auth_key"</span></span>, <span class="hljs-string"><span class="hljs-string">"6514a97ae525f196b8060337380e0cbb"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"requestLoadingInfoTimeout"</span></span>, <span class="hljs-string"><span class="hljs-string">"3000"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"ref"</span></span>, <span class="hljs-string"><span class="hljs-string">"bookmark"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"rpc_url"</span></span>, <span class="hljs-string"><span class="hljs-string">"https%3A%2F%2Fepicwar-facebook.progrestar.net%2Frpc%2F"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"preloader_asset"</span></span>, <span class="hljs-string"><span class="hljs-string">"preloader%2Fpreloader_dwarf.swf"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"browser"</span></span>, <span class="hljs-string"><span class="hljs-string">"chrome"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"country_code"</span></span>, <span class="hljs-string"><span class="hljs-string">"UA"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"geoip_city"</span></span>, <span class="hljs-string"><span class="hljs-string">"Kiev"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"index_version"</span></span>, <span class="hljs-string"><span class="hljs-string">"1398240421"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"static_url"</span></span>, <span class="hljs-string"><span class="hljs-string">"https%3A%2F%2Fepicwar-a.akamaihd.net%2F"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"preloader"</span></span>, <span class="hljs-string"><span class="hljs-string">"https%3A%2F%2Fepicwar-a.akamaihd.net%2Ffacebook%2Fv042%2FFbLoader.swf%3Fv%3D2"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"rpc_url"</span></span>, <span class="hljs-string"><span class="hljs-string">"https%3A%2F%2Fepicwar-facebook.progrestar.net%2Frpc%2F"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"stat_url"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://stat.progrestar.net/collector/client/"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"error_url"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://error.progrestar.net/client/"</span></span>}, } t := utils.Template(<span class="hljs-string"><span class="hljs-string">"original"</span></span>) http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/original"</span></span>, func (w http.ResponseWriter, r *http.Request) { err := t.Execute(w, struct{Flashvars []Pair}{Flashvars: flashvars}) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != nil { log.Fatal(<span class="hljs-string"><span class="hljs-string">"There was an error:"</span></span>, err) } }) }</code> "}, <code class="actionscript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">package</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">main</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">import</span></span></span><span class="hljs-class"> ( "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">net</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">http</span></span></span><span class="hljs-class">" "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">log</span></span></span><span class="hljs-class">" "./</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">utils</span></span></span><span class="hljs-class">" ) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Pair</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> {</span></span> Key string Value string } func original(Uid string) { flashvars := []Pair{ Pair{<span class="hljs-string"><span class="hljs-string">"fb_source"</span></span>, <span class="hljs-string"><span class="hljs-string">"bookmark"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"ref"</span></span>, <span class="hljs-string"><span class="hljs-string">"bookmarks"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"count"</span></span>, <span class="hljs-string"><span class="hljs-string">"0"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"fb_bmpos"</span></span>, <span class="hljs-string"><span class="hljs-string">"2_0"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"code"</span></span>, <span class="hljs-string"><span class="hljs-string">"AQA9KrPoSxjyTjNoG9B1mUHoZ8ooUxusmPWV6Aa17SfgHIkSVubBwLxCKC5EO7fkfIiC9LvnrDOY35pzlPwyasKVe6q1dcOZzvyQeTmrlf-rhjjMH0FZGh0PWwMp0k3IqZTg1tKunkFFGMALgo4Vf8vSzGFG2r8DiJq5-N7K-5MIg7j3VnR0A0-EzaM5kATvrM5FmI1XWmxHbHFmHpS52rKuTvSuH27Ipwt4p2V2DGayvPDjnvvfs6d5-hdaCtoxoOvBJDfecDakToecSzr3kAU6zF4QiMCIC1MtihaH_3C7a9BeLdVqMhr4w4q33WqEso0"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"sys_id"</span></span>, <span class="hljs-string"><span class="hljs-string">"4"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"network"</span></span>, <span class="hljs-string"><span class="hljs-string">"facebook"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"uid"</span></span>, Uid}, Pair{<span class="hljs-string"><span class="hljs-string">"app_id"</span></span>, <span class="hljs-string"><span class="hljs-string">"1424411677784893"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"interface_lang"</span></span>, <span class="hljs-string"><span class="hljs-string">"uk"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"access_token"</span></span>, <span class="hljs-string"><span class="hljs-string">"CAAUPfrARez0BAKDb5H1uds5kLg3794HyPAbTYRZAA1H2i43NPl8sSjpxl77gIqDapYZB4QxWrZAK1H6VQUVAFbWuTWr4VYbXagirvciMba7FhyYKSUboICrvSJKYgBndShSZA0n4ZA5JRZBqigVbMRdCsHrjl8AQEmcWfbJqkHflqmv8XEBarKEVJRfLp56ksLZCO7TBzkfVQZDZD"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"auth_key"</span></span>, <span class="hljs-string"><span class="hljs-string">"6514a97ae525f196b8060337380e0cbb"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"requestLoadingInfoTimeout"</span></span>, <span class="hljs-string"><span class="hljs-string">"3000"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"ref"</span></span>, <span class="hljs-string"><span class="hljs-string">"bookmark"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"rpc_url"</span></span>, <span class="hljs-string"><span class="hljs-string">"https%3A%2F%2Fepicwar-facebook.progrestar.net%2Frpc%2F"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"preloader_asset"</span></span>, <span class="hljs-string"><span class="hljs-string">"preloader%2Fpreloader_dwarf.swf"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"browser"</span></span>, <span class="hljs-string"><span class="hljs-string">"chrome"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"country_code"</span></span>, <span class="hljs-string"><span class="hljs-string">"UA"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"geoip_city"</span></span>, <span class="hljs-string"><span class="hljs-string">"Kiev"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"index_version"</span></span>, <span class="hljs-string"><span class="hljs-string">"1398240421"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"static_url"</span></span>, <span class="hljs-string"><span class="hljs-string">"https%3A%2F%2Fepicwar-a.akamaihd.net%2F"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"preloader"</span></span>, <span class="hljs-string"><span class="hljs-string">"https%3A%2F%2Fepicwar-a.akamaihd.net%2Ffacebook%2Fv042%2FFbLoader.swf%3Fv%3D2"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"rpc_url"</span></span>, <span class="hljs-string"><span class="hljs-string">"https%3A%2F%2Fepicwar-facebook.progrestar.net%2Frpc%2F"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"stat_url"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://stat.progrestar.net/collector/client/"</span></span>}, Pair{<span class="hljs-string"><span class="hljs-string">"error_url"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://error.progrestar.net/client/"</span></span>}, } t := utils.Template(<span class="hljs-string"><span class="hljs-string">"original"</span></span>) http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/original"</span></span>, func (w http.ResponseWriter, r *http.Request) { err := t.Execute(w, struct{Flashvars []Pair}{Flashvars: flashvars}) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != nil { log.Fatal(<span class="hljs-string"><span class="hljs-string">"There was an error:"</span></span>, err) } }) }</code> </pre><br></div></div><br>  I left all flashvars, although I think there is no need for some. <br><br>  The communication protocol is quite simple.  Only POST requests and only one URL.  There is no abundance of GET / POST requests and parameters, such as in Grepolis. <br>  The bot, in turn, separately receives the game card, it can be viewed at <a href="http://localhost:8080/bot">http: // localhost: 8080 / bot</a> .  Here is just a map without beautiful and isometric.  But you can clearly see where the building is, which reduces the likelihood of empty spaces in the middle of the city where the enemy can land.  I myself often did that.  And in the home client, an inconvenient isometric projection, where the angle cannot be changed, is not always convenient. <br><br>  I'll start by collecting resources.  It is very simple.  A separate Goroutine is created, which collects resources, if possible, and falls asleep.  In response, buildings and resources come, the so-called state. <br><br><div class="spoiler">  <b class="spoiler_title">Here is the source code for the resource collector.</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processCollectRequest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(player *Player, resp *Response)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, result := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> resp.Results { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(result.Ident == <span class="hljs-string"><span class="hljs-string">"group_1_body"</span></span>){ parseResources(player, result.Result[<span class="hljs-string"><span class="hljs-string">"resource"</span></span>].([]<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>{})) parseBuildings(player, result.Result[<span class="hljs-string"><span class="hljs-string">"building"</span></span>].([]<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>{})) } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">collectFood</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(player *Player)</span></span></span><span class="hljs-function"> *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Response</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> resp *Response <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, building := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> player.Buildings { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(building.TypeId == MILL_ID){ resp = decodeJson(network.Post(collectResource(building.Id))) } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> resp } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">collectGold</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(player *Player)</span></span></span><span class="hljs-function"> *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Response</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> resp *Response <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, building := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> player.Buildings { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(building.TypeId == MINE_ID){ resp = decodeJson(network.Post(collectResource(building.Id))) } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> resp } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resourcesCollector</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(playerChan </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">chan</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Player)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> resp *Response <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> playerStruct Player <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> player *Player resp = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> playerStruct = &lt;- playerChan player = &amp;playerStruct <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(player.FoodCapacity &gt; player.Food){ log.Print(<span class="hljs-string"><span class="hljs-string">"Collect Food"</span></span>) resp = collectFood(player) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(player.GoldCapacity &gt; player.Gold){ log.Print(<span class="hljs-string"><span class="hljs-string">"Collect Gold"</span></span>) resp = collectGold(player) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(resp != <span class="hljs-literal"><span class="hljs-literal">nil</span></span>){ processCollectRequest(player, resp) resp = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } playerChan &lt;- playerStruct time.Sleep(time.Minute * <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> resourcesCollector(playerChan) }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">In a separate constant file.</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> bot <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> CASTLE_ID = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MINE_ID = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TREASURY_ID = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MILL_ID = <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BARN_ID = <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BARRACKS_ID = <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> STAFF_ID = <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BUILDER_HUT_ID = <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> FORGE_ID = <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BALLISTA_ID = <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> WALL_ID = <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ARCHER_TOWER_ID = <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> CANNON_ID = <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> THUNDER_TOWER_ID = <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ICE_TOWER_ID = <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> FIRE_TOWER_ID = <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> CLAN_HOUSE_ID = <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DARK_TOWER_ID = <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TAVERN_ID = <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ALCHEMIST_ID = <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> GOLD_RESOURCE_ID = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> FOOD_RESOURCE_ID = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> CAPACITIES = [<span class="hljs-number"><span class="hljs-number">12</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">uint32</span></span> {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">5000</span></span>, <span class="hljs-number"><span class="hljs-number">15000</span></span>, <span class="hljs-number"><span class="hljs-number">35000</span></span>, <span class="hljs-number"><span class="hljs-number">75000</span></span>, <span class="hljs-number"><span class="hljs-number">150000</span></span>, <span class="hljs-number"><span class="hljs-number">300000</span></span>, <span class="hljs-number"><span class="hljs-number">600000</span></span>, <span class="hljs-number"><span class="hljs-number">1000000</span></span>, <span class="hljs-number"><span class="hljs-number">2000000</span></span>, <span class="hljs-number"><span class="hljs-number">3000000</span></span>, <span class="hljs-number"><span class="hljs-number">4000000</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> BUILDINGS = Buildings{ Wall: BuildingDependencies{ BuildingDependency{CastleLvl: <span class="hljs-number"><span class="hljs-number">2</span></span>, Cost: <span class="hljs-number"><span class="hljs-number">250</span></span>}, BuildingDependency{CastleLvl: <span class="hljs-number"><span class="hljs-number">2</span></span>, Cost: <span class="hljs-number"><span class="hljs-number">500</span></span>}, BuildingDependency{CastleLvl: <span class="hljs-number"><span class="hljs-number">3</span></span>, Cost: <span class="hljs-number"><span class="hljs-number">1000</span></span>}, BuildingDependency{CastleLvl: <span class="hljs-number"><span class="hljs-number">4</span></span>, Cost: <span class="hljs-number"><span class="hljs-number">3000</span></span>}, BuildingDependency{CastleLvl: <span class="hljs-number"><span class="hljs-number">5</span></span>, Cost: <span class="hljs-number"><span class="hljs-number">10000</span></span>}, BuildingDependency{CastleLvl: <span class="hljs-number"><span class="hljs-number">6</span></span>, Cost: <span class="hljs-number"><span class="hljs-number">25000</span></span>}, BuildingDependency{CastleLvl: <span class="hljs-number"><span class="hljs-number">7</span></span>, Cost: <span class="hljs-number"><span class="hljs-number">60000</span></span>}, BuildingDependency{CastleLvl: <span class="hljs-number"><span class="hljs-number">8</span></span>, Cost: <span class="hljs-number"><span class="hljs-number">150000</span></span>}, BuildingDependency{CastleLvl: <span class="hljs-number"><span class="hljs-number">9</span></span>, Cost: <span class="hljs-number"><span class="hljs-number">400000</span></span>}, BuildingDependency{CastleLvl: <span class="hljs-number"><span class="hljs-number">10</span></span>, Cost: <span class="hljs-number"><span class="hljs-number">1000000</span></span>}, BuildingDependency{CastleLvl: <span class="hljs-number"><span class="hljs-number">11</span></span>, Cost: <span class="hljs-number"><span class="hljs-number">2000000</span></span>}}}</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">And the parser</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> bot <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"log"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseResources</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(player *Player, resources []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">interface</span></span></span></span><span class="hljs-function"><span class="hljs-params">{})</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, resource := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> resources { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Id <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Amount <span class="hljs-keyword"><span class="hljs-keyword">uint32</span></span> Id = <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>(resource.(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>{})[<span class="hljs-string"><span class="hljs-string">"id"</span></span>].(<span class="hljs-keyword"><span class="hljs-keyword">float64</span></span>)) Amount = <span class="hljs-keyword"><span class="hljs-keyword">uint32</span></span>(resource.(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>{})[<span class="hljs-string"><span class="hljs-string">"amount"</span></span>].(<span class="hljs-keyword"><span class="hljs-keyword">float64</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Id == GOLD_RESOURCE_ID){ player.Gold = Amount log.Print(<span class="hljs-string"><span class="hljs-string">"Gold - "</span></span>, Amount) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Id == FOOD_RESOURCE_ID){ player.Food = Amount log.Print(<span class="hljs-string"><span class="hljs-string">"Food - "</span></span>, Amount) } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseUnits</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(player *Player, units []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">interface</span></span></span></span><span class="hljs-function"><span class="hljs-params">{})</span></span></span></span>{ player.Units = []Unit{} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, unit := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> units { player.Units = <span class="hljs-built_in"><span class="hljs-built_in">append</span></span>( player.Units, Unit{ Id: <span class="hljs-keyword"><span class="hljs-keyword">uint64</span></span>(unit.(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>{})[<span class="hljs-string"><span class="hljs-string">"id"</span></span>].(<span class="hljs-keyword"><span class="hljs-keyword">float64</span></span>)), Amount: <span class="hljs-keyword"><span class="hljs-keyword">uint64</span></span>(unit.(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>{})[<span class="hljs-string"><span class="hljs-string">"amount"</span></span>].(<span class="hljs-keyword"><span class="hljs-keyword">float64</span></span>))}) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseBuildings</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(player *Player, buildings []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">interface</span></span></span></span><span class="hljs-function"><span class="hljs-params">{})</span></span></span></span>{ player.Buildings = []Building{} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, building := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> buildings { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> typeId <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> level <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> completed <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> typeId = <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>(building.(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>{})[<span class="hljs-string"><span class="hljs-string">"typeId"</span></span>].(<span class="hljs-keyword"><span class="hljs-keyword">float64</span></span>)) level = <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>(building.(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>{})[<span class="hljs-string"><span class="hljs-string">"level"</span></span>].(<span class="hljs-keyword"><span class="hljs-keyword">float64</span></span>)) completed = building.(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>{})[<span class="hljs-string"><span class="hljs-string">"completed"</span></span>].(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(typeId == BARN_ID) { player.FoodCapacity += CAPACITIES[level] } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(typeId == TREASURY_ID) { player.GoldCapacity += CAPACITIES[level] } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(typeId == CASTLE_ID){ player.CastleLvl = level <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(completed == <span class="hljs-literal"><span class="hljs-literal">false</span></span>){ player.CastleLvl-- } } player.Buildings = <span class="hljs-built_in"><span class="hljs-built_in">append</span></span>( player.Buildings, Building{ Id: <span class="hljs-keyword"><span class="hljs-keyword">uint64</span></span>(building.(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>{})[<span class="hljs-string"><span class="hljs-string">"id"</span></span>].(<span class="hljs-keyword"><span class="hljs-keyword">float64</span></span>)), TypeId: typeId, Flip: building.(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>{})[<span class="hljs-string"><span class="hljs-string">"flip"</span></span>].(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>), Level: level, X: <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>(building.(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>{})[<span class="hljs-string"><span class="hljs-string">"x"</span></span>].(<span class="hljs-keyword"><span class="hljs-keyword">float64</span></span>)), Y: <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>(building.(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>{})[<span class="hljs-string"><span class="hljs-string">"y"</span></span>].(<span class="hljs-keyword"><span class="hljs-keyword">float64</span></span>)), Completed: completed, Volume: <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>(building.(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>{})[<span class="hljs-string"><span class="hljs-string">"volume"</span></span>].(<span class="hljs-keyword"><span class="hljs-keyword">float64</span></span>)), StateTimestamp:<span class="hljs-keyword"><span class="hljs-keyword">uint64</span></span>(building.(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>{})[<span class="hljs-string"><span class="hljs-string">"stateTimestamp"</span></span>].(<span class="hljs-keyword"><span class="hljs-keyword">float64</span></span>)), Hitpoints: <span class="hljs-keyword"><span class="hljs-keyword">uint64</span></span>(building.(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>{})[<span class="hljs-string"><span class="hljs-string">"hitpoints"</span></span>].(<span class="hljs-keyword"><span class="hljs-keyword">float64</span></span>)), CompleteTime: <span class="hljs-keyword"><span class="hljs-keyword">uint64</span></span>(building.(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>{})[<span class="hljs-string"><span class="hljs-string">"completeTime"</span></span>].(<span class="hljs-keyword"><span class="hljs-keyword">float64</span></span>))}) } }</code> </pre><br></div></div><br>  I made the self-improvement of buildings only for the walls, because there are a lot of them to click on each separate block is very inconvenient.  The answer is the same state. <br><div class="spoiler">  <b class="spoiler_title">builder</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">builder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(playerChan </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">chan</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Player)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> playerStruct Player <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> player *Player <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> resp *Response <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isBuild <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span> playerStruct = &lt;- playerChan player = &amp;playerStruct <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, building := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> player.Buildings { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( building.TypeId == WALL_ID &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(BUILDINGS.Wall) &gt; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(building.Level) &amp;&amp; player.CastleLvl &gt;= BUILDINGS.Wall[building.Level].CastleLvl &amp;&amp; player.Gold &gt;= BUILDINGS.Wall[building.Level].Cost){ log.Print(<span class="hljs-string"><span class="hljs-string">"Upgrade Wall. Level "</span></span>, building.Level) resp = decodeJson(network.Post(upgradeBuilding(building.Id))) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(resp != <span class="hljs-literal"><span class="hljs-literal">nil</span></span>){ processCollectRequest(player, resp) isBuild = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> } } playerChan &lt;- playerStruct <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(isBuild){ time.Sleep(time.Second) }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ time.Sleep(time.Hour) } <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> builder(playerChan) }</code> </pre><br></div></div><br>  I‚Äôll also make a reservation that you can simply transfer the structure to Goroutin by reference.  But when I did that, the garbage collector cleared the memory after a while and I had a nullPointer exception thrown away.  Therefore, I use channels. <br><div class="spoiler">  <b class="spoiler_title">Main</b> <div class="spoiler_text"><pre> <code class="go hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decodeJson</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(encoded_json []</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Response</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> resp *Response err := json.Unmarshal(encoded_json, &amp;resp) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span>){ log.Fatal(<span class="hljs-string"><span class="hljs-string">"decodeJson"</span></span>, err) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(resp.Error != Error{}){ resp = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> resp } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initGame</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(playerChan </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">chan</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Player)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> playerStruct Player <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> player *Player playerStruct = Player{} player = &amp;playerStruct resp := decodeJson(network.Post(getStartBoard())) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, result := <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> resp.Results { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(result.Ident == <span class="hljs-string"><span class="hljs-string">"getSelfInfo"</span></span>){ user := result.Result[<span class="hljs-string"><span class="hljs-string">"user"</span></span>].(<span class="hljs-keyword"><span class="hljs-keyword">map</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>{}) level, _ := strconv.Atoi(user[<span class="hljs-string"><span class="hljs-string">"level"</span></span>].(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>)) player.Level = <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>(level) player.Stars = <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>(user[<span class="hljs-string"><span class="hljs-string">"starmoney"</span></span>].(<span class="hljs-keyword"><span class="hljs-keyword">float64</span></span>)) parseUnits(player, user[<span class="hljs-string"><span class="hljs-string">"unit"</span></span>].([]<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>{})) parseResources(player, user[<span class="hljs-string"><span class="hljs-string">"resource"</span></span>].([]<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>{})) } player.GoldCapacity = <span class="hljs-number"><span class="hljs-number">0</span></span> player.FoodCapacity = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(result.Ident == <span class="hljs-string"><span class="hljs-string">"getBuildings"</span></span>){ parseBuildings(player, result.Result[<span class="hljs-string"><span class="hljs-string">"building"</span></span>].([]<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>{})) } } playerChan &lt;- playerStruct } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> player = <span class="hljs-built_in"><span class="hljs-built_in">make</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">chan</span></span> Player, <span class="hljs-number"><span class="hljs-number">1</span></span>) initGame(player) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> resourcesCollector(player) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> builder(player) http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/bot"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span></span></span> { t, err := template.ParseFiles(<span class="hljs-string"><span class="hljs-string">"static/bot.html"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Fatal(<span class="hljs-string"><span class="hljs-string">"There was an error:"</span></span>, err) } err = t.Execute(w, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { log.Fatal(<span class="hljs-string"><span class="hljs-string">"There was an error:"</span></span>, err) } }) http.HandleFunc(<span class="hljs-string"><span class="hljs-string">"/bot/map"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(w http.ResponseWriter, r *http.Request)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> playerStruct Player = &lt;- player player &lt;- playerStruct json, err := json.Marshal(playerStruct) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span>){ log.Fatal(err) } io.WriteString(w, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>(json)) }) }</code> </pre><br></div></div><br>  I will also introduce the client part of the bot.  The most difficult thing was to optimally display the places where there are no buildings, but the landing cannot be landed there either.  The rest is extremely simple. <br><div class="spoiler">  <b class="spoiler_title">Who cares about the bot client code</b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!doctype html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Throne Rush Bot<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css"> </span><span class="hljs-selector-id"><span class="css"><span class="hljs-selector-id">#main</span></span></span><span class="css">{ </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">display</span></span></span><span class="css">:block; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">margin</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css"> auto; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">background-color</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">#00FF33</span></span></span><span class="css">; } </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">body</span></span></span><span class="css">{ </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">background-color</span></span></span><span class="css">:</span><span class="hljs-number"><span class="css"><span class="hljs-number">#66CC00</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">height</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">100%</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">margin</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">padding</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">; } </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">html</span></span></span><span class="css">{ </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">height</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">100%</span></span></span><span class="css">; } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">canvas</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"main"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">canvas</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> STYLES = { </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">: { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">name</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Castle"</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">size</span></span></span><span class="javascript">: </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">5</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">fillColor</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#996600'</span></span></span><span class="javascript"> }, </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">2</span></span></span><span class="javascript">: { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">name</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Mine"</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">size</span></span></span><span class="javascript">: </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">2</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">fillColor</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#996600'</span></span></span><span class="javascript"> }, </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">3</span></span></span><span class="javascript">: { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">name</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Treasury"</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">size</span></span></span><span class="javascript">: </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">3</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">fillColor</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#996600'</span></span></span><span class="javascript"> }, </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">4</span></span></span><span class="javascript">: { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">name</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Mill"</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">size</span></span></span><span class="javascript">: </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">2</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">fillColor</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#996600'</span></span></span><span class="javascript"> }, </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">5</span></span></span><span class="javascript">: { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">name</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Barn"</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">size</span></span></span><span class="javascript">: </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">3</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">fillColor</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#996600'</span></span></span><span class="javascript"> }, </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">6</span></span></span><span class="javascript">: { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">name</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Barracs"</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">size</span></span></span><span class="javascript">: </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">3</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">fillColor</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#996600'</span></span></span><span class="javascript"> }, </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">7</span></span></span><span class="javascript">: { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">name</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Staff"</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">size</span></span></span><span class="javascript">: </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">2</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">fillColor</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#996600'</span></span></span><span class="javascript"> }, </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">8</span></span></span><span class="javascript">: { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">name</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Bldrs"</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">size</span></span></span><span class="javascript">: </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">2</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">fillColor</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#996600'</span></span></span><span class="javascript"> }, </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">9</span></span></span><span class="javascript">: { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">name</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Forge"</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">size</span></span></span><span class="javascript">: </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">2</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">fillColor</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#996600'</span></span></span><span class="javascript"> }, </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">10</span></span></span><span class="javascript">: { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">name</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Ballista"</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">size</span></span></span><span class="javascript">: </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">2</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">fillColor</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#996600'</span></span></span><span class="javascript"> }, </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">11</span></span></span><span class="javascript">: { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">name</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">""</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">size</span></span></span><span class="javascript">: </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">fillColor</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#660000'</span></span></span><span class="javascript"> }, </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">12</span></span></span><span class="javascript">: { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">name</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Archrs"</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">size</span></span></span><span class="javascript">: </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">2</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">fillColor</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#996600'</span></span></span><span class="javascript"> }, </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">13</span></span></span><span class="javascript">: { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">name</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Cannon"</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">size</span></span></span><span class="javascript">: </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">2</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">fillColor</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#996600'</span></span></span><span class="javascript"> }, </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">14</span></span></span><span class="javascript">: { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">name</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Thunder"</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">size</span></span></span><span class="javascript">: </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">2</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">fillColor</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#996600'</span></span></span><span class="javascript"> }, </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">15</span></span></span><span class="javascript">: { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">name</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Ice"</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">size</span></span></span><span class="javascript">: </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">2</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">fillColor</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#996600'</span></span></span><span class="javascript"> }, </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">16</span></span></span><span class="javascript">: { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">name</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Fire Tower"</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">size</span></span></span><span class="javascript">: </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">2</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">fillColor</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#996600'</span></span></span><span class="javascript"> }, </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">17</span></span></span><span class="javascript">: { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">name</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Clan house"</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">size</span></span></span><span class="javascript">: </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">3</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">fillColor</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#996600'</span></span></span><span class="javascript"> }, </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">18</span></span></span><span class="javascript">: { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">name</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Dark Tower"</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">size</span></span></span><span class="javascript">: </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">2</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">fillColor</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#996600'</span></span></span><span class="javascript"> }, </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">19</span></span></span><span class="javascript">: { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">name</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Tavern"</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">size</span></span></span><span class="javascript">: </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">3</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">fillColor</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#996600'</span></span></span><span class="javascript"> }, </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">20</span></span></span><span class="javascript">: { </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">name</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Alchemist"</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">size</span></span></span><span class="javascript">: </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">3</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">fillColor</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'#996600'</span></span></span><span class="javascript"> } }; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> MAP_SIZE = </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">36</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> NOT_DESANT_COLOR = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"#FF0033"</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> height = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.body.clientHeight; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> canvas = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.getElementById(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'main'</span></span></span><span class="javascript">); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> ctx = canvas.getContext(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'2d'</span></span></span><span class="javascript">); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> step = height / </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">40</span></span></span><span class="javascript">; canvas.width = height; canvas.height = height; canvas.style.width = height + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'px'</span></span></span><span class="javascript">; canvas.style.height = height + </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'px'</span></span></span><span class="javascript">; ctx.strokeStyle=</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"#FF0033"</span></span></span><span class="javascript">; ctx.textAlign=</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"center"</span></span></span><span class="javascript">; ctx.textBaseline=</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"middle"</span></span></span><span class="javascript">; </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">pointFree</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">buildings, point</span></span></span></span><span class="javascript"><span class="hljs-function">)</span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">for</span></span></span><span class="javascript">(</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> i </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">in</span></span></span><span class="javascript"> buildings){ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> building = buildings[i]; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript">( point[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">] &gt;= building.x &amp;&amp; point[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">] &lt; building.x + STYLES[building.typeId].size &amp;&amp; point[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">] &gt;= building.y &amp;&amp; point[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">] &lt; building.y + STYLES[building.typeId].size ){ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">return</span></span></span><span class="javascript"> </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">false</span></span></span><span class="javascript">; } } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">return</span></span></span><span class="javascript"> </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">true</span></span></span><span class="javascript">; } </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">drawMap</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">player</span></span></span></span><span class="javascript"><span class="hljs-function">)</span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> redPoints = []; player.Buildings .forEach(</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">building</span></span></span></span><span class="javascript"><span class="hljs-function">)</span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">for</span></span></span><span class="javascript">(</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> i = </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">-1</span></span></span><span class="javascript">; i &lt; STYLES[building.typeId].size + </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">; i++){ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> point = [building.x + i, building.y - </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">].join(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">','</span></span></span><span class="javascript">); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript">(redPoints.indexOf(point) === </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">-1</span></span></span><span class="javascript">){ redPoints.push(point); } } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">for</span></span></span><span class="javascript">(</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> i = </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">-1</span></span></span><span class="javascript">; i &lt; STYLES[building.typeId].size + </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">; i++){ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> point = [building.x + i, building.y + STYLES[building.typeId].size].join(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">','</span></span></span><span class="javascript">); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript">(redPoints.indexOf(point) === </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">-1</span></span></span><span class="javascript">){ redPoints.push(point); } } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">for</span></span></span><span class="javascript">(</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> i = </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">-1</span></span></span><span class="javascript">; i &lt; STYLES[building.typeId].size + </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">; i++){ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> point = [building.x - </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">, building.y + i].join(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">','</span></span></span><span class="javascript">); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript">(redPoints.indexOf(point) === </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">-1</span></span></span><span class="javascript">){ redPoints.push(point); } } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">for</span></span></span><span class="javascript">(</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> i = </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">-1</span></span></span><span class="javascript">; i &lt; STYLES[building.typeId].size + </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">; i++){ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> point = [building.x + STYLES[building.typeId].size, building.y + i].join(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">','</span></span></span><span class="javascript">); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript">(redPoints.indexOf(point) === </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">-1</span></span></span><span class="javascript">){ redPoints.push(point); } } ctx.fillStyle=STYLES[building.typeId].fillColor; ctx.fillRect( step * building.x, step * building.y, step * STYLES[building.typeId].size, step * STYLES[building.typeId].size); ctx.stroke(); ctx.strokeText( STYLES[building.typeId].name+</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'('</span></span></span><span class="javascript">+building.level+</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">')'</span></span></span><span class="javascript">, step * building.x + step * STYLES[building.typeId].size / </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">2</span></span></span><span class="javascript">, step * building.y + step * STYLES[building.typeId].size / </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">2</span></span></span><span class="javascript">); }); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">while</span></span></span><span class="javascript">(redPoints.length &gt; </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">){ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> point = redPoints.pop().split(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">','</span></span></span><span class="javascript">); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript">(pointFree(player.Buildings, point)){ ctx.fillStyle=NOT_DESANT_COLOR; ctx.fillRect( step * point[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">], step * point[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">], step, step); ctx.stroke(); } } } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> xmlhttp = </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">new</span></span></span><span class="javascript"> XMLHttpRequest(); xmlhttp.open(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'GET'</span></span></span><span class="javascript">, </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'/bot/map'</span></span></span><span class="javascript">, </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">true</span></span></span><span class="javascript">); xmlhttp.onreadystatechange = </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (xmlhttp.readyState === </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">4</span></span></span><span class="javascript">) { drawMap(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">JSON</span></span></span><span class="javascript">.parse(xmlhttp.responseText)) } }; xmlhttp.send(</span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">null</span></span></span><span class="javascript">); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">So he looks like</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/732/4dd/f23/7324ddf23b165c85df53306c664ce692.png"><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/223013/">https://habr.com/ru/post/223013/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../222997/index.html">Is the native method expensive? JNI "Secret" extension</a></li>
<li><a href="../222999/index.html">ANC9 - evolution of headphones with active noise cancellation</a></li>
<li><a href="../223003/index.html">FCC approved net neutrality cancellation plan</a></li>
<li><a href="../223005/index.html">Spectral-selective polymer window films: 3M technology in sun protection</a></li>
<li><a href="../223009/index.html">"Quantum compass" as an alternative to GPS</a></li>
<li><a href="../223015/index.html">Jump Start May 20: Data Center Virtualization using Windows Server 2012 R2 and System Center 2012 R2. Deploying Virtual Machines and Services</a></li>
<li><a href="../223017/index.html">5,000 rubles for website promotion: is there a business outside the Moscow Ring Road?</a></li>
<li><a href="../223021/index.html">Hadoop and Automation: Part 3</a></li>
<li><a href="../223025/index.html">Restoration of virginity accelerator Cyberstorm MK-III for Amiga computers</a></li>
<li><a href="../223027/index.html">Everything you need to know about prototypes, closures, and performance</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>