<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Qwt and Qt Creator. Part 3: Graph as a Designer Form Element</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The examples used are Qt Creator 3.0.0 (MinGW) and Qwt-6.1.0. 

 To understand this article, the reader must have initial experience in developing win...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Qwt and Qt Creator. Part 3: Graph as a Designer Form Element</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/6f0/7ce/c0d/6f07cec0d44f9c1eac53f129b07a612e.png"><br><br>  <i>The examples used are Qt Creator 3.0.0 (MinGW) and Qwt-6.1.0.</i> <i><br><br></i>  <i>To understand this article, the reader must have initial experience in developing windows applications in the Qt Creator environment, and understand the concept of signal-slot.</i>  <i>It is also recommended to get acquainted with part 1 and 2 of the series of my articles on Qwt:</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="http://habrahabr.ru/post/211204/">habrahabr.ru/post/211204</a> <br>  <a href="http://habrahabr.ru/post/211867/">habrahabr.ru/post/211867</a> <br><br>  <b>Qwt</b> is a graphic library that allows you to significantly simplify the process of data visualization in the program.  Simplification is as follows: there is no need to manually prescribe display elements, such as scales of coordinates, grids, data curves, and so on.  It is only necessary to set the parameters of these elements. <br><br>  In the previous parts of the cycle of articles, schedule controls were added by manual coding.  I think most programmers would prefer to use Qt Creator tools. <br><br>  <b>In part number 3, we will do the following:</b> <br><br>  ‚Ä¢ add a widget to display the graphic in the Designer Form, which allows using Qt Creator controls; <br>  ‚Ä¢ we will build a demo curve, we will implement the basic convenience of working with the schedule: the ability to move around the schedule field, its approach / delete, we will display the coordinates of the cursor as it moves; <br>  ‚Ä¢ display click coordinates in the Designer Form status bar; <br>  ‚Ä¢ move the curve along the x axis using standard Qt Creator controls. <br><br><a name="habracut"></a>  The content of this article to some extent duplicates the content of part 2.  This was done on purpose, since I wanted to make the articles independent of each other. <br><br><div class="spoiler">  <b class="spoiler_title">Add a widget to display the graph in the Designer Form</b> <div class="spoiler_text">  1. Create a project with Mainwindow.  Let me remind you of the required procedure for using Qwt: add the line "CONFIG + = qwt" to the project's .pro file and launch qmake via the context menu (right-click on the project root folder). <br><br>  2. Open the form editor and find the widget ‚ÄúWidget‚Äù.  Place it on the form. <br><img src="https://habrastorage.org/getpro/habr/post_images/d95/44d/78e/d9544d78eae7740a8649b266c47f7b1e.png"><br><br>  3. Change the name of the added ‚ÄúWidget‚Äù to ‚ÄúQwt_Widget‚Äù. <br>  4. Right click on "Qwt_Widget" and select "Promote to ..." <br><img src="https://habrastorage.org/getpro/habr/post_images/84a/3ba/971/84a3ba971060a9a351aed83c656c1d7c.png"><br><br>  5. In the Promoted class name field, type ‚ÄúQwtPlot‚Äù.  In the Header file field, change ‚Äúqwtplot.h‚Äù to ‚Äúqwt_plot.h‚Äù.  Click Add and close the window. <br><img src="https://habrastorage.org/getpro/habr/post_images/c87/38a/6a0/c8738a6a0f3f796c7274a3c2ceed0fc9.png"><br><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">We will construct a demonstration curve, we will implement the basic convenience of working with the schedule</b> <div class="spoiler_text">  Below is the code, in many respects similar to that published in Part 2.  The code is slightly improved, the fragments responsible for the ‚Äúmanual‚Äù addition of controls are removed. <br>  Pay special attention to the following.  Previously, we created a private variable QwtPlot * d_plot, and then used such a construct as, for example: <br><pre><code class="cpp hljs">d_plot-&gt;setTitle( <span class="hljs-string"><span class="hljs-string">"Qwt demonstration"</span></span> );</code> </pre> <br><br>  Now for the properties of the chart, we will use the following structure: <br><pre> <code class="cpp hljs">ui-&gt;Qwt_Widget-&gt;setTitle( <span class="hljs-string"><span class="hljs-string">"Qwt demonstration"</span></span> );</code> </pre><br><br>  Moreover, if there are no such constructions in the code, then ‚ÄúQwt_Widget‚Äù is empty.  After adding a line with the setting, this widget starts displaying the graph field. <br><br><div class="spoiler">  <b class="spoiler_title">The contents of the mainwindow.h file</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> MAINWINDOW_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAINWINDOW_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QMainWindow&gt; #include &lt;qwt_plot.h&gt; #include &lt;qwt_plot_grid.h&gt; #include &lt;qwt_legend.h&gt; #include &lt;qwt_plot_curve.h&gt; #include &lt;qwt_symbol.h&gt; #include &lt;qwt_plot_magnifier.h&gt; #include &lt;qwt_plot_panner.h&gt; #include &lt;qwt_plot_picker.h&gt; #include &lt;qwt_picker_machine.h&gt; namespace Ui { class MainWindow; } class MainWindow : public QMainWindow { Q_OBJECT public: explicit MainWindow(QWidget *parent = 0); ~MainWindow(); private Q_SLOTS: void click_on_canvas( const QPoint &amp;pos ); private: Ui::MainWindow *ui; void addPlot(); void addPlotGrid(); QwtPlotCurve *curve; QPolygonF points; void addCurve(); void enableMagnifier(); void enableMovingOnPlot(); void enablePicker(); }; #endif // MAINWINDOW_H</span></span></span></span></code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">The contents of the mainwindow.cpp file</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"mainwindow.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ui_mainwindow.h"</span></span></span><span class="hljs-meta"> MainWindow::MainWindow(QWidget *parent) : QMainWindow(parent), ui(new Ui::MainWindow) { ui-&gt;setupUi(this); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//        addPlot(); //    addPlotGrid(); //  addCurve(); //   /  enableMagnifier(); //      enableMovingOnPlot(); //        //      enablePicker(); } MainWindow::~MainWindow() { delete ui; } void MainWindow::addPlot() { // #include &lt;qwt_plot.h&gt; ui-&gt;Qwt_Widget-&gt;setTitle( "Qwt demonstration" ); ui-&gt;Qwt_Widget-&gt;setCanvasBackground( Qt::white ); //    ui-&gt;Qwt_Widget-&gt;setAxisTitle(QwtPlot::yLeft, "Y"); ui-&gt;Qwt_Widget-&gt;setAxisTitle(QwtPlot::xBottom, "X"); ui-&gt;Qwt_Widget-&gt;insertLegend( new QwtLegend() ); } void MainWindow::addPlotGrid() { // #include &lt;qwt_plot_grid.h&gt; QwtPlotGrid *grid = new QwtPlotGrid(); grid-&gt;setMajorPen(QPen( Qt::gray, 2 )); //     grid-&gt;attach( ui-&gt;Qwt_Widget ); } void MainWindow::addCurve() { //#include &lt;qwt_plot_curve.h&gt; curve = new QwtPlotCurve(); curve-&gt;setTitle( "Demo Curve" ); curve-&gt;setPen( Qt::blue, 6 ); //     //   // #include &lt;qwt_symbol.h&gt; QwtSymbol *symbol = new QwtSymbol( QwtSymbol::Ellipse, QBrush( Qt::yellow ), QPen( Qt::red, 2 ), QSize( 8, 8 ) ); curve-&gt;setSymbol( symbol ); //       //     ,   //    for (int i = 0; i &lt; 5; i++) { points &lt;&lt; QPointF( 1.0 * i, 1.0 * i); //   } curve-&gt;setSamples( points ); //      curve-&gt;attach( ui-&gt;Qwt_Widget ); //     } void MainWindow::enableMagnifier() { // #include &lt;qwt_plot_magnifier.h&gt; QwtPlotMagnifier *magnifier = new QwtPlotMagnifier(ui-&gt;Qwt_Widget-&gt;canvas()); // ,  / magnifier-&gt;setMouseButton(Qt::MidButton); } void MainWindow::enableMovingOnPlot() { // #include &lt;qwt_plot_panner.h&gt; QwtPlotPanner *d_panner = new QwtPlotPanner( ui-&gt;Qwt_Widget-&gt;canvas() ); // ,   d_panner-&gt;setMouseButton( Qt::RightButton ); } void MainWindow::enablePicker() { // #include &lt;qwt_plot_picker.h&gt; //   QwtPlotPicker *d_picker = new QwtPlotPicker( QwtPlot::xBottom, QwtPlot::yLeft, //    QwtPlotPicker::CrossRubberBand, //    QwtPicker::AlwaysOn, //   ui-&gt;Qwt_Widget-&gt;canvas() ); //    //    d_picker-&gt;setRubberBandPen( QColor( Qt::red ) ); //     d_picker-&gt;setTrackerPen( QColor( Qt::black ) ); //     d_picker-&gt;setStateMachine( new QwtPickerDragPointMachine() ); }</span></span></span></span></code> </pre><br></div></div><br>  The performed actions allow us to display the graph directly in the form, and the dimensions of its canvas correspond to the dimensions of ‚ÄúQwt_Widget‚Äù.  Try resizing the form after compiling and running the program.  The dimensions of "Qwt_Widget", of course, do not change.  For this to happen, you must use the "Layout".  I decided not to describe this standard (well-trodden and traversed) procedure in the article. <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Display click coordinates in the Designer Form status bar.</b> <div class="spoiler_text">  1. Add the code to the prototype of the MainWindow class in the mainwindow.h file <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Q_SLOTS: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">click_on_canvas</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QPoint &amp;pos )</span></span></span></span>;</code> </pre><br><br>  implement the slot (function) in mainwindow.cpp: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> MainWindow::click_on_canvas( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QPoint &amp;pos ) { <span class="hljs-comment"><span class="hljs-comment">//     double x = ui-&gt;Qwt_Widget-&gt;invTransform(QwtPlot::xBottom, pos.x()); double y = ui-&gt;Qwt_Widget-&gt;invTransform(QwtPlot::yLeft, pos.y()); statusBar()-&gt;showMessage("x= " + QString::number(x) + "; y = " + QString::number(y)); }</span></span></code> </pre><br><br>  Add the following line to the function enablePicker (): <br><pre> <code class="cpp hljs"> connect( d_picker, SIGNAL( appended( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QPoint &amp; ) ), SLOT( click_on_canvas( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QPoint &amp; ) ) );</code> </pre><br><br>  Alternatively, one could declare d_picker a private variable of the MainWindow class and make the above signal-slot connection in the constructor, or in a special method. <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Move the curve along the x axis</b> <div class="spoiler_text">  Here, since the visualizer is added using Widget, everything is simple and familiar: <br>  1. Add the ‚ÄúDouble Spin box‚Äù control to the form and rename it to ‚ÄúchangeXSpinBox‚Äù. <br>  2. Add the ‚ÄúPushButton‚Äù control to the form and rename it to ‚ÄúmoveByXButton‚Äù.  Change the text on the button to ‚ÄúChange x‚Äù. <br>  3. For "moveByXButton", execute the command "Go to slot" -&gt; clicked. <br>  4. The function should look like this: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> MainWindow::on_moveByXButton_clicked() { <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> x = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   ','  '.'  ,  //  spinBox      double QString spinBoxText = ui-&gt;changeXSpinBox-&gt;text().replace( QLocale().decimalPoint(), QLatin1Char('.')); double xChangeValue = spinBoxText.toDouble(); for (int i = 0; i &lt;points.size(); i++) { x = points[i].x(); points[i].setX(x + xChangeValue); } curve-&gt;setSamples(points); ui-&gt;Qwt_Widget-&gt;replot(); }</span></span></code> </pre><br></div></div><br><br>  <b>Conclusions:</b> we successfully used the Qt Creator design tools to create a visualizer and its demonstration controls.  With the spinBox and button, we can change the x-coordinate of the displayed curve. <br>  In part 4 of the article cycle, we will implement additional ways to increase / decrease graphics, sample points with the mouse, editing tools for displaying graphics and curves, and exporting graphics. <br><br>  PS I express my great appreciation to <a href="http://habrahabr.ru/users/riateche/" class="user_link">Riateche</a> for the valuable comments on articles No. 1 and No. 2, which were taken into account when writing this article. <br><br>  <b>References:</b> <br><br>  Sources: <br>  <a href="https://github.com/VladimirSap/Qwt_Tutorial">github.com/VladimirSap/Qwt_Tutorial</a> <br><br>  Official resource: <br>  <a href="http://qwt.sourceforge.net/">qwt.sourceforge.net</a> <br><br>  Collection of solutions of various problems with Qwt: <br>  <a href="http://www.qtcentre.org/archive/index.php/f-23.html">www.qtcentre.org/archive/index.php/f-23.html</a> <br><br>  Library variant, alternative Qwt (thanks, <a href="http://habrahabr.ru/users/gooroo/" class="user_link">GooRoo</a> ) <br>  <a href="http://www.qcustomplot.com/">www.qcustomplot.com</a> <br><br>  Links to previous articles in the cycle: <br>  Part 1: <a href="http://habrahabr.ru/post/211204/">habrahabr.ru/post/211204</a> <br>  Part 2: <a href="http://habrahabr.ru/post/211867/">habrahabr.ru/post/211867</a> </div><p>Source: <a href="https://habr.com/ru/post/212137/">https://habr.com/ru/post/212137/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../212121/index.html">Classic Scala Design Patterns</a></li>
<li><a href="../212123/index.html">Lightpack went on sale in Russia</a></li>
<li><a href="../212125/index.html">Create an album gallery</a></li>
<li><a href="../212127/index.html">Freaks and Geeks: the main cranks of the IT world</a></li>
<li><a href="../212131/index.html">Open Data Day February 22 in Moscow</a></li>
<li><a href="../212141/index.html">The service approach of publishing or transmitting data is strictly not earlier than the specified date and / or only in a certain geolocation</a></li>
<li><a href="../212143/index.html">What browser are you using?</a></li>
<li><a href="../212145/index.html">Usability testing of a new corporate product</a></li>
<li><a href="../212147/index.html">Interview with Sergei Belousov: really big data</a></li>
<li><a href="../212153/index.html">PhpStorm - we increase productivity (plug-ins and themes). Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>