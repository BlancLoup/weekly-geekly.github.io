<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What is SPF</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I think no one needs to explain what the problem is spam in our time. The fight against this evil is not a simple matter, and if you want to approach ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What is SPF</h1><div class="post__text post__text-html js-mediator-article">  I think no one needs to explain what the problem is spam in our time.  The fight against this evil is not a simple matter, and if you want to approach the ideal, requiring a combination of several elements.  One of these elements is the SPF protocol.  Being published in April 2006 in RFC 2006, the protocol currently has the status of ‚Äúexperimental‚Äù, and quite good prevalence. <br><br>  SPF is adopted by such giants as Google, Yandex, Mail.Ru, Microsoft, Rambler.  Yahoo does not support SPF, but tries to promote its DKIM development, by the way, not too successfully. <br><br>  So, how does SPF work? <br><a name="habracut"></a><br><h4>  General principles of work </h4><br>  The basic idea is that the host of the address indicates from which addresses his mail should be expected, and how to interpret the error in case of non-compliance.  It is important to understand that this data is only the recommendation of the sender for verification.  Yes, yes, of course, the standard describes how the receiving side should handle the result, but for all reasons the receiving side can actually do whatever it wants with them - fully comply, interpret it in its own way, or ignore the recommendations altogether. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Technical details </h4><br>  The TXT field in DNS is used for data placement.  So IANA has assigned a DNS field code 99 for SPF.  The format of the SPF field is identical to TXT.  In general, using the TXT field is not optimal, but the problem is that not every DNS server and client understands the new SPF record type.  Therefore, sharing TXT and SPF is considered a good approach for compatibility and future development. <br>  The standard recommends that domains that meet SPF requirements have both types of records.  However, at least one entry must be present necessarily.  If there are two entries, they must be identical.  For example: <br><blockquote>  example.com.  IN TXT "v = spf1 + mx a: colo.example.com/28 -all" <br>  example.com.  IN SPF "v = spf1 + mx a: colo.example.com/28 -all" </blockquote>  If the SPF record is set, then TXT records should be ignored. <br><br><h4>  Interaction mechanism </h4><br>  Mail exchange using SPF occurs according to the following algorithm. <br>  The mx.example.com mail server sends an email to user@example.net.  The example.com DNS records contain the following strings: <br><blockquote>  mx.example.com  IN A 208.77.188.166 <br>  example.com.  IN MX 10 mx.example.com. <br>  example.com.  IN TXT "v = spf1 + mx-all" </blockquote><br>  So, mx.example.com connects to SMTP example.net and gets from it, something like <br><blockquote>  &gt;&gt; 220 example.net ESMTP Service (Mailer v1.0) ready at 07/30/2009 12:28:21 UTC </blockquote>  then mx.example.com is submitted via HELO / EHLO. <br><blockquote>  &lt;&lt; HELO mx.example.com </blockquote>  Depending on the settings of the receiving party, after this submission there may already be a check for compliance of the submitted name with the SPF rules, but in this place it is not necessary <br><blockquote>  &gt;&gt; 250 example.net Hello mx.example.com., Pleased to meet you <br>  &lt;&lt; MAIL From: &lt;user@example.com&gt; </blockquote>  And here in this place, after the sender issued the MAIL FROM, a mandatory check, interpretation of the result and reaction to it should follow. <br>  The SPF checking module currently does the following things.  A query is made to the DNS.  SPF and TXT fields are requested.  If there is an SPF rule in the received response, then it is parsed and analysis for compliance occurs.  In our example, this rule is ‚Äúv = spf1 + mx -all‚Äù.  According to the rule, MX records are checked, and the IP addresses specified in the records obtained from the DNS name and IP address of the connected sender are checked.  In this case, everything is the same, control is returned to the mailer, and he starts receiving the message. <br><br>  If, suddenly, the actual IP of the connecting sender was different, the analyzer would tell the mailer that the incoming message is not valid, and it would be better not to receive it at all, well, or in extreme cases, mark it separately. <br><br><h4>  Recording format </h4><br>  An SPF record looks like this: <br><blockquote>  example.com.  IN SPF "v = spf1 + mx a: colo.example.com/28 -all" </blockquote><br>  This entry contains the following information: <br>  SPF version - 1 (by the way, while the only one used) <br>  the letter can have a sender with an IP address, the corresponding MX records for the example.com domain <br>  the letter may have a sender with an IP address corresponding to one of the addresses on the subnet colo.example.com/28 <br>  In all other cases, when the address does not meet the listed conditions, consider the sender unreliable. <br>  In general, the condition has 2 parts - the determinant and the mechanism. <br>  Identifiers can be: "+" Pass, "-" Fail, "~" SoftFail, "?"  Neutral <br>  Mechanisms: all, include, A, MX, PTR, IP4, IP6, exists <br>  The results of a condition check can be the following specific results: <br><blockquote>  * None - means that either there are no records in the domain, or the domain cannot be checked at all.  In general, no intelligible answer was received. <br>  * Neutral - arises in a situation where the domain owner does not want or can not tell whether IP is allowed.  This result should be processed in the same way as None. <br>  * Pass - means that everything is OK and the recipient can accept the letter. <br>  * Fail - clearly indicates that the letter should not be accepted.  The relying party can mark the letter or reject. <br>  * SoftFail - located somewhere between Fail and Neutral.  The receiving party should not discard the letter on the basis of only this result. <br>  * TempError - the result that occurs if the client at the time of verification receives a temporary error.  The message can be accepted or temporarily rejected. <br>  * PermError - an error that occurs when it is impossible to correctly interpret the DNS records of the sender. </blockquote><br>  Take, for example, some real domain.  Let's say google.com.  TXT request returns <br><blockquote>  "V = spf1 include: _netblocks.google.com ~ all" </blockquote><br>  it says that you need to include rules from the _netblocks.google.com entry.  Interestingly, _netblocks.google.com does not have an A-record, but only a TXT-record.  Here she is: <br><blockquote>  "V = spf1 ip4: 216.239.32.0/19 ip4: 64.233.160.0/19 ip4: 66.249.80.0/20 ip4: 72.14.192.0/18 ip4: 209.85.128.0/17 ip4: 66.102.0.0/20 ip4: 74.125. 0.0 / 16 ip4: 64.18.0.0/20 ip4: 207.126.144.0/20? All ¬ª </blockquote><br>  Here are the subnets that Google's mail servers can be located on.  The last all-in mechanism with the Neutral determinant informs the analyzer that the sender's address may be out of the allowed range.  Letters from foreign address spaces are recommended to be checked additionally, and not rejected unconditionally.  For such a large-scale structure, like Google, this is the right decision, because in the process of work the addresses may change, for example, in case of temporary failure and switching to the reserve.  And besides, the address may vary shipments. <br>  More tricky SPF entry from Rambler: <br><blockquote>  "V = spf1 ip4: 81.19.66.0/23 ip4: 81.19.88.0/24 -exists:% {ir} .spf.rambler.ru -exists:% {l} .u.spf.rambler.ru ~ all" </blockquote><br>  there are 2 subnets from which mail is allowed to be received, and 2 sets of sources, mail from which will have the result of the Fail check. <br><br><h4>  Shipping Problem </h4><br>  Imagine the following scheme - the user sends an email from vasily@xyz.com to pupkin@mylo.ru, and there is an automatic forwarding to pupkin@gmail.com.  And the xyz.com domain is spelled SPF "v = spf1 + mx-all".  As a result, the final recipient of gmail.com will make a check, and will receive a mismatch between the address of the actual sender and the specified one, and according to the rules SPF will not accept the letter.  To solve this problem, there is the SRS: Sender Rewriting Scheme.  In a nutshell, the forwarder rewrites the return-path header. <br>  In general, I believe that this moment is very controversial.  Using an intermediate mailbox to redirect traffic to another mailbox is very similar to a spam attack.  Here, for example, I register a box, put a candle on it wherever possible, subscribe to a million mailings, and put a redirect on a certain box that I want to fill up with spam.  If the senders have SPF and there is no SRS on the forwarding mailer, the target will reject these streams as spam, but when the SRS is running, it will receive completely ‚Äúlegitimate‚Äù mail flows. <br><br><h4>  Conclusion </h4><br>  SPF is a simple and fairly effective way to assess the legitimacy of the transmitted mail.  Mail server administrators are minimally required to add SPF records to the DNS.  Ease of implementation and support of the main popular MTAs make SPF spreading wider and wider, which benefits all email users, mail servers reduce traffic and generally makes the world a better place :) <br><br></div><p>Source: <a href="https://habr.com/ru/post/63768/">https://habr.com/ru/post/63768/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../63760/index.html">LED Kerosene</a></li>
<li><a href="../63761/index.html">Idea for a startup: Recruitment</a></li>
<li><a href="../63763/index.html">Vulnerability in Video ActiveX Control</a></li>
<li><a href="../63765/index.html">Aspire Timeline 1810T - Replacement Aspire One 751</a></li>
<li><a href="../63767/index.html">WPF - using page navigation, adding controls to NavigationWindow</a></li>
<li><a href="../63773/index.html">Which video codec is better for HTML 5</a></li>
<li><a href="../63774/index.html">Imagine Cup. Embedded Development</a></li>
<li><a href="../63775/index.html">Accounting Set 3 in 1</a></li>
<li><a href="../63776/index.html">Accident opens the way for innovation</a></li>
<li><a href="../63779/index.html">Introduced sms verification Google account during registration</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>