<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cost Optimization with Amazon S3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Amazon S3 is convenient to use to store files of any format. In addition to the convenient API, we get almost dimensionless storage. Excellent accessi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cost Optimization with Amazon S3</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://aws.amazon.com/ru/s3/">Amazon S3 is</a> convenient to use to store files of any format.  In addition to the convenient API, we get almost dimensionless storage.  Excellent accessibility and low cost make S3 mega-attractive for young and small projects. <br><br>  However, over time, files become more and more.  And you will have to pay not only for new data, but for all of history.  In addition, Amazon is charging money for GET and POST requests, as well as for traffic. <br><br>  Despite the low cost at the start, with the growth of this solution will be more and more expensive. <br><a name="habracut"></a><br><h4>  Should I use S3 at all? </h4><br>  Definitely worth it.  Especially for small projects.  Several tens of thousands of files and several thousand requests per day.  All this will cost a couple of bucks a month. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In return, you will not need to spend time and money on various issues: <br><ul><li>  Availability.  AWS will always work. </li><li>  Scaling.  No need to solve complex problems of file distribution between servers. </li><li>  Load.  Sudden spikes in popularity will not lead to iron failure. </li></ul><br><br>  S3 is perfect for storing user files of any format - <a href="http://habrahabr.ru/company/io/blog/257533/">photos</a> , documents and even video. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c38/4e8/180/c384e818046ae439a8c2211e24836269.jpg" alt="image"><br><br><h4>  When not to use? </h4><br>  Definitely not to use S3 as a CDN.  It is better to maintain all the statics (CSS, Javascript and icons) on your own or use the appropriate CDN provider for this. <br><br><h4>  How much will you have to pay? </h4><br>  For storing each terabyte of files you need to pay about 30 bucks a month.  In addition, $ 90 will cost every terabyte of traffic. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dea/325/e3b/dea325e3b82686d47a4e2014045262de.jpg" alt="image"><br><br>  Storage of 1 terabyte - about 5 million photos or 50 thousand short videos. <br>  A site with 100 thousand views per day, on each page of which there are 5 photos, will generate traffic of 1 terabyte per month. <br><br><h4>  Cost increase </h4><br>  However, with an increase in the number of views by 10 times, S3 traffic will cost almost 1,000 bucks a month. <br>  An alternative to this solution would be to rent several servers with a budget of $ 300. <br><br><h4>  Hybrid solution </h4><br>  A significant part of the cost when using S3 is just traffic. <br>  Storage and loading is relatively inexpensive. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/44c/ad1/02f/44cad102f9c570cf14301206abb0d823.jpg" alt="image"><br><br>  As a good solution, it makes sense to use S3 only as a reliable storage. <br>  In this case, a significant reduction in the cost of traffic can be obtained using a simple caching scheme. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/994/627/81f/99462781f210d0d1b1f4ff6e9270391c.jpg" alt="image"><br><br>  Then the files are downloaded directly to Amazon S3, and the return is configured through their own caching servers. <br><br><h4>  Varnish based solution </h4><br>  Varnish is a cool HTTP caching server.  With it, you can customize caching files from Amazon S3.  Configuration example: <br><br><pre><code class="lua hljs">backend s3 { .host = <span class="hljs-string"><span class="hljs-string">"s3.amazonaws.com"</span></span>; .port = <span class="hljs-string"><span class="hljs-string">"80"</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">sub</span></span> vcl_recv { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (req.url ~ <span class="hljs-string"><span class="hljs-string">"\.(gif|jpg|jpeg|png)$"</span></span>) { unset req.http.cookie; unset req.http.cache-control; unset req.http.pragma; unset req.http.expires; unset req.http.etag; set req.backend = s3; set req.http.host = <span class="hljs-string"><span class="hljs-string">"my_bucket.s3.amazonaws.com"</span></span>; lookup; } } <span class="hljs-built_in"><span class="hljs-built_in">sub</span></span> vcl_fetch { set obj.ttl = <span class="hljs-number"><span class="hljs-number">3</span></span>w; }</code> </pre> <br><br>  The example uses the bouquet my_bucket.  You should also monitor the hit rate.  Acceptable value - 99%.  This means that 99% of all requests will fall into the cash register and only 1% will go to S3. <br><br><h4>  Additional measures </h4><br>  To further optimize costs, you need to follow the rule - to minimize file sizes.  If the pictures are saved, you can convert them to <a href="https://onthe.io/learn%2B%25D0%25A7%25D1%2582%25D0%25BE%2B%25D1%2582%25D0%25B0%25D0%25BA%25D0%25BE%25D0%25B5%2BWebP">Webp format</a> before saving to S3.  They will occupy much less space than JPG.  Even without this, make sure that the <a href="https://onthe.io/learn%2B%25D0%259A%25D0%25B0%25D0%25BA%2B%25D0%25B2%25D1%258B%25D0%25B1%25D1%2580%25D0%25B0%25D1%2582%25D1%258C%2B%25D1%2584%25D0%25BE%25D1%2580%25D0%25BC%25D0%25B0%25D1%2582%2B%25D0%25B8%25D0%25B7%25D0%25BE%25D0%25B1%25D1%2580%25D0%25B0%25D0%25B6%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B9">correct image format is</a> selected before saving. <br><br>  Text files should be compressed with gzip. <br><br><h4>  Other cloud storage </h4><br>  There is an alternative.  At S3, the world has not gone away with the wedge, so it‚Äôs worth trying to work with other clouds, for example Azure or Google Cloud, especially considering that almost all services offer to <a href="https://onthe.io/learn%2B5%2B%25D1%2581%25D0%25B5%25D1%2580%25D0%25B2%25D0%25B8%25D1%2581%25D0%25BE%25D0%25B2%2B%25D0%25B4%25D0%25BB%25D1%258F%2B%25D1%2585%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F%2B%25D1%2584%25D0%25BE%25D1%2582%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D1%2584%25D0%25B8%25D0%25B9%2B%25D0%25B2%2B%25D0%25BE%25D0%25B1%25D0%25BB%25D0%25B0%25D0%25BA%25D0%25B5">test them for free.</a> <br><br><h4>  Abstract </h4><br><ul><li>  Amazon S3 is very convenient to use at start and for small projects. </li><li>  With the growing popularity of S3 becomes more expensive than its own iron. </li><li>  To reduce the cost of the solution it is necessary to reduce traffic.  To do this, you need to give files through the caching server. </li><li>  For caching it is convenient to use Varnish. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/258029/">https://habr.com/ru/post/258029/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../258015/index.html">Ensuring backward compatibility of .NET applications when using WinRT</a></li>
<li><a href="../258019/index.html">Asm.js came to Chakra and Microsoft Edge</a></li>
<li><a href="../258023/index.html">To the question of fitting resistors</a></li>
<li><a href="../258025/index.html">Part 2 - Synesis. Why is the demonstration of video analytics in offices so different from the real work in life?</a></li>
<li><a href="../258027/index.html">Interview with Eric Michaels-Auber, RubyHero-2014</a></li>
<li><a href="../258031/index.html">New features of the platform VoxImplant: Instant Messaging and Presence + demo on ReactJS / Flux</a></li>
<li><a href="../258035/index.html">Record of the webinar "Optimizing Internet traffic using Kerio Control"</a></li>
<li><a href="../258037/index.html">Problems installing CentOS 7 with flash USB</a></li>
<li><a href="../258039/index.html">Research: vulnerabilities in industrial control systems in 2014</a></li>
<li><a href="../258041/index.html">Question and answer sessions for viewers online at DevCon</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>