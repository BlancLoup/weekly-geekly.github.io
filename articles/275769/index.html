<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Work with geolocation in iOS 24/7</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I often see the question:  Is it possible to work with geolocation in iOS when the application is minimized and send data to the server? 
 I...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Work with geolocation in iOS 24/7</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/219/3fd/f73/2193fdf73cc945d99418a1ec0266010a.png"><br><br><br>  Recently, I often see the question: <blockquote>  Is it possible to work with geolocation in iOS when the application is minimized and send data to the server? </blockquote><br>  It really is possible and not at all difficult. <br>  <em>How to</em> fit into the preview of the article. <br><p>  However, the task is often more complex and since I have significant experience in this field, I decided to share this experience. </p><br><p>  In order to have some specifics, I assumed that the task before us was to write a cycle tracker.  From the user's side, it looks like this: </p><br><ol><li>  Download the application </li><li>  I'm running </li><li>  Register </li><li>  I click where they ask </li><li>  I close </li><li>  I ride </li><li>  I'm running </li><li>  I see the result </li></ol><br><p>  ps final code <a href="https://github.com/ajjnix/FunLocation">here</a> . </p><a name="habracut"></a><br><p>  For the development can be divided into 3 main areas of work. </p><br><ol><li>  Stability of work with geo-data. <br>  The user has started the application, turned it off or closed it altogether - the application must process the data. </li><li>  Saving battery. <br>  Perhaps, it does not need additional explanation. <br>  By the way, this is the hardest part of the job. </li><li>  Correct data handling. <br>  Work with data needs to be tested and debugged. </li></ol><br><h3 id="inicializaciya-menedzhera">  Manager initialization </h3><br><p>  To begin, consider the usual work with <a href="https://developer.apple.com/reference/corelocation/cllocationmanager">CLLocationManager</a> . </p><br><ol><li>  Create a manager. </li><li>  Subscribe to events. </li><li>  Run the manager to respond to changes in geolocation. </li></ol><br><div class="spoiler">  <b class="spoiler_title">Minimum code</b> <div class="spoiler_text"><pre><code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> CoreLocation <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LocationService</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NSObject</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CLLocationManagerDelegate { private let locationManager = CLLocationManager</span></span></span></span>() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>() locationManager.delegate = self locationManager.startUpdatingLocation() } func locationManager(_ manager: CLLocationManager, didUpdateLocations locations: [CLLocation]) { } }</code> </pre> </div></div><br><p>  But for this to work, you need to confirm the user that he allows the use of information about his location. </p><br><h3 id="-ili-pravo-imeyu">  ... or have the right? </h3><br><p>  iOS provides 2 rights to work with geolocation: </p><br><ol><li>  <strong>requestWhenInUseAuthorization</strong> - we can get information about the location update when the application is active. </li><li>  <strong>requestAlwaysAuthorization</strong> - in addition, we get the ability to receive <em>CLLocationManager API</em> events when the application is not active / closed. </li></ol><br><p>  From this you might think that working with geolocation in the background can only be done with <em>requestAlwaysAuthorization</em> rights - this is not so. </p><br><p>  And in the same way, <em>requestAlwaysAuthorization</em> does not allow to work quietly in the background out of the box.  It is about working with regions, popular places, significant movements and so on. </p><br><p>  If the code above is what is in the project, then calling the <em>requestWhenInUseAuthorization ()</em> method or <em>requestAlwaysAuthorization ()</em> will not show the user a request for rights. <br>  To do this, you also need to add explanatory text of the message to <em>info.plist</em> in the appropriate <em>NSLocationAlwaysUsageDescription</em> / <em>NSLocationWhenInUseUsageDescription key</em> </p><br><p>  Now, after confirming the user rights, we can work with geolocation. </p><br><h2 id="rabotaem-v-fone">  We work in the background </h2><br><p>  For an application to work with geolocation in the background, you need to do 2 things: </p><br><ol><li>  <em>Expose</em> at <em>CLLocationManager</em> <br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">allowsBackgroundLocationUpdates</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre> </li><li>  Add to the setting in Background Modes ("Background Modes -&gt; Location updates").  Otherwise, exception will be thrown. </li></ol><br><p>  Everything, the application can work in the background with geolocation, as well as send network requests and so on. </p><br><h3 id="chto-to-poshlo-ne-po-planu">  Something went wrong </h3><br><p>  As soon as the user, having minimized the application, will remain stationary for some time from the point of view of the system, geolocation will stop, and with it the application. <br>  The thing is that by default <em>CLLocationManager</em> uses a pause for geolocation <em><u>pausesLocationUpdatesAutomatically</u></em> .  And this option is not as simple as it seems. </p><br><ol><li>  I launched the application and started the movement.  The application is working. </li><li>  I turned off the app and keep moving.  The application is working. </li><li>  I met a friend and stopped to talk to him.  The application is still working. </li></ol><br><p>  And at some point it stops working. </p><br><p>  As you understand, a pause started, and after a while the work of the application itself, which is in the background, stopped.  Pretty logical, because it is a pause. </p><br><p>  I continued driving, but the LocationManager is still on pause.  And it will remain on a pause, as long as I do not deploy the application myself. </p><br><p>  Thus, the system tries to save battery power in cases when it is necessary to work before the ‚Äústop‚Äù. </p><br><div class="spoiler">  <b class="spoiler_title">ps if you need a pause</b> <div class="spoiler_text"><p>  If, nevertheless, the application needs to work <strong>before the</strong> end of the movement, then it is possible to help the system better determine this state by specifying a suitable goal in the "activityType", for which we work with geolocation. </p></div></div><br><p>  For us, this is a tangible problem, so we simply disable the pause for the LocationManager. </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">pausesLocationUpdatesAutomatically</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br><h2 id="ne-ubivay-menya-ivan-carevich-username">  Do not kill me, <del>  Ivan Tsarevich </del>  username! </h2><br><p>  Earlier, I mentioned the access rights to geolocation <em>requestAlwaysAuthorization</em> .  And that this makes it possible to receive events of the <em>CLLocationManager API</em> .  And to receive both being in the background, and in the unloaded state.  In the case of the latter, the system can restart our application to deliver a new event.  For example: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">locationManager</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.startMonitoringSignificantLocationChanges</span></span>() ‚Äî    <span class="hljs-selector-tag"><span class="hljs-selector-tag">locationManager</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.startMonitoringVisits</span></span>() ‚Äî    <span class="hljs-selector-tag"><span class="hljs-selector-tag">locationManager</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.startMonitoring</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">for</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">CLRegion</span></span>) ‚Äî        </code> </pre> <br><p>  This is what we will use.  If the user is killing the application, then we need to get back to work as quickly as possible.  In my case, the most suitable would be <em>startMonitoringSignificantLocationChanges</em> , since the regions have limitations in radius.  The main <em>thing is</em> not to forget to start again to configure and run <em>CLLocationManager</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Full code</b> <div class="spoiler_text"><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> CoreLocation <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LocationService</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NSObject</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CLLocationManagerDelegate { private let locationManager = CLLocationManager</span></span></span></span>() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>() locationManager.delegate = self locationManager.requestAlwaysAuthorization() locationManager.allowsBackgroundLocationUpdates = <span class="hljs-literal"><span class="hljs-literal">true</span></span> locationManager.pausesLocationUpdatesAutomatically = <span class="hljs-literal"><span class="hljs-literal">false</span></span> locationManager.startUpdatingLocation() locationManager.startMonitoringSignificantLocationChanges() } func locationManager(_ manager: CLLocationManager, didUpdateLocations locations: [CLLocation]) { } }</code> </pre> </div></div><br><p>  Fine!  The application works in the background, the application is restarted, works with geolocation, can work with the network, and so.  That's just to remove us with such activity from the device. </p><br><h2 id="ekonomiya-batarei">  Battery saving </h2><br><p>  If you open the statistics of energy consumption, then our application with a probability of 99.99% will be the leader and unfortunately not in terms of savings.  Therefore, we will now optimize. </p><br><h3 id="pogreshnost">  Error </h3><br><p>  The battery consumption is greatly affected by the required error from the <em>CLLocationManager</em> . <br>  We can demand the most accurate data, but we can, with an error of about 10 meters, 3 kilometers, and so on ( <u>kCLLocationAccuracy *</u> ). <br>  Appropriately, the higher the required data quality, the greater the battery consumption. </p><br><p>  Therefore, when the error of 100m is enough for you, you do not need to take the maximum quality. <br>  More interestingly, if you demand poor quality, then most likely the system will produce more than you expect.  Therefore, it is imperative not to require an error better than you really need. <br>  ps required does not mean valid. </p><br><h3 id="konfiguraciya">  Configuration </h3><br><p>  Additionally, you can win in the fight for the battery, if you remember about <u><em>distanceFilter</em></u> and <u><em>allowDeferredLocationUpdates</em></u> . </p><br><ul><li>  distanceFilter allows you to set the distance in meters, during which we are not interested in changing geolocation from point to point.  Savings do not say that a huge, but savings. </li><li>  Deferred notifications (allowDeferredLocationUpdates) allow the system to deliver information at its discretion, or according to specified criteria. <br>  The criteria can be distance and time. <br>  For example, after receiving the last point, the application logic will not break if within 5 minutes the points may not come, but then the system will deliver them <strong>all</strong> at once. <br>  The criterion is a time equal to 5 minutes.  If another application at this time requests geodata, the system can in passing and give us the accumulated points.  There are a number of related <a href="https://developer.apple.com/reference/corelocation/cllocationmanager/1620547-allowdeferredlocationupdates">restrictions</a> on setting up <em>CLLocationManager</em> that you need not forget. </li></ul><br><h3 id="rabotaem-s-dannymi-togda-kogda-eto-deystvitelno-nuzhno">  We work with data when you really need it. </h3><br><p>  We have indicated that our goal is a bicycle tracker.  At the moment we are processing data always, regardless of whether we need it or not.  Because of the pause, we can not stop geolocation. </p><br><p>  One of the solutions will change the required data quality during the trip and at other times.  The difference between the best and worst data is almost 4 times. </p><br><div class="spoiler">  <b class="spoiler_title">Changes to CLLocationManager settings depending on the state</b> <div class="spoiler_text"><pre> <code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setActiveMode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value: Bool)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> value { locationManager.desiredAccuracy = kCLLocationAccuracyNearestTenMeters locationManager.distanceFilter = <span class="hljs-number"><span class="hljs-number">10</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { locationManager.desiredAccuracy = kCLLocationAccuracyThreeKilometers locationManager.distanceFilter = <span class="hljs-type"><span class="hljs-type">CLLocationDistanceMax</span></span> } }</code> </pre> </div></div><br><p>  Now it remains only to track when the user rides a bicycle.  For this we can use <em>CMMotionActivityManager</em> from <em>CoreMotion</em> . </p><br><div class="spoiler">  <b class="spoiler_title">We track the type of activity</b> <div class="spoiler_text"><pre> <code class="hljs objectivec">motionManager.startActivityUpdates(to: .main, withHandler: { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] activity <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>?.setActiveMode(activity?.cycling ?? <span class="hljs-literal"><span class="hljs-literal">false</span></span>) })</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Full LocationService Code</b> <div class="spoiler_text"><pre> <code class="hljs objectivec">import CoreLocation import CoreMotion final <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> LocationService: <span class="hljs-built_in"><span class="hljs-built_in">NSObject</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">CLLocationManagerDelegate</span></span> { private let locationManager = <span class="hljs-built_in"><span class="hljs-built_in">CLLocationManager</span></span>() private let motionManager = <span class="hljs-built_in"><span class="hljs-built_in">CMMotionActivityManager</span></span>() override init() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.init() locationManager.delegate = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> locationManager.requestAlwaysAuthorization() locationManager.allowsBackgroundLocationUpdates = <span class="hljs-literal"><span class="hljs-literal">true</span></span> locationManager.pausesLocationUpdatesAutomatically = <span class="hljs-literal"><span class="hljs-literal">false</span></span> setActiveMode(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) locationManager.startUpdatingLocation() locationManager.startMonitoringSignificantLocationChanges() motionManager.startActivityUpdates(to: .main, withHandler: { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] activity <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>?.setActiveMode(activity?.cycling ?? <span class="hljs-literal"><span class="hljs-literal">false</span></span>) }) } func setActiveMode(_ value: Bool) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> value { locationManager.desiredAccuracy = kCLLocationAccuracyNearestTenMeters locationManager.distanceFilter = <span class="hljs-number"><span class="hljs-number">10</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { locationManager.desiredAccuracy = kCLLocationAccuracyThreeKilometers locationManager.distanceFilter = <span class="hljs-built_in"><span class="hljs-built_in">CLLocationDistanceMax</span></span> } } func locationManager(_ manager: <span class="hljs-built_in"><span class="hljs-built_in">CLLocationManager</span></span>, didUpdateLocations locations: [<span class="hljs-built_in"><span class="hljs-built_in">CLLocation</span></span>]) { } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Energy schedule vs hours of operation.</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/484/bac/d3f/484bacd3f7374fc683823cc06ee4fdce.png"><br><p>  Type A: Maximum Quality <br>  Type B: Maximum Quality + Filtration <br>  Type C: Poor quality + filtering <br>  Type D: Without Application </p></div></div><br><p>  Is it possible to further improve?  Of course.  This approach is necessary if it is critical to process all geolocation in the background.  Further depends on your imagination. </p><br><div class="spoiler">  <b class="spoiler_title">For iOS 10+, you need to register NSMotionUsageDescription in Info.plist</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>NSMotionUsageDescription<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>$(PRODUCT_NAME) motion use.<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </div></div><br><h2 id="proveryaem-obrabotku-geodannyh">  Checking geodata handling </h2><br><p>  The application must be checked.  Getting off the writing process for a ‚Äútrip‚Äù is not a good idea.  Yes, and about debugging in this approach, you can forget. </p><br><p>  Fortunately, Apple allows us to use <a href="https://en.wikipedia.org/wiki/GPS_Exchange_Format">GPX</a> files (and we don‚Äôt even need a real device to work in this case). </p><br><p>  We select the service that generates the route of the movement, and save the following file in gpx: </p><br><div class="spoiler">  <b class="spoiler_title">Sample file</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gpx</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">creator</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Xcode"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wpt</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lat</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"54.91148"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"83.07381"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wpt</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lat</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"54.90792"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"83.07243"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">gpx</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">We allow geolocation simulation in the scheme settings and load our GPX file.</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/ed8/0ab/40d/ed80ab40d6814a5092bd33c5c7823434.png"></div></div><br><div class="spoiler">  <b class="spoiler_title">Select the desired simulation and use debugging.</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/32c/29e/532/32c29e5325764f45b94cbfdf62ea5df1.png"></div></div><br><h2 id="vmesto-zaklyucheniya">  Instead of conclusion </h2><br><p>  Unfortunately, it is difficult to write what is interesting, what is obvious, so there are not many things to do: </p><br><ul><li>  If the application is "restarted" in the background, the user will not be able to "kill" him. </li><li>  If geolocation is paused when the application is in the background, then it will not be possible to remove from the pause using push notifications, regions, and so on.  The same applies to restarting the manager.  Will apply only after the "reversal" of the application. </li><li>  Geolocation works with accuracy.  If you do not use a filter, then you can get a lot of changes in geolocation by standing in one place. </li><li>  You can turn on geolocation simulation on a real device, and other applications will also work with "new" geolocation.  For example, cards. </li><li>  With a long geolocation simulation, the real device may stick and stop turning off the simulation.  Only restart helps. </li><li>  When you start the application, it is possible that you will get the "old point".  Do not forget to watch <em>ts</em> . </li><li>  You can make a wrapper over <em>CLLocationManager</em> and <em>parse</em> <em>GPX</em> for testing. </li><li>  GPX file allows you to set the speed in points. </li><li>  GPS near some objects may not work. </li><li>  You can use geolocation in airplane mode. </li><li>  You can use geolocation without a sim card. </li></ul><br><p>  ps final code <a href="https://github.com/ajjnix/FunLocation">here</a> . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/275769/">https://habr.com/ru/post/275769/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../275757/index.html">How to safely store and use secret data in R</a></li>
<li><a href="../275759/index.html">Highly accurate coordinates (+ -2cm) for virtual reality, kopter and robots</a></li>
<li><a href="../275761/index.html">Script automatic update DDNS for No-IP</a></li>
<li><a href="../275765/index.html">Considering difference schemes in Mathcad Express</a></li>
<li><a href="../275767/index.html">Own browser - the way the mouse: Theory</a></li>
<li><a href="../275771/index.html">Pets vs cattle</a></li>
<li><a href="../275779/index.html">Microsoft sent a request for appruv ChakraCore support implementation in Node.js along with the V8 engine</a></li>
<li><a href="../275781/index.html">The digest of interesting materials for the mobile developer # 137 (on January 18-24)</a></li>
<li><a href="../275783/index.html">Swift improve performSegueWithIdentifier or convenient router with storyboards</a></li>
<li><a href="../275785/index.html">How to use SQL DB in student Microsoft AZURE from Dreamspark</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>