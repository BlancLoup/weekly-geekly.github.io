<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cast</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Being at the Qt Developer Days 2010 conference, I learned that one of the most popular questions at the interview with different foreign companies wor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cast</h1><div class="post__text post__text-html js-mediator-article">  Being at the Qt Developer Days 2010 conference, I learned that one of the most popular questions at the interview with different foreign companies working with the Qt library is the issue of differences in the methods of type casting in C ++.  So here I will review the main differences between <b>static_cast</b> , <b>dynamic_cast</b> , <b>const_cast</b> , <b>reinterpret_cast</b> , <b>C-style cast</b> , <b>qobject_cast</b> and <b>qvariant_cast</b> <br><br><a name="habracut"></a><br><br>  1. <b>static_cast</b> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Syntax: <br><pre>  TYPE static_cast &lt;TYPE&gt; (object); </pre><br><br>  static_cast converts expressions of one static type into objects and values ‚Äã‚Äãof another static type.  It supports the conversion of numerical types, pointers and references according to the inheritance hierarchy both up and down.  The check is performed at the compilation level, so in case of an error, the message will be received at the time of building the application or library. <br><br>  2. <b>dynamic_cast</b> <br><br>  Syntax: <br><pre>  TYPE &amp; dynamic_cast &lt;TYPE &amp;&gt; (object);
 TYPE * dynamic_cast &lt;TYPE *&gt; (object); </pre><br><br>  Used for dynamic type casting at run time.  If the types are incorrectly cast, an exception std :: bad_cast is raised for references, and 0 is returned for pointers. It uses the RTTI (Runtime Type Information) system.  Safe coercion of types across the inheritance hierarchy, including for virtual inheritance. <br><br>  3. <b>const_cast</b> . <br><br>  Syntax: <br><pre>  TYPE const_cast &lt;TYPE&gt; (object); </pre><br><br>  Perhaps the simplest type conversion.  Removes cv qualifiers - const and volatile, that is, constancy and refusal to optimize the variable compiler.  This conversion is checked at the compilation level and a message will be displayed in case of a typecast error. <br><br>  4. <b>reinterpret_cast</b> <br><br>  Syntax: <br><pre>  TYPE reinterpret_cast &lt;TYPE&gt; (object); </pre><br><br>  Type casting without checking.  reinterpret_cast - direct indication to the compiler.  It is applied only in case of full confidence of the programmer in his own actions.  Does not remove constancy and volatile.  used to bring a pointer to a pointer, a pointer to a whole and vice versa. <br><br>  5. <b>C-style cast</b> <br><br>  Syntax: <br><pre>  TYPE (TYPE *) object; </pre><br><br>  Si-shny method of coercion of types.  Perhaps the most undesirable method of casting.  Stroustrup writes: <br>  ‚ÄúFor example, what does the expression mean - <i>x = (T) y;</i>  .  We do not know.  It depends on type T, types x and y.  T may be a type name, a typedef, or it may be a template parameter.  Maybe x and y are scalar variables and T is the value of the transform.  Maybe x object of a class derived from class Y and T is a downward transform.  For this reason, the programmer may not know what he is actually doing. ‚Äù <br>  The second reason for the undesirable use of type casting in C-style is the complexity of the process of searching for type-casting places. <br><br>  6. <b>qobject_cast</b> <br><br>  Syntax: <br><pre>  TYPE qobject_cast &lt;TYPE&gt; (QObject * object) </pre><br><br>  Converts a QObject * object to a TYPE type if the object type of the TYPE object or type inherits from TYPE otherwise returns 0. qobject_cast from 0 also gives 0. Required condition.  The class must inherit from QObject and contain the Q_OBJECT macro.  The function behaves similarly to the standard dynamic_cast, but does not use RTTI.  Here is how this function is described in Qt 4.7.0: <br><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">template &lt; <font color="#0000ff">class</font> T&gt; inline T qobject_cast(QObject * <font color="#0000ff">object</font> ) { <font color="#0000ff">#if</font> !defined(QT_NO_MEMBER_TEMPLATES) &amp;&amp; !defined(QT_NO_QOBJECT_CHECK) reinterpret_cast&lt;T&gt;(0)-&gt;qt_check_for_QOBJECT_macro(*reinterpret_cast&lt;T&gt;( <font color="#0000ff">object</font> )); <font color="#0000ff">#endif</font> <font color="#0000ff">return</font> static_cast&lt;T&gt;(reinterpret_cast&lt;T&gt;(0)-&gt;staticMetaObject.cast( <font color="#0000ff">object</font> )); }</font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <ol><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> template &lt; <font color="#0000ff">class</font> T&gt; inline T qobject_cast(QObject * <font color="#0000ff">object</font> ) { <font color="#0000ff">#if</font> !defined(QT_NO_MEMBER_TEMPLATES) &amp;&amp; !defined(QT_NO_QOBJECT_CHECK) reinterpret_cast&lt;T&gt;(0)-&gt;qt_check_for_QOBJECT_macro(*reinterpret_cast&lt;T&gt;( <font color="#0000ff">object</font> )); <font color="#0000ff">#endif</font> <font color="#0000ff">return</font> static_cast&lt;T&gt;(reinterpret_cast&lt;T&gt;(0)-&gt;staticMetaObject.cast( <font color="#0000ff">object</font> )); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> template &lt; <font color="#0000ff">class</font> T&gt; inline T qobject_cast(QObject * <font color="#0000ff">object</font> ) { <font color="#0000ff">#if</font> !defined(QT_NO_MEMBER_TEMPLATES) &amp;&amp; !defined(QT_NO_QOBJECT_CHECK) reinterpret_cast&lt;T&gt;(0)-&gt;qt_check_for_QOBJECT_macro(*reinterpret_cast&lt;T&gt;( <font color="#0000ff">object</font> )); <font color="#0000ff">#endif</font> <font color="#0000ff">return</font> static_cast&lt;T&gt;(reinterpret_cast&lt;T&gt;(0)-&gt;staticMetaObject.cast( <font color="#0000ff">object</font> )); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> template &lt; <font color="#0000ff">class</font> T&gt; inline T qobject_cast(QObject * <font color="#0000ff">object</font> ) { <font color="#0000ff">#if</font> !defined(QT_NO_MEMBER_TEMPLATES) &amp;&amp; !defined(QT_NO_QOBJECT_CHECK) reinterpret_cast&lt;T&gt;(0)-&gt;qt_check_for_QOBJECT_macro(*reinterpret_cast&lt;T&gt;( <font color="#0000ff">object</font> )); <font color="#0000ff">#endif</font> <font color="#0000ff">return</font> static_cast&lt;T&gt;(reinterpret_cast&lt;T&gt;(0)-&gt;staticMetaObject.cast( <font color="#0000ff">object</font> )); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> template &lt; <font color="#0000ff">class</font> T&gt; inline T qobject_cast(QObject * <font color="#0000ff">object</font> ) { <font color="#0000ff">#if</font> !defined(QT_NO_MEMBER_TEMPLATES) &amp;&amp; !defined(QT_NO_QOBJECT_CHECK) reinterpret_cast&lt;T&gt;(0)-&gt;qt_check_for_QOBJECT_macro(*reinterpret_cast&lt;T&gt;( <font color="#0000ff">object</font> )); <font color="#0000ff">#endif</font> <font color="#0000ff">return</font> static_cast&lt;T&gt;(reinterpret_cast&lt;T&gt;(0)-&gt;staticMetaObject.cast( <font color="#0000ff">object</font> )); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> template &lt; <font color="#0000ff">class</font> T&gt; inline T qobject_cast(QObject * <font color="#0000ff">object</font> ) { <font color="#0000ff">#if</font> !defined(QT_NO_MEMBER_TEMPLATES) &amp;&amp; !defined(QT_NO_QOBJECT_CHECK) reinterpret_cast&lt;T&gt;(0)-&gt;qt_check_for_QOBJECT_macro(*reinterpret_cast&lt;T&gt;( <font color="#0000ff">object</font> )); <font color="#0000ff">#endif</font> <font color="#0000ff">return</font> static_cast&lt;T&gt;(reinterpret_cast&lt;T&gt;(0)-&gt;staticMetaObject.cast( <font color="#0000ff">object</font> )); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> template &lt; <font color="#0000ff">class</font> T&gt; inline T qobject_cast(QObject * <font color="#0000ff">object</font> ) { <font color="#0000ff">#if</font> !defined(QT_NO_MEMBER_TEMPLATES) &amp;&amp; !defined(QT_NO_QOBJECT_CHECK) reinterpret_cast&lt;T&gt;(0)-&gt;qt_check_for_QOBJECT_macro(*reinterpret_cast&lt;T&gt;( <font color="#0000ff">object</font> )); #endif <font color="#0000ff">return</font> static_cast&lt;T&gt;(reinterpret_cast&lt;T&gt;(0)-&gt;staticMetaObject.cast( <font color="#0000ff">object</font> )); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> template &lt; <font color="#0000ff">class</font> T&gt; inline T qobject_cast(QObject * <font color="#0000ff">object</font> ) { <font color="#0000ff">#if</font> !defined(QT_NO_MEMBER_TEMPLATES) &amp;&amp; !defined(QT_NO_QOBJECT_CHECK) reinterpret_cast&lt;T&gt;(0)-&gt;qt_check_for_QOBJECT_macro(*reinterpret_cast&lt;T&gt;( <font color="#0000ff">object</font> )); <font color="#0000ff">#endif</font> <font color="#0000ff">return</font> static_cast&lt;T&gt;(reinterpret_cast&lt;T&gt;(0)-&gt;staticMetaObject.cast( <font color="#0000ff">object</font> )); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> template &lt; <font color="#0000ff">class</font> T&gt; inline T qobject_cast(QObject * <font color="#0000ff">object</font> ) { <font color="#0000ff">#if</font> !defined(QT_NO_MEMBER_TEMPLATES) &amp;&amp; !defined(QT_NO_QOBJECT_CHECK) reinterpret_cast&lt;T&gt;(0)-&gt;qt_check_for_QOBJECT_macro(*reinterpret_cast&lt;T&gt;( <font color="#0000ff">object</font> )); <font color="#0000ff">#endif</font> <font color="#0000ff">return</font> static_cast&lt;T&gt;(reinterpret_cast&lt;T&gt;(0)-&gt;staticMetaObject.cast( <font color="#0000ff">object</font> )); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> </ol> <code><font color="gray"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">template &lt; <font color="#0000ff">class</font> T&gt; inline T qobject_cast(QObject * <font color="#0000ff">object</font> ) { <font color="#0000ff">#if</font> !defined(QT_NO_MEMBER_TEMPLATES) &amp;&amp; !defined(QT_NO_QOBJECT_CHECK) reinterpret_cast&lt;T&gt;(0)-&gt;qt_check_for_QOBJECT_macro(*reinterpret_cast&lt;T&gt;( <font color="#0000ff">object</font> )); <font color="#0000ff">#endif</font> <font color="#0000ff">return</font> static_cast&lt;T&gt;(reinterpret_cast&lt;T&gt;(0)-&gt;staticMetaObject.cast( <font color="#0000ff">object</font> )); }</font> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  So, what is happening here: <br><br>  First, if QT_NO_MEMBER_TEMPLATES is not defined (defined only if Microsoft Visual Studio is lower than 2002) and QT_NO_QOBJECT_CHECK (determined when Microsoft Visual Studio is lower than 2003), then the Q_OBJECT macro is present in the class declaration.  And then the conversion itself is performed directly - first we get a static object of the QMetaObject class, called staticMetaObject, which calls the cast method, which returns the object passed to it by const_cast, checking whether the given object inherits from QObject.  Next, the resulting object is static_cast and the result is returned. <br><br>  7. <b>qvariant_cast</b> <br><br>  Syntax: <br><pre>  TYPE qvariant_cast &lt;TYPE&gt; (const QVariant &amp; value) </pre><br><br>  Brings the QVariant class object to the desired class.  The function is similar to the qVariantValue function. <br><br>  Consider what happens inside: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  template &lt;typename T&gt; inline T qvariant_cast ( <font color="#0000ff">const</font> QVariant &amp; v) </li><li>  { </li><li>  <font color="#0000ff">const</font> <font color="#0000ff">int</font> vid = qMetaTypeId &lt;T&gt; (static_cast &lt;T *&gt; (0)); </li><li>  <font color="#0000ff">if</font> (vid == v.userType ()) </li><li>  <font color="#0000ff">return</font> * reinterpret_cast &lt; <font color="#0000ff">const</font> T *&gt; (v.constData ()); </li><li>  <font color="#0000ff">if</font> (vid &lt; <font color="#0000ff">int</font> (QMetaType :: User)) { </li><li>  T t; </li><li>  <font color="#0000ff">if</font> (qvariant_cast_helper (v, QVariant :: Type (vid), &amp; t)) </li><li>  <font color="#0000ff">return</font> t; </li><li>  } </li><li>  <font color="#0000ff">return</font> T (); </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  In the first section of the code, the class identifier is obtained via the Qt metasystem.  In the event that the class is not registered through Q_DECLARE_METATYPE, compiling the code with a cast to this type will generate an error.  Further, if the object type received from the metasystem coincides with the type in the QVariant value, the object content is reinterpret_cast, if the class identifier is not a built-in type and its id does not match the value embedded in the QVariant value, then TYPE () is returned.  For cases when we cast to the built-in type, the qvariant_cast_helper function is called, which in turn calls the convert function, whose address is stored in the Handler structure.  It is already being cast in a way suitable for the TYPE type.  If the conversion fails, the TYPE () object is returned. <br><br>  <b>UPD:</b> C-style cast is essentially the slowest conversion, since in this case the following calls are sequentially sorted: <br><ul><li>  const_cast </li><li>  static_cast </li><li>  static_cast + const_cast </li><li>  reinterpret_cast </li><li>  reinterpret_cast + const_cast </li></ul><br><br>  <b>UPD:</b> Thank you <a href="https://habrahabr.ru/users/bajlepa/" class="user_link">BaJlepa</a> : <br>  1. const_cast can also add cv qualifiers <br>  2. for the conversion of pointers, it is better to use double static_cast via void * instead of reinterpret_cast, because such a conversion allows you to be sure that only pointeres are involved in casting <br><br>  Sources: <br>  a) <a href="http://alenacpp.blogspot.com/2005/08/c.html">http://alenacpp.blogspot.com/2005/08/c.html</a> <br>  b) <a href="http://www.cppreference.com/">http://www.cppreference.com</a> <br>  c) <a href="http://www.cplusplus.com/doc/tutorial/typecasting/">http://www.cplusplus.com/doc/tutorial/typecasting/</a> <br>  d) <a href="http://doc.qt.nokia.com/4.7/qobject.html">http://doc.qt.nokia.com/4.7/qobject.html#qobject_cast</a> <br>  e) <a href="http://www2.research.att.com/~bs/bs_faq2.html">http://www2.research.att.com/~bs/bs_faq2.html</a> <br>  e) <a href="http://doc.qt.nokia.com/4.7/qvariant.html">http://doc.qt.nokia.com/4.7/qvariant.html#qvariant_cast</a> <br>  <b>UPD:</b> g) <a href="http://www.rsdn.ru/Forum/Info/FAQ.cpp.c-stylecast.aspx">http://www.rsdn.ru/Forum/Info/FAQ.cpp.c-stylecast.aspx</a> </div><p>Source: <a href="https://habr.com/ru/post/106294/">https://habr.com/ru/post/106294/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../106275/index.html">Cut the Rope (IOs) over 1 million copies in 10 days</a></li>
<li><a href="../106276/index.html">Google has introduced a new feature to combat Internet fraudsters</a></li>
<li><a href="../106277/index.html">The largest Internet companies of Runet do not consider themselves responsible for the content posted by users.</a></li>
<li><a href="../106282/index.html">New series of memory modules</a></li>
<li><a href="../106293/index.html">The gel will be able to replace the dentist.</a></li>
<li><a href="../106296/index.html">Homemade Remote Control for Canon 50d</a></li>
<li><a href="../106298/index.html">Hosting Reality Check Network hacked</a></li>
<li><a href="../106300/index.html">Adobe Flash CS5 + Adobe Flash Builder - Common Projects</a></li>
<li><a href="../106302/index.html">Building SIFT descriptors and image matching task</a></li>
<li><a href="../106304/index.html">Ajenti 0.4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>