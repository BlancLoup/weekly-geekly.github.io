<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Zabbix 2.2 riding on nginx + php-fpm and mariadb</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to note that this instruction was born in the process of implementing Zabbix in the walls of Acronis . 
 In the process of examination and the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Zabbix 2.2 riding on nginx + php-fpm and mariadb</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/6ab/8bc/2be/6ab8bc2be9d3c4ff89a47783a9ac5626.png"><br><br>  <b>I want to note that this instruction was born in the process of implementing Zabbix in the walls of <a href="http://habrahabr.ru/company/acronis/">Acronis</a> .</b> <b><br></b>  <b>In the process of examination and the research I conducted, she proved her right to life and safely serves us faithfully and day by day.</b> <br><br>  We face a nontrivial task, to achieve maximum performance of the well-known monitoring system zabbix. <br>  Among the many articles on the Internet, there are many descriptions of typical installations of this system.  I will describe in detail how to make zabbix work faster. <br>  As a base system, I will use CentOS 6.4.  As well as many I love Debian, Gentoo and all other distributions, but this article is for CentOS. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Everything I need to do, I will write in detail and step by step, and begin with the basic configuration of our CentOS</b> <br><a name="habracut"></a><br><br>  <b># Turn off SELINUX</b> <br> <code>sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config</code> <br> <br>  <b># Customize time zone</b> <br> <code>ln -sf /usr/share/zoneinfo/Europe/Moscow /etc/localtime</code> <br> <br>  <b># Run time synchronization</b> <br><blockquote>  yum install ntp -y <br>  chkconfig ntpd on <br>  /etc/init.d/ntpd stop <br>  ntpdate 0.ru.pool.ntp.org 1.ru.pool.ntp.org 2.ru.pool.ntp.org 3.ru.pool.ntp.org <br>  /etc/init.d/ntpd start </blockquote><br><br>  <b># Install auxiliary components</b> <br> <code>yum install wget nano wget ntpdate -y</code> <br> <br>  <b># These repositories should be, there are a lot of packages that are not in the basic repositories, we will find here</b> <br><blockquote>  wget <a href="">dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</a> <br>  wget <a href="">rpms.famillecollet.com/enterprise/remi-release-6.rpm</a> <br>  sudo rpm -Uvh remi-release-6 * .rpm epel-release-6 * .rpm <br>  rm * .rpm -f </blockquote><br><br>  <b># This repository is useful to us, but we will turn it off by default.</b> <br><blockquote>  rpm --import <a href="http://dag.wieers.com/rpm/packages/RPM-GPG-KEY.dag.txt">dag.wieers.com/rpm/packages/RPM-GPG-KEY.dag.txt</a> <br>  cd / tmp <br>  wget <a href="">dag.wieers.com/rpm/packages/rpmforge-release/rpmforge-release-0.3.6-1.el5.rf.x86_64.rpm</a> &amp;&amp; rpm -ivh rpmforge-release-0.3.6-1.el5.rf. x86_64.rpm <br></blockquote><br><br>  <b># Turn off, we will use through --enablerepo = rpmforge</b> <br> <code>sed -i 's/enabled = 1/enabled = 0/g' /etc/yum.repos.d/rpmforge.repo</code> <br> <br>  <b># And this is a gem for web systems and not only, there really is a lot of things that an administrator needs in his work.</b>  <b>Musthave</b> <br> <code><a href="http://www.atomicorp.com/installers/atomic"></a> wget -q -O - www.atomicorp.com/installers/atomic | sh</code> <br> <br>  <b># We put useful software</b> <br><blockquote>  yum install nano mc screen sudo nscd htop ntp zip unzip pigz iotop sysstat lsof strace atop multitail -y <br>  yum --enablerepo = rpmforge install htop -y <br></blockquote><br>  <b># Update the system</b> <br> <code>yum update -y</code> <br> <br>  <b>Now let's move on to installing the zabbix itself and the components it needs:</b> <br><br>  <b>SERVER</b> <br><br>  <b># Install the official zabbix repository for centos</b> <br> <code><a href=""></a> rpm -ivh repo.zabbix.com/zabbix/2.2/rhel/6/x86_64/zabbix-release-2.2-1.el6.noarch.rpm</code> <br> <br>  <b># Killing all old MySQL components, This will remove MySQL!</b> <br> <code>yum remove php-* mysql-* MariaDB-* -y</code> <br> <br>  <b># Install mariadb from the atomic repository</b> <br> <code>yum install mariadb-server mariadb-devel mariadb-client -y</code> <br> <br>  <b># Install many components and modules that are needed for zabbix operation</b> <br><blockquote>  yum install ntp php php-mysql php-mbstring php-mcrypt rpm-build gcc mariadb-devel openssl-devel cyrus-sasl-devel pkgconfig zlib-devel pggconfig zlib-devel pgg-devel openldap-devel libtool gdbm-devel pam-devel gamin-devel php-fpm php-cli php-gd php-imap php-ldap php-odbc php-pear php-xml php-xmlrpc php-pecl-apc hp-magpierss php-snmp php- tidy spawn-fcgi openssl perl-TimeDate webalizer perl-DateTime-Format-HTTP perl-DateTime-Format-Builder perl-TimeDate libevent-devel php-pecl-memcache nginx cronie cronie-anacron crontabs postfix sysstat -y </blockquote><br><br>  <b># Install zabbix yourself</b> <br><blockquote>  yum install zabbix-server-mysql zabbix-web-mysql zabbix-agent </blockquote><br><br>  <b># We configure MariaDB, you need to bring its config to this form (these config are designed for 16GB of RAM on the server)</b> <b><br></b>  <b>[root @ zabbix ~] nano /etc/my.cnf</b> <br><br><blockquote>  [mysqld] <br>  datadir = / var / lib / mysql <br>  socket = / var / lib / mysql / mysql.sock <br>  # Disabling symbolic-links <br>  symbolic-links = 0 <br>  <b>default_storage_engine = InnoDB</b> <b><br></b>  <b>innodb_file_per_table = 1</b> <br>  # <br>  # <br>  # network <br>  connect_timeout = 60 <br>  wait_timeout = 28800 <br>  max_connections = 200 <br>  max_allowed_packet = 512M <br>  max_connect_errors = 1000 <br><br>  # limits <br>  tmp_table_size = 512M <br>  max_heap_table_size = 256M <br>  table_cache = 1024 <br><br>  # logs <br>  log_error = /var/log/mysql/mysql-error.log <br>  #slow_query_log_file = /var/log/mysql/mysql-slow.log <br>  #slow_query_log = 1 <br>  #long_query_time = 20 <br><br>  # innodb <br>  default_storage_engine = InnoDB <br>  innodb_file_per_table = 1 <br>  innodb_status_file = 1 <br>  innodb_additional_mem_pool_size = 128M <br>  innodb_buffer_pool_size = 12G <b># The value of this parameter should be no more than 60% of the RAM on the server</b> <br>  innodb_flush_method = O_DIRECT <br>  innodb_io_capacity = 2000 <br>  innodb_flush_log_at_trx_commit = 2 <br>  innodb_support_xa = 0 <br>  innodb_log_buffer_size = 128M <br><br>  # experimental <br>  innodb_stats_update_need_lock = 0 <br><br>  # other stuff <br>  event_scheduler = 1 <br>  query_cache_type = 0 <br>  query_cache_size = 536870912 <br>  join_buffer_size = 1M <br>  query_cache_limit = 2M <br>  sort_buffer_size = 2M <br>  read_buffer_size = 2M <br>  read_rnd_buffer_size = 4M <br>  key_buffer = 256M <br>  key_buffer_size = 64M <br>  open_files_limit = 100000 <br>  thread_cache_size = 100 <br><br>  [mysqld_safe] <br>  log-error = / var / log / mysqld.log <br>  pid-file = / var / run / mysqld / mysqld.pid <br><br>  # <br>  # include all files from the config directory <br>  # <br>  ! includedir /etc/my.cnf.d </blockquote><br><br>  <b># Add mysql to autoload</b> <br> <code>chkconfig mysqld on &amp;&amp; /etc/init.d/mysqld restart</code> <br> <br>  <b># Add php-fpm to startup</b> <br><blockquote>  chkconfig --levels 235 php-fpm on <br>  /etc/init.d/php-fpm start </blockquote><br><br>  <b># Remove the default configs nginx</b> <br><blockquote>  rm /etc/nginx/conf.d/default.conf -f <br>  rm /etc/nginx/conf.d/virtual.conf -f <br></blockquote><br>  <b># Create zabbix database</b> <br><blockquote>  mysql -e 'CREATE DATABASE zabbix CHARACTER SET utf8 COLLATE utf8_bin;' <br>  mysql -e 'grant all privileges on zabbix. * to zabbix @ localhost identified by "9c9yUiUuros";' <br>  mysql -e 'flush privileges;' </blockquote><br><br>  <b># Fill in standard schemes for zabbix database</b> <br><blockquote>  mysql zabbix &lt;/usr/share/doc/zabbix-server-mysql-2.2.0/create/schema.sql <br>  mysql zabbix &lt;/usr/share/doc/zabbix-server-mysql-2.2.0/create/images.sql <br>  mysql zabbix &lt;/usr/share/doc/zabbix-server-mysql-2.2.0/create/data.sql </blockquote><br><br>  <b># Add iptables rules</b> <br><blockquote>  iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 10050 -j ACCEPT <br>  iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 10051 -j ACCEPT <br>  iptables -A INPUT -p udp -m state --state NEW -m udp --dport 10050 -j ACCEPT <br>  iptables -A INPUT -p udp -m state --state NEW -m udp --dport 10051 -j ACCEPT <br>  iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT <br>  service iptables save </blockquote><br><br>  <b># Make the necessary changes to the configuration of php</b> <b><br></b>  <b>[root @ zabbix ~] nano /etc/php.ini</b> <br><br><blockquote>  post_max_size = 16M <br>  max_execution_time = 300 <br>  max_input_time = 300 <br>  date.timezone = Europe / Moscow </blockquote><br><br>  <b># We give the configuration of zabbix to the following form:</b> <b><br></b>  <b>egrep -v '^ # | ^ $' /etc/zabbix/zabbix_server.conf</b> <b><br><br></b>  <b>[root @ zabbix ~] nano /etc/zabbix/zabbix_server.conf</b> <br><blockquote>  LogFile = / var / log / zabbix / zabbix_server.log <br>  LogFileSize = 0 <br>  PidFile = / var / run / zabbix / zabbix_server.pid <br>  DBName = zabbix <br>  DBUser = zabbix <br>  DBUser = zabbix <br>  DBPassword = 9c9yUiUuros <br>  DBSocket = / var / lib / mysql / mysql.sock <br>  SNMPTrapperFile = / var / log / snmptt / snmptt.log <br>  AlertScriptsPath = / usr / lib / zabbix / alertscripts <br>  ExternalScripts = / usr / lib / zabbix / externalscripts </blockquote><br><br>  <b># Add zabbix server to startup</b> <br> <code>chkconfig zabbix-server on</code> <br> <br>  <b># We will slightly change the standard configuration of nginx, we will give the config to this form:</b> <b><br></b>  <b>[root @ zabbix ~] nano /etc/nginx/nginx.conf</b> <br><blockquote>  user nginx; <br>  worker_processes 10; <br>  pid /var/run/nginx.pid; <br><br>  events { <br>  worker_connections 1024; <br>  use epoll; <br><br>  multi_accept on; <br><br>  } <br><br>  error_log /var/log/nginx/error.log warn; <br><br>  http { <br>  include /etc/nginx/mime.types; <br>  default_type application / octet-stream; <br><br>  log_format main '$ remote_addr - $ remote_user [$ time_local] "$ request"' <br>  '$ status $ body_bytes_sent "$ http_referer"' <br>  '"$ http_user_agent" "$ http_x_forwarded_for"'; <br><br>  access_log /var/log/nginx/access.log main; <br><br>  connection_pool_size 256; <br>  client_header_buffer_size 4k; <br>  client_max_body_size 100m; <br>  large_client_header_buffers 8 8k; <br>  request_pool_size 4k; <br>  output_buffers 1 32k; <br>  postpone_output 1460; <br>  proxy_max_temp_file_size 0; <br>  gzip on; <br>  gzip_min_length 1024; <br>  gzip_proxied any; <br>  gzip_proxied expired no-cache no-store private auth; <br>  gzip_types text / plain text / xml application / xml application / x-javascript text / javascript text / css text / json; <br>  gzip_comp_level 8; <br>  gzip_disable "MSIE [1-6] \. (?!. * SV1)"; <br><br>  sendfile on; <br>  tcp_nopush on; <br>  tcp_nodelay on; <br>  keepalive_timeout 75 20; <br>  server_names_hash_max_size 8192; <br>  ignore_invalid_headers on; <br>  server_name_in_redirect off; <br><br>  proxy_buffer_size 8k; <br>  proxy_buffers 32 4k; <br>  proxy_connect_timeout 1000; <br>  proxy_read_timeout 12000; <br>  proxy_send_timeout 12000; <br>  proxy_cache_path / var / cache / nginx levels = 2 keys_zone = pagecache: 5m inactive = 10m max_size = 50m; <br>  real_ip_header X-Real-IP; <br><br>  proxy_set_header Host $ host; <br>  proxy_set_header X-Real-IP $ remote_addr; <br>  proxy_set_header X-Forwarded-For $ proxy_add_x_forwarded_for; <br><br>  allow all; <br><br>  include /etc/nginx/conf.d/*.conf; <br>  } </blockquote><br><br>  <b># We configure nginx to work with zabbix and php-fpm</b> <b><br></b>  <b>[root @ zabbix ~] # nano /etc/nginx/conf.d/zabbix.conf</b> <br><blockquote>  server { <br>  listen 80; <br>  server_name <b>name</b> ; <br>  server_name is <b>another name</b> ; <br><br>  location / { <br>  root / usr / share / zabbix; <br>  index index.php index.html index.htm; <br>  } <br><br>  location ~ \ .php $ { <br>  root / usr / share / zabbix; <br>  try_files $ uri = 404; <br>  fastcgi_pass 127.0.0.1:9000; <br>  fastcgi_index index.php; <br>  fastcgi_buffers 4 256k; <br>  fastcgi_busy_buffers_size 256k; <br>  fastcgi_temp_file_write_size 256k; <br><br>  fastcgi_param SCRIPT_FILENAME $ document_root $ fastcgi_script_name; <br>  include fastcgi_params; <br>  } <br><br>  # deny access to .htaccess files, if Apache's document root <br>  # concurs with nginx's one <br>  # <br>  location ~ /\.ht { <br>  deny all; <br>  } <br>  } <br><br>  server { <br>  listen 80; <br>  server_name _; <br><br>  location / { <br>  root / usr / share / zabbix; <br>  index index.php index.html index.htm; <br>  } <br><br>  location ~ \ .php $ { <br>  root / usr / share / zabbix; <br>  try_files $ uri = 404; <br>  fastcgi_pass 127.0.0.1:9000; <br>  fastcgi_index index.php; <br>  fastcgi_param SCRIPT_FILENAME $ document_root $ fastcgi_script_name; <br>  include fastcgi_params; <br>  } <br><br>  # deny access to .htaccess files, if Apache's document root <br>  # concurs with nginx's one <br>  # <br>  location ~ /\.ht { <br>  deny all; <br>  } <br>  } </blockquote><br><br>  <b># Remove apache from autoload</b> <br><blockquote>  chkconfig --levels 235 httpd off <br>  /etc/init.d/httpd stop </blockquote><br><br>  <b># Add nginx to autoload</b> <br><blockquote>  chkconfig --levels 235 nginx on <br>  /etc/init.d/nginx start </blockquote><br><br>  <b>With this simple method, we get a high-performance installation of zabbix.</b> <b><br><br></b>  <b>The article would not be complete if I had not told about the installation of zabbix-proxy and zabbix-agent, it is assumed that the steps of the basic system setup (at the very beginning of the article) we have already passed</b> <br><br>  <b>PROXY</b> <br><br>  <b># Install the official zabbix repository for centos</b> <br> <code><a href=""></a> rpm -ivh repo.zabbix.com/zabbix/2.0/rhel/6/x86_64/zabbix-release-2.0-1.el6.noarch.rpm</code> <br> <br>  # Remove old software <br><blockquote>  yum remove zabbix-proxy- * -y <br>  yum remove mysql * mysql- * </blockquote><br><br>  <b># Install mariadb from the atomic repository</b> <br> <code>yum install mariadb-server mariadb-devel mariadb-client -y</code> <br> <br>  # After removing mysql components, important components could be removed <br> <code>yum install -y cronie cronie-anacron crontabs postfix sysstat</code> <br> <br>  <b># Actually zabbix itself from the official repository</b> <br> <code>yum install zabbix zabbix-agent zabbix-proxy-mysql zabbix-proxy -y</code> <br> <br>  <b>Consider the case that zabbix-proxy need to be put on something else, for example fedora 14</b> <br><br><blockquote>  mkdir / root / zabbix &amp;&amp; cd / root / zabbix <br>  wget <a href="">repo.zabbix.com/zabbix/2.0/rhel/6/x86_64/zabbix-2.0.9-1.el6.x86_64.rpm</a> <br>  wget <a href="">repo.zabbix.com/zabbix/2.0/rhel/6/x86_64/zabbix-agent-2.0.9-1.el6.x86_64.rpm</a> <br>  wget <a href="">repo.zabbix.com/zabbix/2.0/rhel/6/x86_64/zabbix-proxy-2.0.9-1.el6.x86_64.rpm</a> <br>  wget <a href="">repo.zabbix.com/zabbix/2.0/rhel/6/x86_64/zabbix-proxy-mysql-2.0.9-1.el6.x86_64.rpm</a> <br>  wget <a href="">repo.zabbix.com/zabbix/2.0/rhel/6/x86_64/zabbix-get-2.0.9-1.el6.x86_64.rpm</a> <br>  rpm -Uhv * .rpm </blockquote><br><br>  <b># Set up MariaDB, you need to add parameters</b> <b><br></b>  <b>[root @ zabbix ~] nano /etc/my.cnf</b> <br><br><blockquote>  default_storage_engine = InnoDB <br>  innodb_file_per_table = 1 </blockquote><br><br>  <b># Add zabbix to autoload</b> <br><blockquote>  chkconfig zabbix-proxy on <br>  chkconfig zabbix-agent on <br>  chkconfig mysqld on &amp;&amp; /etc/init.d/mysqld start </blockquote><br><br>  <i># Create a base</i> <br><blockquote>  mysql -e 'CREATE DATABASE zabbix CHARACTER SET utf8 COLLATE utf8_bin;' <br>  mysql -e 'grant all privileges on zabbix. * to zabbix @ localhost identified by "lNZrKeZASv0L";' <br>  mysql -e 'flush privileges;' <br></blockquote><br><br>  <b># Fill in standard schemes for zabbix database</b> <br><blockquote>  mysql zabbix &lt;/usr/share/doc/zabbix-server-mysql-2.0.9/create/schema.sql <br>  mysql zabbix &lt;/usr/share/doc/zabbix-server-mysql-2.0.9/create/images.sql </blockquote><br><br>  <b># Add iptables rules</b> <br><blockquote>  iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 10050 -j ACCEPT <br>  iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 10051 -j ACCEPT <br>  iptables -A INPUT -p udp -m state --state NEW -m udp --dport 10050 -j ACCEPT <br>  iptables -A INPUT -p udp -m state --state NEW -m udp --dport 10051 -j ACCEPT <br>  service iptables save </blockquote><br><br>  <b># We configure zabbix-proxy itself</b> <br><blockquote>  sed -i "s / ^ Server =. * / Server = server address-zabbix / g" /etc/zabbix/zabbix_proxy.conf <br>  sed -i "s / ^ Hostname =. * / Hostname = name-this-proxy-who-pointed-zabbix-server / g" /etc/zabbix/zabbix_proxy.conf <br>  sed -i "s / ^ DBName =. * / DBName = zabbix / g" /etc/zabbix/zabbix_proxy.conf <br>  echo ProxyMode = 0 &gt;&gt; /etc/zabbix/zabbix_proxy.conf <br>  echo ProxyLocalBuffer = 1 &gt;&gt; /etc/zabbix/zabbix_proxy.conf <br>  echo ProxyLocalBuffer = ProxyOfflineBuffer = 100 &gt;&gt; /etc/zabbix/zabbix_proxy.conf <br>  echo HousekeepingFrequency = 1r = 100 &gt;&gt; /etc/zabbix/zabbix_proxy.conf <br>  echo DataSenderFrequency = 300 &gt;&gt; /etc/zabbix/zabbix_proxy.conf <br>  echo StartPollers = 5 &gt;&gt; /etc/zabbix/zabbix_proxy.conf <br>  echo StartIPMIPollers = 1 &gt;&gt; /etc/zabbix/zabbix_proxy.conf <br>  echo StartPollersUnreachable = 1 &gt;&gt; /etc/zabbix/zabbix_proxy.conf <br>  echo StartTrappers = 5 &gt;&gt; /etc/zabbix/zabbix_proxy.conf <br>  echo StartHTTPPollers = 1 &gt;&gt; /etc/zabbix/zabbix_proxy.conf <br>  echo StartDBSyncers = 4 &gt;&gt; /etc/zabbix/zabbix_proxy.conf <br>  echo Timeout = 10 &gt;&gt; /etc/zabbix/zabbix_proxy.conf <br>  echo FpingLocation = / usr / sbin / fping &gt;&gt; /etc/zabbix/zabbix_proxy.conf <br>  echo Fping6Location = / usr / sbin / fping6 &gt;&gt; /etc/zabbix/zabbix_proxy.conf <br>  echo DebugLevel = 3 &gt;&gt; /etc/zabbix/zabbix_proxy.conf <br>  echo StartDiscoverers = 10 &gt;&gt; /etc/zabbix/zabbix_proxy.conf <br>  echo DBPassword = lNZrKeZASv0L &gt;&gt; /etc/zabbix/zabbix_proxy.conf </blockquote><br><br>  <b># Checking the zabbix-proxy configuration file</b> <br> <code>egrep -v '^#|^$' /etc/zabbix/zabbix_proxy.conf</code> <br> <br>  <b># Go</b> <br><blockquote>  /etc/init.d/zabbix-proxy start </blockquote><br><br>  <b>AGENT, obviously we will deploy it through chef or puppet but for the completeness of the material</b> <br><br>  <b># Install the official zabbix repository for centos</b> <br> <code><a href=""></a> rpm -ivh repo.zabbix.com/zabbix/2.0/rhel/6/x86_64/zabbix-release-2.0-1.el6.noarch.rpm</code> <br> <br>  <b># Install the agent from the official repository</b> <br> <code>yum install zabbix zabbix-agent -y</code> <br> <br>  <b>or if you are not very fresh fedora</b> <br> <code><a href=""></a> rpm -Uhv repo.zabbix.com/zabbix/2.0/rhel/6/x86_64/zabbix-2.0.9-1.el6.x86_64.rpm</code> <br> <br>  <b># Give zabbix user sudo rights and create folders for our future scripts</b> <br><blockquote>  usermod -s / bin / bash zabbix <br>  echo 'zabbix ALL = (ALL) NOPASSWD: ALL' &gt;&gt; / etc / sudoers <br>  sed -i 's / Defaults \ requireti / # Defaults \ requiretty / g' / etc / sudoers <br>  mkdir / etc / zabbix / scripts / <br>  chmod 750 / etc / zabbix / scripts / </blockquote><br><br>  <b># Add zabbix-agent to startup</b> <br> <code>chkconfig zabbix-agent on</code> <br> <br>  <b># Add iptables rules</b> <br><blockquote>  iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 10050 -j ACCEPT <br>  iptables -A INPUT -p tcp -m state --state NEW -m tcp --dport 10051 -j ACCEPT <br>  iptables -A INPUT -p udp -m state --state NEW -m udp --dport 10050 -j ACCEPT <br>  iptables -A INPUT -p udp -m state --state NEW -m udp --dport 10051 -j ACCEPT <br>  service iptables save </blockquote><br><br>  <b># Setting up our zabbix-agent</b> <br><blockquote>  sed -i "s / ^ Server =. * / Server = zabbix-sever-or-proxy / g address" /etc/zabbix/zabbix_agentd.conf <br>  sed -i "s / ^ ServerActive =. * / ServerActive = zabbix-sever-or-proxy / g address" /etc/zabbix/zabbix_agentd.conf <br>  sed -i "s / ^ Hostname =. * / Hostname =` hostname` / g "/etc/zabbix/zabbix_agentd.conf <br>  echo EnableRemoteCommands = 1 &gt;&gt; /etc/zabbix/zabbix_agentd.conf <br>  echo LogRemoteCommands = 1 &gt;&gt; /etc/zabbix/zabbix_agentd.conf <br>  echo Timeout = 30 &gt;&gt; /etc/zabbix/zabbix_agentd.conf <br></blockquote><br><br>  <b># Done, watch logs</b> <br> <code>/etc/init.d/zabbix-agent restart &amp;&amp; tail -f -n 100 /var/log/zabbix/zabbix_*.log</code> <br> <br>  <b>Thank you for your attention, if you find this material interesting, I will be glad to share many more and more!</b> <br><br>  <a href="http://habrahabr.ru/post/198448/">HAPRoxy for Percona or Galera on CentOS.</a>  <a href="http://habrahabr.ru/post/198448/">Its configuration and monitoring in Zabbix</a> </div><p>Source: <a href="https://habr.com/ru/post/198354/">https://habr.com/ru/post/198354/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../198336/index.html">Apogee: Man Orchestra and Online Game Publisher 1987 (continued)</a></li>
<li><a href="../198338/index.html">Using the Haar cascade to compare images</a></li>
<li><a href="../198340/index.html">Standard charge for laptops</a></li>
<li><a href="../198346/index.html">Twitter Bootstrap 3 Compilation</a></li>
<li><a href="../198350/index.html">Apple will replace 64 and 128GB SSD for MacBook Air mid 2012 for free</a></li>
<li><a href="../198356/index.html">AppsMafia: Hackathon in Moscow (November 9 - 10)</a></li>
<li><a href="../198360/index.html">Finally! Welcome Windows 8.1!</a></li>
<li><a href="../198362/index.html">Under the blow. RBS systems</a></li>
<li><a href="../198364/index.html">Gold foil</a></li>
<li><a href="../198366/index.html">Migrate from mysql to postgresql</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>