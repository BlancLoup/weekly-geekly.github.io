<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to embed static analysis in a project with more than 10 megabytes of source code?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="So, you are a developer in a project in which there is a lot of (or even very much) source code. For example, more than 10 megabytes. You have read ar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to embed static analysis in a project with more than 10 megabytes of source code?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/46b/b42/4bd/46bb424bd8834156aea8de0cf497d43b.png" align="left"><br>  So, you are a developer in a project in which there is a lot of (or even very much) source code.  For example, more than 10 megabytes.  You have read <a href="http://www.viva64.com/ru/a/0084/">articles</a> about checking open source projects and you wanted to check your own project with some code analyzer.  You checked the project and received over a thousand messages from the analyzer.  A thousand is an optimistic option.  Maybe more than ten thousand.  But you are not a lazy developer?  You started browsing them.  And, oh, horror, the fifth message of the analyzer turned out to be a real mistake!  As well as the seventh, ninth, twelfth and fifteenth.  You have written yourself a dozen more real errors pointed to by the analyzer and are going to the boss with the words: <br><br>  <i>‚ÄúChef, look.</i>  <i>I downloaded a cool analyzer.</i>  <i>He has already found ten real mistakes in only half an hour.</i>  <i>In total, he issued a thousand (two, three, four) messages.</i>  <i>Let's buy this analyzer, we will deal with the guys and fix all the messages in two or three weeks.</i>  <i>And then, when we fix everything, he will give us 0 messages.</i>  <i>So, we are cool programmers and make high-quality code! ‚Äù</i> <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And although you are already mentally putting up a chest for a new medal (after all, you are fighting for the quality of the project!), Your boss will very likely answer something like this: <br><br>  <i>‚ÄúYou have nothing to do?</i>  <i>You want to divert the whole team for three weeks to correct mistakes, and we have a release in a month!</i>  <i>So what if the mistakes are real?</i>  <i>Lived somehow with them and nothing.</i>  <i>Yes, I understand that it would be great not to make mistakes in the new code.</i>  <i>Well, you do not do it!</i>  <i>And I will not allow the old code to touch!</i>  <i>He has already been tested and customers paid for it.</i>  <i>And who for three weeks of work of the team will pay?</i>  <i>So we will not buy the analyzer, and we will not touch the old code.</i>  <i>And your current tasks are apparently over.</i>  <i>So we will throw you right now.</i>  <i>And so tomorrow was ready! "</i> <br><br>  Real scenario?  Real.  Worst of all, the good idea of ‚Äã‚Äãintroducing static analysis stalled by the need to work through all the messages that the code analyzer produces.  After all, if each analyzer run will produce a thousand messages, then it will be impossible to understand where the new messages are and where the old ones will be.  Or is there a way to solve this problem? <br><br><h2>  How does this issue solve in PVS-Studio? </h2><br>  A couple of releases back in PVS-Studio appeared a mechanism for suppressing old or "uninteresting" messages from the code analyzer.  By version 5.22, we finally debugged it, worked it out, and now it turned out to be so convenient that we recommend using it to anyone who is thinking about implementing static analysis in their project.  And I'll tell you how to use it. <br><br>  So, before you project for 5 million lines of code (just for example), in which 150 megabytes of source code.  You checked it with the analyzer and received several thousand general purpose messages (General Analysis).  You would be happy to fix them, but the project manager does not allocate time. <br><br>  OK, no question.  After completing the analysis of the entire solution, go to the PVS-Studio menu -&gt; Suppress Messages ... The dialog is simple, click "Suppress Current Messages", then Close.  As a result, you will have 0 messages left in the PVS-Studio window.  And even if you run again the analysis of the whole code - after the analysis is completed there will be 0 messages.  But now, if you start writing a new code or modifying the old code, then the analyzer will already swear on this code.  Unless of course you write it immediately perfect. <br><br><h2>  How it works? </h2><br>  This mechanism works quite simply.  Rather, now it is simple, but how many experiments were performed to come to this option ... Well, okay, what happens from the point of view of the user when he presses the ‚ÄúSuppress Current Messages‚Äù button? <br><br>  A database is created in the project folder from .suppress files.  For each project (.vcxproj file), a .suppress file is created next to it.  It stores information about all messages that were issued by the analyzer when checking this project.  With these messages, we compare the results of each new analysis. <br><br>  Messages are naturally compared out of the forehead.  We consider the message code, the text of the current line of code, as well as the text of the previous and next lines of code.  But on the contrary we do not take into account the line number: after all, if the message was issued at the end of the file (and so it is stored in the database), then inserting the lines at the beginning of the file will lead to a change in the message issue line.  We will track this and will not issue an "uninteresting" message once again.  But if one of the lines has changed (previous, current or next), then we are already fighting, because  the context of the message has been touched, and you can consider this message already issued to the new (modified) code. <br><br>  What to do with these.  suppress files?  If PVS-Studio runs on the same machine, say, a build server, then you can store these files directly in the project folders.  If this is not convenient (for example, a clean assembly is made), then before launching the analyzer, you can copy files to the project folder using robocopy from another location - it saves the folder structure. <br><br>  If several developers work with the analyzer, then .suppress files can be put into the repository.  The question arises - how to synchronize these .suppress files between developers?  On the one hand, the answer is simple - it is XML, so there is no problem.  But on the other hand, it turns out that synchronizing these files (and indeed somehow modifying them) is not necessary.  It is enough to create them once during the implementation of the analyzer, and there is no need to modify them anymore.  Well, at the same time try to maintain 0 messages from the analyzer on the project in the future. <br><br>  <b>Note.</b>  But how to maintain 0 messages from the analyzer in the future, if it doesn‚Äôt, no, and gives false warnings?  In this case, there are several ways to suppress individual warnings.  About this will be discussed below. <br><br><h2>  So what is this mechanism for? </h2><br>  If suddenly someone else did not understand, then I will give an absolutely concrete example.  You can add all messages to this database (we will receive 0 messages during the check).  Next on the build server, the analyzer is launched every night ( <a href="http://www.viva64.com/ru/d/0001/">how to configure the launch of the analyzer on the build server</a> ), which generates only new messages, that is, messages for a new code written by the team in a day.  These messages are saved not only in .plog (analyzer report in xml-format), but in a text file side by side.  And this text file can already be sent by mail to project participants using any suitable program.  For example, using <a href="http://www.viva64.com/go.php%3Furl%3D1507">SendEmail</a> . <br><br>  In the morning, people see messages from the analyzer in their mail and can correct errors even without installing PVS-Studio on their machines.  Well, if you still want to open a report (.plog), then it is available on the build server.  With the help of this trick you can save great money on licenses for PVS-Studio. <br><br>  By the way, you can configure which messages (more precisely, which levels) should be included in a text report.  This is done using the OutputLogFilter option, which is located on the Specific Analyzer Settings tab of the PVS-Studio settings.  We recommend including General Analysis Level1 and Level 2 messages in a text file. <br><br><h3>  A small caveat about incremental analysis. </h3><br>  We still recommend that first of all, developers use PVS-Studio, including on local machines, in <a href="http://www.viva64.com/ru/d/0218/">incremental analysis</a> mode.  This is a tick ‚ÄúAnalysis after Build (Modified files only)‚Äù in the PVS-Studio menu.  When enabled, the analyzer monitors your work and automatically runs for those files that have been compiled (it keeps track of the modification of .obj files).  If the analyzer does not find anything, then you will not even notice that it has started.  And if it does, it will pop up an error message. <br><br>  Incremental analysis supports the database of "uninteresting" messages.  If you have such a database, then the messages from incremental analysis will be only about the new code.  And if not, then completely on the file that is being analyzed. <br><br>  The incremental analysis mode allows you to correct errors as soon as they appear, even before the error is in the version control system.  And as <a href="http://www.viva64.com/ru/t/0046/">we know</a> from McConnell, error correction at this stage is the cheapest.  Therefore, if possible, we recommend using PVS-Studio both during daily checks on the server and in the incremental analysis mode on the programmers' machines. <br><br><h2>  How to fix messages that are in the database? </h2><br>  Well, you implemented static analysis on the project, the analyzer gives you no more than a few messages per day, which you and the team immediately rule.  Fine.  But then there was a week of free time, which can be spent on editing old mistakes.  How to get to them?  There are two options. <ol><li>  You can use the ‚ÄúSuppress Messages ...‚Äù command to bring up a dialog box in which the ‚ÄúDisplay Suppressed Messages‚Äù checkbox appears.  Turn it on and messages will appear. </li><li>  Or, if you have a daily launch configured on the build server, then you simply go to the folder with the results of the last analysis and see the following files there: <ol><li>  SolutionName.plog - a log with only new messages; </li><li>  SolutionName.plog.txt - a text log, the same as SolutionName.plog; </li><li>  SolutionName_WithSuppressedMessages.plog - all messages, including ‚Äúuninteresting‚Äù. </li></ol><br></li></ol>  Here with this file SolutionName_WithSuppressedMessages.plog and it is necessary to work.  Open it and get all the messages.  At first, this file will be large, as there are many messages.  But if you rule them at least sometimes, then in time he will become small, and maybe you will be able to refuse him (and .suppress files, respectively), too. <br><br>  It is important to understand this.  If you have time and opportunity, you can always go back to the old "uninteresting" messages and correct them.  We recommend doing this, because errors are errors and they should be corrected. <br><br><h2>  And this is not contrary to the function of Mark as False Alarm? </h2><br>  In PVS-Studio there is a command <a href="http://www.viva64.com/ru/d/0021/">Mark As False Alarm</a> - mark as a false alarm.  This is when a comment of the form // - V501 is added to the message line.  Having met such a comment, the analyzer will not issue a V501 message on this line. <br><br>  The mechanism described in this article and Mark As False Alarm do not contradict each other.  But they serve a slightly different purpose.  Mass suppression of uninteresting messages - for mass marking in the implementation of the analyzer in the project.  And Mark As False Alarm - in order that the analyzer does not swear into separate fragments. <br><br>  In principle, it would be possible to mark the whole code as False Alarm earlier, but usually it‚Äôs scary for people to make so many edits in the code.  In addition, it is not clear how to work with old errors - remove everything that is marked as False Alarm?  And if there really is a false alarm. <br><br>  But using the mass repression mechanism to suppress individual messages is also wrong. <br><br>  In general, these are two mechanisms that solve different problems.  Do not confuse them. <br><br><h2>  Conclusion </h2><br>  So, the approach to the implementation of static analysis in a live project looks like this: <ol><li>  We mark all messages as ‚Äúuninteresting‚Äù using the ‚ÄúSuppress Messages ...‚Äù command. </li><li>  Now the next time you start the analyzer will display messages only on the new code. </li><li>  If necessary, you can always correct errors that were hidden during the implementation. </li></ol>  This allows you to start benefiting from static analysis right away. <br><br><h2>  Additional links </h2><br><ol><li>  <a href="http://www.viva64.com/ru/d/0001/">Checking the code with PVS-Studio from the command line.</a> </li><li>  <a href="http://www.viva64.com/ru/d/0218/">PVS-Studio incremental analysis mode.</a> </li><li>  <a href="http://www.viva64.com/ru/d/0021/">Suppression of false warnings.</a> </li><li>  <a href="http://www.viva64.com/ru/t/0046/">Static code analysis.</a> </li><li>  <a href="http://www.viva64.com/ru/a/0084/">An updated list of open-source projects that we tested with PVS-Studio.</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/252493/">https://habr.com/ru/post/252493/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../252475/index.html">Personal data of users of Rozetka.ua in public access</a></li>
<li><a href="../252481/index.html">Wi-Fi thermometer on the ESP8266 + DS18B20 for only $ 4</a></li>
<li><a href="../252483/index.html">9 facts that programmers know and do not know everything else</a></li>
<li><a href="../252489/index.html">PHPUnit: spreadsheet (spreadsheet) as a data source (data provider)</a></li>
<li><a href="../252491/index.html">TLS in HTTP / 2</a></li>
<li><a href="../252495/index.html">Making another joystick (gamepad) on the Arduino</a></li>
<li><a href="../252497/index.html">DevCon 2015: announcement of the second wave of speakers and conference reports</a></li>
<li><a href="../252499/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ150 (March 2 - 8, 2015)</a></li>
<li><a href="../252501/index.html">About one trick to return an error code from a function</a></li>
<li><a href="../252503/index.html">High Voltage Greetings on Spring Day</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>