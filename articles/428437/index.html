<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Apple Wallet. What is it and how to integrate your card into it</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It is considered that Wallet is not the most popular service in the CIS. But already in the second project in a row, the customer sets the task ‚ÄúTo ma...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Apple Wallet. What is it and how to integrate your card into it</h1><div class="post__text post__text-html js-mediator-article"><p>  It is considered that Wallet is not the most popular service in the CIS.  But already in the second project in a row, the customer sets the task ‚ÄúTo make integration with the Wallet‚Äù.  Therefore, I decided to write this article in order to tell about the service as a whole and show how to integrate my product into it. </p><br><p>  What is a wallet?  It allows you to keep in your phone various types of cards (tickets, discount cards, etc.), making life easier for users of the product.  Moreover, it is possible to update the card information via push notifications, but this is a topic for a separate article.  But if you have a card / ticket / subscription that can be integrated into the phone, then there is a solution for this!  How to do this - read below. </p><a name="habracut"></a><br><p>  As a rule, your server is responsible for creating the map.  The application receives the card in the form of a .pkpass file and already through the application the user can add the card to the Wallet. </p><br><h2 id="struktura-karty">  Map structure </h2><br><p>  What is the map from the point of view of the developer?  The map is an archive with the .pkpass extension.  It contains all the data necessary for the display and operation of the map.  The contents of the archive are in the table below. </p><br><table><tbody><tr><th>  File </th><th>  Purpose </th></tr><tr><td>  background.png </td><td>  Background picture for the map. </td></tr><tr><td>  footer.png </td><td>  Picture next to the barcode </td></tr><tr><td>  icon.png </td><td>  Icon for notifications and letters </td></tr><tr><td>  logo.png </td><td>  Logo card.  Displayed on the upper left </td></tr><tr><td>  manifest.json </td><td>  Registry of all included files </td></tr><tr><td>  signature </td><td>  PKCS7 signature </td></tr><tr><td>  pass.json </td><td>  Appearance and information on the map </td></tr><tr><td>  strip.png </td><td>  Picture behind the main card description </td></tr><tr><td>  thumbnail.png </td><td>  Additional picture (specify) </td></tr></tbody></table><br><p>  There are the following types of cards: </p><br><ul><li>  <b>Boarding ticket:</b> by plane or train.  Usually the coupon works on one trip; </li><li>  <b>Coupon:</b> for coupons and special offers; </li><li>  <b>Event ticket:</b> can work both for one event, and for the whole season; </li><li>  <b>Discount card:</b> loyalty cards, discount or gift cards; </li><li>  <b>General view of the map:</b> if none of the above does not fit your case: for example, a map for trips to the subway or a pass to the gym. </li></ul><br><p>  Consider schematically the appearance of different cards.  Pictures should be called as indicated in the table above. </p><br><h3>  Boarding card </h3><br><img src="https://habrastorage.org/webt/8m/s6/cy/8ms6cyz55rve1igxt_xfv2e034i.png"><br><h3>  Coupon </h3><br><img src="https://habrastorage.org/webt/-r/l-/dk/-rl-dknkbsqnkuim5-kqog6ceuu.png"><br><h3>  Event ticket </h3><br><img src="https://habrastorage.org/webt/rr/r9/jh/rrr9jh2ho29rfmht7xrf0z7pmes.png"><br><h3>  General Map </h3><br><img src="https://habrastorage.org/webt/az/zc/hg/azzchgo25cvpj_gcu_oof1vh1k8.png"><br><h3>  Discount card </h3><br><img src="https://habrastorage.org/webt/zl/zt/ft/zlztft7igalmerx8rhabnxorwfc.png"><br><h1 id="struktura-passjson">  Pass.json structure </h1><br><p>  Required fields.  Contain Pass Type ID, Team ID, organization name, etc. <br>  Keys for related applications.  Needed to display applications that need to be "associated" with the map. <br>  Keys "expiration date" cards. <br>  Keys of relevance.  For example, the coordinates of the area where the map can be used, or the beginning of the event for which it is intended. <br>  The key is style.  At the beginning of the article were listed 5 types of maps for Wallet.  Each of them has its own style.  Such a key must be strictly one. <br>  Keys visual card design.  In addition to the obvious, they contain information about the barcode displayed on the map. <br>  Web service keys.  You can use web services to interact with the map, for example, automatically update it. <br>  NFC keys.  Contain additional information for Apple Pay transactions. </p><br><p>  Now everything is more detailed. </p><br><h2>  Required fields </h2><br><table><tbody><tr><th>  <nobr>JSON key</nobr> </th><th>  <nobr>Data type</nobr> </th><th>  <nobr>Description</nobr> </th></tr><tr><td>  description </td><td>  String. <br>  Localizable </td><td>  Brief map description.  Localizable </td></tr><tr><td>  formatVersion </td><td>  Int </td><td>  File format version.  The value must be 1. </td></tr><tr><td>  <nobr>organizationName</nobr> </td><td>  String. <br>  Localizable </td><td>  The name of the organization that issues the cards. </td></tr><tr><td>  <nobr>passTypeIdentifier</nobr> </td><td>  String </td><td>  Pass Type ID and developer cabinet. </td></tr><tr><td>  <nobr>serialNumber</nobr> </td><td>  String </td><td>  The serial number of the individual card </td></tr><tr><td>  <nobr>teamIdentifier</nobr> </td><td>  String </td><td>  Team ID Developer Team </td></tr></tbody></table><br><h2>  Keys for related applications </h2><br><table><tbody><tr><th>  <nobr>JSON key</nobr> </th><th>  <nobr>Data type</nobr> </th><th>  <nobr>Description</nobr> </th></tr><tr><td>  <nobr>associatedStoreIdentifiers</nobr> </td><td>  [Int] </td><td>  Optional.  Application ID associated with the card.  Always take the first, compatible with the current device. </td></tr><tr><td>  <nobr>appLaunchURL</nobr> </td><td>  String </td><td>  URL that is passed to the application when opened </td></tr></tbody></table><br><h2>  Style Keys </h2><br><table><tbody><tr><th>  <nobr>JSON key</nobr> </th><th>  <nobr>Data type</nobr> </th><th>  <nobr>Description</nobr> </th></tr><tr><td>  <nobr>primaryFields</nobr> </td><td>  [Json] </td><td>  Basic information about the map. </td></tr><tr><td>  <nobr>secondaryFields</nobr> </td><td>  [Json] </td><td>  Background Information. </td></tr><tr><td>  <nobr>auxiliaryFields</nobr> </td><td>  [Json] </td><td>  Fields for additional information.  Optional </td></tr><tr><td>  <nobr>headerFields</nobr> </td><td>  [Json] </td><td>  The title of the card.  It is displayed even when the cards are visible in the list. </td></tr><tr><td>  <nobr>auxiliaryFields</nobr> </td><td>  [Json] </td><td>  Basic information about the map. </td></tr><tr><td>  <nobr>transitType</nobr> </td><td>  String </td><td>  Type of transport for card tickets.  It can take the following values: <br>  PKTransitTypeAir, <br>  PKTransitTypeBoat, <br>  PKTransitTypeBu`, <br>  PKTransitTypeGeneric, <br>  `PKTransitTypeTrain`. </td></tr><tr><td>  <nobr>backFields</nobr> </td><td>  [Json] </td><td>  Array of fields responsible for the back side of the card </td></tr></tbody></table><br><p>  JSON in this case has the following form: </p><br><pre><code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"key"</span></span> : <span class="hljs-string"><span class="hljs-string">"value1"</span></span>, <span class="hljs-string"><span class="hljs-string">"label"</span></span> : <span class="hljs-string"><span class="hljs-string">"value2"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span> : <span class="hljs-string"><span class="hljs-string">"value3"</span></span></code> </pre> <br><p>  The value of the key value can be either numeric or string.  However, currencyCode together with a string value will not work.  As for auxiliaryFields and secondaryFields, there may be several of them, and it is worth monitoring the length of the lines that they use. </p><br><h2>  Keys of visual design </h2><br><table><tbody><tr><th>  <nobr>JSON key</nobr> </th><th>  <nobr>Data type</nobr> </th><th>  <nobr>Description</nobr> </th></tr><tr><td>  <nobr>barcodes</nobr> </td><td>  [Json] </td><td>  Information for the barcode (see below). </td></tr><tr><td>  <nobr>backgroundColor</nobr> </td><td>  color as string </td><td>  Background color. (# Fa32e4) </td></tr><tr><td>  <nobr>foregroundColor</nobr> </td><td>  color as string </td><td>  Color labels with values </td></tr><tr><td>  <nobr>groupingIdentifier</nobr> </td><td>  String </td><td>  Optional for event tickets and transport tickets.  Cards with the same style - passTypeIdentifier and groupingIdentifier - will be grouped </td></tr><tr><td>  <nobr>labelColor</nobr> </td><td>  color as string </td><td>  Label text with field names </td></tr><tr><td>  <nobr>logoText</nobr> </td><td>  Localizable string </td><td>  Text displayed next to the logo </td></tr></tbody></table><br><h2>  Barcode </h2><br><p>  The most important part of the map.  The identification number of the card is sewn into it (for example, the physical card number or the ticket number).  It is important that a scanner or any other tool be able to read codes in the proper encoding. </p><br><table><tbody><tr><th>  <nobr>JSON key</nobr> </th><th>  <nobr>Data type</nobr> </th><th>  <nobr>Description</nobr> </th></tr><tr><td>  <nobr>altText</nobr> </td><td>  String </td><td>  Optional text displayed next to the barcode if the barcode is not readable. </td></tr><tr><td>  <nobr>format</nobr> </td><td>  String </td><td>  Barcode format.  May take values: PKBarcodeFormatQR, <br>  PKBarcodeFormatPDF417, <br>  PKBarcodeFormatAztec, <br>  PKBarcodeFormatCode128 </td></tr><tr><td>  <nobr>message</nobr> </td><td>  String </td><td>  Code or card number encrypted in barcode. </td></tr><tr><td>  <nobr>messageEncoding</nobr> </td><td>  String </td><td>  Message encoding  Usually iso-8859-1 </td></tr></tbody></table><br><h2>  Location </h2><br><p>  These keys are responsible for the location within which the map can be used. </p><br><table><tbody><tr><th>  <nobr>JSON key</nobr> </th><th>  <nobr>Data type</nobr> </th><th>  <nobr>Description</nobr> </th></tr><tr><td>  <nobr>altiture</nobr> </td><td>  String </td><td>  Optional text displayed next to the barcode if the barcode is not readable. </td></tr><tr><td>  <nobr>latitude</nobr> </td><td>  Longitude </td><td>  Latitude </td></tr><tr><td>  <nobr>longtitude</nobr> </td><td>  Double </td><td>  Latitude </td></tr><tr><td>  <nobr>relevantText</nobr> </td><td>  String </td><td>  Optional text that is displayed on the lock screen when the user enters the range of the card. </td></tr></tbody></table><br><h2>  Downside </h2><br><p>  Additional information can be placed on the reverse information part: terms of use, auto-update policy, contact details and a link to the application to which the card belongs.  The figure shows the correspondence of the fields in pass.json and the appearance of the back side of the map.  If the value-field has links, phone numbers, etc., they will be highlighted automatically. </p><br><p><img src="https://habrastorage.org/webt/er/gx/ow/ergxowmbtn08dmjnv2lkrqlo3ku.png"></p><br><h1 id="sozdanie-karty-chast-2">  Create a map.  Part 2 </h1><br><p>  So, the pictures are ready, pass.json is formed, it remains to put all this together.  To do this, fill in manifest.json (see table 1), where you need to include all the pictures and pass.json.  It turns out like this: </p><br><pre> <code class="hljs go">. . . . . . <span class="hljs-string"><span class="hljs-string">"pass.json"</span></span> = <span class="hljs-number"><span class="hljs-number">303</span></span>c753abc39aa732ec74643d6db28348fe8a823; <span class="hljs-string"><span class="hljs-string">"strip.png"</span></span> = <span class="hljs-number"><span class="hljs-number">736d</span></span>01f84cb73d06e8a9932e43076d68f19461ff; <span class="hljs-string"><span class="hljs-string">"strip@2x.png"</span></span> = <span class="hljs-number"><span class="hljs-number">468f</span></span>a7bc93e6b55342b56fda09bdce7c829d7d46; . . . . . .</code> </pre> <br><p>  From this point on it is not necessary to change anything, since SHA will be incorrect, in case of changes, it is necessary to generate SHA again. </p><br><p>  Next you need to create a Pass Type ID in the developer‚Äôs office and make a certificate for it.  The procedure should be more or less familiar if you have previously created, for example, Provisioning profiles. </p><br><img src="https://habrastorage.org/webt/2b/um/hu/2bumhu9wgoawlz1lt-qhieildna.png"><br><p>  Then we go to the key-keeper (Keychain) and export the Apple Worldwide Developer Relation Certificate (WWDR) from there as .pem. </p><br><p><img src="https://habrastorage.org/webt/jg/kk/sl/jgkksl_tfac4e23hz7bk1swxhtq.png"></p><br><p>  From there, we export the created Pass Type ID as .p12.  At this stage, the key card asks you to enter the password for the certificate.  In this case, the password is optional. <br>  Please note that all further actions should be performed in one folder where manifest.json, pass.json and pictures should already be located. </p><br><p>  Now you need to generate a signature, which we will sign the archive.  To begin with, export the Pass Type ID and the key to it as .pem. </p><br><pre> <code class="hljs objectivec">openssl pkcs12 -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> certificate.p12 -clcerts -nokeys -<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> passcertificate.pem -passin pass: your_password</code> </pre> <br><p>  and </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">openssl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pkcs12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-in</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">certificates</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.p12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-nocerts</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-out</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">passkey</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-passin</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pass</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">-passout</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pass</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:new_password</span></span></code> </pre> <br><p>  Now we are ready to generate a signature.  Make this a command: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">openssl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">smime</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-binary</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-sign</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-certfile</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">WWDR</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-signer</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">passcertificate</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-inkey</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">passkey</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-in</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">manifest</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.json</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-out</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">signature</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-outform</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">DER</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-passin</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pass</span></span>:___</code> </pre> <br><p>  So, everything is ready with us, it remains only to collect the archive, we do it with the command: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">zip</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">nameOfPass</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pkpass</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">manifest</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.json</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pass</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.json</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">signature</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">logo</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.png</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">logo</span></span>@<span class="hljs-keyword"><span class="hljs-keyword">2x</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">png</span></span> logo@<span class="hljs-number"><span class="hljs-number">3</span></span>x.png icon.png icon@<span class="hljs-number"><span class="hljs-number">2</span></span>x.png icon@<span class="hljs-number"><span class="hljs-number">3</span></span>x.png</code> </pre> <br><p>  I draw your attention to the fact that all the files to which you want to include the data archive for the card (.pkpass) should be listed here. <br>  As a result, we get a .pkpass file that can be opened on the computer.  We will see a preview of the map, the appearance of which may differ from the appearance on the phone. <br>  All this can be done a little easier.  Apple provides the <code>signpass</code> utility ( <a href="https://developer.apple.com/services-account/download%3Fpath%3D/iOS/Wallet_Support_Materials/WalletCompanionFiles.zip">Apple Wallet sample meterials</a> ), which takes all the SHA calculations (the <code>manifest.json</code> file can be left alone) and the work of creating signatures.  To use it, you need to collect the project and place the <code>signpass</code> file in a folder with all the necessary resources. </p><br><img src="https://habrastorage.org/webt/tj/jj/eo/tjjjeoqlhxzjumfr3nrg9ve8yhm.png"><br><p>  In general, the structure should look like this: </p><br><img src="https://habrastorage.org/webt/qc/pb/lr/qcpblrbdaw7piffxdehwa1whlpw.png"><br><p>  Next, execute the command: </p><br><pre> <code class="hljs">./signpass -p wallet</code> </pre> <br><p>  Wallet is the name of the folder in which all resources lie.  At the output we get the file wallet.pkpass.  Its contents can be viewed by unarchiving wallet.pkpass. </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">unzip</span></span> wallet.pkpass</code> </pre> <br><p>  It is possible that the creation of pkpass will be put on the backend, in this case it will be necessary to transfer to the developers of WWDR, ‚Äã‚Äãa certificate for the Pass Type ID in the form of .p12 and a password for it. </p><br><h1 id="integraciya-s-prilozheniem">  Application Integration </h1><br><p>  In order for the app to have the ability to add maps to the Wallet, you must enable this feature in the App ID and also enable this feature in the Capabilities in the project. </p><br><img src="https://habrastorage.org/webt/yq/wo/py/yqwopyfu9nhk-_klilrcoczwe3m.png"><br><img src="https://habrastorage.org/webt/o-/se/ek/o-seekf9zbohe4jmwtcvnzfwes4.png"><br><p>  This is necessary for full-fledged correct work with Wallet.  Otherwise, it will not be possible to read cards from the Wallet and, for example, it will not be possible to understand whether our card has been added or not.  It is also important to note that the team id in pass.json must match the c team id, or you will have to add them manually to the entitlements and this may correct the situation, but I did not check it. </p><br><p><img src="https://habrastorage.org/webt/82/ow/p9/82owp9rv4gyaldwm0si77b5nn8m.png"></p><br><h2 id="dobavlenie-karty">  Adding a card </h2><br><p>  Adding cards is very simple: </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passPath = <span class="hljs-type"><span class="hljs-type">Bundle</span></span>.main.path(forResource: <span class="hljs-string"><span class="hljs-string">"wallet"</span></span>, ofType: <span class="hljs-string"><span class="hljs-string">"pkpass"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error: <span class="hljs-type"><span class="hljs-type">ErrorPointer</span></span> = <span class="hljs-type"><span class="hljs-type">ErrorPointer</span></span>(nilLiteral: ()) <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passData = <span class="hljs-type"><span class="hljs-type">NSData</span></span>(contentsOfFile: passPath) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> pass = <span class="hljs-type"><span class="hljs-type">PKPass</span></span>(data: passData <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-type"><span class="hljs-type">Data</span></span>, error: error) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passLibrary = <span class="hljs-type"><span class="hljs-type">PKPassLibrary</span></span>() passLibrary.addPasses([pass]) { (status) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(passLibrary.containsPass(pass)) }</code> </pre> <br><p>  However, again, more often .pkpass file will need to be downloaded from your server. <br>  It is worth noting that PassKit gives quite readable errors, so you can easily understand what exactly was done wrong. </p><br><h2 id="poluchenie-informacii-o-dobavlennyh-kartah">  Getting information about added maps </h2><br><p>  To get information about the maps available in the Wallet and related to your application, you need to refer to the PKPassLibrary object. </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passLibrary = <span class="hljs-type"><span class="hljs-type">PKPassLibrary</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> passes = passLibrary.passes()</code> </pre> <br><p>  Thus, it is possible to understand whether a map has been added or not, as well as to update the interface.  In addition, through the PKPassLibrary maps can be updated and deleted.  You can update maps via web services, but in this article we will not consider this option. </p><br><h1 id="proverka-na-unikalnost">  Check for uniqueness </h1><br><p>  Since in your service, as a rule, the card is tied to an account, the application will most likely have to somehow determine whether the card belongs to the current user.  I suggest doing this through <code>serialNumber</code> .  For example, set the user ID or card number as the <code>serialNumber</code> . </p><br><h1 id="testirovanie">  Testing </h1><br><p>  Apple provides examples of pkpass for different types, you can focus on them. <br>  <a href="https://developer.apple.com/services-account/download%3Fpath%3D/iOS/Wallet_Support_Materials/WalletCompanionFiles.zip">Apple Wallet samples</a> <br>  To see how the map looks, you can add pkpass to the project (see ‚ÄúAdding a Map‚Äù).  The process of adding / deleting has already been discussed above, it remains only to remind that the application will not see already added cards, if the card for Wallet was created on one developer account, and the development itself was carried out from another account (relevant for outsourcing companies).  In this case, you can add cards without problems. <br>  You can check whether the information in the barcode is correctly encoded using any QR code scanner.  And just need to check the correctness of the work with this scanner. </p><br><h1 id="zaklyuchenie">  Conclusion </h1><br><p>  The article reviewed the process of creating and designing the card, as well as the process of integration with the application and the problems that may arise.  I deliberately did not address the issues of integration with web services and map updates, and I hope to do this in the next article. </p><br><h1 id="ispolzuemye-materialy">  Materials used: </h1><br><p>  <a href="https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/PassKit_PG/Creating.html">https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/PassKit_PG/Creating.html</a> <br>  <a href="https://developer.apple.com/library/archive/documentation/UserExperience/Reference/PassKit_Bundle/Chapters/TopLevel.html">https://developer.apple.com/library/archive/documentation/UserExperience/Reference/PassKit_Bundle/Chapters/TopLevel.html#//apple_ref/doc/uid/TP40012026-CH2-SW3</a> <br>  <a href="https://itechroof.wordpress.com/2015/11/30/apple-wallet-part-13/">https://itechroof.wordpress.com/2015/11/30/apple-wallet-part-13/</a> <br>  <a href="https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/PassKit_PG/Updating.html">https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/PassKit_PG/Updating.html</a> </p><br><p>  Special thanks to <a href="https://habr.com/users/mehdzor/" class="user_link">mehdzor</a> for the developer account for tests. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/428437/">https://habr.com/ru/post/428437/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../428423/index.html">How the IBM and Red Hat deal at $ 34 billion will change the IT market: expert and analyst opinions</a></li>
<li><a href="../428429/index.html">Electronic signature GOST R 34.10 PDF documents in the LibreOffice office suite</a></li>
<li><a href="../428431/index.html">More than concentric layers</a></li>
<li><a href="../428433/index.html">Lawyers about testing when hiring in the private sector</a></li>
<li><a href="../428435/index.html">What to read in PHP in Russian?</a></li>
<li><a href="../428439/index.html">Without ensemble</a></li>
<li><a href="../428441/index.html">GitHub purchase completed. What will happen next?</a></li>
<li><a href="../428443/index.html">Reconciliation - checking data integrity in distributed systems</a></li>
<li><a href="../428445/index.html">How we went to the hackathon in Helsinki and lost</a></li>
<li><a href="../428447/index.html">Data protection in the cloud: a guide for developers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>