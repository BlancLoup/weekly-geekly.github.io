<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Kotlin: Without Best Practices, life is not the same. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! This article is about the most pressing problems when programming in Kotlin. In particular, I will touch on several topics that cause the mo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Kotlin: Without Best Practices, life is not the same. Part 1</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr!  This article is about the most pressing problems when programming in Kotlin.  In particular, I will touch on several topics that cause the most ambiguity - the use of it in lambda expressions, the abuse of functions from the Standard.kt file, and the brevity of writing vs.  code readability. <br><a name="habracut"></a><br><h3>  Prehistory </h3><br>  I started looking at Kotlin about a year ago (starting at Milestone 12) and actively used it to write my Android applications.  After two years of writing Android applications in the Java language, writing on Kotlin was a breath of fresh air - the code was much more compact (no anonymous classes to you, functional features appeared), and the language itself is much more expressive (extension functions, lambda functions) and safer ( null safety). <br><br>  When the language came out, I began to write my new project at work without a doubt, praising it at the same time to my colleagues (in my small company I am the only Android developer, the rest are developing Java client-server applications in Java).  I understood that after me the new team member would have to learn this language, which in my opinion was not a problem in this case - this language is very similar to Java and after 3-5 days after reading the official documentation, you can begin to write confidently on it. <br><br>  After some time, I began to notice that in some cases you need to beat your hands and write a longer but understandable code than a short and less clear one.  Example: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//   ,         Safe-call ("?."),        val user = response?.user ?: return val name = user.name.toLowerCase() //  ,          val name = response?.user?.name?.toLowerCase() ?: return</span></span></code> </pre> <br>  Since I was the only programmer, I quickly understood this pattern and implicitly developed a rule for myself to prefer the readability of the code of its brevity.  Everything would be nothing until we took an internship Android programmer for an internship.  As I expected, after reading the official documentation on the language, he quickly mastered Kotlin, having Java programming experience, but then strange things started to happen: each code review caused half-hour (and sometimes hour) discussions between us on what language constructions are best used in certain situations.  In other words, we began to develop a programming style for Kotlin in our company.  I believe that these discussions arose for the reason that the documentation, which is the entry point to the world of Kotlin, does not provide the very Best Practices, namely when it is better NOT to use these features and what is better to use instead.  That is why I decided to write this article. <br><br>  At once I want to stipulate that I am not trying to prove the truth of my statements, but I am trying to discuss how to properly write all such things on Kotlin. <br><br><h2>  Language problems </h2><br><h3>  "It" callback hell </h3><br>  This problem lies in the fact that in Kotlin it is allowed not to name the only parameter of the callback function.  It will have the name "it" by default.  Example: <br><br><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/**    callback,         */</span></span> <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(callback: (Any?)</span></span></span><span class="hljs-function"> -&gt; Unit) </span></span>{ ... callback(parameter) ... } <span class="hljs-comment"><span class="hljs-comment">/**  . Kotlin    execute { ... },   execute({ ... }),     */</span></span> execute { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (it is String) { <span class="hljs-comment"><span class="hljs-comment">//   parameter   it,      String .... } .... }</span></span></code> </pre><br>  However, when we have several nested functions, confusion can arise: <br><br><pre> <code class="java hljs">execute { execute { execute { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (it is String) { <span class="hljs-comment"><span class="hljs-comment">// it       execute .... } .... } } } execute { execute { execute { parameter -&gt; if (it is String) { //  it        execute,        .... } .... } } }</span></span></code> </pre><br>  On small fragments when this may not seem like such a problem, however, if several people work on the code and such a function with a nested call has 10-15 lines, then it is easy to lose who actually owns it at this nesting level.  The situation worsens if the name it is used for some operation in each level of nesting.  In this case, the understanding of such a code greatly deteriorates. <br><br><pre> <code class="java hljs">executeRequest { <span class="hljs-comment"><span class="hljs-comment">//  it -    Response if (it.body() == null) return executeDB { //  it -    DatabaseHelper it.update(user) executeInBackgroud { //  it -    Thread if (it.wait()) ... .... } } }</span></span></code> </pre><br>  <a href="https://discuss.kotlinlang.org/t/will-it-variable-stay-or-go/522/">Here</a> is a discussion on the readability of code using it.  My opinion is that it helps a lot to shorten the code and makes it clearer for simple functions, but once we deal with a nested callback function, it‚Äôs better to name the parameters of both functions: <br><br><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">//   executeInBackgroud { if (it.wait()) ... .... } //   executeRequest { response -&gt; if (response.body() == null) return executeDB { dbHelper -&gt; dbHelper.update(user) ... } }</span></span></code> </pre><br><h3>  Abuse of functions from the Standard.kt file </h3><br>  For those who do not know, the <a href="">Standard.kt</a> file contains many useful functions.  <a href="http://beust.com/weblog/2015/10/30/exploring-the-kotlin-standard-library/">Here</a> is a detailed description of what each of them is for. <br><br>  Problems with these functions begin when the programmer starts using them too often. <br><br>  The first example is the let function, which essentially performs 2 tasks: allows you to call code if a value is not null and shift this value to the variable it: <br><br><pre> <code class="java hljs">response?.user?.let { val name = it.name <span class="hljs-comment"><span class="hljs-comment">//  it    user }</span></span></code> </pre><br>  The first drawback of this function overlaps with the topic of the previous section - the variable it appears, which adds possible errors.  The second drawback is that using this function, the code is not read as English text.  Much better to write as follows: <br><br><pre> <code class="java hljs">val user = response?.user ?: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> val name = user.name</code> </pre><br>  Third, let adds an extra level of indentation, which degrades the readability of the code.  You can read about this feature <a href="http://beust.com/weblog/2016/01/14/a-close-look-at-kotlins-let/">here</a> , <a href="https://www.reddit.com/r/Kotlin/comments/41dg3r/a_close_look_at_kotlins_let/">here</a> and <a href="https://discuss.kotlinlang.org/t/usecases-let-function-t-let-f-t-r/387">here</a> .  My opinion is that this function is not needed at all in the language, the only advantage of it is help with null safety.  However, even this plus can be solved in other more elegant and understandable ways (preliminary check for null with?: Or just if). <br><br>  As for the other functions, they should be applied extremely rarely and carefully.  Take, for example, with.  It allows you not to specify each time the object on which you want to call the function: <br><br><pre> <code class="java hljs">with(dbHelper) { update(user) delete(comment) } <span class="hljs-comment"><span class="hljs-comment">//    : dbHelper.update(user) dbHelper.delete(comment)</span></span></code> </pre><br>  The problem begins where these calls are mixed with other code that is not related to the dbHelper object: <br><br><pre> <code class="java hljs">with(dbHelper) { val user = query(user.id) user.name = name user.address = getAddress() <span class="hljs-comment"><span class="hljs-comment">// getAddress()     dbHelper .... update(user) val comment = getLatestComment() // getLatestComment()      dbHelper .... delete(comment) }</span></span></code> </pre><br>  In this case, it is necessary to constantly monitor who actually owns one or another function, which significantly reduces readability.  I will not give an example with nested use with, and so it is clear what kind of spaghetti code will end up. <br><br>  I will write about other painful things in the next article, because it has already managed to grow. <br><br>  <b>Update:</b> <br><br>  It so happened that while I was preparing the material for the second part of the article, a <a href="https://www.youtube.com/watch%3Fv%3DCABN2r4GPpQ">video of the presentation of Anton Keks</a> was published, which not only fully covered all the points of my second article, but also contained some additional important points.  But the most important thing is that this video also has developer comments.  I decided that the second article would not be in the format that the first one (and will say that there is such a problem, the video says this at such and such a minute), so for now I will not write the second part, but least until I discover new problems in the language.  Anyone who was waiting for the continuation, I advise you to watch the video presentation. </div><p>Source: <a href="https://habr.com/ru/post/308312/">https://habr.com/ru/post/308312/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../308302/index.html">Romance in (non-romantic) games: linear plots</a></li>
<li><a href="../308304/index.html">The future of flash memory: IBM FlashSystem</a></li>
<li><a href="../308306/index.html">Parallels Toolbox helps you download YouTube videos, turn off the microphone, record videos, and more.</a></li>
<li><a href="../308308/index.html">Write less code, damn it</a></li>
<li><a href="../308310/index.html">Using graphic effects in UWP applications using Win2D</a></li>
<li><a href="../308314/index.html">How to install Windows Server 2012 R2 and not get 200 updates after</a></li>
<li><a href="../308316/index.html">The book "Web development using Node and Express. Full use of JavaScript stack ¬ª</a></li>
<li><a href="../308318/index.html">Password Visibility Toggle - Android Support Library, revision 24.2.0</a></li>
<li><a href="../308320/index.html">Selection of servers for video surveillance systems</a></li>
<li><a href="../308326/index.html">Ember: Declarative templating with compiled helpers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>