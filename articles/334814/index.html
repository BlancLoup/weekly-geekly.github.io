<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How the KOMPAS-3D math library turned into a C3D Toolkit for CAD developers ‚Üí part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In previous posts, we talked about how the KOMPAS-3D CAD system is being developed and tested . Additionally, a series of articles on application deve...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How the KOMPAS-3D math library turned into a C3D Toolkit for CAD developers ‚Üí part 1</h1><div class="post__text post__text-html js-mediator-article">  In previous posts, we talked about how the <a href="http://kompas.ru/kompas-3d/about/">KOMPAS-3D</a> CAD system is <a href="https://habrahabr.ru/company/ascon/blog/326550/">being developed</a> and <a href="https://habrahabr.ru/company/ascon/blog/327582/">tested</a> .  Additionally, a series of articles on application development using <a href="https://habrahabr.ru/company/ascon/blog/328088/">the KOMPAS-3D API has been</a> launched.  It's time to talk about the "stuffing" that manages all the constructions in KOMPAS - the <a href="http://c3dlabs.com/ru/">core of the geometric modeling C3D</a> or just the geometric core of C3D. <br><br><img src="https://habrastorage.org/web/cef/3b2/fe3/cef3b2fe35d945ee810f977dc67b7926.png"><br>  <i>Fire ladder AL-30 (manufacturer: LLC Fire Systems)</i> <br><a name="habracut"></a><br><h2>  <font color="#00B2FF">Why do you need a geometric core when you have access to the CAD-system API?</font> </h2><br>  The application programming interface API in the CAD system allows you to expand the capabilities of the design system and contributes to a significant reduction in the development time of additional software components to the existing CAD system in the enterprise.  This is achieved through the use of a ready-made set of functions, presented in a convenient and understandable for the developer form.  As a rule, the internal implementation of such functions is hidden from the API programmer-user and is an object of intellectual property of the owner of the source software codes. <br><br>  The features of working with the application programming interface are specified in the technical documentation.  It also indicates which values ‚Äã‚Äãneed to be fed to the input of a particular function in order to get the correct values ‚Äã‚Äãon the output according to the purpose of this function.  That is, the API allows to abstract from the implementation of individual program blocks when developing applications: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/web/b25/f88/f54/b25f88f547204bb3be725711eb218f52.png"><br>  <i>Working with the API-interface on the principle of "black box"</i> <br><br>  Due to the fact that KOMPAS-3D has its own API, the basic functionality of the system over time has been supplemented with applications for designing electronic equipment and electrical equipment, machine parts, pipelines, metal structures, buildings and structures for various purposes. <br><br>  But using the CAD API is not always convenient and expedient.  The fact is that when referring to the geometric functions of the kernel, the developer directly eliminates the need to interact with intermediate links of the CAD system, such as the graphical interface, specifications, etc. Therefore, the same geometry in the kernel is created faster than in the CAD API.  Also, the use of a geometric kernel allows engineering application developers to keep secret the know-how invented by them.  For example, the features of constructing complex geometric models can be easily hidden from the user's attention. <br><br>  Most modern CAD systems are based on the 3D model building tree, which means that each new operation leads to the rebuilding of the entire tree, so using the kernel it is much easier to carry out iterative constructions, in particular, the creation of gears: <br><br><img src="https://habrastorage.org/web/39a/3e9/10b/39a3e910b5824e3f9b916380ba57469c.jpg"><br>  <i>Bevel gear built by the Shaft application without using a geometric kernel: multiple build operations are hidden in the macro element</i> <br><br> <a href=""><img src="https://habrastorage.org/web/dca/778/7bc/dca7787bc39743f1a5ab0b1d096a1e75.png"></a> <br>  <i>Bevel gear, built by the <abbr title="The successor to the app &quot;Shaft&quot;">application "Shafts and mechanical gears"</abbr> using the functionality of the geometric core: to build a ring gear requires only two operations (Picture is clickable)</i> <br><br>  In the case of the Shafts and Mechanical Transmissions application, using the kernel allows developers to: <br><br><ul><li>  reduce the time to create three-dimensional geometry; </li><li>  increase the accuracy of calculations difficult to form models; </li><li>  automatically carry out measurements of measuring dimensions of gears, as well as perform invisible constructions necessary for calculating gears. </li></ul><br>  In general, with the use of a geometric kernel in development, the probability of a model breaking when the user changes the application version decreases, and in general, the stability of the program increases with unpredictable user actions.  And the inclusion of the mathematical library in the basis of the developed solution allows to ensure independence from existing programs.  At a minimum, this means that you do not have to drag a third-party (often heavy) system distributive to the project and make license deductions for using the associated CAD system.  However, the latter statement cannot be considered a weighty argument, since application developers often focus on the audience of a specific CAD, CAM or CAE system, sometimes reaching values ‚Äã‚Äãof tens and hundreds of thousands of active users. <br><br><h2>  <font color="#00B2FF">Geometric and game cores</font> </h2><br>  The set of geometric functions in CAD forms together the geometric core of the system, which differs from the game engine with realistic 3D graphics.  This is most clearly demonstrated through an analogy with graphic editors.  As you know, some of them work with raster graphics based on points.  Other editors use vector graphics that are based on curved lines.  Similarly, in 3D applications, there is polygonal graphics, which is based on the position of points in space (polygons are built from them), and spline graphics, which is a combination of mathematical formulas and equations. <br><br>  In terms of CAD, we can say that polygonal graphics are based on a faceted representation of geometry.  The same presentation is used in game engines and in various animation packages for creating special effects of cinema: <br><br><img src="https://habrastorage.org/web/8fa/6f0/ff5/8fa6f0ff591344e9b0d4efd19d024cfe.png"><br>  <i>Faceted representation of 3D-model geometry</i> <br><br>  A mathematically accurate description of a 3D model is given by the boundary representation.  Its main feature is that to represent the shape of a geometric model, a set of faces is used, passing along the border that separates the interior of the object being modeled from the rest of the space.  As you probably already guessed, it is this representation that is used in geometric kernels. <br><br><div class="spoiler">  <b class="spoiler_title">Explanation.</b> <div class="spoiler_text">  In the boundary representation based on NURBS, the curves and surfaces accurately pass through the given discrete places of space (points or curves), at other points of the space, the requirement of smoothness is imposed on them.  Since the source data for constructing NURBS objects are discrete, NURBS curves and surfaces in the boundary representation are considered accurate because they exactly correspond to the initial requirements.  Moreover, NURBS objects can accurately represent the shape of <u>almost all</u> analytical curves and surfaces. <br><br>  Everything for which analytical laws are known is described in the boundary representation by other objects, for example, curves and surfaces of second order.  For objects that cannot be analyzed analytically, the boundary representation uses special techniques.  So, for an accurate description of the intersection curve of two cubic NURBS surfaces, iterative methods are used: the intersection curve is represented by a set of points, which serve as initial approximations for determining the position of the intersection curve point with the required accuracy.  Thus, the position of the points of the intersection curve with each reference to the curve is recalculated by iterative methods using the information in the curve. <br><br>  <b>UPD: A</b> person communicates with an intersection curve, for example, two NURBS surfaces, as follows: a person reports the value of a parameter to a curve, and the curve gives a point in space corresponding to this parameter.  That is, there is some information in the intersection curve (this is not necessarily a set of points, there can be intersected surfaces and some data on the curve parameter), which allows you to calculate a point at the intersection of surfaces with maximum machine precision, above which it makes no sense to specify.  Accordingly, there are no piecewise linear representations, cubic curves, or approximation curves in the intersection curve.  The curve of intersection of surfaces is an object that, for the specified parameter, gives a point in space. <br></div></div><br><br><img src="https://habrastorage.org/web/659/1cc/ca1/6591ccca155043b49838756e4769bdd0.png"><br>  <i>Boundary representation of the geometry of a 3D model</i> <br><br><h4>  <font color="#00B2FF">But then why is polygonal graphics not suitable for a geometric kernel?</font> </h4><br>  There are three main reasons: <br><br>  <b>Scalable</b> . <br><br><div class="spoiler">  <b class="spoiler_title">Any object must be easily increased and reduced.</b>  <b class="spoiler_title">Defects of geometry are irrelevant.</b> <div class="spoiler_text">  This means that at any scale of the visual scene, the image will be as smooth as the model itself.  A round is always round, a corner is a corner.  Violation of the stated principle implies the presence of defects. </div></div><br>  The accuracy of the display of the model in the boundary representation is determined at the CAD level, and the calculation of the polygonal grids is made so that the model visually appears smooth.  In this case, if we take the original <i>polygonal</i> model, then, regardless of the chosen design system, when we increase the scale, we will first see increasing triangles, and then the model will become angular.  The restriction in this case is set at the level of the model itself - with what accuracy the grid was originally calculated, for example, when writing to the STL format, with such precision you will have to work further. <br><br> <a href=""><img src="https://habrastorage.org/web/68b/775/d45/68b775d457da4e06aa9862a7deae73d4.jpg"></a> <br>  <i>Hunting in natural size.</i>  <i>When the model is enlarged, all faces retain their shape (the image is clickable)</i> <br><br>  <b>Smoothness</b> <br><br><div class="spoiler">  <b class="spoiler_title">The grid of triangles for working with drawings is not suitable - the drawing needs smooth and clear contours, and the grid will create visual dirt.</b> <div class="spoiler_text">  For example, consider the cube.  When projecting its boundary representation onto a plane, we get a square.  In the case of a polygonal representation, we will see a square with a diagonal.  If you project a polygonal cylinder into a drawing, then there will be much more diagonals.  They form the visual dirt. </div></div><br> <a href=""><img src="https://habrastorage.org/web/70c/343/8c0/70c3438c0ad942afbf90c0d104b59a23.jpg"></a> <br>  <i>An example of transferring a facet model to a drawing.</i>  <i>You can see how the places of grid thickening merge (Picture is clickable)</i> <br><br>  <b>Accuracy</b> <br><br><div class="spoiler">  <b class="spoiler_title">The movement of the machine control bodies with a numerical control, which works with the 3D model, is much easier to set using mathematical formulas.</b> <div class="spoiler_text">  The polygonal representation of the model does not allow to build an exact trajectory of the cutting tool, since the initial information about the shape of the object being made is missing and replaced by an approximate one. <br><br>  <b>NB: There are no</b> ready-made CAM formats that would accept NURBS as source data.  There are some enthusiasts who offer their own versions of the G-code, capable of performing ‚ÄúNURBS interpolation‚Äù, but so far all this remains in the field of science. </div></div><br><img src="https://habrastorage.org/web/e68/155/6e1/e681556e11ee4ea6a5408eaf57caf7cd.jpg"><br>  <i>Processing a model in an Esprit CAM system</i> <br><br>  Actually, there are much more reasons, but these are professional subtleties. <br><br>  <b>Unbelievable, but true:</b> modern design systems (and KOMPAS-3D are not an exception) work with two representations of geometry.  The boundary representation is used in the modeling process, after which the triangulation grid is calculated and a polygonal model is built, which is then sent to the video card to draw the visual scene.  At this stage, the visualization core can interfere with the process, for example, C3D Vision, which is responsible for managing the drawing of the model using mathematical, software and hardware optimization tools.  More about this we will tell in the following articles. <br><br><h2>  <font color="#00B2FF">Difficult choice: buy a core or write your own?</font> </h2><br>  Every engineering software developer sooner or later faces a choice: do you have to write the necessary mathematical algorithms yourself or buy ready-made components on the side?  In the history of ASCON, the use of third-party modules was considered in 1995, when the development of KOMPAS-3D was discussed.  Then a thorny let was chosen for independent writing of geometric functions, which are based on rather complicated mathematics.  You can learn more about it by reading the <a href="http://znanium.com/catalog.php%3Fbookinfo%3D520536">book</a> on geometric modeling by <a href="http://znanium.com/catalog.php%3Fbookinfo%3D520536">Nikolai Golovanov</a> : <br><br> <a href=""><img src="https://habrastorage.org/web/d6f/af6/02e/d6faf602ef32450a9126f26e3bd5e84c.png"></a> <a href=""><img src="https://habrastorage.org/web/87b/1ec/d1c/87b1ecd1ca354b06a06ef503b977e093.jpg"></a> <br>  <i>The table of contents and the cover of the book "Geometric modeling" N.N.</i>  <i>Golovanova (Pictures are clickable)</i> <br><br>  Few people know that later, in the 2000s, ASCON re-considered the issue of using a third-party mathematical core for working with 3D.  Testing of the CAD components available on the market was made and a strategically important decision was made to continue developing our own geometric core.  It was named C3D, which is short for the core corporate project name ‚ÄúCore3D‚Äù.  Today this core is successfully used not only inside ASCON, but also in projects of other developers of computer-aided design systems in Russia and abroad. <br><br>  <b><a href="https://habrahabr.ru/company/ascon/blog/335110/">The second part of the article</a></b> <br><br><img src="https://habrastorage.org/web/f52/793/b03/f52793b0361243168fc76230ba4fb17c.jpg" align="left"><br>  <b>Arkady Kamnev</b> <br>  Marketing Manager at C3D Labs </div><p>Source: <a href="https://habr.com/ru/post/334814/">https://habr.com/ru/post/334814/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../334802/index.html">Music licensing for indie developers</a></li>
<li><a href="../334804/index.html">Finding the best place in the world for a windmill</a></li>
<li><a href="../334806/index.html">New V8 and Node.js speed: optimization techniques today and tomorrow</a></li>
<li><a href="../334810/index.html">Self-orginizing map on TensorFlow</a></li>
<li><a href="../334812/index.html">Rotational Tag Family for Autodesk Revit Downloadable Families</a></li>
<li><a href="../334816/index.html">Voice interface for ordering a car by phone in action</a></li>
<li><a href="../334822/index.html">Case: how to organize multi-channel customer support on the example of a single hosting provider</a></li>
<li><a href="../334824/index.html">Archive this: how file system archiving works with Commvault</a></li>
<li><a href="../334826/index.html">ERP: project initiation. Alternative customer perspective</a></li>
<li><a href="../334828/index.html">Rethinking PID 1. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>