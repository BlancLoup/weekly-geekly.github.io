<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Weather Station on Arduino from A to Z. Part 4</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continued. The previous part . 
 Table of contents: 


- Part 1. Requirements. The choice of iron. General scheme 
- Part 2. Software. Central unit, i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Weather Station on Arduino from A to Z. Part 4</h1><div class="post__text post__text-html js-mediator-article"><p>  Continued.  <a href="https://habr.com/post/425953/">The previous part</a> . <br>  Table of contents: </p><br><ul><li>  <a href="https://habr.com/post/425901/">Part 1. Requirements.</a>  <a href="https://habr.com/post/425901/">The choice of iron.</a>  <a href="https://habr.com/post/425901/">General scheme</a> </li><li>  <a href="https://habr.com/post/425927/">Part 2. Software.</a>  <a href="https://habr.com/post/425927/">Central unit, iron</a> </li><li>  <a href="https://habr.com/post/425953/">Part 3. Central unit, software</a> </li><li>  <a href="https://habr.com/post/425963/">Part 4. Transom Sensor</a> </li><li>  <a href="https://habr.com/post/426019/">Part 5. MySQL, PHP, WWW, Android</a> </li></ul><br><h1 id="zaokonnyy-datchik-zhelezo">  Window sensor.  Iron </h1><br><p>  We must immediately recognize that the first version of the remote (remote) sensor turned out to be not entirely successful in terms of power supply and power consumption.  As I already wrote, I only had the Arduino Pro Mini 5V module on hand. And I used Ni-MH batteries. </p><br><p>  Given that I also connected the solar battery, the whole design worked autonomously for about 25 days.  The battery capacity was very negatively influenced by low, often negative temperatures on the street at the end of winter. </p><br><p>  To make everything work for you much longer, make the following replacements: </p><br><ul><li>  Buy a 3.3V Arduino Pro Mini </li><li>  Use a Li-ion battery type Panasonic NCR18650A 3.7 V, 2 pcs.  for about $ 14 at 3100mAh.  You can try CR123, CR123A batteries.  And remember that a 9V battery (such as "Kron") is a bad power source. </li></ul><a name="habracut"></a><br><p>  The main thing to remember is that your batteries will work on the street, i.e.  at negative temperatures, which slow down the chemical processes occurring inside them and, thereby, greatly reduce their capacity. </p><br><p>  The DHT22 sensor can work from 3.3 V, so it's all the way through. </p><br><p>  The above permutations will not entail rework or replacement of other components. </p><br><h1 id="pitanie">  Nutrition </h1><br><p>  I initially used 4 pcs.  Ni-MH battery connected in series with the removal of the third, so it turned out two supply voltage: 4.8 V for the DHT22 sensor and 3.6 V for everything else.  I did not use lowering (or more precisely energy-destroying) or step-up electronic circuits, only environmentally friendly voltage and current. </p><br><p><img src="https://habrastorage.org/webt/fu/y2/ug/fuy2ugymimv6bobt_raozj4phso.png" alt="Nutrition"></p><br><p>  The solar panel is connected as shown.  Solar panel 1.6W 5.5V 266mA was bought for $ 6.64. </p><br><p>  The circuit uses a Schottky diode of type 1N914 and an electrolytic capacitor of 50-100 ŒºF. </p><br><p><img src="https://habrastorage.org/webt/cb/tz/3f/cbtz3fcowam0ednzs-hrtvcgx0y.jpeg"></p><br><h1 id="raspinovka--i-soedinenie">  Pinout and connection </h1><br><p>  We proceed to the assembly. </p><br><h2 id="datchik-temperatury-i-vlazhnosti-dht22">  Temperature and humidity sensor DHT22 </h2><br><p><img src="https://habrastorage.org/webt/lc/es/rh/lcesrhbcvwc62oyouhfplszy4mg.jpeg" alt="DHT22"></p><br><p>  Pinout for connecting temperature and humidity sensor DHT22: </p><br><table><thead><tr><th>  DHT22 front side from left to right </th><th>  Arduino Pro Mini </th><th>  Note </th></tr></thead><tbody><tr><td>  VCC </td><td>  3.3 - 5V </td><td>  5V recommended, better external power </td></tr><tr><td>  SDA </td><td>  D2 </td><td> In the sketch it is <code>DHTPIN</code> </td></tr><tr><td>  NC </td><td>  Not connected </td></tr><tr><td>  GND </td><td>  GND </td></tr></tbody></table><br><p>  Optionally, you can connect (pull) SDA through a 10K resistor to VCC. </p><br><p>  Initialization: </p><br><pre> <code class="hljs cpp"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DHTPIN 2 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//   D2 DHT dht(DHTPIN, DHTTYPE);</span></span></span></span></code> </pre> <br><p>  To protect the sensor from direct sunlight, I made a casing for it from a tin can, pasted on top with reflective metallic tape. </p><br><h2 id="nrf24l01">  nRF24L01 + </h2><br><p><img src="https://habrastorage.org/webt/s6/ec/cd/s6eccdukpd6vmu3p1jxvfbswufu.png" alt="nRF24L01 +"></p><br><p>  Pinout of the nRF24L01 + radio module (look at the top of the board where the chip is, with the pin pins at the bottom): </p><br><table><thead><tr><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td>  (2) 3.3V </td><td>  (4) CSN </td><td>  (6) MOSI </td><td>  (8) IRQ </td></tr><tr><td>  (1) GND </td><td>  (3) CE </td><td>  (5) SCK </td><td>  (7) MISO </td></tr></tbody></table><br><p>  Connection nRF24L01 + </p><br><table><thead><tr><th>  Arduino Pro Mini </th><th>  nRF24L01 + </th><th>  Note </th></tr></thead><tbody><tr><td>  3.3V </td><td>  VCC (2) </td><td>  Better external power </td></tr><tr><td>  pin D8 </td><td>  CE (3) </td><td>  chip enable in </td></tr><tr><td>  SS pin D10 </td><td>  CSN (4) </td><td>  chip select in </td></tr><tr><td>  SCK pin D13 </td><td>  SCK (5) </td><td>  SPI clock in </td></tr><tr><td>  MOSI pin D11 </td><td>  SDI (6) </td><td>  SPI Data in </td></tr><tr><td>  MISO pin D12 </td><td>  SDO (7) </td><td>  SPI data out </td></tr><tr><td>  IRQ 8 </td><td>  Interrupt output, not connected </td></tr><tr><td>  GND </td><td>  GND (1) </td></tr></tbody></table><br><p>  Initialization: </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-function">NRF24 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nrf24</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">8</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br><p>  As advised on the forums, the nRF24L01 + power supply terminals immediately soldered a small capacitance electrolytic capacitor (10¬µF). </p><br><p>  I have a radio module with an external additional antenna; it ‚Äúbreaks through‚Äù two walls reliably. </p><br><h1 id="voltmetr">  Voltmeter </h1><br><p>  The window sensor has a voltmeter to measure the battery supply voltage.  The measurement technology is described by Scott Daniels "Secret Arduino Voltmeter - Measure Battery Voltage", 2012. </p><br><p>  Data is read from analog pin A1. </p><br><p><img src="https://habrastorage.org/webt/j_/z1/-x/j_z1-xvapjojymqhqvnu8xsyvkm.png"></p><br><p>  I have voltage divider resistors for 100 KŒ© and 10 KŒ© (you may have slightly different ratings, you must <strong>accurately</strong> measure them with an ohm meter). </p><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> r1 = <span class="hljs-number"><span class="hljs-number">100400</span></span>; <span class="hljs-comment"><span class="hljs-comment">// 100KOm const float r2 = 9960; // 10KOm</span></span></code> </pre> <br><p>  The following constant must be calibrated individually as described by Scott Daniels.  Using a separate <a href="https://github.com/tim4dev/arduino/tree/master/sensor-test/true_voltmeter">scheme and sketch</a> . </p><br><p>  We measure two Vcc values: real Vcc with a voltmeter (on an AREF pin or 5V) and Vcc with our function.  Then replace the constant ( <code>1.1 * 1023.0 * 1000</code> ) with a new one: </p><br><pre> <code class="hljs pgsql">scale_constant = internal1<span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-keyword"><span class="hljs-keyword">Ref</span></span> * <span class="hljs-number"><span class="hljs-number">1023</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span></code> </pre> <br><p>  where <code>internal1.1Ref = 1.1 * Vcc1 ( ) / Vcc2 (  )</code> </p><br><p>  Where </p><br><ul><li>  Vcc1 - Vcc value measured manually with a voltmeter </li><li>  Vcc2 - Vcc value defined by our function </li></ul><br><p>  This reference value will be individual for a <em>particular</em> AVR chip and will depend on temperature fluctuations. </p><br><p>  As a result, I got the following value: </p><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> typVbg = <span class="hljs-number"><span class="hljs-number">1.082</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    1.0 ‚Äî 1.2 </span></span></code> </pre> <br><p>  As our rechargeable battery discharges in the dark and recharges from a solar battery, the voltage chart will look like a sawtooth, ‚Äúsagging‚Äù on cloudy days: </p><br><p><img src="https://habrastorage.org/webt/fb/ne/sg/fbnesguoqhfpwcgfa--lcrtpf4m.png" alt="Schedule"></p><br><p>  The graph is real, taken from the web of the project. </p><br><h1 id="sborka">  Assembly </h1><br><p>  To assemble the unit as a whole, I again used a prototype soldering board. <br>  Payal, connected on a whim, without prior wiring, so I have no scheme. </p><br><p>  That's what happened. </p><br><p><img src="https://habrastorage.org/webt/v0/jp/wd/v0jpwdvxp-ydqtqo99byjnpk3k0.jpeg" alt="Assembly"></p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/425963/">https://habr.com/ru/post/425963/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../425953/index.html">Weather Station on Arduino from A to Z. Part 3</a></li>
<li><a href="../425955/index.html">8 interesting beta bugs iOS 12 and how we searched for them</a></li>
<li><a href="../425957/index.html">Petrol bikes or weird product search (e-commerce)</a></li>
<li><a href="../425959/index.html">A few tips on Angular</a></li>
<li><a href="../425961/index.html">‚ÄúLearning to Spring is a pointless exercise‚Äù - Josh Long, the main evangelist of Spring about the project‚Äôs internal kitchen</a></li>
<li><a href="../425965/index.html">SAP Data Management Suite as a complex for working with Big Data in companies</a></li>
<li><a href="../425967/index.html">Silicon Chainsaw Massacre</a></li>
<li><a href="../425969/index.html">How will I become a web developer ... and will I?</a></li>
<li><a href="../425971/index.html">There is evidence of the presence of spy chips in the servers Supermicro</a></li>
<li><a href="../425973/index.html">How we built the S3 DataLine repository. Experiments, testing and a little about hippos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>