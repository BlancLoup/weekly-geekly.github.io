<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple checksum calculation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When data is transmitted over communication lines, a checksum is used , calculated according to some algorithm. The algorithm is often complex, of cou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple checksum calculation</h1><div class="post__text post__text-html js-mediator-article">  When data is transmitted over communication lines, a <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25BD%25D1%2582%25D1%2580%25D0%25BE%25D0%25BB%25D1%258C%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2581%25D1%2583%25D0%25BC%25D0%25BC%25D0%25B0">checksum is used</a> , calculated according to some algorithm.  The algorithm is often complex, of course, it is mathematically justified, but it is very inconvenient when there is a shortage of resources, for example, when programming microcontrollers. <br><br><img src="https://habrastorage.org/files/d3a/1d1/6d6/d3a1d16d6a6b4be1a57030f6a24e3015.jpg"><br><br>  To simplify the algorithm, without losing quality, you need a bit of ‚Äúbit magic,‚Äù which is an interesting topic in itself. <br><a name="habracut"></a><br>  Without a checksum, it is dangerous to transmit data, since interference is present everywhere and always, the whole question is only in their probability of occurrence and the side effects caused by them.  Depending on the conditions, the algorithm of error detection and the amount of data in the checksum are chosen.  The algorithm is more complicated, and the checksum is larger, less errors are not recognized. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/c77/9d4/980/c779d4980c844a9ab2cc4633e42020e1.jpg"><br><br>  The cause of interference at the physical level, during data transmission. <br><br><img src="https://habrastorage.org/files/05e/ed3/abc/05eed3abc29446129220d51302d4909b.gif"><br><br>  <a href="http://www.cyberforum.ru/asutp/thread519341.html">Here is</a> an example of the most typical algorithm for a microcontroller, which has actually become an industry standard since 1979. <br><br><div class="spoiler">  <b class="spoiler_title">Checksum calculation for Modbus protocol</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">crc_calculating</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> puchMsg, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> usDataLen)</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">/*##  ##*/</span></span></span><span class="hljs-function"> </span></span>{ { <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> uchCRCHi = <span class="hljs-number"><span class="hljs-number">0xFF</span></span> ; <span class="hljs-comment"><span class="hljs-comment">/*    CRC */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> uchCRCLo = <span class="hljs-number"><span class="hljs-number">0xFF</span></span> ; <span class="hljs-comment"><span class="hljs-comment">/*    CRC */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> uIndex ; <span class="hljs-comment"><span class="hljs-comment">/* will index into CRC lookup table */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (usDataLen--) <span class="hljs-comment"><span class="hljs-comment">/* pass through message buffer */</span></span> { uIndex = uchCRCHi ^ *puchMsg++ ; <span class="hljs-comment"><span class="hljs-comment">/*  CRC */</span></span> uchCRCLo = uchCRCLo ^ auchCRCHi[uIndex] ; uchCRCHi = auchCRCLo[uIndex] ; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (uchCRCHi &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span> | uchCRCLo) ; <span class="hljs-comment"><span class="hljs-comment">/* Table of CRC values for high‚Äìorder byte */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> auchCRCHi[] = { <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span> }; <span class="hljs-comment"><span class="hljs-comment">/* Table of CRC values for low‚Äìorder byte */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> auchCRCLo[] = { <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC3</span></span>, <span class="hljs-number"><span class="hljs-number">0x03</span></span>, <span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">0xC2</span></span>, <span class="hljs-number"><span class="hljs-number">0xC6</span></span>, <span class="hljs-number"><span class="hljs-number">0x06</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xC7</span></span>, <span class="hljs-number"><span class="hljs-number">0x05</span></span>, <span class="hljs-number"><span class="hljs-number">0xC5</span></span>, <span class="hljs-number"><span class="hljs-number">0xC4</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0xCC</span></span>, <span class="hljs-number"><span class="hljs-number">0x0C</span></span>, <span class="hljs-number"><span class="hljs-number">0x0D</span></span>, <span class="hljs-number"><span class="hljs-number">0xCD</span></span>, <span class="hljs-number"><span class="hljs-number">0x0F</span></span>, <span class="hljs-number"><span class="hljs-number">0xCF</span></span>, <span class="hljs-number"><span class="hljs-number">0xCE</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, <span class="hljs-number"><span class="hljs-number">0xCA</span></span>, <span class="hljs-number"><span class="hljs-number">0xCB</span></span>, <span class="hljs-number"><span class="hljs-number">0x0B</span></span>, <span class="hljs-number"><span class="hljs-number">0xC9</span></span>, <span class="hljs-number"><span class="hljs-number">0x09</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0xC8</span></span>, <span class="hljs-number"><span class="hljs-number">0xD8</span></span>, <span class="hljs-number"><span class="hljs-number">0x18</span></span>, <span class="hljs-number"><span class="hljs-number">0x19</span></span>, <span class="hljs-number"><span class="hljs-number">0xD9</span></span>, <span class="hljs-number"><span class="hljs-number">0x1B</span></span>, <span class="hljs-number"><span class="hljs-number">0xDB</span></span>, <span class="hljs-number"><span class="hljs-number">0xDA</span></span>, <span class="hljs-number"><span class="hljs-number">0x1A</span></span>, <span class="hljs-number"><span class="hljs-number">0x1E</span></span>, <span class="hljs-number"><span class="hljs-number">0xDE</span></span>, <span class="hljs-number"><span class="hljs-number">0xDF</span></span>, <span class="hljs-number"><span class="hljs-number">0x1F</span></span>, <span class="hljs-number"><span class="hljs-number">0xDD</span></span>, <span class="hljs-number"><span class="hljs-number">0x1D</span></span>, <span class="hljs-number"><span class="hljs-number">0x1C</span></span>, <span class="hljs-number"><span class="hljs-number">0xDC</span></span>, <span class="hljs-number"><span class="hljs-number">0x14</span></span>, <span class="hljs-number"><span class="hljs-number">0xD4</span></span>, <span class="hljs-number"><span class="hljs-number">0xD5</span></span>, <span class="hljs-number"><span class="hljs-number">0x15</span></span>, <span class="hljs-number"><span class="hljs-number">0xD7</span></span>, <span class="hljs-number"><span class="hljs-number">0x17</span></span>, <span class="hljs-number"><span class="hljs-number">0x16</span></span>, <span class="hljs-number"><span class="hljs-number">0xD6</span></span>, <span class="hljs-number"><span class="hljs-number">0xD2</span></span>, <span class="hljs-number"><span class="hljs-number">0x12</span></span>, <span class="hljs-number"><span class="hljs-number">0x13</span></span>, <span class="hljs-number"><span class="hljs-number">0xD3</span></span>, <span class="hljs-number"><span class="hljs-number">0x11</span></span>, <span class="hljs-number"><span class="hljs-number">0xD1</span></span>, <span class="hljs-number"><span class="hljs-number">0xD0</span></span>, <span class="hljs-number"><span class="hljs-number">0x10</span></span>, <span class="hljs-number"><span class="hljs-number">0xF0</span></span>, <span class="hljs-number"><span class="hljs-number">0x30</span></span>, <span class="hljs-number"><span class="hljs-number">0x31</span></span>, <span class="hljs-number"><span class="hljs-number">0xF1</span></span>, <span class="hljs-number"><span class="hljs-number">0x33</span></span>, <span class="hljs-number"><span class="hljs-number">0xF3</span></span>, <span class="hljs-number"><span class="hljs-number">0xF2</span></span>, <span class="hljs-number"><span class="hljs-number">0x32</span></span>, <span class="hljs-number"><span class="hljs-number">0x36</span></span>, <span class="hljs-number"><span class="hljs-number">0xF6</span></span>, <span class="hljs-number"><span class="hljs-number">0xF7</span></span>, <span class="hljs-number"><span class="hljs-number">0x37</span></span>, <span class="hljs-number"><span class="hljs-number">0xF5</span></span>, <span class="hljs-number"><span class="hljs-number">0x35</span></span>, <span class="hljs-number"><span class="hljs-number">0x34</span></span>, <span class="hljs-number"><span class="hljs-number">0xF4</span></span>, <span class="hljs-number"><span class="hljs-number">0x3C</span></span>, <span class="hljs-number"><span class="hljs-number">0xFC</span></span>, <span class="hljs-number"><span class="hljs-number">0xFD</span></span>, <span class="hljs-number"><span class="hljs-number">0x3D</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x3F</span></span>, <span class="hljs-number"><span class="hljs-number">0x3E</span></span>, <span class="hljs-number"><span class="hljs-number">0xFE</span></span>, <span class="hljs-number"><span class="hljs-number">0xFA</span></span>, <span class="hljs-number"><span class="hljs-number">0x3A</span></span>, <span class="hljs-number"><span class="hljs-number">0x3B</span></span>, <span class="hljs-number"><span class="hljs-number">0xFB</span></span>, <span class="hljs-number"><span class="hljs-number">0x39</span></span>, <span class="hljs-number"><span class="hljs-number">0xF9</span></span>, <span class="hljs-number"><span class="hljs-number">0xF8</span></span>, <span class="hljs-number"><span class="hljs-number">0x38</span></span>, <span class="hljs-number"><span class="hljs-number">0x28</span></span>, <span class="hljs-number"><span class="hljs-number">0xE8</span></span>, <span class="hljs-number"><span class="hljs-number">0xE9</span></span>, <span class="hljs-number"><span class="hljs-number">0x29</span></span>, <span class="hljs-number"><span class="hljs-number">0xEB</span></span>, <span class="hljs-number"><span class="hljs-number">0x2B</span></span>, <span class="hljs-number"><span class="hljs-number">0x2A</span></span>, <span class="hljs-number"><span class="hljs-number">0xEA</span></span>, <span class="hljs-number"><span class="hljs-number">0xEE</span></span>, <span class="hljs-number"><span class="hljs-number">0x2E</span></span>, <span class="hljs-number"><span class="hljs-number">0x2F</span></span>, <span class="hljs-number"><span class="hljs-number">0xEF</span></span>, <span class="hljs-number"><span class="hljs-number">0x2D</span></span>, <span class="hljs-number"><span class="hljs-number">0xED</span></span>, <span class="hljs-number"><span class="hljs-number">0xEC</span></span>, <span class="hljs-number"><span class="hljs-number">0x2C</span></span>, <span class="hljs-number"><span class="hljs-number">0xE4</span></span>, <span class="hljs-number"><span class="hljs-number">0x24</span></span>, <span class="hljs-number"><span class="hljs-number">0x25</span></span>, <span class="hljs-number"><span class="hljs-number">0xE5</span></span>, <span class="hljs-number"><span class="hljs-number">0x27</span></span>, <span class="hljs-number"><span class="hljs-number">0xE7</span></span>, <span class="hljs-number"><span class="hljs-number">0xE6</span></span>, <span class="hljs-number"><span class="hljs-number">0x26</span></span>, <span class="hljs-number"><span class="hljs-number">0x22</span></span>, <span class="hljs-number"><span class="hljs-number">0xE2</span></span>, <span class="hljs-number"><span class="hljs-number">0xE3</span></span>, <span class="hljs-number"><span class="hljs-number">0x23</span></span>, <span class="hljs-number"><span class="hljs-number">0xE1</span></span>, <span class="hljs-number"><span class="hljs-number">0x21</span></span>, <span class="hljs-number"><span class="hljs-number">0x20</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0xA0</span></span>, <span class="hljs-number"><span class="hljs-number">0x60</span></span>, <span class="hljs-number"><span class="hljs-number">0x61</span></span>, <span class="hljs-number"><span class="hljs-number">0xA1</span></span>, <span class="hljs-number"><span class="hljs-number">0x63</span></span>, <span class="hljs-number"><span class="hljs-number">0xA3</span></span>, <span class="hljs-number"><span class="hljs-number">0xA2</span></span>, <span class="hljs-number"><span class="hljs-number">0x62</span></span>, <span class="hljs-number"><span class="hljs-number">0x66</span></span>, <span class="hljs-number"><span class="hljs-number">0xA6</span></span>, <span class="hljs-number"><span class="hljs-number">0xA7</span></span>, <span class="hljs-number"><span class="hljs-number">0x67</span></span>, <span class="hljs-number"><span class="hljs-number">0xA5</span></span>, <span class="hljs-number"><span class="hljs-number">0x65</span></span>, <span class="hljs-number"><span class="hljs-number">0x64</span></span>, <span class="hljs-number"><span class="hljs-number">0xA4</span></span>, <span class="hljs-number"><span class="hljs-number">0x6C</span></span>, <span class="hljs-number"><span class="hljs-number">0xAC</span></span>, <span class="hljs-number"><span class="hljs-number">0xAD</span></span>, <span class="hljs-number"><span class="hljs-number">0x6D</span></span>, <span class="hljs-number"><span class="hljs-number">0xAF</span></span>, <span class="hljs-number"><span class="hljs-number">0x6F</span></span>, <span class="hljs-number"><span class="hljs-number">0x6E</span></span>, <span class="hljs-number"><span class="hljs-number">0xAE</span></span>, <span class="hljs-number"><span class="hljs-number">0xAA</span></span>, <span class="hljs-number"><span class="hljs-number">0x6A</span></span>, <span class="hljs-number"><span class="hljs-number">0x6B</span></span>, <span class="hljs-number"><span class="hljs-number">0xAB</span></span>, <span class="hljs-number"><span class="hljs-number">0x69</span></span>, <span class="hljs-number"><span class="hljs-number">0xA9</span></span>, <span class="hljs-number"><span class="hljs-number">0xA8</span></span>, <span class="hljs-number"><span class="hljs-number">0x68</span></span>, <span class="hljs-number"><span class="hljs-number">0x78</span></span>, <span class="hljs-number"><span class="hljs-number">0xB8</span></span>, <span class="hljs-number"><span class="hljs-number">0xB9</span></span>, <span class="hljs-number"><span class="hljs-number">0x79</span></span>, <span class="hljs-number"><span class="hljs-number">0xBB</span></span>, <span class="hljs-number"><span class="hljs-number">0x7B</span></span>, <span class="hljs-number"><span class="hljs-number">0x7A</span></span>, <span class="hljs-number"><span class="hljs-number">0xBA</span></span>, <span class="hljs-number"><span class="hljs-number">0xBE</span></span>, <span class="hljs-number"><span class="hljs-number">0x7E</span></span>, <span class="hljs-number"><span class="hljs-number">0x7F</span></span>, <span class="hljs-number"><span class="hljs-number">0xBF</span></span>, <span class="hljs-number"><span class="hljs-number">0x7D</span></span>, <span class="hljs-number"><span class="hljs-number">0xBD</span></span>, <span class="hljs-number"><span class="hljs-number">0xBC</span></span>, <span class="hljs-number"><span class="hljs-number">0x7C</span></span>, <span class="hljs-number"><span class="hljs-number">0xB4</span></span>, <span class="hljs-number"><span class="hljs-number">0x74</span></span>, <span class="hljs-number"><span class="hljs-number">0x75</span></span>, <span class="hljs-number"><span class="hljs-number">0xB5</span></span>, <span class="hljs-number"><span class="hljs-number">0x77</span></span>, <span class="hljs-number"><span class="hljs-number">0xB7</span></span>, <span class="hljs-number"><span class="hljs-number">0xB6</span></span>, <span class="hljs-number"><span class="hljs-number">0x76</span></span>, <span class="hljs-number"><span class="hljs-number">0x72</span></span>, <span class="hljs-number"><span class="hljs-number">0xB2</span></span>, <span class="hljs-number"><span class="hljs-number">0xB3</span></span>, <span class="hljs-number"><span class="hljs-number">0x73</span></span>, <span class="hljs-number"><span class="hljs-number">0xB1</span></span>, <span class="hljs-number"><span class="hljs-number">0x71</span></span>, <span class="hljs-number"><span class="hljs-number">0x70</span></span>, <span class="hljs-number"><span class="hljs-number">0xB0</span></span>, <span class="hljs-number"><span class="hljs-number">0x50</span></span>, <span class="hljs-number"><span class="hljs-number">0x90</span></span>, <span class="hljs-number"><span class="hljs-number">0x91</span></span>, <span class="hljs-number"><span class="hljs-number">0x51</span></span>, <span class="hljs-number"><span class="hljs-number">0x93</span></span>, <span class="hljs-number"><span class="hljs-number">0x53</span></span>, <span class="hljs-number"><span class="hljs-number">0x52</span></span>, <span class="hljs-number"><span class="hljs-number">0x92</span></span>, <span class="hljs-number"><span class="hljs-number">0x96</span></span>, <span class="hljs-number"><span class="hljs-number">0x56</span></span>, <span class="hljs-number"><span class="hljs-number">0x57</span></span>, <span class="hljs-number"><span class="hljs-number">0x97</span></span>, <span class="hljs-number"><span class="hljs-number">0x55</span></span>, <span class="hljs-number"><span class="hljs-number">0x95</span></span>, <span class="hljs-number"><span class="hljs-number">0x94</span></span>, <span class="hljs-number"><span class="hljs-number">0x54</span></span>, <span class="hljs-number"><span class="hljs-number">0x9C</span></span>, <span class="hljs-number"><span class="hljs-number">0x5C</span></span>, <span class="hljs-number"><span class="hljs-number">0x5D</span></span>, <span class="hljs-number"><span class="hljs-number">0x9D</span></span>, <span class="hljs-number"><span class="hljs-number">0x5F</span></span>, <span class="hljs-number"><span class="hljs-number">0x9F</span></span>, <span class="hljs-number"><span class="hljs-number">0x9E</span></span>, <span class="hljs-number"><span class="hljs-number">0x5E</span></span>, <span class="hljs-number"><span class="hljs-number">0x5A</span></span>, <span class="hljs-number"><span class="hljs-number">0x9A</span></span>, <span class="hljs-number"><span class="hljs-number">0x9B</span></span>, <span class="hljs-number"><span class="hljs-number">0x5B</span></span>, <span class="hljs-number"><span class="hljs-number">0x99</span></span>, <span class="hljs-number"><span class="hljs-number">0x59</span></span>, <span class="hljs-number"><span class="hljs-number">0x58</span></span>, <span class="hljs-number"><span class="hljs-number">0x98</span></span>, <span class="hljs-number"><span class="hljs-number">0x88</span></span>, <span class="hljs-number"><span class="hljs-number">0x48</span></span>, <span class="hljs-number"><span class="hljs-number">0x49</span></span>, <span class="hljs-number"><span class="hljs-number">0x89</span></span>, <span class="hljs-number"><span class="hljs-number">0x4B</span></span>, <span class="hljs-number"><span class="hljs-number">0x8B</span></span>, <span class="hljs-number"><span class="hljs-number">0x8A</span></span>, <span class="hljs-number"><span class="hljs-number">0x4A</span></span>, <span class="hljs-number"><span class="hljs-number">0x4E</span></span>, <span class="hljs-number"><span class="hljs-number">0x8E</span></span>, <span class="hljs-number"><span class="hljs-number">0x8F</span></span>, <span class="hljs-number"><span class="hljs-number">0x4F</span></span>, <span class="hljs-number"><span class="hljs-number">0x8D</span></span>, <span class="hljs-number"><span class="hljs-number">0x4D</span></span>, <span class="hljs-number"><span class="hljs-number">0x4C</span></span>, <span class="hljs-number"><span class="hljs-number">0x8C</span></span>, <span class="hljs-number"><span class="hljs-number">0x44</span></span>, <span class="hljs-number"><span class="hljs-number">0x84</span></span>, <span class="hljs-number"><span class="hljs-number">0x85</span></span>, <span class="hljs-number"><span class="hljs-number">0x45</span></span>, <span class="hljs-number"><span class="hljs-number">0x87</span></span>, <span class="hljs-number"><span class="hljs-number">0x47</span></span>, <span class="hljs-number"><span class="hljs-number">0x46</span></span>, <span class="hljs-number"><span class="hljs-number">0x86</span></span>, <span class="hljs-number"><span class="hljs-number">0x82</span></span>, <span class="hljs-number"><span class="hljs-number">0x42</span></span>, <span class="hljs-number"><span class="hljs-number">0x43</span></span>, <span class="hljs-number"><span class="hljs-number">0x83</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span> }; } }</code> </pre> <br></div></div><br>  Such code is not weak, there is an <a href="http://www.microchip.su/showthread.php%3Ft%3D6659">option without a table</a> , but slower (bit-by-bit data processing is necessary), in any case able to take out the brain to both the programmer and the microcontroller.  Not in any microcontroller the algorithm with the table will get at all. <br><br>  Let's analyze the algorithms that generally can confirm the integrity of the data with a low price. <br><br><h4>  Parity bit (1-bit checksum) </h4><br>  In the first place is a simple parity bit.  If necessary, the hardware is formed, the principle is the simplest, and is <a href="https://ru.wikipedia.org/wiki/%25D0%2591%25D0%25B8%25D1%2582_%25D1%2587%25D1%2591%25D1%2582%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D0%25B8">described in detail in Wikipedia</a> .  There is only one drawback, it skips double errors (and even an even number of errors), when the parity of all bits does not change.  It can be used to collect statistics on the presence of errors in the stream of transmitted data, but data integrity does not guarantee, although it reduces the likelihood of a missed error by 50% (depends, of course, on the type of interference on the line, in this case it is assumed that the number of even and odd failures is equal to ). <br>  To enable the parity bit, often no code is needed, just indicate that the UART should use the parity bit.  Typically, simply specify: <br><br><div class="spoiler">  <b class="spoiler_title">enable parity bit on microcontroller</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ Serial.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>,SERIAL_8N1); <span class="hljs-comment"><span class="hljs-comment">//  ,   ; Serial1.begin(38400,SERIAL_8E1); //    Serial.println("Hello Computer"); Serial1.println("Hello Serial 1"); }</span></span></code> </pre><br></div></div><br>  Often, developers even forget that the UART has the ability to check bit parity on board.  In addition to the integrity of the transmitted data, this allows you to avoid a steady breakdown of synchronization (for example, when transmitting data over the air), when the payload can randomly simulate start and stop bits, and instead of data at the output of the buffer, start and stop bits in random order. <br><br><h4>  8-bit checksum </h4><br>  If the parity is small (and this is usually small), an additional checksum is added.  Calculate the checksum, you can as the amount of previously transferred bytes, simply and logically <br><br><img src="http://tex.s2cms.ru/svg/CRC%3Dbyte(1)%20%2B%20byte(2)%20%2B%20byte(3)%2B%20...%20%2B%20byte(N)" alt="image"><br><br>  Naturally, the overflow bits are not taken into account, the result is placed in the 8 bits allocated for the checksum.  You can skip the error if, in the event of an accidental failure, one byte is increased by some value, and the other byte is reduced by the same value.  Checksum does not change.  Let's conduct an experiment on data transfer.  Baseline data are as follows: <br><br><ol><li>  The data block is 8 bytes. </li><li>  Random ($ FF + 1) pseudo-random data population </li><li>  Randomly change 1 bit in a data block with an XOR operation with a specially prepared byte, which has one single bit at a random position. </li><li>  We repeat the previous paragraph 10 times, this can result in 0 to 10 bad bits (2 errors can be superimposed on each other when restoring data), we ignore the option with 0 bad bits in the future as useless for us. </li></ol><br>  We transmit a virtual telegram N times.  The ideal checksum will reveal an error in the amount of information available to it about the message, more information, a higher probability of detecting a faulty telegram.  Probability of missing an error for 1 bit of checksum: <br><br><img src="http://tex.s2cms.ru/svg/P%3D1%2F(2%5E1)%3D0.5" alt="image">  . <br><br>  For 8 bits: <br><br><img src="https://tex.s2cms.ru/svg/P%3D1%2F(2%5E8)%3D1%3A256" alt="image">  , <br><br>  for 256 sent telegrams with an error, one will pass the checksum check.  We look at the statistics from virtual data transfer using a simple test program: <br><br><div class="spoiler">  <b class="spoiler_title">Statistics</b> <div class="spoiler_text">  1: 144 (here and below - the probability of passing an error) <br>  1: 143 <br>  1: 144 <br>  1: 145 <br>  1: 144 <br>  1: 142 <br>  1: 143 <br>  1: 143 <br>  1: 142 <br>  1: 140 <br>  Total number of errors 69892 from 10 million iterations, or 1: 143.078 </div></div><br><br>  Or conditional efficiency = 55% of the capabilities of the ‚Äúideal‚Äù checksum.  Such is the fee for the simplicity of the algorithm and the speed of data processing.  In general, for many applications, the algorithm is operational.  One addition operation and one 8-bit variable are used.  There is no possibility of incorrect implementation.  Therefore, the algorithm <a href="http://www.bookasutp.ru/Chapter2_10.aspx">is used in the</a> ADAMS, ICP <a href="http://www.bookasutp.ru/Chapter2_10.aspx">controllers</a> as part of the DCON protocol (the parity bit can be included there, the ASCI characters only, which also contributes to improving the reliability of data transmission and the resulting reliability is somewhat higher, as part of the errors are detected by other, additional features not related to checksum). <br><br>  Despite the probability of passing an error of 1: 143, the probability of finding an error better than 1: 256 is impossible theoretically.  There are losses in the quality of work, but this is not always significant.  If you need higher reliability, you need to use a checksum with a large number of bits.  Or, in other words, a simple checksum does not efficiently use about 0.75 bits out of 8 available bits of information in the checksum. <br><br>  For comparison, instead of the sum, bitwise XOR is added.  It became significantly worse, the probability of detecting an error was 1:67 or 26% of the theoretical limit.  Simplified, this can be explained by the fact that XOR changes even fewer bits in the checksum when an error occurs, lower the response to a single bit failure, and a repeated error is more likely to return the checksum to its original state. <br><br>  It can also be argued that the checksum for XOR is 8 independent checksums of 1 bit.  The probability that an error will occur in one of 8 bits is 1: 8, the probability of double failure 1:64, which we observe, the theoretical value coincided with experimental data. <br><br>  We need such an algorithm to replace with the single error the maximum number of bits in the checksum.  But we are, in total, limited by the complexity of the algorithm, and the resources at our disposal.  Not all microcontrollers have a hardware CRC calculation unit.  But, almost everywhere, there is a multiplication unit.  Calculate the checksum as the product of a sequence of bytes, on some "magic" constant: <br><br><pre> <code class="cs hljs">CRC=CRC + <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>*<span class="hljs-number"><span class="hljs-number">211</span></span></code> </pre><br>  The constant should be simple, and be large enough to change a larger number of bits after each operation, 211 is quite suitable, we check: <br><br><div class="spoiler">  <b class="spoiler_title">Statistics</b> <div class="spoiler_text">  1: 185 <br>  1: 186 <br>  1: 185 <br>  1: 185 <br>  1: 193 <br>  1: 188 <br>  1: 187 <br>  1: 194 <br>  1: 190 <br>  1: 200 <br></div></div><br>  Only 72% of the theoretical limit, a slight improvement over the simple amount.  The algorithm in this form does not make sense.  In this case, important information from the discarded high bits of 8..16 is lost, and they must be taken into account.  The easiest way is to mix the XOR function with the lower bits 1..8.  We come to an even more intensive modification of the checksum, preferably with minimal resources.  Add focus <a href="https://ru.wikipedia.org/wiki/Raiden_%2528%25D0%25B0%25D0%25BB%25D0%25B3%25D0%25BE%25D1%2580%25D0%25B8%25D1%2582%25D0%25BC%2529">from cryptographic algorithms</a> <br><br><pre> <code class="delphi hljs">CRC=CRC + byte*<span class="hljs-number"><span class="hljs-number">211</span></span> CRC= CRC XOR (CRC <span class="hljs-keyword"><span class="hljs-keyword">SHR</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>); <span class="hljs-comment"><span class="hljs-comment">// "" ,     CRC=CRC AND $FF; //     8,   16 </span></span></code> </pre><br><ul><li>  The intermediate CRC for the first action is 16-bit (after calculations it is cut to 8 bits) and in the future we work as with 8-bit, if we have an 8-bit microcontroller, this will speed up data processing. </li><li>  We return the high bits and mix with the low bits. </li></ul><br>  Checking: <br><br><div class="spoiler">  <b class="spoiler_title">Statistics</b> <div class="spoiler_text">  1: 237 <br>  1: 234 <br>  1: 241 <br>  1: 234 <br>  1: 227 <br>  1: 238 <br>  1: 235 <br>  1: 233 <br>  1: 231 <br>  1: 236 <br></div></div><br>  The result is 91% of the theoretical limit.  It is quite suitable for use. <br><br>  If there is no multiplication unit in the microcontroller, you can simulate the multiplication of the operations of addition, offset and XOR.  The essence of the process is the same, modified by an error bit, evenly ‚Äúdistributed‚Äù over the remaining bits of the checksum. <br><br><pre> <code class="delphi hljs">CRC := (CRC <span class="hljs-keyword"><span class="hljs-keyword">shl</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) + byte; CRC := (CRC <span class="hljs-keyword"><span class="hljs-keyword">shl</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) + byte; CRC:=(CRC XOR (CRC <span class="hljs-keyword"><span class="hljs-keyword">SHR</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>)) ; <span class="hljs-comment"><span class="hljs-comment">//     </span></span></code> </pre><br>  Result: <br><br><div class="spoiler">  <b class="spoiler_title">Statistics</b> <div class="spoiler_text">  1: 255 <br>  1: 257 <br>  1: 255 <br>  1: 255 <br>  1: 254 <br>  1: 255 <br>  1: 250 <br>  1: 254 <br>  1: 256 <br>  1: 254 <br></div></div><br>  Surprisingly good result.  The average value is 254.5 or 99% of the theoretical limit, operations are slightly more, but they are all simple and no multiplication is used. <br><br>  If for internal storage of intermediate checksum values ‚Äã‚Äãwe give 16 bits to the variable (but only the lower 8 bits are transmitted via the communication line), which is not a problem even for the weakest microcontroller, we will get some improvement in the operation of the algorithm.  In general, saving 8 bits does not make much sense, and the 8-bit intermediate variable was previously used simply to simplify the understanding of the algorithm. <br><br><div class="spoiler">  <b class="spoiler_title">Statistics</b> <div class="spoiler_text">  1: 260 <br>  1: 250 <br>  1: 252 <br>  1: 258 <br>  1: 261 <br>  1: 255 <br>  1: 254 <br>  1: 261 <br>  1: 264 <br>  1: 262 <br></div></div><br>  That corresponds to 100.6% of the theoretical limit, quite a good result for such a simple one-line algorithm: <br><br><pre> <code class="delphi hljs">CRC:=CRC + byte*<span class="hljs-number"><span class="hljs-number">44111</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   16-</span></span></code> </pre><br>  Full 16-bit multiplication is used.  Again, it was not without the magic number 44111 (selected from general considerations without going through the entire subset of numbers).  More precisely, it makes sense to select a constant only after having decided on the expected type of errors in the data transmission line. <br><br>  Such a high result is explained by the fact that 2 cycles of multiplication in a row completely mix the bits, which is what we needed.  The exception, it seems, is the last byte of the telegram, especially its high bits, they are not fully mixed in the checksum, but the probability that an error will occur in them is small, approximately 4%.  This feature practically does not manifest itself statistically, at least on my set of test data and an error limited to 10 failed bits.  To exclude this feature, you can do N + 1 iterations by adding a virtual byte in addition to the ones in the test data block (but this is a complication of the algorithm). <br><br>  Option without multiplication with the same result.  The CRC variable is 16-bit, 8-bit data, the result of the algorithm is the lower 8 bits of the checksum found: <br><br><pre> <code class="delphi hljs">CRC := (CRC <span class="hljs-keyword"><span class="hljs-keyword">shl</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) + CRC + byte; CRC := (CRC <span class="hljs-keyword"><span class="hljs-keyword">shl</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) + CRC + byte; CRC:=(CRC XOR (CRC <span class="hljs-keyword"><span class="hljs-keyword">SHR</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>));</code> </pre><br>  The result is 100.6% of the theoretical limit. <br><br>  The non-multiplication option is simpler, leaving the bare minimum of functions, only 3 mathematical operations: <br><br><pre> <code class="delphi hljs">CRC:=byte + CRC; CRC:=CRC xor (CRC <span class="hljs-keyword"><span class="hljs-keyword">shr</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>);</code> </pre><br>  The result is 86% of the theoretical limit. <br><br>  In this case, the loss of the most significant bits is not; they are returned to the lower part of the variable through the XOR function (bit mixer). <br><br>  A slight improvement in some cases gives the same: <br><br><ul><li>  Double pass on processed data.  But at the cost of complicating the algorithm (the outer loop must be specified), at the cost of doubling the processing time. </li><li>  The processing of an additional, virtual byte at the end of the processed data, the complexity of the algorithm and the time of the algorithm is almost nonexistent. </li><li>  Using a variable to store a checksum greater in bit depth than the final checksum and mixing the lower bits with the high bits. </li></ul><br>  The result of the work of the considered algorithms, from simple and weak, to complex and qualitative: <br><br><img src="https://habrastorage.org/files/ea0/080/84d/ea008084d26445a6bc26441b2bfdf716.gif"><br><br><h4>  16-bit checksum </h4><br>  Further, suppose that 8 bits are not enough for us to form a checksum. <br><br><img src="https://habrastorage.org/files/ca7/a2f/9a0/ca7a2f9a0c4f461d9e658e64d76f051a.jpg"><br><br>  The next option is 16 bits, and the theoretical error probability of the transmitted data is 1: 65536, which is much better.  Reliability grows exponentially.  But, as a side effect, the amount of auxiliary data is growing, by the example of our telegram, 2 bytes of checksum are added to 8 bytes of useful information. <br><br>  Simple sum and XOR algorithms, as applied to the 16-bit and subsequent CRCs, are not considered at all, they practically do not improve the quality of work, compared to the 8-bit variants. <br><br>  We modify the algorithm for processing a checksum of 16 bits, it should be noted that there is also a magic number 8 and 44111, a significant and unreasonable change worsens the work of the algorithm several times. <br><br><pre> <code class="delphi hljs">CRC:=CRC + byte16*<span class="hljs-number"><span class="hljs-number">44111</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  16- CRC:=CRC XOR (CRC SHR 8);</span></span></code> </pre><br>  Result: <br><br><div class="spoiler">  <b class="spoiler_title">Statistics</b> <div class="spoiler_text">  1: 43478 <br>  1: 76923 <br>  1: 83333 <br>  1: 50,000 <br>  1: 83333 <br>  1: 100,000 <br>  1: 90909 <br>  1: 47,619 <br>  1: 50,000 <br>  1: 90909 <br></div></div><br>  That corresponds to 109% of the theoretical limit.  There is a measurement error, but it is excusable for 10 million iterations.  It also affects the creation algorithm, and in general the type of errors.  For a more accurate analysis, in any case, you need to adjust the conditions for errors in a particular data line. <br><br>  Additionally, I note that you can use 32-bit intermediate variables to accumulate the result, and use the final checksum as the lower 16 bits.  In many cases, for any digit of the checksum, the quality of the algorithm improves somewhat. <br><br><h4>  32-bit checksum </h4><br>  Let's move on to the 32-bit checksum option.  There is a problem with the time devoted to the analysis of statistical data, since the number of transmitted telegrams is already comparable to 2 ^ 32.  The algorithm is the same; magic numbers change upwards <br><br><pre> <code class="delphi hljs">CRC:=CRC+byte32*$<span class="hljs-number"><span class="hljs-number">990</span></span>C9AB5; CRC:=CRC XOR (CRC <span class="hljs-keyword"><span class="hljs-keyword">SHR</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>);</code> </pre><br>  Over 10 million iterations, no error was detected.  To speed up the collection of statistics cut the CRC to 24 bits: <br><br><pre> <code class="delphi hljs">CRC = CRC <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> $FFFFFF;</code> </pre><br>  The result, out of 10 million iterations, the error was detected 3 times <br><br><div class="spoiler">  <b class="spoiler_title">Statistics</b> <div class="spoiler_text">  1: 1,000,000 <br>  1: no <br>  1: no <br>  1: no <br>  1: 1,000,000 <br>  1: no <br>  1: 1,000,000 <br>  1: no <br>  1: no <br>  1: no <br></div></div><br>  Quite a good result and generally close to the theoretical limit for 24-bit checksum (1: 16777216).  Here it should be noted that the data integrity control function is evenly distributed across all CRC bits, and it is quite possible to discard them from any side if there is a limit on the size of the transmitted CRC. <br><br>  For full-fledged 32 bits, it‚Äôs enough to wait long for the result, there are simply no errors, for an acceptable waiting time. <br><br>  Option without multiplication: <br><br><pre> <code class="delphi hljs">CRC := (CRC <span class="hljs-keyword"><span class="hljs-keyword">shl</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) + CRC + byte; CRC := (CRC <span class="hljs-keyword"><span class="hljs-keyword">shl</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) + CRC; CRC:=CRC xor (CRC <span class="hljs-keyword"><span class="hljs-keyword">shr</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>);</code> </pre><br>  There was no failure for a full-fledged checksum.  The checksum trimmed to 24 bits shows approximately the same results, 8 errors per 100 million iterations.  Intermediate variable CRC 64-bit. <br><br><h4>  64-bit checksum </h4><br>  And finally, 64-bit checksum, the maximum checksum, which makes sense when transferring data at the lower level: <br><br><pre> <code class="delphi hljs">CRC:=CRC+byte64*$<span class="hljs-number"><span class="hljs-number">5</span></span>FB7D03C81AE5243; CRC:=CRC XOR (CRC <span class="hljs-keyword"><span class="hljs-keyword">SHR</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   1..20</span></span></code> </pre><br>  Wait for the data transmission error, until the end of the universe, probably will not work :) <br><br><img src="https://habrastorage.org/files/022/ace/6c5/022ace6c5c224be29a8dcd7b38f8fa83.jpg"><br><br>  A method similar to that used for the CRC32 showed similar results.  More bits are left, higher reliability is in full compliance with the theoretical limit.  Checked on the lower 20 and 24 bits, this seems to be quite sufficient to assess the quality of the algorithm. <br><br>  You can also apply for 128-bit numbers (and even larger ones), the main thing is to choose correctly 128-bit magic constants.  But this is clearly not for microcontrollers, such numbers are not supported by the compiler. <br><br><h4>  Comments </h4><br>  In general, the multiplication method is similar to the generation of a pseudo-random sequence, only taking into account the useful data involved in the process. <br><br>  I recommend to use in microcontrollers, or to check the integrity of any transmitted data.  It is a working method, already as it is, despite the simplicity of the algorithm. <br><br>  My CRC research project on <a href="https://github.com/sim31r/CRC_MY">githab</a> . <br><br>  Further, it would be interesting to optimize the algorithm for more real data (not pseudo-random numbers by the standard algorithm), to select more suitable magic numbers for a number of tasks and initial conditions, I think you can still win fractions of a percent in the quality of the algorithm.  Optimize the algorithm for speed, readability of the code (the simplicity of the algorithm), quality of work.  Ideally, get and test code samples for all types of microcontrollers, for this you need examples using the multiplication of 8, 16, 32 bit data, and no multiplication at all. </div><p>Source: <a href="https://habr.com/ru/post/278171/">https://habr.com/ru/post/278171/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../278159/index.html">Debian's RISC under QEMU</a></li>
<li><a href="../278163/index.html">CodingFuture + Puppet. Part III: Install Puppet Server (cfpuppetserver)</a></li>
<li><a href="../278165/index.html">Best practices Richard Siddeway Powershell in depth</a></li>
<li><a href="../278167/index.html">HTTP / 2: getting ready for the transition</a></li>
<li><a href="../278169/index.html">How to shoot yourself in Kotlin</a></li>
<li><a href="../278173/index.html">ASP.NET Core + Docker: Cooking Together</a></li>
<li><a href="../278175/index.html">Differences between Azure Resource Manager and Azure Service Manager - a developer‚Äôs perspective</a></li>
<li><a href="../278177/index.html">Azure-IaaS-Digest number 2 (February)</a></li>
<li><a href="../278179/index.html">Why technical debt is good</a></li>
<li><a href="../278181/index.html">We saw a web demo - Wavescroll</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>