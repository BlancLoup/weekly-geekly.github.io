<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We implement CircularRevealAnimation on Flutter and publish the library on pub.dev in passing.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In Android, there is a very interesting feature of the animation View, which is called CircularRevealAnimation - literally "circular disclosure". Flut...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We implement CircularRevealAnimation on Flutter and publish the library on pub.dev in passing.</h1><div class="post__text post__text-html js-mediator-article"><p> In Android, there is a very interesting feature of the animation View, which is called <code>CircularRevealAnimation</code> - literally "circular disclosure".  Flutter, in turn, although it has rich capabilities for animating widgets, does not provide such animation from the box. </p><br><p><img src="https://habrastorage.org/webt/ei/71/nn/ei71nnazai4-3ln2qzmqlsqjzvo.gif"></p><br><p>  This article will show you how to implement this animation with Flutter and publish the library to <a href="http://pub.dev/">pub.dev</a> for easy access and distribution. <a name="habracut"></a></p><br><h2 id="realizaciya-animacii">  Animation implementation </h2><br><p>  In Flutter, everything is a widget.  And animation is no exception.  Therefore, we will create the class <a href=""><code>CircularRevealAnimation</code></a> , which will extend the class <code>StatelessWidget</code> . </p><br><p>  Starting, stopping, and other animation management is done using the <code>AnimationController</code> .  To create an <code>AnimationController</code> you need to inherit from <code>StatefulWidget</code> and add the special class <code>SingleTickerProviderStateMixin</code> to <code>State</code> . </p><br><p>  Our animation class <code>CircularRevealAnimation</code> will not independently manage animation, but will receive <code>Animation&lt;double&gt;</code> as a required constructor parameter, so there is no need to inherit from <code>StatefulWidget</code> .  This is done so that <code>CircularRevealAnimation</code> can be easily combined with other animations using the same <code>AnimationController</code> .  For example, combine the disclosure animation with the transparency change animation. </p><br><p>  Another important parameter of the <code>CircularRevealAnimation</code> constructor is the <code>child</code> , which is a child of our animation and will appear or disappear.  In general, in Flutter, many widgets have a <code>child</code> parameter.  Such widgets allow you to change the behavior, drawing or location of the child widget.  Or add an animation, as happens with <code>CircularRevealAnimation</code> . </p><br><p>  In addition, to set the animation, you will need parameters such as the center of the disclosure (or closure) of the animation, as well as the minimum and maximum radii of the disclosure.  These parameters are optional and can be either <code>null</code> or not specified when creating the animation.  In this case, the default values ‚Äã‚Äãwill be used: the center of the disclosure will be in the center of the widget, the minimum radius will be wounded to zero, and the maximum radius will be equal to the distance from the center of the disclosure to the vertex of the widget that is furthest from the center of the disclosure. </p><br><p>  The algorithm for calculating the maximum radius by default is as follows.  First, calculate the distance horizontally and vertically from the center to the vertex furthest from the center of the disclosure, and then calculate the diagonal using the Pythagorean theorem. </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calcMaxRadius</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Size size, Offset center)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> w = max(center.dx, size.width - center.dx); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> h = max(center.dy, size.height - center.dy); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sqrt(w * w + h * h); }</code> </pre> <br><p>  Now you need to implement trimming the widget within the circle during the drawing.  With this, the <code>ClipPath</code> class will help us, allowing you to trim a widget using an arbitrary pattern.  As parameters, the <code>clipper</code> passed to this widget (more about it later) and the <code>child</code> is the child widget that needs to be trimmed. </p><br><p>  The <code>clipper</code> parameter of the <code>ClipPath</code> widget determines how the child widget will be cropped.  To create your own trim template, create a <a href=""><code>CircularRevealClipper</code></a> class that inherits the <code>CustomClipper&lt;Path&gt;</code> class and override the <code>Path getClip(Size size)</code> method.  This method returns a <code>Path</code> that bounds the clipping region.  In our case, this area is a circle with a given center.  To calculate the radius of a circle, you need to know the current value of the animation.  This value is passed to <code>CircularRevealClipper</code> as a <code>fraction</code> parameter.  The calculation of the radius of a circle is performed using linear interpolation between the minimum and maximum radii. </p><br><p>  After that, let's move on to implementing the widget.  Animation is convenient to use <code>AnimatedBuilder</code> .  The <code>AnimatedBuilder</code> constructor accepts an <code>Animation&lt;double&gt;</code> object and a <code>builder</code> , which is used to build widgets based on the current animation value.  In the <code>builder</code> we create a <code>ClipPath</code> and pass the current value of the animation ( <code>fraction</code> ) to <code>CircularRevealClipper</code> . </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CircularRevealAnimation</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StatelessWidget</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@override</span></span> <span class="hljs-function"><span class="hljs-function">Widget </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BuildContext context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> AnimatedBuilder( animation: animation, builder: (BuildContext context, Widget _) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ClipPath( clipper: CircularRevealClipper( fraction: animation.value, center: center, minRadius: minRadius, maxRadius: maxRadius, ), child: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.child, ); }, ); } }</code> </pre> <br><p>  This completes the creation of <code>CircularRevealAnimation</code> .  It remains to use it.  To do this, create a <code>StatefulWidget</code> , <code>AnimationController</code> and pass the <code>AnimationController</code> to <code>CircularRevealAnimation</code> . </p><br><div class="spoiler">  <b class="spoiler_title">Usage example</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'package:flutter/material.dart'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'package:circular_reveal_animation/circular_reveal_animation.dart'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>=&gt; runApp(MyApp()); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyApp</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StatelessWidget</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@override</span></span> <span class="hljs-function"><span class="hljs-function">Widget </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BuildContext context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MaterialApp( title: <span class="hljs-string"><span class="hljs-string">'CRA Demo'</span></span>, theme: ThemeData( primarySwatch: Colors.blue, ), home: MyHomePage(), ); } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyHomePage</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StatefulWidget</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@override</span></span> <span class="hljs-function"><span class="hljs-function">_MyHomePageState </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>=&gt; _MyHomePageState(); } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">_MyHomePageState</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">State</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyHomePage</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SingleTickerProviderStateMixin</span></span></span><span class="hljs-class"> </span></span>{ AnimationController animationController; Animation&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt; animation; <span class="hljs-meta"><span class="hljs-meta">@override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.initState(); animationController = AnimationController( vsync: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, duration: Duration(milliseconds: <span class="hljs-number"><span class="hljs-number">1000</span></span>), ); animation = CurvedAnimation( parent: animationController, curve: Curves.easeIn, ); } <span class="hljs-meta"><span class="hljs-meta">@override</span></span> <span class="hljs-function"><span class="hljs-function">Widget </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BuildContext context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Scaffold( appBar: AppBar( title: Text(<span class="hljs-string"><span class="hljs-string">"CRA Demo"</span></span>), ), body: Padding( padding: <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> EdgeInsets.all(<span class="hljs-number"><span class="hljs-number">16.0</span></span>), child: CircularRevealAnimation( minRadius: <span class="hljs-number"><span class="hljs-number">12</span></span>, maxRadius: <span class="hljs-number"><span class="hljs-number">200</span></span>, center: Offset(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">300</span></span>), child: Container(color: Colors.red), animation: animation, ), ), floatingActionButton: FloatingActionButton(onPressed: () { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (animationController.status == AnimationStatus.forward || animationController.status == AnimationStatus.completed) { animationController.reverse(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { animationController.forward(); } }), ); } }</code> </pre> </div></div><br><p>  <a href="https://github.com/qwert2603/circular_reveal_animation/tree/master/example">Demo application</a> on github. </p><br><h2 id="sozdanie-biblioteki">  Creating a library </h2><br><p>  To create a Dart or Flutter library, you need to add the <code>pubspec.yaml</code> file to the same directory as the <code>lib</code> directory with the Dart files.  This file contains the library description, information about the authors and dependencies. </p><br><p>  It is also a good practice to create a file that defines a public API.  This file is located in the <code>lib</code> folder and includes the name of the library and the list of files that need to be included in the public API.  All other Dart-files are placed in the <code>src</code> directory.  This not only hides files that are not included in the public API, but also allows you to import a library using a single <code>import</code> expression.  Contents of this <a href="">file</a> : </p><br><pre> <code class="java hljs">library circular_reveal_animation; export <span class="hljs-string"><span class="hljs-string">'package:circular_reveal_animation/src/circular_reveal_animation.dart'</span></span>;</code> </pre> <br><p>  In more detail about creation of libraries on Dart it is possible to read <a href="https://dart.dev/guides/libraries/create-library-packages">here</a> . </p><br><h2 id="publikaciya-na-pubdevpubdev">  Publish to <a href="http://pub.dev/">pub.dev</a> </h2><br><p>  Publishing the Dart library to pub.dev is very simple.  All you need to do is run the <code>flutter packages pub publish</code> command from the root directory of the library.  The publication is carried out on behalf of the Google account, so the linking process will be given during the publication process, which must be opened in the browser and authorized by Google.  Subsequently, it will be possible to publish updates only using the account on whose behalf the first version was posted. </p><br><p>  Before publishing, it is recommended to check the library correctness using the <code>flutter packages pub publish --dry-run</code> . </p><br><p>  After executing the <code>flutter packages pub publish</code> library will immediately be available at pub.dev.  And, as written in the documentation, "Publishing is forever" - later you can only upload new versions.  Old versions will also be available. </p><br><p>  Although the publication of libraries looks simple, it can also have pitfalls.  For example, when publishing the first version, I was shot a few points in the rating because the library description (in <code>pubspec.yaml</code> ) was too short. </p><br><p>  More information about the publication of libraries can be found <a href="https://dart.dev/tools/pub/publishing">here</a> . </p><br><p>  Actually, the <code>circular_reveal_animation</code> library on <a href="https://pub.dev/packages/circular_reveal_animation">pub.dev</a> and <a href="https://github.com/qwert2603/circular_reveal_animation">github.com</a> . </p><br><p>  <strong>PS:</strong> I used <code>```java {...} ```</code> to highlight the code on Dart.  It would be nice to add a highlight of the code on Dart on habr.com. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/452072/">https://habr.com/ru/post/452072/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../452060/index.html">Predicates of informational hope</a></li>
<li><a href="../452062/index.html">And how does your morning begin?</a></li>
<li><a href="../452064/index.html">PowerShell Desired State Configuration and File: Part 1. Configuring a DSC Pull Server to Work with a SQL Database</a></li>
<li><a href="../452066/index.html">Excelsior JET stops developing its AOT compiler after 18 years of work</a></li>
<li><a href="../452068/index.html">12. Check Point Getting Started R80.20. Logs & Reports</a></li>
<li><a href="../452074/index.html">The first game on unity or what took me six months</a></li>
<li><a href="../452078/index.html">Reservations at Kubernetes: it exists</a></li>
<li><a href="../45208/index.html">Down with the language barrier - 2</a></li>
<li><a href="../452086/index.html">What's in a pixel for you my: the creation of nanopixels using plasmon meta-surfaces</a></li>
<li><a href="../45209/index.html">The first test of the interplanetary Internet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>