<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Identify all the classes that the Java application uses.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Without a doubt, everyone who in his resume indicates the experience of developing in Java, at least once in his life wrote the lines 

public static ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Identify all the classes that the Java application uses.</h1><div class="post__text post__text-html js-mediator-article">  Without a doubt, everyone who in his resume indicates the experience of developing in Java, at least once in his life wrote the lines <pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span></span></code> </pre>  compiled them and executed them with a command like <code>java HelloWorld</code> . <br>  But how many people know what happens inside the JVM from the moment this command is executed until control is transferred to the main method, how does Java find and load the classes needed by the user?  Occurring once the production problem forced the author to understand this issue.  The results of the survey under the cut.  Immediately it is worth making a reservation that the article does not pretend to complete coverage of all existing JVMs, testing was conducted only on the Sun HotSpot JVM. <br><a name="habracut"></a><br><h2>  Formulation of the problem </h2><br>  One day, the customer needed to find out which classes his application uses.  The application was already well known to the author and was an explosive mixture of code of different races, which implements (to the credit of system developers, mostly competently and to the point) the mechanisms of inheritance, late binding and dynamic compilation.  Therefore, information on the actually used classes could significantly help in refactoring the application. <br>  The task is set as follows: during the operation of the application, a file should be generated containing the names of all the classes directly used by the application.  It, by the way, consists of two main parts: the application server, which hosts the web interface of the application, and the processing server (a separate server, on which various periodic tasks are run using Ant scripts).  Of course, information about classes must be collected from both parts of the application. <br>  Let's start looking for a solution to the problem and at the same time we will look into the class loading mechanisms in Java. <br><br><h2>  Overriding Class Loader </h2><br>  The first direction that came to mind when solving this problem was to take advantage of the possibilities of expanding the class loading mechanism in Java.  Many articles have been written on this topic, including in Russian (links at the end of the article). <br>  The essence of this mechanism is as follows: <br><ol><li>  descendants of the abstract class <code>java.lang.ClassLoader</code> are used to directly load classes, as evidenced by the signature of the <code>Class loadClass(String name)</code> method <code>Class loadClass(String name)</code> .  This method should find the byte array that is the bytecode of the required class and pass it to the <code>protected Class defineClass(String name, byte[] b, int off, int len)</code> , which will turn it into an instance of <code>java.lang.Class</code> .  Thus, by implementing their loaders, developers can download from any place where they can get an array of bytes; </li><li>  framework developers declare a clever mechanism of hierarchy and inheritance of loaders.  In this case, inheritance here should be understood not in terms of class inheritance in OOP, but as a separate hierarchy organized with the help of the <code>getParent</code> method of the <code>ClassLoader</code> class.  When you start the JVM, a vertex of this hierarchy of three main loaders is created: the base one (Bootstrap Classloader, responsible for loading the base classes of the framework), the extension loader (Extension Classloader, responsible for loading classes from lib / ext) and the system loader (System Classloader, responsible for loading custom classes).  Further, developers are free to continue this hierarchy from the bootloader and below.  By default, the HotSpot JVM uses the <code>sun.misc.Launcher$AppClassLoader</code> class as the system bootloader, but you can easily override it using the <code>java.system.class.loader</code> system property of the <code>java.system.class.loader</code> command line key <code>java -Djava.system.class.loader=..</code> ; </li><li>  A loading delegation rule is declared: any loader, before attempting to load any class, must first contact its parent, and only if it could not load the required class, try to load it itself.  Unfortunately, the beauty and convenience of this rule are compensated by the lack of mandatory execution.  The author still has to face the consequences of non-fulfillment of this rule. </li></ol><br>  However, at this stage, the first concept of solving the problem has appeared: <br><ol><li>  Implement your own class loader, replacing the system one, which, when you call the loadClass method, will simply write the class name to a file, and send a class load request to the real system loader.  Subject to the rules of delegation described above, this should allow catching all loaded custom classes, even if they are loaded by other loaders; </li><li>  To force all JVMs running on the machine to use this class loader as the system one. </li></ol><br>  To implement the second paragraph, it is necessary to solve the following tasks: <br><ul><li>  Make the class visible to all running JVMs.  It is inconvenient, time consuming and irrational from the point of view of expanding the system to include a class in all the classpaths of the many components of the application.  Moreover, there is a more beautiful solution - put the loader class in the lib / ext JRE folder.  Classes in this folder are available automatically without adding them to the classpath (as noted above, they are loaded by the extension loader when the JVM starts); </li><li>  set for all JVM system property <code>java.system.class.loader</code> - from the command line you can do it like this: <code>java -Djava.system.class.loader=.. HelloWolrd</code> </li><li>  directly make all JVMs run with the necessary <code>-Djava.system.class.loader</code> .  As it turned out, there is also an elegant solution for this - you need to use a special environment variable, the value of which is automatically added to the launch parameters of any JVM.  During the search, two variables were found that could be responsible for this feature: JAVA_OPTS and JAVA_TOOL_OPTIONS.  However, none of the articles gave a clear answer to the question: what is the difference between these two variables?  It was decided to find the answer to this question empirically.  During the experiment, it was found that the truly ‚Äúmagical‚Äù is the JAVA_TOOL_OPTIONS variable, the value of which is automatically added to the launch parameters of any HotSpot JVM launched.  And JAVA_OPTS is the result of a tacit agreement between developers of various Java applications.  This variable is explicitly used by many scripts (for example, startup.sh/startup.bat to start Apache Tomcat), but no one guarantees that all script developers will use this variable. </li></ul><br>  So, the job is done, the bootloader is compiled and placed in lib / ext, the value of the <code>JAVA_TOOL_OPTIONS</code> environment <code>JAVA_TOOL_OPTIONS</code> is set, we run the application, work, open the log and see ... a scant list of a dozen classes, including system and several third-party classes.  It was here that I had to recall the non-obligation to execute the delegation delegation rule, as well as to look into the source code for Apache Ant and Tomcat.  As it turned out, these applications use their own class loaders.  This, on the one hand, partly allowed them to acquire their powerful functionality.  However, for one reason or another, the developers of these products decided not to adhere to the recommended rule for delegating loading and the loaders written by them do not always turn to their parents before downloading the next class.  That is why our system loader knows almost nothing about classes that are loaded by Tomcat and Ant. <br>  Thus, the described method does not allow catching all the required classes, especially considering the variety of application servers used - who knows how developers of the application server used by the customer reacted to the load delegation rule. <br><br><h2>  Attempt number two.  Apply class instrumentation </h2><br>  Sometimes knowledge and skills alone are not enough to solve a problem.  Sometimes intuition and a bit of luck are needed to achieve a goal.  Now the author no longer remembers in response to a search query about class loaders, the search giant issued a link to an article about the mechanism of class instrumentation.  As it turned out, this tool is designed to change the bytes of Java code classes during their loading (for example, JProfiler using this mechanism is built into the classes for measuring performance).  Stop, what does it mean during their loading?  That is, this mechanism knows about each loaded class?  Yes, he knows, and, as it turned out, it is even better than class loaders ‚Äî the <code>byte[] transform(ClassLoader loader, String className, Class&lt;?&gt; classBeingRedefined, ProtectionDomain protectionDomain, byte[] classfileBuffer)</code> method <code>byte[] transform(ClassLoader loader, String className, Class&lt;?&gt; classBeingRedefined, ProtectionDomain protectionDomain, byte[] classfileBuffer)</code> the <code>ClassFileTransformer</code> interface called by the transformer class implementing loading any class.  This method turned out to be the bottleneck through which any loadable class passes, with the exception of a very small number of system classes. <br>  Now the task is as follows: <br><ol><li>  Write your own transformer class that implements the <code>ClassFileTransformer.transform</code> method, which, however, will not perform any transformation, but will only write the name of the loaded class to a file. </li><li>  And again it is necessary to make so that the class written by us was connected to any started Java application. </li></ol><br>  The source code of the transformer class is presented below: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.test; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.File; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.lang.instrument.Instrumentation; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.lang.instrument.ClassFileTransformer; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.security.ProtectionDomain; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.lang.instrument.IllegalClassFormatException; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoggingClassFileTransformer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClassFileTransformer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">premain</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String agentArguments, Instrumentation instrumentation)</span></span></span><span class="hljs-function"> </span></span>{ instrumentation.addTransformer(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LoggingClassFileTransformer()); } <span class="hljs-comment"><span class="hljs-comment">/** *        * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> className        * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment">  classfileBuffer  -  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] transform(ClassLoader loader, String className, Class&lt;?&gt; classBeingRedefined, ProtectionDomain protectionDomain, <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] classfileBuffer) <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> IllegalClassFormatException { log(className); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> classfileBuffer; } <span class="hljs-comment"><span class="hljs-comment">//     lib/ext private static final File logFile = new File(System.getProperty("java.ext.dirs").split(File.pathSeparator)[0]+"/LoggingClassFileTransformer.log"); public static synchronized void log(String text) { //    // ... } }</span></span></code> </pre><br>  Here it is necessary to clarify the mechanism of using transformer classes.  To connect such a class to the application, we need the so-called premain class, i.e.  class containing the <code>public static void premain(String paramString, Instrumentation paramInstrumentation)</code> .  From the name of the method it is clear that it is called before calling the main method.  At this moment, you can connect transformer classes to your application using the <code>addTransformer</code> method of the <code>addTransformer</code> interface.  Thus, the above class is both a transformer class and a premain class.  To use this class, it must be placed in a JAR file whose manifest (file META-INF / MANIFEST.MF) contains the Premain-Class parameter indicating the full name of the premain class, in our case <code>Premain-Class: com.test.LoggingClassFileTransformer</code> .  Then you need to specify the full path to this archive using the <code>-javaagent</code> parameter when starting the JVM.  This is where the JAVA_TOOL_OPTIONS variable comes to the rescue. <br>  So, the class is written, compiled, packaged with the manifest in the JAR, the environment variable <code>JAVA_TOOL_OPTIONS=-javaagent:"  LoggingClassFileTransformer.jar"</code> set, the application is running, the log is compiled, PROFIT! <br>  <b>upd3.</b> <br>  Habrayuser <a href="https://habrahabr.ru/users/grossws/" class="user_link">grossws</a> offered another way that uses instrumentation ‚Äî AspectJ: ‚ÄúIt‚Äôs relevant if you need to cheaply instruct all classes in their part of the application without affecting the environment, but this is a slightly different task.‚Äù 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>upd.</b> <br><h2>  The third way.  Simple as scrap </h2><br>  Thanks to <a href="https://habrahabr.ru/users/spiff/" class="user_link">spiff</a> and <a href="https://habrahabr.ru/users/apangin/" class="user_link">apangin habrausers,</a> which in a personal reminded me of another way that I tried, but was undeservedly forgotten, because  ultimately did not fit. <br>  This method is based on running JVM with the <code>-verbose:class</code> parameters <code>-verbose:class</code> or <code>--XX:+TraceClassLoading</code> .  When using any of these parameters, messages like <code>[Loaded java.util.Date from shared objects file]</code> added to the standard JVM output stream.  However, this method, despite its simplicity, has one major drawback - it is difficult to control the format of the displayed message, as well as the direction of the output.  And the application in question already displays enough debugging information to stdout, and the ability to filter out the necessary messages from the stream and redirect them to a separate file for all JVM instances running on the server is very problematic. <br>  <b>upd2.</b> <br>  Habrayuzer <a href="https://habrahabr.ru/users/apangin/" class="user_link">apangin</a> this method was completed to the next version of the launch of the JVM: <br> <code>java -XX:+TraceClassLoading -XX:+UnlockDiagnosticVMOptions -XX:+LogVMOutput -XX:LogFile=java_*.log -XX:-DisplayVMOutput HelloWorld</code> <br>  Instead of * automatically pid will be substituted. <br>  After launching such a command, a file with the name, for example, java_580.log, will be formed, approximately as follows: <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version='1.0' encoding='UTF-8'?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hotspot_log</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'160 1'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">process</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'580'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">time_ms</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'1334248301214'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vm_version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> Java HotSpot(TM) Client VM <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">release</span></span></span><span class="hljs-tag">&gt;</span></span> 20.6-b01 <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">release</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">info</span></span></span><span class="hljs-tag">&gt;</span></span> Java HotSpot(TM) Client VM (20.6-b01) for windows-x86 JRE (1.6.0_31-b05), built on Feb 3 2012 18:44:09 by "java_re" with MS VC++ 7.1 (VS2003) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">info</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vm_version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vm_arguments</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">args</span></span></span><span class="hljs-tag">&gt;</span></span> -XX:+TraceClassLoading -XX:+UnlockDiagnosticVMOptions -XX:+LogVMOutput -XX:LogFile=java_*.log -XX:-DisplayVMOutput <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">args</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">command</span></span></span><span class="hljs-tag">&gt;</span></span> test <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">command</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">launcher</span></span></span><span class="hljs-tag">&gt;</span></span> SUN_STANDARD <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">launcher</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> java.vm.specification.name=Java Virtual Machine Specification java.vm.version=20.6-b01 java.vm.name=Java HotSpot(TM) Client VM java.vm.info=mixed mode, sharing java.ext.dirs=C:\Program Files\Java\jre6\lib\ext;C:\WINDOWS\Sun\Java\lib\ext java.endorsed.dirs=C:\Program Files\Java\jre6\lib\endorsed sun.boot.library.path=C:\Program Files\Java\jre6\bin java.library.path=C:\WINDOWS\system32;C:\WINDOWS\Sun\Java\bin;C:\WINDOWS\system32;C:\WINDOWS;C:\Program Files\PC Connectivity Solution\;C:\Program Files\Rockwell Software\RSCommon;C:\WINDOWS\system32;C:\WINDOWS;C:\WINDOWS\System32\Wbem;C:\Program Files\Java\jdk1.6.0_06\bin;c:\hibernate;C:\WINDOWS\system32\WindowsPowerShell\v1.0;C:\Program Files\TortoiseSVN\bin;C:\Program Files\Nmap;;C:\PROGRA~1\COMMON~1\MUVEET~1\030625;C:\PROGRA~1\COMMON~1\MUVEET~1\030625;. java.home=C:\Program Files\Java\jre6 java.class.path=. sun.boot.class.path=C:\Program Files\Java\jre6\lib\resources.jar;C:\Program Files\Java\jre6\lib\rt.jar;C:\Program Files\Java\jre6\lib\sunrsasign.jar;C:\Program Files\Java\jre6\lib\jsse.jar;C:\Program Files\Java\jre6\lib\jce.jar;C:\Program Files\Java\jre6\lib\charsets.jar;C:\Program Files\Java\jre6\lib\modules\jdk.boot.jar;C:\Program Files\Java\jre6\classes java.vm.specification.vendor=Sun Microsystems Inc. java.vm.specification.version=1.0 java.vm.vendor=Sun Microsystems Inc. sun.java.command=test sun.java.launcher=SUN_STANDARD <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vm_arguments</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tty</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">writer</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">thread</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'1504'</span></span></span><span class="hljs-tag">/&gt;</span></span> [Loaded java.lang.Object from shared objects file] ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">writer</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">thread</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'3092'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">destroy_vm</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stamp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0.281'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tty_done</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stamp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0.283'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tty</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hotspot_log_done</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">stamp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0.283'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hotspot_log</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  At the same time, nothing new is written to the standard output stream, thanks to the <code>-XX:-DisplayVMOutput</code> option <code>-XX:-DisplayVMOutput</code> . <br>  The main advantage of this method is its simplicity.  It‚Äôs not a fact that such a file format would suit the customer, but this is already a debatable question and it is not within the scope of this article. <br><br><h2>  Conclusion </h2><br>  So, what conclusions can be made after the project is completed: <br><ul><li>  The class loading mechanism in Java is an interesting and very useful feature of the framework, which can be useful for solving a certain range of tasks.  However, it is worth remembering that the main task that can be solved with the help of this mechanism is to find and load a class from a place from which others cannot load it.  This mechanism may be of little use for gathering information about loaded classes; </li><li>  Java classroom instrumentation is another powerful mechanism for working with classes, and its task is to work with classes like guinea pigs.  Do you need to get information about the time of the method or just find out the name of the newly loaded class - this mechanism will come to the rescue; </li><li>  Java as a whole is an open and creative platform.  Open source applications on this (as well as in any other language) are not only useful for their functionality, but also valuable for ideas that can be learned from their source code.  And the lack of source code is often not a problem for Java applications.  There are many tools that allow you to display the source code of almost any compiled Java class.  With their help, you can easily analyze the code of almost any class and method, even from the core of the framework (for example, from the rt.jar file), of course, with the exception of native methods.  In working on this and many other projects, the author has come in handy with the free Java Decompiler utility, which allows him to see the source code of almost any compiled Java class.  Particularly fascinating is the opportunity to see the part of the source code of the Java kernel, which is itself written in Java, for example, if you open the rt.jar file located in the lib folder of the JRE. </li></ul><br><br><h2>  List of used sources </h2><br>  Java class loader articles: <br><ul><li>  <a href="http://habrahabr.ru/post/103830/">habrahabr.ru/post/103830</a> </li><li>  <a href="http://voituk.kiev.ua/2008/01/14/java-plugins/">voituk.kiev.ua/2008/01/14/java-plugins</a> </li><li>  <a href="https://blogs.oracle.com/vmrobot/entry/%25D0%25BE%25D1%2581%25D0%25BD%25D0%25BE%25D0%25B2%25D1%258B_%25D0%25B4%25D0%25B8%25D0%25BD%25D0%25B0%25D0%25BC%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25BE%25D0%25B9_%25D0%25B7%25D0%25B0%25D0%25B3%25D1%2580%25D1%2583%25D0%25B7%25D0%25BA%25D0%25B8_%25D0%25BA%25D0%25BB%25D0%25B0%25D1%2581%25D1%2581%25D0%25BE%25D0%25B2_%25D0%25B2">blogs.oracle.com/vmrobot/entry/%D0%BE%D1%81%D0%BD%D0%BE%D0%B2%D1%8B_%D0%B4%D0%B8% D0%BD%D0%B0 % D0% BC% D0% B8% D1% 87% D0% B5% D1% 81% D0% BA% D0% BE% D0% B9_% D0% B7% D0% B0% D0% B3% D1% 80% D1 % 83% D0% B7% D0% BA% D0% B8_% D0% BA% D0% BB% D0% B0% D1% 81% D1% 81% D0% BE% D0% B2_% D0% B2</a> </li></ul><br>  Other useful links: <br><ul><li>  <a href="http://stackoverflow.com/questions/3933300/difference-between-java-opts-and-java-tool-options">stackoverflow.com/questions/3933300/difference-between-java-opts-and-java-tool-options</a> - a question about the variables JAVA_OPTS and JAVA_TOOL_OPTIONS; </li><li>  <a href="http://docs.oracle.com/javase/1.4.2/docs/api/java/lang/ClassLoader.html">docs.oracle.com/javase/1.4.2/docs/api/java/lang/ClassLoader.html#getSystemClassLoader</a> - how to override the system loader; </li><li>  <a href="http://www.sql.ru/forum/actualthread.aspx%3Ftid%3D858652">www.sql.ru/forum/actualthread.aspx?tid=858652</a> - this particular topic prompted the idea of ‚Äã‚Äãusing Instrumentation instead of class loaders; </li><li>  <a href="http://www.exampledepot.com/egs/java.lang/PropCmdLine.html">www.exampledepot.com/egs/java.lang/PropCmdLine.html</a> - how to set the value of the Java system property from the command line; </li><li>  <a href="http://docs.oracle.com/javase/1.4.2/docs/guide/extensions/spec.html">docs.oracle.com/javase/1.4.2/docs/guide/extensions/spec.html</a> - how to get the path to the lib / ext folder; </li><li>  <a href="http://www.javalobby.org/java/forums/t19309.html">www.javalobby.org/java/forums/t19309.html</a> - the article provides an example of the simplest class of transformer; </li><li>  <a href="http://today.java.net/pub/a/today/2008/04/24/add-logging-at-class-load-time-with-instrumentation.html">today.java.net/pub/a/today/2008/04/24/add-logging-at-class-load-time-with-instrumentation.html</a> - the article solves a similar problem of compulsory logging in all loadable classes; </li><li>  <a href="http://java.decompiler.free.fr/">java.decompiler.free.fr</a> is the home page of the Java Decompiler project. </li><li>  <a href="http://www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html">www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html</a> - description of some HotSpot JVM launch parameters </li><li>  <a href="http://q-redux.blogspot.com/2011/01/inspecting-hotspot-jvm-options.html">q-redux.blogspot.com/2011/01/inspecting-hotspot-jvm-options.html</a> - another article about rarely used HotSpot JVM launch parameters </li><li>  <a href="http://habrahabr.ru/post/140133/">habrahabr.ru/post/140133</a> - article about the features of class loaders in some application servers <br></li></ul></div><p>Source: <a href="https://habr.com/ru/post/141699/">https://habr.com/ru/post/141699/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../141694/index.html">IPTV head station</a></li>
<li><a href="../141695/index.html">Yii discrete projects based on a common core</a></li>
<li><a href="../141696/index.html">"Let's cut off Susanin's foot?" (C)</a></li>
<li><a href="../141697/index.html">Will interstellar travel become a reality? Orientation problem</a></li>
<li><a href="../141698/index.html">Shellcodes, exploits ... Tulsa under Win</a></li>
<li><a href="../141701/index.html">Creating Windows 8 and IE10 - a selection of materials for March'12</a></li>
<li><a href="../141702/index.html">The art of negotiation is just business, nothing personal</a></li>
<li><a href="../141703/index.html">Remart: how I created my business</a></li>
<li><a href="../141704/index.html">Validation of datetime fields when translating a project from ASP.NET MVC 3 to ASP.NET MVC 4</a></li>
<li><a href="../141705/index.html">Organizing sharing of files in C # application</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>