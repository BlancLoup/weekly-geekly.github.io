<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The impossible is possible. Stateful behavior in a stateless application!</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When developing web applications, interactive communication with the user is often necessary in the process of performing some actions. Web ERP-system...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The impossible is possible. Stateful behavior in a stateless application!</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/f8a/c23/7f9/f8ac237f9a04364f05f24a5dbed00ce2.png" align="left">  When developing web applications, interactive communication with the user is often necessary in the process of performing some actions.  Web ERP-systems, in turn, impose on such communication rather specific requirements.  After commissioning several variants of such systems, I found a method that seemed to me the most acceptable.  Now I want to share my solution to the problem of interactive work with the user when performing actions on the server. <br><a name="habracut"></a><br><br><br><br>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, when developing a complex web application, you need to combine several conflicting requirements: <br><ol><li>  The application code of a business solution must contain a minimum of artifacts that are not relevant to the business problem. </li><li>  the business transaction must take place in one indivisible transaction </li><li>  during the code execution, interactive communication with the user is necessary </li><li>  waiting for a response from the user should not occupy server resources and block the work of other users </li><li>  the application code is executed on the server, communication with the client goes through the browser </li></ol><br><br>  <b>A typical business task:</b> placing an order, in the process of ordering on the server checks are made that require the operator to interactive input.  For example, we want to ask the user to confirm his actions when certain conditions are met. <br><br>  In accordance with the requirement of simplicity of the business code, we would like the application code to look something like this (attention, pseudocode!): <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span>  = ();  (.()) { (‚Äú      , ?‚Äù); } ();</code> </pre> <br><br>  In this case, in the confirmation line, we would like magic to occur: <br><ol><li>  Code suspended work. </li><li>  The request Yes / No has come to the unconfirmed form of the client. </li><li>  If he clicks "Yes" - we continue to work. </li><li>  If ‚ÄúNo‚Äù - give him to re-enter the form and send again. </li></ol><br><br>  I propose to your court my <b>‚Äúmagical‚Äù</b> solution, which has already been tested and successfully works in my projects. <br><br><h4>  Let's try to solve the problem of issuing a typical ‚ÄúYes / No‚Äù dialogue. </h4><br>  The main problem is that we cannot pause the operation on the server while waiting for a response from the user for several reasons: <br><ol><li>  All client-server communication occurs asynchronously and over a stateless protocol. </li><li>  we cannot occupy resources while waiting for a response from the user </li></ol><br>  However, the user should have the impression of continuity of action.  Similarly, the programmer should not think about the fact that the execution of his code can be interrupted.  Therefore, it is necessary to use some tricks. <br><br>  To begin with, we introduce the concepts of request identifiers and actions. <br>  <b>Request ID</b> is a unique request ID that is generated on the client.  For each request to the server, its identifier is its own, except for the case when we request user input. <br>  <b>Action ID</b> - unique identifier of the action.  To be more precise, the unique identifier of the place in the code in which the user's response is requested. <br><br>  These two identifiers allow you to organize the client-server operation scheme in such a way that you can determine exactly when and what was requested from the user and what answer he gave. <br><br>  This is how the scheme looks like: <br><img src="https://habrastorage.org/storage2/ef4/afb/b15/ef4afbb15f47821f22bf02e6612bce85.png"><br><br>  Thus, the developer has the impression that his method is executed only 1 time.  The user, accordingly, also seems that he performed only 1 action. <br><br>  Consider how this idea might look like for a programmer. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HelloNewWorldOrder</span></span> { <span class="hljs-comment"><span class="hljs-comment">// ,   Guid guid = new Guid("5FFD6DB4-1201-44BF-9DE0-DC199AC004D9"); public void KillAllHumans(Human[] humans) { foreach (var human in humans) { if (human.Name == Context.Current.User.Name) { //      ExceptionHelper.Interactive(guid, "     .   ?"); } human.Kill(); } } }</span></span></code> </pre><br><img src="https://habrastorage.org/storage2/7ee/2a4/4c5/7ee2a44c50a9e51aab0058a4d46875cc.png"><br>  In my opinion, it looks pretty friendly :) <br><br>  ExceptionHelper.Interactive itself looks something like this: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Interactive</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Guid id, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> message</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    var key = RequestHelper.GetRequestId(); var exists = Query.All&lt;InteractiveException&gt;() .Any(r =&gt; r.RequestId == key &amp;&amp; r.ExceptionId == id); if (exists) { return; } throw new InteractiveException(message, id, key); }</span></span></code> </pre><br><br>  It remains to add only the record of omitted exceptions in the database.  For example, this can be done in Global.asax, the base controller, or where we expect similar communication with the user. <br><br>  In this simple way, we have achieved that the behavior of the desktop application that stores its state between user actions is emulated.  At the same time, the real state of the application is not stored anywhere, no resources are blocked, and no restrictions on the user response time are imposed. <br><br>  You can try this system in action at <a href="http://demo.oreodor.com/Parts/Main.aspx">http://demo.oreodor.com/Parts/Main.aspx#Order:Regular</a> .  The approach described in the article is used there when placing the order. <br><br>  The source code of the validation validity action is as follows: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> [Icon(ExtIcon.Accept)] public class OrderCompleteAction : IAction</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;IFormContext&lt;Order&gt;</span></span></span><span class="hljs-comment">&gt; { </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">  1 </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> private Guid e1 = new Guid("84099696-2225-41F9-AF54-0BE66367CEAA"); </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">  1 </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> private Guid e2 = new Guid("26142EDB-3DC8-4B00-920F-FA33FC3ADF40"); </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="context"&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> public void Execute(IFormContext</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;Order&gt;</span></span></span><span class="hljs-comment"> context) { Assert.That(context.Item, Is.Not.Null, "   , !"); var cpus = context.Item.Items.Select(m =&gt; m.Linked) .OfType</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;Cpu&gt;</span></span></span><span class="hljs-comment">().Select(c =&gt; c.SocketType.SysName).ToHashSet(); var mbs = context.Item.Items.Select(m =&gt; m.Linked) .OfType</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;MotherBoard&gt;</span></span></span><span class="hljs-comment">().Select(c =&gt; c.SocketType.SysName).ToHashSet(); var coolers = context.Item.Items.Select(m =&gt; m.Linked) .OfType</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;Cooler&gt;</span></span></span><span class="hljs-comment">().SelectMany(c =&gt; c.Sockets.Select(m =&gt; m.Linked.SysName)).ToHashSet(); if (!cpus.IsSubsetOf(coolers)) { ExceptionHelper.Interactive(e1, "       ."); } if (!cpus.IsSubsetOf(mbs)) { ExceptionHelper.Interactive(e2, "       . ."); } context.Item.Status = Status.BuiltInStatuses.Work.ToEntity</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;Status&gt;</span></span></span><span class="hljs-comment">(); context.ShowMsgBox("   ."); } }</span></span></code> </pre></div><p>Source: <a href="https://habr.com/ru/post/142897/">https://habr.com/ru/post/142897/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../142888/index.html">The insides of jQuery. Search for event code</a></li>
<li><a href="../142890/index.html">Prototype data model</a></li>
<li><a href="../142892/index.html">Live Broadcast ALM Summit 2012</a></li>
<li><a href="../142893/index.html">New navigator on code examples Microsoft All-In-One Code Framework, MSDN, Windows 8 and much more</a></li>
<li><a href="../142895/index.html">An example of using Custom Destination in FreePBX</a></li>
<li><a href="../142900/index.html">APRX client in amateur radio APRS based on D-Link Dir-620</a></li>
<li><a href="../142901/index.html">Tried to type Zerg Rush in Google?</a></li>
<li><a href="../142902/index.html">The Chinese government again defended its: Google Drive is blocked in China</a></li>
<li><a href="../142903/index.html">New github charts to your attention</a></li>
<li><a href="../142904/index.html">Quick view of site statistics with a LiveInternet counter</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>