<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Once again about Hyper-Threading</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There was a time when it was necessary to evaluate memory performance in the context of Hyper-threading technology . We came to the conclusion that it...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Once again about Hyper-Threading</h1><div class="post__text post__text-html js-mediator-article">  There was a time when it was necessary to evaluate <a href="http://composter.com.ua/content/hyper-threading-i-proizvoditelnost-pamyati-2014-12-16" title="Hyper-threading and memory performance">memory performance in the context of Hyper-threading technology</a> .  We came to the conclusion that its influence is not always positive.  When the free time quantum appeared, there was a desire to continue research and consider the processes taking place with an accuracy of machine clock ticks and bits using the software of our own design. <a name="habracut"></a><br><br><h3>  Explored platform </h3><br>  The object of the experiments is an ASUS N750JK laptop with an Intel Core i7-4700HQ processor.  Clock speed 2.4GHz, increased in Intel Turbo Boost mode to 3.4GHz.  Installed 16 gigabytes of DDR3-1600 RAM (PC3-12800), working in dual channel mode.  The operating system is Microsoft Windows 8.1 64 bits. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/863/5f0/502/8635f050208535da999dc43c5a33d795.jpg" alt="image"><br>  Fig.1 Configuration of the platform under study. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The processor of the platform under investigation contains 4 cores, which, when enabled, Hyper-Threading technology provides hardware support for 8 threads or logical processors.  This information Firmware platform transmits the operating system through the ACPI-table MADT (Multiple APIC Description Table).  Since the platform contains only one memory controller, the System Resource Affinity Table (SRAT) table, which declares the proximity of the processor cores to the memory controllers, is absent.  Obviously, the laptop under study is not a <a href="https://ru.intel.com/business/community/index.php%3Fautomodule%3Dblog%26blogid%3D59442%26showentry%3D5024" title="On the other side of the NUMA API">NUMA platform</a> , but the operating system, for the purpose of unification, treats it as a NUMA system with a single domain, as indicated by the line NUMA Nodes = 1. The fact of principle for our experiments is that the first level data cache size 32 kilobytes for each of the four cores.  Two logical processors dividing one core share the first and second level cache memory. <br><br><h3>  Operation under investigation </h3><br>  We will explore the dependence of the speed of reading a block of data on its size.  To do this, we choose the most efficient method, namely, reading 256-bit operands using the AVX instruction VMOVAPD.  On the graphs, the block size is plotted along the X axis, and the read speed is along the Y axis.  In the vicinity of point X, which corresponds to the size of the first-level cache, we expect to see the inflection point, since performance should drop after the block being processed goes beyond the cache memory.  In our test, in the case of multi-threaded processing, each of the 16 initiated threads works with a separate address range.  To control the Hyper-Threading technology within the application, each thread uses the SetThreadAffinityMask API function, which sets a mask in which each logic processor has one bit.  A single bit value allows the specified processor to use the specified stream, a zero value - prohibits.  For 8 logical processors of the platform under study, mask 11111111b allows using all processors (Hyper-Threading is enabled), mask 01010101b allows using one logical processor in each core (Hyper-Threading is disabled). <br><br>  The following abbreviations are used on the graphs: <br><br>  <b>MBPS (Megabytes per Second)</b> - <i>block read speed in megabytes per second</i> ; <br><br>  <b>CPI (Clocks per Instruction)</b> - the <i>number of cycles per instruction</i> ; <br><br>  <b>TSC (Time Stamp Counter)</b> - <i>CPU clock counter</i> . <br><br>  Note. The clock frequency of the TSC register may not correspond to the processor clock frequency when operating in Turbo Boost mode.  This must be taken into account when interpreting the results. <br><br>  On the right side of the graphs, a hexadecimal dump of instructions that make up the cycle body of the target operation performed in each of the program streams, or the first 128 bytes of this code, is visualized. <br><br><h2>  Experience number 1.  One thread </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/ede/a98/047/edea980479f3fe210978f20325d58891.jpg" alt="image"><br>  <b>Fig.2</b> <i>Reading in one thread</i> <br><br>  The maximum speed of 213563 megabytes per second.  The inflection point occurs when the block size is about 32 kilobytes. <br><br><h2>  Experience number 2.  16 threads on 4 processors, Hyper-Threading off </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/618/fc4/0f9/618fc40f9d9cbbd65170c409d72d4668.jpg" alt="image"><br>  <b>Fig.3</b> <i>Reading in sixteen threads.</i>  <i>The number of logical processors used is four</i> <br><br>  Hyper-Threading is turned off.  The maximum speed of 797598 megabytes per second.  The inflection point occurs when the block size is about 32 kilobytes.  As expected, compared to reading with one thread, the speed increased approximately 4 times, in the number of working cores. <br><br><h2>  Experience number 3.  16 threads per 8 processors, Hyper-Threading enabled </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/325/a19/28b/325a1928b5c5a79e9c13d52288245f2d.jpg" alt="image"><br>  <b>Fig.4</b> <i>Reading in sixteen threads.</i>  <i>The number of logical processors used is equal to eight</i> <br><br>  Hyper-threading enabled.  The maximum speed of 800722 megabytes per second, as a result of the inclusion of Hyper-Threading almost did not grow.  Big minus - the inflection point occurs when the block size is about 16 kilobytes.  The inclusion of Hyper-Threading slightly increased the maximum speed, but the speed drop now occurs at half the size of the block - about 16 kilobytes, so the average speed dropped significantly.  This is not surprising, each core has its own first-level cache, while logical processors of the same core share it. <br><br><h2>  findings </h2><br>  The investigated operation is quite well scaled on a multi-core processor.  Causes - each of the cores contains its own cache memory of the first and second levels, the size of the target block is comparable to the size of the cache memory, and each of the threads works with its own address range.  For academic purposes, we created such conditions in a synthetic test, realizing that real applications are usually far from ideal optimization.  But the inclusion of Hyper-Threading, even in these conditions gave a negative effect, with a small increase in peak speed, there is a significant loss in the processing speed of blocks whose size is in the range from 16 to 32 kilobytes. </div><p>Source: <a href="https://habr.com/ru/post/248359/">https://habr.com/ru/post/248359/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../248343/index.html">PCI DSS Virtualization Guide. Part 3</a></li>
<li><a href="../248345/index.html">How to sell Fortune 500 to the state and other terrible organizations</a></li>
<li><a href="../248351/index.html">Not all antiviruses are equally useful: Sergey Gordeychik and Vladimir Kropotov webinar</a></li>
<li><a href="../248353/index.html">Incremental backup on the fly using Quick Backup - a new feature of Veeam Backup & Replication v8</a></li>
<li><a href="../248357/index.html">PLC100 + LabVIEW + joystick</a></li>
<li><a href="../248369/index.html">LinkMeUp. Issue number 23. Compass-EOS - the first router with optical switching within the board</a></li>
<li><a href="../248371/index.html">Unity3D - crossfade, the basics of working with sound (lesson)</a></li>
<li><a href="../248373/index.html">Android launchers. Three developer mistakes</a></li>
<li><a href="../248377/index.html">Handling custom gestures for Leap Motion. Part 1</a></li>
<li><a href="../248379/index.html">Simple "iron" terminal</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>