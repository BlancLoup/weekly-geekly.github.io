<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Look in looking-glass</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A great example of network solidarity is the numerous services of looking-glass, which allow you to look behind the scenes of so many large and small ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Look in looking-glass</h1><div class="post__text post__text-html js-mediator-article">  A great example of network solidarity is the numerous services of looking-glass, which allow you to look behind the scenes of so many large and small networks around the world.  It is so amazing in today's world, hidden behind hundreds of security systems, just to pick up and execute commands on routers that are among the most critical devices in the entire data transmission infrastructure. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/09b/934/b1b/09b934b1be064154b10a285f5512f596.png" alt="looking-glass version6"></div><br><br>  You just need to enter the IP address or prefix in the field and get in reply the routing table or trace and the results of the <i>ping</i> utility.  Therefore, when you understand that it is possible to enter not only addresses, but also some other characters formed into meaningful commands and to receive meaningful results, a stupor occurs.  I want to run and shout at all corners: "But what is it that should be immediately banned, what kind of absurdity?"  These are all the consequences of recent years, when security is above openness and convenience, and there are undoubtedly reasons for that. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It will be a question of the very popular implementation of looking-glass from version6.net and that something can be obtained from this service. <br><a name="habracut"></a><br>  If you suddenly find it normal that the looking-glass interface allows you to enter something other than an IP address, then you probably belong to the ‚Äúold school‚Äù or do not read the news.  It seemed to me unusual, especially since other implementations of this service do not allow this. <br><br><ul><li>  In <a href="http://lg.retn.net/">ReTN</a> (quite a popular implementation), all entered characters are treated as a domain name, if it is not an IP address. </li><li>  <a href="http://www.msk-ix.ru/network/lookingglass.html">MSX-IX</a> everything is divided into parts, you can enter, but only where it is provided and interpreted everything is quite rigid. </li><li>  <a href="http://dataix.ru/rus/s/11/looking_glass.html">Data IX</a> allows some freedom, although it reports that the IP address is not specified: <i>‚ÄúAn invalid argument is</i> specified <i>‚Äî it must be IP or IP / n‚Äù</i> <i>‚Äîbut</i> still <i>birdc</i> is executed, which reports an error and filters all obscenities. </li><li>  And <a href="https://lg.vk.com/">Vkontakte is</a> allowed only <i>ping</i> and <i>traceroute</i> and only with IP addresses. </li></ul><br>  Since it was unusual for me, I even began to warn the owners of services about it, but then I <a href="https://github.com/Cougar/lg">looked into the code</a> and realized that it should be so - this is a feature, not a bug.  On the site <a href="http://wiki.version6.net/LG">version6.net</a> , which is now for some reason not available, the functionality is honestly written: <i>" <b>all BGP show commands</b> , ping and traceroute"</i> . <br><br>  Open <i>lg.cgi</i> , which is hard to read and Perl does not help at all: <br><br><blockquote><pre><code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">my</span></span> %FORM = &amp;cgi_decode($incoming); ... $FORM<span class="hljs-string"><span class="hljs-string">{addr}</span></span> =~ <span class="hljs-regexp"><span class="hljs-regexp">s/\s.*//</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (($FORM<span class="hljs-string"><span class="hljs-string">{query}</span></span> eq <span class="hljs-string"><span class="hljs-string">"ping"</span></span>) || ($FORM<span class="hljs-string"><span class="hljs-string">{query}</span></span> eq <span class="hljs-string"><span class="hljs-string">"trace"</span></span>)); $FORM<span class="hljs-string"><span class="hljs-string">{addr}</span></span> =~ <span class="hljs-regexp"><span class="hljs-regexp">s/[^\s\d\.:\w\-_\/\$]//g</span></span>;</code> </pre> </blockquote><br>  The command is transmitted in the <i>$ addr</i> variable, in which all characters except whitespace (including tabs, <i>\ s</i> option), letters, numbers, symbols "-", "_", "/", "$", ".", " <i>Are</i> deleted: ". <br><br>  The <i>ping</i> condition is much stricter.  As far as I can see, all input is wiped after the whitespace.  Therefore, adding something extra to the <i>ping</i> and <i>traceroute</i> commands is much more difficult. <br><br><blockquote><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $command = <span class="hljs-keyword"><span class="hljs-keyword">sprintf</span></span>($query_cmd, $FORM<span class="hljs-string"><span class="hljs-string">{addr}</span></span>); ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($FORM<span class="hljs-string"><span class="hljs-string">{addr}</span></span> !~ <span class="hljs-regexp"><span class="hljs-regexp">/^[\w\.\^\$\-\/ ]*$/</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($FORM<span class="hljs-string"><span class="hljs-string">{addr}</span></span> =~ <span class="hljs-regexp"><span class="hljs-regexp">/^[\w\.\^\$\-\:\/ ]*$/</span></span>) { ... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { &amp;print_error(<span class="hljs-string"><span class="hljs-string">"Illegal characters in parameter string"</span></span>); } }</code> </pre></blockquote><br>  Then a command is formed for direct execution from the <i>$ query_cmd</i> template and a check is made that the input belongs to a slightly different group of characters: tabs are excluded, because spaces are clearly indicated, the "_" symbol remains included because it falls under the <i>\ w</i> option with numbers, the symbol appears ^ ".  Additional verification is done on ":", which is possible only when working with IPv6. <br><br>  That's all, the remaining checks are only on the empty line for some modes of operation.  The command for execution has already been formed earlier and it goes to the device without changes: <br><br><blockquote><pre> <code class="perl hljs">$FORM<span class="hljs-string"><span class="hljs-string">{addr}</span></span> = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($FORM<span class="hljs-string"><span class="hljs-string">{addr}</span></span> =~ <span class="hljs-regexp"><span class="hljs-regexp">/^[ ]*$/</span></span>); ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($query_cmd =~ <span class="hljs-regexp"><span class="hljs-regexp">/%s/</span></span>) { &amp;print_error(<span class="hljs-string"><span class="hljs-string">"Parameter missing"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($FORM<span class="hljs-string"><span class="hljs-string">{addr}</span></span> eq <span class="hljs-string"><span class="hljs-string">""</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { &amp;print_warning(<span class="hljs-string"><span class="hljs-string">"No parameter needed"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($FORM<span class="hljs-string"><span class="hljs-string">{addr}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ne</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>); } ... &amp;run_command($FORM<span class="hljs-string"><span class="hljs-string">{router}</span></span>, $router_list{$FORM<span class="hljs-string"><span class="hljs-string">{router}</span></span>}, $command);</code> </pre></blockquote><br>  What can we do?  From useful lost quotes, symbols "|", "?"  and all brackets.  But there are a lot left, even very much.  The command forming pattern looks like this (for Cisco): <br><br><blockquote><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">my</span></span> %valid_query = ( <span class="hljs-string"><span class="hljs-string">"ios"</span></span> =&gt; { <span class="hljs-string"><span class="hljs-string">"ipv4"</span></span> =&gt; { <span class="hljs-string"><span class="hljs-string">"bgp"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"show ip bgp %s"</span></span>, <span class="hljs-string"><span class="hljs-string">"advertised-routes"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"show ip bgp neighbors %s advertised-routes"</span></span>, <span class="hljs-string"><span class="hljs-string">"summary"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"show ip bgp summary"</span></span>, <span class="hljs-string"><span class="hljs-string">"ping"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"ping %s"</span></span>, <span class="hljs-string"><span class="hljs-string">"trace"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"traceroute %s"</span></span> }, ...</code> </pre></blockquote><br>  The basic <i>show ip bgp</i> , <i>ping,</i> and <i>traceroute</i> commands.  Obviously, <i>show ip bgp summary</i> and <i>show ip bgp neighbors% s advertised-routes</i> can be formed from <i>show ip bgp% s</i> . <br><br><h1>  show ip bgp </h1><br>  Our bread.  It should be noted that on different sites, additional filtering is still done, or refinement for other systems other than the standard ones, therefore, it is not always possible to enter arbitrary characters.  Rather, it is even possible, but further execution of commands leads to errors.  However, if we have the basic devices provided in the original code, we can enter a wide range of commands.  Site Cisco, we will stop on one vendor, offers <a href="http://www.cisco.com/c/en/us/td/docs/ios/iproute_bgp/command/reference/irg_book/irg_bgp5.html">many options</a> .  Some useful, for example. <br><br><h2>  show ip bgp regexp </h2><br>  We look at all the routes for a given AS-PATH.  For example, <a href="http://lg.ttk.ru/%3Fquery%3Dbgp%26protocol%3DIPv4%26addr%3Dregexp%2B13238%2524%26router%3Dsgm01rb">to all Yandex networks from Stockholm, TTK</a> (GET will send directly to the query results): <br><br><div class="spoiler">  <b class="spoiler_title">show ip bgp regexp $ 13238</b> <div class="spoiler_text"><pre>  Router: sgm01rb 
 Command: show bgp regexp $ 13238


 Sat Dec 19 16: 30: 21.141 UTC
 BGP router identifier 10.146.0.1, local AS number 20485
 BGP generic scan interval 60 secs
 BGP table state: Active
 Table ID: 0x0 RD version: 0
 BGP main routing table version 2995757495
 BGP scan interval 60 secs

 Status codes: s suppressed, damped, history, valid,&gt; best
               i - internal, r RIB-failure, S stale, N Nexthop-discard
 Origin codes: i - IGP, e - EGP,?  - incomplete
    Network Next Hop Metric LocPrf Weight Path
 Route Distinguisher: 20485: 1 (default for vrf internet)
 *&gt; i5.45.192.0 / 18 10.78.0.6 1000 70 0 13238 i
 * i 10.99.0.8 1000 70 0 13238 i
 * 149.6.168.201 1000 70 0 174 13238 i
 * 166.63.220.185 1000 70 0 1273 9002 13238 i
 * 212.73.250.153 1000 60 0 3356 13238 i
 * 213.248.99.221 1000 70 0 1299 13238 i
 *&gt; i5.45.194.0 / 24 10.78.0.6 1000 70 0 13238 i
 * i 10.99.0.8 1000 70 0 13238 i
 * 212.73.250.153 1000 60 0 3356 13238 i
 * 213.248.99.221 1000 70 0 1299 13238 i
 *&gt; i5.45.196.0 / 24 10.78.0.6 1000 70 0 13238 i
 * i 10.99.0.8 1000 70 0 13238 i
 * 149.6.168.201 1000 70 0 174 13238 i
 * 166.63.220.185 1000 70 0 1273 9002 13238 i
 * 212.73.250.153 1000 60 0 3356 13238 i
 * 213.248.99.221 1000 70 0 1299 13238 i
 *&gt; i5.45.202.0 / 24 10.78.0.6 1000 70 0 13238 i
 * i 10.99.0.8 1000 70 0 13238 i
 * 212.73.250.153 1000 60 0 3356 13238 i
 * 213.248.99.221 1000 70 0 1299 13238 i
 ... </pre></div></div><br><h2>  show ip bgp neighbors </h2><br>  Detailed information about established neighborhoods.  The command is sometimes indirectly available in the highlighted output when executing other commands.  For example, detailed information about one of the <a href="http://lg.corbina.ru/">Beeline</a> neighborhoods <a href="http://lg.corbina.ru/">in Stavropol:</a> <br><br><div class="spoiler">  <b class="spoiler_title">show ip bgp neighbors 10.255.0.2</b> <div class="spoiler_text"><pre> Router: len244-bb.stv 
 Command: show ip bgp neigh


 BGP neighbor is 10.255.0.2, remote AS 3216, external link
   BGP version 4, remote router ID 79.104.32.226
   BGP state = Established, up for 1y5w
   Last read 00:00:40, last write 00:00:14, hold time is 180, keepalive interval is 60 seconds
   Neighbor sessions:
     1 active, is not multisession capable
   Neighbor capabilities:
     Route refresh: advertised and received (new)
     Four-octets ASN Capability: advertised and received
     Address family IPv4 Unicast: advertised and received
     Multisession Capability: advertised
   Message statistics:
     InQ depth is 0
     OutQ depth is 0
    
                          Sent Rcvd
     Opens: 1 1
     Notifications: 0 0
     Updates: 1,352
     Keepalives: 631466 635532
     Route Refresh: 0 0
     Total: 631468 635885
   Default minimum time between advertisement runs is 30 seconds

  For address family: IPv4 Unicast
   Session: 10.255.0.2
   BGP table version 182470946, neighbor version 182470946/0
   Output queue size: 0
   Index 77
   77 update-group member
   Incoming update prefix filter list is B2B-BRAS-IN
   Outgoing update filter list prefix is ‚Äã‚ÄãDENY-ALL
   Slow-peer detection is disabled
   Slow-peer split-update-group dynamic is disabled
                                  Sent Rcvd
   Prefix activity: ---- ----
     Prefixes Current: 0 1 (Consumes 52 bytes)
     Prefixes Total: 0 176
     Implicit Withdraw: 0 0
     Explicit Withdraw: 0 175
     Used as bestpath: n / a 1
     Used as multipath: n / a 0

                                    Outbound inbound
   Local Policy Denied Prefixes: -------- -------
     prefix-list 16426 0
     Well-known Community: 126392327 n / a
     Bestpath from this peer: 347 n / a
     Suppressed due to dampening: 15381 n / a
     Invalid Path: 2886275 n / a
     Total: 129310756 0
   Maximum prefixes allowed 500
   Threshold for warning message 75%, restart interval 3 min
   Number of NLRIs in the update sent: max 0, min 0
   Last detected as dynamic slow peer: never
   Dynamic slow peer recovered: never

 Datagrams (max data segment is 1460 bytes):
 Rcvd: 1268112 (out of order: 0), with data: 635885, total data bytes: 12089768
 Sent: 1265174 (retransmit: 1 fastretransmit: 0), with data: 631468, total data bytes: 11997935

 ...
</pre></div></div><br>  You can expand to <i>advertised-routes</i> to see which routes are advertised in the direction of a certain neighbor, often present directly in the interface. <br><br><h2>  show ip bgp summary </h2><br>  The command is not always available directly, so you can try to bypass.  For example, for <a href="http://lg.rtcomm.ru/lg.php">RTCOMM</a> : <br><br><div class="spoiler">  <b class="spoiler_title">show ip bgp summary</b> <div class="spoiler_text"><pre> BGP router identifier 81.176.81.18, local AS number 8342 
 RIB entries 1052472, using 64 MiB of memory 
 Peers 2, using 5024 bytes of memory 
 Peer groups 1, using 16 bytes of memory 

 Neighbor V AS MsgRcvd MsgSent TblVer InQ OutQ Up / Down State / PfxRcd 
 195.161.1.10 4 8342 42323357 15458 0 0 0 01w3d17h 574623 
 195.161.1.155 4 8342 43105981 15458 0 0 0 01w3d17h 574623 

 Total number of neighbors 2
</pre></div></div><br><h1>  Ping and traceroute </h1><br>  And these commands can be expanded: increase the size of the packet, turn off fragmentation.  But it is more difficult to do this, because the code for filtering is stricter.  Examples, however, can be found - <a href="http://lg.starnet.ru/">Starnet</a> , by the way here is Juniper: <br><br><div class="spoiler">  <b class="spoiler_title">ping count 5 detail do-not-fragment size 1200 8.8.8.8</b> <div class="spoiler_text"><pre> Router: MSK-IX MX480 
 Command: ping count 5 detail do-not-fragment size 1200 8.8.8.8


 PING 8.8.8.8 (8.8.8.8): 1200 data bytes
 1208 bytes from 8.8.8.8 via xe-3/3 / 0.0: icmp_seq = 0 ttl = 60 time = 1.041 ms
 1208 bytes from 8.8.8.8 via xe-3/3 / 0.0: icmp_seq = 1 ttl = 60 time = 0.964 ms
 1208 bytes from 8.8.8.8 via xe-3/3 / 0.0: icmp_seq = 2 ttl = 60 time = 0.959 ms
 1208 bytes from 8.8.8.8 via xe-3/3 / 0.0: icmp_seq = 3 ttl = 60 time = 32.190 ms
 1208 bytes from 8.8.8.8 via xe-3/3 / 0.0: icmp_seq = 4 ttl = 60 time = 1.038 ms

 --- 8.8.8.8 ping statistics ---
 5 packets transmitted, 5 packets received, 0% packet loss
 round-trip min / avg / max / stddev = 0.959 / 7.238 / 32.190 / 12.476 ms
 ...
</pre></div></div><br>  Looking-glass is a wonderful tool, even an excellent one that solves many problems and unites the ranks of networking professionals around the world, a very clear sign of a company's maturity.  Having mentioned several different companies, in my own I have not yet decided to put such a service outside. <br><br>  You can experiment for a long time, LG services are available a lot around the world and a sufficient number of them are built on the version offered by version6.net.  But any tool must be predictable, some of the unfiltered commands are terribly resource intensive, some open a little more than can be allowed in the modern world.  Take a look at your code and do it enough for you.  Be attentive to each other, mutual assistance and openness allowed to build the Internet, we will not destroy it. </div><p>Source: <a href="https://habr.com/ru/post/273517/">https://habr.com/ru/post/273517/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../273497/index.html">Taming UEFI SecureBoot</a></li>
<li><a href="../273505/index.html">Open lecture: the problem of the feasibility of Boolean formulas</a></li>
<li><a href="../273509/index.html">Immersion in ASP.NET 5 Runtime</a></li>
<li><a href="../273511/index.html">Paul Graham: The Word "Hacker"</a></li>
<li><a href="../273513/index.html">Why and how do we back up github</a></li>
<li><a href="../273519/index.html">Underground carders market. Translation of the book "KingPIN". Chapter 22. "Enemies"</a></li>
<li><a href="../273523/index.html">Another "critical" "vulnerability" "VPN" and why Port Fail is nonsense</a></li>
<li><a href="../273525/index.html">Multiplication by the method of Russian peasants</a></li>
<li><a href="../273527/index.html">Apple guidelines for iOS apps are out of date</a></li>
<li><a href="../273533/index.html">Translation: What I learned by developing an API for the Microsoft cloud platform</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>