<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Sylph: Deep Stubs for tests from the creators of PHPixie, or how to convert an array to a class</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One of the most necessary things when writing unit tests is the creation of mocks and stubs for objects that are used by the class under test. Here it...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Sylph: Deep Stubs for tests from the creators of PHPixie, or how to convert an array to a class</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/c8c/cdf/42e/c8ccdf42ec34ca6dd830077e79760cb9.jpg" alt="Unit Testing Sylph" align="right"><br>  One of the most necessary things when writing unit tests is the creation of mocks and stubs for objects that are used by the class under test.  Here it is worth mentioning the important difference: if the ‚Äúmock‚Äù is the original object in which the replacement of one or several methods, then the ‚Äústub‚Äù is a kind of fake that completely replaces the original object.  depending on the scenario, it is sometimes much easier to create a stub than to make a suitable mock.  In this article, I will show how to effectively and quickly create stubs using a small Sylph class from the creators of the <a href="http://phpixie.com/">PHPixie</a> framework. <br><a name="habracut"></a><br><br>  Sometimes there are cases when the test method uses deep properties of an object for example: <br><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Fairy</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $name; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $home_tree; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name, $home_tree)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;name = $name; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;home_tree = $home_tree; } <span class="hljs-comment"><span class="hljs-comment">//           //      public function get_friends(){ $friends = $this-&gt;home_tree-&gt;num_squirrels; $friends += $this-&gt;home_tree-&gt;forest-&gt;num_animals('bunny')); return $friends; }</span></span></code> </pre> <br><br>  When writing a test for such a class, we would have to take the Tree and Forest classes, link them together, and pass them to the constructor.  And all for the sake of calling one function. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="https://github.com/dracony/Sylph">Sylph</a> makes this much easier by using simple associated arrays and anonymous functions.  In our case, we could describe $ home_tree as: <br><br><pre> <code class="php hljs">$sylph = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \PHPixie\Sylph(); $home_tree = $sylph-&gt;cast(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'num_squirrels'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">'forest'</span></span> =&gt; $sylph-&gt;cast(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'num_animals'</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($animal)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($animal == <span class="hljs-string"><span class="hljs-string">'bunny'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>(<span class="hljs-string"><span class="hljs-string">'Animal not found'</span></span>); } )) ));</code> </pre><br><br>  This approach has a number of advantages, first of all, much better readability and conciseness. <br>  By the way, the use of anonymous functions allows you to do quite interesting operations, for example, to change parameters on the fly: <br><br><pre> <code class="php hljs">$num_bunnies = <span class="hljs-number"><span class="hljs-number">5</span></span>; $bunnies = $sylph-&gt;cast(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'add'</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($new)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($num_bunnies)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $new + $num_bunnies; } )); $bunnies-&gt;add(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-comment"><span class="hljs-comment">// 6 $bunnies-&gt;add(2); // 7 $num_bunnies = 2; $bunnies-&gt;add(1); // 3 $bunnies-&gt;add(2); // 4</span></span></code> </pre><br><br>  As always, the PHPixie developers try to find the easiest solution to the problem. </div><p>Source: <a href="https://habr.com/ru/post/189360/">https://habr.com/ru/post/189360/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../189346/index.html">ASP.NET 2.0 Login control + MySQL, VS2008, authorization of users on the site</a></li>
<li><a href="../189348/index.html">John Carmack joins Oculus and ... still remains in id Software</a></li>
<li><a href="../189350/index.html">As I wrote the update module on C #</a></li>
<li><a href="../189352/index.html">Interaction of php-soap on linux with certificate authorization using GOST algorithms</a></li>
<li><a href="../189356/index.html">Trace - Tracker for Extremes</a></li>
<li><a href="../189362/index.html">Technology Real Time MapReduce in Yandex. How to speed up something very big</a></li>
<li><a href="../189366/index.html">MODX EVO store - the first repository for MODX EVOLUTION</a></li>
<li><a href="../189370/index.html">10Gbit network storage - 2</a></li>
<li><a href="../189372/index.html">Elementary OS RC1</a></li>
<li><a href="../189374/index.html">NASA launched the first Russian-language site</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>