<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>CleverStyle Framework 6 Evolution</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, the first release of the 6.x branch was released, which means that in addition to the rejected backwards compatibility, there are also innov...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>CleverStyle Framework 6 Evolution</h1><div class="post__text post__text-html js-mediator-article"><p>  Recently, the first release of the 6.x branch was released, which means that in addition to the rejected backwards compatibility, there are also innovations that I would like to talk about. </p><br><blockquote>  Previous changes: <a href="http://habrahabr.ru/post/244311/">part 1</a> , <a href="http://habrahabr.ru/post/255139/">part 2</a> , <a href="https://habrahabr.ru/post/275139/">part 3</a> , <a href="https://habrahabr.ru/post/302944/">part 4</a> , <a href="https://habrahabr.ru/post/307626/">part 5</a> . </blockquote><p><br>  In general, each new release simplifies the framework itself, minor features are removed (they can be implemented without interfering with the framework core), new ones appear, and those that remain are polished. </p><br><p>  It is also becoming increasingly important to give the developer the opportunity to abandon the built-in functionality that can lead to overheads.  This allows you to speed up the development at the expense of suitable built-in functionality, but at the same time not incur the inevitable overhead for what is not used. </p><a name="habracut"></a><br><h4 id="eschyo-bolee-legkiy-i-bystryy-frontend">  Lighter and faster front end </h4><br><p>  Even in versions 5.x, the work with the multi-lingual interface became asynchronous.  At 6.x, translation downloads became asynchronous, as well as the connection of the sprintf.js library. <br>  In general, this means two things: </p><br><ul><li>  the static cache has ceased to be language dependent, that is, when you switch the interface language, you will load another translation file, but everything else will be loaded from the cache without changes </li><li>  if you do not use this functionality, you do not download extra code </li></ul><br><p>  This means that if you do not need support for web components and you will not use translations in the frontend, then the overhead framework (at the time of release) in production: </p><br><ul><li>  371 bytes of CSS (178 bytes of gzip) </li><li>  24,846 bytes JS (8371 bytes gzip) </li></ul><br><p>  This is quite a bit (almost half of this volume is occupied by Alameda, the modern version of RequireJS). </p><br><p>  But even this is not the limit, in the near future I plan to write an article on how statics caching in the framework works, there will be information on how you can give up 100% of the framework's frontend in production, how to integrate your build system if you wish, and so on ( so far you can read a new page of <a href="">documentation</a> ). </p><br><h4 id="proizvoditelnost-frontenda">  Frontend performance </h4><br><p>  On the front end, the performance of system events has been improved, and, more importantly, translation downloads. </p><br><p>  The fact is that translations on the frontend can be used either as strings or as methods.  In the second case, you can pass some arguments and get a formatted string with the given parameters: </p><br><pre><code class="javascript hljs">cs.Language(<span class="hljs-string"><span class="hljs-string">'system_profile_'</span></span>).ready().then(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">L</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(L.hello(<span class="hljs-string"><span class="hljs-string">'Guest'</span></span>)); <span class="hljs-comment"><span class="hljs-comment">// , Guest! });</span></span></code> </pre> <br><p>  At the same time, several new functions were created for each key in the translations.  This is not a problem if there are only a few keys, but when there are several hundred of them, this is noticeable. </p><br><p>  As a result of refactoring, it was possible to reduce the number of created functions to one per key. </p><br><p>  The performance of some commonly used user elements is also improved. </p><br><p>  <code>cs-icon</code> sometimes has more than a hundred copies on a page, so its speed is very important, in recent versions (starting with the latest 5.x) it supports from 1 to 2 icons (earlier it was possible more) and renders them much faster, avoiding adding / delete items in its shadow tree. </p><br><h4 id="mysql-strict-mode">  MySQL strict mode </h4><br><p>  MySQL is forced into strict mode.  This avoids a number of unpleasant problems, including security issues. </p><br><p>  As a result of the inclusion of strict mode, several minor problems were found, now they are fixed and covered with tests. </p><br><h4 id="xss">  Xss </h4><br><p>  Continuing the topic of security - the implementation of the <code>xap()</code> function used everywhere to clear input data has been rewritten and is now based on HTML Purifier.  Now this function is truly safe, it used to be the same as it turned out. </p><br><h4 id="cscrud_helpers">  cs \ CRUD_helpers </h4><br><p>  In multilingual configurations, this treit did not always correctly search.  The search could not take into account the multilingual parameters when searching and sorting data by its own fields of the table, now its own fields, and the fields of the related tables are always taken into account correctly. </p><br><p>  Also, a search in a multilingual configuration now always uses the current system language, and does not allow to specify it as a parameter (otherwise, sometimes it was not strange docking that turned out when the main table uses one language, but related another). </p><br><h4 id="servernye-optimizacii">  Server optimizations </h4><br><p>  System classes actively use traits, but in some cases loading traits may not be very rational (for example, a trait involved in building a static cache is not needed when processing API requests). </p><br><p>  Now a number of system traits have been refactored into independent classes, which are loaded only when they are really needed. </p><br><p>  A number of small optimizations found during profiling were also made.  For example, on the server, a significant percentage of the execution time was taken by loading translations from the cache (in fact, JSON deserialization), which was not always used for query APIs and with multilingual support turned off.  In such scenarios, translation downloads no longer occur, it is delayed until real use. </p><br><p>  Now, under the usual Apache2 + PHP7, the rendering time of a simple page starts from 0.8 ms, that is 0.0008 s, which was previously possible only under HHVM. </p><br><h4 id="udalena-podderzhka-ie">  IE support removed </h4><br><p>  The framework no longer supports Internet Explorer, basic IE11 support is available in the Old IE module, IE10 is not supported at all. </p><br><p>  In the next major version, most likely, IE11 will also be dropped, and the last 2 stable versions of Edge will be supported, however, the same is true with all other major browsers (sometimes people remember Safari 5 on Windows, but this is no longer funny). </p><br><h4 id="polirovka-vnutrennih-interfeysov-i-struktury">  Polishing of internal interfaces and structures </h4><br><p>  The polishing of the internal API of system objects continued. </p><br><p>  You no longer need to use additional methods to store / retrieve some system configuration fields. </p><br><p>  The supported fields themselves are now defined by the special class <code>cs\Config\Options</code> (previously taken from the JSON file), which, in addition to the field name and default values, also returns additional metadata, which, in principle, is enough to automatically build the UI, which in Future versions will be used to fully manage the system configuration via the CLI interface. </p><br><p>  Fixed the order of calls to initialization methods and constructor in <code>cs\Singleton</code> , which caused some problems when working in HTTP server mode. </p><br><p>  Historically, the use of <code>includes</code> renamed to <code>assets</code> (this resulted in the renaming of directories for the entire project), which is a much more common name. </p><br><p>  On this wave, the static structure was transferred from a separate <code>includes/map.json</code> to the <code>assets</code> key of a shared file with meta-information of the <code>meta.json</code> module, which stores information on supported languages, databases, dependencies and other details. </p><br><p>  Another great renaming steel engines.  Different implementations of working with cache, database and storage were called engines, while in the connection parameters to the database one could see the type of database ( <code>type</code> ), and such connections were found in the repositories. </p><br><p>  All of this is now consistently referred to as <code>drivers</code> / <code>driver</code> so as not to confuse anyone (including himself) with confusion. </p><br><h4 id="udalenie-vtorostepennyh-funkciy">  Removing secondary functions </h4><br><p>  From early alpha versions to the last release, the framework had two mechanisms for blocking users: </p><br><ul><li>  temporary blocking of the user until a certain point in the future </li><li>  temporary blocking of the user and IP after several failed login attempts </li></ul><br><p>  Both of these locks were primitive in secondary, and therefore removed.  For the second blocking, several system events appeared that allow you to return this functionality, and even more, with the help of third-party modules. </p><br><h4 id="prochie-novye-fichi">  Other new features </h4><br><p>  The blog module has added support for SQLite in the blog module. </p><br><p>  A patch has been added over the already used <code>wp-cli/wp-cli-tools</code> package that implements an HTML-like syntax for formatting answers in the CLI interface (designed in the form of <a href="https://github.com/wp-cli/php-cli-tools/pull/100">PR 100</a> , but somehow the developers did not rush to accept the patch, I decided not to wait any longer). <br>  The patch allows instead of: </p><br><pre> <code class="hljs perl">%gCleverStyle Framework%n version %y$version%n, CLI interface</code> </pre> <br><p>  Write this: </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">g</span></span></span><span class="hljs-tag">&gt;</span></span>CleverStyle Framework<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">g</span></span></span><span class="hljs-tag">&gt;</span></span> version <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">y</span></span></span><span class="hljs-tag">&gt;</span></span>$version<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">y</span></span></span><span class="hljs-tag">&gt;</span></span>, CLI interface</code> </pre> <br><p>  And even nested tags are supported, which is very painful to do without this patch. </p><br><p>  When using server-prepared expressions, you can now pass more parameters than you need, the extra ones will be discarded.  Sometimes it is convenient. </p><br><p>  Added support for the template string from ES2015 to the JS minifiers (if you suddenly use this without conversion to ES5). </p><br><p>  Translations are uploaded <a href="https://www.transifex.com/cleverstyle/cleverstyle-framework">to the Transifex service</a> , which should simplify translation into other languages ‚Äã‚Äãthat I myself do not know :) </p><br><h4 id="testirovanie-i-kachestvo-koda">  Testing and code quality </h4><br><p>  There are a lot more tests, they are much better and cover much of the code. </p><br><p>  All system classes are covered with tests, the majority is 100%, many are 98-99%, some very slightly less. </p><br><p>  Coverage of controllers began - the controllers responsible for user login / logout, password change / reset, user profile settings were covered first. </p><br><img src="https://habrastorage.org/files/cc6/868/c0d/cc6868c0de504eea9ce38160207b1811.png"><br><img src="https://habrastorage.org/files/ad9/6b4/1fc/ad96b41fc73446a393c843cb694a52dc.png"><br><p><br>  The real coverage is even more, because the APC cache driver is not tested (it runs in Travis CI, but I don‚Äôt have it locally), also in some packages build and installation tests, test coverage is disabled due to a <a href="https://bugs.xdebug.org/view.php%3Fid%3D1322">bug in Xdebug</a> , but the tests themselves chased away. </p><br><p>  The quality of the code according to Scrutinizer has significantly increased (not only the kernel code, but all modules in the repository are taken into account), almost 75% of the code has an A / B rating and there is no code with F rating: </p><br><img src="https://habrastorage.org/files/4c9/55e/358/4c955e3585ad4895bb035fe6f3073e4e.png"><br><br><h4 id="naposledok">  At last </h4><br><p>  Always glad to new ideas and constructive comments. <br>  ¬ª <a href="https://github.com/nazar-pc/CleverStyle-Framework">GitHub repository</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/312164/">https://habr.com/ru/post/312164/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../312146/index.html">Monitor client PCs in Microsoft AD with Zabbix. Part 2 - Template, Scripts and LLD</a></li>
<li><a href="../312148/index.html">We separate the interface and implementation in the functional style in C ++</a></li>
<li><a href="../312154/index.html">Donald Knut: ‚ÄúMy advice to the young‚Äù (93/97) and ‚ÄúFeeling the need to assert oneself‚Äù (9/97)</a></li>
<li><a href="../312158/index.html">Over RethinkDB clouds are gathering?</a></li>
<li><a href="../312162/index.html">Knowledge is power: we analyze product statistics and do not lose customers on the road of progress</a></li>
<li><a href="../312166/index.html">VIDEOMOST - VKS server in your pocket</a></li>
<li><a href="../312168/index.html">[Peter] Meeting with Gil Tene from Azul Systems about application response times</a></li>
<li><a href="../312172/index.html">Javascript six-character journey</a></li>
<li><a href="../312174/index.html">Autoscaling - a tool for automatic vertical scaling of resources (CPU | RAM | HDD)</a></li>
<li><a href="../312176/index.html">FSTEC: firewall requirements - 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>