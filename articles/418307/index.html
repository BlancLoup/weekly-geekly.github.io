<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Apple Machine Learning Tools</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the past few years, the topic of artificial intelligence and machine learning has ceased to be for people something from the realm of fiction and h...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Apple Machine Learning Tools</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/si/by/p7/sibyp7evcy3vtvyh7jthlpqh68m.png"></p><br><p>  In the past few years, the topic of artificial intelligence and machine learning has ceased to be for people something from the realm of fiction and has firmly entered everyday life.  Social networks offer to visit interesting events for us, cars on the roads have learned to move without driver participation, and a voice assistant in the phone tells you when to leave home to avoid traffic jams and whether you need to take an umbrella with you. </p><br><p>  In this article, we will look at the machine learning tools that Apple offers, analyze what the company has shown in this area at WWDC18, and try to understand how this can be put into practice. </p><a name="habracut"></a><br><h2 id="mashinnoe-obuchenie">  Machine learning </h2><br><p>  So, machine learning is a process in which the system, using certain data analysis algorithms and processing a huge number of examples, identifies patterns and uses them to predict the characteristics of new data. </p><br><p>  Machine learning was born from the theory that computers can learn on their own, while not yet programmed to perform certain actions.  In other words, unlike conventional programs with pre-entered instructions for solving specific problems, machine learning allows the system to learn how to recognize patterns and make predictions. </p><br><h2 id="bnns-i-cnn">  BNNS and CNN </h2><br><p>  Apple has been using machine learning technology on its devices for quite some time: Mail identifies emails containing spam, Siri helps you quickly find out the answers to your questions, Photos recognizes faces on images. </p><br><p>  At WWDC16, the company introduced two APIs based on neural networks - Basic Neural Network Subroutines (BNNS) and Convolutional Neural Networks (CNN).  BNNS is part of the Accelerate system, which is the basis for performing fast computing on the CPU, and CNN is the part of the Metal Performance Shaders library using the GPU.  More information about these technologies can be found, for example, <a href="http://machinethink.net/blog/apple-deep-learning-bnns-versus-metal-cnn">here</a> . </p><br><h2 id="core-ml-i-turi-create">  Core ML and Turi Create </h2><br><p>  In the past year, Apple announced a framework that significantly simplifies work with machine learning technologies - Core ML.  It is based on the idea of ‚Äã‚Äãtaking a pre-trained data model, and integrating it into your application in just a few lines of code. </p><br><p><img src="https://habrastorage.org/webt/eg/dl/rz/egdlrzk40ao2z5a_eijvug8dhbc.png"></p><br><p>  With Core ML you can implement many functions: </p><br><ul><li>  identification of objects in the photo and video; </li><li>  predictive text input; </li><li>  face tracking and recognition; </li><li>  motion analysis; </li><li>  definition of bar codes; </li><li>  text comprehension and recognition; </li><li>  image recognition in real time; </li><li>  stylization of images; </li><li>  and much more. </li></ul><br><p>  Core ML, in turn, uses low-level Metal, Accelerate and BNNS, and therefore the results of calculations occur very quickly. </p><br><p>  The kernel supports neural networks, generalized linear models, feature engineering, tree ensembles, support vector machines, and pipeline models. </p><br><p>  But Apple initially did not show its own technologies for creating and training models, but only made a converter for other popular frameworks: Caffe, Keras, scikit-learn, XGBoost, LIBSVM. </p><br><p>  Using third-party tools was often not the easiest task, the trained models were quite large, and the training itself took a lot of time. </p><br><p>  At the end of the year, the company introduced Turi Create - a framework for teaching models, the main idea of ‚Äã‚Äãwhich was ease of use and support for a large number of scenarios - image classification, object definition, recommender systems, and many others.  But Turi Create, despite its relative ease of use, only supported Python. </p><br><h2 id="create-ml">  Create ML </h2><br><p>  And this year, Apple, in addition to Core ML 2, finally showed its own tool for training models - the Create ML framework using Apple native technologies - Xcode and Swift. </p><br><p>  It works quickly, and creating model models using Create ML becomes really easy. </p><br><p>  At WWDC, impressive indicators of Create ML and Core ML 2 were announced on the example of the Memrise application.  If earlier it took 24 hours to train one model using 20 thousand images, then Create ML reduces this time to 48 minutes on a MacBook Pro and up to 18 minutes on iMac Pro.  The size of the trained model has decreased from 90MB to 3MB. </p><br><p>  Create ML allows you to use as source data images, texts and structured objects - for example, tables. </p><br><p><img src="https://habrastorage.org/webt/uk/di/2e/ukdi2ewm3e2ax6bbr3ceu_fymlu.png"></p><br><h2 id="klassifikaciya-izobrazheniy">  Image classification </h2><br><p>  Let's see how the classification of images works.  To train a model, we need an initial data set: take three groups of photos of animals: dogs, cats and birds and distribute them into folders with appropriate names, which will become the names of the categories of the model.  Each group contains 100 images with a resolution up to 1920x1080 pixels and up to 1Mb in size.  Photographs should be as different as possible, so that the trained model does not rely on features such as color in the image or the surrounding space. </p><br><p><img src="https://habrastorage.org/webt/w8/oz/_9/w8oz_9t_3_0fyz86xusotsdp9zi.png"></p><br><p>  Also, to test how well a trained model copes with the recognition of objects, a test data set is needed - images that are not included in the original dataset. </p><br><p>  Apple provides two ways to interact with Create ML: using UI on the MacOS Playground Xcode and programmatically using CreateMLUI.framework and CreateML.framework.  Using the first method, it is enough to write a couple of lines of code, transfer the selected images to the specified area, and wait until the model is trained. </p><br><p><img src="https://habrastorage.org/webt/b6/zb/w_/b6zbw_ihfbmt2lx0ovib4nmkfsk.gif"></p><br><p>  On the Macbook Pro 2017, in the maximum configuration, training took 29 seconds for 10 iterations, and the size of the trained model was 33Kb.  Looks impressive. </p><br><p>  Let's try to figure out how to achieve such indicators and what is ‚Äúunder the hood‚Äù. <br>  The task of image classification is one of the most popular use cases for convolutional neural networks.  For a start it is worth explaining what they are. </p><br><p>  A person, seeing an image of an animal, can quickly attribute it to a certain class on the basis of any distinctive features.  The neural network acts in a similar way, conducting a search for basic characteristics.  Accepting the initial array of pixels as input, it sequentially passes information through groups of convolutional layers and builds more and more complex abstractions.  On each subsequent layer, she learns to highlight certain signs ‚Äî first these are lines, then sets of lines, geometric shapes, body parts, and so on.  On the last layer, we get the output of a class or group of probable classes. </p><br><p>  In the case of Create ML, neural network training is not performed from scratch.  The framework uses a neural network previously trained on a huge data set, which already includes a large number of layers and has high accuracy. </p><br><p><img src="https://habrastorage.org/webt/go/qu/el/goquell4agcijc9duege4cg1ydw.png"></p><br><p>  This technology is called transfer learning.  With it, you can change the architecture of a pre-trained network so that it is suitable for solving a new problem.  The modified network is then trained on the new data set. </p><br><p>  Create ML during training extracts from the photo about 1000 distinctive features.  These can be the shapes of objects, the color of textures, the location of the eyes, the dimensions, and many others. <br>  It should be noted that the initial data set on which the used neural network is trained, like ours, may contain photographs of cats, dogs and birds, but it is precisely these categories that are not distinguished in it.  All categories form a hierarchy.  Therefore, it is impossible to simply apply this network in its pure form - it is necessary to train it on our data. </p><br><p>  At the end of the process, we see how accurately our model has been trained and tested after several iterations.  To improve results, we can increase the number of images in the original data set or change the number of iterations. </p><br><p><img src="https://habrastorage.org/webt/k1/rz/to/k1rzto4lzngwwfo46taxa9vnbms.png"></p><br><p>  Then we can check the model ourselves on a test dataset.  Images in it must be unique, i.e.  Do not enter the original set. </p><br><p><img src="https://habrastorage.org/webt/lw/u8/el/lwu8eld5v8q6jwqyeaygwkyzvwi.png"></p><br><p>  For each image, an indicator of <em>confidence</em> is displayed - how accurately a category was recognized using our model. </p><br><p>  For almost all photos, with rare exceptions, this figure was 100%.  I specifically added to the test dataset the image that you see above, and, as you can see, Create ML recognized the dog in 86% and the bird in 13%. </p><br><p>  The training of the model is completed, and all that remains is for us to save the * .mlmodel file and add it to our project. </p><br><p><img src="https://habrastorage.org/webt/vd/ey/xb/vdeyxbibcdbgd3f2jb6ozsrpa_u.png"></p><br><p>  To test the model, I wrote a simple application using the Vision framework.  It allows you to work with Core ML models and solve problems like image classification or object detection with their help. </p><br><p>  Our application will recognize the picture from the device‚Äôs camera and display the category and the percentage of confidence in the classification. </p><br><p>  We initialize the Core ML model to work with Vision and configure the query: </p><br><pre><code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupVision</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> visionModel = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>? <span class="hljs-type"><span class="hljs-type">VNCoreMLModel</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: <span class="hljs-type"><span class="hljs-type">AnimalsClassifier</span></span>().model) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">fatalError</span></span>(<span class="hljs-string"><span class="hljs-string">"Can't load VisionML model"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> request = <span class="hljs-type"><span class="hljs-type">VNCoreMLRequest</span></span>(model: visionModel) { (request, error) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> results = request.results <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.handleRequestResults(results) } requests = [request] }</code> </pre> <br><p>  Add a method that will process the results obtained VNCoreMLRequest.  Let's display only those whose confidence index is more than 70%: </p><br><pre> <code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleRequestResults</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> results: [</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">])</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> categoryText: <span class="hljs-type"><span class="hljs-type">String?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> { <span class="hljs-type"><span class="hljs-type">DispatchQueue</span></span>.main.async { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.categoryLabel.text = categoryText } } <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> foundObject = results .compactMap({ $<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">VNClassificationObservation</span></span> }) .first(<span class="hljs-keyword"><span class="hljs-keyword">where</span></span>: { $<span class="hljs-number"><span class="hljs-number">0</span></span>.confidence &gt; <span class="hljs-number"><span class="hljs-number">0.7</span></span> }) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { categoryText = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> category = categoryTitle(identifier: foundObject.identifier) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> confidence = <span class="hljs-string"><span class="hljs-string">"\(round(foundObject.confidence * 100 * 100) / 100)%"</span></span> categoryText = <span class="hljs-string"><span class="hljs-string">"\(category) \(confidence)"</span></span> }</code> </pre><br><p>  And the last thing is to add the delegate method AVCaptureVideoDataOutputSampleBufferDelegate, which will be called for each new frame from the camera and execute the query: </p><br><pre> <code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">captureOutput</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> output: AVCaptureOutput, didOutput sampleBuffer: CMSampleBuffer, from connection: AVCaptureConnection)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> pixelBuffer = <span class="hljs-type"><span class="hljs-type">CMSampleBufferGetImageBuffer</span></span>(sampleBuffer) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> requestOptions: [<span class="hljs-type"><span class="hljs-type">VNImageOption</span></span>: <span class="hljs-type"><span class="hljs-type">Any</span></span>] = [:] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cameraIntrinsicData = <span class="hljs-type"><span class="hljs-type">CMGetAttachment</span></span>( sampleBuffer, key: kCMSampleBufferAttachmentKey_CameraIntrinsicMatrix, attachmentModeOut: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) { requestOptions = [.cameraIntrinsics:cameraIntrinsicData] } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> imageRequestHandler = <span class="hljs-type"><span class="hljs-type">VNImageRequestHandler</span></span>( cvPixelBuffer: pixelBuffer, options: requestOptions) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> imageRequestHandler.perform(requests) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(error) } }</code> </pre> <br><p>  Let's check how well the model does its task: </p><br><p><img src="https://habrastorage.org/webt/fy/5k/fl/fy5kflqc3p02w0mo0dwgaar3vle.gif"></p><br><p>  The category is determined with rather high accuracy, and this is especially surprising when one considers how fast the training went and how small the initial data was.  Periodically, on a dark background, the model detects birds, but I think this is easily solved by increasing the number of images in the original dataset or increasing the minimum acceptable level of confidence. </p><br><p>  If we want to train the model to classify any other category, it‚Äôs enough to add a new group of images and repeat the process - it will take a few minutes. </p><br><p>  As an experiment, I made another data set in which I changed all the photos of cats in a photo of one cat from different angles, but on the same background and in the same environment.  In this case, the model began to almost always make mistakes and recognize the category in an empty room, apparently relying on color as a key feature. </p><br><p>  Another interesting feature presented in Vision only this year is the ability to recognize objects in the image in real time.  It is represented by the VNRecognizedObjectObservation class, which allows you to get a category of an object and its location - boundingBox. </p><br><p><img src="https://habrastorage.org/webt/fo/96/cb/fo96cbqh0flkktb9umjrfxxofu4.jpeg"></p><br><p>  Now Create ML does not allow to create models for the implementation of this functionality.  Apple suggests in this case to use Turi Create.  The process is not much more complicated than the above: it is necessary to prepare category folders with photos and a file in which the coordinates of the rectangle where the object is located will be indicated for each image. </p><br><h2 id="natural-language-processing">  Natural language processing </h2><br><p>  The following function, Create ML, is teaching models to classify texts in natural language ‚Äî for example, to determine the emotional coloring of sentences or to identify spam. </p><br><p><img src="https://habrastorage.org/webt/xv/fq/48/xvfq489qejhdwl_uitxcc-2yyii.png"></p><br><p>  To create a model, we must assemble a table with an initial data set ‚Äî sentences or whole texts related to a specific category ‚Äî and train it with a model using the MLTextClassifier object: </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> data = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">try</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MLDataTable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">contentsOf: URL(fileURLWithPath: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"/Users/CreateMLTest/texts.json"</span></span></span></span></span><span class="hljs-function">)) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">let</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">trainingData, testingData</span></span></span><span class="hljs-function">)</span></span> = data.randomSplit(<span class="hljs-keyword"><span class="hljs-keyword">by</span></span>: <span class="hljs-number"><span class="hljs-number">0.8</span></span>, seed: <span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> textClassifier = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">try</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MLTextClassifier</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">trainingData: trainingData, textColumn: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"text"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, labelColumn: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"label"</span></span></span></span></span><span class="hljs-function">) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">try</span></span></span><span class="hljs-function"> textClassifier.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">write</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">to: URL(fileURLWithPath: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"/Users/CreateMLTest/TextClassifier.mlmodel"</span></span></span></span></span><span class="hljs-function">))</span></span></code> </pre> <br><p>  In this case, the trained model has the type Text Classifier: </p><br><p><img src="https://habrastorage.org/webt/kg/j1/ws/kgj1wst4121ojpwfk73yehmte_m.png"></p><br><h2 id="tablichnye-dannye">  Tabular data </h2><br><p>  Let's take a closer look at another feature of Create ML - model training using structured data (tables). </p><br><p>  We will write a test application that predicts the price of an apartment based on its location on the map and other specified parameters. </p><br><p>  So, we have a table with abstract data about apartments in Moscow in the form of a csv file: the area of ‚Äã‚Äãeach apartment, the floor, the number of rooms and coordinates (latitude and longitude) are known.  In addition, the cost of each apartment is known.  The closer to the center or the larger the area, the higher the price. </p><br><p><img src="https://habrastorage.org/webt/hd/-w/77/hd-w77qhysj80_kapqbqddwdhyi.png"></p><br><p>  The task of Create ML will be to build a model capable of predicting the price of an apartment on the basis of the indicated signs.  Such a task in machine learning is called a regression problem and is a classic example of learning with a teacher. </p><br><p>  Create ML supports many models - Linear Regression, Decision Tree Regression, Tree Classifier, Logistic Regression, Random Forest Classifier, Boosted Trees Regression, and others. </p><br><p>  We will use the MLRegressor object, which, based on the input data, will select the best option itself. <br>  First, we initialize the MLDataTable object with the contents of our csv file: </p><br><pre> <code class="hljs lisp">let trainingFile = URL(<span class="hljs-name"><span class="hljs-name">fileURLWithPath</span></span>: <span class="hljs-string"><span class="hljs-string">"/Users/CreateMLTest/Apartments.csv"</span></span>) let apartmentsData = try MLDataTable(<span class="hljs-name"><span class="hljs-name">contentsOf</span></span>: trainingFile)</code> </pre> <br><p>  We divide the initial data set into data for training the model and testing as a percentage of 80/20: </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> (trainingData, testData) = apartmentsData.randomSplit(<span class="hljs-keyword"><span class="hljs-keyword">by</span></span>: <span class="hljs-number"><span class="hljs-number">0.8</span></span>, seed: <span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br><p>  We create the MLRegressor model, specifying the data for training and the name of the column whose values ‚Äã‚Äãwe want to predict.  A task-specific type of regressor (linear, decision tree, boosted tree, or random forest) will be automatically selected based on a study of the input data.  We can also specify feature columns - specific columns-parameters for analysis, but in this example there is no need for this, we will use all parameters.  At the end, save the trained model and add to the project: </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> model = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-type"><span class="hljs-type">MLRegressor</span></span>(trainingData: apartmentsData, targetColumn: <span class="hljs-string"><span class="hljs-string">"Price"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> modelPath = <span class="hljs-type"><span class="hljs-type">URL</span></span>(fileURLWithPath: <span class="hljs-string"><span class="hljs-string">"/Users/CreateMLTest/ApartmentsPricer.mlmodel"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> model.write(to: modelPath, metadata: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)</code> </pre> <br><p><img src="https://habrastorage.org/webt/xv/ci/-e/xvci-e7bhoxwfpvwtjdmwqwwhv0.png"></p><br><p>  In this example, we see that the model type is already the Pipeline Regressor, and the Description field indicates the automatically selected regressor type - the Boosted Tree Regression Model.  The parameters Inputs and Outputs correspond to the columns of the table, but their data type is Double. </p><br><p>  Now check the resulting result. <br>  Initialize the model object: </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> model = <span class="hljs-type"><span class="hljs-type">ApartmentsPricer</span></span>()</code> </pre> <br><p>  Call the prediction method, passing in the specified parameters: </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> area = Double(areaSlider.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> floor = Double(floorSlider.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> rooms = Double(roomsSlider.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> latitude = annotation.coordinate.latitude <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> longitude = annotation.coordinate.longitude <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> prediction = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>? model.prediction( area: area, floor: floor, rooms: rooms, latitude: latitude, longitude: longitude)</code> </pre><br><p>  Display the predicted value of the cost: </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> price = prediction?.price priceLabel.text = formattedPrice(price)</code> </pre> <br><p>  Changing the point on the map or the values ‚Äã‚Äãof the parameters, we get the apartment price quite close to our test data: </p><br><p><img src="https://habrastorage.org/webt/pu/j-/v1/puj-v1m8x0ghkxrh1fwogdejxfu.png"></p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  Now the Create ML framework is one of the easiest ways to work with machine learning technologies.  It still does not allow creating models for solving some tasks: recognition of objects in the image, photo styling, definition of similar images, recognition of physical actions based on accelerometer or gyroscope data, which Turi Create, for example, does. </p><br><p>  But it is worth noting that Apple has quite seriously advanced in this area over the past year, and for sure, we will soon see the development of the described technologies. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/418307/">https://habr.com/ru/post/418307/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../418295/index.html">Almost everything you wanted to know about the floating point in ARM, but were afraid to ask</a></li>
<li><a href="../418297/index.html">Neffos N1 smartphone review</a></li>
<li><a href="../418301/index.html">The great opposition of Mars in 2018: how to observe and what to expect</a></li>
<li><a href="../418303/index.html">Vanessa-Automation is a tool for testing application solutions on the 1C: Enterprise platform.</a></li>
<li><a href="../418305/index.html">How many objects does Python allocate when executing scripts?</a></li>
<li><a href="../418309/index.html">How Planck's astronomical satellite forever changed our view of the universe.</a></li>
<li><a href="../418311/index.html">Review Dell Latitude 7390 Laptop: Corporate Superhero</a></li>
<li><a href="../418313/index.html">Top 10 API Testing Tools</a></li>
<li><a href="../418315/index.html">Without a single "Oops": the top 10 reports of DevOops 2017</a></li>
<li><a href="../418317/index.html">2048 is prohibited. Not RosKomNadzor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>