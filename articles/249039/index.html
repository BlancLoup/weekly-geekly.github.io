<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I implemented multilingualism on the site and in the project</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Having created and supporting an open source project, I want to immediately solve all possible problems of multilingual support of both the project an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I implemented multilingualism on the site and in the project</h1><div class="post__text post__text-html js-mediator-article">  Having created and supporting an open source project, I want to immediately solve all possible problems of multilingual support of both the project and the site.  I have come across multi-language support for a long time, starting with desktop programs.  Thus, having an idea of ‚Äã‚Äãthe possible needs, I began to get acquainted with the proposed solutions.  Yes, almost all SaaS services offer free use for open-source projects, but basically everything is focused on translating string resources.  And what about the site and documentation?  Unfortunately, I did not find anything suitable and started to implement myself.  I will say right away that I am satisfied with the result and use the system for almost six months, although I warn you that this is not a massive, complete solution, but rather a specific implementation for my needs, but I hope that some ideas may be useful to other developers. <br><br>  For a start, I will list the requirements that I set for the future offspring. <br><a name="habracut"></a><br><ol><li>  You need to localize both resources for a project stored as JSON in .js, and all texts and documentation on the site. </li><li>  A resource may not have a translation into other languages.  That is, for example, I can accumulate texts in Russian, and then give them to the translator, and these texts will already be available in the Russian version of the site. </li><li>  There should be a convenient system on the site so that the user can translate resources not translated into his language, create a new resource (text) or check and edit existing texts in his native language.  It should look something like this - the user selects the action (translation, verification), the native language (and in the case of translation is still the original language), as well as the desired volume.  For these parameters, a resource is searched for and offered to the user for translation or editing.  Naturally, there should be a log of user actions and accumulate statistics on the work performed. </li><li>  The site should have a choice of languages, but on each page should show only those languages ‚Äã‚Äãfor which there is already a translation of this page. </li><li>  The same line can be used in several places.  For example, the string is used in .js and in the documentation.  That is, the resource must be in one instance and when it is changed, it must be changed in JSON and in the documentation. </li><li>  Ideally, there should be some kind of auto-moderated system, but for now you can stop at the personal decision making on publishing. </li></ol><br>  Displaying changes in real time was not relevant to me, and I decided to make several intermediate tables with the entire internal kitchen and then, on command, do the assembly of JSON and generate pages of the site itself.  In fact, four tables are enough. <br><div class="spoiler">  <b class="spoiler_title">Table structure</b> <div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">`languages`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`_uptime`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT_TIMESTAMP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT_TIMESTAMP</span></span>, <span class="hljs-string"><span class="hljs-string">`_owner`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">smallint</span></span>(<span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">32</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`native`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">32</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`iso639`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`_uptime`</span></span> (<span class="hljs-string"><span class="hljs-string">`_uptime`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=MyISAM <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8 ; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">`langid`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`_uptime`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT_TIMESTAMP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT_TIMESTAMP</span></span>, <span class="hljs-string"><span class="hljs-string">`_owner`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">smallint</span></span>(<span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">96</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`comment`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`restype`</span></span> tinyint(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`attrib`</span></span> tinyint(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`_uptime`</span></span> (<span class="hljs-string"><span class="hljs-string">`_uptime`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`name`</span></span> (<span class="hljs-string"><span class="hljs-string">`name`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`restype`</span></span> (<span class="hljs-string"><span class="hljs-string">`restype`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=MyISAM <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8 ; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">`langlog`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`_uptime`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT_TIMESTAMP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT_TIMESTAMP</span></span>, <span class="hljs-string"><span class="hljs-string">`_owner`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">smallint</span></span>(<span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`iduser`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`idlangres`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`action`</span></span> tinyint(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`_uptime`</span></span> (<span class="hljs-string"><span class="hljs-string">`_uptime`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`iduser`</span></span> (<span class="hljs-string"><span class="hljs-string">`iduser`</span></span>,<span class="hljs-string"><span class="hljs-string">`idlangres`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=MyISAM <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8 ; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">`langres`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`_uptime`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT_TIMESTAMP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT_TIMESTAMP</span></span>, <span class="hljs-string"><span class="hljs-string">`_owner`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">smallint</span></span>(<span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`langid`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">smallint</span></span>(<span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`lang`</span></span> tinyint(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`text`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`prev`</span></span> mediumint(<span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`verified`</span></span> tinyint(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`size`</span></span> mediumint(<span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`_uptime`</span></span> (<span class="hljs-string"><span class="hljs-string">`_uptime`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`langid`</span></span> (<span class="hljs-string"><span class="hljs-string">`langid`</span></span>,<span class="hljs-string"><span class="hljs-string">`lang`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`size`</span></span> (<span class="hljs-string"><span class="hljs-string">`size`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=MyISAM <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8 ;</code> </pre> </div></div><br>  Language table with three fields name, native, iso639.  Recording Example: <i>Russian, Russian, ru</i> <br><br>  A table of text identifiers of langid resources, where you can specify another comment and type.  I divided all resources for myself into several types: JSON string, site page, simple text, text in MarkDown format.  You can of course use your own types. <br>  Example: <i>ancelbtn, Text for Cancel button, JSON</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Table of text resources langres (langid, language, text, prev).  Store references to the identifier, language and the text itself. <br>  The last prev field provides versioning of the text when edited and indicates the previous version of the resource. <br><br>  All changes are recorded in the langlog log table (iduser, idlangres, action).  The action field will indicate the committed action - creation, editing, checking. <br><br>  I will not stop at work with users, I will only say that the user is registered automatically when sending a translation or correction.  Since email is not required, the user is immediately informed of the login and password.  All changes made by him will be tied to his account.  In the future, he can specify your email and other data or just forget about this registration. <br><br>  I drew a diagram for you to better present all the relationships between the tables. <br><img src="https://habrastorage.org/files/502/e7f/967/502e7f9679704498a8dbe1d78b70b651.png" alt="image"><br><br>  Since I need the ability to insert resources into other resources, I added macros like # identifier #.  For example, in the simplest case, if we have the resource name = "Name", then we can use it in the resource entername = "Specify your # name #", which will be replaced by <i>Specify your Name</i> . <br>  Now, to generate site pages, it is enough to go through all languages ‚Äã‚Äãand resources with the appropriate type, process each text with a special replacement function, and write the result into a separate table with ready pages.  Moreover, the processing takes place in such a way that if # identifier # is not found in the current language, then it is searched for in other languages.  Here is a sketch of the recursive function (with loop guard) that performs this processing. <br><div class="spoiler">  <b class="spoiler_title">PHP example substitution function</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">proceed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $input, $recurse = false )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> $db, $syslang; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !$recurse ) <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;chain = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $result = <span class="hljs-string"><span class="hljs-string">''</span></span>; $off = <span class="hljs-number"><span class="hljs-number">0</span></span>; $start = <span class="hljs-number"><span class="hljs-number">0</span></span>; $len = strlen( $input ); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ( ($off = strpos( $input, <span class="hljs-string"><span class="hljs-string">'#'</span></span>, $off )) !== <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> &amp;&amp; $off &lt; $len - <span class="hljs-number"><span class="hljs-number">2</span></span> ) { $end = strpos( $input, <span class="hljs-string"><span class="hljs-string">'#'</span></span>, $off + <span class="hljs-number"><span class="hljs-number">2</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( $end === <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( $end - $off &gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;lenlimit ) { $off = $end - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } $name = substr( $input, $off + <span class="hljs-number"><span class="hljs-number">1</span></span>, $end - $off - <span class="hljs-number"><span class="hljs-number">1</span></span> ); $langid = $db-&gt;getone(<span class="hljs-string"><span class="hljs-string">"select id from langid where name=?s"</span></span>, $name ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( $langid &amp;&amp; !in_array( $langid, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;chain )) { $langres = $db-&gt;getrow(<span class="hljs-string"><span class="hljs-string">"select _uptime, id,text from langres where langid=?s &amp;&amp; verified&gt;0 order by if( lang=?s, 0, 1 ),lang"</span></span>, $langid, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;lang ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( $langres ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( $langres[<span class="hljs-string"><span class="hljs-string">'_uptime'</span></span>] &gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;time ) <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;time = $langres[<span class="hljs-string"><span class="hljs-string">'_uptime'</span></span>]; $result .= substr( $input, $start, $off - $start ); $off = $end + <span class="hljs-number"><span class="hljs-number">1</span></span>; $start = $off; array_push( <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;chain, $langid ); $result .= <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;proceed( $langres[<span class="hljs-string"><span class="hljs-string">'text'</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ); array_pop( <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;chain ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( $off &gt;= $len - <span class="hljs-number"><span class="hljs-number">2</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } } $off = $end - <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( $start &lt; $len ) $result .= substr( $input, $start ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $result; }</code> </pre><br></div></div><br>  In addition to replacing macros like # name #, I also immediately convert MarkDown markup to HTML and process my own directives.  For example, I have a table of pictures where you can put screenshots for different languages ‚Äã‚Äãon one post, and if I specify the tag [img "/ file / # * indexes #"] in the text, then I‚Äôm replacing an image with the name indexes with the right language.  But the most important thing is that I can generate uploads for various purposes in any format.  As an example, I will give the code for generating JSON files; there, however, as unnecessary, the identifier substitution function is not used. <br><div class="spoiler">  <b class="spoiler_title">JSON file generation for RU and EN</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jsonerror</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $message )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> $message; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save_json</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $filename )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> $db, $original; preg_match(<span class="hljs-string"><span class="hljs-string">"/^\w*_(?&lt;lang&gt;\w*)\.js$/"</span></span>, $filename, $matches ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>( $matches[<span class="hljs-string"><span class="hljs-string">'lang'</span></span>] )) jsonerror( <span class="hljs-string"><span class="hljs-string">'No locale'</span></span> ); $lang = $db-&gt;getrow(<span class="hljs-string"><span class="hljs-string">"select * from languages where iso639=?s"</span></span>, $matches[<span class="hljs-string"><span class="hljs-string">'lang'</span></span>] ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !$lang ) jsonerror( <span class="hljs-string"><span class="hljs-string">'Unknown locale '</span></span>.$matches[<span class="hljs-string"><span class="hljs-string">'lang'</span></span>] ); $list = $db-&gt;getall(<span class="hljs-string"><span class="hljs-string">"select lng.name, r.text from langid as lng left join langres as r on r.langid = lng.id where lng.restype=5 &amp;&amp; verified&gt;0 &amp;&amp; r.lang=?s order by lng.name"</span></span>, $lang[<span class="hljs-string"><span class="hljs-string">'id'</span></span>] ); $out = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ( $list <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $il ) $out[ $il[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]] = $il[<span class="hljs-string"><span class="hljs-string">'text'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( $lang[<span class="hljs-string"><span class="hljs-string">'id'</span></span>] == <span class="hljs-number"><span class="hljs-number">1</span></span> ) $original = $out; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ( $original <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $ik =&gt; $io ) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>( $out[ $ik ] )) $out[ $ik ] = $io; $output = <span class="hljs-string"><span class="hljs-string">"/* This file is automatically generated on eonza.org. Use http://www.eonza.org/translate.html to edit or translate these text resources. */ var lng = { \tcode: '$lang[iso639]', \tnative: '$lang[native]', "</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ( $out <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $ok =&gt; $ov ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( strpos( $ov, <span class="hljs-string"><span class="hljs-string">"'"</span></span> ) === <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> ) $text = <span class="hljs-string"><span class="hljs-string">"'$ov'"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> (strpos( $ov, <span class="hljs-string"><span class="hljs-string">'"'</span></span> ) === <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> ) $text = <span class="hljs-string"><span class="hljs-string">"\"$ov\""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> jsonerror( <span class="hljs-string"><span class="hljs-string">'Wrong text:'</span></span>.$text ); $output .= <span class="hljs-string"><span class="hljs-string">"\t$ok: $text,\r\n"</span></span>; } $output .= <span class="hljs-string"><span class="hljs-string">"\r\n};\r\n"</span></span>; $jsfile = dirname(<span class="hljs-keyword"><span class="hljs-keyword">__FILE__</span></span>).<span class="hljs-string"><span class="hljs-string">"/i18n/$lang[iso639].js"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( file_exists( $jsfile )) $output .= file_get_contents( $jsfile ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file_put_contents( HOME.<span class="hljs-string"><span class="hljs-string">"tmp/$filename"</span></span>, $output )) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"Save: "</span></span>.HOME.<span class="hljs-string"><span class="hljs-string">"tmp/$filename&lt;br&gt;"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> jsonerror( <span class="hljs-string"><span class="hljs-string">'Save error:'</span></span>.HOME.<span class="hljs-string"><span class="hljs-string">"tmp/$filename"</span></span> ); } $original = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $files = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'en'</span></span>, <span class="hljs-string"><span class="hljs-string">'ru'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ( $files <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $if ) save_json( <span class="hljs-string"><span class="hljs-string">"locale_$if.js"</span></span> ); $zip = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ZipArchive(); <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> $zip-&gt;open( HOME.<span class="hljs-string"><span class="hljs-string">"tmp/locale.zip"</span></span>, ZipArchive::CREATE ); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ( $files <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $f ) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> $zip-&gt;addFile( HOME.<span class="hljs-string"><span class="hljs-string">"tmp/locale_$f.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"locale_$f.js"</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> $zip-&gt;close(); <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"Finish&lt;br&gt;&lt;a href='/tmp/locale.zip'&gt;ZIP file&lt;/a&gt;"</span></span>;</code> </pre><br></div></div><br>  Thus, having spent not so much effort, I realized almost everything I wanted.  Only things that are not relevant at the moment due to low activity on the site have remained unrealized.  But the additional features that were needed in the process of use were added.  For example, getting a text file with resources that need translation and reloading the translated text. <br>  Those <a href="http://www.eonza.org/translate.html">interested</a> can <a href="http://www.eonza.org/translate.html">take a look at the work page</a> where users can translate, edit and create new resources for my project. <br><br><img src="https://habrastorage.org/files/d5f/f16/a67/d5ff16a67c7345ca9435e9c5991067ca.png" alt="image"></div><p>Source: <a href="https://habr.com/ru/post/249039/">https://habr.com/ru/post/249039/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../249025/index.html">Announcement of the JPoint 2015 Java Conference</a></li>
<li><a href="../249027/index.html">Procedural generation of planetary textures based on the Diamond-Square algorithm, part 1</a></li>
<li><a href="../249029/index.html">Xcode 6 Objective-C Modernization Tool</a></li>
<li><a href="../249031/index.html">The synapse ensemble is a structural unit of the neural network</a></li>
<li><a href="../249037/index.html">Scan and index pages in multiple languages</a></li>
<li><a href="../249041/index.html">YouTube abandoned Flash in favor of HTML5 by default.</a></li>
<li><a href="../249045/index.html">C # for AS3 developers. Part 4: Abstract Classes and Functions</a></li>
<li><a href="../249047/index.html">Sass-architecture of your project</a></li>
<li><a href="../249051/index.html">Do not use MediaPlayer and MediaMetadataRetriever in Android</a></li>
<li><a href="../249053/index.html">How virtual reality came to the project on Unity</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>