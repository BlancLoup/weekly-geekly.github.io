<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we overcame iron obstacles in test automation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the early stages of implementing the DevOps practices in the ESF program, difficulties arose. For example, building a pipeline of some projects req...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we overcame iron obstacles in test automation</h1><div class="post__text post__text-html js-mediator-article">  In the early stages of implementing the DevOps practices in the ESF program, difficulties arose.  For example, building a pipeline of some projects required automation of end-to-end scenarios using plastic cards and digital signatures, while the use of hardware, a POS terminal and a Touch Memory tablet imposes significant restrictions on the automation of checks.  What restrictions faced and how they were solved, read under the cut. <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/mi/wi/yq/miwiyqnatozugh-ag3vochnnzfu.jpeg"><br><br>  When testing the UI, the tester manually performs the steps of test cases that use various external devices.  Automation was hampered by interaction with external devices: <br><br>  - in the course of making adjustments to customer data, confirmation of an authorized employee by a ‚Äútablet‚Äù (TM) is required; <br>  - when identifying a client by the card, it is required to insert the card into the POS terminal. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As an automation option, it was proposed to robotize the process of interaction with devices.  However, robotization was not as accessible.  The robot was a mechanized grip on a platform of 3 m¬≤, which could take a card, insert it into the POS terminal and enter a PIN.  A particular obstacle to use was the low accuracy of hand movements: if the card did not fall into the terminal receiver, then the force of a mechanical hand could break it.  In addition, hand management was launched from a server that was not in the corporate network segment. <br><br>  The next option decided to explore the mechanisms of interaction of equipment and programs.  When analyzing these mechanisms, it turned out that communication with external USB-devices goes through registered ActiveX-libraries. <br><br>  Analyzing possible ways of implementation, in one of the html and js files we encountered the following construction: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> signProcessor = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ActiveXObject(<span class="hljs-string"><span class="hljs-string">"Signature.Processor"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> signProcessor.DWriteSettings != <span class="hljs-string"><span class="hljs-string">"undefined"</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> signProcessor.DSignInitialize != <span class="hljs-string"><span class="hljs-string">"undefined"</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> signProcessor.JSignErrorMessage != <span class="hljs-string"><span class="hljs-string">"undefined"</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> signProcessor.JIdUser != <span class="hljs-string"><span class="hljs-string">"undefined"</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> signProcessor.JGetTmNumber != <span class="hljs-string"><span class="hljs-string">"undefined"</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> signProcessor.DSignUnInitialize != <span class="hljs-string"><span class="hljs-string">"undefined"</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  Here you can clearly see how an ActiveX object is created and its methods are called.  As an experiment, several methods were called with the following vbs-script: <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'  ‚Äî c:\Windows\SysWOW64\wscript.exe "C:\term\sign.vbs" Set MyServ = CreateObject("Signature.Processor") MyServ.DWriteSettings MyServ.DSignInitialize s = "TM=" &amp; MyServ.JGetTmNumber() &amp; vbCrLf s = s &amp;"JIdUser=" &amp; MyServ.JIdUser() &amp; vbCrLf wscript.stdout.writeline s setMyServ=nothing</span></span></code> </pre><br>  Got the result: <br><br><pre> <code class="javascript hljs">  Windows (Microsoft )  <span class="hljs-number"><span class="hljs-number">5.8</span></span>   (Microsoft Corp.), <span class="hljs-number"><span class="hljs-number">1996</span></span><span class="hljs-number"><span class="hljs-number">-2001.</span></span>   . TM=<span class="hljs-number"><span class="hljs-number">06000000000000</span></span>d0 JIdUser=SBTT0001u </code> </pre><br>  No errors! <br><br>  It turns out that if we write our ActiveX object and produce the necessary data, the program will ‚Äúthink‚Äù that it communicates with the hardware. <br><br>  The idea is as follows: we save the data that we get from the real library into the setup file, create a fake ActiveX object with the same name as the real one, and we will take the response data from the setup file. <br><br>  In Visual Studio, we wrote a COM library with the name ‚ÄúSignature.Processor‚Äù, as in the example above, where we implemented methods that return previously obtained values ‚Äã‚Äãfrom the test file. <br><br>  This implementation worked perfectly with the automated system (AS), which only checks the number of the EDS TM carrier, consisting of 8 hexadecimal numbers (JGetTmNumber) and the signature identifier (JIdUser).  However, the new versions of the modules ‚Äúlearned‚Äù to verify the signature on the transmitted hash, which is required to be signed in the present. <br><br>  This cryptographic signature functionality cannot be implemented by counting once the hash and its signature, since when the hash changes, the signature must also inevitably change.  The function of automated signing has an EDS server.  However, to use it, you need applications for physical access over the local network from each client, setting up administrators directly on the server to open access, and you still need to load the private key into a free slot.  Access to all possible machines where, possibly, an automated EDS will be used, cannot be requested.  To circumvent this security constraint, we have identified a separate server through which the interaction between the workstations with the tests and the server will take place. <br><br>  The next problem is that when working with a signature through the <a href="https://habrahabr.ru/post/168565/">FPSU-IP</a> software and hardware complex, the <a href="https://habrahabr.ru/post/168565/">EDS</a> server does not have the ability to work with the TM, since when querying the number of the ‚Äútablet‚Äù from the FPSU itself, an empty value is returned.  Since the FPSU-IP uses the concept of a key (the slot number into which the EDS private key is loaded) for working with EDS, our solution should emulate the number of the ‚Äútablet‚Äù.  For example, all the letters ‚ÄúD‚Äù and at the end of the slot number with EDS. <br><br>  As a result, we got the following solution: <br><br><img src="https://habrastorage.org/webt/dc/ht/zh/dchtzhvgeui8g6mghc8mlcg2il0.png"><br><br>  So we have a flexible testing tool that emulates physical interaction with equipment. <br><br>  At the same time practiced in Microsoft C #. <br><br>  A similar situation exists with POS-terminals for bank cards.  All interaction is carried out through the ActiveX-component, through which various functions of the terminal are called.  Only without pitfalls. <br><br>  As a result, we have the opportunity to automate scenarios on a large number of test data, up to emulation of a card with an incorrect number or expired.  This allowed the release of POS-terminals in the process of auto-testing. <br><br>  What is important, we received additional ‚Äúbuns‚Äù - we managed to solve problems not related to automation, which made testers very happy: <br><br><ul><li>  reduction of time during manual testing due to the exclusion of manual manipulations with maps after creating a dedicated test bench and setting up the DevOps pipeline-pipe; </li><li>  reducing the time from filing an application for making cards from two weeks to several days.  Subsequently, the script for preparing test cards for the ‚Äúsmall circle‚Äù was implemented; </li><li>  eliminating the need for transportation and delivery of test cards - reduced labor costs and consumption of materials for embossing test cards; </li><li>  when a new tester was promptly brought out, for example, an outsourcing, the need to equip a workstation with a POS terminal and a TM reader was no longer necessary.  This greatly accelerated immersion in the project! </li></ul><br>  We hope this short post was useful for you.  As always, we are happy to chat and answer your questions in the comments. </div><p>Source: <a href="https://habr.com/ru/post/345066/">https://habr.com/ru/post/345066/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345056/index.html">Exfiltration in Metasploit: DNS Tunnel for Meterpreter</a></li>
<li><a href="../345058/index.html">Another theft through SWIFT. Now in Russia</a></li>
<li><a href="../345060/index.html">Top 10 React Libraries on GitHub</a></li>
<li><a href="../345062/index.html">The battlefield is augmented reality. Part III: engine capabilities, animation and POI</a></li>
<li><a href="../345064/index.html">First look at the RPG: it turns out, this is not only role-playing games</a></li>
<li><a href="../345070/index.html">On the wave of mining. New virus distributed through Facebook</a></li>
<li><a href="../345072/index.html">Good news for the webmaster: Hamster Marketplace placed an offer on the RunCPA site</a></li>
<li><a href="../345074/index.html">How not to drown in the landing: the history of the creation of the Japanese CarPrice</a></li>
<li><a href="../345076/index.html">Key-value for storing metadata in storage. Testing embedded databases</a></li>
<li><a href="../345078/index.html">IT forecasts for 2018: 8 infrastructure trends</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>