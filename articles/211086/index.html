<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Symfony CMF. Part 2 and the last</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Let's continue to look at the symfony CMF , which implements the concept of a platform for building a CMS from loosely coupled components. In the firs...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Symfony CMF. Part 2 and the last</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/606/322/bce/606322bce0a894b6cd0dda6f92c2e3a7.png" alt="image" align="left">  Let's continue to look at the <a href="http://cmf.symfony.com/">symfony CMF</a> , which implements the concept of a platform for building a CMS from loosely coupled components.  In the <a href="http://habrahabr.ru/post/197524/">first part of the</a> article, we examined in detail the storage and access to data, in the second part everything else is waiting for us. <br><br>  The continuation of the article comes out with a significant delay due to my laziness, health problems and the Internet.  For these couple of months, the system has grown to version 1.0.0, and all subsequent edits in the master branch for some reason break the system, without being documented.  In case anyone wants to install the system with his hands, remember - rely on stable versions marked with tags. <br><br>  The most impatient can squander down, download a virtual machine with an installed system (VirtualBox is required) and touch everything myself, but for the sake of completeness I would recommend reading the article first. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So.  What we have on schedule after data storage? <br><a name="habracut"></a><br><br><img src="https://habrastorage.org/getpro/habr/post_images/1d2/339/9e3/1d23399e38a07a3c854a2e1e02cb52ec.png" alt="Hello world">  <em>Screenshot of the main page of the demo project</em> <br><br><h4>  Template engine </h4><br>  Here, everything is familiar to many - <a href="http://twig.sensiolabs.org/">Twig</a> is used.  Flexible, powerful, very fast and concise.  It supports blocking, inheritance, and compilation of templates into PHP code.  The master page template looks like this: <br><br><pre><code class="hljs django"><span class="xml"></span><span class="hljs-template-tag"><span class="xml"></span><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">extends</span></span></span></span></span><span class="hljs-template-tag"> "SandboxMainBundle::skeleton.html.twig" %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">block</span></span></span></span></span><span class="hljs-template-tag"> content %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">em</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">We are on the homepage which uses a special template</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">em</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name">createphp</span></span></span><span class="hljs-template-tag"> cmfMainContent </span><span class="hljs-keyword"><span class="hljs-template-tag"><span class="hljs-keyword">as</span></span></span><span class="hljs-template-tag">="rdf" %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ rdf|raw }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name">endcreatephp</span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">hr</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ sonata_block_render({ 'name': 'additionalInfoBlock' }, { 'divisible_by': 3, 'divisible_class': 'row', 'child_class': 'span3' }) }}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"row"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"span3"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Some additional links:</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">for</span></span></span></span></span><span class="hljs-template-tag"> child </span><span class="hljs-keyword"><span class="hljs-template-tag"><span class="hljs-keyword">in</span></span></span><span class="hljs-template-tag"> cmf_children(cmf_find('/cms/simple')) %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ path(child) }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ child.title|</span><span class="hljs-name"><span class="hljs-template-variable"><span class="hljs-name">striptags</span></span></span><span class="hljs-template-variable"> }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endfor</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"span3"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ sonata_block_render({ 'name': 'rssBlock' }) }}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endblock</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"></span><span class="xml"></span></code> </pre> <br>  CoreBundle includes a bundle of extensions for Twig, which simplify working with CMF and traversing a PHPCR tree, for example, functions such as <code>cmf_prev</code> , <code>cmf_next</code> , <code>cmf_children</code> and <a href="http://symfony.com/doc/current/cmf/bundles/core/templating.html">others</a> . <br><br>  There is nothing more to look at here anymore, Twig - he is in Africa Twig. <br><br><h4>  A couple of words about admin </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/d75/064/4b3/d750644b39b096486fbaa332bb6598cc.png" alt="Sonata"><br>  <em>Admin home page</em> <br><br>  The famous admin generator SonataAdminBundle performs exactly the same function in Symfony CMF, but through a special layer in the form of <a href="https://github.com/sonata-project/SonataDoctrinePhpcrAdminBundle">SonataDoctrinePhpcrAdminBundle</a> .  This was done so that the original bandl could abstract from the data storage. <br><br>  TreeBrowserBundle, working on <a href="http://www.jstree.com/documentation">jsTree</a> , is intended for working with tree structures. <br><br>  The components that have the admin part, described below, will definitely connect their panels here.  Therefore, I don‚Äôt see any reason to dwell on this, detailed screenshots will be further. <br><br><h4>  Static content </h4><br>  Static content in the CMS - the foundation of everything.  In Symfony CMF, ContentBundle is responsible for static content, which provides a basic implementation of static document classes, including multilingualism and route communication. <br><br>  The basis of the bundle is the class <code>StaticContent</code> , whose composition will be familiar to many - self-speaking fields such as <code>title</code> , <code>body</code> , link to the parent document, and so on.  In addition, it implements two interfaces: <br><br><ul><li>  <code>RouteReferrersInterface</code> , provides a bundle with routes </li><li>  <code>PublishWorkflowInterface</code> , helps to show or hide content using specified publication dates </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/4a3/774/0e9/4a37740e9cd3c6ff0146360673d472d1.png" alt="publish workflow"><br><br>  For multilanguage documents, <code>MultilangStaticContent</code> is provided - everything is the same, but translation of fields and a locale declaration are added.  How is the translation - we have already seen in the first part of the article. <br><br>  Bundle relies controller.  <code>ContentController</code> consists of a single <code>indexAction</code> , which accepts the desired document as input and renders it in the desired language if everything is in order with the publication parameters.  Optionally, you can set a template with which the page will be displayed.  If you do not specify, the default one will be taken. <br><br><h4>  Routing </h4><br>  In modern large sites, the amount of material can be easily measured in thousands.  Multiply by the number of transfers.  Add the need for constant revisions of materials and URLs to them in the name of search engine optimization. <br>  At the same time, notice that such things are usually handled by the site administrator (webmaster, content manager, SEO), and not the developer. <br><br>  What are the requirements for routing in this case? <br><br><ul><li>  URL is set by user </li><li>  multisite support </li><li>  multilingual support </li><li>  tree structure </li><li>  content, menus and routes should be separated </li></ul><br>  If we recall the standard Symfony 2 router, it becomes clear that such flexibility cannot be achieved there.  Routes are explicitly spelled out in the config for each controller, and the user is simply not allowed to change them.  The maximum that you can count on is any <code>/page/{slug}</code> , which can be edited from the admin panel. <br><br>  Let's take a look at how a functioning SF2 circuit looked like: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f36/bff/d74/f36bffd74ca89367b76859cd7e3abcf5.png" alt="Routing in SF2" title="Routing in SF2"><br><br>  If you do not go into the details of the options for configuring the parameters, everything is pretty primitive.  A request comes in, the router decides what to call the controller, the controller pulls the necessary data and renders the view, then issues the coveted Response. <br><br>  This is a fairly familiar scheme. <br><br>  Why is this option not good for CMS? <br><br>  Imagine that we have a <code>PageController</code> , which takes as an argument a URL-alias of the page, compares it with what is stored in the database and returns a page, or 404. <br><br>  In my practice, there were cases when among static content there were different forms that would have looked more harmoniously as part of the site section, rather than as a separate component.  For example, on one bank site, a credit <code>/calculator</code> added to the URL of the text section <code>/credits/cash</code> , so that people, after reading the necessary information about loans, could find the necessary numbers on the spot. <br><br>  Suppose the <code>PageController</code> first part of the URL, what to do with the calculator, which obviously will act as a separate controller?  Add <code>pattern: /credits/cash/calculator</code> in the config and specify a separate controller / action?  Somehow ugly.  Even if you prioritize the rest of the routes, it is clear that there is no smell of flexibility here - if the alias in the database changes, you will have to edit the config with your hands. <br><br>  Need something else. <br><br>  We summarize routing in SF2: <br><br><ul><li>  determine which controller serves the request </li><li>  parse URL parameters </li><li>  if nothing happens, the default behavior is based on a pre-configured set of routes. <br><br><ul><li>  either from the application configuration </li><li>  either from bundles </li></ul><br></li><li>  users cannot edit routes </li><li>  does not scale to a very large number of routes </li><li>  in the CMS, the <em>user</em> himself wants to decide what address should be. </li></ul><br><h5>  The concept of routing in symfony CMF </h5><br>  From the beautiful and powerful, but inconvenient in the case of CMS Symfony 2 router had to be abandoned in favor of the new concept: <br><br><ul><li>  need to separate the content tree from the navigation tree </li><li>  The navigation tree consists of <em>links</em> to the elements of the content tree.  Due to this, they are easily implemented: <br><br><ul><li>  multi-site (desktop, tablet, mobile versions) </li><li>  multilanguage </li></ul><br></li><li>  rebooting the navigation requires cloning the navigation tree </li><li>  on readiness, the result flows back </li></ul><br>  Immediately a solution comes to mind: we create a default route ( <code>/{url}</code> with the obligatory parameter <code>url: .*</code> ), One controller for all requests, and depending on the contents we redirect the request to other controllers.  But at the same time, no one cancels conflicts with other routes. <br><br><pre> <code class="hljs objectivec">navigation: pattern: <span class="hljs-string"><span class="hljs-string">"/{url}"</span></span> defaults: { _controller: service.controller:indexAction } requirements: url: .*</code> </pre><br>  It still does not sound very much. <br><br>  A better solution was to provide (as long as it was not marked as outdated since the days of Symfony 2.1) <code>DoctrineRouter</code> .  It is already much more flexible, because it looked for routes by the URL in the database, while the implementation was ready for documents through PHPCR-ODM, and you can attach any of your own.  The route was explicitly specified by the controller, otherwise the <code>ControllerResolver</code> used, which itself tried to decide which controller would process the request.  There were also built-in resolvers: <br><br><ul><li>  binding of nodes of a certain type to the controller </li><li>  binding nodes of a certain type to a pattern and using a standard (generic) controller </li></ul><br>  Up to the heap - route redirection (to other routes or absolute URLs). <br><br>  At the moment, to solve all the problems with routing in Symfony CMF, two components are used - <code>ChainRouter</code> and <code>DynamicRouter</code> .  The first replaces the standard SF2 router and, despite the name, the operation of the router (the definition of the controller for processing the request) does not actually perform.  Instead, it allows you to add your routers to the chain list.  In the chain, all configured routers will try to process the request in turn, in order of priority.  Router services are searched by tags. <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">cmf_routing</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">chain</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">routers_by_id</span></span>: #  <span class="hljs-selector-tag"><span class="hljs-selector-tag">DynamicRouter</span></span>    #        #         <span class="hljs-selector-tag"><span class="hljs-selector-tag">cmf_routing</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.dynamic_router</span></span>: 20 #    <span class="hljs-selector-tag"><span class="hljs-selector-tag">acme_core</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.my_router</span></span>: 50 #       <span class="hljs-selector-tag"><span class="hljs-selector-tag">router</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.default</span></span>: 100 <span class="hljs-selector-tag"><span class="hljs-selector-tag">services</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">acme_core</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.my_router</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">class</span></span>: %<span class="hljs-selector-tag"><span class="hljs-selector-tag">my_namespace</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.my_router_class</span></span>% <span class="hljs-selector-tag"><span class="hljs-selector-tag">tags</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">name</span></span>: cmf_routing.router, priority: <span class="hljs-number"><span class="hljs-number">300</span></span> }</code> </pre><br>  Well, we have an infinite number of routers available for use. <br><br>  Now we recall the search for routes in the database and <code>DynamicRouter</code> .  Its task is to load routes from the <em>provider</em> , the provider can be (and usually is) a database.  In the standard package there are implementations of providers for Doctrine PHPCR-ODM, Doctrine ORM and of course, you can add to the list of providers by implementing <a href="https://github.com/symfony-cmf/Routing/blob/master/RouteProviderInterface.php">RouteProviderInterface</a> . <br><br>  What do providers do?  <code>DynamicRouter</code> request, providers issue an ordered subset of candidate routes that may suit the incoming request, and <code>DynamicRouter</code> makes the final decision and matches the request with a specific <code>Route</code> object. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/54c/835/540/54c835540eaaff5e02dd5ab8ab79fe83.png" alt="Routing 2.0"><br><br>  The route determines which controller will handle a particular request.  <code>DynamicRouter</code> uses several methods in descending order of priority: <br><br><ul><li>  explicitly: <code>Route</code> document itself explicitly declares the final controller if it returns from the <code>getDefault('_controller')</code> call. </li><li>  by alias: route returns the value of <code>getDefault('type')</code> , which is mapped to the configuration from <code>config.yml</code> <br></li><li>  by class: The <code>Route</code> document must implement the <code>RouteObjectInterface</code> and return an object for <code>getContent()</code> .  The return type of the class is again mapped to the config. </li><li>  default: the default controller will be used, if any is configured </li></ul><br>  Similarly (explicitly or by class), the route can also specify the pattern with which the page should be rendered. <br><br>  Optionally, using the above-mentioned <code>RouteObjectInterface</code> you can teach the route to return an instance of the model associated with it. <br><br>  Redirects are also supported.  In general, there is the <code>RedirectRouteInterface</code> interface, but for PHPCR-ODM, the implementation is ready as a <code>RedirectRoute</code> document.  It can redirect to an absolute URI and to a named route generated by any router in the chain. <br><br>  Another important feature that might be interesting for those who did not work with Symfony is the two-wayness of the router.  In addition to recognizing routes based on specified parameters, these routes can also be generated by passing parameters as arguments.  Unlike the standard SF2 router, as a parameter for the <code>path()</code> function, you can pass not only the route name specified in the config, but also the implementation <code>RouteObjectInterface</code> , <code>RouteReferrersInterface</code> (that is, route object), or a link to an object in the repository using its content_id: <br><br><pre> <code class="hljs django"><span class="xml"></span><span class="hljs-comment"><span class="xml"></span><span class="hljs-comment">{# myRoute    Symfony\Component\Routing\Route #}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ path(myRoute) }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Read on</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-comment"><span class="hljs-comment">{#    /    #}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ path('/cms/routes') }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Home</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-comment"><span class="hljs-comment">{# myContent  RouteReferrersInterface #}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ path(myContent) }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Read on</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-comment"><span class="hljs-comment">{#    ,   ContentRepositoryInterface #}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ path(null, {'content_id': '/cms/content/my-content'}) }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Read on </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br>  If several routes are suitable for the same material, the locale of which matches the query locale will be considered preferable. <br><br>  Finally, back to what was written a little earlier, the separation of the navigation tree and the content tree.  Take a look at the scheme, branched navigation according to certain rules transfers control to the necessary controllers and only after that it requests data: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f99/6fe/524/f996fe5244877ff68ae56de5298e27aa.png" alt="Link between routing and content" title="Link between routing and content"><br><br>  In the admin for the routes, you can set the format (so that the URL ends in <code>.html</code> , for example) and the final slash. <br><br>  On top of that, the experimental <a href="http://symfony.com/doc/current/cmf/bundles/routing_auto/introduction.html">RoutingAutoBundle</a> proposes to generate routes for the content based on the rules prepared in advance.  By generating auto routes, flexibility is achieved: for individual routes, it is easy to translate pseudonyms, generate a site map and change the class of documents to which the route can refer.  But in most cases for simple CMS this bundle may not be necessary. <br><br>  On this with flexible routing finish. <br><br><h4>  Menu </h4><br>  No CMS can do without a menu system.  Although the menu structure usually follows the content structure, it may need its own logic, not defined by the content or existing in several contexts with different options: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/db2/dd7/680/db2dd76807180011afe2f62349f7a9de.png" alt="Sample menu" title="Sample menu"><br><br>  Symfony CMF includes MenuBundle, a tool that allows you to define your own menus.  It extends the well-known <a href="https://github.com/KnpLabs/KnpMenuBundle">KnpMenuBundle</a> , complementing it with hierarchical and multilingual elements and tools to write them to the selected repository. <br><br>  When displaying the menu, MenuBundle relies on default for KnpMenuBundle renderers and helpers.  <a href="">It is</a> recommended to read <a href="">full documentation</a> , but in general in the simplest case, the output looks like this: <br><br><pre> <code class="hljs cs">{{ knp_menu_render(<span class="hljs-string"><span class="hljs-string">'simple'</span></span>) }}</code> </pre> <br>  The menu name passed to the <code>MenuProviderInterface</code> will in turn be passed to the <code>MenuProviderInterface</code> implementation, which will decide which menu to show. <br><br>  At the heart of the bundle is <code>PhpcrMenuProvider</code> , the implementation of <code>MenuProviderInterface</code> , which is responsible for dynamically loading the menu from the PHPCR storage.  By default, the provider service is configured by the <code>menu_basepath</code> parameter, which specifies where to look for the menu in the PHPCR tree.  When rendering a menu, the <code>name</code> parameter is passed, which must be a direct descendant of the specified base path.  This allows <code>PhpcrMenuProvider</code> to work with several menu hierarchies using a single storage mechanism.  Recalling the above usage example, the <code>simple</code> menu should be located at <code>/cms/menu/simple</code> , if the following is specified in the configuration: <br><br><pre> <code class="hljs mel">cmf_menu: menu_basepath: /cms/<span class="hljs-keyword"><span class="hljs-keyword">menu</span></span></code> </pre><br>  Two types of nodes are <code>MenuNode</code> : <code>MenuNode</code> and <code>MultilangMenuNode</code> .  <code>MenuNode</code> contains information about a specific menu item: <code>label</code> , <code>uri</code> , a list of <code>children</code> , a link to the route, the associated Content element, plus an attributes <code>attributes</code> list, which allows you to customize the menu output. <br><br>  The <code>MultilangMenuNode</code> class extends <code>MenuNode</code> to support multilingualism: a <code>locale</code> field has been added to define the translation to which the item and <code>label</code> belong to the <code>uri</code> , marked as <code>translated=true</code> .  These are the only fields that differ between translations. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eae/c16/3bd/eaec163bdab042d20bdc6e59af876690.png" alt="Admin Panel 1"><br><br>  For integration with the admin panel provides panels and services for SonataDoctrinePhpcrAdminBundle.  Panels are available immediately, but to use them, you must explicitly add to the dashboards. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/726/2e6/f91/7262e6f91abf49b41df79439b3b1e7dd.png" alt="Admin menu 2"><br><br>  A bundle is configured <a href="http://symfony.com/doc/current/cmf/reference/configuration/menu.html">as usual</a> , but all parameters are optional. <br><br>  The link between routing, menu and content is demonstrated here: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/545/fc8/ae4/545fc8ae49508293a0395863166d6165.png" alt="Routing, content, menu" title="Routing, content, menu"><br><br><h4>  Blocks </h4><br>  Provided and bandle to work with blocks.  Blocks can implement some kind of logic or simply return static content that can be invoked anywhere in the template.  BlockBundle is based on the <a href="https://github.com/sonata-project/SonataBlockBundle">SonataBlockBundle</a> and, where <a href="https://github.com/sonata-project/SonataBlockBundle">appropriate</a> , replaces the components of the parent bundle with its PHPCR compatible ones. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/74c/149/a2d/74c149a2da308205664e42338c19f07f.png" alt="Blocks"><br>  <em>Typical blocks from the main page</em> <br><br>  Inside the bundle are a few typical blocks: <br><br><ul><li>  <code>StringBlock</code> is a block with a single <code>body</code> field, which simply renders a string in a template, without even surrounding it with any tags. </li><li>  <code>SimpleBlock</code> - add <code>title</code> to <code>body</code> <br></li><li>  <code>ContainerBlock</code> - renders a specified list of blocks (including other block-containers) </li><li>  <code>ReferenceBlock</code> - can only refer to another block.  When a call is triggered, it is as if the block referred to is called. </li><li>  <code>ActionBlock</code> - <code>ActionBlock</code> result of executing a certain action from the controller, you can send the desired request parameters </li><li>  <code>RssBlock</code> - Shows an RSS feed with the specified template. </li><li>  <code>ImagineBlock</code> - used by LiipImagineBundle to display images directly from PHPCR </li><li>  <code>SlideshowBlock</code> is a special kind of container block that allows you to wrap any blocks in markup so that you can organize a slideshow.  It is noteworthy that the JS library for this you need to choose yourself, in the bundle it is not. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/202/506/ba8/202506ba8c700f3d03bd6e033af88dfe.png" alt="Admin box"><br><br>  You can create <a href="http://symfony.com/doc/current/cmf/bundles/block/create_your_own_blocks.html">your own blocks</a> . <br><br>  <a href="http://symfony.com/doc/current/cmf/bundles/block/cache.html">The</a> blocking <a href="http://symfony.com/doc/current/cmf/bundles/block/cache.html">caching mechanism</a> works on top of the <a href="https://github.com/vihuvac/SonataCacheBundle">SonataCacheBundle</a> , although BlockBundle lacks adapters for MongoDB, Memcached and APC - you have to be content with Varnish or SSI. <br><br>  Blocks are <code>sonata_block_render()</code> function <code>sonata_block_render()</code> , but unlike the original bundle, the block name is passed to PHPCR as arguments. <br><br><h4>  Frontend / Inline Editing </h4><br>  Editing on-the-fly implemented using several components. <br><br>  The first is <a href="http://rdfa.info/">RDFa</a> markup.  This is a way to describe metadata in HTML in the style of microformats, but with the help of attributes. <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"myarticle"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">typeof</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://rdfs.org/sioc/ns#Post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">about</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://example.net/blog/news_item"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">property</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dcterms:title"</span></span></span><span class="hljs-tag">&gt;</span></span>News item title<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">property</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sioc:content"</span></span></span><span class="hljs-tag">&gt;</span></span>News item contents<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  After that, the code above ceases to be a ‚Äústupid‚Äù set of DOM elements, because information from attributes can be conveniently extracted into JS code and associated with models and collections of Backbone.js using <a href="https://github.com/bergie/VIE">VIE.js</a> - this is the second component. <br><br>  The third in the chain is <a href="http://createjs.org/">create.js</a> , which saves us from having to invent an editing interface. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d1a/802/62d/d1a80262de34b084221009a6a6badac0.png" alt="Workflow create.js"><br>  <em>Workflow create.js</em> <br><br>  create.js runs on top of VIE.js on jQuery widgets.  What can he do? <br><br><ul><li>  Modify the contents of RDF-tagged elements using editors - Aloha, Hallo, Redactor, ckEditor </li><li>  using localStorage, provide support for saving-restoring edits before they go to CMS </li><li>  manage notifications appearing during editing </li><li>  organize your toolbars with the right tools </li><li>  call custom workflow functions such as "delete", "unpublish" </li></ul><br>  All content is edited in place, while at the expense of RDFa it is not necessary to generate tons of auxiliary HTML markup, as some CMS do. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f6e/cd2/db2/f6ecd2db224816d284ce92d9cc8e912c.png" alt="Editor"><br>  <em>ckEditor in the service of good</em> <br><br>  Well, it closes the <a href="https://github.com/flack/createphp">CreatePHP</a> list, a library that links the create.js calls and the backend itself.  It is responsible for mapping the properties of the model in PHP to HTML attributes and rendering the entity.  The most attentive ones have already seen that there is a Twig extension for CreatePHP and its challenge is in the first listing of this article: we pass the model and specify the output format.  Beauty. <br><br>  The last two components are combined for convenience in CreateBundle. <br><br><h4>  Mediabundle </h4><br>  One of the bundles of the most minimalist implementation is a bundle for working with media objects.  They can be documents, binaries, MP3s, videos, and even what your heart desires.  The current version supports uploading pictures and downloading files, and writing everything else.  <a href="https://github.com/sonata-project/SonataMediaBundle">SonataMediaBundle</a> can help, especially since there is integration. <br><br>  Bundle provides: <br><br><ul><li>  basic documents for simple models; </li><li>  basic <code>FormType</code> for simple models; </li><li>  controller for uploading and downloading files; </li><li>  helper, giving an abstraction from uploading to the server; </li><li>  controller to display the picture. </li></ul><br>  As well as helpers and adapters for integration: <br><br><ul><li>  media browsers (elFinder, ckFinder, MceFileManager, etc.); </li><li>  image manipulation libraries (Imagine, LiipImagineBundle). </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/70f/112/fb6/70f112fb6747e0d8ad257b3eb99568cb.png" alt="elfinder"><br><br>  There is a whole scattering of interfaces for creating your own media classes: <br><br><ul><li>  <code>MediaInterface</code> : base class; </li><li>  <code>MetadataInterface</code> : definition of metadata; </li><li>  <code>FileInterface</code> : defined as a file; </li><li>  <code>ImageInterface</code> : defined as a picture; </li><li>  <code>FileSystemInterface</code> : the file is stored in the file system, as the media object preserves the path to it; </li><li>  <code>BinaryInterface</code> : mainly used when the file is saved inside the media object; </li><li>  <code>DirectoryInterface</code> : defined as a directory; </li><li> <code>HierarchyInterface</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: Media objects stored directory path to the media: </font></font><code>/path/to/file/filename.ext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An interesting approach to file paths. </font><font style="vertical-align: inherit;">In bundle terminology, the path to the media object is understood, for example, </font></font><code>/path/to/my/media.jpg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and the differences between the paths in Windows and * nix-systems are leveled. </font><font style="vertical-align: inherit;">In PHPCR, this path can be used as an identifier. </font><font style="vertical-align: inherit;">Several useful methods are available:</font></font><br><br><ul><li> <code>getPath</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gets the path to the object stored in PHPCR, ORM or another Doctrine storage; </font></font></li><li> <code>getUrlSafePath</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> transforms the path for safe use into a URL; </font></font></li><li> <code>mapPathToId</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> transforms the path into an identifier to search the Doctrine storage; </font></font></li><li> <code>mapUrlSafePathToId</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> transforms the URL back into an id. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Self-supporting features are available in the Twig extension: </font></font><br><br><pre> <code class="hljs django"><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ cmf_media_download_url(file) }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"Download"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Download</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">img</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ cmf_media_display_url(image) }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">alt</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">""</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> You can attach a picture to the document through the provided Type Type: </font></font><br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Form</span></span>\<span class="hljs-title"><span class="hljs-title">FormBuilderInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configureFormFields</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(FormBuilderInterface $formBuilder)</span></span></span><span class="hljs-function"> </span></span>{ $formBuilder -&gt;add(<span class="hljs-string"><span class="hljs-string">'image'</span></span>, <span class="hljs-string"><span class="hljs-string">'cmf_media_image'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'required'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)) ; }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Implemented adapters media browser </font></font><a href="http://elfinder.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">elFinder</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , libraries </font></font><a href="https://github.com/KnpLabs/Gaufrette"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gaufrette</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , giving abstraction layer above the file system and </font></font><a href="https://github.com/liip/LiipImagineBundle"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LiipImagine</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which simplifies the manipulation of the images. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/906/914/423/9069144230271dcaa099f0622c59dd86.png" alt=""><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As I said before, the implementation of the bundle is minimalist. </font><font style="vertical-align: inherit;">Suffice it to say that the pictures are not loaded in a crowd, and in order to physically delete the file attached to the document, you must also delete the document itself.</font></font> Um <br><br><h4>  Perspectives </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> It is planned (and sometimes even ready to some extent) integration with modules: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SymfonyCmfSearchBundle (full search, extends LiipSearchBundle) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SymfonyCmfSimpleCms (the simplest CMS that comes with CMF) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> LuneticsLocaleBundle (automatic locale detection) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> other bundles from Sonata </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And of course, the development of new features and the elimination of current shortcomings. </font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Is everything so good? </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I‚Äôm already here for a lot of kilobytes of text I‚Äôve been crucified, as everything in Symfony CMF is wonderful, so it‚Äôs logical to ask where is the criticism. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lacks lack. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Symfony CMF is updated infrequently - on the githaba it is indicated that the process of releasing new versions is similar to the release scheme of SF2, that is, every six months (we write new features for four months, fix bugs for two months and prepare a release). Of course, there will be minor fixes aimed at eliminating vulnerabilities, but in general, if you want a new one, you will have to wait considerably. At the same time, this is the stage of development, when no one promises to maintain backward compatibility between releases at any cost. This means that what worked in 1.0, in 1.1, can easily break.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The documentation suffers. In the wiki project is a mess, many articles should already be deleted, outdated code is written somewhere, and in general, the Symfony CMF Book is not as friendly and simple as a similar compilation for SF2. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMF has a very high threshold of entry. To install a test system, it‚Äôs not enough to ‚Äúunpack everything into webroot and run install.php‚Äù - you need to understand the connection between the components and be able to handle each of them. Any revision or implementation of your code will require a thoughtful study of the entrails. Although, probably, developers using SF2 will not be scared. And for users, there is no documentation at all ...</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The conclusion that suggests itself only on the screenshots is that the system is damp and far from the presentation. Usability of admin panel is in question - it seems like a neat Bootstrap, and it seems that the designer‚Äôs hand didn‚Äôt touch anything here. Despite the cool front-end editor, for </font></font><code>body</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-elements in the admin panel there is only a pitiful textarea two lines high. For typical operations, one has to perform too many gestures due to ill-conceived navigation. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a39/159/f58/a39159f5822e8699e151f3e71b445b73.png" alt=" "><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The documentation often contains promises to make X or Y </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">later</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">If you want someone to advertise the project - to convince the expediency of use will work with difficulty, I think. </font><font style="vertical-align: inherit;">There will be no eye-candy-sheets fashionable nowadays that promise how easy and fun your life will be after installing Symfony CMF. </font><font style="vertical-align: inherit;">In general, there are no ‚Äúboxes‚Äù from which you can get an attractive working system.</font></font><del><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And probably not </font></font></del><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Separately, I note that the examples of industrial use Symfony CMF </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">until</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no. </font><font style="vertical-align: inherit;">It is not known how the system behaves under load and what to do if you suddenly need scaling (including the backend) - these issues are not disclosed in the documentation except for the Cache bundle and the APC installation.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Get down to business </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can immediately download the virtual machine image I prepared for VirtualBox, where everything is installed and configured, including various backends. </font><font style="vertical-align: inherit;">For convenience, you can register to your hosts file </font></font><code>ip_ cmf-sandbox</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and go there through the browser, but in general you can go and simply by the IP address, which she will try to prompt immediately after the login (default login and password :) </font></font><code>symfony</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mirrors (.ova-file, ‚âà 1Gb):</font></font><br><br><ul><li>  <a href="http://yadi.sk/d/_9tlJiqDH7SAL">Yandex.Disk</a> </li><li> <a href="https://mega.co.nz/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mega.co.nz</font></font></a> </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If for some reason you don‚Äôt want to bother with it, I give a link to the </font></font><a href="http://cmf.liip.ch/en"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">online sandbox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but you don‚Äôt get there to dig deeper inside, although it‚Äôs good to look at the quick fix too. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Manually installing a little bit of a chore, so </font><font style="vertical-align: inherit;">I will not </font><font style="vertical-align: inherit;">dwell on each step described in the </font></font><a href="http://symfony.com/doc/master/cmf/book/installation.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instructions</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Just briefly go through the main points. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Requirements for the machine to run CMF are a bit non-standard, although no crime. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First, you need to satisfy the standard requirements for symfony 2 (it‚Äôs very likely that this is all right):</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> install PHP 5.3.3+ </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> enable json support </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> enable ctype support </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to </font></font><code>php.ini</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">correctly install</font></font><code>date.timezone</code> <br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> install doctrine pdo drivers </font></font></li></ul><br> <a href="http://symfony.com/doc/current/reference/requirements.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Everything else</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (APC and so on) is optional. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next come the symfony CMF requirements. </font><font style="vertical-align: inherit;">SQLite is used by default for data storage, so make sure that the extension is installed </font></font><code>pdo_sqlite</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To use other backends, install:</font></font><br><br><ul><li> <a href="http://jackrabbit.apache.org/downloads.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache Jackrabbit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and, accordingly, Java (for each distribution kit, its own installation method). </font><font style="vertical-align: inherit;">At the root of the CMF installed, there must be a script </font></font><code>jack</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that downloads and helps launch Jackrabbit without unnecessary gestures. </font><font style="vertical-align: inherit;">You can use it, but Java is still set separately.</font></font></li><li> <a href="http://midgard-project.org/phpcr/">Midgard2 PHPCR</a>     PHP.  ,     :   ,   (   sid    Debian),       ,  ,     .  ,  ,    RPM,  deb-.        <a href="https://github.com/midgardproject/midgard-php5"></a> ,    ‚Äî  Midgard2  CMF   . </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Also in the folder with a sandbox lies a script written by me </font></font><code>switch_backends.py</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which itself will replace the config with the desired one (the original files are corrected in </font></font><code>app/config/phpcr/</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) and will clean up the production cache so that it all takes off. For obvious reasons, I commented out the midgard-options so far - they still do not work. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I want to warn against the temptation to type in the console </font></font><code>git pull</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or </font></font><code>composer update</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- as I said at the beginning of the article, the edits in the master branch violate the performance of the system, wait for the next stable release.</font></font><br><br><h3>  Summary </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So, despite the numerous ‚Äúbut‚Äù, the project looks interesting. </font><font style="vertical-align: inherit;">Surprisingly, some fundamental content management problems (for example, multilingual and routing / menu) have been successfully resolved. </font><font style="vertical-align: inherit;">Development is slowly being conducted by an extremely limited circle of people who already have a job, so now the best help is a fork on a githaba and a useful pull-request, whether it is documentation editing or error correction. </font><font style="vertical-align: inherit;">CMF popularization is only ahead (try searching the web for materials, there are practically none), all hope is only in the open source and the community. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Using CMF now in production can be risky, but it‚Äôs still worth being aware of. </font><font style="vertical-align: inherit;">Who knows, maybe from </font></font><a href="http://fabien.potencier.org/article/71/sensiolabs-raises-5-million-euros-to-boost-the-symfony-ecosystem"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">those millions of euros</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> something will fall here and in a couple of years we will see a wonderful product?</font></font><br><br>  That's all.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A small list of useful links: </font></font><br><br><ul><li> <a href="http://symfony.com/doc/current/cmf/index.html">  CMF</a> </li><li> <a href="http://cmf.symfony.com/"> </a> </li><li>  <a href="https://github.com/symfony-cmf/symfony-cmf/wiki/Roadmap">Roadmap</a> </li><li> <a href="http://symfony.com/doc/current/cmf/contributing/index.html">    </a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/211086/">https://habr.com/ru/post/211086/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../211066/index.html">Comparative test of 5V chargers and microUSB cables</a></li>
<li><a href="../211070/index.html">Joe Armstrong on developer tools</a></li>
<li><a href="../211074/index.html">Project history through three startups</a></li>
<li><a href="../211080/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ94 (January 26 - February 1, 2014)</a></li>
<li><a href="../211082/index.html">Dic: fast memory</a></li>
<li><a href="../211088/index.html">The grand battle in EVE Online, who lost $ 300,000 and what did happen there</a></li>
<li><a href="../211090/index.html">Mageia 4</a></li>
<li><a href="../211092/index.html">Podcast Noise Security Bit # 4 "On hardware security"</a></li>
<li><a href="../211094/index.html">The easiest way to add a WebSocket to Django</a></li>
<li><a href="../211100/index.html">Tame ZoG (Part 1: The Wolves and the Goat)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>