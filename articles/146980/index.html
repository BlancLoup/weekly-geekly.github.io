<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to quickly "throw" 100,500 new users in Active Directory (raised on MS Windows Server 2003) or Script to add user accounts to Active Directory</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It so happened that I chose the profession of a system administrator. And I have been doing this at times ungrateful work for nearly 6 years. 
 One da...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to quickly "throw" 100,500 new users in Active Directory (raised on MS Windows Server 2003) or Script to add user accounts to Active Directory</h1><div class="post__text post__text-html js-mediator-article"> It so happened that I chose the profession of a system administrator.  And I have been doing this at times ungrateful work for nearly 6 years. <br>  One day, a couple of years ago, I was faced with a question, which later developed into a task, namely, how relatively quickly to get new user accounts in AD under MS Windows Server 2003? <br><a name="habracut"></a><br>  I think that everyone knows how to add a user to the domain, so to speak, "pens".  That is, to add AD user accounts you have to do something like the following: open the Users and Computers snap-in of the above OS, open the corresponding Organization Unite OU, initiate user creation using any known methods, and then create users in the window that opens after another.  Agree, this is quite a long and dreary, especially if the required user accounts are not 10, but let's say - 300, 500 and more.  Especially it will become a routine matter when you need to fill in not only the "login" and "password" fields, but also, located in various tabs, the fields "Last Name", "First Name, Middle Name", "Position", "Department", "Organization " etc.  Of course, you will say that the ‚Äúcopy-paste‚Äù and ‚Äúblind dialing‚Äù methods have not been canceled yet, but you try and feel what user account you are tired of, and if you don‚Äôt get tired, then count the number of errors made when filling data. <br>  In general, having understood that something needs to be done with this and since my time was limited, I turned to Internet resources in order to search for a script that was supposed to exist and solve this problem, as suggested by my instincts.  Alas, I was practically disappointed in what I saw.  The Internet was full of all sorts of scripts to automate various tasks in the AD environment, but what I needed was completely absent.  I had to turn to English-language resources, on one of which (alas, I already lost the site link at the time of writing this article, I had thoughts of where to look, and if I found it, I‚Äôll publish) there was a certain ‚Äúfish‚Äù script on VBS in very ‚Äúraw‚Äù As it turned out when trying to use it on a test system, it did not lead to anything - it simply, a priori, did not work, due to the presence of a lot of flaws and trivial errors in it, as I found out later.  I had to correct, add the code and become, in addition to everything, a little programmer in the VBS language :) <br>  For this, allow me to submit to the court of a respected public a script for adding user accounts in AD to previously created OUs (level 1).  If the question arises why OUs are not automatically created, then I will answer in advance that I didn‚Äôt find out how to do it, and the control is so harsher for the changes made in AD - it‚Äôs still not necessary to play in the sandbox, but to make tangible changes to the powerful and real time system, the so-called "Active Directory". <br><br>  <u><b>Important note!</b></u> <br>  In advance, you need to create a file containing a separator ";"  Required parameters: <br>  Login;  Password;  Name Patronymic name;  Surname;  Position;  Department;  Organization; <br>  The presence of a closing delimiter ";"  in each line, for example: <br>  sirin-bird1;  password1;  First name1;  Last Name1;  Position1;  Division1;  Organization1; <br>  sirin-bird2;  password2;  First name2;  Last Name2;  Position2;  Division2;  Organization2; <br>  sirin-bird4;  password3;  Name2 Patronymic3  Surname3;  Position3;  Division3;  Organization3; <br>  sirin-bird3;  password4;  First name4;  Surname4;  Position4;  Division4;  Organization4; <br>  sirin-bird5;  password5;  Name2 Patronymic5;  Surname5;  Position5;  Division5;  Organization5; <br>  ... ... ... ... ... ... ... <br>  The creation of such a file can be entrusted to unqualified personnel who know how to handle an elementary text editor.  And then just check the correctness of typing and placement of delimiters, as your humble servant did. <br><br>  <u><b>Another important note!</b></u> <br>  The ‚ÄúOrganization‚Äù parameter is the OU for the corresponding user and is not created by this script, so in order for everything to work, first create the corresponding OU in the root of the domain (near the ‚ÄúUsers‚Äù OU folder).  This is due to the fact that in my domain there were several client organizations with their users, employees, hence this division. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <u><b>So, the script itself:</b></u> <br>  Set objArgs = WScript.Arguments <br>  if objArgs.Count = 0 then <br>  WScript.Echo ‚ÄúAdd users to the domain.‚Äù <br>  WScript.Echo "add_to_ad.vbs [filename]" <br>  WScript.Echo "[file name] - file with list of users" <br>  WScript.Echo "file format: Login; Password; First Name; Last Name; Position; Department; Organization;" <br>  WScript.Quit <br>  end if <br>  path = objArgs (0) <br><br>  Set fso = CreateObject ("Scripting.FileSystemObject") <br>  Set objFile = fso.OpenTextFile (path, 1) <br>  Do Until objFile.AtEndOfStream <br>  str = objFile.ReadLine <br>  for i = 1 to Len (str) step 1 <br>  strCh = Mid (str, i, 1) <br>  if strCh = ";"  then <br>  select case Z <br>  case 0 <br>  UserName = strRez '*** Login <br>  case 1 <br>  UserPassword = strRez '*** Password <br>  case 2 <br>  FirstName = strRez '*** First Name <br>  case 3 <br>  LastName = strRez '*** Last Name <br>  case 4 <br>  Title = strRez '*** Title <br>  case 5 <br>  Department = strRez '*** Division <br>  case 6 <br>  Company = strRez '*** Organization <br>  'case 7 <br>  'Manager = strRez' *** Head <br>  'case 8 <br>  'OfficeRoom = strRez' *** Room <br>  end select <br>  strRez = "" <br>  strCh = "" <br>  Z = Z + 1 <br>  else <br>  strRez = strRez + strCh <br>  end if <br>  next <br>  strRez = "" <br>  strCh = "" <br>  Z = 0 <br><br>  Set objRoot = GetObject ("LDAP: // RootDSE") <br>  Set objADSystemInfo = CreateObject ("ADSystemInfo") <br>  DomainDNSName = objADSystemInfo.DomainDNSName <br>  DomainDN = objRoot.Get ("DefaultNamingContext") <br>  ContainerDN = "ou =" &amp; Company &amp; "," &amp; DomainDN <br><br>  pName = UserName &amp; "@" &amp; DomainDNSName '"@ snb.local" <br><br>  '!!!  IMPORTANT !!! *** We indicate in advance the CREATED OU in which new users rush ******* <br><br>  Set objOU = GetObject ("LDAP: //" &amp; ContainerDN) <br><br>  '*************************** Create domain user account ****************** ***** <br>  Set objUser = objOU.Create ("User", "cn =" + UserName) <br>  '**** Login ***** <br>  objUser.Put "sAMAccountName", UserName <br>  objUser.SetInfo <br><br>  '****** password ******* <br>  Set objUser = GetObject ("LDAP: // cn =" + UserName + "," + ContainerDN) <br>  objUser.SetPassword UserPassword <br><br>  '******* UPN ********** <br>  objUser.Put "userPrincipalName", pName <br><br>  '****** account shutdown ******* <br>  objUser.AccountDisabled = TRUE <br><br>  '******** First Name ********* <br>  objUser.Put "givenName", FirstName <br><br>  '***** Last Name ********* <br>  objUser.Put "sn", LastName <br><br>  '***** Display Name ****** <br>  objUser.Put "displayName", LastName &amp; "" &amp; FirstName <br><br>  'Initials <br>  objUser.Put "initials", left (FirstName, 1) &amp; "."  '&amp; left (LastName, 1) <br><br>  ' ***** Position ****** <br>  objUser.Put "title", Title <br><br>  ' ***** Department ****** <br>  objUser.Put "department", Department <br><br>  'Organization <br>  objUser.Put "Company", Company <br><br>  'Head <br>  'objUser.Put "manager", Manager <br><br>  'room <br>  'objUser.Put "physicalDeliveryOfficeName", OfficeRoom <br><br>  '***** Const.  Require password change on next login *** <br>  objUser.Put "pwdLastSet", CLng (0) <br><br>  objUser.SetInfo <br><br>  'WScript.Echo "User -" + UserName + "added to AD" <br><br>  Loop <br>  WScript.Echo "Users added to AD" <br>  objFile.Close <br><br>  <b><u>additional code to insert into the script:</u></b> <br><br>  'Home directory <br>  'objUser.Put "HomeDirectory", strHomeDirPath <br><br>  ' mailbox <br>  'objUser.Put "mailNickname", strName <br><br>  ' site <br>  'objUser.Put "wWWHomePage", " <a href="http://www.test.com/">www.test.com</a> " <br><br>  Some more examples: <br>  'ObjUser.Put "Description", "Year 2" <br>  'objUser.Put "physicalDeliveryOfficeName", sOfficeName <br>  'objUser.Put "ProfilePath", sScPath <br>  'sHDrive objUser.Put "HomeDrive", "Z" <br>  'objUser.Put "TerminalServicesProfilePath", sTermProf <br>  'objUser.Put "TerminalServicesHomeDirectory", sTermHDir <br><br>  The code from the text editor should be saved with the extension .vbs <br>  The launch of the script is carried out with the transfer of parameters from the file. <br>  For example: script.vbs users.txt <br>  where <br>  script.vbs - the script itself <br>  users.txt - file with input data. <br><br>  Script execution takes seconds with instant output. <br>  As you can see from the code, if you uncover a couple more lines and make additions to the file with the input parameters, then you can also add the Manager and the Room Number on the machine.  The script can be developed indefinitely.  For example, add the ability to add a field like ‚ÄúPhone‚Äù in the same way. <br>  As a text editor for Windows, I can advise free to use and highly functional Notepad ++. <br>  One of the useful links where there are scripts on VBS: <a href="http://forum.sysadmins.su/">forum.sysadmins.su</a> <br>  I hope this information will be for someone very useful and necessary. </div><p>Source: <a href="https://habr.com/ru/post/146980/">https://habr.com/ru/post/146980/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../146974/index.html">Activision Blizzard sells for $ 8.1 billion</a></li>
<li><a href="../146975/index.html">Do you still think that plugging a pair of wires into the Arduino is DIY?</a></li>
<li><a href="../146976/index.html">PR on Habrahabr. Statistics, expectations, reality and surprises</a></li>
<li><a href="../146978/index.html">Overview of Huawei E560 Wireless 3G Router</a></li>
<li><a href="../146979/index.html">Google Nexus 7 in Ukraine promises to sell in September for $ 350</a></li>
<li><a href="../146982/index.html">% username%, and where did you start immersion in programming?</a></li>
<li><a href="../146983/index.html">Web development on node.js and express. We study node.js in practice</a></li>
<li><a href="../146984/index.html">Integration tests with Maven, JUnit and Spring</a></li>
<li><a href="../146986/index.html">Tutoronline.ru: online tutorial call on the Internet. How it works?</a></li>
<li><a href="../146987/index.html">About the power interchange with examples</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>