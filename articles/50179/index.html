<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using the console when debugging ASP.Net applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I'm going to start a new project and gradually approaching the stage of writing some basic things. I decided to collect and systematize my knowledge a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using the console when debugging ASP.Net applications</h1><div class="post__text post__text-html js-mediator-article">  I'm going to start a new project and gradually approaching the stage of writing some basic things.  I decided to collect and systematize my knowledge about some aspects of software development on the ASP.Net platform, obtained for more than a year of commercial development.  The result was this article.  She does not pretend to fundamentally new things, everyone knows this for a long time, in a certain sense these are peculiar best practices.  All that is written below is most likely useful for beginners, but experienced developers will be able to learn something interesting for themselves. <br><a name="habracut"></a><br>  You and I live in a time of advanced development tools, debuggers that support debugging of multi-threaded applications, and many other extremely useful things.  But like any other phenomenon, such progress has its drawbacks - on not the fastest machines, the step-by-step debugging process can turn into a developer‚Äôs nightmare.  Everything hangs, the debugger hints to you that it would be time to upgrade the car, after a half-hour journey through the code of your offspring you press F10 again and with horror fly along with the exception thrown somewhere in the depths of the code to the top level, into a carefully crafted catch .  The exception message tells you that incorrect arguments came to the method, but it is absolutely incomprehensible where they came from and how.  Gritting your teeth and armed with patience, you once again start the hunt for a nasty bug ... <br>  I have several years of programming programming competitions behind my back, which were accompanied by writing code on a variety of tools from Turbo Pascal to Visual Studio 2008 in a variety of conditions.  Who does not know, Olympiads usually take place in various universities.  Sometimes computers killed by students hung to impossibility, and the number of viruses on the machine exceeded any reasonable framework.  However, all participants of the competition are in such conditions, so there is no time to complain - you need to solve the tasks.  So, over the years I learned a very important thing: perhaps the best debagger is the console.  Yes, yes, here is the same, the usual black thing, on which gray letters are crawling up.  However, the colors depend on the user's imagination. <br>  Even on fast machines, the console is convenient for debugging long iterative or recursive calculations ‚Äî it gives out information much faster than a regular debugger, all at once, along with intermediate results, you just need to enter in the places of interest to you Console.WriteLine, printf, system.out.println or equivalent in the language in which you write your applications.  The console is the same log, but you do not need to go into the files to view it, it is on your screen and you can see everything that interests you at once.  In the end, I think that many of the developers used it at least once in their life for debugging. <br>  Today I will show you, using the ASP.Net MVC application as an example, how to use the console when debugging and logging.  So let's get started. <br>  First, we need to unizalize the console itself.  To do this, we describe a small static class ConsoleManager, in which we import AllocConsole from kernel32.dll.  We will also add a method that will initialize the console, set its output and clean it before starting the application: <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">class</font> ConsoleManager&lt;br&gt;  {&lt;br&gt;    [DllImport( <font color="#A31515">"kernel32.dll"</font> , EntryPoint = <font color="#A31515">"AllocConsole"</font> , CharSet = CharSet.Unicode)]&lt;br&gt; <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">extern</font> <font color="#0000ff">bool</font> AllocConsole();&lt;br&gt;&lt;br&gt; <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> InitializeConsoleManager()&lt;br&gt;    {&lt;br&gt; <font color="#0000ff">#if</font> CONSOLE&lt;br&gt; <font color="#0000ff">try</font> &lt;br&gt;      {&lt;br&gt;        AllocConsole();&lt;br&gt; <font color="#2B91AF">Console</font> .SetOut( <font color="#0000ff">new</font> TextWriter( <font color="#0000ff">new</font> StreamWriter( <font color="#2B91AF">Console</font> .OpenStandardOutput(), <font color="#2B91AF">Encoding</font> .Default, 100)));&lt;br&gt; <font color="#2B91AF">Console</font> .Clear();&lt;br&gt;      }&lt;br&gt; <font color="#0000ff">catch</font> (Exception)&lt;br&gt;      {&lt;br&gt;      }&lt;br&gt; <font color="#0000ff">#endif</font> &lt;br&gt;    }&lt;br&gt;  }&lt;br&gt;</font> &lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Since we do not want the console to be visible during normal operation of the application on the server, we enclosed the code initializing it in the conditional compilation directive and of course did not forget to define the CONSOLE symbol in the Debug configuration of the project.  Now we climb into Global.asax and initialize the console at the start of the application: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">protected</font> <font color="#0000ff">void</font> Application_Start()&lt;br&gt;    {&lt;br&gt;      ConsoleManager.InitializeConsoleManager();&lt;br&gt; <font color="#008000">// ...</font> &lt;br&gt;    }&lt;br&gt;</font> &lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Hooray, now when you start the application, we have a black application window!  Great, but this work is not over - now we will decorate it a little.  An almost indispensable attribute of any web application is the logs - because often they are practically the only evidence by which you can track down an error on a running server.  Sin does not duplicate logger messages in our console - it saves a lot of time when debugging.  In order to distinguish which messages need to be written to and to the file and to the console, and which only to the console we will describe the listing: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">enum</font> Severity&lt;br&gt;  {&lt;br&gt;    None,&lt;br&gt;    Event,&lt;br&gt;    Error,&lt;br&gt;    Debug,&lt;br&gt;  }&lt;br&gt;</font> &lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  It's simple: <br><ul><li>  None - unimportant information, is not written to the file, is displayed on the console in dark gray in order not to distract;  usage example - logging http-request; </li><li>  Event - an event in the life of the site - is written to a file, displayed on the console in green;  example - user logged in; </li><li>  Error - somewhere there was a trouble - is written to a file, to the console in bright red;  usage example - unhandled exception; </li><li>  Debug - almost the same as None, but more important - is displayed only on the console in blue;  An example of use is the intermediate results of a long calculation that needs to be checked. </li></ul><br>  To determine the color corresponding to a specific type of message, we write a simple extension-method: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">static</font> ConsoleColor GetLogEntryColor( <font color="#0000ff">this</font> Severity severity)&lt;br&gt;    {&lt;br&gt; <font color="#0000ff">switch</font> (severity)&lt;br&gt;      {&lt;br&gt; <font color="#0000ff">case</font> Severity.None:&lt;br&gt; <font color="#0000ff">return</font> ConsoleColor.DarkGray;&lt;br&gt; <font color="#0000ff">case</font> Severity.Event:&lt;br&gt; <font color="#0000ff">return</font> ConsoleColor.Green;&lt;br&gt; <font color="#0000ff">case</font> Severity.Error:&lt;br&gt; <font color="#0000ff">return</font> ConsoleColor.Red;&lt;br&gt; <font color="#0000ff">case</font> Severity.Debug:&lt;br&gt; <font color="#0000ff">return</font> ConsoleColor.Cyan;&lt;br&gt; <font color="#0000ff">default</font> :&lt;br&gt; <font color="#0000ff">throw</font> <font color="#0000ff">new</font> ArgumentException( <font color="#0000ff">string</font> .Format( <font color="#A31515">"Unknown severity: '{0}'"</font> , severity));&lt;br&gt;      }&lt;br&gt;    }&lt;br&gt;</font> &lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Here it should be noted that the declarative approach would be much more beautiful: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">enum</font> Severity&lt;br&gt;  {&lt;br&gt;    [SeverityColor(ConsoleColor.DarkGray)]&lt;br&gt;    None,&lt;br&gt;    [SeverityColor(ConsoleColor.Green)]&lt;br&gt;    Event,&lt;br&gt;    [SeverityColor(ConsoleColor.Red)]&lt;br&gt;    Error,&lt;br&gt;    [SeverityColor(ConsoleColor.Cyan)]&lt;br&gt;    Debug,&lt;br&gt;  }&lt;br&gt;</font> &lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  but for performance reasons, I refused it.  The question is controversial and maybe in the future I will come back to it.  Now all that remains is to describe our logger, not forgetting that ASP.Net applications are multi-threaded: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">class</font> Logger&lt;br&gt;  {&lt;br&gt;    [ThreadStatic]&lt;br&gt; <font color="#0000ff">private</font> <font color="#0000ff">static</font> Severity m_CurrentSeverity;&lt;br&gt;&lt;br&gt; <font color="#008000">/// &lt;summary&gt;</font> &lt;br&gt; <font color="#008000">/// Writes debug message to log</font> &lt;br&gt; <font color="#008000">/// &lt;/summary&gt;</font> &lt;br&gt; <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> WriteToLog( <font color="#0000ff">string</font> message)&lt;br&gt;    {&lt;br&gt;      WriteToLog(message, Severity.Debug);&lt;br&gt;    }&lt;br&gt;&lt;br&gt; <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> WriteToLog( <font color="#0000ff">string</font> message, Severity severity)&lt;br&gt;    {&lt;br&gt; <font color="#0000ff">lock</font> ( <font color="#0000ff">typeof</font> (Logger))&lt;br&gt;      {&lt;br&gt;        m_CurrentSeverity = severity;&lt;br&gt;        WriteLineStart();&lt;br&gt;        WriteLine(message);&lt;br&gt;      }&lt;br&gt;    }&lt;br&gt;&lt;br&gt; <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> WriteLine( <font color="#0000ff">string</font> message)&lt;br&gt;    {&lt;br&gt;      Write(message + Environment.NewLine);&lt;br&gt;    }&lt;br&gt;&lt;br&gt; <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Write( <font color="#0000ff">string</font> message, <font color="#0000ff">params</font> <font color="#0000ff">object</font> [] parameters)&lt;br&gt;    {&lt;br&gt;      Write( <font color="#0000ff">string</font> .Format(message, parameters));&lt;br&gt;    }&lt;br&gt;&lt;br&gt; <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Write( <font color="#0000ff">string</font> message)&lt;br&gt;    {&lt;br&gt; <font color="#2B91AF">Console</font> .ForegroundColor = m_CurrentSeverity.GetLogEntryColor();&lt;br&gt; <font color="#2B91AF">Console</font> .Write(message);&lt;br&gt; <font color="#0000ff">if</font> (m_CurrentSeverity == Severity.Error || m_CurrentSeverity == Severity.Event)&lt;br&gt;      {&lt;br&gt; <font color="#008000">// file logging</font> &lt;br&gt;      }&lt;br&gt;    }&lt;br&gt;&lt;br&gt; <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> WriteLineStart()&lt;br&gt;    {&lt;br&gt;      Write( <font color="#A31515">"{0} -&gt; "</font> , <font color="#2B91AF">DateTime</font> .Now);&lt;br&gt;    }&lt;br&gt;  }&lt;br&gt;</font> &lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Everything is intentionally oversimplified for greater understanding.  Console during debugging looks like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/3c3/047/f9b/3c3047f9bd1fd07382f461f0b8523501.png"><br>  From my own experience I will say that with such a console the life of a developer becomes much easier. <br>  Thank. <br>  <b>UPD.</b>  I was prompted here that there is an alternative tool - the <a href="http://technet.microsoft.com/en-us/sysinternals/bb896647.aspx">Debug View</a> program, which implements almost identical functionality. <br></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/50179/">https://habr.com/ru/post/50179/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../50173/index.html">The title problem in personal blogs Habra</a></li>
<li><a href="../50174/index.html">Attacks on wireless networks. Part 1</a></li>
<li><a href="../50175/index.html">IE bugs. Part 1. The presence or absence of hasLayout</a></li>
<li><a href="../50176/index.html">Introduction</a></li>
<li><a href="../50177/index.html">Likbez on the basics of security and cryptography</a></li>
<li><a href="../50181/index.html">Comments are visible only to the author of the topic.</a></li>
<li><a href="../50182/index.html">Popular errors administrators jabber-servers</a></li>
<li><a href="../50184/index.html">Python. Plasma snake</a></li>
<li><a href="../50187/index.html">Nhibernate. DAO + Generic</a></li>
<li><a href="../50189/index.html">Budget planning</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>