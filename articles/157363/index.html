<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Qt signal / slot implementation on Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword 
 Recently I have ported a rather large project from Qt (C ++) to Android (Java), in the process of work I often had to apply dynamic linking...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Qt signal / slot implementation on Android</h1><div class="post__text post__text-html js-mediator-article"><h4>  Foreword </h4><br>  Recently I have ported a rather large project from Qt (C ++) to Android (Java), in the process of work I often had to apply dynamic linking of objects.  The trouble was that, in contrast to the usual signals and slots, Qt in Java is implemented through listeners, and how much I did not try to convince myself that this method is equivalent and also takes place to be the same convenience as when using signals and slots could not be reached. <br>  For example, we need to associate a slider (QSlider in Qt or SeekBar in Android) with some action, at least to bind another slider that will obediently move after the first one.  In Qt, a similar operation looks like this: <br><a name="habracut"></a><br><br><h6>  Example 1 </h6><br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//   QSlider *primary = new QSlider(this); QSlider *secondary = new QSlider(this); //   ,  // ... //      connect(primary, SIGNAL(valueChanged(int)), secondary, SLOT(setValue(int)));</span></span></code> </pre> <br><br>  As a result, we get the connection of the <i>valueChanged ()</i> signal of the <i>primary</i> <i>slider</i> with the <i>setValue ()</i> slot of the <i>secondary slider</i> .  The same on Android: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h6>  Example 2 </h6><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//   SeekBar firstBar = (SeekBar)findViewById(R.id.firstSeekBar); SeekBar secondBar = (SeekBar)findViewById(R.id.secondSeekBar); //  // ... //      firstBar.setOnSeekBarChangeListener(new OnSeekBarChangeListener() { @Override // ........ @Override public void onProgressChanged(SeekBar seekBar, int progress, boolean fromUser) { secondBar.setProgress(progress); } });</span></span></code> </pre><br><br>  And as a result we get the same thing, that is, we associate the displacement of <i>firstBar</i> and <i>secondBar</i> . <br>  Let's see what's going on here.  Somewhere in the depths of <i>firstBar</i> there is a variable of the <i>OnSeekBarChangeListener</i> type which, when a move <i>occurs,</i> is checked for <i>null</i> and if it turns out to be non-zero, and so it happens, its <i>onProgressChanged ()</i> method will be called with the appropriate parameters which in turn will call <i>secondBar.setProgress (progress)</i> and set the value of the second slider. <br>  Everything is very clear and understandable, although somewhat cumbersome.  Qt is more concise in this case, although to implement dynamic binding it goes beyond C ++ to generate code in the project building process using <i>MOC (Meta Object Compiler)</i> .  You have to pay for conciseness, and it becomes obvious when in the process of debugging you get into the generation code.  But fortunately, if you follow the simplest rules, this is extremely rare. <br>  But back to Android.  All Android API classes have a sufficient set of liseners to provide convenience of their use, but what to do if there is a large array of code operating with signals and slots?  Googling, I found several implementations of signals and slots in Java, the most worthy of which, not surprisingly, in the <a href="http://doc.qt.digia.com/qq/qq20-jambi.html">Qt Jambi</a> library, an unfairly forgotten implementation of Qt in Java.  An excellent implementation, however, did not suit me for several reasons, the most weighty of which, the inconsistency of the syntax with the original, it is strange that the same technology as part of the libraries for C ++ and Java is implemented so differently. <br>  As a result, the idea to implement the signals and slots for Android on Java independently emerged. <br><br><h4>  Task </h4><br>  Implement a Java signal and slot engine as close as possible to the Qt C ++ syntax using the Android API. <br><br><h4>  Implementation </h4><br><h5>  What happened </h5><br>  After several attempts, the Java <i>Connector</i> class was written on less than 600 lines with several static methods and a static map (Map) of signals and slots, which is essentially a singleton.  All functionality is enclosed in four static methods: <br><br><ol><li>  <i>boolean connect (Object sender, String signal, Object receiver, String slot, ConnectionType type)</i> </li><li>  <i>void disconnect (Object sender, String signal, Object receiver, String slot)</i> </li><li>  <i>void emit (Object sender, String signalName, Object ... params)</i> </li><li>  <i>Object sender ()</i> </li></ol><br><ul><li>  <i>connect ()</i> allows you to connect a signal and a slot, a type in this context is an enumeration instance that can take the values ‚Äã‚Äãof <i>DirectConnection</i> and <i>QueuedConnection</i> by analogy with Qt.  <i>DirectConnection</i> , the default, also works as the lisener in Example 1. <i>QueuedConnection</i> uses the <i>Handler</i> from the Android API to implement an asynchronous slot call.  Other types of connections remained unrealized, since  The listed 2 covered 100% of cases occurring in a ported project. </li><li>  <i>disconnect ()</i> operation is reverse to connect.  Breaks the signal connection with the slot.  It has options with 4, 3, 2, and 1m parameter.  Which respectively break the signal connection with a specific slot, the signal connection with all receiver slots (receiver), the signal connection with all slots, and the sender connection (sender) with all slots. </li><li>  <i>emit ()</i> allows you to send a signal from an arbitrary location in the program.  The first parameter contains a link to the object (sender) that this signal sends, usually <i>this</i> .  Declaring a signal as a method or variable, unlike other implementations, is not required in this case; the signal is simply an arbitrary string that must necessarily coincide with the string passed in the <i>connect ()</i> method.  Then a comma can be followed by an arbitrary number of parameters of arbitrary types, all of which, or at least the first of them, must coincide with the slot parameters. </li><li>  <i>sender () is a</i> very useful method, also an analog from Qt, called from the body of the slot and returns a pointer (in Java, an Object type reference) to the object that sent the signal. </li></ul><br>  In the runner example, the connection would look like this: <br><br><h6>  Example 3 </h6><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//     Android API    private static class SeekBarChangeListener implements SeekBar.OnSeekBarChangeListener { private Object mSender = null; public SeekBarChangeListener(Object sender) { mSender = sender; } @Override // ........ @Override public void onProgressChanged(SeekBar seekBar, int progress, boolean fromUser) { Connector.emit(mSender, "progressChanged", progress); } } //   SeekBar firstBar = (SeekBar)findViewById(R.id.firstSeekBar); SeekBar secondBar = (SeekBar)findViewById(R.id.secondSeekBar); //  // ... //  firsBar   firstBar.setOnSeekBarChangeListener(new SeekBarChangeListener(firstBar)); //      Connector.connect(firstBar, "SIGNAL(progressChanged(int))" , secondBar, "SLOT(setProgress(int))");</span></span></code> </pre><br>  At first glance it may seem that the implementation with the <i>Connector is</i> more cumbersome than with the help of the logger, but do not forget that the <i>SeekBar</i> class is sharpened for the use of the logger, like all other standard Android API classes, because you have to use wrappers.  Much more benefits can be obtained by using a connector when developing your classes, or by porting Qt projects on Android: <br><ol><li>  no need to create an interface for licenser </li><li>  no need to create a variable for it </li><li>  no setter method needed for licer </li></ol><br><br>  For more complex examples, details about the implementation details, see the next article. <br>  <i>(To be continued)</i> </div><p>Source: <a href="https://habr.com/ru/post/157363/">https://habr.com/ru/post/157363/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../157351/index.html">How to make a desktop, or outsourcing decides</a></li>
<li><a href="../157353/index.html">Nested Diagnostic Context, log4cpp and Boost asio</a></li>
<li><a href="../157357/index.html">On intellectual property with a cool head. Part 1</a></li>
<li><a href="../157359/index.html">Google turns off background images in search</a></li>
<li><a href="../157361/index.html">Android Phishing</a></li>
<li><a href="../157367/index.html">On intellectual property with a cool head. Part 2</a></li>
<li><a href="../157369/index.html">Kim Dotcom promises $ 400 million fiber and free internet to all New Zealand residents</a></li>
<li><a href="../157371/index.html">Webshell on TCL, for Cisco IOS, and more</a></li>
<li><a href="../157373/index.html">Anonymous merged VMware ESX kernel source</a></li>
<li><a href="../157377/index.html">School crafts: Battlecruiser & DeathCraft</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>