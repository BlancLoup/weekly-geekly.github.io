<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Generating the correct code of the banner zone in JavaScript</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Imagine that we are doing an ad network or something else like that, where you need to give users a certain JS code, by inserting that into different ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Generating the correct code of the banner zone in JavaScript</h1><div class="post__text post__text-html js-mediator-article">  Imagine that we are doing an ad network or something else like that, where you need to give users a certain JS code, by inserting that into different places of the page, different things will be displayed there.  Banners, for example.  The most common options I encountered were: <br><br><ul><li>  Plain html banner code insertion (flash drives, pictures). </li><li>  Insert an iframe, where the html code is generated by a separate request in the iframe. </li><li>  When code is written to js via document.write for the above two methods. </li></ul><br>  The common feature of these approaches is that banners load as the page loads, and if something slows down, the whole page will slow down.  Secondly, it will be problematic to update the code that directly shows the banner when outputting to a page.  Perhaps this is not critical. <br><br>  But, in addition to improving these two points, let's add two more conditions to our task and see how well our foreign colleagues decided on buysellads.com.  It is necessary for the banner zone to show any code, as well as in the request for the banner to send any information from our other service (for example, the user id in our service that keeps a history of actions on the site). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, we generate the correct codes for banner zones and write a handler for them under the habrakat. <br><a name="habracut"></a><br>  I will tell briefly and schematically, but with a working example, and in detail it will be possible to look at the code for inspiration <a href="">here</a> and correct it for reading <a href="http://jsbeautifier.org/">here</a> . <br><br>  To solve the above four tasks, you need to make a single script banner uploader, which can be updated at any time, which, before outputting the banners to the page, requests the necessary information from another service and can display any banner on the page.  It seemed to me that buysellads sinned a little by dividing the code that they give webmasters into two parts.  A single banner uploader script is connected in the header, and then the places where they will be shown are placed on the page. <br><br>  In our case, it will be possible to do the same or call the loader next to each banner place, showing the webmaster a single code for the banner zone.  Example of inserting a banner on the page: <br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://digistr.net/static/digistrnet.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">var</span></span></span><span class="actionscript"> bn = {width: </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">200</span></span></span><span class="actionscript">, height: </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">600</span></span></span><span class="actionscript">, param: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"value"</span></span></span><span class="actionscript">} _digistrNET.showProducts(bn); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Such codes can be added as many times per page.  We have some parameters and a function that draws a banner.  In my case, it shows certain goods.  Demo, which I comment on, you can watch <a href="">here</a> .  Everything is done as quickly and easily as possible.  Refactoring and complications sometime in the future, it can be updated easily :) <br><br>  So, if I (the loader) have not yet loaded onto the page, then we write all the functions that we need.  Here, the showProducts function is immediately called, but the banner is not drawn.  For now, we just need to remember where it will be shown when loading the page.  To do this, when we call, we create in the current place an empty and invisible div with a specific id, so that later it can be found on the page.  In addition, for simplicity, we keep records of calls to this function and immediately generate the banner code, which will be shown in this place.  This is a bit indecent since there is no data from another service yet, but so far.  By the way, here too the banner code can be any.  We can also upload any scripts, either insert the flash drive immediately, or simply print the text on the page. <br><br>  In buysellads, such divs are immediately put on the page, where in the class the code of the banner space is indicated in order to determine later which banner to show.  The banner code is not generated there, it is followed by a request to the JS file, which already displays the banner. <br><br>  Then we see that in the loader, after all the functions at the end of the file, there is a request for the necessary data for the banners.  I have this _loadTracker.  In response, we will receive a script that calls our callback function, as they say about <a href="http://ru.wikipedia.org/wiki/JSON">JSONP</a> , which will provide our loader with the received data for personal use. <br><br>  Further on the code on window.onload we call the display of our banners.  Thus, they will be shown when everything is loaded on the page.  It is worth adding a check in case the data from a third-party service has not yet arrived, then you need to wait and try again later on with a timer.  But, usually, before the page loads, this data already comes.  The page is loaded.  Although it is interesting, whether onload is waiting for the data requested in the scripts to load or just quickly everything has loaded in this example.  Who will tell? <br><br>  When the data is received, we go over the entire list of banners that we made when calling showProducts and output the corresponding code instead of the divs we‚Äôve left earlier, replacing the previously missing parameter trackid. <br><br>  In the case of buysellads, they use getElementsByClassName and getElementsByTagName to search for divs placed on the page.  Something is not just there, how to look.  But in their case, there is no waiting until the boot loader loads.  This code is inserted asynchronously: <br><pre> <code class="html hljs xml"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- BuySellAds.com Ad Code --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> (</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>)</span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> bsa = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.createElement(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'script'</span></span></span><span class="javascript">); bsa.type = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'text/javascript'</span></span></span><span class="javascript">; bsa.async = </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">true</span></span></span><span class="javascript">; bsa.src = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'http://cdn.buysellads.com/ac/pro.js'</span></span></span><span class="javascript">; (</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.getElementsByTagName(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'head'</span></span></span><span class="javascript">)[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">]||</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.getElementsByTagName(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'body'</span></span></span><span class="javascript">)[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">]).appendChild(bsa); })(); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- END BuySellAds.com Ad Code --&gt;</span></span></code> </pre><br><br>  Divs are thrown onto the page, without calling JS from this loader. <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bsap_23"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bsaPROrocks"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-serve</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"CVAE"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  This is a bit cooler than in the example we have considered.  But in my case it is easier to work with parameters, they are immediately written to the page and with their large numbers it will be more convenient, without additional requests for parameters, to the database.  As in your case, you choose - this is a general scheme. <br><br>  The general loader code can be moved to the header (before the first banner is called), or to call it together with each parameter (it will not matter from the cache), create your own script for transferring the banner parameters and any options to display on the page.  Everything will appear after the page loads. <br><br>  Well that's all.  Banners on the page.  The method seemed the most correct of the revised on the Internet.  What do you think, besides what looks like anger banners? </div><p>Source: <a href="https://habr.com/ru/post/215673/">https://habr.com/ru/post/215673/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../215661/index.html">In the Indian police for 8 years did not respond to complaints because they lost the password from the database</a></li>
<li><a href="../215665/index.html">+ (AppStore *) Timera: application architecture and design features. Part 2</a></li>
<li><a href="../215667/index.html">Pwn2Own 2014: first results</a></li>
<li><a href="../215669/index.html">New gTLD statistics</a></li>
<li><a href="../215671/index.html">How to return to the usual style of issuing Google. Simple instruction</a></li>
<li><a href="../215675/index.html">Rails 4. Web Application Development</a></li>
<li><a href="../215681/index.html">ReactiveCocoa and MVVM</a></li>
<li><a href="../215683/index.html">Sketch.app site design. Part 2.1: we suggest beauty</a></li>
<li><a href="../215685/index.html">Configuring Digium Phones via DPMA Module in Elastix</a></li>
<li><a href="../215687/index.html">How to handle IA-32 code or Simics decoder features</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>