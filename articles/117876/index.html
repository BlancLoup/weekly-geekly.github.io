<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Django - error handling in ajax forms</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello everyone! 

 We all know that Django is a very powerful and dynamically developing framework for creating web applications. However, despite the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Django - error handling in ajax forms</h1><div class="post__text post__text-html js-mediator-article">  Hello everyone! <br><br>  We all know that <a href="http://www.djangoproject.com/">Django</a> is a very powerful and dynamically developing framework for creating web applications.  However, despite the advent of the Web 2.0 era, there are still no built-in mechanisms for working with <b>AJAX</b> , in particular, sending and checking forms.  Perhaps django simply does not want to impose some js framework on the user and wants to remain flexible in this matter, but one way or another, development often requires forms that work via ajax, without page reloads. <br>  The creation of such forms and work with them will be discussed in this article. <br><br>  At once I will make a reservation that the idea is not new, and there are several libraries that implement the required functionality, for example, one of them is <a href="http://www.dajaxproject.com/">http://www.dajaxproject.com/</a> . <br>  For those who prefer to manage the client‚Äôs interaction with the server themselves or those who don‚Äôt want to draw an additional library into the project and deal with its bugs, I‚Äôll tell you how to <s>invent a bike to</s> implement the mechanism yourself and describe various ways to solve the problem. <br><a name="habracut"></a><br><h4>  The form </h4><br>  For example, take a simple user registration form on the site: <br><pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RegisterForm</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(forms.Form)</span></span></span><span class="hljs-class">:</span></span> email = forms.EmailField() password1 = forms.CharField(label=_(<span class="hljs-string"><span class="hljs-string">"Password"</span></span>), widget=forms.PasswordInput) password2 = forms.CharField(label=_(<span class="hljs-string"><span class="hljs-string">"Password confirmation"</span></span>), widget=forms.PasswordInput)</code> </pre> <br>  In real life, you will most likely inherit this form from the data model, but for our example this is not essential. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Form output </h4><br>  To display this form on the page we have two options: <br><ul><li>  Make a container with <i>display: none</i> within all pages from which you can call a form (or within the parent template), then use JS to create a dialog from this container. </li><li>  Load the form via ajax from a separate URL, and then also create a dialog. </li></ul><br>  The advantage of the first option is in its speed (no additional requests to the server should be made), but in the second option you can use the same <b>view</b> to process <b>GET</b> and <b>POST</b> requests to the form (we will need POST in both cases), plus we make a separate a template file for form output, which makes the code structure more orderly, although this is of course a matter of taste. <br>  Personally, I embed something in a page template only if it is a simple <i>yes / no</i> dialog, and for forms I always use separate <b>views</b> . <br>  Therefore, we‚Äôll stop here on a separate view for the form, then the code will look like this: <br><ul><li>  <b>view</b> : <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">register</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request)</span></span></span><span class="hljs-function">:</span></span> form = RegisterForm() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> direct_to_template(request, <span class="hljs-string"><span class="hljs-string">"register.html"</span></span>, extra_context={<span class="hljs-string"><span class="hljs-string">'form'</span></span>: form })</code> </pre><br></li><li>  <b>template</b> : <br><pre> <code class="html hljs xml">{% load i18n %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"register_form"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{% url register %}"</span></span></span><span class="hljs-tag">&gt;</span></span> {% csrf_token %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> {{ form.as_ul }} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"register"</span></span></span><span class="hljs-tag">&gt;</span></span>{% trans "Register" %}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre></li></ul><h4>  Form processing </h4><br>  We proceed to the processing of the form.  Here it is necessary to take into account that the ajax handler must somehow understand whether the form has been successfully verified or contains errors.  The logical solution here, in my opinion, is to use <b>JSON</b> .  The server response will contain 2 parameters, the first of which is boolean, will report on the success or failure of the validation form.  With the second parameter, again, there are various options: <br><ul><li>  In case of successful verification of the form, this parameter may be empty, since the login form most likely redirects the user to the required url after logging in and it does not matter what is there, or it may be a string that needs to be displayed in the confirmation dialog. </li><li>  In the case when there are errors in the form again, there are 2 possible ways of displaying: <br><ol><li>  The first way is to re-render the form with errors through the template and place the entire html-response in a json-variable, which then replaces the contents of the entire form. </li><li>  The second way is to create an array of errors for all fields of the form and place it in a json variable, then output errors for each field in the loop. </li></ol></li></ul>  I like the second option ideologically more, because it displays only what is needed, without replacing the entire form.  Here I will show how to implement both methods.  The client-side form processing code uses the popular <b>jQuery</b> JS framework and its plugin called <a href="http://jquery.malsup.com/form/">jQuery Form Plugin</a> . <br><ol><li>  The first way: <br><br>  Final version <b>view</b> : <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">register</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> request.method == <span class="hljs-string"><span class="hljs-string">'POST'</span></span>: form = RegisterForm(request.POST) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> form.is_valid(): <span class="hljs-comment"><span class="hljs-comment">#  # ... return HttpResponse(simplejson.dumps({'response': _("Email with a confirmation link has been sent"), 'result': 'success'})) else: t = loader.get_template('register.html') ctx = RequestContext(request, {'form': form}) response = t.render(ctx) return HttpResponse(simplejson.dumps({'response': unicode(response), 'result': 'error'})) form = RegisterForm() return direct_to_template(request, "register.html", extra_context={'form': form })</span></span></code> </pre><br><br>  Client-side processing, javascript: <br><pre> <code class="javascript hljs">$(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'#register'</span></span>).live(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'#register_form'</span></span>).ajaxSubmit({ <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data, statusText, xhr, $form</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     $form.find('.error').remove(); if (data['result'] == 'success') { //  -  } else if (data['result'] == 'error') { //   $form.replaceWith(data['response']); } }, dataType: 'json' }); }); }</span></span></code> </pre></li><li>  The second way: <br><br>  Final version <b>view</b> : <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">register</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> request.method == <span class="hljs-string"><span class="hljs-string">'POST'</span></span>: form = RegisterForm(request.POST) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> form.is_valid(): <span class="hljs-comment"><span class="hljs-comment">#  # ... return HttpResponse(simplejson.dumps({'response': _("Email with a confirmation link has been sent"), 'result': 'success'})) else: #   response  ,  -   response = {} for k in form.errors: #       ... response[k] = form.errors[k][0] return HttpResponse(simplejson.dumps({'response': response, 'result': 'error'})) form = RegisterForm() return direct_to_template(request, "register.html", extra_context={'form': form })</span></span></code> </pre><br><br>  Client-side processing, javascript: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">display_form_errors</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">errors, $form</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> k <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> errors) { $form.find(<span class="hljs-string"><span class="hljs-string">'input[name='</span></span> + k + <span class="hljs-string"><span class="hljs-string">']'</span></span>).after(<span class="hljs-string"><span class="hljs-string">'&lt;div class="error"&gt;'</span></span> + errors[k] + <span class="hljs-string"><span class="hljs-string">'&lt;/div&gt;'</span></span>); } } $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'#register'</span></span>).live(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'#register_form'</span></span>).ajaxSubmit({ <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data, statusText, xhr, $form</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     $form.find('.error').remove(); if (data['result'] == 'success') { //  -  } else if (data['result'] == 'error') { //   display_form_errors(data['response'], $form); } }, dataType: 'json' }); }); }</span></span></code> </pre></li></ol>  It is also worth noting that when using the second method and the form template described earlier, errors will be displayed using the list item <b>&lt;ul&gt;</b> ; for another display, you need to make a different template or override the error class for the form. <br><br>  That's all.  I attach screenshots of the resulting form in various states: <br><br><img src="https://habrastorage.org/storage/habraeffect/a3/07/a307cc36b9dca67de388c2a060b1cfb2.png" alt="image"><br><br>  I will be glad to hear comments and learn other ways to work with ajax-forms. </div><p>Source: <a href="https://habr.com/ru/post/117876/">https://habr.com/ru/post/117876/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../117865/index.html">Google is starting to open up access to a new blogger design</a></li>
<li><a href="../117868/index.html">JavaScript magic: arguments</a></li>
<li><a href="../117869/index.html">"Tablet" from the iPad. Why iPad does not need doctors</a></li>
<li><a href="../117870/index.html">Monitoring of radiation around Fukushima NPP and crowdsourcing</a></li>
<li><a href="../117875/index.html">Easy way to share localhost</a></li>
<li><a href="../117878/index.html">GoPro Motorsports: camcorder onboard review</a></li>
<li><a href="../117879/index.html">WebMatrix: working with mobile clients definition package from 51Degrees.mobi</a></li>
<li><a href="../117881/index.html">Webpage = URL</a></li>
<li><a href="../117885/index.html">We write the client for Habr for Android</a></li>
<li><a href="../117887/index.html">Node.js and the javascript era</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>