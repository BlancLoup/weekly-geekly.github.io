<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Updateable multi-user macro</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I can not program, but I love very much! 
 A slightly modified quote by artist Vasi Lozhkin. 
 Article I want to share the experience of raising a mul...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Updateable multi-user macro</h1><div class="post__text post__text-html js-mediator-article">  I can not program, but I love very much! <br>  A slightly modified quote by artist Vasi Lozhkin. <br>  Article I want to share the experience of raising a multi-user system on VBA Excel. <br>  At the time of the decision to create a flexible application, there were about 7 macros working on large volumes (several files from 20 thousand lines to 370 thousand lines), weighing from 50 kilobytes to 12 megabytes, each of which was written in accordance with the knowledge existing at the time of writing.  Each macro was changed, added, corrected in terms of errors, and considering that these macros were used by more than 60 people, not all of whom were tracking the changes, they constantly tugged at me showing another error, which I had already corrected and sent to everyone.  To explain to the crowd how to properly use macros, I quit right away, because someone will not hear, someone will not understand what it is about, someone will take an already formatted table to work with macros, but I cannot predict who changes the tables. <br><br>  It was necessary to make one code, and not 60 copies of each change sent by mail. <br><a name="habracut"></a><br>  The solution quickly occurred to me, and Google quickly gave me the results of a programmatic change to the VBA code, which was later rolled back into practice.  So, the text without pictures is not interesting, here is the first, this is the structure of the application, which looks like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2f0/145/bc4/2f0145bc4dd82f460f88bdef26538154.jpg" alt="image"><br>  The user opening the file, activating the excel event "opening a book" performs the procedure in the file "client".  The procedure creates a menu by reading the files on the network.  By clicking on the button of the desired macro, an action is taken to create a module in the client from a file located on the network, performs actions and destroys the procedure within itself. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      What we get: <br>  - file for any macro is always one. <br>  - by clicking on the execution of a macro, the user will always use the latest code, which simplifies the support of macros. <br>  - the ability to write a log file for errors, indicating the user, in case you need to beat the one who spoiled everything. <br><br>  Further there will be a lot of copy-paste on the code changed for my tasks, I would gladly point out the authors, but honestly I don‚Äôt know, I took a lot of code from the bourgeois resources, something from the Russian, something invented by me, it was all accumulated for at least six months what in advance is a great litter before primary sources, if anything, write, delete. <br><br>  So, the practical part. <br><br>  We hang the event on the opening of the book: <br><br><pre><code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span> Workbook_Open() create_module_for_file <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span></code> </pre> <br>  The code is not tricky, the concept is one, give a kick for further action <br>  Procedure create_module_for_file: <br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">filemod</span></span> = OpenFileModule(<span class="hljs-string"><span class="hljs-string">"menu"</span></span>) cl_d.create_module (<span class="hljs-string"><span class="hljs-string">"menu"</span></span>) cl_d.write_sub_for_module_action filemod, <span class="hljs-string"><span class="hljs-string">"menu"</span></span> filemod = OpenFileModule(<span class="hljs-string"><span class="hljs-string">"list_action"</span></span>) cl_d.create_module (<span class="hljs-string"><span class="hljs-string">"list_action"</span></span>) cl_d.write_sub_for_module_action filemod, <span class="hljs-string"><span class="hljs-string">"list_action"</span></span></code> </pre><br>  Three lines of three actions, in the beginning we need to pick up the file with the module.  The following function is responsible for this: <br><pre> <code class="hljs vbscript"><span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> OpenFileModule(namemodule) <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> FSO = <span class="hljs-built_in"><span class="hljs-built_in">CreateObject</span></span>(<span class="hljs-string"><span class="hljs-string">"Scripting.FileSystemObject"</span></span>) filepath = <span class="hljs-string"><span class="hljs-string">"-//  //-"</span></span> mSearch = <span class="hljs-string"><span class="hljs-string">".txt"</span></span> OpenFileModule = FSO.GetFile(filepath &amp; <span class="hljs-string"><span class="hljs-string">"\"</span></span> &amp; namemodule &amp; mSearch) <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span></code> </pre><br>  Next, create a module: <br><pre> <code class="hljs php"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">Function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_module</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name_module)</span></span></span><span class="hljs-function"> '       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ThisWorkbook</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VBProject</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VBComponents</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vbext_ct_StdModule</span></span></span><span class="hljs-function"> '     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">k</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ThisWorkbook</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VBProject</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VBComponents</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Count</span></span></span><span class="hljs-function"> '     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ThisWorkbook</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VBProject</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VBComponents</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Item</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(k)</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Name</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">name_module</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">End</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Function</span></span></span></span></code> </pre><br>  And write to the module code from the file <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> write_sub_for_module_action(filepath, filename) <span class="hljs-keyword"><span class="hljs-keyword">Open</span></span> filepath <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> #<span class="hljs-number"><span class="hljs-number">1</span></span> s = "" <span class="hljs-keyword"><span class="hljs-keyword">Do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Until</span></span> EOF(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-type"><span class="hljs-type">Line</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> #<span class="hljs-number"><span class="hljs-number">1</span></span>, Data s = s &amp; Data &amp; z &amp; z <span class="hljs-keyword"><span class="hljs-keyword">Loop</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> vbComp = ThisWorkbook.VBProject.VBComponents(filename) <span class="hljs-keyword"><span class="hljs-keyword">With</span></span> vbComp.CodeModule .InsertLines .CountOfLines + <span class="hljs-number"><span class="hljs-number">1</span></span>, s <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">With</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> vbComp = <span class="hljs-keyword"><span class="hljs-keyword">Nothing</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Close</span></span> #<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span></code> </pre><br>  Having received files, we load the menu. <br>  When loading, a menu is created that fits into add-ons. <br><img src="https://habrastorage.org/getpro/habr/post_images/375/76a/159/37576a159567818cb6841465a5b24a87.jpg" alt="image"><br>  By code: <br>  - to start, delete, in case there will be an update: <br><pre> <code class="hljs pgsql">Application.CommandBars(<span class="hljs-number"><span class="hljs-number">1</span></span>).Controls("MTS_K").<span class="hljs-keyword"><span class="hljs-keyword">Delete</span></span> -   &lt;source lang=¬´VBScript¬ª&gt; <span class="hljs-string"><span class="hljs-string">'   , ,        MenuPos = Application.CommandBars(1).FindControl(ID:=30010).Index + 1 '</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> Menu = Application.CommandBars(<span class="hljs-number"><span class="hljs-number">1</span></span>).Controls.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>:=msoControlPopup, <span class="hljs-keyword"><span class="hljs-keyword">before</span></span>:=MenuPos, <span class="hljs-keyword"><span class="hljs-keyword">temporary</span></span>:=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-string"><span class="hljs-string">'     Menu.Caption = "MTS_K"</span></span></code> </pre><br><br>  The panel has been created, now we are creating the menu directly, which will create buttons directly for each file with macros. <br><pre> <code class="hljs 1c">'     Set Menuname = Menu.Controls.Add(Type:=msoControlPopup) '   <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  Menuname.Caption = <span class="hljs-string"><span class="hljs-string">" YES-&gt;NO"</span></span></code> </pre><br><br>  After the menu is created, buttons are added.  The menu was built on the principle file -&gt; one button.  In turn, one file with a macro can have several procedures that need to be called, and you can enter them in the sub menu.  This code creates 3 buttons: <br><pre> <code class="hljs vhdl">Set SubItem = MenuItem.Controls.Add(<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>:=msoControlButton) '   SubItem.Caption = <span class="hljs-string"><span class="hljs-string">"  "</span></span> ' ,      SubItem.FaceId = <span class="hljs-string"><span class="hljs-string">"801"</span></span> '    ,     SubItem.OnAction = <span class="hljs-string"><span class="hljs-string">"action11a"</span></span> '     SubItem.Enabled = <span class="hljs-literal"><span class="hljs-literal">True</span></span> '    Set SubItem = MenuItem.Controls.Add(<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>:=msoControlButton) SubItem.Caption = <span class="hljs-string"><span class="hljs-string">" "</span></span> SubItem.FaceId = <span class="hljs-string"><span class="hljs-string">"1038"</span></span> SubItem.OnAction = <span class="hljs-string"><span class="hljs-string">" action12a"</span></span> SubItem.Enabled = <span class="hljs-literal"><span class="hljs-literal">True</span></span> Set SubItem = MenuItem.Controls.Add(<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>:=msoControlButton) SubItem.Caption = <span class="hljs-string"><span class="hljs-string">"   "</span></span> SubItem.FaceId = <span class="hljs-string"><span class="hljs-string">"1038"</span></span> SubItem.OnAction = <span class="hljs-string"><span class="hljs-string">" action13a"</span></span> SubItem.Enabled = <span class="hljs-literal"><span class="hljs-literal">True</span></span></code> </pre><br><br>  The result is about this: <br><img src="https://lh4.googleusercontent.com/CnyBNKxBVjOfC53_RP8fe0TELLuJW6HsJSSgts25wO8=w461-h192-p-no" alt="image"><br>  In writing mode, changed the concept of work.  The task was to use the latest version of the code with each click "run macro".  Considering these circumstances, certain files will be downloaded to the client, let's call them index files, that is, modules that are constantly present after opening the file, these are ‚Äúmenu‚Äù and ‚Äúlist action‚Äù, and the macro files themselves will be loaded by pressing a button.  What is their meaning: the menu file forms the menu :) <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> MenuItem = PLEXMenu.Controls.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>:=msoControlPopup) MenuItem.Caption = "  " <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> SubItem = MenuItem.Controls.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>:=msoControlButton) SubItem.Caption = "  " SubItem.FaceId = "801" SubItem.OnAction = "action11" SubItem.Enabled = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span></code> </pre><br><br>  In the menu we see an event referring to the procedure ‚Äúaction1 ... x‚Äù, which sits in the second file ‚Äúlist_action‚Äù.  Let's look at its contents. <br><pre> <code class="hljs vbscript"><span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span> action11() <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> cl_d = <span class="hljs-keyword"><span class="hljs-keyword">New</span></span> Edit_module <span class="hljs-keyword"><span class="hljs-keyword">On</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Error</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Resume</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> cl_d.delete_modul_full (<span class="hljs-string"><span class="hljs-string">"action_yes_no"</span></span>) filemod = OpenFileModule(<span class="hljs-string"><span class="hljs-string">"action_yes_no"</span></span>) cl_d.create_module (<span class="hljs-string"><span class="hljs-string">"action_yes_no"</span></span>) cl_d.write_sub_for_module_action filemod, <span class="hljs-string"><span class="hljs-string">"action_yes_no"</span></span> kart_view <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span></code> </pre><br><br>  What we do, firstly, we need to remove the module in order to load and use it, whether the code is changed.  Next we open the file, create a module and write the code from the file into it. <br>  After these manipulations, we need to call the procedure that performs the manipulations, which are implied by clicking on the button to perform the procedure. <br>  It is interesting here) <br>  If we specify the name of the procedure that is directly in the code above, we have the action11 procedure that curses the fact that it cannot find the ‚Äúkart_view‚Äù procedure, and this is correct, because in fact there is no procedure at the moment when the procedure button is pressed, a function is created, which in turn calls this procedure, the code is: <br><pre> <code class="hljs vbscript"><span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span> action11() <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> cl_d = <span class="hljs-keyword"><span class="hljs-keyword">New</span></span> Edit_module <span class="hljs-keyword"><span class="hljs-keyword">On</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Error</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Resume</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> cl_d.delete_modul_full (<span class="hljs-string"><span class="hljs-string">"action_yes_no"</span></span>) filemod = OpenFileModule(<span class="hljs-string"><span class="hljs-string">"action_yes_no"</span></span>) cl_d.create_module (<span class="hljs-string"><span class="hljs-string">"action_yes_no"</span></span>) cl_d.write_sub_for_module_action filemod, <span class="hljs-string"><span class="hljs-string">"action_yes_no"</span></span> action11a <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> action11a() kart_view <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span></code> </pre><br><br>  That is, at the time of calling "kart_view" from "action11a", this procedure will already be loaded into the module, vba does not see the catch. <br>  The resulting result: click on the button, the code is loaded into the module, executed.  In case of repeated execution, the module is deleted, reloaded, executed.  When you close the file, the book is cleared of everything, so as not to take up space and lie quietly until the next discovery. <br>  Just a couple of words on processing large files, I think it will be interesting.  As mentioned, files are used in large volumes, more than 300 thousand lines, from which it is necessary to select, as a rule, 10-30 thousand and work with them. <br>  If I had been asked how to make a sample from half a year ago, I would have been unaware of the conditional cycle.  Later, many methods were tried, I will describe each of them for info, except for those that can be implemented using standard excel functions. <br>  Initial data: there is a table of 300 thousand lines, we know 10 thousand values ‚Äã‚Äãthat we need. <br>  1) At first I tried to loop through the sample. <br><pre> <code class="hljs pgsql">tab1 =   tab2 =   col_tab1 = tab1.Cells(<span class="hljs-keyword"><span class="hljs-keyword">Rows</span></span>.Count, <span class="hljs-number"><span class="hljs-number">1</span></span>).<span class="hljs-keyword"><span class="hljs-keyword">End</span></span>(xlUp).<span class="hljs-keyword"><span class="hljs-keyword">Row</span></span> <span class="hljs-string"><span class="hljs-string">'    (10 ) col_tab2 = tab2.Cells(Rows.Count, 1).End(xlUp).Row '</span></span>    (<span class="hljs-number"><span class="hljs-number">300</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> col_tab1 <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ii = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> col_tab2 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> tab1.cells(ii,<span class="hljs-number"><span class="hljs-number">1</span></span>) = tab2.cells(i,<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>  <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> next ii next i</code> </pre><br><br>  What we get, if we do not complete the cycle, it turns out that we need to sort out 300,000 lines 10,000 times to find the result.  Working out vba will be about 500 lines per second, total <br>  3000000000/500 = 6000000 seconds, (100000 minutes or 1666.66 hours or 69 days or 9 weeks or ...) <br>  And the result is usually needed here and now, well, or in a couple of minutes a maximum, so there is no right away. <br>  2) The second method I use is working with mysql server <br>  To work with mysql server, which already was, for another project, the mysql ODBC driver was needed, I knew them 2, version 3.51, and version 5.1. The choice fell on 3.51, because the second one, due to discussions of its work on the forums, was not very worked well with encodings, and I wanted a base in utf8 <br>  The driver was put to me, and the first bump on which I stumbled is access rights <br><br>  That is, you need an account to connect from the outside, in our case it will be a vba-macro which used to swear like this: <br><img src="https://lh4.googleusercontent.com/h0bVMi2pRwUtJPh9_cZrZNmx1h773tPpyIGfhZZfehA=w386-h192-p-no" alt="image"><br>  Having smoked sql manuals, found it <br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">USER</span></span> <span class="hljs-string"><span class="hljs-string">'%'</span></span>@<span class="hljs-string"><span class="hljs-string">'user'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTIFIED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PASSWORD</span></span> <span class="hljs-string"><span class="hljs-string">'mtspass'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">GRANT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> *.* <span class="hljs-keyword"><span class="hljs-keyword">TO</span></span> <span class="hljs-string"><span class="hljs-string">'%'</span></span>@<span class="hljs-string"><span class="hljs-string">'user'</span></span>;</code> </pre><br><br>  That is, on request above, an account is created for any user with root rights. <br>  Naturally, no one gave me the root of the rights and the project using the mysql server for storing data was ‚Äúfrozen‚Äù because in the future it was necessary to write to the database, I had only reading. <br>  For performance evaluation: the same macro using iterations using cycles worked for 59 seconds, with sql we managed to do the same for 3.5-4 seconds, that is, we really managed to accelerate more than 10 times. <br>  By code, a good article is here: <a href="http://egregors.blogspot.ru/2013/05/mysql-vba-excel-mysql.html">egregors.blogspot.ru/2013/05/mysql-vba-excel-mysql.html</a> <br>  3) Continuing to smoke the sql theme, began work on working with access. <br>  The code turns out to be hellish, but working. <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> cN = <span class="hljs-built_in"><span class="hljs-built_in">New</span></span> ADODB.<span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span> <span class="hljs-string"><span class="hljs-string">'  cN.Open "Provider=Microsoft.Jet.OLEDB.4.0; Data Source=-//  //-\base\base" &amp; Environ("USERNAME") &amp; ".mdb; Jet OLEDB:Database;" '</span></span>     <span class="hljs-string"><span class="hljs-string">'      for i = 1 to col_tab1 nabor_act = nabor_act &amp; ‚Äú'</span></span>,<span class="hljs-string"><span class="hljs-string">'‚Äù &amp; tab1.cells(i,1) next i Set RS = New ADODB.Recordset '</span></span>       RS.<span class="hljs-keyword"><span class="hljs-keyword">Open</span></span> "SELECT * FROM kartoteka WHERE nom_act LIKE '‚Äù &amp; right(nabor_act, len(nabor_act)-3) &amp; ‚Äù' ;", cN, adOpenStatic, adLockOptimistic o = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">While</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> RS.EOF ter.Cells(o, <span class="hljs-number"><span class="hljs-number">1</span></span>) = "" &amp; Right$(RS.Fields(<span class="hljs-number"><span class="hljs-number">1</span></span>).<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>) ter.Cells(o, <span class="hljs-number"><span class="hljs-number">2</span></span>) = RS.Fields(<span class="hljs-number"><span class="hljs-number">2</span></span>).<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span> ter.Cells(o, <span class="hljs-number"><span class="hljs-number">3</span></span>) = "" ter.Cells(o, <span class="hljs-number"><span class="hljs-number">4</span></span>) = RS.Fields(<span class="hljs-number"><span class="hljs-number">6</span></span>).<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span> ter.Cells(o, <span class="hljs-number"><span class="hljs-number">5</span></span>) = "" o = o + <span class="hljs-number"><span class="hljs-number">1</span></span> RS.MoveNext <span class="hljs-keyword"><span class="hljs-keyword">Loop</span></span> cN.<span class="hljs-keyword"><span class="hljs-keyword">Close</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> cN = <span class="hljs-keyword"><span class="hljs-keyword">Nothing</span></span></code> </pre><br><br>  This method works slower than mysql, for some reason, but it is quite acceptable for use.  But not me ... <br>  I refused it the very first time when I needed a system in which the user creates a database in a certain folder and writes there 2 tables of 300 thousand lines each, for comparing and calculating them.  With the tests, I got a base of about 600 meters in size, given that in the future 50 people can use this macro at the same time, it turns out a folder of about 25-30 gigs in size, for which admins would quarter me right away. <br>  4) Actually the way I stopped.  Yes, it works slower than the second and third methods, but these disadvantages are compensated by the functionality.  Sql book request <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> cn = <span class="hljs-built_in"><span class="hljs-built_in">New</span></span> ADODB.<span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span> <span class="hljs-string"><span class="hljs-string">'    cn.ConnectionString = "Provider=Microsoft.ACE.OLEDB.12.0;Data Source=" &amp; ActiveWorkbook.path &amp; "\" &amp; ActiveWorkbook.Name &amp; ";Extended Properties=Excel 12.0;" '</span></span>    cn.ConnectionTimeout = <span class="hljs-number"><span class="hljs-number">40</span></span> cn.<span class="hljs-keyword"><span class="hljs-keyword">Open</span></span> <span class="hljs-string"><span class="hljs-string">'      for i = 1 to col_tab1 nabor_act = nabor_act &amp; ‚Äú'</span></span>,<span class="hljs-string"><span class="hljs-string">'‚Äù &amp; tab1.cells(i,1) next i sql = "SELECT * FROM [res$] WHERE [ ] '</span></span>‚Äù &amp; right(nabor_act, len(nabor_act)<span class="hljs-number"><span class="hljs-number">-3</span></span>) &amp; ‚Äù<span class="hljs-string"><span class="hljs-string">' " Dim rs As New ADODB.Recordset Set rs = New ADODB.Recordset '</span></span>    rs.ActiveConnection = cn <span class="hljs-string"><span class="hljs-string">'     rs.LockType = adLockOptimistic '</span></span>              .          <span class="hljs-keyword"><span class="hljs-keyword">Update</span></span>().            . rs.CursorLocation = adUseClient <span class="hljs-string"><span class="hljs-string">'     rs.source = sql '</span></span>  rs.<span class="hljs-keyword"><span class="hljs-keyword">Open</span></span> rs.MoveFirst <span class="hljs-string"><span class="hljs-string">'     rew = "" Do Until rs.EOF '</span></span>   rew = rew &amp; "','" &amp; rs.Fields(<span class="hljs-number"><span class="hljs-number">0</span></span>).<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span> rs.MoveNext <span class="hljs-string"><span class="hljs-string">'     Loop rs.Close cn.Close</span></span></code> </pre><br><br>  Here ... If we take the conditions of the example, a line for the query will gather somewhere for 10 seconds, a query with a sample will hang up for 25 seconds, and a 10 seconds test will depend on the desired result. <br>  Something like this. </div><p>Source: <a href="https://habr.com/ru/post/217791/">https://habr.com/ru/post/217791/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../217771/index.html">How to minimize setting for content site</a></li>
<li><a href="../217775/index.html">Cosmos Facts Hard to Believe</a></li>
<li><a href="../217779/index.html">Emulation of pressing multimedia keys in Windows, Linux and Mac OS X</a></li>
<li><a href="../217783/index.html">How we learned to read the thoughts of system administrators</a></li>
<li><a href="../217789/index.html">Voice control media center</a></li>
<li><a href="../217797/index.html">Half-life 3 will be released in the fall of 2014</a></li>
<li><a href="../217799/index.html">How to reduce the cost of a virtual data center with a USB flash drive</a></li>
<li><a href="../217801/index.html">YAWNDB - time series database</a></li>
<li><a href="../217803/index.html">People do not need a drill, but a picture on the wall</a></li>
<li><a href="../217807/index.html">Microsoft is ending support for Windows XP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>