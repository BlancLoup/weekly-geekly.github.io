<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Redux Tutorial</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today, Redux is one of the most interesting phenomena in the world of JavaScript. It stands out from hundreds of libraries and frameworks in that it c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Redux Tutorial</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/64b/d36/ae7/64bd36ae7bfe47d1a2ed255031ba6762.png" align="left">  Today, <a href="http://rackt.github.io/redux/">Redux</a> is one of the most interesting phenomena in the world of JavaScript.  It stands out from hundreds of libraries and frameworks in that it competently solves many different issues by introducing a simple and predictable state model, a bias for functional programming and immutable data, providing a compact API.  What else is needed for happiness?  Redux is a very small library, and learning its API is not difficult.  But for many people, there is a kind of pattern rupture - a small number of components and voluntary restrictions on pure functions and immutable data may seem unwarranted coercion.  How exactly do we work in such conditions? <br><br>  In this tutorial, we will look at building a full-stack application from scratch using Redux and <a href="http://facebook.github.io/immutable-js/">Immutable-js</a> .  Applying the <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B0%25D0%25B7%25D1%2580%25D0%25B0%25D0%25B1%25D0%25BE%25D1%2582%25D0%25BA%25D0%25B0_%25D1%2587%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B7_%25D1%2582%25D0%25B5%25D1%2581%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">TDD</a> approach, we will go through all the stages of constructing a Node + Redux backend and React + Redux frontend applications.  In addition, we will use tools such as ES6, <a href="http://babeljs.io/">Babel</a> , <a href="http://socket.io/">Socket.io</a> , <a href="http://webpack.github.io/">Webpack</a> and <a href="https://mochajs.org/">Mocha</a> .  The set is very curious, and you instantly master it! <br><a name="habracut"></a><br><h1>  The content of the article </h1><br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">1. What you need</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">2. Application</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">3. Architecture</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">4. Server application</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">4.1.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">Development of an application state tree</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">4.2.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">Project Setup</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">4.3.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">Introduction to immutable data</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">4.4.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">Implementing application logic with pure functions</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">4.4.1.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">Loading records</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">4.4.2.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">Launch vote</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">4.4.3.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">Voting</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">4.4.4.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">Go to the next pair</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">4.4.5.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">Completion of the vote</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">4.5.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">Using Actions and Reducers</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">4.6.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">Flavor Reducer Composition</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">4.7.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">Using the Redux Store</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">4.8.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">Configuring Socket.io Server</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">4.9.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">Status Translation from Redux Listener</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">4.10.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">Getting Redux Remote Actions</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">5. Client application</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">5.1.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">Customize client project</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">5.1.1.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">Unit testing support</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">5.2.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">React and react-hot-loader</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">5.3.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">Creating an interface for the voting screen</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">5.4.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">Immutable data and pure rendering</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">5.5.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">Creating an interface for the results screen and processing routing</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">5.6.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">Using Client Redux-Store</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">5.7.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">Transferring input from Redux to React</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">5.8.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">Configuring the Socket.io client</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">5.9.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">Getting actions from the server</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">5.10.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">Transfer actions from React components</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">5.11.</a>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">Sending actions to the server using Redux Middleware</a> <br>  <a href="https://habrahabr.ru/company/mailru/blog/303456/">6. Exercises</a> <br><br><a name="1"></a><h1>  1. What you need </h1><br>  This guide will be most useful for developers who already know how to write JavaScript applications.  As already mentioned, we will use Node, ES6, <a href="http://facebook.github.io/react/">React</a> , <a href="http://webpack.github.io/">Webpack</a> and <a href="http://babeljs.io/">Babel</a> , and if you are at least a little familiar with these tools, there will be no problems with promotion.  Even if you are not familiar, you can understand the basics along the way. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As a good tutorial on developing web applications using React, Webpack and ES6, you can advise <a href="http://survivejs.com/">SurviveJS</a> .  As for the tools, you will need a <a href="https://nodejs.org/en/">Node with NPM</a> and your favorite text editor. <br><br><a name="2"></a><h1>  2. Application </h1><br>  We will make an application for "live" voting at parties, conferences, meetings and other meetings.  The idea is that the user will be offered a collection of voting positions: movies, songs, programming languages, <a href="https://mobile.twitter.com/horse_js">quotes from Horse JS</a> , and so on.  The app will have items in pairs so that everyone can vote for their favorite.  As a result of a series of polls, one element will remain - the winner.  Example of voting for the best movie <a href="https://ru.wikipedia.org/wiki/%25D0%2591%25D0%25BE%25D0%25B9%25D0%25BB,_%25D0%2594%25D1%258D%25D0%25BD%25D0%25BD%25D0%25B8">Danny Boyle</a> : <br><br><img src="https://habrastorage.org/files/4ae/cd9/011/4aecd90110e0466b9348e6b22e09ab9a.png"><br><br>  The application will have two different user interfaces: <br><br><ul><li>  The interface for voting can be used on any device where the web browser is launched. </li><li>  The interface of the voting results can be displayed on the projector or some big screen.  Voting results will be updated in real time. </li></ul><br><img src="https://habrastorage.org/files/bc7/c2a/22e/bc7c2a22e8384379ba8fab0e4a14c219.png"><br><br><a name="3"></a><h1>  3. Architecture </h1><br>  Structurally, the system will consist of two applications: <br><br><ul><li>  A browser-based React application that provides both user interfaces. </li><li>  Server application on Node containing the voting logic. </li></ul><br>  Interaction between applications will be carried out using WebSockets.  <a href="http://rackt.github.io/redux/">Redux</a> will help us to organize the code of the client and server parts.  And for storing states we will use the <a href="https://facebook.github.io/immutable-js/">Immutable</a> structure. <br><br>  Despite the great similarity between the client and the server ‚Äî for example, both will use Redux ‚Äî this is not a <a href="https://medium.com/%40mjackson/universal-javascript-4761051b7ae9">universal / isomorphic application</a> , and applications will not share any code.  Rather, it can be described as a distributed system of two applications that interact with each other through message passing. <br><br><a name="4"></a><h1>  4. Server application </h1><br>  First we write a Node application, and then React.  This will allow us not to be distracted from the implementation of the basic logic of the application, before we get to the interface.  Since we are creating a server application, we will get acquainted with Redux and Immutable and find out how the application built on them will be arranged.  Redux is usually associated with React projects, but its use is not limited to them.  In particular, we will find out how Redux can be useful in other contexts! <br><br>  In the course of reading this guide, I recommend that you write an application from scratch, but you can download the source code from <a href="https://github.com/teropa/redux-voting-server">GitHub</a> . <br><br><a name="4-1"></a><h2>  4.1.  Development of an application state tree </h2><br>  Creating an application using Redux often begins with a thinking through the <i>application state</i> data structure.  It describes what happens in the application at any time.  State (state) is in any framework and architecture.  In Ember and Backbone applications, the state is stored in Models.  In Angular-based applications, the state is most often stored in Factories and Services.  In most Flux applications, the state is a repository (Stores).  And how is this done in Redux? <br><br>  Its main difference is that all application states are stored in a single tree structure.  Thus, everything that needs to be known about the state of the application is contained in one data structure from associative (map) and regular arrays.  As you will soon see, this decision has quite a few consequences.  One of the most important is that you can separate the state of the application from its <i>behavior</i> .  State is pure data.  It does not contain any methods or functions, and it is not hidden inside other objects.  <i>Everything is in one place.</i>  This may seem to be a limitation, especially if you have experience with object-oriented programming.  But in reality this is a manifestation of greater freedom, since you can concentrate on data alone.  Very much logically flows from the design of the state of the application if you devote enough time to it. <br><br>  I do not want to say that you always need to first fully develop the state tree, and then create the other components of the application.  This is usually done in parallel.  But it seems to me that it is more useful to first outline in general how a tree should look in different situations before starting to write code.  Let's imagine what a state tree can be for our voting application.  The purpose of the application is to be able to vote within pairs of objects (movies, musical groups).  As an initial state of the application, it is advisable to make a simple collection of positions that will participate in the voting.  Let's call this collection of <i>entries</i> : <br><br><img src="https://habrastorage.org/files/acf/6b2/e6e/acf6b2e6efa540308fcb52911e4539be.png"><br><br>  After the start of voting, it is necessary to somehow separate the positions that are participating in the voting at the moment.  The state may be a <i>voice</i> entity containing a pair of positions from which the user must select one.  Naturally, this pair should be extracted from the <i>entries</i> collection: <br><br><img src="https://habrastorage.org/files/4a1/589/851/4a1589851933420a849497e850d79859.png"><br><br>  We also need to keep records of voting results.  This can be done using another structure inside the <i>vote</i> : <br><br><img src="https://habrastorage.org/files/98a/459/615/98a45961583340e29ef4a801dbb7a5b3.png"><br><br>  At the end of the current voting, the losing entry is discarded, and the winning one is returned back to the <i>entries</i> and placed at the end of the list.  Later, she will again vote.  Then the following pair is taken from the list: <br><br><img src="https://habrastorage.org/files/3f7/7cf/513/3f77cf513c9b4ce0a701c38e8a2cee5b.png"><br><br>  These states cycle through each other as long as there are entries in the collection.  At the end there will be only one record, which is declared the winner, and the voting ends: <br><br><img src="https://habrastorage.org/files/428/a5c/b86/428a5cb86c8a47de9602e201d01a4c0e.png"><br><br>  The scheme seems quite reasonable, we will begin to implement it.  There are many different ways of developing states for these requirements. Perhaps this option is not optimal.  But this is not particularly important.  The initial scheme should be just good to start.  The main thing is that we have an understanding of how our application should work.  And this is before we move on to writing code! <br><br><a name="4-2"></a><h2>  4.2.  Project Setup </h2><br>  It's time to roll up your sleeves.  First you need to create a project folder, and then initialize it as an NPM project: <br><br><pre><code class="bash hljs">mkdir voting-server <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> voting-server npm init -y</code> </pre> <br>  In the created folder there is a single <code>package.json</code> file for now.  We will write the code in the specification of ES6.  Although Node since version 4.0.0 supports many features of ES6, the modules we need are still left behind.  Therefore, we need to add Babel to our project so that we can use all the power of ES6 and translate the code into ES5: <br><br><pre> <code class="bash hljs">npm install --save-dev babel-core babel-cli babel-preset-es2015</code> </pre><br>  We also need libraries for writing unit tests: <br><br><pre> <code class="bash hljs">npm install --save-dev mocha chai</code> </pre><br>  We'll use <a href="https://mochajs.org/">Mocha</a> as a testing framework.  Inside the tests, we will use <a href="http://chaijs.com/">Chai</a> as a library to check the expected behavior and states.  We will run the tests using the <code>mocha</code> : <br><br><pre> <code class="bash hljs">./node_modules/mocha/bin/mocha --compilers js:babel-core/register --recursive</code> </pre><br>  After that, Mocha will recursively search all the tests of the project and run them.  Babel will be used to transport the ES6 code before launching it.  For convenience, you can store this command in <code>package.json</code> : <br><br><pre> <code class="javascript hljs">package.json <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: { <span class="hljs-string"><span class="hljs-string">"test"</span></span>: <span class="hljs-string"><span class="hljs-string">"mocha --compilers js:babel-core/register --recursive"</span></span> },</code> </pre><br>  Now we need to include support for ES6 / ES2015 in Babel.  To do this, we activate the <code>babel-preset-es2015</code> package that we have already installed.  Then just add the <code>"babel"</code> section to the <code>package.json</code> : <br><br><pre> <code class="javascript hljs">package.json <span class="hljs-string"><span class="hljs-string">"babel"</span></span>: { <span class="hljs-string"><span class="hljs-string">"presets"</span></span>: [<span class="hljs-string"><span class="hljs-string">"es2015"</span></span>] }</code> </pre><br>  Now, using the <code>npm</code> command, we can run our tests: <br><br><pre> <code class="bash hljs">npm run <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre><br>  The <code>test:watch</code> can be used to start a process that tracks changes in our code and runs tests after each change: <br><br><pre> <code class="javascript hljs">package.json <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: { <span class="hljs-string"><span class="hljs-string">"test"</span></span>: <span class="hljs-string"><span class="hljs-string">"mocha --compilers js:babel-core/register --recursive"</span></span>, <span class="hljs-string"><span class="hljs-string">"test:watch"</span></span>: <span class="hljs-string"><span class="hljs-string">"npm run test -- --watch"</span></span> },</code> </pre><br>  The <a href="http://facebook.github.io/immutable-js/">Immutable</a> library developed by Facebook provides us with a number of useful data structures.  We will discuss it in the next chapter, but for now just add to the project along with the <a href="https://github.com/astorije/chai-immutable">chai-immutable</a> library, which adds support for comparing Immutable-structures to Chai: <br><br><pre> <code class="bash hljs">npm install --save immutable npm install --save-dev chai-immutable</code> </pre><br>  It is necessary to connect chai-immutable before running any tests.  This can be done using the <code>test_helper</code> file: <br><br><pre> <code class="javascript hljs">test/test_helper.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chai <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'chai'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chaiImmutable <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'chai-immutable'</span></span>; chai.use(chaiImmutable);</code> </pre><br>  Now we will make Mocha load this file before running the tests: <br><br><pre> <code class="javascript hljs">package.json <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: { <span class="hljs-string"><span class="hljs-string">"test"</span></span>: <span class="hljs-string"><span class="hljs-string">"mocha --compilers js:babel-core/register --require ./test/test_helper.js --recursive"</span></span>, <span class="hljs-string"><span class="hljs-string">"test:watch"</span></span>: <span class="hljs-string"><span class="hljs-string">"npm run test -- --watch"</span></span> },</code> </pre><br>  Now we have everything to start. <br><br><a name="4-3"></a><h2>  4.3.  Introduction to immutable data </h2><br>  The second important point related to the Redux architecture: a state is not just a tree, but an <i>immutable tree</i> .  The tree structure from the previous chapter may suggest that the code should change the state of the application simply by updating the trees: replacing elements in associative arrays, removing them from arrays, etc.  But in Redux everything is done differently.  The state tree in a Redux application is an <i>immutable data structure</i> .  This means that as long as the tree exists, it does not change.  It always keeps the same state.  And the transition to another state is done by creating <i>another</i> tree, in which the necessary changes have been made.  That is, two successive application states are stored in two separate and independent trees.  And switching between trees is done by calling a <i>function</i> that accepts the current state and <i>returns the</i> following. <br><br><img src="https://habrastorage.org/files/8ed/18f/93d/8ed18f93d4f84081b22542a91a019861.png"><br><br>  Is this a good idea?  Usually they immediately indicate that if all the states are stored in one tree and you make all these safe updates, then you can save the history of the application states with little effort.  This allows you to implement undo / redo ‚Äúfor free‚Äù - you can simply set the previous or next state (tree) from the history.  You can also serialize the story and save it for the future, or put it in storage for later playback, which can be invaluable help in debugging. <br><br>  But it seems to me that, in addition to all these additional features, the main advantage of using immutable data is to simplify the code.  You have to program <a href="https://en.wikipedia.org/wiki/Pure_function">pure functions</a> : they only accept and return data, and nothing more.  These functions behave predictably.  You can call them as many times as you want, and they will always behave the same way.  Give them the same arguments, and you will get the same results.  Testing becomes trivial, because you do not need to configure stubs or other fakes to ‚Äúprepare the universe‚Äù for the function call.  There are just input and output data. <br><br>  Since we will describe the state of our application with immutable structures, let's spend a little time getting to know them by writing a few unit tests that illustrate the work. <br><br>  If you confidently work with immutable data and the <a href="http://facebook.github.io/immutable-js/">Immutable</a> library, you can proceed to the next section. <br><br>  To get acquainted with the idea of ‚Äã‚Äãimmutability, you can start by talking about the simplest data structure.  Suppose you have a counter application whose state is a number.  Let's say it changes from 0 to 1, then to 2, then to 3, etc.  In principle, we already think of numbers as immutable data.  When the counter increases, the number does not <i>change</i> .  Yes, it is impossible, because the numbers do not have "setters".  You cannot say <code>42.setValue(43)</code> . <br><br>  So we just get <i>another</i> number, adding one to the previous one.  This can be done using the clean function.  Its argument will be the current state, and the return value will be used as the next state.  The called function does not change the current state.  Here is her example, as well as the unit test for her: <br><br><pre> <code class="javascript hljs">test/immutable_spec.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {expect} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'chai'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'immutability'</span></span>, () =&gt; { describe(<span class="hljs-string"><span class="hljs-string">'a number'</span></span>, () =&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">increment</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">currentState</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> currentState + <span class="hljs-number"><span class="hljs-number">1</span></span>; } it(<span class="hljs-string"><span class="hljs-string">'is immutable'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> state = <span class="hljs-number"><span class="hljs-number">42</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> nextState = increment(state); expect(nextState).to.equal(<span class="hljs-number"><span class="hljs-number">43</span></span>); expect(state).to.equal(<span class="hljs-number"><span class="hljs-number">42</span></span>); }); }); });</code> </pre><br>  Obviously, <code>state</code> does not change when you call <code>increment</code> , because the numbers are immutable! <br><br>  As you can see, this test does nothing with our application, we haven‚Äôt written it yet. <br><br>  Tests can be just a learning tool for us.  I often find it useful to learn new APIs or techniques by writing unit tests that run some ideas.  In the book <a href="http://www.amazon.com/Test-Driven-Development-By-Example/dp/0321146530">Test-Driven Development,</a> such tests are called "training tests." <br><br>  Now we will extend the idea of ‚Äã‚Äãimmutability to all types of data structures, and not just numbers. <br><br>  With the help of Immutable <a href="https://facebook.github.io/immutable-js/docs/">lists,</a> we can, for example, make an application whose state is the list of films.  The operation of adding a new movie will create a <i>new list, which is a combination of the old list and the position being added</i> .  It is important to note that after this operation the old state <i>remains unchanged</i> : <br><br><pre> <code class="javascript hljs">test/immutable_spec.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {expect} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'chai'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {List} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'immutability'</span></span>, () =&gt; { <span class="hljs-comment"><span class="hljs-comment">// ... describe('A List', () =&gt; { function addMovie(currentState, movie) { return currentState.push(movie); } it('is immutable', () =&gt; { let state = List.of('Trainspotting', '28 Days Later'); let nextState = addMovie(state, 'Sunshine'); expect(nextState).to.equal(List.of( 'Trainspotting', '28 Days Later', 'Sunshine' )); expect(state).to.equal(List.of( 'Trainspotting', '28 Days Later' )); }); }); });</span></span></code> </pre><br>  And if we inserted the film into a regular array, the old state would change.  But instead, we use lists from Immutable, so we use the same semantics as in the previous example with numbers. <br><br>  When inserted into a regular array, the old state would change.  But since we use Immutable lists, we have the same semantics as in the example with numbers. <br><br>  This idea is also well applicable to full state trees.  The tree is a nested structure of lists (lists), associative arrays ( <a href="https://facebook.github.io/immutable-js/docs/">maps</a> ) and other types of collections.  The operation applied to it creates a <i>new state tree</i> , leaving the previous one intact.  If the tree is an associative array with the key <code>movies</code> containing the list of movies, then adding a new position implies the need to create a new array in which the key <code>movies</code> indicates a new list: <br><br><pre> <code class="javascript hljs">test/immutable_spec.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {expect} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'chai'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {List, <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'immutability'</span></span>, () =&gt; { <span class="hljs-comment"><span class="hljs-comment">// ... describe('a tree', () =&gt; { function addMovie(currentState, movie) { return currentState.set( 'movies', currentState.get('movies').push(movie) ); } it('is immutable', () =&gt; { let state = Map({ movies: List.of('Trainspotting', '28 Days Later') }); let nextState = addMovie(state, 'Sunshine'); expect(nextState).to.equal(Map({ movies: List.of( 'Trainspotting', '28 Days Later', 'Sunshine' ) })); expect(state).to.equal(Map({ movies: List.of( 'Trainspotting', '28 Days Later' ) })); }); }); });</span></span></code> </pre><br><br>  Here we see exactly the same behavior as before, extended to demonstrate the work with nested structures.  The idea of ‚Äã‚Äãimmutability applies to data of all shapes and sizes. <br><br>  For operations on such nested structures in Immutable, there are several auxiliary functions that make it easier to ‚Äúclimb‚Äù into nested data in order to get the updated value.  For brevity, we can use the <a href="https://facebook.github.io/immutable-js/docs/">update</a> function: <br><br><pre> <code class="javascript hljs">test/immutable_spec.js <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addMovie</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">currentState, movie</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> currentState.update(<span class="hljs-string"><span class="hljs-string">'movies'</span></span>, movies =&gt; movies.push(movie)); }</code> </pre><br>  We will use a similar function in our application to update the status of the application.  The <a href="https://facebook.github.io/immutable-js/docs/">Immutable API</a> hides many other features, and we only looked at the tip of the iceberg. <br><br>  Immutable data is a key aspect of the Redux architecture, but there is no strict requirement to use the Immutable library.  The <a href="http://rackt.github.io/redux/">official Redux documentation</a> for the most part refers to simple objects and arrays of JavaScript, and refrain from modifying them <i>by agreement</i> . <br><br>  There are several reasons why the Immutable library will be used in our manual: <br><br><ul><li>  The data structures in Immutable are designed from scratch to be immutable and provide an API that allows you to conveniently perform operations on them. </li><li>  I share the point of view of Rich Hayki, according to which <a href="http://codequarterly.com/2011/rich-hickey/">there is no such thing as immutability by agreement</a> .  If you use data structures that can be changed, then sooner or later someone will make a mistake and do it.  Especially if you are new.  Things like <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze">Object.freeze ()</a> will help you not to be mistaken. </li><li>  Immutable data structures are <a href="https://en.wikipedia.org/wiki/Persistent_data_structure">persistent</a> , that is, their internal structure is such that creating a new version is an efficient operation in terms of time and memory consumption, especially in the case of large state trees.  The use of ordinary objects and arrays can lead to redundant copying, reducing performance. </li></ul><br><a name="4-4"></a><h2>  4.4.  Implementing application logic with pure functions </h2><br>  Acquainted with the idea of ‚Äã‚Äãimmutable state trees and functions that operate on these trees, you can proceed to creating the logic of our application.  It will be based on the above components: a tree structure and a set of functions that create new versions of this tree. <br><br><a name="4-4-1"></a><h3>  4.4.1.  Loading records </h3><br>  First of all, the application must "download" a collection of records for voting.  You can make the function <code>setEntries</code> , which takes the previous state and collection, and creates a new state by including records there.  Here is a test for this function: <br><br><pre> <code class="javascript hljs">test/core_spec.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {List, <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {expect} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'chai'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {setEntries} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../src/core'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'application logic'</span></span>, () =&gt; { describe(<span class="hljs-string"><span class="hljs-string">'setEntries'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'   '</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> state = <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> entries = List.of(<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> nextState = setEntries(state, entries); expect(nextState).to.equal(<span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>({ <span class="hljs-attr"><span class="hljs-attr">entries</span></span>: List.of(<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>) })); }); }); });</code> </pre><br>  The initial implementation of <code>setEntries</code> does only the simplest thing: the <code>entries</code> key in the associative state array assigns the specified list of entries as the value.  We receive the first of the trees designed by us earlier. <br><br><pre> <code class="javascript hljs">src/core.js <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setEntries</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, entries</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state.set(<span class="hljs-string"><span class="hljs-string">'entries'</span></span>, entries); }</code> </pre><br>  For convenience, let the input records be a regular JavaScript array (or something to be <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Iteration_protocols">iterated</a> ).  In the status tree, however, there should be an Immutable list ( <code>List</code> ): <br><br><pre> <code class="javascript hljs">test/core_spec.js it(<span class="hljs-string"><span class="hljs-string">'  immutable'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> state = <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> entries = [<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> nextState = setEntries(state, entries); expect(nextState).to.equal(<span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>({ <span class="hljs-attr"><span class="hljs-attr">entries</span></span>: List.of(<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>) })); });</code> </pre><br>  To meet this requirement, we will transfer the entries to the list constructor: <br><br><pre> <code class="javascript hljs">src/core.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {List} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setEntries</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, entries</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state.set(<span class="hljs-string"><span class="hljs-string">'entries'</span></span>, List(entries)); }</code> </pre><br><a name="4-4-2"></a><h3>  4.4.2.  Launch vote </h3><br>  Voting can be started by calling the <code>next</code> function in a state that already has a set of entries.  Thus, the transition from the first to the second of the projected trees will be made. <br><br>  This function does not need additional arguments.  It should create an associative array of <code>vote</code> , in which the first two records are stored by the <code>pair</code> key.  In this case, the entries that are currently participating in the voting should no longer be in the list of <code>entries</code> : <br><br><pre> <code class="javascript hljs">test/core_spec.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {List, <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {expect} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'chai'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {setEntries, next} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../src/core'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">' '</span></span>, () =&gt; { <span class="hljs-comment"><span class="hljs-comment">// .. describe('', () =&gt; { it('     ', () =&gt; { const state = Map({ entries: List.of('Trainspotting', '28 Days Later', 'Sunshine') }); const nextState = next(state); expect(nextState).to.equal(Map({ vote: Map({ pair: List.of('Trainspotting', '28 Days Later') }), entries: List.of('Sunshine') })); }); }); });</span></span></code> </pre><br>  The function implementation will <a href="https://facebook.github.io/immutable-js/docs/">merge the</a> update with the old state, separating the first entries into a separate list, and the rest into a new version of the list of <code>entries</code> : <br><br><pre> <code class="javascript hljs">src/core.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {List, <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// ... export function next(state) { const entries = state.get('entries'); return state.merge({ vote: Map({pair: entries.take(2)}), entries: entries.skip(2) }); }</span></span></code> </pre><br><a name="4-4-3"></a><h3>  4.4.3.  Voting </h3><br>  As the voting proceeds, the user should be able to vote for different entries.  And with each new vote on the screen should display the current result.  If you have already voted for a specific entry, then its counter should increase. <br><br><pre> <code class="javascript hljs">test/core_spec.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {List, <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {expect} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'chai'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {setEntries, next, vote} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../src/core'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">' '</span></span>, () =&gt; { <span class="hljs-comment"><span class="hljs-comment">// ... describe('vote', () =&gt; { it('     ', () =&gt; { const state = Map({ vote: Map({ pair: List.of('Trainspotting', '28 Days Later') }), entries: List() }); const nextState = vote(state, 'Trainspotting'); expect(nextState).to.equal(Map({ vote: Map({ pair: List.of('Trainspotting', '28 Days Later'), tally: Map({ 'Trainspotting': 1 }) }), entries: List() })); }); it('       ', () =&gt; { const state = Map({ vote: Map({ pair: List.of('Trainspotting', '28 Days Later'), tally: Map({ 'Trainspotting': 3, '28 Days Later': 2 }) }), entries: List() }); const nextState = vote(state, 'Trainspotting'); expect(nextState).to.equal(Map({ vote: Map({ pair: List.of('Trainspotting', '28 Days Later'), tally: Map({ 'Trainspotting': 4, '28 Days Later': 2 }) }), entries: List() })); }); }); });</span></span></code> </pre><br>  Using the <a href="https://facebook.github.io/immutable-js/docs/">fromJS</a> function from Immutable, you can more concisely create all these nested schemes and lists. <br><br>  Run the tests: <br><br><pre> <code class="javascript hljs">src/core.js <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vote</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, entry</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state.updateIn( [<span class="hljs-string"><span class="hljs-string">'vote'</span></span>, <span class="hljs-string"><span class="hljs-string">'tally'</span></span>, entry], <span class="hljs-number"><span class="hljs-number">0</span></span>, tally =&gt; tally + <span class="hljs-number"><span class="hljs-number">1</span></span> ); }</code> </pre><br>  Using <a href="https://facebook.github.io/immutable-js/docs/">updateIn</a> allows you not to spread the idea of ‚Äã‚Äãthe tree.  This code says: ‚Äútake the path of the nested data structure [ <code>'vote'</code> , <code>'tally'</code> , <code>'Trainspotting'</code> ] and apply this function.  If any keys are missing, then create new arrays instead of them ( <code>Map</code> ).  If at the end there is no value, then initialize to zero. "  It is this kind of code that allows you to enjoy working with immutable data structures, so it‚Äôs worth taking the time to practice this. <br><br><a name="4-4-4"></a><h3>  4.4.4.  Go to the next pair </h3><br>  At the end of the vote on the current pair, go to the next.  You need to save the winner and add it to the end of the list of entries so that he will again take part in the voting.  The losing entry is simply discarded.  In case of a tie, both entries are kept. <br><br>  Add this logic to the existing implementation <code>next</code> : <br><br><pre> <code class="javascript hljs">test/core_spec.js describe(<span class="hljs-string"><span class="hljs-string">'next'</span></span>, () =&gt; { <span class="hljs-comment"><span class="hljs-comment">// ... it('       ', () =&gt; { const state = Map({ vote: Map({ pair: List.of('Trainspotting', '28 Days Later'), tally: Map({ 'Trainspotting': 4, '28 Days Later': 2 }) }), entries: List.of('Sunshine', 'Millions', '127 Hours') }); const nextState = next(state); expect(nextState).to.equal(Map({ vote: Map({ pair: List.of('Sunshine', 'Millions') }), entries: List.of('127 Hours', 'Trainspotting') })); }); it('        ', () =&gt; { const state = Map({ vote: Map({ pair: List.of('Trainspotting', '28 Days Later'), tally: Map({ 'Trainspotting': 3, '28 Days Later': 3 }) }), entries: List.of('Sunshine', 'Millions', '127 Hours') }); const nextState = next(state); expect(nextState).to.equal(Map({ vote: Map({ pair: List.of('Sunshine', 'Millions') }), entries: List.of('127 Hours', 'Trainspotting', '28 Days Later') })); }); });</span></span></code> </pre><br>  In our implementation, we simply combine the winners of the current vote with the entries.  You can find these winners using the new <code>getWinners</code> function: <br><br><pre> <code class="javascript hljs">src/core.js <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getWinners</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">vote</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!vote) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> []; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [a, b] = vote.get(<span class="hljs-string"><span class="hljs-string">'pair'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> aVotes = vote.getIn([<span class="hljs-string"><span class="hljs-string">'tally'</span></span>, a], <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> bVotes = vote.getIn([<span class="hljs-string"><span class="hljs-string">'tally'</span></span>, b], <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (aVotes &gt; bVotes) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [a]; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (aVotes &lt; bVotes) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [b]; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [a, b]; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> entries = state.get(<span class="hljs-string"><span class="hljs-string">'entries'</span></span>) .concat(getWinners(state.get(<span class="hljs-string"><span class="hljs-string">'vote'</span></span>))); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state.merge({ <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>({<span class="hljs-attr"><span class="hljs-attr">pair</span></span>: entries.take(<span class="hljs-number"><span class="hljs-number">2</span></span>)}), <span class="hljs-attr"><span class="hljs-attr">entries</span></span>: entries.skip(<span class="hljs-number"><span class="hljs-number">2</span></span>) }); }</code> </pre><br><a name="4-4-5"></a><h3>  4.4.5.  Completion of the vote </h3><br>  At some point, we have only one record - the winner, and then the voting ends.  And instead of forming a new vote, we explicitly designate this record as the winner in the current state.  The end of the vote. <br><br><pre> <code class="javascript hljs">test/core_spec.js describe(<span class="hljs-string"><span class="hljs-string">'next'</span></span>, () =&gt; { <span class="hljs-comment"><span class="hljs-comment">// ... it('    ,    ', () =&gt; { const state = Map({ vote: Map({ pair: List.of('Trainspotting', '28 Days Later'), tally: Map({ 'Trainspotting': 4, '28 Days Later': 2 }) }), entries: List() }); const nextState = next(state); expect(nextState).to.equal(Map({ winner: 'Trainspotting' })); }); });</span></span></code> </pre><br>  In the <code>next</code> implementation, it is necessary to provide for the handling of the situation where, after the next voting is completed, only one position remains in the list of entries: <br><br><pre> <code class="javascript hljs">src/core.js <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> entries = state.get(<span class="hljs-string"><span class="hljs-string">'entries'</span></span>) .concat(getWinners(state.get(<span class="hljs-string"><span class="hljs-string">'vote'</span></span>))); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (entries.size === <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state.remove(<span class="hljs-string"><span class="hljs-string">'vote'</span></span>) .remove(<span class="hljs-string"><span class="hljs-string">'entries'</span></span>) .set(<span class="hljs-string"><span class="hljs-string">'winner'</span></span>, entries.first()); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state.merge({ <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>({<span class="hljs-attr"><span class="hljs-attr">pair</span></span>: entries.take(<span class="hljs-number"><span class="hljs-number">2</span></span>)}), <span class="hljs-attr"><span class="hljs-attr">entries</span></span>: entries.skip(<span class="hljs-number"><span class="hljs-number">2</span></span>) }); } }</code> </pre><br>  Here you could simply return the <code>Map({winner: entries.first()})</code> .  But instead, we again take the old state and explicitly remove the <code>vote</code> and <code>entries</code> keys from it.  This is done with an eye to the future: it may happen that in our state there will be some third-party data that needs to be transmitted in unchanged form using this function.  In general, the basis of state transformation functions is a good idea - always convert the old state into a new one, instead of creating a new state from scratch. <br><br>  Now we have a completely acceptable version of the main logic of our application, expressed in the form of several functions.  We also wrote unit tests for them, which were fairly easy for us: no presets or stubs.  This is the beauty of pure functions.  You can simply call them and check the returned values. <br><br>  Please note that we have not even installed Redux yet.  At the same time, they calmly engaged in the development of application logic, without involving the ‚Äúframework‚Äù in this task.  There is something damn nice about it. <br><br><a name="4-5"></a><h2>  4.5.  Using Actions and Reducers </h2><br>  So, we have basic functions, but we will not call them directly in Redux.  Between the functions and the outside world is a layer of indirect addressing: <code>Actions</code> . <br><br>  These are simple data structures that describe the changes that should occur with the state of your application.  In essence, this is a description of a function call, packed in a small object.  By convention, each action has a <code>type</code> attribute that describes which operation this action is for.      .    ,     : <br><br><pre> <code class="javascript hljs">{<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'SET_ENTRIES'</span></span>, <span class="hljs-attr"><span class="hljs-attr">entries</span></span>: [<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>]} {<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'NEXT'</span></span>} {<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'VOTE'</span></span>, <span class="hljs-attr"><span class="hljs-attr">entry</span></span>: <span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>}</code> </pre><br>              .    <code>VOTE</code>    : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  action let voteAction = {type: 'VOTE', entry: 'Trainspotting'} //   : return vote(state, voteAction.entry);</span></span></code> </pre><br>      (generic function),    ‚Äî     ‚Äî     .    <i></i> ( <code>reducer</code> ): <br><br><pre> <code class="javascript hljs">src/reducer.js <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ,    ,    }</span></span></code> </pre><br>   ,   reducer      : <br><br><pre> <code class="javascript hljs">test/reducer_spec.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {<span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>, fromJS} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {expect} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'chai'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> reducer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../src/reducer'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'reducer'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'handles SET_ENTRIES'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initialState = <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> action = {<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'SET_ENTRIES'</span></span>, <span class="hljs-attr"><span class="hljs-attr">entries</span></span>: [<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>]}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> nextState = reducer(initialState, action); expect(nextState).to.equal(fromJS({ <span class="hljs-attr"><span class="hljs-attr">entries</span></span>: [<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>] })); }); it(<span class="hljs-string"><span class="hljs-string">'handles NEXT'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initialState = fromJS({ <span class="hljs-attr"><span class="hljs-attr">entries</span></span>: [<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>] }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> action = {<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'NEXT'</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> nextState = reducer(initialState, action); expect(nextState).to.equal(fromJS({ <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: { <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: [<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>] }, <span class="hljs-attr"><span class="hljs-attr">entries</span></span>: [] })); }); it(<span class="hljs-string"><span class="hljs-string">'handles VOTE'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initialState = fromJS({ <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: { <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: [<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>] }, <span class="hljs-attr"><span class="hljs-attr">entries</span></span>: [] }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> action = {<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'VOTE'</span></span>, <span class="hljs-attr"><span class="hljs-attr">entry</span></span>: <span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> nextState = reducer(initialState, action); expect(nextState).to.equal(fromJS({ <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: { <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: [<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>], <span class="hljs-attr"><span class="hljs-attr">tally</span></span>: {<span class="hljs-attr"><span class="hljs-attr">Trainspotting</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>} }, <span class="hljs-attr"><span class="hljs-attr">entries</span></span>: [] })); }); });</code> </pre><br>      reducer       .    ,          : <br><br><pre> <code class="javascript hljs">src/reducer.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {setEntries, next, vote} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'SET_ENTRIES'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> setEntries(state, action.entries); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'NEXT'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> next(state); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'VOTE'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vote(state, action.entry) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; }</code> </pre><br>  ,   reducer   ,     . <br><br>  reducer-    :      ,   ,     .        .  ,  <code>undefined</code>  ,       : <br><br><pre> <code class="javascript hljs">test/reducer_spec.js describe(<span class="hljs-string"><span class="hljs-string">'reducer'</span></span>, () =&gt; { <span class="hljs-comment"><span class="hljs-comment">// ... it('has an initial state', () =&gt; { const action = {type: 'SET_ENTRIES', entries: ['Trainspotting']}; const nextState = reducer(undefined, action); expect(nextState).to.equal(fromJS({ entries: ['Trainspotting'] })); }); });</span></span></code> </pre><br><br>       <code>core.js</code> ,       : <br><br><pre> <code class="javascript hljs">src/core.js <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> INITIAL_STATE = <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>();</code> </pre><br>      reducer-          : <br><br><pre> <code class="javascript hljs">src/reducer.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {setEntries, next, vote, INITIAL_STATE} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = INITIAL_STATE, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'SET_ENTRIES'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> setEntries(state, action.entries); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'NEXT'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> next(state); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'VOTE'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vote(state, action.entry) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; }</code> </pre><br><br>  ,   reducer               .  ,    ,     <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Array/reduce"></a>    .     <i></i> :     callback-a. <br><br><pre> <code class="javascript hljs">test/reducer_spec.js it(<span class="hljs-string"><span class="hljs-string">'   reduce'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actions = [ {<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'SET_ENTRIES'</span></span>, <span class="hljs-attr"><span class="hljs-attr">entries</span></span>: [<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>]}, {<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'NEXT'</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'VOTE'</span></span>, <span class="hljs-attr"><span class="hljs-attr">entry</span></span>: <span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'VOTE'</span></span>, <span class="hljs-attr"><span class="hljs-attr">entry</span></span>: <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'VOTE'</span></span>, <span class="hljs-attr"><span class="hljs-attr">entry</span></span>: <span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'NEXT'</span></span>} ]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> finalState = actions.reduce(reducer, <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>()); expect(finalState).to.equal(fromJS({ <span class="hljs-attr"><span class="hljs-attr">winner</span></span>: <span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span> })); });</code> </pre><br>  <i> / </i>           action/reducer,       .  actions ‚Äî  ,     JSON,  ,  ,      Web Worker,      reducer-a.       ,     . <br><br>  ,    actions    ,      Immutable.     Redux. <br><br><a name="4-6"></a><h2>  4.6.  Reducer- </h2><br>    ,        . <br><br>    ,           .           ,      .         . <br><br>                (  <i></i> ).    :     -   ,     . <br><br>       ,       .  -     :  <code>vote</code>      ,        <code>vote</code> .       .         unit   <code>vote</code> : <br><br><pre> <code class="javascript hljs">test/core_spec.js describe(<span class="hljs-string"><span class="hljs-string">'vote'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'     '</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> state = <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>({ <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: List.of(<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>) }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> nextState = vote(state, <span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>) expect(nextState).to.equal(<span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>({ <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: List.of(<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>), <span class="hljs-attr"><span class="hljs-attr">tally</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>({ <span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> }) })); }); it(<span class="hljs-string"><span class="hljs-string">'       '</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> state = <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>({ <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: List.of(<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>), <span class="hljs-attr"><span class="hljs-attr">tally</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>({ <span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> }) }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> nextState = vote(state, <span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>); expect(nextState).to.equal(<span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>({ <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: List.of(<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>), <span class="hljs-attr"><span class="hljs-attr">tally</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>({ <span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span> }) })); }); });</code> </pre><br>  ,   ,     ! <br><br>   <code>vote</code>          : <br><br><pre> <code class="javascript hljs">src/core.js <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vote</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">voteState, entry</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> voteState.updateIn( [<span class="hljs-string"><span class="hljs-string">'tally'</span></span>, entry], <span class="hljs-number"><span class="hljs-number">0</span></span>, tally =&gt; tally + <span class="hljs-number"><span class="hljs-number">1</span></span> ); }</code> </pre><br>  reducer       <code>vote</code>   . <br><br><pre> <code class="javascript hljs">src/reducer.js <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = INITIAL_STATE, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'SET_ENTRIES'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> setEntries(state, action.entries); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'NEXT'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> next(state); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'VOTE'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state.update(<span class="hljs-string"><span class="hljs-string">'vote'</span></span>, voteState =&gt; vote(voteState, action.entry)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; }</code> </pre><br>     ,        :  -reducer      reducer-  .              . <br><br>    <i>reducer-</i>     <a href="http://rackt.github.io/redux/docs/basics/Reducers.html"> Redux</a> .      ,      reducer-. <br><br><a name="4-7"></a><h2>  4.7.  Redux Store </h2><br> ,     reducer,   ,      Redux. <br><br>     ,       ,         ,      <code>reduce</code>       . ,      .   ,     :     ,     ,   . <br><br>      ‚Äî <i>Redux Store</i> .   ,  ,      . <br><br>   reducer-,    : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {createStore} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = createStore(reducer);</code> </pre><br>   <i> (dispatch)</i>   store,    reducer-       .        <i></i> ,     Redux-Store. <br><br><pre> <code class="javascript hljs">store.dispatch({<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'NEXT'</span></span>});</code> </pre><br>           : <br><br><pre> <code class="javascript hljs">store.getState();</code> </pre><br>     Redux Store   <code>store.js</code> .   :    ,    ,  action    : <br><br><pre> <code class="javascript hljs">test/store_spec.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {<span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>, fromJS} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {expect} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'chai'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> makeStore <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../src/store'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'store'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'     '</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = makeStore(); expect(store.getState()).to.equal(<span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>()); store.dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'SET_ENTRIES'</span></span>, <span class="hljs-attr"><span class="hljs-attr">entries</span></span>: [<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>] }); expect(store.getState()).to.equal(fromJS({ <span class="hljs-attr"><span class="hljs-attr">entries</span></span>: [<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>] })); }); });</code> </pre><br>   Store    Redux  : <br><br><pre> <code class="bash hljs">npm install --save redux</code> </pre><br>    <code>store.js</code> ,    <code>createStore</code>   reducer-: <br><br><pre> <code class="javascript hljs">src/store.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {createStore} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> reducer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./reducer'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeStore</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> createStore(reducer); }</code> </pre><br> , Redux Store      ,       ‚Äî    ,   actions,            ,   reducer. <br><br> <i>:    Redux-  ?</i> <br> <i>: .  .</i> <br><br>      .   ,          .     -      ? <br><br>     <i> </i> .    ‚Äî  ,        .   ‚Äî     . <br><br> ,          Redux.  ,      reducer-,    Redux   .       ,    ,     ! <br><br>         ‚Äî <code>index.js</code> ,      Store: <br><br><pre> <code class="javascript hljs">index.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> makeStore <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./src/store'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = makeStore();</code> </pre><br>      ,      Node REPL (,   <code>babel-node</code> ),   <code>index.js</code>       Store. <br><br><a name="4-8"></a><h2> 4.8.   Socket.io </h2><br>           ,        .       ,  . <br><br>          ,            .      WebSocket'. ,   <a href="http://socket.io/">Socket.io</a> ,        WebSocket'.        <a href="http://www.jonahnisenson.com/how-does-socket-io-fallback-to-xhr-or-jsonp/"> </a>  ,   WebSocket'. <br><br>  Socket.io  : <br><br><pre> <code class="javascript hljs">npm install --save socket.io</code> </pre><br>   <code>server.js</code> ,     Socket.io: <br><br><pre> <code class="javascript hljs">src/server.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Server <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'socket.io'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startServer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> io = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Server().attach(<span class="hljs-number"><span class="hljs-number">8090</span></span>); }</code> </pre><br>     Socket.io,      8090  HTTP-.   ,     ,        . <br><br>      <code>index.js</code> ,        : <br><br><pre> <code class="javascript hljs">index.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> makeStore <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./src/store'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> startServer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./src/server'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = makeStore(); startServer();</code> </pre><br>     ,   <code>start</code>   <code>package.json</code> : <br><br><pre> <code class="javascript hljs">package.json <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: { <span class="hljs-string"><span class="hljs-string">"start"</span></span>: <span class="hljs-string"><span class="hljs-string">"babel-node index.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"test"</span></span>: <span class="hljs-string"><span class="hljs-string">"mocha --compilers js:babel-core/register --require ./test/test_helper.js --recursive"</span></span>, <span class="hljs-string"><span class="hljs-string">"test:watch"</span></span>: <span class="hljs-string"><span class="hljs-string">"npm run test -- --watch"</span></span> },</code> </pre><br>           Redux-Store: <br><br><pre> <code class="bash hljs">npm run start</code> </pre><br>  <code>babel-node</code>       <a href="https://babeljs.io/docs/usage/cli/">babel-cli</a> .     Node-    Babel-.  ,       ,     .        . <br><br><a name="4-9"></a><h2> 4.9.  Store  Redux Listener </h2><br>      Socket.io   Redux ,      .  . <br><br>         (, ¬´   ?¬ª, ¬´  ?¬ª, ¬´   ?¬ª).         <a href="http://socket.io/docs/server-api/">   Socket.io</a>   . <br><br>   ,  - ?    <i></i>  Redux store,  ,        action,    .  ,  callback     store. <br><br>      <code>startServer</code> ,     Redux store  : <br><br><pre> <code class="javascript hljs">index.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> makeStore <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./src/store'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {startServer} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./src/server'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = makeStore(); startServer(store);</code> </pre><br>    (listener)   .    ,     JavaScript-      Socket.io    <code>state</code> .     JSON-  ,      Socket.io. <br><br><pre> <code class="javascript hljs">src/server.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Server <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'socket.io'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startServer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">store</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> io = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Server().attach(<span class="hljs-number"><span class="hljs-number">8090</span></span>); store.subscribe( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> io.emit(<span class="hljs-string"><span class="hljs-string">'state'</span></span>, store.getState().toJS()) ); }</code> </pre><br>       <i></i>   .         .      (,     ,    ,  ..).            . <br><br>       ,    <i></i>       .           . <br><br>   Socket.io     <code>connection</code> ,     .         : <br><br><pre> <code class="javascript hljs">src/server.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Server <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'socket.io'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startServer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">store</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> io = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Server().attach(<span class="hljs-number"><span class="hljs-number">8090</span></span>); store.subscribe( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> io.emit(<span class="hljs-string"><span class="hljs-string">'state'</span></span>, store.getState().toJS()) ); io.on(<span class="hljs-string"><span class="hljs-string">'connection'</span></span>, (socket) =&gt; { socket.emit(<span class="hljs-string"><span class="hljs-string">'state'</span></span>, store.getState().toJS()); }); }</code> </pre><br><a name="4-10"></a><h2> 4.10.  Remote Redux Actions </h2><br>      ,       :   ,           <code>NEXT</code> .       Redux store  <code>action</code> ,  . <br><br><pre> <code class="javascript hljs">src/server.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Server <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'socket.io'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startServer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">store</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> io = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Server().attach(<span class="hljs-number"><span class="hljs-number">8090</span></span>); store.subscribe( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> io.emit(<span class="hljs-string"><span class="hljs-string">'state'</span></span>, store.getState().toJS()) ); io.on(<span class="hljs-string"><span class="hljs-string">'connection'</span></span>, (socket) =&gt; { socket.emit(<span class="hljs-string"><span class="hljs-string">'state'</span></span>, store.getState().toJS()); socket.on(<span class="hljs-string"><span class="hljs-string">'action'</span></span>, store.dispatch.bind(store)); }); }</code> </pre><br>       ¬´ Redux¬ª,      store  (remote) actions.   Redux    :   JavaScript-,      ,     ,          .    ! <br><br> ,        ,     ,   Socket.io,     Redux store.       -  ,  <a href="http://vertx.io/docs/vertx-web/java/">Vert.x Event Bus Bridge</a> .         . <br><br>      : <br><br><ol><li>     -  (action). </li><li>     Redux store. </li><li> Store  reducer,   ,    action. </li><li> Store      reducer- . </li><li> Store   listener,  . </li><li>    <code>state</code> . </li><li>    ‚Äî  ,     ‚Äî   . </li></ol><br> ,      ,       ,  ,   .      <code>entries.json</code> .       . <br><br><pre> <code class="javascript hljs">entries.json [ <span class="hljs-string"><span class="hljs-string">"Shallow Grave"</span></span>, <span class="hljs-string"><span class="hljs-string">"Trainspotting"</span></span>, <span class="hljs-string"><span class="hljs-string">"A Life Less Ordinary"</span></span>, <span class="hljs-string"><span class="hljs-string">"The Beach"</span></span>, <span class="hljs-string"><span class="hljs-string">"28 Days Later"</span></span>, <span class="hljs-string"><span class="hljs-string">"Millions"</span></span>, <span class="hljs-string"><span class="hljs-string">"Sunshine"</span></span>, <span class="hljs-string"><span class="hljs-string">"Slumdog Millionaire"</span></span>, <span class="hljs-string"><span class="hljs-string">"127 Hours"</span></span>, <span class="hljs-string"><span class="hljs-string">"Trance"</span></span>, <span class="hljs-string"><span class="hljs-string">"Steve Jobs"</span></span> ]</code> </pre><br>      <code>index.js</code> ,        <code>NEXT</code> : <br><br><pre> <code class="javascript hljs">index.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> makeStore <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./src/store'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {startServer} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./src/server'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = makeStore(); startServer(store); store.dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'SET_ENTRIES'</span></span>, <span class="hljs-attr"><span class="hljs-attr">entries</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./entries.json'</span></span>) }); store.dispatch({<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'NEXT'</span></span>});</code> </pre><br>      . <br><br><a name="5"></a><h1> 5.   </h1><br>     React-,        .      Redux. ,       :      React-.      ,   ,     React      .     ,      <a href="https://github.com/teropa/redux-voting-client">GitHub</a> . <br><br><a name="5-1"></a><h2>  5.1.    </h2><br>       NPM-,        . <br><br><pre> <code class="bash hljs">mkdir voting-client <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> voting-client npm init ‚Äìy</code> </pre><br>       HTML-.    <code>dist/index.html</code> : <br><br><pre> <code class="html hljs xml">dist/index.html <span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"app"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bundle.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>    <code>&lt;div&gt;</code>  ID <code>app</code> ,      .          <code>bundle.js</code> . <br><br>   JavaScript-,     .          : <br><br><pre> <code class="javascript hljs">src/index.js <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'I am alive!'</span></span>);</code> </pre><br>       <a href="http://webpack.github.io/">Webpack</a>    ,     : <br><br><pre> <code class="bash hljs">npm install --save-dev webpack webpack-dev-server</code> </pre><br>      ,      ,          : <code>npm install -g webpack webpack-dev-server</code> . <br><br>    Webpack,    ,   : <br><br><pre> <code class="javascript hljs">webpack.config.js <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">entry</span></span>: [ <span class="hljs-string"><span class="hljs-string">'./src/index.js'</span></span> ], <span class="hljs-attr"><span class="hljs-attr">output</span></span>: { <span class="hljs-attr"><span class="hljs-attr">path</span></span>: __dirname + <span class="hljs-string"><span class="hljs-string">'/dist'</span></span>, <span class="hljs-attr"><span class="hljs-attr">publicPath</span></span>: <span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-attr"><span class="hljs-attr">filename</span></span>: <span class="hljs-string"><span class="hljs-string">'bundle.js'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">devServer</span></span>: { <span class="hljs-attr"><span class="hljs-attr">contentBase</span></span>: <span class="hljs-string"><span class="hljs-string">'./dist'</span></span> } };</code> </pre><br>      <code>index.js</code>       <code>dist/bundle.js</code> .  <code>dist</code>      . <br><br>    webpack   <code>bundle.js</code> : <br><br><pre> <code class="bash hljs">webpack</code> </pre><br>   ,        localhost:8080 (    <code>index.js</code> ). <br><br><pre> <code class="bash hljs">webpack-dev-server</code> </pre><br>        React <a href="https://facebook.github.io/jsx/">JSX </a>  ES6,      . Babel     ,      Webpack-: <br><br><pre> <code class="bash hljs">npm install --save-dev babel-core babel-loader babel-preset-es2015 babel-preset-react</code> </pre><br>   <code>package.json</code>  Babel' ES6/ES2015  React JSX,     : <br><br><pre> <code class="javascript hljs">package.json <span class="hljs-string"><span class="hljs-string">"babel"</span></span>: { <span class="hljs-string"><span class="hljs-string">"presets"</span></span>: [<span class="hljs-string"><span class="hljs-string">"es2015"</span></span>, <span class="hljs-string"><span class="hljs-string">"react"</span></span>] }</code> </pre><br>     Webpack,     <code>.jsx</code>  <code>.js</code>       Babel: <br><br><pre> <code class="javascript hljs">webpack.config.js <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">entry</span></span>: [ <span class="hljs-string"><span class="hljs-string">'./src/index.js'</span></span> ], <span class="hljs-attr"><span class="hljs-attr">module</span></span>: { <span class="hljs-attr"><span class="hljs-attr">loaders</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.jsx?$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">exclude</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/node_modules/</span></span>, <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-string"><span class="hljs-string">'babel'</span></span> }] }, <span class="hljs-attr"><span class="hljs-attr">resolve</span></span>: { <span class="hljs-attr"><span class="hljs-attr">extensions</span></span>: [<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'.js'</span></span>, <span class="hljs-string"><span class="hljs-string">'.jsx'</span></span>] }, <span class="hljs-attr"><span class="hljs-attr">output</span></span>: { <span class="hljs-attr"><span class="hljs-attr">path</span></span>: __dirname + <span class="hljs-string"><span class="hljs-string">'/dist'</span></span>, <span class="hljs-attr"><span class="hljs-attr">publicPath</span></span>: <span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-attr"><span class="hljs-attr">filename</span></span>: <span class="hljs-string"><span class="hljs-string">'bundle.js'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">devServer</span></span>: { <span class="hljs-attr"><span class="hljs-attr">contentBase</span></span>: <span class="hljs-string"><span class="hljs-string">'./dist'</span></span> } };</code> </pre><br>      CSS.      ,       .      <a href="https://github.com/teropa/redux-voting-client/commit/css"> </a> .    CSS-   Webpack-    ( <a href="https://github.com/postcss/autoprefixer"></a> ),   ,    . <br><br><a name="5-1-1"></a><h3>  5.1.1.    </h3><br>         .       ‚Äî Mocha  Chai: <br><br><pre> <code class="bash hljs">npm install --save-dev mocha chai</code> </pre><br>     React-,     DOM.         -    <a href="http://karma-runner.github.io/0.13/index.html">Karma</a> .       ,   <a href="http://jaketrent.com/post/testing-react-with-jsdom/"> </a>  <a href="https://github.com/tmpvar/jsdom">jsdom</a> ,  DOM   JavaScript  Node: <br><br><pre> <code class="bash hljs">npm install --save-dev jsdom</code> </pre><br>    jsdom  io.js  Node.js 4.0.0.       Node,        jsdom: <br><br><pre> <code class="bash hljs">npm install --save-dev jsdom@3</code> </pre><br>       jsdom   React.  ,  jsdom-  <code>document</code>  <code>window</code> ,  .     <a href="https://nodejs.org/api/globals.html"> </a> ,  React   ,     <code>document</code>  <code>window</code> .       : <br><br><pre> <code class="javascript hljs">test/test_helper.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> jsdom <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'jsdom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> doc = jsdom.jsdom(<span class="hljs-string"><span class="hljs-string">'&lt;!doctype html&gt;&lt;html&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> win = doc.defaultView; global.document = doc; global.window = win;</code> </pre><br>  ,     ,   jsdom- <code>window</code> (, <code>navigator</code> ),      global  Node.js.    ,    <code>window</code>       <code>window.</code> ,      .       React: <br><br><pre> <code class="javascript hljs">test/test_helper.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> jsdom <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'jsdom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> doc = jsdom.jsdom(<span class="hljs-string"><span class="hljs-string">'&lt;!doctype html&gt;&lt;html&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> win = doc.defaultView; global.document = doc; global.window = win; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>).forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> global)) { global[key] = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>[key]; } });</code> </pre><br>    Immutable ,       ,      ,    Chai.    ‚Äî immutable  chai-immutable: <br><br><pre> <code class="bash hljs">npm install --save immutable npm install --save-dev chai-immutable</code> </pre><br>       : <br><br><pre> <code class="javascript hljs">test/test_helper.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> jsdom <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'jsdom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chai <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'chai'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chaiImmutable <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'chai-immutable'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> doc = jsdom.jsdom(<span class="hljs-string"><span class="hljs-string">'&lt;!doctype html&gt;&lt;html&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> win = doc.defaultView; global.document = doc; global.window = win; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>).forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> global)) { global[key] = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>[key]; } }); chai.use(chaiImmutable);</code> </pre><br>     :    <code>package.json</code>    : <br><br><pre> <code class="javascript hljs">package.json <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: { <span class="hljs-string"><span class="hljs-string">"test"</span></span>: <span class="hljs-string"><span class="hljs-string">"mocha --compilers js:babel-core/register --require ./test/test_helper.js \"test/**/*@(.js|.jsx)\""</span></span> },</code> </pre><br>        <code> package.json</code> .      :     <code>--recursive</code> ,        <code>.jsx</code> -.     <code>.js</code> ,  <code>.jsx</code> -  <a href="https://github.com/isaacs/node-glob">glob</a> . <br><br>           .      <code>test:watch</code> ,    : <br><br><pre> <code class="javascript hljs">package.json <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: { <span class="hljs-string"><span class="hljs-string">"test"</span></span>: <span class="hljs-string"><span class="hljs-string">"mocha --compilers js:babel-core/register --require ./test/test_helper.js 'test/**/*.@(js|jsx)'"</span></span>, <span class="hljs-string"><span class="hljs-string">"test:watch"</span></span>: <span class="hljs-string"><span class="hljs-string">"npm run test -- --watch"</span></span> },</code> </pre><br><a name="5-2"></a><h2>  5.2. React  react-hot-loader </h2><br>  Webpack  Babel ,  React! <br><br>   React-   Redux  Immutable        (Pure Components,     Dumb Components).   ,      ,    : <br><br><ol><li>        ,       .       ‚Äî    ,     .. </li><li>        .      .   -     ,      ,          .     ,      . </li></ol><br>    <a href="https://www.youtube.com/watch%3Fv%3D1uRC3hmKQnM%26feature%3Dyoutu.be%26t%3D13m10s"> ,     </a> :   ,   ,        .        .     ,          . <br><br>       ,    <i></i> ?      Redux store!       ‚Äî  . React-        <i></i>     . <br><br>     .  React   : <br><br><pre> <code class="bash hljs">npm install --save react react-dom</code> </pre><br>   <a href="https://github.com/gaearon/react-hot-loader">react-hot-loader</a> .              . <br><br><pre> <code class="bash hljs">npm install --save-dev react-hot-loader</code> </pre><br>     react-hot-loader,       .  , <a href="https://www.youtube.com/watch%3Fv%3DxsSnOQynTHs"> Redux  react-hot-loader ‚Äî    </a> ! <br><br>         <code>webpack.config.js</code> .   : <br><br><pre> <code class="javascript hljs">webpack.config.js <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> webpack = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'webpack'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">entry</span></span>: [ <span class="hljs-string"><span class="hljs-string">'webpack-dev-server/client?http://localhost:8080'</span></span>, <span class="hljs-string"><span class="hljs-string">'webpack/hot/only-dev-server'</span></span>, <span class="hljs-string"><span class="hljs-string">'./src/index.js'</span></span> ], <span class="hljs-attr"><span class="hljs-attr">module</span></span>: { <span class="hljs-attr"><span class="hljs-attr">loaders</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.jsx?$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">exclude</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/node_modules/</span></span>, <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-string"><span class="hljs-string">'react-hot!babel'</span></span> }] }, <span class="hljs-attr"><span class="hljs-attr">resolve</span></span>: { <span class="hljs-attr"><span class="hljs-attr">extensions</span></span>: [<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'.js'</span></span>, <span class="hljs-string"><span class="hljs-string">'.jsx'</span></span>] }, <span class="hljs-attr"><span class="hljs-attr">output</span></span>: { <span class="hljs-attr"><span class="hljs-attr">path</span></span>: __dirname + <span class="hljs-string"><span class="hljs-string">'/dist'</span></span>, <span class="hljs-attr"><span class="hljs-attr">publicPath</span></span>: <span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-attr"><span class="hljs-attr">filename</span></span>: <span class="hljs-string"><span class="hljs-string">'bundle.js'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">devServer</span></span>: { <span class="hljs-attr"><span class="hljs-attr">contentBase</span></span>: <span class="hljs-string"><span class="hljs-string">'./dist'</span></span>, <span class="hljs-attr"><span class="hljs-attr">hot</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">plugins</span></span>: [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> webpack.HotModuleReplacementPlugin() ] };</code> </pre><br>   <code>entry</code>         :    Webpack      (hot module loader) Webpack.       Webpack  <a href="https://github.com/webpack/docs/wiki/hot-module-replacement-with-webpack">  </a> .      ,    <code>plugins</code>          <code>devServer</code> . <br><br>   <code>loaders</code>    <code>react-hot</code> ,     Babel     .js  .jsx. <br><br>                   (Hot Module Replacement). <br><br><a name="5-3"></a><h2>  5.3.       </h2><br>     :    ,     ,       .       . <br><br><img src="https://habrastorage.org/files/83a/da5/a4a/83ada5a4a8fb409f89fb067758eddbc7.png"><br><br>         ,   React-   :   ,   .   ,  Webpack  react-hot-loader     <a href="http://blog.iterate.no/2012/10/01/know-your-feedback-loop-why-and-how-to-optimize-it/">  </a> ,   .  ,      ,      . <br><br> ,     <code>Voting</code>        .     div <code>#app</code> ,      <code>index.html</code> .    <code>index.js</code>  <code>index.jsx</code> ,     JSX-: <br><br><pre> <code class="javascript hljs">src/index.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Voting <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/Voting'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pair = [<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>]; ReactDOM.render( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Voting</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pair</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{pair}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">, document.getElementById('app') );</span></span></code> </pre><br>  <code>Voting</code>      .      ,     .  ,    ,   . <br><br>      <code>webpack.config.js</code> : <br><br><pre> <code class="javascript hljs">webpack.config.js entry: [ <span class="hljs-string"><span class="hljs-string">'webpack-dev-server/client?http://localhost:8080'</span></span>, <span class="hljs-string"><span class="hljs-string">'webpack/hot/only-dev-server'</span></span>, <span class="hljs-string"><span class="hljs-string">'./src/index.jsx'</span></span> ],</code> </pre><br>      webpack-dev-server       <code>Voting</code> .    : <br><br><pre> <code class="javascript hljs">src/components/Voting.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> React.createClass({ <span class="hljs-attr"><span class="hljs-attr">getPair</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.pair || []; }, <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"voting"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {this.getPair().map(entry =&gt; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{entry}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{entry}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> )} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; } });</code> </pre><br>      ,     .      - ,  <i></i>   .     .       . <br><br>     ,  ,     webpack-dev-server,    . <br><br>      .      <code>Voting_spec.jsx</code> : <br><br><pre> <code class="javascript hljs">test/components/Voting_spec.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Voting <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../src/components/Voting'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'Voting'</span></span>, () =&gt; { });</code> </pre><br>       <code>pair</code> ,      .      <a href="https://facebook.github.io/react/docs/test-utils.html">renderIntoDocument</a>     React,    : <br><br><pre> <code class="bash hljs">npm install --save react-addons-test-utils</code> </pre><br><br><pre> <code class="javascript hljs">test/components/Voting_spec.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { renderIntoDocument } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-addons-test-utils'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Voting <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../src/components/Voting'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'Voting'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'renders a pair of buttons'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> component = renderIntoDocument( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Voting</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pair</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{[</span></span></span></span><span class="xml"><span class="hljs-tag">"</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Trainspotting</span></span></span></span><span class="xml"><span class="hljs-tag">", "</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">28</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Days</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Later</span></span></span></span><span class="xml"><span class="hljs-tag">"]} /&gt;</span></span></span><span class="xml"> ); }); });</span></span></code> </pre><br>            React ‚Äî <a href="https://facebook.github.io/react/docs/test-utils.html">scryRenderedDOMComponentsWithTag</a> .    ,           . <br><br><pre> <code class="javascript hljs">test/components/Voting_spec.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { renderIntoDocument, scryRenderedDOMComponentsWithTag } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-addons-test-utils'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Voting <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../src/components/Voting'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {expect} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'chai'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'Voting'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'renders a pair of buttons'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> component = renderIntoDocument( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Voting</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pair</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{[</span></span></span></span><span class="xml"><span class="hljs-tag">"</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Trainspotting</span></span></span></span><span class="xml"><span class="hljs-tag">", "</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">28</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Days</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Later</span></span></span></span><span class="xml"><span class="hljs-tag">"]} /&gt;</span></span></span><span class="xml"> ); const buttons = scryRenderedDOMComponentsWithTag(component, 'button'); expect(buttons.length).to.equal(2); expect(buttons[0].textContent).to.equal('Trainspotting'); expect(buttons[1].textContent).to.equal('28 Days Later'); }); });</span></span></code> </pre><br>    : <br><br><pre> <code class="bash hljs">npm run <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre><br>         callback-.        ,    .     .      <a href="https://facebook.github.io/react/docs/test-utils.html">Simulate</a>    React: <br><br><pre> <code class="javascript hljs">test/components/Voting_spec.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { renderIntoDocument, scryRenderedDOMComponentsWithTag, Simulate } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-addons-test-utils'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Voting <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../src/components/Voting'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {expect} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'chai'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'Voting'</span></span>, () =&gt; { <span class="hljs-comment"><span class="hljs-comment">// ... it('invokes callback when a button is clicked', () =&gt; { let votedWith; const vote = (entry) =&gt; votedWith = entry; const component = renderIntoDocument( &lt;Voting pair={["Trainspotting", "28 Days Later"]} vote={vote}/&gt; ); const buttons = scryRenderedDOMComponentsWithTag(component, 'button'); Simulate.click(buttons[0]); expect(votedWith).to.equal('Trainspotting'); }); });</span></span></code> </pre><br>     .       <code>onClick</code> ,  <code>vote</code>   : <br><br><pre> <code class="javascript hljs">src/components/Voting.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> React.createClass({ <span class="hljs-attr"><span class="hljs-attr">getPair</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.pair || []; }, <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"voting"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {this.getPair().map(entry =&gt; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{entry}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{()</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> this.props.vote(entry)}&gt; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{entry}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> )} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; } });</code> </pre><br>             :      actions,     callback-. <br><br>       .               ,   ,      . <br><br>     - ,       .         ,      ,    .    <code>hasVoted</code> ,      : <br><br><pre> <code class="javascript hljs">src/index.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Voting <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/Voting'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pair = [<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>]; ReactDOM.render( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Voting</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pair</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{pair}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">hasVoted</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"Trainspotting"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">, document.getElementById('app') );</span></span></code> </pre><br>    : <br><br><pre> <code class="javascript hljs">src/components/Voting.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> React.createClass({ <span class="hljs-attr"><span class="hljs-attr">getPair</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.pair || []; }, <span class="hljs-attr"><span class="hljs-attr">isDisabled</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.hasVoted; }, <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"voting"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {this.getPair().map(entry =&gt; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{entry}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">disabled</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.isDisabled()}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{()</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> this.props.vote(entry)}&gt; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{entry}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> )} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; } });</code> </pre><br>   label  ,        <code>hasVoted</code> .    <code>hasVotedFor</code> ,   ,    : <br><br><pre> <code class="javascript hljs">src/components/Voting.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> React.createClass({ <span class="hljs-attr"><span class="hljs-attr">getPair</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.pair || []; }, <span class="hljs-attr"><span class="hljs-attr">isDisabled</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.hasVoted; }, <span class="hljs-attr"><span class="hljs-attr">hasVotedFor</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">entry</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.hasVoted === entry; }, <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"voting"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {this.getPair().map(entry =&gt; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{entry}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">disabled</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.isDisabled()}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{()</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> this.props.vote(entry)}&gt; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{entry}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {this.hasVotedFor(entry) ? </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"label"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Voted</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> : null} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> )} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; } });</code> </pre><br>      ,     .      ,     : <br><br><pre> <code class="javascript hljs">src/index.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Voting <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/Voting'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pair = [<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>]; ReactDOM.render( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Voting</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pair</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{pair}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">winner</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"Trainspotting"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">, document.getElementById('app') );</span></span></code> </pre><br>     ,  div          winner: <br><br><pre> <code class="javascript hljs">src/components/Voting.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> React.createClass({ <span class="hljs-attr"><span class="hljs-attr">getPair</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.pair || []; }, <span class="hljs-attr"><span class="hljs-attr">isDisabled</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.hasVoted; }, <span class="hljs-attr"><span class="hljs-attr">hasVotedFor</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">entry</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.hasVoted === entry; }, <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"voting"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {this.props.winner ? </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"winner"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Winner is {this.props.winner}!</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> : this.getPair().map(entry =&gt; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{entry}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">disabled</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.isDisabled()}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{()</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> this.props.vote(entry)}&gt; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{entry}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {this.hasVotedFor(entry) ? </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"label"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Voted</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> : null} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> )} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; } });</code> </pre><br>      ,       .      ,     (vote screen)     (winner),    (vote).    winner    div: <br><br><pre> <code class="javascript hljs">src/components/Winner.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> React.createClass({ <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"winner"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Winner is {this.props.winner}! </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; } });</code> </pre><br>      ,   ,    : <br><br><pre> <code class="javascript hljs">src/components/Vote.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> React.createClass({ <span class="hljs-attr"><span class="hljs-attr">getPair</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.pair || []; }, <span class="hljs-attr"><span class="hljs-attr">isDisabled</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.hasVoted; }, <span class="hljs-attr"><span class="hljs-attr">hasVotedFor</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">entry</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.hasVoted === entry; }, <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"voting"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {this.getPair().map(entry =&gt; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{entry}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">disabled</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.isDisabled()}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{()</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> this.props.vote(entry)}&gt; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{entry}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {this.hasVotedFor(entry) ? </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"label"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Voted</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> : null} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> )} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; } });</code> </pre><br>        ,      : <br><br><pre> <code class="javascript hljs">src/components/Voting.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Winner <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./Winner'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Vote <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./Vote'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> React.createClass({ <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &lt;div&gt; {this.props.winner ? &lt;Winner ref="winner" winner={this.props.winner} /&gt; : &lt;Vote {...this.props} /&gt;} &lt;/div&gt;; } });</code> </pre><br>  ,      <a href="https://facebook.github.io/react/docs/more-about-refs.html">ref</a> .           DOM-. <br><br>      ! ,       <i></i> :   ,     ,    callback-.      .     ,    Redux store. <br><br>          .   <code>hasVoted</code>      : <br><br><pre> <code class="javascript hljs">test/components/Voting_spec.jsx it(<span class="hljs-string"><span class="hljs-string">' ,    '</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> component = renderIntoDocument( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Voting</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pair</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{[</span></span></span></span><span class="xml"><span class="hljs-tag">"</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Trainspotting</span></span></span></span><span class="xml"><span class="hljs-tag">", "</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">28</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Days</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Later</span></span></span></span><span class="xml"><span class="hljs-tag">"]} </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">hasVoted</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"Trainspotting"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> ); const buttons = scryRenderedDOMComponentsWithTag(component, 'button'); expect(buttons.length).to.equal(2); expect(buttons[0].hasAttribute('disabled')).to.equal(true); expect(buttons[1].hasAttribute('disabled')).to.equal(true); });</span></span></code> </pre><br> Label <code>Voted</code>    ,       <code>hasVoted</code> : <br><br><pre> <code class="javascript hljs">test/components/Voting_spec.jsx it(<span class="hljs-string"><span class="hljs-string">' label  ,   '</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> component = renderIntoDocument( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Voting</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pair</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{[</span></span></span></span><span class="xml"><span class="hljs-tag">"</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Trainspotting</span></span></span></span><span class="xml"><span class="hljs-tag">", "</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">28</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Days</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Later</span></span></span></span><span class="xml"><span class="hljs-tag">"]} </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">hasVoted</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"Trainspotting"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> ); const buttons = scryRenderedDOMComponentsWithTag(component, 'button'); expect(buttons[0].textContent).to.contain('Voted'); });</span></span></code> </pre><br>     ,     ,    ref' : <br><br><pre> <code class="javascript hljs">test/components/Voting_spec.jsx it(<span class="hljs-string"><span class="hljs-string">'  '</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> component = renderIntoDocument( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Voting</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">winner</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"Trainspotting"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> ); const buttons = scryRenderedDOMComponentsWithTag(component, 'button'); expect(buttons.length).to.equal(0); const winner = ReactDOM.findDOMNode(component.refs.winner); expect(winner).to.be.ok; expect(winner.textContent).to.contain('Trainspotting'); });</span></span></code> </pre><br>          ,   ,           ¬´¬ª.     ,   ,       ,    . <br><br><a name="5-4"></a><h2>  5.4.      (Pure Rendering) </h2><br>       ,    ,   ,       React.           ,         ,   React        . <br><br>    <a href="https://facebook.github.io/react/docs/pure-render-mixin.html">PureRenderMixin</a>  <a href="https://www.npmjs.com/package/react-addons-pure-render-mixin">add-on-</a> .   mixin  ,  React  -   ( )    .    ,  ,   . <br><br>      ,    immutable    .        ,         ,      ! <br><br>       . ,     ,       ,      - ,   <i> </i> : <br><br><pre> <code class="javascript hljs">test/components/Voting_spec.jsx it(<span class="hljs-string"><span class="hljs-string">'   '</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pair = [<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> container = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'div'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> component = ReactDOM.render( &lt;Voting pair={pair} /&gt;, container ); let firstButton = scryRenderedDOMComponentsWithTag(component, 'button')[0]; expect(firstButton.textContent).to.equal('Trainspotting'); pair[0] = 'Sunshine'; component = ReactDOM.render( &lt;Voting pair={pair} /&gt;, container ); firstButton = scryRenderedDOMComponentsWithTag(component, 'button')[0]; expect(firstButton.textContent).to.equal('Trainspotting'); });</code> </pre><br>  <code>renderIntoDocument</code>     <code>&lt;div&gt;</code>     ,  . <br><br>      <b></b>  ,     : <br><br><pre> <code class="javascript hljs">test/components/Voting_spec.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { renderIntoDocument, scryRenderedDOMComponentsWithTag, Simulate } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-addons-test-utils'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {List} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Voting <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../src/components/Voting'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {expect} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'chai'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'Voting'</span></span>, () =&gt; { <span class="hljs-comment"><span class="hljs-comment">// ... it(' DOM   ', () =&gt; { const pair = List.of('Trainspotting', '28 Days Later'); const container = document.createElement('div'); let component = ReactDOM.render( &lt;Voting pair={pair} /&gt;, container ); let firstButton = scryRenderedDOMComponentsWithTag(component, 'button')[0]; expect(firstButton.textContent).to.equal('Trainspotting'); const newPair = pair.set(0, 'Sunshine'); component = ReactDOM.render( &lt;Voting pair={newPair} /&gt;, container ); firstButton = scryRenderedDOMComponentsWithTag(component, 'button')[0]; expect(firstButton.textContent).to.equal('Sunshine'); }); });</span></span></code> </pre><br>       ,     PureRenderMixin.          .   ,      ,  :     <b></b> .      ,           . <br><br>       ,    PureRenderMixin   .   : <br><br><pre> <code class="bash hljs">npm install --save react-addons-pure-render-mixin</code> </pre><br>         : <br><br><pre> <code class="javascript hljs">src/components/Voting.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PureRenderMixin <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-addons-pure-render-mixin'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Winner <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./Winner'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Vote <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./Vote'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> React.createClass({ <span class="hljs-attr"><span class="hljs-attr">mixins</span></span>: [PureRenderMixin], <span class="hljs-comment"><span class="hljs-comment">// ... }); src/components/Vote.jsx import React from 'react'; import PureRenderMixin from 'react-addons-pure-render-mixin'; export default React.createClass({ mixins: [PureRenderMixin], // ... }); src/components/Winner.jsx import React from 'react'; import PureRenderMixin from 'react-addons-pure-render-mixin'; export default React.createClass({ mixins: [PureRenderMixin], // ... });</span></span></code> </pre><br>  ,         PureRenderMixin   ,       .   ,   React      Voting,       . <br><br>        PureRenderMixin   . -,    ,  -,       . <br><br><a name="5-5"></a><h2>  5.5.          (Routing Handling) </h2><br>    ,        :    . <br><br>          ,     ,        .    ,          . <br><br> ,       ,          .         URL'.   <code>#/</code>    ,   <code>#/results</code> ‚Äî    . <br><br>        <a href="http://rackt.github.io/react-router/">react-router</a> ,           .     : <br><br><pre> <code class="bash hljs">npm install --save react-router@2.0.0</code> </pre><br>   .     (Router)  React- <code>Route</code> ,       .        : <br><br><pre> <code class="javascript hljs">src/index.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Route} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/App'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Voting <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/Voting'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pair = [<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> routes = &lt;Route component={App}&gt; &lt;Route path="/" component={Voting} /&gt; &lt;/Route&gt;; ReactDOM.render( &lt;Voting pair={pair} /&gt;, document.getElementById('app') );</code> </pre><br>     ,    Voting.     <i></i> ,        .     <code>App</code> ,    . <br><br>           .       <code>App</code> : <br><br><pre> <code class="javascript hljs">src/components/App.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {List} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pair = List.of(<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> React.createClass({ <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> React.cloneElement(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.children, {<span class="hljs-attr"><span class="hljs-attr">pair</span></span>: pair}); } });</code> </pre><br>      ,    <code>children</code> .  react-router  ,    .          <code>Voting</code> ,         <code>Voting</code> . <br><br>  ,   <code>pair</code>   <code>index.jsx</code>  <code>App.jsx</code> .         <code>pair</code>   API <a href="https://facebook.github.io/react/docs/top-level-api.html">cloneElement</a> .   ,      . <br><br>     ,    PureRenderMixin   .       App: - <a href="https://github.com/rackt/react-router/issues/470">     React</a>    . ,     . <br><br>    <code>index.js</code> ,     ,     : <br><br><pre> <code class="javascript hljs">src/index.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Router, Route, hashHistory} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/App'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Voting <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/Voting'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> routes = <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Route</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">component</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{App}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Route</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">component</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{Voting}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Route</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">; ReactDOM.render( </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Router</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">history</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{hashHistory}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{routes}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Router</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">, document.getElementById('app') );</span></span></code> </pre><br>  <code>Router</code>   <code>react-router</code>     ,          <code>#hash</code> (   API     HTML 5).         . <br><br>       :      <code>Voting</code> .          React,        .     ,      <code>Results</code> : <br><br><pre> <code class="javascript hljs">src/index.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Router, Route, hashHistory} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/App'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Voting <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/Voting'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Results <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/Results'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> routes = &lt;Route component={App}&gt; &lt;Route path="/results" component={Results} /&gt; &lt;Route path="/" component={Voting} /&gt; &lt;/Route&gt;; ReactDOM.render( &lt;Router history={hashHistory}&gt;{routes}&lt;/Router&gt;, document.getElementById('app') );</code> </pre><br>     <code>&lt;Route&gt;</code>   <code>/results</code>   <code>results</code> .      Voting. <br><br>     <code>Results</code>     : <br><br><pre> <code class="javascript hljs">src/components/Results.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PureRenderMixin <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-addons-pure-render-mixin'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> React.createClass({ <span class="hljs-attr"><span class="hljs-attr">mixins</span></span>: [PureRenderMixin], <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Hello from results!</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> } });</code> </pre><br>     <a href="http://localhost/">localhost</a> :8080/#/results,       Results.      .    ¬´¬ª  ¬´¬ª       ,     .  ,   ! <br><br>             React.      ,   <a href="http://rackt.github.io/react-router/"> </a> . <br><br> ,       Results,     - .       ,        Voting: <br><br><pre> <code class="javascript hljs">src/components/Results.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PureRenderMixin <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-addons-pure-render-mixin'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> React.createClass({ <span class="hljs-attr"><span class="hljs-attr">mixins</span></span>: [PureRenderMixin], <span class="hljs-attr"><span class="hljs-attr">getPair</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.pair || []; }, <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"results"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {this.getPair().map(entry =&gt; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{entry}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"entry"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{entry}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> )} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; } });</code> </pre><br>    ,      ,      .       App    Map: <br><br><pre> <code class="javascript hljs">src/components/App.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {List, <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pair = List.of(<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tally = <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>({<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> React.createClass({ <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> React.cloneElement(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.children, { <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: pair, <span class="hljs-attr"><span class="hljs-attr">tally</span></span>: tally }); } });</code> </pre><br>    Results    : <br><br><pre> <code class="javascript hljs">src/components/Results.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PureRenderMixin <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-addons-pure-render-mixin'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> React.createClass({ <span class="hljs-attr"><span class="hljs-attr">mixins</span></span>: [PureRenderMixin], <span class="hljs-attr"><span class="hljs-attr">getPair</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.pair || []; }, <span class="hljs-attr"><span class="hljs-attr">getVotes</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">entry</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.tally &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.tally.has(entry)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.tally.get(entry); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }, <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"results"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {this.getPair().map(entry =&gt; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{entry}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"entry"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{entry}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"voteCount"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {this.getVotes(entry)} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> )} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; } });</code> </pre><br>              Results,  ,      .    div'   ,          .      ,    : <br><br><pre> <code class="javascript hljs">test/components/Results_spec.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { renderIntoDocument, scryRenderedDOMComponentsWithClass } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-addons-test-utils'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {List, <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Results <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../src/components/Results'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {expect} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'chai'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'Results'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'renders entries with vote counts or zero'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pair = List.of(<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tally = <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>({<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> component = renderIntoDocument( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Results</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pair</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{pair}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">tally</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{tally}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> ); const entries = scryRenderedDOMComponentsWithClass(component, 'entry'); const [train, days] = entries.map(e =&gt; e.textContent); expect(entries.length).to.equal(2); expect(train).to.contain('Trainspotting'); expect(train).to.contain('5'); expect(days).to.contain('28 Days Later'); expect(days).to.contain('0'); }); });</span></span></code> </pre><br>     ¬´Next¬ª,      .    ,      callback-.    ,      ¬´Next¬ª.     ,    ,      : <br><br><pre> <code class="javascript hljs">test/components/Results_spec.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { renderIntoDocument, scryRenderedDOMComponentsWithClass, Simulate } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-addons-test-utils'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {List, <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Results <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../src/components/Results'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {expect} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'chai'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'Results'</span></span>, () =&gt; { <span class="hljs-comment"><span class="hljs-comment">// ... it(' callback    Next', () =&gt; { let nextInvoked = false; const next = () =&gt; nextInvoked = true; const pair = List.of('Trainspotting', '28 Days Later'); const component = renderIntoDocument( &lt;Results pair={pair} tally={Map()} next={next}/&gt; ); Simulate.click(ReactDOM.findDOMNode(component.refs.next)); expect(nextInvoked).to.equal(true); }); });</span></span></code> </pre><br>       .   ,     : <br><br><pre> <code class="javascript hljs">src/components/Results.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PureRenderMixin <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-addons-pure-render-mixin'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> React.createClass({ <span class="hljs-attr"><span class="hljs-attr">mixins</span></span>: [PureRenderMixin], <span class="hljs-attr"><span class="hljs-attr">getPair</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.pair || []; }, <span class="hljs-attr"><span class="hljs-attr">getVotes</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">entry</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.tally &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.tally.has(entry)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.tally.get(entry); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }, <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"results"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"tally"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {this.getPair().map(entry =&gt; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{entry}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"entry"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{entry}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"voteCount"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {this.getVotes(entry)} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> )} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"management"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"next"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"next"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.props.next}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Next </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>; } });</code> </pre><br>       ,      : <br><br><pre> <code class="javascript hljs">test/components/Results_spec.jsx it(<span class="hljs-string"><span class="hljs-string">'  '</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> component = renderIntoDocument( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Results</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">winner</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"Trainspotting"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pair</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{[</span></span></span></span><span class="xml"><span class="hljs-tag">"</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Trainspotting</span></span></span></span><span class="xml"><span class="hljs-tag">", "</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">28</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Days</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Later</span></span></span></span><span class="xml"><span class="hljs-tag">"]} </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">tally</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{Map()}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> ); const winner = ReactDOM.findDOMNode(component.refs.winner); expect(winner).to.be.ok; expect(winner.textContent).to.contain('Trainspotting'); });</span></span></code> </pre><br>         Winner,     .       ,         : <br><br><pre> <code class="javascript hljs">src/components/Results.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PureRenderMixin <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-addons-pure-render-mixin'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Winner <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./Winner'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> React.createClass({ <span class="hljs-attr"><span class="hljs-attr">mixins</span></span>: [PureRenderMixin], <span class="hljs-attr"><span class="hljs-attr">getPair</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.pair || []; }, <span class="hljs-attr"><span class="hljs-attr">getVotes</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">entry</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.tally &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.tally.has(entry)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.tally.get(entry); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }, <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.winner ? <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Winner</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"winner"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">winner</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.props.winner}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> : </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"results"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"tally"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {this.getPair().map(entry =&gt; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{entry}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"entry"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{entry}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"voteCount"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {this.getVotes(entry)} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> )} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"management"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"next"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"next"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.props.next}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Next </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">; } });</span></span></code> </pre><br>            . ,  Tally     .     ,   ! <br><br>     ,    .        ,        . ,        .         ,     . <br><br> ,     ,   ,         Redux store     . <br><br><a name="5-6"></a><h2>  5.6.   Redux Store </h2><br> Redux         ,   .       .     Redux     ,      !   ,      React-. <br><br>      ,       .   ,    . <br><br>       .     ,   .     vote     : <br><br><img src="https://habrastorage.org/files/0a4/68b/17a/0a468b17aca845789b4442ac9b5b9fc8.png"><br><br>       ,     . <br><br><img src="https://habrastorage.org/files/62d/4ab/900/62d4ab90056b42d08e058cd86f696e8d.png"><br><br>   (Voting)  ,       .     : <br><br><img src="https://habrastorage.org/files/f29/bac/d7f/f29bacd7ff894f4d914a58e2ef824e88.png"><br><br>    ,       : <br><br><img src="https://habrastorage.org/files/98c/c0f/4be/98cc0f4be82d48299de89c0f43ffa135.png"><br><br>  ,       ,    <code>hasVoted</code> .         ,  (actions)   (reducers),    Redux store.    ? <br><br>       ,      .     ‚Äî  .        : <br><br><ul><li>         . </li><li>     ‚ÄúNext‚Äù   . </li></ul><br>  ,        .       .     . <br><br>      ,     .      ,     <code>state</code> ,             .   ,      .      reducer-a,   action,           .  action    : <br><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'SET_STATE'</span></span>, <span class="hljs-attr"><span class="hljs-attr">state</span></span>: { <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: {...} } }</code> </pre><br>     ,   .  ,   , reducer       : <br><br><pre> <code class="javascript hljs">test/reducer_spec.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {List, <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>, fromJS} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {expect} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'chai'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> reducer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../src/reducer'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'reducer'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'handles SET_STATE'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initialState = <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> action = { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'SET_STATE'</span></span>, <span class="hljs-attr"><span class="hljs-attr">state</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>({ <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>({ <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: List.of(<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>), <span class="hljs-attr"><span class="hljs-attr">tally</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>({<span class="hljs-attr"><span class="hljs-attr">Trainspotting</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>}) }) }) }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> nextState = reducer(initialState, action); expect(nextState).to.equal(fromJS({ <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: { <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: [<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>], <span class="hljs-attr"><span class="hljs-attr">tally</span></span>: {<span class="hljs-attr"><span class="hljs-attr">Trainspotting</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>} } })); }); });</code> </pre><br> Reducer       JS- .               : <br><br><pre> <code class="javascript hljs">test/reducer_spec.js it(<span class="hljs-string"><span class="hljs-string">' SET_STATE   JS-'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initialState = <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> action = { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'SET_STATE'</span></span>, <span class="hljs-attr"><span class="hljs-attr">state</span></span>: { <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: { <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: [<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>], <span class="hljs-attr"><span class="hljs-attr">tally</span></span>: {<span class="hljs-attr"><span class="hljs-attr">Trainspotting</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>} } } }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> nextState = reducer(initialState, action); expect(nextState).to.equal(fromJS({ <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: { <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: [<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>], <span class="hljs-attr"><span class="hljs-attr">tally</span></span>: {<span class="hljs-attr"><span class="hljs-attr">Trainspotting</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>} } })); });</code> </pre><br>   <code>undefined</code>      reducer-    : <br><br><pre> <code class="javascript hljs">test/reducer_spec.js it(<span class="hljs-string"><span class="hljs-string">' SET_STATE   '</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> action = { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'SET_STATE'</span></span>, <span class="hljs-attr"><span class="hljs-attr">state</span></span>: { <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: { <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: [<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>], <span class="hljs-attr"><span class="hljs-attr">tally</span></span>: {<span class="hljs-attr"><span class="hljs-attr">Trainspotting</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>} } } }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> nextState = reducer(<span class="hljs-literal"><span class="hljs-literal">undefined</span></span>, action); expect(nextState).to.equal(fromJS({ <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: { <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: [<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>], <span class="hljs-attr"><span class="hljs-attr">tally</span></span>: {<span class="hljs-attr"><span class="hljs-attr">Trainspotting</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>} } })); });</code> </pre><br>    .  ,    .    -reducer,  reducer-: <br><br><pre> <code class="javascript hljs">src/reducer.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {<span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = Map(</span></span></span><span class="hljs-function">), </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; }</code> </pre><br> Reducer   action <code>SET_STATE</code> .    <a href="https://facebook.github.io/immutable-js/docs/">merge</a>  Map         -.     ! <br><br><pre> <code class="javascript hljs">src/reducer.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {<span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, newState</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state.merge(newState); } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = Map(</span></span></span><span class="hljs-function">), </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'SET_STATE'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> setState(state, action.state); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; }</code> </pre><br>  ,       ¬´¬ª ,   reducer-.    ,      ,      .   ,           .   ,        . <br><br>        ,    :     ¬´Next¬ª.       ,       ,       . <br><br>    Redux   : <br><br><pre> <code class="bash hljs">npm install --save redux</code> </pre><br>     store    <code>index.jsx</code> .    - ,   <code>SET_STATE</code> (  ,       ): <br><br><pre> <code class="javascript hljs">src/index.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Router, Route, hashHistory} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {createStore} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> reducer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./reducer'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/App'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Voting <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/Voting'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Results <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/Results'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = createStore(reducer); store.dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'SET_STATE'</span></span>, <span class="hljs-attr"><span class="hljs-attr">state</span></span>: { <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: { <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: [<span class="hljs-string"><span class="hljs-string">'Sunshine'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>], <span class="hljs-attr"><span class="hljs-attr">tally</span></span>: {<span class="hljs-attr"><span class="hljs-attr">Sunshine</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>} } } }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> routes = &lt;Route component={App}&gt; &lt;Route path="/results" component={Results} /&gt; &lt;Route path="/" component={Voting} /&gt; &lt;/Route&gt;; ReactDOM.render( &lt;Router history={hashHistory}&gt;{routes}&lt;/Router&gt;, document.getElementById('app') );</code> </pre><br> Store .         React-? <br><br><a name="5-7"></a><h2>  5.7.     Redux  React </h2><br>  Redux Store    .       React-,     .           store  ,   .    React  ,  PureRenderMixin    ,      ,   . <br><br>     ,   Redux React    <a href="https://github.com/rackt/react-redux">react-redux</a> : <br><br><pre> <code class="bash hljs">npm install --save react-redux</code> </pre><br> react-redux      Redux store  : <br><br><ul><li>    store    . </li><li>  actions   callback- . </li></ul><br>          - ( <a href="https://github.com/rackt/react-redux">Provider</a> )  react-redux.       Redux Store,      store c  . <br><br>    -.         . <br><br><pre> <code class="javascript hljs">src/index.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Router, Route, hashHistory} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {createStore} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Provider} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> reducer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./reducer'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/App'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {VotingContainer} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/Voting'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Results <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/Results'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = createStore(reducer); store.dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'SET_STATE'</span></span>, <span class="hljs-attr"><span class="hljs-attr">state</span></span>: { <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: { <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: [<span class="hljs-string"><span class="hljs-string">'Sunshine'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>], <span class="hljs-attr"><span class="hljs-attr">tally</span></span>: {<span class="hljs-attr"><span class="hljs-attr">Sunshine</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>} } } }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> routes = &lt;Route component={App}&gt; &lt;Route path="/results" component={Results} /&gt; &lt;Route path="/" component={VotingContainer} /&gt; &lt;/Route&gt;; ReactDOM.render( &lt;Provider store={store}&gt; &lt;Router history={hashHistory}&gt;{routes}&lt;/Router&gt; &lt;/Provider&gt;, document.getElementById('app') ); });</code> </pre><br>     ,     ¬´¬ª,   store    .     ,      : <br><br><ul><li>   <code>App</code>     ,     . </li><li> <code>Vote</code>  <code>Winner</code>    ,     .      . </li><li>    ,     : <code>Voting</code>  <code>Results</code> .     <code>App</code>  .  -     store. </li></ul><br>    <code>Voting</code> .   react-redux  <a href="https://github.com/rackt/react-redux">connect</a> ,      .       ,    ,   React-: <br><br><pre> <code class="javascript hljs">connect(mapStateToProps)(SomeComponent);</code> </pre><br> -     Redux Store   .         .    Voting      <code>pair</code>  <code>winner</code>  Store: <br><br><pre> <code class="javascript hljs">src/components/Voting.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PureRenderMixin <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-addons-pure-render-mixin'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {connect} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Winner <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./Winner'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Vote <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./Vote'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Voting = React.createClass({ <span class="hljs-attr"><span class="hljs-attr">mixins</span></span>: [PureRenderMixin], <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &lt;div&gt; {this.props.winner ? &lt;Winner ref="winner" winner={this.props.winner} /&gt; : &lt;Vote {...this.props} /&gt;} &lt;/div&gt;; } }); function mapStateToProps(state) { return { pair: state.getIn(['vote', 'pair']), winner: state.get('winner') }; } connect(mapStateToProps)(Voting); export default Voting;</code> </pre><br>    .     ,  <code>connect</code>        <code>Voting</code> .   ,   .   <code>connect</code> <i>  </i> <code>Voting</code> .   ,         .       <code>VotingContainer</code> : <br><br><pre> <code class="javascript hljs">src/components/Voting.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PureRenderMixin <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-addons-pure-render-mixin'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {connect} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Winner <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./Winner'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Vote <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./Vote'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Voting = React.createClass({ <span class="hljs-attr"><span class="hljs-attr">mixins</span></span>: [PureRenderMixin], <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &lt;div&gt; {this.props.winner ? &lt;Winner ref="winner" winner={this.props.winner} /&gt; : &lt;Vote {...this.props} /&gt;} &lt;/div&gt;; } }); function mapStateToProps(state) { return { pair: state.getIn(['vote', 'pair']), winner: state.get('winner') }; } export const VotingContainer = connect(mapStateToProps)(Voting);</code> </pre><br>      <code>Voting</code>    <code>VotingContainer</code> .   react-redux   ¬´¬ª (dumb) ,   ‚Äî ¬´¬ª (smart).     ¬´¬ª  ¬´¬ª.  ,  ,   ,   : <br><br><ul><li> /       .     ,  . </li><li> /      - ,        Redux store.    react-redux. </li></ul><br>   -,   <code>Voting</code>  <code>VotingContainer</code> .       ,     Redux-. <br><br><pre> <code class="javascript hljs">src/index.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Router, Route, hashHistory} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {createStore} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Provider} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> reducer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./reducer'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/App'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {VotingContainer} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/Voting'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Results <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/Results'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = createStore(reducer); store.dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'SET_STATE'</span></span>, <span class="hljs-attr"><span class="hljs-attr">state</span></span>: { <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: { <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: [<span class="hljs-string"><span class="hljs-string">'Sunshine'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>], <span class="hljs-attr"><span class="hljs-attr">tally</span></span>: {<span class="hljs-attr"><span class="hljs-attr">Sunshine</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>} } } }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> routes = &lt;Route component={App}&gt; &lt;Route path="/results" component={Results} /&gt; &lt;Route path="/" component={VotingContainer} /&gt; &lt;/Route&gt;; ReactDOM.render( &lt;Provider store={store}&gt; &lt;Router history={hashHistory}&gt;{routes}&lt;/Router&gt; &lt;/Provider&gt;, document.getElementById('app') );</code> </pre><br>        <code>Voting</code> ,       Voting    <i> </i> : <br><br><pre> <code class="javascript hljs">test/components/Voting_spec.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { renderIntoDocument, scryRenderedDOMComponentsWithTag, Simulate } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-addons-test-utils'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {List} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Voting} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../src/components/Voting'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {expect} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'chai'</span></span>;</code> </pre><br>     .    <i></i>  Voting,   .    ,     store. <br><br>        ,      <code>pair</code>  <code>winner</code> .  ,       <code>tally</code> : <br><br><pre> <code class="javascript hljs">src/components/Results.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PureRenderMixin <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-addons-pure-render-mixin'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {connect} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Winner <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./Winner'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Results = React.createClass({ <span class="hljs-attr"><span class="hljs-attr">mixins</span></span>: [PureRenderMixin], <span class="hljs-attr"><span class="hljs-attr">getPair</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.pair || []; }, <span class="hljs-attr"><span class="hljs-attr">getVotes</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">entry</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.tally &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.tally.has(entry)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.tally.get(entry); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }, <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.winner ? <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Winner</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"winner"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">winner</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.props.winner}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> : </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"results"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"tally"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {this.getPair().map(entry =&gt; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{entry}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"entry"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{entry}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"voteCount"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {this.getVotes(entry)} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> )} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"management"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"next"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"next"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.props.next}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Next </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">; } }); function mapStateToProps(state) { return { pair: state.getIn(['vote', 'pair']), tally: state.getIn(['vote', 'tally']), winner: state.get('winner') } } export const ResultsContainer = connect(mapStateToProps)(Results);</span></span></code> </pre><br>  <code>index.jsx</code>    ,  <code>Results</code>  <code>ResultsContainer</code> : <br><br><pre> <code class="javascript hljs">src/index.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Router, Route, hashHistory} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {createStore} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Provider} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> reducer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./reducer'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/App'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {VotingContainer} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/Voting'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {ResultsContainer} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/Results'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = createStore(reducer); store.dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'SET_STATE'</span></span>, <span class="hljs-attr"><span class="hljs-attr">state</span></span>: { <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: { <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: [<span class="hljs-string"><span class="hljs-string">'Sunshine'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>], <span class="hljs-attr"><span class="hljs-attr">tally</span></span>: {<span class="hljs-attr"><span class="hljs-attr">Sunshine</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>} } } }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> routes = &lt;Route component={App}&gt; &lt;Route path="/results" component={ResultsContainer} /&gt; &lt;Route path="/" component={VotingContainer} /&gt; &lt;/Route&gt;; ReactDOM.render( &lt;Provider store={store}&gt; &lt;Router history={hashHistory}&gt;{routes}&lt;/Router&gt; &lt;/Provider&gt;, document.getElementById('app') );</code> </pre><br> ,        <code>Results</code> : <br><br><pre> <code class="javascript hljs">test/components/Results_spec.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { renderIntoDocument, scryRenderedDOMComponentsWithClass, Simulate } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-addons-test-utils'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {List, <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Results} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../src/components/Results'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {expect} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'chai'</span></span>;</code> </pre><br>       React-  Redux-,       . <br><br>    ,        ,        .              . <br><br>    ,   ,       .       ,           .   ,         ,     ,     .          ¬´¬ª. <br><br> ,         Redux.  <code>App.jsx</code>      ,    : <br><br><pre> <code class="javascript hljs">src/components/App.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> React.createClass({ <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.children; } });</code> </pre><br><a name="5-8"></a><h2>  5.8.   Socket.io </h2><br>       Redux-,       Redux-.          ,      . <br><br>       socket-     .     Redux-,       .    . <br><br>   .    Socket.io-    .    <a href="http://socket.io/docs/client-api/"> socket.io-client</a> ,    ,     : <br><br><pre> <code class="bash hljs">npm install --save socket.io-client</code> </pre><br>       <code>io</code> ,        Socket.io.    8090 (    ): <br><br><pre> <code class="javascript hljs">src/index.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Router, Route, hashHistory} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {createStore} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Provider} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> io <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'socket.io-client'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> reducer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./reducer'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/App'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {VotingContainer} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/Voting'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {ResultsContainer} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/Results'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = createStore(reducer); store.dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'SET_STATE'</span></span>, <span class="hljs-attr"><span class="hljs-attr">state</span></span>: { <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: { <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: [<span class="hljs-string"><span class="hljs-string">'Sunshine'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>], <span class="hljs-attr"><span class="hljs-attr">tally</span></span>: {<span class="hljs-attr"><span class="hljs-attr">Sunshine</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>} } } }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> socket = io(<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${location.protocol}</span></span></span><span class="hljs-string">//</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${location.hostname}</span></span></span><span class="hljs-string">:8090`</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> routes = &lt;Route component={App}&gt; &lt;Route path="/results" component={ResultsContainer} /&gt; &lt;Route path="/" component={VotingContainer} /&gt; &lt;/Route&gt;; ReactDOM.render( &lt;Provider store={store}&gt; &lt;Router history={hashHistory}&gt;{routes}&lt;/Router&gt; &lt;/Provider&gt;, document.getElementById('app') );</code> </pre><br> ,   ,         .    WebSocket-,      Socket.io. <br><br>          Socket.io-:  ,      Webpack-. <br><br><a name="5-9"></a><h2>  5.9.  actions   </h2><br>     Socket.io   .           <code>state</code> ,    .          <code>SET_STATE</code> .       reducer: <br><br><pre> <code class="javascript hljs">src/index.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Router, Route, hashHistory} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {createStore} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Provider} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> io <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'socket.io-client'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> reducer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./reducer'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/App'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {VotingContainer} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/Voting'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {ResultsContainer} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/Results'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = createStore(reducer); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> socket = io(<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${location.protocol}</span></span></span><span class="hljs-string">//</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${location.hostname}</span></span></span><span class="hljs-string">:8090`</span></span>); socket.on(<span class="hljs-string"><span class="hljs-string">'state'</span></span>, state =&gt; store.dispatch({<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'SET_STATE'</span></span>, state}) ); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> routes = &lt;Route component={App}&gt; &lt;Route path="/results" component={ResultsContainer} /&gt; &lt;Route path="/" component={VotingContainer} /&gt; &lt;/Route&gt;; ReactDOM.render( &lt;Provider store={store}&gt; &lt;Router history={hashHistory}&gt;{routes}&lt;/Router&gt; &lt;/Provider&gt;, document.getElementById('app') );</code> </pre><br>  ,      <code>SET_STATE</code> .     ,       . <br><br>    ‚Äî   :      ,   .      ! <br><br><a name="5-10"></a><h2>  5.10.  actions  React- </h2><br>  ,     <i></i>   Redux store.        <i></i> . <br><br>      .     ,   <code>Voting</code>    <code>vote</code> ,    callback-.   ,     .        ,    . <br><br>   ,     - ? ,        .      ,      :     <code>hasVoted</code> ,         - . <br><br>  <code>SET_STATE</code>      Redux action ‚Äî <code>VOTE</code> .    <code>hasVoted</code>  : <br><br><pre> <code class="javascript hljs">test/reducer_spec.js it(<span class="hljs-string"><span class="hljs-string">' VOTE    hasVoted'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> state = fromJS({ <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: { <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: [<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>], <span class="hljs-attr"><span class="hljs-attr">tally</span></span>: {<span class="hljs-attr"><span class="hljs-attr">Trainspotting</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>} } }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> action = {<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'VOTE'</span></span>, <span class="hljs-attr"><span class="hljs-attr">entry</span></span>: <span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> nextState = reducer(state, action); expect(nextState).to.equal(fromJS({ <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: { <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: [<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>], <span class="hljs-attr"><span class="hljs-attr">tally</span></span>: {<span class="hljs-attr"><span class="hljs-attr">Trainspotting</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>} }, <span class="hljs-attr"><span class="hljs-attr">hasVoted</span></span>: <span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span> })); });</code> </pre><br>    <i> </i>    ,   VOTE  -    ,        : <br><br><pre> <code class="javascript hljs">test/reducer_spec.js it(<span class="hljs-string"><span class="hljs-string">'      hasVoted  VOTE'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> state = fromJS({ <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: { <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: [<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>], <span class="hljs-attr"><span class="hljs-attr">tally</span></span>: {<span class="hljs-attr"><span class="hljs-attr">Trainspotting</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>} } }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> action = {<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'VOTE'</span></span>, <span class="hljs-attr"><span class="hljs-attr">entry</span></span>: <span class="hljs-string"><span class="hljs-string">'Sunshine'</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> nextState = reducer(state, action); expect(nextState).to.equal(fromJS({ <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: { <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: [<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>], <span class="hljs-attr"><span class="hljs-attr">tally</span></span>: {<span class="hljs-attr"><span class="hljs-attr">Trainspotting</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>} } })); });</code> </pre><br>   reducer-a    : <br><br><pre> <code class="javascript hljs">src/reducer.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {<span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, newState</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state.merge(newState); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vote</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, entry</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> currentPair = state.getIn([<span class="hljs-string"><span class="hljs-string">'vote'</span></span>, <span class="hljs-string"><span class="hljs-string">'pair'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentPair &amp;&amp; currentPair.includes(entry)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state.set(<span class="hljs-string"><span class="hljs-string">'hasVoted'</span></span>, entry); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = Map(</span></span></span><span class="hljs-function">), </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'SET_STATE'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> setState(state, action.state); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'VOTE'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vote(state, action.entry); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; }</code> </pre><br>  <code>hasVoted</code>      .        ,     .       <code>SET_STATE</code> , ,        ,     .   ,     <code>hasVoted</code> : <br><br><pre> <code class="javascript hljs">test/reducer_spec.js it(<span class="hljs-string"><span class="hljs-string">'  ,   hasVoted  SET_STATE'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initialState = fromJS({ <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: { <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: [<span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span>, <span class="hljs-string"><span class="hljs-string">'28 Days Later'</span></span>], <span class="hljs-attr"><span class="hljs-attr">tally</span></span>: {<span class="hljs-attr"><span class="hljs-attr">Trainspotting</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>} }, <span class="hljs-attr"><span class="hljs-attr">hasVoted</span></span>: <span class="hljs-string"><span class="hljs-string">'Trainspotting'</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> action = { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'SET_STATE'</span></span>, <span class="hljs-attr"><span class="hljs-attr">state</span></span>: { <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: { <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: [<span class="hljs-string"><span class="hljs-string">'Sunshine'</span></span>, <span class="hljs-string"><span class="hljs-string">'Slumdog Millionaire'</span></span>] } } }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> nextState = reducer(initialState, action); expect(nextState).to.equal(fromJS({ <span class="hljs-attr"><span class="hljs-attr">vote</span></span>: { <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: [<span class="hljs-string"><span class="hljs-string">'Sunshine'</span></span>, <span class="hljs-string"><span class="hljs-string">'Slumdog Millionaire'</span></span>] } })); });</code> </pre><br>      <code>resetVote</code>    <code>SET_STATE</code> : <br><br><pre> <code class="javascript hljs">src/reducer.js <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {List, <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, newState</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state.merge(newState); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vote</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, entry</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> currentPair = state.getIn([<span class="hljs-string"><span class="hljs-string">'vote'</span></span>, <span class="hljs-string"><span class="hljs-string">'pair'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentPair &amp;&amp; currentPair.includes(entry)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state.set(<span class="hljs-string"><span class="hljs-string">'hasVoted'</span></span>, entry); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resetVote</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> hasVoted = state.get(<span class="hljs-string"><span class="hljs-string">'hasVoted'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> currentPair = state.getIn([<span class="hljs-string"><span class="hljs-string">'vote'</span></span>, <span class="hljs-string"><span class="hljs-string">'pair'</span></span>], List()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasVoted &amp;&amp; !currentPair.includes(hasVoted)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state.remove(<span class="hljs-string"><span class="hljs-string">'hasVoted'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = Map(</span></span></span><span class="hljs-function">), </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'SET_STATE'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> resetVote(setState(state, action.state)); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'VOTE'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vote(state, action.entry); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; }</code> </pre><br>      <code>hasVoted</code>     .        . <br><br>     <code>hasVoted</code>   <code>Voting</code> : <br><br><pre> <code class="javascript hljs">src/components/Voting.jsx <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapStateToProps</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">pair</span></span>: state.getIn([<span class="hljs-string"><span class="hljs-string">'vote'</span></span>, <span class="hljs-string"><span class="hljs-string">'pair'</span></span>]), <span class="hljs-attr"><span class="hljs-attr">hasVoted</span></span>: state.get(<span class="hljs-string"><span class="hljs-string">'hasVoted'</span></span>), <span class="hljs-attr"><span class="hljs-attr">winner</span></span>: state.get(<span class="hljs-string"><span class="hljs-string">'winner'</span></span>) }; }</code> </pre><br>    -   <code>Voting vote</code> callback,       . <code>Voting</code>       actions  Redux,    <code>connect</code>  react-redux. <br><br> react-redux      <i> ,    </i> .         Redux: <i>  (Action creators)</i> . <br><br>    ,   Redux    ,  ( )  <code>type</code>    .           .        : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vote</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">entry</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'VOTE'</span></span>, entry}; }</code> </pre><br>     ¬´ ¬ª.    ,      .          ,           .         ,       .      ,           . <br><br>   ,          : <br><br><pre> <code class="javascript hljs">src/action_creators.js <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'SET_STATE'</span></span>, state }; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vote</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">entry</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'VOTE'</span></span>, entry }; }</code> </pre><br>        .      ,      .   ,   . <br><br>    <code>index.jsx</code>  Socket.io-       <code>setState</code> : <br><br><pre> <code class="javascript hljs">src/index.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Router, Route, hashHistory} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {createStore} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Provider} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> io <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'socket.io-client'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> reducer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./reducer'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {setState} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./action_creators'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/App'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {VotingContainer} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/Voting'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {ResultsContainer} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/Results'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = createStore(reducer); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> socket = io(<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${location.protocol}</span></span></span><span class="hljs-string">//</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${location.hostname}</span></span></span><span class="hljs-string">:8090`</span></span>); socket.on(<span class="hljs-string"><span class="hljs-string">'state'</span></span>, state =&gt; store.dispatch(setState(state)) ); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> routes = &lt;Route component={App}&gt; &lt;Route path="/results" component={ResultsContainer} /&gt; &lt;Route path="/" component={VotingContainer} /&gt; &lt;/Route&gt;; ReactDOM.render( &lt;Provider store={store}&gt; &lt;Router history={hashHistory}&gt;{routes}&lt;/Router&gt; &lt;/Provider&gt;, document.getElementById('app') );</code> </pre><br>       ,  react-redux    React-.    callback- <code>vote</code>  <code>Voting</code>    vote.  ,    :  ,  ,   .           <code>connect</code>  react-redux    : <br><br><pre> <code class="javascript hljs">src/components/Voting.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PureRenderMixin <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-addons-pure-render-mixin'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {connect} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Winner <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./Winner'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Vote <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./Vote'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> actionCreators <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../action_creators'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Voting = React.createClass({ <span class="hljs-attr"><span class="hljs-attr">mixins</span></span>: [PureRenderMixin], <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &lt;div&gt; {this.props.winner ? &lt;Winner ref="winner" winner={this.props.winner} /&gt; : &lt;Vote {...this.props} /&gt;} &lt;/div&gt;; } }); function mapStateToProps(state) { return { pair: state.getIn(['vote', 'pair']), hasVoted: state.get('hasVoted'), winner: state.get('winner') }; } export const VotingContainer = connect( mapStateToProps, actionCreators )(Voting);</code> </pre><br>    <code>vote</code>    <code>Voting</code> .     ,      vote,      Redux Store.          !      :      . <br><br><a name="5-11"></a><h2>  5.11.       Redux Middleware </h2><br>       ‚Äî     .          ‚ÄúNext‚Äù   . <br><br>   .     ? <br><br><ul><li>   ,   <code>VOTE</code>     Redux store. </li><li>  <code>VOTE</code>   reducer-     <code>hasVoted</code> . </li><li>     actions    Socket.io- <code>action</code> .        Redux Store. </li><li>  <code>VOTE</code>   reducer-     . </li></ul><br> ,     ,  .         <code>VOTE</code> ,     <i></i> Redux stores.    . <br><br>  Where to begin?  Redux     ,             .     ,       . <br><br> Redux      actions,   redux store ‚Äî <a href="http://rackt.github.io/redux/docs/advanced/Middleware.html">Middleware</a> . <br><br> Middleware () ‚Äî  ,        ,      reducer  store. Middleware     ,        ,           store.         actions  . <br><br>      middleware  listeners: <br><br><ul><li>    ,     store,      . </li><li>     ,         . </li></ul><br>     . <br><br>  remote action middleware,     Socket.io-        store,    . <br><br>    middleware.  ,   Redux store    ,  callback ¬´next¬ª.     <i></i> ,  Redux action.        middleware: <br><br><pre> <code class="bash hljs">src/remote_action_middleware.js <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> default store =&gt; next =&gt; action =&gt; { }</code> </pre><br>       ,      : <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> default <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(store) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(next) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(action) { } } }</code> </pre><br>       <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B0%25D1%2580%25D1%2580%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5"></a> .        :         ( <code>function(store, next, action) { }</code> ),          .             ,  ¬´¬ª,  <code>store</code>  . <br><br>        <code>next</code> .  callback,    middleware   ,    <code>action</code>  store (  middleware): <br><br><pre> <code class="bash hljs">src/remote_action_middleware.js <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> default store =&gt; next =&gt; action =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> next(action); }</code> </pre><br>    <i> </i> <code>next</code> ,     .        reducer  store. <br><br>  -   middleware,  ,   : <br><br><pre> <code class="bash hljs">src/remote_action_middleware.js <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> default store =&gt; next =&gt; action =&gt; { console.log(<span class="hljs-string"><span class="hljs-string">'in middleware'</span></span>, action); <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> next(action); }</code> </pre><br>    middleware   Redux store,     .  middleware    Redux  <code>applyMiddleware</code> .   middleware,    ,   , ,   ,   <code>createStore</code> .        store      middleware: <br><br><pre> <code class="bash hljs">src/components/index.jsx import React from <span class="hljs-string"><span class="hljs-string">'react'</span></span>; import ReactDOM from <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span>; import {Router, Route, hashHistory} from <span class="hljs-string"><span class="hljs-string">'react-router'</span></span>; import {createStore, applyMiddleware} from <span class="hljs-string"><span class="hljs-string">'redux'</span></span>; import {Provider} from <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span>; import io from <span class="hljs-string"><span class="hljs-string">'socket.io-client'</span></span>; import reducer from <span class="hljs-string"><span class="hljs-string">'./reducer'</span></span>; import {setState} from <span class="hljs-string"><span class="hljs-string">'./action_creators'</span></span>; import remoteActionMiddleware from <span class="hljs-string"><span class="hljs-string">'./remote_action_middleware'</span></span>; import App from <span class="hljs-string"><span class="hljs-string">'./components/App'</span></span>; import {VotingContainer} from <span class="hljs-string"><span class="hljs-string">'./components/Voting'</span></span>; import {ResultsContainer} from <span class="hljs-string"><span class="hljs-string">'./components/Results'</span></span>; const createStoreWithMiddleware = applyMiddleware( remoteActionMiddleware )(createStore); const store = createStoreWithMiddleware(reducer); const socket = io(`<span class="hljs-variable"><span class="hljs-variable">${location.protocol}</span></span>//<span class="hljs-variable"><span class="hljs-variable">${location.hostname}</span></span>:8090`); socket.on(<span class="hljs-string"><span class="hljs-string">'state'</span></span>, state =&gt; store.dispatch(setState(state)) ); const routes = &lt;Route component={App}&gt; &lt;Route path=<span class="hljs-string"><span class="hljs-string">"/results"</span></span> component={ResultsContainer} /&gt; &lt;Route path=<span class="hljs-string"><span class="hljs-string">"/"</span></span> component={VotingContainer} /&gt; &lt;/Route&gt;; ReactDOM.render( &lt;Provider store={store}&gt; &lt;Router <span class="hljs-built_in"><span class="hljs-built_in">history</span></span>={hashHistory}&gt;{routes}&lt;/Router&gt; &lt;/Provider&gt;, document.getElementById(<span class="hljs-string"><span class="hljs-string">'app'</span></span>) );</code> </pre><br>       .      API Redux. <br><br> ,    ,  ,  middleware    actions:   <code>SET_STATE</code> ,     ‚Äî <code>VOTE</code> . <br><br> Middleware      Socket.io-    middleware.        .       <code>index.jsx</code> ,    middleware .           middleware.      Socket.io: <br><br><pre> <code class="javascript hljs">src/remote_action_middleware.js <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> socket =&gt; <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">store</span></span></span><span class="hljs-function"> =&gt;</span></span> next =&gt; <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">action</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'in middleware'</span></span>, action); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> next(action); }</code> </pre><br><pre> <code class="javascript hljs">src/index.jsx <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> socket = io(<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${location.protocol}</span></span></span><span class="hljs-string">//</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${location.hostname}</span></span></span><span class="hljs-string">:8090`</span></span>); socket.on(<span class="hljs-string"><span class="hljs-string">'state'</span></span>, state =&gt; store.dispatch(setState(state)) ); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> createStoreWithMiddleware = applyMiddleware( remoteActionMiddleware(socket) )(createStore); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = createStoreWithMiddleware(reducer);</code> </pre><br><br>  ,         store:    ,        store. <br><br>  ,  middleware   <code>action</code> : <br><br><pre> <code class="javascript hljs">src/remote_action_middleware.js <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> socket =&gt; <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">store</span></span></span><span class="hljs-function"> =&gt;</span></span> next =&gt; <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">action</span></span></span><span class="hljs-function"> =&gt;</span></span> { socket.emit(<span class="hljs-string"><span class="hljs-string">'action'</span></span>, action); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> next(action); }</code> </pre><br>  That's all!                  .        ,     .  ! <br><br>     :           <code>SET_STATE</code> ,     .         ,       ,   <code>SET_STATE</code> .   . <br><br> Middleware  action       .   ,  SET_STATE,   ,  .        ,   <code>{meta: {remote: true}}</code> : <br><br> (     rafScheduler  <a href="http://rackt.github.io/redux/docs/advanced/Middleware.html"> middleware</a> ) <br><br><pre> <code class="javascript hljs">src/remote_action_middleware.js <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> socket =&gt; <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">store</span></span></span><span class="hljs-function"> =&gt;</span></span> next =&gt; <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">action</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (action.meta &amp;&amp; action.meta.remote) { socket.emit(<span class="hljs-string"><span class="hljs-string">'action'</span></span>, action); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> next(action); }</code> </pre><br>        <code>VOTE</code> ,  <i> </i>  <code>SET_STATE</code> : <br><br><pre> <code class="javascript hljs">src/action_creators.js <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'SET_STATE'</span></span>, state }; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vote</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">entry</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">meta</span></span>: {<span class="hljs-attr"><span class="hljs-attr">remote</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'VOTE'</span></span>, entry }; }</code> </pre><br>  : <br><br><ol><li>    .   VOTE. </li><li> Middleware    action  Socket.io-. </li><li>    Redux store,       <code>hasVote</code> . </li><li>     ,   Redux store  action      . </li><li>     store      . </li><li>  Redux store       <code>SET_STATE</code> . </li><li>        . </li></ol><br>          ‚ÄúNext‚Äù.      ,     .       . <br><br>    <code>NEXT</code>      : <br><br><pre> <code class="javascript hljs">src/action_creator.js <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'SET_STATE'</span></span>, state }; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vote</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">entry</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">meta</span></span>: {<span class="hljs-attr"><span class="hljs-attr">remote</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'VOTE'</span></span>, entry }; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">meta</span></span>: {<span class="hljs-attr"><span class="hljs-attr">remote</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'NEXT'</span></span> }; }</code> </pre><br>         <code>ResultsContainer</code> : <br><br><pre> <code class="javascript hljs">src/components/Results.jsx <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PureRenderMixin <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-addons-pure-render-mixin'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {connect} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Winner <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./Winner'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> actionCreators <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../action_creators'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Results = React.createClass({ <span class="hljs-attr"><span class="hljs-attr">mixins</span></span>: [PureRenderMixin], <span class="hljs-attr"><span class="hljs-attr">getPair</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.pair || []; }, <span class="hljs-attr"><span class="hljs-attr">getVotes</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">entry</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.tally &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.tally.has(entry)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.tally.get(entry); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }, <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.winner ? <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Winner</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"winner"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">winner</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.props.winner}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> : </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"results"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"tally"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {this.getPair().map(entry =&gt; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{entry}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"entry"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{entry}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"voteCount"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {this.getVotes(entry)} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> )} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"management"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"next"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"next"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{this.props.next}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Next </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">; } }); function mapStateToProps(state) { return { pair: state.getIn(['vote', 'pair']), tally: state.getIn(['vote', 'tally']), winner: state.get('winner') } } export const ResultsContainer = connect( mapStateToProps, actionCreators )(Results);</span></span></code> </pre><br> ‚Ä¶   !       .            .  ,            .  .    ¬´Next¬ª     ,      . <br><br><a name="6"></a><h1> 6.  </h1><br>      ,       Redux,     .           . <br><br> 1.    <br>      ,        .       ,   . <br><br> <a href="https://github.com/teropa/redux-voting-server/commit/exercise-1"> </a> . <br><br> 2.     <br>      ,     ,     hasVoted.    :      ,           ,     .       ,    . <br><br>   ,        ,       . <br><br> <i>:</i>      .    ,     .       ,      . <br><br>   <a href="https://github.com/teropa/redux-voting-server/commit/exercise-2"> </a>  <a href="https://github.com/teropa/redux-voting-client/commit/exercise-2"> </a> . <br><br> 3.    <br>           .   ,    .  . <br><br> <i>:</i>       ,    ,     .      ,        .       ,         . <br><br>   <a href="https://github.com/teropa/redux-voting-server/commit/exercise-4"> </a>  <a href="https://github.com/teropa/redux-voting-client/commit/exercise-4"> </a> . <br><br> 4.   <br>     ,       . <br><br> <i>:</i>        ,      . <br><br>   <a href="https://github.com/teropa/redux-voting-server/commit/exercise-4"> </a>  <a href="https://github.com/teropa/redux-voting-client/commit/exercise-4"> </a> . <br><br> 5.     <br>      Socket.io  .   ,        . <br><br> <i>:</i>     Socket.io   ,     Redux-  . <br><br> <a href="https://github.com/teropa/redux-voting-client/commit/exercise-5"> </a> . <br><br>  :     (Peer to Peer) <br>      ,   ,    .     ,     reducer-      reducer   ,    .     ,       . <br><br>   ,       ,      ?       ?       P2P   WebRTC? ( <a href="http://socket.io/blog/socket-io-p2p/">Socket.io P2P</a> ) </div><p>Source: <a href="https://habr.com/ru/post/303456/">https://habr.com/ru/post/303456/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../303442/index.html">We write an application for analyzing tweets in real-time mode in 30 minutes</a></li>
<li><a href="../303446/index.html">Let's see DNS</a></li>
<li><a href="../303448/index.html">Another 0day vulnerability found in Adobe Flash Player</a></li>
<li><a href="../303450/index.html">High-Density WiFi. Part 3: About technology. Part 4: About Money</a></li>
<li><a href="../303452/index.html">Report from Moscow Data Science Meetup May 27</a></li>
<li><a href="../303458/index.html">Ranking Quality Metrics</a></li>
<li><a href="../303462/index.html">The first 10 minutes on the server</a></li>
<li><a href="../303464/index.html">10 ways to abuse employees of their official position and methods of dealing with them using the accounting system</a></li>
<li><a href="../303466/index.html">IntelliJ IDEA 2016.2 Public Preview Review</a></li>
<li><a href="../303468/index.html">Experiments with Arduino 101</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>