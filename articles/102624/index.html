<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Firefox 4: Draw arbitrary elements as backgrounds with -moz-element</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Paul Rouget: This is a blog of our guest, Marcus Stange. Marcus is usually working on implementing the Firefox theme for Macs, but this time he made a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Firefox 4: Draw arbitrary elements as backgrounds with -moz-element</h1><div class="post__text post__text-html js-mediator-article"><blockquote><blockquote><blockquote>  <sub><i><b>Paul Rouget:</b> This is a blog of our guest, Marcus Stange.</i></sub>  <sub><i>Marcus is usually working on implementing the Firefox theme for Macs, but this time he made a small detour through the prototyping engine in Gecko, implementing <b>-moz-element</b> .</i></sub> </blockquote></blockquote></blockquote><br>  In the fourth beta version of the new Firefox, we present you with a new extension of the <nobr>CSS</nobr> <b>background-image</b> <nobr>properties</nobr> : the ability to draw arbitrary elements as backgrounds using <b>-moz-element (#elementID)</b> . <blockquote>  &lt;p id = "myBackground1" style = "background: darkorange; color: white; width: 300px; height: 40px;"&gt; <br>  This element will be used as a background. <br>  &lt;! - This element will serve as a background.  -&gt; <br>  &lt;/ p&gt; <br>  &lt;p style = "background: -moz-element (# myBackground1); padding: 20px 10px; font-weight: bold;"&gt; <br>  This box uses # myBackground1 as its background! <br>  &lt;! - This rectangle uses # myBackground1 as background!  -&gt; <br>  &lt;/ p&gt; </blockquote> <a href="http://hacks.mozilla.org/wp-content/uploads/2010/08/basicexample.html" title="show example"><img src="http://hacks.mozilla.org/wp-content/uploads/2010/08/basicexamplescreenshot.png" alt="[ ]" title="show example"></a> <br><br>  The <b>-moz-element ()</b> image works exactly the same as the usual <b>url ()</b> image.  This means that it is controlled by all the usual background properties: <b>background-position</b> , <b>background-repeat</b> , and even <a href="http://hacks.mozilla.org/2009/12/css-backgrounds-firefox-36/"><b>background-size</b></a> . <br><br>  Using the <b>background-size</b> , you can create a <i>thumbnail of</i> the element that is used as the background ‚Äî an example: <a name="habracut"></a><blockquote>  &lt;ul id = "thumbnails"&gt; <br>  &lt;li style = "background-image: -moz-element (# slide-0)"&gt; &lt;/ li&gt; <br>  &lt;li style = "background-image: -moz-element (# slide-1)"&gt; &lt;/ li&gt; <br>  &lt;li style = "background-image: -moz-element (# slide-2)"&gt; &lt;/ li&gt; <br>  &lt;li style = "background-image: -moz-element (# slide-3)"&gt; &lt;/ li&gt; <br>  &lt;/ ul&gt; </blockquote><blockquote>  #thumbnails li { <br>  width: 160px; <br>  height: 120px; <br>  background-repeat: no-repeat; <br>  background-size: contain; <br>  } </blockquote> <a href="http://hacks.mozilla.org/wp-content/uploads/2010/08/thumbnails.html" title="show example"><img src="http://hacks.mozilla.org/wp-content/uploads/2010/08/thumbnailscreenshot.png" alt="[ ]" title="show example"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Keep in mind three things <nobr>about</nobr> <b>-moz-element</b> : <ol><li>  The background is <b>alive</b> : whatever happens in the element specified by the <b>-moz-element</b> property, the background will reflect its changes.  It will also display text selection with the cursor, blinking of the text cursor, and so on. </li><li>  The background is <b>just an appearance.</b>  It can not zhmyaknut mouse and get to the element of the original source of the image.  So it is arranged. </li><li>  The background can be done <b>any</b> element of HTML.  <nobr>Even</nobr> <b>&lt;iframe&gt;</b> : <br><br> <a href="http://hacks.mozilla.org/wp-content/uploads/2010/08/iframe.html" title="show example"><img src="http://hacks.mozilla.org/wp-content/uploads/2010/08/iframescreenshot.png" alt="[ ]" title="show example"></a> <br><br>  Even <b>&lt;video&gt;</b> : <br><br> <a href="http://hacks.mozilla.org/wp-content/uploads/2010/08/video.html" title="show example"><img src="http://hacks.mozilla.org/wp-content/uploads/2010/08/videoscreenshot.png" alt="[ ]" title="show example"></a> <br><br>  And even the canvas <b>&lt;canvas&gt;</b> : <br><br> <a href="http://hacks.mozilla.org/wp-content/uploads/2010/08/canvas.html" title="show example"><img src="http://hacks.mozilla.org/wp-content/uploads/2010/08/canvasscreenshot.png" alt="[ ]" title="show example"></a> </li></ol>  Using canvas as a background can be useful in many applications.  For example, if you <a href="http://mezzoblue.github.com/PaintbrushJS/demo/">repaint the image of <nobr>CSS backgrounds</nobr> in a browser in sepia</a> , then you no longer need to re-encode the image processed on the canvas, <a href="http://www.w3.org/TR/html5/the-canvas-element.html">getting the "data:" URI</a> .  Instead, you can make the background image itself a canvas. <br><br>  Using a canvas as a background image <a href="http://webkit.org/blog/176/css-canvas-drawing/">also supports Webkit</a> , via <b>-webkit-canvas ()</b> . <br><br><h2>  Draw looping </h2><br>  A quick note about recursive references: if you try to <a href="http://hacks.mozilla.org/wp-content/uploads/2010/08/paintingloop.html">draw an element in this way, which is itself drawn with <b>-moz-element</b> ,</a> then the looping of the drawing will be detected and prevented.  So, if you want to paint the <a href="http://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25B2%25D1%2591%25D1%2580_%25D0%25A1%25D0%25B5%25D1%2580%25D0%25BF%25D0%25B8%25D0%25BD%25D1%2581%25D0%25BA%25D0%25BE%25D0%25B3%25D0%25BE">Sierpinski carpet</a> , you have to come up with another way. <br><br><h2>  Hiding the original element </h2><br>  Sometimes you may not want the original element to be visible - and leave only the <b>-moz-element</b> background visible.  And what then do you have to do?  Simply setting ‚Äú <b>display: none</b> ‚Äù or ‚Äú <b>visibility: hidden</b> ‚Äù to the source element will not work, since then there will be nothing to draw against the <b>-moz-element</b> background, and therefore it will become transparent. <br><br>  Instead, you need to prevent the element from being drawn on the screen without hiding it directly.  One possible way is to put this element inside another, and set this other ‚Äú <b>height: 0;</b>  <b>overflow: hidden;</b>  "In CSS. <br><br>  Three types of elements are exceptions to this rule: images, canvases, and videotapes.  These kinds of elements are <b>allowed to</b> have the " <b>display: none</b> " property <nobr>and</nobr> <b>still be</b> used <nobr>in</nobr> <b>-moz-element</b> .  Moreover, they may not even be contained in the DOM of the main document. <br><br>
<h2>  New DOM API: <br> <code>document.mozSetImageElement</code> </h2> <br>  We have added a new method to the <b>document</b> object: <b>document.mozSetImageElement ( <i>element_id</i> , <i>element</i> )</b> . <br><br>  Consider the following two lines of code: <blockquote>  var slide5 = document.getElementById ("slide-5"); <br>  document.mozSetImageElement ("current-slide", slide5); </blockquote>  Now all those elements that are endowed with the <b><nobr>background-image:</nobr> <nobr>-moz-element (# current-slide)</nobr></b> property will display the element having the <nobr>ID <b>slide-5</b> -</nobr> even if <b>there is</b> an element that has the <nobr>ID <b>current-slide</b> !</nobr> <br><br>  Calling <b>document.mozSetImageElement ("current-slide", null)</b> cancels the actual override. <br><br>  Such an API can come in handy in a variety of practical situations.  I indirectly mentioned one of them in the previous subsection: using <b>mozSetImageElement,</b> you can use canvases and images that are not part of the DOM tree: <blockquote>  var img = new Image (); <br>  img.src = "my_image.png"; <br>  document.mozSetImageElement ("image", img); <br><br>  var canvas = document.createElement ("canvas"); <br>  canvas.width = canvas.height = 100; <br>  var ctx = canvas.getContext ("2d"); <br>  // ... further we draw through ctx ... <br>  document.mozSetImageElement ("canvas", canvas); </blockquote>  ( <a href="http://hacks.mozilla.org/wp-content/uploads/2010/08/outofdomtree.html">show example</a> ) <br><br>  Another situation in which the <b>mozSetImageElement</b> call is useful is to create a library of javascript functions.  For example, you might get this function: <blockquote>  var runningNumber = 0; <br>  function addReflectionToElement (reflectedElement) { <br>  var referenceID = "reflected-element-" + runningNumber ++; <br>  var reflection = document.createElement ("div"); <br>  reflection.className = "reflection"; <br>  reflection.style.backgroundImage = <br>  "-moz-element (#" + referenceID + ")"; <br>  document.mozSetImageElement (referenceID, reflectedElement); <br>  // ... and now insert reflection into the DOM ... <br>  } </blockquote>  By following this way, you can reduce the side effect of using the library function: it will not have to manipulate the ID of the element that is transferred to it. <br><br>  Finally, <b>mozSetImageElement</b> also allows you to reference elements of other documents (for example, inside &lt;iframe&gt;);  at the same time, of course, the usual requirements for the interaction of documents (the unity of their origin) apply. <br><br><h2>  <code>-moz-element</code> for SVG rendering servers: patterns and gradients </h2><br>  If you finished writing SVG manually, then you probably know the concept of rendering servers ( <a href="http://www.w3.org/TR/SVG/pservers.html">paint servers</a> ): these are the elements, patterns <nobr>and / or</nobr> gradients that you have to specify in the <b>fill</b> <nobr>or <b>stroke</b></nobr> attributes when a single-color fill is not suitable.  Now they can also be used in the backgrounds of HTML elements using <nobr><b>-moz-element</b> :</nobr> <blockquote>  &lt;p style = "background: -moz-element (#pattern), <br>  -moz-element (#gradient); <br>  padding: 10px;  color: white "&gt; <br>  This element has both types of SVG paint servers <br>  in its background: a pattern and a gradient. <br>  &lt;! - The background of this element uses both types. <br>  SVG drawing servers: pattern and gradient.  -&gt; <br>  &lt;/ p&gt; <br><br>  &lt;svg height = "0"&gt; <br>  &lt;linearGradient id = "gradient" x2 = "0" y2 = "1"&gt; <br>  &lt;stop stop color = "black" offset = "0%" /&gt; <br>  &lt;stop stop-color = "red" offset = "100%" /&gt; <br>  &lt;/ linearGradient&gt; <br>  &lt;pattern id = "pattern" patternUnits = "userSpaceOnUse" <br>  width = "60" height = "60"&gt; <br>  &lt;circle fill = "black" fill-opacity = "0.5" <br>  cx = "30" cy = "30" r = "10" /&gt; <br>  &lt;/ pattern&gt; <br>  &lt;/ svg&gt; </blockquote> <a href="http://hacks.mozilla.org/wp-content/uploads/2010/08/svgpatterngradientexample.html" title="show example"><img src="http://hacks.mozilla.org/wp-content/uploads/2010/08/svgpatterngradient.png" alt="[ ]" title="show example"></a> <br><br>  Please note that thanks to our <a href="http://hacks.mozilla.org/2010/05/firefox-4-the-html5-parser-inline-svg-speed-and-more/">new HTML5 parser,</a> we don‚Äôt have to use XHTML in order for the implemented SVG code to work. <br><br>  The above feature duplicates the existing possibilities of <a href="http://hacks.mozilla.org/2009/11/css-gradients-firefox-36/">CSS gradients</a> and SVG illustrations, but it is also extremely useful in some situations, for example, in animations.  Suppose you need to create a process indicator, equipped with an animated gradient, like this: <br><br><img src="http://hacks.mozilla.org/wp-content/uploads/2010/08/flowinggradient.gif" alt="[process indicator]"><br><br>  You could achieve the desired using a CSS gradient and some javascript that periodically updates the <b>background-position</b> property.  However, you could also use an SVG gradient animated by SMIL, and therefore not requiring any javascript at all: <blockquote>  &lt;div <br>  style = "background: -moz-element (# animated-gradient);"&gt; <br>  &lt;/ div&gt; <br><br>  &lt;svg height = "0"&gt; <br><br>  &lt;linearGradient id = "animated-gradient" spreadMethod = "reflect" <br>  gradientUnits = "userSpaceOnUse" <br>  x1 = "16" x2 = "24" y2 = "0"&gt; <br>  &lt;animate attributeName = "x1" values ‚Äã‚Äã= "16; 0" dur = "350ms" <br>  repeatCount = "indefinite" /&gt; <br>  &lt;animate attributeName = "x2" values ‚Äã‚Äã= "24; 8" dur = "350ms" <br>  repeatCount = "indefinite" /&gt; <br><br>  &lt;stop stop-color = "# 0F0" offset = "0" /&gt; <br>  &lt;stop stop-color = "# 0D0" offset = "100%" /&gt; <br>  &lt;/ linearGradient&gt; <br><br>  &lt;/ svg&gt; </blockquote>  ( <a href="http://hacks.mozilla.org/wp-content/uploads/2010/08/flowinggradient.html">show example</a> ) <br><br>  The same can be achieved <nobr>with CSS animations,</nobr> however, until they are implemented in Gecko, you can follow the above described path. <br><br>  Support for SVG images as CSS backgrounds ( <a href="https://bugzilla.mozilla.org/show_bug.cgi%3Fid%3D276431">bug 276431</a> ) will also be provided soon. <br><br>  And here's another example: <a href="http://hacks.mozilla.org/wp-content/uploads/2010/08/pacman.html">Pacman on CSS and SVG</a> . <br><br><h2>  Applications </h2><br>  I have a couple more suggestions for using <nobr><b>-moz-element</b> :</nobr> <br><br><h3>  Reflections </h3><br>  What is reflection? <blockquote>  #reflection { <br>  / * Reflection is a copy of the original element ... * / <br>  background: -moz-element (# reflected-element) <br>  bottom left no-repeat; <br><br>  / * ... reflected from top to bottom ... * / <br>  -moz-transform: scaleY (-1); <br><br>  / * ... and with gradual darkening from top to bottom.  * / <br>  mask: url (# reflection-mask); <br>  } </blockquote> <a href="http://hacks.mozilla.org/wp-content/uploads/2010/08/reflection1.html" title="show example"><img src="http://hacks.mozilla.org/wp-content/uploads/2010/08/reflectionscreenshot.png" alt="[ ]" title="show example"></a> <br><br>  Since we can apply any style to the reflection, we can generate effects like <a href="http://hacks.mozilla.org/wp-content/uploads/2010/08/reflectionwithwaterripples.html">animated circles on the water</a> . <br><br><h3>  Elegant transitions between slides </h3><br>  In this demo, I want to achieve such a spectacular transition between adjacent slides, which looks as if the top half of the previous slide was wrapped down, opening the next slide below it: <blockquote>  <sub>At this place in the Mozilla Hacks blog there is a video, connected by the &lt;video&gt; element, so it will not work to show it on Habrahabr.</sub> </blockquote>  How would you implement this idea?  Sure, it would take <nobr>some kind of</nobr> conversion, but the transformation of which particular element?  The upper half of the slide requires a different transformation than the bottom, so simply applying the conversion to the entire slide will fail. <br><br>  As a result, I created four new elements (#previousUpper, #previousLower, #nextUpper and #nextLower) and placed them in a separate container (called #transition), which becomes visible only during the transition from slide to slide.  Then I assign the correct dimensions to them and impose the appropriate part of the image from the previous or next slide, using <b>background-image: -moz-element (# previous / nextSlide)</b> and the correct value of the <b>background-position</b> property.  And then I put the desired transformation on these auxiliary elements. <br><br>  The code for this example is quite complicated, really ... - so I‚Äôll just take you <a href="http://hacks.mozilla.org/wp-content/uploads/2010/08/tada.html">to the final demonstration of it</a> . <br><br><h3>  Still? </h3><br>  I have now run out of ideas for the <nobr><b>-moz-element</b></nobr> examples <nobr>,</nobr> although, of course, there is still a lot to be done with this property.  Now it's your turn! <br><br><h2>  Acknowledgments </h2><br>  <a href="http://weblogs.mozillazine.org/roc/">Robert O'Callahan</a> , who prepared the <a href="http://weblogs.mozillazine.org/roc/archives/2008/07/the_latest_feat.html">initial</a> <a href="http://weblogs.mozillazine.org/roc/archives/2008/06/applying_svg_ef.html">implementation</a> back in 2008, deserves most of this thanks.  After his initial experiments, however, he had to work closely on more important matters, so that the patches lay inactive for almost a year, until (in April 2009) he started a <a href="http://groups.google.com/group/mozilla.dev.platform/browse_thread/thread/d58cbafa83471800/b4b5ab1849ffe3af">discussion in the newsgroup</a> about what should be a suitable API.  Shortly thereafter, Ryo Kawaguchi <a href="https://bugzilla.mozilla.org/show_bug.cgi%3Fid%3D506826">revived the works of Robert</a> and devoted all his last weeks of his <a href="http://blog.mozilla.com/interns/2009/09/13/ryo-kawaguchi/">internship in Mozille</a> to them.  A year later, I prepared this patch for review <i>(review)</i> and conducted it through the final stages, up to the inclusion in the Firefox code. <br><br>  Finally, I <a href="http://hacks.mozilla.org/2010/08/more-efficient-javascript-animations-with-mozrequestanimationframe/">‚Äôll explain the</a> same warning that <a href="http://hacks.mozilla.org/2010/08/more-efficient-javascript-animations-with-mozrequestanimationframe/">mozRequestAnimationFrame</a> concerned: <nobr>both <b>-moz-element</b></nobr> <nobr>and <b>document.mozSetImageElement</b></nobr> are experimental APIs.  We do not guarantee their endless support, and we do not advocate their use.  We implemented them so that people could experiment with them, and we would receive feedback.  We will offer these APIs as a standard (but without the ‚Äúmoz‚Äù prefix, of course), so feedback on our implementation will help us improve the future standard. </div><p>Source: <a href="https://habr.com/ru/post/102624/">https://habr.com/ru/post/102624/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../102614/index.html">The UVB-76 station gave the fourth signal in 30 years</a></li>
<li><a href="../102616/index.html">Questions for an interview with Edward Shishkin</a></li>
<li><a href="../102617/index.html">Vobis Highscreen Nano - equipment and features</a></li>
<li><a href="../102619/index.html">Canon has released a 120-megapixel CMOS sensor</a></li>
<li><a href="../102620/index.html">Some obscure programming facts</a></li>
<li><a href="../102625/index.html">GPRS QoS - Myth or Reality?</a></li>
<li><a href="../102627/index.html">About bridges, telecoms and the price of the error</a></li>
<li><a href="../102628/index.html">Prototyping in Expression Blend + SketchFlow. Part 2. Basics</a></li>
<li><a href="../102630/index.html">Prototyping in Expression Blend + SketchFlow. Part 1. A bit of history</a></li>
<li><a href="../102634/index.html">A brain scan will help you choose a profession.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>