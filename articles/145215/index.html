<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Protecting the Apache web server from a slow-reading attack, as well as some other targeted attacks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings. 
 I want to share my experience in protecting the Apache web server from a slow read attack. The fact that this attack can be read here (En...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Protecting the Apache web server from a slow-reading attack, as well as some other targeted attacks</h1><div class="post__text post__text-html js-mediator-article">  Greetings. <br>  I want to share my experience in protecting the <a href="httpd.apache.org/">Apache</a> web server from a slow read attack.  The fact that this attack can be read <a href="https://community.qualys.com/blogs/securitylabs/2012/01/05/slow-read">here</a> (English), as well as <a href="http://habrahabr.ru/post/135817/">here</a> (Russian). <br><br>  The considered method allows you to secure the server using the extensions mod_evasive and mod_security, and most importantly - it takes less than half an hour to implement.  Setup was made on <a href="http://habrahabr.ru/post/142852/">Ubuntu version 12.04</a> + Apache 2.2.  Setting up for other versions of the web server, as well as for other operating systems, differs mainly in the installation features of software packages and, in fact, in the versions of the installed programs and modules for them. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/997/dcd/d7b/997dcdd7bc3d9fb82a497c28b4bc14c0.gif"><br><a name="habracut"></a><br>  <strong>Package installation</strong> <br>  Since the protected server is installed on Ubuntu, the installation of the necessary modules for Apache is performed with one command: <br><blockquote><code>sudo apt-get install libapache2-mod-evasive libapache-mod-security</code> <br> </blockquote><br>  The <a href="http://www.zdziarski.com/blog/%3Fpage_id%3D442">mod_evasive</a> package <a href="http://www.zdziarski.com/blog/%3Fpage_id%3D442">will</a> provide protection against <a href="http://www.google.ru/search%3Fq%3D%25D1%2587%25D1%2582%25D0%25BE%2B%25D1%2582%25D0%25B0%25D0%25BA%25D0%25BE%25D0%25B5%2Bddos">DDOS</a> <a href="http://ru.wikipedia.org/wiki/DoS-%25D0%25B0%25D1%2582%25D0%25B0%25D0%25BA%25D0%25B0">application-level flood attacks</a> , while <a href="http://www.modsecurity.org/" title="mod_security">mod_security</a> will protect against targeted attacks, including slow-reading attacks. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At its core, mod_security is an open source software firewall that protects a webserver, and is being developed by <a href="https://www.trustwave.com/spiderlabs/">Trustwave SpiderLabs</a> . <br><br>  <strong>Config mod_evasive</strong> <br>  For the module to work, you will need a folder to save logs with rights to write Apache (it is assumed that the web server is started from the user www-data): <br><blockquote> <code>sudo mkdir /var/log/mod_evasive <br> sudo chown www-data:www-data /var/log/mod_evasive/</code> <br> </blockquote><br>  Create a file with settings: <br><blockquote> <code>sudo nano /etc/apache2/conf.d/modevasive <br> &lt;ifmodule mod_evasive20.c&gt; <br> DOSHashTableSize 3097 <br> DOSPageCount 2 <br> DOSSiteCount 50 <br> DOSPageInterval 1 <br> DOSSiteInterval 1 <br> DOSBlockingPeriod 90 <br> DOSLogDir /var/log/mod_evasive <br> DOSEmailNotify EMAIL@DOMAIN.com <br> DOSWhitelist 127.0.0.1 <br> &lt;/ifmodule&gt;</code> </blockquote> <br>  Email must be replaced with the address of the recipient of information about the detected attack (to send letters, you need <a href="http://habrahabr.ru/post/49665/">sendmail</a> / <a href="http://habrahabr.ru/post/143570/">postfix</a> ). <br>  This completes the mod_evasive setting. <br><br>  <strong>Config mod_security</strong> <br>  Since mod_security is a firewall, it needs a set of rules to work. <br>  You can download the latest version of the rules from the <a href="http://sourceforge.net/projects/mod-security/files/modsecurity-crs/0-CURRENT/" title="Sourceforge">SourceForge</a> page.  In addition, it is possible to configure the automatic update of the rules, it is described in more detail <a href="https://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project">here</a> . <br>  In the downloaded archive you will find several folders.  We are interested in the basic rules that are in the base_rules folder. <br>  Create a folder for the rules, copy them from the downloaded from SourceForge and the unpacked file. <br><blockquote> <code>sudo mkdir /etc/apache2/mod_security_rules <br> sudo mv base_rules/* /etc/apache2/mod_security_rules <br> sudo chown -R root:root /etc/apache2/mod_security_rules</code> </blockquote> <br>  Create a configuration file for mod_security with the following contents: <br><blockquote> <code>sudo nano /etc/apache2/conf.d/modsecurity <br> &lt;ifmodule mod_security2.c&gt; <br> Include mod_security_rules/*.conf <br> SecWriteStateLimit 100 <br> &lt;/ifmodule&gt;</code> </blockquote> <br>  This config will connect the rules we have just copied, and in addition, it will set a limit on the number of threads for each individual IP that may be in <a href="">SERVER_BUSY_WRITE</a> mode, which will prevent the possibility of performing attacks like <a href="http://en.wikipedia.org/wiki/Slowloris">Slow Loris</a> / SlowHttp. <br><br>  For the 32-bit version of Ubuntu, the configuration ends here. <br>  In x64, there is a modsecurity bug related to the difference in paths to libraries, due to which libxml is not connected.  To fix the first thing you need to determine where your libxml2.so.2 library is located: <br><blockquote> <code>locate libxml2.so.2</code> </blockquote>  There are 2 options: /usr/lib/x86_64-linux-gnu/libxml2.so.2 or /usr/lib/i386-linux-gnu/libxml2.so.2.  Next, you need to edit the /etc/apache2/mods-enabled/mod-security.load file, replacing the path where the plug-in library with /usr/lib/libxml2.so.2 is located with the path to the library on your system. <br><br>  Make sure the modules are connected: <br><blockquote> <code>sudo a2enmod mod-evasive <br> sudo a2enmod mod-security</code> </blockquote> <br>  and restart Apache to use configs: <br><blockquote> <code>service apache2 restart</code> </blockquote> <br><br>  <strong>Testing</strong> <br>  For testing, use the <a href="httptest/" title="slowhttptest">slowhttptest</a> utility.  You can read about its setup and installation on the pages of the project, so let's get straight to the application: <br><blockquote> <code><a href="http://domain.com/"></a> slowhttptest -c 65539 -B -g -o my_server_stats -i 110 -r 200 -s 8192 -t FAKEVERB -u DOMAIN.COM -x 10 -p 3</code> </blockquote> <br>  If you believe the output of the program, then at the fifth second the server becomes unavailable: <br><blockquote> <code>Sat Jun 2 16:41:37 2012:slow HTTP test status on 5th second: <br> initializing: 0 <br> pending: 564 <br> connected: 217 <br> error: 0 <br> closed: 0 <br> service available: NO</code> </blockquote> <br>  But what I wrote in the Apache logs: <br><blockquote> <code>tail /var/log/apache2/error.log <br> [Sat Jun 02 16:41:38 2012] [warn] ModSecurity: Access denied with code 400. Too many threads [101] of 100 allowed in WRITE state from xxx.xxx.xxx.xxx - Possible DoS Consumption Attack [Rejected]</code> </blockquote> <br><br>  Thus, the server is no longer subject to the attack of slow reading and temporarily blocks the <a href="http://ru.wikipedia.org/wiki/IP-%25D0%25B0%25D0%25B4%25D1%2580%25D0%25B5%25D1%2581">IP address of the</a> users making the attack. <br><br>  The main advantages of this method of protection are: simplicity and speed of setup, use of OpenSource solutions. <br>  The weak point can be a distributed attack made from many different IP addresses. </div><p>Source: <a href="https://habr.com/ru/post/145215/">https://habr.com/ru/post/145215/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../145209/index.html">Swumanoid (SWimming hUMANOID robot)</a></li>
<li><a href="../145210/index.html">Joosy: An Alternative Approach to Browser Framework</a></li>
<li><a href="../145211/index.html">Helvetica and super heroes</a></li>
<li><a href="../145212/index.html">Laravel - PHP Framework for Artisans</a></li>
<li><a href="../145214/index.html">Creating multiple diagrams based on a single Entity Framework model in Visual Studio 2012</a></li>
<li><a href="../145216/index.html">Computex announced devices on Windows 8</a></li>
<li><a href="../145218/index.html">Firefox 13 released - with SPDY, new home page and tabs</a></li>
<li><a href="../145219/index.html">HP, IBM, Cisco and Hitachi blade server platforms comparison, part two: network infrastructure, management, server features, service and market share</a></li>
<li><a href="../145221/index.html">Forcing the capture of the roles of the deceased operations wizard</a></li>
<li><a href="../145222/index.html">Dedicated Internet backbone can connect BRICS countries, Africa and the USA</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>