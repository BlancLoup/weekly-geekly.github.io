<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Titanic on Kaggle: you do not finish reading this post until the end</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! 

 # {Data Science for newbies} 

 My name is Gleb Morozov, we are already familiar with the previous articles. Due to numerous requests, I ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Titanic on Kaggle: you do not finish reading this post until the end</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr! <br><img src="https://habrastorage.org/files/c3e/cde/5b7/c3ecde5b78cd41e89b09f79af46311bb.png"><br>  <b># {Data Science for newbies}</b> <br><br>  My name is Gleb Morozov, we are already familiar with the previous articles.  Due to numerous requests, I continue to describe the experience of my participation in educational projects of <a href="http://dscourse.mlclass.ru/">MLClass.ru</a> (by the way, who have not had time - you can still <a href="http://dscourse.mlclass.ru/">get the materials of past courses</a> before the end - this is probably the shortest and most practical course in data analysis that you can imagine) . <br><br>  This paper describes my attempt to create a model for predicting the surviving passengers of the Titanic.  The main task is training in the use of tools used in Data Science for data analysis and presentation of research results, <b>so this article will be very, very long</b> .  The focus is on <b>exploratory research</b> and on the creation and selection of predictors ( <b>feature engineering</b> ).  The model is created as part of the <b>Titanic: Machine Learning from Disaster</b> competition on the Kaggle website.  In my work I will use the language "R". <br><a name="habracut"></a><br><h3>  Prerequisites for creating a model </h3><br>  If you trust Wikipedia, then Titanic collided with an iceberg at 11:40 pm ship time, when the vast majority of passengers and ship crew were in their cabins.  Accordingly, the location of the cabins may have had an impact on the likelihood of survival, since  passengers of the lower decks, first, later learned about the collision and, accordingly, had less time to get to the upper deck.  And, secondly, they naturally had to get out of the ship‚Äôs premises longer.  Below are the schemes of the Titanic, indicating the decks and rooms. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/530/f91/bf0/530f91bf048d46b7ad9f53854d9af266.png"><br><br><img src="https://habrastorage.org/files/ddf/307/0c6/ddf3070c69e0450184e35790f72917d1.jpeg"><br><br>  The Titanic was a British ship, and according to the laws of Britain, the number of lifeboats that corresponded to the vessel‚Äôs displacement and not the passenger capacity had to be on the ship.  Titanic formally met these requirements and had 20 boats (14 with a capacity of 65 people, 2 - 40 people, 4 - 47 people), which were designed to load 1178 people, just 2208 people on Titanic.  Thus, knowing that there would not be enough boats for everyone, the captain of the Titanic Smith gave, after a collision with an iceberg, an order to take on boats only women and children.  However, team members did not always follow him. <br><br><h3>  Data acquisition </h3><br>  Kaggle provides data as two files in csv format: <br><br><ul><li>  train.csv (contains a sample of passengers with a known outcome, i.e. survived or not) </li><li>  test.csv (contains another sample of passengers without a dependent variable) </li></ul><br><br>  To get the data in R, I use the read_csv function from the readr package.  In comparison with the basic functions, this package provides a number of advantages, in particular: higher speed and clear names of parameters. <br><br><pre><code class="hljs lisp">require(<span class="hljs-name"><span class="hljs-name">readr</span></span>) data_train &lt;- read_csv(<span class="hljs-string"><span class="hljs-string">"train.csv"</span></span>) data_test &lt;- read_csv(<span class="hljs-string"><span class="hljs-string">"test.csv"</span></span>)</code> </pre> <br>  Let's see what we got: <br><br><pre> <code class="hljs smalltalk">str(data_train) ## <span class="hljs-type"><span class="hljs-type">Classes</span></span> <span class="hljs-string"><span class="hljs-string">'tbl_df'</span></span>, <span class="hljs-string"><span class="hljs-string">'tbl'</span></span> and <span class="hljs-string"><span class="hljs-string">'data.frame'</span></span>: <span class="hljs-number"><span class="hljs-number">891</span></span> obs. of <span class="hljs-number"><span class="hljs-number">12</span></span> variables: ## <span class="hljs-string"><span class="hljs-string">$ </span></span><span class="hljs-type"><span class="hljs-type">PassengerId</span></span>: int <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> ... ## <span class="hljs-string"><span class="hljs-string">$ </span></span><span class="hljs-type"><span class="hljs-type">Survived</span></span> : int <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> ... ## <span class="hljs-string"><span class="hljs-string">$ </span></span><span class="hljs-type"><span class="hljs-type">Pclass</span></span> : int <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> ... ## <span class="hljs-string"><span class="hljs-string">$ </span></span><span class="hljs-type"><span class="hljs-type">Name</span></span> : chr <span class="hljs-comment"><span class="hljs-comment">"Braund, Mr. Owen Harris"</span></span> <span class="hljs-comment"><span class="hljs-comment">"Cumings, Mrs. John Bradley (Florence Briggs Thayer)"</span></span> <span class="hljs-comment"><span class="hljs-comment">"Heikkinen, Miss. Laina"</span></span> <span class="hljs-comment"><span class="hljs-comment">"Futrelle, Mrs. Jacques Heath (Lily May Peel)"</span></span> ... ## <span class="hljs-string"><span class="hljs-string">$ </span></span><span class="hljs-type"><span class="hljs-type">Sex</span></span> : chr <span class="hljs-comment"><span class="hljs-comment">"male"</span></span> <span class="hljs-comment"><span class="hljs-comment">"female"</span></span> <span class="hljs-comment"><span class="hljs-comment">"female"</span></span> <span class="hljs-comment"><span class="hljs-comment">"female"</span></span> ... ## <span class="hljs-string"><span class="hljs-string">$ </span></span><span class="hljs-type"><span class="hljs-type">Age</span></span> : num <span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-number"><span class="hljs-number">38</span></span> <span class="hljs-number"><span class="hljs-number">26</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-type"><span class="hljs-type">NA</span></span> <span class="hljs-number"><span class="hljs-number">54</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span> ... ## <span class="hljs-string"><span class="hljs-string">$ </span></span><span class="hljs-type"><span class="hljs-type">SibSp</span></span> : int <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> ... ## <span class="hljs-string"><span class="hljs-string">$ </span></span><span class="hljs-type"><span class="hljs-type">Parch</span></span> : int <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ... ## <span class="hljs-string"><span class="hljs-string">$ </span></span><span class="hljs-type"><span class="hljs-type">Ticket</span></span> : chr <span class="hljs-comment"><span class="hljs-comment">"A/5 21171"</span></span> <span class="hljs-comment"><span class="hljs-comment">"PC 17599"</span></span> <span class="hljs-comment"><span class="hljs-comment">"STON/O2. 3101282"</span></span> <span class="hljs-comment"><span class="hljs-comment">"113803"</span></span> ... ## <span class="hljs-string"><span class="hljs-string">$ </span></span><span class="hljs-type"><span class="hljs-type">Fare</span></span> : num <span class="hljs-number"><span class="hljs-number">7.25</span></span> <span class="hljs-number"><span class="hljs-number">71.28</span></span> <span class="hljs-number"><span class="hljs-number">7.92</span></span> <span class="hljs-number"><span class="hljs-number">53.1</span></span> <span class="hljs-number"><span class="hljs-number">8.05</span></span> ... ## <span class="hljs-string"><span class="hljs-string">$ </span></span><span class="hljs-type"><span class="hljs-type">Cabin</span></span> : chr <span class="hljs-comment"><span class="hljs-comment">""</span></span> <span class="hljs-comment"><span class="hljs-comment">"C85"</span></span> <span class="hljs-comment"><span class="hljs-comment">""</span></span> <span class="hljs-comment"><span class="hljs-comment">"C123"</span></span> ... ## <span class="hljs-string"><span class="hljs-string">$ </span></span><span class="hljs-type"><span class="hljs-type">Embarked</span></span> : chr <span class="hljs-comment"><span class="hljs-comment">"S"</span></span> <span class="hljs-comment"><span class="hljs-comment">"C"</span></span> <span class="hljs-comment"><span class="hljs-comment">"S"</span></span> <span class="hljs-comment"><span class="hljs-comment">"S"</span></span> ...</code> </pre><br><br><h3>  Data analysis </h3><br>  I believe that research data analysis is one of the most important parts of Data Scientist's work, because, apart from directly transforming ‚Äúraw‚Äù data into ready-made models, often during this process you can see hidden dependencies, thanks to which the most accurate models are obtained. <br><br>  First, look at the missing data.  In the data provided, a part of the missing information was marked with the symbol NA and, when loaded, were converted to the special symbol NA by default.  But among symbolic variables there are many passengers with missing variables that were not marked.  Check their availability using the capabilities of the packages magrittr and dplyr <br><br><pre> <code class="hljs pgsql">require(magrittr) require(dplyr) data_train %&gt;% <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>(<span class="hljs-type"><span class="hljs-type">Name</span></span>, Sex, Ticket, Cabin, Embarked) %&gt;% apply(., <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">column</span></span>) sum(column == "")) ## <span class="hljs-type"><span class="hljs-type">Name</span></span> Sex Ticket Cabin Embarked ## <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">687</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre><br>  Replace the blanks with NA, using the recode function from the car package. <br><br><pre> <code class="hljs perl"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(car) data_train$Cabin &lt;- recode(data_train$Cabin, <span class="hljs-string"><span class="hljs-string">"'' = NA"</span></span>) data_train$Embarked &lt;- recode(data_train$Embarked, <span class="hljs-string"><span class="hljs-string">"'' = NA"</span></span>)</code> </pre><br>  For a graphical representation, it is convenient to use the missmap function from the package for working with missing Amelia data. <br><br><pre> <code class="hljs lisp">require(<span class="hljs-name"><span class="hljs-name">colorspace</span></span>) colors_A &lt;- sequential_hcl(<span class="hljs-number"><span class="hljs-number">2</span></span>) require(<span class="hljs-name"><span class="hljs-name">Amelia</span></span>) missmap(<span class="hljs-name"><span class="hljs-name">data_train</span></span>, col = colors_A, legend=FALSE)</code> </pre><br><br><img src="https://habrastorage.org/files/720/862/637/720862637b6f402aab7ce37f5fdce4b7.png"><br><br>  Thus, about 20% of the data in the Age variable and almost 80% in Cabin are missing.  And if with the age of the passengers it is possible to make a reasonable replacement of the missing values, due to their small share, then it is unlikely to do something with the cabins, because  Missing values ‚Äã‚Äãare significantly more than filled.  Missing Values ‚Äã‚Äãin the Embarked Tag <br><br>  We will return to the missing values ‚Äã‚Äãlater, but for now let's see what information can be extracted from the data that we have.  I remind you that the main task is to determine the variables that affect the probability of surviving a Titanic crash.  Let's try to get initial ideas about these dependencies using simple graphs. <br><br><pre> <code class="hljs pgsql">##            <span class="hljs-string"><span class="hljs-string">'ggplot2'</span></span> require(ggplot2) require(gridExtra) data_train %&lt;&gt;% <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>(., Survived = <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.factor(Survived), Pclass = <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.factor(Pclass), Sex = <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.factor(Sex), Embarked = <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.factor(Embarked), SibSp = <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(SibSp)) colours &lt;- rainbow_hcl(<span class="hljs-number"><span class="hljs-number">4</span></span>, start = <span class="hljs-number"><span class="hljs-number">30</span></span>, end = <span class="hljs-number"><span class="hljs-number">300</span></span>) ggbar &lt;- ggplot(data_train) + geom_bar(stat = "bin", width=<span class="hljs-number"><span class="hljs-number">.6</span></span>, fill= colours[<span class="hljs-number"><span class="hljs-number">3</span></span>], colour="black") + guides(fill=<span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>) + ylab(<span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>) g1 &lt;- ggbar + aes(x = factor(Survived, labels = c("", ""))) + ggtitle(" \n   ") + xlab(<span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>) g2 &lt;- ggbar + aes(x = factor(Pclass, labels = c("", "", ""))) + ggtitle(" \n   ") + xlab(<span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>) g3 &lt;- ggbar + aes(x = factor(Sex, labels = c("", ""))) + ggtitle("   ") + xlab(<span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>) g4 &lt;- ggbar + aes(x = <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.factor(SibSp)) + ggtitle("   \n ' +      '") + xlab(<span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>) g5 &lt;- ggbar + aes(x = <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.factor(Parch)) + ggtitle("   \n ' +   '") + xlab(<span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>) g6 &lt;- ggbar + aes(x = factor(Embarked, labels = c("Cherbourg", "Queenstown", "Southampton"))) + ggtitle(" \n   ") + xlab(<span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>) gghist &lt;- ggplot(data_train) + geom_histogram(fill= colours[<span class="hljs-number"><span class="hljs-number">4</span></span>]) + guides(fill=<span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>) + ylab(<span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>) g7 &lt;- gghist + aes(x = Age) + xlab(<span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>) + ggtitle("   ") g8 &lt;- gghist + aes(x = Fare) + xlab(<span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>) + ggtitle(" \n   ") grid.arrange(g1, g2, g3, g4, g5, g6, g7, g8, ncol = <span class="hljs-number"><span class="hljs-number">2</span></span>, nrow=<span class="hljs-number"><span class="hljs-number">4</span></span>)</code> </pre><br><br><img src="https://habrastorage.org/files/d1a/3a1/4a8/d1a3a14a8e15477b8ec929ab8e11ac86.png"><br><br>  Already it is possible to draw the first conclusions: <br><br><ul><li>  more passengers were killed than saved </li><li>  the vast majority of passengers were in cabins of the third class </li><li>  there were more men than women </li></ul><br>  In general, we can already say that the main factors of the model will be the floor of the passenger (remember the order of the captain, about which I wrote earlier) and the location of the cabin. <br><br>  Let's go back to the missing values ‚Äã‚Äãfor a while.  From the schedule Distribution of passengers at the point of departure it is obvious that most of the passengers went from Southampton, respectively, you can safely replace 2 NA with this value <br><br><pre> <code class="hljs perl">data_train$Embarked[is.na(data_train$Embarked)] &lt;- <span class="hljs-string"><span class="hljs-string">"S"</span></span></code> </pre><br>  Now take a closer look at the relationship between the probability of survival and other factors.  The following graph confirms the theory that the higher the passenger cabin class, the greater the chances of survival.  (By "higher", "I mean the reverse order, because the first class is higher than the second and, especially, the third.) <br><br><pre> <code class="hljs lisp">ggbar &lt;- ggplot(<span class="hljs-name"><span class="hljs-name">data_train</span></span>) + geom_bar(<span class="hljs-name"><span class="hljs-name">stat</span></span> = <span class="hljs-string"><span class="hljs-string">"bin"</span></span>, width=.<span class="hljs-number"><span class="hljs-number">6</span></span>) ggbar + aes(<span class="hljs-name"><span class="hljs-name">x</span></span> = factor(<span class="hljs-name"><span class="hljs-name">Pclass</span></span>, labels = c(<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)), fill = factor(<span class="hljs-name"><span class="hljs-name">Survived</span></span>, labels = c(<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>))) + scale_fill_manual (<span class="hljs-name"><span class="hljs-name">values=colours</span></span>[]) + guides(<span class="hljs-name"><span class="hljs-name">fill=guide_legend</span></span>(<span class="hljs-name"><span class="hljs-name">title=NULL</span></span>)) + ylab(<span class="hljs-name"><span class="hljs-name">NULL</span></span>) + xlab(<span class="hljs-string"><span class="hljs-string">" "</span></span>)</code> </pre><br><br><img src="https://habrastorage.org/files/aa4/12f/37e/aa412f37ee2d47368093e4c7fd09ca0e.png"><br><br>  Compare the chances of survival in men and women.  The data confirm the theory expressed earlier. <br><br><pre> <code class="hljs lisp">ggbar + aes(<span class="hljs-name"><span class="hljs-name">x</span></span> = factor(<span class="hljs-name"><span class="hljs-name">Sex</span></span>, labels = c(<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)), fill = factor(<span class="hljs-name"><span class="hljs-name">Survived</span></span>, labels = c(<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>))) + scale_fill_manual (<span class="hljs-name"><span class="hljs-name">values=colours</span></span>[]) + guides(<span class="hljs-name"><span class="hljs-name">fill=guide_legend</span></span>(<span class="hljs-name"><span class="hljs-name">title=NULL</span></span>)) + ylab(<span class="hljs-name"><span class="hljs-name">NULL</span></span>) + xlab(<span class="hljs-string"><span class="hljs-string">" "</span></span>)</code> </pre><br><br><img src="https://habrastorage.org/files/b4e/0d5/6a4/b4e0d56a43e54899bba76c54b04b7d3b.png"><br><br>  Now let's take a look at the chances of surviving passengers from various ports of departure. <br><br><pre> <code class="hljs lisp">ggbar + aes(<span class="hljs-name"><span class="hljs-name">x</span></span> = factor(<span class="hljs-name"><span class="hljs-name">Embarked</span></span>, labels = c(<span class="hljs-string"><span class="hljs-string">"Cherbourg"</span></span>, <span class="hljs-string"><span class="hljs-string">"Queenstown"</span></span>, <span class="hljs-string"><span class="hljs-string">"Southampton"</span></span>)), fill = factor(<span class="hljs-name"><span class="hljs-name">Survived</span></span>, labels = c(<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>))) + scale_fill_manual (<span class="hljs-name"><span class="hljs-name">values=colours</span></span>[]) + guides(<span class="hljs-name"><span class="hljs-name">fill=guide_legend</span></span>(<span class="hljs-name"><span class="hljs-name">title=NULL</span></span>)) + ylab(<span class="hljs-name"><span class="hljs-name">NULL</span></span>) + xlab(<span class="hljs-string"><span class="hljs-string">" "</span></span>)</code> </pre><br><br><img src="https://habrastorage.org/files/2e8/508/23a/2e850823a3274336b9b69ea471bba7dd.png"><br><br>  It seems that there is some kind of connection, but I think that this is most likely due to the distribution of passengers of different classes between these ports, which is confirmed by the following graph. <br><br><pre> <code class="hljs lisp">ggbar + aes(<span class="hljs-name"><span class="hljs-name">x</span></span> = factor(<span class="hljs-name"><span class="hljs-name">Embarked</span></span>, labels = c(<span class="hljs-string"><span class="hljs-string">"Cherbourg"</span></span>, <span class="hljs-string"><span class="hljs-string">"Queenstown"</span></span>, <span class="hljs-string"><span class="hljs-string">"Southampton"</span></span>)), fill = factor(<span class="hljs-name"><span class="hljs-name">Pclass</span></span>, labels = c(<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>))) + scale_fill_manual (<span class="hljs-name"><span class="hljs-name">values=colours</span></span>[]) + guides(<span class="hljs-name"><span class="hljs-name">fill=guide_legend</span></span>(<span class="hljs-name"><span class="hljs-name">title=</span></span><span class="hljs-string"><span class="hljs-string">" "</span></span>)) + ylab(<span class="hljs-name"><span class="hljs-name">NULL</span></span>) + xlab(<span class="hljs-string"><span class="hljs-string">" "</span></span>)</code> </pre><br><br><img src="https://habrastorage.org/files/7cf/6ca/34f/7cf6ca34f21342fc87e16be987b7a711.png"><br><br>  You can also test the hypothesis that younger people survive, because  they move faster, swim better, etc. <br><br><pre> <code class="hljs lisp">ggplot(<span class="hljs-name"><span class="hljs-name">data_train</span></span>, aes(<span class="hljs-name"><span class="hljs-name">x</span></span> = factor(<span class="hljs-name"><span class="hljs-name">Survived</span></span>, labels = c(<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)), y = Age, fill = factor(<span class="hljs-name"><span class="hljs-name">Survived</span></span>, labels = c(<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)))) + geom_boxplot() + scale_fill_manual (<span class="hljs-name"><span class="hljs-name">values=colours</span></span>[]) + guides(<span class="hljs-name"><span class="hljs-name">fill=guide_legend</span></span>(<span class="hljs-name"><span class="hljs-name">title=NULL</span></span>)) + ylab(<span class="hljs-name"><span class="hljs-name">NULL</span></span>) + xlab(<span class="hljs-name"><span class="hljs-name">NULL</span></span>)</code> </pre><br><br><img src="https://habrastorage.org/files/0ca/3c1/cf3/0ca3c1cf3c3048afa826d0c717c4c8d3.png"><br><br>  As you can see, an obvious dependency is not visible here. <br><br>  Now, with the help of another type of graph, let's look at the presence of possible statistical relationships between the features of objects.  You can make preliminary conclusions that confirm the thoughts expressed earlier.  In particular, that the chances of survival decrease with the growth of the class and age is a very weak symptom for building a model.  You can also find other patterns.  There is a negative correlation between age and class, which is most likely due to more aged passengers more often could afford a more expensive cabin.  In addition, the ticket price and class are closely related (high correlation coefficient), which is quite expected. <br><br><pre> <code class="hljs pgsql">source(<span class="hljs-string"><span class="hljs-string">'my.plotcorr.R'</span></span>) corplot_data &lt;- data_train %&gt;% <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>(Survived, Pclass, Sex, Age, SibSp, Parch, Fare, Embarked) %&gt;% mutate(Survived = <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(Survived), Pclass = <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(Pclass), Sex = <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(Sex), Embarked = <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(Embarked)) corr_train_data &lt;- cor(corplot_data, use = "na.or.complete") colsc &lt;- c(rgb(<span class="hljs-number"><span class="hljs-number">241</span></span>, <span class="hljs-number"><span class="hljs-number">54</span></span>, <span class="hljs-number"><span class="hljs-number">23</span></span>, maxColorValue=<span class="hljs-number"><span class="hljs-number">255</span></span>), <span class="hljs-string"><span class="hljs-string">'white'</span></span>, rgb(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">61</span></span>, <span class="hljs-number"><span class="hljs-number">104</span></span>, maxColorValue=<span class="hljs-number"><span class="hljs-number">255</span></span>)) colramp &lt;- colorRampPalette(colsc, space=<span class="hljs-string"><span class="hljs-string">'Lab'</span></span>) colorscor &lt;- colramp(<span class="hljs-number"><span class="hljs-number">100</span></span>) my.plotcorr(corr_train_data, col=colorscor[((corr_train_data + <span class="hljs-number"><span class="hljs-number">1</span></span>)/<span class="hljs-number"><span class="hljs-number">2</span></span>) * <span class="hljs-number"><span class="hljs-number">100</span></span>], upper.panel="number", mar=c(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>), main=<span class="hljs-string"><span class="hljs-string">'  '</span></span>)</code> </pre><br><br><img src="https://habrastorage.org/files/be8/3fe/6cb/be83fe6cb5d84fa3b3377dc269d3508b.png"><br><br>  Let's go back to the missing values ‚Äã‚Äãin the data.  One of the usual ways to deal with them is to replace them with an average of the available values ‚Äã‚Äãof the same trait.  For example, 177 missed from the sign Age can be replaced by 29.7 <br><br><pre> <code class="hljs perl">summary(data_train$Age) <span class="hljs-comment"><span class="hljs-comment">## Min. 1st Qu. Median Mean 3rd Qu. Max. NA's ## 0.42 20.12 28.00 29.70 38.00 80.00 177</span></span></code> </pre><br><br>  I have already successfully applied this method earlier with the Embarked sign, but there were only two replacements, and here - 177, which is more than 20% of all available data on this sign.  Therefore, it is worth finding a more accurate way to replace. <br><br>  One of the possible options is to take the average, but depending on the class of the cabin, because if you look at the chart below, this relationship is possible.  And, if you think about it, such an assumption is intuitively clear: the older a person is, the higher his probable well-being and, accordingly, the higher level of comfort that he can afford.  Thus, it is possible to replace the missing value for a passenger, for example, from the third class, with the average age for this class, which will already be a great progress compared to just the average for all passengers. <br><br><pre> <code class="hljs lisp">ggplot(<span class="hljs-name"><span class="hljs-name">data_train</span></span>, aes(<span class="hljs-name"><span class="hljs-name">x</span></span> = factor(<span class="hljs-name"><span class="hljs-name">Pclass</span></span>, labels = c(<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)), y = Age, fill = factor(<span class="hljs-name"><span class="hljs-name">Pclass</span></span>))) + geom_boxplot() + scale_fill_manual (<span class="hljs-name"><span class="hljs-name">values=colours</span></span>) + ylab(<span class="hljs-string"><span class="hljs-string">""</span></span>) + xlab(<span class="hljs-string"><span class="hljs-string">" "</span></span>) + guides(<span class="hljs-name"><span class="hljs-name">fill=FALSE</span></span>)</code> </pre><br><br><img src="https://habrastorage.org/files/d06/376/a9c/d06376a9c7fc48a0936a42ce15c3535d.png"><br><br>  But let's turn to another of the possible options for replacing the missing values ‚Äã‚Äãfor the Age attribute.  If you look at the values ‚Äã‚Äãof the Name attribute, you can notice an interesting feature. <br><br><pre> <code class="hljs objectivec">head(data_train$Name) <span class="hljs-meta"><span class="hljs-meta">## [1] </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Braund, Mr. Owen Harris"</span></span></span><span class="hljs-meta"> ## [2] </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Cumings, Mrs. John Bradley (Florence Briggs Thayer)"</span></span></span><span class="hljs-meta"> ## [3] </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Heikkinen, Miss. Laina"</span></span></span><span class="hljs-meta"> ## [4] </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Futrelle, Mrs. Jacques Heath (Lily May Peel)"</span></span></span><span class="hljs-meta"> ## [5] </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Allen, Mr. William Henry"</span></span></span><span class="hljs-meta"> ## [6] </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Moran, Mr. James"</span></span></span></span></code> </pre><br><br>  The name of each passenger is built one pattern each time: ‚ÄúLast Name, Gonorato.  Name".  The appeal of the Master in the 19th century was applied to male children, respectively, this can be used to single out narrower and more precise groups by age.  And Miss was applied to unmarried women, but in the 19th century, in the overwhelming majority, only young girls and girls were unmarried.  In order to use this dependency we will create a new Title attribute. <br><br><pre> <code class="hljs mel">require(stringr) data_train$Title &lt;- data_train$Name %&gt;% str_extract(., <span class="hljs-string"><span class="hljs-string">"\\w+\\."</span></span>) %&gt;% str_sub(.,<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">-2</span></span>) unique(data_train$Title) ## [<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-string"><span class="hljs-string">"Mr"</span></span> <span class="hljs-string"><span class="hljs-string">"Mrs"</span></span> <span class="hljs-string"><span class="hljs-string">"Miss"</span></span> <span class="hljs-string"><span class="hljs-string">"Master"</span></span> <span class="hljs-string"><span class="hljs-string">"Don"</span></span> <span class="hljs-string"><span class="hljs-string">"Rev"</span></span> ## [<span class="hljs-number"><span class="hljs-number">7</span></span>] <span class="hljs-string"><span class="hljs-string">"Dr"</span></span> <span class="hljs-string"><span class="hljs-string">"Mme"</span></span> <span class="hljs-string"><span class="hljs-string">"Ms"</span></span> <span class="hljs-string"><span class="hljs-string">"Major"</span></span> <span class="hljs-string"><span class="hljs-string">"Lady"</span></span> <span class="hljs-string"><span class="hljs-string">"Sir"</span></span> ## [<span class="hljs-number"><span class="hljs-number">13</span></span>] <span class="hljs-string"><span class="hljs-string">"Mlle"</span></span> <span class="hljs-string"><span class="hljs-string">"Col"</span></span> <span class="hljs-string"><span class="hljs-string">"Capt"</span></span> <span class="hljs-string"><span class="hljs-string">"Countess"</span></span> <span class="hljs-string"><span class="hljs-string">"Jonkheer"</span></span></code> </pre><br><br>  Now we define titles, among owners of which there is at least one with absent age. <br><br><pre> <code class="hljs pgsql">mean_title &lt;- data_train %&gt;% group_by(Title) %&gt;% summarise(count = n(), Missing = sum(<span class="hljs-keyword"><span class="hljs-keyword">is</span></span>.na(Age)), Mean = round(mean(Age, na.rm = T), <span class="hljs-number"><span class="hljs-number">2</span></span>)) mean_title ## Source: <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> data frame [<span class="hljs-number"><span class="hljs-number">17</span></span> x <span class="hljs-number"><span class="hljs-number">4</span></span>] ## ## Title count Missing Mean ## <span class="hljs-number"><span class="hljs-number">1</span></span> Capt <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">70.00</span></span> ## <span class="hljs-number"><span class="hljs-number">2</span></span> Col <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">58.00</span></span> ## <span class="hljs-number"><span class="hljs-number">3</span></span> Countess <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">33.00</span></span> ## <span class="hljs-number"><span class="hljs-number">4</span></span> Don <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">40.00</span></span> ## <span class="hljs-number"><span class="hljs-number">5</span></span> Dr <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">42.00</span></span> ## <span class="hljs-number"><span class="hljs-number">6</span></span> Jonkheer <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">38.00</span></span> ## <span class="hljs-number"><span class="hljs-number">7</span></span> Lady <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">48.00</span></span> ## <span class="hljs-number"><span class="hljs-number">8</span></span> Major <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">48.50</span></span> ## <span class="hljs-number"><span class="hljs-number">9</span></span> Master <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4.57</span></span> ## <span class="hljs-number"><span class="hljs-number">10</span></span> Miss <span class="hljs-number"><span class="hljs-number">182</span></span> <span class="hljs-number"><span class="hljs-number">36</span></span> <span class="hljs-number"><span class="hljs-number">21.77</span></span> ## <span class="hljs-number"><span class="hljs-number">11</span></span> Mlle <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">24.00</span></span> ## <span class="hljs-number"><span class="hljs-number">12</span></span> Mme <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">24.00</span></span> ## <span class="hljs-number"><span class="hljs-number">13</span></span> Mr <span class="hljs-number"><span class="hljs-number">517</span></span> <span class="hljs-number"><span class="hljs-number">119</span></span> <span class="hljs-number"><span class="hljs-number">32.37</span></span> ## <span class="hljs-number"><span class="hljs-number">14</span></span> Mrs <span class="hljs-number"><span class="hljs-number">125</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">35.90</span></span> ## <span class="hljs-number"><span class="hljs-number">15</span></span> Ms <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">28.00</span></span> ## <span class="hljs-number"><span class="hljs-number">16</span></span> Rev <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">43.17</span></span> ## <span class="hljs-number"><span class="hljs-number">17</span></span> Sir <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">49.00</span></span></code> </pre><br>  And we will replace.  To do this, create a function and apply it to the attribute Age. <br><br><pre> <code class="hljs php">impute.mean &lt;- <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(impute_col, filter_var, var_levels)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (lev in var_levels) { impute_col[(filter_var == lev) &amp; is.na(impute_col)] &lt;- mean(impute_col[filter_var == lev], na.rm = T) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (impute_col) } data_train$Age &lt;- impute.mean(data_train$Age, data_train$Title, c(<span class="hljs-string"><span class="hljs-string">"Dr"</span></span>, <span class="hljs-string"><span class="hljs-string">"Master"</span></span>, <span class="hljs-string"><span class="hljs-string">"Mrs"</span></span>, <span class="hljs-string"><span class="hljs-string">"Miss"</span></span>, <span class="hljs-string"><span class="hljs-string">"Mr"</span></span>)) summary(data_train$Age) <span class="hljs-comment"><span class="hljs-comment">## Min. 1st Qu. Median Mean 3rd Qu. Max. ## 0.42 21.77 30.00 29.75 35.90 80.00</span></span></code> </pre><br>  If you pay attention to the sign of Fare (ticket price), you can see that there are tickets with zero cost. <br><br><pre> <code class="hljs lisp">head(<span class="hljs-name"><span class="hljs-name">table</span></span>(<span class="hljs-name"><span class="hljs-name">data_train</span></span>$Fare)) ## ## <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">4.0125</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">6.2375</span></span> <span class="hljs-number"><span class="hljs-number">6.4375</span></span> <span class="hljs-number"><span class="hljs-number">6.45</span></span> ## <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>  The first explanation that comes to mind is the children, but if you look at the other signs of these passengers, this assumption turns out to be false. <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">data_train</span></span> %&gt;% <span class="hljs-selector-tag"><span class="hljs-selector-tag">filter</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">Fare</span></span> &lt; 6) %&gt;% <span class="hljs-selector-tag"><span class="hljs-selector-tag">select</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">Fare</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">Age</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">Pclass</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">Title</span></span>) %&gt;% <span class="hljs-selector-tag"><span class="hljs-selector-tag">arrange</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">Fare</span></span>) ## <span class="hljs-selector-tag"><span class="hljs-selector-tag">Fare</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Age</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Pclass</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Title</span></span> ## 1 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0000</span></span> 36<span class="hljs-selector-class"><span class="hljs-selector-class">.00000</span></span> 3 <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mr</span></span> ## 2 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0000</span></span> 40<span class="hljs-selector-class"><span class="hljs-selector-class">.00000</span></span> 1 <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mr</span></span> ## 3 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0000</span></span> 25<span class="hljs-selector-class"><span class="hljs-selector-class">.00000</span></span> 3 <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mr</span></span> ## 4 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0000</span></span> 32<span class="hljs-selector-class"><span class="hljs-selector-class">.36809</span></span> 2 <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mr</span></span> ## 5 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0000</span></span> 19<span class="hljs-selector-class"><span class="hljs-selector-class">.00000</span></span> 3 <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mr</span></span> ## 6 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0000</span></span> 32<span class="hljs-selector-class"><span class="hljs-selector-class">.36809</span></span> 2 <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mr</span></span> ## 7 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0000</span></span> 32<span class="hljs-selector-class"><span class="hljs-selector-class">.36809</span></span> 2 <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mr</span></span> ## 8 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0000</span></span> 32<span class="hljs-selector-class"><span class="hljs-selector-class">.36809</span></span> 2 <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mr</span></span> ## 9 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0000</span></span> 49<span class="hljs-selector-class"><span class="hljs-selector-class">.00000</span></span> 3 <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mr</span></span> ## 10 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0000</span></span> 32<span class="hljs-selector-class"><span class="hljs-selector-class">.36809</span></span> 1 <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mr</span></span> ## 11 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0000</span></span> 32<span class="hljs-selector-class"><span class="hljs-selector-class">.36809</span></span> 2 <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mr</span></span> ## 12 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0000</span></span> 32<span class="hljs-selector-class"><span class="hljs-selector-class">.36809</span></span> 2 <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mr</span></span> ## 13 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0000</span></span> 39<span class="hljs-selector-class"><span class="hljs-selector-class">.00000</span></span> 1 <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mr</span></span> ## 14 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0000</span></span> 32<span class="hljs-selector-class"><span class="hljs-selector-class">.36809</span></span> 1 <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mr</span></span> ## 15 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0000</span></span> 38<span class="hljs-selector-class"><span class="hljs-selector-class">.00000</span></span> 1 <span class="hljs-selector-tag"><span class="hljs-selector-tag">Jonkheer</span></span> ## 16 4<span class="hljs-selector-class"><span class="hljs-selector-class">.0125</span></span> 20<span class="hljs-selector-class"><span class="hljs-selector-class">.00000</span></span> 3 <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mr</span></span> ## 17 5<span class="hljs-selector-class"><span class="hljs-selector-class">.0000</span></span> 33<span class="hljs-selector-class"><span class="hljs-selector-class">.00000</span></span> 1 <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mr</span></span></code> </pre><br>  Therefore, I think it would be logical to replace the zero values ‚Äã‚Äãwith the average values ‚Äã‚Äãfor the class using the already used impute.mean function. <br><br><pre> <code class="hljs php">data_train$Fare[data_train$Fare == <span class="hljs-number"><span class="hljs-number">0</span></span>] &lt;- NA data_train$Fare &lt;- impute.mean(data_train$Fare, data_train$Pclass, <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(levels(data_train$Pclass)))</code> </pre><br>  The Title attribute, introduced to replace missing values ‚Äã‚Äãin the Age attribute, gives us additional information about the passenger field, its nobility (for example, Don and Sir) and the priority in accessing the lifeboats.  Therefore, this feature must be left when building a model.  In total, we have 17 values ‚Äã‚Äãof this attribute.  The following graph shows their relationship with age. <br><br><pre> <code class="hljs lisp">ggplot(<span class="hljs-name"><span class="hljs-name">data_train</span></span>, aes(<span class="hljs-name"><span class="hljs-name">x</span></span> = factor(<span class="hljs-name"><span class="hljs-name">Title</span></span>, c(<span class="hljs-string"><span class="hljs-string">"Capt"</span></span>,<span class="hljs-string"><span class="hljs-string">"Col"</span></span>,<span class="hljs-string"><span class="hljs-string">"Major"</span></span>,<span class="hljs-string"><span class="hljs-string">"Sir"</span></span>,<span class="hljs-string"><span class="hljs-string">"Lady"</span></span>,<span class="hljs-string"><span class="hljs-string">"Rev"</span></span>, <span class="hljs-string"><span class="hljs-string">"Dr"</span></span>,<span class="hljs-string"><span class="hljs-string">"Don"</span></span>,<span class="hljs-string"><span class="hljs-string">"Jonkheer"</span></span>,<span class="hljs-string"><span class="hljs-string">"Countess"</span></span>,<span class="hljs-string"><span class="hljs-string">"Mrs"</span></span>, <span class="hljs-string"><span class="hljs-string">"Ms"</span></span>,<span class="hljs-string"><span class="hljs-string">"Mr"</span></span>,<span class="hljs-string"><span class="hljs-string">"Mme"</span></span>,<span class="hljs-string"><span class="hljs-string">"Mlle"</span></span>,<span class="hljs-string"><span class="hljs-string">"Miss"</span></span>,<span class="hljs-string"><span class="hljs-string">"Master"</span></span>)), y = Age)) + geom_boxplot(<span class="hljs-name"><span class="hljs-name">fill=</span></span> colours[<span class="hljs-number"><span class="hljs-number">3</span></span>]) + guides(<span class="hljs-name"><span class="hljs-name">fill=FALSE</span></span>) + guides(<span class="hljs-name"><span class="hljs-name">fill=guide_legend</span></span>(<span class="hljs-name"><span class="hljs-name">title=NULL</span></span>)) + ylab(<span class="hljs-string"><span class="hljs-string">""</span></span>) + xlab(<span class="hljs-name"><span class="hljs-name">NULL</span></span>)</code> </pre><br><br><img src="https://habrastorage.org/files/1fb/a9e/656/1fba9e6561124cb99a18089cfac9edc8.png"><br><br>  But many of the values, as I believe, can be combined into 5 groups: Aristocratic, Mr, Mrs, Miss and Master, since  merged titles belong in fact to one or related groups. <br><br><pre> <code class="hljs php">change.titles &lt;- <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data, old_title, new_title)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (title in old_title) { data$Title[data$Title == title] &lt;- new_title } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (data$Title) } data_train$Title &lt;- change.titles(data_train, c(<span class="hljs-string"><span class="hljs-string">"Capt"</span></span>, <span class="hljs-string"><span class="hljs-string">"Col"</span></span>, <span class="hljs-string"><span class="hljs-string">"Don"</span></span>, <span class="hljs-string"><span class="hljs-string">"Dr"</span></span>, <span class="hljs-string"><span class="hljs-string">"Jonkheer"</span></span>, <span class="hljs-string"><span class="hljs-string">"Lady"</span></span>, <span class="hljs-string"><span class="hljs-string">"Major"</span></span>, <span class="hljs-string"><span class="hljs-string">"Rev"</span></span>, <span class="hljs-string"><span class="hljs-string">"Sir"</span></span>, <span class="hljs-string"><span class="hljs-string">"Countess"</span></span>), <span class="hljs-string"><span class="hljs-string">"Aristocratic"</span></span>) data_train$Title &lt;- change.titles(data_train, c(<span class="hljs-string"><span class="hljs-string">"Ms"</span></span>), <span class="hljs-string"><span class="hljs-string">"Mrs"</span></span>) data_train$Title &lt;- change.titles(data_train, c(<span class="hljs-string"><span class="hljs-string">"Mlle"</span></span>, <span class="hljs-string"><span class="hljs-string">"Mme"</span></span>), <span class="hljs-string"><span class="hljs-string">"Miss"</span></span>) data_train$Title &lt;- <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.factor(data_train$Title) ggplot(data_train, aes(x = factor(Title, c(<span class="hljs-string"><span class="hljs-string">"Aristocratic"</span></span>, <span class="hljs-string"><span class="hljs-string">"Mrs"</span></span>, <span class="hljs-string"><span class="hljs-string">"Mr"</span></span>, <span class="hljs-string"><span class="hljs-string">"Miss"</span></span>, <span class="hljs-string"><span class="hljs-string">"Master"</span></span>)), y = Age)) + geom_boxplot(fill= colours[<span class="hljs-number"><span class="hljs-number">3</span></span>]) + guides(fill=<span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>) + guides(fill=guide_legend(title=<span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>)) + ylab(<span class="hljs-string"><span class="hljs-string">""</span></span>) + xlab(<span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>)</code> </pre><br><br><img src="https://habrastorage.org/files/4fc/11b/2ef/4fc11b2efee248a0b4294ac658c6a355.png"><br><br>  Let's introduce such an indicator as Survival Percentage and look at its dependence on the groups that turned out at the previous stage. <br><br><pre> <code class="hljs pgsql">Surv_rate_title &lt;- data_train %&gt;% group_by(Title) %&gt;% summarise(Rate = mean(<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.character(Survived)))) ggplot(Surv_rate_title, aes(x = Title, y = Rate)) + geom_bar(stat = "identity", width=<span class="hljs-number"><span class="hljs-number">.6</span></span>, fill= colours[<span class="hljs-number"><span class="hljs-number">3</span></span>]) + xlab(<span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>) + ylab(" ")</code> </pre><br><br><img src="https://habrastorage.org/files/f9b/7aa/301/f9b7aa301c0d4e31ab87cb091de8d8e6.png"><br><br>  In order to get a good idea of ‚Äã‚Äãthe relationship between the signs is better than the graphics, as I think nothing has yet been invented.  For example, according to the following graph, it is clearly seen that the main groups of survivors are women of the first and second class of all ages.  And among the men, all the boys younger than 15 years old survived except the third class of service and a small proportion of older men and mostly from the first class. <br><br><pre> <code class="hljs lisp">ggplot(<span class="hljs-name"><span class="hljs-name">data</span></span> = data_train, aes(<span class="hljs-name"><span class="hljs-name">x</span></span> = Age, y = Pclass, color = factor(<span class="hljs-name"><span class="hljs-name">Survived</span></span>, labels = c(<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)))) + geom_point(<span class="hljs-name"><span class="hljs-name">shape</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>, size = <span class="hljs-number"><span class="hljs-number">4</span></span>, position=position_jitter(<span class="hljs-name"><span class="hljs-name">width=0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>,height=.<span class="hljs-number"><span class="hljs-number">1</span></span>)) + facet_grid(<span class="hljs-name"><span class="hljs-name">Sex</span></span> ~ .) + guides(<span class="hljs-name"><span class="hljs-name">color=guide_legend</span></span>(<span class="hljs-name"><span class="hljs-name">title=NULL</span></span>)) + xlab(<span class="hljs-string"><span class="hljs-string">""</span></span>) + ylab(<span class="hljs-string"><span class="hljs-string">" "</span></span>)</code> </pre><br><br><img src="https://habrastorage.org/files/9ed/057/3eb/9ed0573eb46d4f729f0b7f58118e6d4d.png"><br><br>  Now look at the information that can be obtained from the number of relatives on the ship. <br><br><pre> <code class="hljs lisp">ggplot(<span class="hljs-name"><span class="hljs-name">data_train</span></span>, aes(<span class="hljs-name"><span class="hljs-name">x</span></span> = SibSp, y = Parch, color = factor(<span class="hljs-name"><span class="hljs-name">Survived</span></span>, labels = c(<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)))) + geom_point(<span class="hljs-name"><span class="hljs-name">shape</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>, size = <span class="hljs-number"><span class="hljs-number">4</span></span>, position=position_jitter(<span class="hljs-name"><span class="hljs-name">width=0</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>,height=.<span class="hljs-number"><span class="hljs-number">3</span></span>)) + guides(<span class="hljs-name"><span class="hljs-name">color=guide_legend</span></span>(<span class="hljs-name"><span class="hljs-name">title=NULL</span></span>)) + xlab(<span class="hljs-string"><span class="hljs-string">"- \n  ,\n .. , "</span></span>) + ylab(<span class="hljs-string"><span class="hljs-string">"- \n  ,\n .. ,   .."</span></span>)</code> </pre><br><br><img src="https://habrastorage.org/files/e5d/acb/3fb/e5dacb3fb5734a3e8517a4ee7e42c8ec.png"><br><br>  It is very likely that survival is negatively affected by the absence of relatives as well as a large number. <br><br>  We introduce such a feature as Family, i.e.  the number of relatives on board the ship and look at the effect on survival. <br><br><pre> <code class="hljs pgsql">Surv_rate_family &lt;- data_train %&gt;% group_by(<span class="hljs-keyword"><span class="hljs-keyword">Family</span></span> = SibSp + Parch) %&gt;% summarise(Rate = mean(<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.character(Survived)))) ggplot(Surv_rate_family, aes(x = <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.factor(<span class="hljs-keyword"><span class="hljs-keyword">Family</span></span>), y = Rate)) + geom_bar(stat = "identity", width=<span class="hljs-number"><span class="hljs-number">.6</span></span>, fill= colours[<span class="hljs-number"><span class="hljs-number">3</span></span>]) + xlab("-    ") + ylab(" ")</code> </pre><br><br><img src="https://habrastorage.org/files/cff/871/625/cff8716257cc4658a90daf3247db66d1.png"><br><br>  And also in the context of the sexes of passengers. <br><br><pre> <code class="hljs kotlin">data_train$Family &lt;- data_train$SibSp + data_train$Parch ggplot(data_train, aes(x = factor(Family), y = <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.character(Survived)))) + stat_summary( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function">.y = mean, ymin=0, ymax=1, geom="bar", size=4, fill= colours[2]) + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xlab</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"-    "</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> + ylab(<span class="hljs-string"><span class="hljs-string">" "</span></span>) + facet_grid(Sex ~ .)</code> </pre><br><br><img src="https://habrastorage.org/files/b08/53c/21a/b0853c21a46647aeb81fb5861847e50e.png"><br><br>  The graph shows that for a woman a small number of relatives significantly increases the likelihood of survival.  The statistical significance of this dependence should be checked, but I think that the attribute should be left and to look at its influence when creating the model.  It is also possible that such a binary sign as ‚ÄúHaving relatives on board‚Äù will make sense. <br><br><pre> <code class="hljs kotlin">data_train$isFamily &lt;- <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.factor(<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(data_train$Family &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>)) ggplot( data_train, aes(x=factor(isFamily, labels =c(<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)),y=<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.character(Survived))) ) + stat_summary( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function">.y = mean, ymin=0, ymax=1, geom="bar", size=4, fill= colours[2]) + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ylab</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">" "</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> + xlab(<span class="hljs-string"><span class="hljs-string">"    "</span></span>)</code> </pre><br><br><img src="https://habrastorage.org/files/d46/2f5/7ef/d462f57ef5324bc6b3bc49653677b87b.png"><br><br>  At first glance, it seems that the presence of relatives increases the likelihood of survival, but if you look at the relationship in terms of classes and gender, the picture changes. <br><br><pre> <code class="hljs lisp">ggplot(<span class="hljs-name"><span class="hljs-name">data_train</span></span>, aes(<span class="hljs-name"><span class="hljs-name">x</span></span> = factor(<span class="hljs-name"><span class="hljs-name">isFamily</span></span>, labels =c(<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)), y = as.numeric(<span class="hljs-name"><span class="hljs-name">as</span></span>.character(<span class="hljs-name"><span class="hljs-name">Survived</span></span>)))) + stat_summary( <span class="hljs-name"><span class="hljs-name">fun</span></span>.y = <span class="hljs-string"><span class="hljs-string">"mean"</span></span>, geom=<span class="hljs-string"><span class="hljs-string">"bar"</span></span>, ymin=0, ymax=1, fill= colours[<span class="hljs-number"><span class="hljs-number">2</span></span>]) + facet_grid(<span class="hljs-name"><span class="hljs-name">Pclass</span></span> ~ Sex) + ylab(<span class="hljs-string"><span class="hljs-string">" "</span></span>) + xlab(<span class="hljs-string"><span class="hljs-string">"    "</span></span>)</code> </pre><br><br><img src="https://habrastorage.org/files/d01/7bc/eb3/d017bceb370a43dbb71fe24e44723fc9.png"><br><br>  For a man in the second grade, relatives increase survival, but for a woman in the third grade, the situation is reversed. <br><br>  From the sign of Cabin, i.e.  cabin numbers occupied by the passenger, it would be possible to extract the deck number (this is the letter in the room) and on which board the cabin was (if the last digit of the number is odd, then this is the port side, and, accordingly, vice versa), but since  only 20% of passengers have cabin numbers in the data, I do not think that this will significantly affect the accuracy of the model.  Much more interesting, in my opinion, will be information about the availability of this number.  The first-class cabin numbers became known from the list that was found on the body of the steward Herbert Cave, no further official information was preserved, respectively, it can be concluded that if the passenger room number of the second or third class is known, then he survived.  Therefore, as with relatives, we will look at survival depending on the availability of a cabin room as a whole for all passengers and in a section by class and sex. <br><br><pre> <code class="hljs kotlin">data_train$isCabin &lt;- factor(ifelse(<span class="hljs-keyword"><span class="hljs-keyword">is</span></span>.na(data_train$Cabin),<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) ggplot( data_train, aes(x=factor(isCabin, labels =c(<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)),y=<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.character(Survived))) ) + stat_summary( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function">.y = mean, ymin=0, ymax=1, geom="bar", size=4, fill= colours[3]) + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ylab</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">" "</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> + xlab(<span class="hljs-string"><span class="hljs-string">"  "</span></span>)</code> </pre><br><br><img src="https://habrastorage.org/files/7a3/2ff/307/7a32ff307bab485bab327122642692d2.png"><br><br><pre> <code class="hljs lisp">ggplot(<span class="hljs-name"><span class="hljs-name">data_train</span></span>, aes(<span class="hljs-name"><span class="hljs-name">x</span></span> = factor(<span class="hljs-name"><span class="hljs-name">isCabin</span></span>, labels =c(<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)), y = as.numeric(<span class="hljs-name"><span class="hljs-name">as</span></span>.character(<span class="hljs-name"><span class="hljs-name">Survived</span></span>)))) + stat_summary( <span class="hljs-name"><span class="hljs-name">fun</span></span>.y = <span class="hljs-string"><span class="hljs-string">"mean"</span></span>, geom=<span class="hljs-string"><span class="hljs-string">"bar"</span></span>, ymin=0, ymax=1, fill= colours[<span class="hljs-number"><span class="hljs-number">3</span></span>]) + facet_grid(<span class="hljs-name"><span class="hljs-name">Pclass</span></span> ~ Sex) + ylab(<span class="hljs-string"><span class="hljs-string">" "</span></span>) + xlab(<span class="hljs-string"><span class="hljs-string">"  "</span></span>)</code> </pre><br><br><img src="https://habrastorage.org/files/247/673/31f/24767331f3674aa698966775179aa4ab.png"><br><br>  Obviously, the assumption was confirmed, especially for male passengers. <br><br>  To summarize all the research work that has been done: <br><br><ul><li>  Certain patterns were identified in the data, but in order to say for sure that the target attribute depends on this and on this it is necessary to conduct a statistical analysis. </li><li>  Additional features were created Title, Family, isFamily, isCabin, which, in my opinion, have an impact on the target feature and can be used to create the model.  But the final conclusion about the benefits of these features can be made only in the process of creating a predictive model. </li></ul><br><br>  Now select from the data those signs that we will use when creating the model. <br><br><pre> <code class="hljs pgsql">data_train %&lt;&gt;% <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>(Survived, Pclass, Sex, Age, Fare, Embarked, Title, <span class="hljs-keyword"><span class="hljs-keyword">Family</span></span>, isFamily, isCabin)</code> </pre><br>  And the last schedule in this part of the work. <br><br><pre> <code class="hljs pgsql">corplot_data &lt;- data_train %&gt;% <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>(Survived, Pclass, Sex, Age, Fare, Embarked, <span class="hljs-keyword"><span class="hljs-keyword">Family</span></span>, isFamily, isCabin) %&gt;% mutate(Survived = <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(Survived), Pclass = <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(Pclass), Sex = <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(Sex), Embarked = <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(Embarked), isFamily = <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(isFamily), isCabin = <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(isCabin)) corr_train_data &lt;- cor(corplot_data, use = "na.or.complete") colsc &lt;- c(rgb(<span class="hljs-number"><span class="hljs-number">241</span></span>, <span class="hljs-number"><span class="hljs-number">54</span></span>, <span class="hljs-number"><span class="hljs-number">23</span></span>, maxColorValue=<span class="hljs-number"><span class="hljs-number">255</span></span>), <span class="hljs-string"><span class="hljs-string">'white'</span></span>, rgb(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">61</span></span>, <span class="hljs-number"><span class="hljs-number">104</span></span>, maxColorValue=<span class="hljs-number"><span class="hljs-number">255</span></span>)) colramp &lt;- colorRampPalette(colsc, space=<span class="hljs-string"><span class="hljs-string">'Lab'</span></span>) colorscor &lt;- colramp(<span class="hljs-number"><span class="hljs-number">100</span></span>) my.plotcorr(corr_train_data, col=colorscor[((corr_train_data + <span class="hljs-number"><span class="hljs-number">1</span></span>)/<span class="hljs-number"><span class="hljs-number">2</span></span>) * <span class="hljs-number"><span class="hljs-number">100</span></span>], upper.panel="number", mar=c(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>), main=<span class="hljs-string"><span class="hljs-string">'  '</span></span>)</code> </pre><br><br><img src="https://habrastorage.org/files/5aa/199/2ab/5aa1992ab9424e378a6e6064c7340c4a.png"><br><br>  Prepare data for correct use in the process models. <br><br><pre> <code class="hljs ruby"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(plyr) <span class="hljs-keyword"><span class="hljs-keyword">require</span></span>(dplyr) data_train$Survived <span class="hljs-string"><span class="hljs-string">%&lt;&gt;</span></span>% revalue(., c(<span class="hljs-string"><span class="hljs-string">"0"</span></span>=<span class="hljs-string"><span class="hljs-string">"Died"</span></span>, <span class="hljs-string"><span class="hljs-string">"1"</span></span> = <span class="hljs-string"><span class="hljs-string">"Survived"</span></span>)) data_train$Pclass <span class="hljs-string"><span class="hljs-string">%&lt;&gt;</span></span>% revalue(., c(<span class="hljs-string"><span class="hljs-string">"1"</span></span>=<span class="hljs-string"><span class="hljs-string">"First"</span></span>, <span class="hljs-string"><span class="hljs-string">"2"</span></span>=<span class="hljs-string"><span class="hljs-string">"Second"</span></span>, <span class="hljs-string"><span class="hljs-string">"3"</span></span>=<span class="hljs-string"><span class="hljs-string">"Third"</span></span>)) data_train$Sex <span class="hljs-string"><span class="hljs-string">%&lt;&gt;</span></span>% revalue(., c(<span class="hljs-string"><span class="hljs-string">"female"</span></span>=<span class="hljs-string"><span class="hljs-string">"Female"</span></span>, <span class="hljs-string"><span class="hljs-string">"male"</span></span>=<span class="hljs-string"><span class="hljs-string">"Male"</span></span>)) data_train$isFamily <span class="hljs-string"><span class="hljs-string">%&lt;&gt;</span></span>% revalue(., c(<span class="hljs-string"><span class="hljs-string">"0"</span></span>=<span class="hljs-string"><span class="hljs-string">"No"</span></span>, <span class="hljs-string"><span class="hljs-string">"1"</span></span>=<span class="hljs-string"><span class="hljs-string">"Yes"</span></span>)) data_train$isCabin <span class="hljs-string"><span class="hljs-string">%&lt;&gt;</span></span>% revalue(., c(<span class="hljs-string"><span class="hljs-string">"0"</span></span>=<span class="hljs-string"><span class="hljs-string">"No"</span></span>, <span class="hljs-string"><span class="hljs-string">"1"</span></span>=<span class="hljs-string"><span class="hljs-string">"Yes"</span></span>))</code> </pre><br><h3>  Creating a model </h3><br>  In this paper, I will use the caret package, which has absorbed most of the well-known models of machine learning and provides a convenient interface for their practical use.  Despite the fact that we have a test sample provided by the Kaggle site, we still need to split the training sample into two parts.  On one of which we will train the model, and on the other, we will evaluate its quality before applying it to a competitive sample.  I chose an 80/20 split. <br><br><pre> <code class="hljs sql">require(caret) set.seed(<span class="hljs-number"><span class="hljs-number">111</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">split</span></span> &lt;- createDataPartition(data_train$Survived, p = <span class="hljs-number"><span class="hljs-number">0.8</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> = <span class="hljs-literal"><span class="hljs-literal">FALSE</span></span>) train &lt;- slice(data_train, <span class="hljs-keyword"><span class="hljs-keyword">split</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> &lt;- slice(data_train, -<span class="hljs-keyword"><span class="hljs-keyword">split</span></span>)</code> </pre><br>  Let's start with the simplest classification model - logistic regression.  To evaluate the model, we will use the residual deviance statistics or residual deviation, which indirectly corresponds to the variance in the data, which is unexplained after the model has been applied.  Null deviance or null deviance is the deviation of the ‚Äúempty‚Äù model, which does not include any parameters other than beta0.  Accordingly, the smaller the deviation of residuals in relation to the null deviance - the better the model.  In the future, to compare different models, AUC statistics or the area under the ROC curve will be used.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To correctly estimate this parameter, it will be estimated using a tenfold cross-validation (10-fold cross-validation (CV)) with the sample split into 10 parts. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So the first model is logistic regression. </font><font style="vertical-align: inherit;">Predictors initially present in the data provided are selected as features.</font></font><br><br><pre> <code class="hljs kotlin">cv_ctrl &lt;- trainControl(method = <span class="hljs-string"><span class="hljs-string">"repeatedcv"</span></span>, repeats = <span class="hljs-number"><span class="hljs-number">10</span></span>, summaryFunction = twoClassSummary, classProbs = TRUE) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>.seed(<span class="hljs-number"><span class="hljs-number">111</span></span>) glm.tune.1 &lt;- train(Survived ~ Pclass + Sex + Age + Fare + Embarked + Family, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = train, method = <span class="hljs-string"><span class="hljs-string">"glm"</span></span>, metric = <span class="hljs-string"><span class="hljs-string">"ROC"</span></span>, trControl = cv_ctrl) glm.tune.1 ## Generalized Linear Model ## ## <span class="hljs-number"><span class="hljs-number">714</span></span> samples ## <span class="hljs-number"><span class="hljs-number">9</span></span> predictor ## <span class="hljs-number"><span class="hljs-number">2</span></span> classes: <span class="hljs-string"><span class="hljs-string">'Died'</span></span>, <span class="hljs-string"><span class="hljs-string">'Survived'</span></span> ## ## No pre-processing ## Resampling: Cross-Validated (<span class="hljs-number"><span class="hljs-number">10</span></span> fold, repeated <span class="hljs-number"><span class="hljs-number">10</span></span> times) ## Summary of sample sizes: <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">642</span></span>, <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">642</span></span>, ... ## Resampling results ## ## ROC Sens Spec ROC SD Sens SD Spec SD ## <span class="hljs-number"><span class="hljs-number">0.8607813</span></span> <span class="hljs-number"><span class="hljs-number">0.8509091</span></span> <span class="hljs-number"><span class="hljs-number">0.7037963</span></span> <span class="hljs-number"><span class="hljs-number">0.0379468</span></span> <span class="hljs-number"><span class="hljs-number">0.05211929</span></span> <span class="hljs-number"><span class="hljs-number">0.08238326</span></span> ## ## summary(glm.tune.1) ## ## Call: ## NULL ## ## Deviance Residuals: ## Min <span class="hljs-number"><span class="hljs-number">1</span></span>Q Median <span class="hljs-number"><span class="hljs-number">3</span></span>Q Max ## -<span class="hljs-number"><span class="hljs-number">2.2611</span></span> -<span class="hljs-number"><span class="hljs-number">0.5641</span></span> -<span class="hljs-number"><span class="hljs-number">0.3831</span></span> <span class="hljs-number"><span class="hljs-number">0.5944</span></span> <span class="hljs-number"><span class="hljs-number">2.5244</span></span> ## ## Coefficients: ## Estimate Std. Error z value Pr(&gt;|z|) ## (Intercept) <span class="hljs-number"><span class="hljs-number">4.5920291</span></span> <span class="hljs-number"><span class="hljs-number">0.5510121</span></span> <span class="hljs-number"><span class="hljs-number">8.334</span></span> &lt; <span class="hljs-number"><span class="hljs-number">2e-16</span></span> *** ## PclassSecond -<span class="hljs-number"><span class="hljs-number">1.0846865</span></span> <span class="hljs-number"><span class="hljs-number">0.3449892</span></span> -<span class="hljs-number"><span class="hljs-number">3.144</span></span> <span class="hljs-number"><span class="hljs-number">0.00167</span></span> ** ## PclassThird -<span class="hljs-number"><span class="hljs-number">2.5390919</span></span> <span class="hljs-number"><span class="hljs-number">0.3469115</span></span> -<span class="hljs-number"><span class="hljs-number">7.319</span></span> <span class="hljs-number"><span class="hljs-number">2.50e-13</span></span> *** ## SexMale -<span class="hljs-number"><span class="hljs-number">2.7351467</span></span> <span class="hljs-number"><span class="hljs-number">0.2277348</span></span> -<span class="hljs-number"><span class="hljs-number">12.010</span></span> &lt; <span class="hljs-number"><span class="hljs-number">2e-16</span></span> *** ## Age -<span class="hljs-number"><span class="hljs-number">0.0450577</span></span> <span class="hljs-number"><span class="hljs-number">0.0088554</span></span> -<span class="hljs-number"><span class="hljs-number">5.088</span></span> <span class="hljs-number"><span class="hljs-number">3.62e-07</span></span> *** ## Fare <span class="hljs-number"><span class="hljs-number">0.0002526</span></span> <span class="hljs-number"><span class="hljs-number">0.0028934</span></span> <span class="hljs-number"><span class="hljs-number">0.087</span></span> <span class="hljs-number"><span class="hljs-number">0.93042</span></span> ## EmbarkedQ -<span class="hljs-number"><span class="hljs-number">0.1806726</span></span> <span class="hljs-number"><span class="hljs-number">0.4285553</span></span> -<span class="hljs-number"><span class="hljs-number">0.422</span></span> <span class="hljs-number"><span class="hljs-number">0.67333</span></span> ## EmbarkedS -<span class="hljs-number"><span class="hljs-number">0.4364064</span></span> <span class="hljs-number"><span class="hljs-number">0.2711112</span></span> -<span class="hljs-number"><span class="hljs-number">1.610</span></span> <span class="hljs-number"><span class="hljs-number">0.10746</span></span> ## Family -<span class="hljs-number"><span class="hljs-number">0.1973088</span></span> <span class="hljs-number"><span class="hljs-number">0.0805129</span></span> -<span class="hljs-number"><span class="hljs-number">2.451</span></span> <span class="hljs-number"><span class="hljs-number">0.01426</span></span> * ## --- ## Signif. codes: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">'***'</span></span> <span class="hljs-number"><span class="hljs-number">0.001</span></span> <span class="hljs-string"><span class="hljs-string">'**'</span></span> <span class="hljs-number"><span class="hljs-number">0.01</span></span> <span class="hljs-string"><span class="hljs-string">'*'</span></span> <span class="hljs-number"><span class="hljs-number">0.05</span></span> <span class="hljs-string"><span class="hljs-string">'.'</span></span> <span class="hljs-number"><span class="hljs-number">0.1</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> ## ## (Dispersion parameter <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> binomial family taken to be <span class="hljs-number"><span class="hljs-number">1</span></span>) ## ## Null deviance: <span class="hljs-number"><span class="hljs-number">950.86</span></span> on <span class="hljs-number"><span class="hljs-number">713</span></span> degrees of freedom ## Residual deviance: <span class="hljs-number"><span class="hljs-number">613.96</span></span> on <span class="hljs-number"><span class="hljs-number">705</span></span> degrees of freedom ## AIC: <span class="hljs-number"><span class="hljs-number">631.96</span></span> ## ## Number of Fisher Scoring iterations: <span class="hljs-number"><span class="hljs-number">5</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The model already shows good performance in reducing deviance by 950-613 = 337 points compared to the ‚Äúempty‚Äù model. </font><font style="vertical-align: inherit;">Now we will try to improve this indicator by entering those new features that were added earlier.</font></font><br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">set</span></span>.seed(<span class="hljs-number"><span class="hljs-number">111</span></span>) glm.tune.2 &lt;- train(Survived ~ Pclass + Sex + Age + Fare + Embarked + Title + Family + isFamily + isCabin, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = train, method = <span class="hljs-string"><span class="hljs-string">"glm"</span></span>, metric = <span class="hljs-string"><span class="hljs-string">"ROC"</span></span>, trControl = cv_ctrl) glm.tune.2 ## Generalized Linear Model ## ## <span class="hljs-number"><span class="hljs-number">714</span></span> samples ## <span class="hljs-number"><span class="hljs-number">9</span></span> predictor ## <span class="hljs-number"><span class="hljs-number">2</span></span> classes: <span class="hljs-string"><span class="hljs-string">'Died'</span></span>, <span class="hljs-string"><span class="hljs-string">'Survived'</span></span> ## ## No pre-processing ## Resampling: Cross-Validated (<span class="hljs-number"><span class="hljs-number">10</span></span> fold, repeated <span class="hljs-number"><span class="hljs-number">10</span></span> times) ## Summary of sample sizes: <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">642</span></span>, <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">642</span></span>, ... ## Resampling results ## ## ROC Sens Spec ROC SD Sens SD Spec SD ## <span class="hljs-number"><span class="hljs-number">0.8755115</span></span> <span class="hljs-number"><span class="hljs-number">0.8693182</span></span> <span class="hljs-number"><span class="hljs-number">0.7661772</span></span> <span class="hljs-number"><span class="hljs-number">0.03599347</span></span> <span class="hljs-number"><span class="hljs-number">0.04526764</span></span> <span class="hljs-number"><span class="hljs-number">0.07882857</span></span> ## ## summary(glm.tune.2) ## ## Call: ## NULL ## ## Deviance Residuals: ## Min <span class="hljs-number"><span class="hljs-number">1</span></span>Q Median <span class="hljs-number"><span class="hljs-number">3</span></span>Q Max ## -<span class="hljs-number"><span class="hljs-number">2.4368</span></span> -<span class="hljs-number"><span class="hljs-number">0.5285</span></span> -<span class="hljs-number"><span class="hljs-number">0.3532</span></span> <span class="hljs-number"><span class="hljs-number">0.5087</span></span> <span class="hljs-number"><span class="hljs-number">2.5409</span></span> ## ## Coefficients: ## Estimate Std. Error z value Pr(&gt;|z|) ## (Intercept) <span class="hljs-number"><span class="hljs-number">1.467e+01</span></span> <span class="hljs-number"><span class="hljs-number">5.354e+02</span></span> <span class="hljs-number"><span class="hljs-number">0.027</span></span> <span class="hljs-number"><span class="hljs-number">0.978145</span></span> ## PclassSecond -<span class="hljs-number"><span class="hljs-number">4.626e-01</span></span> <span class="hljs-number"><span class="hljs-number">4.765e-01</span></span> -<span class="hljs-number"><span class="hljs-number">0.971</span></span> <span class="hljs-number"><span class="hljs-number">0.331618</span></span> ## PclassThird -<span class="hljs-number"><span class="hljs-number">1.784e+00</span></span> <span class="hljs-number"><span class="hljs-number">4.790e-01</span></span> -<span class="hljs-number"><span class="hljs-number">3.725</span></span> <span class="hljs-number"><span class="hljs-number">0.000195</span></span> *** ## SexMale -<span class="hljs-number"><span class="hljs-number">1.429e+01</span></span> <span class="hljs-number"><span class="hljs-number">5.354e+02</span></span> -<span class="hljs-number"><span class="hljs-number">0.027</span></span> <span class="hljs-number"><span class="hljs-number">0.978701</span></span> ## Age -<span class="hljs-number"><span class="hljs-number">3.519e-02</span></span> <span class="hljs-number"><span class="hljs-number">1.093e-02</span></span> -<span class="hljs-number"><span class="hljs-number">3.221</span></span> <span class="hljs-number"><span class="hljs-number">0.001279</span></span> ** ## Fare <span class="hljs-number"><span class="hljs-number">2.175e-04</span></span> <span class="hljs-number"><span class="hljs-number">2.828e-03</span></span> <span class="hljs-number"><span class="hljs-number">0.077</span></span> <span class="hljs-number"><span class="hljs-number">0.938704</span></span> ## EmbarkedQ -<span class="hljs-number"><span class="hljs-number">1.405e-01</span></span> <span class="hljs-number"><span class="hljs-number">4.397e-01</span></span> -<span class="hljs-number"><span class="hljs-number">0.320</span></span> <span class="hljs-number"><span class="hljs-number">0.749313</span></span> ## EmbarkedS -<span class="hljs-number"><span class="hljs-number">4.426e-01</span></span> <span class="hljs-number"><span class="hljs-number">2.887e-01</span></span> -<span class="hljs-number"><span class="hljs-number">1.533</span></span> <span class="hljs-number"><span class="hljs-number">0.125224</span></span> ## TitleMaster <span class="hljs-number"><span class="hljs-number">3.278e+00</span></span> <span class="hljs-number"><span class="hljs-number">8.805e-01</span></span> <span class="hljs-number"><span class="hljs-number">3.722</span></span> <span class="hljs-number"><span class="hljs-number">0.000197</span></span> *** ## TitleMiss -<span class="hljs-number"><span class="hljs-number">1.120e+01</span></span> <span class="hljs-number"><span class="hljs-number">5.354e+02</span></span> -<span class="hljs-number"><span class="hljs-number">0.021</span></span> <span class="hljs-number"><span class="hljs-number">0.983313</span></span> ## TitleMr <span class="hljs-number"><span class="hljs-number">2.480e-01</span></span> <span class="hljs-number"><span class="hljs-number">6.356e-01</span></span> <span class="hljs-number"><span class="hljs-number">0.390</span></span> <span class="hljs-number"><span class="hljs-number">0.696350</span></span> ## TitleMrs -<span class="hljs-number"><span class="hljs-number">1.029e+01</span></span> <span class="hljs-number"><span class="hljs-number">5.354e+02</span></span> -<span class="hljs-number"><span class="hljs-number">0.019</span></span> <span class="hljs-number"><span class="hljs-number">0.984660</span></span> ## Family -<span class="hljs-number"><span class="hljs-number">4.841e-01</span></span> <span class="hljs-number"><span class="hljs-number">1.240e-01</span></span> -<span class="hljs-number"><span class="hljs-number">3.903</span></span> <span class="hljs-number"><span class="hljs-number">9.49e-05</span></span> *** ## isFamilyYes <span class="hljs-number"><span class="hljs-number">2.248e-01</span></span> <span class="hljs-number"><span class="hljs-number">3.513e-01</span></span> <span class="hljs-number"><span class="hljs-number">0.640</span></span> <span class="hljs-number"><span class="hljs-number">0.522266</span></span> ## isCabinYes <span class="hljs-number"><span class="hljs-number">1.060e+00</span></span> <span class="hljs-number"><span class="hljs-number">4.122e-01</span></span> <span class="hljs-number"><span class="hljs-number">2.572</span></span> <span class="hljs-number"><span class="hljs-number">0.010109</span></span> * ## --- ## Signif. codes: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">'***'</span></span> <span class="hljs-number"><span class="hljs-number">0.001</span></span> <span class="hljs-string"><span class="hljs-string">'**'</span></span> <span class="hljs-number"><span class="hljs-number">0.01</span></span> <span class="hljs-string"><span class="hljs-string">'*'</span></span> <span class="hljs-number"><span class="hljs-number">0.05</span></span> <span class="hljs-string"><span class="hljs-string">'.'</span></span> <span class="hljs-number"><span class="hljs-number">0.1</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> ## ## (Dispersion parameter <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> binomial family taken to be <span class="hljs-number"><span class="hljs-number">1</span></span>) ## ## Null deviance: <span class="hljs-number"><span class="hljs-number">950.86</span></span> on <span class="hljs-number"><span class="hljs-number">713</span></span> degrees of freedom ## Residual deviance: <span class="hljs-number"><span class="hljs-number">566.46</span></span> on <span class="hljs-number"><span class="hljs-number">699</span></span> degrees of freedom ## AIC: <span class="hljs-number"><span class="hljs-number">596.46</span></span> ## ## Number of Fisher Scoring iterations: <span class="hljs-number"><span class="hljs-number">12</span></span> &lt;source&gt;  !    <span class="hljs-number"><span class="hljs-number">613</span></span>-<span class="hljs-number"><span class="hljs-number">566</span></span>=<span class="hljs-number"><span class="hljs-number">47</span></span> . ,  ,    , -,   Sex,   , ..  Title        .    Fare, ..         .    Embarked,    . &lt;source code=<span class="hljs-string"><span class="hljs-string">"R"</span></span>&gt; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>.seed(<span class="hljs-number"><span class="hljs-number">111</span></span>) glm.tune.3 &lt;- train(Survived ~ Pclass + Age + I(Embarked==<span class="hljs-string"><span class="hljs-string">"S"</span></span>) + Title + Family + isFamily + isCabin, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = train, method = <span class="hljs-string"><span class="hljs-string">"glm"</span></span>, metric = <span class="hljs-string"><span class="hljs-string">"ROC"</span></span>, trControl = cv_ctrl) glm.tune.3 ## Generalized Linear Model ## ## <span class="hljs-number"><span class="hljs-number">714</span></span> samples ## <span class="hljs-number"><span class="hljs-number">9</span></span> predictor ## <span class="hljs-number"><span class="hljs-number">2</span></span> classes: <span class="hljs-string"><span class="hljs-string">'Died'</span></span>, <span class="hljs-string"><span class="hljs-string">'Survived'</span></span> ## ## No pre-processing ## Resampling: Cross-Validated (<span class="hljs-number"><span class="hljs-number">10</span></span> fold, repeated <span class="hljs-number"><span class="hljs-number">10</span></span> times) ## Summary of sample sizes: <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">642</span></span>, <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">642</span></span>, ... ## Resampling results ## ## ROC Sens Spec ROC SD Sens SD Spec SD ## <span class="hljs-number"><span class="hljs-number">0.8780578</span></span> <span class="hljs-number"><span class="hljs-number">0.8702273</span></span> <span class="hljs-number"><span class="hljs-number">0.7705423</span></span> <span class="hljs-number"><span class="hljs-number">0.03553343</span></span> <span class="hljs-number"><span class="hljs-number">0.04502726</span></span> <span class="hljs-number"><span class="hljs-number">0.07757737</span></span> ## ## summary(glm.tune.3) ## ## Call: ## NULL ## ## Deviance Residuals: ## Min <span class="hljs-number"><span class="hljs-number">1</span></span>Q Median <span class="hljs-number"><span class="hljs-number">3</span></span>Q Max ## -<span class="hljs-number"><span class="hljs-number">2.4508</span></span> -<span class="hljs-number"><span class="hljs-number">0.5286</span></span> -<span class="hljs-number"><span class="hljs-number">0.3522</span></span> <span class="hljs-number"><span class="hljs-number">0.5120</span></span> <span class="hljs-number"><span class="hljs-number">2.5449</span></span> ## ## Coefficients: ## Estimate Std. Error z value Pr(&gt;|z|) ## (Intercept) <span class="hljs-number"><span class="hljs-number">0.55401</span></span> <span class="hljs-number"><span class="hljs-number">0.80063</span></span> <span class="hljs-number"><span class="hljs-number">0.692</span></span> <span class="hljs-number"><span class="hljs-number">0.48896</span></span> ## PclassSecond -<span class="hljs-number"><span class="hljs-number">0.49217</span></span> <span class="hljs-number"><span class="hljs-number">0.44618</span></span> -<span class="hljs-number"><span class="hljs-number">1.103</span></span> <span class="hljs-number"><span class="hljs-number">0.26999</span></span> ## PclassThird -<span class="hljs-number"><span class="hljs-number">1.81552</span></span> <span class="hljs-number"><span class="hljs-number">0.42912</span></span> -<span class="hljs-number"><span class="hljs-number">4.231</span></span> <span class="hljs-number"><span class="hljs-number">2.33e-05</span></span> *** ## Age -<span class="hljs-number"><span class="hljs-number">0.03554</span></span> <span class="hljs-number"><span class="hljs-number">0.01083</span></span> -<span class="hljs-number"><span class="hljs-number">3.281</span></span> <span class="hljs-number"><span class="hljs-number">0.00103</span></span> ** ## `I(Embarked == <span class="hljs-string"><span class="hljs-string">"S"</span></span>)TRUE` -<span class="hljs-number"><span class="hljs-number">0.37801</span></span> <span class="hljs-number"><span class="hljs-number">0.24222</span></span> -<span class="hljs-number"><span class="hljs-number">1.561</span></span> <span class="hljs-number"><span class="hljs-number">0.11862</span></span> ## TitleMaster <span class="hljs-number"><span class="hljs-number">3.06205</span></span> <span class="hljs-number"><span class="hljs-number">0.84703</span></span> <span class="hljs-number"><span class="hljs-number">3.615</span></span> <span class="hljs-number"><span class="hljs-number">0.00030</span></span> *** ## TitleMiss <span class="hljs-number"><span class="hljs-number">2.88073</span></span> <span class="hljs-number"><span class="hljs-number">0.64386</span></span> <span class="hljs-number"><span class="hljs-number">4.474</span></span> <span class="hljs-number"><span class="hljs-number">7.67e-06</span></span> *** ## TitleMr <span class="hljs-number"><span class="hljs-number">0.04083</span></span> <span class="hljs-number"><span class="hljs-number">0.58762</span></span> <span class="hljs-number"><span class="hljs-number">0.069</span></span> <span class="hljs-number"><span class="hljs-number">0.94460</span></span> ## TitleMrs <span class="hljs-number"><span class="hljs-number">3.80377</span></span> <span class="hljs-number"><span class="hljs-number">0.67946</span></span> <span class="hljs-number"><span class="hljs-number">5.598</span></span> <span class="hljs-number"><span class="hljs-number">2.17e-08</span></span> *** ## Family -<span class="hljs-number"><span class="hljs-number">0.48442</span></span> <span class="hljs-number"><span class="hljs-number">0.12274</span></span> -<span class="hljs-number"><span class="hljs-number">3.947</span></span> <span class="hljs-number"><span class="hljs-number">7.93e-05</span></span> *** ## isFamilyYes <span class="hljs-number"><span class="hljs-number">0.22652</span></span> <span class="hljs-number"><span class="hljs-number">0.34724</span></span> <span class="hljs-number"><span class="hljs-number">0.652</span></span> <span class="hljs-number"><span class="hljs-number">0.51418</span></span> ## isCabinYes <span class="hljs-number"><span class="hljs-number">1.08796</span></span> <span class="hljs-number"><span class="hljs-number">0.40990</span></span> <span class="hljs-number"><span class="hljs-number">2.654</span></span> <span class="hljs-number"><span class="hljs-number">0.00795</span></span> ** ## --- ## Signif. codes: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">'***'</span></span> <span class="hljs-number"><span class="hljs-number">0.001</span></span> <span class="hljs-string"><span class="hljs-string">'**'</span></span> <span class="hljs-number"><span class="hljs-number">0.01</span></span> <span class="hljs-string"><span class="hljs-string">'*'</span></span> <span class="hljs-number"><span class="hljs-number">0.05</span></span> <span class="hljs-string"><span class="hljs-string">'.'</span></span> <span class="hljs-number"><span class="hljs-number">0.1</span></span> <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> ## ## (Dispersion parameter <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> binomial family taken to be <span class="hljs-number"><span class="hljs-number">1</span></span>) ## ## Null deviance: <span class="hljs-number"><span class="hljs-number">950.86</span></span> on <span class="hljs-number"><span class="hljs-number">713</span></span> degrees of freedom ## Residual deviance: <span class="hljs-number"><span class="hljs-number">568.64</span></span> on <span class="hljs-number"><span class="hljs-number">702</span></span> degrees of freedom ## AIC: <span class="hljs-number"><span class="hljs-number">592.64</span></span> ## ## Number of Fisher Scoring iterations: <span class="hljs-number"><span class="hljs-number">5</span></span></code> </pre><br><br>   , , , . ,      ROC,  ,               p-value , ,   ,       .     .  isFamily, .. Family      .      ,     .    Title. <br><br><pre> <code class="hljs vhdl">set.seed(<span class="hljs-number"><span class="hljs-number">111</span></span>) glm.tune.<span class="hljs-number"><span class="hljs-number">4</span></span> &lt;- train(Survived ~ I(Pclass==<span class="hljs-string"><span class="hljs-string">"Third"</span></span>) + Age + I(Embarked==<span class="hljs-string"><span class="hljs-string">"S"</span></span>) + I(Title==<span class="hljs-string"><span class="hljs-string">"Master"</span></span>) + I(Title==<span class="hljs-string"><span class="hljs-string">"Miss"</span></span>) + I(Title==<span class="hljs-string"><span class="hljs-string">"Mrs"</span></span>) + Family + isCabin, data = train, method = <span class="hljs-string"><span class="hljs-string">"glm"</span></span>, metric = <span class="hljs-string"><span class="hljs-string">"ROC"</span></span>, trControl = cv_ctrl) glm.tune.<span class="hljs-number"><span class="hljs-number">4</span></span> ## Generalized Linear Model ## ## <span class="hljs-number"><span class="hljs-number">714</span></span> samples ## <span class="hljs-number"><span class="hljs-number">9</span></span> predictor ## <span class="hljs-number"><span class="hljs-number">2</span></span> classes: <span class="hljs-symbol"><span class="hljs-symbol">'Died</span></span>', <span class="hljs-symbol"><span class="hljs-symbol">'Survived</span></span>' ## ## No pre-processing ## Resampling: Cross-Validated (<span class="hljs-number"><span class="hljs-number">10</span></span> fold, repeated <span class="hljs-number"><span class="hljs-number">10</span></span> times) ## Summary <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> sample sizes: <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">642</span></span>, <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">642</span></span>, ... ## Resampling results ## ## ROC Sens Spec ROC SD Sens SD Spec SD ## <span class="hljs-number"><span class="hljs-number">0.8797817</span></span> <span class="hljs-number"><span class="hljs-number">0.8738636</span></span> <span class="hljs-number"><span class="hljs-number">0.7719841</span></span> <span class="hljs-number"><span class="hljs-number">0.03535413</span></span> <span class="hljs-number"><span class="hljs-number">0.04374363</span></span> <span class="hljs-number"><span class="hljs-number">0.0775346</span></span> ## ## summary(glm.tune.<span class="hljs-number"><span class="hljs-number">4</span></span>) ## ## Call: ## <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> ## ## Deviance Residuals: ## Min <span class="hljs-number"><span class="hljs-number">1</span></span>Q Median <span class="hljs-number"><span class="hljs-number">3</span></span>Q Max ## -<span class="hljs-number"><span class="hljs-number">2.4369</span></span> -<span class="hljs-number"><span class="hljs-number">0.5471</span></span> -<span class="hljs-number"><span class="hljs-number">0.3533</span></span> <span class="hljs-number"><span class="hljs-number">0.5098</span></span> <span class="hljs-number"><span class="hljs-number">2.5384</span></span> ## ## Coefficients: ## Estimate Std. <span class="hljs-literal"><span class="hljs-literal">Error</span></span> z value Pr(&gt;|z|) ## (Intercept) <span class="hljs-number"><span class="hljs-number">0.29594</span></span> <span class="hljs-number"><span class="hljs-number">0.46085</span></span> <span class="hljs-number"><span class="hljs-number">0.642</span></span> <span class="hljs-number"><span class="hljs-number">0.520765</span></span> ## `I(Pclass == <span class="hljs-string"><span class="hljs-string">"Third"</span></span>)<span class="hljs-literal"><span class="hljs-literal">TRUE</span></span>` -<span class="hljs-number"><span class="hljs-number">1.46194</span></span> <span class="hljs-number"><span class="hljs-number">0.26518</span></span> -<span class="hljs-number"><span class="hljs-number">5.513</span></span> <span class="hljs-number"><span class="hljs-number">3.53e-08</span></span> *** ## Age -<span class="hljs-number"><span class="hljs-number">0.03469</span></span> <span class="hljs-number"><span class="hljs-number">0.01049</span></span> -<span class="hljs-number"><span class="hljs-number">3.306</span></span> <span class="hljs-number"><span class="hljs-number">0.000946</span></span> *** ## `I(Embarked == <span class="hljs-string"><span class="hljs-string">"S"</span></span>)<span class="hljs-literal"><span class="hljs-literal">TRUE</span></span>` -<span class="hljs-number"><span class="hljs-number">0.45389</span></span> <span class="hljs-number"><span class="hljs-number">0.23350</span></span> -<span class="hljs-number"><span class="hljs-number">1.944</span></span> <span class="hljs-number"><span class="hljs-number">0.051910</span></span> . ## `I(Title == <span class="hljs-string"><span class="hljs-string">"Master"</span></span>)<span class="hljs-literal"><span class="hljs-literal">TRUE</span></span>` <span class="hljs-number"><span class="hljs-number">3.01939</span></span> <span class="hljs-number"><span class="hljs-number">0.59974</span></span> <span class="hljs-number"><span class="hljs-number">5.035</span></span> <span class="hljs-number"><span class="hljs-number">4.79e-07</span></span> *** ## `I(Title == <span class="hljs-string"><span class="hljs-string">"Miss"</span></span>)<span class="hljs-literal"><span class="hljs-literal">TRUE</span></span>` <span class="hljs-number"><span class="hljs-number">2.83185</span></span> <span class="hljs-number"><span class="hljs-number">0.29232</span></span> <span class="hljs-number"><span class="hljs-number">9.687</span></span> &lt; <span class="hljs-number"><span class="hljs-number">2e-16</span></span> *** ## `I(Title == <span class="hljs-string"><span class="hljs-string">"Mrs"</span></span>)<span class="hljs-literal"><span class="hljs-literal">TRUE</span></span>` <span class="hljs-number"><span class="hljs-number">3.80006</span></span> <span class="hljs-number"><span class="hljs-number">0.36823</span></span> <span class="hljs-number"><span class="hljs-number">10.320</span></span> &lt; <span class="hljs-number"><span class="hljs-number">2e-16</span></span> *** ## Family -<span class="hljs-number"><span class="hljs-number">0.42962</span></span> <span class="hljs-number"><span class="hljs-number">0.09269</span></span> -<span class="hljs-number"><span class="hljs-number">4.635</span></span> <span class="hljs-number"><span class="hljs-number">3.57e-06</span></span> *** ## isCabinYes <span class="hljs-number"><span class="hljs-number">1.43072</span></span> <span class="hljs-number"><span class="hljs-number">0.30402</span></span> <span class="hljs-number"><span class="hljs-number">4.706</span></span> <span class="hljs-number"><span class="hljs-number">2.53e-06</span></span> *** ## <span class="hljs-comment"><span class="hljs-comment">--- ## Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 ## ## (Dispersion parameter for binomial family taken to be 1) ## ## Null deviance: 950.86 on 713 degrees of freedom ## Residual deviance: 570.25 on 705 degrees of freedom ## AIC: 588.25 ## ## Number of Fisher Scoring iterations: 5</span></span></code> </pre><br><br>         , ..,      ,      . <br><br><pre> <code class="hljs vhdl">set.seed(<span class="hljs-number"><span class="hljs-number">111</span></span>) glm.tune.<span class="hljs-number"><span class="hljs-number">5</span></span> &lt;- train(Survived ~ Pclass + Age + I(Embarked==<span class="hljs-string"><span class="hljs-string">"S"</span></span>) + I(Title==<span class="hljs-string"><span class="hljs-string">"Master"</span></span>) + I(Title==<span class="hljs-string"><span class="hljs-string">"Miss"</span></span>) + I(Title==<span class="hljs-string"><span class="hljs-string">"Mrs"</span></span>) + Family + isCabin + I(Title==<span class="hljs-string"><span class="hljs-string">"Mr"</span></span>&amp; Pclass==<span class="hljs-string"><span class="hljs-string">"Third"</span></span>), data = train, method = <span class="hljs-string"><span class="hljs-string">"glm"</span></span>, metric = <span class="hljs-string"><span class="hljs-string">"ROC"</span></span>, trControl = cv_ctrl) glm.tune.<span class="hljs-number"><span class="hljs-number">5</span></span> ## Generalized Linear Model ## ## <span class="hljs-number"><span class="hljs-number">714</span></span> samples ## <span class="hljs-number"><span class="hljs-number">9</span></span> predictor ## <span class="hljs-number"><span class="hljs-number">2</span></span> classes: <span class="hljs-symbol"><span class="hljs-symbol">'Died</span></span>', <span class="hljs-symbol"><span class="hljs-symbol">'Survived</span></span>' ## ## No pre-processing ## Resampling: Cross-Validated (<span class="hljs-number"><span class="hljs-number">10</span></span> fold, repeated <span class="hljs-number"><span class="hljs-number">10</span></span> times) ## Summary <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> sample sizes: <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">642</span></span>, <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">642</span></span>, ... ## Resampling results ## ## ROC Sens Spec ROC SD Sens SD Spec SD ## <span class="hljs-number"><span class="hljs-number">0.8814059</span></span> <span class="hljs-number"><span class="hljs-number">0.8981818</span></span> <span class="hljs-number"><span class="hljs-number">0.7201455</span></span> <span class="hljs-number"><span class="hljs-number">0.03712511</span></span> <span class="hljs-number"><span class="hljs-number">0.04155444</span></span> <span class="hljs-number"><span class="hljs-number">0.08581645</span></span> ## ## summary(glm.tune.<span class="hljs-number"><span class="hljs-number">5</span></span>) ## ## Call: ## <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> ## ## Deviance Residuals: ## Min <span class="hljs-number"><span class="hljs-number">1</span></span>Q Median <span class="hljs-number"><span class="hljs-number">3</span></span>Q Max ## -<span class="hljs-number"><span class="hljs-number">2.9364</span></span> -<span class="hljs-number"><span class="hljs-number">0.5340</span></span> -<span class="hljs-number"><span class="hljs-number">0.4037</span></span> <span class="hljs-number"><span class="hljs-number">0.3271</span></span> <span class="hljs-number"><span class="hljs-number">2.5123</span></span> ## ## Coefficients: ## Estimate Std. <span class="hljs-literal"><span class="hljs-literal">Error</span></span> z value ## (Intercept) <span class="hljs-number"><span class="hljs-number">0.52451</span></span> <span class="hljs-number"><span class="hljs-number">0.60337</span></span> <span class="hljs-number"><span class="hljs-number">0.869</span></span> ## PclassSecond -<span class="hljs-number"><span class="hljs-number">0.95649</span></span> <span class="hljs-number"><span class="hljs-number">0.52602</span></span> -<span class="hljs-number"><span class="hljs-number">1.818</span></span> ## PclassThird -<span class="hljs-number"><span class="hljs-number">3.54288</span></span> <span class="hljs-number"><span class="hljs-number">0.66944</span></span> -<span class="hljs-number"><span class="hljs-number">5.292</span></span> ## Age -<span class="hljs-number"><span class="hljs-number">0.03581</span></span> <span class="hljs-number"><span class="hljs-number">0.01126</span></span> -<span class="hljs-number"><span class="hljs-number">3.179</span></span> ## `I(Embarked == <span class="hljs-string"><span class="hljs-string">"S"</span></span>)<span class="hljs-literal"><span class="hljs-literal">TRUE</span></span>` -<span class="hljs-number"><span class="hljs-number">0.46028</span></span> <span class="hljs-number"><span class="hljs-number">0.23707</span></span> -<span class="hljs-number"><span class="hljs-number">1.942</span></span> ## `I(Title == <span class="hljs-string"><span class="hljs-string">"Master"</span></span>)<span class="hljs-literal"><span class="hljs-literal">TRUE</span></span>` <span class="hljs-number"><span class="hljs-number">4.72492</span></span> <span class="hljs-number"><span class="hljs-number">0.80338</span></span> <span class="hljs-number"><span class="hljs-number">5.881</span></span> ## `I(Title == <span class="hljs-string"><span class="hljs-string">"Miss"</span></span>)<span class="hljs-literal"><span class="hljs-literal">TRUE</span></span>` <span class="hljs-number"><span class="hljs-number">4.43875</span></span> <span class="hljs-number"><span class="hljs-number">0.56446</span></span> <span class="hljs-number"><span class="hljs-number">7.864</span></span> ## `I(Title == <span class="hljs-string"><span class="hljs-string">"Mrs"</span></span>)<span class="hljs-literal"><span class="hljs-literal">TRUE</span></span>` <span class="hljs-number"><span class="hljs-number">5.24324</span></span> <span class="hljs-number"><span class="hljs-number">0.58650</span></span> <span class="hljs-number"><span class="hljs-number">8.940</span></span> ## Family -<span class="hljs-number"><span class="hljs-number">0.41607</span></span> <span class="hljs-number"><span class="hljs-number">0.09926</span></span> -<span class="hljs-number"><span class="hljs-number">4.192</span></span> ## isCabinYes <span class="hljs-number"><span class="hljs-number">1.12486</span></span> <span class="hljs-number"><span class="hljs-number">0.42860</span></span> <span class="hljs-number"><span class="hljs-number">2.625</span></span> ## `I(Title == <span class="hljs-string"><span class="hljs-string">"Mr"</span></span> &amp; Pclass == <span class="hljs-string"><span class="hljs-string">"Third"</span></span>)<span class="hljs-literal"><span class="hljs-literal">TRUE</span></span>` <span class="hljs-number"><span class="hljs-number">2.30163</span></span> <span class="hljs-number"><span class="hljs-number">0.59547</span></span> <span class="hljs-number"><span class="hljs-number">3.865</span></span> ## Pr(&gt;|z|) ## (Intercept) <span class="hljs-number"><span class="hljs-number">0.384683</span></span> ## PclassSecond <span class="hljs-number"><span class="hljs-number">0.069012</span></span> . ## PclassThird <span class="hljs-number"><span class="hljs-number">1.21e-07</span></span> *** ## Age <span class="hljs-number"><span class="hljs-number">0.001477</span></span> ** ## `I(Embarked == <span class="hljs-string"><span class="hljs-string">"S"</span></span>)<span class="hljs-literal"><span class="hljs-literal">TRUE</span></span>` <span class="hljs-number"><span class="hljs-number">0.052195</span></span> . ## `I(Title == <span class="hljs-string"><span class="hljs-string">"Master"</span></span>)<span class="hljs-literal"><span class="hljs-literal">TRUE</span></span>` <span class="hljs-number"><span class="hljs-number">4.07e-09</span></span> *** ## `I(Title == <span class="hljs-string"><span class="hljs-string">"Miss"</span></span>)<span class="hljs-literal"><span class="hljs-literal">TRUE</span></span>` <span class="hljs-number"><span class="hljs-number">3.73e-15</span></span> *** ## `I(Title == <span class="hljs-string"><span class="hljs-string">"Mrs"</span></span>)<span class="hljs-literal"><span class="hljs-literal">TRUE</span></span>` &lt; <span class="hljs-number"><span class="hljs-number">2e-16</span></span> *** ## Family <span class="hljs-number"><span class="hljs-number">2.77e-05</span></span> *** ## isCabinYes <span class="hljs-number"><span class="hljs-number">0.008677</span></span> ** ## `I(Title == <span class="hljs-string"><span class="hljs-string">"Mr"</span></span> &amp; Pclass == <span class="hljs-string"><span class="hljs-string">"Third"</span></span>)<span class="hljs-literal"><span class="hljs-literal">TRUE</span></span>` <span class="hljs-number"><span class="hljs-number">0.000111</span></span> *** ## <span class="hljs-comment"><span class="hljs-comment">--- ## Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 ## ## (Dispersion parameter for binomial family taken to be 1) ## ## Null deviance: 950.86 on 713 degrees of freedom ## Residual deviance: 550.82 on 703 degrees of freedom ## AIC: 572.82 ## ## Number of Fisher Scoring iterations: 6</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And we got a significant leap as a model. </font><font style="vertical-align: inherit;">At this stage, we‚Äôll stop with logistic regression and turn to other models. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In particular, to the very popular Random Forest. </font><font style="vertical-align: inherit;">When training this model, you can choose the number of randomly selected, for each of the many trees created, signs - mtry.</font></font><br><br><pre> <code class="hljs kotlin">rf.grid &lt;- <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.frame(.mtry = c(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>.seed(<span class="hljs-number"><span class="hljs-number">111</span></span>) rf.tune &lt;- train(Survived ~ Pclass + Sex + Age + Fare + Embarked + Title + Family + isFamily + isCabin, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> = train, method = <span class="hljs-string"><span class="hljs-string">"rf"</span></span>, metric = <span class="hljs-string"><span class="hljs-string">"ROC"</span></span>, tuneGrid = rf.grid, trControl = cv_ctrl) rf.tune ## Random Forest ## ## <span class="hljs-number"><span class="hljs-number">714</span></span> samples ## <span class="hljs-number"><span class="hljs-number">9</span></span> predictor ## <span class="hljs-number"><span class="hljs-number">2</span></span> classes: <span class="hljs-string"><span class="hljs-string">'Died'</span></span>, <span class="hljs-string"><span class="hljs-string">'Survived'</span></span> ## ## No pre-processing ## Resampling: Cross-Validated (<span class="hljs-number"><span class="hljs-number">10</span></span> fold, repeated <span class="hljs-number"><span class="hljs-number">10</span></span> times) ## Summary of sample sizes: <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">642</span></span>, <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">642</span></span>, ... ## Resampling results across tuning parameters: ## ## mtry ROC Sens Spec ROC SD Sens SD ## <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">0.8710121</span></span> <span class="hljs-number"><span class="hljs-number">0.8861364</span></span> <span class="hljs-number"><span class="hljs-number">0.7230423</span></span> <span class="hljs-number"><span class="hljs-number">0.03912907</span></span> <span class="hljs-number"><span class="hljs-number">0.04551133</span></span> ## <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">0.8723865</span></span> <span class="hljs-number"><span class="hljs-number">0.8929545</span></span> <span class="hljs-number"><span class="hljs-number">0.7021825</span></span> <span class="hljs-number"><span class="hljs-number">0.04049427</span></span> <span class="hljs-number"><span class="hljs-number">0.04467829</span></span> ## <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">0.8719942</span></span> <span class="hljs-number"><span class="hljs-number">0.8893182</span></span> <span class="hljs-number"><span class="hljs-number">0.7079630</span></span> <span class="hljs-number"><span class="hljs-number">0.04063512</span></span> <span class="hljs-number"><span class="hljs-number">0.04632489</span></span> ## Spec SD ## <span class="hljs-number"><span class="hljs-number">0.08343852</span></span> ## <span class="hljs-number"><span class="hljs-number">0.08960364</span></span> ## <span class="hljs-number"><span class="hljs-number">0.08350602</span></span> ## ## ROC was used to select the optimal model using the largest value. ## The <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> value used <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the model was mtry = <span class="hljs-number"><span class="hljs-number">3</span></span>.</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this case, the best performance has a model with mtry equal to 3. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And the last model that will be used in this work is the support vector machine (SVM). </font><font style="vertical-align: inherit;">SVM is sensitive to unnormalized input data, so the preProcess parameter will be used so that the model can be normalized before training the model. </font><font style="vertical-align: inherit;">In SVM, Cost is used as one of the parameters. </font><font style="vertical-align: inherit;">The model will be performed at its 9 different values ‚Äã‚Äãand selected with the best AUC values.</font></font><br><br><pre> <code class="hljs vhdl">set.seed(<span class="hljs-number"><span class="hljs-number">111</span></span>) svm.tune &lt;- train(Survived ~ Pclass + Sex + Age + Fare + Embarked + Title + Family + isFamily + isCabin, data = train, method = <span class="hljs-string"><span class="hljs-string">"svmRadial"</span></span>, tuneLength = <span class="hljs-number"><span class="hljs-number">9</span></span>, preProcess = c(<span class="hljs-string"><span class="hljs-string">"center"</span></span>, <span class="hljs-string"><span class="hljs-string">"scale"</span></span>), metric = <span class="hljs-string"><span class="hljs-string">"ROC"</span></span>, trControl = cv_ctrl) svm.tune ## Support Vector Machines <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Radial Basis <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> Kernel ## ## <span class="hljs-number"><span class="hljs-number">714</span></span> samples ## <span class="hljs-number"><span class="hljs-number">9</span></span> predictor ## <span class="hljs-number"><span class="hljs-number">2</span></span> classes: <span class="hljs-symbol"><span class="hljs-symbol">'Died</span></span>', <span class="hljs-symbol"><span class="hljs-symbol">'Survived</span></span>' ## ## Pre-processing: centered, scaled ## Resampling: Cross-Validated (<span class="hljs-number"><span class="hljs-number">10</span></span> fold, repeated <span class="hljs-number"><span class="hljs-number">10</span></span> times) ## Summary <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> sample sizes: <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">642</span></span>, <span class="hljs-number"><span class="hljs-number">643</span></span>, <span class="hljs-number"><span class="hljs-number">642</span></span>, ... ## Resampling results across tuning parameters: ## ## C ROC Sens Spec ROC SD Sens SD ## <span class="hljs-number"><span class="hljs-number">0.25</span></span> <span class="hljs-number"><span class="hljs-number">0.8578892</span></span> <span class="hljs-number"><span class="hljs-number">0.8893182</span></span> <span class="hljs-number"><span class="hljs-number">0.7026455</span></span> <span class="hljs-number"><span class="hljs-number">0.04086454</span></span> <span class="hljs-number"><span class="hljs-number">0.04863259</span></span> ## <span class="hljs-number"><span class="hljs-number">0.50</span></span> <span class="hljs-number"><span class="hljs-number">0.8599136</span></span> <span class="hljs-number"><span class="hljs-number">0.8956818</span></span> <span class="hljs-number"><span class="hljs-number">0.6862831</span></span> <span class="hljs-number"><span class="hljs-number">0.04005935</span></span> <span class="hljs-number"><span class="hljs-number">0.04952978</span></span> ## <span class="hljs-number"><span class="hljs-number">1.00</span></span> <span class="hljs-number"><span class="hljs-number">0.8544741</span></span> <span class="hljs-number"><span class="hljs-number">0.8945455</span></span> <span class="hljs-number"><span class="hljs-number">0.6877646</span></span> <span class="hljs-number"><span class="hljs-number">0.04193910</span></span> <span class="hljs-number"><span class="hljs-number">0.04470456</span></span> ## <span class="hljs-number"><span class="hljs-number">2.00</span></span> <span class="hljs-number"><span class="hljs-number">0.8469004</span></span> <span class="hljs-number"><span class="hljs-number">0.8943182</span></span> <span class="hljs-number"><span class="hljs-number">0.6814815</span></span> <span class="hljs-number"><span class="hljs-number">0.04342792</span></span> <span class="hljs-number"><span class="hljs-number">0.04595398</span></span> ## <span class="hljs-number"><span class="hljs-number">4.00</span></span> <span class="hljs-number"><span class="hljs-number">0.8379595</span></span> <span class="hljs-number"><span class="hljs-number">0.8925000</span></span> <span class="hljs-number"><span class="hljs-number">0.6781746</span></span> <span class="hljs-number"><span class="hljs-number">0.04709993</span></span> <span class="hljs-number"><span class="hljs-number">0.04450981</span></span> ## <span class="hljs-number"><span class="hljs-number">8.00</span></span> <span class="hljs-number"><span class="hljs-number">0.8299511</span></span> <span class="hljs-number"><span class="hljs-number">0.8877273</span></span> <span class="hljs-number"><span class="hljs-number">0.6769974</span></span> <span class="hljs-number"><span class="hljs-number">0.04692596</span></span> <span class="hljs-number"><span class="hljs-number">0.04403429</span></span> ## <span class="hljs-number"><span class="hljs-number">16.00</span></span> <span class="hljs-number"><span class="hljs-number">0.8273934</span></span> <span class="hljs-number"><span class="hljs-number">0.8818182</span></span> <span class="hljs-number"><span class="hljs-number">0.6758862</span></span> <span class="hljs-number"><span class="hljs-number">0.04636108</span></span> <span class="hljs-number"><span class="hljs-number">0.04499307</span></span> ## <span class="hljs-number"><span class="hljs-number">32.00</span></span> <span class="hljs-number"><span class="hljs-number">0.8206023</span></span> <span class="hljs-number"><span class="hljs-number">0.8756818</span></span> <span class="hljs-number"><span class="hljs-number">0.6769709</span></span> <span class="hljs-number"><span class="hljs-number">0.04665624</span></span> <span class="hljs-number"><span class="hljs-number">0.04339395</span></span> ## <span class="hljs-number"><span class="hljs-number">64.00</span></span> <span class="hljs-number"><span class="hljs-number">0.8121454</span></span> <span class="hljs-number"><span class="hljs-number">0.8704545</span></span> <span class="hljs-number"><span class="hljs-number">0.6710714</span></span> <span class="hljs-number"><span class="hljs-number">0.04718058</span></span> <span class="hljs-number"><span class="hljs-number">0.04664421</span></span> ## Spec SD ## <span class="hljs-number"><span class="hljs-number">0.08976378</span></span> ## <span class="hljs-number"><span class="hljs-number">0.08597689</span></span> ## <span class="hljs-number"><span class="hljs-number">0.08439794</span></span> ## <span class="hljs-number"><span class="hljs-number">0.08532505</span></span> ## <span class="hljs-number"><span class="hljs-number">0.08531935</span></span> ## <span class="hljs-number"><span class="hljs-number">0.08434585</span></span> ## <span class="hljs-number"><span class="hljs-number">0.07958467</span></span> ## <span class="hljs-number"><span class="hljs-number">0.07687452</span></span> ## <span class="hljs-number"><span class="hljs-number">0.07680478</span></span> ## ## Tuning <span class="hljs-keyword"><span class="hljs-keyword">parameter</span></span> <span class="hljs-symbol"><span class="hljs-symbol">'sigma</span></span>' was held <span class="hljs-keyword"><span class="hljs-keyword">constant</span></span> at a value <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-number"><span class="hljs-number">0.1001103</span></span> ## ROC was used <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> the optimal model using the largest value. ## The final values used <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the model were sigma = <span class="hljs-number"><span class="hljs-number">0.1001103</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> C = <span class="hljs-number"><span class="hljs-number">0.5</span></span>. plot(svm.tune)</code> </pre><br><br><img src="https://habrastorage.org/files/d2d/78d/965/d2d78d9659864586bb7009da6f9cd6eb.png"><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Model evaluation </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For all three models created, we will evaluate using the intersection of the predicted values ‚Äã‚Äãand the real values ‚Äã‚Äãof the target characteristic predicted on the test sample. </font><font style="vertical-align: inherit;">Caret's confusionMatrix makes this easy to do.</font></font><br><br><pre> <code class="hljs pgsql">glm.pred &lt;- predict(glm.tune<span class="hljs-number"><span class="hljs-number">.4</span></span>, test) confusionMatrix(glm.pred, test$Survived) ## Confusion Matrix <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Statistics</span></span> ## ## Reference ## Prediction Died Survived ## Died <span class="hljs-number"><span class="hljs-number">92</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> ## Survived <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">53</span></span> ## ## Accuracy : <span class="hljs-number"><span class="hljs-number">0.8192</span></span> ## <span class="hljs-number"><span class="hljs-number">95</span></span>% CI : (<span class="hljs-number"><span class="hljs-number">0.7545</span></span>, <span class="hljs-number"><span class="hljs-number">0.8729</span></span>) ## <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> Information Rate : <span class="hljs-number"><span class="hljs-number">0.6158</span></span> ## P-<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span> [Acc &gt; NIR] : <span class="hljs-number"><span class="hljs-number">3.784e-09</span></span> ## ## Kappa : <span class="hljs-number"><span class="hljs-number">0.62</span></span> ## Mcnemar<span class="hljs-string"><span class="hljs-string">'s Test P-Value : 0.8597 ## ## Sensitivity : 0.8440 ## Specificity : 0.7794 ## Pos Pred Value : 0.8598 ## Neg Pred Value : 0.7571 ## Prevalence : 0.6158 ## Detection Rate : 0.5198 ## Detection Prevalence : 0.6045 ## Balanced Accuracy : 0.8117 ## ## '</span></span>Positiv<span class="hljs-string"><span class="hljs-string">e' Class : Died ## rf.pred &lt;- predict(rf.tune, test) confusionMatrix(rf.pred, test$Survived) ## Confusion Matrix and Statistics ## ## Reference ## Prediction Died Survived ## Died 103 18 ## Survived 6 50 ## ## Accuracy : 0.8644 ## 95% CI : (0.805, 0.9112) ## No Information Rate : 0.6158 ## P-Value [Acc &gt; NIR] : 2.439e-13 ## ## Kappa : 0.7036 ## Mcnemar'</span></span>s Test P-<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span> : <span class="hljs-number"><span class="hljs-number">0.02474</span></span> ## ## Sensitivity : <span class="hljs-number"><span class="hljs-number">0.9450</span></span> ## Specificity : <span class="hljs-number"><span class="hljs-number">0.7353</span></span> ## Pos Pred <span class="hljs-keyword"><span class="hljs-keyword">Value</span></span> : <span class="hljs-number"><span class="hljs-number">0.8512</span></span> ## Neg Pred <span class="hljs-keyword"><span class="hljs-keyword">Value</span></span> : <span class="hljs-number"><span class="hljs-number">0.8929</span></span> ## Prevalence : <span class="hljs-number"><span class="hljs-number">0.6158</span></span> ## Detection Rate : <span class="hljs-number"><span class="hljs-number">0.5819</span></span> ## Detection Prevalence : <span class="hljs-number"><span class="hljs-number">0.6836</span></span> ## Balanced Accuracy : <span class="hljs-number"><span class="hljs-number">0.8401</span></span> ## ## <span class="hljs-string"><span class="hljs-string">'Positive'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Class</span></span> : Died ## svm.pred &lt;- predict(svm.tune, test) confusionMatrix(svm.pred, test$Survived) ## Confusion Matrix <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Statistics</span></span> ## ## Reference ## Prediction Died Survived ## Died <span class="hljs-number"><span class="hljs-number">101</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> ## Survived <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">51</span></span> ## ## Accuracy : <span class="hljs-number"><span class="hljs-number">0.8588</span></span> ## <span class="hljs-number"><span class="hljs-number">95</span></span>% CI : (<span class="hljs-number"><span class="hljs-number">0.7986</span></span>, <span class="hljs-number"><span class="hljs-number">0.9065</span></span>) ## <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> Information Rate : <span class="hljs-number"><span class="hljs-number">0.6158</span></span> ## P-<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span> [Acc &gt; NIR] : <span class="hljs-number"><span class="hljs-number">9.459e-13</span></span> ## ## Kappa : <span class="hljs-number"><span class="hljs-number">0.6939</span></span> ## Mcnemar<span class="hljs-string"><span class="hljs-string">'s Test P-Value : 0.1096 ## ## Sensitivity : 0.9266 ## Specificity : 0.7500 ## Pos Pred Value : 0.8559 ## Neg Pred Value : 0.8644 ## Prevalence : 0.6158 ## Detection Rate : 0.5706 ## Detection Prevalence : 0.6667 ## Balanced Accuracy : 0.8383 ## ## '</span></span>Positiv<span class="hljs-string"><span class="hljs-string">e' Class : Died ##</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Random Forest shows the best result in predicting the dead - an indicator of Sensitivity. </font><font style="vertical-align: inherit;">And logistic regression in predicting survivors is an indicator of Specificity. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's draw on the same graph the ROC curves on the test data for all the models created.</font></font><br><br><pre> <code class="hljs mel">require(pROC) glm.probs &lt;- predict(glm.tune<span class="hljs-number"><span class="hljs-number">.5</span></span>, test, type = <span class="hljs-string"><span class="hljs-string">"prob"</span></span>) glm.ROC &lt;- roc(response = test$Survived, predictor = glm.probs$Survived, levels = levels(test$Survived)) glm.ROC$auc ## Area under the <span class="hljs-keyword"><span class="hljs-keyword">curve</span></span>: <span class="hljs-number"><span class="hljs-number">0.8546</span></span> plot(glm.ROC, type=<span class="hljs-string"><span class="hljs-string">"S"</span></span>) ## ## Call: ## roc.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(response = test$Survived, predictor = glm.probs$Survived, levels = levels(test$Survived)) ## ## Data: glm.probs$Survived <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">109</span></span> controls (test$Survived Died) &lt; <span class="hljs-number"><span class="hljs-number">68</span></span> cases (test$Survived Survived). ## Area under the <span class="hljs-keyword"><span class="hljs-keyword">curve</span></span>: <span class="hljs-number"><span class="hljs-number">0.8546</span></span> rf.probs &lt;- predict(rf.tune, test, type = <span class="hljs-string"><span class="hljs-string">"prob"</span></span>) rf.ROC &lt;- roc(response = test$Survived, predictor = rf.probs$Survived, levels = levels(test$Survived)) rf.ROC$auc ## Area under the <span class="hljs-keyword"><span class="hljs-keyword">curve</span></span>: <span class="hljs-number"><span class="hljs-number">0.8854</span></span> plot(rf.ROC, add=TRUE, col=<span class="hljs-string"><span class="hljs-string">"red"</span></span>) ## ## Call: ## roc.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(response = test$Survived, predictor = rf.probs$Survived, levels = levels(test$Survived)) ## ## Data: rf.probs$Survived <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">109</span></span> controls (test$Survived Died) &lt; <span class="hljs-number"><span class="hljs-number">68</span></span> cases (test$Survived Survived). ## Area under the <span class="hljs-keyword"><span class="hljs-keyword">curve</span></span>: <span class="hljs-number"><span class="hljs-number">0.8854</span></span> svm.probs &lt;- predict(svm.tune, test, type = <span class="hljs-string"><span class="hljs-string">"prob"</span></span>) svm.ROC &lt;- roc(response = test$Survived, predictor = svm.probs$Survived, levels = levels(test$Survived)) svm.ROC$auc ## Area under the <span class="hljs-keyword"><span class="hljs-keyword">curve</span></span>: <span class="hljs-number"><span class="hljs-number">0.8714</span></span> plot(svm.ROC, add=TRUE, col=<span class="hljs-string"><span class="hljs-string">"blue"</span></span>)</code> </pre><br><br><img src="https://habrastorage.org/files/8c8/5a5/0f4/8c85a50f4b2a40949ce530cda8989778.png"><br><br><pre> <code class="hljs mel">## ## Call: ## roc.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(response = test$Survived, predictor = svm.probs$Survived, levels = levels(test$Survived)) ## ## Data: svm.probs$Survived <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">109</span></span> controls (test$Survived Died) &lt; <span class="hljs-number"><span class="hljs-number">68</span></span> cases (test$Survived Survived). ## Area under the <span class="hljs-keyword"><span class="hljs-keyword">curve</span></span>: <span class="hljs-number"><span class="hljs-number">0.8714</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">According to AUC statistics, Random Forest leads, but these are the results of a single application of the model on a test sample. </font><font style="vertical-align: inherit;">If we collect these statistics by resampling, the result will be different, as shown in the following graph.</font></font><br><br><pre> <code class="hljs pgsql">resamps &lt;- resamples(list(Logit = glm.tune<span class="hljs-number"><span class="hljs-number">.5</span></span>, RF = rf.tune, SVM = svm.tune)) <span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>(resamps) ## ## <span class="hljs-keyword"><span class="hljs-keyword">Call</span></span>: ## <span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>.resamples(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> = resamps) ## ## Models: Logit, RF, SVM ## Number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> resamples: <span class="hljs-number"><span class="hljs-number">100</span></span> ## ## ROC ## Min. <span class="hljs-number"><span class="hljs-number">1</span></span>st Qu. Median Mean <span class="hljs-number"><span class="hljs-number">3</span></span>rd Qu. Max. NA<span class="hljs-string"><span class="hljs-string">'s ## Logit 0.7816 0.8608 0.8845 0.8814 0.9064 0.9558 0 ## RF 0.7715 0.8454 0.8732 0.8724 0.9048 0.9474 0 ## SVM 0.7593 0.8364 0.8620 0.8599 0.8845 0.9381 0 ## ## Sens ## Min. 1st Qu. Median Mean 3rd Qu. Max. NA'</span></span>s ## Logit <span class="hljs-number"><span class="hljs-number">0.7955</span></span> <span class="hljs-number"><span class="hljs-number">0.8636</span></span> <span class="hljs-number"><span class="hljs-number">0.8864</span></span> <span class="hljs-number"><span class="hljs-number">0.8982</span></span> <span class="hljs-number"><span class="hljs-number">0.9318</span></span> <span class="hljs-number"><span class="hljs-number">1.0000</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ## RF <span class="hljs-number"><span class="hljs-number">0.7955</span></span> <span class="hljs-number"><span class="hljs-number">0.8636</span></span> <span class="hljs-number"><span class="hljs-number">0.9091</span></span> <span class="hljs-number"><span class="hljs-number">0.8930</span></span> <span class="hljs-number"><span class="hljs-number">0.9318</span></span> <span class="hljs-number"><span class="hljs-number">0.9773</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ## SVM <span class="hljs-number"><span class="hljs-number">0.7727</span></span> <span class="hljs-number"><span class="hljs-number">0.8636</span></span> <span class="hljs-number"><span class="hljs-number">0.9091</span></span> <span class="hljs-number"><span class="hljs-number">0.8957</span></span> <span class="hljs-number"><span class="hljs-number">0.9318</span></span> <span class="hljs-number"><span class="hljs-number">1.0000</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ## ## Spec ## Min. <span class="hljs-number"><span class="hljs-number">1</span></span>st Qu. Median Mean <span class="hljs-number"><span class="hljs-number">3</span></span>rd Qu. Max. NA<span class="hljs-string"><span class="hljs-string">'s ## Logit 0.4286 0.6667 0.7275 0.7201 0.7857 0.8889 0 ## RF 0.4815 0.6296 0.7037 0.7022 0.7778 0.8889 0 ## SVM 0.5000 0.6296 0.6786 0.6863 0.7500 0.8889 0 dotplot(resamps, metric = "ROC")</span></span></code> </pre><br><br><img src="https://habrastorage.org/files/876/258/8cf/8762588cffe24d2bbf4e401238eb9f6d.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And finally, the last schedule of this work. </font><font style="vertical-align: inherit;">This is a summary of the models for the three statistics: ROC, Sensitivity and Specificity.</font></font><br><br><pre> <code class="hljs lisp">bwplot(<span class="hljs-name"><span class="hljs-name">resamps</span></span>, layout = c(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>))</code> </pre><br><br><img src="https://habrastorage.org/files/7b5/b44/36d/7b5b4436d79f4ac0a0159f9ece655e4a.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It can be concluded that all three models better predict the dead than the survivors (respectively, statistics Sensitivity and Specificity). </font><font style="vertical-align: inherit;">But, in general, the statistical results of the models are not significantly different from each other. </font><font style="vertical-align: inherit;">But, from the point of view of simplicity of the model and generalizing properties, I believe that the best results on a new unknown sample on average should be shown by logistic regression.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Using results for Kaggle </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The next block of code applies the selected model to the estimated data and creates a file for uploading to the site. </font></font><br><br><pre> <code class="hljs mel">data_test$Cabin &lt;- recode(data_test$Cabin, <span class="hljs-string"><span class="hljs-string">"'' = NA"</span></span>) data_test$Embarked &lt;- recode(data_test$Embarked, <span class="hljs-string"><span class="hljs-string">"'' = NA"</span></span>) data_test %&lt;&gt;% transform(.,Pclass = as.factor(Pclass), Sex = as.factor(Sex), Embarked = as.factor(Embarked), SibSp = as.numeric(SibSp)) data_test$Embarked[is.na(data_test$Embarked)] &lt;- <span class="hljs-string"><span class="hljs-string">"S"</span></span> data_test$Title &lt;- data_test$Name %&gt;% str_extract(., <span class="hljs-string"><span class="hljs-string">"\\w+\\."</span></span>) %&gt;% str_sub(.,<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">-2</span></span>) data_test %&gt;% group_by(Title) %&gt;% summarise(count = n(), Missing = sum(is.na(Age)), Mean = round(mean(Age, na.rm = T), <span class="hljs-number"><span class="hljs-number">2</span></span>)) impute.mean.test &lt;- function (impute_col, filter_var, var_levels) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (lev <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> var_levels) { impute_col[(filter_var == lev) &amp; is.na(impute_col)] &lt;- mean_title$Mean[mean_title$Title == lev] #mean(impute_col[filter_var == lev], na.rm = T) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (impute_col) } data_test$Age &lt;- impute.mean.test(data_test$Age, data_test$Title, c(<span class="hljs-string"><span class="hljs-string">"Ms"</span></span>, <span class="hljs-string"><span class="hljs-string">"Master"</span></span>, <span class="hljs-string"><span class="hljs-string">"Mrs"</span></span>, <span class="hljs-string"><span class="hljs-string">"Miss"</span></span>, <span class="hljs-string"><span class="hljs-string">"Mr"</span></span>)) data_test$Fare[data_test$Fare == <span class="hljs-number"><span class="hljs-number">0</span></span>] &lt;- NA data_test$Fare &lt;- impute.mean(data_test$Fare, data_test$Pclass, as.numeric(levels(data_test$Pclass))) data_test$Title &lt;- change.titles(data_test, c(<span class="hljs-string"><span class="hljs-string">"Capt"</span></span>, <span class="hljs-string"><span class="hljs-string">"Col"</span></span>, <span class="hljs-string"><span class="hljs-string">"Don"</span></span>, <span class="hljs-string"><span class="hljs-string">"Dr"</span></span>, <span class="hljs-string"><span class="hljs-string">"Jonkheer"</span></span>, <span class="hljs-string"><span class="hljs-string">"Lady"</span></span>, <span class="hljs-string"><span class="hljs-string">"Major"</span></span>, <span class="hljs-string"><span class="hljs-string">"Rev"</span></span>, <span class="hljs-string"><span class="hljs-string">"Sir"</span></span>, <span class="hljs-string"><span class="hljs-string">"Countess"</span></span>, <span class="hljs-string"><span class="hljs-string">"Dona"</span></span>), <span class="hljs-string"><span class="hljs-string">"Aristocratic"</span></span>) data_test$Title &lt;- change.titles(data_test, c(<span class="hljs-string"><span class="hljs-string">"Ms"</span></span>), <span class="hljs-string"><span class="hljs-string">"Mrs"</span></span>) data_test$Title &lt;- change.titles(data_test, c(<span class="hljs-string"><span class="hljs-string">"Mlle"</span></span>, <span class="hljs-string"><span class="hljs-string">"Mme"</span></span>), <span class="hljs-string"><span class="hljs-string">"Miss"</span></span>) data_test$Title &lt;- as.factor(data_test$Title) data_test$Family &lt;- data_test$SibSp + data_test$Parch data_test$isFamily &lt;- as.factor(as.numeric(data_test$Family &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>)) data_test$isCabin &lt;- factor(ifelse(is.na(data_test$Cabin),<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) data_test %&lt;&gt;% <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>(PassengerId, Pclass, Sex, Age, Fare, Embarked, Title, Family, isFamily, isCabin) data_test$Pclass %&lt;&gt;% revalue(., c(<span class="hljs-string"><span class="hljs-string">"1"</span></span>=<span class="hljs-string"><span class="hljs-string">"First"</span></span>, <span class="hljs-string"><span class="hljs-string">"2"</span></span>=<span class="hljs-string"><span class="hljs-string">"Second"</span></span>, <span class="hljs-string"><span class="hljs-string">"3"</span></span>=<span class="hljs-string"><span class="hljs-string">"Third"</span></span>)) data_test$Sex %&lt;&gt;% revalue(., c(<span class="hljs-string"><span class="hljs-string">"female"</span></span>=<span class="hljs-string"><span class="hljs-string">"Female"</span></span>, <span class="hljs-string"><span class="hljs-string">"male"</span></span>=<span class="hljs-string"><span class="hljs-string">"Male"</span></span>)) data_test$isFamily %&lt;&gt;% revalue(., c(<span class="hljs-string"><span class="hljs-string">"0"</span></span>=<span class="hljs-string"><span class="hljs-string">"No"</span></span>, <span class="hljs-string"><span class="hljs-string">"1"</span></span>=<span class="hljs-string"><span class="hljs-string">"Yes"</span></span>)) data_test$isCabin %&lt;&gt;% revalue(., c(<span class="hljs-string"><span class="hljs-string">"0"</span></span>=<span class="hljs-string"><span class="hljs-string">"No"</span></span>, <span class="hljs-string"><span class="hljs-string">"1"</span></span>=<span class="hljs-string"><span class="hljs-string">"Yes"</span></span>)) Survived &lt;- predict(svm.tune, newdata = data_test) Survived &lt;- revalue(Survived, c(<span class="hljs-string"><span class="hljs-string">"Survived"</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"Died"</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>)) predictions &lt;- as.data.frame(Survived) predictions$PassengerId &lt;- data_test$PassengerId write.csv(predictions[,c(<span class="hljs-string"><span class="hljs-string">"PassengerId"</span></span>, <span class="hljs-string"><span class="hljs-string">"Survived"</span></span>)], <span class="hljs-keyword"><span class="hljs-keyword">file</span></span>=<span class="hljs-string"><span class="hljs-string">"Titanic_predictions.csv"</span></span>, row.names=FALSE, quote=FALSE)</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After downloading the results of applying models to Kaggle, the SVM model showed the best results. </font><font style="vertical-align: inherit;">Entering at the time of writing this work in the top 10% of the results, but, because </font><font style="vertical-align: inherit;">before the end of the competition, the model is evaluated only in part of the data, then the final results can be very different, and both for the better and for the worse. </font><font style="vertical-align: inherit;">Below are the results of evaluating models on Public data.</font></font><br><br><table><tbody><tr><td>  <b>Model</b> </td><td> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Public score</font></font></b> </td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SVM </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0.81340 </font></font></td></tr><tr><td>  Random forest </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0.78947 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Logit </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 0.77512 </font></font></td></tr></tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thanks to everyone who was able to finish reading this post to the end!) I remind you that until November 30, </font></font><a href="http://dscourse.mlclass.ru/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">you can still receive course materials</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on data analysis from the </font><a href="http://mlclass.ru/"><font style="vertical-align: inherit;">MLClass</font></a><font style="vertical-align: inherit;"> project</font></font><a href="http://mlclass.ru/"><font style="vertical-align: inherit;"></font></a> </div><p>Source: <a href="https://habr.com/ru/post/270973/">https://habr.com/ru/post/270973/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270961/index.html">Financial Transmission Ways # 4: ASTS Bridge Protocol</a></li>
<li><a href="../270965/index.html">Those village from zero to one. Now and with reviews of companies</a></li>
<li><a href="../270967/index.html">NUnit 3.0 released</a></li>
<li><a href="../270969/index.html">Restoring access rights for Mac OS X - EL Capitan</a></li>
<li><a href="../270971/index.html">Travel startups. How programmers on a trillionth market are lured: kofounders, vacancies, hackathons</a></li>
<li><a href="../270975/index.html">Introduction to RxJava: Subscription Life Cycle</a></li>
<li><a href="../270977/index.html">Be in the "working group" from the very beginning</a></li>
<li><a href="../270979/index.html">Automatic calculation of computable properties of view models in .NET</a></li>
<li><a href="../270981/index.html">Better or worse</a></li>
<li><a href="../270985/index.html">MBLTdev Live Broadcast</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>