<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How MikroTik sees neighbors. Neighbor discovery update in RouterOS 6.38</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The service of detecting neighboring routers and compatible equipment has been present in RouterOS for a long time. Unfortunately, comrades admins rar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How MikroTik sees neighbors. Neighbor discovery update in RouterOS 6.38</h1><div class="post__text post__text-html js-mediator-article">  The service of detecting neighboring routers and compatible equipment has been present in RouterOS for a long time.  Unfortunately, comrades admins rarely think about the <b>‚ÄúNeighbor Discovery‚Äù</b> operating scheme.  It seems as if everything is simple, but just not as it seems. <br><br>  The unsuccessful attempts to hide the information about your MikroTik router, while receiving information about the routers of the neighbors within the provider‚Äôs broadcast-domain, serve as a graphic illustration.  So to speak, to spy on the neighbors on the provider switch.  This usually looks like a firewall's ban on sending discovery UDP service announcement 255.255.255.255,5678.  Having driven the prohibiting rule into the firewall configuration, some believe that they have completely hidden their router from being visible to their neighbors.  But it is not. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b2f/05b/a7a/b2f05ba7a2124bd4bef70249e09532ac.jpg" alt="image"></div><br><a name="habracut"></a><br><hr><br>  Let's see <b>how Neighbor Discovery works in MikroTik.</b> <br>  Neighbor Discovery in RouterOS <u>up to 6.38</u> contains two ways to advertise and retrieve information that work at different levels of the OSI model: the UDP transport operates on the L4 level, and the MNDP / VDP / CDP family of information on the L2 level receives and transmits it.  Information obtained from both sources is combined and displayed in the list of detected neighbors ‚Äú <i>/ ip neighbors</i> ‚Äù.  This is what Neighbor Discovery looks like in the current release: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/files/00e/0d9/532/00e0d9532fc345a6b06eeb11bc997ccb.jpg" alt="image"></div><br>  Thus, by simply prohibiting the sending of UDP packets to port 5678, it is impossible to hide information about the router.  You must either completely disable the Neighbors service on the interface with the command / ip neighbor discovery set ether1-gateway discover = no, or filter outgoing L2 traffic for MNDP packets using bridge filters.  For example, like this: <br><br><pre><code class="hljs sql">/interface bridge filter add action=<span class="hljs-keyword"><span class="hljs-keyword">drop</span></span> <span class="hljs-keyword"><span class="hljs-keyword">chain</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">output</span></span> disabled=<span class="hljs-keyword"><span class="hljs-keyword">no</span></span> dst-mac-address=<span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>C:CC:CC:CC/FF:FF:FF:FF:FF:FF <span class="hljs-keyword"><span class="hljs-keyword">out</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=ether1-gateway.</code> </pre> <br>  Now a new version of RouterOS 6.38 is being prepared for release, and finally something happened in it that the <s>Bolsheviks had been talking</s> about for <s>so long the</s> administrators of many countries asked.  At 6.38 a good bun is finally added in the form of support for the open protocol <a href="https://ru.wikipedia.org/wiki/LLDP">LLDP</a> .  This further expands the capabilities of the equipment in terms of monitoring the state of the L2 connection.  Now you can see any LLDP-compatible equipment in the list of neighbors, provided that it also includes support for LLDP ads.  For example, now my test router perfectly ‚Äúsees‚Äù the neighboring switch HP v1905-24 <br><br><img src="https://habrastorage.org/files/5f4/ef3/c94/5f4ef3c94a4e44d298b5d28d1aec94c9.jpg" alt="image"><br><br><div class="spoiler">  <b class="spoiler_title">Do not forget to enable LLDP on switch HP v1905-24</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/ce9/ec2/af6/ce9ec2af60b7483ca2074a4369f9dcf0.jpg" alt="image"><br></div></div><br>  While information is received and transmitted a little, but for monitoring the presence / absence of visibility on L2 is enough.  I note that LLDP support did not replace other protocols, but was added to the list of supported in MikroTik Discovery and starting from 6.38 it will look like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/44a/63c/a35/44a63ca35162417a8ec2add45683e698.jpg" alt="image"></div><br>  The official <a href="http://wiki.mikrotik.com/wiki/Manual:IP/Neighbor_discovery">WiKi MikroTik</a> has already added information about the information received and transmitted by RouterOS via LLDP. <br><br>  <i>RouterOS sends out:</i> <i><br><br></i>  <i>Chassis subtype (MAC)</i> <i><br></i> <ul><li>  <i>Port subtype (interface name)</i> </li><li>  <i>TTL</i> </li><li>  <i>System name (system identity)</i> </li><li>  <i>Sys description ({platform} RouterOS {osvers} {boardName})</i> </li><li>  <i>All IP addresses are configured on the port.</i> </li></ul> <i><br></i>  <i>RouterOS accepts and processes:</i> <i><br></i> <ul><li>  <i>identity (LLDP_TYPE_SYS_NAME)</i> </li><li>  <i>interfaceName (depending on the priority, if one is the empty checks the next: LLDP_TYPE_CHASSIS_ID, LLDP_TYPE_PORT_ID, LLDP_TYPE_PORT_DESC)</i> </li><li>  <i>ip4 (first entry of IPv4 LLDP_TYPE_MANAGEMENT_ADDR)</i> </li><li>  <i>ip6 (first entry of IPv6 LLDP_TYPE_MANAGEMENT_ADDR)</i> </li><li>  <i>TTL (LLDP_TYPE_TTL)</i> </li><li>  <i>MAC (Source - 6-11 byte)</i> </li></ul><br>  Well, well, we are waiting for the official release and carefully monitor the test devices - for that, the status of 6.38 is still ‚Äúrc‚Äù. </div><p>Source: <a href="https://habr.com/ru/post/312236/">https://habr.com/ru/post/312236/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../312226/index.html">ASP.NET Core Path [Level 1] Basics</a></li>
<li><a href="../312228/index.html">Installing Canon LBP series printers in Ubuntu</a></li>
<li><a href="../312230/index.html">Intellect cards: 5 ways that helped me turn chaos into order</a></li>
<li><a href="../312232/index.html">4 main lessons that we learned when starting our first service</a></li>
<li><a href="../312234/index.html">Kryptonomicon: great accordion, hello from the 90s and the best book about techies</a></li>
<li><a href="../312238/index.html">Bram Cohen: I wrote BitTorrent sitting in the living room, unemployed, in shorts</a></li>
<li><a href="../312240/index.html">Filter events by categories in the Event Map report</a></li>
<li><a href="../312248/index.html">Feedback on Growing Object-Oriented Software, Guided by Tests</a></li>
<li><a href="../312250/index.html">Open access to the tool for compiling lists of English words from films, books and articles</a></li>
<li><a href="../312256/index.html">LINQ: Dynamic Query Filtering</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>