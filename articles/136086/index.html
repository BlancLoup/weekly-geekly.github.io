<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ruby on Rails on Windows with performance tests</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚ÄúThe pledge of friendship is the difference of individuals‚Äù Julian Semenov.  More and more, Windows developers are interested in Ruby, a dynamic high-...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ruby on Rails on Windows with performance tests</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  ‚ÄúThe pledge of friendship is the difference of individuals‚Äù Julian Semenov. </blockquote>  More and more, Windows developers are interested in Ruby, a dynamic high-level programming language.  The framework for creating Ruby on Rails web applications has played a significant role here.  Development on the "rails" is simple and exciting.  Due to the high dynamics of Ruby, the developer opens a lot of tools, with a relatively small amount of code, you get rich functionality. <br><br>  This article is well-suited for novice web programmers and those who are thinking of starting to work with Ruby on Rails.  It will address such questions: <ul><li>  installation of the working environment; </li><li>  writing a simple application; </li><li>  Deploying the application to the server. </li></ul>  Finally, you will find tests comparing the performance of various variants of running Ruby applications on Windows and Ubuntu. <a name="habracut"></a><br><br><h2>  Setting the working environment </h2>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      First you need to download and install the Web Platform Installer, run it, click on ‚ÄúOptions‚Äù and in the ‚ÄúDisplay additional scenarios‚Äù field add a link to the Helicon Zoo Feed: http://www.helicontech.com/zoo/feed/ <br><br><img src="https://habrastorage.org/storage2/60f/573/f78/60f573f7838aa4af2084df74813c0a6c.png"><br><br>  After that, the Zoo tab will appear in the Web Platform Installer, which contains the ‚ÄúApplications‚Äù, ‚ÄúPackages‚Äù, ‚ÄúModules‚Äù, and ‚ÄúEngines‚Äù sections: <br><br><img src="https://habrastorage.org/storage2/011/b25/b8e/011b25b8e97c6a237aa997b1b66c4b0e.png"><br><br><h2>  Installing Ruby on Rails </h2><br><br>  In the "Engines" section, you can install various frameworks, including Ruby on Rails 3.1 and 2.3.  In addition, Ruby 1.8 and 1.9 are also available here.  By default, installing Rails 3 puts Ruby 1.9 as a dependency.  For Rails 2, Ruby 1.8 will be shipped. <br><br>  For convenience, the Packages section offers the Ruby Hosting Package, which includes the following components: <ul><li>  Ruby 1.8.7 and Ruby 1.9.3; </li><li>  Rails 2.3.11, 3.0.10 and 3.1; </li><li>  Ruby DevKit (for building C extensions); </li><li>  Popular jams: mysql2, pg, sqlite3, mongo_mapper, tiny_tds, activerecord-sqlserver-adapter, devise, authlogic, jekyll, formtastic, will_paginate, sinatra, ramaze, camping-omnibus, thin, goliath. </li></ul><img src="https://habrastorage.org/storage2/b6a/36d/46a/b6a36d46ac8054f7c64904f8e31527b9.png"><br><br><h2>  Creation of the first website </h2><br><br>  To create a new web application, it is convenient to use WebMatrix and IIS Express.  On the ‚ÄúZoo‚Äù tab, in the ‚ÄúPackages‚Äù section, there is the ‚ÄúWebMatrix Templates‚Äù package, which provides various templates-blanks, including for Ruby on Rails. <br><br>  If you do not already have WebMatrix, it will be automatically installed along with the WebMatrix Templates package.  Be prepared that downloading and installing all the packages may take some time. After installing the templates, start WebMatrix and on the start page select "Site from template" and then "Rails Site": <br><br><img src="https://habrastorage.org/storage2/54b/c16/015/54bc160157045309ea0b891b6185a303.png"><br><br>  After creating the Rails Site, if you go to the specified URL or click "Run", you will see a page with instructions: <br><br><img src="https://habrastorage.org/storage2/83e/8c9/a68/83e8c9a682e943024d9653bd5a4acf9b.png"><br><br>  The template is designed to create Rails application branches 2.3, 3.0 or 3.1.  At the moment, there is no application in the site directory yet, only the prepared configuration files.  Let's create it by calling the following command: <br><br> <code>rails new .</code> <br> <br>  If the team does not specify a specific version of Rails, the latest available will be used.  In our case, we used the ‚ÄúRuby Hosting Package‚Äù package, which contains three different versions of Rails at once, and the most recent of them is 3.1.  Therefore, the team will create a stub based on Rails 3.1. <br><br>  Now if you refresh the page, you will see the standard Ruby on Rails greeting: <br><br><img src="https://habrastorage.org/storage2/2aa/d01/ee0/2aad01ee097281288b903fd39927a9d7.png"><br><br><h2>  Development environment </h2><br><br>  To edit the code you need an editor or development environment.  If you prefer the functionality of a full-fledged IDE, with a debugger and means for refactoring, you can consider the following programs: <ul><li>  Aptana (free, <a href="http://aptana.org/">http://aptana.org</a> ) </li><li>  NetBeans (free, <a href="http://netbeans.org/">http://netbeans.org</a> ) </li><li>  RubyMine (commercial, <a href="http://www.jetbrains.com/ruby/">http://www.jetbrains.com/ruby/</a> ) </li></ul>  Each IDE offers a wealth of opportunities for developing and testing Ruby applications, and also supports version control systems. <br><br>  For those who are used to using simpler solutions are available: <ul><li>  Komodo Edit (free, <a href="http://www.activestate.com/komodo-edit">http://www.activestate.com/komodo-edit</a> ) </li><li>  Redcar (free, <a href="http://redcareditor.com/">http://redcareditor.com/</a> ) </li><li>  SciTE (free, <a href="http://www.scintilla.org/SciTE.html">http://www.scintilla.org/SciTE.html</a> ) </li><li>  E TextEditor (commercial, <a href="http://e-texteditor.com/">http://e-texteditor.com/</a> ) </li></ul>  To write the example, we used Aptana: <br><br><img src="https://habrastorage.org/storage2/519/f8a/97d/519f8a97d33bffe37047e5c8cfe6998c.png"><br><br><h2>  MVC </h2><br><br>  Ruby on Rails is based on the model-view-controller architecture (model, view, controller - MVC).  This approach has the following advantages: <ul><li>  isolation of business logic from the interface; </li><li>  as few code repetitions as possible (DRY principle - don't repeat yourself); </li><li>  relatively simple development due to the strict distribution of the code according to its purpose (for example, the HTML output code of the form does not mix with the database processing code). </li></ul>  <em>The model</em> describes the structure of the database in terms of object-oriented programming.  So in Rails, a model is an ordinary class that inherits all the necessary functionality from the class ActiveRecord :: Base.  An instance (object) of such a class describes one row from the corresponding database table.  Thus, the models hide from the developer the subtleties of working with a specific DBMS. <br><br>  <em>A view</em> is the interface itself that the user sees.  At this level, the developer makes templates that convert to HTML, CSS, or JavaScript code. <br><br>  <em>The controller</em> links the model and the view.  Usually it is in the controller that the main logic is placed.  In essence, controllers are Ruby classes.  Each public controller method is called an action.  If your controller is called Home and has a public index method in it, then usually by calling the browser / home / index you will call the action index. <br><br>  When a request comes to an application, the routing mechanism (in the config / routes.rb file) determines which controller is responsible for this type of request.  In addition to the URL address itself, many conditions can be taken into account, for example, you can use different controllers for different browsers, for mobile clients, etc. <br><br>  So, choosing the controller determines the action that will process the request.  Here you can also apply a lot of conditions.  Directly in action, some kind of computation or work with the database takes place.  When the action has fulfilled, it is time presentation.  In the templates, you can transfer the data obtained from the database or some result.  Normal HTML will be generated from the templates (there are also templates for JavaScript and CSS) and the page with the answer will be sent to the user. <br><br><h2>  We write application </h2><br><br>  A classic example for Rails is usually the creation of the simplest blog.  We will not deviate from the traditions.  So, let's delete the file with the greeting - public / index.html and create the Home controller with the Index action - this will be the main blog page.  To do this, run the following command, while in the application directory: <br><br> <code>rails g controller home index</code> <br> <br>  Now if we query / home / index, we will get a page from the template created for the index action: <br><br><img src="https://habrastorage.org/storage2/9fd/4fe/570/9fd4fe5709f5741cbbd670ecc2781620.png"><br><br>  Next, we will create a simple Post model that will describe each individual blog post in the database.  In Ruby code, the model looks like a class, and in a database, it looks like a table.  Thus, an object of class Post is a row in the corresponding table. <br><br>  To create a model, you can call the command ‚Äúrails g model Post ...‚Äù, however let's use a more convenient means - scaffolding (scaffolding - construction wood).  The rails g scaffold command creates, in addition to the model class itself and tests for it, action stubs and presentation templates for creating, editing and deleting model objects.  Run the following command: <br><br> <code>rails g scaffold Post name:string title:string content:text</code> <br> <br>  We‚Äôll get the Post model in app \ models \ post.rb, the Posts controller in app \ controllers \ posts_controller.rb, with index, show, new, edit, update, create, and destroy actions, as well as the database migration script in the db \ migrate directory .  The team also created test stubs and HTML templates.  It is important to note that we have not written any code yet. <br><br>  Let's call a command that will create a database (if it does not already exist), as well as a table of posts with the fields name, title and context, as described above: <br><br> <code>rake db:migrate</code> <br> <br>  The database migration command is used to create or modify the database structure in accordance with our object model.  It needs to be called every time you change something in the application model.  All the magic of fitting the database structure to our model occurs automatically, and the data already recorded in the database will be saved. <br><br>  Note that in the specific example Sqlite is used, in Rails this is the default database.  However, the rails support a lot of other DBMS, while hiding the specifics of working with them. <br><br>  Posts controller actions are now available at / posts /. <br><br><img src="https://habrastorage.org/storage2/17d/e2b/7e3/17de2b7e3448ab5c688c2317f617149c.png"><br><br>  Clicking on the link "New Post" we will see the form: <br><br><img src="https://habrastorage.org/storage2/e0d/4e3/c7e/e0d4e3c7e13a3cbeda28df2b1d895f56.png"><br><br>  Filling in all the fields, we get to the page of the new post: <br><br><img src="https://habrastorage.org/storage2/616/04f/cee/61604fceec0eec8a6f13f056a5dfaaba.png"><br><br>  Once again, no code has yet been written by hand.  Now let's make some changes.  For example, it may be necessary to specify the name and title of the post so that this field is always filled in the database.  Fortunately, Rails provides a very simple validation mechanism.  It is enough to correct the model file as follows: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Post &lt; ActiveRecord::Base validates :<span class="hljs-type"><span class="hljs-type">name</span></span>, :presence =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> validates :title, :presence =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, :length =&gt; { :minimum =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><br>  Here we indicate that filling in the ‚Äúname‚Äù and ‚Äútitle‚Äù fields is mandatory, and the ‚Äútitle‚Äù field must contain at least 5 characters.  Migration is not necessary because  The validators are not directly connected to the base, the check is performed at the level of a Ruby code. <br><br>  If now, for example, do not enter the "name" field, we get an error: <br><br><img src="https://habrastorage.org/storage2/572/f50/d38/572f50d38033f012bc8157924fa61699.png"><br><br>  Let's complicate the task and add comments.  Create a Comment model with the following command: <br><br> <code>rails g model Comment commenter:string body:text post:references</code> <br> <br>  Note the "post: references" parameter.  He links the comments table to the posts table. <br><br>  Update the database: <br><br> <code>rake db:migrate</code> <br> <br>  Now let's set the ‚Äúhas many‚Äù relationship for the Post model: <br><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Post</span></span></span><span class="hljs-class"> &lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type"> ActiveRecord::Base validates :name, :presence =</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">validates</span></span></span><span class="hljs-class"> :</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">title</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">:presence =&gt; true</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">:length =&gt; { :minimum =&gt; 5 } has_many :comments</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">:dependent =&gt; :destroy end</span></span></span></span></code> </pre> <br><br>  The code is intuitive.  It turns out that every Post object can have a lot of comments.  : dependent =&gt;: destroy indicates that when deleting a post, its comments should also be deleted. Since this time we did not use the scaffolding mechanism to create a comment model, we need to generate the corresponding controller: <br><br> <code>rails g controller Comments</code> <br> <br>  In the config \ routes.rb file, replace the line ‚Äúresources: posts do‚Äù with: <br><br><pre> <code class="hljs ruby">resources <span class="hljs-symbol"><span class="hljs-symbol">:posts</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> resources <span class="hljs-symbol"><span class="hljs-symbol">:comments</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><br>  Thus, we indicate how the controller will be available with comments.  In this case, it is embedded in ‚Äúposts‚Äù, i.e.  the links will be: http: // localhost: 41639 / posts / 1 / comments / 3 <br><br>  Next, you need to update the app \ views \ posts \ show.html.erb template so that you can post comments.  After: <br><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>Content:<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span><span class="hljs-tag"> @</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">post.content</span></span></span><span class="hljs-tag"> %&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  add: <br><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span>Comments<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> @</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">post.comments.each</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">do</span></span></span><span class="hljs-tag"> |</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">comment</span></span></span><span class="hljs-tag">| %&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>Commenter:<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">comment.commenter</span></span></span><span class="hljs-tag"> %&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>Comment:<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">comment.body</span></span></span><span class="hljs-tag"> %&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">link_to</span></span></span><span class="hljs-tag"> '</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Destroy</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Comment</span></span></span><span class="hljs-tag">', [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">comment.post</span></span></span><span class="hljs-tag">, </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">comment</span></span></span><span class="hljs-tag">], </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:confirm</span></span></span><span class="hljs-tag"> =&gt;</span></span> 'Are you sure?', :method =&gt; :delete %&gt; <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">end</span></span></span><span class="hljs-tag"> %&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span>Add a comment:<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">form_for</span></span></span><span class="hljs-tag">([@</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">post</span></span></span><span class="hljs-tag">, @</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">post.comments.build</span></span></span><span class="hljs-tag">]) </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">do</span></span></span><span class="hljs-tag"> |</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">f</span></span></span><span class="hljs-tag">| %&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"field"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">f.label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:commenter</span></span></span><span class="hljs-tag"> %&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">f.text_field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:commenter</span></span></span><span class="hljs-tag"> %&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"field"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">f.label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:body</span></span></span><span class="hljs-tag"> %&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">f.text_area</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:body</span></span></span><span class="hljs-tag"> %&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"actions"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%=</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">f.submit</span></span></span><span class="hljs-tag"> %&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">end</span></span></span><span class="hljs-tag"> %&gt;</span></span></code> </pre><br><br><img src="https://habrastorage.org/storage2/a21/198/b39/a21198b39ad074f7711699e01f76e50a.png"><br><br>  Finally we describe the logic of the controller in app \ controllers \ comments_controller.rb <br><br><pre> <code class="hljs scala"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommentsController</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">&lt;</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationController</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">create</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">@post</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">Post</span></span>.find(params[:post_id]) <span class="hljs-meta"><span class="hljs-meta">@comment</span></span> = <span class="hljs-meta"><span class="hljs-meta">@post</span></span>.comments.create(params[:comment]) redirect_to post_path(<span class="hljs-meta"><span class="hljs-meta">@post</span></span>) end <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">destroy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">@post</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-type"><span class="hljs-type">Post</span></span>.find(params[:post_id]) <span class="hljs-meta"><span class="hljs-meta">@comment</span></span> = <span class="hljs-meta"><span class="hljs-meta">@post</span></span>.comments.find(params[:id]) <span class="hljs-meta"><span class="hljs-meta">@comment</span></span>.destroy redirect_to post_path(<span class="hljs-meta"><span class="hljs-meta">@post</span></span>) end end</code> </pre> <br><br>  Now everything is ready and you can add comments to the post: <br><br><img src="https://habrastorage.org/storage2/fc3/a66/4c5/fc3a664c5710bbbc2695376dfb0dbf57.png"><br><br>  So, the main functionality is implemented.  As a final step, let's protect some actions so that an outsider does not have access to them.  A more correct approach is to use registration, sessions, cookies, etc., but for simplicity we will take the usual Basic authentication, especially in Rails it is added in one line.  In posts_controller.rb, write: <br><br> <code>http_basic_authenticate_with :name =&gt; "admin", :password =&gt; "123", :except =&gt; [:index, :show]</code> <br> <br>  Here the login and password are strictly specified.  The: except option excludes the actions: index and: show - no authentication is required for them. <br><br><img src="https://habrastorage.org/storage2/f9e/78e/b5c/f9e78eb5cca002f69af74465d65b15a0.png"><br><br><h2>  Deploy to server </h2><br><br>  So, we have written the application and now we want to post it online.  To do this, configure the Windows server to work with Rails.  We need to repeat the first few steps from the beginning of the article, which we did to deploy the working environment.  You need to install the Microsoft Web Platform Installer, add the Helicon Zoo feed to it and install the Ruby Hosting Package from the Zoo repository.  Before installing, you should make sure that in the Web Platfrom Installer settings it is specified to install applications under IIS, and not under IIS Express.  Now the server is ready to accept our application.  Currently, Windows 2008 and 2008 R2, 32 and 64 bit versions are supported from server platforms. <br><br>  Now we will create an empty web site on the server using standard tools such as IIS Manager or hosting panel.  Next you need to upload our application to the site via FTP or WebDeploy.  In the case of WebDeploy, the necessary rights to the folders will also be distributed.  You can also use Git or another version control system, but this is outside the scope of this article. <br><br>  Helicon Zoo Module was originally developed with the calculation of configuring hosting solutions.  So all applications under it are divided and do not overlap.  The module itself with the default settings works in automatic mode, creating one worker (process handler) when the load is low or adding workers up to the number of cores to give maximum performance if the load on the application increases. <br><br>  In Helicon Zoo the concept of engines (engines) and applications (applications) is used.  So in the engines it is determined what to run and how, by what protocol and on which port, how many minimum and maximum workers are allowed and similar global settings that are set globally in the applicationHost.config file.  Then, already under the site, you can create an application that uses a specific engine and pass it the necessary parameters for the operation of this application.  This allows you to separate the work of the hosting administrator from clients, and clients from each other. For more information about the settings of the Helicon Zoo Module, please read here: <a href="http://www.helicontech.com/zoo/module.htm">http://www.helicontech.com/zoo/module.htm</a> <sub>(English)</sub> <br><br>  Pay attention to the deploy.rb file in the root directory of the site, as well as the DEPLOY_FILE and DEPLOY_LOG settings in the web.config.  The zoo module performs deploy.rb every time the IIS pool is started.  This approach can be useful to those who do not have administrative privileges on the server.  After all, for deployment, most likely, you will need to perform "bundle install" or apply database migration.  To do this, simply restart your application on the server and the deploy.rb file will be executed automatically.  The most popular commands are already registered in deploy.rb. <br><br>  It is also worth remembering that the deploy.rb script is executed by the same Windows user that starts the IIS pool.  As a rule, he has very limited rights and this should be considered when writing his commands.  For example, the usual call of ‚Äúbundle install‚Äù can lead to an error, since it is not possible to write directly to the Ruby installation directory.  A good solution is to pre-save all the jams under the site, in a special directory vendor / cache, for which you need to call the ‚Äúbundle package‚Äù command in the directory of your application before sending it to the server.  And in deploy.rb, you should write the ‚Äúbundle install - local - path vendor / gems‚Äù command. <br><br>  Execute script execution errors can be read in the file specified in the DEPLOY_LOG variable. <br><br>  The last thing I would like to draw attention to when scanning is the RACK_ENV variable in the web.config.  In the web.config that comes from the WebMatrix template, the variable RACK_ENV is specified with the value ‚Äúdevelopment‚Äù.  This includes an appropriate Rails mode, more suitable for development.  On the server, it is necessary to change the value to "production".  By the way, it is ‚Äúproduction‚Äù that is used by default. <br><br><h2>  Performance tests </h2><br><br>  Test machine as a server - Core 2 Quad 2.4 Ghz, 8 Gb RAM, gigabit network.  To generate the load, a more powerful computer and Apache Benchmark were used with the command ‚Äúab.exe -n 100000 -c 100 ‚Äìk‚Äù.  Ubuntu 11.04 Server x64 was used to test Apache and Nginx.  IIS 7 tests worked on Windows Server 2008 R2.  Any virtualok - honest iron. <br><br>  Three tests were performed.  In the first Rails application should simply display the current time on the page in high resolution.  Time is needed to ensure that the answers do not come from the cache.  In the second test, read from the MySQL database, in the third record in the database. <br><br>  Ruby 1.9.3, Rails 3.1.1 and MySQL 5.1.54 were used for the tests.  In the case of HTTP transport, Thin was used as a backend.  Neither Unicorn nor Passenger on Windows just work.  In total, three configurations participated in the test: Windows + IIS 7.5 + Helicon Zoo + Thin, Ubuntu + Apache + Passanger, Ubuntu + Nginx + Thin. <br><br>  Here are the results (the value on the graphs - requests per second): <br><br><img src="https://habrastorage.org/storage2/75e/466/bfb/75e466bfb97fa29905c40a82adce0131.png"><img src="https://habrastorage.org/storage2/852/b5c/fc4/852b5cfc47905f7a8810fe7fde1e8627.png"><img src="https://habrastorage.org/storage2/51b/782/679/51b78267910e0d2dc6898cc9e0f17f0a.png"><br><br>  Also according to the first test with the time output, we present more detailed graphs of ab: <br><br><img src="https://habrastorage.org/storage2/714/b1d/74c/714b1d74c0928fc3578c0dd51e8d4458.png"><br><br><img src="https://habrastorage.org/storage2/255/3e3/ffc/2553e3ffcd1659186dd37b43b8d717da.png"><br><br><img src="https://habrastorage.org/storage2/9c3/751/964/9c37519640ba4b01326b0a0d263fc227.png"><br><br><h2>  findings </h2><br><br>  Ruby on Rails is an excellent framework that allows you to quickly and easily create various web applications.  Of course the world of Ruby is not limited to them.  In subsequent articles, we will look at Goliath and Sinatra. <br><br>  I would like to note that Windows is a good platform for developing Ruby as well as launching applications in production.  If earlier the difference in performance of Ruby on Linux and Windows systems was high, then now the performance, as well as the usability of using RoR on Windows, have greatly improved.  So much so that now the question of performance when choosing a platform can be neglected against the background of other factors. <br><br><br>  PS: The co-author of this article is Vyacheslav Shinkarenko.  Because  he is not invited to Habr, then his Twitter: <a href="https://twitter.com/">https://twitter.com/#!/vyaces</a> </div><p>Source: <a href="https://habr.com/ru/post/136086/">https://habr.com/ru/post/136086/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../136077/index.html">Keep it simplest. Or about simple sites</a></li>
<li><a href="../136080/index.html">CES 2012 // Lenovo IdeaPad Yoga</a></li>
<li><a href="../136082/index.html">Asus Zenbook UX31 Ultrabook Review</a></li>
<li><a href="../136084/index.html">Demotivation in full, or why am I waiting for the end of the world?</a></li>
<li><a href="../136085/index.html">Simulation of pressing Home, End, PgUp, PgDown</a></li>
<li><a href="../136093/index.html">What we thought about 20 years ago</a></li>
<li><a href="../136095/index.html">How to make money in IT?</a></li>
<li><a href="../136097/index.html">High-quality gps monitoring for $ 150</a></li>
<li><a href="../136098/index.html">Protecting electronics from water - a new unique coating</a></li>
<li><a href="../136100/index.html">3D Life - in search of gliders</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>