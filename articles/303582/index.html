<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>C--. First meeting</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The process of porting and creating software development tools for KolibriOS continues. We publish articles on the most actively used programming lang...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>C--. First meeting</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/files/0d6/194/f4b/0d6194f4bd54441b85acce5e6696e434.PNG" align="left">  The process of porting and creating software development tools for KolibriOS continues.  We publish articles on the most actively used programming languages.  Today we begin to talk about the language C--, around which an active community developed in the 2000s.  Details under the cut. </p><a name="habracut"></a><br><p>  Briefly about the language from the <a href="http://c--sphinx.narod.ru/" title="Sphinx C--">official site</a> : </p><br><blockquote>  C-- is a programming language that is intermediate between assembler and C.  Ideal for writing small programs, residents (TSR), drivers, interrupt handlers.  To work with the language C-- familiarity with the assembler and C is necessary.  Now C-- can generate 32-bit code under DOS and Windows <em>(approx. Ed. And also under MenuetOS, KolibriOS)</em> . <br><br>  The author of SPHINX C-- is Peter Cellik (CANADA).  The latest author's version of SPHINX C-- v0.203 is from 28.Oct.96.  Unfortunately, the author refused to further develop the language.  The language itself, together with the source code, was declared orphaned and given to no one else.  Those.  do what you want.  Why not do it?  On this page you will find the latest (but not the author's) version of the language itself, the library, examples of programs, a description of the language itself and libraries in the Notron Guide format, and many other useful information on the C-- language. </blockquote><br><p>  After Peter Sellik, Mikhail Sheker was involved in support, but he stopped development several years ago.  Last year, the <a href="http://www.masm32.com/board/index.php%3Ftopic%3D4703.0">source code was posted</a> on Github <a href="https://github.com/jossk/c--sphinx">https://github.com/jossk/c--sphinx</a> , but we only learned about this <a href="http://board.kolibrios.org/viewtopic.php%3Ff%3D45%26t%3D3237">in March 2016</a> . </p><br><p>  It was decided to talk about this language for two reasons: </p><br><ol><li>  Several popular KolibriOS programs are written on it, among which Eolite is perhaps the most used file manager. <br><img src="https://habrastorage.org/files/287/cd2/0db/287cd20dbf094c84a439233f8635e605.png"></li><li>  Relatively recently, the compiler of this language was ported to KolibriOS (the answer to the question about the license can be found <a href="http://board.kolibrios.org/viewtopic.php%3Ff%3D45%26t%3D3237">here</a> ). </li></ol><br><p>  A little about the porting process from <strong>GerdtR</strong> : </p><br><blockquote>  So.  At first I redid the code under gcc.  The source code was simply written for Watcom C, well, if not significant, but there was an incompatibility.  Corrected a couple of variable names (extern in the cotton committee can, apparently), and the designation of 64-bit numbers differently.  Then Leency revealed that the gcc version does not search for files in the current folder at all, only in the folder with the file itself.  When this fixed the most difficult: the port for the Hummingbird.  Well, since I did not write to CBS under C, there was a standard problem - with whom to link, and what classes to take.  The choice is not wide, the menuetlibc was dropped immediately, as I, having rummaged in the source code, saw still the old functions of accessing files (f56 like).  In short, menuetlibc is outdated, newlib remains.  For a long time I understood how to get kex and not PE at the output, one Makefile helped, where additional objcopy processing was written.  Well, after that, adding functions that are not in newlib (for example, stat was not, in port.c its implementation lies).  Well, a couple of functions for converting ANSI-&gt; ASCII encodings, or rather stubs, because there are still no Russian letters in the compiler strings.  Well, the last problem was, and partially this is left: because of newlib (most likely there is no one more), the current directory is set as the path to the mm itself (and usually / rd / 1), so it turns out that it is to find out where the source the compiler cannot, at least from where to start it.  Exit at the moment - copy the compiler to the source folder, or specify the absolute path.  By the way, before the symbol '/' was considered the beginning of the parameter and the absolute path was not possible to specify, it is now possible.  But with an absolute path, I‚Äôm not sure yet what it will find.  So far, I don‚Äôt want to bother with it, and you can just write -IP = "/ hd1 / 1 / my_source".  In theory, it should work, in practice, no one asked.  By the way ... indicate in the forum something, that the parameters through '-' indicate now ... And when you start without parameters, in the table correct, but then some confusion is obtained.  Ok, then somehow.  Well, in general, the whole story.  The most difficult thing was to figure out where to get it from. :) The code itself is pretty simple, not in a super order, but I didn‚Äôt have to pick the code too much </blockquote><br><p>  The language guide is available at <a href="http://www.c--sphinx.narod.ru/c--doc.htm">http://www.c--sphinx.narod.ru/c--doc.htm</a> .  Consider an example of a simple application for KolibriOS: </p><br><pre><code class="hljs mel">#define MEMSIZE <span class="hljs-number"><span class="hljs-number">4096</span></span>*<span class="hljs-number"><span class="hljs-number">10</span></span> #include <span class="hljs-string"><span class="hljs-string">"../lib/io.h"</span></span> #include <span class="hljs-string"><span class="hljs-string">"../lib/gui.h"</span></span> void main() { word id; dword <span class="hljs-keyword"><span class="hljs-keyword">file</span></span>; io.dir.load(<span class="hljs-number"><span class="hljs-number">0</span></span>,DIR_ONLYREAL); loop() <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(WaitEvent()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> evButton: id=GetButtonID(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (id==<span class="hljs-number"><span class="hljs-number">1</span></span>) ExitProcess(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> evKey: GetKeys(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (key_scancode == SCAN_CODE_ESC ) ExitProcess(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> evReDraw: draw_window(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } void draw_window() { proc_info Form; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; DefineAndDrawWindow(<span class="hljs-number"><span class="hljs-number">215</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>,<span class="hljs-number"><span class="hljs-number">350</span></span>,<span class="hljs-number"><span class="hljs-number">300</span></span>,<span class="hljs-number"><span class="hljs-number">0x34</span></span>,<span class="hljs-number"><span class="hljs-number">0xFFFFFF</span></span>,<span class="hljs-string"><span class="hljs-string">"Window header"</span></span>); GetProcessInfo(#Form, SelfInfo); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;io.dir.count; i++) { WriteText(<span class="hljs-number"><span class="hljs-number">5</span></span>,i*<span class="hljs-number"><span class="hljs-number">8</span></span>+<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">0x80</span></span>,<span class="hljs-number"><span class="hljs-number">0xFF00FF</span></span>,io.dir.position(i)); } DrawCaptButton(<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">22</span></span>, <span class="hljs-number"><span class="hljs-number">22</span></span>, <span class="hljs-number"><span class="hljs-number">0xCCCccc</span></span>, <span class="hljs-number"><span class="hljs-number">0x000000</span></span>, <span class="hljs-string"><span class="hljs-string">"Button"</span></span>); WriteText(<span class="hljs-number"><span class="hljs-number">100</span></span>,<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-number"><span class="hljs-number">0x80</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">"Textline small"</span></span>); WriteText(<span class="hljs-number"><span class="hljs-number">100</span></span>,<span class="hljs-number"><span class="hljs-number">70</span></span>,<span class="hljs-number"><span class="hljs-number">0x90</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">"Textline big"</span></span>); DrawBar(<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">110</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">0x66AF86</span></span>); }</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/files/9cf/2cf/daf/9cf2cfdafc5542bda01b435bf3a41f7a.jpg"></div><br><p>  As you can see, this code is almost the same as in C, but it is possible to write calmly in an almost assembler style, similar to writing wrappers for system functions.  For example, the window creation function: </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DefineAndDrawWindow</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dword x, y, size_w, size_h, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WindowType,dword WindowAreaColor, EDI, ESI</span></span></span><span class="hljs-function">)</span></span> { EAX = <span class="hljs-number"><span class="hljs-number">12</span></span>; EBX = <span class="hljs-number"><span class="hljs-number">1</span></span>; $<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x40</span></span> $xor EAX,EAX EBX = x &lt;&lt; <span class="hljs-number"><span class="hljs-number">16</span></span> + size_w; ECX = y &lt;&lt; <span class="hljs-number"><span class="hljs-number">16</span></span> + size_h; EDX = WindowType &lt;&lt; <span class="hljs-number"><span class="hljs-number">24</span></span> | WindowAreaColor; $<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x40</span></span> EAX = <span class="hljs-number"><span class="hljs-number">12</span></span>; EBX = <span class="hljs-number"><span class="hljs-number">2</span></span>; $<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">0x40</span></span> }</code> </pre> <br><p>  What makes it attractive for software developers for KolibriOS?  First of all, it's very easy to start writing on it.  It was the only language, not counting FASM, in which one could simply start writing without bothering with the cross-compilation setting (now, in this case, C is already gaining momentum).  Secondly, for C-- a lot of libraries and various wrappers were written over system functions.  Among them is its own set of interface elements and even good fonts: <br></p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/534/536/81c/53453681c3de47a0a7c7601ff4124258.png"></div><br><p><br>  You will surely ask yourself a question: if everything is so beautiful, then what is the problem?  Why does it not apply everywhere, even if it is part of the KolibriOS project? <br>  The answer is as follows.  Despite the advantage in ease of development, with its use and disadvantages emerge: </p><br><ul><li>  poor result code optimization; </li><li>  operations priorities are practically absent (C-- considers everything from left to right, that is, 2 + 2 * 2 = 8, not 6); </li><li>  Most importantly, although it is similar to C, it is a different programming language with its own sphere of application.  In the framework of KolibriOS, it is most suitable for creating programs with a graphical interface and is almost never used in system programming. </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/303582/">https://habr.com/ru/post/303582/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../303572/index.html">We write an extension for PHP (7.0.7) without knowledge of C / C ++ and how it works in general</a></li>
<li><a href="../303574/index.html">Implementing demons on Node.js</a></li>
<li><a href="../303576/index.html">Unique data center Finger Lakes Technologies Group inside the nuclear storage</a></li>
<li><a href="../303578/index.html">Creating a blog on symfony 2.8 lts [Part 6]</a></li>
<li><a href="../303580/index.html">How we develop a new frontend Tinkoff.ru</a></li>
<li><a href="../303584/index.html">Experience in automating server REST API testing with Jmeter</a></li>
<li><a href="../303590/index.html">Comparing D and Go performance for web</a></li>
<li><a href="../303594/index.html">Using lambda as local functions</a></li>
<li><a href="../303600/index.html">Emacs as a code editor for Python and Golang</a></li>
<li><a href="../303602/index.html">Experience useful modification UEFI: return Thinkpad W520 legitimate support for fast memory</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>