<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Kali Linux: monitoring and logging</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚Üí Part 1. Kali Linux: security policy, protecting computers and network services 
 ‚Üí Part 2. Kali Linux: filtering traffic using netfilter 
 ‚Üí Part 3....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Kali Linux: monitoring and logging</h1><div class="post__text post__text-html js-mediator-article"> ‚Üí Part 1. <a href="https://habrahabr.ru/company/ruvds/blog/338338/">Kali Linux: security policy, protecting computers and network services</a> <br>  ‚Üí Part 2. <a href="https://habrahabr.ru/company/ruvds/blog/338480/">Kali Linux: filtering traffic using netfilter</a> <br>  ‚Üí Part 3. <a href="https://habrahabr.ru/company/ruvds/blog/338668/">Kali Linux: monitoring and logging</a> <br>  ‚Üí Part 4. <a href="https://habrahabr.ru/company/ruvds/blog/338712/">Kali Linux: system protection and monitoring exercises</a> <br><br>  In the previous two articles in this series, we talked about security policy, about protecting computers and network services, about filtering traffic in Kali Linux.  We thank our readers for the useful additions to these materials.  In particular, the user <a href="https://habrahabr.ru/users/imbasoft/">imbasoft</a> for referring to <a href="https://www.sans.org/reading-room/whitepapers/bestprac">SANS Best Practices</a> and for recommending him to familiarize himself with the set of standards of the <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25A2%25D0%259E_%25D0%2591%25D0%25A0_%25D0%2598%25D0%2591%25D0%2591%25D0%25A1">STO BR IBBS</a> to dive into the topic of business safety management processes.  This comment is given to the <a href="https://habrahabr.ru/company/ruvds/blog/338338/">first</a> material.  Thanks to the user <a href="https://habrahabr.ru/users/loginsin/">loginsin</a> , who made valuable remarks to the <a href="https://habrahabr.ru/company/ruvds/blog/338480/">second</a> material concerning the <code>iptables</code> rules and some other intricacies of filtering traffic in Linux. <br><br> <a href="https://habrahabr.ru/company/ruvds/blog/338668/"><img src="https://habrastorage.org/web/f1d/fd7/e4d/f1dfd7e4d77c459ca3de01a59870fb6d.jpg"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Today we want to share with you the translation of section 7.5.  Chapter 7 of the book ‚Äú <a href="https://kali.training/introduction/kali-linux-revealed-book/">Kali Linux Revealed</a> ‚Äù, which is dedicated to monitoring and logging. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">7.5.</font>  <font color="#3AC1EF">Monitoring and logging</font> </h2><br>  Confidentiality and data protection are important aspects of information security, but it is equally important to ensure the smooth and correct operation of the system.  If you play the role of a system administrator and security professional, you must ensure reliable and predictable infrastructure.  Your area of ‚Äã‚Äãresponsibility is the timely detection of abnormal behavior and deterioration in the quality of work of services. <br><br>  Monitoring and logging programs play a key role here, allowing you to analyze what is happening in the system and in the network. <br><br>  In this section, we will look at some tools that can be used to monitor Kali Linux. <br><br><h2>  <font color="#3AC1EF">7.5.1.</font>  <font color="#3AC1EF">Log monitoring using logcheck</font> </h2><br>  The <code>logcheck</code> utility <code>logcheck</code> designed to monitor log files, which it, by default, hourly scans and sends unusual log entries to the administrator's email for further analysis. <br><br>  The list of files watched by the program is stored in the <code>/etc/logcheck/logcheck.logfiles</code> file.  The default settings allow <code>logcheck</code> to work normally, provided that the <code>/etc/rsyslog.conf</code> file has not been completely changed. <br><br>  <code>Logcheck</code> supports three levels of filtering: <code>paranoid</code> , <code>server</code> and <code>workstation</code> .  Using the <code>paranoid</code> level results in <code>logcheck</code> sending extremely long reports to the administrator.  Probably, it should be used only on separate servers, such as those that play the role of firewalls.  The <code>server</code> level is the default; it is recommended to use it on most servers.  The <code>workstation</code> level, which is quite obvious from its name, was created for workstations; thanks to its use, the program produces brief reports, filtering much more messages than when using other levels of filtering. <br><br>  In all three cases, the <code>logcheck</code> should be configured to exclude from the reports some clearly redundant messages (which ones depend on the services installed on the system).  Otherwise, be prepared for the fact that every hour you will receive long uninteresting emails.  The mechanism for selecting messages for inclusion in reports is rather complicated, so it is recommended to be patient and master <code>/usr/share/doc/logcheck-database/README.logcheck-database.gz</code> . <br><br>  The applicable rules can be divided into several types: <br><br><ul><li>  Rules that analyze messages to find attempts to hack the system.  These rules are stored in a file located in the <code>/etc/logcheck/cracking.d/</code> directory; <br></li><li>  The rules for hacking attempts to be ignored are described in <code>/etc/logcheck/cracking.ignore.d/</code> ; <br></li><li>  The rules for messages rated as security warnings are stored in <code>/etc/logcheck/violations.d/</code> ; <br></li><li>  The rules for security warnings to be ignored are stored in <code>/etc/logcheck/violations.ignore.d/</code> ; <br></li><li>  And finally, the rules that apply to other messages (they are considered as system events). <br></li></ul><br>  <code>ignore.d</code> files <code>ignore.d</code> used to ignore messages.  For example, a message marked as a hacking attempt or a security warning (according to the rule stored in the <code>/etc/logcheck/violations.d/myfile</code> file) can be ignored only when applying the rule that is stored in the <code>/etc/logcheck/violations.ignore.d/myfile</code> file <code>/etc/logcheck/violations.ignore.d/myfile</code> , or in the <code>/etc/logcheck/violations.ignore.d/myfile-extension</code> file. <br><br>  <code>Logcheck</code> always reports system events, unless the directories whose naming scheme is shown below indicate that these events should be ignored: <br><br><pre> <code class="hljs pgsql">/etc/logcheck/ignore.d.{paranoid,<span class="hljs-keyword"><span class="hljs-keyword">server</span></span>,workstation}/</code> </pre> <br>  Naturally, only those directories that correspond to a filtering level equal to or greater than the selected one are taken into account. <br><br><h2>  <font color="#3AC1EF">7.5.2.</font>  <font color="#3AC1EF">Real-time monitoring</font> </h2><br>  The <code>top ‚Äî</code> program <code>top ‚Äî</code> an interactive tool that lists the running processes.  The standard sorting of the process list is based on the amount of CPU resources consumed.  If necessary, it can be activated using the key <code>P</code>  Other ways of sorting processes include sorting by the occupied memory (key <code>M</code> ), total processor usage time (key <code>T</code> ), and process identifier (key <code>N</code> ).  The key <code>k</code> allows you to complete the process by entering its identifier.  Key <code>r</code> allows you to change the priority of the process. <br><br>  If the system looks overloaded, <code>top ‚Äî</code> an excellent tool that helps you know which processes consume the most CPU time or take up too much memory.  In particular, it is usually useful to check whether the consumption of resources by the processes corresponds to the role played by the computer, to the services it is intended to support.  For example, an unknown process running under the user ‚Äúwww-data‚Äù is worth paying attention to.  It needs to be investigated, as it may be some kind of program installed and running on the system through a vulnerability in the web application. <br><br>  The <code>top</code> tool is very flexible; from its help you can find out details on how to customize the data it displays and adapt it to your personal needs and preferences. <br>  The <code>gnome-system-monitor</code> graphical tool is similar to <code>top</code> , it has about the same capabilities. <br><br><h2>  <font color="#3AC1EF">7.5.3.</font>  <font color="#3AC1EF">System change detection</font> </h2><br>  Once the system is installed and configured, most system files should not be changed until the system is updated.  Thus, it is useful to track changes in system files, since any unexpected change can be cause for concern and to investigate the reason for such a change.  This section shows several common tools suitable for monitoring system files, for detecting their changes, and, if necessary, for organizing an administrator alert. <br><br><h3>  <font color="#3AC1EF">‚ñç7.5.3.1.</font>  <font color="#3AC1EF">Package Auditing with dpkg --verify</font> </h3><br>  The <code>dpkg --verify</code> (or <code>dpkg -V</code> ) command is an interesting tool that allows you to output information about system files that have been modified (perhaps by attackers), but the output of this command should be viewed with skepticism.  In order to do its job, the <code>dpkg</code> utility relies on the checksums stored in its own database on the hard disk (you can find it on the path <code>/var/lib/dpkg/info/package.md5sums</code> ).  A qualified hacker can easily modify these files so that they contain new checksums for modified files.  If the attacker goes even further, he will replace the package on your Debian mirror.  In order to protect against such attacks, use the APT digital signature confirmation system (for more on this, see Section 8.3.6. ‚Äú <a href="https://kali.training/8-debian-package-management/advanced-apt-configuration-and-usage/">Package Authentication</a> ‚Äù) for reliable packet checking. <br><br><blockquote><h3>  <font color="#3AC1EF">‚ñçWhat is a checksum file?</font> </h3><br>  We want to remind you that a checksum is a value, often a number (albeit in hexadecimal notation) that contains something like a signature for the contents of a file.  The signature is calculated using some algorithm (among them are the widely known MD5 and SHA1), which, in general, ensure that even the smallest change in the file will lead to a change in the checksum.  This phenomenon is known as the avalanche effect.  A simple digital signature then serves as a means to check if the contents of the file have changed.  These algorithms are not amenable to inverse transformation.  In other words, for most of them, knowledge of the signature does not allow restoring the data on the basis of which this signature was created.  Recent studies in mathematics call into question the absoluteness of this principle, but so far in practice this is not used, since the creation of various data sets having the same checksum is still a very difficult task. </blockquote><br>  Running the <code>dpkg -V</code> command will check all installed packages and display information about those that have failed.  Each character in the package information line indicates that some metadata has been checked.  Unfortunately, <code>dpkg</code> does not store the metadata needed for most tests, and thus displays question marks for them.  At present, only if the package fails the checksum test, the figure 5 appears at the third position. <br><br><pre> <code class="hljs swift"># dpkg -<span class="hljs-type"><span class="hljs-type">V</span></span> ??<span class="hljs-number"><span class="hljs-number">5</span></span>??????   /lib/systemd/system/ssh.service ??<span class="hljs-number"><span class="hljs-number">5</span></span>?????? <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> /etc/libvirt/qemu/networks/<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>.xml ??<span class="hljs-number"><span class="hljs-number">5</span></span>?????? <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> /etc/lvm/lvm.conf ??<span class="hljs-number"><span class="hljs-number">5</span></span>?????? <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> /etc/salt/roster</code> </pre> <br>  In this example, <code>dpkg</code> reports a change in the <code>ssh.service</code> file that the administrator made, instead of using the rules override for <code>/etc/systemd/system/ssh.service</code> , (which would be stored in the <code>/etc</code> directory, where the files should be stored specifying configuration changes).  In addition, the command displays several configuration files (for such files, the letter ‚Äúc‚Äù is displayed in the second column of the report), which were modified quite reasonably. <br><br><h3>  <font color="#3AC1EF">‚ñç7.5.3.2.</font>  <font color="#3AC1EF">File Monitoring: AIDE</font> </h3><br>  The Advanced Intrusion Detection Environment (AIDE) tool allows you to check the integrity of files and detects any changes compared to a previously saved, properly configured system.  The image is stored as a database ( <code>/var/lib/aide/aide.db</code> ) and contains the relevant data (checksums, permissions, time <code>/var/lib/aide/aide.db</code> ) about all the system files. <br><br>  You can install AIDE like this: <br><br><pre> <code class="hljs sql">apt <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> apt <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> aide</code> </pre> <br>  After installation, you need to initialize the database with the <code>aideinit</code> command.  This operation will then be performed daily (using the <code>/etc/cron.daily/aide</code> script) to check that the system files have not changed.  If changes are detected, AIDE writes them to log files ( <code>/var/log/aide/*.log</code> ) and sends the report to the administrator by email. <br><br><blockquote><h3>  <font color="#3AC1EF">‚ñç Protection of the AIDE database</font> </h3><br>  Since AIDE uses a local database to compare the state of files, the correctness of such comparisons is completely tied to the state of the database.  If an attacker gains superuser rights on a compromised system, he will be able to replace the database and hide the traces of the hack.  One way to prevent such an attack is to store the reference data on read-only media. </blockquote><br>  To configure the <code>aide</code> package, you can use the parameters in <code>/etc/default/aide</code> .  Namely, the internal settings of the program are stored in the <code>/etc/aide/aide.conf</code> and <code>/etc/aide/aide.conf.d/</code> (in fact, these are the only files used by <code>update-aide.conf</code> to form <code>/var/lib/aide/aide.conf.autogenerated</code> ).  The configuration indicates which properties of which files should be checked.  For example, the state of the log files is constantly changing, such changes can be ignored, as long as the permissions set for these files do not change.  However, in the case of executable files, both their content and permissions must remain unchanged.  Although these settings are not so complicated, the syntax of AIDE configuration files cannot be called completely intuitive, so for those who want to understand the AIDE configuration, we recommend reading <code>man</code> <code>aide.conf(5)</code> . <br><br>  A new version of the database is created daily at <code>/var/lib/aide/aide.db.new</code> .  If all committed changes are valid, it can replace the reference database. <br><br>  The Tripwire tool is very similar to AIDE.  Even the syntax of the configuration files is almost the same.  The main improvement that <code>tripwire</code> gives is the mechanism for signing the configuration file, with the result that the attacker cannot change it so that it points to a different version of the reference database. <br><br>  The Samhain tool also provides similar capabilities, as well as some functions designed to detect rootkits (this is discussed in the next box).  This program, in addition, can be deployed globally, across the network, and record the results of its work on the server (with a digital signature). <br><br><blockquote><h3>  <font color="#3AC1EF">‚ñçPacks checksecurity and chkrootkit / rkhunter</font> </h3><br>  The <code>checksecurity</code> package is a collection of small scripts that perform basic system checks (searching for empty passwords, new <code>setuid</code> files, and so on) and issue warnings if you can find something suspicious.  The package name, <code>checksecurity</code> , can give the administrator the impression that by checking the system with this package, you can guarantee its security.  However, do not fully rely on this package. <br><br>  The <code>chkrootkit</code> and <code>rkhunter</code> are designed to detect specific rootkits that can be installed in the system.  Rootkits are programs that are created in order to not attract the attention of the administrator, to use the computer imperceptibly.  The tests that perform the aforementioned packages cannot be called 100% reliable, but usually if they find something, it is worth paying attention to. </blockquote><br><h2>  <font color="#3AC1EF">Results</font> </h2><br>  Today we talked about monitoring and logging in Kali Linux.  The tools discussed here allow you to maintain the level of protection of the system and its performance in good condition, however, you should always remember that attackers have the means to counter many control systems.  In the next article, we will summarize the 7th chapter and offer you some exercises that will allow you to test your knowledge and learn something new about Kali Linux. <br><br>  Dear readers!  How do you organize monitoring of your Linux systems? </div><p>Source: <a href="https://habr.com/ru/post/338668/">https://habr.com/ru/post/338668/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../338656/index.html">How chat bots help build omnichanal experience</a></li>
<li><a href="../338660/index.html">HR robot calls thousands of people at the same time: we tell how</a></li>
<li><a href="../338662/index.html">How to make a career in digital: the first year of the life of an internet marketer</a></li>
<li><a href="../338664/index.html">I'd go to the programmers, let them teach me</a></li>
<li><a href="../338666/index.html">DI for fully reusable JSX components</a></li>
<li><a href="../338670/index.html">Cat or shellCode?</a></li>
<li><a href="../338672/index.html">Profiling project build</a></li>
<li><a href="../338674/index.html">Head, what should I do to get more money</a></li>
<li><a href="../338676/index.html">The final release of 3CX Call Flow Designer and 3CX courses in Belarus</a></li>
<li><a href="../338678/index.html">Moving to the cloud: 5 different stories</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>