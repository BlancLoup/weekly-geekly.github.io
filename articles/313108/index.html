<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pro friendship boa with an elephant, or our experience of integrating Bitrix24 with Cisco telephony</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One of the tenders gave us an interesting task: the customer needed CRM for the contact center of the residential and commercial real estate sales dep...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pro friendship boa with an elephant, or our experience of integrating Bitrix24 with Cisco telephony</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/d12/93b/7af/d1293b7af9ae4dff951b29302dc5c626.png"></div><br>  One of the tenders gave us an interesting task: the customer needed CRM for the contact center of the residential and commercial real estate sales department.  In addition to the implementation of a specific real estate catalog (chess facilities), integration with elements of the company's information infrastructure was required, among which was Cisco telephony (at the time of the commencement of work, <acronym>CUCM</acronym> 10.5).  Despite the complete lack of experience with Cisco products, we had a clear view of the implementation of the rest on the basis of Bitrix24, as well as little experience in building call centers and a fair amount of adventurism.  As a result, we proposed to organize a contact center at <acronym>UCCX</acronym> and associate the latter with Bitrix24.  What came out of it - under the cut. <br><a name="habracut"></a><br><h2>  Interaction scenarios </h2><br>  Each call to the sales department number linked to UCCX should be transferred to the operator responsible for this customer, to a public queue or to voice mail (the call flow chart will be lower).  When a call is made to a specific operator, a client card opens in its browser (for customers already existing in the system) or a sales script (for new customers). <br><br>  Calls to customers the operator makes of CRM by clicking on the link with the phone number, or direct dialing.  Missed or failed calls are recorded in a special report in CRM, where they are subsequently processed by the operator.  The management monitors the work statistics of the contact center in Bitrix24.  General scheme of product interconnections: <br><br><img src="https://habrastorage.org/files/ca4/171/3ef/ca41713eff4943408b1987a9eeb590aa.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, we implement the following interaction scenarios: <br><br><ul><li>  request for availability of a number in the base Bitrix24 and responsible for this number; </li><li>  opening a client card or a sales script in a browser; </li><li>  making an outgoing call from Bitrix24; </li><li>  viewing call center statistics from Bitrix24. </li></ul><br><h2>  Training </h2><br>  To at least somehow approach integration, we need local stands with all products (we had virtual machines on ESXi).  And if BitrixVM and Bitriks24 turned around in 15 minutes, the installation and configuration of CUCM + UCCX took away most of the time, which you can write a lot about for a long time.  Here we denote only some of the pitfalls that stumbled upon in the process. <br><br>  The first one is a long process of installing and starting / restarting the server.  10 minutes to start is normal.  When you first encounter, a little discouraging.  And taking into account the fact that, before obtaining an acceptable result, we had to reinstall the product 15 times, this resulted in quite a decent time. <br><br>  The second is that the phone template in CUCM should be IP4 only, not IP4 + IP6, otherwise it will not be possible to get CUCM users as UCCX agents. <br><br>  The third, which we encountered already when running at the customer - this is the limit on the length of the string in the user name.  Full name with more than 27 characters does not allow configuring users as agents.  When trying to configure, an error <b><i>‚ÄúError occured while reading the Resource‚Äù is displayed</i></b> . <br><br>  Now two words about the workplace of the contact center operator.  Of the two options offered by Cisco (the Finesse browser solution and the desktop <acronym>CAD</acronym> application for Windows), the choice fell on Finesse - a web client that implements all the necessary functionality on the operator‚Äôs side.  Other things being equal, it has a more modern look and blends perfectly with browser Bitrix24. <br><br>  So, <s>having completed 7 laps of hell</s> after the preparatory stage, we have two separately working systems: Bitrix24 and CUCM + UCCX.  But all the interesting is yet to come. <br><br><h2>  Integration </h2><br>  It should be noted that the SIP-connector comes bundled with Bitrix24, which allows you to connect office PBXs to Bitrix24, but the idea of ‚Äã‚Äãusing a regular module died without even having time to be born. <br><br>  The fact is that this module is a virtual cloud based PBX based on Voximplant, and according to customer requirements, all elements of the system must be located in the internal network.  Moreover, Asterisk as an interlayer (and by that time we had already mastered its direct integration with Bitrix24) did not suit the customer due to the lower reliability and resiliency of the system.  We only had to patiently smoke mana on UCCX. <br><br>  The integration itself can be divided into two parts: work on the side of UCCX / Finesse and work on the side of Bitrix24. <br><br><h4>  UCCX side actions </h4><br>  To begin, set up a queue - everything is according to the manual.  Next, we create a trigger, a special number, when transferring a call to which the application (application) is launched from CUCM - a kind of container that includes the script and the environment (variables, language, etc.).  Then we create a script (script) - a program in a special language that implements the call processing logic when passing through a call center.  To create it, use the UCCX Script Editor, which comes with the UCCX.  This tool allows you to create scripts and debug them.  You can download it from the <i>Cisco Unified UCCX Administrator Tools-&gt; Plugins</i> web interface.  Installs only on Windows.  Below is the script itself. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/1ae/037/0eb/1ae0370ebb7e4c06921a74e9c4d969dc.png"></div><br>  While working with different versions of UCCX, we noticed one feature: the script created in version 10.5 will not necessarily work in version 11.0.  In the process of working on the integration, we moved from UCCX 10.5 to 11.0, so we had to recreate the script in the editor of the 11th version. <br><br>  It is in the script that integration begins.  After receiving the client number, use the <i>Create URL Document</i> and <i>Create XML Document</i> to transfer the client number to CRM and get the number of the person in charge (or information about its absence), then transfer the call to a specific operator or to a queue. <br><br>  So that when you receive a call to an operator in Finesse, the necessary lead / contact opens in the next tab, using <i>Set Enterprise Call Info, we</i> save the caller's number in a variable that will be available in the Finesse handler.  A flowchart describing the call flow logic: <br><br><img src="https://habrastorage.org/files/0d9/769/9fc/0d97699fc8414d5291ac7ee083608aae.png"><br><br><h4>  Creating a workflow in Finesse </h4><br>  After the call went to the operator, he comes to Finesse.  If the client is already registered in R, a page with information about it is opened in the next tab.  If not, the sales script opens.  In Finesse, this is implemented through the <i>workflow</i> mechanism.  Select the event - call arrival, and determine the action for it.  Among the supported types of actions is <i>Open in a new tab</i> .  We set the path (our CRM, i.e. Bitrix24) and parameters (client id or sales script).  There is a mechanism for testing directly from Finesse, you only need to set the values ‚Äã‚Äãof variables.  All actions are done through the Finesse Administartor.  Screenshots below. <br><br><img src="https://habrastorage.org/files/f23/47f/db0/f2347fdb0c8a4216b9104fc36450dbfb.png"><br><br><img src="https://habrastorage.org/files/4b8/9e9/e42/4b89e9e428b34f5b87085f322e15d1f5.png"><br><br>  This is where the UCCX / Finesse work ends.  Go to Bitrix24. <br><br><h4>  Actions on the side of Bitrix24 </h4><br>  In Bitrix24, you need to create several scripts: <br><br>  <b>1. The script that processes the request for the presence of the number of the caller (client) in CRM Bitrix24.</b>  Using the API, we make a request for a lead / contact with a client number.  If there is a phone in the database, we transfer the internal number of the person in charge; if not, we create a lead with the caller‚Äôs phone and save, indicating a specially created account for the raw leads as the person in charge.  If the call is processed, the operator will be made responsible when filling in the sales script, if not - the lead will be included in the report on unprocessed calls, from where the first released operator will take it. <br><br>  <b>2. The script that initiates the outgoing call from Bitrix24.</b>  Clicking on the number inside the lead / contact card and on the lead / contact list page initiates a call through Finesse.  The integration mechanism is based on the Finesse REST API.  The <i>Dialog</i> object used <i>is Create a New Dialog (Make a Call)</i> .  Examples are in the Finesse manual. <br><br>  <b>3. Statistics.</b> <br>  Statistics are taken directly from UCCX.  <acronym>CCDR</acronym> records are stored in the Informix database on the UCCX server (although there are separate solutions when the CUIC (Cisco Unifiled Intelegence Center) is installed separately).  The third script is used to connect to Informix and get statistics data.  The main thing is to make a request correctly, and the resulting datetime lead to the time zone of the Bitrix24 server.  The structure of the base is a bit tricky, but all the tables and fields are described in detail in the manuals for Infomix.  These are the reports in CRM: <br><br><img src="https://habrastorage.org/files/a51/9a5/32a/a519a532ac954ea6a5f47da9f7ed87e5.png"><br><br><h2>  Total </h2><br>  This engineer will solve any technical problem - for him it is only a matter of time and motivation.  For us, this task turned into four months of immersion in a completely unknown product with its features and oddities.  It was not easy: despite the sleepless nights, some, at first glance obvious, the results on the control points could be achieved 15 minutes before the presentation to the customer.  And we did it: the system (except for the integration with telephony described here, it includes integration with three other external systems and about 400 hours for the implementation of specific functionality) was put into operation and successfully survived the major update of Bitrix24 (from version 15.5 to 16.5). </div><p>Source: <a href="https://habr.com/ru/post/313108/">https://habr.com/ru/post/313108/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../313098/index.html">Philippine Crosswords. Finalization of mobile 2D puzzles to work with color crosswords</a></li>
<li><a href="../313100/index.html">Testing EnGenius ezMaster Solution</a></li>
<li><a href="../313102/index.html">According to Rambler.iOS # 8</a></li>
<li><a href="../313104/index.html">Quality control code in the future development of the project</a></li>
<li><a href="../313106/index.html">5 best reports at the MBLTdev mobile developers conference 15</a></li>
<li><a href="../313110/index.html">How we tried DDD, CQRS and Event Sourcing and what conclusions did</a></li>
<li><a href="../313112/index.html">The peaceful profession of bomb shelter</a></li>
<li><a href="../313114/index.html">Top 5 Threats to Online Gaming Users</a></li>
<li><a href="../313116/index.html">A simple class for building lines of the level of a two-dimensional grid function</a></li>
<li><a href="../313118/index.html">Introduction to Labtech - we automate the work of a system administrator</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>