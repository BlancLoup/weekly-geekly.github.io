<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>On the road with clouds. Relational databases in a new technological context</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! We are thinking about the publication of an unusual book, the author of which wants to present a very interesting interpretation of the mode...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>On the road with clouds. Relational databases in a new technological context</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr!  We are thinking about the publication of an unusual book, the author of which wants to present a very interesting interpretation of the modern technological landscape encompassing Big Data databases and processing technologies.  The author believes that without the active use of clouds, there is no way to go, and he tells about this landscape from this perspective. <br><br>  About the author: <br><br>  <b>Alexander Vasilyevich Senko</b> , Candidate of Physical and Mathematical Sciences in the field of computer modeling and optimization of powerful superhigh-frequency devices. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The author is certified by Microsoft in the field of creating applications in the Microsoft Azure environment: Microsoft Certified Professional and Microsoft Specialist: Developing Microsoft Azure Solutions.  In 2008 he graduated from the Belarusian State University of Informatics and Radioelectronics (BSUIR) with a degree in ‚ÄúModeling and computer design of radio-electronic equipment‚Äù.  From 2007 to 2012, the author works at the Scientific Research Institute of Nuclear Problems of the BSU as a technician, laboratory technician, and engineer.  From 2013 to the present, the author works at <a href="http://www.issoft.by/">ISSoft Solutions</a> for the position of software developer and DevOps with a specialization in the creation of cloud applications based on the Microsoft stack. <br><br>  Under the cut, you can appreciate the ideas and style of the author.  Feel free to vote and comment - and welcome under the cat! <br><a name="habracut"></a><br>  <b>Introduction or why this article should write.</b> <br><br>  Currently, cloud services allow developers and system administrators to quickly create application infrastructure and just as quickly get rid of it when this is no longer necessary.  The fee is charged for the use of cloud resources and for their level of performance, also referred to as the ‚Äúprice level‚Äù - pricing tier.  You can quickly create resources, ‚Äúplay around‚Äù with them, ‚Äútouch‚Äù, master them, and at the same time absolutely do not need to worry about buying / administering servers, reading documentation about installing the required software, and so on. In cloud environments, all typical administration and monitoring tasks consolidated into convenient API or user interface of the web portal management.  But there is one complication - if a person does not understand or does not fully understand how cloud environments work, the task ‚Äúwhat do I need to do to get a database and connect to it from my application‚Äù at first is puzzling.  The abundance of cloud services and various ‚Äúprice levels‚Äù for each service further complicates the selection task.  This article presents a brief overview of one of the most popular cloud services ‚Äî relational database services. <br><br>  Relational databases are a traditional data warehouse.  Information in them can be presented in the form of a set of tables consisting of rows.  These tables are linked to each other using ‚Äúkeys‚Äù ‚Äîspecial integrity constraints, which match the rows of one table with the rows of another.  ‚ÄúBig data‚Äù is often more convenient to store and process more quickly in a non-relational form (for example, in key-value databases), but data stored as interconnected tables allow efficient analysis in any dimension ‚Äî across rows of related tables and across the table, that for the case of NoSQL databases is difficult.  In addition, for relational databases there is a very effective query language - SQL.  In cloud environments, relational databases are presented in two forms - SQL as a Service and as ready-made images for virtual machines.  Databases hosted on virtual machines, in fact, differ little from database servers hosted on traditional virtual and physical hosts.  At the same time, the choice of the type of virtual machine, virtual disks, cloud storage for their placement and network interfaces significantly affect its performance, but this is a topic for a separate chapter, and perhaps also a book.  Database servers hosted on virtual machines in the clouds have significant limitations associated with scaling, availability, and fault tolerance.  For example, Azure VMs at a service level agreement (availability level agreement) at the level of 99.95% only when using a cluster of at least two machines located in one common availability group (Availability Set), and they will physically have network interfaces and power supplies are separated.  In order to reach level 99.99 you need to configure a cluster of several Always On virtual machines. <br><br>  At the same time, SQL has an SLA of 99.99 without the additional difficulties associated with configuring clusters.  On the other hand, the requirements of the <a href="https://en.wikipedia.org/wiki/Health_Insurance_Portability_and_Accountability_Act">HIPPA</a> standards correspond to SQL servers hosted on virtual machines, but not the Azure SQL service.  The rest of the cloud SQL service has unrivaled capabilities in terms of scaling, availability and ease of administration (replication, backup, export, performance analysis of executed queries).  In addition, in some cases, SQL as a Service is significantly cheaper than a similar server that is hosted on a virtual machine (the author is aware that this is a very controversial statement, especially considering the particular use of resources in SQL as a Service and SQL on virtual machines).  SQL as a Service does not support all the capabilities of traditional database servers.  For example, the execution of queries from tables in one database inside another in the case of an SQL service is associated with a number of difficulties and limitations.  Consider examples of implementing SQL as a Service in different cloud environments. <br><br>  <b>Microsoft's Azure SQL relational database service.</b> <br><br>  Microsoft's SQL-As-A-Service implementation is a cloud relational database service based on the Microsoft SQL Server engine and is called Azure SQL.  The Azure SQL query language implements a subset of T-SQL functions.  Azure SQL service instances, which are direct equivalents of MS-SQL databases, are logically grouped into Azure SQL Server ‚Äúservers‚Äù.  Each Azure SQL server must have a unique URL, credentials (username and password), and a set of valid IP addresses that can access it (this list is generated in the server‚Äôs firewall and regulates the rules for accessing it). <br><br>  Physically, Azure SQL Server is located in a data center ‚Äì e located in a specific geographic region.  All instances of Azure SQL databases are located in the same region.  It is also possible to geographically replicate databases in several regions using the Primary-Secondary or Primary-ReadOnly Replica scheme (the primary server is a read-only replica).  With extensive T-SQL support in Azure SQL, you can directly migrate databases from Microsoft SQL Server to Azure SQL.  Of course, direct migration from one type of database to another is far from simple and not a quick task, but in this case it is possible in principle and directly supported using special programs from Microsoft, Red Gate, etc. However, it should be borne in mind that this In some cases, the software simply ‚Äúcuts out‚Äù incompatible database objects without trying to adapt them.  And it may happen that after such a migration, the database ‚Äúrose‚Äù, but happy developers can ‚Äúsuddenly‚Äù miss a number of database objects in Azure SQL.  Each database instance has a certain ‚Äúprice level‚Äù - pricing tier - which is characterized by its performance, limitations on size, number of recovery points, and replication capabilities.  All possible price levels are divided into the following levels: basic (‚ÄúBasic‚Äù), standard (‚ÄúStandard‚Äù) and premium (‚ÄúPremium‚Äù).  The most important difference in price levels is manifested in the different values ‚Äã‚Äãof DTU - a generalized parameter characterizing database performance.  What is this parameter?  DTU (eDTU) is a generalized characteristic of database performance that includes performance indicators for the central processor, memory, I / O devices, and the network interface.  This metric defines a kind of ‚Äúvolume‚Äù that can ‚Äúoccupy‚Äù Azure SQL performance.  If a request is currently being executed in the database, this request consumes a certain amount of resources, which occupy a part of this allowed volume (see Figure 1).  It should be borne in mind that not only the volume, but also the specific values ‚Äã‚Äãof each of the indicators is limited (that is, it will not be possible to ‚Äúexchange‚Äù the extremely small use of the CPU for an extremely large memory value).  This is manifested in particular in the fact that one ‚Äúcurve‚Äù query can cause reuse of one of the resources and, as a result, weigh the entire database (an instance of the Azure SQL Database service but not the Azure SQL Server) and the exact same query will normally work in the traditional database Microsoft SQL Server.  This is because, in Azure SQL, the mechanism for protecting database resources from excessive use is triggered, which forces the process that triggered the request to time out, thereby freeing up database resources. <br><img src="https://habrastorage.org/web/41f/b6b/d6a/41fb6bd6ad5149e4b9034208febff0f3.jpg"><br>  So, Azure SQL consists of instances of the Azure SQL Database, which are actually relational repositories of information with specific values ‚Äã‚Äãfor size and maximum DTU;  an Azure SQL Server instance that groups the Azure SQL Database, providing them with a common connection string, access rules written in the firewall and in some cases providing a common elastic resource pool (Elastic Database Pool, which is described below). <br><br>  Now let's get acquainted with Elastic Database Pool.  This service is built into Azure SQL Server and is used to pool databases into one pool and assign shared resources to all of them.  Why do you need it?  Consider an example of a SaaS application created to provide certain services to users registered in it (for example, this is a cloud-based CRM system).  Each registered user of such a system is allocated its own database of a certain level of performance, expressed by a specific DTU value.  Each performance level has a certain monthly cost, which ultimately affects the profit of the SaaS owner - it will be equal to the total monthly fee of all users minus the cost of cloud services underlying the system architecture.  Now suppose that user activity, expressed in the use of the DTU of each base, is unrelated, i.e.  they load their bases at various random time intervals.  This leads to the fact that there are moments of time when the use of the DTU database of a particular user is very small, and moments when it is great.  Thus, at the moment of small use of the DTU, the bases are ‚Äúidle‚Äù - but they are charged for by Azure.  And what if we take several such databases, that the activity intervals of each coincide with the underload intervals of others, and combine them into a common pool of databases and distribute the total DTU resources between the databases so that the total load is uniform in time;  the fee for the price level will be significantly less than the total fee for all databases.  This idea is the basis of the Azure Elastic Database Pool service.  In addition, ElasticDatabasePool allows you to implement scenarios for dividing one large database into smaller ones, but to perform queries in this divided into ‚Äúfragments‚Äù (shard) database as if it were one monolithic database. <br><br>  Consider now the case when it is still necessary to perform a query to the data located in different databases.  If there is just a set of databases without fragmentation, it is necessary to select one head database and create external data sources and external tables (reference table) in it, which are ‚Äúreflections‚Äù of real tables hosted in other databases.  You can also not use a specialized head database, but <a href="https://docs.microsoft.com/en-us/azure/sql-database/sql-database-elastic-query-getting-started-vertical">create tables</a> in each instance of the Azure SQL Database.  The disadvantage of this approach is that when changing table schemas in databases, you need to synchronously change the schemas in external tables (if there is no master database, then a lot of work needs to be done on changing the schema in all external tables in all databases where they are present) .  In addition, T-SQL implementations in Azure SQL have data type restrictions for external tables (for example, they do not support Foreign Key and nvatrchar (max) type) and currently there are a number of restrictions on executing such queries and databases, where these queries will be executed - for example, it is impossible to export a database to a BACPAC file if it contains references to <a href="https://docs.microsoft.com/en-us/azure/sql-database/sql-database-elastic-query-overview">external tables</a> .  Well, we should not forget about the decline in performance for such requests.  But what does it all look like? <br><br>  Let's assume for definiteness that we have two databases - the First database and the Second database.  Now let's say that from the Second database we need to execute a query to the First database.  To do this, credentials must be created in the Second database that will be used to access the First database: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MASTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> ENCRYPTION <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PASSWORD</span></span> = <span class="hljs-string"><span class="hljs-string">'&lt;0&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> SCOPED CREDENTIAL FirstDBQueryCred <span class="hljs-comment"><span class="hljs-comment">--     WITH IDENTITY = '&lt;&gt;', SECRET = '&lt;0&gt;';</span></span></code> </pre> <br>  Then, in the Second database, create an external data source that will be used to link to the tables of the external database: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXTERNAL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATA</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SOURCE</span></span> FirstDatabaseDataSource <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">TYPE</span></span> = RDBMS, LOCATION = <span class="hljs-string"><span class="hljs-string">'&lt;logical_server_name&gt;.database.windows.net'</span></span>, DATABASE_NAME = <span class="hljs-string"><span class="hljs-string">'First'</span></span>, CREDENTIAL = FirstDBQueryCred )</code> </pre><br>  After that, in the Second database, you need to create an ‚ÄúExternal Table‚Äù (External Table) - a table that is a ‚Äúreflection‚Äù of a similar table located in the First database: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXTERNAL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> [dbo].[TableFromFirstDatabase] ( [KeyFieldID] [<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [DataField] [<span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>](<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> ( DATA_SOURCE = FirstDatabaseDataSource)</code> </pre> <br>  And that's it!  Now we can make queries to the table from the First database in the Second database as to an ordinary table located in the Second database.  It should be borne in mind that these tables are connected only by data - any changes in the schema in one database will not affect the schema of the table in another. <br><br>  Another possible case of querying various databases is to use <a href="https://docs.microsoft.com/en-us/azure/sql-database/sql-database-elastic-jobs-overview">Elastic Database jobs</a> .  The essence of this technology is that a group of databases is combined and managed centrally from a common specialized VM head server.  By interacting with this server programmatically or through Azure Portal, you can manage all connected databases by creating jobs.  These tasks may be of the following nature: <br><br><ul><li>  administrative (consistent schema change, performing index compilation); </li><li>  periodically updating data or collecting data for BI systems, incl.  for analyzing large amounts of data. </li></ul><br>  The Elastic Database jobs service contains the following components (Figure 2): <br><img src="https://habrastorage.org/web/a51/020/123/a51020123b2c485d8a79e4a495c840c1.jpg"><br><ul><li>  host server hosted on an Azure Cloud Service Worker Role instance.  In essence, this is specialized software that is hosted (as of now) on the virtual Azure Cloud Service.  To ensure high availability, it is recommended to create at least 2 VM instances; </li><li>  control database.  This is an instance of Azure SQL that serves to store the metadata of all connected databases; </li><li>  An Azure Service Bus instance that serves to combine and synchronize all components. </li><li>  An instance of the Azure Storage Account cloud storage that serves to store the logs of the entire system. </li></ul><br>  Configuring, using and administering this entire system is a rather complicated topic and will not be discussed in detail.  Those interested can read the topic <a href="https://docs.microsoft.com/en-us/azure/sql-database/sql-database-elastic-scale-get-started">here</a> . <br><br>  In addition to single databases, AzureSQL allows you to create more complex relational repositories ‚Äî fragmented databases ‚Äî Sharded Databases and relational repositories with broad support for massively parallel query execution ‚Äî Azure SQL DWH. <br><br>  Consider the first fragmented database.  The need for database fragmentation occurs when its size becomes excessively large to fit on a single instance of Azure SQL (currently more than 1 TB for Premium pricing tier).  Of course, you can break a large database into smaller databases logically by analyzing its structure (schema).  As mentioned earlier, Azure SQL Server is a logical grouping of Azure SQL Database instances, and not a physical union on a single server.  And direct queries to database objects from another database are possible only if these objects are External table or these databases are combined in the Elastic Database Pool, and Elastic Database Query queries or Elastic Transactions transactions are used.  In this case, it is necessary to apply sharding the database.  Database fragmentation is essentially horizontal scaling, different from vertical scaling ‚Äî increasing the ‚Äúsize‚Äù of the database across CPU, RAM, IOPs, and so on. Splitting one large repository into several smaller repositories and parallel processing all of them, then adding them processing results is the key concept of all big data processing technologies, with which we will continue to meet more than once. </div><p>Source: <a href="https://habr.com/ru/post/330364/">https://habr.com/ru/post/330364/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../330354/index.html">Video: indie developers about failure, success and monetization</a></li>
<li><a href="../330356/index.html">Chromium based browsers - now also in ReactOS</a></li>
<li><a href="../330358/index.html">Rapid STP</a></li>
<li><a href="../330360/index.html">Freeswitch Phonebook</a></li>
<li><a href="../330362/index.html">Mikrotik. QoS for home</a></li>
<li><a href="../330366/index.html">We are building the development process and the CI pipeline, or How can a developer become DevOps for QA</a></li>
<li><a href="../330368/index.html">‚ÄúBreak the vote on RHS ++‚Äù. Give us 1,000,000 RPS</a></li>
<li><a href="../330370/index.html">What is exclusive blockchains?</a></li>
<li><a href="../330372/index.html">Implementing Lean tools in the Service Desk command</a></li>
<li><a href="../330374/index.html">Working with peripherals from JavaScript: from theory to practice</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>