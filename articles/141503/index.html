<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>State machines. We write DKA</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you ever tried to write your bot, the negotiating program (negotiator), the interpreter of the communication protocol and the like, then you probab...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>State machines. We write DKA</h1><div class="post__text post__text-html js-mediator-article">  If you ever tried to write your bot, the negotiating program (negotiator), the interpreter of the communication protocol and the like, then you probably faced with the state machines.  This topic is in principle not a big deal, but if suddenly you didn‚Äôt have a course on the theory of automata, you are welcome under cat. <br><br>  Today we will try to create a simple deterministic state machine.  I suddenly wanted to write it in Perl, but since we will not use any specific tricks, transferring the general concept to any other imperative language will not be difficult. <br><a name="habracut"></a><br><h4>  Introduction </h4><br>  We will not go deep into the theory, for this there is a special literature, Google and Wikipedia;).  Consider the very base.  Let's see what a state machine is. <br><br>  In electronics, and in programming, in the simplest case, we are dealing with so-called "switching functions".  This is a relatively primitive abstraction that does not have its own memory: we are an input to the argument, it is some kind of output.  The output value always depends on the input. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And if it is necessary for us, that the subsequent value of function depended on previous?  From the previous few?  Here we come to a certain abstraction with its own memory.  This will be automatic.  The output value on the automaton depends on the input value and the current state of the automaton. <br><br>  A finite state machine, respectively, is therefore called that the number of its internal states is finite.  And, probably, the simplest of finite automata is deterministic: for each input signal there is only one state into which the automaton can go from the current one. <br><br>  Thus, our machine is defined as follows: <br><ul><li>  initial state; </li><li>  input alphabet (set of possible input signals); </li><li>  many states; </li><li>  and transition table. </li></ul><br>  Actually the whole essence of the machine is determined by the last item.  The transition table (also depicted as a transition diagram) consists of 3 columns: the input signal (symbol), the current state, the next state.  Everything will become clear with an example. <br><br><h4>  Base class </h4><br>  So, we implement our base class.  We have already decided that we need the initial state, the current state and the transition table.  The alphabet of input characters is determined by the task, so we also need to normalize (simplify) the input.  The output signals will be executed by the descendant class's executable methods.  To simplify your life, artificially add to the alphabet the symbol "*" - any other symbol. <br><br><pre><code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> FSM; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> strict; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> Carp; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> vars <span class="hljs-string"><span class="hljs-string">qw($AUTOLOAD)</span></span>; <span class="hljs-comment"><span class="hljs-comment"># Create new object sub new { my $self = {}; my ($proto, $initial) = @_; my $class = ref($proto) || $proto; # Init ourselves $self-&gt;{INITIAL} = $initial; $self-&gt;{CURRENT} = $initial; $self-&gt;{STATES} = {}; bless ($self, $class); return $self; } sub setInitialState { my ($self, $initial) = @_; $self-&gt;{INITIAL} = $initial; return $self; } sub setCurrentState { my ($self, $current) = @_; $self-&gt;{CURRENT} = $current; return $self; } sub getCurrentState { my ($self, $current) = @_; return $self-&gt;{CURRENT}; } sub reset { my $self = shift; $self-&gt;{CURRENT} = $self-&gt;{INITIAL}; return $self; } sub addState { my $self = shift; my %args = @_; $self-&gt;{STATES}-&gt;{$args{STATE}}-&gt;{$args{SYMBOL}} = {NEXT =&gt; $args{NEXT}, ACTION =&gt; $args{ACTION}}; return $self; } sub removeState { my $self = shift; my %args = @_; if (exists $args{SYMBOL}) { delete $self-&gt;{STATES}-&gt;{$args{STATE}}-&gt;{$args{SYMBOL}}; } else { delete $self-&gt;{STATES}-&gt;{$args{STATE}}; } return $self; } # Be sure to override in child sub normalize { my ($self, $symbol) = @_; my $ret = {}; $ret-&gt;{SYMBOL} = $symbol; return $ret; } sub process { my ($self, $rawSymbol) = @_; my $state = $self-&gt;{STATES}-&gt;{$self-&gt;{CURRENT}}; $rawSymbol = $self-&gt;normalize($rawSymbol); my $symbol = $rawSymbol-&gt;{SYMBOL}; print STDERR "Current state " . $self-&gt;{CURRENT} . ", got symbol " . $symbol . "\n"; if (!exists $state-&gt;{$symbol} &amp;&amp; exists $state-&gt;{'*'}) { print STDERR "Unrecognized symbol " . $symbol . ", using *\n"; $symbol = "*"; } # Do some action! $state-&gt;{$symbol}-&gt;{ACTION}($self, $rawSymbol) if ref $state-&gt;{$symbol}-&gt;{ACTION}; # Switch state if (exists $state-&gt;{$symbol}-&gt;{NEXT}) { $self-&gt;{CURRENT} = $state-&gt;{$symbol}-&gt;{NEXT}; } else { die "Don't know how to handle symbol " . $rawSymbol-&gt;{SYMBOL}; } return $self; } 1;</span></span></code> </pre> <br>  I believe that the names of all the methods speak for themselves.  Perhaps you should stop at the <b>normalize</b> and <b>process</b> methods.  The first converts the input string to a hash containing the SYMBOL field with an automaton-simplified input symbol.  And the <b>process itself</b> performs the ‚Äúclocking‚Äù of the state transition processes, processing the next signal. <br><br>  Briefly consider how it works.  The heart of the class is the STATES transition table, which is a hash of hashes hashes :).  The idea here is simple, on the first level we have a list of states (STATE) and related attributes.  Since the transition is determined only by the input symbol (SYMBOL), respectively, these attributes will be the actual signals valid for this state.  Well, by the signal we can already determine the next state (NEXT) and, in the appendage, the action performed (ACTION), which is just a reference to the method. <br><br>  Those.  by <b>process,</b> we first get the character of the input alphabet from the input string ( <b>normalize</b> ), then we get the current state from the list of states.  We look, whether the entering character is defined for it.  If it is not defined, then we consider that "*" has flown to us - any other symbol.  Next, we look whether the action is defined for the state-signal pair.  If defined, execute.  And go to the next state, if it is defined (change the variable CURRENT).  If not defined, then in fact it is a fatal error for our machine. <br><br>  For educational purposes, of course, we display information about the switching of the automaton in STDERR, I think it will not be difficult for you if you need to wrap this output in a log for debug or the like. <br><br><h4>  Example </h4><br>  Let's try to implement something.  Let it be some kind of chat bot. <br>  We base it on the following rules: <br><ul><li>  You must first <b>log in</b> before executing the commands. </li><li>  By the command <b>memorize,</b> we will memorize everything that the user enters, the end by the command <b>exit</b> </li><li>  At the command <b>say N,</b> display the memorized phrase number N </li><li>  The end of the session will be the <b>exit command</b> </li></ul><br><br>  So, we create the transition table for this example: <br><table><tbody><tr><th>  Symbol </th><th>  condition </th><th>  Next state </th><th>  Act </th></tr><tr><td>  LOGIN </td><td>  INIT </td><td>  SESSION </td><td>  Opening session </td></tr><tr><td>  * </td><td>  INIT </td><td>  INIT </td><td>  - </td></tr><tr><td>  * </td><td>  SESSION </td><td>  SESSION </td><td>  - </td></tr><tr><td>  SAY </td><td>  SESSION </td><td>  SESSION </td><td>  Print line number N </td></tr><tr><td>  EXIT </td><td>  SESSION </td><td>  INIT </td><td>  - </td></tr><tr><td>  MEMORIZE </td><td>  SESSION </td><td>  STORE </td><td>  - </td></tr><tr><td>  * </td><td>  STORE </td><td>  STORE </td><td>  Save string to buffer </td></tr><tr><td>  EXIT </td><td>  STORE </td><td>  SESSION </td><td>  - </td></tr></tbody></table><br>  Total, the automaton alphabet consists of symbols (LOGIN, MEMORIZE, SAY, EXIT, *), the automaton has 3 states (INIT, SESSION and STORE). <br><br>  Well, let's implement it.  First of all, we will set the transition table in the constructor, where necessary - add references to the methods being called.  No difficulties :) <br><br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> ChatBot; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> FSM; @ISA = (<span class="hljs-string"><span class="hljs-string">"FSM"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> strict; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> Carp; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> vars <span class="hljs-string"><span class="hljs-string">qw($AUTOLOAD)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $proto = <span class="hljs-keyword"><span class="hljs-keyword">shift</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $class = <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span>($proto) || $proto; <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $self = $class-&gt;SUPER::new(<span class="hljs-string"><span class="hljs-string">"INIT"</span></span>); $self-&gt;addState(<span class="hljs-string"><span class="hljs-string">STATE =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"INIT"</span></span>, <span class="hljs-string"><span class="hljs-string">SYMBOL =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"*"</span></span>, <span class="hljs-string"><span class="hljs-string">NEXT =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"INIT"</span></span>, <span class="hljs-string"><span class="hljs-string">ACTION =&gt;</span></span> \&amp;doIntroduce); $self-&gt;addState(<span class="hljs-string"><span class="hljs-string">STATE =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"INIT"</span></span>, <span class="hljs-string"><span class="hljs-string">SYMBOL =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"LOGIN"</span></span>, <span class="hljs-string"><span class="hljs-string">NEXT =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"SESSION"</span></span>, <span class="hljs-string"><span class="hljs-string">ACTION =&gt;</span></span> \&amp;doLogin); $self-&gt;addState(<span class="hljs-string"><span class="hljs-string">STATE =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"INIT"</span></span>, <span class="hljs-string"><span class="hljs-string">SYMBOL =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"EXIT"</span></span>, <span class="hljs-string"><span class="hljs-string">NEXT =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"INIT"</span></span>, <span class="hljs-string"><span class="hljs-string">ACTION =&gt;</span></span> \&amp;doQuit); $self-&gt;addState(<span class="hljs-string"><span class="hljs-string">STATE =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"SESSION"</span></span>, <span class="hljs-string"><span class="hljs-string">SYMBOL =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"*"</span></span>, <span class="hljs-string"><span class="hljs-string">NEXT =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"SESSION"</span></span>); $self-&gt;addState(<span class="hljs-string"><span class="hljs-string">STATE =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"SESSION"</span></span>, <span class="hljs-string"><span class="hljs-string">SYMBOL =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"EXIT"</span></span>, <span class="hljs-string"><span class="hljs-string">NEXT =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"INIT"</span></span>); $self-&gt;addState(<span class="hljs-string"><span class="hljs-string">STATE =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"SESSION"</span></span>, <span class="hljs-string"><span class="hljs-string">SYMBOL =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"SAY"</span></span>, <span class="hljs-string"><span class="hljs-string">NEXT =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"SESSION"</span></span>, <span class="hljs-string"><span class="hljs-string">ACTION =&gt;</span></span> \&amp;doSay); $self-&gt;addState(<span class="hljs-string"><span class="hljs-string">STATE =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"SESSION"</span></span>, <span class="hljs-string"><span class="hljs-string">SYMBOL =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"MEMORIZE"</span></span>,<span class="hljs-string"><span class="hljs-string">NEXT =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"STORE"</span></span>); $self-&gt;addState(<span class="hljs-string"><span class="hljs-string">STATE =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"STORE"</span></span>, <span class="hljs-string"><span class="hljs-string">SYMBOL =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"*"</span></span>, <span class="hljs-string"><span class="hljs-string">NEXT =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"STORE"</span></span>, <span class="hljs-string"><span class="hljs-string">ACTION =&gt;</span></span> \&amp;doRemember); $self-&gt;addState(<span class="hljs-string"><span class="hljs-string">STATE =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"STORE"</span></span>, <span class="hljs-string"><span class="hljs-string">SYMBOL =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"EXIT"</span></span>, <span class="hljs-string"><span class="hljs-string">NEXT =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">"SESSION"</span></span>); $self-&gt;{SESSION} = {}; $self-&gt;{LOGIN} = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $self; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">normalize</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> ($self, $symbol) = @_; <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $ret = {}; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($symbol =~ <span class="hljs-regexp"><span class="hljs-regexp">/^(\S+)(.*)$/</span></span>) { $ret-&gt;{SYMBOL} = <span class="hljs-keyword"><span class="hljs-keyword">uc</span></span> $1; $ret-&gt;{DATA} = $2; $ret-&gt;{RAW} = $symbol; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $ret-&gt;{SYMBOL} = <span class="hljs-string"><span class="hljs-string">"*"</span></span>; $ret-&gt;{DATA} = $symbol; $ret-&gt;{RAW} = $symbol; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $ret; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doIntroduce</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $self = <span class="hljs-keyword"><span class="hljs-keyword">shift</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"Please introduce yourself first!\n"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $self; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doLogin</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> ($self, $symbol) = @_; <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"Welcome,"</span></span> . $symbol-&gt;{DATA} . <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; $self-&gt;{LOGIN} = $symbol-&gt;{DATA}; $self-&gt;{SESSION}-&gt;{$self-&gt;{LOGIN}} = () <span class="hljs-keyword"><span class="hljs-keyword">unless</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exists</span></span> $self-&gt;{SESSION}-&gt;{$self-&gt;{LOGIN}}; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $self; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSay</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> ($self, $symbol) = @_; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">defined</span></span> $self-&gt;{SESSION}-&gt;{$self-&gt;{LOGIN}}-&gt;[$symbol-&gt;{DATA}]) { <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> $self-&gt;{SESSION}-&gt;{$self-&gt;{LOGIN}}-&gt;[$symbol-&gt;{DATA}]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"No record\n"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $self; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doRemember</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> ($self, $symbol) = @_; <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> @{ $self-&gt;{SESSION}-&gt;{$self-&gt;{LOGIN}} }, $symbol-&gt;{RAW}; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $self; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doQuit</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> ($self, $symbol) = @_; <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"Bye bye!\n"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $self; } <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br>  The transition diagram is as follows. <br><br><img src="https://habrastorage.org/storage2/947/f0a/be3/947f0abe3fece8786be6b7ed291dbe75.png"><br><br>  The transition table in this case will have the following form: <br><pre> <code class="perl hljs">{ <span class="hljs-string"><span class="hljs-string">'INIT'</span></span> =&gt; { <span class="hljs-string"><span class="hljs-string">'*'</span></span> =&gt; { <span class="hljs-string"><span class="hljs-string">'ACTION'</span></span> =&gt; \&amp;doIntroduce, <span class="hljs-string"><span class="hljs-string">'NEXT'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'INIT'</span></span> }, <span class="hljs-string"><span class="hljs-string">'LOGIN'</span></span> =&gt; { <span class="hljs-string"><span class="hljs-string">'ACTION'</span></span> =&gt; \&amp;doLogin, <span class="hljs-string"><span class="hljs-string">'NEXT'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SESSION'</span></span> }, <span class="hljs-string"><span class="hljs-string">'EXIT'</span></span> =&gt; { <span class="hljs-string"><span class="hljs-string">'ACTION'</span></span> =&gt; \&amp;doQuit, <span class="hljs-string"><span class="hljs-string">'NEXT'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'INIT'</span></span> } }, <span class="hljs-string"><span class="hljs-string">'STORE'</span></span> =&gt; { <span class="hljs-string"><span class="hljs-string">'*'</span></span> =&gt; { <span class="hljs-string"><span class="hljs-string">'ACTION'</span></span> =&gt; \&amp;doRemember, <span class="hljs-string"><span class="hljs-string">'NEXT'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'STORE'</span></span> }, <span class="hljs-string"><span class="hljs-string">'EXIT'</span></span> =&gt; { <span class="hljs-string"><span class="hljs-string">'NEXT'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SESSION'</span></span> } }, <span class="hljs-string"><span class="hljs-string">'SESSION'</span></span> =&gt; { <span class="hljs-string"><span class="hljs-string">'SAY'</span></span> =&gt; { <span class="hljs-string"><span class="hljs-string">'ACTION'</span></span> =&gt; \&amp;doSay, <span class="hljs-string"><span class="hljs-string">'NEXT'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SESSION'</span></span> }, <span class="hljs-string"><span class="hljs-string">'*'</span></span> =&gt; { <span class="hljs-string"><span class="hljs-string">'NEXT'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SESSION'</span></span> }, <span class="hljs-string"><span class="hljs-string">'MEMORIZE'</span></span> =&gt; { <span class="hljs-string"><span class="hljs-string">'NEXT'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'STORE'</span></span> }, <span class="hljs-string"><span class="hljs-string">'EXIT'</span></span> =&gt; { <span class="hljs-string"><span class="hljs-string">'NEXT'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'INIT'</span></span> } } }</code> </pre><br>  We write the simplest program using these classes. <br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> ChatBot; $bot = ChatBot-&gt;new(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(&lt;&gt;) { $bot-&gt;process($_); }</code> </pre><br>  Well, a simple check.  On input we will give the following sequence. <br><pre> <code class="hljs dos">hello world! login <span class="hljs-variable"><span class="hljs-variable">%username%</span></span> hello world! say <span class="hljs-number"><span class="hljs-number">3</span></span> memorize hey, <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> you really remember everything i would say? let's check <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> say <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> hello login <span class="hljs-variable"><span class="hljs-variable">%username%</span></span> say <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span></code> </pre><br>  What do we get at the output? <br><pre> <code class="hljs perl">Please introduce yourself first! Welcome, %username% No record hey, <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> you really remember everything i would <span class="hljs-keyword"><span class="hljs-keyword">say</span></span>? Please introduce yourself first! Welcome, %username% let<span class="hljs-string"><span class="hljs-string">'s check</span></span></code> </pre><br>  In general, try it yourself. <br><br><h4>  Conclusion </h4><br>  Thus, we implemented the simplest finite state machine.  It seems to be nothing complicated?  Where can it come in handy?  Well, with chat bots everything is clear.  Approximately the same thing happens if on the other side there is not a person, but a piece of iron - by transmitting commands and listening to the answers, we can write a bot that tweaks the router, for example.  Interactive command interfaces?  Yes, we actually implemented it now!  Want to connect to a service using a stateful protocol?  Nothing is easier! <br><br>  I hope my article was at least helpful to someone.  Yes, the implementation is primitive, there are a great many ready-made ones.  But it's interesting to try to do something from scratch, right? <br><br>  I would welcome any comments. </div><p>Source: <a href="https://habr.com/ru/post/141503/">https://habr.com/ru/post/141503/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../141497/index.html">20 trends in the mobile gaming industry</a></li>
<li><a href="../141498/index.html">A new version of the package manager NuGet 1.7 has been released.</a></li>
<li><a href="../141499/index.html">Electronics MK-85 and information security - the continuation of the story</a></li>
<li><a href="../141500/index.html">Let's Talk About Control</a></li>
<li><a href="../141501/index.html">Understand the decorators in Python'e, step by step. Step 2</a></li>
<li><a href="../141504/index.html">Android application architecture. Part IV - integration level</a></li>
<li><a href="../141505/index.html">The program for cutting bread</a></li>
<li><a href="../141506/index.html">Freedom is worse than non-freedom</a></li>
<li><a href="../141507/index.html">Implementing exceptions on plain C</a></li>
<li><a href="../141509/index.html">Workflow organization: synchronization channel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>