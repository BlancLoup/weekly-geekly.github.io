<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Case development of the mobile application "My Beeline" under the Apple Watch: how the spears broke</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The first and main problem we encountered when developing an application for the Apple Watch was the lack of test devices. A significant part of the p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Case development of the mobile application "My Beeline" under the Apple Watch: how the spears broke</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/14e/647/8f9/14e6478f90df45c9bd7cec3410239a8f.png" alt="image" align="left">  The first and main problem we encountered when developing an application for the Apple Watch was the lack of test devices.  A significant part of the problems that will be discussed in this article is directly related to this fact.  Well, and then we hit the clock and danced with tambourines again, so that the application would work correctly, and just hit the counter. <br><br><h4>  <b>Idea, design and start of development</b> </h4><br>  We started to deal with the Apple Watch in November 2014, as soon as the WatchKit SDK appeared in the access.  Thoroughly studied the guidelines and all the information that was available on the network.  At the time of the immediate start of the development of the application ‚ÄúMy Beeline‚Äù under the Apple Watch, we already had a developed set of ideas and a clear understanding of what we want to get at the output.  Consumer research was not conducted on this project, but wearables came to the rescue with our own user experience - many Redmadrobot employees used Pebble long ago, and we drew more than one prototype for this watch and experimented with drawing Android Wear concepts.  For Apple Watch, we thought up user scenarios and how this all could integrate with the main iOS application.  The script was used on the Beeline SDK and on the Apple Watch SDK, after which it became clear what should be done and what should not or cannot be implemented in principle. <br><a name="habracut"></a><br>  Artur Sakharov ( <a href="https://habrahabr.ru/users/mc_murphy/" class="user_link">mc_murphy</a> ), CTO <br><blockquote>  <i>‚ÄúWe offered‚Äú Beeline ‚Äùthis application not as a set of elements, but as a complete product for watches.</i>  <i>And Beeline gave us the opportunity to realize it.</i>  <i>That is, it was not typical for the development of standard applications to align with the acceptance of each individual screen.</i>  <i>This allowed to prepare for the release of hours in advance.</i>  <i>It took two weeks to develop, and only two months passed from the idea to the appearance of the application in the store.</i>  <i>We did everything we wanted and what was possible: the application itself, notifications, Glances. ‚Äù</i> </blockquote><br>  Dmitry Pankrushev, VimpelCom OJSC <br><blockquote>  <i>‚ÄúWe tried to give our customers the opportunity to use the application‚Äú My Beeline ‚Äùon this geek device too, therefore, they were the first among the telecom companies to implement the application for Apple Watch.</i>  <i>In the next two releases, we intend to complete the development of the core functionality of the application.</i>  <i>Major development efforts will focus on improving UI / UX and increasing stability.</i>  <i>And, of course, we will add new functionality - here we are following user comments.</i>  <i>In general, our attention is focused on the development of the entire ecosystem of Beeline applications. ‚Äù</i> </blockquote><br>  <b>Application Functionality</b> <b><br></b> <ul><li>  Screen with a hint for authorization </li><li>  Balance and "batteries" (calls, sms and Internet traffic) </li><li>  User data update by force touch gesture </li><li>  Glance (widget) with the latest data from the application </li><li>  Broadcast push from the application on the phone to the clock </li></ul><br><img src="https://habrastorage.org/files/24c/ed4/fdd/24ced4fdd4f14817858e2c9d63a93d04.png"><br><br>  Katya Sotova ( <a href="https://habrahabr.ru/users/lost_in_purple/" class="user_link">lost_in_purple</a> ), designer <br><blockquote>  <i>‚ÄúThe study of the guidelines made it clear that Apple Watch should not be considered as an independent device - it is always paired with the phone and is its complement, the second display.</i>  <i>We began to think what the Beeline subscriber would like to see on the clock.</i>  <i>The most current information that comes to your phone in the form of notifications and messages.</i>  <i>Balance, SMS balance, minutes of conversation and Internet traffic in accordance with the tariff.</i>  <i>This information can be obtained by typing a long code from a combination of characters, or to get into a regular application from a smartphone.</i>  <i>That is, it is a slow process that we wanted to speed up.</i>  <i>In this sense, Apple Watch turned out to be a very suitable tool.</i> <i>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </i>  <i>Actual information should be visually clear and understandable.</i>  <i>When it comes to some digital value, often the user is not primarily worried about the numbers themselves, but simply leaving something for him or has arrived - he has spent all SMS or almost everything, and, accordingly, is it necessary to do something.</i>  <i>For visualization, we decided to use round diagrams, which allow one glance, without reading, to understand how things are.</i>  <i>To them, we also made an animation.</i>  <i>When the screen opens, the spinner is unscrewed on it to the state in which the user's balance or balance is found according to certain parameters.</i> <br><br><img src="https://habrastorage.org/files/572/706/81f/57270681f02542098f896011c3aeee81.png"><img src="https://habrastorage.org/files/3e2/13c/0af/3e213c0afe2542368aa3ae61070b67bc.png"><img src="https://habrastorage.org/files/0af/31a/bd0/0af31abd00ed4fbea850271bbdc27026.gif"><br><br>  <i>Of the two types of navigation, we chose page by page because we did not intend and we are not going to add too much information to the application.</i>  <i>The most difficult was thinking through the interaction of the user with zero screens, screens for emergency situations.</i>  <i>For example, if a person on the phone does not have autologin activated, the watch asks him to log in to the phone;</i>  <i>it happens that there is no connection to the network;</i>  <i>and sometimes the data is simply loaded for a long time.</i>  <i>It was necessary to somehow make it clear to the user that the application is ‚Äúthinking‚Äù, and not stuck.</i>  <i>To do this, we used the animation - the light flashes, then the data is loaded, everything is in order, nothing is stuck.</i> <i><br><br></i>  <i>We used custom colors and fonts of the customer, and made graphics, focusing on the guideline, which at one time prepared for the ecosystem of applications Beeline.</i>  <i>It took less than a week to create the initial design, after which only minor changes were made. ‚Äù</i> </blockquote><br>  However, without the difficulties still not done.  In the <a href="http://habrahabr.ru/company/redmadrobot/blog/256501/">previous</a> article about the development for Apple Watch, we already talked in detail about various system limitations.  Features of working with groups instead of layers;  tricks that had to come up on the go to realize a dynamic increase in the number of pages when using PageControl;  Difficulties with the creation of animation.  But this was not the end. <br><br><h4>  <b>Simulator and testing on the clock</b> </h4><br><img src="https://habrastorage.org/files/dad/9b8/293/dad9b8293dfb46f29ddd73c6f8e246b9.png"><br>  In the absence of test devices, we used a simulator.  But, first, on the simulator it was possible to test far from all the scenarios, and secondly, at times it was clearly buggy.  For example, the feature did not work well with pictures of different sizes for different watch modifications.  And the handoff mode is in principle impossible to properly work out on the simulator.  While the Apple Watch is designed to be used on the go, the simulator does not allow you to feel this at all, but on the contrary, it seems that you look at the watch all the time.  There is a false feeling that the watch is another screen of the phone. <br><br>  Ilya Gorshkov, QA Team Leader <br><blockquote>  <i>‚ÄúIn the absence of real test devices, the test setup required help from developers: they gave us access to the source code of the project and installed the Xcode development environment.</i>  <i>It was impossible to check all the scenarios on the simulator, but we covered the main ones.</i>  <i>It became clear that the application is operational.</i>  <i>The application was tested for different types of Beeline customer accounts: prepaid, postpaid, business.</i>  <i>It was important that the functionality for a specific account in the main application exactly matched the one on the clock. ‚Äù</i> </blockquote><br><h4>  <b>Data update</b> </h4><br>  Two years ago, iOS introduced the ability to update data in an application when it is not running.  We used it in the system widgets alienated from the main application ‚ÄúMy Beeline‚Äù.  Then it was enough to make the application get specific data and tokens from the secure storage only at the moment when the user unlocked the phone.  The watches should receive updated data even when the phone is in your pocket.  During testing on this watch, it became clear that the data on them when the phone is locked is not updated.  Obvious solutions to the problem did not work, but we got out. <br><br><img src="https://habrastorage.org/files/075/1be/8bf/0751be8bfbd54aba84116fd3bb45d741.png"><img src="https://habrastorage.org/files/d85/aa7/f7e/d85aa7f7e54d4b4aacecf520ec573315.png"><img src="https://habrastorage.org/files/a47/48a/866/a4748a866a65465895fd35cfb2481e8c.png"><br><br>  Grigory Matvievich ( <a href="https://habrahabr.ru/users/fountainhead/" class="user_link">fountainhead</a> ), iOS developer <br><blockquote>  <i>‚ÄúTo get the balance, we have a specially generated token that is stored in the most secure area of ‚Äã‚Äãthe iOS operating system, in keychain.</i>  <i>When the watch requests data, the application is closed and the phone itself is locked.</i>  <i>The clock starts the basic iOS application in the background to request a balance.</i>  <i>The clock communicates with the main application on the phone, it starts in the background, climbs into the keychain, takes this token and asks for a balance on this token.</i> <i><br><br></i>  <i>All information stored in keychain has special storage attributes.</i>  <i>Some attributes suggest that when the phone is locked, information is not available.</i>  <i>To access this keychain, we use one library that simplifies this access.</i>  <i>We started to change storage attributes to lower ones, so that the information was available not only on the locked phone.</i>  <i>But it did not help.</i> <i><br><br></i>  <i>It was necessary to check with which attributes the token is stored in keychain, and when it is actually available.</i>  <i>A jailbroken phone was taken, a special program was found on the Internet that dumped keychain, and a special utility was used to access the file system.</i>  <i>Thus, we found out with which attributes this token was saved, changed attributes, and checked if the changes were applied.</i>  <i>As it turned out, the problem was with the library, which wraps access.</i>  <i>It turned out that the token was forcibly set to the storage attribute ‚Äúonly on unlocked device‚Äù, and this affects all users whose phones are protected by a Touch ID or password.</i>  <i>When changing the storage attribute to ‚Äúavailable after first unlocking‚Äù and repairing the external library, the problem was solved. ‚Äù</i> </blockquote><br><h4>  <b>Work with data and integration with the main application</b> </h4><br>  We didn‚Äôt have the possibility of modifying the server on the client side, so it was impossible to get away from dependence on the Beeline server and Internet speed.  The process of connecting the data is not so difficult, but long, and, of course, it is further complicated by debugging on the simulator.  This was due to the fact that the main application on the iPhone and WatchKit Extension are two different independent processes with their own sandbox. <br><img src="https://habrastorage.org/files/b16/b02/072/b16b02072beb4b5dbf062b018a90a312.jpg"><br>  Mikhail Moskovchenko, iOS-teamlead <br><blockquote> <i>‚ÄúIntegration implied interaction with the standard flow, which goes in the main application: authorization, obtaining financial information required proper implementation for the watch.</i>  <i>The main difficulty was to ‚Äúteach‚Äù the watch to communicate with the main application even when it was not running.</i>  <i>In the main application, everything happens in the forgrand - what is started, can be seen on the screen, all processes occur at the moment when the user interacts with them.</i>  <i>And everything was set up so that the screens of each other were alternately changed.</i> <i><br><br></i>  <i>For the clock was allocated a separate process.</i>  <i>Initially, we used a script made specifically for ‚ÄúMy Beeline‚Äù, but it gave a side effect.</i>  <i>The application was running in the background, and when at that moment the person ran it on the phone, it was already active.</i>  <i>In this case, for example, an incorrect screen could be displayed.</i>  <i>The main screen did not appear because the authorization process was not completed.</i>  <i>To avoid this, we decided to separate the launch of the application and the update on the clock and made a separate set of methods for authorization.</i>  <i>Checking the offer, the subscriber type, whether the account is blocked, the receipt of the token itself.</i>  <i>That is, we have isolated separately everything that is included in the authorization. ‚Äù</i> </blockquote><br><h4>  <b>Layout on the page and review</b> </h4><br>  When we sent the app to the store, Apple has not yet documented a lot of nuances regarding the display of the app under the clock.  However, a new version of the Xcode development environment was released, which required verification of all certificates, including for the watch. <br><br>  Mikhail Moskovchenko, iOS-teamlead <br><blockquote>  <i>‚ÄúSince the clock is an extension of the main application, one certificate was created for them, which was supposed to work quite normally, as with any widget.</i>  <i>But it turned out that this is absolutely not the case, and iTunes Connect when trying to upload an application there produced incomprehensible random errors.</i>  <i>I had to generate additional certificates on developer.apple.com, to get additional permissions from Apple - an additional certificate directly for the watch.</i>  <i>Only after that the application was taken to the review.</i>  <i>Naturally, all these nuances were not described anywhere.</i>  <i>Now all widgets, Watchkit Extension and the main application should have the same version.</i>  <i>This is also a key point, without which updates are not accepted for review.</i>  <i>You cannot use the clock image, the word Apple, or the phrase Apple Watch.</i>  <i>The first time we got a reject, because in the preview of the pictures that appeared at launch, there was a clock image. ‚Äù</i> </blockquote><br><br><img src="https://habrastorage.org/files/45c/63e/b61/45c63eb61f124e6c929d6e864ae48e20.gif"><img src="https://habrastorage.org/files/f05/cee/07e/f05cee07e67d4a01856386b239a81519.gif"><img src="https://habrastorage.org/files/f18/6b0/48a/f186b048a5c64e929dbfad3cc7192275.png"><br><br><h4>  <b>Total</b> </h4><br>  Many difficulties, of course, could have been avoided if we had not been in a hurry with laying out the application in the store and had waited for the massive sale of watches.  But we were in a hurry :) And they released the first Russian telecom application under the Apple Watch. <br><br>  In the first version of the smart watch, Apple allowed third-party developers to create appy, which are an extension of the main iOS-application.  Development exclusively under the Apple Watch promise to do in the future. <br><br>  Then new original scenarios of interaction with the clock may appear, but for now it remains for us to develop applications within the limited capabilities that developers have - and users.  The nearest plan is the possibility of paying for mobile Internet right from the clock in the next update. </div><p>Source: <a href="https://habr.com/ru/post/258849/">https://habr.com/ru/post/258849/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../258831/index.html">HP Helion Rack - a solution for the rapid deployment of a private cloud based on OpenStack</a></li>
<li><a href="../258833/index.html">Displaying the content of iOS applications in Google Search results and other good news</a></li>
<li><a href="../258841/index.html">Criteria for the quality of video analytics. Part 4</a></li>
<li><a href="../258845/index.html">SAN soup. We build virtual SAN on the Windows Server 2012 R2 platform</a></li>
<li><a href="../258847/index.html">Brief Making of Pinup Character</a></li>
<li><a href="../258851/index.html">Writing an image file plugin for OpenSceneGraph</a></li>
<li><a href="../258853/index.html">Fake Minecraft apps on Google Play downloaded hundreds of thousands of times</a></li>
<li><a href="../258859/index.html">How to develop a multiplayer 3D game without artists, designers and modelers in six months</a></li>
<li><a href="../258861/index.html">Introducing XACML - the standard for Attribute-Based Access Control</a></li>
<li><a href="../258863/index.html">Video from the user: ReactOS is installed and works on a "modern" computer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>