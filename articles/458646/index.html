<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Atomic Swaps In A Nutshell</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As of July 2019, there are about 2000 cryptocurrencies, but there is no single exchange mechanism between different blockchains. In this article, we w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Atomic Swaps In A Nutshell</h1><div class="post__text post__text-html js-mediator-article"><p>  As of July 2019, there are about 2000 cryptocurrencies, but there is no single exchange mechanism between different blockchains.  In this article, we will simplifyly consider how one of the exchange technologies without intermediaries is arranged - atomic exchanges (atomic swaps). <br>  Enjoy reading! </p><br><p><img src="https://habrastorage.org/webt/jc/ba/qj/jcbaqjix_if2eyc1wfdplh9y24y.png" alt="logo"></p><a name="habracut"></a><br><h1 id="atomic-swaps-chto-eto-takoe-i-s-chem-ego-edyat">  Atomic Swaps: what is it and what is it eaten with? </h1><br><p>  Atomic swaps are a series of transactions on both blockchains that allow you to exchange coins without the participation of a third party and trust in the second participant in the exchange.  In essence, a transaction is created, the output of which can be spent either with a certain key or after a time out. <br>  Not all blockchains allow you to implement AtomicSwap.  There are two main requirements: </p><br><ul><li>  support of smart contracts (the generator of this very "initial" transaction); </li><li>  using the same cryptomagy (hash function). </li></ul><br><div class="spoiler">  <b class="spoiler_title">Smart contracts?</b>  <b class="spoiler_title">No, not heard</b> <div class="spoiler_text"><p>  Smart contracts - in a broad sense, a "non-oblique" algorithm that performs actions under certain conditions and not otherwise known.  In our case, a smart contract can be considered as a large black box, which is fed the recipient's address, the sender's address, the amount sent, the money hold time and assign a unique identifier (hash).  The output is the desired conditional transaction. </p></div></div><br><div class="spoiler">  <b class="spoiler_title">Hash and his friends</b> <div class="spoiler_text"><p>  The hash function is another character from a tale of higher mathematics.  Converts a stream of input data to another value.  The same data give the same result.  Typically, the input is a large number, referred to as a secret key, and the output is a hash.  Converting a hash back to a secret key is impossible. </p></div></div><br><h1 id="kogda-vse-idet-gladko">  When everything goes smoothly </h1><br><p>  Consider the exchange between Alice (yes, yes, Alice is no longer the same) and Bob.  Alice has Bitcoin (btc), Bob has Ether (eth).  Both characters have addresses on both blockchains.  Prm .: large signs cryptocurrency symbolize blockchains. </p><br><p><img src="https://habrastorage.org/webt/he/-w/pn/he-wpn_bs0onorq7h0fk9lesjoi.png"></p><br><p>  Alice generates a key (a large number) and modestly tells her no one: </p><br><p><img src="https://habrastorage.org/webt/yg/yp/ki/ygypki8kwue-kfpciozfa1amdao.png"></p><br><p>  Based on the key, it considers the hash: </p><br><p><img src="https://habrastorage.org/webt/6p/fy/05/6pfy05jkf_gsnkdpnmsobirlksw.png"></p><br><p>  Creates a contract with a unique identifier equal to the hash: </p><br><p><img src="https://habrastorage.org/webt/o0/tb/o7/o0tbo7awy1tggp2hw6_2o4r1bwy.png"></p><br><p>  Sends money to a contract.  Now she can not spend them a certain time (timelock): </p><br><div class="spoiler">  <b class="spoiler_title">Time is up, or timelock</b> <div class="spoiler_text"><p>  Timelock - the time after which the contract creator will be able to return the money if he sends a transaction of a certain type (let's call it "refund").  This transaction does not need a secret key.  Another user can withdraw money to the recipient specified in the contract (important: not to his own) if he sends a transaction of another type (let's call it redeem) with the secret key. </p><br><p>  In general, the transaction processing mechanism for a contract is as follows: </p><br><pre><code class="plaintext hljs">if (transaction_type == "refund" and sender == contract_creater and timelock &lt; now()) { send_to(creator_address); } else if (transaction_type == "redeem" and hash(secret_key) == contract_id) { send_to(receiver_address); }</code> </pre> </div></div><br><p><img src="https://habrastorage.org/webt/qn/a7/gv/qna7gvo-5i4xwnhcfxwtoe8fay4.png"></p><br><p>  Alice tells the hash to Bob.  Now he can audit (check) all fields of the contract: make sure the addresses are correct, the amount sent, the time the money is stored on the contract (the period during which Alice will not be able to remove them): </p><br><p><img src="https://habrastorage.org/webt/dz/9g/03/dz9g03vs129wy9zt4lz1kwbwjo0.png"></p><br><p>  If everything is good, Bob creates a contract on the second blockchain similar to Aliceen (with the same identifier).  The recipient changes and the amount is possible (if the rate is not 1 to 1). </p><br><p><img src="https://habrastorage.org/webt/y9/he/o3/y9heo3nanmlllp1p1c9wgfoh61m.png"></p><br><p>  Alice is auditing the contract: </p><br><p><img src="https://habrastorage.org/webt/u2/ab/px/u2abpxzaey8qdfotjdrcswduroq.png"></p><br><p>  If it triples, it creates a transaction on Ethereum that spends money on Bob's contract.  The only way to do this is to provide the key.  Now he is known: </p><br><p><img src="https://habrastorage.org/webt/bq/0q/57/bq0q57qn1v7p_hg1zfzus21qiy0.png"></p><br><p>  Alice gets eth: </p><br><p><img src="https://habrastorage.org/webt/69/s8/wu/69s8wut5tgijnspuyr7c4conq9u.png"></p><br><p>  Bob looks at the key and creates a transaction that spends money on Alice‚Äôs contract, using her key: </p><br><p><img src="https://habrastorage.org/webt/yz/pk/j9/yzpkj9qdzxpfshxb6nt6j-40-y4.png"></p><br><p>  Success!  The wolves are fed, the sheep are safe! </p><br><h1 id="kogda-mir-ne-idealen">  When the world is not perfect </h1><br><p>  However, sometimes something can go wrong.  There are two places where the exchange can break.  For this there is a mechanism that allows you to return the money to their rightful owners. </p><br><p>  Suppose Alice as a decent girl sent the money to the contract, but after the audit, Bob changed his mind to part with the ethers: </p><br><p><img src="https://habrastorage.org/webt/dz/9g/03/dz9g03vs129wy9zt4lz1kwbwjo0.png"></p><br><p>  Alice waits for the timelock specified in the contract to expire (say, 48 hours) and returns the bloodlock: </p><br><p><img src="https://habrastorage.org/webt/69/vc/dw/69vcdwy1-vgf2fvclawn6gbbfg8.png"></p><br><p>  Another story tells about the fickle Alice, who did not want to continue the atomic exchange after Bob made a contract.  Alternative scenario: Alice lost the key and cannot do it: </p><br><p><img src="https://habrastorage.org/webt/u2/ab/px/u2abpxzaey8qdfotjdrcswduroq.png"></p><br><p>  Bob waits for the time of blocking money (it is usually less than Alicin‚Äôs, so that Alice does not withdraw Bob‚Äôs money at the last minute, and then does not return her money; let's say 24 hours).  Alice returns her money at the expiration of her timelock. </p><br><p><img src="https://habrastorage.org/webt/wl/ij/p-/wlijp-qfuo2p7dlqdxycxnhchg0.png"></p><br><h1 id="zaklyuchenie">  Conclusion </h1><br><p>  Atomic exchanges are very convenient for exchanging point-to-point, bypassing the exchanges and intermediaries.  Participants undertake to pay only the transaction fee. </p><br><p>  Summing up, in the exchange between A and C on the blockchains B1 and B2, we can distinguish the following steps: </p><br><ol><li>  initialization of the contract for B1 by party A; </li><li>  listening to a contract on B1 with participant C; </li><li>  initialization of the contract for B2 by party C; </li><li>  listening to a contract for B2 by participant A; </li><li>  provision of a key and withdrawal of money for B2 by participant A; </li><li>  obtaining a key on B2 by party C; </li><li>  withdrawal of money for B1 by S. </li></ol><br><p>  The technology is new, but it is already being actively implemented.  Perhaps in the near future she will be able to replace centralized and so ideologically strangers for the blockchain exchange. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/458646/">https://habr.com/ru/post/458646/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../458636/index.html">Video recordings from the DevLeads mitap from Tutu.ru office</a></li>
<li><a href="../458638/index.html">Intel oneAPI Project: many architectures, one API</a></li>
<li><a href="../45864/index.html">Do I need articles / translations on Windows Workflow Foundation?</a></li>
<li><a href="../458640/index.html">Looking for a long dash</a></li>
<li><a href="../458642/index.html">Theory instead of heuristics: getting better as frontend developers</a></li>
<li><a href="../458648/index.html">CI / CD using AWS and Bamboo</a></li>
<li><a href="../45865/index.html">We recognize the operator and the region of the mobile phone</a></li>
<li><a href="../458650/index.html">Cybercall. New level. Online competition from Rostelecom-Solar</a></li>
<li><a href="../458652/index.html">RamblerFront & Meetup # 7</a></li>
<li><a href="../458654/index.html">The Lurk virus hacked into banks while it was being written by ordinary remote workers for hire</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>