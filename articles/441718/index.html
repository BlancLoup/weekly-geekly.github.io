<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Security Week 09: 19-year vulnerability in WinRAR</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We announce a week of prehistoric bugs. The vulnerability in the WinRAR archiver, detected and closed at the end of January, was described in detail b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Security Week 09: 19-year vulnerability in WinRAR</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/7b/wu/t9/7bwut9_r22f5g-aq_47-q6g2cpy.png" align="right">  We announce a week of prehistoric bugs.  The vulnerability in the WinRAR archiver, detected and closed at the end of January, was described in detail by Check Point Software specialists ( <a href="https://threatpost.ru/winrar-vulnerable-to-19-years-old-bug/31259/">news</a> , original <a href="https://research.checkpoint.com/extracting-code-execution-from-winrar/">research</a> ).  In the worst case, a breach allows you to unpack a malicious file in an arbitrary place on your hard drive, for example, in the Windows autorun directory. <br><br>  This vulnerability makes you think about the use of hard-to-check third-party libraries in your software, but not only.  Today we will briefly talk about the problem itself, about the decision of WinRAR developers to abandon the library for unpacking archives in the ACE format, and also raise the topic of updating WinRAR on users' computers.  Looking ahead: although the news and caused a serious resonance, it is rather a story with a happy ending.  But on the class of vulnerabilities associated with the processing of any archives arriving on your computer, you should pay special attention. <br><a name="habracut"></a><br>  In the original report, many (interesting) details are given before the demonstration of the problem, but let's immediately look at the result. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/R2qcBWJzHMo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The prepared archive is saved on the desktop, the user tries to unpack it there, but instead the executable file is written to the autorun directory.  How did that happen?  The researchers used fuzzing technology, namely the <a href="https://github.com/googleprojectzero/winafl">WinAFL</a> package, supported by the Google Project Zero team and the Windows version of the <a href="http://lcamtuf.coredump.cx/afl/">american fuzzy loop</a> program.  Like other similar tools, WinAFL allows you to explore the security (or stability) of the software, passing random (or not quite) data to the application and saving the reaction.  Fuzzers can be considered a sort of ‚Äúmagic wand‚Äù by a security researcher.  They help detect a variety of program crashes in places where they should not be. <br><br>  However, the Check Point report shows that not everything is so simple.  The WinRAR study using WinAFL helped to identify several unexpected application crashes and brought researchers to a library that processes archives in the ACE format ‚Äî a proprietary archival standard.  This library (unacev2.dll) was last updated in 2006 and did not have standard protection mechanisms (such as ASLR or DEP).  However, she was present in all versions of WinRAR over the past 19 years and, as it turned out later, all this time has been vulnerable.  At the time of the discovery of the bug, the WinRAR developers did not have access to its source code.  ACE was a commercial archiver in its time, the unpacking library was free, but it was legal to create archives in this format only with the help of WinACE utility utility (updated until 2007, <a href="http://www.winace.com/">the program website</a> existed until 2017; now it is clearly abandoned software ). <br><br>  It did not work out to find a simple Path Traversal vulnerability, when the archiver unpacks the file into an arbitrary directory, but this time after studying the features of the format using both the original WinACE program and the freely distributed unpacking <a href="https://pypi.org/project/acefile/">code</a> Python.  In the next campaign after random glitches, the researchers found a file that was not saved at all to the place where WinAFL should have saved the result of the library launch. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ns/lb/ru/nslbru7z9sfx4ptvh0pifohy0zc.png"></div><br><br>  The fact is that the ACE archiver allows you to save the full path to the zipped file.  In a normal situation, this path is added to the unpacked path selected by unzipping.  During fuzzing, it turned out that some data set made it possible to make the path absolute, that is, to unpack the file, not where the user pointed, but anywhere, but this is not very good.  Further it seems to be easy - you need to apply the same trick when working not with the library directly, but with WinRAR itself, right?  Not really: the vulnerability was not reproduced.  I will not retell the entire history of finding the right combination of parameters and bypassing another validation stage in WinRAR itself: the program checks and removes crime from the save path in order to avoid just such situations.  But checks, as it turned out, not all possible options. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cx/bj/fo/cxbjfoyha7a0ehhxvlmctekcopc.png"></div><br><br>  It turned out that's what.  This is a screenshot of the ‚Äúprepared‚Äù archive analysis using the Python code mentioned above.  The double c: \\ at the beginning of the path is processed by the unacev2 library and by WinRAR itself so that the file is written to an arbitrary directory.  It seems to be ready to exploit?  Again, no, more precisely not quite.  Attempting to write an executable file to the startup directory in this configuration will trigger the Windows protection.  But the researchers managed to find a way to work around this limitation if the file is saved in the user's directory, for example, in the Downloads folder or on the desktop (which is quite likely).  As shown in the video at the beginning, it was possible to save the prepared file to the user's autorun directory by moving to one folder above in the file path. <br><br>  What is the result?  In the version of WinRAR 5.70 Beta 1, the vulnerability was fixed, completely abandoning the use of an outdated library for working with ACE files.  It is unlikely that someone will be seriously upset about this.  By the way, the advice given in the <a href="https://www.zdnet.com/article/winrar-versions-released-in-the-last-19-years-impacted-by-severe-security-flaw/">article</a> on ZDNet, ‚Äúnot to open suspicious archives in ACE format‚Äù is a bit wrong.  WinRAR does not identify files by permission, and the exploit will work with a vulnerable version of the program, even if the prepared ACE archive has the .rar extension (or any other).  Do not open suspicious archives - this is good, but generally it needs to be updated. <br><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: absolute; visibility: hidden; display: block; transform: rotate(0deg); max-width: 100%; width: 500px; min-width: 220px; margin-top: 10px; margin-bottom: 10px;" data-tweet-id="1052984615139340288"></twitter-widget><blockquote class="twitter-tweet" data-lang="en_US" data-twitter-extracted-i1551234370717872856="true"><p lang="en" dir="ltr">  We‚Äôve still been searching for (rus, WinRip, 7-Zip, WinZip (on Windows) or tar (on Linux)).  For more information: <a href="https://t.co/fKnggJyb0H">https://t.co/fKnggJyb0H</a> <a href="https://twitter.com/hashtag/BigBounties%3Fsrc%3Dhash%26ref_src%3Dtwsrc%255Etfw">#BigBounties</a> </p>  - Zerodium (@Zerodium) <a href="https://twitter.com/Zerodium/status/1052984615139340288%3Fref_src%3Dtwsrc%255Etfw">October 18, 2018</a> </blockquote><script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script></div><br><br>  And now, for a moment, take a break from the post and see which version of WinRAR you have installed (if, of course, you use this archiver).  For orientation: version 5.50 was released in 2017, 5.00 - in 2012, 3.90 - in 2009.  With some probability, the release date of WinRAR will roughly correspond to the date of the initial system setup, as there is still no automatic update feature in this program.  As can be seen from the tweet of the Zerodium vulnerability broker, there is a demand for working exploits in archivers.  Vulnerabilities similar to those found in the ACE archives library can be used for mass or targeted attacks on victims' computers.  It should be noted that the chances of successful operation of such a bug are far from one hundred percent.  With a high probability, the infected archive will be blocked by the postal service (true, for example, for GMail, now there are no passwords and archives with executable files inside it) or anti-virus software.  Unless, of course, you have it. <br><br>  Nevertheless, all these annoying reminders of the need to update one of the dozens of programs installed on your computer make sense.  Otherwise, it is easy to miss a serious vulnerability that will work at the most inopportune moment.  In fairness, we note that serious problems in WinRAR <a href="https://www.cvedetails.com/vulnerability-list/vendor_id-1914/product_id-3768/Rarlab-Winrar.html">appear</a> infrequently. <br><br>  <i>Disclaimer: The opinions expressed in this digest may not always coincide with the official position of Kaspersky Lab.</i>  <i>Dear editors generally recommend to treat any opinions with healthy skepticism.</i> </div><p>Source: <a href="https://habr.com/ru/post/441718/">https://habr.com/ru/post/441718/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../441708/index.html">WG Contract API: zoo of services</a></li>
<li><a href="../441710/index.html">Browser mobile games challenge you</a></li>
<li><a href="../441712/index.html">Mathematical solution of the problems of relativity</a></li>
<li><a href="../441714/index.html">How the locomotives were arranged</a></li>
<li><a href="../441716/index.html">Programming for non-programmers. Biography of June</a></li>
<li><a href="../441720/index.html">Chat bot for Vkontakte on ASP.NET Core C #</a></li>
<li><a href="../441722/index.html">Automating the transition to React Hooks</a></li>
<li><a href="../441728/index.html">Summing up the online contest on the game Blotto</a></li>
<li><a href="../441730/index.html">Entanglion - Haskell among the desktops</a></li>
<li><a href="../441732/index.html">Notes Biorobot</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>