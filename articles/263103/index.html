<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unobvious performance problems in Doctrine related to the hydration of objects</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I implemented the API functions in a Symfony2 back-end project that uses Doctrine as the ORM. 

 And, as it sometimes happens, the speed of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unobvious performance problems in Doctrine related to the hydration of objects</h1><div class="post__text post__text-html js-mediator-article">  Recently, I implemented the API functions in a Symfony2 back-end project that uses Doctrine as the ORM. <br><br>  And, as it sometimes happens, the speed of working out did not quite suit me.  For a simple request, the response was generated in 7.2 seconds. <br><br><img src="https://habrastorage.org/files/5bf/1d7/77c/5bf1d777c62c46b2abec63c2fcab7ca2.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The first assumption is that some heavy queries are running somewhere.  But through the profiler you can not see anything that could <br>  to suggest where the problem was hidden.  There are a lot of SQL queries, but all are fast, and their total execution time is only 223 milliseconds. <br><br><a name="habracut"></a><br><br><img src="https://habrastorage.org/files/283/705/ec5/283705ec558440e19e4b9cee2e495e68.png"><br><br>  I go to the Timeline tab - it is clear that the problem occurs during the operation of the controller (there are literally 5 lines), but where exactly - it has not become clearer. <br><br><img src="https://habrastorage.org/files/e6d/4c1/e23/e6d4c1e23ee0402581176634a7196dae.png"><br><br>  <b>What turned out in the end.</b> <br><br>  It turned out that for generating data, some models (in the depth of long-written services) required connected one-to-many objects.  The object was needed alone, but to access it, the entire ArrayCollection was raised from hundreds of objects. <br><br>  Those.  some of those quick queries returned hundreds of rows, on the basis of which Doctrine picked up hundreds of objects, and a lot of resources were needed for this. <br><br>  This problem was solved simply.  Having a little corrected the logic of the models, I had already prepared them at the time of accessing the related objects.  Work time has become acceptable.  But the problem, while it seems to me, can be quite typical and often arise in projects related to Doctrine.  We need one bound object, all are initialized (not too noticeable to the developer). <br><br>  It would be nice to control it somehow. <br><br>  Therefore, I made a bundle that collects data on the time of hydration of objects inside Doctrine. <br><br>  I think it may be useful for any project using the Symfony2 + Doctrine2 bundle. <br>  <a href="https://github.com/debesha/DoctrineProfileExtraBundle/">debesha / DoctrineProfileExtraBundle</a> (githab) <br><br>  After installing the bundle, an additional badge appears in the profiler panel, in which you can see how much hydration was performed and how much time was spent on it: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/912/660/2f8/9126602f87c72e3a93a2594d6c004a38.png"><br><br>  Accordingly, in the example I gave at the beginning, the profiler looks more eloquent already - 5.5 seconds was spent on the hydration of objects. <br><br><img src="https://habrastorage.org/files/4ea/602/538/4ea6025384414b4ab51aee8a817f85c7.png"><br><br>  And the same thing, but after optimization (which, as I said, was very simple. The most difficult thing was to locate the problem). <br>  Hydration took 0.4 seconds (on my slow working computer). <br><br><img src="https://habrastorage.org/files/e61/aea/f46/e61aeaf46baa48b2a3a7efb84bcc5724.png"><br><br>  I hope with my bandle I will save a lot of time for my colleagues. </div><p>Source: <a href="https://habr.com/ru/post/263103/">https://habr.com/ru/post/263103/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263091/index.html">Pacemaker-based HA-Cluster for LXC and Docker container virtualization</a></li>
<li><a href="../263093/index.html">Crackme Chiwaka1 study</a></li>
<li><a href="../263097/index.html">Event-oriented Python backtesting step by step. Part 1</a></li>
<li><a href="../263099/index.html">Skype turned to people?</a></li>
<li><a href="../263101/index.html">Work with passwords: how to protect your accounts (expert opinion)</a></li>
<li><a href="../263105/index.html">Getting rid of the ‚Äúhistorical reasons‚Äù in cmd.exe in an easier and standard way.</a></li>
<li><a href="../263109/index.html">User data leakage in QIWI</a></li>
<li><a href="../263111/index.html">Chronos library: make writing long operations easier</a></li>
<li><a href="../263113/index.html">Trouble came from not waiting, XSS vulnerability in Yandex.Metrica</a></li>
<li><a href="../263115/index.html">Clojure Web Applications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>