<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Mikrotik 6to4 automation with dynamic IPv4</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article will be useful to those who want to experience IPv6 using 6to4 encapsulation protocol, but with dynamic IPv4. 

 Mikrotik IPv6 
 First of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Mikrotik 6to4 automation with dynamic IPv4</h1><div class="post__text post__text-html js-mediator-article">  This article will be useful to those who want to experience IPv6 using 6to4 encapsulation protocol, but with dynamic IPv4. <br><a name="habracut"></a><br><h2>  Mikrotik IPv6 </h2><br>  First of all, let's check if you have the opportunity to use the public 6to4 gateway, ping it to the address: 192.88.99.1.  If ping goes, read on. <br><br>  So, first of all, you need to install an IPv6 support module (download Extra packages for your device from the <a href="http://www.mikrotik.com/download">site</a> ).  From the archive we take out ipv6 - *. Npk and upload it to the router, then restart it. <br><br>  Now you have IPv6 support, please note that the firewall rules for it need to be done separately. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  6to4 setup </h3><br>  Next, we create a special interface ‚Äú6to4 Tunnel‚Äù, in the Remote Adress we put the address of the public gateway, in Local Adress our current public IPv4 address (or ‚Äúwrong‚Äù in the address, so that the script would configure everything itself). <br><br>  In routing, you need to configure the tunnel interface as the default gateway (before the address :: / 0). <br>  Now we can check if there is a ping to anything from IPv6 (for example ipv6.google.com) <br>  If there is a ping, then go further: <br><br><h3>  Autotune script </h3><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">##############Script Settings################## :local EXTif "ext" :local TUNif "6to4tun" :local LOCif "local" ############################################### :local EXTipv4 [/ip address get [find interface=$EXTif] address]; :local TUNipv4 [/interface 6to4 get [find name=$TUNif] local-address]; :for i from=( [:len $EXTipv4] - 1) to=0 do={ :if ( [:pick $EXTipv4 $i] = "/") do={ :set $EXTipv4 ([:pick $EXTipv4 0 $i]); } } :global dec2hex do={ :local hex "" :local dec [:tonum $1] :for i from=0 to=4 step=4 do={ :set hex ([:pick "0123456789ABCDEF" (($dec&gt;&gt;$i)&amp;0xf) ((($dec&gt;&gt;$i)&amp;0xf)+1)].$hex) } :return ([:tostr $hex]) } :local 6to4prefix do={ :global dec2hex :local oct :local ipv6 "2002:" :local tmp 0 :local c 0 :local ipv4 $1 :for i from=0 to=( [:len $ipv4] - 1) do={ :if ( [:pick $ipv4 $i] = "." || [:pick $ipv4 $i] = "/") do={ :set oct ([:pick $ipv4 $tmp $i]) :set tmp ($i+1) :set ipv6 ("$ipv6".[$dec2hex $oct]) :if ( c =1 || c =3) do={ :set ipv6 ("$ipv6".":") } :set c (c+1) } } :return ($ipv6) } :if ( $TUNipv4 != $EXTipv4 ) do={ /interface 6to4 set [find name=$TUNif] local-address=$EXTipv4 /ipv6 address remove [find interface=$TUNif] /ipv6 address remove [find interface=$LOCif] :local ipv6new [$6to4prefix ($EXTipv4."/")] :log info ($ipv6new) /ipv6 address add interface=$TUNif advertise=no address=("$ipv6new".":1/48") /ipv6 address add interface=$LOCif advertise=yes address=("$ipv6new".":1/64") }</span></span></code> </pre> <br>  In the script, you need to set variables that are responsible for the interfaces that we set up: <br><br><ul><li>  EXTif - external interface </li><li>  TUNif - Tunnel Interface </li><li>  LOCif - local interface </li></ul><br>  By running the script, we get the configured tunnel and the local interface with the / 64 prefix. <br><br>  Now we will add this script to the scheduler (I run every 5 minutes), and when changing the external IPv4, with a small delay, 6to4 will be reconfigured. <br><br><h3>  What difficulties await you? </h3><br>  Clients get IPv6 using SLAAC, and there is no way to set the DNS and gateway (Win clients get only the gateway through RA).  In Mikrotik, there is DHCPv6, but there is still little sense from it (it is not fully completed). <br><br>  In order to support DNS in Mikrotik itself, we set up well-known public servers (for example, 2620: 0: ccc :: 2 and 2620: 0: ccd :: 2), customers can set up a link local Mikrotik address. </div><p>Source: <a href="https://habr.com/ru/post/326076/">https://habr.com/ru/post/326076/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../326064/index.html">Courses Computer Science Club, spring 2017</a></li>
<li><a href="../326068/index.html">How to write TK on the system or revision of the 1C system</a></li>
<li><a href="../326070/index.html">Cat Discrimination: Web Tracking Through Invisible Pictures</a></li>
<li><a href="../326072/index.html">Integration of 3CX with Bitrix24 - free CRM plugin</a></li>
<li><a href="../326074/index.html">Async / await: 6 reasons to forget about promises</a></li>
<li><a href="../326078/index.html">MASM, TASM, FASM, NASM for Windows and Linux</a></li>
<li><a href="../326080/index.html">Future API</a></li>
<li><a href="../326082/index.html">Huawei HyperMetro - tested and implemented</a></li>
<li><a href="../326084/index.html">Audit of current vulnerabilities without registration and SMS</a></li>
<li><a href="../326086/index.html">Cisco CSR 1000v: Features Overview. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>