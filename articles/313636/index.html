<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Linux print server with AD integration</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, I wanted to settle on the experience of creating a linux-based print server with AD integration. Integration refers to entering a lin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Linux print server with AD integration</h1><div class="post__text post__text-html js-mediator-article">  In this article, I wanted to settle on the experience of creating a linux-based print server with AD integration.  Integration refers to entering a linux server into a Windows domain and sharing Cups printers via Samba, including printer drivers.  Perhaps it was clumsily expressed, but if it is simpler, then it looks like this - in order to install a printer to a Windows user, just click on ‚Äúinstall new printer‚Äù, list printers in AD and click on the desired printer - the printer will be installed automatically with all necessary drivers installed.  At the same time, all rights to manage, access, print will be pulled from AD. <br><br><h2>  Part 1. Subtleties settings </h2><br><h3>  Initial data </h3><br><ul><li>  Domain controller - Windows Server 2008 R2 (AD, DNS, DHCP) IP - 10.10.15.31 </li><li>  Domain Name - INITIAL </li><li>  Print server - linux OS (I use OpenSUSE 13.2 x64, kernel 3.16.7-42-default) IP - 10.10.15.11 </li><li>  kerberos 1.12.2-24.1 </li><li>  winbind 4.2.4-40.1 </li><li>  LDAP 2.4.39-8.9.1 </li><li>  Samba 4.2.4-40.1 </li><li>  CUPS 1.5.4-21.9.1 </li></ul><a name="habracut"></a><br>  Assume that the linux OS is already installed and all the necessary packages are installed. <br>  On entering linux into the Winodws domain I will not focus much attention, especially since there are plenty of articles on this topic.  Let me give you a link to a pretty good article - <a href="https://habrahabr.ru/post/143190/">https://habrahabr.ru/post/143190/</a> <br>  <u>I will dwell only on important points.</u>  Also, below I will lay out all my working configs of the above services.  Customized for various articles and manuals. <br><br><h3>  Time synchronization </h3><br>  Time on the linux server must be identical with the domain controller, otherwise it will not drive into the domain. <br>  There are several options for this: specify the same ntp time synchronization server on the domain controller and our print server, or specify the controller's IP domain as the ntp server on the print server.  I configured the second option. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="bash hljs">/etc/ntp.conf server 10.10.15.31 iburst</code> </pre> <br>  You can check the synchronization as follows: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span>-01:~ <span class="hljs-comment"><span class="hljs-comment"># ntpq -p remote refid st t when poll reach delay offset jitter ============================================================================== *10.10.15.31 85.236.191.80 3 u 888 1024 377 0.698 6.690 7.232</span></span></code> </pre><br><h3>  Winbind </h3><br><pre> <code class="bash hljs">/etc/nsswitch.conf passwd: files winbind group: files winbind shadow: files winbind hosts: files [dns] wins</code> </pre><br>  Many people say that these settings are not needed at all for samba, like kerberos and LDAP, but I love everything with Feng Shui))).  Earlier, I configured samba as a PDC (Primary Domain Controller) without kerberos and LDAP and it all worked with WinXP clients, I confirm. <br><br><pre> <code class="bash hljs">/etc/samba/smb.conf winbind separator = / winbind enum users = Yes winbind enum groups = Yes winbind use default domain = Yes winbind nss info = rfc2307 winbind refresh tickets = Yes</code> </pre><br><h3>  Samba </h3><br><pre> <code class="bash hljs">/etc/samba/smb.conf idmap uid = 500-10000000 idmap gid = 500-10000000 idmap backend = ldap:ldap://10.10.15.31</code> </pre><br>  These settings are not recommended by samba itself, starting with some versions 3.X, but in many articles they are indicated.  If you specify these parameters in new versions of samba, then testparm will display: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span>-01:/etc/samba <span class="hljs-comment"><span class="hljs-comment"># testparm -v Load smb config files from /etc/samba/smb.conf WARNING: The "idmap backend" option is deprecated WARNING: The "idmap gid" option is deprecated WARNING: The "idmap uid" option is deprecated</span></span></code> </pre><br>  realm parameter - domain name should be indicated in capital letters! <br><br><pre> <code class="bash hljs">realm = DOMAIN.COM</code> </pre><br><h3>  Kerberos </h3><br>  The realms section - the domain name must be in capital letters! <br><br><pre> <code class="bash hljs">/etc/krb5.conf [realms] DOMAIN.COM = {...</code> </pre><br>  Otherwise, you can get this error when checking kerberos <br><br><pre> <code class="bash hljs">kinit username@DOMAIN.COM kinit(v5): KDC reply did not match expectations <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> getting initial credentials</code> </pre><br>  Suppose you set up the necessary services and successfully entered the linux machine into the Windows domain.  Let's go to the CUPS settings. <br><br><h3>  Cups </h3><br><pre> <code class="bash hljs">/etc/cups/cupsd.conf <span class="hljs-comment"><span class="hljs-comment">#       LogLevel debug #   (,  ,      root) SystemGroup root #     631 / Listen for connections on Port 631. Port 631 Listen /run/cups/cups.sock BrowseLocalProtocols CUPS BrowseRemoteProtocols CUPS #      / Show shared printers on the local network. Browsing On BrowseOrder allow,deny BrowseAllow all BrowseAddress 10.10.15.0/24 BrowseAddress 172.19.2.0/24 BrowseAddress 172.19.3.0/24 BrowseAddress 172.19.4.0/24 # Default authentication type, when authentication is required... DefaultAuthType Basic WebInterface Yes</span></span></code> </pre><br>  Here I will explain. <br><blockquote>  BrowseOrder allow, deny - the order in which the system considers allowing and prohibiting directives: all that is not allowed is prohibited. <br>  BrowseAllow all - displays all available printers on the local network <br>  BrowseAddress - we specify all subnets from which access to printers is needed <br>  DefaultAuthType - authentication type.  The default is Basic. </blockquote><br>  On account of the latter.  I noticed the following in the logs: <br><br><pre> <code class="bash hljs">/var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/cups/error_log cupsdAuthorize: No authentication data provided.</code> </pre><br>  I found two recommendations on this topic: <br><br>  - disable sharing of printers in samba completely (very useful, especially for the print server) <br>  - replace Basic with None wherever there is this option in cupsd.conf (did not feel the difference) <br><br>  On cups.org I read that the values ‚Äã‚Äãof this option can be 2 - Basic and Negotiate, the last one for authentication using kerberos. <br><br>  In any case, this error does not affect the work of cups. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#          . &lt;Location /&gt; # Allow remote access... Order allow,deny Allow all &lt;/Location&gt;</span></span></code> </pre><br>  I specified access for all local subnets.  In principle, in the Allow directive you can specify different subnets, just as I did in BrowseAddress. <br><br>  Next, set up access to the administrative panel and configuration files.  Here you can also register the Allow directive (in each section) with the indication of subnets or a separate IP address from which / which printers can be administered.  If you do not add this directive - adminit will be possible from any subnet locale - equivalently Allow all. <br><br><pre> <code class="bash hljs">&lt;Location /admin&gt; Order allow,deny &lt;/Location&gt; &lt;Location /admin/conf&gt; AuthType Default Require user @SYSTEM &lt;/Location&gt;</code> </pre><br>  This completes the cups setting.  Restart it.  In openSUSE this is done through the systemctl <br><br><pre> <code class="bash hljs">systemctl restart cups.service</code> </pre><br>  Now you can proceed to setting up printers via cups'a web interface.  There is a small subtlety - to change, add, delete printers you need to go into cups web interface via ssl ( <b>https</b> ), i.e.  in the web browser open <br><br><pre> <code class="bash hljs">https://10.10.15.11:631/</code> </pre><br>  Otherwise, we get the following error: <br><br> <a href="http://hostingkartinok.com/show-image.php%3Fid%3D9e9a0fe8c3142a0c40a76918426a0913" title="image hosting"><img src="https://habrastorage.org/getpro/habr/post_images/c2d/d18/2ef/c2dd182efb101813b89fce68aa0b32b3.png"></a> <br><br>  Adding printers to cups via a web interface is a rather trivial task, so I will not describe it.  The only thing I recommend on the ‚ÄúAdministration‚Äù tab is to check whether the options are enabled: <br><br>  - Allow sharing of printers connected to this system <br>  - Allow printing from the Internet <br><br>  And when installing the printer, do not forget to include the option "Allow sharing of this printer." <br><br> <a href="http://hostingkartinok.com/show-image.php%3Fid%3Df3f371186f101af150a31f95109e868f" title="image hosting"><img src="https://habrastorage.org/getpro/habr/post_images/800/3eb/b37/8003ebb3700b5acc669fad653d847923.png"></a> <br><br>  Who does not want to bother with samba, cups have the ability to print using ipp (Internet Printing Protocol).  In Windows, the printer is installed as follows: control panel ‚Üí printers ‚Üí printer installation ‚Üí network printer ‚Üí connect to a printer on the Internet (‚Äúselect shared printer by name‚Äù for Win7 / 8/10) as the url we specify the full path: <br><br><pre> <code class="html hljs xml"> http://10.10.15.11:631/printers/Kyocera_6525_PTO  http://Print-01:631/printers/Kyocera_6525_PTO</code> </pre><br> <a href="http://hostingkartinok.com/show-image.php%3Fid%3Dbd86db1e8978c8e6a4b24b8d161c469d" title="image hosting"><img src="https://habrastorage.org/getpro/habr/post_images/aa8/6f9/059/aa86f90598aac7692a3705ce3d3876e4.png"></a> <br><br><div style="text-align:center;"> <a href="http://hostingkartinok.com/show-image.php%3Fid%3D10045d56a4b804314da2e3e800465927" title="image hosting"><img src="https://habrastorage.org/getpro/habr/post_images/123/6c6/435/1236c643508332337e1c9941c863c6df.png"></a> </div><br><br>  The full path to the printer can be copied from the address bar of the browser in the cups web interface. <br><br> <a href="http://hostingkartinok.com/show-image.php%3Fid%3D45009425fc291152bb3a48dada910cb8" title="place photo"><img src="https://habrastorage.org/getpro/habr/post_images/506/226/fd9/506226fd9e286b3979ff2d95621b684b.png"></a> <br><br>  The only thing with this method, the system will ask the printer driver.  It will need to be pre-downloaded and fed to it during installation. <br><br>  <b>GRAB__1:</b> in WinXP, ipp is enabled by default in the service pack since SP2; in Windows7 / 8/10, the Internet Printing component may not be included. <br><br>  Installed through the control panel ‚Üí programs and components - enable and disable Windows components.  On server-side Windows, this protocol is disabled by default.  Turn on through Server Manager ‚Üí components ‚Üí add components ‚Üí print client via the Internet. <br><br>  I suffered with this problem for 2 days.  When I tried to install the printer in this way, I got out the error - ‚ÄúWindows cannot connect to the printer‚Äù.  At the same time, there is nothing criminal in the cups and samba logs.  It was a megatresh.  I got to parse the entire flow of the network interface using tcpdump and wireshark, but the casket just opened.  The problem was on the side of Windows. <br><br><div style="text-align:center;"> <a href="http://hostingkartinok.com/show-image.php%3Fid%3Dcce905f591c79495da66302590123ff5" title="free image hosting"><img src="https://habrastorage.org/getpro/habr/post_images/ea9/9b5/a80/ea99b5a8016e912e4d2f87a5984900aa.png"></a> </div><br><h2>  Part 2. Installing drivers </h2><br>  Suppose cups printers are installed, now let's start copying and registering printer drivers for Windows. <br><br>  You can manually copy the installed drivers to Windows -% WINDIR% \ system32 \ spool \ drivers \ W32X86 and \ x64 to the folder with the balloon for samba drivers - / var / lib / samba / drivers / W32X86 and ./x64 and then register them with console utility rpcclient, but this is an unreal quest and is not for the faint of heart. <br><br>  We will go more simple way.  Login on a Windows machine with Domain Admin account in our domain.  I will show on the example of WinXP (further I will tell how to act with Win7).  Open the explorer, in the address bar we drive in the address of the print server by IP or name: \\ Print-01 \ or \\ 10.10.15.11 \, go to the Printers and Faxes folder. <br><br> <a href="http://hostingkartinok.com/show-image.php%3Fid%3D88e6b2e2b2f9594d0d290d715e906a52" title="photosite"><img src="https://habrastorage.org/getpro/habr/post_images/96e/bb6/985/96ebb698570edcae112017fa8698e288.png"></a> <br><br>  Right click on the printer ‚Üí properties. <br><br> <a href="http://hostingkartinok.com/show-image.php%3Fid%3Dca2e713d6691031dbbdbe596bab81230" title="photo hosting"><img src="https://habrastorage.org/getpro/habr/post_images/128/bc6/ee7/128bc6ee76f1a6bfab0faa1f2e3b189a.png"></a> <br><br>  On the proposal to install the driver, we say No. <br><br> <a href="http://hostingkartinok.com/show-image.php%3Fid%3Da4f793e4920b4285a7ab5d86806ae833" title="free image hosting"><img src="https://habrastorage.org/getpro/habr/post_images/5ff/5cf/ab6/5ff5cfab68fa6b489e9b90b0424a673d.png"></a> <br><br>  Go to the tab "Advanced" ‚Üí change. <br><br><div style="text-align:center;"> <a href="http://hostingkartinok.com/show-image.php%3Fid%3D6bcce192c0872742db873634875de5ff" title="photohosting"><img src="https://habrastorage.org/getpro/habr/post_images/b6a/2ac/98a/b6a2ac98a57a34a2beba08b01dc7b153.png"></a> </div><br>  Install from the disk and specify the folder with the driver.  Select the printer in the list and click OK. <br><br>  <b>IMPORTANT</b> - in the beginning, you must specify a dad with 32-bit drivers, even if your system is 64-bit!  64-bit firewood can be installed after. <br><br><div style="text-align:center;"> <a href="http://hostingkartinok.com/show-image.php%3Fid%3D2842d1bb4b41aaee40a90614cfa9c688" title="hosting screenshots"><img src="https://habrastorage.org/getpro/habr/post_images/89f/718/cbd/89f718cbd9518384030360f0e3a7323d.png"></a> </div><br>  There is a copy of the drivers in the shared folder samba. <br><br><div style="text-align:center;"> <a href="http://hostingkartinok.com/show-image.php%3Fid%3D21107b7bddf3f12986c930bb5b790e95" title="free image hosting"><img src="https://habrastorage.org/getpro/habr/post_images/5df/721/e78/5df721e783121f4caff92bd3a283c7fc.png"></a> </div><br>  Go to the tab ‚Äúaccess‚Äù ‚Üí tick the checkbox ‚ÄúInsert into Active Diectory‚Äù ‚Üí apply.  If you need 64-bit drivers, click Additional Drivers " <br><br><div style="text-align:center;"> <a href="http://hostingkartinok.com/show-image.php%3Fid%3D6c42fa7d395c8459df9fdab7b8d6c051" title="image host"><img src="https://habrastorage.org/getpro/habr/post_images/d2a/732/833/d2a7328335a42101fcf02d219ad20734.png"></a> </div><br>  And tick x64 ‚Üí OK.  The system will request a folder with drivers - we feed it to it in the same way. <br><br><div style="text-align:center;"> <a href="http://hostingkartinok.com/show-image.php%3Fid%3D320b4179df5b02cdf570263a5965b32d" title="free image hosting"><img src="https://habrastorage.org/getpro/habr/post_images/9c9/14e/957/9c914e957f93ded73cb5343d8218b890.png"></a> </div><br>  If desired, on the "General" tab, you can rename the network printer.  These names will be displayed when you navigate to the printserver \\ Print-01 \ or \\ 10.10.15.11 \. <br><br><div style="text-align:center;"> <a href="http://hostingkartinok.com/show-image.php%3Fid%3Dac20b19c48bc750e4f23d43b93ddd198" title="image hosting"><img src="https://habrastorage.org/getpro/habr/post_images/2ad/808/2b7/2ad8082b75b953f282f11cc604e10717.png"></a> </div><br>  In AD, printer names will be the same as you called them in cups. <br><br><div style="text-align:center;"> <a href="http://hostingkartinok.com/show-image.php%3Fid%3D9109783f6e3994bba8588562efbe51b8" title="photosite"><img src="https://habrastorage.org/getpro/habr/post_images/e93/5f3/0cd/e935f30cdb42516bf8be41ab1aa69e4b.png"></a> </div><br><h3>  Remove printers from AD. </h3><br>  Server Manager ‚Üí Active Directory Domain Services ‚Üí Active Directory users and computers ‚Üí select the domain with the right mouse button ‚Üí find ‚Üí select the group from the ‚Äúprinters‚Äù drop-down list ‚Üí find. <br><br> <a href="http://hostingkartinok.com/show-image.php%3Fid%3D9d18fccc4c31665bdc7bb32300460eab" title="upload image"><img src="https://habrastorage.org/getpro/habr/post_images/4db/071/e46/4db071e46013c9afe28adf711146d88a.png"></a> <br><br>  Find in the list the printer that we want to delete ‚Üí right-click "delete" <br><br> <a href="http://hostingkartinok.com/show-image.php%3Fid%3Db21230034cb92c108190b1c0699bf7f3" title="photosite"><img src="https://habrastorage.org/getpro/habr/post_images/997/74c/fed/99774cfed846c21a3d0c968e790a0324.png"></a> <br><br><h3>  Installing drivers in Windows 7/8/10. </h3><br>  In Windows 7/8/10, you can install drivers on a print server from the printmanagement.msc snap-in.  Start ‚Üí Run ‚Üí printmanagement.msc <br><br>  <b>NOTE</b> Home and Home Premium do not have this tool.  You need to run this snap-in from under the Domain Admin account.  First you need to add our print server by IP or name. <br><br> <a href="http://hostingkartinok.com/show-image.php%3Fid%3D1e9cfe366129e0ca86ca753220e31322" title="photo hosting"><img src="https://habrastorage.org/getpro/habr/post_images/52c/b73/d16/52cb73d16644ab976c992bd601495b3c.png"></a> <br><br>  Further, here you can control the printers of the print server by analogy with the above instructions. <br><br> <a href="http://hostingkartinok.com/show-image.php%3Fid%3D2498ec01ec1e1b25dc56f8878e61150e" title="post image"><img src="https://habrastorage.org/getpro/habr/post_images/1e3/14a/64f/1e314a64fc76d0a7c38733795771e418.png"></a> <br><br>  It is also convenient to manage print server drivers here - delete / add. <br><br> <a href="http://hostingkartinok.com/show-image.php%3Fid%3Df6560021a31e997ca43aa747f7bd3416" title="image hosting"><img src="https://habrastorage.org/getpro/habr/post_images/7a0/5df/037/7a05df037ad2869ff961dab4d98201b0.png"></a> <br><br><h3>  What could not yet be solved </h3><br>  In Windows Server 2012 R2, well, no shared printers want to be installed.  There are no errors in the cups and samba logs.  The printer starts to install, the drivers are copied, but at the ‚Äúinstallation completion‚Äù stage, the above error ‚ÄúWindows cannot connect to the printer‚Äù pops up.  I think this is some kind of a cant of Windows and most likely an ipp protocol, although the component ‚ÄúInternet printing client‚Äù is installed. <br><br>  In conclusion, I will share the secret of installing a Panasonic KX-FLB883RU printer in CUPS.  There are no drivers for this printer for linux, but ljet2p.ppd (Panasonic KX-P4410 Foomatic / ljet2p), which is included in the standard OpenPrintingPPDs package, miraculously came up.  Setting up the printer in CUPS via socket: // IP_address /.  Everything works without glitches.  I hope someone will come in handy. <br><br>  My next article will be devoted to a remote automated system for installing printers to domain users.  Or something like this) <br><br>  My working configs see below. <br><br><div class="spoiler">  <b class="spoiler_title">/etc/krb5.conf</b> <div class="spoiler_text"><pre> <code class="bash hljs">[libdefaults] ticket_lifetime = 24000 default_realm = INITIAL.LOCAL dns_lookup_realm = <span class="hljs-literal"><span class="hljs-literal">false</span></span> dns_lookup_kds = <span class="hljs-literal"><span class="hljs-literal">false</span></span> clockskew = 300 <span class="hljs-comment"><span class="hljs-comment"># ------------------------------------- kdc_timesync = 1 ccache_type = 4 forwardable = true proxiable = true [realms] INITIAL.LOCAL = { kdc = dc-01.initial.local default_domain = initial.local # admin_server = kerberos.initial.local:749 admin_server = dc-01.initial.local } # EXAMPLE.COM = { # kdc = kerberos.example.com # admin_server = kerberos.example.com # } [logging] kdc = FILE:/var/log/krb5/krb5kdc.log admin_server = FILE:/var/log/krb5/kadmind.log default = SYSLOG:NOTICE:DAEMON [domain_realm] .initial.local = INITIAL.LOCAL .INITIAL.local = INITIAL.LOCAL .INITIAL = INITIAL.LOCAL initial.local = INITIAL.LOCAL [appdefaults] pam = { debug = false ticket_lifetime = 1d renew_lifetime = 1d forwardable = true proxiable = false retain_after_close = false minimum_uid = 1 use_shmem = sshd clockskew = 300 }</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">/etc/nsswitch.conf</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /etc/nsswitch.conf # # An example Name Service Switch config file. This file should be # sorted with the most-used services at the beginning. # # The entry '[NOTFOUND=return]' means that the search for an # entry should stop if the search in the previous entry turned # up nothing. Note that if the search failed due to some other reason # (like no NIS server responding) then the search continues with the # next entry. # # Legal entries are: # # compat Use compatibility setup # nisplus Use NIS+ (NIS version 3) # nis Use NIS (NIS version 2), also called YP # dns Use DNS (Domain Name Service) # files Use the local files # [NOTFOUND=return] Stop searching if not found so far # # For more information, please read the nsswitch.conf.5 manual page. # # passwd: files nis # shadow: files nis # group: files nis # passwd: compat winbind # group: compat winbind # shadow: compat winbind passwd: files winbind group: files winbind shadow: files winbind # hosts: files mdns4_minimal [NOTFOUND=return] dns wins hosts: files [dns] wins networks: files dns services: files protocols: files rpc: files ethers: files netmasks: files netgroup: files nis publickey: files bootparams: files automount: files nis aliases: files</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">/etc/openldap/ldap.conf</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># # LDAP Defaults # # See ldap.conf(5) for details # This file should be world readable but not world writable. #BASE dc=example,dc=com #URI ldap://ldap.example.com ldap://ldap-master.example.com:666 #SIZELIMIT 12 #TIMELIMIT 15 #DEREF never URI ldap://10.10.15.31 BASE DC=initial,DC=local</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">/etc/samba/smb.conf</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># smb.conf is the main Samba configuration file. You find a full commented # version at /usr/share/doc/packages/samba/examples/smb.conf.SUSE if the # samba-doc package is installed. [global] workgroup = INITIAL # passdb backend = smbpasswd printing = cups printcap name = cups printcap cache time = 750 cups options = raw map to guest = Bad User logon path = \\%L\profiles\.msprofile logon home = \\%L\%U\.9xprofile logon drive = P: usershare allow guests = Yes add machine script = /usr/sbin/useradd -c Machine -d /var/lib/nobody -s /bin/false %m$ domain logons = No domain master = No security = ADS encrypt passwords = yes # idmap backend = ldap:ldap://10.10.15.31 ldap admin dn = admin@initial.local ldap group suffix = ou=Groups ldap idmap suffix = ou=Idmap ldap machine suffix = ou=Computers ldap passwd sync = Yes ldap suffix = DC=initial,DC=local ldap user suffix = ou=Users ldap ssl = Off ldapsam:trusted = yes ldapsam:editposix = yes # idmap gid = 500-10000000 # idmap uid = 500-10000000 netbios name = print-01 name resolve order = lmhost wins host bcast wins server = 10.10.15.31 wins support = No usershare max shares = 100 kerberos method = system keytab ## -------------------------------------- winbind separator = / winbind enum users = yes winbind enum groups = yes winbind nested groups = yes winbind use default domain = yes winbind nss info = rfc2307 winbind uid = 10000-20000 winbind gid = 10000-20000 realm = INITIAL.LOCAL template homedir = /home/%D/%U winbind refresh tickets = yes template shell = /bin/bash # [homes] # comment = Home Directories # valid users = %S, %D%w%S # browseable = No # read only = No # inherit acls = Yes # [profiles] # comment = Network Profiles Service # path = %H # read only = No # store dos attributes = Yes # create mask = 0600 # directory mask = 0700 # [users] # comment = All users # path = /home # read only = No # inherit acls = Yes # veto files = /aquota.user/groups/shares/ # guest ok = No # [groups] # comment = All groups # path = /home/groups # read only = No # inherit acls = Yes [printers] comment = All Printers path = /var/spool/samba printable = Yes create mask = 0664 browseable = Yes read only = No guest ok = Yes [print$] comment = Printer Drivers path = /var/lib/samba/drivers write list = @ntadmin root force group = ntadmin create mask = 0664 directory mask = 0700 read only = No guest ok = Yes writable = yes # inherit permissions = yes # -------------------------------- use client driver = yes # [netlogon]</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">/etc/cups/cupsd.conf</b> <div class="spoiler_text"><pre> <code class="bash hljs">LogLevel debug SystemGroup root <span class="hljs-comment"><span class="hljs-comment"># Allow remote access Port 631 Listen /run/cups/cups.sock Browsing On BrowseLocalProtocols CUPS BrowseRemoteProtocols CUPS BrowseOrder allow,deny BrowseAllow all BrowseAddress 10.10.15.0/24 BrowseAddress 172.19.2.0/24 BrowseAddress 172.19.3.0/24 BrowseAddress 172.19.4.0/24 DefaultAuthType Basic WebInterface Yes &lt;Location /&gt; # Allow remote access... Order allow,deny Allow all &lt;/Location&gt; &lt;Location /admin&gt; Order deny,allow &lt;/Location&gt; &lt;Location /admin/conf&gt; AuthType Default Require user @SYSTEM &lt;/Location&gt; &lt;Policy default&gt; JobPrivateAccess default JobPrivateValues default SubscriptionPrivateAccess default SubscriptionPrivateValues default &lt;Limit Create-Job Print-Job Print-URI Validate-Job&gt; Order deny,allow &lt;/Limit&gt; &lt;Limit Send-Document Send-URI Hold-Job Release-Job Restart-Job Purge-Jobs Set-Job-Attributes Create-Job-Subscription Renew-Subscription Cancel-Subscription Get-Notifications Reprocess-Job Cancel-Current-Job Suspend-Current-Job Resume-Job Cancel-My-Jobs Close-Job CUPS-Move-Job CUPS-Get-Document&gt; Require user @OWNER @SYSTEM Order deny,allow &lt;/Limit&gt; &lt;Limit CUPS-Add-Modify-Printer CUPS-Delete-Printer CUPS-Add-Modify-Class CUPS-Delete-Class CUPS-Set-Default CUPS-Get-Devices&gt; AuthType Default Require user @SYSTEM Order deny,allow &lt;/Limit&gt; &lt;Limit Pause-Printer Resume-Printer Enable-Printer Disable-Printer Pause-Printer-After-Current-Job Hold-New-Jobs Release-Held-New-Jobs Deactivate-Printer Activate-Printer Restart-Printer Shutdown-Printer Startup-Printer Promote-Job Schedule-Job-After Cancel-Jobs CUPS-Accept-Jobs CUPS-Reject-Jobs&gt; AuthType Default Require user @SYSTEM Order deny,allow &lt;/Limit&gt; &lt;Limit Cancel-Job CUPS-Authenticate-Job&gt; Require user @OWNER @SYSTEM Order deny,allow &lt;/Limit&gt; &lt;Limit All&gt; Order deny,allow &lt;/Limit&gt; &lt;/Policy&gt; &lt;Policy authenticated&gt; JobPrivateAccess default JobPrivateValues default SubscriptionPrivateAccess default SubscriptionPrivateValues default &lt;Limit Create-Job Print-Job Print-URI Validate-Job&gt; AuthType Default Order deny,allow &lt;/Limit&gt; &lt;Limit Send-Document Send-URI Hold-Job Release-Job Restart-Job Purge-Jobs Set-Job-Attributes Create-Job-Subscription Renew-Subscription Cancel-Subscription Get-Notifications Reprocess-Job Cancel-Current-Job Suspend-Current-Job Resume-Job Cancel-My-Jobs Close-Job CUPS-Move-Job CUPS-Get-Document&gt; AuthType Default Require user @OWNER @SYSTEM Order deny,allow &lt;/Limit&gt; &lt;Limit CUPS-Add-Modify-Printer CUPS-Delete-Printer CUPS-Add-Modify-Class CUPS-Delete-Class CUPS-Set-Default&gt; AuthType Default Require user @SYSTEM Order deny,allow &lt;/Limit&gt; &lt;Limit Pause-Printer Resume-Printer Enable-Printer Disable-Printer Pause-Printer-After-Current-Job Hold-New-Jobs Release-Held-New-Jobs Deactivate-Printer Activate-Printer Restart-Printer Shutdown-Printer Startup-Printer Promote-Job Schedule-Job-After Cancel-Jobs CUPS-Accept-Jobs CUPS-Reject-Jobs&gt; AuthType Default Require user @SYSTEM Order deny,allow &lt;/Limit&gt; &lt;Limit Cancel-Job CUPS-Authenticate-Job&gt; AuthType Default Require user @OWNER @SYSTEM Order deny,allow &lt;/Limit&gt; &lt;Limit All&gt; Order deny,allow &lt;/Limit&gt; &lt;/Policy&gt; &lt;Policy allowallforanybody&gt; JobPrivateAccess all JobPrivateValues none SubscriptionPrivateAccess all SubscriptionPrivateValues none &lt;Limit All Validate-Job Cancel-Jobs Cancel-My-Jobs Close-Job CUPS-Get-Document&gt; Order deny,allow Allow from all &lt;/Limit&gt; &lt;/Policy&gt; DefaultPolicy default</span></span></code> </pre><br></div></div><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/313636/">https://habr.com/ru/post/313636/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../313624/index.html">How to make bold decisions and not regret anything</a></li>
<li><a href="../313626/index.html">A large list of valuable tips President Y Combinator</a></li>
<li><a href="../313628/index.html">Made in MIT: Gitless version control system</a></li>
<li><a href="../313630/index.html">Macaw - convenient library for vector graphics in Cocoa</a></li>
<li><a href="../313632/index.html">GitLab on open source project management policy</a></li>
<li><a href="../313638/index.html">On the performance of named pipes in multi-process applications</a></li>
<li><a href="../313640/index.html">‚ÄúMonitoring .NET application performance: approaches and tools,‚Äù an interview with Dina Goldstein</a></li>
<li><a href="../313642/index.html">Microsoft unveiled an update to its Cognitive Toolkit.</a></li>
<li><a href="../313644/index.html">Familiarity with the Ceph repository in pictures</a></li>
<li><a href="../313646/index.html">List of free transactional, hosting and marketing email-providers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>