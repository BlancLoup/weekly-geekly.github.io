<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Plan-fact, dynamics and profits in one diagram with R</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Every time when the financial results of the past year are summed up and the corresponding presentation is being prepared, people are puzzled how to f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Plan-fact, dynamics and profits in one diagram with R</h1><div class="post__text post__text-html js-mediator-article">  Every time when the financial results of the past year are summed up and the corresponding presentation is being prepared, people are puzzled how to fit the main figures on a single diagram.  Whatever the field of activity of the organization, summing up, as a rule, begins with an analysis of the main financial indicators, separately for each of the business areas: <br><ul><li>  turnover in the year ended (actual figures); </li><li>  previously established plans for the past year (for review of implementation); </li><li>  turnover a year earlier (to understand the dynamics); </li><li>  profitability. </li></ul>  A standard bar graph, which can be quickly built in Excel, gives, to put it mildly, not quite an obvious result.  For example, if a business has four directions, then 16 adjacent columns will appear on the diagram, and someone may not like to confuse the best people and those who are lagging behind. <br>  Professionals familiar with R can use ggplot2 to programmatically build the desired diagram, such as here.  For example, the figures for 2012 are taken from the annual report of Unilever.  The targets are not public data, so I had to invent them from the head, setting, for certainty, at the level of "last year + 5%." <br>  The original figures are in Excel and look like this (data in millions of euros): <br><img src="https://habrastorage.org/getpro/habr/post_images/e32/144/cc7/e32144cc7c8c1b8f1c72a57a5b0eaa75.png" alt="image"><br>  The diagram constructed in RStudio looks as follows: <br><img src="https://habrastorage.org/getpro/habr/post_images/97c/474/ff3/97c474ff3aa86a5e45676786b2ea469e.png" alt="image"><br>  Check the diagram for intuitiveness, and without looking at the numbers, suppose which indicator corresponds to which element of the diagram, and the explanations will be further. <br><a name="habracut"></a><br>  The idea is that the main parameter ‚Äî Turnover ‚Äî is shown in the form of color-filled columns, last year‚Äôs figure (LastYear) ‚Äîas a contour that is visually behind, planned figures (Forecast) in the form of slats, and profitability (more precisely, the opposite value - costs) - a small mark. <br>  To read data from Excel, use the XLConnect package.  From the Excel file, from the specified sheet, the named table is loaded into R. <br>  The colors for the chart are taken from the Unilever corporate color table. <br>  So code <br><pre><code class="python hljs">require(XLConnect) require(data.table) require(ggplot2) require(scales) indata &lt;- readTable(loadWorkbook(<span class="hljs-string"><span class="hljs-string">"Unilever.xlsx"</span></span>), sheet = <span class="hljs-string"><span class="hljs-string">"FinResults"</span></span>, table = <span class="hljs-string"><span class="hljs-string">"Unilever2012"</span></span>, useCachedValues = TRUE) finreport &lt;- data.table(indata)[, list( Segment = reorder(Segment, -Turnover), Cost = (Turnover - Profit), Forecast, Turnover, LastYear )] turnover_format = function(...){ function(x) paste(<span class="hljs-string"><span class="hljs-string">"‚Ç¨B "</span></span>, format(x/<span class="hljs-number"><span class="hljs-number">1000</span></span>, ..., nsmall = <span class="hljs-number"><span class="hljs-number">1L</span></span>, scientific = FALSE, trim = TRUE)) } chart &lt;- ggplot(finreport, aes(x = Segment)) + geom_bar(aes(y = LastYear), stat = <span class="hljs-string"><span class="hljs-string">"identity"</span></span>, color = <span class="hljs-string"><span class="hljs-string">"#004976"</span></span>, fill = <span class="hljs-string"><span class="hljs-string">"white"</span></span>, width = <span class="hljs-number"><span class="hljs-number">0.9</span></span>) + geom_bar(aes(y = Turnover), stat = <span class="hljs-string"><span class="hljs-string">"identity"</span></span>, color = <span class="hljs-string"><span class="hljs-string">"white"</span></span>, fill = <span class="hljs-string"><span class="hljs-string">"#0085CA"</span></span>, width = <span class="hljs-number"><span class="hljs-number">0.6</span></span>) + geom_crossbar(aes(ymin = Forecast, ymax = Forecast, y = Forecast), color = <span class="hljs-string"><span class="hljs-string">"#ED8800"</span></span>, width = <span class="hljs-number"><span class="hljs-number">0.4</span></span>, size = <span class="hljs-number"><span class="hljs-number">0.7</span></span>) + geom_point(aes(y = Cost), shape = <span class="hljs-number"><span class="hljs-number">25</span></span>, color = <span class="hljs-string"><span class="hljs-string">"#cedc00"</span></span>, fill = <span class="hljs-string"><span class="hljs-string">"white"</span></span>) + scale_y_continuous(breaks = pretty_breaks(<span class="hljs-number"><span class="hljs-number">20</span></span>), labels = turnover_format()) + theme_bw() + theme ( panel.border = element_blank() , axis.line = element_line() , axis.title.x = element_blank() , axis.title.y = element_blank() , axis.text = element_text( size = <span class="hljs-number"><span class="hljs-number">13</span></span>, color = <span class="hljs-string"><span class="hljs-string">"#3C1053"</span></span>) ) print(chart)</code> </pre> <br>  Baseline: Univeler <a href="http://www.unilever.ru/Images/ir_Unilever_AR12_tcm13-348376_tcm63-348639.pdf">Annual Report and Accounts 2012</a> , page 92. </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/220135/">https://habr.com/ru/post/220135/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../220123/index.html">Internet radio with a host of leading from different cities and calls live</a></li>
<li><a href="../220125/index.html">Basics of parsing with Python + lxml</a></li>
<li><a href="../220127/index.html">Discover MODX</a></li>
<li><a href="../220129/index.html">Jump Start April 22: Data Center Virtualization using Windows Server 2012 R2 and System Center 2012 R2. Ensuring the security and high availability of virtual machines</a></li>
<li><a href="../220131/index.html">EditorConfig - Alone Settings for All Editors / IDE</a></li>
<li><a href="../220137/index.html">Automate the deployment of applications in 1 click on the platform InfoboxCloud Jelastic with JPS</a></li>
<li><a href="../220141/index.html">Algorithms for video processing processor TI DM368, continued ...</a></li>
<li><a href="../220147/index.html">Service goal setting. Now on Android and iOS</a></li>
<li><a href="../220149/index.html">Free plugin for IT service providers - Veeam Backup & Replication Add-on for Kaseya</a></li>
<li><a href="../220151/index.html">InfoTeX opens the door</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>