<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How you can easily and easily implement options in Ruby on Rails</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prologue 

 Probably all the web (and maybe not only the web) developers sooner or later had to deal with such a task as user options . What I mean th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How you can easily and easily implement options in Ruby on Rails</h1><div class="post__text post__text-html js-mediator-article"><h1>  Prologue </h1><br><img src="http://rghost.ru/1839409/private/2825b33cc24c6101349d442a9cfa9df5/image.png" alt="image" align="right"><br>  Probably all the web (and maybe not only the web) developers sooner or later had to deal with such a task as <i>user options</i> .  What I mean the easiest way to show in the picture.  By options, we mean checkboxes (that is, the option is either there or not).  Usually there are not too many such options, about 2-10.  Usually they are indicated when registering and / or editing a profile. <br><br><h1>  Formulation of the problem </h1><br>  As a rule, the number of these settings (and the settings themselves) can vary, so it would be nice to implement the mechanism of these options in such a way that adding / changing / deleting them was as simple as possible while changing as little code as possible.  I'll tell you how you can solve it and how I solved this task within the framework of the Ruby on Rails framework. <br><a name="habracut"></a><br><h1>  Implementation options </h1><br>  In general, I usually ask this question at the interview, I heard a lot of answers.  One of them is to use <i>two tables</i> : one for options, the other for user-option communication (there is a record - it means there is a tick in the form). <br>  Benefits: <br><ul><li>  List of options editable </li></ul>  Disadvantages: <br><ul><li>  join tables to find out if the option is set </li><li>  nontrivial view code </li></ul>  Let me explain the second point: I would like to have something similar to: <br><br><pre>   &lt;% = f.check_box: send_mail_on_friend_request%&gt;
</pre><br>  Of course, this can be done, but the code in the model will not be trivial. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Another option for options is to use one column - the text, which stores the options in serialized form <br><br><pre> class User
   serialize: options, Hash
 end
</pre><br>  In this example, it is unclear what the user‚Äôs options may be at all, let's improve: <br><br><pre> class User
   OPTION_1 =: key_1
   OPTION_2 =: key_2

   serialize: options, Hash

   def option_1 = (value)
     self.options [: key_1] = value
   end
   def option_2 = (value)
     self.options [: key_2] = value
   end
   def option_1
     self.options [: key_1]
   end
   def option_2
     self.options [: key_2]
   end
 end
</pre><br>  Already clearer, but too many methods: what if there are 20 options?  This problem is perfectly solved by define_method (an example of its use will be lower).  But still, let's think: after all, an option, it‚Äôs just a checkbox, just a bit - either cocked or not (yes, yes, as a woman‚Äôs intuition :), why serialize, deserialize?  Can it be made easier? <br><br><h1>  My implementation </h1><br>  Let's think how many such options can there be?  I think a maximum of 10, well, 20, the more the user will not fill.  And what if you keep the options as usual?  Not a bad idea, just have to remember working with bits: <br><br><pre> class User &lt;ActiveRecord :: Base
   NOTIFY_ON_MAIL = 0b0001
   NOTIFY_ON_WALL_POST = 0b0010
   NOTIFY_ON_FRIEND_REQUEST = 0b0100
   NOTIFY_ON_COMMENT_ANSWER = 0b1000

   def notify_on_mail
     self.options &amp; NOTIFY_ON_MAIL! = 0
   end

   def notify_on_mail = (value)
     if value! = "0"
       self.options | = const
     else
       self.options &amp; = ~ const
     end
   end
 end
</pre><br>  So good.  Now you can generalize for any number of options: <br><br><pre> class User &lt;ActiveRecord :: Base
   NOTIFY_ON_MAIL = 0b0001
   NOTIFY_ON_WALL_POST = 0b0010
   NOTIFY_ON_FRIEND_REQUEST = 0b0100
   NOTIFY_ON_COMMENT_ANSWER = 0b1000

   [NOTIFY_ON_MAIL, NOTIFY_ON_WALL_POST, NOTIFY_ON_FRIEND_REQUEST, NOTIFY_ON_COMMENT_ANSWER] .each do | notifer |
     const = self.const_get (notifer)

     define_method notifer.downcase.to_sym do
       (mail_options &amp; const)! = 0
     end

     define_method "# {notifer.downcase} =". to_sym do | flag |
       if flag! = "0"
         self.mail_options | = const
       else
         self.mail_options &amp; = ~ const
       end
     end
   end
 end
</pre><br>  Now to add a new option you need to change just two lines.  Hmm, what if you reduce everything to one?  Result: <br><br><pre> class User &lt;ActiveRecord :: Base
   NOTIFY_ON_MAIL = 0b0001
   NOTIFY_ON_WALL_POST = 0b0010
   NOTIFY_ON_FRIEND_REQUEST = 0b0100
   NOTIFY_ON_COMMENT_ANSWER = 0b1000

   constants.grep (/ ^ NOTIFY _ /). each do | notifer |
     const = self.const_get (notifer)

     define_method notifer.downcase.to_sym do
       (mail_options &amp; const)! = 0
     end

     define_method "# {notifer.downcase} =". to_sym do | flag |
       if flag! = "0"
         self.mail_options | = const
       else
         self.mail_options &amp; = ~ const
       end
     end
   end
 end
</pre><br>  Fields for views can also be generated in a loop. <br>  I hope a little note brought you some thoughts :) All the best to you! </div><p>Source: <a href="https://habr.com/ru/post/95935/">https://habr.com/ru/post/95935/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../95928/index.html">Mortal Kombat: Rebirth</a></li>
<li><a href="../95929/index.html">Who do you work for?</a></li>
<li><a href="../95930/index.html">About implicit ads, backwards compatibility and ABI</a></li>
<li><a href="../95931/index.html">Meet, QMMP - music player</a></li>
<li><a href="../95934/index.html">Turn off the monitor from the keyboard</a></li>
<li><a href="../95938/index.html">Tungstene recognizes Photoshop</a></li>
<li><a href="../95939/index.html">We lift FreshTel in Linux</a></li>
<li><a href="../95940/index.html">Russian team at international competitions in underwater robotics</a></li>
<li><a href="../95942/index.html">Illustrated synopsis of Kent Beck's lecture ‚ÄúFour Strategies for Responsive Design‚Äù (with comments)</a></li>
<li><a href="../95947/index.html">Can you live without a computer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>