<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Goodnight!</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About a month ago I purchased the HTC Hero . The main reason for choosing this phone, rather than the iPhone, was the ability to fully develop applica...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Goodnight!</h1><div class="post__text post__text-html js-mediator-article"><img src="http://i.product-studio.ru/2009/12/goodnight/logo.png" alt="image" align="left">  About a month ago I purchased the <a href="http://www.htc.com/ru/product/hero/overview.html">HTC Hero</a> .  The main reason for choosing this phone, rather than the iPhone, was the ability to fully develop applications for Windows. <br><br>  As a sample of the pen, I wrote a small program that turns off the sound for the night.  Under the cut description of the development process and a link to the program. <br><a name="habracut"></a><br><h4>  Terms of Reference </h4><br>  The problem is that modern phones can do much more than just make calls.  They can receive updates from <a href="http://twitter.com/3fonov">Twitter</a> , email and heaps of other places.  However, they strive to inform the user about these updates.  And everything seems to be nice until night falls.  You go to bed, close your eyes, and then "dzin" or "ZHZHZH-ZHZHZH."  At some point, just turn off the sound and vibration in order to fall asleep. <br><br>  Just for this and need a program.  It turns off all alerts in a given period of time. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Development environment </h4><br>  <i>Eclipse</i> is practically the only full-fledged development tool for Android.  For work, I chose <a href="http://www.eclipse.org/downloads/download.php%3Ffile%3D/eclipse/downloads/drops/R-3.5.1-200909170800/eclipse-SDK-3.5.1-win32.zip">Eclipse Classic 3.5.1</a> . <br><br>  You will also need the <i>Android SDK</i> .  It can be found on <a href="http://developer.android.com/intl/zh-TW/sdk/index.html">the download page</a> .  There is also a quick installation guide. <br><br><h4>  Where to begin </h4><br>  For me, Java and Android development is a completely new occupation.  Therefore, the first thing I carefully studied the <a href="http://developer.android.com/intl/zh-TW/resources/tutorials/hello-world.html">lessons</a> that are presented in the <a href="http://developer.android.com/intl/zh-TW/resources/index.html"><i>Resources</i></a> section. <br><br>  Also in the <a href="http://developer.android.com/intl/zh-TW/reference/packages.html"><i>References</i></a> section, you will find a comprehensive reference for both the Andriod SDK and standard java packages.  The only thing missing is the use cases.  As a result, you first find the class you need, and then use Google to find out how to use it in the context of the application. <br><br><h5>  User interface </h5><img src="http://i.product-studio.ru/2009/12/goodnight/activity.png" alt="image"><br><br>  User interface development takes place in the built-in editor and is understandable to anyone who has come across form designers: <br><img src="http://i.product-studio.ru/2009/12/goodnight/idesigner.png" alt="image"><br><br>  Tips for designing interfaces for Android can be found in a special section of the <a href="http://developer.android.com/intl/zh-TW/guide/practices/ui_guidelines/index.html">Dev Guide</a> .  There are also recommendations for the design of icons: <br><img src="http://i.product-studio.ru/2009/12/goodnight/launcher_structure.png" alt="image"><br><br>  I hardly managed to fit my rectangle into the perspective required for the icons.  How to do something more complicated, I can not imagine.  Nevertheless, there is a <a href="http://developer.android.com/intl/zh-TW/guide/practices/ui_guidelines/icon_design.html">set of templates</a> for Photoshop and Illustrator, which greatly facilitates the creation of icons. <br><br><h4>  Storing user settings </h4><br>  To work with user settings in Android there is a class <a href="http://developer.android.com/intl/zh-TW/reference/android/preference/PreferenceManager.html"><code>PreferenceManager</code></a> .  The <code>getSharedPreferences()</code> method takes the name of the settings set as the first argument, and the creation mode (closed, open for reading or open for writing) as the second argument.  In response, we get an object of the <a href="http://developer.android.com/intl/zh-TW/reference/android/content/SharedPreferences.html"><code>SharedPreferences</code></a> class, which allows you to write and read settings.  If there is no such set, it will be created: <br><blockquote> <code><font color="black">SharedPreferences preferences = getSharedPreferences( <font color="#A31515">"goodnight"</font> , MODE_PRIVATE);</font></code> </blockquote> <br>  Special methods for reading various data types.  The first argument is the name of the field, and the second is the default value: <br><blockquote> <code><font color="black">preferences.getBoolean( <font color="#A31515">"isEnabled"</font> , <font color="#0000ff">false</font> ) <br> preferences.getInt( <font color="#A31515">"startHour"</font> , 23)</font></code> </blockquote> <br>  To write, you need to get the <a href="http://developer.android.com/intl/zh-TW/reference/android/content/SharedPreferences.Editor.html"><code>SharedPreferences.Editor</code></a> object using the <code>edit()</code> method, and at the end call the <code>commit()</code> method: <br><blockquote> <code><font color="black">Editor prefEditor =preferences.edit(); <br> prefEditor.putBoolean( <font color="#A31515">"isEnabled"</font> ,isEnabledCheckBox.isChecked()); <br> prefEditor.putInt( <font color="#A31515">"startHour"</font> , startTimePicker.getCurrentHour()); <br> prefEditor.putInt( <font color="#A31515">"startMinute"</font> , startTimePicker.getCurrentMinute()); <br> prefEditor.putInt( <font color="#A31515">"endHour"</font> , endTimePicker.getCurrentHour()); <br> prefEditor.putInt( <font color="#A31515">"endMinute"</font> , endTimePicker.getCurrentMinute()); <br> prefEditor.commit();</font></code> </blockquote> <br><h4>  Services </h4><br>  In order not to keep the program constantly open and at the same time do something, Android implements full-fledged services that can run in the background.  IPhone developers only dream about it. <br><br>  To create a service, you must create your own class, inherited from <code><a href="http://developer.android.com/intl/zh-TW/reference/android/app/Service.html"></a> android.app.Service</code>  <code><a href="http://developer.android.com/intl/zh-TW/reference/android/app/Service.html"></a> android.app.Service</code> and override method <code>onBind()</code> : <br><br><blockquote> <code><font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> GoodnightService extends Service { <br> <font color="#0000ff">@Override</font> <br> <font color="#0000ff">public</font> IBinder onBind(Intent intent) { <br> <font color="#008000">// TODO Auto-generated method stub</font> <br> <font color="#0000ff">return</font> <font color="#0000ff">null</font> ; <br> } <br> }</font></code> </blockquote> <br>  The <code>onCreate()</code> and <code>onDestroy()</code> methods can also be useful: <br><blockquote> <code><font color="black"><font color="#0000ff">@Override</font> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onCreate() { <br> super.onCreate(); <br> Log.i( <font color="#A31515">"GoodnightService"</font> , <font color="#A31515">"Service created"</font> ); <br> } <br> <font color="#0000ff">@Override</font> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onDestroy() { <br> super.onDestroy(); <br> Log.i( <font color="#A31515">"GoodnightService"</font> , <font color="#A31515">"Service destroyed"</font> ); <br> }</font></code> </blockquote> <br>  There are two types of interaction with services: the transfer of parameters at startup or the use of <a href="http://developer.android.com/intl/zh-TW/guide/developing/tools/aidl.html"><i>Android IDL</i></a> (AIDL).  In the first case, you start the service and after that you can only close it.  In the second case, you can create an interface through which it will be possible to manage the service.  Because  I planned to change the start and end time of the night, then I chose the second option. <br><br>  To do this, you must create a file with the extension <i>.aidl</i> and prescribe the interface in it: <br><blockquote> <code><font color="black"><font color="#0000ff">interface</font> IGoodnightService { <br> <font color="#0000ff">void</font> UpdateSettings(); <br> }</font></code> </blockquote> <br>  Now you need to compile the project in order to generate an interface from the <i>.aidl</i> IDL file.  After compiling, you can update the <code>onBind()</code> method and create a new <code>binder</code> property: <br><blockquote> <code><font color="black"><font color="#0000ff">@Override</font> <br> <font color="#0000ff">public</font> IBinder onBind(Intent intent) { <br> <font color="#0000ff">return</font> binder; <br> } <br> <br> <font color="#0000ff">private</font> final IGoodnightService.Stub binder = <font color="#0000ff">new</font> IGoodnightService.Stub() { <br> <font color="#0000ff">@Override</font> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> UpdateSettings() { <br> Init(); <br> Update(); <br> } <br> };</font></code> </blockquote> <br>  If you do not have a <code>Stub()</code> method, then most likely the file with the interface has the extension <i>.java</i> , and not <i>.aidl</i> . <br><br>  You also need to add your service to the <i>AndroidManifest.xml</i> application manifest: <br><img src="http://i.product-studio.ru/2009/12/goodnight/service.png" alt="image"><br><br><h5>  Client side services </h5><br>  To use the created interface, when you click on the "Apply" button, you need to perform a few simple steps.  First, we need an object with the type of our interface: <br><blockquote> <code><font color="black"><font color="#0000ff">private</font> IGoodnightService service;</font></code> </blockquote> <br>  Secondly, you need to create a property like <code><a href="http://developer.android.com/intl/zh-TW/reference/android/content/ServiceConnection.html"></a> ServiceConnection</code>  <code><a href="http://developer.android.com/intl/zh-TW/reference/android/content/ServiceConnection.html"></a> ServiceConnection</code> that monitors the state of the service and is necessary for associating an interface with it: <br><blockquote> <code><font color="black"><font color="#0000ff">private</font> ServiceConnection svcConn= <font color="#0000ff">new</font> ServiceConnection() { <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onServiceConnected(ComponentName className, <br> IBinder binder) { <br> service=IGoodnightService.Stub.asInterface(binder); <br> <br> } <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onServiceDisconnected(ComponentName className) { <br> service= <font color="#0000ff">null</font> ; <br> } <br> };</font></code> <br> </blockquote><br>  And finally, you need to associate the service with our application using the <a href="http://developer.android.com/intl/zh-TW/reference/android/content/Context.html"><code>bindService()</code></a> method: <br><blockquote> <code><font color="black">bindService( <font color="#0000ff">new</font> Intent( <font color="#0000ff">this</font> ,GoodnightService. <font color="#0000ff">class</font> ), svcConn, BIND_AUTO_CREATE);</font></code> </blockquote> <br>  Now you can safely refer to the methods described in <code>IGoodnightService</code> : <br><blockquote> <code><font color="black"><font color="#0000ff">try</font> { <br> service.UpdateTimers(); <br> } <font color="#0000ff">catch</font> (RemoteException e) { <br> <font color="#008000">// TODO Auto-generated catch block</font> <br> e.printStackTrace(); <br> }</font></code> </blockquote> <br><h4>  Alerts </h4><br>  In order to somehow show the serviceability of the service, I used the notification mechanism.  This can be a vibration, beeps or a small icon in the status bar (second from left): <br><img src="http://i.product-studio.ru/2009/12/goodnight/statusbar.png" alt="image"><br><br>  If you open the status bar, you can see the alert in a more expanded form: <br><img src="http://i.product-studio.ru/2009/12/goodnight/notification.png" alt="image"><br><br>  Text alerts are of two kinds: reporting new events (for example, a message on <a href="http://twitter.com/3fonov">Twitter</a> :-)) or that the program just works. <br><br>  Alerts of the first type can be removed from the list by clicking on the ‚ÄúClear Notifications‚Äù button.  At first I did them every minute so that they would not disappear.  Practice has shown that after 5-6 hours everything started to slow down wildly, and the alerts were no longer updated.  :-) Then the second method was found. <br><br>  To create alerts we need <code><a href="http://developer.android.com/intl/zh-TW/reference/android/app/NotificationManager.html"></a> NotificationManager</code>  <code><a href="http://developer.android.com/intl/zh-TW/reference/android/app/NotificationManager.html"></a> NotificationManager</code> , which can be obtained using the method <code><a href="http://developer.android.com/intl/zh-TW/reference/android/content/Context.html"></a> getSystemService()</code>  <code><a href="http://developer.android.com/intl/zh-TW/reference/android/content/Context.html"></a> getSystemService()</code> : <br><blockquote> <code><font color="black">final NotificationManager mgr = (NotificationManager) getSystemService(NOTIFICATION_SERVICE);</font></code> </blockquote> <br><br>  Now you need to create an alert itself ( <code><a href="http://developer.android.com/intl/zh-TW/reference/android/app/Notification.html"></a> Notification</code>  <code><a href="http://developer.android.com/intl/zh-TW/reference/android/app/Notification.html"></a> Notification</code> ): <br><blockquote> <code><font color="black">Notification note = <font color="#0000ff">new</font> Notification(R.drawable.status, <br> getResources().getString(R. <font color="#0000ff">string</font> .startMessage), <br> System.currentTimeMillis()); <br> note.flags |= Notification.FLAG_ONGOING_EVENT; <br> PendingIntent i = PendingIntent.getActivity( <font color="#0000ff">this</font> , 0, <br> <font color="#0000ff">new</font> Intent( <font color="#0000ff">this</font> , Setup. <font color="#0000ff">class</font> ), 0); <br> <font color="#2B91AF">String</font> interval = <font color="#2B91AF">String</font> .format( <font color="#A31515">"%d:%02d ‚Äì %d:%02d"</font> , startHour, <br> startMinute, endHour, endMinute);</font> <br> <font color="black">note.setLatestEventInfo( <font color="#0000ff">this</font> , interval, <br> getResources().getString(R. <font color="#0000ff">string</font> .notificationMessage), i);</font></code> </blockquote> <br>  Here, <code>PendingIntent</code> is a link to the application that will be launched after clicking on the notification.  BUT <code><a href="http://developer.android.com/intl/zh-TW/reference/android/app/Notification.html"></a> Notification.FLAG_ONGOING_EVENT</code>  <code><a href="http://developer.android.com/intl/zh-TW/reference/android/app/Notification.html"></a> Notification.FLAG_ONGOING_EVENT</code> sets the second alert type. <br><br>  To send an alert, use the method <code><a href="http://developer.android.com/intl/zh-TW/reference/android/app/NotificationManager.html"></a> notify()</code>  <code><a href="http://developer.android.com/intl/zh-TW/reference/android/app/NotificationManager.html"></a> notify()</code> : <br><blockquote> <code><font color="black">mgr.notify(NOTIFY_ME_ID, note);</font></code> </blockquote> <br>  In order to remove the alert from the status bar, call the method <code><a href="http://developer.android.com/intl/zh-TW/reference/android/app/NotificationManager.html"></a> cancel()</code>  <code><a href="http://developer.android.com/intl/zh-TW/reference/android/app/NotificationManager.html"></a> cancel()</code> : <br><blockquote> <code><font color="black">mgr.cancel(NOTIFY_ME_ID);</font></code> </blockquote> <br><br><h4>  Mute </h4><br>  In order to turn off or turn on the sound, you need to get <code><a href="http://developer.android.com/intl/zh-TW/reference/android/media/AudioManager.html"></a> AudioManager</code>  <code><a href="http://developer.android.com/intl/zh-TW/reference/android/media/AudioManager.html"></a> AudioManager</code> : <br><blockquote> <code><font color="black">AudioManager manager = (AudioManager) getSystemService(Context.AUDIO_SERVICE);</font></code> </blockquote> <br>  And set the appropriate mode using <code><a href="http://developer.android.com/intl/zh-TW/reference/android/media/AudioManager.html"></a> setRingerMode()</code>  <code><a href="http://developer.android.com/intl/zh-TW/reference/android/media/AudioManager.html"></a> setRingerMode()</code> : <br><blockquote> <code><font color="black">manager.setRingerMode(AudioManager.RINGER_MODE_SILENT);</font></code> </blockquote> <br><br><h4>  Final assembly of the application </h4><br>  In order to assemble an application into a working apk-container, you need to select a project, run the export wizard located in <i>Android Tools</i> from the context menu and do everything that it asks: <br><img src="http://i.product-studio.ru/2009/12/goodnight/publish.png" alt="image"><br><img src="http://i.product-studio.ru/2009/12/goodnight/publish2.png" alt="image"><br>  Read more about this in the <a href="http://developer.android.com/intl/zh-TW/guide/publishing/app-signing.html"><i>Publishing</i></a> section. <br><br><h4>  Micro conclusion </h4><br>  Writing Android apps is not as easy as Chrome extensions.  Nevertheless, there is nothing supernatural in this.  :-) The main thing to start. <br><br><h4>  Link to the application </h4><br>  Bonus for those who read: <br> <a href=""><img src="http://i.product-studio.ru/2009/12/goodnight/qrcode.png" alt="image"></a> <br>  <a href="">http://x.product-studio.ru/Goodnight.apk</a> <br><br>  I will be glad to hear criticism, suggestions and questions. </div><p>Source: <a href="https://habr.com/ru/post/79575/">https://habr.com/ru/post/79575/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../79566/index.html">New Ion Wexler. Autopsy</a></li>
<li><a href="../79567/index.html">Cipher - a magic glass from designer Damyan Stankovich</a></li>
<li><a href="../79569/index.html">MyShows.ru - TV shows that I watch</a></li>
<li><a href="../79570/index.html">OCZ Vertex Turbo 128GB</a></li>
<li><a href="../79571/index.html">"Ruble" on the crisis</a></li>
<li><a href="../79576/index.html">Original New Year special effect for sites</a></li>
<li><a href="../79577/index.html">Sovok Ozon, or how not to do online shopping</a></li>
<li><a href="../79578/index.html">Domain and hosting site for students almost for nothing</a></li>
<li><a href="../79581/index.html">The principle of transparency or web 2.0 against corruption</a></li>
<li><a href="../79582/index.html">Hollywood and IT</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>