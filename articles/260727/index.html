<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Replacing HDD on NetUP tape drive and installing firmware</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prehistory 
 Recently, one of the NetUP streamers stopped broadcasting. "Hangs," I thought (they have such a "feature"), and went to reboot it. Since ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Replacing HDD on NetUP tape drive and installing firmware</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/4ab/a80/944/4aba80944bc54b81ae5c4fdefcc16685.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a26/f60/141/a26f6014142d4c0d8c66be9a8bbd73b3.jpg"></div><br><br><h4>  Prehistory </h4><br>  Recently, one of the NetUP streamers stopped broadcasting.  "Hangs," I thought (they have such a "feature"), and went to reboot it.  Since  these streamers do not have a power on-off button or a reset button; they are reset only by pulling out the power cord. <br><br>  Some time later, after I returned the power to him, the streamer displayed an inscription on the LCD panel: ‚ÄúChecking HDD filesystem ...‚Äù.  Left it in this state with the thought that it will check the disk and start.  However, this did not happen an hour or two later.  On the tape drive continued to show the inscription about checking HDD.  It was not possible to connect via the console cable.  Also, no subsequent reloads led to anything.  I decided to get the hard drive and check it on the bad block.  There was not a small number of sectors for which Remap or Erase could not be made. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The conclusion is simple: you need to change the hard drive.  There are no problems with the replacement itself, I did not pull out the worker, I installed the worker.  But now we have a bare piece of hardware without an OS (firmware). <br><br>  How to install the firmware from scratch and will continue the story. <br><a name="habracut"></a><br><h4>  Vyrianty </h4><br>  Personally, I see only the 3rd option how to do it: <br><ol><li>  Contact NETUP technical support </li><li>  Clone HDD from another tape drive </li><li>  Deal with the firmware, what it is, and how to install it </li></ol><br>  The first option is suitable for those who bought this product less than a year ago, because  technical support is provided within a year after purchase.  And also to those who pay technical support NetUP.  This option does not suit me, because  I bought more than a year ago, but I don‚Äôt see any reason to pay a year of technical support for an hour of work. <br><br>  The second option is quite acceptable.  It is only necessary to redeem one of the working streamers, to clone its disk with some program.  But I did not want to dismantle another streamer from the rack, and secondly, I did not want to stop broadcasting other channels (subscribers do not like it). <br><br>  The third option suited me perfectly for all the above enumerated criteria.  Plus, it's just interesting and informative. <br><br><h4>  Training </h4><br>  To make the tape drive work, we need: <br><ol><li>  USB flash drive </li><li>  Console cable </li><li>  Router </li><li>  Firmware image </li><li>  LiveFlash image </li></ol><br>  Now for each item separately. <br><br>  USB flash drive fits any size, starting from 128 MB, because  LiveFlash image, takes about 100 MB. <br><br>  Console cable for connecting to a tape drive and changing BIOS settings.  There is no video output on the tape drive. <br><br>  The streamer needs to be connected to the router so that after booting from the USB flash drive you can connect to it via SSH for further work. <br><br>  The firmware image is downloaded from the site netup.tv, section ‚ÄúMy Account&gt; Files&gt; Stable Version‚Äù.  I used firmware-streamer-standalone.1.11.117. <br><br>  LiveFlash image is also from the site.  Section "My Account&gt; Files&gt; Public Files."  There are two images, LiveFlash and LiveCD, but the drive does not have a CD drive.  In general, I think any Linux distribution kit that can boot from a flash drive will do.  In the image from NetUP, I did not see anything special that would not be in other distributions.  But I used it. <br><br><h4>  Let's start </h4><br><h5>  Firmware </h5><br>  As it turned out, the firmware image is a tar.gz archive.  Therefore, unpack the archive. <br><br><pre><code class="bash hljs">tar -xvf firmware-streamer-standalone.1.11.117</code> </pre> <br>  There are four files in the archive: filesystem, info, initrd.img and vmlinuz. <br><br>  The filesystem is, as the name suggests, a file system image packaged in Squashfs. <br><br>  info - this contains information about the firmware: checksums, version, revision, type and date of creation. <br><br>  initrd.img and vmlinuz are a ramdisk and a kernel. <br><br>  All these files will be needed later. <br><br><h5>  Liveflash </h5><br>  It's simple.  We write down the downloaded image on the USB flash drive.  I did it through dd: <br><br><pre> <code class="bash hljs">dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=liveflash.img of=/dev/sdb bs=1M</code> </pre> <br><h5>  Loading </h5><br>  You need to connect the console cable, patch cord to the router, insert the USB flash drive into the tape drive and run it. <br><br>  Now you need to do something that is not in the documentation.  We need to boot from USB Flash, for it is in the BIOS you need to specify it first in the boot queue.  To see the download process and at the right time, press the "Del" key, connect via a console cable to the tape drive.  This can be done via HyperTerminal, putty, etc.  I personally used minicom.  In the connection parameters, in addition to the COM port number, you must specify the speed / parity / bits 115200 8N1, as well as disable hardware and software flow control.  It‚Äôs not in the documentation, or rather there is a console cable connection at a speed of 19200 8N1, but with such settings, the POST message port and the BIOS itself will not be seen.  So you can connect only to a working tape drive, for example, if it does not have a network connection for SSH access. <br><br>  After we got into the BIOS and set to boot from USB Flash, we exit the BIOS and save the settings.  F4, if I'm not mistaken, or through the menu item "Save &amp; Exit".  Now the tape will be loaded from a flash drive.  But there is one caveat: the fact is that the ‚ÄúBoot from local harddrive‚Äù option is selected by default on the LiveFlash loader menu, which of course does not suit us, because  our disk is still empty.  With a serial port speed of 115200, the bootloader menu is not visible.  Therefore, immediately after the tape drive has gone into reboot, we change the speed to 19200 and see the flash drive bootloader.  Select the topmost item ‚ÄúBoot LiveFlash‚Äù and press ‚ÄúEnter‚Äù. <br><br>  After the streamer has booted from LiveFlash, you need to go to the router's WEB interface and see what IP address it received.  Next, using any SSH client, connect to the tape drive with <b>root</b> username and password <b>netup123</b> . <br><br><h5>  Disk </h5><br>  Here we are connected to our streamer via SSH, or rather, to the Live system, which is running on our tape drive. <br><br>  The first thing we need to do is to partition the hard disk into sections, format and mount them into the necessary directories. <br><br>  Split as follows: the first partition is 5 GB., The second is everything else (to be honest, it remains a mystery to me, for which NetUP uses 1 TB disks if a maximum of 15 GB of disk space is used).  You can partition into sections using the fdisk utility that is present in the system. <br><br><pre> <code class="bash hljs">fdisk /dev/sda</code> </pre> <br>  It is quite simple to use fdisk, here I will not describe this, since  this is beyond the scope of the article. <br><br>  Once the partitions are created and the new partition table is written to disk, they need to be formatted: <br><br><pre> <code class="bash hljs">mkfs.ext3 /dev/sda1 mkfs.ext3 /dev/sda2</code> </pre> <br>  Now we mount: <br><br><pre> <code class="bash hljs">mount /dev/sda1 /mnt/flash mount /dev/sda2 /mnt/hdd</code> </pre> <br>  Everything, we are ready to start installing the firmware on these disks. <br><br><h5>  Loader </h5><br>  GRUB is used on tape drives.  You need to install it with the option --root-directory = / mnt / flash, since  It is necessary that the / boot directory and bootloader configuration files be on sda1: <br><br><pre> <code class="bash hljs">grub-install --root-directory=/mnt/flash /dev/sda</code> </pre> <br>  The boot loader is installed, then you need to create a menu.lst file in the / mnt / flash / boot / grub directory, which specifies the kernel boot options.  Full file content: <br><br><div class="spoiler">  <b class="spoiler_title">menu.lst</b> <div class="spoiler_text">  default 0 <br>  timeout 3 <br><br>  NetUP IPTV title <br>  root (hd0,0) <br>  kernel / boot / vmlinuz root = / dev / ram0 selinux = 0 init = / linuxrc vmalloc = 256m ro netup_flash = sda1 netup_hdd = sda2 <br>  initrd /boot/initrd.img <br><br>  title recovery <br>  root (hd0,0) <br>  kernel / boot / vmlinuz root = / dev / ram0 selinux = 0 init = / recovery ro <br>  initrd /boot/initrd.img <br></div></div><br><h5>  Firmware files </h5><br>  Files files and info files previously extracted from the firmware should be uploaded to the tape drive in the / mnt / flash directory.  And the vmlinuz and initrd.img files in / mnt / flash / boot.  For this you can use scp for example, personally I used SFTP in Midnight Commander. <br><br><h5>  Semi final </h5><br>  Actually, this is all.  You can type "reboot" in the console of the tape drive, remove the flash drive and wait for our tape drive to load.  It will unpack the file system, create a swap file for itself, etc.  This will be the standard firmware, with standard settings.  If you want to change the default settings, then I will tell you how to do this. <br><br><h5>  Settings </h5><br>  There are not so many settings: <br><ol><li>  Interface IP addresses </li><li>  Routing </li><li>  Password </li><li>  Timezone </li></ol><br>  The firmware uses Aufs, so in order to force the firmware to apply our settings, it is enough to create the appropriate configuration files that will ‚Äúoverlap‚Äù the standard configuration files. <br><br>  Create a directory in which we place our configuration files: <br><br><pre> <code class="bash hljs">mkdir /mnt/hdd/netup/sysconfig</code> </pre> <br><br><h6>  Interface IP addresses </h6><br>  File network.cfg.  Record in it looks like: <br><br><div class="spoiler">  <b class="spoiler_title">network.cfg</b> <div class="spoiler_text">  eth0 10.4.4.176 255.255.255.0 main <br>  eth3 172.16.0.9 255.255.255.0 <br></div></div><br>  You can immediately register the addresses that are used on the tape drive, so that later you don‚Äôt have to enter the tape drive under standard addresses. <br><br><h6>  Routing </h6><br>  Routes.cfg file  It looks like: <br><br><div class="spoiler">  <b class="spoiler_title">routes.cfg</b> <div class="spoiler_text">  route add -net "0.0.0.0" gw "172.16.0.1" netmask "0.0.0.0" dev "eth3" <br></div></div><br>  You can also register several routes, one in each line. <br><br><h6>  Password </h6><br>  The password.cfg file.  A password is written here that will be used for access via WEB, SSH and FTP.  The password is recorded in clear text. <br><br><h6>  Timezone </h6><br>  Timezone file  Record example: <br><br><div class="spoiler">  <b class="spoiler_title">timezone</b> <div class="spoiler_text">  Asia / Krasnoyarsk <br></div></div><br><h4>  Total </h4><br>  That's all.  As you can see, there is nothing difficult in installing the firmware on a ‚Äúbare‚Äù streamer.  It takes very little time, and if you do this through technical support, it will take half a day of talks in the hotline. <br><br>  So, it's very interesting to do it yourself, quickly and, not least, free of charge. </div><p>Source: <a href="https://habr.com/ru/post/260727/">https://habr.com/ru/post/260727/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../260715/index.html">How to use Canvas to compile a clickable world map on Unity3d</a></li>
<li><a href="../260717/index.html">Quick Start Template for Arduino Due at QtCreator</a></li>
<li><a href="../260719/index.html">AJAX and performance</a></li>
<li><a href="../260721/index.html">Transceiver Signal Level via SNMP in Cisco</a></li>
<li><a href="../260723/index.html">Fix Alt-Tab in LabView</a></li>
<li><a href="../260733/index.html">The future of electronic signature</a></li>
<li><a href="../260735/index.html">Go as a language for learning programming</a></li>
<li><a href="../260737/index.html">Thunderstorm, lightning, and means of protection of the power grid on its own</a></li>
<li><a href="../260739/index.html">Sencha: About licenses and restrictions</a></li>
<li><a href="../260741/index.html">Getting started with OpenCV and its use in C #</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>