<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pornhub bypasses ad blockers with webocards</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="An engineer from BugReplay found a great way to demonstrate how his screencast service works with recording network traffic and demonstrating errors, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pornhub bypasses ad blockers with webocards</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/f75/4ab/3aa/f754ab3aae4d4bdab0c40bc5fcf81e4d.jpg"><br><br>  An engineer from <a href="https://www.bugreplay.com/">BugReplay</a> found a great way to demonstrate how his screencast service works with recording network traffic and demonstrating errors, including WebSockets and JavaScript.  He recorded a <a href="https://app.bugreplay.com/shared/report/938a04d2-546c-42e9-87d2-ec4f0f7a792f">Pornhub screencast</a> with a traffic log that is synchronized with the video.  So, on this demonstration you can clearly see how Pornhub bypasses ad blockers and pushes advertisements with the help of web sockets. <br><a name="habracut"></a><br>  Pornhub works very well.  When you enter the site, it checks for the presence of a blocker.  If such is found, the site opens a new WebSocket connection, which acts as a <i>backup mechanism for advertising delivery</i> . <br><br>  On the <a href="https://app.bugreplay.com/shared/report/938a04d2-546c-42e9-87d2-ec4f0f7a792f">screencast with the network log</a> you can see a lot of requests that were blocked by uBlock Origin.  They are marked as <b>Failed</b> in network traffic. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs sql">http://cdn1b.static.pornhub.phncdn.com/www-static/js/ph-tracking.js?<span class="hljs-keyword"><span class="hljs-keyword">cache</span></span>=<span class="hljs-number"><span class="hljs-number">2016102525</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Failed</span></span> https://media.trafficjunky.net/js/holiday-promo.js <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Failed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">http</span></span>://www.google-analytics.com/analytics.js <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Failed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">http</span></span>://ss.phncdn.com/iframe<span class="hljs-number"><span class="hljs-number">-1.1</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>.html <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Failed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">http</span></span>://ss.phncdn.com/iframe<span class="hljs-number"><span class="hljs-number">-1.1</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>.html <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Failed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">http</span></span>://engine.phn.doublepimp.com/Tag.engine?<span class="hljs-built_in"><span class="hljs-built_in">time</span></span>=<span class="hljs-number"><span class="hljs-number">240</span></span>&amp;<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>=<span class="hljs-number"><span class="hljs-number">7129</span></span>f320-ce21<span class="hljs-number"><span class="hljs-number">-4</span></span>b40<span class="hljs-number"><span class="hljs-number">-9</span></span>d7e<span class="hljs-number"><span class="hljs-number">-37</span></span>b1df8cf8f0&amp;<span class="hljs-keyword"><span class="hljs-keyword">rand</span></span>=<span class="hljs-number"><span class="hljs-number">25334</span></span>&amp;ver=async&amp;referrerUrl=&amp;fingerPrint=<span class="hljs-number"><span class="hljs-number">123</span></span>&amp;abr=<span class="hljs-literal"><span class="hljs-literal">false</span></span>&amp;stdTime=<span class="hljs-number"><span class="hljs-number">-300</span></span>&amp;fpe=<span class="hljs-number"><span class="hljs-number">3</span></span>&amp;bw=<span class="hljs-number"><span class="hljs-number">1262</span></span>&amp;bh=<span class="hljs-number"><span class="hljs-number">636</span></span>&amp;res=<span class="hljs-number"><span class="hljs-number">1280</span></span>x800 <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Failed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">http</span></span>://electosake.com/<span class="hljs-number"><span class="hljs-number">240</span></span>/<span class="hljs-number"><span class="hljs-number">7129</span></span>f320-ce21<span class="hljs-number"><span class="hljs-number">-4</span></span>b40<span class="hljs-number"><span class="hljs-number">-9</span></span>d7e<span class="hljs-number"><span class="hljs-number">-37</span></span>b1df8cf8f0/<span class="hljs-number"><span class="hljs-number">82615</span></span>/asynch/<span class="hljs-literal"><span class="hljs-literal">null</span></span>/<span class="hljs-number"><span class="hljs-number">123</span></span>/<span class="hljs-literal"><span class="hljs-literal">null</span></span>/<span class="hljs-literal"><span class="hljs-literal">true</span></span>/<span class="hljs-number"><span class="hljs-number">-300</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span>/<span class="hljs-number"><span class="hljs-number">1262</span></span>/<span class="hljs-number"><span class="hljs-number">636</span></span>/Tag.a1b <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Failed</span></span> https://www.etahub.com/trackn?app_id=<span class="hljs-number"><span class="hljs-number">971</span></span>&amp;product_name=<span class="hljs-number"><span class="hljs-number">2</span></span>&amp;<span class="hljs-keyword"><span class="hljs-keyword">category</span></span>=connectTime&amp;<span class="hljs-keyword"><span class="hljs-keyword">action</span></span>=other&amp;label=&amp;<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>=<span class="hljs-number"><span class="hljs-number">116</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Failed</span></span> https://www.etahub.com/trackn?app_id=<span class="hljs-number"><span class="hljs-number">971</span></span>&amp;product_name=<span class="hljs-number"><span class="hljs-number">2</span></span>&amp;<span class="hljs-keyword"><span class="hljs-keyword">category</span></span>=ttfb&amp;<span class="hljs-keyword"><span class="hljs-keyword">action</span></span>=other&amp;label=&amp;<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>=<span class="hljs-number"><span class="hljs-number">799</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Failed</span></span> https://www.etahub.com/trackn?app_id=<span class="hljs-number"><span class="hljs-number">971</span></span>&amp;product_name=<span class="hljs-number"><span class="hljs-number">2</span></span>&amp;<span class="hljs-keyword"><span class="hljs-keyword">category</span></span>=redirectTime&amp;<span class="hljs-keyword"><span class="hljs-keyword">action</span></span>=other&amp;label=&amp;<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Failed</span></span> https://www.etahub.com/trackn?app_id=<span class="hljs-number"><span class="hljs-number">971</span></span>&amp;product_name=<span class="hljs-number"><span class="hljs-number">2</span></span>&amp;<span class="hljs-keyword"><span class="hljs-keyword">category</span></span>=domInteractive&amp;<span class="hljs-keyword"><span class="hljs-keyword">action</span></span>=other&amp;label=&amp;<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>=<span class="hljs-number"><span class="hljs-number">1659</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Failed</span></span> https://www.etahub.com/trackn?app_id=<span class="hljs-number"><span class="hljs-number">971</span></span>&amp;product_name=<span class="hljs-number"><span class="hljs-number">2</span></span>&amp;<span class="hljs-keyword"><span class="hljs-keyword">category</span></span>=domComplete&amp;<span class="hljs-keyword"><span class="hljs-keyword">action</span></span>=other&amp;label=&amp;<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>=<span class="hljs-number"><span class="hljs-number">1829</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Failed</span></span> https://www.etahub.com/trackn?app_id=<span class="hljs-number"><span class="hljs-number">971</span></span>&amp;product_name=<span class="hljs-number"><span class="hljs-number">2</span></span>&amp;<span class="hljs-keyword"><span class="hljs-keyword">category</span></span>=domContentLoadedEventEnd&amp;<span class="hljs-keyword"><span class="hljs-keyword">action</span></span>=other&amp;label=&amp;<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>=<span class="hljs-number"><span class="hljs-number">1710</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Failed</span></span> https://www.etahub.com/trackn?app_id=<span class="hljs-number"><span class="hljs-number">971</span></span>&amp;product_name=<span class="hljs-number"><span class="hljs-number">2</span></span>&amp;<span class="hljs-keyword"><span class="hljs-keyword">category</span></span>=loadEventEnd&amp;<span class="hljs-keyword"><span class="hljs-keyword">action</span></span>=other&amp;label=&amp;<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>=<span class="hljs-number"><span class="hljs-number">1850</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Failed</span></span></code> </pre> <br>  Clicking on the query displays the details.  Reason for blocking: <code>net::ERR_BLOCKED_BY_CLIENT</code> .  This error occurs <a href="http://stackoverflow.com/questions/23341765/getting-neterr-blocked-by-client-error-on-some-ajax-calls">when the ad blocker in the browser</a> blocks some Ajax calls (at least in Chrome, this is how it works). <br><br>  Immediately after the error message in the log, we see a <a href="https://app.bugreplay.com/shared/report/938a04d2-546c-42e9-87d2-ec4f0f7a792f">request to create a web socket and frames</a> , to which a positive response was received. <br><br><pre> <code class="hljs ruby"><span class="hljs-symbol"><span class="hljs-symbol">ws:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/ws.adspayformy.site./nsoj</span></span> webSocketCreate <span class="hljs-symbol"><span class="hljs-symbol">ws:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/ws.adspayformy.site./nsoj</span></span> webSocketFrameSent <span class="hljs-symbol"><span class="hljs-symbol">ws:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/ws.adspayformy.site./nsoj</span></span> webSocketFrameReceived</code> </pre> <br>  As if apologizing to users, Pornhub uses the domain adspayformy.site to create the webbox.  The joke is clearly aimed at those who use ad blockers. <br><br>  After downloading the webbox, a frame is created <a href="https://app.bugreplay.com/shared/report/938a04d2-546c-42e9-87d2-ec4f0f7a792f">where the encoded JSON content is loaded</a> for each place on the page where the advertising banner should be. <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"zone_id"</span></span>: <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-attr"><span class="hljs-attr">"link"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://cp.pleasedontslaymy.download/_z/eyJj...In19"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"media_type"</span></span>: <span class="hljs-string"><span class="hljs-string">"image"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"media_encoding"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"img_data"</span></span>: <span class="hljs-string"><span class="hljs-string">"/9j/4QA.....Wh+n//2Q=="</span></span>, <span class="hljs-attr"><span class="hljs-attr">"img_type"</span></span>: <span class="hljs-string"><span class="hljs-string">"image/jpeg"</span></span> }</code> </pre> <br>  In this case, <code>zone_id</code> 32 is indicated, which indicates the place for the introduction of advertising.  Usually a video is inserted there, but in this example it is a graphic banner, which is indicated in <code>media_type</code> .  Content is encoded in base64 and restored in the browser in accordance with the <a href="https://ru.wikipedia.org/wiki/Data:_URL">data: URL</a> (or data: URI) scheme, which is supported by almost all modern browsers.  On and then data marked as <code>image/jpeg</code> transferred to this scheme. <br><br>  Advertising blockers usually track web sockets, so coding data in base64 is also a smart move. <br><br>  Of course, after disclosing dirty Pornhub methods, music will not play for a long time.  Already on October 25, one of the developers in the Chromium community under the nickname pkalinnikov <a href="https://bugs.chromium.org/p/chromium/issues/detail%3Fid%3D129353">suggested a patch</a> , with the help of which the browser will be able to block web-sites through the <a href="https://bugs.chromium.org/p/chromium/issues/detail%3Fid%3D129353">webRequest API</a> .  If the patch is accepted, ad blockers will be able to safely implement the normal way of blocking such hacks in Chrome, but Pornhub owners will have to look for new tricks in the eternal struggle with blockers, which <a href="https://geektimes.ru/post/267536/">will never stop</a> . <br><br>  After the release of the <a href="http://blog.bugreplay.com/post/152579164219/pornhubdodgesadblockersusingwebsockets">publication</a> from the developer BugReplay, it turned out that some ad blockers had learned how to block web sockets like those used by Pornhub.  At least, the web socket will not pass through uBlock Origin (the <a href="https://github.com/gorhill/uBlock/issues/1936">corresponding ticket</a> ) and AdBlock Plus (the <a href="https://issues.adblockplus.org/ticket/1727">ticket</a> ).  But the AdBlock blocker and some others have not yet been updated. <br><br>  The history of the Chrome webRequest API ‚Äúbug‚Äù that does not allow intercepting WebSocket requests ( <a href="https://bugs.chromium.org/p/chromium/issues/detail%3Fid%3D129353">ticket 129353</a> ) is very interesting.  This ticket was opened in May 2012.  And still remains open.  The discussion went on for a very long time.  Users complained in the discussion that due to the inability to block web-sites, sites can relatively easily bypass ad blockers.  After all, if the blocker does not track web sockets through standard APIs, then to block such advertisements you need to look for very difficult workarounds.  At first it was a purely theoretical problem.  It seems that in 2012 not a single site used such methods to bypass advertising blockers, and the blockers themselves were not as popular at that time as they are now. <br><br>  The situation changed in 2015 and 2016.  Now Pornhub is not the only site that has thought of such a hack.  What is most interesting in discussing the ticket in Chromium in August 2016 <a href="https://bugs.chromium.org/p/chromium/issues/detail%3Fid%3D129353">was one of the developers</a> .  He convincingly explained that ad blockers are trying to rewrite the contents of web sockets - and this really threatens the security of users, because it breaks down the basic Javascript functionality.  That is, to introduce this patch is to sacrifice security.  All anything, but this <a href="https://bugs.chromium.org/u/3552224858/">routeh</a> developer <a href="https://bugs.chromium.org/u/3552224858/">... @ gmail.com</a> works for MindGeek, which owns both the Pornhub website and the By Traffic Junky advertising network, which delivers advertising there.  By the way, similar tricks for circumventing ad blockers work not only on Pornhub, but also on other MindGeek websites. <br><br>  It seems that quite advanced programmers are working in porn companies.  As is known from history, it is the porn industry that has often moved technological progress forward.  It turns out that now they are ahead of everyone else in something.  At least in the most innovative ways to bypass ad blockers.  However, in the same discussion in the tracker Chomium <a href="https://bugs.chromium.org/p/chromium/issues/detail%3Fid%3D129353">reported</a> that the trick with the web socket and use some other advertising networks, mentioned some network RevDefender. <br><br>  We wish good luck to comrade <a href="https://bugs.chromium.org/u/2917096638/">pkalinnikov</a> that his <a href="https://codereview.chromium.org/2449913002/">patch be</a> accepted into the Chromium code base.  Apparently, this is one of the leading developers of Chromium, so we rely on its authority. </div><p>Source: <a href="https://habr.com/ru/post/314354/">https://habr.com/ru/post/314354/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../314344/index.html">7 server security measures</a></li>
<li><a href="../314346/index.html">The complexity of load testing - an interview with Vladimir Sitnikov (Netcracker) and Andrey Dmitriev</a></li>
<li><a href="../314348/index.html">IT for the investment ecosystem</a></li>
<li><a href="../314350/index.html">We write server-assistant for BaaS or ‚ÄúWell, why do I need Firebase then?‚Äù</a></li>
<li><a href="../314352/index.html">Data Leaks in 2016 - Preliminary Results of the Year</a></li>
<li><a href="../314356/index.html">Missionary Interfaces</a></li>
<li><a href="../314358/index.html">Mail.ru Group bought the Delivery Club food delivery service for $ 100 million</a></li>
<li><a href="../314360/index.html">What are professionals talking about? Based on a round table on analyzing gaming projects as part of White Nights Moscow</a></li>
<li><a href="../314362/index.html">Founder's advice. Ilya Ekushevsky - about Busfor online transport service</a></li>
<li><a href="../314364/index.html">How to make friends PCIe with 10-meter copper cables and 100-meter optics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>