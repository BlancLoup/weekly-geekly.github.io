<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Analog ip unnumbered in Mikrotik RouterOS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At once I will say that I was inspired to write the post by a similar article published on Habr√© back in 2009. Therefore, I will not retell its conten...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Analog ip unnumbered in Mikrotik RouterOS</h1><div class="post__text post__text-html js-mediator-article"> At once I will say that I was inspired to write the post by a similar article <a href="http://habrahabr.ru/post/71689/">published</a> on Habr√© back in 2009.  Therefore, I will not retell its contents and present the configuration of Cisco devices. <br><br>  Today, when IPv4-addresses have become even more deficient than the Moskvich car in Soviet times, it‚Äôs a crime to give a client a / 30 or / 31 network.  In Cisco, to circumvent these problems, there is an ‚Äúip unnumbered‚Äù mode that allows you to assign a single address to a client without wasting addresses.  Let's see how this is done in Mikrotik RouterOS.  Imagine this (strongly simplified) scheme: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c5c/7ca/766/c5c7ca766262fc54af7fe650134214a3.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Our gateway (provider-gw) is connected via ether1 to the Internet via BGP (or in another way, it does not matter) and we have our own ‚Äúlarge‚Äù public network, for example - 123.45.60.0/22.  The first client is connected to the VLAN-interface vlan100, which, let's say, is connected to ether2.  The second is for vlan200. <br><a name="habracut"></a><br> <code>/interface vlan add disabled=no name=vlan100 vlan-id=100 interface=ether2 comment="Client 1"</code> <br> <code>/interface vlan add disabled=no name=vlan200 vlan-id=200 interface=ether2 comment="Client 2"</code> <br> <br>  The router must have an IP address from our public network.  Suppose 123.45.60.1 with a mask / 22.  This address must be assigned to any free interface or vlan, even if they will not be used later.  Let it be vlan1000: <br><br> <code>/interface vlan add disabled=no name=vlan1000 vlan-id=1000 interface=ether2</code> <br> <code>/ip address add interface=vlan1000 address=123.45.60.1/22</code> <br> <br>  Now we will make the settings on the router for our clients.  To do this, we will allocate to them any free IP from the range of our public network, say, 123.45.60.5 and 123.45.60.6.  Add static routes for these addresses leading to the corresponding client VLANs.  It is desirable to specify the preffered source address of our router. <br><br> <code>/ip route add dst-address=123.45.60.5 gateway=vlan100 pref-src=123.45.60.1 comment="Static route to Client 1"</code> <br> <code>/ip route add dst-address=123.45.60.6 gateway=vlan200 pref-src=123.45.60.1 comment="Static route to Client 2"</code> <br> <br>  Customize client number 1: <br>  IP: 123.45.60.5 <br>  Mask: 255.255.255.252 (or / 22; yes, here we indicate the mask of our ‚Äúbig‚Äù public network) <br>  Gateway: 123.45.60.1 <br><br>  We configure client number 2 in the same way.  Only the IP address changes. <br>  IP: 123.45.60.6 <br>  Mask: 255.255.255.252 (or / 22) <br>  Gateway: 123.45.60.1 <br><br>  Everything.  It's enough.  After that, IP clients will be accessible from the Internet, without waste of addresses.  Other clients are included in a similar way, each in their own VLAN.  But in this case, we have this situation: for example, client number 1 wants to send an ip package to client number 2.  Since client's address # 2 falls under the network mask / 22, client # 1 considers that # 2 is in the same broadcast domain with it and tries to send a packet not through a router, but directly, for which it will try to find out its MAC address using ARP.  Of course, it will not work with him, because the clients are in different VLANs and cannot send ARP requests to each other. <br><br>  If you need to isolate clients from each other, you can leave everything as it is, although from the Internet point of view it is wrong (each node must have a connection to another node via IP).  This situation is solved by enabling proxy-arp on client VLANs: <br><br> <code>/interface vlan set vlan100 arp=proxy-arp</code> <br> <code>/interface vlan set vlan200 arp=proxy-arp</code> <br> <br>  Now the router will respond to arp requests from clients, substituting its MAC address in the response and clients will be able to exchange IP traffic as if they are in the same segment. <br><br>  As you might have guessed, similarly, you can assign several IP addresses or even subnets to one client VLAN simply by creating static routes with the corresponding dst-address. <br><br>  UPD: <br><br>  As practice has shown, it is much better to create non-static routes in / ip route, but simply add the IP address of the router to the interface with the desired IP address in the network field; the route will be created automatically.  Example: <br><br> <code>/ip address add network=123.45.60.5 interface=vlan100 address=123.45.60.1 comment="IPoE Client 1"</code> <br> <code>/ip address add network=123.45.60.6 interface=vlan100 address=123.45.60.1 comment="IPoE Client 2"</code> </div><p>Source: <a href="https://habr.com/ru/post/213037/">https://habr.com/ru/post/213037/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../213023/index.html">Developer Contest "Native Speech" - we begin the countdown!</a></li>
<li><a href="../213025/index.html">Germany and France do not want to pass European traffic through the US</a></li>
<li><a href="../213027/index.html">Ensure the reliable operation of Google Cloud Messaging</a></li>
<li><a href="../213033/index.html">The new interface Yandex.Metro and technology with which it works</a></li>
<li><a href="../213035/index.html">OpenStack needs more than one hat.</a></li>
<li><a href="../213039/index.html">Promotional website for a mobile application. Part 1</a></li>
<li><a href="../213041/index.html">Social behavior statistics on news sites: how can it help with traffic and monetization issues?</a></li>
<li><a href="../213043/index.html">One ring to rule all ... devices</a></li>
<li><a href="../213045/index.html">Webinar on Component Based Software Engineering Innopolis University</a></li>
<li><a href="../213047/index.html">We split Quark. Intel microarchitecture</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>