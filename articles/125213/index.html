<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Full Russification admin</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. The other day there was a task to Russify the django admin panel including the names of models, fields and applications. The main goal was to a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Full Russification admin</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/2581360c/6d4add47/78f9efbc/9d52ec54.jpg" align="right"><br>  Hello.  The other day there was a task to Russify the django admin panel including the names of models, fields and applications.  The main goal was to avoid modifying the django code.  Long googling did not give a holistic picture of this process.  Therefore, I decided to collect everything in one place. <br>  I‚Äôll say right away that at the very beginning of the project I installed <a href="https://bitbucket.org/izi/django-admin-tools/wiki/Home">django-admin-tools</a> and thereby saved myself a certain amount of nerve cells.  And all the manipulations were carried out over django 1.3. <br><a name="habracut"></a><br><br><h4>  Training </h4><br>  To begin with, we write in the configuration file <br><br><pre><code class="python hljs">LANGUAGE_CODE = <span class="hljs-string"><span class="hljs-string">'ru-RU'</span></span> USE_I18N = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Then create your own django-admin-tools dashboard classes.  To do this, execute the commands <br><br> <code>python manage.py custommenu</code> <br> <code>python manage.py customdashboard</code> <br> <br>  As a result of these commands, you will have two dashboard.py and menu.py files in the root directory of the project.  Next, in the project configuration file, you need to specify where the necessary classes are located.  To do this, we add to it the following lines <br><br><pre> <code class="python hljs">ADMIN_TOOLS_MENU = <span class="hljs-string"><span class="hljs-string">'myproject.menu.CustomMenu'</span></span> ADMIN_TOOLS_INDEX_DASHBOARD = <span class="hljs-string"><span class="hljs-string">'myproject.dashboard.CustomIndexDashboard'</span></span> ADMIN_TOOLS_APP_INDEX_DASHBOARD = <span class="hljs-string"><span class="hljs-string">'myproject.dashboard.CustomAppIndexDashboard'</span></span></code> </pre><br>  The path can be any.  The main thing that it was on the right classes <br><br>  For the translation we need the utility <a href="http://www.gnu.org/software/gettext">gettext</a> .  Its installation is different for different systems.  Therefore, we will not go into this process.  We will work with utf-8 encoding. <br>  Gettext uses for translation dictionaries with the extension .po, which translates into a binary format with the extension .mo.  In order to prepare them you need to create a folder locale in the root directory of the project or application.  It is the folder, not the python module.  That is, without the __init__.py file, otherwise there will be errors. <br>  Next you need to open the console and go to the directory in which you put the folder locale and execute the command <br><br> <code>python manage.py makemessages -l ru</code> <br> <br>  When executing this command, all files will be scanned for access to the dictionary and the django.po file compiled, which will appear in the folder locale / en / LC_MESSAGES.  You can execute this command regularly after adding new references to the dictionary in the code, or edit the django.po file with your hands. <br>  To make changes in the dictionary take effect, you need to execute the command <br><br> <code>python manage.py compilemessages</code> <br> <br>  after completion of which, django.mo appears next to the django.po file. <br><br><h4>  Translation of the application name </h4><br>  First of all, you need to force the admin panel to display the Russian name for the application name.  At one of the forums, it was advised to simply write the desired value in the app_label field of the Meta subclass in the model, but I refused this right away.  As the url of the application changes and problems start with syncdb.  The overlap of the title method in str did not help either, since the filter flew in and the admin-tools began to sculpt all the models in one box. <br>  I usually run the makemessages command while working on a project, which means we need a place where the dictionary reference will be indicated.  Simply put, I enter the following code in the __init__.py file of my application. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.utils.translation <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ugettext_lazy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> _ _(<span class="hljs-string"><span class="hljs-string">'Feedback'</span></span>)</code> </pre><br>  Here we import the ugettext_lazy module and make an appeal to the dictionary for translation.  If you then run the makemessages command again, the following lines will be added to the django.po file <br><br> <code>#: feedback/__init__.py:2 <br> msgid "Feedback" <br> msgstr "" <br></code> <br>  and we will be able to substitute your translation in msgstr.  In this case, "Feedback".  Now we need to make it so that when displaying the template the name of the application is taken from our dictionary.  To do this, first override the app_list.html template.  This template is used when displaying the AppList module. <br>  In our templates directory, we will create a specific directory structure and put the app_list.html file there so that we have a way <br><br> <code>templates/admin_tools/dashboard/modules/add_list.html <br></code> <br>  This file should have the same content as the <a href="https://bitbucket.org/izi/django-admin-tools/src/8bcc0fba2346/admin_tools/dashboard/templates/admin_tools/dashboard/modules/app_list.html">original app_list.html</a> .  Now change the code in line 5 to the following <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{ child.url }}"</span></span></span><span class="hljs-tag">&gt;</span></span>{% trans child.title %}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Thus, when displaying the name of the application in the general list, our value will be taken from the dictionary. <br>  In the general list, the name is displayed normally, but when we go into the application itself, the module header is still not translated.  In order to fix this, take a look at our dashboard.py file, which we created at the beginning, and find the class CustomAppIndexDashboard there.  He is responsible for the formation of the application page in the admin panel.  In his __init__ method, fix the code to get the following <br><br><pre> <code class="python hljs">self.children += [ modules.ModelList(_(self.app_title), self.models), <span class="hljs-comment"><span class="hljs-comment">#...     </span></span></code> </pre><br>  Here we wrapped the self.app_title function in the ugettext_lazy function and now the name will also be translated on the application page. <br>  Only bread crumbs remained.  It still displays the original name. <br>  The breadcrumbs module is used in a large number of templates, so for my thoughts I‚Äôve got to gut django.contrib.admin files.  The result of which was such a class.  It must be registered in the admin.py file of your application before registering admin modules.  Looking ahead, I‚Äôll say that here we also translate the page headers for viewing, editing and adding a model using the library, which I‚Äôll talk about below. <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.contrib <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> admin <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.utils.translation <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ugettext_lazy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.utils.text <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> capfirst <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.db.models.base <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ModelBase <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.conf <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> settings <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pymorphy <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> get_morph morph = get_morph(settings.PYMORPHY_DICTS[<span class="hljs-string"><span class="hljs-string">'ru'</span></span>][<span class="hljs-string"><span class="hljs-string">'dir'</span></span>]) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">I18nLabel</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, function)</span></span></span><span class="hljs-function">:</span></span> self.target = function self.app_label = <span class="hljs-string"><span class="hljs-string">u''</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rename</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, f, name = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">u''</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrapper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> extra_context = kwargs.get(<span class="hljs-string"><span class="hljs-string">'extra_context'</span></span>, {}) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">'delete_view'</span></span> != f.__name__: extra_context[<span class="hljs-string"><span class="hljs-string">'title'</span></span>] = self.get_title_by_name(f.__name__, args[<span class="hljs-number"><span class="hljs-number">1</span></span>], name) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: extra_context[<span class="hljs-string"><span class="hljs-string">'object_name'</span></span>] = morph.inflect_ru(name, <span class="hljs-string"><span class="hljs-string">u''</span></span>).lower() kwargs[<span class="hljs-string"><span class="hljs-string">'extra_context'</span></span>] = extra_context <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f(*args, **kwargs) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> wrapper <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_title_by_name</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, name, request={}, obj_name = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">u''</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">'add_view'</span></span> == name: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _(<span class="hljs-string"><span class="hljs-string">'Add %s'</span></span>) % morph.inflect_ru(obj_name, <span class="hljs-string"><span class="hljs-string">u','</span></span>).lower() <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> <span class="hljs-string"><span class="hljs-string">'change_view'</span></span> == name: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _(<span class="hljs-string"><span class="hljs-string">'Change %s'</span></span>) % morph.inflect_ru(obj_name, <span class="hljs-string"><span class="hljs-string">u','</span></span>).lower() <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> <span class="hljs-string"><span class="hljs-string">'changelist_view'</span></span> == name: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">'pop'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> request.GET: title = _(<span class="hljs-string"><span class="hljs-string">'Select %s'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: title = _(<span class="hljs-string"><span class="hljs-string">'Select %s to change'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> title % morph.inflect_ru(obj_name, <span class="hljs-string"><span class="hljs-string">u','</span></span>).lower() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrapper_register</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, model_or_iterable, admin_class=None, **option)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(model_or_iterable, ModelBase): model_or_iterable = [model_or_iterable] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> model <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> model_or_iterable: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> admin_class <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: admin_class = type(model.__name__+<span class="hljs-string"><span class="hljs-string">'Admin'</span></span>, (admin.ModelAdmin,), {}) self.app_label = model._meta.app_label current_name = model._meta.verbose_name.upper() admin_class.add_view = self.rename(admin_class.add_view, current_name) admin_class.change_view = self.rename(admin_class.change_view, current_name) admin_class.changelist_view = self.rename(admin_class.changelist_view, current_name) admin_class.delete_view = self.rename(admin_class.delete_view, current_name) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.target(model, admin_class, **option) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrapper_app_index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, request, app_label, extra_context=None)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> extra_context <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: extra_context = {} extra_context[<span class="hljs-string"><span class="hljs-string">'title'</span></span>] = _(<span class="hljs-string"><span class="hljs-string">'%s administration'</span></span>) % _(capfirst(app_label)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.target(request, app_label, extra_context) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">register</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.wrapper_register <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.wrapper_app_index admin.site.register = I18nLabel(admin.site.register).register() admin.site.app_index = I18nLabel(admin.site.app_index).index()</code> </pre><br>  With it, we replace the context for rendering the template with the function call ugettext_lazy.  So we translated the name of the application in breadcrumbs and the title of the page.  But that is not all.  To complete the picture, we need to reload another <a href="https://bitbucket.org/izi/django-admin-tools/src/8bcc0fba2346/admin_tools/dashboard/templates/admin/app_index.html">admin / app_index.html template.</a> And replace line 11 with <br><br><pre> <code class="python hljs">{% trans app.name %}</code> </pre><br>  It remains only to translate the application name in the drop-down menu.  To do this, simply reload the <a href="https://bitbucket.org/kmike/django-admin-tools/src/e898f9abf1c8/admin_tools/menu/templates/admin_tools/menu/item.html">admin_tools / menu / item.html template</a> and fix a couple of lines.  In the load block of the second line, add i18n, and at the end of the 5th line, instead of {{item.title}} we write {% trans item.title%}. <br>  Now all the names of our application will be displayed from the django.mo dictionary.  We can go further <br><br><h4>  Translation of the model name and fields </h4><br>  If the name of the application, we just need to display in translated form, then the name of the model would be good to display, taking into account the case, gender and number.  In search of a beautiful solution, I came across a magnificent <a href="http://pymorphy.readthedocs.org/en/latest/">kmike pymorphy</a> module, for which I thank him so much.  It is very easy to use and does its job perfectly!  In addition, for the admin we do not need great speed.  All we have to do is <a href="http://pymorphy.readthedocs.org/en/latest/intro.html">install the pymorphy module</a> and <a href="http://pymorphy.readthedocs.org/en/latest/usage/django.html">integrate it into django</a> <a href="http://pymorphy.readthedocs.org/en/latest/intro.html">following the</a> steps in the documentation. <br>  Now we need to redefine several templates in the admin panel and place pymorphy filters there, while all line breaks should remain in one place.  Namely, in the file django.po. <br>  Next, for example, we will Russify the Picture model so that it is displayed as a ‚ÄúPicture‚Äù.  The first thing to do in this model is <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Picture</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(models.Model)</span></span></span><span class="hljs-class">:</span></span> title = models.CharField(max_length=<span class="hljs-number"><span class="hljs-number">255</span></span>, verbose_name=_(<span class="hljs-string"><span class="hljs-string">'title'</span></span>)) ... <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> verbose_name = _(<span class="hljs-string"><span class="hljs-string">u'picture'</span></span>) verbose_name_plural = _(<span class="hljs-string"><span class="hljs-string">u'pictures'</span></span>)</code> </pre><br>  And add to the file django.po <br><br> <code>msgid "picture" <br> msgstr "" <br> <br> msgid "pictures" <br> msgstr "" <br> <br> msgid "title" <br> msgstr "" <br></code> <br>  Now it remains to be done so that the translated words are displayed taking into account the case and the number <br>  Let's start with the <a href="https://code.djangoproject.com/browser/django/trunk/django/contrib/admin/templates/admin/change_list.html">admin / change_list.html</a> template.  He is responsible for displaying a list of model elements.  To begin with, add the pymorphy_tags module to the load block.  For example, in line 2. To get <br><br> <code>{% load adminmedia admin_list i18n pymorphy_tags %}</code> <br> <br>  Next we find there line 64, which is responsible for the output of the add button <br><br> <code>{% blocktrans with cl.opts.verbose_name as name %}Add {{ name }}{% endblocktrans %}</code> <br>  and change it to <br> <code>{% blocktrans with cl.opts.verbose_name|inflect:"" as name %}Add {{ name }}{% endblocktrans %}</code> <br> <br>  Here we added the change of the model name to the accusative case.  And got the correct inscription "Add a picture."  Read more about the forms of change can be <a href="http://pymorphy.readthedocs.org/en/latest/ref/gram_info_ru.html">read here</a> . <br>  Page headers are already translated in the right form using the I18nLabel class so you can move on. <br>  Now we will overload the <a href="https://code.djangoproject.com/browser/django/trunk/django/contrib/admin/templates/admin/change_form.html">admin / change_form.html template</a> .  First you need to add the pymorphy_tags module to the load block, and then fix the bread crumbs there replacing in line 22 <br><br> <code>{{ opts.verbose_name }}</code> <br>  on <br> <code>{{ opts.verbose_name|inflect:"" }}</code> <br> <br>  Next in the list is the <a href="https://code.djangoproject.com/browser/django/trunk/django/contrib/admin/templates/admin/delete_selected_confirmation.html">admin / delete_selected_confirmation.html template</a> .  All edits are made in it in the same way as in the previous cases.  Here you need to first fix the bread crumbs like this <br><br> <code>{% trans app_label|capfirst %}</code> <br> <br>  Unfortunately, the function delete_selected, which is responsible for displaying this page, does not support extra_context, which makes me very sad.  Therefore, I made my own filter, which changes the shape of the number depending on the size of the object. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> template <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.conf <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> settings <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pymorphy <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> get_morph register = template.Library() morph = get_morph(settings.PYMORPHY_DICTS[<span class="hljs-string"><span class="hljs-string">'ru'</span></span>][<span class="hljs-string"><span class="hljs-string">'dir'</span></span>]) @register.filter <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">plural_from_object</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(source, object)</span></span></span><span class="hljs-function">:</span></span> l = len(object[<span class="hljs-number"><span class="hljs-number">0</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> == l: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> source <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> morph.pluralize_inflected_ru(source.upper(), l).lower()</code> </pre><br><br>  Now in all places it is necessary to expand the blocktrans block like so <br><br> <code>{% blocktrans %}Are you sure you want to delete the selected {{ objects_name }}? All of the following objects and their related items will be deleted:{% endblocktrans %}</code> <br>  fix on <br> <code>{% blocktrans with objects_name|inflect:""|plural_from_object:deletable_objects as objects_name %}Are you sure you want to delete the selected {{ objects_name }}? All of the following objects and their related items will be deleted:{% endblocktrans %}</code> <br> <br>  After all this, it remains only to reload the <a href="https://code.djangoproject.com/browser/django/trunk/django/contrib/admin/templates/admin/pagination.html">admin / pagination.html template</a> , connect the pymorphy_tags module in it and replace line 9 in it with <br><br> <code>{{ cl.result_count }} {{ cl.opts.verbose_name|lower|plural:cl.result_count }}</code> <br> <br>  I added the lower filter because there was an error when converting the gettext proxy object in the plural filter.  But perhaps this is in my environment such a glitch and you will not need to add it. <br><br>  The following <a href="https://code.djangoproject.com/browser/django/trunk/django/contrib/admin/templates/admin/filter.html">admin / filter.html</a> template is planned to replace the first two lines with <br><br> <code>{% load i18n pymorphy_tags %} <br> &lt;h3&gt;{% blocktrans with title|inflect:"" as filter_title %} By {{ filter_title }} {% endblocktrans %}&lt;/h3&gt; <br></code> <br><br>  There are only user messages that are still displayed without counting the number.  In order to correct this annoying injustice, you need to override the message_user method of the ModelAdmin class.  You can paste this into admin.py.  I did it like this <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">message_wrapper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrapper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, request, message)</span></span></span><span class="hljs-function">:</span></span> gram_info = morph.get_graminfo( self.model._meta.verbose_name.upper() )[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span> != message.find(<span class="hljs-string"><span class="hljs-string">u'"'</span></span>): <span class="hljs-string"><span class="hljs-string">""" Message about some action with a single element """</span></span> words = [w <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> w <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> re.split(<span class="hljs-string"><span class="hljs-string">"( |\\\".*?\\\".*?)"</span></span>, message) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> w.strip()] form = gram_info[<span class="hljs-string"><span class="hljs-string">'info'</span></span>][:gram_info[<span class="hljs-string"><span class="hljs-string">'info'</span></span>].find(<span class="hljs-string"><span class="hljs-string">','</span></span>)] message = <span class="hljs-string"><span class="hljs-string">u' '</span></span>.join(words[:<span class="hljs-number"><span class="hljs-number">2</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> word <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> words[<span class="hljs-number"><span class="hljs-number">2</span></span>:]: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> word.isdigit(): word = word.replace(<span class="hljs-string"><span class="hljs-string">"."</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>).upper() <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: info = morph.get_graminfo(word)[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">u'_'</span></span> != info[<span class="hljs-string"><span class="hljs-string">'class'</span></span>]: word = morph.inflect_ru(word, form).lower() <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> &lt;= info[<span class="hljs-string"><span class="hljs-string">'info'</span></span>].find(<span class="hljs-string"><span class="hljs-string">u''</span></span>): word = morph.inflect_ru(word, form, <span class="hljs-string"><span class="hljs-string">u'_'</span></span>).lower() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: word = word.lower() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> IndexError: word = word.lower() message += <span class="hljs-string"><span class="hljs-string">u' '</span></span> + word <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-string"><span class="hljs-string">""" Message about some action with a group of elements """</span></span> num = int(re.search(<span class="hljs-string"><span class="hljs-string">"\d"</span></span>, message).group(<span class="hljs-number"><span class="hljs-number">0</span></span>)) words = message.split(<span class="hljs-string"><span class="hljs-string">u' '</span></span>) message = words[<span class="hljs-number"><span class="hljs-number">0</span></span>] pos = gram_info[<span class="hljs-string"><span class="hljs-string">'info'</span></span>].find(<span class="hljs-string"><span class="hljs-string">','</span></span>) form = gram_info[<span class="hljs-string"><span class="hljs-string">'info'</span></span>][:pos] + <span class="hljs-string"><span class="hljs-string">u','</span></span> + <span class="hljs-string"><span class="hljs-string">u''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> == num <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">u''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> word <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> words[<span class="hljs-number"><span class="hljs-number">1</span></span>:]: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> word.isdigit(): word = word.replace(<span class="hljs-string"><span class="hljs-string">"."</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>).upper() info = morph.get_graminfo(word)[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">u'_'</span></span> != info[<span class="hljs-string"><span class="hljs-string">'class'</span></span>]: word = morph.pluralize_inflected_ru(word, num).lower() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: word = morph.inflect_ru(word, form, <span class="hljs-string"><span class="hljs-string">u'_'</span></span>).lower() message += <span class="hljs-string"><span class="hljs-string">u' '</span></span> + word message += <span class="hljs-string"><span class="hljs-string">'.'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f(self, request, capfirst(message)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> wrapper admin.ModelAdmin.message_user = message_wrapper(admin.ModelAdmin.message_user)</code> </pre><br>  Here we sort the message by words and incline them to the desired form.  Separately different messages for groups of objects and for units. <br><br>  Now we can see something like this. <br><img src="http://habrastorage.org/storage1/a919f022/c43ff20e/9306ef99/fc1f461b.png"><br><br><h4>  Conclusion </h4><br>  The lack of solutions in the django architecture is certainly frustrating, but everything is in our hands.  Perhaps some solutions may seem like curves to you, but I have not yet found a way to make it more elegant. <br>  When writing an article, I tried to explain briefly and point by point, and in spite of the amount of text, there are not so many movements to achieve a result.  This is subject to the use of the above code. <br><br>  The main goal of this work was to translate the administrative interface and save all the translated strings in one place, namely in the language file.  What we got. <br><br>  I would be grateful for any comments and suggestions.  Thanks for attention. <br><br>  PS You can <a href="">pick up</a> ready-made templates <a href="">here</a> .  You will need to unpack the contents of the archive into your templates directory. <br><br>  <b>[UPD]:</b> Michael ( <a href="https://habrahabr.ru/users/kmike/" class="user_link">kmike</a> ) started a bitbucket project called <a href="https://bitbucket.org/kmike/django-russian-admin">django-russian-admin</a> to automate all of the above actions. </div><p>Source: <a href="https://habr.com/ru/post/125213/">https://habr.com/ru/post/125213/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../125207/index.html">Special 4 Habrahabr: QIWI Wallet Company Development Report in Q2 2011</a></li>
<li><a href="../125208/index.html">House of Talents goes to the CIS</a></li>
<li><a href="../12521/index.html">The first social network in Ning.com in Russian</a></li>
<li><a href="../125210/index.html">Working with Java on the command line</a></li>
<li><a href="../125212/index.html">Isostick: a flash drive that impersonates an optical drive</a></li>
<li><a href="../125214/index.html">Bluetooth module HC-04 on CSR chip BC417143B</a></li>
<li><a href="../125216/index.html">Create a video surveillance system using motion</a></li>
<li><a href="../125217/index.html">IT Operations: the beginning</a></li>
<li><a href="../125218/index.html">Development of its first USB device. A small step forward</a></li>
<li><a href="../125219/index.html">Apple's financial reserves exceeded US government operating reserves</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>