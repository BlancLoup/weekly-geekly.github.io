<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Which virtualization system is better?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon. 

 People who have experience raising virtual machines on different systems, tell me: 
 What kind of virtualization system (from opens...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Which virtualization system is better?</h1><div class="post__text post__text-html js-mediator-article">  Good afternoon. <br><br>  People who have experience raising virtual machines on different systems, tell me: <br>  <b>What kind of virtualization system (from opensource) to put on the server, taking into account that the guest systems will mainly be engaged in routing?</b> <br><a name="habracut"></a><br><br>  Our company now has a zoo of servers (ordinary PC-shki) that do everything - from packet routing to FTP servers.  All this eats electricity, requires cooling, and replacing parts as it ages. <br>  Putting a new server into operation, for example, replacing the old one requires buying hardware, installing and configuring. <br>  Then you need to keep both servers on for some time, so that if there are any problems on the new one (they don‚Äôt tweak, they encounter an unexpected glitch) quickly switch everything to the old one. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The solution is to drag all these iron monsters inside one machine. <br><br>  Because  most of our ‚Äúservers‚Äù in power were far behind a modern computer based on Core 2 Duo or Core 2 Quad - we assumed that we could drag at least 4 to a computer based on Core 2 Duo E6400 @ 3GHz / 4096 RAM real cars. <br><br>  The most important servers were selected as candidates for the transfer: VPN (about 500 simultaneous sessions), a couple of soft Linux routers, a radius server, and a couple of servers displaying the admin web interface. <br><br>  Then began the selection of virtualization systems.  Of the candidates were: <br>  -OpenVZ <br>  -KVM <br>  -Xen <br>  -VMWare ESXi <br><br>  The selection resulted in the following: <br>  -OpenVZ.  Experience with him already.  It does not actually demarcate the system at all, and it works purely at the level of kernel call emulation.  In addition, it does not allow to raise new network interfaces within the system, which means that the VPN server on it will not work.  For web hosting still goes.  For routers - no <br><br>  -VMWare ESXi could not run on any of the computers available to us.  The installer either simply did not start, or the system after installation was simply not loaded. <br><br>  -Xen - was dropped because every guest machine should have the same kernel as the host machine.  Besides.  Actually, I couldn‚Äôt make it work at all.  Maybe it's my pen curves.  So we moved on to the last candidate ... <br><br>  -KVM - it doesn't matter to him which guest machine runs inside the host machine.  Although with Windows, at least with OS / 2.  Essentially complete isolation of machines from each other.  Bribed and the fact that RedHat relies on this system, and advises it for Enterprise applications.  According to all our requirements, it met. <br><br>  Put the KVM.  Quickly figured out how to put inside the system, set up the grid and routing between virtuals. <br>  The scheme was so.  The host machine has 2 network cards, inside they are connected to the following system: <br>  eth0-hosts - virtual br0 - [eth0-guest-machine-1 - eth1-guest-machine-1] - virtual br1 - [eth0-guest-machine-2 - eth1-guest-machine-2] - virtual br2 - eth1 host machines <br><br>  Began to test.  In tests, such a scheme behaved remarkably.  Almost no load.  It works stably. <br>  Put in production.  And then bam!  The load has increased significantly. <br><br>  It turned out that with the traffic through the virtual machine about 15 Mbit, it eats 40% of the processor (according to top) on the host machine.  Accordingly, already 2 machines devour almost all the processor power on the host machine.  At the same time inside the virtualok download 1-2%. <br><br>  They read that normal people do not live without virtio.  These are such special drivers that directly forward physical hardware to a virtual machine, without emulating it.  Actually it reduces the load on the host machine. <br><br>  Have tried.  And faced with two strange things: <br>  1) When you turn on virtio, the guest machine can simply fall down without giving a reason after 3-8 hours of operation <br>  2) The load on the host machine is not reduced, but remained at the same level. <br><br>  On the host machine, the Gentoo system, with a 2.6.30 kernel, manually compiled.  All that is needed for virtualization is already compiled into it. <br>  On guest machines tried Ubuntu and ArchLinux.  No difference.  Everyone is falling. <br><br>  We tried to update the kernel on the host machine, update the KVM, update the guest machine ... as long as it did nothing.  Everything works without virtio and is sometimes overloaded <br>  Now I continue to experiment with KVM on another machine, but the thought has already crept in to try out Xen ... and generally, maybe I‚Äôm doing something wrong? <br>  For example, to work virtio, you can not combine the virtual interface with a real network card in the soft bridge ... Or maybe I‚Äôm doing everything right, and it should be so?  Such a load, such problems ... <br><br>  In general, the help of competent people is needed. <br><br>  P / S: Huge request, do not give advice like "replace everything with Cisco", "Linux garbage, put fryaha."  If you think a little, you will understand why these tips are quite far from reality. </div><p>Source: <a href="https://habr.com/ru/post/70608/">https://habr.com/ru/post/70608/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../70593/index.html">Upgrading or reinstalling? From Windows XP and Vista to Windows 7</a></li>
<li><a href="../70595/index.html">GWT 1.7.1 release fixes Mac OS X Snow Leopard issues</a></li>
<li><a href="../70601/index.html">Transform blood into light</a></li>
<li><a href="../70602/index.html">TeamWox - a gift to small business!</a></li>
<li><a href="../70607/index.html">Moscow: in public institutions incandescent bulbs will be replaced with energy-saving</a></li>
<li><a href="../70610/index.html">Perl One-Line Programs</a></li>
<li><a href="../70614/index.html">Consumer Expert Social Network</a></li>
<li><a href="../70615/index.html">On a heuristic method for detecting viral injections on sites</a></li>
<li><a href="../70616/index.html">Creating an installer using WiX. Part 3</a></li>
<li><a href="../70617/index.html">Consumer Expert Social Network</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>