<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Developing an Android Application with Xamarin and F #</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 Recently, Xamarin announced a competition to develop a mobile application in the functional programming language F #. 
 This was due to the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Developing an Android Application with Xamarin and F #</h1><div class="post__text post__text-html js-mediator-article"><img align="right" height="150" src="https://habrastorage.org/getpro/habr/post_images/45f/380/50e/45f38050ece3fa9b2e7e66028072ddf9.png" alt="image"><br><br>  Hello! <br><br>  Recently, Xamarin announced a <a href="http://blog.xamarin.com/contest-build-your-first-f-mobile-app/">competition to develop a</a> mobile application in the functional programming language F #. <br>  This was due to the release of Xamarin 3 with full F # support.  I decided to distract from everyday tasks and try to participate, especially since I have been looking at F # for a long time, but I didn‚Äôt have a chance to get to know him more.  To participate in the competition, I decided to develop an application whose idea was proposed by someone in the process of discussing the sudden take-off of the Yo mobile app.  Here is a quote: <br><blockquote>  The idea for a startup, the working name of "where are you?". 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The meaning is simple, the girl installs the application, indicates the number of her young man in it, and then a big button appears to send the message ‚Äúwhere are you?‚Äù #Startup #idea <br></blockquote><br>  Why not? <br><br>  <b>Note</b> <br>  I wrote this post while working on the application.  Therefore, it is large and sometimes not very logical. <br><br><a name="habracut"></a><br><h4>  T-shirt </h4><br>  The first thing I did was download and launch the Xamarin Store application to get a T-shirt with F #.  I already have the same with C # <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/981/448/088/981448088fb8d2927cc803582e321986.png" alt="image"></div><br><br>  Rather, I tried, but immediately grabbed the problem with the construction.  It turns out the current version of Xamarin supports F # version 3.0, and only version F # 3.1.1 is free to download. <br><br>  F # 3.0 is located inside the Visual Studio Express 2012 for Web package and is installed with the studio using the Microsoft Web Platform Installer.  Strange approach. <br>  For Xamarin and F # to work, it is enough for the FSharp.Core build of version 4.3.0.0 to be in the GAC.  Anyway, here‚Äôs a <a href="http://go.microsoft.com/fwlink/%3FLinkId%3D261286">direct link</a> if anyone wants to try. <br><br><h4>  Beginning of work </h4><br>  Now Xamarin supports F # only inside Xamarin Studio.  So I had to forget about my beloved VS2013 for a while and work in this generally quite good environment.  Creating a new application for Android took a couple of seconds and here we have a working Hello-world Android application on F # <br><div class="spoiler">  <b class="spoiler_title">MainActivity.fs</b> <div class="spoiler_text"><pre><code class="hljs pgsql">namespace Xakpc.WhereAreYou.Droid <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span> <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> Android.App <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> Android.Content <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> Android.OS <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> Android.Runtime <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> Android.Views <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> Android.Widget [&lt;Activity (Label = "Xakpc.WhereAreYou.Droid", MainLauncher = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)&gt;] <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> WhereAreYouActivity () = <span class="hljs-keyword"><span class="hljs-keyword">inherit</span></span> Activity () let mutable count:<span class="hljs-type"><span class="hljs-type">int</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span> override this.OnCreate (bundle) = base.OnCreate (bundle) // <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> our <span class="hljs-keyword"><span class="hljs-keyword">view</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> the "main" layout resource this.SetContentView (Resource_Layout.Main) // <span class="hljs-keyword"><span class="hljs-keyword">Get</span></span> our button <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> the layout resource, <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> attach an event <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> it let button = this.FindViewById&lt;Button&gt;(Resource_Id.myButton) button.Click.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span> (fun args -&gt; button.Text &lt;- sprintf "%d clicks!" count count &lt;- count + <span class="hljs-number"><span class="hljs-number">1</span></span> )</code> </pre> <br></div></div><br>  It seems Habr does not know how to color F #.  Sadness (but there is support for Vala) <br><br><h4>  Immediately to Fight, Attempt number one </h4><br>  How the application should look like to me was obvious, 3 screens, 3 push notifications, good old Azure as a backend, vivid colors (inspired by Yo) <br>  Further the best friend of the developer, a pencil and a piece of paper.  Drew mokapy and forward to the code.  Add components from the Xamarin Component Store to the project: Azure Mobile Services and Google Play Services (ICS - I don‚Äôt want to bother with old versions of Android now). <br>  We collect and <i>BAM!</i>  - the first rake. <br><div class="spoiler">  <b class="spoiler_title">Grabelki</b> <div class="spoiler_text">  Programming on Xamarin for Android, according to <a href="https://habrahabr.ru/users/xlab/" class="user_link">Xlab</a> .  I agree with him :) <br><img src="https://habrastorage.org/getpro/habr/comment_images/93d/1ce/3d3/93d1ce3d386481e561e3b4033acf405d.gif" alt="image"><br></div></div>  When building a project, Xamarin builds resource files, in particular, it generates a <code>Resource.Designer.fs</code> file containing, as far as I understand, pointers and / or resource identifiers.  In particular, there is a pointer to the Id.end identifier which is translated into the following code <br><pre> <code class="hljs pgsql">// aapt resource <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>: <span class="hljs-number"><span class="hljs-number">0x7f070013</span></span> static member end = <span class="hljs-number"><span class="hljs-number">2131165203</span></span></code> </pre><br>  and the word end is key for F # and the compiler reports an error The <code>   "end"    (FS0010)</code> .  And this is one of the errors that you cannot solve yourself, the management of the generation of these files is unfortunately not available to us. <br>  I immediately wrote to the Xamarin forum and Miguel de Icaza on Twitter - and I got an answer promptly!  Developers report that this bug has already been fixed in the alpha version. <br>  I switch Xamarin Studio to alpha channel and <i>BAM!</i>  - still does not work. <br>  It turns out ... <br><blockquote>  Alpha channel is not quite there yet yet ... </blockquote><br>  Well, it remains only to wait until it is "there", there is still time.  Let's leave Google Play Services alone. <br><br><h5>  A few words about F # </h5><br>  When I started the project, I did not know anything about F #, except that it is ‚Äúcool‚Äù, ‚Äúmodern‚Äù, and ‚Äúextremely comfortable.‚Äù  An attempt to take it overnight in a new project failed miserably.  I spent almost fifteen minutes trying to understand why <code>let values = ["item1"; "item2"; "item3"]</code> <code>let values = ["item1"; "item2"; "item3"]</code>  <code>let values = ["item1"; "item2"; "item3"]</code> cannot be passed to the ArrayAdapter's constructor <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|] -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code></code> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> <hr> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> <h4> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> </h4> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> <div style="text-align:center;"> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> </div> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> <pre> <code class="hljs pgsql"><code>listView.Adapter &lt;- <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>) <br>  , ,  let <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> Fun <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> : string) = use md5 = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>.Cryptography.MD5.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> |&gt; <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Text.<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string CreateMD5Hash (string <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>) { MD5 md5 = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>.Cryptography.MD5.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>(); byte[] inputBytes = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Text.<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.ASCII.GetBytes (<span class="hljs-keyword"><span class="hljs-keyword">input</span></span>); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> StringBuilder(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Resources\Resource.designer.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Properties\AssemblyInfo.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Helpers\Helpers.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Services\User.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Services\AzureServiceWorker.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="IAmHereActivity.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="WhereAreYouActivity.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task<span class="hljs-string"><span class="hljs-string">',      .     F#         Task.  ,     : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         </span></span><code><span class="hljs-string"><span class="hljs-string">Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</span></span></code><span class="hljs-string"><span class="hljs-string">       </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">            </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars ['</span></span> <span class="hljs-string"><span class="hljs-string">';'</span></span>-<span class="hljs-string"><span class="hljs-string">';'</span></span>(<span class="hljs-string"><span class="hljs-string">';'</span></span>)<span class="hljs-string"><span class="hljs-string">'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">book.ToList()</span></span></code><span class="hljs-string"><span class="hljs-string">   List </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</span></span></code><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.map ExtractUserInfo</span></span></code><span class="hljs-string"><span class="hljs-string">      Contracts  UserInfo,      UserInfo </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.toList</span></span></code><span class="hljs-string"><span class="hljs-string">   List </span></span><code><span class="hljs-string"><span class="hljs-string">_contacts &lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">    mutable  </span></span><code><span class="hljs-string"><span class="hljs-string">_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">    UserInfo  string,     - -    </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.toArray&lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">  List  Array    ArrayAdapter </span></span><br><span class="hljs-string"><span class="hljs-string">    -      List.   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> Azure Mobile Servcies </span></span><br><span class="hljs-string"><span class="hljs-string">   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    </span></span><code><code><br><span class="hljs-string"><span class="hljs-string"> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><s><span class="hljs-string"><span class="hljs-string"></span></span></s><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">member this.RegisterMe phone name regId = async {</span></span></code><span class="hljs-string"><span class="hljs-string"> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string"> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</span></span></code><span class="hljs-string"><span class="hljs-string">  do-bang,   </span></span><code><span class="hljs-string"><span class="hljs-string">await</span></span></code><span class="hljs-string"><span class="hljs-string">  C#. ..             continuation    . </span></span><code><span class="hljs-string"><span class="hljs-string">return (usr.Id, usr.PhoneHash, usr.Nickname)</span></span></code><span class="hljs-string"><span class="hljs-string">      Tuple&lt;string,string,string&gt;     .  </span></span><code><span class="hljs-string"><span class="hljs-string">try ... with | e -&gt;</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">try..catch</span></span></code><span class="hljs-string"><span class="hljs-string">  C# </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       .  F#    </span></span><code><span class="hljs-string"><span class="hljs-string">fst</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">snd</span></span></code><span class="hljs-string"><span class="hljs-string">      .        2 .     : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string"> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><code><span class="hljs-string"><span class="hljs-string">id tuple</span></span></code><span class="hljs-string"><span class="hljs-string">  Id  .. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    5  Azure,       Push .       Azure Custom Api  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">    </span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : '</span></span>Hello World!<span class="hljs-string"><span class="hljs-string">' }); console.log('</span></span>Incoming <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> requst: <span class="hljs-string"><span class="hljs-string">', request.body.RequestId); var usersTable = request.service.tables.getTable('</span></span><span class="hljs-keyword"><span class="hljs-keyword">User</span></span><span class="hljs-string"><span class="hljs-string">'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('</span></span>Send <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> results: <span class="hljs-string"><span class="hljs-string">', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('</span></span>Push notification sent: <span class="hljs-string"><span class="hljs-string">', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('</span></span>Error sending push notification: <span class="hljs-string"><span class="hljs-string">', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('</span></span>Error <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span>: <span class="hljs-string"><span class="hljs-string">', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    Push      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       ,    </span></span><code><span class="hljs-string"><span class="hljs-string">let-bang</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">do!</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      Google Play Services.     F#   .           .    : </span></span><i><span class="hljs-string"><span class="hljs-string">Xamarin.Android.Support.v7.AppCompat</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     , Google Play Services ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       </span></span><a href="http://developer.android.com/google/gcm/client.html"><span class="hljs-string"><span class="hljs-string">developer.android.com</span></span></a><span class="hljs-string"><span class="hljs-string"> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string">    , -  </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><a href="https://bitbucket.org/xakpc/whereareyou"><span class="hljs-string"><span class="hljs-string">bitbucket.org/xakpc/whereareyou</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,     </span></span><br><span class="hljs-string"><span class="hljs-string">          ,           "" . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> ,   Android   F#.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       -  Android  F#.   ,       .</span></span></code></code> </pre> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> <div class="spoiler"> <code><b class="spoiler_title"><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br>  ,     C# <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></b></code> <div class="spoiler_text"> <pre> <code class="hljs pgsql"><code>listView.Adapter &lt;- <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>) <br>  , ,  let <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> Fun <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> : string) = use md5 = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>.Cryptography.MD5.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> |&gt; <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Text.<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string CreateMD5Hash (string <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>) { MD5 md5 = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>.Cryptography.MD5.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>(); byte[] inputBytes = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Text.<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.ASCII.GetBytes (<span class="hljs-keyword"><span class="hljs-keyword">input</span></span>); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> StringBuilder(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Resources\Resource.designer.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Properties\AssemblyInfo.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Helpers\Helpers.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Services\User.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Services\AzureServiceWorker.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="IAmHereActivity.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="WhereAreYouActivity.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task<span class="hljs-string"><span class="hljs-string">',      .     F#         Task.  ,     : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         </span></span><code><span class="hljs-string"><span class="hljs-string">Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</span></span></code><span class="hljs-string"><span class="hljs-string">       </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">            </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars ['</span></span> <span class="hljs-string"><span class="hljs-string">';'</span></span>-<span class="hljs-string"><span class="hljs-string">';'</span></span>(<span class="hljs-string"><span class="hljs-string">';'</span></span>)<span class="hljs-string"><span class="hljs-string">'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">book.ToList()</span></span></code><span class="hljs-string"><span class="hljs-string">   List </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</span></span></code><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.map ExtractUserInfo</span></span></code><span class="hljs-string"><span class="hljs-string">      Contracts  UserInfo,      UserInfo </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.toList</span></span></code><span class="hljs-string"><span class="hljs-string">   List </span></span><code><span class="hljs-string"><span class="hljs-string">_contacts &lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">    mutable  </span></span><code><span class="hljs-string"><span class="hljs-string">_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">    UserInfo  string,     - -    </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.toArray&lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">  List  Array    ArrayAdapter </span></span><br><span class="hljs-string"><span class="hljs-string">    -      List.   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> Azure Mobile Servcies </span></span><br><span class="hljs-string"><span class="hljs-string">   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    </span></span><code><code><br><span class="hljs-string"><span class="hljs-string"> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><s><span class="hljs-string"><span class="hljs-string"></span></span></s><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">member this.RegisterMe phone name regId = async {</span></span></code><span class="hljs-string"><span class="hljs-string"> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string"> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</span></span></code><span class="hljs-string"><span class="hljs-string">  do-bang,   </span></span><code><span class="hljs-string"><span class="hljs-string">await</span></span></code><span class="hljs-string"><span class="hljs-string">  C#. ..             continuation    . </span></span><code><span class="hljs-string"><span class="hljs-string">return (usr.Id, usr.PhoneHash, usr.Nickname)</span></span></code><span class="hljs-string"><span class="hljs-string">      Tuple&lt;string,string,string&gt;     .  </span></span><code><span class="hljs-string"><span class="hljs-string">try ... with | e -&gt;</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">try..catch</span></span></code><span class="hljs-string"><span class="hljs-string">  C# </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       .  F#    </span></span><code><span class="hljs-string"><span class="hljs-string">fst</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">snd</span></span></code><span class="hljs-string"><span class="hljs-string">      .        2 .     : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string"> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><code><span class="hljs-string"><span class="hljs-string">id tuple</span></span></code><span class="hljs-string"><span class="hljs-string">  Id  .. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    5  Azure,       Push .       Azure Custom Api  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">    </span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : '</span></span>Hello World!<span class="hljs-string"><span class="hljs-string">' }); console.log('</span></span>Incoming <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> requst: <span class="hljs-string"><span class="hljs-string">', request.body.RequestId); var usersTable = request.service.tables.getTable('</span></span><span class="hljs-keyword"><span class="hljs-keyword">User</span></span><span class="hljs-string"><span class="hljs-string">'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('</span></span>Send <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> results: <span class="hljs-string"><span class="hljs-string">', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('</span></span>Push notification sent: <span class="hljs-string"><span class="hljs-string">', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('</span></span>Error sending push notification: <span class="hljs-string"><span class="hljs-string">', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('</span></span>Error <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span>: <span class="hljs-string"><span class="hljs-string">', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    Push      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       ,    </span></span><code><span class="hljs-string"><span class="hljs-string">let-bang</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">do!</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      Google Play Services.     F#   .           .    : </span></span><i><span class="hljs-string"><span class="hljs-string">Xamarin.Android.Support.v7.AppCompat</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     , Google Play Services ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       </span></span><a href="http://developer.android.com/google/gcm/client.html"><span class="hljs-string"><span class="hljs-string">developer.android.com</span></span></a><span class="hljs-string"><span class="hljs-string"> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string">    , -  </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><a href="https://bitbucket.org/xakpc/whereareyou"><span class="hljs-string"><span class="hljs-string">bitbucket.org/xakpc/whereareyou</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,     </span></span><br><span class="hljs-string"><span class="hljs-string">          ,           "" . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> ,   Android   F#.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       -  Android  F#.   ,       .</span></span></code></code> </pre> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> </div></div> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> <pre> <code class="hljs pgsql"><code>listView.Adapter &lt;- <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>) <br>  , ,  let <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> Fun <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> : string) = use md5 = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>.Cryptography.MD5.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> |&gt; <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Text.<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string CreateMD5Hash (string <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>) { MD5 md5 = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>.Cryptography.MD5.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>(); byte[] inputBytes = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Text.<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.ASCII.GetBytes (<span class="hljs-keyword"><span class="hljs-keyword">input</span></span>); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> StringBuilder(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Resources\Resource.designer.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Properties\AssemblyInfo.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Helpers\Helpers.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Services\User.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Services\AzureServiceWorker.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="IAmHereActivity.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="WhereAreYouActivity.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task<span class="hljs-string"><span class="hljs-string">',      .     F#         Task.  ,     : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         </span></span><code><span class="hljs-string"><span class="hljs-string">Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</span></span></code><span class="hljs-string"><span class="hljs-string">       </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">            </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars ['</span></span> <span class="hljs-string"><span class="hljs-string">';'</span></span>-<span class="hljs-string"><span class="hljs-string">';'</span></span>(<span class="hljs-string"><span class="hljs-string">';'</span></span>)<span class="hljs-string"><span class="hljs-string">'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">book.ToList()</span></span></code><span class="hljs-string"><span class="hljs-string">   List </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</span></span></code><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.map ExtractUserInfo</span></span></code><span class="hljs-string"><span class="hljs-string">      Contracts  UserInfo,      UserInfo </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.toList</span></span></code><span class="hljs-string"><span class="hljs-string">   List </span></span><code><span class="hljs-string"><span class="hljs-string">_contacts &lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">    mutable  </span></span><code><span class="hljs-string"><span class="hljs-string">_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">    UserInfo  string,     - -    </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.toArray&lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">  List  Array    ArrayAdapter </span></span><br><span class="hljs-string"><span class="hljs-string">    -      List.   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> Azure Mobile Servcies </span></span><br><span class="hljs-string"><span class="hljs-string">   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    </span></span><code><code><br><span class="hljs-string"><span class="hljs-string"> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><s><span class="hljs-string"><span class="hljs-string"></span></span></s><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">member this.RegisterMe phone name regId = async {</span></span></code><span class="hljs-string"><span class="hljs-string"> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string"> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</span></span></code><span class="hljs-string"><span class="hljs-string">  do-bang,   </span></span><code><span class="hljs-string"><span class="hljs-string">await</span></span></code><span class="hljs-string"><span class="hljs-string">  C#. ..             continuation    . </span></span><code><span class="hljs-string"><span class="hljs-string">return (usr.Id, usr.PhoneHash, usr.Nickname)</span></span></code><span class="hljs-string"><span class="hljs-string">      Tuple&lt;string,string,string&gt;     .  </span></span><code><span class="hljs-string"><span class="hljs-string">try ... with | e -&gt;</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">try..catch</span></span></code><span class="hljs-string"><span class="hljs-string">  C# </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       .  F#    </span></span><code><span class="hljs-string"><span class="hljs-string">fst</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">snd</span></span></code><span class="hljs-string"><span class="hljs-string">      .        2 .     : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string"> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><code><span class="hljs-string"><span class="hljs-string">id tuple</span></span></code><span class="hljs-string"><span class="hljs-string">  Id  .. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    5  Azure,       Push .       Azure Custom Api  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">    </span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : '</span></span>Hello World!<span class="hljs-string"><span class="hljs-string">' }); console.log('</span></span>Incoming <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> requst: <span class="hljs-string"><span class="hljs-string">', request.body.RequestId); var usersTable = request.service.tables.getTable('</span></span><span class="hljs-keyword"><span class="hljs-keyword">User</span></span><span class="hljs-string"><span class="hljs-string">'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('</span></span>Send <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> results: <span class="hljs-string"><span class="hljs-string">', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('</span></span>Push notification sent: <span class="hljs-string"><span class="hljs-string">', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('</span></span>Error sending push notification: <span class="hljs-string"><span class="hljs-string">', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('</span></span>Error <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span>: <span class="hljs-string"><span class="hljs-string">', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    Push      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       ,    </span></span><code><span class="hljs-string"><span class="hljs-string">let-bang</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">do!</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      Google Play Services.     F#   .           .    : </span></span><i><span class="hljs-string"><span class="hljs-string">Xamarin.Android.Support.v7.AppCompat</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     , Google Play Services ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       </span></span><a href="http://developer.android.com/google/gcm/client.html"><span class="hljs-string"><span class="hljs-string">developer.android.com</span></span></a><span class="hljs-string"><span class="hljs-string"> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string">    , -  </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><a href="https://bitbucket.org/xakpc/whereareyou"><span class="hljs-string"><span class="hljs-string">bitbucket.org/xakpc/whereareyou</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,     </span></span><br><span class="hljs-string"><span class="hljs-string">          ,           "" . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> ,   Android   F#.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       -  Android  F#.   ,       .</span></span></code></code> </pre> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> <h5> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> </h5> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> <pre> <code class="hljs pgsql"><code>listView.Adapter &lt;- <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>) <br>  , ,  let <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> Fun <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> : string) = use md5 = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>.Cryptography.MD5.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> |&gt; <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Text.<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string CreateMD5Hash (string <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>) { MD5 md5 = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>.Cryptography.MD5.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>(); byte[] inputBytes = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Text.<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.ASCII.GetBytes (<span class="hljs-keyword"><span class="hljs-keyword">input</span></span>); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> StringBuilder(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Resources\Resource.designer.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Properties\AssemblyInfo.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Helpers\Helpers.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Services\User.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Services\AzureServiceWorker.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="IAmHereActivity.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="WhereAreYouActivity.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task<span class="hljs-string"><span class="hljs-string">',      .     F#         Task.  ,     : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         </span></span><code><span class="hljs-string"><span class="hljs-string">Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</span></span></code><span class="hljs-string"><span class="hljs-string">       </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">            </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars ['</span></span> <span class="hljs-string"><span class="hljs-string">';'</span></span>-<span class="hljs-string"><span class="hljs-string">';'</span></span>(<span class="hljs-string"><span class="hljs-string">';'</span></span>)<span class="hljs-string"><span class="hljs-string">'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">book.ToList()</span></span></code><span class="hljs-string"><span class="hljs-string">   List </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</span></span></code><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.map ExtractUserInfo</span></span></code><span class="hljs-string"><span class="hljs-string">      Contracts  UserInfo,      UserInfo </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.toList</span></span></code><span class="hljs-string"><span class="hljs-string">   List </span></span><code><span class="hljs-string"><span class="hljs-string">_contacts &lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">    mutable  </span></span><code><span class="hljs-string"><span class="hljs-string">_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">    UserInfo  string,     - -    </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.toArray&lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">  List  Array    ArrayAdapter </span></span><br><span class="hljs-string"><span class="hljs-string">    -      List.   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> Azure Mobile Servcies </span></span><br><span class="hljs-string"><span class="hljs-string">   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    </span></span><code><code><br><span class="hljs-string"><span class="hljs-string"> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><s><span class="hljs-string"><span class="hljs-string"></span></span></s><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">member this.RegisterMe phone name regId = async {</span></span></code><span class="hljs-string"><span class="hljs-string"> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string"> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</span></span></code><span class="hljs-string"><span class="hljs-string">  do-bang,   </span></span><code><span class="hljs-string"><span class="hljs-string">await</span></span></code><span class="hljs-string"><span class="hljs-string">  C#. ..             continuation    . </span></span><code><span class="hljs-string"><span class="hljs-string">return (usr.Id, usr.PhoneHash, usr.Nickname)</span></span></code><span class="hljs-string"><span class="hljs-string">      Tuple&lt;string,string,string&gt;     .  </span></span><code><span class="hljs-string"><span class="hljs-string">try ... with | e -&gt;</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">try..catch</span></span></code><span class="hljs-string"><span class="hljs-string">  C# </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       .  F#    </span></span><code><span class="hljs-string"><span class="hljs-string">fst</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">snd</span></span></code><span class="hljs-string"><span class="hljs-string">      .        2 .     : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string"> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><code><span class="hljs-string"><span class="hljs-string">id tuple</span></span></code><span class="hljs-string"><span class="hljs-string">  Id  .. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    5  Azure,       Push .       Azure Custom Api  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">    </span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : '</span></span>Hello World!<span class="hljs-string"><span class="hljs-string">' }); console.log('</span></span>Incoming <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> requst: <span class="hljs-string"><span class="hljs-string">', request.body.RequestId); var usersTable = request.service.tables.getTable('</span></span><span class="hljs-keyword"><span class="hljs-keyword">User</span></span><span class="hljs-string"><span class="hljs-string">'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('</span></span>Send <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> results: <span class="hljs-string"><span class="hljs-string">', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('</span></span>Push notification sent: <span class="hljs-string"><span class="hljs-string">', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('</span></span>Error sending push notification: <span class="hljs-string"><span class="hljs-string">', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('</span></span>Error <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span>: <span class="hljs-string"><span class="hljs-string">', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    Push      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       ,    </span></span><code><span class="hljs-string"><span class="hljs-string">let-bang</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">do!</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      Google Play Services.     F#   .           .    : </span></span><i><span class="hljs-string"><span class="hljs-string">Xamarin.Android.Support.v7.AppCompat</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     , Google Play Services ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       </span></span><a href="http://developer.android.com/google/gcm/client.html"><span class="hljs-string"><span class="hljs-string">developer.android.com</span></span></a><span class="hljs-string"><span class="hljs-string"> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string">    , -  </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><a href="https://bitbucket.org/xakpc/whereareyou"><span class="hljs-string"><span class="hljs-string">bitbucket.org/xakpc/whereareyou</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,     </span></span><br><span class="hljs-string"><span class="hljs-string">          ,           "" . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> ,   Android   F#.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       -  Android  F#.   ,       .</span></span></code></code> </pre> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> <pre> <code class="hljs pgsql"><code>listView.Adapter &lt;- <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>) <br>  , ,  let <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> Fun <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> : string) = use md5 = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>.Cryptography.MD5.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> |&gt; <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Text.<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string CreateMD5Hash (string <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>) { MD5 md5 = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>.Cryptography.MD5.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>(); byte[] inputBytes = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Text.<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.ASCII.GetBytes (<span class="hljs-keyword"><span class="hljs-keyword">input</span></span>); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> StringBuilder(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Resources\Resource.designer.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Properties\AssemblyInfo.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Helpers\Helpers.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Services\User.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Services\AzureServiceWorker.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="IAmHereActivity.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="WhereAreYouActivity.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task<span class="hljs-string"><span class="hljs-string">',      .     F#         Task.  ,     : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         </span></span><code><span class="hljs-string"><span class="hljs-string">Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</span></span></code><span class="hljs-string"><span class="hljs-string">       </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">            </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars ['</span></span> <span class="hljs-string"><span class="hljs-string">';'</span></span>-<span class="hljs-string"><span class="hljs-string">';'</span></span>(<span class="hljs-string"><span class="hljs-string">';'</span></span>)<span class="hljs-string"><span class="hljs-string">'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">book.ToList()</span></span></code><span class="hljs-string"><span class="hljs-string">   List </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</span></span></code><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.map ExtractUserInfo</span></span></code><span class="hljs-string"><span class="hljs-string">      Contracts  UserInfo,      UserInfo </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.toList</span></span></code><span class="hljs-string"><span class="hljs-string">   List </span></span><code><span class="hljs-string"><span class="hljs-string">_contacts &lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">    mutable  </span></span><code><span class="hljs-string"><span class="hljs-string">_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">    UserInfo  string,     - -    </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.toArray&lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">  List  Array    ArrayAdapter </span></span><br><span class="hljs-string"><span class="hljs-string">    -      List.   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> Azure Mobile Servcies </span></span><br><span class="hljs-string"><span class="hljs-string">   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    </span></span><code><code><br><span class="hljs-string"><span class="hljs-string"> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><s><span class="hljs-string"><span class="hljs-string"></span></span></s><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">member this.RegisterMe phone name regId = async {</span></span></code><span class="hljs-string"><span class="hljs-string"> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string"> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</span></span></code><span class="hljs-string"><span class="hljs-string">  do-bang,   </span></span><code><span class="hljs-string"><span class="hljs-string">await</span></span></code><span class="hljs-string"><span class="hljs-string">  C#. ..             continuation    . </span></span><code><span class="hljs-string"><span class="hljs-string">return (usr.Id, usr.PhoneHash, usr.Nickname)</span></span></code><span class="hljs-string"><span class="hljs-string">      Tuple&lt;string,string,string&gt;     .  </span></span><code><span class="hljs-string"><span class="hljs-string">try ... with | e -&gt;</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">try..catch</span></span></code><span class="hljs-string"><span class="hljs-string">  C# </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       .  F#    </span></span><code><span class="hljs-string"><span class="hljs-string">fst</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">snd</span></span></code><span class="hljs-string"><span class="hljs-string">      .        2 .     : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string"> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><code><span class="hljs-string"><span class="hljs-string">id tuple</span></span></code><span class="hljs-string"><span class="hljs-string">  Id  .. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    5  Azure,       Push .       Azure Custom Api  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">    </span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : '</span></span>Hello World!<span class="hljs-string"><span class="hljs-string">' }); console.log('</span></span>Incoming <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> requst: <span class="hljs-string"><span class="hljs-string">', request.body.RequestId); var usersTable = request.service.tables.getTable('</span></span><span class="hljs-keyword"><span class="hljs-keyword">User</span></span><span class="hljs-string"><span class="hljs-string">'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('</span></span>Send <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> results: <span class="hljs-string"><span class="hljs-string">', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('</span></span>Push notification sent: <span class="hljs-string"><span class="hljs-string">', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('</span></span>Error sending push notification: <span class="hljs-string"><span class="hljs-string">', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('</span></span>Error <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span>: <span class="hljs-string"><span class="hljs-string">', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    Push      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       ,    </span></span><code><span class="hljs-string"><span class="hljs-string">let-bang</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">do!</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      Google Play Services.     F#   .           .    : </span></span><i><span class="hljs-string"><span class="hljs-string">Xamarin.Android.Support.v7.AppCompat</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     , Google Play Services ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       </span></span><a href="http://developer.android.com/google/gcm/client.html"><span class="hljs-string"><span class="hljs-string">developer.android.com</span></span></a><span class="hljs-string"><span class="hljs-string"> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string">    , -  </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><a href="https://bitbucket.org/xakpc/whereareyou"><span class="hljs-string"><span class="hljs-string">bitbucket.org/xakpc/whereareyou</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,     </span></span><br><span class="hljs-string"><span class="hljs-string">          ,           "" . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> ,   Android   F#.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       -  Android  F#.   ,       .</span></span></code></code> </pre> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> <ol><li> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> </li> <li> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> </li> <li> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> </li> <li> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> </li> <li> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> </li> <li> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> </li> <li> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> </li> <li> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> </li> </ol> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> <div style="text-align:center;"> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> </div> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> <h4> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> </h4> <code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> <pre> <code class="hljs pgsql"><code>listView.Adapter &lt;- <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>) <br>  , ,  let <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> Fun <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> : string) = use md5 = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>.Cryptography.MD5.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> |&gt; <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Text.<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string CreateMD5Hash (string <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>) { MD5 md5 = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>.Cryptography.MD5.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>(); byte[] inputBytes = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Text.<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.ASCII.GetBytes (<span class="hljs-keyword"><span class="hljs-keyword">input</span></span>); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> StringBuilder(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Resources\Resource.designer.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Properties\AssemblyInfo.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Helpers\Helpers.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Services\User.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Services\AzureServiceWorker.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="IAmHereActivity.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="WhereAreYouActivity.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task<span class="hljs-string"><span class="hljs-string">',      .     F#         Task.  ,     : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         </span></span><code><span class="hljs-string"><span class="hljs-string">Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</span></span></code><span class="hljs-string"><span class="hljs-string">       </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">            </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars ['</span></span> <span class="hljs-string"><span class="hljs-string">';'</span></span>-<span class="hljs-string"><span class="hljs-string">';'</span></span>(<span class="hljs-string"><span class="hljs-string">';'</span></span>)<span class="hljs-string"><span class="hljs-string">'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">book.ToList()</span></span></code><span class="hljs-string"><span class="hljs-string">   List </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</span></span></code><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.map ExtractUserInfo</span></span></code><span class="hljs-string"><span class="hljs-string">      Contracts  UserInfo,      UserInfo </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.toList</span></span></code><span class="hljs-string"><span class="hljs-string">   List </span></span><code><span class="hljs-string"><span class="hljs-string">_contacts &lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">    mutable  </span></span><code><span class="hljs-string"><span class="hljs-string">_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">    UserInfo  string,     - -    </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.toArray&lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">  List  Array    ArrayAdapter </span></span><br><span class="hljs-string"><span class="hljs-string">    -      List.   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> Azure Mobile Servcies </span></span><br><span class="hljs-string"><span class="hljs-string">   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    </span></span><code><code><br><span class="hljs-string"><span class="hljs-string"> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><s><span class="hljs-string"><span class="hljs-string"></span></span></s><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">member this.RegisterMe phone name regId = async {</span></span></code><span class="hljs-string"><span class="hljs-string"> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string"> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</span></span></code><span class="hljs-string"><span class="hljs-string">  do-bang,   </span></span><code><span class="hljs-string"><span class="hljs-string">await</span></span></code><span class="hljs-string"><span class="hljs-string">  C#. ..             continuation    . </span></span><code><span class="hljs-string"><span class="hljs-string">return (usr.Id, usr.PhoneHash, usr.Nickname)</span></span></code><span class="hljs-string"><span class="hljs-string">      Tuple&lt;string,string,string&gt;     .  </span></span><code><span class="hljs-string"><span class="hljs-string">try ... with | e -&gt;</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">try..catch</span></span></code><span class="hljs-string"><span class="hljs-string">  C# </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       .  F#    </span></span><code><span class="hljs-string"><span class="hljs-string">fst</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">snd</span></span></code><span class="hljs-string"><span class="hljs-string">      .        2 .     : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string"> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><code><span class="hljs-string"><span class="hljs-string">id tuple</span></span></code><span class="hljs-string"><span class="hljs-string">  Id  .. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    5  Azure,       Push .       Azure Custom Api  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">    </span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : '</span></span>Hello World!<span class="hljs-string"><span class="hljs-string">' }); console.log('</span></span>Incoming <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> requst: <span class="hljs-string"><span class="hljs-string">', request.body.RequestId); var usersTable = request.service.tables.getTable('</span></span><span class="hljs-keyword"><span class="hljs-keyword">User</span></span><span class="hljs-string"><span class="hljs-string">'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('</span></span>Send <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> results: <span class="hljs-string"><span class="hljs-string">', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('</span></span>Push notification sent: <span class="hljs-string"><span class="hljs-string">', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('</span></span>Error sending push notification: <span class="hljs-string"><span class="hljs-string">', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('</span></span>Error <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span>: <span class="hljs-string"><span class="hljs-string">', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    Push      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       ,    </span></span><code><span class="hljs-string"><span class="hljs-string">let-bang</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">do!</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      Google Play Services.     F#   .           .    : </span></span><i><span class="hljs-string"><span class="hljs-string">Xamarin.Android.Support.v7.AppCompat</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     , Google Play Services ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       </span></span><a href="http://developer.android.com/google/gcm/client.html"><span class="hljs-string"><span class="hljs-string">developer.android.com</span></span></a><span class="hljs-string"><span class="hljs-string"> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string">    , -  </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><a href="https://bitbucket.org/xakpc/whereareyou"><span class="hljs-string"><span class="hljs-string">bitbucket.org/xakpc/whereareyou</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,     </span></span><br><span class="hljs-string"><span class="hljs-string">          ,           "" . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> ,   Android   F#.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       -  Android  F#.   ,       .</span></span></code></code> </pre> <code><code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> <pre> <code class="hljs pgsql"><code>listView.Adapter &lt;- <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>) <br>  , ,  let <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> Fun <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> : string) = use md5 = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>.Cryptography.MD5.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> |&gt; <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Text.<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string CreateMD5Hash (string <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>) { MD5 md5 = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>.Cryptography.MD5.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>(); byte[] inputBytes = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Text.<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.ASCII.GetBytes (<span class="hljs-keyword"><span class="hljs-keyword">input</span></span>); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> StringBuilder(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Resources\Resource.designer.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Properties\AssemblyInfo.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Helpers\Helpers.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Services\User.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Services\AzureServiceWorker.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="IAmHereActivity.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="WhereAreYouActivity.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task<span class="hljs-string"><span class="hljs-string">',      .     F#         Task.  ,     : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         </span></span><code><span class="hljs-string"><span class="hljs-string">Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</span></span></code><span class="hljs-string"><span class="hljs-string">       </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">            </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars ['</span></span> <span class="hljs-string"><span class="hljs-string">';'</span></span>-<span class="hljs-string"><span class="hljs-string">';'</span></span>(<span class="hljs-string"><span class="hljs-string">';'</span></span>)<span class="hljs-string"><span class="hljs-string">'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">book.ToList()</span></span></code><span class="hljs-string"><span class="hljs-string">   List </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</span></span></code><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.map ExtractUserInfo</span></span></code><span class="hljs-string"><span class="hljs-string">      Contracts  UserInfo,      UserInfo </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.toList</span></span></code><span class="hljs-string"><span class="hljs-string">   List </span></span><code><span class="hljs-string"><span class="hljs-string">_contacts &lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">    mutable  </span></span><code><span class="hljs-string"><span class="hljs-string">_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">    UserInfo  string,     - -    </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.toArray&lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">  List  Array    ArrayAdapter </span></span><br><span class="hljs-string"><span class="hljs-string">    -      List.   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> Azure Mobile Servcies </span></span><br><span class="hljs-string"><span class="hljs-string">   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    </span></span><code><code><br><span class="hljs-string"><span class="hljs-string"> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><s><span class="hljs-string"><span class="hljs-string"></span></span></s><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">member this.RegisterMe phone name regId = async {</span></span></code><span class="hljs-string"><span class="hljs-string"> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string"> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</span></span></code><span class="hljs-string"><span class="hljs-string">  do-bang,   </span></span><code><span class="hljs-string"><span class="hljs-string">await</span></span></code><span class="hljs-string"><span class="hljs-string">  C#. ..             continuation    . </span></span><code><span class="hljs-string"><span class="hljs-string">return (usr.Id, usr.PhoneHash, usr.Nickname)</span></span></code><span class="hljs-string"><span class="hljs-string">      Tuple&lt;string,string,string&gt;     .  </span></span><code><span class="hljs-string"><span class="hljs-string">try ... with | e -&gt;</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">try..catch</span></span></code><span class="hljs-string"><span class="hljs-string">  C# </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       .  F#    </span></span><code><span class="hljs-string"><span class="hljs-string">fst</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">snd</span></span></code><span class="hljs-string"><span class="hljs-string">      .        2 .     : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string"> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><code><span class="hljs-string"><span class="hljs-string">id tuple</span></span></code><span class="hljs-string"><span class="hljs-string">  Id  .. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    5  Azure,       Push .       Azure Custom Api  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">    </span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : '</span></span>Hello World!<span class="hljs-string"><span class="hljs-string">' }); console.log('</span></span>Incoming <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> requst: <span class="hljs-string"><span class="hljs-string">', request.body.RequestId); var usersTable = request.service.tables.getTable('</span></span><span class="hljs-keyword"><span class="hljs-keyword">User</span></span><span class="hljs-string"><span class="hljs-string">'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('</span></span>Send <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> results: <span class="hljs-string"><span class="hljs-string">', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('</span></span>Push notification sent: <span class="hljs-string"><span class="hljs-string">', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('</span></span>Error sending push notification: <span class="hljs-string"><span class="hljs-string">', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('</span></span>Error <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span>: <span class="hljs-string"><span class="hljs-string">', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    Push      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       ,    </span></span><code><span class="hljs-string"><span class="hljs-string">let-bang</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">do!</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      Google Play Services.     F#   .           .    : </span></span><i><span class="hljs-string"><span class="hljs-string">Xamarin.Android.Support.v7.AppCompat</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     , Google Play Services ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       </span></span><a href="http://developer.android.com/google/gcm/client.html"><span class="hljs-string"><span class="hljs-string">developer.android.com</span></span></a><span class="hljs-string"><span class="hljs-string"> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string">    , -  </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><a href="https://bitbucket.org/xakpc/whereareyou"><span class="hljs-string"><span class="hljs-string">bitbucket.org/xakpc/whereareyou</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,     </span></span><br><span class="hljs-string"><span class="hljs-string">          ,           "" . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> ,   Android   F#.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       -  Android  F#.   ,       .</span></span></code></code> </pre> <code><code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> <ol><li> <code><code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> </li> <li> <code><code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> <pre> <code class="hljs pgsql"><code>listView.Adapter &lt;- <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>) <br>  , ,  let <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> Fun <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> : string) = use md5 = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>.Cryptography.MD5.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> |&gt; <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Text.<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string CreateMD5Hash (string <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>) { MD5 md5 = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>.Cryptography.MD5.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>(); byte[] inputBytes = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Text.<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.ASCII.GetBytes (<span class="hljs-keyword"><span class="hljs-keyword">input</span></span>); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> StringBuilder(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Resources\Resource.designer.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Properties\AssemblyInfo.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Helpers\Helpers.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Services\User.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Services\AzureServiceWorker.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="IAmHereActivity.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="WhereAreYouActivity.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task<span class="hljs-string"><span class="hljs-string">',      .     F#         Task.  ,     : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         </span></span><code><span class="hljs-string"><span class="hljs-string">Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</span></span></code><span class="hljs-string"><span class="hljs-string">       </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">            </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars ['</span></span> <span class="hljs-string"><span class="hljs-string">';'</span></span>-<span class="hljs-string"><span class="hljs-string">';'</span></span>(<span class="hljs-string"><span class="hljs-string">';'</span></span>)<span class="hljs-string"><span class="hljs-string">'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">book.ToList()</span></span></code><span class="hljs-string"><span class="hljs-string">   List </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</span></span></code><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.map ExtractUserInfo</span></span></code><span class="hljs-string"><span class="hljs-string">      Contracts  UserInfo,      UserInfo </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.toList</span></span></code><span class="hljs-string"><span class="hljs-string">   List </span></span><code><span class="hljs-string"><span class="hljs-string">_contacts &lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">    mutable  </span></span><code><span class="hljs-string"><span class="hljs-string">_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">    UserInfo  string,     - -    </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.toArray&lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">  List  Array    ArrayAdapter </span></span><br><span class="hljs-string"><span class="hljs-string">    -      List.   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> Azure Mobile Servcies </span></span><br><span class="hljs-string"><span class="hljs-string">   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    </span></span><code><code><br><span class="hljs-string"><span class="hljs-string"> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><s><span class="hljs-string"><span class="hljs-string"></span></span></s><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">member this.RegisterMe phone name regId = async {</span></span></code><span class="hljs-string"><span class="hljs-string"> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string"> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</span></span></code><span class="hljs-string"><span class="hljs-string">  do-bang,   </span></span><code><span class="hljs-string"><span class="hljs-string">await</span></span></code><span class="hljs-string"><span class="hljs-string">  C#. ..             continuation    . </span></span><code><span class="hljs-string"><span class="hljs-string">return (usr.Id, usr.PhoneHash, usr.Nickname)</span></span></code><span class="hljs-string"><span class="hljs-string">      Tuple&lt;string,string,string&gt;     .  </span></span><code><span class="hljs-string"><span class="hljs-string">try ... with | e -&gt;</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">try..catch</span></span></code><span class="hljs-string"><span class="hljs-string">  C# </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       .  F#    </span></span><code><span class="hljs-string"><span class="hljs-string">fst</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">snd</span></span></code><span class="hljs-string"><span class="hljs-string">      .        2 .     : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string"> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><code><span class="hljs-string"><span class="hljs-string">id tuple</span></span></code><span class="hljs-string"><span class="hljs-string">  Id  .. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    5  Azure,       Push .       Azure Custom Api  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">    </span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : '</span></span>Hello World!<span class="hljs-string"><span class="hljs-string">' }); console.log('</span></span>Incoming <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> requst: <span class="hljs-string"><span class="hljs-string">', request.body.RequestId); var usersTable = request.service.tables.getTable('</span></span><span class="hljs-keyword"><span class="hljs-keyword">User</span></span><span class="hljs-string"><span class="hljs-string">'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('</span></span>Send <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> results: <span class="hljs-string"><span class="hljs-string">', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('</span></span>Push notification sent: <span class="hljs-string"><span class="hljs-string">', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('</span></span>Error sending push notification: <span class="hljs-string"><span class="hljs-string">', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('</span></span>Error <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span>: <span class="hljs-string"><span class="hljs-string">', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    Push      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       ,    </span></span><code><span class="hljs-string"><span class="hljs-string">let-bang</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">do!</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      Google Play Services.     F#   .           .    : </span></span><i><span class="hljs-string"><span class="hljs-string">Xamarin.Android.Support.v7.AppCompat</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     , Google Play Services ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       </span></span><a href="http://developer.android.com/google/gcm/client.html"><span class="hljs-string"><span class="hljs-string">developer.android.com</span></span></a><span class="hljs-string"><span class="hljs-string"> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string">    , -  </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><a href="https://bitbucket.org/xakpc/whereareyou"><span class="hljs-string"><span class="hljs-string">bitbucket.org/xakpc/whereareyou</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,     </span></span><br><span class="hljs-string"><span class="hljs-string">          ,           "" . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> ,   Android   F#.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       -  Android  F#.   ,       .</span></span></code></code> </pre></li><li> <code><code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> </li> <li> <code><code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> </li> <li> <code><code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> </li> </ol> <code><code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> <div style="text-align:center;"> <code><code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> </div> <code><code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> <pre> <code class="hljs pgsql"><code>listView.Adapter &lt;- <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>) <br>  , ,  let <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> Fun <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> : string) = use md5 = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>.Cryptography.MD5.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> |&gt; <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Text.<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string CreateMD5Hash (string <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>) { MD5 md5 = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>.Cryptography.MD5.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>(); byte[] inputBytes = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Text.<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.ASCII.GetBytes (<span class="hljs-keyword"><span class="hljs-keyword">input</span></span>); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> StringBuilder(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Resources\Resource.designer.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Properties\AssemblyInfo.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Helpers\Helpers.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Services\User.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Services\AzureServiceWorker.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="IAmHereActivity.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="WhereAreYouActivity.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task<span class="hljs-string"><span class="hljs-string">',      .     F#         Task.  ,     : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         </span></span><code><span class="hljs-string"><span class="hljs-string">Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</span></span></code><span class="hljs-string"><span class="hljs-string">       </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">            </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars ['</span></span> <span class="hljs-string"><span class="hljs-string">';'</span></span>-<span class="hljs-string"><span class="hljs-string">';'</span></span>(<span class="hljs-string"><span class="hljs-string">';'</span></span>)<span class="hljs-string"><span class="hljs-string">'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">book.ToList()</span></span></code><span class="hljs-string"><span class="hljs-string">   List </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</span></span></code><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.map ExtractUserInfo</span></span></code><span class="hljs-string"><span class="hljs-string">      Contracts  UserInfo,      UserInfo </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.toList</span></span></code><span class="hljs-string"><span class="hljs-string">   List </span></span><code><span class="hljs-string"><span class="hljs-string">_contacts &lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">    mutable  </span></span><code><span class="hljs-string"><span class="hljs-string">_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">    UserInfo  string,     - -    </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.toArray&lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">  List  Array    ArrayAdapter </span></span><br><span class="hljs-string"><span class="hljs-string">    -      List.   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> Azure Mobile Servcies </span></span><br><span class="hljs-string"><span class="hljs-string">   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    </span></span><code><code><br><span class="hljs-string"><span class="hljs-string"> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><s><span class="hljs-string"><span class="hljs-string"></span></span></s><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">member this.RegisterMe phone name regId = async {</span></span></code><span class="hljs-string"><span class="hljs-string"> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string"> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</span></span></code><span class="hljs-string"><span class="hljs-string">  do-bang,   </span></span><code><span class="hljs-string"><span class="hljs-string">await</span></span></code><span class="hljs-string"><span class="hljs-string">  C#. ..             continuation    . </span></span><code><span class="hljs-string"><span class="hljs-string">return (usr.Id, usr.PhoneHash, usr.Nickname)</span></span></code><span class="hljs-string"><span class="hljs-string">      Tuple&lt;string,string,string&gt;     .  </span></span><code><span class="hljs-string"><span class="hljs-string">try ... with | e -&gt;</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">try..catch</span></span></code><span class="hljs-string"><span class="hljs-string">  C# </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       .  F#    </span></span><code><span class="hljs-string"><span class="hljs-string">fst</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">snd</span></span></code><span class="hljs-string"><span class="hljs-string">      .        2 .     : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string"> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><code><span class="hljs-string"><span class="hljs-string">id tuple</span></span></code><span class="hljs-string"><span class="hljs-string">  Id  .. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    5  Azure,       Push .       Azure Custom Api  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">    </span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : '</span></span>Hello World!<span class="hljs-string"><span class="hljs-string">' }); console.log('</span></span>Incoming <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> requst: <span class="hljs-string"><span class="hljs-string">', request.body.RequestId); var usersTable = request.service.tables.getTable('</span></span><span class="hljs-keyword"><span class="hljs-keyword">User</span></span><span class="hljs-string"><span class="hljs-string">'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('</span></span>Send <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> results: <span class="hljs-string"><span class="hljs-string">', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('</span></span>Push notification sent: <span class="hljs-string"><span class="hljs-string">', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('</span></span>Error sending push notification: <span class="hljs-string"><span class="hljs-string">', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('</span></span>Error <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span>: <span class="hljs-string"><span class="hljs-string">', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    Push      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       ,    </span></span><code><span class="hljs-string"><span class="hljs-string">let-bang</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">do!</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      Google Play Services.     F#   .           .    : </span></span><i><span class="hljs-string"><span class="hljs-string">Xamarin.Android.Support.v7.AppCompat</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     , Google Play Services ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       </span></span><a href="http://developer.android.com/google/gcm/client.html"><span class="hljs-string"><span class="hljs-string">developer.android.com</span></span></a><span class="hljs-string"><span class="hljs-string"> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string">    , -  </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><a href="https://bitbucket.org/xakpc/whereareyou"><span class="hljs-string"><span class="hljs-string">bitbucket.org/xakpc/whereareyou</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,     </span></span><br><span class="hljs-string"><span class="hljs-string">          ,           "" . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> ,   Android   F#.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       -  Android  F#.   ,       .</span></span></code></code> </pre> <code><code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> <div class="spoiler"> <code><code><b class="spoiler_title"><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br>      <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</b></code></code> <div class="spoiler_text"> <pre> <code class="hljs pgsql"><code>listView.Adapter &lt;- <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>) <br>  , ,  let <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> Fun <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> : string) = use md5 = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>.Cryptography.MD5.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> |&gt; <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Text.<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string CreateMD5Hash (string <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>) { MD5 md5 = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>.Cryptography.MD5.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>(); byte[] inputBytes = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Text.<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.ASCII.GetBytes (<span class="hljs-keyword"><span class="hljs-keyword">input</span></span>); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> StringBuilder(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Resources\Resource.designer.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Properties\AssemblyInfo.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Helpers\Helpers.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Services\User.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Services\AzureServiceWorker.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="IAmHereActivity.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="WhereAreYouActivity.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task<span class="hljs-string"><span class="hljs-string">',      .     F#         Task.  ,     : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         </span></span><code><span class="hljs-string"><span class="hljs-string">Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</span></span></code><span class="hljs-string"><span class="hljs-string">       </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">            </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars ['</span></span> <span class="hljs-string"><span class="hljs-string">';'</span></span>-<span class="hljs-string"><span class="hljs-string">';'</span></span>(<span class="hljs-string"><span class="hljs-string">';'</span></span>)<span class="hljs-string"><span class="hljs-string">'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">book.ToList()</span></span></code><span class="hljs-string"><span class="hljs-string">   List </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</span></span></code><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.map ExtractUserInfo</span></span></code><span class="hljs-string"><span class="hljs-string">      Contracts  UserInfo,      UserInfo </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.toList</span></span></code><span class="hljs-string"><span class="hljs-string">   List </span></span><code><span class="hljs-string"><span class="hljs-string">_contacts &lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">    mutable  </span></span><code><span class="hljs-string"><span class="hljs-string">_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">    UserInfo  string,     - -    </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.toArray&lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">  List  Array    ArrayAdapter </span></span><br><span class="hljs-string"><span class="hljs-string">    -      List.   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> Azure Mobile Servcies </span></span><br><span class="hljs-string"><span class="hljs-string">   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    </span></span><code><code><br><span class="hljs-string"><span class="hljs-string"> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><s><span class="hljs-string"><span class="hljs-string"></span></span></s><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">member this.RegisterMe phone name regId = async {</span></span></code><span class="hljs-string"><span class="hljs-string"> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string"> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</span></span></code><span class="hljs-string"><span class="hljs-string">  do-bang,   </span></span><code><span class="hljs-string"><span class="hljs-string">await</span></span></code><span class="hljs-string"><span class="hljs-string">  C#. ..             continuation    . </span></span><code><span class="hljs-string"><span class="hljs-string">return (usr.Id, usr.PhoneHash, usr.Nickname)</span></span></code><span class="hljs-string"><span class="hljs-string">      Tuple&lt;string,string,string&gt;     .  </span></span><code><span class="hljs-string"><span class="hljs-string">try ... with | e -&gt;</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">try..catch</span></span></code><span class="hljs-string"><span class="hljs-string">  C# </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       .  F#    </span></span><code><span class="hljs-string"><span class="hljs-string">fst</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">snd</span></span></code><span class="hljs-string"><span class="hljs-string">      .        2 .     : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string"> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><code><span class="hljs-string"><span class="hljs-string">id tuple</span></span></code><span class="hljs-string"><span class="hljs-string">  Id  .. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    5  Azure,       Push .       Azure Custom Api  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">    </span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : '</span></span>Hello World!<span class="hljs-string"><span class="hljs-string">' }); console.log('</span></span>Incoming <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> requst: <span class="hljs-string"><span class="hljs-string">', request.body.RequestId); var usersTable = request.service.tables.getTable('</span></span><span class="hljs-keyword"><span class="hljs-keyword">User</span></span><span class="hljs-string"><span class="hljs-string">'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('</span></span>Send <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> results: <span class="hljs-string"><span class="hljs-string">', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('</span></span>Push notification sent: <span class="hljs-string"><span class="hljs-string">', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('</span></span>Error sending push notification: <span class="hljs-string"><span class="hljs-string">', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('</span></span>Error <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span>: <span class="hljs-string"><span class="hljs-string">', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    Push      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       ,    </span></span><code><span class="hljs-string"><span class="hljs-string">let-bang</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">do!</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      Google Play Services.     F#   .           .    : </span></span><i><span class="hljs-string"><span class="hljs-string">Xamarin.Android.Support.v7.AppCompat</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     , Google Play Services ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       </span></span><a href="http://developer.android.com/google/gcm/client.html"><span class="hljs-string"><span class="hljs-string">developer.android.com</span></span></a><span class="hljs-string"><span class="hljs-string"> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string">    , -  </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><a href="https://bitbucket.org/xakpc/whereareyou"><span class="hljs-string"><span class="hljs-string">bitbucket.org/xakpc/whereareyou</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,     </span></span><br><span class="hljs-string"><span class="hljs-string">          ,           "" . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> ,   Android   F#.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       -  Android  F#.   ,       .</span></span></code></code> </pre> <code><code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> </div></div> <code><code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> <pre> <code class="hljs pgsql"><code>listView.Adapter &lt;- <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>) <br>  , ,  let <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> Fun <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> : string) = use md5 = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>.Cryptography.MD5.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> |&gt; <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Text.<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string CreateMD5Hash (string <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>) { MD5 md5 = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>.Cryptography.MD5.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>(); byte[] inputBytes = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Text.<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.ASCII.GetBytes (<span class="hljs-keyword"><span class="hljs-keyword">input</span></span>); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> StringBuilder(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Resources\Resource.designer.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Properties\AssemblyInfo.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Helpers\Helpers.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Services\User.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Services\AzureServiceWorker.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="IAmHereActivity.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="WhereAreYouActivity.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task<span class="hljs-string"><span class="hljs-string">',      .     F#         Task.  ,     : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         </span></span><code><span class="hljs-string"><span class="hljs-string">Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</span></span></code><span class="hljs-string"><span class="hljs-string">       </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">            </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars ['</span></span> <span class="hljs-string"><span class="hljs-string">';'</span></span>-<span class="hljs-string"><span class="hljs-string">';'</span></span>(<span class="hljs-string"><span class="hljs-string">';'</span></span>)<span class="hljs-string"><span class="hljs-string">'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">book.ToList()</span></span></code><span class="hljs-string"><span class="hljs-string">   List </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</span></span></code><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.map ExtractUserInfo</span></span></code><span class="hljs-string"><span class="hljs-string">      Contracts  UserInfo,      UserInfo </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.toList</span></span></code><span class="hljs-string"><span class="hljs-string">   List </span></span><code><span class="hljs-string"><span class="hljs-string">_contacts &lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">    mutable  </span></span><code><span class="hljs-string"><span class="hljs-string">_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">    UserInfo  string,     - -    </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.toArray&lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">  List  Array    ArrayAdapter </span></span><br><span class="hljs-string"><span class="hljs-string">    -      List.   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> Azure Mobile Servcies </span></span><br><span class="hljs-string"><span class="hljs-string">   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    </span></span><code><code><br><span class="hljs-string"><span class="hljs-string"> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><s><span class="hljs-string"><span class="hljs-string"></span></span></s><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">member this.RegisterMe phone name regId = async {</span></span></code><span class="hljs-string"><span class="hljs-string"> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string"> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</span></span></code><span class="hljs-string"><span class="hljs-string">  do-bang,   </span></span><code><span class="hljs-string"><span class="hljs-string">await</span></span></code><span class="hljs-string"><span class="hljs-string">  C#. ..             continuation    . </span></span><code><span class="hljs-string"><span class="hljs-string">return (usr.Id, usr.PhoneHash, usr.Nickname)</span></span></code><span class="hljs-string"><span class="hljs-string">      Tuple&lt;string,string,string&gt;     .  </span></span><code><span class="hljs-string"><span class="hljs-string">try ... with | e -&gt;</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">try..catch</span></span></code><span class="hljs-string"><span class="hljs-string">  C# </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       .  F#    </span></span><code><span class="hljs-string"><span class="hljs-string">fst</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">snd</span></span></code><span class="hljs-string"><span class="hljs-string">      .        2 .     : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string"> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><code><span class="hljs-string"><span class="hljs-string">id tuple</span></span></code><span class="hljs-string"><span class="hljs-string">  Id  .. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    5  Azure,       Push .       Azure Custom Api  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">    </span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : '</span></span>Hello World!<span class="hljs-string"><span class="hljs-string">' }); console.log('</span></span>Incoming <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> requst: <span class="hljs-string"><span class="hljs-string">', request.body.RequestId); var usersTable = request.service.tables.getTable('</span></span><span class="hljs-keyword"><span class="hljs-keyword">User</span></span><span class="hljs-string"><span class="hljs-string">'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('</span></span>Send <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> results: <span class="hljs-string"><span class="hljs-string">', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('</span></span>Push notification sent: <span class="hljs-string"><span class="hljs-string">', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('</span></span>Error sending push notification: <span class="hljs-string"><span class="hljs-string">', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('</span></span>Error <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span>: <span class="hljs-string"><span class="hljs-string">', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    Push      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       ,    </span></span><code><span class="hljs-string"><span class="hljs-string">let-bang</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">do!</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      Google Play Services.     F#   .           .    : </span></span><i><span class="hljs-string"><span class="hljs-string">Xamarin.Android.Support.v7.AppCompat</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     , Google Play Services ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       </span></span><a href="http://developer.android.com/google/gcm/client.html"><span class="hljs-string"><span class="hljs-string">developer.android.com</span></span></a><span class="hljs-string"><span class="hljs-string"> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string">    , -  </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><a href="https://bitbucket.org/xakpc/whereareyou"><span class="hljs-string"><span class="hljs-string">bitbucket.org/xakpc/whereareyou</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,     </span></span><br><span class="hljs-string"><span class="hljs-string">          ,           "" . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> ,   Android   F#.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       -  Android  F#.   ,       .</span></span></code></code> </pre> <code><code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> <h4> <code><code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> </h4> <code><code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> <div style="text-align:center;"> <code><code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> </div> <code><code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> <pre> <code class="hljs pgsql"><code>listView.Adapter &lt;- <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>) <br>  , ,  let <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> Fun <span class="hljs-keyword"><span class="hljs-keyword">And</span></span> Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> : string) = use md5 = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>.Cryptography.MD5.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> |&gt; <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Text.<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string CreateMD5Hash (string <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>) { MD5 md5 = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>.Cryptography.MD5.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>(); byte[] inputBytes = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Text.<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.ASCII.GetBytes (<span class="hljs-keyword"><span class="hljs-keyword">input</span></span>); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> StringBuilder(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Resources\Resource.designer.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Properties\AssemblyInfo.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Helpers\Helpers.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Services\User.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="Services\AzureServiceWorker.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="IAmHereActivity.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="WhereAreYouActivity.fs" /&gt; &lt;Compile <span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task<span class="hljs-string"><span class="hljs-string">',      .     F#         Task.  ,     : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">         </span></span><code><span class="hljs-string"><span class="hljs-string">Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</span></span></code><span class="hljs-string"><span class="hljs-string">       </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">            </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars ['</span></span> <span class="hljs-string"><span class="hljs-string">';'</span></span>-<span class="hljs-string"><span class="hljs-string">';'</span></span>(<span class="hljs-string"><span class="hljs-string">';'</span></span>)<span class="hljs-string"><span class="hljs-string">'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">book.ToList()</span></span></code><span class="hljs-string"><span class="hljs-string">   List </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</span></span></code><span class="hljs-string"><span class="hljs-string">      </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.map ExtractUserInfo</span></span></code><span class="hljs-string"><span class="hljs-string">      Contracts  UserInfo,      UserInfo </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.toList</span></span></code><span class="hljs-string"><span class="hljs-string">   List </span></span><code><span class="hljs-string"><span class="hljs-string">_contacts &lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">    mutable  </span></span><code><span class="hljs-string"><span class="hljs-string">_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">    UserInfo  string,     - -    </span></span><code><span class="hljs-string"><span class="hljs-string">|&gt; Seq.toArray&lt;-</span></span></code><span class="hljs-string"><span class="hljs-string">  List  Array    ArrayAdapter </span></span><br><span class="hljs-string"><span class="hljs-string">    -      List.   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> Azure Mobile Servcies </span></span><br><span class="hljs-string"><span class="hljs-string">   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      ,    </span></span><code><code><br><span class="hljs-string"><span class="hljs-string"> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><s><span class="hljs-string"><span class="hljs-string"></span></span></s><span class="hljs-string"><span class="hljs-string">    </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">member this.RegisterMe phone name regId = async {</span></span></code><span class="hljs-string"><span class="hljs-string"> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string"> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</span></span></code><span class="hljs-string"><span class="hljs-string">  do-bang,   </span></span><code><span class="hljs-string"><span class="hljs-string">await</span></span></code><span class="hljs-string"><span class="hljs-string">  C#. ..             continuation    . </span></span><code><span class="hljs-string"><span class="hljs-string">return (usr.Id, usr.PhoneHash, usr.Nickname)</span></span></code><span class="hljs-string"><span class="hljs-string">      Tuple&lt;string,string,string&gt;     .  </span></span><code><span class="hljs-string"><span class="hljs-string">try ... with | e -&gt;</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">try..catch</span></span></code><span class="hljs-string"><span class="hljs-string">  C# </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       .  F#    </span></span><code><span class="hljs-string"><span class="hljs-string">fst</span></span></code><span class="hljs-string"><span class="hljs-string">  </span></span><code><span class="hljs-string"><span class="hljs-string">snd</span></span></code><span class="hljs-string"><span class="hljs-string">      .        2 .     : </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string"> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    : </span></span><code><span class="hljs-string"><span class="hljs-string">id tuple</span></span></code><span class="hljs-string"><span class="hljs-string">  Id  .. </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    5  Azure,       Push .       Azure Custom Api  </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><b class="spoiler_title"><span class="hljs-string"><span class="hljs-string">    </span></span></b><span class="hljs-string"><span class="hljs-string"> </span></span><code class="javascript"><span class="hljs-string"><span class="hljs-string">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : '</span></span>Hello World!<span class="hljs-string"><span class="hljs-string">' }); console.log('</span></span>Incoming <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> requst: <span class="hljs-string"><span class="hljs-string">', request.body.RequestId); var usersTable = request.service.tables.getTable('</span></span><span class="hljs-keyword"><span class="hljs-keyword">User</span></span><span class="hljs-string"><span class="hljs-string">'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('</span></span>Send <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> results: <span class="hljs-string"><span class="hljs-string">', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('</span></span>Push notification sent: <span class="hljs-string"><span class="hljs-string">', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('</span></span>Error sending push notification: <span class="hljs-string"><span class="hljs-string">', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('</span></span>Error <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span>: <span class="hljs-string"><span class="hljs-string">', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    Push      </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">       ,    </span></span><code><span class="hljs-string"><span class="hljs-string">let-bang</span></span></code><span class="hljs-string"><span class="hljs-string">   </span></span><code><span class="hljs-string"><span class="hljs-string">do!</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">   </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      Google Play Services.     F#   .           .    : </span></span><i><span class="hljs-string"><span class="hljs-string">Xamarin.Android.Support.v7.AppCompat</span></span></i><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     , Google Play Services ,   . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       </span></span><a href="http://developer.android.com/google/gcm/client.html"><span class="hljs-string"><span class="hljs-string">developer.android.com</span></span></a><span class="hljs-string"><span class="hljs-string"> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><code><span class="hljs-string"><span class="hljs-string">//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</span></span></code><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">        </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">    . </span></span><br><span class="hljs-string"><span class="hljs-string">    , -  </span></span><br><span class="hljs-string"><span class="hljs-string">     </span></span><a href="https://bitbucket.org/xakpc/whereareyou"><span class="hljs-string"><span class="hljs-string">bitbucket.org/xakpc/whereareyou</span></span></a><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">     ,     </span></span><br><span class="hljs-string"><span class="hljs-string">          ,           "" . </span></span><br><span class="hljs-string"><span class="hljs-string"> </span></span><br><span class="hljs-string"><span class="hljs-string">  </span></span><br><span class="hljs-string"><span class="hljs-string"> ,   Android   F#.      . </span></span><br><span class="hljs-string"><span class="hljs-string"> ,       -  Android  F#.   ,       .</span></span></code></code> </pre> <code><code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> <div style="text-align:center;"> <code><code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> </div> <code><code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> <h4> <code><code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> </h4> <code><code><code>listView.Adapter &lt;- new ArrayAdapter(this, Android.Resource.Layout.SimpleListItem1, Android.Resource.Id.Text1, values) <br>  , ,  let values = [|"item1"; "item2"; "item3"|]</code> -   string[],       list (IEnumerable   ) <br>          F#.            <a href="http://www.tryfsharp.org/Learn/">www.tryfsharp.org/Learn</a> <br> <img src="https://habrastorage.org/getpro/habr/post_images/409/e22/9ac/409e229ac7bc0a6a235277641477f6e5.png"> <br>      F# -  ,  <br> <br>        <a href="http://fsharpforfunandprofit.com/">F# For Fun And Profit</a> <br> <br>   ,    <br>     - . <br> <br> <img height="400" src="https://habrastorage.org/getpro/habr/post_images/3ef/57d/ade/3ef57dade86ad45ffe261e851ea8de9d.png"> <br> <br>        hash <br>     MD5  F# <br> <code> let MD5Hash (input : string) = use md5 = System.Security.Cryptography.MD5.Create() input |&gt; System.Text.Encoding.ASCII.GetBytes |&gt; md5.ComputeHash |&gt; Seq.map (fun c -&gt; c.ToString("X2")) |&gt; Seq.reduce (+)</code> <br> <br>  <code>|&gt;</code>  pipeline ,     . <br>     :    GetBytes -&gt;   -&gt;      HEX  -&gt;       ( <i> reduce   +          </i> ) -&gt;    . <br> <br> <b class="spoiler_title"> ,     C#</b> <code>using System; public string CreateMD5Hash (string input) { MD5 md5 = System.Security.Cryptography.MD5.Create(); byte[] inputBytes = System.Text.Encoding.ASCII.GetBytes (input); byte[] hashBytes = md5.ComputeHash (inputBytes); StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; hashBytes.Length; i++) { sb.Append (hashBytes[i].ToString ("X2")); } return sb.ToString(); }</code> <br> <br> <br>          :        .       AzureServiceWorker (  CLR    ) <br> <br>          -   .   F# <b>  </b> !   Xamarin Studio            . <br> <code class="xml"> &lt;ItemGroup&gt; &lt;Compile Include="Resources\Resource.designer.fs" /&gt; &lt;Compile Include="Properties\AssemblyInfo.fs" /&gt; &lt;Compile Include="Helpers\Helpers.fs" /&gt; &lt;Compile Include="Services\User.fs" /&gt; &lt;Compile Include="Services\AzureServiceWorker.fs" /&gt; &lt;Compile Include="IAmHereActivity.fs" /&gt; &lt;Compile Include="WhereAreYouActivity.fs" /&gt; &lt;Compile Include="SignInActivity.fs" /&gt; &lt;/ItemGroup&gt;</code> <br> <br>    <br>        :    .    Xamarin    Xamarin.Mobile <br> <br>      .  F#         TPL,     Task',      .     F#         Task.  ,     : <br> <code>module Async = open System.Threading open System.Threading.Tasks let inline AwaitPlainTask (task: Task) = // rethrow exception from preceding task if it fauled let continuation (t : Task) : unit = match t.IsFaulted with | true -&gt; raise t.Exception | arg -&gt; () task.ContinueWith continuation |&gt; Async.AwaitTask</code> <br>         <code>Async.AwaitIAsyncResult &gt;&gt; Async.Ignore</code>       <br> <br>            <br> <code>let ExtractUserInfo (x : Contact) = let first = x.Phones |&gt; Seq.tryPick(fun x -&gt; if x.Type = PhoneType.Mobile then Some(x) else None) match first with | Some(first) -&gt; let phone = first.Number |&gt; StripChars [' ';'-';'(';')'] UserInfo.CreateUserInfo((MD5Hash phone), phone, x.DisplayName) | None -&gt; UserInfo.CreateUserInfo("no mobile phone", "no mobile phone", "no mobile phone") // function for async list filling let FillContactsAsync = async { let book = new AddressBook (this) let! result = book.RequestPermission() |&gt; Async.AwaitTask if result then _contacts &lt;- book.ToList() |&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones)) |&gt; Seq.map ExtractUserInfo |&gt; Seq.sortBy(fun x -&gt; x.DisplayName) |&gt; Seq.toList let finalContacts = _contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant()) |&gt; Seq.toArray this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, finalContacts) else System.Diagnostics.Debug.WriteLine("Permission denied by user or manifest") this.ListAdapter &lt;- new ArrayAdapter(this, Resource_Layout.row_contact, Array.empty) }</code> <br>      <br> <code>book.ToList()</code>   List <code>|&gt; Seq.filter (fun (x: Contact) -&gt; not (Seq.isEmpty x.Phones))</code>      <code>|&gt; Seq.map ExtractUserInfo</code>      Contracts  UserInfo,      UserInfo <code>|&gt; Seq.sortBy(fun x -&gt; x.DisplayName)</code>  <code>|&gt; Seq.toList</code>   List <code>_contacts &lt;-</code>    mutable  <code>_contacts |&gt; Seq.map (fun x -&gt; x.DisplayName.ToUpperInvariant())&lt;-</code>    UserInfo  string,     - -    <code>|&gt; Seq.toArray&lt;-</code>  List  Array    ArrayAdapter <br>    -      List.   . <br> <br> <img height="400" src="//habrastorage.org/files/51d/2f6/242/51d2f624208e4a9da32a73f0b2a9246d.png"> <br> <br> Azure Mobile Servcies <br>   -    Azure Mobile Services.       NotificationHub,     Push    .   Azure    , ..      . <br> <br>      ,    <code><br> module WruConstants = [&lt;Literal&gt;] let TotallyNotAzureServer = "https://YOUR.azure-mobile.net/"; [&lt;Literal&gt;] let TotallyNotAzureKey = "YOUR"</code> <br> <br>   <s></s>    <br> <code>member this.RegisterMe phone name regId = async { try let table = this.MobileService.GetTable&lt;User&gt;() let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId } do! table.InsertAsync usr |&gt; Async.AwaitPlainTask return (usr.Id, usr.PhoneHash, usr.Nickname) with | e -&gt; System.Diagnostics.Trace.WriteLine(e.ToString) return (String.Empty,String.Empty,String.Empty) }</code> <br> <code>member this.RegisterMe phone name regId = async {</code> -       (     )    .       "computation expression"   workflow.   { }       ! ( bang),  do! (do-bang)  let! (let bang)     User.    ,  F#        ,      <br> <code> let usr = { Id = "" PhoneHash = MD5Hash phone Nickname = name RegistrationId = regId }</code> <code>do! table.InsertAsync usr |&gt; Async.AwaitPlainTask</code>  do-bang,   <code>await</code>  C#. ..             continuation    . <code>return (usr.Id, usr.PhoneHash, usr.Nickname)</code>      Tuple&lt;string,string,string&gt;     .  <code>try ... with | e -&gt;</code>  <code>try..catch</code>  C# <br> <br> <img height="400" src="//habrastorage.org/files/c21/7d3/9bd/c217d39bd1cc4f5da56402fcff59f884.png"> <br> <br>       .  F#    <code>fst</code>  <code>snd</code>      .        2 .     : <br> <code> let id (c,_,_) = c let phonehash (_,c,_) = c let nickname (_,_,c) = c</code> <br>    : <code>id tuple</code>  Id  .. <br> <br>    5  Azure,       Push .       Azure Custom Api  <br> <br> <b class="spoiler_title">    </b> <code class="javascript">exports.post = function(request, response) { // Use "request.service" to access features of your mobile service, eg: // var tables = request.service.tables; // var push = request.service.push; //response.send(statusCodes.OK, { message : 'Hello World!' }); console.log('Incoming call with requst: ', request.body.RequestId); var usersTable = request.service.tables.getTable('User'); usersTable.where( { id : request.body.TargetId } ) .read( { success: function(results) { if (results.length &gt; 0) { var user = results[0] console.log('Send to results: ', user.Nickname, user.RegistrationId); request.service.push.gcm.send(user.RegistrationId, { RequesterId: request.body.RequesterId, RequesterNickname: request.body.RequesterName, TargetId: user.id, TargetNickname: user.Nickname }, { success: function(gcm_response) { console.log('Push notification sent: ', gcm_response); response.send(statusCodes.OK, { RequestedNickname : user.Nickname }); }, error: function(gcm_error) { console.log('Error sending push notification: ', gcm_error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : user.Nickname }); } }); } else { response.send(statusCodes.NO_CONTENT, { RequestedNickname : "" }); } }, error: function(error) { console.log('Error read table: ', error); response.send(statusCodes.INTERNAL_SERVER_ERROR, { RequestedNickname : "" }); } }); };</code> <br> <br>    Push      <br> <code>// Perform Push operation member this.PushAsync targetId myId myNickname = async { try let (request : PushRequest) = { TargetId = targetId RequesterId = myId RequesterName = myNickname } let! result = this.MobileService.InvokeApiAsync&lt;PushRequest, PushResponce&gt;("pushhim", request) |&gt; Async.AwaitTask return result.RequestedNickname with | e -&gt; return e.ToString() }</code> <br> <br>       ,    <code>let-bang</code>   <code>do!</code> <br> <br>   <br> <br> <img height="400" src="//habrastorage.org/files/5d1/2d2/3c1/5d12d23c17cf4048864c53048454bd9d.png"> <br>      Google Play Services.     F#   .           .    : <i>Xamarin.Android.Support.v7.AppCompat</i> <br>     , Google Play Services ,   . <br> <br>      push notification   .    GCM,  ID,     ID       Push  (.   pushhim).        BroadcastReciever       <a href="http://developer.android.com/google/gcm/client.html">developer.android.com</a> .     F#         Xamarin Component Store.     Google Cloud Messaging Client         GCM    .        ID <br> <code>//Check to see that GCM is supported and that the manifest has the correct information GcmClient.CheckDevice(this) GcmClient.CheckManifest(this) // check google play if CheckPlayServices() then // Try to get registration id let regId = GcmClient.GetRegistrationId this if String.IsNullOrEmpty(regId) then // Call to Register the device for Push Notifications GcmClient.Register(this, WruConstants.GcmSender);</code> <br> <br> <img height="400" src="//habrastorage.org/files/085/ce2/070/085ce2070e4e4e718038177424d494d0.png"> <br>        <br> <br>    . <br>    , -  <br>     <a href="https://bitbucket.org/xakpc/whereareyou">bitbucket.org/xakpc/whereareyou</a> <br>     ,     <br>          ,           "" . <br> <br>  <br> ,   Android   F#.      . <br> ,       -  Android  F#.   ,       .</code></code> </div><p>Source: <a href="https://habr.com/ru/post/228783/">https://habr.com/ru/post/228783/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../228761/index.html">MKI game station: an exhibition of game consoles at the Exhibition of Economic Achievements, where almost everything can be touched</a></li>
<li><a href="../228771/index.html">Tricky canister</a></li>
<li><a href="../228777/index.html">Solitaire finances sing romance</a></li>
<li><a href="../228779/index.html">802.11ad (WiGig) - range and utility</a></li>
<li><a href="../228781/index.html">Krita for Krita: new functionality for Krita 2.9</a></li>
<li><a href="../228787/index.html">Ten millionth backup script</a></li>
<li><a href="../228789/index.html">Python-digest # 31. News, interesting projects, articles and interviews [June 8, 2014 - July 6, 2014] Revival</a></li>
<li><a href="../228793/index.html">Huge pages in postgreSQL</a></li>
<li><a href="../228795/index.html">Three stages of development of any service or something in common with McDonalds and IBM Watson</a></li>
<li><a href="../228803/index.html">Summer review of space affairs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>