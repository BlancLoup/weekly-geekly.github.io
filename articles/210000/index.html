<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>An inside view or infrastructure of the Likeastore project</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In a relatively short time, we managed to try and change a lot of decisions that directly or indirectly affect the product. Today, I would like to rev...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>An inside view or infrastructure of the Likeastore project</h1><div class="post__text post__text-html js-mediator-article">  In a relatively short time, we managed to try and change a lot of decisions that directly or indirectly affect the product.  Today, I would like to review the infrastructure around the <a href="https://likeastore.com/">Likeastore</a> project.  This may be interesting to many developers thinking about their launch. <br><br>  I will go from hardware to software, from low infrastructure levels to higher ones.  For all the services that we use by subscription, I will specify prices.  There will be a small commentary for each item, but in the future, each of them can be opened more deeply in subsequent posts.  Go‚Ä¶ <br><a name="habracut"></a><br><h4>  A little story .. </h4><br>  From the very beginning, we started to focus on the clouds, because it is convenient.  The main requirement was for it to be PaaS ( <a href="https://www.appfog.com/">AppFog</a> , <a href="https://www.nodejitsu.com/">Nodejitsu</a> , <a href="https://www.heroku.com/">Heroku</a> , <a href="http://www.windowsazure.com/">Azure</a> ), and not IaaS ( <a href="http://aws.amazon.com/ec2/">EC2</a> , <a href="https://www.digitalocean.com/">DigitalOcean</a> , <a href="http://www.rackspace.com/">Rackspace</a> ).  Maintaining your own infrastructure is too ‚Äúgreat fun‚Äù for a startup. <br><br>  PaaS is a combination of virtual hardware and infrastructure deployment and scaling applications.  It was the convenience of deployment that was the main thing, since it was banal to think about big growth. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Our first experience was with <a href="https://www.appfog.com/">AppFog</a> .  At the time of the first experiments, they looked really attractive - 8 instances, 256 MB of memory for each.  The most important thing is ‚Äúdeployment by one team‚Äù through the client and cut it all for 20 bucks.  At first, everything was okay, but later negative moments began to open: a rather long deployment (30-40 sec), an uncomfortable cheap board, but most unpleasant, due to a problem in their load balancing system, AppFog constantly ‚Äúlost‚Äù server cookies, which made it impossible use the app. <br><br>  We had to leave for <a href="https://www.nodejitsu.com/">Nodejitsu</a> .  3 instances for $ 33, expensive compared to AppFog, but on the Nodejitsu the application worked, deployments went quickly, the deshborb was convenient and support was at a height.  I had to revise our architecture a bit to fit in 3 instances, but it was even for the better.  We had no particular complaints about Nodejitsu, except that their servers are located in the us-east-1 zone and for Europe this created noticeable ping latency. <br><br>  Happiness ended when we entered the public beta phase (summer 2013).  We clearly understood that we were working with personal data of the user, so the use of <code>http</code> was not acceptable.  Nodejitsu does not allow you to use SSL for Personal Plan with a custom domain.  Going to the Business Plan cost $ 120 a month. <br><br>  It was a "bummer" ... It was necessary to rent the server and do everything yourself, i.e.  essentially go back to IaaS solutions. <br><br><h4>  Hosting and iron </h4><br>  They decided to rent a server from <a href="https://www.digitalocean.com/%3Frefcode%3Dde56d081b272">DigitalOcean</a> .  We chose by price, but time has shown that DigitalOcean is a reliable and convenient partner. <br><br>  By the time of our transition to DigitalOcean, they launched support in the AMS1 zone (Amsterdam) and we were one of the first droplets in this zone.  Can not say.  that everything was perfectly smooth from the very beginning, but after moving the car to the European zone, the responsiveness of the application changed radically (to the best party).  This was especially noticeable from mobile devices. <br><br>  We started with the cheapest option: 512MB, 1CPU, 20GB SSD for just 5 bucks.  This was more than enough to start.  In this configuration, we have prospered up to the thousandth user.  Node.js is not the most "wasteful" platform in terms of resources and 512MB gives the opportunity for normal operation, but up to some load.  Over time, the most resource-intensive component of the collector (collection of likes) began to consume a lot of memory and trite to fall. <br><br>  We took a bigger droplet - 1GB, 1CPU, 30GB SDD for 10 bucks, and left the last one for our ‚Äústitch‚Äù environment.  Thus, the entire hosting cost us 15 bucks, with SSL support.  Almost 10 times more profitable than any PaaS solution.  Just recently, we switched to droplets with 2GB RAM / 2 CPU, and this configuration will last us for a long time. <br><br>  <i>"But DigitalOcean, this is not PaaS,"</i> you will object, and you will be right.  But we were able to bring it closer to that.  How? <br><br>  After ‚Äúhaving tasted‚Äù to overflow PaaS, it is extremely difficult to refuse them.  I could hardly imagine deployment via ftp or ssh, ‚Äúmanually‚Äù starting and stopping the node, configuring nginx, etc.  But by chance, I came across a project called <a href="https://github.com/progrium/dokku">dokku</a> , which greatly influenced the development of <a href="https://likeastore.com/">Likeastore</a> . <br><br>  Dokku allows you to turn a Ubuntu server into a mini-Heroku server, with the ability to deploy any (Node.js, Ruby, PHP, Static etc.) applications via git push.  Dokku is very easy to install and requires minimal configuration. <br><br><h4>  Deployment process </h4><br>  Dokku uses git as source transport to machine A (a development machine or an intergrate server) on machine B (a production machine) and a <a href="https://www.docker.io/">docker</a> to isolate executable processes and the launch environment.  dokku allows you to deploy the application with one command: <br><br> <code>git push production master <br></code> <br><br>  Each time an application is deployed from a ‚Äúclean‚Äù environment, the required version will be installed on this environment, all necessary dependencies will be installed, and so on.  dokku uses <a href="http://nginx.org/">nginx</a> , acting as a proxy for running containers, if necessary, the SSL connection is configured by copying keys to a specific folder on the server. <br><br>  We deploy about 5-10 times a day for a test and 1-2 times into the working environment, starting using dokku from version 0.1, we did not experience any significant difficulties, but the project brought a lot of benefit.  At the same time, both he himself and the technologies underlying it are extremely interesting! <br><br><h4>  Data storage </h4><br>  At the very beginning of the project, we used <a href="http://couchdb.apache.org/">CouchDB</a> , but very quickly switched to <a href="http://www.mongodb.org/">MongoDB</a> . <br><br>  MongoDB is convenient in all respects, this is a schemaless solution, ideal for fast-developing projects, easily upgraded by the developer‚Äôs machine.  Our current data volumes allow you to work without sharding, with one instance of the database. <br><br>  The prospects for the MongoDB configuration in production pleased me even less than the manual deployment.  We started with <a href="https://mongolab.com/welcome/">MongoLab</a> , but later switched to <a href="http://www.mongohq.com/home">MongoHQ</a> , primarily because we received good recommendations from colleagues about their support service, and the second is that MongoHQ allows you to deploy a server in Europe. <br><br>  For the prototype, we took a test connection, 512MB (which then seemed to be an unattainable volume), everything worked with a bang.  But I remember how happy I was with the transition to <code>AWS Small:EU</code> , which MongoHQ gave us a loan after we had some problem and we turned in support - the application just ‚Äúfly‚Äù, the response time was close to what we we have on the developer's environment.  In addition, they have a pretty good admin panel, tracking slow queries and recommended indexes. <br><br><h4>  Logging and monitoring </h4><br>  Running an application into production without proper logging is suicide.  Access to the logs should be quick, simple and desirable with the possibility of notification if errors or warnings appear in the logs.  Those.  again, logs should be placed in the cloud. <br><br>  The solution we have focused on is <a href="https://logentries.com/">Logentries</a> .  With our current volume of traffic log, we remain on a free account.  The "cardiograms" of all our applications are always in front of our eyes, so we quickly see when something starts to go wrong. <br><br>  It is also important to monitor the status of your servers.  At first, it was ssh to the server and manual monitoring, now, on the advice of colleagues, they were visiting <a href="http://newrelic.com/">New Relic</a> .  I really liked the installation process, good documentation and support.  New Relic's premium feature is application monitoring, they have recently got Node.js support. <br><br><h4>  Metrics and User Relations </h4><br>  If the logs are the number one priority for the application, then the metrics are the priority number for the product. <br><br>  Naturally, we have <a href="http://www.google.com/analytics/">Google Analytics</a> .  Maybe they throw a stone at me, but GA for me is nothing more than tracking general traffic and referrals.  Step to the right, step to the left - problems begin that are difficult to notice, since the data in the reports appear only the next day.  Difficult to tune and takes a long time to figure it out. <br><br>  We use our solution <a href="https://github.com/seismolabs/seismo">Seismo</a> (very early and simple) and more recently, we used <a href="https://github.com/seismolabs/seismo">MixPanel</a> to build funnels.  MixPanel was very pleased with its integration and scared with its price.  So we will develop our solution, depending on current needs. <br><br>  We use 2 solutions for communication with users: for <a href="http://mandrill.com/">Mandrill</a> transactional letters, and for support, invitation and retention letters of <a href="https://www.intercom.io/">Intercom</a> .  Both products are very cool, the pricing policy of Mandrill (12,000 letters for free) allows us to use it at no cost, but with Intercom we just recently had a trial run, and their price tag is quite high - the base price is $ 49 + $ 11 for every 250 active users.  We connected Intercom at the end of December and our invoice was $ 82.  This is still the most expensive service (convenient), but I would consider alternatives. <br><br><h4>  Total infrastructure costs </h4><br>  So, let's summarize the startup costs for infrastructure: $ 40 (DigitalOcean) + $ 20 (MongoHQ) + $ 82 (Intercom) = $ 152.  This is quite a lot, as for a start-up company, we will still look for ways to optimize.  However, this is not such a big amount of money that should keep you from trying to start your service.  Moreover, we came to these expenses in about half a year of the product‚Äôs existence, and the initial ones were at the level of $ 10‚Äì20 per month. <br><br>  Now the most favorable environment and a lot of things being done to help developers, away from doubts - start today! </div><p>Source: <a href="https://habr.com/ru/post/210000/">https://habr.com/ru/post/210000/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../209986/index.html">University timetable s01e03: season finale</a></li>
<li><a href="../209990/index.html">Creating a tweak on the example of the Phone application. Yes, it will be a plus!</a></li>
<li><a href="../209994/index.html">Gravity Beads</a></li>
<li><a href="../209996/index.html">What are the topics of letters working by the sweat</a></li>
<li><a href="../209998/index.html">Do electric cars dream of cars?</a></li>
<li><a href="../210002/index.html">Future home lighting</a></li>
<li><a href="../210004/index.html">Legalization of income freelancer in Ukraine. Part 1: state registration of business</a></li>
<li><a href="../210006/index.html">Google evaluates the work of Internet providers</a></li>
<li><a href="../210008/index.html">Video recordings of the reports of the ‚ÄúClouds‚Äù stream of the FOSS Sea conference</a></li>
<li><a href="../210010/index.html">How internet addicts are treated in China: a New York Times report</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>