<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Plugin for HANA Database project in Visual Studio</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I work on a SCRUM in an ASP .NET MVC project, in which HANA is used as a database, and TFS is used as a Source Control. At the database level, we main...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Plugin for HANA Database project in Visual Studio</h1><div class="post__text post__text-html js-mediator-article">  I work on a SCRUM in an ASP .NET MVC project, in which HANA is used as a database, and TFS is used as a Source Control.  At the database level, we mainly use View (Calculation, Attributes and DB Views), as well as the Stored Procedure, to perform transactional requests to the server. <br><br>  After the end of each release, I always had a question: ‚ÄúWhat exactly has changed in this release?‚Äù Or ‚ÄúWho made what change?‚Äù In this regard, I thought: ‚ÄúWhy not track the state of objects in TFS after each change?‚Äù <br><br>  As a result, I decided to create a plugin that allows you to use a Database project in Visual Studio (VS) and import the changes that are in the database.  So the idea of ‚Äã‚Äãcreating this application was born. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We start with a simple and see what kind of prototypes Microsoft has.  As an example, take the MS-SQL-server and Database-project in Visual Studio and consider all the features that they have: <br><br><ol><li>  You can create your own scheme (use the existing one) in MS-SQL and then import it into the Database-project in Visual Studio (DB VS). </li><li>  You can create (change) an object in the Database and transform the changes into a database. </li><li>  You can track changes in the Source Control (in my case in TFS). </li><li>  Thus, we can track all changes that occur during the development, as well as their authors. </li></ol><br>  I say right away that supporting all these possibilities is very difficult, especially since HANA has a kind of objects like Graphic View: it is created in a graphical form and cannot be demonstrated in any way in Visual Studio (but nevertheless, an approach was found for this type of objects) to import it into VS). <br><br>  I went the easy way.  Consider each opportunity separately. <br><a name="habracut"></a><br><h3>  Creating / using a schema in HANA and importing it into DB VS </h3><br>  There are two tasks: <br><br><ol><li>  Create a project from scratch in DB VS and import it into DB. </li><li>  Use an existing project (scheme) in the DB and import it into DB VS. </li></ol><br>  I chose only the second: firstly, I already have an existing project, secondly, to create a project in VS, feedback is needed (I will talk about it a little later), which is a very difficult task. <br><br>  So, I have to create a bridge that imports all the objects from the DB to the VS VS. <br><br><h3>  Creating (changing) an object in the Database and transforming changes into a database </h3><br>  This is almost the same as in the previous task.  That is, if I already have an existing scheme, I just need to bring objects into DB VS.  However, it is worth considering here: if the modified (deleted) object already exists in the project, it should be edited (deleted) in DB VS.  This is necessary in order to track changes in TFS, so I also implemented this task. <br><br><h3>  Ability to track changes in Source Control (in my case in TFS) </h3><br>  After there are changes in DB VS, it is necessary to track them in TFS.  To do this, somehow you need to mark the changed files in VS so that it is included in the list of items for Check-In.  Here I had to use ".New framework libraries" for TFS.  I used Visual Studio 2012 during the creation of this plugin, but for other (higher) versions of VS, you need to use the necessary (additional) framework from Microsoft so that the plugin can make changes to TFS. <br><br><h3>  DB VS Plugin </h3><br>  The plugin consists of 4 main parts: <br><br><ol><li>  Authentication Window. </li><li>  HANA Object Transformer. </li><li>  Object Changes Manager. </li><li>  TFS Manager. </li></ol><br><h4>  Authentication Window </h4><br>  In this window we enter all the necessary information for our plugin.  After the check is successful, the system remembers the data and uses it at the next login.  If for any reason the plugin could not ‚Äúreach‚Äù one server (for example, after changing its rights in the DB or TFS), the login window opens again and allows you to edit your rights. <br><br><img src="https://habrastorage.org/web/065/0aa/614/0650aa614c474ce5a71da99163ff4218.PNG"><br><br>  We need to enter two types of data: <br><br><ol><li>  All the necessary information for HANA, namely: Server Path, User Name, Password and Schema Name. </li><li>  Information about the project and TFS: in the Project Path field you can show the location of the VS VS file's DB for use in the plugin.  Also information about TFS Credential, such as User Name, Password and TFS Server URL. </li></ol><br>  If you put a tick near Save, then after successful connection to the servers your data will be saved. <br><br><h3>  HANA Object Transformer </h3><br>  This is the hardest part of the plugin.  Here, using the system dictionaries, we obtain information on all objects that are in the system.  Objects that are supported in the current implementation: <br><br><ol><li>  Tables. </li><li>  Constraints (Foreign Keys, Primary Keys, Unique). </li><li>  Table Types. </li><li>  Sequences. </li><li>  Functions. </li><li>  Stored Procedures. </li><li>  Synonyms. </li><li>  Views (Attribute Views, Calculation Views, Database Views). </li></ol><br>  I know that many projects in HANA also use other objects (like REST Services (XSJS), etc.), but in our case we ignored them.  For all objects except Views, I use system dictionaries to get data.  As an example, consider getting data about tables. <br><br>  To do this, we obtain the name of the tables in our schema using the following query: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> SCHEMA_NAME,TABLE_NAME,TABLE_OID,COMMENTS,FIXED_PART_SIZE,IS_LOGGED,IS_SYSTEM_TABLE,IS_COLUMN_TABLE,TABLE_TYPE,IS_INSERT_ONLY,IS_TENANT_SHARED_DATA,IS_TENANT_SHARED_METADATA,SESSION_TYPE,IS_TEMPORARY,TEMPORARY_TABLE_TYPE,COMMIT_ACTION,IS_USER_DEFINED_TYPE,HAS_PRIMARY_KEY,PARTITION_SPEC,USES_EXTKEY,AUTO_MERGE_ON,USES_DIMFN_CACHE,IS_PUBLIC,AUTO_OPTIMIZE_COMPRESSION_ON,COMPRESSED_EXTKEY,HAS_TEXT_FIELDS,HAS_TEXT_FIELDS,USES_QUEUE_TABLE,IS_PRELOAD,IS_PARTIAL_PRELOAD,UNLOAD_PRIORITY,HAS_SCHEMA_FLEXIBILITY,IS_REPLICA <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLES</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> SCHEMA_NAME = CURRENT_SCHEMA <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> IS_USER_DEFINED_TYPE = <span class="hljs-string"><span class="hljs-string">'FALSE'</span></span>;</code> </pre> <br>  After that, we get data about the columns of the tables using the following query and in the C # code using Linq we combine them: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> SCHEMA_NAME, TABLE_NAME, TABLE_OID, COLUMN_NAME, <span class="hljs-keyword"><span class="hljs-keyword">POSITION</span></span>, DATA_TYPE_ID, DATA_TYPE_NAME, <span class="hljs-keyword"><span class="hljs-keyword">OFFSET</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">LENGTH</span></span>, SCALE, IS_NULLABLE, DEFAULT_VALUE, <span class="hljs-keyword"><span class="hljs-keyword">COLLATION</span></span>,COMMENTS, MAX_VALUE, MIN_VALUE, CS_DATA_TYPE_ID, CS_DATA_TYPE_NAME,DDIC_DATA_TYPE_ID, DDIC_DATA_TYPE_NAME, COMPRESSION_TYPE, INDEX_TYPE, COLUMN_ID, PRELOAD,GENERATED_ALWAYS_AS, HAS_SCHEMA_FLEXIBILITY, FUZZY_SEARCH_INDEX, FUZZY_SEARCH_MODE,MEMORY_THRESHOLD,LOAD_UNIT,GENERATION_TYPE <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> TABLE_COLUMNS <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> SCHEMA_NAME = CURRENT_SCHEMA <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">POSITION</span></span></code> POSITION, DATA_TYPE_ID, DATA_TYPE_NAME, OFFSET, LENGTH, SCALE, IS_NULLABLE, DEFAULT_VALUE, COLLATION, COMMENTS, MAX_VALUE, MIN_VALUE, CS_DATA_TYPE_ID, CS_DATA_TYPE_NAME, DDIC_DATA_TYPE_ID, DDIC_DATA_TYPE_NAME, COMPRESSION_TYPE, INDEX_TYPE, COLUMN_ID, PRELOAD, GENERATED_ALWAYS_AS, <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> SCHEMA_NAME, TABLE_NAME, TABLE_OID, COLUMN_NAME, <span class="hljs-keyword"><span class="hljs-keyword">POSITION</span></span>, DATA_TYPE_ID, DATA_TYPE_NAME, <span class="hljs-keyword"><span class="hljs-keyword">OFFSET</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">LENGTH</span></span>, SCALE, IS_NULLABLE, DEFAULT_VALUE, <span class="hljs-keyword"><span class="hljs-keyword">COLLATION</span></span>,COMMENTS, MAX_VALUE, MIN_VALUE, CS_DATA_TYPE_ID, CS_DATA_TYPE_NAME,DDIC_DATA_TYPE_ID, DDIC_DATA_TYPE_NAME, COMPRESSION_TYPE, INDEX_TYPE, COLUMN_ID, PRELOAD,GENERATED_ALWAYS_AS, HAS_SCHEMA_FLEXIBILITY, FUZZY_SEARCH_INDEX, FUZZY_SEARCH_MODE,MEMORY_THRESHOLD,LOAD_UNIT,GENERATION_TYPE <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> TABLE_COLUMNS <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> SCHEMA_NAME = CURRENT_SCHEMA <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">POSITION</span></span></code> </pre> <br>  The most difficult was to get information about the Graphic Attribute View.  There is no direct possibility to obtain data about the structure of the View.  But if you think about it, HANA Studio shows this graphic view using certain metadata in the database.  I also tried to get exactly these metadata, and found an XML file, which for each View is stored in the DB.  So I solved this question: that is, to get information about the view and also track its changes, I need to store its XML in DBVS.  In the XML structure, there is data such as incoming parameters, outgoing parameters, the names of all the tables used in the current view, the data type, filters, join-s, and much more interesting. <br><br>  Calculation / Database Views are also mostly created and saved as SQL Script, so there were no special problems. <br><br><h3>  Object Changes Manager (OCM) </h3><br>  After receiving the information from the database, you need to see what change there is in the current and in the previous states of DB VS.  OCM is a link to synchronize changes and synchronizes DB VS in three stages: <br><br><ol><li>  Checks which new objects have been added to the schema. </li><li>  Checks for changes to every existing object. </li><li>  Checks the removal of objects in the schema. </li></ol><br>  In the first case: OCM generates a script, adds a file, locates in DB VS and updates additional files. <br><br>  In the second case: OCM compares the generated script with the existing file in DB VS and, if the object has changed, changes the existing file. <br><br>  In the third case: OCM deletes object files that are missing in the current version of the schema. <br><br>  Below are screenshots that show how the plug-in window looks and how the migration process takes place: <br><br><img src="https://habrastorage.org/web/12e/6c4/aa4/12e6c4aa4d7b4d62af0fac676b137d6d.PNG"><br>  <i>Fig.</i>  <i>1. List of objects (in this case, the table) that have changed</i> <i><br><br></i> <ul><li>  <i>red color - deleted items,</i> </li><li>  <i>green - new,</i> </li><li>  <i>purple - modified</i> </li></ul><br><img src="https://habrastorage.org/web/34b/80a/a96/34b80aa9613c47beb857f8afa453c2d6.PNG"><br>  <i>Figure 2. List of Stored Procedure that have changed.</i> <br><br><img src="https://habrastorage.org/web/8e8/3bf/fe5/8e83bffe52dd45ba9fd0752c466e6a77.PNG"><br>  <i>Fig.</i>  <i>3. The Included window includes a list of the typed objects to be changed in DB VS</i> <i><br></i> <br><img src="https://habrastorage.org/web/fb2/d9a/a7e/fb2d9aa7e1f841d086a44fd126a64527.PNG"><br>  <i>Fig.</i>  <i>4. Question for accepting a change in DB VS</i> <br><br><img src="https://habrastorage.org/web/b9a/121/905/b9a121905de4447eafcfe8d957ef69f6.PNG"><br>  <i>Fig.</i>  <i>5. Migration to DB VS is in progress.</i> <br><br><img src="https://habrastorage.org/web/598/93b/86e/59893b86e37247888d2ae63df6efb896.PNG"><br>  <i>Fig.</i>  <i>6. Message on successful migration</i> <br><br><h3>  TFS Manager Service (TFS MS) </h3><br>  TFS MS monitors every change that occurs in the project, and marks them accordingly: so that when Check-In they all fall into the list of changed items in the TFC. <br><br>  With this plugin, I was able to track all the changes within our project.  I moved on and expanded this plugin for the Merge Delivery Unit in different schemes, and also to compare different schemes after the merge process, to make sure that everything was correct.  But I will tell about it in the next articleÔÅä </div><p>Source: <a href="https://habr.com/ru/post/337680/">https://habr.com/ru/post/337680/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../337670/index.html">Interserver WebRTC</a></li>
<li><a href="../337672/index.html">Getting the text of requests from SoapHttpClientProtocol</a></li>
<li><a href="../337674/index.html">Kindergarten, pants with straps: where do programmers come from</a></li>
<li><a href="../337676/index.html">How to optimally calculate the amount of "iron": Sizing model of the EFS</a></li>
<li><a href="../337678/index.html">The practice of forming requirements in IT projects from A to Z. Part 6. System behavior. Excellence requirements</a></li>
<li><a href="../337682/index.html">Oracle actually eliminates Sun</a></li>
<li><a href="../337688/index.html">Docker Compose advanced configuration (translation)</a></li>
<li><a href="../337690/index.html">Yandex. Blitz. Why and what algorithmic problems need to be able to solve, working in the search</a></li>
<li><a href="../337692/index.html">Experience in implementing PSR standards in a single project</a></li>
<li><a href="../337694/index.html">VMware Announces ‚ÄúEnd‚Äù vCenter Server for Windows</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>