<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Use 54 FZ for the benefit of home bookkeeping</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When the next edition of Federal Law number 54 "On the use of cash registers" came into force, most of the population met her negatively. 

 Something...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Use 54 FZ for the benefit of home bookkeeping</h1><div class="post__text post__text-html js-mediator-article">  When the next edition of Federal Law number 54 "On the use of cash registers" came into force, most of the population met her negatively. <br><br><div class="spoiler">  <b class="spoiler_title">Something like this (18+, contains obscene language)</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/dglMh5er36U" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br>  I was one of the few who jumped, clapped their hands and was generally happy as a child. <br>  For the maintenance of accounting from a separate domestic work has become the most elementary business. <br><a name="habracut"></a><br><h2>  What for? </h2><br>  There will be no answer to the question "why do we need home accounting".  If you do not know the answer, then you do not need it. <br><br>  Also forget about the savings based on the analysis of accounting.  The classic example of ‚Äúyou will see that a cup of coffee for 130 rubles eats up to 4,000 a month every day‚Äù is divorced from reality.  If a person is not an idiot, he will see it without tedious bookkeeping. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  The foundation </h2><br>  Let's start with the simple.  Software for accounting. <br><br>  There are a billion programs for home accounting. <br><br>  I was superficially acquainted with the general trends and refused to use specialized software. <br>  A high threshold of entry, limited support, the inability to expand on the one hand, and redundant functionality on the other, dubious prospects and the lifespan of software ... <br>  In the end, my wife and I settled on Google Docs.  We have been conducting bookkeeping since 2014, and during this time we have not failed (although the birth of a child has become a serious temptation) and have not regretted choosing a tool. <br><br>  Everything looks very simple: <br>  Three main sheets: <br>  Categories - a list of categories for input validation <br>  Current month - not to get lost <br>  Current year - we drop here the current month <br><br>  It looks like this (I think everything is clear from the screenshot): <br><br><img src="https://habrastorage.org/webt/3w/oa/uz/3woauz8lzez1fh33fdww7bs6s5e.png"><br><br>  Categories are automatically inserted from the corresponding sheet.  If you enter something that is not in the list, the validator will curse. <br><br>  I wanted to make tags, but in the end I refused this idea - objectively tagging is not at all simpler, and no need was found for this.  Approximate destination category is enough. <br><br>  This is what my list of categories looks like (it is not perfect, some of the categories duplicate each other, some of the categories are subcategories of others, but such a list has been formed over 4 years and covers our family needs for analyzing expenses): <br><br><div class="spoiler">  <b class="spoiler_title">Sheet: Categories</b> <div class="spoiler_text">  Site <br>  Fruits <br>  Vegetables <br>  Spice <br>  Petrol <br>  Cultural holidays <br>  Dessert <br>  Products <br>  Hygiene <br>  Health <br>  beauty <br>  Auto <br>  Job <br>  Meat <br>  Bedroom <br>  Kitchen <br>  Equipment <br>  Presents <br>  Entrance hall <br>  Clothes, shoes <br>  Games <br>  Communal <br>  Hobby <br>  Soft <br>  Cat <br>  A fish <br>  Taxi <br>  Job <br>  Phone <br>  Equipment <br>  Dishes <br>  Household chemicals <br>  Sport <br>  Office <br>  Taxes <br>  Moto <br>  Garden <br>  Interior <br>  Security <br>  Cafe <br>  Home maintenance and repair <br>  Furniture <br>  Sex <br>  Travels <br>  Buying a property <br>  Drift <br>  Drawing <br>  Sculpture <br>  Training <br>  Ready meal <br>  Smart House <br>  Led <br>  Children <br></div></div><br><h2>  Practice </h2><br>  In theory, bookkeeping looks very simple. <br><br>  Well, what do we have to come home after the purchase and quickly enter the list of purchased goods into the document?  A couple of packets of milk, a loaf of bread, cookies ... <br><br>  The theory does not take into account trips to supermarkets, when products are bought at once in a bunch ... <br><br>  And here it is - "a handful of nails": <br><br><img src="https://habrastorage.org/webt/ck/uk/y9/ckuky9pgir58uush0mfucrshicq.jpeg"><br><br>  One kind of footcloth is wildly demotivating.  And entering with the union and counting items by category takes a long time.  My wife and I sat down in the evenings and together we hammered in all the checks that had accumulated during the week. <br><br>  Periodically, there was a desire to make text recognition check, to simplify the input. <br>  But further thoughts did not go. <br><br>  The reason is as simple as 5 kopecks: it takes time to write software.  And at that moment it was obvious that the time spent on writing software capable of more or less qualitatively recognizing all checks and generating on their basis at least some useful data ‚Äî about 10 years will overlap manual hammering in checks. <br><br>  So it was until July 1, 2017.  On this day, the ‚Äúsame‚Äù version of 54 FZ came into effect. <br>  ‚ÄúThat's it!‚Äù, I thought, ‚ÄúYou can take the data from the check without hammering it in manually‚Äù ... And then we continued to hammer in the checks with our hands.  Because inertia, laziness and conservatism. <br><br>  In February 2018, my son was born ... This has greatly changed the priorities in business. <br><br>  As a result - we did not find the time to keep accounts. <br><br>  Checks have accumulated a huge amount. <br><br><div class="spoiler">  <b class="spoiler_title">Nail bucket</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ji/79/mm/ji79mmkvdm0voeghcn8njsdn36a.jpeg"><br></div></div><br>  And here came the understanding that either I was doing automation, or I had to throw out all the checks, because I simply had no power to drive them. <br><br><h2>  Automation </h2><br>  It's time to talk about 54 FZ and what it gives us. <br><br>  This law obliges sellers to conduct checks through the OFD (Fiscal Data Operator).  If without clever words - all cash desks merge checks into the Internet. <br><br>  And they can be accessed. <br><br>  I don‚Äôt know how now, but when I understood, I couldn‚Äôt find any information about the protocol on the Internet. <br><br>  Fortunately, the FTS have released their mobile application that can download checks. <br><br>  Things are easy - we take a sniffer, put it on the phone and see what it sends an application for downloading data. <br><br><div class="spoiler">  <b class="spoiler_title">And it sends that</b> <div class="spoiler_text">  GET request to: <br>  <a href="https://proverkacheka.nalog.ru/">proverkacheka.nalog.ru</a> : 9999 / v1 / inns / * / kkts / * / fss / {FN} / tickets / {FD}? fiscalSign = {FPD} &amp; sendToEmail = no <br>  The header contains the following required fields: <br>  "Authorization": "Basic {BASE64 (phone: password)}" <br>  Device-Id ":" {Any rubbish} " <br>  "Device-OS": "Android 5.1" - most likely, you can also send rubbish, did not check. <br>  "Version": "2" <br>  "ClientVersion": "1.4.4.1" <br><br>  The answer is in the form of json, I don‚Äôt see any sense in bringing the structure, it is simple and in practice it will be easily understood by the one to whom it will be relevant. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Link to sniffer</b> <div class="spoiler_text">  Links to the sniffer will not.  I took the first one in Google.  Everything worked fine, but I can't recommend it.  It is worth remembering that in order to intercept https traffic, the application installs its certificates and is generally quite active in the phone.  There is no certainty that the application does not contain malicious code.  Therefore, if necessary - google and use it at your own peril and risk. <br></div></div><br>  As you can see, the protocol requires a phone and a password to download the check. <br>  I did not register, since it is easy to register through the official application and then use the phone and password to receive checks. <br><br>  As I said above, writing automation software only makes sense if the costs of writing overlap with the gain from automation. <br><br>  Therefore, I am a <s>bit</s> ashamed of the application code. <br><br>  On the other hand, the application is written in a few hours and works great. <br><br>  With the help of QZXing and a webcam, we scan the QR code, retrieve the OP, FD, FPD from it and make a request for the contents of the check. <br><br>  By the way, the expensive webcam worked very poorly as a QR code scanner. <br><br>  I was even a little upset and already wanted to recognize the application as unusable, since  it took a few minutes to scan one code, which is completely unacceptable. <br>  However, for the sake of experiment, I decided to try using a cheap Chinese webcam as a scanner ... And, oh, a miracle, she scans QR codes from checks without any problems!  I did not expect this in any way ... I suppose the fact is that the Chinese webcam has a backlight, which is useless for normal use, but works well for close viewing of checks. <br><br><h2>  application </h2><br>  If you've suddenly read this far, you're probably interested in trying out the check reading software yourself. <br><br>  Categories are stored in the categories.txt file. <br><br><img src="https://habrastorage.org/webt/rm/fq/sx/rmfqsxejidth_xdt8okkti4znzm.png"><br><br>  Enter the phone number and password that received during registration in the official application. <br>  Enter once, then it is saved locally in the application settings. <br><br>  Click Request Bill, select the source of the video stream to scan a check and scan the receipt, or enter the data manually and click Manual to use the entered data. <br><br>  If it is possible to recognize the data on the video stream, the window will automatically close and a request for a check will be sent. <br><br>  What we have already entered is automatically substituted: <br><br><img src="https://habrastorage.org/webt/lp/ll/ci/lpllciywz9x6e5jx5l2miklivu0.png"><br><br>  Fill in the fields: everything except the guarantee is mandatory. <br><br><img src="https://habrastorage.org/webt/z5/yo/mh/z5yomhsdxis7paricm5yqi9d4pu.png"><br><br>  Then click Generate Result and get the data in text form suitable for insertion into the table editor, this text is also placed in the clipboard. <br><br><img src="https://habrastorage.org/webt/2w/m8/ft/2wm8ft2m_uvg5nrcqurvoqudsre.png"><br><br>  Automation requires minimizing data entry.  Therefore, everything that we have already entered is saved. <br>  Buy something a second time - all fields of the goods will be already filled. <br><br>  Everything entered is saved in the items.csv file <br><br>  <a href="https://github.com/Allexin/BillDownloader"><b>Sources of application hang on GitHub</b></a> <br><br>  There in the releases section you can pick up a build for Linux and Windows.  Under the poppy, too, no problem going, but this is not for me. <br><br>  UPD: <br>  API authors have slightly changed its behavior. <br>  1) Now it is necessary to first ask a valid check from the API, and only then request it.  Otherwise, get invalid public API usage <br>  2) Introduced a limit on the number of free requests from one user per day.  Specially did not check, but the feeling of limitation in the region of 20 checks.  In general, the restriction does not affect the home bookkeeping, so it may not be noticed. </div><p>Source: <a href="https://habr.com/ru/post/423633/">https://habr.com/ru/post/423633/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../423623/index.html">Management for the geek: why count them?</a></li>
<li><a href="../423625/index.html">Meet the first lunar tourist</a></li>
<li><a href="../423627/index.html">Come study classical administration: regulations, tools, scripts Southbridge</a></li>
<li><a href="../423629/index.html">Managing Changes in Mars IT Infrastructure</a></li>
<li><a href="../423631/index.html">Two skills that will help you become an excellent developer</a></li>
<li><a href="../423635/index.html">Retro style audiobook player</a></li>
<li><a href="../423637/index.html">7 practical lessons on UX</a></li>
<li><a href="../423639/index.html">More efficient writing of arrays to the permanent memory of a smart contract in Solidity</a></li>
<li><a href="../423641/index.html">Deep Learning and OpenVINO Toolkit. Intel Expert Answers</a></li>
<li><a href="../423643/index.html">Banks are increasingly monitoring customer reputation: an investigation by Business Insider</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>