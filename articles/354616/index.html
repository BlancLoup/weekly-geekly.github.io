<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How does Qlean use Machine Learning?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Every day more and more orders arrive, and they need to be somehow distributed among the performers. It seems nothing complicated: the order came - gi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How does Qlean use Machine Learning?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/ee/0f/cw/ee0fcwzp96brofhfplbll0y29he.jpeg" alt="image">  Every day more and more orders arrive, and they need to be somehow distributed among the performers.  It seems nothing complicated: the order came - give it to the Clin.  But not everything is as simple as it seems.  Our cleaners do not have a fixed work schedule, they can work when they want to, refuse to virtually any orders (and these cleaners, alas, are done quite often).  Therefore, the distribution of orders - one of the most difficult tasks on which we work. <br><a name="habracut"></a><br><h3>  MAIN PROBLEMS </h3><br>  One of the biggest problems is the manual distribution.  We have a lot of orders that need to be quickly distributed.  Where do these orders come from? <br><br><ul><li>  The client can order the cleaning at the last moment, right today. </li><li>  The customer can transfer the order to any day. </li><li>  The cleaner can jump off the order at the last moment. </li></ul><br>  We call such orders ‚Äúlast minute‚Äù.  They are quite a lot, and hope that the wipers will disassemble them in the application is not worth it.  Therefore, we distribute them manually.  The call center employees ring up the cleaners and offer them orders.  This is a time consuming process, requiring time and resources. <br><br>  On the day, it is distributed from 50 orders manually, in the season an adism happens at all - maybe 300. It takes a lot of time and resources. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Another problem is backlog orders.  Every day we do not fulfill about 2% of orders because we cannot or do not have time to find cleaners on them.  If we do not do them, we give the client a free cleaning.  Every day we give about 20 free clean-ups, and in season this number can reach 200-300. <br><br>  <b>How do we solve these problems?</b> <br><br>  <b>1. Clinical application</b> <br><br>  Cleaners can independently disassemble orders using an application that has a tape with orders for each day. <br><br><img src="https://habrastorage.org/webt/xh/ri/tr/xhritrwbjsoxwa9tzsjpuieb47k.png" alt="image"><br><br>  These tapes differ for different wedge segments.  For example, novice cleaners will never see the orders of our regular customers.  This visibility is controlled by the matrix.  Numbers mean how long the cliner sees the order in the application. <br><br><img src="https://habrastorage.org/webt/s-/5o/se/s-5oseqp8yp35dw5clak-4xkbti.png" alt="image"><br><br>  There are other limitations, we follow them, and each of them affects our metrics. <br><br>  <b>2. Auto-assignment</b> <br><br>  Together with the rapid growth of orders, the number of ‚Äúbad‚Äù orders is growing.  ‚ÄúBad‚Äù - those that ultimately do not take place or will be canceled.  We needed to do something about it, and therefore we decided to hack a little and make ML to predict such orders. <br><br>  Especially we did not become wise.  We invented about 30 different signs: the time from the moment the order was created, the time since the last order, how much the customer canceled the orders, how much he brought us money for all the time, and so on. <br><br>  They took ready libraries <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.ensemble <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> GradientBoostingClassifier <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.model_selection <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> train_test_split <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.metrics <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> roc_auc_score</code> </pre> <br>  Loaded features <br><br><pre> <code class="python hljs">features = pd.read_csv(<span class="hljs-string"><span class="hljs-string">'train/train.csv'</span></span>, header = <span class="hljs-number"><span class="hljs-number">0</span></span>) X = features.drop([<span class="hljs-string"><span class="hljs-string">'cancel'</span></span>], axis=<span class="hljs-number"><span class="hljs-number">1</span></span>) y = features.cancel</code> </pre> <br>  We divided the sample into training and test. <br><br><pre> <code class="python hljs">X_train, X_test, y_train, y_test = train_test_split(X, y, train_size=<span class="hljs-number"><span class="hljs-number">0.8</span></span>, random_state=<span class="hljs-number"><span class="hljs-number">1234</span></span>)</code> </pre> <br>  Trained by gradient boosting <br><br><pre> <code class="python hljs">gb_clf = GradientBoostingClassifier(learning_rate=<span class="hljs-number"><span class="hljs-number">0.2</span></span>, n_estimators=<span class="hljs-number"><span class="hljs-number">70</span></span>, max_depth=<span class="hljs-number"><span class="hljs-number">3</span></span>, verbose=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, random_state=<span class="hljs-number"><span class="hljs-number">241</span></span>) gb_clf.fit(X_train, y_train)</code> </pre> <br>  Checked on a test sample <br><br><pre> <code class="python hljs">y_true = y_test y_pred = final_gb_clf.predict_proba(X_test)[:,<span class="hljs-number"><span class="hljs-number">1</span></span>] roc_auc=roc_auc_score(y_true, y_pred)</code> </pre> <br>  roc-auc: 0.881929812245 <br><br>  Made a forecast <br><br><pre> <code class="python hljs">features = pd.read_csv(<span class="hljs-string"><span class="hljs-string">'predict_features.csv'</span></span>, header = <span class="hljs-number"><span class="hljs-number">0</span></span>, index_col=<span class="hljs-string"><span class="hljs-string">'order_id'</span></span>) y_predict = gb_clf.predict_proba(features)[:,<span class="hljs-number"><span class="hljs-number">1</span></span>] print(y_pred)</code> </pre> <br>  Got a good roc-auc = 0.88.  And threw in the production. <br><br>  Now, every morning, we are given an estimate of the probability of order cancellation in the database. <br>  Expertly, we chose a threshold value for estimating probability: 0.7. <br>  Now we are actively using the model in our business processes.  For example, we call such bad orders in advance and they have a separate flow in the application. <br><br>  For different tests, we sometimes cut it down, and this affects our business metrics. <br>  For example, on April 7, they caught a bunch of outstanding orders, because before that they turned off the model. <br><br><img src="https://habrastorage.org/webt/lx/ay/ec/lxayecnrywb1r9x2sogphe7wlyg.png" alt="image"><br><br>  We decided to go ahead and distribute orders automatically.  But they immediately faced with the fact that we do not know which wipers will work and when. <br><br>  Got them a schedule.  But, as it turned out, the wipers, in principle, do not comply with it.  And to force them is contrary to our foundations. <br><br>  Once again, ML.  We made a similar model, but predicting the likelihood of us to go to work.  Now we have two models spinning, every day we have current info about orders and clinkers and we can distribute them. <br><br>  <b>Algorithm</b> <br><br>  We are looking for orders that need to be distributed, we clean out the ‚Äúbad‚Äù ones with the help of the obtained estimate of the probability of cancellation.  We select then on each order of kliner.  First, those that the client wants to see - the chosen ones - and assign them to the order.  If all of them are busy, then we select other cleaners that the client already had, but simply were not evaluated at all.  If they are busy, just look for the nearest free clinoer. <br><br>  <b>results</b> <br><br>  We expected a significant reduction in manual distribution and we managed to reduce it by half.  We also thought that auto assignment would reduce the percentage of outstanding orders to us, but this did not happen, since the main contribution to the solution of this problem was made by the model for estimating the probability of canceling orders. <br><br>  <b>findings</b> <br><br>  Do not be afraid to use ML in your tasks - making a simple model is easy.  It took us only a couple of days to work one model for writing models.  But now we can use it in our business processes. <br><br>  Ask questions in the comments, we will be happy to answer them. </div><p>Source: <a href="https://habr.com/ru/post/354616/">https://habr.com/ru/post/354616/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../354602/index.html">Comparing Google TPUv2 and Nvidia V100 on ResNet-50</a></li>
<li><a href="../354606/index.html">How to spoil a useful service (for example, Yandex.Maps)</a></li>
<li><a href="../354608/index.html">We understand the concept of BPM. What is business process management?</a></li>
<li><a href="../354612/index.html">What we read in April: useful articles for Angular-developers and a selection of the best with ng-conf</a></li>
<li><a href="../354614/index.html">The financial revolution: how IT startups change the rules of the game on Wall Street</a></li>
<li><a href="../354618/index.html">Stealing NTLM via PDF</a></li>
<li><a href="../354620/index.html">Kotlin playground</a></li>
<li><a href="../354622/index.html">3 common design mistakes that are easy to fix</a></li>
<li><a href="../354624/index.html">Backend United # 1. Vinaigrette - video, photo report, presentations and feedback from listeners</a></li>
<li><a href="../354626/index.html">Linux Mood Color, Mac OS Mood Color</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>