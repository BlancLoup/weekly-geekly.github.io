<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Slovomaniya - guess the words. Part 1, Ruby</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When I first saw Slovenia , I crush on it very tightly, spending endless hours guessing words. The essence of the game: there is a 4x4 grid, there is ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Slovomaniya - guess the words. Part 1, Ruby</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/394/f6a/703/394f6a703b290d89c452aa0ec047c323.jpg" alt="Slovenia" align="left">  When I first saw <a href="http://itunes.apple.com/ru/app/slovomania/id450116479%3Fmt%3D8">Slovenia</a> , I <a href="http://itunes.apple.com/ru/app/slovomania/id450116479%3Fmt%3D8">crush</a> on it very tightly, spending endless hours guessing words.  The essence of the game: there is a 4x4 grid, there is a letter in each cell.  The task of the player - to make words, consistently connecting the letters together. <br>  After a certain amount of time, an idea appeared: what if to automate the process of solving words?  After all, often I myself am engaged in a simple enumeration of combinations in attempts to add a word.  It is obvious that the computer will cope with this task much more productively than any person.  Of course, with the exception of those cases when the word is immediately ‚Äúvisible‚Äù on the field, but this problem has already been solved by our brain, so it was decided to engage in the division of labor between the brain and the computer, so that everyone can do what is easier for him. <br><a name="habracut"></a><br>  First, it was necessary to make a prototype in order to understand how the task of finding words on the field is achievable with the currently available computing power (MacBook Core 2 Duo 2.2Ghz Late 2007 with 4 GB of memory and a Linode 1024 server).  Since recently I have been actively developing Ruby on Rails, it was decided to take Ruby as a test environment.  Obviously, our task requires large computing power, and in the case of Ruby we have a large overhead on almost every operation, so for a combat situation it is necessary to use something else (for example C, but more on that later).  However, it is impossible not to take into account the undoubted plus - this is the speed of development. <br><br>  So let's go.  Our program will work as follows: <br><ol><li>  Enumerate all possible letter layout options. </li><li>  We compare the results with the dictionary </li><li>  If the option is found in the dictionary - the word is guessed, you can show it to the player </li></ol><br>  First of all, it was necessary to organize a dictionary on which we will rely.  After a brief search, several dictionaries were found in Yandex as plain text files (there is a separate word on each line).  Dictionaries are uploaded to the SQLite database.  Now you can proceed directly to writing the program.  I will give only the most interesting moments, links to the full source code are given at the end of the article.  Please note that the program was written in the style of ‚Äúmake the working version as soon as possible‚Äù and not ‚Äúwrite as beautifully as possible using all the design patterns from the GoF book‚Äù. <br><br>  The following algorithm of actions took shape in my head: <br><ol><li>  We become a cell with coordinates (x, y) (for the origin of the coordinates, I took the lower left corner).  We remember the position of the current cell in a special list of coordinates (paths). </li><li>  We go in turn in each direction (north, south, west, east, northeast, southeast, southwest and northwest) one cell. </li><li>  For each path create a new list of coordinates </li><li>  According to the lists of coordinates we form words </li><li>  Check if there are words in the dictionary (if there is, then we show the player) </li><li>  For each new position, go to step 2 until we reach a certain word length (that is, the length of the list of coordinates).  The length is determined by two factors: the maximum possible word length in the game, or our computing power. </li><li>  Go to the next cell and start all over again. </li></ol><br>  Thus, we recursively go around the entire field, going through all possible combinations.  At the same time, one should not forget that each cell can be used in each word only once, therefore in paragraph (2) it is necessary to check whether this cell is in our list of coordinates.  Also, do not forget to make sure that we have not gone beyond the playing field. <br>  And one more test: we are looking for a word in the dictionary only if its length (i.e., the length of the path) is more than two, because according to the rules of the game a word can consist of at least 3 letters. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here's what it looks like: <br><br><h5>  Game grid </h5><br><pre><code class="ruby hljs">@@w = [ <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span> ]</code> </pre> <br><br><h5>  Coordinate class </h5><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Coord</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_accessor</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">x</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">y</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br><br><h5>  Bypassing Neighboring Cells </h5><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lookup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(coords, deep)</span></span></span></span> print_word coords <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> deep &gt;= <span class="hljs-number"><span class="hljs-number">3</span></span> last = coords[-<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-comment"><span class="hljs-comment">#up lookup_next coords, Coord.new(last.x + 1, last.y), deep #up-right lookup_next coords, Coord.new(last.x + 1, last.y + 1), deep #right lookup_next coords, Coord.new(last.x, last.y + 1), deep #right-down lookup_next coords, Coord.new(last.x + 1, last.y - 1), deep #down lookup_next coords, Coord.new(last.x, last.y - 1), deep #left-down lookup_next coords, Coord.new(last.x - 1, last.y - 1), deep #left lookup_next coords, Coord.new(last.x - 1, last.y), deep #left-up lookup_next coords, Coord.new(last.x - 1, last.y + 1), deep end def lookup_next(coords, new_coord, deep) return if deep &gt; 6 return if new_coord.x &lt; 0 or new_coord.y &lt; 0 or new_coord.x &gt; 3 or new_coord.y &gt; 3 unless coords.find{|c|cx == new_coord.x and cy == new_coord.y} lookup coords.dup + [new_coord], deep + 1 end end</span></span></code> </pre><br><br><h5>  Search a word in the dictionary and print it </h5><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">print_word</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coords</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">word</span></span></span><span class="hljs-function"> = "" </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coords</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">each</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">|</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c</span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">|</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">word</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">+</span></span></span><span class="hljs-function">= @@</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">w</span></span></span><span class="hljs-function">[3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">-</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cy</span></span></span><span class="hljs-function">].</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">split</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>[cx] <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> @@words.<span class="hljs-keyword"><span class="hljs-keyword">include</span></span>?(word) @@db.execute( <span class="hljs-string"><span class="hljs-string">"select * from words where (word)=('</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{word}</span></span></span><span class="hljs-string">')"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|row|</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> @@words.<span class="hljs-keyword"><span class="hljs-keyword">include</span></span>?(word) @@words &lt;&lt; word puts word <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><br>  All found words are stored in the global variable @@ words to avoid displaying identical words. <br><br><h5>  Run the search </h5><br><pre> <code class="ruby hljs"><span class="hljs-number"><span class="hljs-number">0</span></span>.upto(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|x|</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.upto(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|y|</span></span> lookup [Coord.new(x, y)], <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><br>  One of the drawbacks of this implementation is that the search starts from the lower left corner of the grid, and the program may not have enough time to bypass the entire field, so you can search for words from the opposite corner in a separate thread: <br><br><pre> <code class="ruby hljs">Thread.new { <span class="hljs-number"><span class="hljs-number">3</span></span>.downto(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|x|</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>.downto(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|y|</span></span> lookup [Coord.new(x, y)], <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> }</code> </pre><br><br>  Even though we use relatively slow Ruby, our program is viable and finds words perfectly.  In the next article I will look at the implementation on C with ncurses, distributed memory, semaphores and blackjack. <br><br>  <a href="">Source code</a> <br>  <a href="http://dl.dropbox.com/u/989832/words.sqlite">Vocabulary</a> <br><br>  Justice triumphed: now the one with the cooler computer wins! </div><p>Source: <a href="https://habr.com/ru/post/142809/">https://habr.com/ru/post/142809/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../142803/index.html">Disk Encryption in XenServer</a></li>
<li><a href="../142804/index.html">What would our world look like if the Internet had existed for thousands of years</a></li>
<li><a href="../142805/index.html">Determining the IP address of a Skype user</a></li>
<li><a href="../142806/index.html">Google commented on the user property rights situation.</a></li>
<li><a href="../142808/index.html">Excursion from version 1.6.1 to 1.6.5</a></li>
<li><a href="../142811/index.html">Valve completes porting Steam for GNU / Linux</a></li>
<li><a href="../142814/index.html">Study on the Russian IT outsourcing market</a></li>
<li><a href="../142815/index.html">Feedback evolution</a></li>
<li><a href="../142816/index.html">Coded crazy passive sniffer as a module for Python</a></li>
<li><a href="../142817/index.html">Facebook can refuse 30% of the commission and change the rules of the game throughout the market.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>