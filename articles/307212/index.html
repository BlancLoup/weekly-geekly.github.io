<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Do not Perseids uniform or Model flash satellite with their own hands</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! After colorful meteor showers, we smoothly move to astronomical autumn. This year, it foreshadows us a lunar eclipse, a conjunction of Venus...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Do not Perseids uniform or Model flash satellite with their own hands</h1><div class="post__text post__text-html js-mediator-article"><p>  Hi, Habr!  After colorful meteor showers, we smoothly move to astronomical autumn.  This year, it foreshadows us a <a href="https://geektimes.ru/post/279388/">lunar eclipse, a conjunction of Venus and Jupiter</a> , as well as flights of bright man-made satellites.  My today's story is about how to model the reflection of light from such satellites, and what is unusual awaits us this October. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/files/477/774/c91/477774c91e764fc4b52f1f0e041a8d4d.jpg"></div><br>  <em><a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D1%2581%25D0%25BF%25D1%258B%25D1%2588%25D0%25BA%25D0%25B0_%25C2%25AB%25D0%2598%25D1%2580%25D0%25B8%25D0%25B4%25D0%25B8%25D1%2583%25D0%25BC%25D0%25B0%25C2%25BB">Iridium flash</a> , the first photo with my own hands - I pointed the wrong way, the shutter opened late, the horizon filled up :)</em> <p></p><a name="habracut"></a><br><h1 id="font-colorcc0000s-chego-vse-nachalosfont">  How it all began </h1><br><p>  In the spring, a <a href="https://geektimes.ru/post/270570">post</a> about Lighthouse satellite appeared on Hiktaims.  This is a Kubsat with a size of 30x10x10 cm, the main task of which, after going into orbit, is to open a mirror film that will reflect sunlight towards the Earth.  According to the authors, this should make Beacon one of the brightest satellites in the night sky.  The piquancy is added by the fact that Mayak is the first satellite in Russia for which funds were raised by crowdfunding, and very successfully. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/05b/fbe/fff/05bfbeffffe94345835dfbbe1e7bacf6.jpg"></div><br><p>  ( <em>picture <a href="http://zelenyikot.livejournal.com/87839.html">from here</a></em> ) </p><br><p>  Habr, undoubtedly, is still a cake: in the <a href="https://geektimes.ru/post/270570/">comments there was</a> a lively discussion about the feasibility of the project, to which the developers were also connected.  And if everything was all right with the design of the satellite, then the statements about the ‚Äúbrightest star in the sky‚Äù were very surprised.  For example, due to the fact that the film mirror is rarely good.  Or because the satellite must spin around its axis at a speed of one revolution per second ‚Äî then the speed of the sunbeam on the Earth turns out to be enormous, and the flashes must be too short.  The developers admitted that they really have problems with the calculation of reflections, and offered to those who wish to help them with this. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/98a/a39/24f/98aa3924f73049bbb0c5d2068992825c.png"></div><br><p>  The first analytical calculation proposed <a href="https://habrahabr.ru/users/quiensabe/" class="user_link">Quiensabe</a> .  ( <em>His post with not very optimistic results was published on GT, but it was removed due to inaccurate reference to crowdfunding - however, that‚Äôs another story.</em> ) Such a calculation gave an adequate assessment, but could not take into account the mass of factors - the curvature of the Earth‚Äôs surface, the change flash brightness as the rotation of the mirror and other things.  A neat numerical model was needed, which counts the brightness of the reflection with a small time step depending on the relative position of the satellite, the observer, the Sun and everything else. </p><br><p>  The task did not seem too complicated - it just needed to carefully understand all the geometry and not mess up anything.  Motivated and the ability to find something such cosmic.  And, of course, the joy of writing your own bike is priceless. </p><br><p>  ( <em><strong>There will be a lot of mathematics next.</strong> The results start <a href="https://habr.com/ru/post/307212/">here</a> , well, quite tl; dr - <a href="https://habr.com/ru/post/307212/">here</a> .</em> ) </p><br><h1 id="font-colorcc0000algoritmfont">  Algorithm </h1><br><p>  The main task of the model is to calculate the maximum flash brightness for the given satellite parameters and the given observer position on Earth.  In this case, the prediction of flares for a few days goes into the background - for this there is, for example, <a href="http://heavens-above.com/">heavens-above.com</a> .  It would be logical to take one satellite pass over the observer, and already for him to calculate the reflection brightness with a small time step.  After that, by varying the initial parameters, it will be possible to calculate the maximum possible flash brightness. </p><br><p>  So, the first step: to see the flash, it is necessary that the satellite: a) flew over the horizon and b) was not in the shadow of the Earth.  Step two: if these conditions are met, you can begin to consider the brightness of the flash.  Yes, it is very likely that the satellite will rotate - in this case, the flashes may be periodic.  (Flashing satellite!) Therefore, in general, the third step is needed - to search for individual flashes separated by intervals of darkness.  Lines up the logic of the program, which implements three functions: </p><br><ul><li>  <strong>The first function</strong> counts the coordinates of the satellite and the observer during one revolution with a large time step (1-5 seconds) and checks at which points the satellite is visible above the horizon and is not in the shade.  If the satellite appears above the horizon, the function calculates the time intervals when it is visible, and transmits them to the second function. </li><li>  <strong>The second function</strong> works with a small time step (0.001 - 1 s) and at each step calculates the brightness of the flash, which the observer sees. </li><li>  <strong>The third function</strong> is the most non-cosmic one.  She finds the individual flashes in the results of the second function and considers their parameters: brightness, duration, maximum transit time, and so on. </li></ul><br><h1 id="font-colorcc0000fizicheskaya-modelfont">  Physical model </h1><br><p>  We will model the task in the ECI (Earth-centered inertial) reference system - its beginning coincides with the center of the Earth, the Z axis is directed to the north pole, and the Sun is in the XZ plane. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/e05/b17/2f9/e05b172f9c21416182d388aa0925d8c2.jpg" width="400"></div><br><p>  Why ECI?  Because the Sun is motionless in it, the observer rotates with the Earth around the Z axis, and the satellite orbit does not change its position in space.  This means that the coordinates of both the satellite and the observer are easily parameterized through the angles.  Details - under the spoiler. </p><br><div class="spoiler">  <b class="spoiler_title">More coordinates god coordinates!</b> <div class="spoiler_text"><p>  <strong>The coordinates of the observer</strong> are given by the latitude of <em>fi <sub>obs</sub></em> and the current longitude of <em>theta <sub>obs</sub></em> . </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/1c7/724/84e/1c772484eddf4de3a7a887123765f517.jpg" width="400"></div><br><p>  In essence, <em>theta <sub>obs</sub></em> is local time: noon corresponds to <em>theta <sub>obs</sub></em> = 0, and midnight - <em>theta <sub>obs</sub></em> = 180. You also need to know the local time at the initial time <em>theta <sub>obs0</sub></em> and the speed of the Earth‚Äôs rotation around its axis.  Then the coordinates of the observer in ECI are expressed as: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/249/f98/fe1/249f98fe1c1744a5aa42787a47186495.png"></div><br><p>  <strong>The satellite orbit</strong> to facilitate the calculations can be considered circular.  In this case, it can be set with three parameters: radius <em>R <sub>orb</sub></em> , inclination <em>fi</em> and longitude of the ascending node <em>theta <sub>AN</sub></em> .  The ascending node is the point at which the orbit crosses the equator towards the north. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/547/3a5/dc7/5473a5dc713f411c830704fb1c4814ab.jpg" width="400"></div><br><p>  <strong>Gravity,</strong> <del>  heartless you with </del>  .  Since the orbit is circular, the satellite moves along it with a constant angular velocity </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/035/f3e/05f/035f3e05f5c0457482826371824131ae.png"></div><br><p> Now that we know all this, the position of the satellite in orbit is easy to parameterize through the alpha angle: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/57b/d53/8f7/57bd538f7f174da7a07160210c6af466.png"></div><br><p>  Here <em>dir <sub>AN</sub></em> and <em>dir <sub>B</sub></em> are the directions to the ascending node and the highest point of the orbit, which are considered simple trigonometry: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/bc4/911/94c/bc491194c2c34f8e97940168ccebbc3f.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/122/02c/904/12202c90418e43c08b5fb41223b668ca.png"></div><br><p>  <strong>The sun.</strong>  The chip of the ECI reference system is that the Sun is always in the XZ plane.  Depending on the time of year, it changes position: when summer is in the northern hemisphere, the sun is above the Z axis, and in the winter - vice versa.  We are not interested in the position of the Sun itself, but in the direction to it.  Rather, from him, that is, along the direction of movement of the sun's rays.  In the pictures it is called <em>k <sub>sun</sub></em> . </p></div></div><br><p>  Did you count the coordinates?  Now we need to check <strong>whether the satellite is visible above the horizon</strong> - otherwise it is meaningless to consider something.  This is determined by the co-direction of the vectors from the observer to the satellite - <em>dir <sub>sat_obs</sub></em> and to the zenith of <em>dir <sub>obs</sub></em> : if their scalar product is positive, then the satellite is somewhere above us. </p><br><p>  <strong>If the satellite is above the horizon, then you need to know its coordinates in the sky</strong> .  To do this, the direction to the satellite must be projected onto the plane of the observer.  The observer's plane is set by vectors north <em>dir <sub>nord</sub></em> and west <em>dir <sub>west</sub></em> .  The first is through the direction to the zenith and the north pole of the Earth <em>d <sub>NP</sub></em> , and already along it and the direction to the zenith the vector to the west is calculated. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/e4c/cd0/3dd/e4ccd03dd80c49fa96c17756173f1556.jpg" width="400"></div><br><p>  Now we need to check <strong>if the satellite is not in the shadow of the Earth</strong> (otherwise there will obviously be no reflection).  From the picture below it is easy to understand that the satellite is in the shadow, if two conditions are fulfilled simultaneously: </p><br><ul><li>  the angle between <em>k <sub>sun</sub></em> and <em>dir <sub>sat</sub></em> (vector per satellite) is acute; </li><li>  <em>d &lt;R</em> </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/files/258/e95/aed/258e95aedbec4ddc84c65c5d758717b8.jpg" width="400"></div><br><p>  In a similar way, it is necessary to check that the observer is in the shade, that is, he is now in the night.  It‚Äôs not easy to see a satellite in the sunlight, although <a href="https://geektimes.ru/post/261136/">day astronomy</a> undoubtedly also has its own charm. </p><br><p>  Finally, if the satellite is illuminated by the Sun and is somewhere above us, it remains to calculate the brightness of the flash.  More precisely, its <strong>apparent magnitude</strong> , which shows brightness compared to other stars.  The magnitude scale is logarithmic: it is defined as </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/41c/5be/5d2/41c5be5d2c404f4e8b4ccb1dc81fecb9.png"></div><br><p>  that is, a change in brightness by 100 times corresponds to a change in magnitude by 5 units.  It also shows that the magnitude scale has been inverted: smaller values ‚Äã‚Äãcorrespond to brighter objects.  For example, the magnitude of Arcturus and Vega - the brightest stars of the Northern Hemisphere - is +0.0, Sirius - -1.7, but Venus reaches -4.6 magnitude.  The eye distinguishes stars up to +6 magnitude, although in large cities the illumination does not allow to see something brighter than +4. </p><br><div class="spoiler">  <b class="spoiler_title">Some more photometry</b> <div class="spoiler_text"><p>  To calculate the stellar magnitude, you need to know the brightness, or rather the <strong>illumination</strong> - that is, the power of the light flux passing through a unit of area.  It is measured in W / m <sup>2</sup> or in lux, that is, the physical meaning of the illumination is how bright the surface will be.  From the definition it follows that the illumination does not depend on the area.  Therefore, observation with the naked eye, a camera or a telescope will give the same result of measuring the magnitude. </p><br><p>  How to calculate the illumination, which creates a reflection from the satellite?  First of all, the power of the reflected light (that is, how many photons are reflected from the satellite per second) is found by multiplying the area of ‚Äã‚Äãthe mirror by the illumination created by the Sun.  One should not forget that the mirror can be at an angle to the sun's rays.  And also about the fact that the mirror is non-uniform and reflects light into a large solid angle - the ‚Äúhare‚Äù on the surface of the Earth will be extended, and we can be far from its center.  Finally, the illumination depends quadratically on the distance to the satellite - the farther the satellite is, the less light will reach the observer.  The final expression for light is: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/eef/943/033/eef943033fc64ddb9e5a6bddbf364afc.png"></div><br><p>  where <em>E <sub>orbit</sub></em> is the illumination created by the Sun on the Earth‚Äôs orbit, the second factor is the area of ‚Äã‚Äãthe mirror at an angle to the sun‚Äôs rays, the third is the fraction of the solid angle that the observer sees, and the fourth is the quadratic dependence on the distance to the satellite. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/094/474/aaa/094474aaa7c34cf6a75c61833c927f40.jpg" width="600"></div><br><p>  By comparing this number with the illuminance corresponding to a zero magnitude (2.5 ‚àô 10 <sup>-8</sup> W / m <sup>2</sup> ), we find the magnitude of the satellite. </p></div></div><br><p>  <strong>Whether we see a flash or not is determined by the position of the mirror</strong> .  It is convenient to set it by the normal vector <em>n <sub>mir</sub></em> : this makes it easy to calculate the direction of the reflected beam according to the good old rule about the angle of incidence equal to the angle of reflection: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ea7/272/f30/ea7272f30a534a919319e44511c4fbd4.jpg" width="400"></div><br><p>  Simply and easily?  By no means!  In practice, it is faster to consider how the mirror <strong>should be positioned</strong> so that at a given position of the satellite and the observer the reflection would fall directly on the observer.  And then compare with the current position of the mirror.  The advantage of this approach is that it allows you to change the time step.  As long as the mirror is far from the optimal position, the step can be increased - there will be no flash anytime soon.  If the flash has already begun, then the time step must be reduced to calculate it with the maximum resolution. </p><br><p>  Finally, the <strong>satellite rotates, and with it the mirror rotates</strong> .  Therefore, it is convenient to decompose the normal to the mirror <em>n <sub>mir</sub></em> into two components ‚Äî parallel and perpendicular to the axis of rotation of the satellite <em>d <sub>mir</sub></em> .  The first one remains motionless, the second one precesses - the mathematics of this is exactly the same as the motion of the satellite in orbit. </p><br><h1 id="font-colorcc0000kodfont">  Code </h1><br><p>  The code is written in the lab.  As I described above, it is divided into three functions, which are in turn called by the main <em>calc_one</em> script.  In the main script, constants, initial conditions and simulation parameters are set, which are passed to the functions via the <em>param</em> structure as follows: </p><br><pre><code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">% satellite orbit param.incl_sat = 97.75; % inclination, deg (ISS: 51.6, SSO for 600 km: 97.75) param.theta_asc = -7.5; % longitude of the ascending node, deg param.alpha_sat_0 = 0; % angle between AN and the sat in the plane of orbit at t=0, deg param.h_orbit = 600 * 1E3; % orbit height, m</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">More options!</b> <div class="spoiler_text"><pre> <code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">%%%%%%%%%%%%%%%%%% SIMULATION PARAMETERS %%%%%%%%%%%%%%%%%%%%%%%%%% % world param.rad_earth = 6400 * 1E3; % Earth radius, m param.GM = 6.67*1E-11 * 5.972*1E24; % grav. constant times Earth mass, m^3/s^2 param.omega_obs = 1/(60*60*24); % Earth angular velocity, turns/s param.k_sun = [-0.99, 0, 0.16]; % sunlight wavevector (22 Jun: [-0.92,0,-0.4]; 21 Dec: [-0.92,0,0.4], 15 Oct: [-0.99,0,0.16]) param.atmosphere_transmission = 0.7; % atmosphere transmission param.flux_sun = 1367; % Sun irradiant flux on the Earth orbit, W/m^2 param.flux_m0 = 2.5*1E-8; % flux corresponding to the apparent magnitude = 0, W/m^2 param.min_m = 6; % minimal visible apparent magnitude % observer param.phi_obs = 55.75; % latitude, deg (Moscow: 55.75) param.theta_obs_0 = 170; % longitude, deg (noon: 0, midnight: 180) % satellite orbit param.incl_sat = 97.75; % inclination, deg param.theta_asc = -7.5; % longitude of the ascending node, deg param.alpha_sat_0 = 0; % angle between AN and the sat in the plane of orbit at t=0, deg param.h_orbit = 600 * 1E3; % orbit height, m % satellite mirror param.omega_rot = 1; % rotation speed of the satellite, turns/s param.d_rot = [0 0.7 1]; % rotation axis of the satellite param.n_mirror_0 = [1 0 0]; % normal to the mirror at t=0 param.gauss_w = 17.2; % divergence angle of a normal distrubution, deg param.sq_mirror = 3.8; % mirror square, m^2 % simulation parameters param.dt1 = 1; % time step if the satellite is below horizon or in the shadow, s param.dt2 = 1; % same if satellite is above horizon, but reflection is far away param.dt3 = 1 * 1E-2; % same if satellite is above horizon, reflection is close param.dt4 = 5 * 1E-3; % same if reflection is seen param.frame_duration = 0.03; % exposition time of a camera/eye, s</span></span></code> </pre> </div></div><br><p>  <strong>The first function</strong> <em>fn_pass</em> counts the satellite coordinates and searches for a single span above the horizon.  First, it calculates any auxiliary values ‚Äã‚Äã(the direction to the North Pole, the speed of rotation of the satellite, and so on). </p><br><pre> <code class="matlab hljs"> <span class="hljs-comment"><span class="hljs-comment">% calculate some aux values rad_orbit = rad_earth + h_orbit; % radius of the orbit from the center of Earth r_np = [0 0 rad_earth]; % coordinates of the North pole dir_an = [cosd(theta_asc), sind(theta_asc), 0]; % direction on the acsending node dir_b = [-sind(theta_asc)*cosd(incl_sat),... cosd(theta_asc)*cosd(incl_sat), sind(incl_sat)]; % direction on the highest point of the sat omega_sat = sqrt(2*GM/rad_orbit)/(2*pi*rad_orbit); % satellite angular velocity on the orbit, s^-1 dir_obs_z = sind(phi_obs); % z-coordinate of the observer, does not change</span></span></code> </pre> <br><p>  After that, the while-loop in time is started with a constant step equal to 1 second.  The condition for exiting the cycle is the satellite leaving the horizon (or two satellite turns without a single appearance above the horizon, which is unrealistic in low orbits).  In the cycle, the coordinates of the observer and the satellite are calculated sequentially: </p><br><pre> <code class="matlab hljs"> <span class="hljs-comment"><span class="hljs-comment">% coordinates of the observer theta_obs = mod(theta_obs_0 + 360*omega_obs*current_time, 360); dir_obs = [cosd(phi_obs)*cosd(theta_obs), cosd(phi_obs)*sind(theta_obs), dir_obs_z]; r_obs = rad_earth * dir_obs; % coordinates of the satellite theta_sat = mod(alpha_sat_0 + 360*omega_sat*current_time, 360); dir_sat = cosd(theta_sat)*dir_an + sind(theta_sat)*dir_b; r_sat = rad_orbit*dir_sat; % vector from the satellite to the observer r_sat_obs = r_obs-r_sat; dir_sat_obs = fn_norm(r_sat_obs);</span></span></code> </pre> <br><p>  it is checked that the satellite is above the horizon and its coordinates are calculated in the sky: </p><br><pre> <code class="matlab hljs"> <span class="hljs-comment"><span class="hljs-comment">% CHECK1: check if the satellite is above the horizon if fn_dot(dir_obs, dir_sat_obs) &lt; 0</span></span></code> </pre> <br><pre> <code class="matlab hljs"> <span class="hljs-comment"><span class="hljs-comment">% basis on the skychart r_obs_np = r_np - r_obs; % vector from the observer to the North pole dist_obs_np = sqrt(sum(r_obs_np.^2)); cos_angle_obs_np = fn_dot(r_obs_np, -dir_obs)/dist_obs_np; dir_nord = r_obs_np + cos_angle_obs_np*dist_obs_np*dir_obs; dir_nord = fn_norm(dir_nord); % vector to the nord dir_west = fn_cross(dir_obs, dir_nord); dir_west = fn_norm(dir_west); % vector to the west % coordinates of the satellite on the sky chart pass_path.alt(pass_step,1) = 90 - acosd(fn_dot(-dir_sat_obs, dir_obs)); map_proj_nord = fn_dot(-dir_sat_obs, dir_nord); map_proj_west = fn_dot(-dir_sat_obs, dir_west); pass_path.azimuth(pass_step,1) = mod(-atan2d(map_proj_west, map_proj_nord), 360);</span></span></code> </pre> <br><p>  and, finally, it is checked whether the satellite is in the shadow: </p><br><pre> <code class="matlab hljs"> <span class="hljs-comment"><span class="hljs-comment">% CHECK 2: check that the satellite is not in the shadow cos_angle_sat_ksun = fn_dot(dir_sat,k_sun); dist_sat_ksun = rad_orbit*sqrt(1-cos_angle_sat_ksun^2); % distance from the sat to the central axis of shadow if (dist_sat_ksun &gt; rad_earth) % satellite is not in the shadow</span></span></code> </pre> <br><p>  All data is stored in the <em>pass_path</em> structure, which the function returns.  But before that you need to find all the intervals during which the satellite is above the horizon and illuminated by the Sun - they will be needed for the second function to work. </p><br><div class="spoiler">  <b class="spoiler_title">This is very boring, so removed under spoiler</b> <div class="spoiler_text"><pre> <code class="matlab hljs"> <span class="hljs-comment"><span class="hljs-comment">% STEP 2: if the pass was above horizon, % select the regions when sat is above horizon and not in shadow pass_path.reflection_intervals = []; if isempty(pass_path.time) == 0 flag_in_shadow = 1; num_regions_not_in_shadow = 0; for counter_step = 1:size(pass_path.time,1) if pass_path.in_shadow(counter_step) == 0 % satellite is not in shadow if flag_in_shadow == 0 % sat is still not in shadow else % sat was in shadow and just went out of it flag_in_shadow = 0; num_regions_not_in_shadow = num_regions_not_in_shadow + 1; pass_path.reflection_intervals(num_regions_not_in_shadow,1) = pass_path.time(counter_step); end else % satellite is in shadow if flag_in_shadow == 0 % sat was not in shadow and just went into it flag_in_shadow = 1; pass_path.reflection_intervals(num_regions_not_in_shadow,2) = pass_path.time(counter_step); else % sat is still in shadow end end end % if at the end sat was still not in shadow, % time of the end of the last interval will be time of the last % point above the horizon if flag_in_shadow == 0 pass_path.reflection_intervals(num_regions_not_in_shadow,2) = pass_path.time(counter_step); end end</span></span></code> </pre> </div></div><br><p>  The intervals are stored in the <em>pass_path.reflection_intervals</em> in the <em>Nx2</em> array, where N is the number of visibility intervals, 2 numbers are the time of the beginning and end of the visibility interval.  Now the <em>pass_path</em> structure <em>is</em> returned to the main script, from where the second function is called. </p><br><p>  <strong>The second function</strong> <em>fn_reflection</em> works only at intervals where the satellite is above the horizon and illuminated by the sun.  At each step (which may be shorter than one second), he also calculates the coordinates of the observer and the satellite, after which he checks whether the mirror is close to the optimal position: </p><br><pre> <code class="matlab hljs"> <span class="hljs-comment"><span class="hljs-comment">% CHECK 3: if angle (d_rot, n_opt) is close to angle (d_rot, n_mir0), proceed % this means that geometry can in principle give a reflection if (angle_drot_nopt &gt; (angle_drot_nmirror-angle_div))... &amp;&amp; (angle_drot_nopt &lt; (angle_drot_nmirror+angle_div)) % current orientation of the mirror n_mir = n_mir_parallel... + n_mir_perp0*cosd(360*omega_rot*current_time)... + n_mir_perp1*sind(360*omega_rot*current_time); % angle between current orientation of the mirror and n_opt angle_nmir_nopt = acosd(fn_dot(n_mir, n_opt)); % CHECK 4: if n_mir is close to n_opt, proceed and calculate the reflection if angle_nmir_nopt &lt; angle_div</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Little military trick about the position of the mirror</b> <div class="spoiler_text"><p>  As can be seen from the code, the location of the mirror is checked by two parameters - azimuth ( <em>CHECK 3</em> ) and radial ( <em>CHECK 4</em> ) angles with respect to the axis of rotation of the satellite.  The trick is that the radial angle changes as the satellite rotates.  But the azimuth is not! </p><br><p>  Therefore, first it makes sense to check whether the azimuth angle is close to the optimal position.  If not, then nothing will help in the near future.  If so, then you can calculate the radial angle, and at the same time reduce the time step. </p></div></div><br><p>  Finally, if the mirror is close to the optimal position, then the illumination created by the sunbeam can also be calculated.  Well, the magnitude at the same time </p><br><pre> <code class="matlab hljs"> <span class="hljs-comment"><span class="hljs-comment">% calculate the angle between the direction on the observer % and direction of the main reflection cos_angle_nmir_ksun = fn_dot(n_mir, -k_sun); k_refl = 2*cos_angle_nmir_ksun*n_mir + k_sun; cos_angle_refl_obs = abs(fn_dot(k_refl, dir_sat_obs)); angle_refl_obs = acosd(cos_angle_refl_obs); % flux at the observer's place refl_fraction = 2/(pi*degtorad(gauss_w)^2) * exp (-2*angle_refl_obs^2/gauss_w^2); % now it is Gaussian int_reflection = flux_sun * sq_mirror * cos_angle_nmir_ksun; flux = max (int_reflection * refl_fraction ... * atmosphere_transmission / distance^2, flux_min); % W/m^2</span></span></code> </pre> <br><p>  It can be seen that if the brightness is too low (dimmer than +6), then the result will be +6.  This means that we will not see anything.  All results are written to the <em>pass</em> structure, which the function returns. </p><br><p>  <strong>The third function</strong> <em>fn_flares</em> is the simplest: it counts flashes, their maximum brightness, duration and location in the sky.  It is really primitive, but long, so I put it under the spoiler. </p><br><div class="spoiler">  <b class="spoiler_title">fn_flares</b> <div class="spoiler_text"><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pass</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fn_flares</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pass, param)</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">functions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">counts</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flares</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">into</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pass</span></span></span><span class="hljs-function">' </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">structure</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">summarizes</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">data</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">about</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">their</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">magnitudes</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">durations</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">etc</span></span></span><span class="hljs-function">. % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saves</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">them</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">in</span></span></span><span class="hljs-function"> '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pass</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flares</span></span></span><span class="hljs-function">' </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">field</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initialization</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">counter_flare</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flare_is_now</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flares</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flares</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">struct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('time',[],'dist',[],'alt',[],'azimuth',[],'inst_magn',[],'vis_magn',[],'dur',[])</span></span></span><span class="hljs-function">; % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">step</span></span></span><span class="hljs-function"> = 1:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">length</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pass.time)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pass</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">magnitude</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(step)</span></span></span><span class="hljs-function"> &lt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">param</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_m</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flare</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">present</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">now</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flare_is_now</span></span></span><span class="hljs-function"> == 0 % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flare</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">just</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">began</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flare_is_now</span></span></span><span class="hljs-function"> = 1; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">counter_flare</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">counter_flare</span></span></span><span class="hljs-function"> + 1; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">time_beg</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pass</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">time</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(step)</span></span></span><span class="hljs-function">; % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">integrate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">energy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flare</span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[J/m^2]</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">step</span></span></span><span class="hljs-function"> &lt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">length</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pass.time)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">energy</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pass</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flux</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(step)</span></span></span><span class="hljs-function">*... </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pass.time(step+1)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pass</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">time</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(step)</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">was</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">last</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">data</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">point</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nothing</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">field</span></span></span><span class="hljs-function"> '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brightest</span></span></span><span class="hljs-function">' % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">data</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">about</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brightest</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">point</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flare</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brightest</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">magn</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pass</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">magnitude</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(step)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brightest</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">time</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pass</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">time</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(step)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brightest</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">azimuth</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pass</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">azimuth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(step)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brightest</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alt</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pass</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(step)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brightest</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pass</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(step)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flare</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">still</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">goes</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">increment</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">energy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flare</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">step</span></span></span><span class="hljs-function"> &lt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">length</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pass.time)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">energy</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">energy</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pass</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flux</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(step)</span></span></span><span class="hljs-function">*... </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pass.time(step+1)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pass</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">time</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(step)</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">was</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">last</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">data</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">point</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nothing</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">here</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flare</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brighter</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">renew</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">data</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">about</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brightest</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">point</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pass</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">magnitude</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(step)</span></span></span><span class="hljs-function"> &lt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brightest</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">magn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brightest</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">magn</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pass</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">magnitude</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(step)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brightest</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">time</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pass</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">time</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(step)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brightest</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">azimuth</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pass</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">azimuth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(step)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brightest</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alt</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pass</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(step)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brightest</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pass</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(step)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">no</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flare</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">now</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flare_is_now</span></span></span><span class="hljs-function"> == 0 % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">still</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">no</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flare</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flare</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">just</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ended</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">up</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">results</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flare_is_now</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">time_end</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pass</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">time</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(step-1)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">duration</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">time_end</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">time_beg</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">duration</span></span></span><span class="hljs-function"> &gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">param</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">frame_duration</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flare</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">long</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">we</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">can</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">see</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">it</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">directly</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vis_magn</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brightest</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">magn</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flare</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">short</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">one</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">should</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">divide</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">its</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">energy</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">over</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">exposure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">time</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">an</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eye</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">camera</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apparent</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">magnitude</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vis_magn</span></span></span><span class="hljs-function"> = ... </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(-2.5*log10(current_flare.energy/param.frame_duration/param.flux_m0)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">param</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min_m</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">data</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">in</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flares</span></span></span><span class="hljs-function">' </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">structure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flares</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">time</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(counter_flare,1)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brightest</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">time</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flares</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(counter_flare,1)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brightest</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flares</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">azimuth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(counter_flare,1)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brightest</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">azimuth</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flares</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(counter_flare,1)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brightest</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alt</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flares</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inst_magn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(counter_flare,1)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brightest</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">magn</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flares</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vis_magn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(counter_flare,1)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vis_magn</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flares</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dur</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(counter_flare,1)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current_flare</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">duration</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">result</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flares</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">num_of_flares</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">counter_flare</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pass</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flares</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flares</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre> </div></div><br><p>  One problem appears here.  If the flash is very short, then the total number of photons caught in the eye can be low even if the instant brightness was high.  Then the apparent brightness of the flash will be much less than the maximum. </p><br><p>  What does ‚Äúshort flash‚Äù mean?  Obviously, one that is shorter than the exposure time of the camera.  And if we observe it with an eye?  What to consider the exposure of the eye, I did not have a clue, so I asked <a href="https://habrahabr.ru/users/meklon/" class="user_link">Meklon</a> .  He told a lot of interesting things - but it boiled down to the fact that the eye works sooo hard, his sensitivity is highly nonlinear, and therefore a clear answer to the question cannot be given.  Even approximately.  As a result, it was decided to choose a more or less meaningful number - I chose 30 ms, which corresponds to about 30 frames per second. </p><br><p>  So, if the flash turns out to be shorter than the exposure time, then its duration is rounded up to the exposure time, the total amount of light remains unchanged, well, the brightness, respectively, decreases.  For example, if in reality a flash lasts 10 ms and during this time 3000 photons arrived, then its momentary ‚Äúbrightness‚Äù is 300 photons / ms.  We will see that it lasted 30 ms with a ‚Äúbrightness‚Äù of 100 photons / ms ‚Äî 3 times less than the instant one. </p><br><p>  <strong>Finally, the main</strong> <em>calc_one</em> <strong>script</strong> first calls the first <em>fn_pass</em> function, and if the satellite is visible above the horizon and is not in the shade, it considers the brightness of the reflections as the <em>fn_reflection</em> function and the flash parameters with the <em>fn_flares</em> function: </p><br><pre> <code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">% calculate trajectory of the pass pass_path = fn_pass(param); % proceed if the satellite is above the horizon and not always in shadow if isempty(pass_path.reflection_intervals) == 0 % calculate the reflections and magnitudes of flares pass = fn_reflection(param, pass_path.reflection_intervals); pass = fn_flares(pass, param); end</span></span></code> </pre> <br><h1 id="font-colorcc0000optimizaciyafont">  Optimization </h1><br><p>  I have already mentioned the first optimization technique: this is a variable time step.  The <em>fn_pass</em> function works with a large step (1 s) - to check whether the satellite is visible above the horizon, this is more than enough.  But the <em>fn_reflection</em> function <em>has</em> three possible time steps: the smallest (up to 1 ms) is needed to calculate the flash profile, the other two - when the flash is not visible, but it may soon appear.  They are defined in the structure with parameters: </p><br><pre> <code class="matlab hljs">param.dt1 = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">% time step if the satellite is below horizon or in the shadow, s param.dt2 = 1; % same if satellite is above horizon, but reflection is far away param.dt3 = 1 * 1E-2; % same if satellite is above horizon, reflection is close param.dt4 = 5 * 1E-3; % same if reflection is seen</span></span></code> </pre> <br><p>  The second point is connected with built-in Matlab functions.  They were conceived to be universal - for example, the same cosine can be considered from both real and complex numbers, both single and as part of arrays.  Naturally, for this versatility, one has to check the input parameters.  In the case of simple functions such as scalar product, this test may take longer than the actual mathematics: </p><br><div class="spoiler">  <b class="spoiler_title">Built-in scalar function</b> <div class="spoiler_text"><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a,b,dim)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isinteger</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function"> || </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isinteger</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(b)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message('MATLAB:dot:integerClass')</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Special</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">case</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">A</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">B</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">are</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vectors</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dim</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">supplied</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ismatrix</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a)</span></span></span><span class="hljs-function"> &amp;&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ismatrix</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(b)</span></span></span><span class="hljs-function"> &amp;&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nargin</span></span></span><span class="hljs-function">&lt;3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(size(a)</span></span></span><span class="hljs-function">)==1, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(:)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(size(b)</span></span></span><span class="hljs-function">)==1, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(:)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function">; % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Check</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dimensions</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">any</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(size(a)</span></span></span><span class="hljs-function">~=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(b)</span></span></span><span class="hljs-function">), </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message('MATLAB:dot:InputSizeMismatch')</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nargin</span></span></span><span class="hljs-function">==2, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(conj(a)</span></span></span><span class="hljs-function">.*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(conj(a)</span></span></span><span class="hljs-function">.*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dim</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre></div></div><br><p>  In our code, most often, just vector and scalar products are called, as well as the normalization of a vector.  Therefore, it makes sense to write their own functions for them without checks - because all the vectors are obviously three-dimensional, and their components are real: </p><br><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fn_dot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a, b)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function">*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(2)</span></span></span><span class="hljs-function">*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(2)</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(3)</span></span></span><span class="hljs-function">*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(3)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p>  After that, the computation speed has approximately doubled. </p><br><div class="spoiler">  <b class="spoiler_title">Lyrical digression: anonymous functions in MATLAB.</b> <div class="spoiler_text"><p>  In general, there is such a thing as <a href="https://habrahabr.ru/post/199300/">anonymous functions</a> in the matlab.  The idea is to declare a function directly in the text of another function, without occupying an additional file.  It is argued that they make the code more readable and faster than individual functions. </p><br><p>  It turned out that in fact the opposite is true.  When I tried to declare scalar and vector products as anonymous functions, the calculations took much longer.  In the subtleties of the work of the matlab compiler, I am not strong, so it would be great if someone could explain what is happening. </p></div></div><br><p>  The code can be found on the <a href="https://github.com/qbertych/satellite_flares">githaba</a> .  The calculation of the flashes was checked at Iridium and gave meaningful results - the brightness of the flashes was about -9 magnitude. </p><br><h1 id="font-colorcc0000mayakfontanchorresultsanchor">  Lighthouse <a name="results"></a></h1><br><p>  Satellite "Mayak" is scheduled to launch this October into a circular orbit with a height of 600 km.  In central Russia, it will be best seen from about 22:00 to 02:00 local time.  Beacon film mirrors reflect light much worse than the Iridium antennas, but they surpass them in area. </p><br><div class="spoiler">  <b class="spoiler_title">Beacon Parameters</b> <div class="spoiler_text"><table><thead><tr><th>  Parameter </th><th>  Value </th></tr></thead><tbody><tr><td>  Orbit height </td><td>  400 - 600 km </td></tr><tr><td>  Orbit inclination </td><td>  97.7 ¬∞ </td></tr><tr><td>  Direction to ascending node </td><td>  -7.5 ¬∞ </td></tr><tr><td>  Mirror area </td><td>  3.8 m <sup>2</sup> </td></tr><tr><td>  Reflection divergence (1œÉ) </td><td>  17.2 ¬∞ </td></tr><tr><td>  Rotational speed </td><td>  unknown (expected 0.5 - 1 rps) </td></tr><tr><td>  Rotation axis orientation </td><td>  unknown </td></tr></tbody></table></div></div><br><p>  After entering the orbit, the satellite should open the mirrors and spin at a speed of about 1 revolution per second.  The problem is that the <strong>direction of the twist axis is not known in principle</strong> - there are no orientation systems or telemetry on the satellite.  A twist is added to all this when the cube is separated from the carrier.  Here, for example, two Cubsat launched from the ISS;  it is evident that immediately after launching, they already rotate in different ways: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a54/133/8ce/a541338ce726402c8a4320590cfe3c61.jpg"></div><br><p>  It remains to specify the random direction of the axis of rotation and orientation of the mirror in the <em>calc_one</em> script and see if the observer will see the satellite fly: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/8f1/ff8/ef0/8f1ff8ef0d9f45399209e499f8085205.png"></div><br><p>  Wow, something is visible!  On the left - the trajectory of the satellite in the Moscow sky, at about 11 o'clock in the evening.  The red dots are visible flashes of the satellite, the black line is the satellite in the shadow of the Earth and is not visible.  The graphs on the right are the brightness of the flashes (above) and their duration (below) depending on the time.  It can be seen that the flashes are bright, but short.  And judging by the abundance of points, there are really a lot of them (the script counted 330): </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/9f1/fc8/49f/9f1fc849f9174684a7c797fa527c1573.png" width="500"></div><br><p>  Flash at second!  Captain Evidence suggests that this is how it should be for a satellite that is swirling at a speed of 1 rev / s.  And the profile of a single flash looks like this: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/916/53b/0d1/91653b0d1e5b468ea632459f31ffb7e0.png" width="400"></div><br><p>  The flash is really short and ends at +6 magnitude when it becomes dimmer than the background. </p><br><p>  The main question that worries us is: <strong>when is the best time to observe flashes?</strong>  To do this, you can run the script for different positions (= different local time) of the observer.  What about the fact that we do not know the orientation of the satellite?  You can perform calculations each time for several random orientations of the mirror and the axis of rotation, and then choose the brightest flash.  The code will change like this: </p><br><pre> <code class="matlab hljs">line_theta_obs_0 = <span class="hljs-number"><span class="hljs-number">134</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">236</span></span>; <span class="hljs-comment"><span class="hljs-comment">% values of theta_obs_0 to be simulated number_of_iterations = 50; % number of different mirror orientations for one data point for counter_theta_obs_0 = 1:size(line_theta_obs_0,2) param.theta_obs_0 = line_theta_obs_0(counter_theta_obs_0); % calculate trajectory of the pass pass_path = fn_pass(param);</span></span></code> </pre> <br><p>  and if the satellite flies on the horizon, </p><br><pre> <code class="matlab hljs"> <span class="hljs-comment"><span class="hljs-comment">% loop over different random orientations of the mirror for counter_mirror = 1:number_of_iterations % create randomly oriented mirror and rotation axis param.d_rot = [rand, rand, rand]; param.n_mirror_0 = [rand, rand, rand]; % calculate the reflections and magnitudes of flares pass = fn_reflection(param, pass_path.reflection_intervals); pass = fn_flares(pass, param); end</span></span></code> </pre> <br><p>  We launch it for 50 observer positions and 50 random orientations of the satellite, waiting for midnight (yes, it takes a lot of time to simulate), we get the result: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/934/4c4/59d/9344c459d9d44dd88cdac0eaa3399065.png" width="500"></div><br><p>  <strong>The brightest flashes fall at midnight</strong> ‚Äî a fairly convenient time for observation.  Evening flashes can also be bright.  Unfortunately, shining brighter than Sirius and the planets will not work, but with a successful scenario, the satellite can be seen quite well.  It can be seen that the brightness of the flashes decreases as the satellite moves away from the zenith (lower blue graph), which is associated with an increase in the distance to the satellite when it flies near the horizon.  At the same time, the duration of the flashes (the average purple graph) remains almost unchanged. </p><br><p>  <strong>What is the chance to see a bright flash?</strong>  The only random element in the problem is the orientation of the satellite in orbit.  In the cycle according to the orientations of the satellite, it was necessary to maintain the flash brightness for each iteration, and then build a histogram.  ( <em>Damn, I had to think about it right away!</em> ) Add the necessary code and run the script for 100 satellite orientations.  The next morning we get the result: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/2c1/c66/83e/2c1c6683e9bb4ce2b046d5a4b4877f2c.png" width="600"></div><br><p>  Here different flashes of different brightness are shown.  The bar in the diagram is a specific local time;  the probability of flashes of all kinds of brightnesses in it is 100%.  <strong>It can be seen that the results are disappointing</strong> : </p><br><ul><li>  flashes brighter than Vega (magnitude +0) can be seen for about an hour from 11:15 to 00:15;  the probability of this is about 10%; </li><li>  flashes brighter than stars of the Big Dipper and Cassiopeia (brighter than +2) are visible a little longer than two hours (from 10 pm to half past midnight), the probability of seeing them is about 20%; </li><li>  <strong>with a probability of more than 50%, there will be no flares at all</strong> </li></ul><br><p>  <strong>Now the good news: three mirrors on the satellite</strong> .  This does not mean that the probability will increase threefold (if only because then we would receive meaningless probabilities of 150%).  But with a good arrangement of mirrors, an increase in the probability of two times is quite realistic, which is quite good.  If you are very lucky, it will be possible to observe flashes from two mirrors in turn.  Yes, it will not affect the brightness in any way - it will be possible to see anything brighter than Vega only at the ‚Äúfinest hour‚Äù around midnight. </p><br><p>  Let's count something else.  For example, <strong>how the flash brightness will vary depending on the satellite's spin speed</strong> . </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/bde/863/0a6/bde8630a6711475c9804843aff82c72d.png" width="500"></div><br><p>  If the satellite rotates too fast, the flashes become too short (lower graph).  Then the camera / eye rounds the exposure time to the lowest possible (1 frame or 0.03 s).  At the same time, the flash brightness will drop.  In our case, this happens at a spin of 3 rps. </p><br><p>  And if the rotation speed is the opposite, too small?  Also, nothing terrible up to ~ 0.01 rev / s.  But below the flash will go too rarely - it may happen that the first flash will end long before the zenith, and the second will start strongly after.  As far as I know, the Beacon will rotate at a speed of 0.1 - 1 rev / s, which is far from both the upper and lower limits - which means that with any twist we should see frequent bright flashes. </p><br><p>  <strong>Well, now about the sad.</strong>  <strong>The lighthouse century is very short</strong> - its huge mirrors will be slowed down by the residual atmosphere even at an altitude of 600 km.  During the month, the satellite will drop to 400 km, where braking is even stronger, and within a few days after that it will enter the dense layers of the atmosphere.        ,  ,     0.6  : </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/50b/291/0e2/50b2910e26fd428998d50169ced172f5.png" width="500"></div><br><p> <strong>:</strong> <a name="tldr"></a></p><br><ul><li>          . <strong>"   "    ‚Äî   , ,     .</strong> </li><li>     ( ,    ,    -  ) ‚Äî  20 %. </li><li>       ‚Äî     ""    . </li></ul><br><h1 id="font-colorcc0000vmesto-poslesloviyafont">  Instead of an afterword </h1><br><p> ,     ‚Äì  GUI,  ,  ,    CUDA    . ,   .            . </p><br><p> ,    <a href="https://habrahabr.ru/users/quiensabe/" class="user_link">Quiensabe</a>       .    ‚Äì     ,  ,  ! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/307212/">https://habr.com/ru/post/307212/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../307202/index.html">Security Week 31: News from Blackhat</a></li>
<li><a href="../307204/index.html">8 lectures to help understand machine learning and neural networks</a></li>
<li><a href="../307206/index.html">HEIST allows you to receive encrypted information in the HTTPS channel in clear text</a></li>
<li><a href="../307208/index.html">Debian Linux and Tor for a secure deb</a></li>
<li><a href="../307210/index.html">Common mistakes of the novice HTML maker-up</a></li>
<li><a href="../307214/index.html">Mikrotik QOS in distributed systems or smart shapers</a></li>
<li><a href="../307218/index.html">How many neurons do you need to find out if the Alexander Nevsky Bridge is divorced?</a></li>
<li><a href="../307220/index.html">This little miracle is the Knut-Morris-Pratt (KMP) algorithm.</a></li>
<li><a href="../307222/index.html">About pricing for indie games</a></li>
<li><a href="../307224/index.html">Fairy, evil corporation and duck. How games are really made. Part 2. Programmer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>