<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Move semantics in C ++ 11 and STL containers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is a small note about how with the advent of the new standard C ++ 11 standard container requirements for their elements have changed. In C ++ 98...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Move semantics in C ++ 11 and STL containers</h1><div class="post__text post__text-html js-mediator-article"> This is a small note about how with the advent of the <a href="http://ru.wikipedia.org/wiki/C%252B%252B11">new standard C ++ 11</a> standard container requirements for their elements have changed.  In C ++ 98, the container element was required, in fact, to have a ‚Äúreasonable‚Äù copy constructor and an assignment operator.  If, for example, an object in your class owns a resource, copying usually becomes impossible (at least without a "deep" copy of the resource).  As an example, let's consider the following wrapper class around <code>FILE*</code> written in C ++ 98: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">File</span></span></span><span class="hljs-class"> {</span></span> FILE* handle; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: File(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* filename) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !(handle = fopen(filename, <span class="hljs-string"><span class="hljs-string">"r"</span></span>)) ) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::runtime_error(<span class="hljs-string"><span class="hljs-string">"blah blah blah"</span></span>); } ~File() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (handle) fclose(handle); } <span class="hljs-comment"><span class="hljs-comment">// ... private: File(const File&amp;); //  void operator=(const File&amp;); //  };</span></span></code> </pre><br><a name="habracut"></a><br><br>  We have forbidden copying and assigning objects of this class, since copying <code>FILE*</code> would require some platform-dependent tweaks, and does not have a special physical meaning at all. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      What to do if you want to keep a whole list of objects of type <code>File</code> ?  Unfortunately, we cannot use <code>File</code> in a standard container, that is, such code simply does not compile: <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;File&gt; files; files.push_back(File(<span class="hljs-string"><span class="hljs-string">"data.txt"</span></span>));</code> </pre><br><br>  A typical solution to this problem in C ++ 98 is to use <code>shared_ptr</code> : <br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;boost::<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;File&gt; &gt; files; files.push_back(boost::<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;File&gt;(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(<span class="hljs-string"><span class="hljs-string">"data.txt"</span></span>)) );</code> </pre><br><br>  Such a solution is not particularly pleasing to the eye, especially considering that we use dynamic memory where it would seem that it is not needed. <br><br>  If we allow the use of C ++ 11, then the picture changes dramatically.  With the advent of <a href="http://stackoverflow.com/questions/3106110/what-are-move-semantics">move semantics</a> , standard containers no longer require the usual copy constructor and assignment operator, unless you intend to copy the entire container.  Instead, the semantics of displacement is sufficient.  Let's see how we can rewrite the example of the <code>File</code> class in C ++ 11: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">File</span></span></span><span class="hljs-class"> {</span></span> FILE* handle; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: File(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* filename) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !(handle = fopen(filename, <span class="hljs-string"><span class="hljs-string">"r"</span></span>)) ) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::runtime_error(<span class="hljs-string"><span class="hljs-string">"blah blah blah"</span></span>); } ~File() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (handle) fclose(handle); } File(File&amp;&amp; that) { handle = that.handle; that.handle = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; } File&amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>=(File&amp;&amp; that) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::swap(handle, that.handle); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } File(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> File&amp;) = <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  void operator=(const File&amp;) = delete; //  // ... };</span></span></code> </pre><br><br>  We again prohibit normal copying, but allow the object to be moved.  Now this code works: <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;File&gt; files; files.push_back(File(<span class="hljs-string"><span class="hljs-string">"data1.txt"</span></span>)); files.push_back(File(<span class="hljs-string"><span class="hljs-string">"data2.txt"</span></span>)); files.erase(files.begin());</code> </pre><br><br>  In addition, thanks to the variadic templates, a new template function <code>emplace_back</code> appeared in the containers, which allows you to create an object directly in the container without copying it: <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;File&gt; files; files.emplace_back(<span class="hljs-string"><span class="hljs-string">"data1.txt"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  File("data1.txt")   </span></span></code> </pre><br><br>  I hope that this note clearly shows how important the innovation is the semantics of moving objects.  All success in the transition to a new standard! </div><p>Source: <a href="https://habr.com/ru/post/174019/">https://habr.com/ru/post/174019/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../173995/index.html">China standardizes national OS based on Ubuntu</a></li>
<li><a href="../173997/index.html">GitLab 5.0 release</a></li>
<li><a href="../174005/index.html">Optimization history alpha_composite in Pillow 2.0</a></li>
<li><a href="../174007/index.html">Taiwan court allowed pirates to legally distribute adult films</a></li>
<li><a href="../174015/index.html">Comparing Serializable and Parcelable. In seconds</a></li>
<li><a href="../174021/index.html">OpenShot video editor with updated engine running on Windows and Mac</a></li>
<li><a href="../174023/index.html">Microsoft showed "smart" Excel - "formulas" can be set in "ordinary" language</a></li>
<li><a href="../174025/index.html">Nokia makes patent claims to the free VP8 video codec, blocking its adoption as a standard</a></li>
<li><a href="../174029/index.html">Accordion menu on pure CSS</a></li>
<li><a href="../174031/index.html">500 experiments that separate you from a successful project.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>