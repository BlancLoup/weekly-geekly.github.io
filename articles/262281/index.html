<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tekla Structure API (c #): connecting and retrieving a tree of objects</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tekla Structure ( see of.sayt ) - a system that automates the process of designing buildings. When used in large companies, it is natural to want to i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tekla Structure API (c #): connecting and retrieving a tree of objects</h1><div class="post__text post__text-html js-mediator-article">  <b>Tekla Structure</b> ( <a href="http://www.tekla.com/ru/%25D0%259F%25D1%2580%25D0%25BE%25D0%25B4%25D1%2583%25D0%25BA%25D1%2586%25D0%25B8%25D1%258F/tekla-structures">see of.sayt</a> ) - a system that automates the process of designing buildings.  When used in large companies, it is natural to want to integrate Tekl into the already existing enterprise management system. <br><br>  So, the first task is to get a tree of model objects.  The tree should have the following form - model -&gt; assemblies ( <i>Assembly</i> ) of which the model consists -&gt; parts of which assemblies consist ( <i>Part</i> ).  The object tree must be obtained from existing drawings, i.e.  we will analyze the model through the prism of the list of drawings (it sounds obscure, but in the course of the article everything will become clear). <br><br>  The used development system is the Visual Studio 2013 Community, c # language. <br><a name="habracut"></a><br>  Tekla Structure has its api and even a special <a href="http://www.tekla.com/openAPI">StartUp Package</a> (you can download it after registering on the site), after installing it, DeveloperGuide, api help and examples appear in the directory where Tekla is installed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After creating a new project, first of all we add the necessary * .dll to References.  For the current task we need the following: <br><ol><li>  Tekla.Structures.dll (common functions) </li><li>  Tekla.Structures.Model.dll (for working with the model itself) </li><li>  Tekla.Structures.Drawing.dll (for working with drawings) </li></ol><br>  <b>Connect to Tekla Structure</b> <br>  To connect, it is necessary that Tekla Structure be launched and the required model be opened in it. <br><br><pre><code class="cs hljs">... <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Tekla.Structures; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Tekla.Structures.Drawing; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Tekla.Structures.Model; ... Model model; DrawingHandler CurrentDrawingHandler; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainForm</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { model = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Model(); <span class="hljs-comment"><span class="hljs-comment">//    CurrentDrawingHandler = new DrawingHandler(); //    //    if (model.GetConnectionStatus() &amp;&amp; CurrentDrawingHandler.GetConnectionStatus()) { InitializeComponent(); } else MessageBox.Show("Tekla Structures must be opened!"); }</span></span></code> </pre> <br><h4>  Getting a list of drawings </h4><br>  Two options have been developed for obtaining a list <br><pre> <code class="cs hljs"> ... DrawingEnumerator drawingsEnum; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rbSelectedDrawings.Checked) drawingsEnum = CurrentDrawingHandler.GetDrawingSelector().GetSelected(); <span class="hljs-comment"><span class="hljs-comment">// ,   else drawingsEnum = CurrentDrawingHandler.GetDrawings(); //    ...</span></span></code> </pre><br><h4>  Building a tree </h4><br>  Here it is particularly worth noting the method of obtaining the drawing object ( <i>Drawing</i> ) as an object of the model ( <i>Model</i> ), since  All information (composition, weight, length, brand, materials, etc.) is located in the model object. <br><br>  To assemble: <br><br><pre> <code class="cs hljs">Assembly assembly = model.SelectModelObject(((drawingsEnum.Current <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> AssemblyDrawing)).AssemblyIdentifier) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Assembly;</code> </pre><br>  For details: <br><br><pre> <code class="cs hljs">Tekla.Structures.Model.Part part = model.SelectModelObject((drawingsEnum.Current <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> SinglePartDrawing).PartIdentifier) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Tekla.Structures.Model.Part;</code> </pre><br>  To get the parameters from the report, use the following method: ( <i>all the available parameters can be viewed in Tekl when considering the drawing template</i> ): <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> number = <span class="hljs-number"><span class="hljs-number">0</span></span>; assembly.GetReportProperty(<span class="hljs-string"><span class="hljs-string">"MODEL_TOTAL"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> number); <span class="hljs-comment"><span class="hljs-comment">//    string assembly_pos = ""; assembly.GetReportProperty("ASSEMBLY_POS", ref assembly_pos); //    double thickness = 0.0; part.GetReportProperty("PROFILE.WIDTH", ref thickness); //   ...</span></span></code> </pre><br>  The very construction of the tree: <br><br><pre> <code class="cs hljs"> ... NameElement = <span class="hljs-string"><span class="hljs-string">""</span></span>; ProjectInfo projectInfo = model.GetProjectInfo(); <span class="hljs-comment"><span class="hljs-comment">//    - , ,   .. ModelInfo modelInfo = model.GetInfo(); //    -      TreeNode parentNode = new TreeNode(); parentNode.Text = projectInfo.ProjectNumber; //   -   (  ) while (drawingsEnum.MoveNext()) //   { if (drawingsEnum.Current is AssemblyDrawing) //     { Assembly assembly = model.SelectModelObject(((drawingsEnum.Current as AssemblyDrawing)).AssemblyIdentifier) as Assembly; string assembly_pos = ""; assembly.GetReportProperty("ASSEMBLY_POS", ref assembly_pos); NameElement = assembly_pos; } else if (drawingsEnum.Current is SinglePartDrawing) //     { Tekla.Structures.Model.Part part = model.SelectModelObject((drawingsEnum.Current as SinglePartDrawing).PartIdentifier) as Tekla.Structures.Model.Part; string part_pos = ""; part.GetReportProperty("PART_POS", ref part_pos); NameElement = part_pos; } TreeNode drawingNode = new TreeNode(); drawingNode.Tag = drawingsEnum.Current; drawingNode.Text = NameElement; if (drawingsEnum.Current is AssemblyDrawing) AddChildDrawingObjectsToTreeNode(drawingNode, drawing as AssemblyDrawing); //      parentNode.Nodes.Add(drawingNode); } ...</span></span></code> </pre><br><h4>  Getting assembly parts </h4><br>  Please note that the assembly has one main part assembly.GetMainPart () and many minor assembly.GetSecondaries ().  We need to get both those and others. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddChildDrawingObjectsToTreeNode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TreeNode parentNode, AssemblyDrawing parentDrawing</span></span></span><span class="hljs-function">)</span></span> { Assembly assembly = model.SelectModelObject(parentDrawing.AssemblyIdentifier) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Assembly; Tekla.Structures.Model.Part part = assembly.GetMainPart() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Tekla.Structures.Model.Part; <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> part_pos = <span class="hljs-string"><span class="hljs-string">""</span></span>; part.GetReportProperty(<span class="hljs-string"><span class="hljs-string">"PART_POS"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> part_pos); TreeNode objectNode = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TreeNode(); objectNode.Tag = part; objectNode.Text = part_pos; parentNode.Nodes.Add(objectNode); ArrayList secondaries = assembly.GetSecondaries(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; secondaries.Count; i++) { Tekla.Structures.Model.ModelObject modelObject = secondaries[i] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Tekla.Structures.Model.ModelObject; part_pos = <span class="hljs-string"><span class="hljs-string">""</span></span>; modelObject.GetReportProperty(<span class="hljs-string"><span class="hljs-string">"PART_POS"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> part_pos); objectNode = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TreeNode(); objectNode.Tag = modelObject; objectNode.Text = part_pos; parentNode.Nodes.Add(objectNode); } }</code> </pre><br>  It is worth noting that from all the details ( <i>Part</i> ) we can also get the child elements using the method: <br><br><pre> <code class="cs hljs">ModelObjectEnumerator modelObjectEnum = part.GetChildren();</code> </pre><br>  The first problem is solved. <br><br><h4>  Sources Used When Writing Code </h4><br><ol><li>  <a href="http://cadsupport.ru/tekla-api-faq/">cadsupport.ru</a> </li><li>  <a href="http://software-solutions-online.com/category/tekla/">software-solutions-online.com</a> </li><li>  <a href="http://topengineer.ru/forum/viewforum.php%3Ff%3D1">topengineer.ru</a> </li><li>  well and, of course, help on api, example and other data provided by Tekl itself </li></ol></div><p>Source: <a href="https://habr.com/ru/post/262281/">https://habr.com/ru/post/262281/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262269/index.html">ERP on SKALA-R - we are testing the performance of the SAP and Oracle Database bundles</a></li>
<li><a href="../262271/index.html">A simple method for extracting relationships and facts from text.</a></li>
<li><a href="../262275/index.html">Non-PKI or social packages for employees</a></li>
<li><a href="../262277/index.html">Selection of interesting materials of the week for iOS developers</a></li>
<li><a href="../262279/index.html">Generating LINQ to SQL Code for SQLite in .NET (C #)</a></li>
<li><a href="../262283/index.html">From AutoCAD yes to nanoCAD: change of the main CAD system in the design institute</a></li>
<li><a href="../262285/index.html">Using configurable logic cells PIC microcontrollers to control WS2812</a></li>
<li><a href="../262287/index.html">Computer algebra systems for working with tensors</a></li>
<li><a href="../262289/index.html">The best reports of the DevCon 2015 conference - Top 10</a></li>
<li><a href="../262295/index.html">Evolution go</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>