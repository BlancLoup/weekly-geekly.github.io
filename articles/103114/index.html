<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>External Term Format</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If any program needs to transfer data to an erlang server, this data must first be serialized. That is, converted to a binary form, so that the Erlang...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>External Term Format</h1><div class="post__text post__text-html js-mediator-article">  If any program needs to transfer data to an erlang server, this data must first be serialized.  That is, converted to a binary form, so that the Erlang can then unpack them back.  This is usually done using ASN.1, google protobuf, thrift, etc.  All this is without a doubt worthy products. <br><br>  As an alternative, you can consider the use of Erlang external term format.  Erlang‚Äôs executable system has two functions - <i>term_to_binary ()</i> and <i>binary_to_term ()</i> , which can efficiently and quickly pack / unpack any values ‚Äã‚Äãinto this format, and the format itself is well described in the documentation - <a href="http://www.erlang.org/doc/apps/erts/erl_ext_dist.html">www.erlang.org/doc/apps/erts/ erl_ext_dist.html</a> <br><br>  How it all works. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Ext.  The format is very simple in structure.  Typically, the data in it have the form "tag, data" or "tag, length, data."  The tag describes what type of data is packed. <br><br>  For basic data types, tags are <br><br><ul><li>  <b>Tuple</b> - 104, number of elements (1 byte), all elements </li><li>  <b>List</b> - 108, number of elements (4 bytes), all elements, 106 </li><li>  <b>Atom</b> - 115, length (1 byte), text of an atom </li><li>  <b>Integer</b> - 98, value (4 bytes), or for a <b>short integer</b> (less than 255) - 97, value (1 byte) </li><li>  <b>Line</b> - 107, length (2 bytes), text.  In principle, a string can be encoded as a list of integers, but if you need to transfer a short string with 8-bit text, this tag is what the doctor ordered </li></ul><br><br>  All the packed data should be tagged 131. This is the version number of the current ext.  term format. <br><br>  That is, the Erlang value [{banknote, 100, rub}] will be packaged in the structure: <br><br><img src="https://habrastorage.org/storage1/ae19c8a1/87f35a55/487c5ef9/7595625c.png"><br><br>  As a proof of concept, we will write, for example, on a python a simple procedure that packs python structures in ext term format, and unpack the result on an erlang ... <br><br>  We will pack a Python list into an Erlang list, a Python tuple into an Erlang tuple, integers, Python strings.  For atoms ... well ... for example, we will create an heir from the string in python so that they can be easily distinguished in the packing procedure from ordinary strings. <br><br>  It turns out something like: <br><br><pre><code class="hljs python"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> types <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> IntType, StringType, TupleType, ListType <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> struct <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pack <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> socket <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">atom</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(str)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_eterm</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x,accum)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> type(x) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> IntType: accum.append(pack(<span class="hljs-string"><span class="hljs-string">'&gt;Bi'</span></span>,<span class="hljs-number"><span class="hljs-number">98</span></span>,x)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> type(x) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> StringType: accum.append(pack(<span class="hljs-string"><span class="hljs-string">"&gt;BH"</span></span>,<span class="hljs-number"><span class="hljs-number">107</span></span>,len(x))) accum.append(x) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> type(x) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> TupleType: accum.append(pack(<span class="hljs-string"><span class="hljs-string">"BB"</span></span>,<span class="hljs-number"><span class="hljs-number">104</span></span>,len(x))) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> term <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> x: _eterm(term,accum) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> type(x) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> ListType: accum.append(pack(<span class="hljs-string"><span class="hljs-string">"&gt;BI"</span></span>,<span class="hljs-number"><span class="hljs-number">108</span></span>,len(x))) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> term <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> x:_eterm(term,accum) accum.append(chr(<span class="hljs-number"><span class="hljs-number">106</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(x,atom): accum.append(pack(<span class="hljs-string"><span class="hljs-string">"BB"</span></span>,<span class="hljs-number"><span class="hljs-number">115</span></span>,len(x))) accum.append(x) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> AssertionError(<span class="hljs-string"><span class="hljs-string">"Cannot convert that type to erlang term %s"</span></span>%(x)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">binary</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(X)</span></span></span><span class="hljs-function">:</span></span> accum = [chr(<span class="hljs-number"><span class="hljs-number">131</span></span>)] _eterm(X,accum) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>.join(accum)</code> </pre> <br><br>  Fine.  Now we will pack some complicated structure and transfer it to Erlang in the simplest way. <br><br><pre> <code class="hljs lisp">pterm = (<span class="hljs-name"><span class="hljs-name">atom</span></span>(<span class="hljs-string"><span class="hljs-string">"vcard"</span></span>),[(<span class="hljs-name"><span class="hljs-name">atom</span></span>(<span class="hljs-string"><span class="hljs-string">"firstname"</span></span>),<span class="hljs-string"><span class="hljs-string">"Odobenus"</span></span>), (<span class="hljs-name"><span class="hljs-name">atom</span></span>(<span class="hljs-string"><span class="hljs-string">"lastname"</span></span>),<span class="hljs-string"><span class="hljs-string">"Rosmarus"</span></span>), (<span class="hljs-name"><span class="hljs-name">atom</span></span>(<span class="hljs-string"><span class="hljs-string">"age"</span></span>),<span class="hljs-number"><span class="hljs-number">48</span></span>), (<span class="hljs-name"><span class="hljs-name">atom</span></span>(<span class="hljs-string"><span class="hljs-string">"children"</span></span>),[ (<span class="hljs-string"><span class="hljs-string">"Dimon"</span></span>,<span class="hljs-number"><span class="hljs-number">1988</span></span>), (<span class="hljs-string"><span class="hljs-string">"Natashka"</span></span>,<span class="hljs-number"><span class="hljs-number">1990</span></span>), (<span class="hljs-string"><span class="hljs-string">"Katka"</span></span>,<span class="hljs-number"><span class="hljs-number">2000</span></span>), (<span class="hljs-string"><span class="hljs-string">"Anka"</span></span>,<span class="hljs-number"><span class="hljs-number">2003</span></span>)] ) erlterm = binary(<span class="hljs-name"><span class="hljs-name">pterm</span></span>) sock = socket.socket(<span class="hljs-name"><span class="hljs-name">socket</span></span>.AF_INET, socket.SOCK_DGRAM) sock.sendto(<span class="hljs-name"><span class="hljs-name">erlterm</span></span>,(<span class="hljs-string"><span class="hljs-string">"localhost"</span></span>,<span class="hljs-number"><span class="hljs-number">10000</span></span>))</code> </pre><br><br>  That is, they packed and sent a udp packet.  In erlang we accept and decode: <br><br><pre> <code class="hljs erlang-repl"><span class="hljs-meta"><span class="hljs-meta">1&gt; </span></span>gen_udp:open(<span class="hljs-number"><span class="hljs-number">10000</span></span>,[binary]). {ok,#Port&lt;<span class="hljs-number"><span class="hljs-number">0.585</span></span>&gt;} <span class="hljs-number"><span class="hljs-number">2</span></span>&gt; R=receive {udp,_ ,_,_,Bin} -&gt; Bin end. &lt;&lt;<span class="hljs-number"><span class="hljs-number">131</span></span>,<span class="hljs-number"><span class="hljs-number">104</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">115</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">118</span></span>,<span class="hljs-number"><span class="hljs-number">99</span></span>,<span class="hljs-number"><span class="hljs-number">97</span></span>,<span class="hljs-number"><span class="hljs-number">114</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>,<span class="hljs-number"><span class="hljs-number">108</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">104</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">115</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">102</span></span>,<span class="hljs-number"><span class="hljs-number">105</span></span>,<span class="hljs-number"><span class="hljs-number">114</span></span>,<span class="hljs-number"><span class="hljs-number">115</span></span>,<span class="hljs-number"><span class="hljs-number">116</span></span>,<span class="hljs-number"><span class="hljs-number">110</span></span>,<span class="hljs-number"><span class="hljs-number">97</span></span>,<span class="hljs-number"><span class="hljs-number">109</span></span>,<span class="hljs-number"><span class="hljs-number">101</span></span>,<span class="hljs-number"><span class="hljs-number">107</span></span>,...&gt;&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>&gt; binary_to_term( R ). {vcard,[{firstname,<span class="hljs-string"><span class="hljs-string">"Odobenus"</span></span>}, {lastname,<span class="hljs-string"><span class="hljs-string">"Rosmarus"</span></span>}, {age,<span class="hljs-number"><span class="hljs-number">48</span></span>}, {children,[{<span class="hljs-string"><span class="hljs-string">"Dimon"</span></span>,<span class="hljs-number"><span class="hljs-number">1988</span></span>}, {<span class="hljs-string"><span class="hljs-string">"Natashka"</span></span>,<span class="hljs-number"><span class="hljs-number">1990</span></span>}, {<span class="hljs-string"><span class="hljs-string">"Katka"</span></span>,<span class="hljs-number"><span class="hljs-number">2000</span></span>}, {<span class="hljs-string"><span class="hljs-string">"Anka"</span></span>,<span class="hljs-number"><span class="hljs-number">2003</span></span>}]}]}</code> </pre><br><br><h5>  findings </h5><br><br>  We have transferred (by small blood) a complex structure from a python to an erlang.  The advantages of this approach - <ul><li>  Flexibility.  You can pack anything. </li><li>  Performance.  On the erlang <i>binary_to_term ()</i> and <i>term_to_binary () are</i> implemented as BIF, in C, and well optimized for speed and memory ... </li></ul><br><br>  Lack of ext.  Term format-a: Any flexibility has a downside.  In the case of hand curves or stupid programming, you can pack structures with which the Erlang server just won't know what to do. <br><br>  The formats of double numbers, dimensionless integers, transfer of compressed data, binary packaging into this format, etc. are outside the article.  etc.  But all this is well described in the documentation. <br><br>  The main thing to understand the idea. </div><p>Source: <a href="https://habr.com/ru/post/103114/">https://habr.com/ru/post/103114/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../103105/index.html">New feature in Gmail - Priority Inbox</a></li>
<li><a href="../103108/index.html">The Myth of Free H.264</a></li>
<li><a href="../103109/index.html">Skype connect</a></li>
<li><a href="../103110/index.html">What does a person think when buying applications on the iPhone</a></li>
<li><a href="../103111/index.html">Online Business Reputation</a></li>
<li><a href="../103115/index.html">Take part in testing and earn 1500 rubles</a></li>
<li><a href="../103116/index.html">Mail.Ru holds the first Technology Forum.</a></li>
<li><a href="../103117/index.html">Droider Chart. Release 16</a></li>
<li><a href="../103121/index.html">We are testing the new Intel Parallel Studio XE 2011 beta</a></li>
<li><a href="../103123/index.html">Change in import duties</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>