<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cryptography in simple language: parse symmetric and asymmetric encryption on the example of the Star Wars plot (Updated)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello to all readers of Habr! Not so long ago, I decided to deal with encryption algorithms and electronic signature principles. The topic, I think, i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cryptography in simple language: parse symmetric and asymmetric encryption on the example of the Star Wars plot (Updated)</h1><div class="post__text post__text-html js-mediator-article">  Hello to all readers of Habr!  Not so long ago, I decided to deal with encryption algorithms and electronic signature principles.  The topic, I think, is interesting and relevant.  In the process of learning I tried several libraries, but the most convenient from my point of view is the <a href="https://www.dlitz.net/software/pycrypto/">PyCrypto</a> library.  She has excellent documentation, accompanied by examples. <br><br><img src="https://habrastorage.org/webt/66/he/oz/66heoz7zb5m8gxup9igsegwjlog.png" alt="image"><br><br>  <b>After reading the material you learn the following points:</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  What is encryption; </li><li>  What distinguishes symmetric encryption from asymmetric; </li><li>  In which case it is more efficient to use symmetric, and in which asymmetric encryption; </li><li>  What is a data hash and what is it used for in encryption; </li></ol><br>  The relevance of the topic is constantly growing.  The use of cryptography has long been not limited to encrypting information.  Encryption algorithms in one form or another are used daily by us when visiting sites via the HTTPS protocol, when making purchases with a bank card, and when communicating in instant messengers.  Over the past few years, blockchain technologies, which are also based on cryptography, have received wide attention. <br><br>  The purpose of this article is to acquaint the reader with the basic encryption algorithms.  When writing an article, I tried to give as much attention as possible to the question of practical application.  Python 3.6 was used for programming.  When writing code, I tried to divide it into separate parts and comment on all key points. <br><a name="habracut"></a><br>  In this article, I did not understand the digital signature, but after understanding asymmetric encryption, the meaning of this technology will become clear. <br><br><h3>  Plot </h3><br>  Let us mentally transfer to the Star Wars universe before the events of Episode 6, when the resistance forces become aware of the start of building a new Death Star.  The command plans to introduce a reconnaissance group under the guise of builders.  The operation is very dangerous, communication with the headquarters will be difficult.  In the case of emergency Stew, each member of the group can send and receive messages from headquarters on an unprotected frequency. <br><br>  The purpose of the reconnaissance group is any data that can shed light on the configuration, weaponry and designation of the future station.  For data storage it is planned to develop special equipment and software. <br><br>  <b>The headquarters approved two variants of this operation:</b> <br><br>  Plan A - returning agents with data to rebel forces; <br>  Plan B - remote transmission of plans from the Death Star itself, using the equipment of the station.  <i>The transfer of information in this case will be fast, but after the transfer, the agent is likely to be calculated and caught.</i> <br><br><div class="spoiler">  <b class="spoiler_title">Scheme</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/cv/xz/or/cvxzormscazwyzscn90hvzrdmqq.png" alt="image"><br></div></div><br>  You are a programmer in a team that is responsible for software development. <br><br>  <b>When planning an operation, several possible negative scenarios are considered:</b> <br><br><ul><li>  The enemy intercepts the signal, understands its contents about the planning of the attack, and takes the object closer to the forces loyal to the Empire.  In this case, losses among resistance will be higher; </li><li>  One of the spies will be caught and will disclose an operation plan during interrogation, which may lead to compromise of the encryption keys (they will be discussed below); </li><li>  A spy with loaded data can be intercepted by imperial forces, which will make changes to the contents, misinforming the resistance about the weak points of the station.  In this case, when attacking, the rebel fleet will be sent in the wrong direction and gradually destroyed; </li></ul><br>  <b>Of these scenarios, the tasks are modeled:</b> <br><br><ol><li>  Content must be securely encrypted and protected from changes; </li><li>  In the case of loss of encryption keys or their compromise, it should be possible to obtain new encryption keys remotely at a frequency that can be heard by the enemy. </li></ol><br><h4>  Information encryption </h4><br>  Let's solve the problem of encrypting information: <br><br>  Encryption key is used to encrypt and decrypt information.  It is the key that makes encryption reversible.  Each agent will be provided with an encryption key.  After downloading the data, the agent will encrypt it and send it to the resistance headquarters. <br><br><div class="spoiler">  <b class="spoiler_title">Description of encryption principle</b> <div class="spoiler_text">  The method by which encryption and decryption of a message is performed using a single key is called <i>symmetric encryption</i> . <br><br><img src="https://habrastorage.org/webt/or/pn/ar/orpnarkw6jyoz-vdtqwwf7ap4vi.png" alt="image"><br><br>  The weak point of symmetric encryption is the encryption key, or rather its delivery to the addressee.  If the key is compromised during delivery, the third party will easily decode the message.  The strength of symmetric encryption is its speed, which makes it possible to encode large amounts of data. <br><br>  <i>Asymmetric encryption</i> to encrypt data uses two interconnected keys: public and private. <br><br><img src="https://habrastorage.org/webt/vg/bo/i3/vgboi3dy5tbj3tbta36ul-ybdau.png" alt="image"><br><br>  <b>The mechanism of action is as follows:</b> <br><br><ol><li>  the addressee sends the OPEN key to the sender; </li><li>  The sender encodes the message using the received public key.  At the same time, the message can now be decoded only by the private key; </li><li>  when receiving an encrypted message, the recipient decodes it with a CLOSED key (which was generated in a pair with an open one). </li></ol><br></div></div><br>  Let's get started in programming!  To develop the necessary software, we will use the Python library called <a href="https://pypi.org/project/pycrypto/">pycrypto</a> .  She has excellent documentation and presents all common encryption algorithms. <br><br>  To begin with, we will develop a functional for symmetric encryption called <a href="https://ru.wikipedia.org/wiki/Advanced_Encryption_Standard">Advanced Encryption Standard (AES)</a> .  It is one of the most common symmetric encryption algorithms. <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> Crypto.Cipher <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> AES <span class="hljs-comment"><span class="hljs-comment">#   from Crypto.Hash import SHA256 #        SHA. from Crypto.Hash import MD5 #            32  from Crypto import Random def transform_password(password_str): """Transform the password string into 32 bit MD5 hash :param password_str: &lt;str&gt; password in plain text; :return: &lt;str&gt; Transformed password fixed length """ h = MD5.new() h.update(key.encode()) return h.hexdigest() def symmetric_encrypt(message, key, verbose = True): """Encripts the message using symmetric AES algorythm. :param message: &lt;str&gt; Message for encryption; :param key: &lt;object&gt; symmetric key; :return: &lt;object&gt; Message encrypted with key """ key_MD5 = transform_password(key) #      32  message_hash = SHA256.new(message.encode()) message_with_hash = message.encode() + message_hash.hexdigest().encode() #     .      iv = Random.new().read(AES.block_size) cipher = AES.new(key_MD5, AES.MODE_CFB, iv) #     . AES.MODE_CFB -   ,      iv. https://www.dlitz.net/software/pycrypto/api/current/Crypto.Cipher.blockalgo-module.html#MODE_CFB encrypted_message = iv + cipher.encrypt(message_with_hash) #       .  ,       ,       . if verbose: print(f'Message was encrypted into: {encrypted_message.hex()}') return encrypted_message def symmetric_decrypt(encr_message, key): """Decripts the message using private_key and check it's hash :param encrypted_message: &lt;object&gt; Encrypted message :param key: &lt;object&gt; symmetric key; :return: &lt;object&gt; Message decripted with key """ key_MD5 = transform_password(key) #   ,      bsize = AES.block_size dsize = SHA256.digest_size*2 iv = Random.new().read(bsize) cipher = AES.new(key_MD5, AES.MODE_CFB, iv) decrypted_message_with_hesh = cipher.decrypt(encr_message)[bsize:] #     ,      decrypted_message = decrypted_message_with_hesh[:-dsize] #   ,      digest = SHA256.new(decrypted_message).hexdigest() #    .     ,     . if digest==decrypted_message_with_hesh[-dsize:].decode(): #      ,      ,   print(f"Success!\nEncrypted hash is {decrypted_message_with_hesh[-dsize:].decode()}\nDecrypted hash is {digest}") return decrypted_message.decode() else: print(f"Encryption was not correct: the hash of decripted message doesn't match with encrypted hash\nEncrypted hash is {decrypted_message_with_hesh[-dsize:]}\nDecrypted hash is {digest}")</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Check the code for example</b> <div class="spoiler_text"><pre> <code class="python hljs">message = <span class="hljs-string"><span class="hljs-string">"""  120   120  / 120   10     30-5 (2)    4.0 """</span></span> key = <span class="hljs-string"><span class="hljs-string">'Traveling through hyperspace ain'</span></span>t like dusting crops, farm boy.<span class="hljs-string"><span class="hljs-string">' encr_message = symmetric_encrypt(message, key, verbose = True) print('</span></span>\n<span class="hljs-string"><span class="hljs-string">') print('</span></span>DECRIPTION<span class="hljs-string"><span class="hljs-string">') decr_message = symmetric_decrypt(encr_message, key) print(decr_message)</span></span></code> </pre><br><pre> <code class="plaintext hljs">Message was encrypted into: ed10e4c65358bb9e351c801c3b3200b21fa86a24021c317bb5c9d8b3f76bdf9f3a7d26781a22402f0e4f41ca831b6d2da9e1e6878c34c79ddc7959af3ae9fc2ba0cfff1c0180a7e0f637f1aa5b24507d552d5dfe7625e7b81d817b5882b2b19bb95f3988a03c78f850098dfc8e6089863deaa39b887eaea4c1d4ba006edaec90205d54b27ed4ac70ed75cdd01732e1176bf04218beb8ae742ff708a201a9d1cb57dd5f2e70dc3239208d23705f7a3aae3e315c4df6d73c871b66c4995cce5f19738f731cd58755d21ed92612c44197f875cddf3f7aa1d60e435ce1492679b9d60c4b8538f52408f321711ac1d2daa6dbbc33dc655abca10e2f5fd3ff27823995b9dcdb62c0bafc1963ab539ccb466f1c140479df34b0005f578f72fcdd76b17391332037b801f74f733a08 DECRIPTION Success! Encrypted hash is b0dbb35b28fbff258350a50c39282b73e31f408c9da937c81d8d48115b491026 Decrypted hash is b0dbb35b28fbff258350a50c39282b73e31f408c9da937c81d8d48115b491026  120   120  / 120   10     30-5 (2)    4.0</code> </pre><br></div></div><br>  <i>As you can see, we successfully encrypted the message with the public key.</i> <i><br></i>  <i>Run the code several times.</i>  <i>You will see that each time the encrypted part changes.</i>  <i>This happens because during encryption, we applied the Cipher FeedBack (AES.MODECFB) mode, in which the plaintext blocks are mixed with the ciphertext blocks.</i>  <i>iv - initialization vector (read more about the mode <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B5%25D0%25B6%25D0%25B8%25D0%25BC_%25D0%25BE%25D0%25B1%25D1%2580%25D0%25B0%25D1%2582%25D0%25BD%25D0%25BE%25D0%25B9_%25D1%2581%25D0%25B2%25D1%258F%25D0%25B7%25D0%25B8_%25D0%25BF%25D0%25BE_%25D1%2588%25D0%25B8%25D1%2584%25D1%2580%25D0%25BE%25D1%2582%25D0%25B5%25D0%25BA%25D1%2581%25D1%2582%25D1%2583">here</a> ).</i>  <i>When decrypting a message, we see that the hash of the decrypted message coincides with the hash that we added during encryption.</i>  <i>This means that the decoding was correct.</i> <i><br></i> <br><div class="spoiler">  <b class="spoiler_title">What is a hash</b> <div class="spoiler_text">  A document hash is simply a string of characters that is unique to a particular dataset.  With any change in the data hash is very much changed.  In other words, a hash is a kind of ‚Äúfingerprint‚Äù for any data set. <br><br><img src="https://habrastorage.org/webt/qn/tf/v3/qntfv3yr0oiaexp1o_jzekwsd1o.png"><br></div></div><br>  But what if the encryption keys are compromised for some reason?  Then anyone can decipher the information. <br><br>  In this case, we need to somehow change the encryption keys remotely in frequency, which can be heard by the enemy.  We assume that it is already listening.  So how do we do this?  Here comes another method called asymmetric encryption (or a public key cryptographic system).  Unlike symmetric encryption, it uses two keys: open and closed.  The message is encrypted with the public key, after which it can only be decrypted with the private key.  The public key in decryption will be useless.  However, there is an important point: the private key must necessarily be from the generated pair with an open one.  Having a public key is one of several important and interesting properties of asymmetric encryption.  That is, we can transmit the public key by any channel and not be afraid that it will be used to decrypt the message. <br><br>  At the same time, in relation to our task, there is one nuance - asymmetric encryption is suitable for small data, for example, short messages.  We can only guess about the amount of data obtained by intelligence.  Of course, we can break all the data into small fragments and encode each of them with a private key, but there is a more optimal solution.  (The problem is addressed <a href="https://security.stackexchange.com/questions/33434/rsa-maximum-bytes-to-encrypt-comparison-to-aes-in-terms-of-security">here</a> ). <br><br>  <b>Decision</b> <br><br><blockquote>  <i>User Akela_wolf rightly noticed, anyone can generate and send the public key.</i>  <i>I made some adjustments to the plan.</i> <br><br>  It will be correct if, before sending agents, the headquarters will generate several key pairs and assign a private key to each agent.  It is better to generate just a few pairs, so that each agent has an individual key.  This is necessary to precisely personalize the key owner. <br>  Then, in the event of key compromise, the center will create a new SYMMETRIC key, encode it to each agent with public keys and send it through an open channel. <br><div class="spoiler">  <b class="spoiler_title">General solution scheme</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ge/uk/q3/geukq3vj-o8ab3bkta_i5y-8xsa.png"><br><img src="https://habrastorage.org/webt/5l/sn/fy/5lsnfygzrehgkfjlq6qzon-wbdw.png"><br></div></div><br><br></blockquote><br><br><div class="spoiler">  <b class="spoiler_title">Old solution</b> <div class="spoiler_text"><ol><li>  The agent will generate a key pair (open and closed) in place, then send the public key to the rebel forces; </li><li>  At the headquarters of the resistance will create a new key for SYMMETRIC encryption; </li><li>  The symmetric key is encoded with the public key that the agent sent; </li><li>  The encrypted symmetric key will be sent to the agent who decodes it with the private key. </li></ol><br>  <i>Pay attention to our broadcast on the open channel:</i> <i><br><br></i> <ol><li>  The agent sends the OPEN key from the pair, the CLOSED key is with him; </li><li>  The headquarters of the resistance sends a symmetric encryption key, encrypted by the public key sent by the agent. </li></ol><br><br>  Neither the first nor the second message represent any value during the interception. <br></div></div><br><br>  Write the code: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#          RSA. #        SHA256 from Crypto.PublicKey import RSA #      def generate_keys(bits = 2048): """Generates the pair of private and public keys. :param bits: &lt;int&gt; Key length, or size (in bits) of the RSA modulus (default 2048) :return: &lt;object&gt; private_key, &lt;object&gt; public_key """ private_key = RSA.generate(bits) public_key = private_key.publickey() return private_key, public_key private_key, public_key = generate_keys(bits = 2048)</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Let's see what the keys look like.</b> <div class="spoiler_text"><pre> <code class="python hljs">print(private_key.exportKey(format=<span class="hljs-string"><span class="hljs-string">'PEM'</span></span>).decode()) print(<span class="hljs-string"><span class="hljs-string">'\n'</span></span>) print(<span class="hljs-string"><span class="hljs-string">'#'</span></span>*<span class="hljs-number"><span class="hljs-number">65</span></span>) print(<span class="hljs-string"><span class="hljs-string">'\n'</span></span>) print(public_key.exportKey(format=<span class="hljs-string"><span class="hljs-string">'PEM'</span></span>).decode())</code> </pre> <br> <code>-----BEGIN RSA PRIVATE KEY----- <br> MIIEpAIBAAKCAQEA4JDLu7Vtvg2yqbH6Y0eJPfoEsOlKzgmOodqhA1CqkEG4OpKi <br> sGW7ciGP4v37GE6edHBCEy4UNkVQtnpPBjzTHvKd1pO70B84vD5OSrS7uNw2EYkj <br> d/ZwhrJMrcQKRwPkkM4OiewaaAaK0vPWJIKwlW61DY9X7LfNz7aOKMTbKnm1vdR0 <br> 919AV98FUmNoQBgka6nXFGmNbi7D43MtLwxBZIXfFupEiANSvOs+57hgaCho7OWM <br> GUOjLkG6HBscPhJ2W1H5DU9GjwL24ynTvKifgo1/2ue61MV1Pzh5CVaicJKNaRtg <br> Pd99gFhBGINsXV2X6Jh/W5nNsCddU4EI0AlO8wIDAQABAoIBAARM4YnjrIlSK9Sy <br> EtBp40frjMFyhjsx1ahlzmWI2utORt/gRPtJx3AlEmNPZ8qMXt5t8+X4IOz1INmN <br> uAuviH90N++O/q66mlSIgOlPUrT0ipiFXseCUZ9StMMzGNtJSMw5FfAwNEU/stLd <br> VoF2ezkxWIg88XsX/fn3Tfub4XKLvu4raJGcJ+Fo2GI9hYEGKnHhSuHvDHekTLlQ <br> z46O+cIwtehbFGcKesyK3zDD1uP5YLPIWpiqt1TgKjJzRF0l4ZJLk+RT7kU2pGIQ <br> mosOnr+06WyMIg724yQyAIwtS9X0czKBGUESrtTTb1HCXLeTwnncOTxh6q2z42LF <br> tn34+DECgYEA6EEp4oTvjfTQfUQPMByuAjF1hpdFHQqRymygiFgoF+Mg3QmL0w8j <br> /84H/q7s8FSx+3th8MK87bFq4lrry+h/mYwmvF5zZbhxcnl2uaX+KUPgpT6TgvAo <br> WOv2wc4BSaoo9DrxrZId86vpO2qbopw6gkBsvw47HSoQ+FSqXtZ0p8kCgYEA94Zj <br> b1ulctUjybiszO93TAjkzx3lU3yL+B1eZiQXtJa3mgG+ka1R/uMfr0NlT+Jzo0My <br> wHV30YRJDxziCrDol9OgSSU0sXwEcUxUIBLBwXLCp1EmMsYG9PB/x4OTWve35a8F <br> O+rMxuvWaZeIOfVCfL8UEcWweYaVdWIonJN+ltsCgYEAjeSZ2UlMLZce9RjqioNL <br> EA31dlfeoqJ9dYUuAn6RaB6cSk51vWlnnfXazo9CNIYaAsFbkcL3t+QHn+jaXEZc <br> BowocjbmG4Q20zBAB6XRBJbynSIA7yMYE1N9+uOHx+CMisGkO12krOUfZex4zzzR <br> RhhkF8ly9htoKL9ZIv20YXkCgYBzH3UF6PkVZJ5lhtgP5Nx2Z7iLwBrV7ppnBrnO <br> BcFkw6iXH3KT7KmzQ82LxWvMcMVZzLpBGyFkOAOG3OchE9DKNKpa+sv8NHMYguip <br> li+5mneAPFTozoOTznuPvtl9OLO2RuXHTVh6uFub9tdsJW8L+A8MiQagLwE6fDHp <br> SQxaewKBgQDIyzL1THpW3+AMNrOZuI/d3Em5wpGJiZbDSBRosvsfGm/sHaz4Ik5E <br> nWnftgktmsAD60eORTTh9/ww/nm7f3q9kzT8Sv1MmqeRXq9VFIOeP/+8SSE/7LzD <br> izlb5xEtVD8LuY54jHyiOxiZC++TQswMnOKKi0Gx26MDoO7Tx9akVw== <br> -----END RSA PRIVATE KEY----- <br> <br> ################################################################# <br> <br> -----BEGIN PUBLIC KEY----- <br> MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA4JDLu7Vtvg2yqbH6Y0eJ <br> PfoEsOlKzgmOodqhA1CqkEG4OpKisGW7ciGP4v37GE6edHBCEy4UNkVQtnpPBjzT <br> HvKd1pO70B84vD5OSrS7uNw2EYkjd/ZwhrJMrcQKRwPkkM4OiewaaAaK0vPWJIKw <br> lW61DY9X7LfNz7aOKMTbKnm1vdR0919AV98FUmNoQBgka6nXFGmNbi7D43MtLwxB <br> ZIXfFupEiANSvOs+57hgaCho7OWMGUOjLkG6HBscPhJ2W1H5DU9GjwL24ynTvKif <br> go1/2ue61MV1Pzh5CVaicJKNaRtgPd99gFhBGINsXV2X6Jh/W5nNsCddU4EI0AlO <br> 8wIDAQAB <br> -----END PUBLIC KEY----- <br></code> <br>  As you can see, asymmetric encryption keys are long mathematically generated sequences of characters. <br></div></div><br>  So we generated the keys.  Now let's write a function to encode the data: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> Crypto.PublicKey <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> RSA <span class="hljs-comment"><span class="hljs-comment">#        RSA. from Crypto.Hash import SHA256 #        SHA256.    #       from Crypto.Cipher import PKCS1_OAEP #   def encrypt_message(message, public_key, verbose = True): """Encripts the message using public_key. :param message: &lt;str&gt; Message for encryption :param public_key: &lt;object&gt; public_key :param verbose: &lt;bool&gt; Print description; :return: &lt;object&gt; Message encrypted with public_key """ message_hash = SHA256.new(message.encode()) #   . cipher = PKCS1_OAEP.new(public_key) message_with_hash = message.encode() + message_hash.hexdigest().encode() #      ,          encrypted_message = cipher.encrypt(message_with_hash) if verbose: print(f'Message: {message} was encrypted to\n{encrypted_message.hex()}') return encrypted_message def decrypt_message(encrypted_message, private_key): """Decripts the message using private_key and check it's hash :param encrypted_message: &lt;object&gt; Encrypted message :param private_key: &lt;object&gt; private_key :return: &lt;object&gt; Message decripted with private_key """ dsize = SHA256.digest_size*2 cipher = PKCS1_OAEP.new(private_key) decrypted_message_with_hesh = cipher.decrypt(encrypted_message) #   (  ) decrypted_message = decrypted_message_with_hesh[:-dsize] #      digest = SHA256.new(decrypted_message).hexdigest() #     if digest==decrypted_message_with_hesh[-dsize:].decode(): #      ,      ,   print(f"Success!\nEncrypted hash is {decrypted_message_with_hesh[-dsize:].decode()}\nDecrypted hash is {digest}") return decrypted_message.decode() else: print(f"Encryption was not correct: the hash of decripted message doesn't match with encrypted hash\nEncrypted hash is {decrypted_message_with_hesh[-dsize:]}\nDecrypted hash is {digest}")</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Steps to work</b> <div class="spoiler_text"><ol><li>  The agent generates a pair of keys: <br><pre> <code class="python hljs">private_key, public_key = generate_keys()</code> </pre> <br></li><li>  Sends an OPEN key to headquarters; </li><li>  In the headquarters using a public key encode the key for symmetric encryption: <br><pre> <code class="python hljs">new_symmetric_key = <span class="hljs-string"><span class="hljs-string">'SOME_KEY_asdfasdfasdfasdfsdfgrtwhetynt'</span></span> encr_msg = encrypt_message(new_symmetric_key, public_key)</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Conclusion</b> <div class="spoiler_text"> <code>Message: SOME_KEY_asdfasdfasdfasdfsdfgrtwhetynt was encrypted to <br> 41e940507c96397e3feb4a53390c982633bb1775a52957996a8069bd22063086a0e831bf775a17909276aba0d0478ee6c953837c8ea5d20d40e1c8eb463aaa1bc5c93c71677b1a85e90439c9dbda8a98ce168acb38368155437c66815b84aa2fbdda0eb909e4e6079b4410c720eddd955ed048193bf87f8f9976a17ee32a58a71dfddf3db116343d949d29c25f72c511a440a50a5d4f1e01c37b24a1cb4127e191d3231328b2f120c7dbd0cb5bf19823f0978b8ed17d25952de4b146ef9724fff359eb2af503fdfd72b91525a5503b076ba9aaaeac55af3f8d210c12d579d45dd70362123c0b4b36ef9c2f7705e6f884a25553eb0e11e5077f11fa986d0ff280</code> <br> </div></div><br></li><li>  This long sequence is sent back to the agent; </li><li>  The agent decrypts the received message using the private key: <br><pre> <code class="python hljs">recieved_symmetric_key = decrypt_message(encr_msg, private_key) print(<span class="hljs-string"><span class="hljs-string">'\n'</span></span>) print(<span class="hljs-string"><span class="hljs-string">f"New symmetric key is: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{recieved_symmetric_key}</span></span></span><span class="hljs-string">"</span></span>)</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Conclusion</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">Success! Encrypted hash is 42ad66445a05ac09e684bb21f9b487d95b9cfa11d02e0b459931321ee02f7c1c Decrypted hash is 42ad66445a05ac09e684bb21f9b487d95b9cfa11d02e0b459931321ee02f7c1c New symmetric key is: SOME_KEY_asdfasdfasdfasdfsdfgrtwhetynt</code> </pre> <br></div></div><br></li><li>  Then, using a new symmetric key, the agent encrypts the received data: <br><br><pre> <code class="python hljs">message = <span class="hljs-string"><span class="hljs-string">"""  120   120  / 120   10     30-5 (2)    4.0 """</span></span> encr_message = symmetric_encrypt(message, recieved_symmetric_key, verbose = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Conclusion</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">Message was encrypted into:</code> </pre><br></div></div><br></li><li>  The headquarters produce decryption: <br><pre> <code class="python hljs">print(<span class="hljs-string"><span class="hljs-string">'DECRIPTION'</span></span>) decr_message = symmetric_decrypt(encr_message, new_symmetric_key) print(decr_message)</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Conclusion</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">DECRIPTION Success! Encrypted hash is b0dbb35b28fbff258350a50c39282b73e31f408c9da937c81d8d48115b491026 Decrypted hash is b0dbb35b28fbff258350a50c39282b73e31f408c9da937c81d8d48115b491026  120   120  / 120   10     30-5 (2)    4.0</code> </pre><br></div></div><br></li></ol><br></div></div><br>  <b>Voila!</b> <br><br>  In this abstract example, we saw the work of common encryption algorithms.  Symmetric and asymmetric encryption, as well as hashing, are used <a href="https://www.digicert.com/ssl-cryptography.htm">in the work of the web</a> , <a href="https://learnmeabitcoin.com/guide/digital_signatures">electronic signature</a> , <a href="https://medium.com/icovo/digital-signatures-in-a-blockchain-digital-signatures-44b981b75413">blockchain and cryptocurrencies</a> .  I hope the material was useful for understanding the work of these technologies. <br><br><h3>  Afterword </h3><br>  As a result, the rebel intelligence was able to obtain accurate information about the station‚Äôs vulnerability and the path to it, the presence of the Emperor for inspection, the presence of the power grid and its source on Endor.  The empire figured out spies, misinformed them about the station‚Äôs combat capability.  The station was also assigned to the satellite of Endor, from where it was protected by a shield. <br><br><div class="spoiler">  <b class="spoiler_title">But we know how it all ended;)</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/452042/">https://habr.com/ru/post/452042/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../452030/index.html">Computer history: discovering interactivity</a></li>
<li><a href="../452034/index.html">Self-control of time for self-education and time for reading books</a></li>
<li><a href="../452036/index.html">Software Defined Radio - how does it work? Part 2</a></li>
<li><a href="../452038/index.html">Dangerous trade</a></li>
<li><a href="../452040/index.html">Tunguska meteorite and his younger brothers</a></li>
<li><a href="../452046/index.html">Remote control with low quiescent current on the ATmega328P</a></li>
<li><a href="../45205/index.html">Secret IP addresses of German intelligence</a></li>
<li><a href="../452052/index.html">How we halved the cost of an introductory lesson by looking at a solution with airlines</a></li>
<li><a href="../452054/index.html">Why WhatsApp will never be safe</a></li>
<li><a href="../452056/index.html">Golang DevDay: May 31, Novosibirsk + broadcast</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>