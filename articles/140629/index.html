<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>IPv6 - he is near. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today there is a lot of discussion about the timing of the introduction of IPv6 anywhere and everywhere. But one thing is clear: without the movements...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>IPv6 - he is near. Part 1</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/e4b/66a/e89/e4b66ae899a966ae9953f8b18e81e098.jpg"><br><br>  Today there is a lot of discussion about the timing of the introduction of IPv6 anywhere and everywhere.  But one thing is clear: without the movements of large companies, nothing will come of it.  Google already uses IPv6, there are networks that provide IPv6, including non-commercial ones. <br>  In this post I would like to tell not only how to join the world of IPv6, but also some of the subtleties associated with it, which I had to stumble over. <br>  In this case, a non-trivial configuration scenario is considered that uses a home server and you completely control the address space allocated to you. <br><a name="habracut"></a><br>  About the need for the IPv6 protocol, about the lack of IPv4 addresses was written hundreds of times.  I will not be a hundred first, read it yourself. <br><br><h4>  Give me new internet! </h4>  And who will give them?  - you ask?  But not everything is so bad, as there are companies that provide access to IPv6 for free, through a tunnel over an IPv4 connection.  That is, you get ‚Äúwrapped‚Äù IPv6 traffic over your existing IPv4 connection. <br>  Here is a partial list of such good companies: <br><ul><li>  <a href="http://he.net/">Hurricane Electric</a> (it has a lot of services, we are primarily <a href="http://tunnelbroker.net/">tunnelbroker.net</a> ) </li><li>  <a href="http://gogonet.gogo6.com/">Freenet6</a> (convenient for those who want one-click, is also useful for users behind NAT) </li><li>  <a href="http://www.sixxs.net/">SixXS</a> (also a popular network, but I don‚Äôt know anything about it) </li></ul>  Do not consider it a PR, but in the future Hurricane Electric will be considered, since I worked with it and it provides a lot of other useful things besides tunnels. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Before you start </h5>  Let you have: <br>  1) IPv4 Internet access and static white IP address <br>  2) Home server with Linux installed (shown in Debian example) <br>  3) Client machines (Windows, Linux, Mac - not important) <br>  Later this list will be expanded, but sufficient for the minimum configuration. <br><br>  <b>Register</b> on <a href="http://tunnelbroker.net/">TunnelBroker.net</a> nothing abstruse is not here, but do not rush immediately to create a tunnel, you will have time. <br><br>  <b>Select a server</b> for this to help <a href="http://lg.he.net/">Looking Glass</a> , it will ping your server from servers providing tunnels.  The shorter the ping, the better, you can still look at the traceroute and choose the option with a smaller number of routers along the way. <br><br><h5>  Let's start </h5>  Now it's time to set up a tunnel and get access to IPv6 on your home server. <br><br>  <b>Register the tunnel</b> .  To do this, select <a href="http://tunnelbroker.net/new_tunnel.php">Create Regular Tunnel</a> in your TunnelBroker account, enter the IPv4 address of your server, and specify the server that you selected. <br>  Your end will be immediately tested to receive packets with protocol number 41, the availability of which is necessary for the operation of the tunnel. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b81/91d/de1/b8191dde1d11eebb99633249cae614ec.png"><br><br>  <b>Please note</b> that for a quick start, there are ready examples of settings for different operating systems (1 in the screenshot), your client's IPv6 address differs (2 from 3) by a prefix from the Routed / 64 subnet by one digit, it is often not noticed.  And you can also fill in rDNS (4) right away as in the screenshot, while you will be updated you will have time to configure everything else. <br><br>  <b>Check the operation of the tunnel</b> .  To do this, copy the configuration for Linux-route2 and execute it in the terminal as a root.  Try <b>ping6 ipv6.google.com</b> if it works, congratulations, the tunnel works.  It is possible for accuracy to ping your Client IPv6 address from Looking Glass (which was used when choosing a server). <br><br>  <b>Make it static</b> .  In the world of IPv6, the need for dynamic addresses has disappeared forever, so the values ‚Äã‚Äãthat you have seen never change (unless of course you have a static IPv4 address, and even if it changes, then only the Client IPv4 address will change). <br>  Open a <b>/ etc / network / interfaces</b> file in a text editor (for example, <b>nano</b> ) (it may be different, depends on the distribution, but this is true on Debian, Ubuntu and many others) <br><br>  Add a new interface description to the end of the file like this: <br><br><pre><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">auto</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">he-ipv6</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">iface</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">he-ipv6</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet6</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">v4tunnel</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">address</span></span> 2001<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:470</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:abcd</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:abcd</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">::2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">netmask</span></span> 64 <span class="hljs-selector-tag"><span class="hljs-selector-tag">gateway</span></span> 2001<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:470</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:abcd</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:abcd</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">::1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">endpoint</span></span> 216<span class="hljs-selector-class"><span class="hljs-selector-class">.11</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.22</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.33</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">local</span></span> 11<span class="hljs-selector-class"><span class="hljs-selector-class">.22</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.33</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.44</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ttl</span></span> 255</code> </pre> <br>  Field Assignment: <br>  1) <b>address</b> - your Client IPv6 address <br>  2) <b>gateway</b> - your Server IPv6 address <br>  3) <b>endpoint</b> - your Server IPv4 address <br>  4) <b>local</b> - your Client IPv6 address <br><br>  Now when you restart your tunnel will automatically rise. <br><br><h5>  MTU-related butthurt prevention </h5>  But do not rush to restart the server, since the tunnel you are running (when you checked it).  Now you need to check such a thing as <b>MTU</b> .  MTU is the maximum packet size transmitted over the link layer of the OSI model.  In the case of our tunnel, this size coincides with the maximum IPv6 packet size on top of the tunnel.  Due to the fact that IPv6 packets are encapsulated in IPv4 packets, headers of IPv4 packets are added to it, hence the tunnel MTU (maximum 1480) is at least 20 less than the interface MTU that you access to the Internet via IPv4 (usually 1500, but maybe less).  If you work <br><pre> <code class="bash hljs">ping6 ipv6.google.com</code> </pre>  But crashes with an error <br><pre> <code class="bash hljs">wget -6 -O /dev/null http://he.net</code> </pre>  Then 99% is the problem with MTU. <br><br>  <b>Calculate MTU</b> .  Since IPv4 packets can be fragmented, that is, if it is too large to transmit over any channel, it can be cut into pieces.  However, headers are added to each such piece, and the effectiveness is greatly reduced.  And if the package does not fit into the interface on the server, then it will not work at all.  To calculate the MTU with regard to intermediate nodes, we will ping our tunnel server with packages that cannot be fragmented. <br>  This is done like this (where at the end should be your Server IPv4 address): <br><pre> <code class="bash hljs">ping -M <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> -s 1472 216.66.84.46</code> </pre>  If pinged normally, then nothing needs to be changed, packets up to 1,500 bytes (1,472 + <b>28</b> bytes) inclusively pass normally.  If the answer is: <br><pre> <code class="bash hljs">From 11.22.33.44 icmp_seq=1 Frag needed and DF <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> (mtu = 1488)</code> </pre>  Then try to reduce the size of the package to achieve success.  Then increase it until it responds. <br><br>  <b>Fix MTU</b> .  Let you have a maximum at <b>ping -M do -s 1464 ...</b> Then we take <b>1472</b> - 1464 = 8 then <b>1480</b> - 8 = 1472 And so we got that in this case your tunnel MTU should be equal to 1472. Now let's go back to the Tunnel Details, Advanced tab and choose the MTU is not greater than yours, but the closest to yours.  We restart the tunnel (or we lower, we lift the interface, or we reboot the system).  Check again: <br><pre> <code class="bash hljs">wget -6 -O /dev/null http://he.net</code> </pre>  If the moon phase did not change, then you no longer have problems with the MTU of the tunnel. <br><br><h5>  Internet distribution </h5>  Yes, the server already has a working IPv6, but we want to provide it to all the computers in the house.  The server is considered to be in the same local home (office) network as the clients and in the same broadcast domain of Ethernet. <br><br>  <b>Allow IPv6 forwarding</b> .  In the case of Debian, the <b>sysctl</b> service is responsible for this, with a lot of settings, mostly kernel-level network parameters. <br>  Editing the <b>/etc/sysctl.conf</b> file <br><pre> <code class="bash hljs">net.ipv6.conf.all.forwarding=1 net.ipv6.conf.default.forwarding=1</code> </pre>  Apply changes (in console): <br><pre> <code class="bash hljs">sysctl -p</code> </pre>  After that, your server will no longer be able to assign itself an IPv6 address automatically, but we don‚Äôt need it. <br><br>  <b>Install the subnet announce daemon</b> .  For these purposes (stateless autoconfiguration differs from DHCPv6 in that the addresses are assigned by the machines themselves according to the MAC address, which is good in combating ARP spoofing) the <b>radvd</b> daemon (with DVD discs has nothing in common) is intended. <br>  Install it: <br><pre> <code class="bash hljs">apt-get install radvd</code> </pre>  And immediately stop: <br><pre> <code class="bash hljs">/etc/init.d/radvd stop</code> </pre> <br><br>  <b>Configure radvd</b> .  It's simple.  First find your Routed / 64 prefix in Tunnel Details. <br>  Editing the <b>/etc/radvd.conf</b> file <br><pre> <code class="bash hljs">interface eth0 { AdvSendAdvert on; AdvLinkMTU 1480; prefix 2001:470:abcd:abcd::/64 { AdvOnLink on; AdvAutonomous on; }; };</code> </pre>  Where <b>interface</b> is the network interface that looks to your local network, <b>prefix</b> is your Routed / 64, and <b>AdvLinkMTU</b> is your tunnel's MTU. <br>  Automatic DNS configuration is not considered, as additional actions are required on all client computers under Linux, and Windows does not support getting DNS through Router Advertisement at all, only through DHCPv6 (which is very inconvenient).  Therefore, it is easier to register on all Hurricane Electric server DNS client machines (your Anycasted IPv6 / IPv4 Caching Nameserver).  In Windows, this is done in the network connection settings; in Linux, the file <b>/etc/resolv.conf is being</b> edited <br><br>  <b>Configure the network interface</b> .  If you start <b>radvd</b> right now (no need yet), then clients will get their cherished addresses, but nothing will work.  The fact is that the packets from clients to the Internet will go away, but they will not come back, since, once on your server, they will not find you on the network due to the lack of a route to the clients of your subnet (Routed / 64).  You can, of course, register only the route, but it is better to add the first address from this subnet to the interface on the server, this is the custom to do, by that the routing will work a little faster. <br>  We find in the <b>/ etc / network / interfaces</b> file the <b>interface</b> settings (looking into the local network), in my case eth0, which look like this: <br><pre> <code class="bash hljs">allow-hotplug eth0 iface eth0 inet static address 192.168.6.6 netmask 255.255.255.0 broadcast 192.168.6.255</code> </pre>  And at the end of the section we add IPv6 settings, as a result it turns out (all together): <br><pre> <code class="bash hljs">allow-hotplug eth0 iface eth0 inet static address 192.168.6.6 netmask 255.255.255.0 broadcast 192.168.6.255 iface eth0 inet6 static address 2001:470:abcd:abcd::1 netmask 64</code> </pre>  Where the part of the address before the double colon (hi C ++) corresponds to your routed / 64.  Be careful when editing this file.  So once I accidentally broke the network settings and could not log into the server via SSH, I had to look for a monitor. <br>  For momentary address assignment perform: <br><pre> <code class="bash hljs">ip -6 addr add 2001:470:abcd:abcd::1/64 dev eth0</code> </pre>  Note that the address in this command specifies the length of the prefix ( <b>/ 64</b> ) at the end, this is important.  Well, the name of the interface to change in which case you need not forget. <br><br>  <b>We check the work</b> .  It's time to check your newly configured IPv6 network. <br>  <b>Starting radvd</b> <br><pre> <code class="bash hljs">/etc/init.d/radvd start</code> </pre>  Immediately, all the machines on the network received IPv6 addresses in your Routed / 64 subnet based on their MAC address (in any case, the Windows machines did not require reconnection). <br>  On client machines (we did not forget to register DNS), we open <a href="http://test-ipv6.com/">test-ipv6.com</a> <br><img src="https://habrastorage.org/getpro/habr/post_images/140/8b7/f0f/1408b7f0f323d45baef158a914edb236.png"><br>  If you have everything green too, congratulations!  You have connected your network to the world of IPv6. <br>  Google, YouTube should also work over IPv6. <br><br><h5>  PROFIT !!! </h5>  <b>A small bonus</b> .  My subnet, for example, is located in Amsterdam, everything is fine with pings.  But the higher subnet Hurricane Electric (2001: 470 :: / 32) is registered in the United States and all its subnets are recognized as the United States regardless of geography.  Therefore, you can google all the services that are available only in the United States, without using an American proxy and without sacrificing ping length.  Therefore, instead of abstract benefits, we have very specific advantages: <br><ol><li>  Global availability of all clients - goodbye NAT </li><li>  Everyone thinks you are American </li><li>  Torrents work faster, mainly due to peers with Teredo enabled </li><li>  By setting up IPv6 today, you will be ready for its onset tomorrow, and you may be able to make money setting it up during the rush. </li><li>  Dedicated subnet - a vast space for distortions, and free.  You can access rDNS, DNS nameserver from the same Hurricane Electric, with support for dynamic DNS and a very nice interface. </li></ol>  <b>In the following series</b> .  This is the first part of a series of articles on IPv6, but I can immediately say what will happen in the following parts: <br><ul><li>  <b>Part 2</b> .  Setup firewall.  Fighting NAT.  Configure multiple server configurations, merge offices.  Configure OpenVPN + IPv6, create subnets, Routed / 48, Dualstack. </li><li>  <b>Part 3</b>  Work with DNS, rDNS.  Placing your services in IPv6, Native IPv6.  What is good and bad Native IPv6 provided by hosters.  Own Native IPv6, how to register a network for your company, what to connect to. </li><li>  <b>Part 4</b>  Online certification for skills in the field of IPv6 from Hurricane Electric.  The theory required for certification (step by step instructions for cheaters do not wait, although there are already on the Internet).  The future of IPv6. </li></ul>  I do not promise a quick release of the subsequent parts, but part 2 is expected in 2-3 weeks.  Unfortunately, in the following parts, the level of availability of presentation will not be successful, as the level of skills of the target audience will also be higher. <br><br>  Be prepared for IPv6, its arrival is inevitable. </div><p>Source: <a href="https://habr.com/ru/post/140629/">https://habr.com/ru/post/140629/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../140616/index.html">Access to static data</a></li>
<li><a href="../140617/index.html">Without wires. Release 3</a></li>
<li><a href="../140623/index.html">We trade Bitcoin title characters</a></li>
<li><a href="../140624/index.html">Create a simple widget for Mac OS X Dashboard</a></li>
<li><a href="../140627/index.html">Creating a window interface using jQuery UI. Part 2</a></li>
<li><a href="../140630/index.html">Super smooth transformations for jQuery</a></li>
<li><a href="../140631/index.html">FCGI :: ProcManager module development</a></li>
<li><a href="../140633/index.html">Rails-based REST providers: a nightmare with views</a></li>
<li><a href="../140634/index.html">Sony patents new fingerprint sensor for smartphone display</a></li>
<li><a href="../140635/index.html">Android: reader with synchronization between devices</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>