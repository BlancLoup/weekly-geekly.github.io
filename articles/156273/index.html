<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Modification in the database tabular or multiple fields of documents</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Often, projects require updating the multiple fields of any documents in the database. Probably there are ready-made solutions, but by typing in Googl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Modification in the database tabular or multiple fields of documents</h1><div class="post__text post__text-html js-mediator-article">  Often, projects require updating the multiple fields of any documents in the database.  Probably there are ready-made solutions, but by typing in Google "changing the multiple properties of documents", "processing multiple fields", "processing table fields", etc., I did not find any solution, so I decided to write my own and at the same time describe it in this article . <br><br><a name="habracut"></a><br>  All examples will be in PHP, and the mysql database used.  Although, the above code is not tied to any database, it only determines which lines should be deleted, which lines should be added, and which lines should be modified.  Further, these "instructions" can be easily implemented for any database. <br><br>  For example, we have a simple document with single properties such as "identifier", "name", "creation date", and there is also a multiple field for this document - an access control table in the form: user code, time and date the access permission began, and time and date from which access is prohibited. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The data structure of a particular document in PHP can be represented like this: <br><pre><code class="php hljs">$document[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] = <span class="hljs-string"><span class="hljs-string">"1"</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   $document["name"] = " "; //   $document["create_date"] = "25-10-2012"; //    $document["permissions_table"] = array( array( "user_id" =&gt; 1, //   "grant_from" =&gt; "2012-10-25 00:00:00", //        "grant_to" =&gt; "2012-10-27 23:59:59" //        ) );</span></span></code> </pre> <br><br>  We assume that in the database such a document will be stored in two tables: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/* - document_header (   ,   -  ) id INT NOT NULL AUTOINCREMENT name TEXT NOT NULL create_date DATETIME NOT NULL - document_permissions (   ,   -  ) id INT NOT NULL AUTOINCREMENT document_id INT NOT NULL user_id INT NOT NULL grant_from DATETIME grant_to DATETIME */</span></span></code> </pre><br><br>  Further we will present that there is a task of change of the access table of our document.  At the same time, after the user submits, we receive two arrays of our document for processing: an array with old data and an array with new data. <br><br>  Now we will consider how to convert these arrays into a sequence of SQL queries to modify the document in the database. <br><br>  With flat data, everything is quite simple, they can be processed with the following code <br><pre> <code class="php hljs">$changes = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($old_document <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $k =&gt; $v) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($k == <span class="hljs-string"><span class="hljs-string">"permissions_table"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($old_document[$k] != $new_document[$k]) $changes[$k] = $new_document[$k]; } $changes[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] = $old_document[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] $changes[<span class="hljs-string"><span class="hljs-string">"document_id"</span></span>] = $old_document[<span class="hljs-string"><span class="hljs-string">"document_id"</span></span>]</code> </pre><br><br>  As a result, we get an array of <b>$ changes</b> with modified fields and their new values, which is easy to convert to an UPDATE database query.  I do not want to overload the article with this operation, so we will omit it. <br><br>  Next, we need to process the changes in the table of access to the document and make the necessary changes in the database. <br>  Different situations can happen here, for example: <br>  - old line has been changed <br>  - a new line has been added <br>  - old line has been deleted <br>  - the row order has changed <br><br>  And any combination of the above operations. <br><br>  At the same time, we need to generate the corresponding queries in the database and execute them in the following sequence: <br>  1. Delete extra lines <br>  2. Modify existing rows <br>  3. Adding new lines <br>  Deletion is performed primarily to ensure that there is no conflict of unique keys in the database during add or modify operations. <br><br>  As a result, we need a function that receives arrays of old and new values ‚Äã‚Äãas input, and at the output gives us three arrays with table lines that need to be deleted, modified and added to our database. <br><br>  For this task, I wrote a universal function that works with any configuration of tabular data.  Only with some restrictions that are listed at the end of the article. <br><br>  So, the magic function has the following interface: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/* @$data -      @$old_data -      @$keys -       (, .      ) @$hidden_keys -     ,     (.      ) @$options -   */</span></span></code> </pre><br>  At the output, we get the treasured arrays of delete, update, insert, which are easy to convert to database queries for later execution. <br><br>  Function source code: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateOperationsFromMultiData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($data, $old_data, $keys, $hidden_keys, $options)</span></span></span><span class="hljs-function"> </span></span>{ $out = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">"insert"</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(), <span class="hljs-string"><span class="hljs-string">"update"</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(), <span class="hljs-string"><span class="hljs-string">"delete"</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>()); $unique_elements = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $unique_keys = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-comment"><span class="hljs-comment">//           $old_elements_hashes = array(); $old_elements_keys = array(); foreach($old_data as $k =&gt; $fields) { $res = self::__getKeyAndHashFromLine($fields, $keys, $hidden_keys); $old_data[$k]["___key"] = $res["key"]; $old_data[$k]["___hash"] = $res["hash"]; if($res["key"]) { $old_elements_hashes[$res["key"]] = $res["hash"]; $old_elements_keys[$res["key"]] = $k; } else { $old_elements_hashes[$k] = $res["hash"]; } } //     $data = array_merge($data); foreach($data as $k =&gt; $fields) { $res = self::__getKeyAndHashFromLine($fields, $keys); $data[$k]["___key"] = $res["key"]; $data[$k]["___hash"] = $res["hash"]; foreach($hidden_keys as $k2) unset($fields[$k2]); //        if($options["unique"]) { if(in_array($res["hash"], $unique_elements)) continue; else $unique_elements[] = $res["hash"]; } if($res["key"]) { //         if(in_array($res["key"], $unique_keys)) continue; else $unique_keys[] = $res["key"]; //          if(!isset($old_elements_hashes[$res["key"]])) $out["insert"][$k] = $fields; else { //      ,    if($res["hash"] != $old_elements_hashes[$res["key"]]) { //         foreach($hidden_keys as $v) { $fields[$v] = $old_data[$old_elements_keys[$res["key"]]][$v]; } //        $out["update"][$k] = $fields; } $old_data[$old_elements_keys[$res["key"]]]["___new_key"] = $k; unset($old_elements_hashes[$res["key"]]); unset($old_elements_keys[$res["key"]]); } } else { //            if($key = array_keys($old_elements_hashes, $res["hash"])) { $key = current($key); unset($old_elements_hashes[$key]); $old_data[$key]["___new_key"] = $k; } else { //    ,    $out["insert"][$k] = $fields; } } } //   old_data      if($keys) foreach($old_elements_keys as $k =&gt; $v) { unset($old_data[$v]["___key"]); unset($old_data[$v]["___hash"]); unset($old_data[$v]["___new_key"]); $out["delete"][] = $old_data[$v]; unset($old_data[$v]); } else foreach($old_elements_hashes as $k =&gt; $v) { unset($old_data[$k]["___key"]); unset($old_data[$k]["___hash"]); unset($old_data[$k]["___new_key"]); $out["delete"][] = $old_data[$k]; unset($old_data[$k]); } //      //    $old_data = array_merge($old_data); $data = array_merge($data); if($options["save_order"]) { $delete = false; //    (  ,           update ) if($old_data[0]["___new_key"] != "0") $delete = true; foreach($old_data as $k =&gt; $v) { //    ,        if($v["___new_key"] != $k) $delete = true; if($delete) { unset($old_data[$k]["___key"]); unset($old_data[$k]["___hash"]); unset($old_data[$k]["___new_key"]); unset($data[$v["___new_key"]]["___key"]); unset($data[$v["___new_key"]]["___hash"]); $out["delete"][] = $old_data[$k]; foreach($hidden_keys as $hk) { $data[$v["___new_key"]][$hk] = $old_data[$k][$hk]; } $out["insert"][$v["___new_key"]] = $data[$v["___new_key"]]; if($keys) unset($out["update"][$v["___new_key"]]); } } } $out["update"] = array_merge($out["update"]); ksort($out["insert"]); $out["insert"] = array_merge($out["insert"]); return $out; } //     function __getKeyAndHashFromLine($line, $keys, $hide_keys = array()) { $hash = $line; //   foreach($keys as $v) unset($hash[$v]); foreach($hide_keys as $v) unset($hash[$v]); //    $hash = serialize($hash); //   $key = ""; foreach($keys as $v) $key .= "__" . $line[$v]; return array("hash" =&gt; $hash, "key" =&gt; $key); }</span></span></code> </pre><br><br>  In our case, the function call will look like this: <br><pre> <code class="php hljs">$result = generateOperationsFromMultiData($new_document[<span class="hljs-string"><span class="hljs-string">"permissions_table"</span></span>], $old_document[<span class="hljs-string"><span class="hljs-string">"permissions_table"</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">"id"</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">"unique"</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>));</code> </pre><br>  As a result, <b>$ result</b> will contain three arrays: <b>delete</b> , <b>update</b> , <b>insert</b> . <br><br>  I will give a couple of examples for clarity. <br>  In the first example, we have two lines for two users.  Emulating changes, we enter the third user and we delete the second.  In this case, we specifically duplicate the line with the first user and make changes in the dates of both lines for it. <br><pre> <code class="php hljs">$old_document[<span class="hljs-string"><span class="hljs-string">"permissions_table"</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">"id"</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"document_id"</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"user_id"</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"grant_from"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"2012-10-25 00:00:00"</span></span>, <span class="hljs-string"><span class="hljs-string">"grant_to"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"2012-10-27 00:00:00"</span></span> ), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">"id"</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"document_id"</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"user_id"</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"grant_from"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"2012-10-25 00:00:00"</span></span>, <span class="hljs-string"><span class="hljs-string">"grant_to"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"2012-10-27 00:00:00"</span></span> ) ); $new_document[<span class="hljs-string"><span class="hljs-string">"permissions_table"</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">"document_id"</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"user_id"</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">"grant_from"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"2012-10-25 00:00:00"</span></span>, <span class="hljs-string"><span class="hljs-string">"grant_to"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"2012-10-27 00:00:00"</span></span> ), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">"document_id"</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"user_id"</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"grant_from"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"2012-10-25 00:00:00"</span></span>, <span class="hljs-string"><span class="hljs-string">"grant_to"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"2012-10-03 00:00:00"</span></span> ), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">"document_id"</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"user_id"</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"grant_from"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"2012-10-25 00:00:00"</span></span>, <span class="hljs-string"><span class="hljs-string">"grant_to"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"2012-10-31 00:00:00"</span></span> ) ); generateOperationsFromMultiData( $new_document[<span class="hljs-string"><span class="hljs-string">"permissions_table"</span></span>], $old_document[<span class="hljs-string"><span class="hljs-string">"permissions_table"</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">"user_id"</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">"id"</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">"unique"</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-string"><span class="hljs-string">"save_order"</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> ) )</code> </pre><br>  At the output we get: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [insert] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [<span class="hljs-number"><span class="hljs-number">0</span></span>] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [document_id] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [user_id] =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span> [grant_from] =&gt; <span class="hljs-number"><span class="hljs-number">2012</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-25</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> [grant_to] =&gt; <span class="hljs-number"><span class="hljs-number">2012</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-27</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> ) ) [update] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [<span class="hljs-number"><span class="hljs-number">0</span></span>] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [document_id] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [user_id] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [grant_from] =&gt; <span class="hljs-number"><span class="hljs-number">2012</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-25</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> [grant_to] =&gt; <span class="hljs-number"><span class="hljs-number">2012</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> [id] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ) ) [delete] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [<span class="hljs-number"><span class="hljs-number">0</span></span>] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [id] =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> [document_id] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [user_id] =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> [grant_from] =&gt; <span class="hljs-number"><span class="hljs-number">2012</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-25</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> [grant_to] =&gt; <span class="hljs-number"><span class="hljs-number">2012</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-27</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> ) ) )</code> </pre><br>  As a result, it turns out that we need to insert a line with the third user, delete the line with the second user and make changes in the first user.  At the same time note that the changes for the first user are taken from the first row for this user in the <b>$ new_document [permissions_table]</b> array.  By this, I wanted to show the correct processing of the ‚Äúdubbed data‚Äù. <br><br>  Now consider the parameters that control the behavior of the function. <br><br>  <b>$ keys</b> - an array of table data keys.  If specified, the function will automatically start throwing out lines with duplicate keys; in the above example, the key ‚Äúuser_id‚Äù is indicated, so we have forbidden repeating lines for the same user.  Keys can be composite, for this purpose it is enough just to specify them in the array of this parameter.  If the keys are not set, the function will still work, but you will have to enter some id into the database, by which it will be necessary to distinguish one line from another.  You will need to register it in the <b>$ hidden_keys</b> function. <br><br>  <b>$ hidden_keys</b> - hidden keys, these are keys that may be present in the array of old data and absent in the array of changed data.  In this case, the function automatically transfers these keys to the output arrays for deleting and modifying strings.  In particular, this is necessary for managing multiple data when a string consists of one or several non-key fields.  Then, in order to identify such lines, a unique id is entered in the database, but it is not necessary to ‚Äúforce‚Äù it into the form and monitor its ‚Äúintegrity‚Äù when editing.  The function itself will determine which lines with a specific id to delete, which ones to change, and which lines to add with new ones. <br><br>  <b>$ options [unique]</b> - if you set this flag to <b>true</b> , then besides the uniqueness of the keys, the function will begin to check the uniqueness of the remaining data of the string, that is, in our case, if the <b>$ options [unique]</b> flag is set, we could not specify the same periods for different users, and the function would leave the first available period and delete the subsequent repeated ones. <br><br>  <b>$ options [save_order]</b> is a flag that indicates the need to preserve the order of data in the database, the same as in the <b>$ data</b> array (in our example, <b>$ new_document [permissions_table]</b> ).  To understand how this flag works, consider the result of our example, but only with the <b>$ options [save_order]</b> flag set: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [insert] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [<span class="hljs-number"><span class="hljs-number">0</span></span>] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [document_id] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [user_id] =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span> [grant_from] =&gt; <span class="hljs-number"><span class="hljs-number">2012</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-25</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> [grant_to] =&gt; <span class="hljs-number"><span class="hljs-number">2012</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> ) [<span class="hljs-number"><span class="hljs-number">1</span></span>] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [document_id] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [user_id] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [grant_from] =&gt; <span class="hljs-number"><span class="hljs-number">2012</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-25</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> [grant_to] =&gt; <span class="hljs-number"><span class="hljs-number">2012</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> [id] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ) ) [update] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( ) [delete] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [<span class="hljs-number"><span class="hljs-number">0</span></span>] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [id] =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> [document_id] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [user_id] =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> [grant_from] =&gt; <span class="hljs-number"><span class="hljs-number">2012</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-25</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> [grant_to] =&gt; <span class="hljs-number"><span class="hljs-number">2012</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-27</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> ) [<span class="hljs-number"><span class="hljs-number">1</span></span>] =&gt; <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [id] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [document_id] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [user_id] =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> [grant_from] =&gt; <span class="hljs-number"><span class="hljs-number">2012</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-25</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> [grant_to] =&gt; <span class="hljs-number"><span class="hljs-number">2012</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-27</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> ) ) )</code> </pre><br>  We see that the function first suggests deleting all existing records in order to insert a new record with a third user and after it a record with the first user.  Thus, in the database we get the same sequence when sampling without sorting, as in our new array.  With this functionality, you can save on the extra field that we would need to sort the rows.  However, if a row is inserted in the middle or at the beginning of the table, you will first have to delete all the data following this row, and then add it again (we saw these actions in the last example) <br><br>  <b>Note: the</b> function always offers the minimum number of queries to the database to achieve the desired result. <br><br>  <b>Restrictions: the</b> data of lines should be only flat at the time of execution of the function.  Fields should not be called: "___key", "___hash", "___new_key". <br></div><p>Source: <a href="https://habr.com/ru/post/156273/">https://habr.com/ru/post/156273/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../156263/index.html">Developer Economics 2013 study: participation</a></li>
<li><a href="../156265/index.html">Halloween - hello admin</a></li>
<li><a href="../156267/index.html">The new Switchvox 450 & 470, API and something else ...</a></li>
<li><a href="../156269/index.html">The results of the contest "I and my ASUS: One Day in Our Life"</a></li>
<li><a href="../156271/index.html">Component MacBook Repair: Power Supply Repair</a></li>
<li><a href="../156275/index.html">Data on 1 million Facebook users cost $ 5.</a></li>
<li><a href="../156277/index.html">How easy it is to connect any OPC server sensor to the narodmon.ru project</a></li>
<li><a href="../156279/index.html">Fuelphp in the field</a></li>
<li><a href="../156281/index.html">The benefits of a scientific approach for startups</a></li>
<li><a href="../156283/index.html">AnnotatedSQL lib - automatic database generation in Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>