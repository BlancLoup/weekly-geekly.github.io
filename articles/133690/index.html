<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>QtWebKit-specific when developing mobile HTML5 applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This post participates in the competition " Smart phones for smart posts " 

 Introduction 
 It is no secret that with the advent of HTML5, the develo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>QtWebKit-specific when developing mobile HTML5 applications</h1><div class="post__text post__text-html js-mediator-article">  This post participates in the competition " <a href="http://habrahabr.ru/company/Nokia/blog/132522/">Smart phones for smart posts</a> " <br><br><h4>  Introduction </h4><br>  It is no secret that with the advent of HTML5, the development focus gradually began to shift towards the Web.  These include simple Web sites and dynamic applications, and even mobile applications written entirely using HTML5.  Independent from the platform and execution environment and requiring only unquestioning implementation of standards.  But nevertheless, no matter how good the whole stack of technologies introduced by the new HTML standards, there are still some tasks that require the use of native development tools. <br><br>  Such problems, for example, is to gain access to system information, control and change anything in the system.  Access from HTML5 to contacts, calendar, organizer on a mobile device and others.  Again, if our application performs some serious calculations, they can be transferred from slow JS to fast C ++.  In this article I want to consider several techniques of interaction between a Web application and native code on the example of the QtWebKit module that may be useful. <br><a name="habracut"></a><br><h4>  Table of contents </h4><br><ul><li>  Calling C ++ Methods from JavaScript </li><li>  Calling JavaScript code from C ++ methods </li><li>  Integration of QWidget into a web page </li></ul><br><h4>  Calling C ++ Methods from JavaScript </h4><br>  Theoretically, in this case, we need to add a new JS object to the HTML page, through which we could have access to one of our classes.  QtWebKit provides the ability to embed such objects in a Web page, but with one condition - adding a new object must be done every time we reload the page in our browser component.  That is, each time you clean up both the DOM tree and the JS object tree. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In practice, we need to create a new Qt Mobile Application, a Qt Simulator profile, the rest to our taste in Qt Creator.  After that, drop the QWebView component onto the form, add a line in the .pro file <br><br><pre><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">QT</span></span> += webkit</code> </pre> <br>  in the header of mainwindow.h declare one private and one public slots: <br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> slots: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addJSObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> slots: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">webViewQuitClicked</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>;</code> </pre><br>  And in the implementation file mainwindow.cpp include the QWebFrame header, change the constructor a bit and describe the implementations for the slots added to mainwindow.h: <br><pre> <code class="hljs rust">... #include &lt;QWebFrame&gt; #include &lt;QMessageBox&gt; MainWindow::MainWindow(QWidget *parent) : QMainWindow(parent), ui(new Ui::MainWindow) { ui-&gt;setupUi(this); connect(ui-&gt;webView-&gt;page()-&gt;mainFrame(), SIGNAL(javaScriptWindowObjectCleared()), this, SLOT(addJSObject())); } void MainWindow::addJSObject() { ui-&gt;webView-&gt;page()-&gt;mainFrame()-&gt;addToJavaScriptWindowObject(QString(<span class="hljs-string"><span class="hljs-string">"mainWindow"</span></span>), this); } void MainWindow::webViewQuitClicked () { qApp-&gt;quit(); } ...</code> </pre><br>  Now let's deal with this code: <br><ul><li>  Private slot addJSObject () - is responsible for adding to each new page a JS object pointing to the current form.  At the same time, it will be called every time the web page is reloaded.  The javaScriptWindowObjectCleared () signal is responsible for this.  As can be seen from the code, on the Web page our object will have the name ‚ÄúmainWindow‚Äù. </li><li>  The webViewQuitClicked () public slot is the slot that will be accessible to us from our JavaScript code located on the Web page.  Naturally, by analogy, you can add other methods, which are then called from JS. </li></ul><br>  We go further.  Now we need to try to call this code from our Web page.  To do this, create an HTML file of the following content: <br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/1999/xhtml"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Content-Type"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html; charset=utf-8"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Application Example<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="actionscript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="actionscript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="actionscript"><span class="hljs-function"><span class="hljs-title">quitApplication</span></span></span></span><span class="hljs-params"><span class="actionscript"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span><span class="actionscript"><span class="hljs-function"> </span></span></span><span class="actionscript">{ mainWindow.webViewQuitClicked (); } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'quitApplication();'</span></span></span><span class="hljs-tag">&gt;</span></span>Quit Application<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  And a bit the rule is the constructor of the application, namely, we add one line to it: <br><pre> <code class="hljs lisp">ui-&gt;webView-&gt;load(<span class="hljs-string"><span class="hljs-string">"file:///"</span></span>+QApplication:<span class="hljs-symbol"><span class="hljs-symbol">:applicationDirPath</span></span>() + <span class="hljs-string"><span class="hljs-string">"/../../html5caller/example.htm"</span></span>)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre><br>  Of course, you can download a page from somewhere on the Internet. <br>  Yeah, not bad.  And what to do if we want to transfer some parameter to the C ++ function?  Nothing is easier!  Simply we describe in C ++ code a new public slot with the desired parameters.  For example - display a message to the user: <br>  mainwindow.h: <br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> slots: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">webViewQuitClicked</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">webViewShowMessageClicked</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">QString message, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> number</span></span></span><span class="hljs-function">)</span></span>;</code> </pre><br>  mainwindow.cpp: <br><pre> <code class="hljs css">... <span class="hljs-selector-tag"><span class="hljs-selector-tag">void</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MainWindow</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">::webViewShowMessageClicked</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">QString</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">message</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">int</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">number</span></span>) { <span class="hljs-attribute"><span class="hljs-attribute">QMessageBox</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">information</span></span>(this, <span class="hljs-string"><span class="hljs-string">"From Web"</span></span>, message+QString::number(number)); } ...</code> </pre><br>  And change example.htm: <br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/1999/xhtml"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Content-Type"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html; charset=utf-8"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Application Example<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">quitApplication</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ mainWindow.webViewQuitClicked (); } </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">calculate</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">val1, val2</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ result = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">eval</span></span></span><span class="javascript">(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">parseFloat</span></span></span><span class="javascript">(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.calc.val1.value)+</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">parseFloat</span></span></span><span class="javascript">(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.calc.val2.value)) mainWindow.webViewShowMessageClicked (</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Result: "</span></span></span><span class="javascript">, result); } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'quitApplication();'</span></span></span><span class="hljs-tag">&gt;</span></span>Quit Application<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FORM</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"calc"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"val1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4"</span></span></span><span class="hljs-tag">&gt;</span></span>+ <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"val2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" + "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onclick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"calculate(val1, val2)"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FORM</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Now, we can not only close the application, but also pass some parameters to it, and with normal data type control.  And that's what happened: <br><img src="http://habrastorage.org/storage1/f201c4d3/2efdf834/2aaf502e/06c441c9.png"><br>  Well, the last.  what can be added on this topic.  Let's say.  we send some data to C ++, they are processed there and we want to get it back.  To do this, we simply describe the returned data type in our slot, for example: <br><pre> <code class="hljs cs">... <span class="hljs-function"><span class="hljs-function">QString </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readResult</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> val1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> val2</span></span></span><span class="hljs-function">)</span></span> { ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QString(); } ...</code> </pre><br>  And from the JS-code we call this method like the others, with the only difference that we set the variable where we want to add the return value: <br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lolo = mainWindow.readResult();</code> </pre><br>  That's it ... Go ahead ... <br><br><h4>  Calling JavaScript code from C ++ methods </h4><br>  We will not dwell on this for long.  To call the JS code, we must use the methods of the QWebFrame class.  Here is an example: we need to get the url of all the pictures on the page: <br><pre> <code class="hljs pgsql">QVariant listOfImages = webView.page()-&gt;mainFrame()-&gt;evaluateJavaScript("document.getElementsByTagName(\"img\").length;"); <span class="hljs-type"><span class="hljs-type">double</span></span> numberOfImages = listOfImages.toDouble(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">double</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; numberOfImages; ++i) { srcOfImages = webView.page()-&gt;mainFrame()-&gt;evaluateJavaScript(QString("document.getElementsByTagName(\"img\")[%1].src;").arg(i)); imageUrl = srcOfImages.toString(); }</code> </pre><br>  First we get the number of tags like img, and then we go through this list and pull out the necessary URLs.  As you can see from the example, we can easily refer to any objects on the page, and accordingly execute any methods on it. <br><br><h4>  Integration of QWidget into a web page </h4><br>  This is the second big topic I would like to talk about.  It will be a matter of not quite standard procedure ... We really will include in our web page some widget from our application. <br><br>  This can be done using the QWebPluginFactory class.  Let's get started  First of all, in Qt Creator, in the project tree on the left, right-click on our project.  From the contact menu, select the item ‚ÄúAdd new‚Äù -&gt; C ++ class.  The class name is MyWidgetFactory, the base class QWebPluginFactory, type QObject, next, complete.  In order for our plugin to become complete, we need to override two methods of the base class: <br><pre> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-function">QObject *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QString &amp;mimeType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QUrl &amp;url, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QStringList &amp;argumentNames, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QStringList &amp;argumentValues)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; QList&lt;QWebPluginFactory::Plugin&gt; plugins() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>;</code> </pre><br>  The first is creating widgets on demand from Web pages.  The second one describes the Mime types to which the plugin should respond and for which it is necessary to create new widgets.  In general, initially, I used a similar approach a couple of years ago, when I wrote an instant messenger for Vkontakte.ru.  Then I needed to embed a music player widget into the page in order to make it easier for users to share music.  You can see its full implementation here <a href="http://code.google.com/p/vimka/source/browse/">code.google.com/p/vimka/source/browse/#svn%2Ftrunk%2Fchats</a> in the vkmediafactory.h and vkmediafactory.cpp files <br><br>  We will do something simpler now.  So let's first change the resulting class template. <br>  mywidgetfactory.h: <br><pre> <code class="hljs kotlin">#ifndef MYWIDGETFACTORY_H #define MYWIDGETFACTORY_H #include &lt;QWebPluginFactory&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyWidgetFactory</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">public QWebPluginFactory { Q_OBJECT public: explicit MyWidgetFactory</span></span></span></span>(QObject *parent = <span class="hljs-number"><span class="hljs-number">0</span></span>); QObject *create(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QString &amp;mimeType, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QUrl &amp;url, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QStringList &amp;argumentNames, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QStringList &amp;argumentValues) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>; QList&lt;QWebPluginFactory::Plugin&gt; plugins() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>; signals: <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> slots: }; #endif <span class="hljs-comment"><span class="hljs-comment">// MYWIDGETFACTORY_H</span></span></code> </pre><br>  mywidgetfactory.cpp: <br><pre> <code class="hljs rust">#include <span class="hljs-string"><span class="hljs-string">"mywidgetfactory.h"</span></span> #include &lt;QTabWidget&gt; #include &lt;QPushButton&gt; #include &lt;QProgressBar&gt; #include &lt;QDebug&gt; #include &lt;QApplication&gt; #include &lt;QUrl&gt; MyWidgetFactory::MyWidgetFactory(QObject *parent) : QWebPluginFactory(parent) { } QList&lt;QWebPluginFactory::Plugin&gt; MyWidgetFactory::plugins() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { QWebPluginFactory::MimeType mimeType; mimeType.name = <span class="hljs-string"><span class="hljs-string">"text/qtexample"</span></span>; mimeType.description = <span class="hljs-string"><span class="hljs-string">"Comma-separated values"</span></span>; mimeType.fileExtensions = QStringList() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"txt"</span></span>; QWebPluginFactory::Plugin plugin; plugin.name = <span class="hljs-string"><span class="hljs-string">"PluginFactory Example"</span></span>; plugin.description = <span class="hljs-string"><span class="hljs-string">"PluginFactory Example"</span></span>; plugin.mimeTypes = QList&lt;MimeType&gt;() &lt;&lt; mimeType; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QList&lt;QWebPluginFactory::Plugin&gt;() &lt;&lt; plugin; } QObject *MyWidgetFactory::create(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QString &amp;mimeType, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QUrl &amp;url, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QStringList &amp;argumentNames, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QStringList &amp;argumentValues) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { qDebug() &lt;&lt; mimeType &lt;&lt; url &lt;&lt; argumentNames &lt;&lt; argumentValues; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mimeType != <span class="hljs-string"><span class="hljs-string">"text/qtexample"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; QTabWidget *tab = new QTabWidget(); int max = argumentValues.last().split(<span class="hljs-string"><span class="hljs-string">","</span></span>).first().toInt(); int val = argumentValues.last().split(<span class="hljs-string"><span class="hljs-string">","</span></span>).last().toInt(); QProgressBar *progressBar = new QProgressBar(); tab-&gt;addTab(progressBar, <span class="hljs-string"><span class="hljs-string">"Progress"</span></span>); progressBar-&gt;setMaximum(max); progressBar-&gt;setValue(val); QPushButton *pb = new QPushButton(<span class="hljs-string"><span class="hljs-string">"Click me!"</span></span>); tab-&gt;addTab(pb, <span class="hljs-string"><span class="hljs-string">"Button"</span></span>); connect(pb, SIGNAL(clicked()),QApplication::instance(), SLOT(quit())); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tab; }</code> </pre><br>  What have we done?  In the plugins () function, we described a Mime type that we would like to react to.  And then they described the plugin itself, which will monitor all of the loaded pages for the presence of this Mime type and, if it is detected, call the create () method and then turn the resulting widget into the page itself. <br><br>  Next, in the create () method we accept and output data to the console, check the mime type matches the text / qtexample we need and return a non-empty widget if the mime types match.  To make it a little more visual, here is the console output of data received by this function: <br><pre> <code class="hljs lisp"><span class="hljs-string"><span class="hljs-string">"text/qtexample"</span></span> QUrl( <span class="hljs-string"><span class="hljs-string">"file:///D:/devel/html5caller/100,28"</span></span> ) (<span class="hljs-string"><span class="hljs-string">"type"</span></span>, <span class="hljs-string"><span class="hljs-string">"data"</span></span>, <span class="hljs-string"><span class="hljs-string">"width"</span></span>, <span class="hljs-string"><span class="hljs-string">"height"</span></span>, <span class="hljs-string"><span class="hljs-string">"src"</span></span>) (<span class="hljs-string"><span class="hljs-string">"text/qtexample"</span></span>, <span class="hljs-string"><span class="hljs-string">"100,28"</span></span>, <span class="hljs-string"><span class="hljs-string">"300"</span></span>, <span class="hljs-string"><span class="hljs-string">"300"</span></span>, <span class="hljs-string"><span class="hljs-string">"100,28"</span></span>)</code> </pre><br>  As for the factory ... <br><br>  The next step is to tell our application about the presence of our own plugin factory.  To do this, let's add two new headings to the mainwondow.cpp file: <br><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QWebSettings&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"mywidgetfactory.h"</span></span></span></span></code> </pre><br>  And change the constructor of this class: <br><pre> <code class="hljs php">MainWindow::MainWindow(QWidget *<span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>) : QMainWindow(<span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>), ui(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Ui::MainWindow) { QWebSettings::globalSettings()-&gt;setAttribute( QWebSettings::PluginsEnabled, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); ui-&gt;setupUi(this); connect(ui-&gt;webView-&gt;page()-&gt;mainFrame(), SIGNAL(javaScriptWindowObjectCleared()), this, SLOT(addJSObject())); MyWidgetFactory *factory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyWidgetFactory(ui-&gt;webView); ui-&gt;webView-&gt;page()-&gt;setPluginFactory(factory); ui-&gt;webView-&gt;load(<span class="hljs-string"><span class="hljs-string">"file:///"</span></span>+QApplication::applicationDirPath() + <span class="hljs-string"><span class="hljs-string">"/../../html5caller/example.htm"</span></span>); }</code> </pre><br>  Here, first of all, in QtWebKit's global settings, we have included plugin support.  After that, we created an object of our Factory class and set it as a Plugin Factory for our QWebPage object related to our webView. <br><br>  There remains the last, final touch - you need to somehow embed our plugin into web-cnhfybxre / To do this, open example.htm and add a line like this after describing our form: <br><pre> <code class="hljs pgsql">&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>="text/qtexample" data="100,28" width="300" height="300"&gt;&lt;/<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;</code> </pre><br>  As it is easy to guess, here we specify the mime-type in order for the created plugin to react to us, set the dimensions of the future widget and transfer some data for initialization. <br><br>  The result of our work will be the following window: <br><img src="https://habrastorage.org/storage1/8ec9b41d/ea03e342/a531c0c8/54811706.png"><br>  According to the widget, you can poke, switch between tabs, and if you press the button on the second tab, the application will process the click and close. <br><br>  In general, that's all that I would like to tell about this time.  The source code of the application can be taken here and used as an example: <a href="http://code.google.com/p/html5cppmixer/downloads/list">code.google.com/p/html5cppmixer/downloads/list</a> <br><br>  I hope someone my experience will be useful and will be useful. </div><p>Source: <a href="https://habr.com/ru/post/133690/">https://habr.com/ru/post/133690/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../133685/index.html">Nokia 700 - video debriefing</a></li>
<li><a href="../133686/index.html">Emotional recognition market research</a></li>
<li><a href="../133687/index.html">Determinant of Wi-Fi points and their passwords</a></li>
<li><a href="../133688/index.html">How I went to the Android Market</a></li>
<li><a href="../133689/index.html">Second HTML5 Camp. Live broadcast</a></li>
<li><a href="../133692/index.html">Business control and financial reports</a></li>
<li><a href="../133695/index.html">Microsoft ignites startups for three years!</a></li>
<li><a href="../133697/index.html">Teremka style programming</a></li>
<li><a href="../133699/index.html">How to dictate email by phone</a></li>
<li><a href="../133700/index.html">Integrating Qt applications into Mac OS X (using Cocoa and Objective-C ++)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>