<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The troubleshooting algorithm in the LED lamp driver or Hercule Poirot rests</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, a friend asked me to help with the problem. He is engaged in the development of LED lamps, haggling them along the way. He has accumulated a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The troubleshooting algorithm in the LED lamp driver or Hercule Poirot rests</h1><div class="post__text post__text-html js-mediator-article"> Recently, a friend asked me to help with the problem.  He is engaged in the development of LED lamps, haggling them along the way.  He has accumulated a number of lamps that are not working properly.  Outwardly, this is expressed as: when turned on, the lamp flashes for a short time (less than a second) for a second goes out and repeats so indefinitely.  He gave me three such lamps for research, I solved the problem, the malfunction turned out to be very interesting (right in the style of Hercule Poirot) and I want to tell you about the way to find the malfunction. <br><a name="habracut"></a><br>  LED lamp looks like this: <br><br><img src="https://habrastorage.org/files/4dc/370/662/4dc3706623344821aa882957f71bd6a4.JPG"><br>  Figure 1. Appearance of the disassembled LED lamp <br><br>  The developer has applied a curious solution - the heat from the working LEDs is taken by a heat pipe and transferred to the classic aluminum radiator.  According to the author, this solution allows you to ensure the correct thermal conditions for the LEDs, minimizing the thermal degradation and ensuring the maximum possible service life of the diodes.  Along the way, the service life of the diode power driver increases, since the driver board is rendered from the thermal circuit and the board temperature does not exceed 50 degrees Celsius. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Such a solution - to separate the functional areas of light emission, heat removal and generation of supply current - allowed us to obtain high lamp performance in terms of reliability, durability and maintainability. <br>  Strangely enough, the minus of such lamps directly follows from its advantages - manufacturers do not need a durable lamp :).  The story of the collusion of manufacturers of incandescent lamps on the maximum service life of 1000 hours we all remember? <br><br>  Well, I can not fail to note the characteristic appearance of the product.  My "state control" (wife) did not allow me to put these lamps in the chandelier, where they are visible. <br><br>  Back to the driver problems. <br><br>  Here is the driver board: <br><br><img src="https://habrastorage.org/files/e47/f99/687/e47f996870fe4b3a8abd775f6a48d9ea.JPG"><br>  Figure 2. The appearance of the LED driver board from the surface-mounted side. <br><br>  And from the back: <br><br><img src="https://habrastorage.org/files/cc2/bbb/33d/cc2bbb33de1d41e68d5024f22feac3d4.JPG"><br>  Figure 3. The appearance of the LED driver board from the side of the power parts <br><br>  Studying it under a microscope allowed us to determine the type of control chip - this is MT7930.  This is a flyback converter control chip (Fly Back), hung with various defenses, like a Christmas tree - toys. <br><br>  Protection is built into MT7930: <br><br>  ‚Ä¢ from overcurrent of the key element <br>  ‚Ä¢ power supply down <br>  ‚Ä¢ increase the supply voltage <br>  ‚Ä¢ short circuit in the load and load break. <br>  ‚Ä¢ from exceeding the crystal temperature <br><br>  Declaring protection against short circuit in the load for the current source is more of a marketing nature :) <br><br>  A schematic diagram for exactly such a driver could not be obtained, but a search in the network gave some very similar schemes.  The closest one is shown in the picture: <br><br><img src="https://habrastorage.org/files/005/c0d/f02/005c0df020f34ffa879718887d6af20f.png"><br><br>  Figure 4. LED Driver MT7930.  Electrical schematic diagram <br><br>  An analysis of this scheme and a thoughtful reading of the manual to the microcircuit led me to the conclusion that the source of the blinking problem is the triggering of the protection after the start.  Those.  the initial start-up procedure passes (flashing of the lamp - this is it), but then the converter turns off due to some kind of protection, the power capacitors are discharged and the cycle starts anew. <br><br>  <b>Attention!</b>  <b>There are life-threatening voltages in the circuit!</b>  <b>Do not repeat without a proper understanding of what you are doing!</b> <br><br>  To study the signals with an oscilloscope, you need to decouple the circuit from the network so that there is no galvanic contact.  For this, I used an isolation transformer.  On the balcony in the reserves were found two transformers TN36 still Soviet production, dated 1975.  Well, these are eternal devices, massive, filled with green lacquer.  Connected by the scheme 220 - 24 - 24 -220.  Those.  first lowered the voltage to 24 volts (4 secondary windings of 6.3 volts), and then increased.  The presence of several primary windings with taps gave me the opportunity to play with different supply voltages - from 110 volts to 238 volts.  Such a solution is of course somewhat redundant, but it is quite suitable for one-time measurements. <br><br><img src="https://habrastorage.org/files/df2/617/594/df26175942664b5bace620095ed6cfe1.JPG"><br>  Figure 5. Photo separation transformer <br><br>  From the description of the start in the manual, it follows that when power is applied, capacitor C8 starts charging through resistors R1 and R2 with a total resistance of about 600 com.  Two resistors are applied from the safety requirements so that when one is broken through, the current through this circuit does not exceed the safe value. <br><br>  So, the power capacitor is slowly charging (this time is about 300-400 ms) and when the voltage on it reaches the level of 18.5 volts, the procedure for starting the converter starts.  The microcircuit begins to generate a sequence of pulses on a key field-effect transistor, which leads to the appearance of a voltage on the winding Na.  This voltage is used in two ways - to generate feedback pulses to control the output current (circuit R5 R6 C5) and to form the voltage of the working power supply of the chip (circuit D2 R9).  At the same time, a current arises in the output circuit, which leads to the ignition of the lamp. <br><br>  Why does the protection work and by what parameter? <br><br>  <b>First guess</b> <br><br>  Tripping of output overvoltage protection? <br><br>  To test this assumption, I dropped out and checked the resistors in the divider circuit (R5 10 com and R6 39 com).  Without unsoldering, do not check them, since they are connected in parallel through the transformer winding.  The elements were OK, but at some point the scheme worked! <br><br>  I checked the shape and voltage of the signals at all points of the transducer with an oscilloscope and was surprised to see that all of them are completely passport.  No abnormalities ... <br><br>  He gave the scheme to work for an hour - everything is OK. <br><br>  And if you let it cool?  After 20 minutes in the off state does not work. <br><br>  Very well, apparently the matter of heating some element? <br><br>  But what?  And what are the parameters of the element can float? <br><br>  At this point, I concluded that there is some element that is sensitive to temperature on the converter board.  Heating of this element fully normalizes the operation of the circuit. <br>  What is this item? <br><br>  <b>Second guess</b> <br><br>  Suspicion fell on the transformer.  The problem was thought so - the transformer due to inaccuracies in manufacturing (say for a couple of turns of the unwound winding) works in the saturation region and because of a sharp drop in inductance and a sharp increase in current, the field key current protection is triggered.  This is a resistor R4 R8 R19 in the drain circuit, the signal from which is fed to pin 8 (CS, apparently Current Sense) of the microcircuit and is used for the operating circuit of the current and when the 2.4 volt threshold is exceeded, it turns off the generation to protect the field effect transistor and transformer from damage.  The board under study has two R15 R16 resistors in parallel with an equivalent resistance of 2.3 ohms. <br><br>  But as far as I know, the parameters of the transformer deteriorate when heated, i.e.  system behavior should be different - turn on, work for 5-10 minutes and turn off.  The transformer on the board is very massive and has a thermal constant that is no less than a few minutes. <br>  Maybe, of course there is a short-circuited coil in it, which disappears when heated? <br><br>  Replacing the transformer to a guaranteed serviceable one was impossible at that moment (they did not bring a guaranteed working fee yet), so I left this option for later, when there were no versions left :).  Plus the intuitive feeling is not it.  I trust my engineering intuition. <br><br>  At this point, I checked the hypothesis about the protection of current, reducing the OS resistor by current by two solders parallel to it the same - it did not affect the blinking of the lamp. <br><br>  So, with the current of the field-effect transistor, everything is normal and there is no overcurrent.  It was clearly visible and the waveform on the oscilloscope screen.  The peak of the sawtooth signal was 1.8 volts and clearly did not reach a value of 2.4 volts, at which the microcircuit turns off generation. <br><br>  The circuit also turned out to be insensitive to changing the load - neither the connection of the second head in parallel, nor the switching of the heated head to the cold head and back changed anything. <br><br>  <b>Third assumption</b> <br><br>  I researched the power supply voltage of the microcircuit.  When operating in normal mode, all voltages were absolutely normal.  In the flashing mode, too, as far as could be judged by the waveforms on the oscilloscope screen. <br><br>  As before, the system blinked in a cold state and began to work normally when the transformer leg was warming up with a soldering iron.  15 seconds to warm up - and everything starts up normally. <br><br>  Warming the chip with a soldering iron did not give anything. <br><br>  And it was very embarrassing to have a short heating time ... what could change there in 15 seconds? <br><br>  At some point, I sat down and methodically, logically, everything is guaranteed to work.  Once the lamp lights up - it means the starting circuit is working. <br>  If the board heats up, it is possible to start the system and it works for hours ‚Äî that means the power systems are intact. <br>  It cools and stops working - something depends on the temperature ... <br>  Is there a crack in the circuit in the feedback circuit?  Cools and shrinks, contact breaks, heats up, expands and the contact recovers? <br>  I climbed a cold board with a tester - there are no cliffs. <br><br>  What else can interfere with the transition from the launch mode to the operating mode? !!! <br><br>  From complete hopelessness, intuitively soldered in parallel with an electrolytic capacitor 10 microfarads at 35 volts for the power supply of the chip is the same. <br><br>  And then came the happiness.  Earned! <br><br>  Replacing a 10 ŒºF capacitor with a 22 ŒºF completely solved the problem. <br><br>  Here it is, the cause of the problem: <br><br><img src="https://habrastorage.org/files/9e5/d99/d96/9e5d99d966904599a361a1ad5c3ff336.JPG"><br>  Figure 6. Capacitor with wrong capacity. <br><br>  Now it became clear the mechanism of failure.  The circuit has two power supply circuits.  The first, starting, slowly charges the capacitor C8 when applying 220 volts through a resistor in 600 com.  After its charge, the microcircuit starts generating pulses for the field operator, starting the power part of the circuit.  This leads to the generation of power for the chip in the operating mode on a separate winding, which is fed to the capacitor through a diode with a resistor.  The signal from this winding is also used to stabilize the output current. <br><br>  Until the system is out of operation, the microchip is powered by the stored energy in the capacitor.  And it lacked a little bit - literally two or three percent. <br>  The voltage drop was enough for the chip protection system to operate at low power and turn off everything.  And the cycle began anew. <br><br>  It was impossible to catch this drawdown of the supply voltage with an oscilloscope - too rough an estimate.  It seemed to me that everything is fine. <br><br>  Warming up the board increased the capacity of the capacitor by missing percentages - and the energy was already enough for a normal launch. <br><br>  It is clear why only some of the drivers failed with fully functional elements.  The freakish combination of the following factors has played a role: <br><br>  ‚Ä¢ Small capacitor capacitance.  The tolerance on the capacity of electrolytic capacitors (-20% + 80%) played a positive role, i.e.  capacity of 10 microfarads in 80% of cases have a real capacity of about 18 microfarads.  Over time, capacity decreases due to drying of the electrolyte. <br>  ‚Ä¢ Positive temperature dependence of the electrolytic capacitor capacitance on temperature.  The increased temperature at the site of the output control is literally two or three degrees, and there is enough capacity for a normal launch.  If we assume that on-site output control was not 20 degrees, but 25-27, then this was enough for almost 100% passing of the output control. <br><br>  The driver manufacturer saved, of course, by using capacities of a lower rating compared to the reference design from the manual (22 microfarads are indicated there), but fresh containers at elevated temperatures and taking into account the variation + 80% allowed the driver to hand over the batch of drivers.  The customer received seemingly working drivers, which eventually began to fail for some unknown reason.  It would be interesting to know - did the manufacturer's engineers take into account the behavior of electrolytic capacitors with increasing temperature and natural variation, or did this happen by chance? </div><p>Source: <a href="https://habr.com/ru/post/247975/">https://habr.com/ru/post/247975/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../247965/index.html">Minimum DB / GUI application on PicoLisp</a></li>
<li><a href="../247967/index.html">Lock iOS: do not fall for blackmail!</a></li>
<li><a href="../247969/index.html">Docker in production - what we learned by running over 300 million containers</a></li>
<li><a href="../247971/index.html">OS for data center Mesosphere: What is it and for whom</a></li>
<li><a href="../247973/index.html">Reflections on dereferencing a null pointer</a></li>
<li><a href="../247977/index.html">Regarding the evolution of printed materials in interactive and electronic</a></li>
<li><a href="../247979/index.html">Automation of non-cash payments</a></li>
<li><a href="../247981/index.html">Asterisk + FreeSwitch + Skype. Detailed guide</a></li>
<li><a href="../247983/index.html">The basics of CG-drawing examples: draw an oscilloscope, apply 3D</a></li>
<li><a href="../247987/index.html">Backup audio records from a playlist on VKontakte (up to 6000) using Python and the VK API</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>