<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing Opera Unite multilingual application (part 1)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Unfortunately, so far Opera does not support the localization of widgets by the method proposed in the W3C standard , but even if it does support, the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing Opera Unite multilingual application (part 1)</h1><div class="post__text post__text-html js-mediator-article">  Unfortunately, so far Opera does not support the localization of widgets by the method proposed in <a href="http://www.w3.org/TR/widgets/">the W3C standard</a> , but even if it does support, then this only applies to the server side, and, apparently, only the server language.  Therefore, we will do everything ourselves, given that the languages ‚Äã‚Äãof the browser server and the browser client are generally different. <a name="habracut"></a><h4>  Receiving from the server the language of the information sent to the client </h4>  How to determine the client language on the server?  - <a href="http://tools.ietf.org/html/rfc2616">HTTP Accept-Language header</a> .  How to get to him?  - via the getRequestHeader method or the headers property of the <a href="">WebServerRequest</a> object type.  And then process it according to the algorithm described in the RFC?  - Yes.  To do this, I wrote a function that accepts WebServerRequest and a list of supported localizations, and gives the client a preferred localization: <pre>  function getLanguageNameForRequest (Request, SelectedArray) {
	 var HeaderCollection = Request.getRequestHeader ("Accept-Language");
	 var AcceptString = "";
	 if (HeaderCollection! = null) if (HeaderCollection.length&gt; = 1) {
		 // HeaderCollection is a DOMStringList and does not have a join method, so pornography
		 for (var i = 0, AcceptString = HeaderCollection.item (0); i &lt;HeaderCollection.length-1;) {
			 i ++;
			 AcceptString + = "," + HeaderCollection.item (i);
		 }
	 }
	 var AcceptArray = AcceptString.replace ("", ""). split (",");
	 // See RFC2616, # 14.4 Accept-Language
	 //http://tools.ietf.org/html/rfc2616#section-14.4
	 var Lang = SelectedArray [0], Qu = -Infinity;
	 for (var i in AcceptArray) {
		 var l, q, lq;
		 lq = AcceptArray [i] .split (";");
		 l = lq [0]; q = 1;
		 try {
			 if (lq [1] .substring (0,2) === "q =") {
				 q = parseFloat (lq [1] .substring (2));
			 }
		 } catch (err) {
			 q = 1;
		 }
		 if (SelectedArray.indexOf (l)&gt; = 0) {
			 if (q&gt; Qu) {
				 Lang = l;
				 Qu = q;
			 }
		 }
	 }
	
	 return lang;
 }
</pre><h5>  Call example </h5>  For example, if the client sent the string ‚Äúru, ru-RU; q = 0.9, en; q = 0.8, de; q = 0.7‚Äù in the Accept-Language header, and the languages ‚Äã‚Äãru and en are supported on the server, then getLanguageNameForRequest will return ‚Äúru‚Äù: <pre>  window.onload = function () {opera.io.webserver.addEventListener ('_ index', function (RequestEvent) {
	 RequestEvent.connection.response.writeLine ("Client language:" + getLanguageNameForRequest (RequestEvent.connection.request, ["ru", "en"]));
	 RequestEvent.connection.response.close ();
 }, false);} </pre>  Why not use UserAgent instead?  Because it conveys the language of the browser interface, not the pages. <h4>  Receiving from the server side the language of information output to the server </h4>  The feature of Opera Unite technology is that the server-side script interacts not only with people who receive HTML clients through browsers, but also with the person who sits behind the server browser directly through various APIs, such as sending messages through <a href="">widget.showNotification</a> .  Fortunately, the same DOM is available for the server code as for the normal page, that is, window.navigator.language works and gives the interface language of the browser-server.  Wrap in a function similar to the previous case that selects a language from the available: <pre> function getLanguageNameForServer (SelectedArray) {
	 var l = window.navigator.language
	 return (SelectedArray.indexOf (l)&gt; = 0)? l: SelectedArray [0];
 }

 widget.showNotification ("Server language:" + getLanguageNameForServer (["en", "ru", "de"])); </pre><h4>  Creating infrastructure for localization of the application as a whole </h4>  Since one of the most important advantages of Opera Unite is the ability to use the same JavaScript code simultaneously in the server and client parts of the application, I would like to not lose this property when creating an API for localization, that is, the language of the returned strings should be implicitly determined by the place executing the code that asks for them.  This will be the second part of the post, if I write it. </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/72372/">https://habr.com/ru/post/72372/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../72367/index.html">Now Xmarks and under Google Chrome</a></li>
<li><a href="../72368/index.html">Programming social interactions</a></li>
<li><a href="../72369/index.html">5 invitations to Google Wave for free</a></li>
<li><a href="../72370/index.html">Software Configuration Management // Distributed Version Control</a></li>
<li><a href="../72371/index.html">W3C Launches New Website</a></li>
<li><a href="../72373/index.html">Yandex in Kazakhstan</a></li>
<li><a href="../72375/index.html">Google Chrome OS seems to run off the network%)</a></li>
<li><a href="../72376/index.html">Low cost ion nettop. Review and showdown</a></li>
<li><a href="../72384/index.html">free retake on VCP 4 until the end of 2009</a></li>
<li><a href="../72386/index.html">information about removing devices after P2V migration</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>