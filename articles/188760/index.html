<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Link, $ observe and $ watch functions in directives executed in the context of AngularJS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When you run your code inside a controller or service, you don‚Äôt have to worry about calling $ apply (), since the code runs inside the context of Ang...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Link, $ observe and $ watch functions in directives executed in the context of AngularJS</h1><div class="post__text post__text-html js-mediator-article"> When you run your code inside a controller or service, you don‚Äôt have to worry about calling $ apply (), since the code runs inside the context of Angular.  By this is meant that Angulyar understands that your code is in the process of execution and will perform a dirty check (check-check) after its completion.  When you are inside the directive, Angulyr's world view is a bit more limited;  now the directive should take care of calling $ apply () (or calling $ apply () with something like $ timeout) when it is necessary to inform Angulyar about changes in the view model (i.e. $ scope).  However, determining when to do this is a bit more difficult, because some aspects of the directive are actually executed within the context of Angulyar. <br><br>  If you have already created your own directives, you can be sure that you have seen one of two messages: <br><br> <code>$apply is already in progress.</code> <br> <code>$digest is already in progress.</code> <br> <a name="habracut"></a><br>  These error messages indicate that you are trying to tell Angulyar about the code that he already knows.  At best, just see this error in the console.  At worst, a recursive fiasco will occur that will break the browser (one of the few flaws in Firebug). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Most likely you got this error because you were inside a directive, and tried to tell Angulyar about all the changes in $ scope that occurred inside the directive.  And, although the philosophy of your actions is correct, there are parts of the directive that Angulyar has already monitored.  In particular, Angulyar already knows about: <br><br>  - binding function <br>  - $ observe () handlers for attributes <br>  - $ watch () handlers for $ scope <br><br>  If you make changes to the $ scope within the code that is executed synchronously in the linking function or asynchronously within the $ observe () and $ watch () handlers, then the actions are already performed in the context of Angular.  This means that Angulyar will perform a dirty check after the execution of your code and will cause additional $ digest cycles if necessary. <br><br>  To demonstrate this, I wrote a small directive that tracks the image upload event.  If the image is already loaded during the execution of the directive, the handler is called immediately - in the context of Angulyar.  If the image has not yet been loaded, the handler is invoked asynchronously and Angular should be explicitly notified of the changes. <br><br>  Note: $ observe () and $ watch () handlers are shown for demonstration purposes.  They do nothing. <br><br><div class="spoiler">  <b class="spoiler_title">Sample code</b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!doctype html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-app</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Demo"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-controller</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ListController"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--     src- --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-repeat</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"image in images"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>Loaded: {{ image.complete }}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{ image.source }}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bn-load</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"imageLoaded( image )"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--     src- --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>Loaded: {{ staticImage.complete }}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4.png"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bn-load</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"imageLoaded( staticImage )"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--  jQuery  AngularJS --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"//code.jquery.com/jquery-1.9.0.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"//ajax.googleapis.com/ajax/libs/angularjs/1.0.4/angular.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">//    var Demo = angular.module( "Demo", [] ); //     Demo.controller("ListController", function( $scope ) { //     $scope.imageLoaded = function( image ) { image.complete = true; }; //   .     //   data-URIs,     $scope.images = [{ complete: false, source: "1.png" }, { complete: false, source: "2.png" }, { complete: false, source: "3.png" }]; //    $scope.staticImage = { complete: false, source: "4.png" }; }); //  ,      Demo.directive( "bnLoad", function() { //   DOM   . function link( $scope, element, attributes ) { //      // $digest     $apply() function handleLoadSync() { logWithPhase( "handleLoad - Sync" ); $scope.$eval( attributes.bnLoad ); } //     //  $digest,     //    function handleLoadAsync() { logWithPhase( "handleLoad - Async" ); $scope.$apply( function() { handleLoadSync(); }); } //         . function logWithPhase( message ) { console.log( message, ":", $scope.$$phase ); } // ,     . //       //    Data URI, //         if ( element[0].src &amp;&amp; element[0].complete ) { handleLoadSync(); //     -    // (..    ). } else { element.on( "load.bnLoad", handleLoadAsync ); } //       //  ,   //       attributes.$observe("src", function( srcAttribute ) { logWithPhase( "$observe : " + srcAttribute ); }); //      //       . // :        ; //       . $scope.$watch("( image || staticImage ).complete", function( newValue ) { logWithPhase( "$watch : " + newValue ); }); //      $scope.$on("$destroy", function() { element.off( "load.bnLoad" ); }); } //    return({ link: link, restrict: "A" }); } ); </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  As you can see, three images (inside ngRepeat) are loaded dynamically and one is statically loaded.  Loading of all four images is monitored using the bnLoad directive and the phases of the life cycle are recorded in the log. <br><br>  The static image - 4.png - will be loaded by the time the directive is executed and causes the first handler to be triggered, which then displays the following in the console: <br><br><pre>  handleLoad - Sync: $ apply
 $ observe: 4.png: $ digest
 $ watch: true: $ digest
 $ observe: 1.png: $ digest
 $ watch: false: $ digest
 $ observe: 2.png: $ digest
 $ watch: false: $ digest
 $ observe: 3.png: $ digest
 $ watch: false: $ digest
 $ observe: 1.png: $ digest
 $ observe: 2.png: $ digest
 $ observe: 3.png: $ digest
 handleLoad - Async: null
 handleLoad - Sync: $ apply
 $ watch: true: $ digest
 handleLoad - Async: null
 handleLoad - Sync: $ apply 
 $ watch: true: $ digest
 handleLoad - Async: null
 handleLoad - Sync: $ apply
 $ watch: true: $ digest </pre><br>  I know that it is not clear from which side to approach, so I will point out a few key points: <br><br>  The first response of handleLoadSync () was caused by a static image.  Please note that it happened already inside the $ apply phase, in which Angulyar performs a dirty check.  This is because it was called in the link function link (), which is already in the context of Angulyar. <br><br>  All $ observe () and $ watch () handlers are inside the $ digest phase of Angulery‚Äôs dirty life cycle.  Once there, you don‚Äôt need to tell Angulyar about any changes in $ scope.  The angular will automatically perform a dirty check after each $ digest cycle. <br><br>  All images loaded asynchronously called the handleLoadAsync () method, which uses the $ apply () method to tell Angulyar about these changes.  That is why all subsequent handleLoadSync () methods are in the $ apply phase - they were called from the handleLoadAsync () handler. <br><br>  As mentioned earlier, Angulyar's directives are very powerful, but with a subversion you have to puff to put your head back.  The execution time in the Angulyar directive is crucial to its functionality, and this is one of the most difficult things to understand correctly.  Add something like CSS transitions ‚Äî which only have partial browser support ‚Äî and you'll quickly notice that problems with $ digest occur in one browser, but not in another.  We hope that this study will help a little better understand the cause of such problems. <br><br>  <i>Translator's Note: A</i> <a href="http://plnkr.co/edit/cMH4WIezzw6SNyuLYzrm%3Fp%3Dpreview">living example demonstrating the phases of the life cycle of Angulyar</a> </div><p>Source: <a href="https://habr.com/ru/post/188760/">https://habr.com/ru/post/188760/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../188746/index.html">Skwibl - how to do a startup and have time to relax?</a></li>
<li><a href="../188748/index.html">Comparison of electronic voltage regulators of foreign (Chinese) and Russian production</a></li>
<li><a href="../188752/index.html">IconBIT NETTAB SKAT RX tablet review: small and smart</a></li>
<li><a href="../188756/index.html">Happy Farm selected 8 resident startups of the second cycle for an internship in Silicon Valley</a></li>
<li><a href="../188758/index.html">Parse anti-piracy law by bone</a></li>
<li><a href="../188766/index.html">The annual route of the Curiosity rover for 2 minutes from NASA (and yes, Curiosity has been on Mars for a year!)</a></li>
<li><a href="../188774/index.html">Logging and Confirming Incidents for Updates Installed with SCCM 2007</a></li>
<li><a href="../188776/index.html">Features of the gaming market in China - part 2</a></li>
<li><a href="../188778/index.html">Custom Tree v2 jQuery plugin</a></li>
<li><a href="../188780/index.html">Moto X. A controversial but interesting novelty from Motorola / Google</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>