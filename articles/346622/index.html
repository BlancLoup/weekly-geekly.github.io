<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Examination of internal FPGA defects: we are looking for a black cat in a dark room</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Season 2: The board contains 4 XC7K160T crystals, which do not work for more than 2-3 weeks. What is the reason for failure? We understand 
 1. Softwa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Examination of internal FPGA defects: we are looking for a black cat in a dark room</h1><div class="post__text post__text-html js-mediator-article"><h3>  Season 2: The board contains 4 XC7K160T crystals, which do not work for more than 2-3 weeks.  What is the reason for failure?  We understand </h3><br><h4>  1. Software. </h4><br>  A check was made of the number of LUT elements between the triggers.  She showed it <br>  the number reaches 12, however this does not lead to large time delays and is easy <br>  fits in 4 ns, and even almost always in 3 ns.  In the process of obtaining the result of combinatorial operations (addition and comparison of multi-digit numbers) there is a danger of increased current consumption and local heating due to the significant spread of the propagation times of pulses, and as a result, the appearance of limit switching frequencies up to 1 GHz.  In Figure 1 below you can see that not one switch occurs at each clock cycle, but several. <br><br><img src="https://habrastorage.org/webt/i7/zm/ex/i7zmexitpudfio6daxu254y2deo.png" alt="image"><br>  Pic1 <br><br>  Therefore, an attempt was made to use a conveyor <a name="habracut"></a>  for computing and estimating with <br>  using simulation at the GATE level.  There were not too many switches, and <br>  pipelining only led to an increase in current consumption, so it was no longer applied.  Evaluation of the code has shown that it is written as optimally as possible.  Any changes in particular to the algorithm (for example, approximation by multiplication, which is applicable when dividing by a fixed constant) can only lead to an increase in the resources used.  Therefore, the further concerned mainly search for the causes of failure of the chips. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  2. Checking the temperature. </h4><br>  One of the reasons for the failure of the crystal may be overheating.  The critical temperature of the crystal can be considered the temperature of more than 80 degrees.  According to the expert (Novomar), silicon is ‚Äúdegraded‚Äù.  Usually, this is how tests for the failure of crystals are carried out. In a short time, it is possible to estimate how much a crystal will work under normal conditions.  Temperature measurements showed that under the worst conditions and long-term operation, temperatures above 70 degrees do not rise.  (See Fig.2) From which it follows that even with a clock frequency of 300 MHz, the life of the crystal can hardly be reduced.  The figure shows a graph when the calculation does not last long.  It was checked that in the long-term mode the temperature above 70 degrees does not rise either. <br><br><img src="https://habrastorage.org/webt/kl/ck/mb/klckmbe20qlhmcxwa3gohesjklm.png"><br>  Pic2 <br><br><h4>  3. The current consumption of the core and vias. </h4><br>  The core current consumption (VCCINT and VCCBRAM) FPGA was measured.  Power supply 1.0V. <br>  Figure 3 shows a graph of the current consumption of the core from the clock frequency of the processing unit. <br>  data.  Real and calculated.  Calculated less because the mode is no computing and <br>  computation mode is averaged.  Here you can see that the current can reach values ‚Äã‚Äãup to 15 A, while <br>  Power contacts for FPGA 21 pcs.  so  The current of each pin will be approximately 0.7 A. There are 2 places in the seal (M14, N13 and L13, K12), where there are 2 pins per transition hole.  So  current <br>  will be 1.4 A. The calculated value for the transition hole 1.5 A, recommended by the developers - 1 A. The test of these holes for current destruction was carried out. <br>  A prolonged 4 A current test (several hours) had no effect on the via.  Its resistance amounted to several mOhm.  In addition, on the board with the FPGA removed, all the holes were checked for breaks that were not detected.  The conclusion is that for this reason, the redeployment board does not need.  The reason for the failure of the crystals is not that.  Figure 3 shows a graph of the power consumption of the core, but since the voltage <br>  power supply core 1 V, then the current is numerically equal to the power. <br><br><img src="https://habrastorage.org/webt/fn/bd/fx/fnbdfxfle4elomopyub9n8ltqgm.png"><br>  Pic.3 <br><br><h4>  4. The sequence of supplying power to the crystal. </h4><br>  The sequence of powering the crystal is: VCCINT-&gt; VCCBRAM-&gt; VCCAUX &amp; <br>  VCCO;  VCCINT and VCCBRAM are allowed at the same time.  In this project, the sequence is broken.  This can be seen on the oscillogram in Figure 4. For 5 ms <br>  VCCO 3.3 V voltage exceeds 1.5 V, and VCCINT has not yet reached the nominal value.  it <br>  not recommended by the manufacturer. <br><br><img src="https://habrastorage.org/webt/qs/2m/vx/qs2mvx-pcu0riteslwvyvmlcg2u.png"><br>  Pic.4 <br><br>  However, in this situation, failure is possible at the time of power-up.  And really <br>  crystal fails during long work.  However, it is recommended to <br>  INHIBIT contacts of 3.3 V and 1.8 V stabilizers; set 1.0 ŒºF capacitors to GND.  it <br>  will allow them to run for a few milliseconds, and ensure that the requirement is met <br>  power up sequences.  See fig.  five. <br><br><img src="https://habrastorage.org/webt/wt/y0/ow/wty0owaraanssvjsr3swqqa2ita.png"><br>  Pic.5 <br><br><h4>  5. Principle diagram </h4><br>  The study of the circuit showed that the pin M12 VCCADC is supplied with power 3.3 V. This violates <br>  The maximum permissible values ‚Äã‚Äãfor a crystal that makes up for this pin is 2.0 V, nominal 1.8 V. It is necessary either to redistribute the board and connect this pin to 1.8 V, or reduce the power of 3.3 V to 1.8 V. But then you need to switch the signal CFGBVS_0 to GND.  It can also change other modes, so it seems better to repack. <br><br><h4>  6. Examining the state of defective crystals. </h4><br>  A problem with a reset has been detected on a good device.  Those.  when turned on, all the LEDs are lit and the device does not go into operating mode.  The problem was overcome by removing the external reset and generating it inside the crystal.  However, on a faulty sample, there is a problem on 3 chips out of four.  On two of them, the internal RST signal does not react at all to a pin (J26) state change, on one it responds only if it is closed to ground, and so it has state 1, although it should be 0. And only on one it works correctly.  This suggests that something is the result of exposure to a pin of static electricity, (although I was told that the pin is not used), or the problem is also related to the improper power supply of the ADCVCC pin (M12), or to the wrong power-up order. <br><br><h4>  6.1 SLICES </h4><br>  Now the fun part.  A program was written to fill in the slices. <br>  (elementary cells) by triggers, and memory is organized on them.  Crystal scan <br>  showed the presence of faulty items.  In fig.  6 shows these elements in yellow.  (Besides <br>  pale yellow strip on the left).  Figure 7 in more detail. <br><br><img src="https://habrastorage.org/webt/qs/3h/22/qs3h22iwc2rwfriuvbktsshrvps.png"><br>  Pic.6 <br><br><img src="https://habrastorage.org/webt/wn/uh/nh/wnuhnhfe8ahv5mw0_4ievdxi_hi.png"><br>  Fig.7 <br><br>  The test result can be viewed in the log files.  The calculation of the faulty element looks like this: For example, the file: test_X0-108Y160-191_Dev1 (com5) .txt <br>  ERROR AT A: 000D <br>  WR: 55555555 <br>  RD: 43555555 <br>  Address 0xD, 13: Slice position: X = 13, Y = 160 + (wrong bit position) = 160 + 25 = 185 and the others: 186, 188. So, X = 13, Y = 185, 186,188 <br>  So positions of faulty slices were received.  The test itself with the sources in the archive <a href="https://yadi.sk/d/e_QZGkBN3RSKaj">TEST_SLICES (27'07'2016)</a> .  In the Versions folder are bit files to run.  They are designed for quartz 125 MHz, the port speed is 115200. In the pictures you can see a green rectangle, this is the XADC block, the one with the wrong power supply, 3.3 V instead of 1.8V.  If XILINX is close to reality, it shows the location of the elements, then it can be seen that the assumption of crystal damage for this reason may be true.  You can exclude the broken slices from the system and prohibit the breeder from using them with the commands: <br>  set_property PROHIBIT 1 [get_sites SLICE_X17Y243] - prohibits individual slices. <br>  set_property PROHIBIT 1 [get_sites -range SLICE_X1Y176: SLICE_X25Y223] <br>  - Prohibits a set of slices. <br>  A complete set of such commands can be found in the file main1.xdc in the project archive <a href="https://yadi.sk/d/Rdf-snqO3RSKcX">BRAM_TEST</a> . <br><br><h4>  6.2 BRAM </h4><br>  Using the data about the broken slices, a test was constructed using 98% of the blocks. <br>  of memory.  The test result in fig.  eight. <br><br><img src="https://habrastorage.org/webt/rx/ax/ja/rxaxjav-oqs0lnxicnpbeiyuip4.png"><br>  Fig.8 <br><br>  More detail in Figure 9.  Red dots mark defective slices that are not used. <br>  for test work. <br><br><img src="https://habrastorage.org/webt/em/ht/ma/emhtmayjvvsgdma6vhtqbiejsv8.png"><br>  Fig.9 <br><br>  You can see that almost half of the BRAM memory is damaged.  And the damaged area is so <br>  However, it is closer to the ADC module, which is fed the wrong power.  Perhaps it <br>  not an accident.  If we consider that the slice test does not show all the faults, but only by <br>  One trigger and several LUTs per slice, I consider using a crystal with limiting <br>  The number of cores for a project is not efficient.  His work will be unpredictable, and may not <br>  show reliable results.  In addition, BRAM damage is too large.  And also <br>  it is necessary to take into account that some other chips may have other damages and not coincide with those already found. <br><br><h4>  Conclusion: </h4><br>  1. The board needs re-routing with power correction on ADC_VCC (M12) and installation <br>  additional capacitors to the INHIBIT pins of stabilizers + 3.3V and + 1.8V.  Also if <br>  The RST signal is output out of the board with the help of long wires (not counting the board with <br>  LEDs), it is desirable to provide protection against static electricity. <br>  2. When there is a great need, you can try to build a project, for example, at 80-90 <br>  kernels, introducing restrictions on the use of BRAM and SLICES, without using an external RST pin, applying an internal generated reset. <br>  PS: After following recommendation 1, the problems disappeared. <br>  M. Ye. Generalov, 2018 </div><p>Source: <a href="https://habr.com/ru/post/346622/">https://habr.com/ru/post/346622/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346604/index.html">The digest of interesting materials for the mobile developer # 236 (January 8 - January 14)</a></li>
<li><a href="../346606/index.html">Learned Telegram chat bot with AI in 30 lines of Python code</a></li>
<li><a href="../346608/index.html">We test user scripts with Hermione. Yandex lecture</a></li>
<li><a href="../346610/index.html">Reasoning around systems engineering and comments on "Richard Hamming: Chapter 28. Systems Engineering"</a></li>
<li><a href="../346618/index.html">Correcting typos with context</a></li>
<li><a href="../346628/index.html">Spring Security interrogation query path</a></li>
<li><a href="../346630/index.html">Events, processes and services: a modern approach to automating business processes</a></li>
<li><a href="../346632/index.html">Parsim memes in python: how to bypass the server lock</a></li>
<li><a href="../346634/index.html">Lab: Introduction to Docker from scratch. Your first microservice</a></li>
<li><a href="../346636/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ297 (January 8 - 14, 2018)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>