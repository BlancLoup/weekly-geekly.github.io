<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Rambler-Kart API Widgets</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article we will talk about one of the most promising features of the Rambler-Maps API - connecting custom widgets . 

 What are widgets? Stric...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Rambler-Kart API Widgets</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://maps.rambler.ru/api/examples/TutorialWidget.html"><img src="https://habrastorage.org/storage2/0fc/d07/764/0fcd07764c1d9b0aae3a1d04a65770de.png"></a> <br><br>  In this article we will talk about one of the most promising features of the Rambler-Maps API - connecting custom <a href="http://maps.rambler.ru/api/docs/widget">widgets</a> . <br><a name="habracut"></a><br>  What are widgets?  Strictly speaking, these are JS modules created from a template to increase the functionality of the API.  Figuratively speaking, if the API is the foundation of working with maps, the widgets are the home.  And how it will be - you decide.  By writing your own widget, you can implement your wildest cartographic ideas. <br><br>  At the moment, we have already developed four widgets: <a href="http://maps.rambler.ru/api/docs/routing">"Routing"</a> , <a href="http://maps.rambler.ru/api/docs/ruler">"Line"</a> , <a href="http://maps.rambler.ru/api/docs/traffic">"Traffic jams"</a> and <a href="http://maps.rambler.ru/api/docs/cameras">"Cameras"</a> .  On their example, it is quite possible to get an idea of ‚Äã‚Äãwhat are the Rambler-Kart API widgets, why they are needed and how they work.  By the way, you can send us your own widgets and we will post them on the website so that everyone can use them! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      From words get down to business.  Next, we will step by step analyze the creation of a new widget that performs a simple task: after turning on, display a tip from the (cursor) geographic coordinates near the cursor, perform a reverse geocoding when clicking on the map and show the address of the click location in this prompt, and hide everything. <br><br>  So, create a widget.  Everything necessary for its operation is passed by arguments to the <b>RMap.registerWidget</b> method.  The first argument is the name of the widget (for subsequent reference to it), the second is an object with parameters, which we will discuss in detail. <br><br>  First you need to assign output: specify the author, a brief description of the widget and the version number. <br><br><pre><code class="javascript hljs">RMap.registerWidget(<span class="hljs-string"><span class="hljs-string">'Location'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">author</span></span>: <span class="hljs-string"><span class="hljs-string">'Alex.'</span></span>, <span class="hljs-attr"><span class="hljs-attr">about</span></span>: <span class="hljs-string"><span class="hljs-string">'location tooltip'</span></span>, <span class="hljs-attr"><span class="hljs-attr">version</span></span>: <span class="hljs-string"><span class="hljs-string">'0.0.1'</span></span>,</code> </pre> <br>  Then the parameter <b>controls</b> , an array of widget controls.  In our case, this is one button switch (SwitchButton).  Among the properties of the control object, the important funcs should be highlighted, consisting of <b>switchOn</b> and <b>switchOff</b> - these are functions that are triggered when the button is turned on and off.  It is enough to pass on their names, we will return to them later. <br><br><pre> <code class="javascript hljs"> controls: [{ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: [<span class="hljs-string"><span class="hljs-string">'SwitchButton'</span></span>], <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-string"><span class="hljs-string">'control'</span></span>, <span class="hljs-attr"><span class="hljs-attr">groupId</span></span>: <span class="hljs-string"><span class="hljs-string">'loc'</span></span>, <span class="hljs-attr"><span class="hljs-attr">style</span></span>: { <span class="hljs-comment"><span class="hljs-comment">/*  .  Location.js */</span></span> }, <span class="hljs-attr"><span class="hljs-attr">funcs</span></span>: { <span class="hljs-attr"><span class="hljs-attr">switchOn</span></span>: <span class="hljs-string"><span class="hljs-string">'switchOn'</span></span>, <span class="hljs-attr"><span class="hljs-attr">switchOff</span></span>: <span class="hljs-string"><span class="hljs-string">'switchOff'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">params</span></span>: { <span class="hljs-attr"><span class="hljs-attr">autoSwitch</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">autoSwitchCall</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, <span class="hljs-attr"><span class="hljs-attr">parent</span></span>: <span class="hljs-string"><span class="hljs-string">'map.controls.groups.loc'</span></span> }],</code> </pre><br>  The <b>cursors</b> parameter allows <b>you</b> to specify which cursors to use in certain situations.  Say, for our widget, one crosshair cursor is enough for accurate positioning. <br><br><pre> <code class="javascript hljs"> cursors: { <span class="hljs-attr"><span class="hljs-attr">crosshair</span></span>: { <span class="hljs-attr"><span class="hljs-attr">cur</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">def</span></span>: <span class="hljs-string"><span class="hljs-string">"crosshair"</span></span> } },</code> </pre><br>  The next optional parameter, <b>eventTypes,</b> is a widget event type that can be used, for example, to interact with other widgets. <br><br><pre> <code class="javascript hljs"> eventTypes: { <span class="hljs-attr"><span class="hljs-attr">TURN_ON</span></span>: <span class="hljs-string"><span class="hljs-string">"turn on"</span></span>, <span class="hljs-attr"><span class="hljs-attr">TURN_OFF</span></span>: <span class="hljs-string"><span class="hljs-string">"turn off"</span></span> },</code> </pre><br>  The <b>handlers</b> parameter establishes connections between events and their handlers.  In our widget, there are four handlers: show (shows a hint when you hover over the map), move (moves the hint after the cursor), hide (hides the hint when the cursor leaves the map or turns off the button) and geocode (converts coordinates into an address).  From the inside of the widget, the events can then be addressed as this.event.call (‚Äúturn on‚Äù, [{data: ...}]);  Additional data is simultaneously transmitted. <br><br><pre> <code class="javascript hljs"> handlers: { <span class="hljs-attr"><span class="hljs-attr">show</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: [<span class="hljs-string"><span class="hljs-string">"mousemove"</span></span>], <span class="hljs-attr"><span class="hljs-attr">handler</span></span>: <span class="hljs-string"><span class="hljs-string">"show"</span></span>, <span class="hljs-attr"><span class="hljs-attr">isObject</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">sleeped</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-comment"><span class="hljs-comment">//   .  Location.js },</span></span></code> </pre><br>  The <b>tools</b> parameter is a list of API libraries that are used in the widget.  By the way, I remind you that widgets can and even need to use any available API methods. <br><br><pre> <code class="javascript hljs"> tools: [<span class="hljs-string"><span class="hljs-string">"JSON"</span></span>, <span class="hljs-string"><span class="hljs-string">"Events"</span></span>, <span class="hljs-string"><span class="hljs-string">"util"</span></span>],</code> </pre><br>  And finally, the variables and functions of the widget. <br><br><pre> <code class="javascript hljs"> <span class="hljs-comment"><span class="hljs-comment">// topP: 5, leftP: 5, tt: false, h: false, //,    show: function(e) { //  // .  Location.js }, move: function(e) { //  //  .  Location.js }, hide: function() { //  this.tt.style.display = 'none' }, geocode: function(e) { //    // .  Location.js }, //  switchOn  switchOff switchOn: function() { this.handlers.show.activate(); this.handlers.hide.activate(); this.handlers.geocode.activate(); this.cursors.crosshair.show(); }, switchOff: function() { this.handlers.show.sleep(); this.handlers.geocode.sleep(); this.hide(); this.cursors.crosshair.hide(); }, //     turnOn: function() { this.controls.control.switchOn(); }, turnOff: function() { this.controls.control.switchOff(); }</span></span></code> </pre><br>  A useful note is that any public functions of the widget, for example, <b>turnOn</b> or <b>turnOff</b> described above, can be called in the page script using an expression like map.widgets.Location.turnOn (). <br><br>  Creating a widget is over.  Further, the generated code can be placed directly in the body of the page, but (!) It is much more convenient to save it in a separate JS module and connect it along with the API.  Then to call the widget, the <b>getWidget</b> method is <b>used</b> , and the script on the page is reduced to just a couple of lines. <br><br><pre> <code class="javascript hljs">&lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span>&gt; <span class="hljs-comment"><span class="hljs-comment">//     - var map = new RMap('myMap', {widgets: false}); //  map.getWidget("Location", function () {this.init()} ); &lt;/script&gt;</span></span></code> </pre><br>  The full code of the example is available at <a href="http://maps.rambler.ru/api/examples/TutorialWidget.html">http://maps.rambler.ru/api/examples/TutorialWidget.html</a> </div><p>Source: <a href="https://habr.com/ru/post/155071/">https://habr.com/ru/post/155071/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../155059/index.html">Visual editor BB codes for phpBB3</a></li>
<li><a href="../155061/index.html">A simple way to transmit information via video</a></li>
<li><a href="../155063/index.html">Release of the new version of the modLivestreet 0.3.0-rc module</a></li>
<li><a href="../155067/index.html">Carmageddon did come out!</a></li>
<li><a href="../155069/index.html">The first stable SDK for Dart</a></li>
<li><a href="../155073/index.html">Internet Explorer for Xbox</a></li>
<li><a href="../155075/index.html">How to get rid of ORA-01410 by isolating intact data</a></li>
<li><a href="../155077/index.html">Google introduced the ‚ÄúDisavow links‚Äù feature to selectively remove the influence of spamming external links.</a></li>
<li><a href="../155079/index.html">Foresight "Cloud services - myth or reality?"</a></li>
<li><a href="../155081/index.html">Supermarket chain in China is going to open augmented reality stores</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>