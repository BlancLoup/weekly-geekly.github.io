<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Mixed (client / server) xmlDsig digital signature generation algorithm based on CryptoPro Browser Plugin</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On Habr√©, there was already an overview article about the mechanisms for creating EDS in the browser, where it was told about the Krypto Pro CSP + bun...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Mixed (client / server) xmlDsig digital signature generation algorithm based on CryptoPro Browser Plugin</h1><div class="post__text post__text-html js-mediator-article">  On Habr√©, there was already an overview <a href="http://habrahabr.ru/post/136572/">article</a> about the mechanisms for creating EDS in the browser, where it was told about the Krypto Pro CSP + bundle of their own browser plug-in.  As it was said there, the preliminary requirements for work are the presence of a CryptoPro CSP on a computer and the installation of a certificate with which we are going to sign.  The option is quite working, moreover, in version 1.05.1418 of the plug-in, work with the XMLDsig signature has been added.  If there is an opportunity to drive files to the client and back, then in order to sign the document on the client, it is enough to read CryptoRead help.  Everything is done in javascript by calling a couple of methods. <br>  However, what if the files are on the server and you want to minimize the traffic and sign them without driving the client entirely? <br>  Interesting? <a name="habracut"></a><br>  So, the client / server XMLDSig digital signature generation algorithm. <br>  Information about the specification on XMLDsig can be found at the address <a href="http://www.w3.org/TR/xmldsig-core/">here</a> . <br>  I will consider the formation of an enveloping signature for an xml document. <br>  A simple example of signed xml: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MyTestXml</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MySomeData</span></span></span><span class="hljs-tag">&gt;</span></span>....<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MySomeData</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Signature</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2000/09/xmldsig#"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SignedInfo</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CanonicalizationMethod</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Algorithm</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/TR/2001/REC-xml-c14n-20010315"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SignatureMethod</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Algorithm</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"urn:ietf:params:xml:ns:cpxmlsec:algorithms:gostr34102001-gostr3411"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Reference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">URI</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Transforms</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Transform</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Algorithm</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/TR/1999/REC-xpath-19991116"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">XPath</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:dsig</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2000/09/xmldsig#"</span></span></span><span class="hljs-tag">&gt;</span></span>not(ancestor-or-self::dsig:Signature)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">XPath</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Transform</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Transforms</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DigestMethod</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Algorithm</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"urn:ietf:params:xml:ns:cpxmlsec:algorithms:gostr3411"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DigestValue</span></span></span><span class="hljs-tag">&gt;</span></span>...<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DigestValue</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Reference</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SignedInfo</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SignatureValue</span></span></span><span class="hljs-tag">&gt;</span></span>...<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SignatureValue</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">KeyInfo</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">X509Data</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">X509Certificate</span></span></span><span class="hljs-tag">&gt;</span></span>...<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">X509Certificate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">X509Data</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">KeyInfo</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Signature</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MyTestXml</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  To better understand what an enveloping signature is, I offer a brief translation of the description of tags from the specification: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Signature - contains the signature data, including the signature itself and the certificate. </li><li>  SignedInfo - contains information about the data to be signed and algorithms that will be used when generating a signature. </li><li>  CanonicalizationMethod - specifies the canalization algorithm that will be applied to SignedInfo before calculating the signature. </li><li>  SignatureMethod - specifies the algorithm used to generate and validate the signature.  The algorithm receives the caned-localized SignedInfo tag. </li><li>  Reference can occur 1 or more times.  Contains information about the data being signed, including the location of the data in the document, the algorithm for calculating the hash from the data, the transformation, and the hash itself. </li><li>  Transforms and Transform transform data.  The input of the first transform comes the result of dereferencing the URI attribute of the Reference tag.  The result of the previous one comes to the input of each subsequent transform, the result of the last transform comes to the input of the algorithm specified in the DigestMethod.  Usually in transform specify XPath, defining protected parts of the document. </li><li>  DigestMethod is a hash calculation algorithm for Transforms results. </li><li>  DigestValue is a hash value from Transforms results. Often this is a hash of the data referenced by the Reference URI. </li><li>  SignatureValue is the signature itself, for the formation of which everything is being started. </li><li>  KeyInfo - information about the key; here you are interested in the X509Certificate tag, which contains the base64encoded certificate from the key with which the data is signed. </li></ul><br><br>  So, the source data: <br><br><ul><li>  on the server we have an xml document to be signed.  I also used CryptoPro .Net on the server, but it can be done without it. </li><li>  on the client, we need an OS that supports working with CryptoPro CSp 3.6 (in my case it was Windows 7), a browser that supports working with CryptoPro Pro EDS Browser Plugin, and, actually, the key that we are going to sign (in my case, the key was on the flash drive) . </li></ul><br><br>  Client preparation: <br><br><ul><li>  install CryptoPro CSP 3.6 </li><li>  Installing CryptoPro EDS Browser Plugin </li><li>  Install the certificate from the USB flash drive in the local storage (see <a href="http://www.cryptopro.ru/sites/default/files/docs/instruction_manual_csp_r3.pdf">instructions</a> <br>  Clause 2.5.2.2.  Installing a personal certificate stored in a private key container ") </li></ul><br><br>  <b>Step number 1.</b>  <b>(server)</b> <br>  <i>Prepare a signature template for the document that we are going to sign.</i> <br>  At this stage, we need to obtain a Signature tagging with calculated hashes (DigestValue) from the protected data.  The algorithm for manually calculating these hashes is described in detail <a href="http://www.di-mgt.com.au/xmldsig.html">here</a> , but since we bought CryptoPro .Net in our office and based on it we wrote an internal library for working with signatures, I simply signed the document on the server with another key using this library, and as a result I got the necessary I have a template with calculated hashes from the data, but with invalid SignatureValue and X509Certificate. <br><br>  <b>Step number 2.</b>  <b>(server)</b> <br>  <i>We can canonize SignedInfo, formed in step # 1</i> <br>  The algorithm is as follows (taken <a href="http://www.di-mgt.com.au/xmldsig.html">from here</a> with additions. In the disputed places left the original text): <br><ul><li>  the first character "&lt;", the last "&gt;". </li><li>  all intermediate spaces inside tags are preserved (original All leading space characters inbetween are retained.) </li><li>  view elements <pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tag</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre>  replace with <pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tag</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tag</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre></li><li>  end of lines replace with LF (0x0A). </li><li>  expose namespace xmlns = " <a href="http://www.w3.org/2000/09/xmldsig">www.w3.org/2000/09/xmldsig#</a> " to the SignedInfo tag (The English namepace The xmlns = " <a href="http://www.w3.org/2000/09/xmldsig">www.w3.org/2000/09/xmldsig#</a> " .) </li><li>  tag attributes must be arranged alphabetically within tags (this problem manifested itself when generating a signature containing SignatureProperties) </li></ul><br><br>  C # code that worked in my case: <br><pre> <code class="cs hljs"> XmlNode xmlNode = xmlElement.GetElementsByTagName(<span class="hljs-string"><span class="hljs-string">"SignedInfo"</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; XmlDocument xmlDocumentSignInfo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XmlDocument(); xmlDocumentSignInfo.PreserveWhitespace = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; xmlDocumentSignInfo.LoadXml(xmlNode.OuterXml); result = Canonicalize(xmlDocumentSignInfo);</code> </pre><br><br>  Where: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Canonicalize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">XmlDocument document</span></span></span><span class="hljs-function">)</span></span> { XmlDsigExcC14NTransform xmlTransform = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XmlDsigExcC14NTransform(); xmlTransform.LoadInput(document); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamReader((MemoryStream)xmlTransform.GetOutput()).ReadToEnd(); <span class="hljs-comment"><span class="hljs-comment">//C#      XPath  result = s.Replace("&lt;XPath&gt;", "&lt;XPath xmlns:dsig=\"http://www.w3.org/2000/09/xmldsig#\"&gt;"); return result ; }</span></span></code> </pre><br><br>  <b>Step number 3.</b> <br>  <i>We take hash from kanokalizirovanny SignedInfo.</i> <br>  There are 2 options, server and client. <br>  <b>3.1)</b> Hash capture on client.  That is what I use, so I will describe it first: <br>  On the server, encode the SignedInfo to base64 <br>  C #: <pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> b64CanonicalizeSignedInfo= Convert.ToBase64String(Encoding.UTF8.GetBytes(s));</code> </pre><br>  and send this data to the client. <br>  On the client, we take the hash with the help of the cryptographic plugin <br>  Javascript: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> CADESCOM_HASH_ALGORITHM_CP_GOST_3411 = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> CADESCOM_BASE64_TO_BINARY = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hashObject = CreateObject(<span class="hljs-string"><span class="hljs-string">"CAdESCOM.HashedData"</span></span>); hashObject.Algorithm = CADESCOM_HASH_ALGORITHM_CP_GOST_3411; hashObject.DataEncoding = CADESCOM_BASE64_TO_BINARY; hashObject.Hash(hexCanonicalSignedInfo);</code> </pre><br><br>  You can view the hash using hashObject.Value <br>  <b>3.2)</b> We consider the hash on the server and send it to the client.  This option did not work for me, but to be honest, I did not really try. <br><br>  We take hash (server C #): <br><pre> <code class="cs hljs"> HashAlgorithm myhash = HashAlgorithm.Create(<span class="hljs-string"><span class="hljs-string">"GOST3411"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] hashResult = myhash.ComputeHash(anonicalSignedInfoByteArr);</code> </pre><br>  Perhaps the hash should be converted to base64. <br><br>  We send to the client, there we use <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hashObject = CreateObject(<span class="hljs-string"><span class="hljs-string">"CAdESCOM.HashedData"</span></span>); hashObject.SetHashValue(hashFromServer);</code> </pre><br>  It was on the hashObject.SetHashValue method that I had an error.  I did not understand, but a crypto forum was told that it was possible to somehow make it work. <br><br>  If you are thinking of implementing a server-side algorithm for generating a hash, then here are a couple of useful tips: <br>  1) Calculate the hash on the client and on the server from an empty string.  it must match, it means your algorithms are the same. <br>  For GOST3411 these are the following values: <br>  base64: mB5fPKMMhBSHgw + E + 0M + E6wRAVabnBNYSsSDI0zWVsA = <br>  hex: 98 1e 5f 3c a3 0c 84 14 87 83 0f 84 fb 43 3e 13 ac 11 01 56 9b 9c 13 58 4a c4 83 23 4c d6 56 c0 <br>  2) Ensure that you have hashes for arbitrary data generated on the client and on the server. <br>  After that, you can only send the hash from SignedInfo instead of the entire SignedInfo to the client. <br><br>  <b>Step number 4. (client)</b> <br>  <i>Generate SignatureValue and send to the SignatureValue server and certificate information.</i> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> certNumber=<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-comment"><span class="hljs-comment">//      var CAPICOM_CURRENT_USER_STORE = 2; var CAPICOM_MY_STORE = "my"; var CAPICOM_STORE_OPEN_MAXIMUM_ALLOWED = 2; var oStore = CreateObject("CAPICOM.Store"); oStore.Open(CAPICOM_CURRENT_USER_STORE, CAPICOM_MY_STORE, CAPICOM_STORE_OPEN_MAXIMUM_ALLOWED); var certificate=oStore.Certificates.Item(certNumber) var rawSignature = CreateObject("CAdESCOM.RawSignature"); var signatureHex = rawSignature.SignHash(hashObject, certificate); // base64   var binReversedSignatureString = utils.reverse(utils.hexToString(signatureHex)); var certValue = certificate.Export(certNumber);</span></span></code> </pre><br><br>  We return to the server binReversedSignatureString and certValue. <br><br>  The code of functions from utils I do not post.  I was prompted to him on the cryptoPro forum and can be viewed in this <a href="http://www.cryptopro.ru/forum2/default.aspx%3Fg%3Dposts%26t%3D6444">thread.</a> <br><br>  <b>Step number 5.</b>  <b>(server)</b> <br>  <i>Replace the Signature tag values ‚Äã‚Äãof the SignatureValue and X509Certificate tags with the values ‚Äã‚Äãreceived from the client in the Signature tag generated in Step 1</i> <br><br>  <b>Step number 6.</b>  <b>(server)</b> <br>  <i>We verify the card.</i> <br>  If the verification was successful, then everything is fine.  As a result, we get a document signed with a client key on the server, without going back and forth the file itself. <br><br>  <i>Note:</i> if work is carried out with a document that already contains signatures, they should be disconnected from the document before step No. 1 and attached to the document back after step No. 6 <br><br>  In conclusion, I would like to say a big thank you for helping us find the algorithm for the participants of the CryptoPro forum by dmishin and Fomich. <br>  Without their advice I would flop with it many times longer. </div><p>Source: <a href="https://habr.com/ru/post/189596/">https://habr.com/ru/post/189596/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../189582/index.html">Simple but effective technique for working with SQL comment blocks</a></li>
<li><a href="../189584/index.html">Between Samsung Galaxy S III and OPPO Find 5 (quite a bit more about the latter)</a></li>
<li><a href="../189586/index.html">Hipster approach or ‚Äúwhat to do when writing press releases is boring‚Äù</a></li>
<li><a href="../189588/index.html">How to create a cluster in JBoss AS 7.1 in standalone mode?</a></li>
<li><a href="../189594/index.html">Paul Graham: How to convince investors</a></li>
<li><a href="../189598/index.html">URiX - Review of Not uNix</a></li>
<li><a href="../189606/index.html">Control your website with the new monitoring service from REG.RU</a></li>
<li><a href="../189610/index.html">The phrase "perezalil on habrastorage" loses its meaning</a></li>
<li><a href="../189612/index.html">Like spawns like: what affects the rating on the Internet</a></li>
<li><a href="../189614/index.html">mySQLgame 2.0</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>