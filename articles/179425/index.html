<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using Liquibase without a headache. 10 tips from real development experience</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Liquibase is a database migration management system. This is the second article about Liquibase, this time containing tips on ‚Äúcombat‚Äù use of the syst...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using Liquibase without a headache. 10 tips from real development experience</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/c4d/818/517/c4d818517f5ff47997415924b8896ec4.jpg" alt="kdpv" align="right">  Liquibase is a database migration management system.  This is the second article about Liquibase, this time containing tips on ‚Äúcombat‚Äù use of the system.  For getting the basic information, the first article-translation ‚ÄúManaging DB Migrations with Liquibase‚Äù ( <a href="http://habrahabr.ru/post/178665/">link</a> ) is suitable. <br><br>  Like many tools that make life easier for software developers, Liquibase has a ‚Äúreverse side of the coin‚Äù that you have to face sooner or later. <br><br>  Here are 10 things that at a certain point when working with Liquibase was a discovery for me. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  1. Versioning of the application should be reflected in the folder structure of migrations </h4><br>  If you do not follow this rule, the changelog files will quickly decorate the migration folder with its number and unusual names. <br>  At the moment, for myself, I have developed an optimal strategy for naming files and folders.  Here she is: <br><br><pre><code class="bash hljs">/db-migrations /v-1.0 /2013-03-02--01-initial-schema-import.xml /2013-03-02--02-core-data.xml /2013-03-04--01-notifications.xml /changelog-v.1.0-cumulative.xml /v-2.0 ... /changelog-v.2.0-cumulative.xml /changelog.xml</code> </pre> <br>  More details: <a name="habracut"></a><br><br><h5>  1.1.  Changes to database changes should be contained in separate folders and correspond to the application versions. </h5><br>  Pros: <br><ul><li>  You can always easily tell what changes to the data scheme occurred during the transition from version to application version. </li><li>  Supports accuracy in folders, does not allow to relax. </li></ul><br><br><h5>  1.2.  Have a cumulative changelog file for each version. </h5><br>  The main migration file is /db-migrations/changelog.xml.  Only the cumulative changelog files of each version are included in it (‚Äúinclude‚Äù tag). <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">databaseChangeLog</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.liquibase.org/xml/ns/dbchangelog"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Should be only links to per-version cumulative changelog files. --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">file</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"v-1.0/changelog-v.1.0-cumulative.xml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">relativeToChangelogFile</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">file</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"v-2.0/changelog-v.2.0-cumulative.xml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">relativeToChangelogFile</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">databaseChangeLog</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  In turn, the cumulative changers of application versions include specific changeset files. <br>  Thus, it is possible not to litter the main file of changelogs. <br><br><h5>  1.3.  Follow file naming conventions </h5><br>  The file naming rule makes it possible to understand what followed what without viewing cumulative file changer files. <br><br><pre> <code class="hljs 1c"><code class="xml">-&lt;DATE_INCR&gt;-.xml <br> <b>DATE</b> ‚Äì <span class="hljs-built_in"><span class="hljs-built_in"></span></span>  <br> <b>DATE_INCR</b> ‚Äì      (      <span class="hljs-built_in"><span class="hljs-built_in"></span></span>.) <br> <b>DESCR</b> ‚Äì . <br> : <br> <i><span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">03</span></span>-<span class="hljs-number"><span class="hljs-number">02</span></span>--<span class="hljs-number"><span class="hljs-number">01</span></span>-initial-schema-import.xml</i> <br> <br> <span class="hljs-number"><span class="hljs-number">2</span></span>.   ,   <br>   (<span class="hljs-keyword"><span class="hljs-keyword"></span></span>    rollback )    . <br>   <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   ,    <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  .    , <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   . <br> <br> <span class="hljs-keyword"><span class="hljs-keyword"></span></span>     <span class="hljs-built_in"><span class="hljs-built_in"></span></span> ,  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>      PROD-,    , ,      ,   . <br> <br> <span class="hljs-number"><span class="hljs-number">3</span></span>.    ,    <br>   ‚Äî  . <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   , ,    . <br>    , <span class="hljs-keyword"><span class="hljs-keyword"></span></span>      ,     rollback.           . <br> <br> <span class="hljs-number"><span class="hljs-number">4</span></span>. ,   ,    <br> <span class="hljs-keyword"><span class="hljs-keyword"></span></span>      ,  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>    Oracle  MySQL DDL- <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   . <br>  ,  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>     , DDL-,      . <br>  ( ): <br> <br> &lt;changeSet id=<span class="hljs-string"><span class="hljs-string">"2013-03-02-initial-schema-import-1"</span></span> author=<span class="hljs-string"><span class="hljs-string">"eg"</span></span>&gt; &lt;createTable tableName=<span class="hljs-string"><span class="hljs-string">"HOUSES"</span></span>&gt; &lt;column name=<span class="hljs-string"><span class="hljs-string">"ID"</span></span> type=<span class="hljs-string"><span class="hljs-string">"BIGINT"</span></span> /&gt; &lt;/createTable&gt; &lt;addPrimaryKey tableName=<span class="hljs-string"><span class="hljs-string">"HOUSES"</span></span> columnNames=<span class="hljs-string"><span class="hljs-string">"ID"</span></span> /&gt; &lt;/changeSet&gt;</code></code> <h4> <code class="hljs 1c"><code class="xml">-&lt;DATE_INCR&gt;-.xml <br> <b>DATE</b> ‚Äì <span class="hljs-built_in"><span class="hljs-built_in"></span></span>  <br> <b>DATE_INCR</b> ‚Äì      (      <span class="hljs-built_in"><span class="hljs-built_in"></span></span>.) <br> <b>DESCR</b> ‚Äì . <br> : <br> <i><span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">03</span></span>-<span class="hljs-number"><span class="hljs-number">02</span></span>--<span class="hljs-number"><span class="hljs-number">01</span></span>-initial-schema-import.xml</i> <br> <br></code> <span class="hljs-number"><span class="hljs-number">2</span></span>.   ,   <br>   (<span class="hljs-keyword"><span class="hljs-keyword"></span></span>    rollback )    . <br>   <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   ,    <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  .    , <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   . <br> <br> <span class="hljs-keyword"><span class="hljs-keyword"></span></span>     <span class="hljs-built_in"><span class="hljs-built_in"></span></span> ,  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>      PROD-,    , ,      ,   . <br> <br> <span class="hljs-number"><span class="hljs-number">3</span></span>.    ,    <br>   ‚Äî  . <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   , ,    . <br>    , <span class="hljs-keyword"><span class="hljs-keyword"></span></span>      ,     rollback.           . <br> <br> <span class="hljs-number"><span class="hljs-number">4</span></span>. ,   ,    <br> <span class="hljs-keyword"><span class="hljs-keyword"></span></span>      ,  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>    Oracle  MySQL DDL- <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   . <br>  ,  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>     , DDL-,      . <br>  ( ): <br> <br> &lt;changeSet id=<span class="hljs-string"><span class="hljs-string">"2013-03-02-initial-schema-import-1"</span></span> author=<span class="hljs-string"><span class="hljs-string">"eg"</span></span>&gt; &lt;createTable tableName=<span class="hljs-string"><span class="hljs-string">"HOUSES"</span></span>&gt; &lt;column name=<span class="hljs-string"><span class="hljs-string">"ID"</span></span> type=<span class="hljs-string"><span class="hljs-string">"BIGINT"</span></span> /&gt; &lt;/createTable&gt; &lt;addPrimaryKey tableName=<span class="hljs-string"><span class="hljs-string">"HOUSES"</span></span> columnNames=<span class="hljs-string"><span class="hljs-string">"ID"</span></span> /&gt; &lt;/changeSet&gt;</code> </h4> <code class="hljs 1c"><code class="xml">-&lt;DATE_INCR&gt;-.xml <br> <b>DATE</b> ‚Äì <span class="hljs-built_in"><span class="hljs-built_in"></span></span>  <br> <b>DATE_INCR</b> ‚Äì      (      <span class="hljs-built_in"><span class="hljs-built_in"></span></span>.) <br> <b>DESCR</b> ‚Äì . <br> : <br> <i><span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">03</span></span>-<span class="hljs-number"><span class="hljs-number">02</span></span>--<span class="hljs-number"><span class="hljs-number">01</span></span>-initial-schema-import.xml</i> <br> <br></code> <span class="hljs-number"><span class="hljs-number">2</span></span>.   ,   <br>   (<span class="hljs-keyword"><span class="hljs-keyword"></span></span>    rollback )    . <br>   <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   ,    <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  .    , <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   . <br> <br> <span class="hljs-keyword"><span class="hljs-keyword"></span></span>     <span class="hljs-built_in"><span class="hljs-built_in"></span></span> ,  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>      PROD-,    , ,      ,   . <br> <br> <span class="hljs-number"><span class="hljs-number">3</span></span>.    ,    <br>   ‚Äî  . <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   , ,    . <br>    , <span class="hljs-keyword"><span class="hljs-keyword"></span></span>      ,     rollback.           . <br> <br> <span class="hljs-number"><span class="hljs-number">4</span></span>. ,   ,    <br> <span class="hljs-keyword"><span class="hljs-keyword"></span></span>      ,  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>    Oracle  MySQL DDL- <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   . <br>  ,  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>     , DDL-,      . <br>  ( ): <br> <br> &lt;changeSet id=<span class="hljs-string"><span class="hljs-string">"2013-03-02-initial-schema-import-1"</span></span> author=<span class="hljs-string"><span class="hljs-string">"eg"</span></span>&gt; &lt;createTable tableName=<span class="hljs-string"><span class="hljs-string">"HOUSES"</span></span>&gt; &lt;column name=<span class="hljs-string"><span class="hljs-string">"ID"</span></span> type=<span class="hljs-string"><span class="hljs-string">"BIGINT"</span></span> /&gt; &lt;/createTable&gt; &lt;addPrimaryKey tableName=<span class="hljs-string"><span class="hljs-string">"HOUSES"</span></span> columnNames=<span class="hljs-string"><span class="hljs-string">"ID"</span></span> /&gt; &lt;/changeSet&gt;</code> <h4> <code class="hljs 1c"><code class="xml">-&lt;DATE_INCR&gt;-.xml <br> <b>DATE</b> ‚Äì <span class="hljs-built_in"><span class="hljs-built_in"></span></span>  <br> <b>DATE_INCR</b> ‚Äì      (      <span class="hljs-built_in"><span class="hljs-built_in"></span></span>.) <br> <b>DESCR</b> ‚Äì . <br> : <br> <i><span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">03</span></span>-<span class="hljs-number"><span class="hljs-number">02</span></span>--<span class="hljs-number"><span class="hljs-number">01</span></span>-initial-schema-import.xml</i> <br> <br></code> <span class="hljs-number"><span class="hljs-number">2</span></span>.   ,   <br>   (<span class="hljs-keyword"><span class="hljs-keyword"></span></span>    rollback )    . <br>   <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   ,    <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  .    , <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   . <br> <br> <span class="hljs-keyword"><span class="hljs-keyword"></span></span>     <span class="hljs-built_in"><span class="hljs-built_in"></span></span> ,  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>      PROD-,    , ,      ,   . <br> <br> <span class="hljs-number"><span class="hljs-number">3</span></span>.    ,    <br>   ‚Äî  . <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   , ,    . <br>    , <span class="hljs-keyword"><span class="hljs-keyword"></span></span>      ,     rollback.           . <br> <br> <span class="hljs-number"><span class="hljs-number">4</span></span>. ,   ,    <br> <span class="hljs-keyword"><span class="hljs-keyword"></span></span>      ,  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>    Oracle  MySQL DDL- <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   . <br>  ,  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>     , DDL-,      . <br>  ( ): <br> <br> &lt;changeSet id=<span class="hljs-string"><span class="hljs-string">"2013-03-02-initial-schema-import-1"</span></span> author=<span class="hljs-string"><span class="hljs-string">"eg"</span></span>&gt; &lt;createTable tableName=<span class="hljs-string"><span class="hljs-string">"HOUSES"</span></span>&gt; &lt;column name=<span class="hljs-string"><span class="hljs-string">"ID"</span></span> type=<span class="hljs-string"><span class="hljs-string">"BIGINT"</span></span> /&gt; &lt;/createTable&gt; &lt;addPrimaryKey tableName=<span class="hljs-string"><span class="hljs-string">"HOUSES"</span></span> columnNames=<span class="hljs-string"><span class="hljs-string">"ID"</span></span> /&gt; &lt;/changeSet&gt;</code> </h4> <code class="hljs 1c"><code class="xml">-&lt;DATE_INCR&gt;-.xml <br> <b>DATE</b> ‚Äì <span class="hljs-built_in"><span class="hljs-built_in"></span></span>  <br> <b>DATE_INCR</b> ‚Äì      (      <span class="hljs-built_in"><span class="hljs-built_in"></span></span>.) <br> <b>DESCR</b> ‚Äì . <br> : <br> <i><span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">03</span></span>-<span class="hljs-number"><span class="hljs-number">02</span></span>--<span class="hljs-number"><span class="hljs-number">01</span></span>-initial-schema-import.xml</i> <br> <br></code> <span class="hljs-number"><span class="hljs-number">2</span></span>.   ,   <br>   (<span class="hljs-keyword"><span class="hljs-keyword"></span></span>    rollback )    . <br>   <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   ,    <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  .    , <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   . <br> <br> <span class="hljs-keyword"><span class="hljs-keyword"></span></span>     <span class="hljs-built_in"><span class="hljs-built_in"></span></span> ,  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>      PROD-,    , ,      ,   . <br> <br> <span class="hljs-number"><span class="hljs-number">3</span></span>.    ,    <br>   ‚Äî  . <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   , ,    . <br>    , <span class="hljs-keyword"><span class="hljs-keyword"></span></span>      ,     rollback.           . <br> <br> <span class="hljs-number"><span class="hljs-number">4</span></span>. ,   ,    <br> <span class="hljs-keyword"><span class="hljs-keyword"></span></span>      ,  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>    Oracle  MySQL DDL- <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   . <br>  ,  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>     , DDL-,      . <br>  ( ): <br> <br> &lt;changeSet id=<span class="hljs-string"><span class="hljs-string">"2013-03-02-initial-schema-import-1"</span></span> author=<span class="hljs-string"><span class="hljs-string">"eg"</span></span>&gt; &lt;createTable tableName=<span class="hljs-string"><span class="hljs-string">"HOUSES"</span></span>&gt; &lt;column name=<span class="hljs-string"><span class="hljs-string">"ID"</span></span> type=<span class="hljs-string"><span class="hljs-string">"BIGINT"</span></span> /&gt; &lt;/createTable&gt; &lt;addPrimaryKey tableName=<span class="hljs-string"><span class="hljs-string">"HOUSES"</span></span> columnNames=<span class="hljs-string"><span class="hljs-string">"ID"</span></span> /&gt; &lt;/changeSet&gt;</code> <h4> <code class="hljs 1c"><code class="xml">-&lt;DATE_INCR&gt;-.xml <br> <b>DATE</b> ‚Äì <span class="hljs-built_in"><span class="hljs-built_in"></span></span>  <br> <b>DATE_INCR</b> ‚Äì      (      <span class="hljs-built_in"><span class="hljs-built_in"></span></span>.) <br> <b>DESCR</b> ‚Äì . <br> : <br> <i><span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">03</span></span>-<span class="hljs-number"><span class="hljs-number">02</span></span>--<span class="hljs-number"><span class="hljs-number">01</span></span>-initial-schema-import.xml</i> <br> <br></code> <span class="hljs-number"><span class="hljs-number">2</span></span>.   ,   <br>   (<span class="hljs-keyword"><span class="hljs-keyword"></span></span>    rollback )    . <br>   <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   ,    <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  .    , <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   . <br> <br> <span class="hljs-keyword"><span class="hljs-keyword"></span></span>     <span class="hljs-built_in"><span class="hljs-built_in"></span></span> ,  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>      PROD-,    , ,      ,   . <br> <br> <span class="hljs-number"><span class="hljs-number">3</span></span>.    ,    <br>   ‚Äî  . <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   , ,    . <br>    , <span class="hljs-keyword"><span class="hljs-keyword"></span></span>      ,     rollback.           . <br> <br> <span class="hljs-number"><span class="hljs-number">4</span></span>. ,   ,    <br> <span class="hljs-keyword"><span class="hljs-keyword"></span></span>      ,  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>    Oracle  MySQL DDL- <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   . <br>  ,  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>     , DDL-,      . <br>  ( ): <br> <br> &lt;changeSet id=<span class="hljs-string"><span class="hljs-string">"2013-03-02-initial-schema-import-1"</span></span> author=<span class="hljs-string"><span class="hljs-string">"eg"</span></span>&gt; &lt;createTable tableName=<span class="hljs-string"><span class="hljs-string">"HOUSES"</span></span>&gt; &lt;column name=<span class="hljs-string"><span class="hljs-string">"ID"</span></span> type=<span class="hljs-string"><span class="hljs-string">"BIGINT"</span></span> /&gt; &lt;/createTable&gt; &lt;addPrimaryKey tableName=<span class="hljs-string"><span class="hljs-string">"HOUSES"</span></span> columnNames=<span class="hljs-string"><span class="hljs-string">"ID"</span></span> /&gt; &lt;/changeSet&gt;</code> </h4> <code class="hljs 1c"><code class="xml">-&lt;DATE_INCR&gt;-.xml <br> <b>DATE</b> ‚Äì <span class="hljs-built_in"><span class="hljs-built_in"></span></span>  <br> <b>DATE_INCR</b> ‚Äì      (      <span class="hljs-built_in"><span class="hljs-built_in"></span></span>.) <br> <b>DESCR</b> ‚Äì . <br> : <br> <i><span class="hljs-number"><span class="hljs-number">2013</span></span>-<span class="hljs-number"><span class="hljs-number">03</span></span>-<span class="hljs-number"><span class="hljs-number">02</span></span>--<span class="hljs-number"><span class="hljs-number">01</span></span>-initial-schema-import.xml</i> <br> <br></code> <span class="hljs-number"><span class="hljs-number">2</span></span>.   ,   <br>   (<span class="hljs-keyword"><span class="hljs-keyword"></span></span>    rollback )    . <br>   <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   ,    <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  .    , <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   . <br> <br> <span class="hljs-keyword"><span class="hljs-keyword"></span></span>     <span class="hljs-built_in"><span class="hljs-built_in"></span></span> ,  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>      PROD-,    , ,      ,   . <br> <br> <span class="hljs-number"><span class="hljs-number">3</span></span>.    ,    <br>   ‚Äî  . <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   , ,    . <br>    , <span class="hljs-keyword"><span class="hljs-keyword"></span></span>      ,     rollback.           . <br> <br> <span class="hljs-number"><span class="hljs-number">4</span></span>. ,   ,    <br> <span class="hljs-keyword"><span class="hljs-keyword"></span></span>      ,  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>    Oracle  MySQL DDL- <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   . <br>  ,  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>     , DDL-,      . <br>  ( ): <br> <br> &lt;changeSet id=<span class="hljs-string"><span class="hljs-string">"2013-03-02-initial-schema-import-1"</span></span> author=<span class="hljs-string"><span class="hljs-string">"eg"</span></span>&gt; &lt;createTable tableName=<span class="hljs-string"><span class="hljs-string">"HOUSES"</span></span>&gt; &lt;column name=<span class="hljs-string"><span class="hljs-string">"ID"</span></span> type=<span class="hljs-string"><span class="hljs-string">"BIGINT"</span></span> /&gt; &lt;/createTable&gt; &lt;addPrimaryKey tableName=<span class="hljs-string"><span class="hljs-string">"HOUSES"</span></span> columnNames=<span class="hljs-string"><span class="hljs-string">"ID"</span></span> /&gt; &lt;/changeSet&gt;</code> </pre><br>  If an error occurs while adding an index, the HOUSES table will not be deleted! <br>  <i>How to avoid pain?</i>  Every change to the database schema must live in its changelog. <br><br>  Example (so correct): <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">changeSet</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2013-03-02-initial-schema-import-1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">author</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"eg"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">createTable</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tableName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"HOUSES"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">column</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ID"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"BIGINT"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">createTable</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">changeSet</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">changeSet</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2013-03-02-initial-schema-import-2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">author</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"eg"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">addPrimaryKey</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tableName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"HOUSES"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">columnNames</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ID"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">changeSet</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br><h4>  5. Path run migration script is set to </h4><br>  Look at the two commands to start the database schema migration script <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> c:/mychangelogs/ liquibase --url=jdbc:mysql://localhost:3306/liquiblog --driver=com.mysql.jdbc.Driver --username=root --password=<span class="hljs-string"><span class="hljs-string">""</span></span> --changeLogFile=db.changelog-0.1.0.xml update</code> </pre><br><pre> <code class="bash hljs">liquibase --url=jdbc:mysql://localhost:3306/liquiblog --driver=com.mysql.jdbc.Driver --username=root --password=<span class="hljs-string"><span class="hljs-string">""</span></span> --changeLogFile=c:/mychangelogs/db.changelog-0.1.0.xml update</code> </pre><br>  It seems that the second team should not roll any changes.  But this is not the case; Liquibase stores the path to the changelog file in the FILENAME column of the DATABASECHANGELOG table. <br>  In connection with this fact, at the second launch Liquibase will consider all changesets as new.  This can break your data schema! <br><br>  <i>How to avoid pain?</i>  Always run changers using relative paths from the same directory. <br><br><h4>  6. Precondition conditions do not affect the changelog checksum. </h4><br>  This is good news for those who like to make mistakes (that is, all of us, sooner or later).  Sometimes this allows you to change the conditions of the changeset application, thus ‚Äúcorrecting the past‚Äù. <br><br><h4>  7. Liquibase is not so good for frequently changing data. </h4><br>  Once we tried to migrate many of the same type, but changing from version to version of the configuration data via changelogs.  It turned out to be very sad - constantly someone from the team was wrong, the error was leaving for the test environment, it was necessary to roll back completely manually (remember the checksum of changesets?). <br>  The sad picture had to be corrected by a sober approach to the specific situation.  Liquibase was left to change the data schema, and the configuration data with each version was poured by a Groovy script, having the properties file as the source. <br><br><h4>  8. Do not trust scripts for automatic generation of changesets. </h4><br>  Liquibase can generate <br><ul><li>  changesets according to the existing database schema </li><li>  the difference that has occurred in the database compared to the existing changesets (applicable for Grails). </li></ul><br>  These amenities should be treated with caution.  This is just a little rid of the routine, no more.  All changesets must be viewed, understood and verified.  You do not want to correct the logical error (foiled by the stupid utility) who went to PROD, right? <br><br><h4>  9. Use XML, not DSL </h4><br>  Sometimes you want to ‚Äúmake life easier‚Äù and abandon XML by starting to use shorter DSL (groovy, yaml, json) <br>  All this is very good as long as you do not want to have: <br><ul><li>  Auto-complete in IDE </li><li>  Automatic verification of formal document fidelity according to the data scheme </li></ul><br>  So why refuse such useful things in favor of brevity?  Apparently, I'm not so good a programmer to give up autocompletion for the sake of a little better readability of the code. <br><br><h4>  10. Study someone else's experience. </h4><br>  Although I learned most of the points in this article from my own experience, the official guide on the best practices of using Liquibase improves the perception of the tool ( <a href="http://www.liquibase.org/bestpractices.html">link</a> ) <br><br>  Successful migrations! </div><p>Source: <a href="https://habr.com/ru/post/179425/">https://habr.com/ru/post/179425/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../179405/index.html">Management of databases 1C 8.2</a></li>
<li><a href="../179411/index.html">Stand-alone application RAP</a></li>
<li><a href="../179413/index.html">Passed DConf 2013 - Conference on the programming language D</a></li>
<li><a href="../179417/index.html">A dream for a million</a></li>
<li><a href="../179419/index.html">The Ubuntu Touch team hopes to provide pre-release of their OS, suitable for daily use, by the end of May</a></li>
<li><a href="../179429/index.html">KriyaMoney. Part 1. Introduction</a></li>
<li><a href="../179431/index.html">HabraReader 2.0 - large client update for iOS</a></li>
<li><a href="../179433/index.html">NoName Framework or How I Invented the Bike</a></li>
<li><a href="../179435/index.html">Project template with MVVM, localization and more</a></li>
<li><a href="../179441/index.html">PHP syntax hack</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>