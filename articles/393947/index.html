<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We do the expansion module for Raspberry Pi with Arduino onboard</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We have a lot of different Raspberry Pi in the Hackspace, with the help of which we teach children to program in python, make robots and various usefu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We do the expansion module for Raspberry Pi with Arduino onboard</h1><div class="post__text post__text-html js-mediator-article">  We have a lot of different Raspberry Pi in the Hackspace, with the help of which we teach children to program in python, make robots and various useful gadgets.  Of course, doing the same thing on the Arduino.  For three years of living in perfect harmony with these extremely different platforms, we have a few ideas about how to properly make a training robot, given the pros and cons of each piece of iron.  All these thoughts materialized in the new device, which will be discussed further. <br><br><img src="https://habrastorage.org/files/628/b32/a01/628b32a0158d4de0928d53c53a2289e0.JPG"><br><br>  In fact, we designed the Arduino-compatible expansion module for RPi, which contains a motor driver and a power conditioner.  It is clear that this module is a self-sufficient controller for the training robot, but it is the RPi + Arduino sandwich that demonstrates the ideologically correct approach to creating robots.  What this thing looks like, what characteristics it possesses, and where it can be applied read further. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br>  <b>A bit of history</b> <br><br>  4 years have already passed since the release of the Raspberry Pi Model B series. At one time, it was the hype around RPi that partly led us to create our hackspace.  After all, the first thing we started to do was to teach children robotics at RPi.  After the first lessons with high school students on the basis of the Ural computer school named after N.N. Krasovsky, we thought about our laboratory workshop, open to all sufferers. <br><br>  Our lessons have developed in the basic course, which was later adapted to the Arduino.  The continuation of this course should have been specific projects in which children could apply their knowledge of the work of microcontrollers and various useful components.  We have devoted a whole class of such educational projects to the creation of mobile robots, both on the basis of the Raspberry Pi and on the Arduino. <br><br>  Our first robot based on RPi was created as a guide for working with schoolchildren.  It was a two-wheeled robot, where the guys worked out work with engines and various kinds of sensors, in preparation for competitions.  The tamiya gearmotor was used as a chassis.  Engine driver served drv8833 from TI.  In the variant for the LineFollower robot there were two self-made reflection sensors.  On the upper deck of the robot was installed bezdeechnaya breadboard for 400 points. <br><br><img src="https://habrastorage.org/files/42f/981/dbb/42f981dbb44b44d6bdd6570913629bfa.jpg"><br><br>  The robot proved to be excellent, so over time the platform tried on a different body kit.  In addition to LineFollower, which we by the way call tracker in our fashion, the robot wore optical reflection sensors, ultrasonic range finders, drew a marker on whatman paper, finally controlled via wifi, transferring the image from the webcam. <br><br>  Over time, it came to the realization that the gear motor was chosen not the most popular, but also very noisy.  The body of the robot did not accommodate all the hotelok, and was not compatible with common designers.  And most importantly, the idea to make an extension module for RPi, which would save the robot from unnecessary "routine" communications and devices.  Thus began the project of a wheeled robot codenamed MR-K-1, and after it the MR-K-2.  From the very beginning we began to provide landing holes for both platforms, and below is a model of a robot with an Arduino on board. <br><br><img src="https://habrastorage.org/files/61c/10e/b02/61c10eb02727415e9f9c63334553031a.jpg"><br><br>  This is a modification for the battle, in which schoolchildren, controlling a robot via bluetooth, strive to burst balloons attached to an enemy machine.  The frame was increased, the gear motor was replaced with the common Chinese engine of yellow (and sometimes white) color.  The case was adapted for the multiplo constructor, so now it is covered with square holes.  All this took several weeks.  But the work on the expansion module was a bit long.  And the problem was not so much in the complexity of implementation, as in the lack of time, aggravated by perfectionism :) <br><br>  <b>RPiDuino expansion module</b> <br><br>  The main developer of the module was Alexander Vasiliev, the leading extremely useful blog <a href="http://alex-exe.ru/">alex-exe.ru</a> .  By the time the project started, he already had vast experience in the development of engine drivers, power stabilizers, and many other devices that are interesting for robot building.  It was decided to call the board to be called RPiDuino, for it was supposed to provide a symbiosis of Raspberry Pi and Arduino. <br><br>  So, what we decided to place on the board. <br><br>  The module was supposed to take direct control of the motor driver, servo drives, and sensors.  All this suggests the presence of a microcontroller.  And since we are doing a learning robot and this controller should be easily stitched by our students, the choice fell on the well-known atmega328 with the arduino-downloader on board.  The presence of atmega makes the module a self-sufficient controller for controlling small training robots. <br><br><img src="https://habrastorage.org/files/62a/1cf/4b6/62a1cf4b6c5e40b8a8ba1e52c2f211ae.jpg"><br><br>  Once an atmega appeared on the board, we also needed a USB-UART bridge, which we used as the CP2102.  Another sign of Arduino compatibility is the familiar connectors on the sides of the board, allowing the expansion modules to fit on top. <br><br>  The module must control the engines, so the appropriate driver appeared.  Modern drivers have become completely microscopic in size, so that they can easily fit on the board without much damage to the neighboring components.  We chose Pololu DRV8833, as there was already some experience with them.  Two-channel driver, with a working channel current - 1A. <br><br><img src="https://habrastorage.org/files/0b2/a99/c62/0b2a99c625bc40e48aa2892c758b4a62.jpg"><br><br>  Finally, a voltage regulator was simply necessary on the board.  Initially it was supposed to make separate power supply for the computational part and for servo drives, but we had some minor problems with the layout.  So there is only one stabilizer LM2596 that feeds the RPi, the microcontroller, the logical part of the engine driver and the sensors. <br><br><img src="https://habrastorage.org/files/3ee/7d5/b93/3ee7d5b9391142108c75e8051131211a.jpg"><br><br>  Also, the power switching button and the buzzer have found their place on the board, with the help of the latter the robot complains about its problems. <br><br><img src="https://habrastorage.org/files/8e3/652/1a2/8e36521a217a45c39c658741419920af.jpg"><br><br>  RPiDuino is inserted into the GPIO connector of the Raspberry Pi, like all modules similar to it.  Communication atmega328 and RPi is carried out through the UART. <br><br><img src="https://habrastorage.org/files/9b3/cf3/547/9b3cf3547666454b993430df7443f1b9.jpg"><br><br>  The rest of the GPIO legs are pulled through so that they can be used at your discretion. <br><br>  <b>Table of key characteristics RPiDuino</b> <br><br><table border="1" cellpadding="3"><tbody><tr><td colspan="2">  <strong>Nutrition</strong> </td></tr><tr><td>  Supply voltage </td><td>  7.5-24V (without engine driver) <br>  7.5-10.5V (with engine driver) </td></tr><tr><td>  Input current </td><td>  From 0.5 to 4A, depends on the load, voltage, motor driver </td></tr><tr><td colspan="2">  <strong>Voltage regulator</strong> </td></tr><tr><td>  Output voltage </td><td>  5B </td></tr><tr><td>  Output current: working / maximum / peak </td><td>  1.5A / 2A / 3A </td></tr><tr><td>  Output voltage ripple </td><td>  one% </td></tr><tr><td>  Power connector </td><td>  5.5x2.1mm and terminal strip </td></tr><tr><td colspan="2">  <strong>Engine driver</strong> </td></tr><tr><td>  Supply voltage </td><td>  2.7-10.5V </td></tr><tr><td>  Current per channel worker / peak </td><td>  1A / 2A </td></tr><tr><td>  PWM frequency </td><td>  50kHz </td></tr><tr><td colspan="2">  <strong>Dimensions</strong> </td></tr><tr><td>  Dimensions </td><td>  85x56x22mm <br>  85x56x33mm (with connector for RaspberryPi) <br></td></tr><tr><td>  Weight </td><td>  49g </td></tr></tbody></table><br><br>  <b>Remote-controlled robot based on RPi + RPiDuino</b> <br><br>  A good demonstration of the capabilities of the RPi is a remote-controlled robot.  It can show the coordinated work of RPi and Arduino, where the older platform is engaged in video signal processing and the user interface, while the second performs its routine robot tasks. <br><br><img src="https://habrastorage.org/files/a1c/00e/e3f/a1c00ee3fdcb40c08bc56e05b958d511.jpg"><br><br>  Now on the robot is a webcam with hardware support for mjpg compression, connected to Raspberry via USB.  The robot clings to WiFi via the TL-WN722N USB router.  Engines are reinforced, with a ratio of 1: 120.  The wheels are large with soft rubber to cling to the linoleum in our hackspace.  Encoders on the engines help to level the spread in the engines.  All this is powered by two LiIon 18650 battery. <br><br>  <b>How it all works</b> <br><br>  On RPiDuino, a program is spinning, which listens to commands from the UART for movement and sends back some telemetry.  In my projects I use the <a href="https://github.com/oevsegneev/arduino-dev/tree/master/libs/SerialFlow">SerialFlow</a> library written for my first quadcopter.  <a href="https://github.com/oevsegneev/arduino-dev/tree/master/sketches/mbot_ctrl_enc_pid">The program code for RPiDuino</a> can also be found on github. <br><br>  On the Raspberry Pi side, things are a bit more complicated.  First, the robot is controlled via a web interface, so I had to raise a small python web server.  The control screen has arrows for setting the direction of motion, a speed controller, telemetry, and a window for displaying the stream from the webcam.  For video transmission, I traditionally use mjpg-streamer. <br><br>  If you want to repeat something similar in your robot, the installation algorithm will be as follows. <br>  1) Install mjpg-streamer, and set up the transmission of the video stream to http. <br>  2) Install the pyserial package. <br>  3) Download and unpack the archive with the server part of the control program. <br>  4) Fill the control sketch with RPIDuino. <br>  5) Configure wifi on RPi. <br>  6) Configure autorun control program on RPi. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/OVygX6h2HSk%3Ffeature%3Doembed&amp;xid=17259,1500002,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiSMX1sK61uW1N2ZYdOzm8UVpuY-w" frameborder="0" allowfullscreen=""></iframe><br><br>  <b>RPiDuino and ROS</b> <br><br>  Another reason why we need this expansion module is the opportunity to show our students the correct concept of robots.  Now it sounds like this: ‚ÄúLook, guys, the robot has a main computer that manages complex calculations.  It can recognize images, build a map using lidar and SLAM.  All this takes him a lot of resources, so that he can no longer control the wheels of the ground robot, and God forbid, by stabilizing the quadrocopter in flight.  For these operations, there is another computer at the level of the spinal cord that specializes in specific simple tasks and is not distracted by anything else.  These two computers are connected by a data bus, over which they communicate with each other and other modules. ‚Äù <br><br>  This is where the concept of ROS comes up.  In this case, the core of the system is spinning on RPi, and RPiDuino is the ROS node.  By the way, we have already made a small package for managing RPIDuino via ROS.  Soon we will publish a separate article on this topic. <br><br>  <b>What's next?</b> <br><br>  Beta version of the module proved to be worthy.  Now a small number of boards can be obtained in our <a href="https://habrahabr.ru/company/makeitlab/">hackspace</a> , write to the person who is interested.  We are planning to create the next version, with new engine drivers, with an additional display and some other buns.  Sources of fees will certainly be published.  We will be glad to any criticism and participation! </div><p>Source: <a href="https://habr.com/ru/post/393947/">https://habr.com/ru/post/393947/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../393937/index.html">Google is looking for pilots for unmanned vehicles</a></li>
<li><a href="../393939/index.html">The author of the YouTube channel was tired of waiting for Google‚Äôs reward for the number of subscribers, smelted it himself and made a video about it.</a></li>
<li><a href="../393941/index.html">Game of Thrones in numbers</a></li>
<li><a href="../393943/index.html">The origami robot needs to be swallowed: in the stomach it will unfold and start working.</a></li>
<li><a href="../393945/index.html">LiteManager remote control of Windows with Linux, Mac OS, Android and IOS</a></li>
<li><a href="../393949/index.html">"Nuclear" train: Barzhusin nuclear missile system with intercontinental ballistic missiles</a></li>
<li><a href="../393951/index.html">Liberty Reserve creator was given 20 years in prison</a></li>
<li><a href="../393959/index.html">How the InfoWatch spy femtocell works to intercept mobile phones in the office</a></li>
<li><a href="../393961/index.html">Where does SpaceX keep all rocket stages that have returned?</a></li>
<li><a href="../393963/index.html">Apple doesn't know why iTunes deletes user files.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>