<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple plan-fact analysis in Power BI Desktop. Part One - Consolidation and Data Cleansing</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="UPD: Updated the publication in connection with the release of Power BI Desktop from the Preview stage on July 24. 

 Today I want to tell you about b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">ğŸ”</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">ğŸ“œ</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">â¬†ï¸</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">â¬‡ï¸</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple plan-fact analysis in Power BI Desktop. Part One - Consolidation and Data Cleansing</h1><div class="post__text post__text-html js-mediator-article"> <i>UPD: Updated the publication in connection with the release of Power BI Desktop from the Preview stage on July 24.</i> <br><br>  Today I want to tell you about building a simple dashboard with a plan-actual analysis of income and expenses in <a href="https://powerbi.microsoft.com/desktop">Power BI Desktop</a> and <a href="https://powerbi.microsoft.com/">Power BI</a> .  In the first part, we will work with queries, learn how to combine data from several sources and perform their cleaning. <br><br>  <b>Baseline data:</b> several Excel files that store information on the company's income and expenditure indicators over time.  Since the form of reports and accounting items changed several times, the information sheets have a similar, but not quite the same structure.  At the exit, you need to get something that will allow managers to get an idea of â€‹â€‹what is happening with the company's finances. <br>  Let's take a look at how Power BI Desktop allows you to combine data and visualize it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/74b/302/516/74b3025165dc49f9aa44a9f51b93c9ed.png" alt="Start window Power BI Desktop"><br>  <i>Figure 1. Power BI Desktop start window</i> <br><br><a name="habracut"></a><br>  When launching, Power BI Desktop asks you to specify a data source or select one of the recent sources.  By the way, about the sources - it is possible to connect to a large number of them, including online and local sources.  For example, Google Analytics.  In our case, all reports are stored in the same folder, so we will select â€œFolderâ€ as the source.  This choice will allow you to add new reports to this folder in the future and load their data for analysis by pressing the â€œUpdateâ€ button. <br><br><img src="https://habrastorage.org/files/aa5/275/beb/aa5275beb79c46bc9cf8e7d5eb78d0af.png" alt="Select data source"><br>  <i>Figure 2. Select data source</i> <br><br>  After clicking the "Connect" button, a preview of the query results to the data source is displayed.  You can load the data â€œas isâ€ or switch to the request editing mode by clicking on the â€œEditâ€ button.  In most cases, the query results need to be processed. <br><br><img src="https://habrastorage.org/files/6a5/124/1d0/6a51241d069b4913a2adee45075663ba.png" alt="Preview query results"><br>  <i>Figure 3. Preview query results</i> <br><br>  After clicking the â€œChangeâ€ button, the â€œQuery Editorâ€ window automatically opens, in which you can and should perform data cleaning and preparation. <br><br><img src="https://habrastorage.org/files/6fc/581/ec9/6fc581ec962d4c11b0b302de2df97f38.png" alt="Query Editor Window"><br>  <i>Figure 4. Query Editor Window</i> <br><br>  As you can see in the screenshot, Power BI Desktop loaded the files from the folder and basic meta-information.  Remove all columns except â€œContentâ€, â€œNameâ€ and â€œExtensionâ€.  Since the file name shows the year to which the corresponding report relates, we use it for that. <br>  If you click on any line in the "Content" column, Power BI Desktop will open the contents of the corresponding book.  Please note that in the "Query Parameters" section, all completed steps are recorded and can be changed or deleted.  If you open the Advanced Editor window, a window will open in which the program code for all the actions performed will be visible.  Yes, Power BI Desktop has its own programming language â€œMâ€ and this is very cool. <br><br><img src="https://habrastorage.org/files/44f/e8a/71f/44fe8a71ffc6479eab90a6d7291e0fd0.png" alt="Advanced Query Editor"><br>  <i>Figure 5. Advanced Query Editor</i> <br><br>  Since the report requires the contents of all Excel files in the folder, not just one, I will delete the last two steps and use some of the â€œMâ€ functions to parse the contents of the Excel workbooks from the folder. <br>  Before further processing of data, it is also necessary to take into account that not only Excel files can be loaded into the folder.  Therefore, you need to apply a filter to the column â€œExtensionâ€, which will eliminate unnecessary file types. <br><br><img src="https://habrastorage.org/files/f71/900/485/f7190048574d49ed82ba9d63c0c887d6.png" alt="Applying filter"><br>  <i>Figure 6. Applying a filter</i> <br><br>  Now you need to "extract" the contents of Excel workbooks.  To do this, I will add a new column using the Excel.Workbook function, which allows you to â€œextractâ€ the contents of your Excel workbooks.  The new column contains the values â€‹â€‹of the type "Table", which allows you to "expand" its contents into several other columns.  When "deploying" you can choose which columns will be displayed.  In this case, the semantic load is carried by the columns â€œDataâ€ and â€œItemâ€ <br><br><img src="https://habrastorage.org/files/b86/9f8/cf3/b869f8cf3c3a4b669f45856dbf6cb238.png" alt="Add custom column"><br>  <i>Figure 7. Adding a custom column</i> <br><br>  The â€œDataâ€ column contains data from Excel sheets, and I use â€œNameâ€ and â€œItemâ€ for timestamps. <br>  Since the â€œNameâ€ column contains data of the form yyyy.xlsx, where yyyy is the year of the report, we will perform a simple operation to separate the data in the column.  Separation can be performed both by the number of characters and by separator.  In this case, the column must be divided by separator. <br><br><img src="https://habrastorage.org/files/996/a61/66a/996a6166a42d45a394e5fa691e81e980.png" alt="Column split"><br>  <i>Figure 8. Split a column</i> <br><br><img src="https://habrastorage.org/files/32f/ddf/b4e/32fddfb4e62a4925bfab786ae55bb79e.png" alt="Split Column Settings Window"><br>  <i>Figure 9. Column split settings window</i> <br><br>  After splitting the column, you will need to rename it. <br><br><img src="https://habrastorage.org/files/32f/ddf/b4e/32fddfb4e62a4925bfab786ae55bb79e.png" alt="Split Column Settings Window"><br>  <i>Figure 9. Column split settings window</i> <br><br><img src="https://habrastorage.org/files/d6e/5ce/680/d6e5ce680124424391df898627fc5b03.png" alt="Prepared for deployment request"><br>  <i>Figure 10. Prepared for "deployment" request</i> <br><br>  Then I â€œunwrapâ€ the Data column and see the contents of all the files and Excel sheets, while in a form that is unsuitable for constructing final reports.  But I can use the Power BI Desktop features to clean the data. <br><br><img src="https://habrastorage.org/files/151/bf9/281/151bf9281a804d3ab09e2d27c6ff5fd7.png" alt="Request after file content deployment"><br>  <i>Figure 11. Query after â€œdeployingâ€ file contents</i> <br><br>  1. Use the top rows as headers and then rename the columns.  I will delete the columns â€œActual deviationâ€ and â€œDeviation in%â€.  Further we will recalculate them. <br>  2. Delete the rows that contain empty values â€‹â€‹and the value "Indicator" in the column "Indicator", applying filtering.  In the same way, I delete the lines that contain total values, for example, â€œTotal Chodâ€, â€œTotalâ€, etc. <br><br><img src="https://habrastorage.org/files/1fb/94a/278/1fb94a278c8f48f69bc5f27df3838cff.png" alt="Data Filtering Menu"><br>  <i>Figure 12. Data filtering menu</i> <br><br>  3. Using the function "Replace values" I will replace synonyms, for example, "Income" and "Incomes". <br><br><img src="https://habrastorage.org/files/2bd/26b/9a7/2bd26b9a79d9486bbc6b3c81f10dbd98.png" alt="Replacing values"><br>  <i>Figure 13. Replacing values</i> <br><br>  4. After a little more study of the contents of the â€œIndicatorâ€ column, I find that all my income relates to the indicator â€œIncomeâ€ or â€œIncomeâ€.  Everything else relates to costs, which greatly facilitates the task.  For convenience, further processing and filtering create a column â€œCategoryâ€, which will contain the value â€œIncomeâ€ if the word â€œIncomeâ€ is present in the â€œIndicatorâ€ column, and in all other cases it will assume the value â€œExpenseâ€. <br><br><img src="https://habrastorage.org/files/37b/5c7/86d/37b5c786d42340ada719109d2f446018.png" alt="Adding a Category column"><br>  <i>Figure 14. Adding a Category column</i> <br><br>  5. Next, I need to specify that the type of values â€‹â€‹in the â€œPlanâ€ and â€œFactâ€ columns is a decimal number.  But before that, I need to remove spaces from the contents of these columns. <br>  6. After performing the operation, I check the columns for errors and negative values.  Since in our case the presence of a negative value means an input error, using the value conversion function, I select the absolute value in the â€œPlanâ€ and â€œFactâ€ columns.  This completes the basic data cleaning. <br>  7. In order to display indicators with a time reference, you must specify a date for each record.  The table contains the month in text form and year.  For convenience, we assume that the data is displayed at the end of each month.  Here we have a problem - the language â€œMâ€ does not allow us to convert the names of the months into dates at the moment.  Therefore, you will need to take a few intermediate steps. <br>  8. Create a new query that will contain the names of the months and their numbers.  To do this, create an empty query, open the advanced editor and paste the following code: <br> <code>let <br> Source = {"", "", "", "", "", "", "", "", "", "", "", ""}, <br> #"Converted to Table" = Table.FromList(Source, Splitter.SplitByNothing(), null, null, ExtraValues.Error), <br> #"Added Index" = Table.AddIndexColumn(#"Converted to Table", "Index", 0, 1), <br> #"Added to Column" = Table.TransformColumns(#"Added Index", {{"Index", each List.Sum({_, 1})}}), <br> #"Renamed Columns" = Table.RenameColumns(#"Added to Column",{{"Column1", ""}}) <br> in <br> #"Renamed Columns" <br></code> <br><br><img src="https://habrastorage.org/files/775/063/35e/77506335ed5f4f79889f59e35b3b34f7.png" alt="Adding an empty query"><br>  <i>Figure 15. Adding an empty query</i> <br><br>  9. I turn to the query â€œPlan-Factâ€ and combine the queries by selecting the desired type of union. <br><br><img src="https://habrastorage.org/files/4b9/222/ec2/4b9222ec284c4b719597824abd49cb6e.png" alt="Join requests"><br>  <i>Figure 16. Merge Queries</i> <br><br>  10. The data from the â€œMonthsâ€ query was added as a new column.  I open it and now we have all the data for the formation of the date.  I create a new column with the name â€œDateâ€ using the formula: = Date.EndOfMonth (#date ([Year], [Index], 1)) The column has been added and it contains the last day of each month.  In order for Power BI Desktop to group dates by months and years, you will need to explicitly set the â€œDateâ€ type <br><br><img src="https://habrastorage.org/files/5a3/0b3/839/5a30b3839ff247aca49f2a5b37f7e213.png" alt="Adding a Date column"><br>  <i>Figure 17. Adding the Date column</i> <br><br>  11. Remove the Index, Year, and Month columns.  We don't need them anymore.  Then you need to click on the "Close and Load" button to proceed to the modeling and visualization of data. <br><br>  At this point, the basic part of data processing is completed and you can proceed to visualization.  The possibilities of data visualization in Power BI Desktop will be discussed in the <a href="http://habrahabr.ru/post/264223/">next section</a> . </div><p>Source: <a href="https://habr.com/ru/post/262655/">https://habr.com/ru/post/262655/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262645/index.html">Firefox blocks Adobe Flash Player plugin</a></li>
<li><a href="../262647/index.html">"Pimp my game", or how to "pump over" games without API</a></li>
<li><a href="../262649/index.html">[ABAP] Learn to use FOR ALL ENTRIES IN correctly</a></li>
<li><a href="../262651/index.html">Synth synthesizing on the example of Korg Monotron</a></li>
<li><a href="../262653/index.html">How beautiful to issue a publication on HabrÃ©</a></li>
<li><a href="../262657/index.html">Open design universal microcontroller module</a></li>
<li><a href="../262659/index.html">Starting a passive income source on the Raspberry Pi: Masternoda Dash</a></li>
<li><a href="../262661/index.html">Microsoft released a set of updates for its products, July 2015</a></li>
<li><a href="../262663/index.html">A bug in Land Rover software leads to spontaneous unlocking of doors.</a></li>
<li><a href="../262665/index.html">Guide for porting Marmalade-based applications to the Windows 10 platform</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>