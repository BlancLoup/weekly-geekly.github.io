<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Machine in St. Petersburg - operator in Moscow</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Long intro 



 In the past, we tested HD FPV with our favorite Virturilka as a video source. Then the tests showed that everything is fine, the first...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Machine in St. Petersburg - operator in Moscow</h1><div class="post__text post__text-html js-mediator-article"><h4>  Long intro </h4><br><br><img src="https://habrastorage.org/getpro/habr/post_images/bd6/10b/518/bd610b518ccab285f98a15c141b6bd27.jpg" width="900"><br><br>  In the <a href="http://habrahabr.ru/company/virt2real/blog/218611/">past,</a> we tested HD FPV with our favorite Virturilka as a video source.  Then the tests showed that everything is fine, the first-person view of model management is quite a real deal.  The main thing - would be a normal communication channel.  While the HDMI input is for Virtualka in the production process (by the way, there is already the <a href="http://www.g0l.ru/blog/n3946">first test sample</a> , but the driver is not yet ready), we decided to look for more options for the organization of the communication channel.  In the comments a lot of humor was on the topic of 4G, so we thought - why not? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  In general, Virturilka was installed on the machine (low-speed, but all-wide Chinese crawler), connected instead of the standard RC-receiver.  In Virtual Virtku a modem is plugged from an unnamed company (but everyone understands that this is Yota <img src="https://habrastorage.org/getpro/habr/post_images/8b8/169/d47/8b8169d4770c3aaff25b8127681018c1.gif">  ).  There are four PWM channels onboard on Virtualvrika, so that it can immediately ‚Äúout of the box‚Äù function as an onboard RC receiver for four channels.  To control the machine usually need only two channels, so that even a search is obtained.  Virtual Server runs a command server with the proud name rcboard, which I have been doing the past few days.  Softinka turned out pretty cool, but I will not publish until I clean out some shoals (as without them). <br><br>  On the control side is an application that takes a signal from any Windows joystick.  Since most RC apps (control equipment, remote, in short) have a coaching connector, you can connect this same app to your computer using a USB adapter.  As a result, the app is seen by the operating system as an ordinary joystick.  By the way, under Linux, everything is much simpler in terms of programming, but under Windows I had to learn the unknown C #.  In short, the .Net application is launched on the control side, which processes the specified joystick and sends packets to the Virturile. <br><br>  As in our case, Virtuirlka goes on the Internet through Yota - the question arose how to send commands to it.  Commands go via UDP (I advise everyone - only UDP, no TCP TCP), while Yota has no white ip.  White ip can be connected to a legal entity (400 rubles per month).  We can connect as there is a legal entity, but this is completely non-kosher.  So there was a way to send commands on board without a white IP address.  A method known as UDP Hole Punching.  More precisely, a simplified version of this method.  Since in this topic I just want to show the test results, so to speak, for the seed, let's postpone the implementation details a bit, because I want to add a full-fledged jupe hole panching for any control method, but now I need a white ip on the control side. <br><br>  I would also like to speak about the type of management.  The same Parrot ArDrone is controlled from a tablet / smartphone.  Our devices (which are based on Virturilka) are controlled by many from a tablet / smartphone.  But this does not mean that this kind of control is good.  Honestly, this is the most crappy kind of control.  When controlling anything, you need to feel the controls in order to look only at the picture from the camera and not think ‚Äúbut did I hit the virtual joystick with my finger‚Äù.  So there‚Äôs nothing better than the usual PC apps.  Is that USB steering wheel / pedals, they are also supported by my soft (by itself, it's just an ordinary joystick).  For cars, it is the steering wheel and pedals - the most nishtyag. <br><br><h4>  How is it done </h4><br><br>  And now in the case.  Yesterday morning I added this server of commands (which is started on Virturile), I tried it, I was surprised that it works.  He informed his colleagues and was about to go to bed.  However, one colleague was in touch and volunteered to speak the first tester.  So it was not possible to go to bed, I had to get dressed and move with the machine into the street.  I watched the machine and a colleague drove it from Peter.  Iota's signal is not very good here, so a colleague (on a mobile phone via Skype) reports that the video is on, but often crumbles.  Telemetry from the board (via the telemetry channel, the voltage of the battery and the parameters of the Yota signal are given to the steering telemetry) showed that the signal is really lousy.  But the machine was going, the video somehow went. <br><br>  By the way, about the video.  After testing HD video at a resolution of 1280x720, there is already no desire to return to the usual 640x480, so all tests are carried out in HD.  For Yota, the bitrate was reduced to one megabit, but even with one megabit, 720p looks better than 640x480. <br><br>  Encouraged by the result, a colleague ran to the nearest hobby store and bought the exact same crawler there.  Connecting to it a Virturile with test firmware is a matter of five minutes.  So after half an hour already <a href="http://habrahabr.ru/users/realizator/" class="user_link">realizator</a> went to the street, and I connected the app to my computer and tried to steer. <br><br>  It turned out that in St. Petersburg, in any case, in one residential area (this was not included in the video) and in the center of Yota it works much better than near my house in Moscow.  So I drove without problems on a typewriter, sitting in a chair six hundred kilometers away from her :-) There is no delay at all, the video does not fall apart, everything is just perfect. <br><br>  So the implementer went with the crawler to the palace square.  Well, if we carry out tests - in an interesting place :-) We didn‚Äôt think about increasing the bitrate of the video, although there is clearly a considerable amount of reserve.  So all pokatushki passed it with a stream of 1 mb / s.  At first, I was afraid to go fast, but soon I settled in and became very short of crawler speed.  Actually, with such a great video you can drive much faster.  But there are no other machines at hand yet, so let at least something. <br><br>  In general, this is what happened as a result.  The tests turned out to be random, so they shot what they had to do.  Even the recording of the stream, which under the linux normally works, under Windows, as it turned out, does not plow, it must be done differently.  So I had to record the usual webcam from the screen, plus I was recording the view from my side. <br><br><h4>  Well, the video itself </h4><br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/qG1Rkmc3jQQ%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700190,15700253&amp;usg=ALkJrhjFEQMWQvxkl3iux_EWz9HvAteTew" frameborder="0" allowfullscreen=""></iframe><br><br>  As I already wrote above, the server of commands and the screw application-rudilku will publish the other day, when I fix minor glitches.  Come to our <a href="http://forum.virt2real.ru/">forum</a> , everything will be there.  But the description of the server commands, perhaps, on a separate topic on Habr√© pull. <br><br>  PS To be honest, I did not expect that everything will turn out so well.  Yota turned out to be better than I thought of her, anyway, in St. Petersburg :-) I‚Äôm accustomed to taxiing different things, but it was very cool to drive around Palace Square and Nevsky Prospect, sitting at home in Moscow.  And most importantly - everything is based on our brainchild - Virturilki :-) <br><br>  UPD&gt; the unexpected continuation turned out.  This time, <a href="http://habrahabr.ru/company/virt2real/blog/223183/">by airplane</a> . </div><p>Source: <a href="https://habr.com/ru/post/223145/">https://habr.com/ru/post/223145/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../223131/index.html">JetBrains EdTech Hackathon results</a></li>
<li><a href="../223133/index.html">MSI S12 Netbook Review</a></li>
<li><a href="../223135/index.html">The script that handles system events with DBus</a></li>
<li><a href="../223137/index.html">Free AngularJS course from Codeschool</a></li>
<li><a href="../223143/index.html">GalaPlugin - JS / QML plugin for QtCreator</a></li>
<li><a href="../223147/index.html">ANTVR: An interesting competitor to the Ocululs Rift with a hybrid controller included</a></li>
<li><a href="../223149/index.html">Does Mail.ru have anti-spam magic algorithms?</a></li>
<li><a href="../223153/index.html">Dreamtorrent is dead. Long live Rutracker ?!</a></li>
<li><a href="../223155/index.html">Kukuruku - the most complete clone of Habrahabr</a></li>
<li><a href="../223157/index.html">Windows Cross-compile POCO for WinCE</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>