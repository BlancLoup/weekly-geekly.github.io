<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Efficient Spring Transaction Management</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day everyone! 

 Well, the end of the month is always intensive, and here we have only one day left before the start of the second stream of the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Efficient Spring Transaction Management</h1><div class="post__text post__text-html js-mediator-article">  Good day everyone! <br><br>  Well, the end of the month is always intensive, and here we have only one day left before the start of the second stream of the course <a href="https://otus.pw/8LJd/">‚ÄúDeveloper on the Spring Framework‚Äù</a> - a wonderful and interesting course that leads a no less beautiful and evil <a href="https://otus.pw/3AnN/">Yuri</a> (as some students call him for the level of requirements in DZ), so let's consider another material that we have prepared for you. <br><br>  Go. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Introduction</b> <br><br>  Most of the time, developers do not attach importance to transaction management.  As a result, either most of the code is rewritten later, or the developer implements transaction management without knowing how it should actually work or what aspects should be used specifically in their case. <br><br>  An important aspect of transaction management is determining the correct transaction boundaries, when the transaction should begin and when to end, when data should be added to the database and when it should be rolled back (in case of an exception). <br><br><img src="https://habrastorage.org/webt/qg/8n/mw/qg8nmwe4wvoqd2iuw3xv3ldpse0.png"><a name="habracut"></a><br><br>  The most important aspect for developers is to understand how to implement transaction management in the application in the best possible way.  Therefore, let's consider various options. <br><br>  <b>Transaction Management Methods</b> <br><br>  Transactions can be managed in the following ways: <br><br>  <i><b>1. Software control by writing custom code</b></i> <br><br>  This is the old way to manage transactions. <br><br><pre><code class="java hljs">EntityManagerFactory factory = Persistence.createEntityManagerFactory(<span class="hljs-string"><span class="hljs-string">"PERSISTENCE_UNIT_NAME"</span></span>); EntityManager entityManager = entityManagerFactory.createEntityManager(); Transaction transaction = entityManager.getTransaction() <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { transaction.begin(); someBusinessCode(); transaction.commit(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(Exception ex) { transaction.rollback(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> ex; }</code> </pre> <br>  <b>Pros</b> : <br><br><ul><li>  Borders of transaction are obvious in the code. </li></ul><br>  <b>Cons</b> : <br><br><ul><li>  It is repetitive and error prone. </li><li>  Any mistake can have a very big impact. </li><li>  You need to write many templates, also, if you want to call another method from this method, you need to manage it again from the code. </li></ul><br>  <i><b>2. Using Spring to manage transactions</b></i> <br><br>  Spring supports two types of transaction management <br><br>  <b>1. Software Transaction Management</b> : You must manage transactions through programming.  This method is quite flexible, but it is difficult to maintain. <br><br>  <b>2. Declarative transaction management</b> : You separate transaction management from business logic.  You use only annotations in an XML-based configuration for transaction management. <br><br>  <u><b>We strongly recommend using declarative transactions.</b></u>  <u><b>If you want to know the reasons, then read on, otherwise go directly to the section Declarative Transaction Management, if you want to implement this option.</b></u> <br><br>  Now let's look at each approach in detail. <br><br>  <i><b>2.1.</b></i>  <i><b>Software transaction management:</b></i> <br><br>  The Spring framework provides two tools for programmatic transaction management. <br><br>  a.  Using <code>TransactionTemplate</code> (recommended by the Spring team): <br><br>  Let's look at how you can implement this type using the example code below (taken from the Spring documentation with some modifications) <br><br>  <u>Note that the code snippets are from Spring Docs.</u> <br><br>  Context Xml file: <br><br><pre> <code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- Initialization for data source --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dataSource"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"driverClassName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.mysql.jdbc.Driver"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"url"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"jdbc:mysql://localhost:3306/TEST"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"username"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"root"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Initialization for TransactionManager --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"transactionManager"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dataSource"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dataSource"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Definition for ServiceImpl bean --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"serviceImpl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.service.ServiceImpl"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">constructor-arg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"transactionManager"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  <code>Service</code> class: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> TransactionTemplate transactionTemplate; <span class="hljs-comment"><span class="hljs-comment">//       PlatformTransactionManager public ServiceImpl(PlatformTransactionManager transactionManager) { this.transactionTemplate = new TransactionTemplate(transactionManager); } //       ,   ,    //       xml  this.transactionTemplate.setIsolationLevel(TransactionDefinition.ISOLATION_READ_UNCOMMITTED); this.transactionTemplate.setTimeout(30); //30  ///    public Object someServiceMethod() { return transactionTemplate.execute(new TransactionCallback() { //         public Object doInTransaction(TransactionStatus status) { updateOperation1(); return resultOfUpdateOperation2(); } }); }}</span></span></code> </pre><br>  If there is no return value, use the convenience class <code>TransactionCallbackWithoutResult</code> with an anonymous class, as shown below: <br><br><pre> <code class="java hljs">transactionTemplate.execute(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TransactionCallbackWithoutResult() { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doInTransactionWithoutResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TransactionStatus status)</span></span></span><span class="hljs-function"> </span></span>{ updateOperation1(); updateOperation2(); } });</code> </pre><br><ul><li>  Instances of the <code>TransactionTemplate</code> class are thread-safe, so not all dialog states are supported. </li><li>  <code>TransactionTemplate</code> instances nevertheless maintain a configuration state, so if a class needs to use a TransactionTemplate with different settings (for example, a different isolation level), then you need to create two different TransactionTemplate instances, although in some classes one TransactionTemplate instance can be used. </li></ul><br>  b.  Using the <code>PlatformTransactionManager</code> implementation directly: <br><br>  Let's look at this option again in the code. <br><br><pre> <code class="java hljs">&lt;!-- Initialization <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> data source --&gt; &lt;bean id=<span class="hljs-string"><span class="hljs-string">"dataSource"</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span></span>&gt; &lt;property name=<span class="hljs-string"><span class="hljs-string">"driverClassName"</span></span> value=<span class="hljs-string"><span class="hljs-string">"com.mysql.jdbc.Driver"</span></span>/&gt; &lt;property name=<span class="hljs-string"><span class="hljs-string">"url"</span></span> value=<span class="hljs-string"><span class="hljs-string">"jdbc:mysql://localhost:3306/TEST"</span></span>/&gt; &lt;property name=<span class="hljs-string"><span class="hljs-string">"username"</span></span> value=<span class="hljs-string"><span class="hljs-string">"root"</span></span>/&gt; &lt;property name=<span class="hljs-string"><span class="hljs-string">"password"</span></span> value=<span class="hljs-string"><span class="hljs-string">"password"</span></span>/&gt; &lt;/bean&gt; &lt;!-- Initialization <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> TransactionManager --&gt; &lt;bean id=<span class="hljs-string"><span class="hljs-string">"transactionManager"</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span></span>&gt; &lt;property name=<span class="hljs-string"><span class="hljs-string">"dataSource"</span></span> ref=<span class="hljs-string"><span class="hljs-string">"dataSource"</span></span> /&gt; &lt;/bean&gt; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Service</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> PlatformTransactionManager transactionManager; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setTransactionManager</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( PlatformTransactionManager transactionManager)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transactionManager = transactionManager; } DefaultTransactionDefinition def = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultTransactionDefinition(); <span class="hljs-comment"><span class="hljs-comment">//     -  ,       def.setName("SomeTxName"); def.setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRED); TransactionStatus status = txManager.getTransaction(def); try { //   -  } catch (Exception ex) { txManager.rollback(status); throw ex; } txManager.commit(status); }</span></span></code> </pre> <br>  Now, before moving on to the next method of managing transactions, let's see how to decide which type of transaction management to choose. <br><br>  Choosing between <b>Software</b> and <b>Declarative Transaction Management</b> : <br><br><ul><li>  Software transaction management is a good choice only if you have a small number of transactional transactions.  (In most cases, this is not a transaction.) </li><li>  The transaction name can be explicitly set only in Software Transaction Management. </li><li>  Software transaction management should be used when you want to explicitly monitor transaction management. </li><li>  On the other hand, if your application contains numerous transactional operations, it is worth using declarative control. </li><li>  Declarative management does not allow managing transactions in business logic and is easy to configure. </li></ul><br>  <i><b>2.2.</b></i>  <i><b>Declarative transactions (Usually used in almost all scenarios of any web application)</b></i> <br><br>  <b>Step 1</b> : Define the transaction manager in the context xml file of your spring application. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"txManager"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tx:annotation-driven</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">transaction-manager</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"txManager"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br>  <b>Step 2</b> : Enable annotation support by adding an entry in the context xml file of your spring application. <br><br>  OR add <code>@EnableTransactionManagement</code> to your configuration file, as shown below: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@EnableTransactionManagement</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppConfig</span></span></span><span class="hljs-class"> </span></span>{ ... }</code> </pre> <br>  <i><b>Spring recommends annotating only specific classes (and methods of specific classes) with the <code>@Transactional</code> annotation versus annotating interfaces.</b></i> <br><br>  The reason for this is that you place the annotation at the interface level, and if you use proxy classes ( <code>proxy-target-class = ¬´true¬ª</code> ) or intertwining aspect ( <code>mode = ¬´aspectj¬ª</code> ), then the transaction parameters are not recognized by the proxy infrastructure and plexuses, for example Transactional behavior will not apply. <br><br>  <b>Step 3</b> : Add the <b><code>@Transactional</code></b> annotation to a class (class method) or interface (interface method). <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tx:annotation-driven</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">proxy-target-class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  The default configuration is: <code>proxy-target-class="false"</code> <br><br><ul><li>  The <code>@Transactional</code> may be placed before an interface definition, interface method, class definition, or public class method. </li><li>  If you want some class methods (marked with <code>@Transactional</code> annotation) to have different attribute settings, such as isolation level or distribution level, place an annotation at the method level to override the class-level attribute settings. </li><li>  In the proxy mode (which is set by default), only ‚Äúexternal‚Äù method calls that go through the proxy can be intercepted.  This means that a ‚Äústand-alone call‚Äù, for example, a method in the target object that calls any other method of the target object, will not result in an actual transaction at run time, even if the method being called is marked with <code>@Transactional</code> . </li></ul><br>  Now let's <code>@Transactional</code> difference between the attributes of the <code>@Transactional</code> annotation <br><br> <b><code>@Transactional (isolation=Isolation.READ_COMMITTED)</code></b> <br> <br><ul><li>  <code>Isolation.DEFAULT</code> set by default. </li><li>  In most cases, you will use the default settings until you have special requirements. </li><li>  Tells the transaction manager ( <code>tx</code> ) that the next isolation level should be used for the current <code>tx</code> .  Must be installed at the point where <code>tx</code> starts from, because we cannot change the isolation level after running tx. </li></ul><br>  <b>DEFAULT</b> : Use the default isolation level in the underlying database. <br><br>  <b>READ_COMMITTED</b> (fixed data read): Constant, indicating that dirty read is prevented;  non-repetitive reading and phantom reading may occur. <br><br>  <b>READ_UNCOMMITTED</b> (read uncommitted data): This isolation level indicates that a transaction can read data that has not yet been deleted by other transactions. <br><br>  <b>REPEATABLE_READ</b> (repeatability of reading): Constant, indicating that ‚Äúdirty‚Äù reading and non-repeatable reading are prevented;  phantom reading may appear. <br><br>  <b>SERIALIZABLE</b> (orderability): Permanent, indicating that ‚Äúdirty‚Äù reading, non-repeatable reading and phantom reading are prevented. <br><br>  What do these slang mean: ‚Äúdirty‚Äù reading, phantom reading or repeated reading? <br><br><ul><li>  <b>Dirty Read</b> : Transaction ‚ÄúA‚Äù writes.  Meanwhile, transaction ‚ÄúB‚Äù reads the same record before completing transaction A. Later, transaction A decides to roll back, and now we have changes in transaction B that are incompatible.  This is a dirty read.  Transaction B worked at the isolation level READ_UNCOMMITTED, so it could read the changes made by transaction A before the transaction was completed. </li><li>  <b>Non-Repeatable Read</b> : Transaction "A" reads some records.  Then transaction ‚ÄúB‚Äù records this record and fixes it.  Later, transaction A reads the same record again and may receive different values, because transaction B made changes to this record and fixed them.  This is a non-repetitive reading. </li><li>  <b>Phantom Read (Phantom Read)</b> : Transaction "A" reads a series of records.  Meanwhile, transaction ‚ÄúB‚Äù inserts a new record in the same row as transaction A. Later, transaction A reads the same range again and also gets the record that transaction B has just inserted. This is a phantom read: the transaction has extracted a number of records several times from the database and received different result sets (containing phantom records). </li></ul><br> <code><b>@Transactional(timeout=60)</b></code> <br> <br>  The default is the default timeout for the underlying transaction system. <br><br>  Tells the tx manager about the length of time to wait for the tx downtime before deciding whether to roll back non-responding transactions. <br><br> <code><b>@Transactional(propagation=Propagation.REQUIRED)</b></code> <br> <br>  If not specified, the propagating default behavior is <code>REQUIRED</code> . <br><br>  Other options: <code>REQUIRES_NEW, MANDATORY, SUPPORTS, NOT_SUPPORTED, NEVER</code> and <code>NESTED</code> . <br><br>  <b>REQUIRED</b> <br><br>  Indicates that the target method cannot work without active tx.  If tx is already running before calling this method, then it will continue in the same tx, or the new tx will start shortly after calling this method. <br><br>  <b>REQUIRES_NEW</b> <br><br><ul><li>  Indicates that a new tx should be launched each time the target method is called.  If the tx is already coming, it will be suspended before starting a new one. </li></ul><br>  <b>MANDATORY</b> <br><br><ul><li>  Indicates that the target method requires active tx.  If tx does not continue, it will not work, throwing an exception. </li></ul><br>  <b>SUPPORTS</b> <br><br><ul><li>  Indicates that the target method can be run independently of tx.  If tx works, he will participate in the same tx.  If executed without tx, it will still be executed if there are no errors. </li></ul><br><ul><li>  Methods that retrieve data are the best candidates for this option. </li></ul><br>  <b>NOT_SUPPORTED</b> <br><br><ul><li>  Indicates that the target method does not require distribution of the transaction context. </li><li>  Basically, the methods that are executed in a transaction, but perform operations with RAM, are the best candidates for this option. </li></ul><br>  <b>NEVER</b> <br><br><ul><li>  Indicates that the target method will throw an exception if executed in a transactional process. </li><li>  This option is in most cases not used in projects. </li></ul><br> <b><code>@Transactional (rollbackFor=Exception.class)</code></b> <br> <br>  Default value: <code>rollbackFor=RunTimeException.class</code> <br><br>  In Spring, all API classes throw a RuntimeException, which means that if a method fails, the container always rolls back the current transaction. <br><br>  The problem is only proven exceptions.  Thus, this parameter can be used for declarative rollback of a transaction if a <code>Checked Exception</code> occurs. <br><br> <code><b>@Transactional (noRollbackFor=IllegalStateException.class)</b></code> <br> <br>  Indicates that a rollback should not occur if the target method raises this exception. <br><br>  Now the final, but most important step in transaction management is the placement of the <code>@Transactiona</code> l annotation.  In most cases, confusion arises where the abstract should be placed: at the service level or at the DAO level? <br><br>  <b><code>@Transactional</code> : Service or DAO level?</b> <br><br>  Service is the best place to place <code>@Transactional</code> , the service level should contain the behavior of the use case at the level of detail for user interaction, which logically goes into the transaction. <br><br>  There are many CRUD applications that do not have significant business logic, have a service level, which simply transfers data between controllers and data access objects, which is not useful.  In these cases, we can place the transaction annotation at the DAO level. <br><br>  Therefore, in practice, you can put them anywhere, it is up to you. <br><br>  In addition, if you place <code>@Transactional</code> at the DAO level and if your DAO level is reused by different services, then it will be difficult to place it at the DAO level, since different services may have different requirements. <br><br>  If your service level retrieves objects using Hibernate, and let's say you have lazy initializations in the definition of a domain object, then you need to open a transaction at the service level, otherwise you will have to face LazyInitializationException thrown by the ORM. <br><br>  Consider another example where your service level can call two different DAO methods to perform database operations.  If your first DAO operation fails, the other two can be transferred, and you end the inconsistent database state.  Annotation at the service level can save you from such situations. <br><br>  Hope this article has helped you. <br><br>  THE END <br><br>  It is always interesting to see your comments or questions. </div><p>Source: <a href="https://habr.com/ru/post/431508/">https://habr.com/ru/post/431508/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../431498/index.html">WebP will soon capture the web, but the century won't be long</a></li>
<li><a href="../431500/index.html">Databases and Kubernetes (review and video report)</a></li>
<li><a href="../431502/index.html">Conference for iOS developers Kolesa Mobile 3.0. Video report</a></li>
<li><a href="../431504/index.html">Phishing works. Chronicle of theft of the iPhone XS, followed by the theft of iCloud data</a></li>
<li><a href="../431506/index.html">Xcode and advanced debugging in LLDB: Part 1</a></li>
<li><a href="../431514/index.html">Interview for interviewers</a></li>
<li><a href="../431516/index.html">One day in the life of a Financial Advisor</a></li>
<li><a href="../431518/index.html">Microsoft Connect (); Meetup in Moscow</a></li>
<li><a href="../431520/index.html">Predict user churn using the RFM method</a></li>
<li><a href="../431524/index.html">Serialization in Java. Not so simple</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>