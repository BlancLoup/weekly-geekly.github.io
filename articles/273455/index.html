<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Implement MVVM in iOS using RxSwift</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There are countless articles about the MVVM pattern in iOS, but a little about RxSwift, and few people focus on how the MVVM pattern looks in practice...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Implement MVVM in iOS using RxSwift</h1><div class="post__text post__text-html js-mediator-article">  There are countless articles about the MVVM pattern in iOS, but a little about RxSwift, and few people focus on how the MVVM pattern looks in practice and how to implement it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b7e/7d4/024/b7e7d40241354d4c6bfbe7e366fb304f.jpg" alt="ReactiveX"><br><br>  ReactiveX is a library for creating asynchronous and event-based programs using the observed sequence.  - <a href="http://reactivex.io/">reactivex.io</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      RxSwift is a relatively young framework that allows " <a href="https://realm.io/news/altconf-ash-furrow-functional-reactive-swift/">reactive programming</a> ."  If you don‚Äôt know anything about it, then look around because functional reactive programming (FRP) is gaining momentum and is not going to stop. <br><a name="habracut"></a><br><h3>  So, what does MVVM look like in iOS? </h3><br>  The way to connect the model with the ViewController when using the MVC pattern often looks like a kind of hack.  You typically call something like the updateUI () function in the controller when you think the model has changed. This can lead to inconsistencies between the model and the ViewController, unnecessary updates and incomprehensible errors. <br><br>  We need a ViewController that will show the true state of the model anyway.  In fact, we need a ViewController, which will be a simple proxy server that will display data on the screen according to the current state of the model. <br><br>  Of course, in most applications it will be useless if they only display a model on the screen.  We need to get data from the model and prepare it for display.  That is why we present the <b>ViewModel</b> class.  <b>ViewModel prepares all the data that you want to display on the screen.</b> <br><br>  But the most interesting: ViewModel knows nothing about the ViewController.  It never refers to it and does not have a property directly.  Instead, ViewController constantly monitors any changes to the ViewModel, and as soon as the changes occur, they will immediately be displayed on the screen.  It should be borne in mind that the ViewController displays each property on the screen with the ViewModel individually, i.e.  if you want to load a row and an image one by one, you can display the row right away because the data is already there, and you don‚Äôt have to wait until the image is loaded to display it together. <br><br>  However, ViewController displays not only data on the screen, it also receives user input.  Since our ViewController is just a proxy server, it cannot use this data, so all it has to do is transfer it to the ViewModel, and the ViewModel will do the rest. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/072/1c6/3f3/0721c63f3aecc24f486d023592ed1977.png" alt="image"><br><br>  This is, in a sense, one-way communication between ViewController and ViewModel.  The ViewController can see and access the ViewModel, but the ViewModel has no idea what the ViewController is.  This means that you can completely remove the ViewController from your application, and all your logic will work as intended! <br><br>  <i>It all sounds great, but how do we do it?</i> <br><br><h3>  MVVM in conjunction with RxSwift </h3><br>  Let's make a simple application that displays the weather forecast in a city that a user enters. <br><br>  <i>This article assumes that you are familiar with RxSwift.</i>  <i>If you do not know anything about him, then boldly read on, but I suggest learning more about <a href="http://reactivex.io/">ReactiveX</a> .</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2a1/2e4/ed0/2a12e4ed09bb35e30e55fa2dda7b8332.png" alt="post_images"><br><br>  We have a UITextField for entering the city name and a couple of UILabels to display the current temperature. <br><br>  <b>Note:</b> <i>for this application, I will receive weather data from the <a href="http://openweathermap.org/">OpenWeatherMap</a> .</i> <br><br>  So, our model will be a Weather class with several <i>name</i> and <i>degrees</i> properties and an initializer that accepts a JSON object, which it analyzes and sets properties. <br><br><pre><code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Weather { var name:String? var degrees:Double? init(json: AnyObject) { let data = JSON(json) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.name = data[<span class="hljs-string"><span class="hljs-string">"name"</span></span>].stringValue <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.degrees = data[<span class="hljs-string"><span class="hljs-string">"main"</span></span>][<span class="hljs-string"><span class="hljs-string">"temp"</span></span>].doubleValue } }</code> </pre> <br>  <b>Note:</b> <i><a href="https://github.com/SwiftyJSON/SwiftyJSON">SwiftyJSON</a> is required to parse JSON into Swift.</i> <br><br>  Now we need to allow the ViewModel to control the model through the public (public) property of searchText, to which the ViewController will later have access. <br><br><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> ViewModel { private <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Constants { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> let URLPrefix = <span class="hljs-string"><span class="hljs-string">"http://api.openweathermap.org/data/2.5/weather?q="</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> let URLPostfix = <span class="hljs-string"><span class="hljs-string">"/* my openweathermap APPID */"</span></span> } let disposeBag = DisposeBag() var searchText = PublishSubject&lt;String?&gt;()</code> </pre><br>  Our searchText is a PublishSubject object.  Subjects are both Observable and Observer.  In other words, you can send them elements that they can regenerate. <br><br>  PublishSubjects are unique because when data is sent to the PublishSubject, it sends it to all subscribers who are currently subscribed to it.  We need this, because in MVVM, depending on the life cycle of the application, Observable in different classes can sometimes receive elements before you subscribe to them.  As soon as the ViewController subscribes to the ViewModel property, it should see that everything is in order with the last element in order to display it, and vice versa. <br><br>  Now we have to declare a property in the ViewModel for each UI element that you want to change programmatically. <br><br><pre> <code class="objectivec hljs">var cityName = PublishSubject&lt;String&gt;() var degrees = PublishSubject&lt;String&gt;()</code> </pre><br>  Let's also set a property for our model and change the properties each time our model changes.  We do this by combining the 'old-fashioned' method (Swift Property Observers) using Rx.  We will send the properties of the Weather object to our PublishSubjects so they can generate values ‚Äã‚Äãin the model. <br><br><pre> <code class="objectivec hljs">var weather:Weather? { didSet { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> let name = weather?.name { <span class="hljs-built_in"><span class="hljs-built_in">dispatch_async</span></span>(dispatch_get_main_queue()) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.cityName.onNext(name) } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> let temp = weather?.degrees { <span class="hljs-built_in"><span class="hljs-built_in">dispatch_async</span></span>(dispatch_get_main_queue()) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.degrees.onNext(<span class="hljs-string"><span class="hljs-string">"\(temp)¬∞F"</span></span>) } } } }</code> </pre><br>  <b>Note:</b> <i>We need to make sure that this is done in the main thread, since the onNext () method runs in another thread!</i>  <i>(the onNext method sends an Observer element).</i> <br><br>  Now let's attach our model to the searchText property that we declared above.  We will do this by creating an NSURLRequest every time changes are made to searchText, and then we will sign our model to that request.  We do this in the init () method, because we know that all our properties are set when the init () method is called. <br><br><pre> <code class="objectivec hljs">init() { let jsonRequest = searchText .map { text <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">NSURLSession</span></span>.sharedSession().rx_JSON(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.getURLForString(text)!) } .switchLatest() jsonRequest .subscribeNext { json <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.weather = Weather(json: json) } .addDisposableTo(disposeBag) }</code> </pre><br>  Thus, each time the searchText is changed, jsonRequest changes itself to the corresponding NSURLRequest.  Every time it changes, our model receives the data we received from NSURLRequest. <br><br>  <b>Note:</b> <i>The rx_JSON () method is actually an observable sequence.</i>  <i>Thus, jsonRequest is actually Observable from Observable.</i>  <i>This is why we use .switchLatest (), which ensures that jsonRequest only returns a new sequence.</i>  <i>Also keep in mind that the request will not begin sampling until you subscribe to it.</i> <br><br>  Now it remains to connect the ViewController with the ViewModel.  We will do this by binding PublishSubjects in the ViewModel to the outlet in the Controller. <br><br><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> ViewController: <span class="hljs-built_in"><span class="hljs-built_in">UIViewController</span></span> { let viewModel = ViewModel() let disposeBag = DisposeBag() @IBOutlet <span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> var nameTextField: <span class="hljs-built_in"><span class="hljs-built_in">UITextField</span></span>! @IBOutlet <span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> var degreesLabel: <span class="hljs-built_in"><span class="hljs-built_in">UILabel</span></span>! @IBOutlet <span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> var cityNameLabel: <span class="hljs-built_in"><span class="hljs-built_in">UILabel</span></span>! override func viewDidLoad() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLoad() <span class="hljs-comment"><span class="hljs-comment">//Binding the UI viewModel.cityName.bindTo(cityNameLabel.rx_text) .addDisposableTo(disposeBag) viewModel.degrees.bindTo(degreesLabel.rx_text) .addDisposableTo(disposeBag) } }</span></span></code> </pre><br>  Don't forget that we also need to make sure that our ViewModel knows what the user entered in the text field!  We can do this by sending the nameTextField value, each time it changes, to the searchText property of the ViewModel.  So we just add this in the viewDidLoad () method: <br><br><pre> <code class="objectivec hljs">nameTextField.rx_text.subscribeNext { text <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.viewModel.searchText.onNext(text) } .addDisposableTo(disposeBag)</code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/623/0dd/c5d/6230ddc5d662da907cc33a6fd3a54d50.png" alt="image"><br><br>  <b>Like this!</b>  Now the application receives weather data, while the user enters the name of the city, and no matter what the user sees, the true state of the application remains hidden. <br><br>  If you are interested in the enhanced version of this app, see my example of a weather app on <a href="https://github.com/marinbenc/ReactiveWeatherExample">Github</a> . </div><p>Source: <a href="https://habr.com/ru/post/273455/">https://habr.com/ru/post/273455/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../273445/index.html">Angular2 is now "beta"</a></li>
<li><a href="../273447/index.html">Tectograms - a new generation of mayndmap</a></li>
<li><a href="../273449/index.html">Introduction to model conversion (or the transformation that creates the transformation that the model creates)</a></li>
<li><a href="../273451/index.html">Commentary to "How to get to the president's dacha at five in the morning"</a></li>
<li><a href="../273453/index.html">New features call history reports (CDR)</a></li>
<li><a href="../273467/index.html">In workshops, start-up platforms, or what you need to get money from an investor</a></li>
<li><a href="../273469/index.html">Release DataGrip (ex-0xDBE) 1.0 - New IDE for SQL</a></li>
<li><a href="../273471/index.html">A collection of practical tips and notes on the layout</a></li>
<li><a href="../273473/index.html">PowerShell, AWS CLI and json</a></li>
<li><a href="../273477/index.html">Symfony2 Voters and Doctrine Filters on guard for security</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>