<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MODx Revo workflow. Workflow organization, version control and deployment</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="All the main elements of the MODX system, such as chunks, templates, snippets, etc., are stored in the database, from which there arises the problem o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MODx Revo workflow. Workflow organization, version control and deployment</h1><div class="post__text post__text-html js-mediator-article">  All the main elements of the MODX system, such as chunks, templates, snippets, etc., are stored in the database, from which there arises the problem of controlling the versions for these elements, as well as the difficulty of separating the site‚Äôs <i>development</i> and <i>production</i> versions. <br><br>  I will give the basic requirements of what I want from my workflow on MODX Revo: <br><ul><li>  version control wherever I write some code (html, css, js, php), </li><li>  have a separate <i>dev-</i> version of the site on which the current development is conducted, and after that - deploy all changes to production, and, preferably, automate this process, </li><li>  at least kopipasta when developing and deploy. </li></ul><br><a name="habracut"></a><br><br><h2>  Content </h2><br><ol><li>  <a href="https://habr.com/ru/post/347538/">Introduction</a> </li><li>  <a href="https://habr.com/ru/post/347538/">Development and Production version of the site</a> </li><li>  <a href="https://habr.com/ru/post/347538/">Version control</a> </li><li>  <a href="https://habr.com/ru/post/347538/">Scheme of work</a> </li><li>  <a href="https://habr.com/ru/post/347538/">Depla</a> </li><li>  <a href="https://habr.com/ru/post/347538/">Conclusion</a> </li><li>  <a href="https://habr.com/ru/post/347538/">Links</a> </li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="intro"></a><br><h2>  Introduction </h2><br>  At the time of this writing, I had a web development experience of just over a year.  I was lucky, I began my journey in this area with MODX Revo, but despite all the advantages of this framework, over time I began to face minuses.  So far, I have not worked in a team on large complex projects and I don‚Äôt know how people usually cope with the above difficulties.  I did not find any specific solution on the Internet, and this contributed to the creation of my workflow, which I want to present in this article.  Immediately make a reservation, I did not come up with anything fundamentally new, but simply gathered pieces of information scattered on the Internet into one guide on how to arrange my workflow when working with MODX Revolution. <br><br>  What we need. <br>  - git <br>  - npm + Gulp <br>  For work, I use IDE PHPStorm. <br><br><a name="dev-prod"></a><br><h2>  Development and Production version of the site </h2><br>  The first thing that comes to mind when you think about how to organize a working (test, <i>dev</i> ) and release (combat, <i>prod</i> ) version of a site is just to have two copies of it.  At first we are developing on a test site, and after approval by the manager or client, we transfer everything to the combat one.  Simple and clear, only this process can turn into a nightmare, because  everything is done manually and there is a considerable probability of an error during the transfer, then you have to check what you did wrong, and then it turns out that the combat site does not fully correspond to the test site and you need to edit something else, etc.  etc.  No, we do not need this. <br><br>  I will not argue for a long time and I will say at once, I suggest using one instance of the site in which we will use the MODX Revo context mechanism.  The standard <i>web</i> context will contain the release version of the site.  Plus we will create another <i>dev</i> context, the work with which will be moved to the subdomain.  So we need to: <br>  - <i>example.com</i> domain running in the context of the <i>web</i> <br>  - subdomain <i>dev.example.com</i> , working in the context of <i>dev</i> <br>  With a delay, I need the changes made in the context of <i>dev</i> to be merged into the <i>web</i> in any way. <br><br><h4>  Create context dev </h4><br>  This part of the work starts from the moment when you have already installed the engine and the necessary components and configured domain names, i.e.  when accessing both addresses <i>example.com</i> and <i>dev.example.com</i> , the same MODX start page is opened (the root directory of both domains is shared). <br><br>  Now go to the admin panel ‚Üí system settings ‚Üí contexts and create a new context.  Key, enter <i>dev</i> , name - whatever you like, I called <i>Development</i> .  In the context menu on the left you will have a new context.  First, create a resource for it, and then go to the context settings (right-click on context ‚Üí edit ‚Üí context settings) and set the settings <br>  - <i>site_start</i> <br>  - <i>error_page</i> <br>  - <i>unauthorized_page</i> , <br>  indicating in them the ID of the created resource.  This is necessary so that the system does not fall with an error if, when working in the context of <i>dev,</i> no page is found. <br> <a href=""><img src="https://habrastorage.org/webt/pw/j-/hf/pwj-hfzxtykafli96uyuz-wr7ae.png"><br></a> <br>  <i>approx.</i>  <i>I created the dev (Development) context and renamed the standard Website context to Production, the key of the standard context remained the same - web.</i> <br><br>  Now in the <i>core / elements / common / plugins /</i> folder (create the necessary folders) create the <i>switchContext.php</i> file with the following contents <br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> modX $modx */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* don't execute if in the Manager */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($modx-&gt;context-&gt;get(<span class="hljs-string"><span class="hljs-string">'key'</span></span>) == <span class="hljs-string"><span class="hljs-string">'mgr'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_HOST'</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'dev.example.com'</span></span>: $modx-&gt;switchContext(<span class="hljs-string"><span class="hljs-string">'dev'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'example.com'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: $modx-&gt;log(modX::LOG_LEVEL_ERROR, <span class="hljs-string"><span class="hljs-string">'Check this plugin! May be your headache coming from here.'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br>  I will explain what the plugin does.  When working with the site through the admin panel, i.e.  in the context of <i>mgr</i> , does nothing.  When working with the front part of the site on the domain <i>dev.example.com,</i> the context switches to <i>dev</i> .  When working on the front end on the main domain, it also does nothing.  But if the execution of the script somehow falls into <i>default</i> , it displays an error in the log.  This can happen, for example, when transferring a site to a new domain name, and this message is intended to make life easier for the developer who will understand why, after the transfer, nothing works.  When I checked the scheme of work on the remote server described here, I just forgot to fix the domain names in this plugin and by mistake in the log I immediately understood what was wrong.  Once again he said ‚ÄúThank you‚Äù to himself. <br><br>  Please note that at the very end of the plug-in file, you must put a <i>return statement</i> , if the plug-in should not return anything, this is necessary in order to rewrite the return value of the <i>include</i> statement, which we use when connecting the plug-in file. <br><br>  Through the admin panel, create a new plugin that will pull up the created file <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $filepath = <span class="hljs-string"><span class="hljs-string">'plugins/switchContext.php'</span></span>; $context = <span class="hljs-string"><span class="hljs-string">'common'</span></span>; $plugin = $modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'pdotools_elements_path'</span></span>) . <span class="hljs-string"><span class="hljs-string">"$context/$filepath"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file_exists($plugin)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $plugin; }</code> </pre><br>  Hang up the plugin on the <i>OnHandleRequest</i> event. <br><br>  Now we have two contexts, how to use them in further development will be shown below. <br><br><a name="cvs"></a><br><h2>  Version control </h2><br>  We create a project repository, for example on GitHub, while in the working directory there will be only files and folders not related to the engine.  Like that <br><pre> <code class="hljs ruby">assets/ <span class="hljs-params"><span class="hljs-params">|-- dev/ |</span></span>-- css/ <span class="hljs-params"><span class="hljs-params">|-- js/ |</span></span>-- img/ \-- scss/ <span class="hljs-params"><span class="hljs-params">|-- web/ |</span></span>-- css/ <span class="hljs-params"><span class="hljs-params">|-- js/ \-- img/ core/ \-- elements/ |</span></span>-- common/ <span class="hljs-params"><span class="hljs-params">|-- plugins/ |</span></span>-- dev/ <span class="hljs-params"><span class="hljs-params">|-- chunks/ |</span></span>-- plugins/ <span class="hljs-params"><span class="hljs-params">|-- snippets/ \-- templates/ |</span></span>-- web/ <span class="hljs-params"><span class="hljs-params">|-- chunks/ |</span></span>-- plugins/ <span class="hljs-params"><span class="hljs-params">|-- snippets/ \-- templates/ \-- plugins/ .gitignore gulpfile.js package.json</span></span></code> </pre><br>  In this case, we will also control the files resulting from the assembly ( <i>assets / web /</i> and <i>core / elements / web /</i> ), in order to be able to roll back after an unsuccessful deployment.  This folder structure will be explained below. <br><br>  Developers, as usual, work in their local repositories and push commits to a remote repository.  In addition, there must be a repository in the root of the site. <br>  Sample .gitignore file <br><pre> <code class="hljs markdown"> # IntelliJ project files .idea/ <span class="hljs-emphasis"><span class="hljs-emphasis">*.iml out gen # ignore MODX files /assets/*</span></span> /connectors/<span class="hljs-bullet"><span class="hljs-bullet">* /core/*</span></span> /manager/<span class="hljs-bullet"><span class="hljs-bullet">* /setup/*</span></span> /config.core.php /index.php /.htaccess # ignore node modules /node_modules/ # do not ignore !/assets/dev/ !/assets/web/ !/core/elements/</code> </pre><br><br><a name="workflow"></a><br><h2>  Scheme of work </h2><br>  When I talked about Develpoment and Production versions above, I suggested using one copy of the site.  This also implies the absence of its local copy (not to be confused with the project's local git-repository).  We will edit the files on the local machine, but at the same time in our local working directory there will be only files and folders that are not related to the engine.  We will make changes to existing files, then <i>upload</i> these files to the site.  After performing any task, we commit in the local repository, then, if necessary, push the changes to GitHub, or where you are going to keep the project there. <br><br>  Now I will tell you how I propose to arrange versioning of the main elements of the system - templates, chunks, snippets and plug-ins, and describe the workflow through IDE PHPStorm in conjunction with the MODX administration panel.  This will help us with the legendary pdoTools and the Fenom template engine it uses. <br><br>  As you know, the pdoTools parser allows you to connect external files directly into the body of the chunk, and it is this feature that underlies the entire version control device. <br><blockquote>  It is necessary to set the <i>pdotools_fenom_parser</i> setting (Use Fenom on pages) to <i>Yes</i> <br></blockquote><br>  The pdoTools component has a pdotools_elements_path system setting with a default value <i>{core_path} elements /</i> .  Well, respectively, create the <i>elements /</i> folder (if not already created) in the <i>core /</i> engine folder and inside create the following folder structure: <br><pre> <code class="hljs ruby">elements/ <span class="hljs-params"><span class="hljs-params">|-- common/ |</span></span>-- plugins/ <span class="hljs-params"><span class="hljs-params">|-- dev/ |</span></span>-- chunks/ <span class="hljs-params"><span class="hljs-params">|-- plugins/ |</span></span>-- snippets/ \-- templates/ <span class="hljs-params"><span class="hljs-params">|-- web/ |</span></span>-- chunks/ <span class="hljs-params"><span class="hljs-params">|-- plugins/ |</span></span>-- snippets/ \-- templates/ \-- plugins/</code> </pre><br>  Actually, development is carried out in the <i>dev /</i> folder. An important rule for the whole team is in effect: ‚ÄúNo one should ever make any changes in the <i>web /</i> folder‚Äù.  When it is full, the entire contents of the <i>dev /</i> folder is copied to the <i>web /</i> using Gulp.  The <i>common /</i> folder contains files common to both contexts, for example, a plugin that switches the current context described above. <br><br>  This folder structure allows you to use the <i>[[* context_key]]</i> placeholder value when connecting external files using the Fenom template engine, like so <br><pre> <code class="php hljs">{set $ctx = $_modx-&gt;resource.context_key} {<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">"file:$ctx/chunks/common/head.tpl"</span></span>}</code> </pre><br>  In the first line, we add the current context key ( <i>dev</i> or <i>web</i> ) to the <i>$ ctx</i> variable, and in the second line we use this value in the file path.  This allows you to have two versions of the site on the same engine. <br> <a href=""><img src="https://habrastorage.org/webt/ux/dh/kv/uxdhkvewm_2suzm_qxlt455jsj0.png"><br></a> <br>  <i>approx.</i>  <i>Attach chunks in the template file</i> <br><br>  In addition to the files containing the main elements of the system, we also need to control the versions of the layout files and js.  Typically, these files are located in the <i>assets /</i> folder as follows. <br><pre> <code class="hljs pgsql">assets/ |<span class="hljs-comment"><span class="hljs-comment">-- css/ |-- js/ \-- img/</span></span></code> </pre><br>  According to the old scheme, I propose to create the following structure <br><pre> <code class="hljs ruby">assets/ <span class="hljs-params"><span class="hljs-params">|-- dev/ |</span></span>-- css/ <span class="hljs-params"><span class="hljs-params">|-- js/ |</span></span>-- img/ \-- scss/ <span class="hljs-params"><span class="hljs-params">|-- web/ |</span></span>-- css/ <span class="hljs-params"><span class="hljs-params">|-- js/ \-- img/</span></span></code> </pre><br>  When working with layout files and scripts, consider the following point.  For example, in the <i>dev / js /</i> folder there may be several .js files (for example, <i>calendar.module.js</i> and <i>search-form.module.js</i> ), but when deployed to production, these files should be combined into one and minimized (for example, <i>main .bundle.min.js</i> ), so that it is impossible to simply take and insert the necessary link <i>[[* context_key]]</i> in the file path, you should do something like this and deploy such a structure <br><pre> <code class="html hljs xml">[[*context_key:is=`dev`:then=` <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"[[++assets_url]][[*context_key]]/js/calendar.module.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"[[++assets_url]][[*context_key]]/js/search-form.module.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   --&gt;</span></span> `]] [[*context_key:is=`web`:then=` <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"[[++assets_url]][[*context_key]]/js/main.bundle.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> `]]</code> </pre><br><br><br><h4>  Associate resources with templates </h4><br>  We create templates in the <i>core / elements / dev / templates /</i> folder, in which we connect chunks from the <i>core / elements / dev / chunks</i> folder using the Fenom template syntax.  At the same time, creating a template file, we also need to create a corresponding template in the admin panel.  Only we will not create a static template, since we cannot specify a specific path to the file, because it depends on the context in which the template is used.  Instead, in the body of the template, we prescribe a single line <br><pre> <code class="php hljs">{<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">'file:[[*context_key]]/templates/base.tpl'</span></span>}</code> </pre><br>  Thus, this template will serve as a kind of template file switch for resources in various contexts. <br> <a href=""><img src="https://habrastorage.org/webt/sq/yn/41/sqyn41n209sa94slq1rufuqlqgy.png"><br></a> <br>  <i>approx.</i>  <i>Template file connection</i> <br><br><h4>  Create plugins </h4><br>  With this approach, the development should be separately discussed the introduction of new plug-ins into the system. <br>  Similarly to the situation with templates, we create plugins in the <i>core / elements / dev / plugins /</i> folder, in which we write the logic of the plug-in.  Next, go to the admin panel and create the corresponding plug-in (NOT static!), In which we include the plug-in file via <i>include</i> as follows <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $filepath = <span class="hljs-string"><span class="hljs-string">'plugins/somePlugin.php'</span></span>; $context = $modx-&gt;context-&gt;get(<span class="hljs-string"><span class="hljs-string">'key'</span></span>); $plugin = $modx-&gt;getOption(<span class="hljs-string"><span class="hljs-string">'pdotools_elements_path'</span></span>) . <span class="hljs-string"><span class="hljs-string">"$context/$filepath"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file_exists($plugin)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $plugin; }</code> </pre><br>  Do not forget, of course, in the admin panel to set the events on which the plugin is hung.  If we need a plugin common to both contexts, we add the value <i>‚Äúcommon‚Äù to the</i> <i>context</i> variable, as was done in the switchContext plugin. <br><br><a name="deploy"></a><br><h2>  Depla </h2><br>  Here we come to the crucial moment.  We roll out a test version of the site for production.  You must first perform some actions with the repository on the server, namely, create an SSH key, register it and set it in the repository settings on GitHub.  I will not describe this process here.  I will leave the link to the integration on key generation and registration below. <br>  So, the city falls asleep, the developers stop their work, all the files are closed and run into a remote repository.  The team leader wakes up, his task is to roll out all the work done to the release as quickly as possible.  I suggest this procedure. <br><ol><li>  On your local machine, you need to synchronize files with a remote repository to make sure that all files in the local repository are up to date. </li><li>  We create a label, for example ‚Äúv1.0.666-pre‚Äù, thus denoting a commit that precedes the build of version v1.0.666, for a quick and convenient rollback in case of unsuccessful deployment. <br><pre> <code class="bash hljs">$ git tag v1.0.666-pre</code> </pre> <br></li><li>  With the help of Gulp we collect a new version of the project. <br><pre> <code class="bash hljs">$ gulp modx:build</code> </pre> <br>  Drive example gulp file.  Here I have described only one task for copying files from <i>core / elements / dev</i> to <i>core / elements / web /</i> , the rest of the task, for sure, you can write yourself. <br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta"> 'use strict'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gulp = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> paths = { <span class="hljs-attr"><span class="hljs-attr">dist</span></span>: { <span class="hljs-comment"><span class="hljs-comment">// output js: 'assets/web/js/', css: 'assets/web/css/', img: 'assets/web/img/', fonts: 'assets/web/fonts/', modx: 'core/elements/web/' }, src: { // sources js: 'assets/dev/js/**/*.js', style: 'assets/dev/sass/style.scss', img: 'assets/dev/img/**/*.*', fonts: 'assets/dev/fonts/**/*.*', modx: 'core/elements/dev/**/*.*' }, watch: { // files watch to js: 'assets/dev/js/**/*.js', style: 'assets/dev/sass/**/*.scss', img: 'assets/dev/img/**/*.*', fonts: 'assets/dev/fonts/**/*.*', modx: 'core/elements/dev/**/*.*' } }; gulp.task('modx:build', function () { return gulp.src(paths.src.modx) .pipe(gulp.dest(paths.dist.modx)) });</span></span></code> </pre><br></li><li>  As a result of the assembly, new or new files will be added in the <i>/ assets / web /</i> and <i>/ core / elements / web /</i> folders.  Make a commit, assign a label to it and <i>push it</i> with the <i>--tags</i> flag to send the created labels to the remote repository. <br><pre> <code class="bash hljs">$ git add . $ git commit -m <span class="hljs-string"><span class="hljs-string">"Build v1.0.666"</span></span> $ git tag v1.0.666 $ git push --tags</code> </pre><br></li><li>  Through SSH we connect to the server and go to the root directory of the site, pull up data from the remote repository and do a <i>hard reset</i> to bring all the files of the site to the form in which they are stored in the repository. <br><pre> <code class="bash hljs">$ git fetch --all $ git reset --hard origin/master</code> </pre><br></li><li>  See the result in production.  If I correctly imagine how the world of development and programming works, then in about 10 out of ten cases, something will go wrong.  Therefore, go back to the console, execute the command <br><pre> <code class="bash hljs">$ git checkout v1.0.666-pre</code> </pre> <br>  those.  We translate the production files to the pre-build state and begin to figure out what's wrong. <br></li></ol><br> <a href=""><img src="https://habrastorage.org/webt/b1/_-/zc/b1_-zcckv8vtssng24u8trqpops.png"><br></a> <br>  <i>approx.</i>  <i>An example of a commit tree.</i> <br><br>  The above described applies to the deployment of templates, chunks and snippets, as well as layout files, but what about the resources? <br><br><h4>  And what about the resources? </h4><br>  Consider this task.  The site has a <i>News</i> section, with time the number of publications has become very large and it was decided to create a new section of the site <i>News Archive</i> . <br><br>  In the <i>dev</i> context, you create the appropriate container, add a couple of instances of archived news, create chunks, if you need a template, etc.  As a result, a new section appears on the domain <i>dev.example.com</i> .  After approval by the customer, you produce the deployment described above, but the new production section will not appear, although all the files will be brought to the required form.  Of course, this will happen because the created partition (meaning the totality of the created resources) will be in the context of <i>dev</i> and will not be available in the context of the <i>web</i> . <br>  - And what to do? <br>  - Copy-paste, comrades, alas. <br>  Or rather the transfer.  We simply transfer the created section to the <i>web</i> context, and then re-create its copy in <i>dev</i> so that the structure of the <i>dev</i> version of the site corresponds to production. <br>  Yes, I did not succeed in completely getting rid of copy-paste. <br><br><a name="the-end"></a><br><h1>  Conclusion </h1><br>  Thus, I managed to organize a workflow that would arrange, first of all, me.  In real work, this scheme has not yet been applied, therefore, no pitfalls have yet been discovered.  Maybe a more professional view of readers will see significant shortcomings, so please write about it in the comments.  And by the way, this is my first article, and I would like to know how accessible and clearly I managed to state my thoughts, I will be grateful for constructive criticism. <br><br>  A development template created as the article is written is available on Github <a href="https://github.com/vanyaraspopov/start-code-modx">https://github.com/vanyaraspopov/start-code-modx</a> . <br><br><a name="links"></a><br><h3>  Links </h3><br>  <a href="https://docs.modx.pro/components/pdotools/parser">pdoTools.</a>  <a href="https://docs.modx.pro/components/pdotools/parser">Parser</a> <br>  <a href="https://docs.modx.pro/components/pdotools/file-elements">pdoTools.</a>  <a href="https://docs.modx.pro/components/pdotools/file-elements">File elements</a> <br>  <a href="https://github.com/fenom-template/fenom/tree/master/docs/ru">Fenom syntax</a> <br>  <a href="https://bezumkin.ru/sections/tips_and_tricks/1987/">Context switch based on URL</a> <br>  <a href="https://docs.modx.com/revolution/2.x/administering-your-site/contexts">Contexts |</a>  <a href="https://docs.modx.com/revolution/2.x/administering-your-site/contexts">MODX Revolution</a> <br>  <a href="https://docs.modx.com/revolution/2.x/administering-your-site/contexts/using-one-gateway-plugin-to-manage-multiple-domains">Using One Gateway Plugin to Manage Multiple Domains</a> <br>  <a href="https://habrahabr.ru/post/209254/">IDE PHPStorm setup</a> <br>  <a href="https://habrahabr.ru/post/250569/">Nice build frontend project</a> <br>  <a href="https://habrahabr.ru/post/220847/">8 Two Wheel MODX Revolution Tips</a> <br>  <a href="https://help.github.com/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent/">Generating a new SSH key</a> <br>  <a href="https://github.com/vanyaraspopov/start-code-modx">Github</a>  <a href="https://github.com/vanyaraspopov/start-code-modx">vanyaraspopov / start-code-modx</a> </div><p>Source: <a href="https://habr.com/ru/post/347538/">https://habr.com/ru/post/347538/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../347526/index.html">Telegram-bot for Redmine. How to simplify the life of yourself and people</a></li>
<li><a href="../347528/index.html">NLog extension for error monitoring</a></li>
<li><a href="../347530/index.html">Can a JavaScript construct (a == 1 && a == 2 && a == 3) be true?</a></li>
<li><a href="../347534/index.html">All the pain of p2p development</a></li>
<li><a href="../347536/index.html">Chromium: the sixth project check and 250 bugs</a></li>
<li><a href="../347540/index.html">Legal status of cryptocurrency - the survey is conducted by the bot of the University Innopolis</a></li>
<li><a href="../347542/index.html">Implementing fork () without MMU</a></li>
<li><a href="../347544/index.html">Measurements as a way to openness</a></li>
<li><a href="../347546/index.html">Fintech Digest: Amazon Go generates a sea of ‚Äã‚Äãtransactions, and biometrics will penetrate all Mastercard</a></li>
<li><a href="../347550/index.html">Preparing .xlsx files: introduction, cell styles</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>