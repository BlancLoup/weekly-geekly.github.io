<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Development of a visual modeling language using Sirius</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the third article in a model-driven development cycle. In previous articles, we dealt with OCL and metamodels , created our own metamodel for ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Development of a visual modeling language using Sirius</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/55a/d06/c73/55ad06c7323746c19c69e7a94282b01b.jpg"><br><br>  This is the third article in a model-driven development cycle.  In previous articles, we dealt with <a href="http://habrahabr.ru/company/cit/blog/264963/">OCL and metamodels</a> , created our own <a href="http://habrahabr.ru/company/cit/blog/266433/">metamodel for the Anchor language with a tree editor</a> .  Today we will make the editor Anchor-diagrams. <br><a name="habracut"></a><br><h4>  <font color="#902213"><b>Summary</b></font> </h4><br>  In a few words: this article describes how to create chart editors.  Moreover, it is described in great detail.  If you do not plan to do this right now, then I recommend simply to scroll through the article, see pictures, headlines - do not get too far behind. <br><br>  If you want and can give it a little more time, then <a href="https://github.com/AresEkb/anchor">there</a> is a finished project.  You can install Eclipse and try everything live. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If you are ready to postpone all your business and start creating a diagram editor right now, then there is a detailed step-by-step guide for you. <br><br><h4>  <font color="#902213"><b>Introduction</b></font> </h4><br>  It is important to note that the <a href="http://habrahabr.ru/company/cit/blog/266433/">metamodel of the Anchor language from the previous article is</a> syntactically neutral.  It describes only the concepts used in the construction of Anchor-models.  But it is not described how these concepts can be drawn on diagrams or described as text. <br><br>  Also in the previous article, in parallel with the syntactically neutral metamodel, we created a tree-like editor of Anchor-models, in which for abstract concepts a completely concrete representation in the form of a tree with icons is used. <br><br>  If you look at the anchor-file with some <a href="https://github.com/AresEkb/anchor/tree/master/anchor.tests/model">Anchor-model</a> , you will see one more notation, but not tree-like, but textual. <br><br>  The Java API, which we also generated in the last article, already works with the third representation of Anchor-models in the form of Java-objects. <br><br>  In this article we will describe one more notation for Anchor-models - diagram.  To create a diagram editor, as before, we will use the Eclipse Modeling Tools.  There are several tools that allow you to work with diagrams. <br><br><h5>  <font color="#902213">Graphical Editing Framework (GEF)</font> </h5><br>  GEF is a powerful toolkit for Eclipse that allows you to work with various diagrams and graphs.  Particularly good is the current 4th version, in which there is support for DOT and many different interesting things.  The disadvantage of GEF is that you need to know Java and write a lot of sample code that could be generated automatically. <br><br><h5>  <font color="#902213">Graphiti</font> </h5><br>  I personally did not use it and did not see examples.  But, as far as I understand, this is some cross-platform abstraction over GEF-like tools, which, however, currently does not support anything except GEF :-) <br><br><h5>  <font color="#902213">Graphical Modeling Framework (GMF)</font> </h5><br>  GMF is a toolkit that somewhat simplifies the use of GEF for diagrams based on EMF.  It consists of 3 parts: GMF Notation, GMF Tooling and GMF Runtime. <br><br>  GMF Notation is a metamodel for representing (arbitrary) diagrams. <br><br>  GMF Runtime - reusable components for chart editors (toolbars, chart export functionality for various graphic formats, etc.). <br><br>  GMF Tooling is a toolkit that allows you to generate code for a chart editor.  Working with GMF Tooling usually looks like this. <br><br><ul><li>  <a href="http://habrahabr.ru/company/cit/blog/266433/">Create an Ecore-metamodel</a> for some modeling language. </li><li>  Create a .gmfgraph model with a description of the graphic elements that will be used in the diagrams. </li><li>  Create a .gmftool model with a description of the diagram editor toolbar. </li><li>  Create a .gmfmap model that links these 3 models together :-) </li><li>  And finally, generate the source code of the diagram editor. </li></ul><br>  All these additional models in GMF very much resemble the .genmodel model that we used in the <a href="http://habrahabr.ru/company/cit/blog/266433/">previous article</a> to generate a tree diagram editor.  It‚Äôs probably easier than using GEF directly, but it's still quite difficult. <br><br>  GMF Notation and GMF Runtime are used in almost all chart editors based on Eclipse. <br><br>  For GMF Tooling, there are alternatives.  However, it is worth noting that GMF appeared relatively long and works, including in older versions of Eclipse.  For example, Rational Software Architect is usually based on a rather ancient version of Eclipse.  Therefore, if you want to create a diagram editor for RSA, you have to use GMF Tooling, instead of more modern tools.  An example of such a diagram editor you saw in the <a href="http://habrahabr.ru/company/cit/blog/264963/">first article of the cycle</a> (note the diagram with men, the source code is available <a href="https://github.com/AresEkb/mda_course">here</a> ). <br><br><blockquote>  <b>Note</b> <br><br>  In general, the same Sirius should theoretically work since Eclipse Juno, but to be honest, I have not tried it yet. </blockquote><br><h5>  <font color="#902213">Sirius</font> </h5><br>  Sirius, like GMF Tooling, allows you to create chart editors based on GMF Notation and GMF Runtime.  But it is much simpler, more functional and more convenient. <br><br><ul><li>  Only one model is created that describes the diagram editor, and not 3. </li><li> In addition to presenting the model as a diagram, it supports tree, table, and other views. </li><li>  Model validation, navigation between views, filters, etc. are supported. </li><li>  No need to generate any code.  You write a diagram editor and test it immediately in the same Eclipse instance. </li></ul><br><h5>  <font color="#902213">Eugenia</font> </h5><br>  On the basis of Eclipse, a sufficiently large number of tools have been created that can be used in model-driven development.  The tools are completely different: for converting, validating, comparing, merging models, etc.  In the <a href="https://www.eclipse.org/epsilon/">Epsilon</a> project, the developers tried to somehow unify and connect all these technologies with each other. <br><br>  EuGENia is a tool used in Epsilon to develop chart editors.  In fact, this is a wrapper over GMF Tooling, which somewhat simplifies the creation of .gmfgraph, .gmftool and .gmfmap models. <br><br><h4>  <font color="#902213"><b>Customization</b></font> </h4><br>  We will create a diagram editor based on the Ecore-metamodel described in the <a href="http://habrahabr.ru/company/cit/blog/266433/">previous article</a> .  Accordingly, it makes no sense to use pure GEF or Graphiti, you need to take some add-on, sharpened by EMF.  EuGENia disappears, because we will not use Epsilon yet.  GMF Tooling also disappears, because, on the one hand, it is too complicated, and on the other, we do not need the diagram editor to work in older versions of Eclipse.  It remains Sirius. <br><br>  Install <a href="https://www.eclipse.org/downloads/">Eclipse Modeling Tools</a> . <br><br>  Install Sirius.  To do this, select the menu Help -&gt; Install New Software ... Add a site <a href="http://download.eclipse.org/sirius/updates/releases/3.0.0/mars">http://download.eclipse.org/sirius/updates/releases/3.0.0/mars</a> <br><br><blockquote>  <b>Note</b> <br><br>  At the time of this writing, this is the latest version of Sirius.  An up-to-date list of versions is available <a href="https://wiki.eclipse.org/Sirius/Update_Sites">here</a> . </blockquote><br>  Select and install the components marked in the figure. <br><br><img src="https://habrastorage.org/files/200/e0f/5cf/200e0f5cf28d45dd8542f9d282e60f45.png"><br><br>  Take the <a href="https://github.com/AresEkb/anchor">projects</a> from the <a href="http://habrahabr.ru/company/cit/blog/266433/">previous article</a> .  Deploy them to the current workspace.  To do this, select File -&gt; Export ... -&gt; Deployable plugin-ins and fragments from the menu. <br><br><img src="https://habrastorage.org/files/3ab/d0e/401/3abd0e401e324747bb2ab7731b0b0602.png"><br><br>  Mark the projects anchor, anchor.edit and anchor.editor.  Select Install into host.  Repository.  After deploying the plugin, restart Eclipse. <br><br>  The previous article described two more options for running these plugins in Eclipse (running the second instance and copying the jar files to $ ECLIPSE_HOME / dropins). <br><br>  Make sure that you open test models from the anchor.tests project of the model folder. <br><br><img src="https://habrastorage.org/files/6a3/250/76f/6a325076f3bb43428da3517e459048f3.png"><br><br>  After that, it is advisable to remove the anchor, anchor.edit and anchor.editor projects from the workspace, because they are already deployed.  If you leave them, there will be nothing fatal.  It is possible that with auto-completion, duplicate metaclasses will be issued (one from the workspace, the second from the deployed plugin). <br><br><h4>  <font color="#902213"><b>Project creation</b></font> </h4><br>  In general, the project anchor.design has already been <a href="https://github.com/AresEkb/anchor/tree/master/anchor.design">created</a> .  You can <br><br><ul><li>  delete this project and create your own, </li><li>  create a similar project nearby, </li><li>  do not create anything and see everything on the example of the finished project. </li></ul><br>  To create a project, select File -&gt; New -&gt; Other ... -&gt; Sirius -&gt; Viewpoint Specification Project.  Call it anchor.design or something else. <br><br>  Open the Sirius perspective (Window -&gt; Perspective -&gt; Open Perspective). <br><br><img src="https://habrastorage.org/files/d14/679/6d7/d146796d77e24bb2a57f8a35a68ad9c2.png"><br><br>  There are a minimum of files in the project: several standard files with settings, a plugin activator in the src folder and, most importantly, an anchor.odesign file.  In it, we will describe the elements of the diagrams, the diagram editor toolbar and everything else. <br><br><h4>  <font color="#902213"><b>Creating a point of view</b></font> </h4><br>  There can be several points of view on the same model (customer or developer, conceptual, logical or physical, etc.).  We will describe only one point of view (Viewpoint).  Add it through the context menu in the tree editor.  Give it an Anchor ID, in the Model File Extension field, specify anchor. <br><br><img src="https://habrastorage.org/files/eed/15f/8e3/eed15f8e393e45039dd2874eb41c0339.png"><br><br><blockquote>  <b>Note</b> <br><br>  Personally, I am very confused that in Sirius objects need to manually register identifiers, they could easily be assigned automatically.  Confused by the possibility of changing identifiers. <br><br>  Also confusing is binding the diagram editor to models by the file extension of the model, and not by the namespace. <br><br>  But, in principle, it works, and okay. </blockquote><br><h4>  <font color="#902213"><b>Creating a view</b></font> </h4><br>  A model can have many different representations.  Currently, Sirius supports 5 views (chart, table, pivot table, tree, sequence diagram).  In this article we will work only with diagrams. <br><br>  Add to the Anchor point of view a model representation in the form of a diagram (New Representation -&gt; Diagram Description). <br><br><img src="https://habrastorage.org/files/992/408/f4c/992408f4c65145668e34f5e1a9ccda30.png"><br><br>  In the properties, specify the ID of the Anchor Diagram, in the Domain Class field, specify the root object of the model (anchor.Model).  In this field, as in many other fields, autocompletion runs, called by Ctrl + Space. <br><br>  Notice that the Default layer is automatically created in the view to accommodate chart elements.  In this article we will not create additional layers. <br><br><h4>  <font color="#902213"><b>Specification of visual elements for anchors</b></font> </h4><br>  Now it is necessary to describe the nodes and edges from which the diagrams will be built. <br><br><blockquote>  <b>Note</b> <br><br>  Once again, in the previous article in the anchor.ecore file, we described the Anchor language in a syntactically neutral form.  Described only the concepts that make up the Anchor-model.  These concepts can be presented in the form of diagram elements, in the form of tree nodes, in the form of text.  Now we are actually creating a second model, in which we describe how syntactically neutral concepts of Anchor-models should be visualized. <br><br>  It is very important to understand the difference between a model and a chart. </blockquote><br>  In the Default layer, add a node (Node) for anchors with the Anchor ID.  In the Domain Class field write anchor.Anchor.  In the Semantic Candidates Expression field, you must specify where exactly in the model you need to look for anchors.  Press Ctrl + Space and see what options are available: <br><br><ul><li>  var: means you need to take the value of some variable; </li><li>  feature: means that you need to take some property or an association of the current object (in this case, the current object is the root object of the anchor.Model model type); </li><li>  service: means that you need to run some Java method that will return the list of anchors to be displayed on the diagram; </li><li>  aql: means that you need to execute some AQL expression that returns a list of objects (AQL is very similar to OCL, and if you read this <a href="http://habrahabr.ru/company/cit/blog/264963/">article</a> , then it should be completely clear to you); </li><li>  [/] similarly allows you to write an expression that will be interpreted by the Acceleo engine (however, it works slowly, unstable and difficult, it is recommended to use AQL); </li><li>  ocl: means that you need to execute some OCL expression that will return a list of objects (in this article we will use mainly OCL expressions, to be honest, I don‚Äôt really understand how OCL and AQL are fundamentally different, but still OCL is a standard OMG). </li></ul><br>  In this case, the anchors that need to be displayed on the diagram are available through the anchors association of the root object of the model.  Therefore, in the Semantic Candidates Expression field you need to write a feature: anchors. <br><br><blockquote>  <b>Note</b> <br><br>  If you do not understand what kind of association this is, look at the last diagram in the <a href="http://habrahabr.ru/company/cit/blog/266433/">previous article</a> . </blockquote><br><img src="https://habrastorage.org/files/101/a54/6ea/101a546ea6324628ac9dfcc98abde2e7.png"><br><br>  Now it is necessary to describe exactly how anchors should be depicted in diagrams.  If you created a new project, copy the <a href="https://github.com/AresEkb/anchor/tree/master/anchor.design/icons">icons</a> folder into it.  Click in the Model Explorer on the left of the anchor.design project and press F5 (or select Refresh from the context menu).  After that, the icons folder should appear in Eclipse. <br><br>  Add an image link to the Anchor node description (New Style -&gt; Workspace Image).  In properties, specify /anchor.design/icons/Anchor.png. <br><br><h4>  <font color="#902213"><b>Testing the chart editor</b></font> </h4><br>  So, we have already described one element of the diagram, let's see how it all looks.  In the project anchor.tests in the model folder are test models with diagrams.  If you are creating a new project anchor.design, then these charts will not open, because they contain many objects that we have not yet described in the anchor.odesign file.  Therefore, you can simply delete the Pefrormance.aird file and create a new one (the test model itself will not go anywhere, because it lies in the anchor file).  To create a new diagram, select File -&gt; New -&gt; Representations File.  Select Initialization from a semantic resource.  Select a model. <br><br><img src="https://habrastorage.org/files/ecf/ee6/bc6/ecfee6bc6cf342b18eba5ebea6c97a49.png"><br><br>  On the last tab of the diagram creation wizard, specify the anchor.tests / model folder.  Select an Anchor point of view. <br><br>  There are no diagrams in the created file yet.  To create one, select the root object of the model and click New Representation -&gt; new Anchor Diagram. <br><br><img src="https://habrastorage.org/files/5a3/61e/7aa/5a361e7aa8b54d6aa6efea85e846bf90.png"><br><br>  Drag the chart editor window to the right to view both the anchor.odesign chart editor description and the test chart at the same time. <br><br><img src="https://habrastorage.org/files/4b3/3aa/36f/4b33aa36f1a244c4b78e371c56728ce0.png"><br><br>  The diagram looks a bit strange :-) <br><br>  This is due to the fact that it displays two icons.  One of the anchor.design project, the second of the anchor.edit project (which we created in the last article for the tree editor).  The icons for the tree editor are small and slightly clumsy, because they are obtained by converting from svg- to gif-format.  To remove them from the chart in anchor.odesign in the image properties in the Label tab, uncheck Show Icon. <br><br>  Also in the Label Position field, specify the border.  This means that the signature of the anchor should not be displayed inside the anchor icon, but on its border. <br><br>  Notice that feature: name is listed in the Label Expression field.  This means that the name property of the anchor will be used as the signature. <br><br>  On the Advanced tab, in the Allow resizing field, disable the resizing of the icon. <br><br>  Now save the specification of the diagram editor (Ctrl + S) and, miraculously, the diagram will automatically update.  In this regard, Sirius greatly simplifies the development of diagram editors.  For example, in the previous article I had to generate the source code, run a second instance of Eclipse.  The same has to be done when using GMF Tooling, but everything is simple. <br><br><img src="https://habrastorage.org/files/0f2/b7d/7d4/0f2b7d7d4feb4738aad2b5b95af3cd15.png"><br><br><h4>  <font color="#902213"><b>The specification of visual elements for attributes</b></font> </h4><br>  For attributes, it would be possible to describe the visual element as well as for anchors by selecting the metaclass anchor.Attribute and the corresponding icon.  However, everything is somewhat more complicated. <br><br>  First, for attributes without saving the history and preserving the history, different icons should be used - circles with single or double borders, respectively. <br><br>  Secondly, when you begin to describe the visual elements for the links, you will see that they indicate which nodes of the diagram they can link.  For example, only a KnottedStaticAttribute and a KnottedHistorizedAttrbute can be associated with a node (Knot).  But StaticAttribute and HistorizedAttrbute cannot be linked to a node, they have a banal relationship with the node (anchor.Knot) in the metamodel. <br><br>  Therefore, copy the description of the visual element for Anchor four times for each kind of attribute.  Modify the Id and Domain Class fields accordingly.  Clear the Semantic Candidates Expression field, because attributes are not top-level objects, they belong to anchors, not models directly.  One could write an OCL expression that bypasses all anchors and returns all attributes, but this makes no sense.  Also change the icons.  After saving the specification and arranging the objects (by dragging the mouse) you will see something like this. <br><br><img src="https://habrastorage.org/files/beb/f83/61a/bebf8361ab10479ba326df58e25527dd.png"><br><br><h4>  <font color="#902213"><b>Specification of relationships between anchors and attributes</b></font> </h4><br>  The metaclasses anchor.Anchor and anchor.Attribute define the relation attributes.  For each instance of this relationship, we need to draw a line on the Anchor diagrams.  To do this, add an edge based on the relation (New Diagram Element -&gt; Relation Based Edge) to the Default layer. <br><br>  Provide an AttributeEdge ID.  In the Source Mapping field, specify the visual element Anchor, which is used to draw anchors.  In the Target Mapping field, specify 4 visual elements for various kinds of attributes.  In the Target Finder Expression field, type feature: attributes. <br><br>  In the Edge Style tab, under the Decorators tab, check NoDecoration for both ends.  On the Advanced tab, in the Ends Centering field, tick Both to align the ends of the lines to the center of the nodes that they connect.  Also remove the nested Label element, because no signatures are needed here. <br><br>  After saving and organizing the elements, you will see something similar.  You‚Äôll have to arrange with a mouse; out of the box, automatic ordering doesn‚Äôt work very well. <br><br><img src="https://habrastorage.org/files/f12/fd6/202/f12fd6202cdc45289dab13f2176e47ea.png"><br><br><h4>  <font color="#902213"><b>Specification of visual elements for braces and nodes</b></font> </h4><br>  You can do this yourself.  For nodes, specify the metaclass anchor.Knot, and in the Semantic Candidates Expression field, specify feature: knots.  For scraps, as for attributes, create 4 elements.  In the Semantic Candidates Expression field, type feature: ties.  On the Label tab for scrapers, clear the Label Expression field because they have no names. <br><br>  Add a link between the KnottedStaticAttribute, KnottedHistorizedAttribute and Knot by analogy with the link between anchors and attributes. <br><br><blockquote>  <b>Note</b> <br><br>  If you don‚Äôt see any links in the diagram or something doesn‚Äôt work, try validating the specification.  To do this, click the button with a green check mark in the header of the specifications editor. <br><br>  For example, instead of feature: knot, I wrote feature: knots.  At the same time, connections between attributes and nodes were simply not displayed without any error messages.  After validating the specification, it becomes clear what the problem is.  Another common mistake is extra spaces. </blockquote><br>  In the end, you get something like that. <br><br><img src="https://habrastorage.org/files/4c2/45d/173/4c245d17341342a5b0bb97a061f67ea1.png"><br><br><h4>  <font color="#902213"><b>Specification of ties of ties with anchors and knots</b></font> </h4><br>  This kind of connections is already somewhat more complicated than those we created earlier.  This is because they are not based on the relationship between objects, but on the anchor.AnchorRole metaclass instances, which have two properties (a name and a flag that determines whether this relationship identifies) and two associations (with a clamp and an anchor). <br><br>  Add an Element Based Edge with the AnchorRoleEdge ID and the following properties: <br><br><ul><li>  Domain Class - anchor.AnchorRole </li><li>  Source Mapping - StaticTie, KnottedStaticTie, HistorizedTie, KnottedHistorizedTie </li><li>  Source Finder Expression - feature: tie </li><li>  Target Mapping - Anchor </li><li>  Target Finder Expression - feature: anchor </li></ul><br>  As before, make a line without arrows, center the ends of the line, remove the tick on Show Icon from the signatures. <br><br>  In contrast to the previous links, we will display two signatures on this one.  In the center of the line you need a signature with the name of the role, for this, in the Label Expression field, specify feature: name.  Add another Begin Label Style, in the Label Expression field write ocl: if self.isIdentifier then '1' else 'm' endif.  Here, <a href="http://habrahabr.ru/company/cit/blog/264963/">OCL</a> is suddenly useful to us.  The meaning of the expression, I think, is intuitively clear: if the relationship is identifying, we show 1, otherwise - m. <br><br>  By analogy, add links based on the anchor.KnotRole metaclass.  In the end, you will see something like that.  Note that in the properties window, you can change both the properties of model objects and various aspects of the display of these objects on diagrams. <br><br><img src="https://habrastorage.org/files/027/b9a/315/027b9a3154cb4b3eb9567445e0625fba.png"><br><br>  Well, well, the diagram editor is almost ready.  Of course, it is not as beautiful and convenient as on the <a href="http://www.anchormodeling.com/modeler/latest/">Anchor Modeling</a> website.  Consider it a fee for using a standard solution.  Although the fact that the properties are displayed in the same window, in my opinion, is quite convenient.  In any case, everything else (adequate automatic ordering of nodes on the diagram, normal splines for edges, etc.) should be finished with hands. <br><br><h4>  <font color="#902213"><b>Specification tool for creating nodes</b></font> </h4><br>  You probably noticed the empty tool palette on the right.  Add a tool to create new anchors there.  To do this, create a new section (New Tool -&gt; Section) with the identifier Nodes.  Add the New Element Creation -&gt; Node Creation node creation tool with the identifier CreateAnchor.  In the Label field, enter Anchor.  In the Node Mappings field, add Anchor.  On the Advanced tab, you can add a link to the icon. <br><br>  Expand this element, you will see the definition of two variables and the Begin block, which will be executed when using our tool.  Add an operation that sets the context to it (New Operation -&gt; Change Context).  In the Browse Expression field, specify var: container.  If you (as I do not understand what this variable is), press Ctrl + Space, and you will see that it refers to an object of type anchor.Model, i.e.  on the root object of our model. <br><br>  In the context of the root object of the model, we need to create an anchor (an instance of the metaclass anchor.Anchor).  To do this, add an instance creation operation (New Operation -&gt; Create Instance).  In the Reference Name field, specify the name of the association of the current object (specified via Change Context), with which you need to associate this object with the created instance.  In this case, it is anchors association.  In the Type Name field, specify anchor.Anchor.  In the Variable Name field, specify the name of the variable that will refer to the created object. <br><br>  Save the specification and try to create a new anchor in the diagram editor.  On the properties tab below specify the name of the anchor. <br><br><img src="https://habrastorage.org/files/934/14e/f69/93414ef69ff54bc58098898cc848ec90.png"><br><br><blockquote>  <b>Note</b> <br><br>  In general, many more different operations are available in Sirius, for example, you can set the name of the new anchor by default, etc.  But you can figure it out on your own. </blockquote><br><h4>  <font color="#902213"><b>Attribute Creation Specification</b></font> </h4><br>  With attributes, things are a bit more complicated than with anchors, because attributes are not top-level objects.  They belong to anchors, not models. <br><br>  Copy the anchor creation tool, correct the Id, Label and Node Mappings fields.  Do not forget that this needs to be done 4 times (for each kind of attribute).  On the Advanced tab, in the Extra Mappings field, add Anchor.  This will allow you to create attributes not only in the context of the model, but also in the context of individual anchors. <br><br>  Now we need to prohibit the creation of attributes that are not attached to the anchor.  To do this, on the General tab, in the Precondition field, specify ocl: container.oclIsKindOf (Anchor).  This means that only an anchor can be used as a container for a new attribute. <br><br>  For the Create Instance operation, in the Reference Name field, specify attributes (this is the name of the association between anchors and attributes).  In the Type Name, specify the metaclass of the attribute being created. <br><br><img src="https://habrastorage.org/files/fe2/63d/2a5/fe263d2a56534700a162d07518b7a308.png"><br><br>  Try creating new attributes.  Make sure that when you hover over an empty area on the chart, the anchor creation tool appears.  And when you hover, the attribute creation tool. <br><br><h4>  <font color="#902213"><b>Specification of other tools for creating, deleting and modifying objects and relationships</b></font> </h4><br>  Tools for creating knots and braces are made in a similar way.  This is quite a chore, but in GMF Tooling this is still a chore, and much more difficult in the GEF without the use of any add-ons. <br><br>  I think it makes no sense to describe the tools for creating links.  You can see examples in the <a href="https://github.com/AresEkb/anchor/tree/master/anchor.design">project</a> .  I will only note that for simple links (anchor - attribute or attribute - node) you need to use the Set operation.  And for more complex connections (clamp - anchor, clamp - node) you need to create new instances of objects. <br><br>  Also in the project you will find examples of tools for removing and modifying links. <br><br><h4> <font color="#902213"><b> </b></font> </h4><br>     ,  ,      (  ). <br><br>      Anchor Diagram   (New Filter -&gt; Composite Filter).       Hide attributes and knots.     (New -&gt; Mapping Filter).   Mappings  Knot, StaticAttribute, HistorizedAttribute, KnottedStaticAttribute, KnottedHistorizedAttribute. <br><br>          - . <br><br><img src="https://habrastorage.org/files/696/845/77b/69684577bb584f3d900975b053b5370f.png"><br><br><h4> <font color="#902213"><b>  </b></font> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the </font></font><a href="http://habrahabr.ru/company/cit/blog/264963/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">first article of the</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cycle, you saw examples of various control rules. </font><font style="vertical-align: inherit;">The rules, like the model itself, were very artificial. </font><font style="vertical-align: inherit;">Now we will add a more useful rule to the diagram editor. </font><font style="vertical-align: inherit;">For example, we ban the attributes of the same name at the anchor. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To do this, add a validation block to the view (New Validation -&gt; Validation). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Then add the model element validation rule (New -&gt; Semantic Validation Rule).</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In the Level field, enter Error. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In the Target Class field, specify anchor.Anchor. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In the Message field, enter ‚ÄúThe anchor has indistinguishable attributes‚Äù. </font></font></li></ul><br>  Add rule specification (New -&gt; Audit).  In the field Audit Expression write <br><br> <code>ocl:attributes-&gt;isUnique(name)</code> <br> <br>  Try to create two attributes of the same name in the model at the same anchor and validate the model (in the context menu of the diagram, select Validate diagram).  At the same time an error icon will appear at the anchor. <br><br>  We formulate this rule a little differently.  Create another rule: <br><br><ul><li>  In the Level field, enter Error. </li><li>  In the Target Class field, specify anchor.Attribute. </li><li>  In the Message field, specify ‚ÄúThe attribute has non-unique name‚Äù. </li></ul><br>  Add rule specification (New -&gt; Audit).  In the field Audit Expression write <br><br> <code>ocl:anchor.attributes-&gt;excluding(self).name-&gt;excludes(self.name)</code> <br> <br>  Now, after validation, not the whole anchor will be highlighted, but individual attributes with non-unique names. <br><br><img src="https://habrastorage.org/files/603/2bc/ec7/6032bcec7d3c46f78cfbe0d85283adbe.png"><br><br><h4>  <font color="#902213"><b>Conclusion</b></font> </h4><br>  After reading this article, you should understand the difference between models and notations for models (for example, diagrams).  I hope you can now create <a href="http://habrahabr.ru/company/cit/blog/266433/">modeling languages</a> and chart editors for them. <br><br>  You also saw the real use of <a href="http://habrahabr.ru/company/cit/blog/264963/">OCL</a> . <br><br>  If you're interested, I highly recommend creating some kind of visual modeling language.  As you can see, this is the same mundane thing as the description of a class or function in code. <br><br>  In subsequent articles, we will look at textual notations for models.  And of course we will do the most important thing - the transformation of models. </div><p>Source: <a href="https://habr.com/ru/post/267335/">https://habr.com/ru/post/267335/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267321/index.html">And again about 1C</a></li>
<li><a href="../267323/index.html">The United States and China may conclude an agreement on the rules of conduct in cyberspace</a></li>
<li><a href="../267325/index.html">About a new set of 3D schools, a Kalashnikov assault rifle, an arctic greenhouse and other engineering projects of graduates of past courses</a></li>
<li><a href="../267327/index.html">IBM Research plans to create a robust method for early diagnosis of dementia using smartphones</a></li>
<li><a href="../267331/index.html">Mail to Mail @ Ru behaves so conveniently that it‚Äôs scary</a></li>
<li><a href="../267337/index.html">What's new in iOS 9, what to expect from Android Marshmallow, what to avoid game designer - and other news of the week for a mobile developer</a></li>
<li><a href="../267339/index.html">Iproute2 policy-routing and traffic balancing between uplinks - the problem of dropping connections</a></li>
<li><a href="../267341/index.html">Adaptation of the Feedly application for Material Design</a></li>
<li><a href="../267343/index.html">Scheduling DHCP server</a></li>
<li><a href="../267345/index.html">Block diagram for the selection of STL-algorithm</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>