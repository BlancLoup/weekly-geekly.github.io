<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Make Keyestudio GSM / GPRS Shield work through the Amperka library</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to present a library to GSM / GPRS Shield for Arduino from Keyestudio. I bought this device because of the price. In China, it was almost 2 tim...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Make Keyestudio GSM / GPRS Shield work through the Amperka library</h1><div class="post__text post__text-html js-mediator-article">  I want to present a library to GSM / GPRS Shield for Arduino from Keyestudio.  I bought this device because of the price.  In China, it was almost 2 times cheaper than its counterpart from Amperki, and three times less than that of iAruino.  The reason for writing this text is the lack of an acceptable library on Keyestudio website for working with it.  <s>Work through a set of AT-commands is not considered.</s>  Libraries for other similar devices in the direct did not fit.  In any case, I could not get them to work. <br><br>  I had to adapt, in my opinion, the most developed "Amperek" library for this board, and thus try to preserve the compatibility of the code written under the amperovsky shield. <br><a name="habracut"></a><br>  Actually link to the library: <a href="https://github.com/andrewinc/keyestudio-gsm-gprs-shield">github.com/andrewinc/keyestudio-gsm-gprs-shield</a> <br><img src="https://habrastorage.org/web/e22/963/00c/e2296300c29f4967bd280e81173b58de.jpg" alt="Appearance Keyestudio GSM / GPRS Shield"><br>  Ampere uses Sim900R chip in its shield, and here Sim900.  The most important difference in the ST signal: it is in the source library and shield, but not in Keyestudio.  Meanwhile, it would be clearly on or off the chip.  But there is a button SIM900_Power, which led me to bad thoughts about the lack of software to enable the chip.  Fortunately, they were wrong. <br><br>  Pin 9 - controls the inclusion of the chip, the same substitute for the Power button on the amperkovskaya board is marked PK. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A small difference in the chip version did not affect its capabilities; in any case, I was able to initiate a call, send and receive an SMS using the examples provided in the library.  I guess this is the main direction of using this shield. <br><br><h3>  Physical settings </h3><br>  The board communicates with Arduino via the UART-interface.  For those who are not aware of the UART - these are the TX and RX pins.  By TX - data follow from Arduino, and by RX - back. <br><br>  There is also a switch ‚ÄúUART_Port - DBG_Port‚Äù, but I did not use this port.  The switch remained in the "UART_Port". <br><br>  The special feature of the board is that it does not work out of the box.  If you pay attention to the state of the jumpers after opening the package (see photo above), you can see the connections TXD c 0 and RXD with 1. On the Arduino for TX and RX, the same pins are used.  The problem is just that, because  they are used to download the sketch, they are also used to exchange information through the Serial object, incl.  and for debugging.  When connecting Arduino with a shield, a conflict arises and the firmware fails. <br><br><h3>  Software serial </h3><br>  It is known that Arduino UNO has only one Serial interface, but their whole family is, for example, Arduino Mega.  Serial1 is associated with a pair of TX1 and RX1, similarly for Serial2 and Serial3. <br>  For the use of Arduino UNO, it is reasonable to use software Serial.  It is enough to connect the appropriate library, and create the object itself, specifying the pins of the Arduino to which TXD and RXD signals come from the shield: <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SoftwareSerial.h&gt; SoftwareSerial mySerial(6, 7);</span></span></span></span></code> </pre> <br>  In this example, TXD is connected to pin 6, and RXD is connected to 7. <br><br><h3>  Chip software enable </h3><br>  Pin on / off the chip - 9, in contrast to the TX and RX, can not be switched to other outputs of the Arduino, in any case, the switches on the shield for this were not found. <br><br>  To turn on the chip, you need to send a high signal to 9 pins, wait 1-3 seconds and send a low signal to it.  Further, usually in the code you can see the wait in seconds 5-15.  All this is reminiscent of the manipulation of the power button on the cell phone, and subsequently loading it and establishing communication with the network. <br><br>  In the source library from Ampere there was feedback through the ST signal.  Through it, in the process of switching on, the state was checked: whether the chip is on.  Alas, in the absence of this signal, the methods of turning the chip on and off are similar to the twin brothers, since the shutter is also supplied with a 9 pin for shutdown.  These methods were not combined into one because of the compatibility of the code <s>and because of the banal laziness</s> . <br><br><h3>  How it works </h3><br>  The library itself is connected with the string: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;GPRSk_Shield_Arduino.h&gt;</span></span></span></span></code> </pre> <br>  After that, you can create an object based on the GPRSk class and transfer the same mySerial to the constructor or specify the hardware Serial1, Serial2, etc.  Example: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">GPRSk </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gprs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mySerial)</span></span></span></span>;</code> </pre> <br>  The setup function typically initializes Serial and mySerial, however, if you do not plan to send debugging information to the Arduino IDE monitor, you can only get by initializing mySerial. <br><br>  After that, the chip power supply is turned on using the gprs.powerOn () method and then gprs.init () is called, which returns true if the chip is ready to receive / transmit information. <br><br>  When all these tasks are completed, you can send SMS: <br><br><pre> <code class="cpp hljs">gprs.sendSMS(<span class="hljs-string"><span class="hljs-string">"+79007654321"</span></span>, <span class="hljs-string"><span class="hljs-string">"Hello SMS from Keyestudio!"</span></span>);</code> </pre> <br>  Read new posts: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span> message[<span class="hljs-number"><span class="hljs-number">160</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> phone[<span class="hljs-number"><span class="hljs-number">16</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> datetime[<span class="hljs-number"><span class="hljs-number">24</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gprs.ifSMSNow()) { gprs.readSMS(message, phone, datetime); }</code> </pre> <br>  make calls: <br><br><pre> <code class="cpp hljs">gprs.callUp(<span class="hljs-string"><span class="hljs-string">"+79007654321"</span></span>);</code> </pre> <br>  etc. <br><br>  Within the library, there are attached ‚Äúamberkoff‚Äù examples, where only Serial1 is changed to software.  They were tested on Keyestudio GSM / GPRS Shield and showed their performance. <br><br><h3>  Nutrition </h3><br>  Observations have shown that this ‚Äúsandwich‚Äù from the Arduino UNO and GPRS shield is not sufficiently powered by USB.  This is expressed in the systematic output of false by the gprs.init () method. <br>  It was not enough and the power of 200mA (9V) in the standard Arduino power connector in addition to USB power.  Rather, sometimes gprs.init () passed, and sometimes not.  I think the power 5V 1-1.5A will be quite sufficient. <br><br><h3>  Disadvantages: </h3><br><ol><li>  The library uses delay () pauses, which interrupts the execution of the entire controller code. </li><li>  It is assumed that no PIN code is set on the SIM card. </li><li>  There is no Cyrillic support in the text of SMS messages. </li></ol><br>  I hope this library can be useful, as well as some comments on working with this shield. </div><p>Source: <a href="https://habr.com/ru/post/403843/">https://habr.com/ru/post/403843/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../403833/index.html">Where does the desire for excessive care for children</a></li>
<li><a href="../403835/index.html">Zyxel Keenetic Extra II Review: AC1200 at Reasonable Price</a></li>
<li><a href="../403837/index.html">A massive attack with a cryptor Wana decrypt0r 2.0</a></li>
<li><a href="../403839/index.html">3D printing at Urban Fest 2017</a></li>
<li><a href="../403841/index.html">Review of online-course on arduino / robotics from MIPT (third week)</a></li>
<li><a href="../403845/index.html">Emercoin connects to F2Pool</a></li>
<li><a href="../403847/index.html">Total Commander: search in the current default folder</a></li>
<li><a href="../403849/index.html">UK police will make decisions about the detention of suspects using AI</a></li>
<li><a href="../403851/index.html">For two years, drivers for sound cards in HP laptops have come with a built-in keylogger</a></li>
<li><a href="../403853/index.html">Log and database IoT events. Quick start from iRidium server</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>