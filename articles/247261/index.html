<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Integration of PayPal to the site as a payment system and the problem with https</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, a site redesign was to be done with the subsequent rebuilding of the entire CMS. In the process, he drew attention to the integration of Pay...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Integration of PayPal to the site as a payment system and the problem with https</h1><div class="post__text post__text-html js-mediator-article">  Recently, a site redesign was to be done with the subsequent rebuilding of the entire CMS.  In the process, he drew attention to the integration of PayPal as a payment system.  I definitely cannot say about the advantages of this payment system or any benefit, the choice of the customer, and since its main activity is Mail Forwarding (sending and delivering packages from the USA), it is more convenient for him to use this payment system. <br><img src="https://habrastorage.org/files/432/5a9/e42/4325a9e42b5345ff8cf528ffa1fb76e9.jpg" height="120"><br>  The total statistical figures about PayPal are 143 million users in 203 countries of the world, although at the same time, until recently, in Russia it was impossible to withdraw funds to your bank account. <br><a name="habracut"></a><br>  The payment process on the site is implemented in the following way, the client logs in to the site, enters the necessary amount to replenish his personal account. <br><br><img src="https://habrastorage.org/files/e85/870/b2a/e85870b2a30145dc870caf5df62c98bf.jpg" height="250"><br><br>  Next, the form of the site redirects the user to the PayPal authorization and payment page, and, after successful payment, issues a corresponding message, redirecting the client to the personal account of the start site. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/3fa/b6e/766/3fab6e766c1842109ff8e760a5cd9d54.jpg" height="300"><br><br>  Actually the simplest form: <br><br><pre><code class="php hljs">&lt;form id=<span class="hljs-string"><span class="hljs-string">"paypal"</span></span> action=<span class="hljs-string"><span class="hljs-string">"https://www.paypal.com/cgi-bin/webscr"</span></span> method=<span class="hljs-string"><span class="hljs-string">"post"</span></span>&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"hidden"</span></span> id=<span class="hljs-string"><span class="hljs-string">"amount"</span></span> name=<span class="hljs-string"><span class="hljs-string">"amount"</span></span> value=<span class="hljs-string"><span class="hljs-string">""</span></span>/&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"hidden"</span></span> name=<span class="hljs-string"><span class="hljs-string">"cmd"</span></span> value=<span class="hljs-string"><span class="hljs-string">"_xclick"</span></span>/&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"hidden"</span></span> name=<span class="hljs-string"><span class="hljs-string">"business"</span></span> value=<span class="hljs-string"><span class="hljs-string">"  PayPal E-mail"</span></span>/&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"hidden"</span></span> name=<span class="hljs-string"><span class="hljs-string">"item_name"</span></span> value=<span class="hljs-string"><span class="hljs-string">" "</span></span>/&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"hidden"</span></span> name=<span class="hljs-string"><span class="hljs-string">"item_number"</span></span> value=<span class="hljs-string"><span class="hljs-string">"   ID "</span></span>/&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"hidden"</span></span> name=<span class="hljs-string"><span class="hljs-string">"currency_code"</span></span> value=<span class="hljs-string"><span class="hljs-string">""</span></span>/&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"hidden"</span></span> name=<span class="hljs-string"><span class="hljs-string">"button_subtype"</span></span> value=<span class="hljs-string"><span class="hljs-string">"services"</span></span>/&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"hidden"</span></span> name=<span class="hljs-string"><span class="hljs-string">"no_note"</span></span> value=<span class="hljs-string"><span class="hljs-string">"1"</span></span>/&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"hidden"</span></span> name=<span class="hljs-string"><span class="hljs-string">"no_shipping"</span></span> value=<span class="hljs-string"><span class="hljs-string">"1"</span></span>/&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"hidden"</span></span> name=<span class="hljs-string"><span class="hljs-string">"return"</span></span> value=<span class="hljs-string"><span class="hljs-string">" "</span></span>/&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"hidden"</span></span> name=<span class="hljs-string"><span class="hljs-string">"notify_url"</span></span> value=<span class="hljs-string"><span class="hljs-string">"  "</span></span>/&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"hidden"</span></span> name=<span class="hljs-string"><span class="hljs-string">"cancel_return"</span></span> value=<span class="hljs-string"><span class="hljs-string">",    "</span></span>/&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"hidden"</span></span> name=<span class="hljs-string"><span class="hljs-string">"bn"</span></span> value=<span class="hljs-string"><span class="hljs-string">"PP-BuyNowBF:btn_buynowCC_LG.gif:NonHostedGuest"</span></span>/&gt; &lt;img alt=<span class="hljs-string"><span class="hljs-string">""</span></span> border=<span class="hljs-string"><span class="hljs-string">"0"</span></span> src=<span class="hljs-string"><span class="hljs-string">"https://www.paypal.com/en_US/i/scr/pixel.gif"</span></span> width=<span class="hljs-string"><span class="hljs-string">"1"</span></span> height=<span class="hljs-string"><span class="hljs-string">"1"</span></span>/&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"submit"</span></span> value=<span class="hljs-string"><span class="hljs-string">""</span></span>/&gt; &lt;/form&gt;</code> </pre> <br><br>  We need PayPal to automatically transfer data on all payments, in real time, so that users of the site can instantly access their funds.  To do this, we enable the IPN (Instant payment notifications) feature in the Profile-My Selling Tools in the personal account of your PayPal account, specifying a link to receive notifications on your site. <br><br><img src="https://habrastorage.org/files/866/0ba/8a4/8660ba8a4571425b9b883384e63818c6.jpg" height="300"><br><br>  A piece of code for receiving notifications and entering payment data into the database.  Since the site uses PHP5, you must install the cURL library. <br><br><pre> <code class="php hljs">$postdata=<span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($_POST <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key=&gt;$value) $postdata.=$key.<span class="hljs-string"><span class="hljs-string">"="</span></span>.urlencode($value).<span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>; $postdata .= <span class="hljs-string"><span class="hljs-string">"cmd=_notify-validate"</span></span>; $curl = curl_init(<span class="hljs-string"><span class="hljs-string">"https://www.paypal.com/cgi-bin/webscr"</span></span>); curl_setopt ($curl, CURLOPT_HEADER, <span class="hljs-number"><span class="hljs-number">0</span></span>); curl_setopt ($curl, CURLOPT_POST, <span class="hljs-number"><span class="hljs-number">1</span></span>); curl_setopt ($curl, CURLOPT_POSTFIELDS, $postdata); curl_setopt ($curl, CURLOPT_SSL_VERIFYPEER, <span class="hljs-number"><span class="hljs-number">0</span></span>); curl_setopt ($curl, CURLOPT_RETURNTRANSFER, <span class="hljs-number"><span class="hljs-number">1</span></span>); curl_setopt ($curl, CURLOPT_SSL_VERIFYHOST, <span class="hljs-number"><span class="hljs-number">1</span></span>); $response = curl_exec ($curl); curl_close ($curl);</code> </pre> <br><br>  After the certificate was turned on, the notification form stopped working; accordingly, the data were no longer loaded in real time; after a little digging in the manuals of the official developers, I changed the code a little.  The hitch lies in the fact that in the PayPal sandbox the request is processed correctly, but when you switch to combat mode, the form refuses to accept the notification.  Therefore, it is necessary to change the corresponding variable in Curl (specified in the form). <br><br>  PayPal no longer supports the SSLv3 certificate due to the vulnerability, I also heard that when switching to https, many people refused to work IPN, in this case, you can simply make a separate subdomain of the payment.mysite.com type on port 80 that will receive all notifications from payment system. </div><p>Source: <a href="https://habr.com/ru/post/247261/">https://habr.com/ru/post/247261/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../247249/index.html">Zsh: fucky new year</a></li>
<li><a href="../247251/index.html">Programming Philosophy - Three-Way Programming</a></li>
<li><a href="../247253/index.html">Java Check State</a></li>
<li><a href="../247255/index.html">How to be friends with STM32</a></li>
<li><a href="../247257/index.html">Fitts law or how to use it</a></li>
<li><a href="../247263/index.html">Dagaz: Factorial is easy!</a></li>
<li><a href="../247265/index.html">Evolution of Zeus. Part III</a></li>
<li><a href="../247267/index.html">Win32 / Virlock - the first self-propagating extortionist</a></li>
<li><a href="../247269/index.html">Interesting on .Net hub for 2014</a></li>
<li><a href="../247271/index.html">PVS-Studio rummaged through the guts of Linux (3.18.1)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>