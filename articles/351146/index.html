<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Notes on meeting VR platform requirements</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I would like to share with you some small solutions that I used in developing an entertainment application for several VR platforms. T...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Notes on meeting VR platform requirements</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/61/lf/1t/61lf1t7figulegm2ppvxnvprzfw.png"><br><br>  In this article I would like to share with you some small solutions that I used in developing an entertainment application for several VR platforms.  The application itself is a video player (360 / 4K, FullHD / 2D, 2K / 3-Screen, streaming video stream, downloading to a file for offline playback).  The application menu is made in stylized 3D scenes for a specific movie.  3-Screen is the <a href="https://www.barco.com/en/product/barco-escape">Barco Escape</a> format, where the video consists of three screens. <br><br>  I needed to develop applications for platforms: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Oculus rift </li><li>  Oculus / Samsung GearVR </li><li>  Steam HTC Vive </li><li>  Google daydream </li><li>  iOS Cardboard </li><li>  Viveport HTC Vive </li></ul><a name="habracut"></a><br>  Testing equipment: <br><br><ul><li>  Samsung S6 (as minimum for GearVR) </li><li>  PC-desktop: i5-4590 / 8Gb / nVidia 970 (Oculus Rift / HTC Vive) </li><li>  Samsung S8 (for Google Daydream) </li><li>  iPhone 7 (for iOS) </li></ul><br><h4>  Optimization </h4><br>  <a href="https://developer.oculus.com/distribute/latest/concepts/publish-rift-app-submission/">Rift Virtual Reality Check (VRC) Guidelines</a> and <a href="https://developer.oculus.com/distribute/latest/concepts/publish-mobile-req/">Mobile Virtual Reality Check (VRC) Guidelines</a> - as the most demanding of hardware is best suited for the requirements basis  If you pass the review in Oculus then you will have no questions on performance on other platforms.  The application should work stably for 45 minutes with a performance of 60 fps on GearVR and with a performance of 90 fps on Rift.  For a start, you can fasten a hand-written frame counter and show it under the gun: <br><br><div class="spoiler">  <b class="spoiler_title">FPSCounter</b> <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine.UI; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FPSCounter</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> updateInterval = <span class="hljs-number"><span class="hljs-number">0.5F</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> tOut; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Text text; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> accum = <span class="hljs-number"><span class="hljs-number">0f</span></span>; <span class="hljs-comment"><span class="hljs-comment">// FPS accumulated over the interval private int frames = 0; // Frames drawn over the interval private float timeleft = 0f; // Left time for current interval private void Start() { timeleft = updateInterval; } private void Update() { timeleft -= Time.deltaTime; accum += Time.timeScale / Time.deltaTime; ++frames; if (timeleft &lt;= 0.0) { float fps = accum / frames; tOut = string.Format("{0:F0} FPS", fps); timeleft = updateInterval; accum = 0f; frames = 0; } if (text != null) { text.text = tOut; } } }</span></span></code> </pre> <br></div></div><br>  But it is better to use the <a href="https://developer.oculus.com/documentation/pcsdk/latest/concepts/dg-debug-tool/">Oculus Debug Tool</a> , where in the process of work statistics will be taken and drawn on the graph in real time over the application - utilities exist for both mobile devices and desktop (works with HTC Vive): <br><br><img src="https://habrastorage.org/webt/-g/mg/pd/-gmgpdasclbttqgdohsjjhzz4fe.png"><br><br>  Adhering to the standard rules, we managed to achieve proper performance: <br><br><ul><li>  polygon minimum </li><li>  baking light and reflections in textures (the camera does not imply movement) </li><li>  avoid transparency </li><li>  avoid multi-materials </li><li>  avoid overloaded shaders </li><li>  periodically test on devices right in the process of modeling the scene </li></ul><br><img src="https://habrastorage.org/webt/x0/sv/mr/x0svmr6sabbceng8vuny_a_he4c.png"><br><br>  When a 2D video is played on the stage, it is ‚Äúprojected‚Äù onto the screen, from which it is supposed to glow. <br><br><img src="https://habrastorage.org/webt/oo/a_/_l/ooa__lfhodvh-kuh3o-7wzvfl6e.png"><br><br>  For this, I had to write a special shader.  The material has a standard Diffuse texture, one illumination texture from the ‚Äúsun‚Äù, another illumination texture from the ‚Äúscreen‚Äù, the blend lighting parameter and the average color from the screen (reduced video frame texture).  At the beginning of playback, there is a smooth blending from daylight to screen, and then each video frame is compressed to the same color with which the lighting is painted. <br><br><img src="https://habrastorage.org/webt/de/8d/oy/de8doycd2qetndr3iopszvsicem.png"><br><br><div class="spoiler">  <b class="spoiler_title">Shader ColorLightmap</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">Shader "Onix/Unlit/ColorLightmap" { Properties { _Diffuse("Diffuse", <span class="hljs-number"><span class="hljs-number">2</span></span>D) = "white" {} [HideInInspector] _texcoord( "", <span class="hljs-number"><span class="hljs-number">2</span></span>D ) = "white" {} _LightmapWhite("LightmapWhite", <span class="hljs-number"><span class="hljs-number">2</span></span>D) = "white" {} [HideInInspector] _texcoord2( "", <span class="hljs-number"><span class="hljs-number">2</span></span>D ) = "white" {} _LightmapDark("LightmapDark", <span class="hljs-number"><span class="hljs-number">2</span></span>D) = "white" {} _LightColor("LightColor", <span class="hljs-number"><span class="hljs-number">2</span></span>D) = "white" {} _LightValue("LightValue", Range( <span class="hljs-number"><span class="hljs-number">0</span></span> , <span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0</span></span> } SubShader { Tags { "RenderType"="Opaque" "LightMode" = "ForwardBase" } LOD <span class="hljs-number"><span class="hljs-number">100</span></span> Cull <span class="hljs-keyword"><span class="hljs-keyword">Off</span></span> Pass { CGPROGRAM #pragma target <span class="hljs-number"><span class="hljs-number">3.0</span></span> #pragma vertex vert #pragma fragment frag #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "UnityCG.cginc" struct appdata { <span class="hljs-type"><span class="hljs-type">float4</span></span> vertex : POSITION; <span class="hljs-type"><span class="hljs-type">float4</span></span> texcoord : TEXCOORD0; <span class="hljs-type"><span class="hljs-type">float4</span></span> texcoord1 : TEXCOORD1; UNITY_VERTEX_INPUT_INSTANCE_ID }; struct v2f { <span class="hljs-type"><span class="hljs-type">float4</span></span> vertex : SV_POSITION; <span class="hljs-type"><span class="hljs-type">float4</span></span> texcoord : TEXCOORD0; <span class="hljs-type"><span class="hljs-type">float4</span></span> lightColor : COLOR; UNITY_VERTEX_OUTPUT_STEREO }; uniform sampler2D _Diffuse; uniform <span class="hljs-type"><span class="hljs-type">float4</span></span> _Diffuse_ST; uniform sampler2D _LightmapWhite; uniform <span class="hljs-type"><span class="hljs-type">float4</span></span> _LightmapWhite_ST; uniform sampler2D _LightmapDark; uniform <span class="hljs-type"><span class="hljs-type">float4</span></span> _LightmapDark_ST; uniform sampler2D _LightColor; uniform <span class="hljs-type"><span class="hljs-type">float</span></span> _LightValue; v2f vert ( appdata v ) { v2f o; UNITY_SETUP_INSTANCE_ID(v); UNITY_INITIALIZE_VERTEX_OUTPUT_STEREO(o); o.texcoord.xy = v.texcoord.xy; o.texcoord.zw = v.texcoord1.xy; // ase common <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> code o.vertex.xyz += float3(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>) ; o.vertex = UnityObjectToClipPos(v.vertex); o.lightColor = tex2Dlod(_LightColor, <span class="hljs-type"><span class="hljs-type">float4</span></span>(<span class="hljs-number"><span class="hljs-number">0.5</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">16.0</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> o; } fixed4 frag (v2f i ) : SV_Target { fixed4 myColorVar; // ase common <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> code float2 uv_Diffuse = i.texcoord.xy * _Diffuse_ST.xy + _Diffuse_ST.zw; float2 uv2_LightmapWhite = i.texcoord.zw * _LightmapWhite_ST.xy + _LightmapWhite_ST.zw; float2 uv2_LightmapDark = i.texcoord.zw * _LightmapDark_ST.xy + _LightmapDark_ST.zw; <span class="hljs-type"><span class="hljs-type">float4</span></span> lerpResult4 = lerp( tex2D( _LightmapWhite, uv2_LightmapWhite ) , ( tex2D( _LightmapDark, uv2_LightmapDark ) * i.lightColor) , _LightValue); <span class="hljs-type"><span class="hljs-type">float4</span></span> blendOpSrc10 = tex2D( _Diffuse, uv_Diffuse ); <span class="hljs-type"><span class="hljs-type">float4</span></span> blendOpDest10 = lerpResult4; myColorVar = ( saturate( ( blendOpDest10 &gt; <span class="hljs-number"><span class="hljs-number">0.5</span></span> ? ( <span class="hljs-number"><span class="hljs-number">1.0</span></span> - ( <span class="hljs-number"><span class="hljs-number">1.0</span></span> - <span class="hljs-number"><span class="hljs-number">2.0</span></span> * ( blendOpDest10 - <span class="hljs-number"><span class="hljs-number">0.5</span></span> ) ) * ( <span class="hljs-number"><span class="hljs-number">1.0</span></span> - blendOpSrc10 ) ) : ( <span class="hljs-number"><span class="hljs-number">2.0</span></span> * blendOpDest10 * blendOpSrc10 ) ) )); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> myColorVar; } ENDCG } } CustomEditor "ASEMaterialInspector" }</code> </pre><br></div></div><br>  The texture from the frame is the fastest to get and scale with RenderTexture and Graphics.Blit: <br><br><div class="spoiler">  <b class="spoiler_title">Frame scaling</b> <div class="spoiler_text"><pre> <code class="cs hljs">Texture texture = subPlayer.TextureProducer.GetTexture(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (texture != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_videoFrame == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _videoFrame = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RenderTexture(<span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, RenderTextureFormat.ARGB32); _videoFrame.useMipMap = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; _videoFrame.autoGenerateMips = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; _videoFrame.Create(); } _videoFrame.DiscardContents(); <span class="hljs-comment"><span class="hljs-comment">// blit to RT so we can average over some pixels Graphics.Blit(texture, _videoFrame); }</span></span></code> </pre><br></div></div><br><h4>  Smoothing </h4><br>  If your picture is still ‚Äúpixel‚Äù - you need to apply anti-aliasing, turn on mipmaps.  You can also use ResolutionScale for supported devices: <br><br><div class="spoiler">  <b class="spoiler_title">ResolutionScale</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (OVRPlugin.tiledMultiResSupported) { UnityEngine.XR.XRSettings.eyeTextureResolutionScale = <span class="hljs-number"><span class="hljs-number">1.2f</span></span>; OVRPlugin.tiledMultiResLevel = OVRPlugin.TiledMultiResLevel.LMSMedium; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { UnityEngine.XR.XRSettings.eyeTextureResolutionScale = <span class="hljs-number"><span class="hljs-number">1.1f</span></span>; }</code> </pre><br></div></div><br>  For antialiasing on a font in a UI, you can use a shader: <br><br><div class="spoiler">  <b class="spoiler_title">Shader AAFont</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">Shader "UI/AAFont" { Properties { [PerRendererData] _MainTex("Sprite Texture", <span class="hljs-number"><span class="hljs-number">2</span></span>D) = "white" {} _Color("Tint", Color) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) _StencilComp("Stencil Comparison", <span class="hljs-type"><span class="hljs-type">Float</span></span>) = <span class="hljs-number"><span class="hljs-number">8</span></span> _Stencil("Stencil ID", <span class="hljs-type"><span class="hljs-type">Float</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> _StencilOp("Stencil Operation", <span class="hljs-type"><span class="hljs-type">Float</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> _StencilWriteMask("Stencil Write Mask", <span class="hljs-type"><span class="hljs-type">Float</span></span>) = <span class="hljs-number"><span class="hljs-number">255</span></span> _StencilReadMask("Stencil Read Mask", <span class="hljs-type"><span class="hljs-type">Float</span></span>) = <span class="hljs-number"><span class="hljs-number">255</span></span> _ColorMask("Color Mask", <span class="hljs-type"><span class="hljs-type">Float</span></span>) = <span class="hljs-number"><span class="hljs-number">15</span></span> [Toggle(UNITY_UI_ALPHACLIP)] _UseUIAlphaClip("Use Alpha Clip", <span class="hljs-type"><span class="hljs-type">Float</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span> } SubShader { Tags { "Queue" = "Transparent" "IgnoreProjector" = "True" "RenderType" = "Transparent" "PreviewType" = "Plane" "CanUseSpriteAtlas" = "True" } Stencil { <span class="hljs-keyword"><span class="hljs-keyword">Ref</span></span>[_Stencil] Comp[_StencilComp] Pass[_StencilOp] ReadMask[_StencilReadMask] WriteMask[_StencilWriteMask] } Cull <span class="hljs-keyword"><span class="hljs-keyword">Off</span></span> Lighting <span class="hljs-keyword"><span class="hljs-keyword">Off</span></span> ZWrite <span class="hljs-keyword"><span class="hljs-keyword">Off</span></span> ZTest[unity_GUIZTestMode] Blend SrcAlpha OneMinusSrcAlpha ColorMask[_ColorMask] Pass { <span class="hljs-type"><span class="hljs-type">Name</span></span> "Default" CGPROGRAM #pragma vertex vert #pragma fragment frag #pragma target <span class="hljs-number"><span class="hljs-number">2.0</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "UnityCG.cginc" #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "UnityUI.cginc" #pragma multi_compile __ UNITY_UI_CLIP_RECT #pragma multi_compile __ UNITY_UI_ALPHACLIP struct appdata_t { <span class="hljs-type"><span class="hljs-type">float4</span></span> vertex : POSITION; <span class="hljs-type"><span class="hljs-type">float4</span></span> color : COLOR; float2 texcoord : TEXCOORD0; UNITY_VERTEX_INPUT_INSTANCE_ID }; struct v2f { <span class="hljs-type"><span class="hljs-type">float4</span></span> vertex : SV_POSITION; fixed4 color : COLOR; float2 texcoord : TEXCOORD0; <span class="hljs-type"><span class="hljs-type">float4</span></span> worldPosition : TEXCOORD1; UNITY_VERTEX_OUTPUT_STEREO }; fixed4 _Color; fixed4 _TextureSampleAdd; <span class="hljs-type"><span class="hljs-type">float4</span></span> _ClipRect; v2f vert(appdata_t v) { v2f <span class="hljs-keyword"><span class="hljs-keyword">OUT</span></span>; UNITY_SETUP_INSTANCE_ID(v); UNITY_INITIALIZE_VERTEX_OUTPUT_STEREO(<span class="hljs-keyword"><span class="hljs-keyword">OUT</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">OUT</span></span>.worldPosition = v.vertex; <span class="hljs-keyword"><span class="hljs-keyword">OUT</span></span>.vertex = UnityObjectToClipPos(<span class="hljs-keyword"><span class="hljs-keyword">OUT</span></span>.worldPosition); <span class="hljs-keyword"><span class="hljs-keyword">OUT</span></span>.texcoord = v.texcoord; <span class="hljs-keyword"><span class="hljs-keyword">OUT</span></span>.color = v.color * _Color; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OUT</span></span>; } sampler2D _MainTex; fixed4 frag(v2f <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>) : SV_Target { float2 dx = ddx(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.texcoord) * <span class="hljs-number"><span class="hljs-number">0.25</span></span>; float2 dy = ddy(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.texcoord) * <span class="hljs-number"><span class="hljs-number">0.25</span></span>; <span class="hljs-type"><span class="hljs-type">float4</span></span> tex0 = tex2D(_MainTex, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.texcoord + dx + dy); <span class="hljs-type"><span class="hljs-type">float4</span></span> tex1 = tex2D(_MainTex, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.texcoord + dx - dy); <span class="hljs-type"><span class="hljs-type">float4</span></span> tex2 = tex2D(_MainTex, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.texcoord - dx + dy); <span class="hljs-type"><span class="hljs-type">float4</span></span> tex3 = tex2D(_MainTex, <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.texcoord - dx - dy); <span class="hljs-type"><span class="hljs-type">float4</span></span> tex = (tex0 + tex1 + tex2 + tex3) * <span class="hljs-number"><span class="hljs-number">0.25</span></span>; half4 color = (tex + _TextureSampleAdd) * <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.color; #ifdef UNITY_UI_CLIP_RECT color.a *= UnityGet2DClipping(<span class="hljs-keyword"><span class="hljs-keyword">IN</span></span>.worldPosition.xy, _ClipRect); #endif #ifdef UNITY_UI_ALPHACLIP clip(color.a - <span class="hljs-number"><span class="hljs-number">0.001</span></span>); #endif <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> color; } ENDCG } } }</code> </pre><br></div></div><br><h4>  User interface </h4><br>  The <a href="https://assetstore.unity.com/packages/tools/gui/curved-ui-vr-ready-solution-to-bend-warp-your-canvas-53258">CurvedUI</a> plugin <a href="https://assetstore.unity.com/packages/tools/gui/curved-ui-vr-ready-solution-to-bend-warp-your-canvas-53258">does an</a> excellent job of quickly switching input methods on different VR platforms, as well as allowing the curvature of the canvas to a curved shape that is more pleasant for VR (sorry for breaking Dynamic batching). <br><br><img src="https://habrastorage.org/webt/ua/0k/n_/ua0kn_frrs3nxy4fjnttzltxm3o.png"><br><br><h4>  Playing video </h4><br>  Not long ago, Unity has improved and fixed many of the shortcomings of its Video Player.  Let ease of use, compatibility with different platforms and performance improved, but not enough to use it in the current application (due to problems with large file support, performance, codec support, video streaming).  Having tried many different solutions, I stopped at <a href="https://assetstore.unity.com/packages/tools/video/avpro-video-56355">AVProVideo</a> .  He is the only one who could provide adequate performance on both mobile devices and desktop solutions. <br><br>  Before publishing, do not forget to install Hardware Decoding.  To build the Oculus Rift, you need to install Use Unity Audio and add the Audio Output component - this way the user will hear the audio in the VR headset and not in the default Windows device (some users may have non-standard configurations). <br><br><img src="https://habrastorage.org/webt/ni/la/x_/nilax_5up8glfx6oks3l1uqrufo.png"><br><br>  360 video is played on the sphere around the user, 3-Screen on a 3-plane mesh. <br><br><img src="https://habrastorage.org/webt/j8/to/rv/j8torvg-qxkuezvs8iupnnbdpea.png"><br><br><h4>  File upload </h4><br>  You can upload files using WebClient and, in practice, standard methods. <br><br><div class="spoiler">  <b class="spoiler_title">Download File</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DownloadFile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { ServicePointManager.ServerCertificateValidationCallback = MyRemoteCertificateValidationCallback; _webClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebClient(); _webClient.DownloadFileCompleted += <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System.ComponentModel.AsyncCompletedEventHandler(AsyncCallDownloadComplete); _webClient.DownloadProgressChanged += <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DownloadProgressChangedEventHandler(AsyncCallDownloadProgress); _webClient.DownloadFileAsync(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(videoData.path), _lclPath); _isDownloading = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AsyncCallDownloadComplete</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, System.ComponentModel.AsyncCompletedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { _isDownloading = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.Error == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _dwnloadProgress = <span class="hljs-number"><span class="hljs-number">1f</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { _dwnloadProgress = <span class="hljs-number"><span class="hljs-number">0f</span></span>; File.Delete(_lclPath); Debug.Log(e.Error.Message); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AsyncCallDownloadProgress</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, DownloadProgressChangedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { _dwnloadProgress = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)e.ProgressPercentage / <span class="hljs-number"><span class="hljs-number">100f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.ProgressPercentage == <span class="hljs-number"><span class="hljs-number">100</span></span>) { _isDownloading = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; _dwnloadProgress = <span class="hljs-number"><span class="hljs-number">1f</span></span>; } }</code> </pre><br></div></div><br>  Additionally, you may need to verify the certificate: <br><br><div class="spoiler">  <b class="spoiler_title">Remote Certificate Validation</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Net; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Net.Security; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Security.Cryptography.X509Certificates; <span class="hljs-comment"><span class="hljs-comment">//To validate SSL certificates public static bool MyRemoteCertificateValidationCallback(System.Object sender, X509Certificate certificate, X509Chain chain, SslPolicyErrors sslPolicyErrors) { bool isOk = true; // If there are errors in the certificate chain, look at each error to determine the cause. if (sslPolicyErrors != SslPolicyErrors.None) { for (int i = 0; i &lt; chain.ChainStatus.Length; i++) { if (chain.ChainStatus[i].Status != X509ChainStatusFlags.RevocationStatusUnknown) { chain.ChainPolicy.RevocationFlag = X509RevocationFlag.EntireChain; chain.ChainPolicy.RevocationMode = X509RevocationMode.Online; chain.ChainPolicy.UrlRetrievalTimeout = new TimeSpan(0, 1, 0); chain.ChainPolicy.VerificationFlags = X509VerificationFlags.AllFlags; bool chainIsValid = chain.Build((X509Certificate2)certificate); if (!chainIsValid) { isOk = false; } } } } return isOk; }</span></span></code> </pre><br></div></div><br>  You can save along the way: <br><br><div class="spoiler">  <b class="spoiler_title">Data path</b> <div class="spoiler_text"><pre> <code class="cs hljs">_lclPath = Application.persistentDataPath + filename;</code> </pre><br></div></div><br><h4>  Notes </h4><br>  And now a list of small notes and solutions that may be needed when porting or developing an application on a VR platform.  I wanted to use only standard plug-ins for VR, which are already included in the editor, but as it turned out, this is not possible.  To meet the requirements of the platform you will have to integrate plugins from the platform to implement some of the buns. <br><br>  Oculus  The application must support the ReCenter function: <br><br><div class="spoiler">  <b class="spoiler_title">ReCenter</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (OVRPlugin.shouldRecenter) { ReCenter(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReCenter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { UnityEngine.XR.InputTracking.Recenter(); }</code> </pre> <br></div></div><br>  Gearvr.  The application should offer its exit menu from the application: <br><br><div class="spoiler">  <b class="spoiler_title">Confirm Quit</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//OVRManager.PlatformUIConfirmQuit(); //or OVRPlugin.ShowUI(OVRPlugin.PlatformUI.ConfirmQuit);</span></span></code> </pre><br></div></div><br>  If you need to disable the positioning of the helmet in space, you can use this script.  Attention!  It contradicts the requirements of the platform. <br><br><div class="spoiler">  <b class="spoiler_title">VRMoveHack</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">VRMoveHack</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform vrroot; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Transform mTransform; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Vector3 initialPosition; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { mTransform = GetComponent&lt;Transform&gt;(); initialPosition = mTransform.position; <span class="hljs-comment"><span class="hljs-comment">//Disabling position breaks the head model on Gear VR, and is against the Rift store guidelines. //I would recommend instead of disabling positional tracking, to give a bubble on rift of ~1m that if the player leaves the screen fades to black. //If you have to disable positional tracking, at least add back in the head model, which consists of a position shift of 0.075f * camera up + 0.0805f * camera forward. initialPosition += (mTransform.up * 0.075f) + (mTransform.forward * 0.0805f); } private void LateUpdate() { Vector3 vrpos; vrpos = mTransform.TransformPoint(vrroot.localPosition); vrpos = mTransform.InverseTransformPoint(vrpos); mTransform.position = initialPosition - vrpos; } }</span></span></code> </pre><br></div></div><br>  Daydream.  For the Daydream platform, when you click on the icon back, the application should exit, here is a script that can help with the back button on all platforms: <br><br><div class="spoiler">  <b class="spoiler_title">Escape / Back</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EscapeScene</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> System.Action OnEscape; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> MYGOOGLEVR </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (Input.GetKeyDown(KeyCode.Escape)) Application.Quit(); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (GvrControllerInput.AppButtonDown) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (Input.GetKeyDown(KeyCode.Escape) || Input.GetButtonDown("Cancel") || Input.GetKeyDown(KeyCode.JoystickButton2)) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (OnEscape != null) OnEscape.Invoke(); } } }</span></span></code> </pre><br></div></div><br>  Gearvr.  Your application will not be checked on the latest versions of the OS and can be rejected.  Build with Mininum API Level: Android 5.0 (API level 21), otherwise write in the comments to the review that you need to test the application on devices with the latest OS version. <br><br>  GearVR / Rift.  In order not to get an incomprehensible failure due to VRC.Mobile.Security, load the assembly into the ALPHA and RC channel, as well as the STORE before release. <br><br>  iOS.  Do not forget to attach a document / contract regarding the use of third-party content, if you use one.  I was lucky to get to the ‚Äúexperienced‚Äù reviewer, whom I described with text and screenshots of how to use the cardboard system, where to go to test in-apps and the operation of the application. <br><br>  Viveport.  For the platform, it is desirable to integrate the SDK to enable DRM.  You can use an automatic Wrapper-based DRM, but only if you are not using the implemented with .Net framework.  I did if the application fails validation - it closes. <br><br>  Steam.  The store does not contain a section for entertainment applications, so video content is best published separately in the Video section, or in the Software section.  Perhaps that is why the <a href="http://store.steampowered.com/app/616810/Maski_VR/">Maski</a> application is located in the Software / Video Production section. <br><br>  Feature.  If you make a site request for ‚Äúfeature‚Äù.  Your application will be considered in more detail.  They may ask to remove help (Google), add additional icons to user interface buttons (Google), ask for more anti-aliasing (Oculus), ask to make some elements of the environment dynamic, for example, waves on water (Oculus). <br><br>  Oculus: Review my project / code.  <a href="https://developer.oculus.com/distribute/latest/concepts/publish-feedback/">Oculus</a> has the ability to request engineers to review your project.  You provide the source code, and in a couple of days you get a project with changes, optimization tips and improvements.  Some of them may be common, and some will be specific, which can only be implemented on the Oculus platform. <br><br>  If necessary, you need to check whether there is access to the Internet and display a message to the user.  It is necessary to display any information about the error or when a scene or content is loaded for a long time (‚ÄúLoading‚Äù, ‚ÄùBuffering‚Äù, ‚ÄùCheck your internet connection and try again.‚Äù, Etc.).  Otherwise, the application will be considered faulty. <br><br><div class="spoiler">  <b class="spoiler_title">Internet reachability</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Application.internetReachability == NetworkReachability.NotReachable)</code> </pre><br></div></div><br>  When removing a VR helmet, the application should pause.  To catch this event, you can use the standard method: <br><br><div class="spoiler">  <b class="spoiler_title">Application pause</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnApplicationPause</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pause</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//do pause }</span></span></code> </pre><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/351146/">https://habr.com/ru/post/351146/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../351136/index.html">10 nuances that you need to pay attention to when choosing a VPS hosting</a></li>
<li><a href="../351138/index.html">How to optimize DevOps using machine learning</a></li>
<li><a href="../351140/index.html">Battery change: UPS on Li-Ion technology</a></li>
<li><a href="../351142/index.html">What makes an owl in ZeroNights 2017 Crackme # 3?</a></li>
<li><a href="../351144/index.html">About life, freedom and the pursuit of happiness user API</a></li>
<li><a href="../351148/index.html">Richard Hamming: Chapter 5. The History of Computers ‚Äî A Practical Application</a></li>
<li><a href="../351150/index.html">Web-based devices</a></li>
<li><a href="../351152/index.html">Immersing in templates and taming Windows GPO</a></li>
<li><a href="../351154/index.html">How to take the right person to the team - preparing for the interview</a></li>
<li><a href="../351156/index.html">No need to complicate! Or how can redpolitika help promote your solutions to users?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>