<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Work with SignalR from Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="So, after much torment, finally, I managed to figure out all the functionality (which I needed for my work), which is in the Signal R library for Andr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Work with SignalR from Android</h1><div class="post__text post__text-html js-mediator-article">  So, after much torment, finally, I managed to figure out all the functionality (which I needed for my work), which is in the Signal R library for Android. <br><br>  The most important thing is jar files that our program needs to connect and work with the server. <br>  You can download them from my site, although you can also make them out of <a href="https://github.com/SignalR/java-client">Github</a> : <br>  <a href="">http://smartarmenia.com/android_libs/signalr-client-sdk.jar</a> <br>  <a href="">http://smartarmenia.com/android_libs/signalr-client-sdk-android.jar</a> <br><a name="habracut"></a><br>  We also need the gson library, which can be added from maven dependencies in Android Studio or downloaded from google for Eclipse. <br><br>  So, after adding these libraries to the libs folder of our project, you can already connect to the server. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I will do everything from the service and AsyncTask by my example, how and where to do - you will decide for yourself. <br><br>  The first thing to do is call a static method before we start using signalr in Android. <br><br><pre><code class="java hljs">Platform.loadPlatformComponent(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AndroidPlatformComponent());</code> </pre> <br><br>  Then we create a connection and hub (s): <br><br><pre> <code class="java hljs">HubConnection connection = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HubConnection(<span class="hljs-string"><span class="hljs-string">"signalr_host"</span></span>); HubProxy mainHubProxy = connection.createHubProxy(<span class="hljs-string"><span class="hljs-string">"MainHub"</span></span>);</code> </pre><br><br>  After that we need to catch state_change events to control our connection. <br><br><pre> <code class="java hljs">connection.stateChanged(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StateChangedCallback() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stateChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ConnectionState connectionState, ConnectionState connectionState2)</span></span></span><span class="hljs-function"> </span></span>{ Log.i(<span class="hljs-string"><span class="hljs-string">"SignalR"</span></span>, connectionState.name() + <span class="hljs-string"><span class="hljs-string">"-&gt;"</span></span> + connectionState2.name()); } });</code> </pre><br>  this is for changing state (Disconnected, Connecting, Connected, Reconnecting) <br><br>  Now we catch the disconnect event: <br><br><pre> <code class="java hljs">connection.closed(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Runnable() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Log.i(<span class="hljs-string"><span class="hljs-string">"SignalR"</span></span>, <span class="hljs-string"><span class="hljs-string">"Closed"</span></span>); connectSignalr(); } });</code> </pre><br><br>  The function that calls the AsyncTask connection (this function must be called at the beginning of the service and when Disconnect (Close)): <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">connectSignalr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { SignalRConnectTask signalRConnectTask = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SignalRConnectTask(); signalRConnectTask.execute(connection); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex) { ex.printStackTrace(); } }</code> </pre><br><br>  Code class SignalRConnectTask: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SignalRConnectTask</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AsyncTask</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doInBackground</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object[] objects)</span></span></span><span class="hljs-function"> </span></span>{ HubConnection connection = (HubConnection) objects[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Thread.sleep(<span class="hljs-number"><span class="hljs-number">2000</span></span>); connection.start().get(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (InterruptedException e) { e.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ExecutionException e) { e.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } }</code> </pre><br><br>  We already have a working connection to the server.  In the future, we will need to subscribe to events or call hub functions. <br><br>  <b>subscribe</b> <br><br><pre> <code class="java hljs">mainHubProxy.subscribe(<span class="hljs-string"><span class="hljs-string">"newClient"</span></span>).addReceivedHandler(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Action&lt;JsonElement[]&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(JsonElement[] jsonElements)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ Log.i(<span class="hljs-string"><span class="hljs-string">"SignalR"</span></span>, <span class="hljs-string"><span class="hljs-string">"Message From Server: "</span></span> + jsonElements[<span class="hljs-number"><span class="hljs-number">0</span></span>].getAsString()); } });</code> </pre><br><br>  In the jsonElements array, the data that the server sent us, they can be of any serializable type.  Basically we know what type they are and can convert to the desired type.  Do it yourself, but if you have questions or need examples, write in the comments. <br><br>  <b>invoke</b> <br><br>  This is to call the hub method.  We have 2 options, a method call that returns a result and returns nothing (Void). <br><br>  First, look at Void: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SignalRTestActionTask</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AsyncTask</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doInBackground</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object[] objects)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (connection.getState() == ConnectionState.Connected) { Object param1 = objects[<span class="hljs-number"><span class="hljs-number">0</span></span>]; Object param2 = objects[<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { mainHubProxy.invoke(<span class="hljs-string"><span class="hljs-string">"TestMethod"</span></span>, param1, param2).get(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (InterruptedException e) { e.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ExecutionException e) { e.printStackTrace(); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPostExecute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object o)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onPostExecute(o); } } <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SignalRTestActionTask().execute(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object());</code> </pre><br><br>  Again, create an AsyncTask to complete the task. <br><br>  Now we will do the same for another variant invoke, which returns the result. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SignalRTestActionWithResultTask</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AsyncTask</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doInBackground</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object[] objects)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (connection.getState() == ConnectionState.Connected) { Object result = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; Object param1 = objects[<span class="hljs-number"><span class="hljs-number">0</span></span>]; Object param2 = objects[<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { result = mainHubProxy.invoke(Object.class, <span class="hljs-string"><span class="hljs-string">"TestMethod"</span></span>, param1, param2).get(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (InterruptedException e) { e.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ExecutionException e) { e.printStackTrace(); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPostExecute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object o)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onPostExecute(o); <span class="hljs-comment"><span class="hljs-comment">//    . } } new SignalRTestActionWithResultTask().execute(new Object(), new Object());</span></span></code> </pre><br><br>  It's simple. <br><br>  Then it was time to deserialize json into classes. <br><br>  For example, our method in signalr returns a String - and we know that. <br>  To do this, we simply pass the function invoke to the type of the result of the method and the result obtained using gson converts the data to the desired type. <br><br><pre> <code class="java hljs">String result = mainHubProxy.invoke(String.class, <span class="hljs-string"><span class="hljs-string">"TestMethod"</span></span>, param1, param2).get();</code> </pre><br><br>  When the json array arrives, the type is passed to the array, so: <br><br><pre> <code class="java hljs">String[] result = mainHubProxy.invoke(String[].class, <span class="hljs-string"><span class="hljs-string">"TestMethod"</span></span>, param1, param2).get();</code> </pre><br><br>  Well, our array can easily be converted to a List: <br><br><pre> <code class="java hljs">List&lt;String&gt; strings = Arrays.asList(result);</code> </pre><br><br>  As a return type, you can specify any type that can be serialized, for example, we can create our own class with the object's json structure.  But these are the wonders of the gson library, to which this article is not dedicated. <br><br>  That's all, I guess.  If you have questions and / or comments, write, we will understand together. </div><p>Source: <a href="https://habr.com/ru/post/301752/">https://habr.com/ru/post/301752/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../301738/index.html">Invitation to the conference "Payment innovations and alternative payment systems" for Habr users</a></li>
<li><a href="../301742/index.html">Science of self-control: is it possible to develop willpower?</a></li>
<li><a href="../301744/index.html">Welcome to Symfony Moscow Meetup June 2</a></li>
<li><a href="../301746/index.html">VKS equipment for meeting rooms</a></li>
<li><a href="../301750/index.html">Developer .NET developer workstation or the difficulty of choosing the perfect configuration</a></li>
<li><a href="../301754/index.html">‚ÄúWe try to ensure that User Experience does not differ in different operating systems‚Äù - Interview with Rider developers from JetBrains</a></li>
<li><a href="../301756/index.html">FreePBX and CallBack: see caller numbers</a></li>
<li><a href="../301760/index.html">Creating a blog on symfony 2.8 lts</a></li>
<li><a href="../301764/index.html">Learning from mistakes in the organization of quality control</a></li>
<li><a href="../301766/index.html">JPoint Student Day: why conference "student day"?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>