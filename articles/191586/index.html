<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Custom layout. Pop-up panel + parallax scrolling</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello colleagues. 

 Today I wanted to tell you how you can create a non-standard layout manager and breathe life into it with animations. 
 We in Dat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Custom layout. Pop-up panel + parallax scrolling</h1><div class="post__text post__text-html js-mediator-article">  Hello colleagues. <br><br>  Today I wanted to tell you how you can create a non-standard layout manager and breathe life into it with animations. <br>  We in DataArt often need to implement non-standard components for customer applications, so I have gained some experience in this business, which I decided to share. <br>  As an example, I decided to implement an analogue of a panel emerging from the bottom that is often found on social networks.  Typically, this technique is used when you need to show content, for example, a photo, and add the ability to comment on an additional socket that the user can pull from below.  At the same time, the main content usually also floats up, but a little slower than the main panel.  This is called "parallax scrolling." <br>  Especially for this article, I decided to implement a similar component from scratch.  Just want to note that this is not a complete, stable and ready for production code, but just a demonstration, written a couple of hours to show the basic techniques. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Expand existing component </h4><br>  For ease of implementation, I decided not to extend the ViewGroup from scratch, but to inherit from FrameLayout.  This will eliminate the need to implement basic routine things, such as measuring children, layout, etc., but at the same time provide enough flexibility to implement our venture. <br>  So, create the class DraggablePanelLayout. <br>  The first thing we want to do is modify the layout procedure so that the top layer is shifted down, and only part of it looks out.  To do this, override onLayout: <br><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onLayout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> changed, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> left, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> top, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> right, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bottom)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onLayout(changed, left, top, right, bottom); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getChildCount() != <span class="hljs-number"><span class="hljs-number">2</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalStateException(<span class="hljs-string"><span class="hljs-string">"DraggedPanelLayout must have 2 children!"</span></span>); } bottomPanel = getChildAt(<span class="hljs-number"><span class="hljs-number">0</span></span>); bottomPanel.layout(left, top, right, bottom - bottomPanelPeekHeight); slidingPanel = getChildAt(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!opened) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> panelMeasuredHeight = slidingPanel.getMeasuredHeight(); slidingPanel.layout(left, bottom - bottomPanelPeekHeight, right, bottom - bottomPanelPeekHeight + panelMeasuredHeight); } }</code> </pre> <br><br>  Everything is simple here: we restrict our layout so that it can store only two descendants.  Then forcibly move the upper child down and squeeze the bottom of the bottom.  Let's do the simplest layout and see what we got: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">com.dataart.animtest.DraggedPanelLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:tools</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/tools"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:dp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/com.dataart.animtest"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dp:bottom_panel_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"64dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tools:context</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".MainActivity"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FrameLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@drawable/stripes"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ImageView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:contentDescription</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@drawable/android"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FrameLayout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FrameLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#FFFFFF"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/hello_world"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center_horizontal"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/random_button"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FrameLayout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">com.dataart.animtest.DraggedPanelLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br><img src="https://habrastorage.org/storage3/b85/808/ec9/b85808ec9ccb8be074f88999e5f9af9c.png"><br><br>  As you can see, the bottom panel has successfully shifted down.  What we need. <br><br><h4>  Add finger dragging </h4><br>  To implement dragging the panel with your finger, you need to override the onTouchEvent method.  Here, when we press with our finger (ACTION_DOWN), we will remember where the user clicked, then with his finger (ACTION_MOVE), we will shift our panels, and finally, with ACTION_UP, we will complete the action.  Completing the action is perhaps the most interesting task, but more on that later. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTouchEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MotionEvent event)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.getAction() == MotionEvent.ACTION_DOWN) { startDragging(event); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.getAction() == MotionEvent.ACTION_MOVE) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (touching) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> translation = event.getY() - touchY; translation = boundTranslation(translation); slidingPanel.setTranslationY(translation); bottomPanel .setTranslationY((<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) (opened ? -(getMeasuredHeight() - bottomPanelPeekHeight - translation) * parallaxFactor : translation * parallaxFactor)); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.getAction() == MotionEvent.ACTION_UP) { isBeingDragged = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; touching = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre><br><br>  Everything is simple here.  The method of boundTranslation limits the movement of the panel with a finger within the screen, setTranslation sets the offset. <br><br><blockquote>  Here I want to make a small digression and talk about layout and translation.  Layout is the process of arranging your markup, i.e., for each View, its size and position on the screen is determined recursively.  As it is not difficult to guess, this is a costly operation.  That is why it is not recommended to perform this procedure during animation, if you just do not want to get the effect of braking animation.  The translation property, in turn, allows you to set a cheap displacement of an element relative to a given position without performing the layout of the entire hierarchy.  This is very useful for animations.  In addition to translation, the View has properties such as Rotation, Scale.  It is also possible to do more advanced transformations by creating a subclass of the desired component and performing the necessary transformations of the canvas.  An example of this can be seen in my previous article about animating a ListView. </blockquote><br><br>  Once again, but briefly and caps.  The main rule for animations - <b>DO NOT EXECUTE LAYOUT !!!</b> <br><br><h4>  End gesture </h4><br>  So, we have learned to move our panel with our fingers, now we need to add the completion of the gesture.  That is, if the user removes the finger, we will adhere to the following logic: <br><ol><li>  If the panel speed is high enough, bring the panel to the end and transfer the component to the opposite state. </li><li>  If the speed is not high, check if the user has passed the panel through half the distance.  If yes, continue driving at a fixed speed, otherwise - return the panel to its original state. </li></ol><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">finishAnimateToFinalPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> velocityY)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> flinging = Math.abs(velocityY) &gt; <span class="hljs-number"><span class="hljs-number">0.5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> opening; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> distY; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> duration; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (flinging) { opening = velocityY &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>; distY = calculateDistance(opening); duration = Math.abs(Math.round(distY / velocityY)); animatePanel(opening, distY, duration); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> halfway = Math.abs(slidingPanel.getTranslationY()) &gt;= (getMeasuredHeight() - bottomPanelPeekHeight) / <span class="hljs-number"><span class="hljs-number">2</span></span>; opening = opened ? !halfway : halfway; distY = calculateDistance(opening); duration = Math.round(<span class="hljs-number"><span class="hljs-number">300</span></span> * (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>) Math.abs((<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>) slidingPanel.getTranslationY()) / (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>) (getMeasuredHeight() - bottomPanelPeekHeight)); } animatePanel(opening, distY, duration); }</code> </pre><br><br>  The method above implements this logic.  To calculate the speed, use the built-in class VelocityTracker. <br>  Finally, create an ObjectAnimator and complete the animation: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">animatePanel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> opening, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> distY, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> duration)</span></span></span><span class="hljs-function"> </span></span>{ ObjectAnimator slidingPanelAnimator = ObjectAnimator.ofFloat(slidingPanel, View.TRANSLATION_Y, slidingPanel.getTranslationY(), slidingPanel.getTranslationY() + distY); ObjectAnimator bottomPanelAnimator = ObjectAnimator.ofFloat(bottomPanel, View.TRANSLATION_Y, bottomPanel.getTranslationY(), bottomPanel.getTranslationY() + (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) (distY * parallaxFactor)); AnimatorSet set = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AnimatorSet(); set.playTogether(slidingPanelAnimator, bottomPanelAnimator); set.setDuration(duration); set.setInterpolator(sDecelerator); set.addListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyAnimListener(opening)); set.start(); }</code> </pre><br><br>  When the animation is completed, we transfer the component to a new state, reset the offset and execute the layout. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAnimationEnd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Animator animation)</span></span></span><span class="hljs-function"> </span></span>{ setOpenedState(opening); bottomPanel.setTranslationY(<span class="hljs-number"><span class="hljs-number">0</span></span>); slidingPanel.setTranslationY(<span class="hljs-number"><span class="hljs-number">0</span></span>); requestLayout(); }</code> </pre><br><br><h4>  Interception touch'a other elements </h4><br>  Now, if we place, for example, a button on our socket, we see that if we try to pull the panel by pressing a button with our finger, we will not be able to do this.  The button will click, but our panel will remain fixed.  This is because the button <br>  The touch event ‚Äústeals‚Äù the panel and handles it itself. <br>  The standard approach is to intercept an event, make sure that we really pull the panel, and not just clicked a button, and take control from the button, completely capturing it with our component.  Specifically for this, View has an onInterceptTouchEvent method.  The logic of this method and the interaction with onTouchEvent is very nontrivial, but well written in the documentation. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onInterceptTouchEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MotionEvent event)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.getAction() == MotionEvent.ACTION_DOWN) { touchY = event.getY(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.getAction() == MotionEvent.ACTION_MOVE) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Math.abs(touchY - event.getY()) &gt; touchSlop) { isBeingDragged = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; startDragging(event); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.getAction() == MotionEvent.ACTION_UP) { isBeingDragged = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> isBeingDragged; }</code> </pre><br><br>  In our implementation, we check if the user has moved the finger enough (touchSlop) before returning true (which means that we have taken control). <br>  Done, now the user can press a button and start moving the panel anywhere.  The button simply does not register a click, but will receive an ACTION_CANCEL event. <br><br><h4>  Completion </h4><br>  This article describes the basic approach to the implementation of animated markup.  Of course, a full-fledged implementation will require taking into account some additional factors, but, starting with what is described here, it is easy to adapt it to your needs. <br><br>  All source components are available on <a href="https://github.com/TheHiddenDuck/draggable-panel-layout">github</a> .  In addition to what is described in the article, the implementation adds: <br><ol><li>  drawing shadows between panels; </li><li>  custom attributes; </li><li>  Use hardware layers to speed up animation. </li></ol><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/191586/">https://habr.com/ru/post/191586/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../191572/index.html">NASA Develops Laser Satellite / Rover Communication System</a></li>
<li><a href="../191574/index.html">Metric # 20 - Podcast on technologies and design of interfaces and services</a></li>
<li><a href="../191576/index.html">PDB files are available for download in DXperience and Universal subscriptions.</a></li>
<li><a href="../191580/index.html">Core Data for iOS. Chapter number 2. Theoretical part</a></li>
<li><a href="../191584/index.html">Dream office: what is it?</a></li>
<li><a href="../191588/index.html">We refuse sample template parameters.</a></li>
<li><a href="../191590/index.html">ROI Initiative Digest</a></li>
<li><a href="../191592/index.html">VKontakte Node JS SDK</a></li>
<li><a href="../191594/index.html">Sonar principles and underwater acoustics: how, why and why</a></li>
<li><a href="../191596/index.html">Solving the transport problem with a genetic algorithm as part of SOA</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>