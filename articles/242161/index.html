<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The work of the web project in an unstable connection</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, my name is Alexander Zelenin, I am a web developer. Today I want to tell you how sites can work in an unstable connection as promised . Simply ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The work of the web project in an unstable connection</h1><div class="post__text post__text-html js-mediator-article">  Hello, my name is Alexander Zelenin, I am a web developer.  Today I want to tell you how sites can work in an unstable connection <sub><a href="http://habrahabr.ru/post/240775/">as promised</a></sub> .  Simply put, what to do if you turn off the Internet, and you need to earn money. <br><br>  Consider 3 examples: an <b>online store</b> , a <b>cinema</b> and an <b>online player</b> .  For the store and the cinema, there is also a division into 2 parts - what to do on the user side and on the operator / seller side. <br><a name="habracut"></a><br><br>  I will not argue because of what problems occur with the connection and separate them in any way.  Also, in this article, the loss of connection is considered as a rare case, and not a permanent state.  For such a function requires contact with the server at least once a day.  Each task has many options to solve it.  It makes no sense to write "it was possible to simply store in memory, there is no need to write in LocalStorage", thanks.  I also note that I did not specifically write any code in the article, since  in each case, an individual approach is required, and over time, storage limitations or peculiarities of browsers may change, but the essence will remain the same. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I apologize if some technical solutions are no longer relevant - I will try to describe the principle of implementation.  If somewhere is wrong - I will be glad for comments and corrections. <br><br>  All this will work in the case of OnePageApplication, in other cases, think out the solutions yourself :-) <br><br><h1>  Situations: </h1><br><h3>  Online store </h3><br><h4>  From the user: </h4><br>  You climb pages, select products, add to cart.  Suddenly, the connection with the store disappears.  Immediately, a window appears with a list of already stored goods and a specially formed phone number, when you call, the user will get to the operator, who will immediately specify where to deliver everything and whether you want something else.  Especially applicable to food delivery.  It happens, the Internet is turned off when you already enter a phone number, click on the next step, and get a connection error.  A back will not return and the phone number does not look.  Order is lost. <br><br><h4>  Operator </h4><br>  The operator has the opportunity on a separate page to see the orders "in progress", also receives messages about lost customers.  If the user has been logged in, he can be called back (directly in the browser), or upon receiving a call with an extension number, ATC immediately displays information about the order.  Everyone is happy. <br><br><h3>  Cinema </h3><br>  The possibility of online ticket ordering + operator interface working through a browser (maybe a separate program, this does not change the essence) with instant sending of data about tickets purchased to the server. <br><br><h4>  From the cashier: </h4><br>  Internet was cut out, tickets must be printed, so that they were not bought online.  The browser blocks a certain number of places (the projected number of purchases online), the rest can be selected / printed without problems.  Data is accumulated and recovered as soon as the connection appears.  If the places run out, the operator contacts the person in charge of the site‚Äôs work, and the latter has the opportunity to allocate another lot for sale offline and the cashier to manually add them as ‚Äúfree‚Äù. <br><br><h4>  From the customer when buying online. </h4><br>  The client sees a message on the site that there is no connection with the cinema's box office, but still has the opportunity to buy a limited number of tickets (or the ability to book tickets by phone by calling directly from the browser).  Special unique QR code is printed on the tickets, which is checked for compliance when entering the hall. <br><br><h3>  Online player </h3><br>  Now, many are abandoning collections of music on their hard drive in favor of online listening.  It would seem that solid pluses - the place on the disk does not end, you can replenish the collection in a couple of clicks, it is always on all devices. <br>  But here the Internet is disconnected, and you sit without music.  Not cool. <br>  How do you like that, for example, "favorite" tracks are always available?  It is already better when there are at least a couple hundred tracks. <br><br><h1>  Implementation </h1><br>  <b>How to determine that the server is not available (from the client)?</b> <br>  We keep a constant socket connection, when disconnected, we block parts of the interface that are responsible for switching to new pages, leaving only the ‚Äúcached‚Äù functionality. <br><br>  <b>How to determine that the client (user, operator workstation) have fallen off?</b> <br>  Yes, exactly the same.  Of course, you need to give at least a couple of seconds to reconnect before you panic. <br><br><h3>  Online player </h3><br>  The main problem is the storage of tracks on the client side.  First, you need to understand what we store and in what form.  We store, of course, playlists, tracks, and some meta information about them. <br><br>  <b>How to store tracks?</b> <br>  Base64 or any textual representation of the file. <br><br>  <b>How to play from a string?</b> <br>  The easiest way is to simply generate an audio element with the source: ‚Äúdata: audio / wav; base64, ...‚Äù.  There are lots of libraries, it will not be difficult to find them. <br><br>  <b>Wait, so this is no streaming, playing only after the download?</b> <br>  In part, yes.  But here, too, have their own tricks.  You can split the file into parts, and start playing as soon as the first part loads.  With proper selection of sizes will be almost indistinguishable from streaming.  Yes, this is an additional cost for special file storage. <br><br>  <b>So, well, and where do we keep it?</b> <br>  Here it is more difficult.  Depending on the situation (browser, device, etc.) we need to use different storage. <br>  <a href="http://habrahabr.ru/post/213515/">IndexedDB</a> : firefox and chrome on mobile devices, chrome, firefox, IE on desktops <br>  <a href="http://habrahabr.ru/post/84654/">WebSQL</a> : android browser, safari, ios web view on mobile, safari on desktops <br>  SessionStorage for android browser, if 200mb websql is not enough.  But keep in mind that saving is only for the session. <br>  In general, for mobile devices, it is better, of course, to release an application. <br><br>  <b>What is the result then?</b> <br>  The user has disconnected the Internet, giving access to the page with your favorite tracks / playlists, playing from the repository on request :-) <br><br><h3>  Cinema </h3><br><h4>  For cash </h4><br>  Task: work when there is no connection to the main service. <br><br>  <b>What data to store?</b> <br>  Information about sessions for a couple of days, tickets sold, ‚Äúpredictable‚Äù online sales, places reserved for online tickets in case of connection loss. <br><br>  <b>Where to store?</b> <br>  In this case, LocalStorage with 5mb should be enough for more than. <br><br>  <b>Work mechanism</b> <br>  Connection lost -&gt; we limit the space in the interface, mark the tickets sold with a flag that they are not saved.  For the operator, in general, nothing changes.  When a connection appears, we send updated data, we obtain data about online tickets sold and sessions for the next couple of days <br><br><h4>  On the site (if the cashier is unavailable) </h4><br>  <b>Objective:</b> do not sell tickets that can be sold at the box office. <br><br>  <b>Solution: We</b> mark in advance the predicted number of places as ‚Äúonline purchases‚Äù; in case of loss of the connection, we sell only them or offer the opportunity to call the cashier. <br><br><h4>  On the site (if client connection breaks) </h4><br>  <b>Task:</b> show a grid of sessions, prices, phone numbers for booking. <br><br>  <b>Solution:</b> immediately load this data into LocalStorage, display when connection is lost. <br><br><h3>  Online store </h3><br><h4>  On the client </h4><br>  When you first add a product, a socket connection is established, we get a unique extension number.  On subsequent uploads, the data is also sent to the server.  Meta data of goods and identifiers are added to LocalStorage, the graph is preloaded.  In case of connection breakdown, we display all the information on the goods, telephone and extension number. <br><br><h4>  On server </h4><br>  We save data on all the goods with reference to the extension number.  When calling, the PBX sends the extension number, and the operator immediately displays all the information on the order. <br>  If it was an authorized client, and we know his phone number - you can immediately make a call. <br><br><h1>  Total </h1><br>  Deciding whether the introduction of such systems costs, of course you. <br>  The main advantage is that the user does not need to install any additional software, add-ins, etc.  Everything works right away. <br>  I am pleased to answer questions and tell you about more specific implementations. </div><p>Source: <a href="https://habr.com/ru/post/242161/">https://habr.com/ru/post/242161/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../242147/index.html">Split text into sentences by a linguistic-independent method using the example of the AIF library</a></li>
<li><a href="../242149/index.html">Moderation Theory</a></li>
<li><a href="../242151/index.html">Alternative programming environment for Arduino - FLProg</a></li>
<li><a href="../242155/index.html">IBM launches humanitarian initiatives to combat Ebola</a></li>
<li><a href="../242159/index.html">7 things that I would like to know before entering the master / graduate school abroad</a></li>
<li><a href="../242167/index.html">SensioLabs PHP Profiler - blackfire.io (SensioLabsProfiler)</a></li>
<li><a href="../242173/index.html">Strutext C ++ word processing library - lexical implementation</a></li>
<li><a href="../242175/index.html">Facebook, hidden services and https certificates</a></li>
<li><a href="../242179/index.html">REST / CRUD. Am I cooking it wrong?</a></li>
<li><a href="../242185/index.html">Unified dynamic corporate signature with Postfix + alterMIME + addAttachFilter + Active Directory or MySQL logo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>