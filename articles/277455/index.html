<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How is the "compatibility" of financial transactions on rough IT-examples</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The core of the Moscow Exchange implements both the functions of directly registering and conducting transactions, and the clearing functions. For exa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How is the "compatibility" of financial transactions on rough IT-examples</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/143/7b5/ae6/1437b5ae640e491e9f9507b9dd0b00df.png"><br><br>  The core of the Moscow Exchange implements both the functions of directly registering and conducting transactions, and the clearing functions.  For example, the same stock exchanges in New York and London carried it into a separate module, so that if one of the fronts fall, do not stop all trades, but simply degrade in terms of possible services. <br><br>  But it's not about that.  In this post, I will talk about why we need a clearing system at all and how the deal is conducted between, for example, the Netherlands and Moscow. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To begin with, in some cases, exchanges and banks, of course, do not change money and securities immediately and instantly.  The procedure is very similar to write-caching: than to make thousands of single Random IO, it is better to write several blocks at once in sequence.  There is also the maximum allowable amount of debt for the period - this is the cache size in our comparison. <br><br>  Plus, of course, neither the money nor the shares go to the final participants of the transaction - they ‚Äúphysically‚Äù fall in the depository, and you get a ‚Äúpointer‚Äù to them. <a name="habracut"></a><br><br><h4>  How then do financial institutions interrelate? </h4><br>  They save mutual debts to each other and close them at the end of the period.  For example, if we are talking about two Russian banks, then in a day there are many operations between them.  For example, 40 customers of Bank A transferred a total of 5 million rubles to Bank B, and another 30 customers of Bank B transferred 4 million rubles to Bank A. on the same day. <br><br><img src="https://habrastorage.org/files/c6d/0b6/245/c6d0b624555a402680b43e2bfe8e7fa9.png"><br><br>  Accordingly, at the end of the trading day, transactions between banks will not be 70 units for a total of 9 million rubles, but only one per 1 million: <br><br><img src="https://habrastorage.org/files/373/918/33a/37391833a8db4061823ef15a4b8d3fbd.png"><br><br>  This makes clearing.  In fact, of course, the situation is somewhat more complicated, and there are not two banks involved in it, but all those that are in clearing.  And there are situations when Bank A owes Bank B, Bank B owes Bank C, Bank C - Bank D, and Bank D - Bank A. As a result, as in the well-known problem of $ 100, the economy begins to spin even before fact there is money.  And clearing makes sure that for each bank there is a minimum of incoming and outgoing transactions. <br><br><h4>  That is why physical persons cannot be traded on the stock exchange. </h4><br>  Just because of this architecture (simplified) of netting in transactions with securities, only those who have a license for brokerage activities can trade in securities.  And that is why you, as an individual, cannot take and buy shares.  You must give instructions to your broker (this may be your own bank, for example, VTB24, Alpha and Sberbank have excellent tools for this), and the broker will already buy the necessary securities. <br><br>  So (again, very simplistic) it looks like: <br><br><img src="https://habrastorage.org/files/762/031/a40/762031a404624ed9b401eb3ad1dcc45d.png"><br><br>  If we consider brokers as production servers, you as a user, an exchange as a router, and a depository of securities as a data storage system, it will be clear why we need a ‚Äúfinancial cache‚Äù. <br><br><h4>  What is this "financial cache"? </h4><br>  Imagine that you decided to buy shares of Google from someone from Europe.  For example, you made an order to buy at a certain price on the stock exchange, and at this moment a private investor from Europe decided to sell several of his shares and just made a deal with you. <br><br>  The exchange helped you find each other, which played a long route with other exchanges and was able to forward the connection between you. <br><br>  Since securities can be viewed as an ordinary physical commodity like potatoes, then you can meet somewhere in the forest, conclude a purchase and sale agreement in two languages, certify translations from a notary, check everything for compliance with the laws of the two countries and exchange papers for money.  The money will go on standard bank routing.  But it is expensive, long and completely unnecessary, as a rule. <br><br>  Therefore, you are using the same exchange for a deal.  Securities are, again very roughly, records in the database with the designation that it is who released it and to whom it belongs.  In the simple case, transactions within the country (even within a single depositary of the bank) simply change the ownership of the shares and not move them anywhere. <br><br>  But different countries and different financial organizations have different depositories.  Why?  Because it is the depositary, in fact, is the very cache that determines the possible amount of mutual settlements at the end of the period.  That is, if you have already made deals for 500 million rubles in one direction, and you owe 300 million, but your depository is limited to only 500 million, you will not be able to make new purchase transactions.  Because from the point of view of the financial system, right now you are at zero - and only after clearing you will be at plus 200. If you will.  And we must either wait for the next period, or increase the cache. <br><br>  In the role of the Russian cache is NSD - the national settlement depository (NKO CJSC NSD).  Architecturally, it is part of the Moscow Stock Exchange and is included in its ‚Äúcluster‚Äù as an integral part. <br><br>  OK, that is, there are routers-exchanges and depositories, right?  What then when calculating with Germany? <br><br><img src="https://habrastorage.org/files/143/7b5/ae6/1437b5ae640e491e9f9507b9dd0b00df.png"><br><br>  <b>That is, it is a multi-rank network, where, simplifying:</b> <br><ul><li>  At the lowest level, the bank simply changes the ownership of the securities in its database (its depository). </li><li>  At a higher level inside the country, the main exchange of this country counts banks as part of its clearing. </li><li>  But even higher, there is a problem with the fact that the ‚Äúformats‚Äù of two different countries do not match, they have different depositories and there are a lot of difficulties.  Therefore, we need an integration point.  The role of the integration server is the international clearing system, which also accumulates mutual debts for the period, and then optimizes them and reduces them to the minimum number of transactions. </li></ul><br><h4>  What is this system that ‚Äúbefriends‚Äù the exchange with each other? </h4><br>  There are several such systems, but for example we will look at Euroclear (we work with our ETF for Russia through it, so I know fine details better than other systems).  So, Euroclear is a Belgian bank, on the basis of which this system exists - in fact, this is a <b>bridge between exchanges of different countries</b> . <br><br><blockquote>  ‚ÄúThe Euroclear system includes 2400 participants from 80 countries, most of which are banks, broker-dealers and other institutions professionally involved in managing new issues of securities, acting as market makers, trading or storing a large number of securities accepted by the system Euroclear  In the third quarter of 1997, about 98,000 securities were accepted for servicing in the Euroclear system.  The value of the securities of participants in the Euroclear system at the end of 1996 was $ 2.116 billion. ‚Äù <br>  <i>Quote from <a href="https://www.nsd.ru/common/img/uploaded/files/depo/02/02-42.pdf">www.nsd.ru/common/img/uploaded/files/depo/02/02-42.pdf</a></i> <br></blockquote><br><br>  From the point of view of the National Settlement Commission, we are settling only with one company - Euroclear, and Eurocler already understands how to proceed further as a black box.  Each country works in the same way: there is a depository where Euroclear has, again simplifying, the right to write, and there is an API that allows you to give him instructions. <br><br>  If you buy our cluster ETFs from a retailer in the Netherlands on the NYSE Euronext (secondary market), a fairly simple operation takes place.  From the point of view of Euroclear, the Russian depositary gave the task of moving the security (ETF) to itself, and in return promised money.  Since we have the DVP mode (delivery vs. payment), Euroclar takes ETF-papers from the Dutch depository and puts it ‚Äúin itself‚Äù (in fact, without moving anything, but working with the pointer).  Then he takes the money from our depository and also drags "in himself."  That is, at this moment we don‚Äôt owe the Dutch money, but the Dutch give us the shares, and we owe the money to Euroclear, and the European Clicker shares.  Similarly, the Germans owe Euroclear a share, and Euroclear a money to them. <br><br>  The size of the debt is determined by the size of the depositories.  In DVP mode, the transaction will not be completed if there is not enough free money in NSD, and a sufficient number of required securities in the Dutch depository.  At the same time, NSD will not believe Euroclear if it does not have a similar resource.  That is, each of the participants guarantees a deal with their ‚Äúcache‚Äù.  All operational risks are eliminated by our clearing NCC (it has large own funds, it makes a pledge assessment, an assessment of the participants' ability).  NCC is directly capitalized by the Central Bank to minimize the risks of trading through the central counterparty.  Naturally, NSD and NCC do not believe you if your broker‚Äôs free cash is less than the amount of the transaction. <br><br>  Plus external financial control, plus other overheads. <br><br>  Then, in the clearing process, all these operations are performed, and the Euroclar quickly exchanges shares for money, and then not only sends you pointers to resources, but ‚Äúphysically‚Äù swaps resources in depositories.  This entire procedure, together with the checks, takes two standard trading days, and therefore ETFs are bought in T + 2 mode. <br><br><h4>  Stop, but an ETF is also a cluster of shares, isn't it? </h4><br>  Yes, one ETF paper is actually a piece of a cluster, for example, from a huge portfolio of shares of US IT companies or global IT companies.  But at the same time, all market participants work with ETF as with one security, and not as a package deal, because virtualization is achieved one more level lower.  In fact, an ETF issuer is a legal entity that bought shares of IT companies according to certain rules and issued its shares.  From the point of view of the exchange, this is one company, and from your point of view it is an index. <br><br><h4>  So what happened in the end? </h4><br>  In order to pass the transaction from the point of view of Euroclear, we make a DVP calculation through NRM with the help of the NCC.  NSD holds a nominally large account, and NCC makes calculations for all market participants. <br><br>  If a more complex deal is needed, for example, with America, a situation is possible with the emergence of another network rank - this is when the Euroclear prokidyvaet bridge to a similar American system. <br><br>  So everything is cleverly twisted. <br><br>  What does this mean in simple words? <br><ul><li>  Banks, exchanges and systems like Euroclear are the transport and logical level of the financial network. </li><li>  Brokers are proxy structures or something like NAT systems. </li><li>  National depositories define the ‚Äúthickness‚Äù of channels between countries. </li><li>  National clearing centers identify switching capabilities and do packet processing. </li><li>  Securities and money are packages. </li><li>  ETF and other index funds are an analogue of the overlay network on top of the ‚Äúordinary‚Äù financial network. </li></ul><br>  Naturally, everything is not quite so much more complicated and more fun (forgive the limitations of these comparisons).  But I think in general terms the task of integration is clear. <br><br>  So, five years ago, we had to make ETFs begin to be listed on the Moscow Exchange, that is, they could be ‚Äúcompatible‚Äù with the NCC, that is, they could be part of NSD.  This was to be achieved both by legal and IT means.  Therefore, in the next post I will talk about how we all connected and automated the workflow. <br><br><h4>  And links: </h4><br><ul><li>  About <a href="http://habrahabr.ru/company/finex/blog/271449/">why you need only 10 people</a> to manage an asset of billions of dollars (IT infrastructure in Habr√©) </li><li>  <a href="http://geektimes.ru/company/finex/blog/266186/">What is ETF</a> (buying a piece of a cluster of shares of T + 2) </li><li>  <a href="http://habrahabr.ru/company/finex/blog/273651/">IT risks when buying stocks</a> </li><li>  <a href="http://geektimes.ru/company/finex/blog/268314/">Why I do not believe in banks in 15 years</a> </li><li>  <a href="https://geektimes.ru/company/finex/blog/269368/">How to buy a piece of Google from Russia, and what are the pitfalls</a> </li><li>  And <a href="http://geektimes.ru/company/finex/blog/268086/">what generally traded on the stock exchange and why prices change so quickly</a> . </li></ul></div><p>Source: <a href="https://habr.com/ru/post/277455/">https://habr.com/ru/post/277455/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../277445/index.html">Use OpenShift (deployment example)</a></li>
<li><a href="../277447/index.html">We return ICQ to life (ICQ). Designer's opinion</a></li>
<li><a href="../277449/index.html">Web file manager Sprut.IO in OpenSource</a></li>
<li><a href="../277451/index.html">Dynamic data binding in HTML and JS</a></li>
<li><a href="../277453/index.html">Neon: Node + Rust</a></li>
<li><a href="../277457/index.html">We test the layout correctly</a></li>
<li><a href="../277459/index.html">Automating stock purchases: large transaction processing architecture</a></li>
<li><a href="../277461/index.html">Traits out of the box</a></li>
<li><a href="../277463/index.html">Xeon Phi: Why do coprocessors use to create trading applications</a></li>
<li><a href="../277465/index.html">Initialized controllers in symfony and working with annotations</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>