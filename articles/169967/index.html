<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Homemade IR Remote for iRobot Roomba</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A survey in my previous post ‚ÄúControlling the iRobot Roomba using a vacuum cleaner via IR‚Äù showed that the community is interested in finding out how ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Homemade IR Remote for iRobot Roomba</h1><div class="post__text post__text-html js-mediator-article">  A survey in my previous post <a href="http://habrahabr.ru/post/168033/">‚ÄúControlling the iRobot Roomba using a vacuum cleaner via IR‚Äù</a> showed that the community is interested in finding out how to make the IR remote itself for Roomb's.  So, welcome!  =) <br><img src="https://habrastorage.org/storage2/5dc/e7d/5e8/5dce7d5e802368aef17e2ed4c54417c2.jpg"><br><a name="habracut"></a><br><br>  Remote control scheme: <br><br><img src="https://habrastorage.org/storage2/349/d3b/d39/349d3bd39d113f5a49b64717b096ae88.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>I used:</i> <br><ul><li>  MK ATTINY2313A-SU, </li><li>  DTSM-20 buttons, </li><li>  transistor BC846, </li><li>  SMD LED for indication, </li><li>  IR diode L-34F3C, </li><li>  Quartz at 7.3728 MHz. </li><li>  several resistors and capacitors. </li></ul><br><br>  Initially, I planned to make a ‚ÄúSpartan‚Äù option - a board with buttons in heat shrinkage, but then I decided to put everything in the case.  The case chose from what is on sale, I liked the <a href="http://www.gainta.com/g401.html">GAINTA G401</a> .  Under it and made a fee: <br><br><img src="https://habrastorage.org/storage2/2bf/acc/df3/2bfaccdf32831bb5fed62f7b22a596b7.png"><br><br>  Button functions: <br>  SW1 - Dock <br>  SW2 - Pause / Power <br>  SW3 - Forward Left <br>  SW4 - Clean <br>  SW5 - Left <br>  SW6 - Forward <br>  SW7 - Spot <br>  SW8 - Right <br>  SW9 - Forward Right <br><br>  As it turned out later, the SW2 button, which, by design, sends the ‚ÄúPause‚Äù command when pressed, but with a long press of the ‚ÄúPower‚Äù button, is not needed, because  these functions are performed by the ‚ÄúClean‚Äù button.  It works the same way as the button on the robot vacuum cleaner itself: short press to clean, to stop during operation, and long press to turn off.  T.ch.  if anyone repeats the console - just do not install SW2. <br><br><div class="spoiler">  <b class="spoiler_title">Program listing</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*   - Irobot Roomba.    Atmel ATTINY2313A. FUSE-: Fuse Low Byte: CKDIV|CKOUT|SUT|SKSEL| 0 | 1 |10 |0100 | 0x64 Default 1 | 1 |10 |1100 | 0b11101100=0xEC   3-8  */</span></span> <span class="hljs-comment"><span class="hljs-comment">//#define F_CPU 7.3728E6 //#define __AVR_ATtiny2313A__ #include &lt;avr/io.h&gt; #include &lt;avr/interrupt.h&gt; #include &lt;avr/sleep.h&gt; /*------&lt;&gt;-----*/ // 39477  // 25,3 : #define P_GEN {TCNT0=0; PORTB |= 0x8; while (TCNT0 &lt; 93); PORTB &amp;= ~0x8; while (TCNT0 &lt; 186);} //Roomba : #define LEFT 129 #define FORWARD 130 #define RIGHT 131 #define SPOT 132 #define DOCK 133 #define CLEAN 136 #define PAUSE 137 #define POWER 138 #define FORWARD_LEFT 139 #define FORWARD_RIGHT 140 #define TEST 170 /*----------------&lt;:&gt;----------------*/ void init(void) { //    /1: CLKPR = (1&lt;&lt;CLKPCE); CLKPR = (0&lt;&lt;CLKPS0)|(0&lt;&lt;CLKPS1)|(0&lt;&lt;CLKPS2)|(0&lt;&lt;CLKPS3); // : PORTD = 0xFF; DDRD = 0x0; PORTB = (1&lt;&lt;PORTB0)|(1&lt;&lt;PORTB1)|(1&lt;&lt;PORTB2); DDRB = (1&lt;&lt;DDB3)|(1&lt;&lt;DDB4); // : GIMSK = 0x30; //(1&lt;&lt;PCIE)|(1&lt;&lt;4); PCMSK = 0x3; //(1&lt;&lt;PCINT0)|(1&lt;&lt;PCINT1); PCMSK2 = 0x7F; } void ir_tx(unsigned char data_ir) { PORTB |= (1&lt;&lt;PB4); //  /*  : 1: __________ 2862uS |988uS |_____ 0: _____ 887uS| 2862uS |__________    ~16870 uS */ unsigned char cnt; // : TCCR0B = (0&lt;&lt;CS12)|(0&lt;&lt;CS11)|(1&lt;&lt;CS10); //   f/1 TCCR1B = (0&lt;&lt;CS12)|(1&lt;&lt;CS11)|(1&lt;&lt;CS10); //   f/64 for (cnt=0; cnt&lt;8; cnt++) { TCNT1=0; if (data_ir &amp; (0x80 &gt;&gt; cnt)) { // 1 while (TCNT1 &lt; 330) P_GEN; while (TCNT1 &lt; (330+114)) ; } else { // 0 while (TCNT1 &lt; 113) P_GEN; while (TCNT1 &lt; (330+114)) ; } } TCNT1=0; while (TCNT1 &lt; 1950) ; PORTB &amp;= ~(1&lt;&lt;PB4); //  } void send_command(void) { volatile unsigned char button_b; volatile unsigned char button_d; volatile unsigned char button_b_new; volatile unsigned char button_d_new; unsigned char pause_cnt = 0; TCCR1B = (0&lt;&lt;CS12)|(1&lt;&lt;CS11)|(1&lt;&lt;CS10); // f/64 TCNT1=0; while (TCNT1 &lt; 346); //346 -  3 ms button_b = ~PINB &amp; ((1&lt;&lt;PINB0)|(1&lt;&lt;PINB1)); button_d = ~PIND &amp; 0x7F; button_b_new = button_b; button_d_new = button_d; while ((button_b == button_b_new)&amp;&amp;(button_d == button_d_new)) { if ((button_b_new == 0) &amp;&amp; (button_d_new == 0)) break; if (button_b == (1&lt;&lt;PINB0)) {ir_tx(DOCK);} if ((pause_cnt &lt; 20) &amp;&amp; (button_b == (1&lt;&lt;PINB1))) {ir_tx(PAUSE); pause_cnt++;} if (pause_cnt &gt;= 20) {ir_tx(POWER);} if (button_d == (1&lt;&lt;PIND0)) {ir_tx(FORWARD_LEFT);} if (button_d == (1&lt;&lt;PIND1)) {ir_tx(CLEAN);} if (button_d == (1&lt;&lt;PIND2)) {ir_tx(LEFT);} if (button_d == (1&lt;&lt;PIND3)) {ir_tx(FORWARD);} if (button_d == (1&lt;&lt;PIND4)) {ir_tx(SPOT);} if (button_d == (1&lt;&lt;PIND5)) {ir_tx(RIGHT);} if (button_d == (1&lt;&lt;PIND6)) {ir_tx(FORWARD_RIGHT);} button_b_new = ~PINB &amp; ((1&lt;&lt;PINB0)|(1&lt;&lt;PINB1)); button_d_new = ~PIND &amp; 0x7F; } } /*----------------------&lt; :&gt;------------------------*/ ISR(PCINT_B_vect) { cli(); send_command(); sei(); } ISR(PCINT_D_vect) { cli(); send_command(); sei(); } /*-----------------&lt;  &gt;-----------------------*/ int main(void) { init(); sei(); for(;;) { set_sleep_mode(SLEEP_MODE_PWR_DOWN); sleep_mode(); } }</span></span></code> </pre> <br></div></div><br><br>  Photo assembly: <br><br><img src="https://habrastorage.org/storage2/482/fa1/9b0/482fa19b0f0dd9661e5ed1a35f7ccbbc.jpg"><br><br>  Signatures of the buttons, of course, look clumsy - now I understand that engraving is not an easy task!  :) <br><br>  The board itself: <br><br><img src="https://habrastorage.org/storage2/953/d66/851/953d66851e365ea15971a18a1f613ad5.jpg"><br><br><img src="https://habrastorage.org/storage2/fdc/3f0/61d/fdc3f061df7c1bacd7ccecae2f307769.jpg"><br><br>  The conductors that were supposed to perform on the reverse side made wires. <br><br>  Video demonstrating the work: <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/4RjTE6N_hWc%3Ffeature%3Doembed&amp;xid=17259,15700002,15700023,15700186,15700191,15700253&amp;usg=ALkJrhgnIhQbAxqj-_c_WcUUsVb5_SMA9Q" frameborder="0" allowfullscreen=""></iframe><br><br><hr><br>  KiCAD project files: <a href="http://yadi.sk/d/fgkfv9Qj2jJjz">RemoteControlPCB.zip</a> . <br>  Firmware: <a href="http://yadi.sk/d/Sb_X5YH42jKdX">RoombaRemoteControl.elf.hex</a> . <br><br>  For firmware via USBasp programmer, avrdude program: <br><pre> <code class="bash hljs">avrdude -p t2313 -c usbasp -U flash:w:./RoombaRemoteControl.elf.hex</code> </pre><br>  Firmware fuse-bits for working with quartz: <br><pre> <code class="bash hljs">avrdude -p t2313 -c usbasp -U lfuse:w:0xEC:m</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/169967/">https://habr.com/ru/post/169967/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../169953/index.html">How to secure yourself on Facebook</a></li>
<li><a href="../169957/index.html">Who writes WebKit?</a></li>
<li><a href="../169959/index.html">WebSockets support added to trunk nginx</a></li>
<li><a href="../169961/index.html">Employment portals: an unexpected marketing tool</a></li>
<li><a href="../169965/index.html">Android: [DirectoryBind] A simple way to link an external sd card and internal memory to make room</a></li>
<li><a href="../169969/index.html">Facebook as an important tool for promoting mobile applications</a></li>
<li><a href="../169975/index.html">Dell's All-Russian IT Solutions Forum: registration is open!</a></li>
<li><a href="../169977/index.html">I invented Erlang because it did not exist.</a></li>
<li><a href="../169979/index.html">Sony Xperia Tablet Z</a></li>
<li><a href="../169981/index.html">Kolobok on a visit at Windows 8: development diaries (part 1)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>