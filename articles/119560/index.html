<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Client class goo.gl and API setup</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="UPD: The repository is now on Github . 

 Hello colleagues! 

 I remember that in my time I was very pleased with the news that the Google API shorten...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Client class goo.gl and API setup</h1><div class="post__text post__text-html js-mediator-article">  <b>UPD: The</b> repository is now on <a href="https://github.com/igrishaev/googl-python">Github</a> . <br><br>  Hello colleagues! <br><br>  I remember that in my time I was very pleased with the <a href="http://habrahabr.ru/blogs/google/111611/">news</a> that the <a href="http://goo.gl/">Google</a> API <a href="http://goo.gl/">shortening URLs</a> had official APIs.  At that time, I was just developing an application that often needed to shorten news feed links.  I just screwed bit.ly, but was tempted to try a new service from Google.  Using the documentation, I in a few hours sketched out the basic functionality and embedded the script in the project. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Over time, changes were made to the script, and, finally, I decided to add comments to the code, write simple documentation and put everything on the <a href="http://code.google.com/p/python-googl-client/">Google code</a> . <br><br>  The main features and features of the class from competitors: <a name="habracut"></a><br><ul><li>  Small size (150 lines), all in one module, no need to connect a heavy official <a href="http://code.google.com/p/google-api-python-client/">python client</a> ; </li><li>  Full API coverage, unlike a <a href="http://code.google.com/p/python-googl/">similar project</a> ; </li><li>  Comments and documentation in the code; </li><li>  Support authorization through ClientLogin + function to get it; </li><li>  Additional initialization parameters, if your API has restrictions on the referer or IP; </li></ul><br>  For more than three months I managed to reduce about 12,000 unique links and in general I am very pleased with the service.  Below I want to give examples of code and tell you how to configure the API for maximum performance. <br><br>  To use a class, you must first obtain an API key.  In general, you can use the shortcut without a key, but then your limits are extremely small.  Go to <a href="http://code.google.com/apis/console/">the API console</a> page, click ‚ÄúAdd project‚Äù and turn on the URL Shortener API (the last one in the list) in the list of available services. <br><br><img src="https://habrastorage.org/storage/5153bb70/8d8bc093/9657b9af/fc35ecba.png"><br><br>  On the tab ‚ÄúProject home‚Äù in the sub-item ‚ÄúAPI access‚Äù your key will be written: <br><br><img src="https://habrastorage.org/storage/6d31f97d/9175d83d/1d676af8/3d06e06c.png"><br><br>  For now, let's skip the description of authentication and restriction of requests, let's see the class in action: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> googl client = googl.Googl(<span class="hljs-string"><span class="hljs-string">"MyAPIAccessKey"</span></span>) result = client.shorten(<span class="hljs-string"><span class="hljs-string">"http://code.google.com/p/python-googl-client/"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> result &gt;&gt;&gt; {<span class="hljs-string"><span class="hljs-string">u'kind'</span></span>: <span class="hljs-string"><span class="hljs-string">u'urlshortener#url'</span></span>, <span class="hljs-string"><span class="hljs-string">u'id'</span></span>: <span class="hljs-string"><span class="hljs-string">u'http://goo.gl/67TaW'</span></span>, <span class="hljs-string"><span class="hljs-string">u'longUrl'</span></span>: <span class="hljs-string"><span class="hljs-string">u'http://code.google.com/p/python-googl-client/'</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> client.expand(result[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]) &gt;&gt;&gt; {<span class="hljs-string"><span class="hljs-string">u'status'</span></span>: <span class="hljs-string"><span class="hljs-string">u'OK'</span></span>, <span class="hljs-string"><span class="hljs-string">u'kind'</span></span>: <span class="hljs-string"><span class="hljs-string">u'urlshortener#url'</span></span>, <span class="hljs-string"><span class="hljs-string">u'id'</span></span>: <span class="hljs-string"><span class="hljs-string">u'http://goo.gl/67TaW'</span></span>, <span class="hljs-string"><span class="hljs-string">u'longUrl'</span></span>: <span class="hljs-string"><span class="hljs-string">u'http://code.google.com/p/python-googl-client/'</span></span>}</code> </pre> <br>  We performed the simplest actions: we got a short link from a long link and vice versa: we extracted information about the original from a short link. <br><br>  To get additional statistics on clicks and time periods, pass an additional parameter projection to the expand () method; its value can be one of the constants with the PROJ_ prefix: <br><pre> <code class="python hljs">info = client.expand(<span class="hljs-string"><span class="hljs-string">'http://goo.gl/67TaW'</span></span>, projection=googl.PROJ_FULL)</code> </pre><br>  This will return to us something like this: <br><pre> <code class="hljs python">{ <span class="hljs-string"><span class="hljs-string">u'status'</span></span>: <span class="hljs-string"><span class="hljs-string">u'OK'</span></span>, <span class="hljs-string"><span class="hljs-string">u'kind'</span></span>: <span class="hljs-string"><span class="hljs-string">u'urlshortener#url'</span></span>, <span class="hljs-string"><span class="hljs-string">u'created'</span></span>: <span class="hljs-string"><span class="hljs-string">u'2011-05-19T05:47:13.058+00:00'</span></span>, <span class="hljs-string"><span class="hljs-string">u'analytics'</span></span>: { <span class="hljs-string"><span class="hljs-string">u'week'</span></span>: { <span class="hljs-string"><span class="hljs-string">u'shortUrlClicks'</span></span>: <span class="hljs-string"><span class="hljs-string">u'0'</span></span>, <span class="hljs-string"><span class="hljs-string">u'longUrlClicks'</span></span>: <span class="hljs-string"><span class="hljs-string">u'1'</span></span> }, <span class="hljs-string"><span class="hljs-string">u'allTime'</span></span>: { <span class="hljs-string"><span class="hljs-string">u'shortUrlClicks'</span></span>: <span class="hljs-string"><span class="hljs-string">u'0'</span></span>, <span class="hljs-string"><span class="hljs-string">u'longUrlClicks'</span></span>: <span class="hljs-string"><span class="hljs-string">u'1'</span></span> }, <span class="hljs-string"><span class="hljs-string">u'twoHours'</span></span>: { <span class="hljs-string"><span class="hljs-string">u'shortUrlClicks'</span></span>: <span class="hljs-string"><span class="hljs-string">u'0'</span></span>, <span class="hljs-string"><span class="hljs-string">u'longUrlClicks'</span></span>: <span class="hljs-string"><span class="hljs-string">u'1'</span></span> }, <span class="hljs-string"><span class="hljs-string">u'day'</span></span>: { <span class="hljs-string"><span class="hljs-string">u'shortUrlClicks'</span></span>: <span class="hljs-string"><span class="hljs-string">u'0'</span></span>, <span class="hljs-string"><span class="hljs-string">u'longUrlClicks'</span></span>: <span class="hljs-string"><span class="hljs-string">u'1'</span></span> }, <span class="hljs-string"><span class="hljs-string">u'month'</span></span>: { <span class="hljs-string"><span class="hljs-string">u'shortUrlClicks'</span></span>: <span class="hljs-string"><span class="hljs-string">u'0'</span></span>, <span class="hljs-string"><span class="hljs-string">u'longUrlClicks'</span></span>: <span class="hljs-string"><span class="hljs-string">u'1'</span></span> } }, <span class="hljs-string"><span class="hljs-string">u'longUrl'</span></span>: <span class="hljs-string"><span class="hljs-string">u'http://code.google.com/p/python-googl-client/'</span></span>, <span class="hljs-string"><span class="hljs-string">u'id'</span></span>: <span class="hljs-string"><span class="hljs-string">u'http://goo.gl/67TaW'</span></span> }</code> </pre><br>  The meaning of each field is described in the <a href="http://code.google.com/intl/en/apis/urlshortener/v1/getting_started.html">documentation</a> . <br><br>  Now consider the authorization.  Authorization is necessary for Google to make sure that Pupkin fulfilled the request, not Sumkin.  Firstly, it gives access to statistics, and secondly, it significantly raises the limits.  Authorization can be done in two ways: <a href="http://code.google.com/apis/accounts/docs/OAuth.html">OAuth</a> and <a href="http://code.google.com/apis/accounts/docs/AuthForInstalledApps.html">ClientLogin</a> .  So far I have implemented the second method, since  it is simpler (I will screw OAuth later).  To request a token, you must install the <a href="http://code.google.com/p/gdata-python-client/">gdata-python-client</a> library and call the get_client_login () function, passing it the login and password from your account.  Set the received token in the class initialization, after which each request will become authorized: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> googl client_login = googl.get_client_login(<span class="hljs-string"><span class="hljs-string">"login"</span></span>, <span class="hljs-string"><span class="hljs-string">"pass"</span></span>) client = googl.Googl(<span class="hljs-string"><span class="hljs-string">"MyAPIAccessKey"</span></span>, client_login=client_login)</code> </pre><br>  <b>Important:</b> the life of the token is approximately one week, after it needs to be updated.  In my project, I put the token update function on kroner once a day. <br><br>  If you shorten links in bulk, sooner or later you will catch the ‚Äúrate limits‚Äù exception.  This is because the default requests / second / user limit is 1.0 in your console: <br><br><img src="https://habrastorage.org/storage/9f034ea5/d6702dad/daff9372/4b3533dc.png"><br><br>  Increase this value to an acceptable, say, 1000 queries. <br><br>  Finally, consider filtering requests.  All API requests can be filtered in two ways: by IP and domain.  On the tab "Traffic Controls" you can specify one of the types: <br><br><img src="https://habrastorage.org/storage/ddae643d/ff518eba/82ac1943/67e15fdf.png"><br><br>  If you selected the item ‚ÄúBrowser-embedded scripts‚Äù, then in the text field specify the address mask from which requests will come, for example, "* .example.com / *".  When initializing a class, you need to specify the referer parameter that satisfies this mask: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> googl client = googl.Googl(<span class="hljs-string"><span class="hljs-string">"MyAPIAccessKey"</span></span>, referer=<span class="hljs-string"><span class="hljs-string">"http://www.example.com"</span></span>)</code> </pre><br>  IP restriction works as follows.  You specify an IP address mask.  Each request searches for the userip parameter (from the address bar).  If it is not found, then the real IP address of the machine with which the call was made is assigned to it.  The userip obtained in this way is compared with the specified mask.  The userip parameter can be set during class initialization: <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> googl client = googl.Googl(<span class="hljs-string"><span class="hljs-string">"MyAPIAccessKey"</span></span>, userip=<span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>)</code> </pre><br>  References: <br><ul><li>  <a href="https://github.com/igrishaev/googl-python">Project page</a> on Github; </li><li>  <a href="http://code.google.com/intl/en/apis/urlshortener/v1/getting_started.html">Official documentation</a> </li><li>  Official <a href="http://code.google.com/p/google-api-python-client/">google-api-python-client</a> with urlshorter support, <a href="http://code.google.com/p/google-api-python-client/source/browse/samples/urlshortener/urlshortener.py">example</a> . </li></ul></div><p>Source: <a href="https://habr.com/ru/post/119560/">https://habr.com/ru/post/119560/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../119549/index.html">All-Russian Popular Front vs Firefox or how to upload pictures correctly</a></li>
<li><a href="../119550/index.html">TermKit: a new concept of the console with a graphical output</a></li>
<li><a href="../119551/index.html">PHP + Word</a></li>
<li><a href="../119555/index.html">ADCSpb # 5. Editors</a></li>
<li><a href="../119556/index.html">Apple proposes to standardize even smaller SIM cards</a></li>
<li><a href="../119561/index.html">Facebook application registration is open</a></li>
<li><a href="../119562/index.html">On-line broadcast forum Positive Hack Days</a></li>
<li><a href="../119563/index.html">Apple gadgets can evoke feelings comparable to religious ones.</a></li>
<li><a href="../119565/index.html">Bitcoin generation in the browser</a></li>
<li><a href="../119566/index.html">How to attract users to your startup</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>