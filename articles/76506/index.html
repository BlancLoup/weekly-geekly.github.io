<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Private slots in Qt's Pimpl pattern</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction. 
 I recently wrote about the implementation of the Pimpl pattern in the Qt library and encouraged people to follow this approach when de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Private slots in Qt's Pimpl pattern</h1><div class="post__text post__text-html js-mediator-article"><h1>  Introduction. </h1><br>  I recently wrote about the implementation of the <a href="http://erudenko.com/wordpress/%3Fp%3D100">Pimpl pattern in the Qt library</a> and encouraged people to follow this approach when developing their own bibiotech.  Now I want to talk about such a concept as private slots and thus continue this topic.  The final article on this topic will be the implementation of the mechanism of Implicit Sharing and the shared d-pointer. <br><br><h1>  What is it and why it is needed. </h1><br>  Private slots are a mechanism complementing the functionality of d-pointers.  It allows you to implement slots for a private class, even if it is not a heir from QObject (usually it is not), but for this the public class must be a heir from QObject.  Ie in fact, a certain private slot is created in a public class and it directly pulls the desired private class method. <br>  Why do you need it?  Well, consider an example.  There is a class QAbstractScrollArea.  It simply displays a certain widget (viewport) and provides scrolling.  Scrolling is provided by using two instances of the QScrollBar class.  He keeps these scrolbars in a private classroom.  Now the problem is: how to connect the signal from the scrollbar about changing its position with the QAbstractScrollAreaPrivate class, because it is not a QObject?  Make it a QObject successor - better not do it :-).  You can make a slot in a public class and hang on it, then in this case it is not very beautiful - since slots from the internal implementation come out.  Here that Qt-Schnick was thought up quite reasonable and elegant approach - private slots. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  How it works. </h1><br>  To implement a private slot, use the Q_PRIVATE_SLOT macro.  Well, according to our custom, we climb into the Qt source and see what it is like: <br><br><blockquote><code><font color="black"># define Q_PRIVATE_SLOT(d, signature)</font> <br></code> </blockquote><br><br>  Oops !!!  Empty :-).  But real men never despair and climb into the source more deeply, but rather into the source code moc.  Who does not know, moc is a certain implementation of a certain parser.  Just a little tricky.  Unlike tools using QLALR (QSA and QXmlStreamReader) - this thing turned out to be unique.  I am not silent in parsers so I cannot conduct a more global analysis.  But he doesn‚Äôt exactly look like LALR because I haven‚Äôt found his vocabulary.  The token table is generated by a certain generate_keywords utility, which can be found in the moc source in the util folder. <br>  As I understand it, it simply generates tokens from any text and forms a structure of the form from them: <br><blockquote> <code><font color="black"><font color="#0000ff">static</font> <font color="#0000ff">const</font> <font color="#0000ff">struct</font> <br> { <br> Token token; <br> <font color="#0000ff">short</font> next; <br> <font color="#0000ff">char</font> defchar; <br> <font color="#0000ff">short</font> defnext; <br> Token ident; <br> }</font> <br></code> </blockquote><br>  Here is an example of the records of this generator: <br><blockquote> <code><font color="black">{Q_SIGNAL_TOKEN, 0, 83, 470, CHARACTER}, <br> {Q_SIGNALS_TOKEN, 0, 0, 0, CHARACTER}, <br> {Q_SLOT_TOKEN, 0, 83, 474, CHARACTER}, <br> {Q_SLOTS_TOKEN, 0, 0, 0, CHARACTER}, <br> {Q_PRIVATE_SLOT_TOKEN, 0, 0, 0, CHARACTER},</font> <br></code> </blockquote><br>  Who wants to skip further or even already knows the answer - please express. <br>  By the way, this whole thing turned out to be very simple to expand :-) you can add your preprocessing.  That's what it means to write beautifully. <br><br>  in token.cpp we find our token: <br><blockquote> <code><font color="black"><font color="#0000ff">case</font> Q_PRIVATE_SLOT_TOKEN: <font color="#0000ff">return</font> <font color="#A31515">"Q_PRIVATE_SLOT_TOKEN"</font> ;</font> <br></code> </blockquote><br><br>  And further in the implementation of the MOC :: parse () method we find what it does when it encounters this parser: <br><blockquote> <code><font color="black"><font color="#0000ff">case</font> Q_PRIVATE_SLOT_TOKEN: <br> parseSlotInPrivate(&amp;def, access); <br> <font color="#0000ff">break</font> ;</font> <br></code> </blockquote><br><br>  Well, that's got to the point, it is in the parseSlotInPrivate method (&amp; def, access); <br>  Here she is: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">void</font> Moc::parseSlotInPrivate(ClassDef *def, FunctionDef::Access access) <br> { <br> next(LPAREN); <br> FunctionDef funcDef; <br> next(IDENTIFIER); <br> funcDef.inPrivateClass = lexem(); <br> <font color="#008000">// also allow void functions</font> <br> <font color="#0000ff">if</font> (test(LPAREN)) { <br> next(RPAREN); <br> funcDef.inPrivateClass += <font color="#A31515">"()"</font> ; <br> } <br> next(COMMA); <br> funcDef.access = access; <br> parseFunction(&amp;funcDef, <font color="#0000ff">true</font> ); <br> def-&gt;slotList += funcDef; <br> <font color="#0000ff">while</font> (funcDef.arguments.size() &gt; 0 &amp;&amp; funcDef.arguments.last().isDefault) { <br> funcDef.wasCloned = <font color="#0000ff">true</font> ; <br> funcDef.arguments.removeLast(); <br> def-&gt;slotList += funcDef; <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Now everything is clear.  As you can see, this directive fills in the necessary values ‚Äã‚Äãto define the meta-function that is generated by the moc (in the same way as for regular slots).  And the empty define simply makes this entry empty when the moc has passed and the time comes for the precompiler.  Ie at the time of standard compilation there is already empty, but the implementation of the slot is generated in the moc file.  Next, I will show how it looks in our example. <br>  Well, in general, figured out how it works, will continue to look at how to use it. <br><br><h1>  How to implement this in your code. </h1><br>  Here in reality everything is very simple.  As an example, take the classes from my <a href="http://erudenko.com/wordpress/%3Fp%3D100">previous article</a> .  And we add new functionality. <br>  1. Add the void _q_boo () method to MyClassPrivare: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">class</font> MyClassPrivate <br> { <br> Q_DECLARE_PUBLIC(MyClass); <br> <font color="#0000ff">public</font> : <br> MyClassPrivate(); <br> <font color="#0000ff">virtual</font> ~MyClassPrivate(); <br> <br> <font color="#0000ff">void</font> foo(); <br> <font color="#0000ff">void</font> _q_boo(); <br> <font color="#0000ff">int</font> i; <br> MyClass * q_ptr; <br> };</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  The implementation in myclass.cpp will look like this: <br><blockquote> <code><font color="black"><font color="#0000ff">void</font> MyClassPrivate::_q_boo() <br> { <br> qDebug()&lt;&lt;i; <br> QCoreApplication::exit(1); <br> }</font> <br></code> </blockquote><br>  Do not forget to add QDebug and QCoreApplication to the included. <br>  About the name _q_boo.  This is the nt private slot naming rule.  The name must begin with "_q_".  Then, when viewing a private class ad, you can determine that it is a slot. <br>  QCoreApplication :: exit (1) - I added so that when we finish, we complete the main application cycle (I‚Äôll write a listing of this application to test our library). <br>  2. For more entanglement (and then everything turns out to be very simple), let us jerk this slot into the heir - MyClassDerived.  To do this, we declare the following macro in his private section: <br><blockquote> <code><font color="black">Q_PRIVATE_SLOT(d_func(), <font color="#0000ff">void</font> _q_boo()); <br></font> <br></code> </blockquote><br>  From the above reverse engineering moc we see here that we need a pointer to the class and the name of its method.  In fact, this is a simple text analysis based on which then the code moc_myclassderived.cpp is generated. <br>  3. Let's try to assemble our project: <br><blockquote> <code><font color="black">moc_myclassderived.cpp: In member function ' <font color="#0000ff">virtual</font> <font color="#0000ff">int</font> MyClassDerived::qt_metacall(QMetaObject::Call, <font color="#0000ff">int</font> , <font color="#0000ff">void</font> **)': <br> moc_myclassderived.cpp:70: error: invalid use of incomplete type ' <font color="#0000ff">struct</font> MyClassDerivedPrivate' <br> myclassderived.h:5: error: forward declaration of ' <font color="#0000ff">struct</font> MyClassDerivedPrivate'</font> <br></code> </blockquote><br>  This is normal, because moc knows nothing about our Private class, because it only includes the header file, on the basis of which it was generated.  And in the public header file only forward announcement.  Since moc is essentially an addition to our implementation, simply include it at the end of our .cpp file: <br><blockquote> <code><font color="black">.................. <br> #include <font color="#A31515">"moc_myclassderived.cpp"</font></font> <br></code> </blockquote><br><br>  Now we start the assembly and ... Again the same error !!!  Do not despair.  Just do a make distclean and build again. <br>  Well, in general, and all ... ahhh of course, an example of use.  Then we go further. <br>  As with the public, we‚Äôre looking at what the nocheneril moc gives us: <br><blockquote> <code><font color="black"><font color="#0000ff">int</font> MyClassDerived::qt_metacall(QMetaObject::Call _c, <font color="#0000ff">int</font> _id, <font color="#0000ff">void</font> **_a) <br> { <br> _id = MyClass::qt_metacall(_c, _id, _a); <br> <font color="#0000ff">if</font> (_id &lt; 0) <br> <font color="#0000ff">return</font> _id; <br> <font color="#0000ff">if</font> (_c == QMetaObject::InvokeMetaMethod) { <br> <font color="#0000ff">switch</font> (_id) { <br> <font color="#0000ff">case</font> 0: signal2((*reinterpret_cast&lt; <font color="#0000ff">int</font> (*)&gt;(_a[1]))); <font color="#0000ff">break</font> ; <br> <font color="#0000ff">case</font> 1: d_func()-&gt;_q_boo(); <font color="#0000ff">break</font> ; <br> <font color="#0000ff">default</font> : ; <br> } <br> _id -= 2; <br> } <br> <font color="#0000ff">return</font> _id; <br> }</font> <br></code> </blockquote><br>  Please note: when a request to call a slot with _id = 1 comes to us, we pull the private class method directly, without any loss, as if this metacall system is native to the private class and not to the public (I‚Äôm a little wrong, because there is a small overhead in type conversion during the d_func () function call. <br><br>  4. Let's start the timer so that it yanked our method when creating the class MyClassDerived in one second. <br>  First we declare the init () method in MyClassDerivedPrivate. <br>  The implementation in myclassderived.cpp looks like this: <br><blockquote> <code><font color="black"><font color="#0000ff">void</font> MyClassDerivedPrivate::init() <br> { <br> Q_Q(MyClassDerived); <br> QTimer::singleShot(1000,q,SLOT(_q_boo())); <br> } <br></font> <br></code> </blockquote><br><br>  Well, let's add an initialization call to our constructor (we used to have them empty): <br><blockquote> <code><font color="black">MyClassDerived::MyClassDerived(QObject *parent) <br> :MyClass(* <font color="#0000ff">new</font> MyClassDerivedPrivate(), parent) <br> { <br> Q_D(MyClassDerived); <br> d-&gt;init(); <br> <br> } <br> <br> MyClassDerived::MyClassDerived(MyClassDerivedPrivate &amp;dd, QObject * parent) <br> :MyClass(dd, parent) <br> { <br> Q_D(MyClassDerived); <br> d-&gt;init(); <br> }</font> <br></code> </blockquote><br>  Of course, in this case, it was possible not to fence the construction with init (), it would just be like in each constructor: <br><blockquote> <code><font color="black">QTimer::singleShot(1000, <font color="#0000ff">this</font> ,SLOT(_q_boo()));</font> <br></code> </blockquote><br>  But I wanted to show the approach when more than one action is needed in the initialization. <br><br>  Do not believe it :-) But that's all.  In the next paragraph I will show the program that will test all this. <br><br><h1>  We are testing our code </h1><br>  Well, we are creating a new project (in my case, I made it in the main subdirectory of my project habrahabra): <br>  main.pro <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">TEMPLATE = app <br> LIBS += -lhabrhabr -L.. <br> INCLUDEPATH += ../ <br> TARGET = main <br> <br> SOURCES += main.cpp</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  well, main.cpp itself: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">#include <font color="#A31515">"myclassderived.h"</font> <br> #include &lt;QApplication&gt; <br> <br> <font color="#0000ff">int</font> main( <font color="#0000ff">int</font> argc, <font color="#0000ff">char</font> ** argv) { <br> QApplication a(argc,argv); <br> MyClassDerived d(0); <br> <font color="#0000ff">return</font> a.exec(); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Why was it necessary to do QApplication?  Yes, because the system of signals and slots will not work without a thread execution loop in the context of which it will be executed (in our case, the mainloop). <br>  We collect, run, we get the result: <br><blockquote> <code><font color="black">7 <br> exit-code:1</font> <br> <br></code> </blockquote><br>  Uraaa !!!  Everything is working. <br><br><h1>  Conclusion </h1><br>  Maybe it scared you that I wrote so much on this topic?  In this case, I can reassure you, everything is much easier than you think.  I just wanted to show how this mechanism works, and not just instructions for use, like: "Insert this here and this here and hurray it all works for you."  In fact, you need to do just three steps. <br>  1. Declare the Q_PRIVATE_SLOT (d_func (), _ q_method ()) macro; <br>  2. Implement this method in a private class. <br>  3. Add to the end of the cpp file #include "moc_classname.cpp" <br><br>  And that's it !!!  It's simple. <br><br>  Important: I already specify the order of the header files in the article regarding pimpl.  But here I will remind you that all private header files must strictly follow the public ones and they must go in the order of inclusion in the HEADERS list.  In our example, the derived class includes the base class headers, so in the HEADERS list of the project file it comes after the parent headers. <br>  Well, just like d-pointer macros, private slot macros are not part of the public API and can be changed at any time.  But do not worry, I reassured about this in the article on pimpl. <br><br>  As always, I invite you to visit my blog: <a href="http://erudenko.com/">erudenko.com</a> .  There you can read the bourgeois version of this article and various additions.  You can write there komenty, I will answer as much as possible. <br><br>  Well, according to tradition, the source code (the source code of the test program is fully published above, so here I will not write them): <br>  habrhabr.pro: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">TEMPLATE = lib <br> HEADERS += myclass.h \ <br> myclass_p.h \ <br> myclassderived.h \ <br> myclassderived_p.h <br> SOURCES += myclass.cpp \ <br> myclassderived.cpp</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  myclass.h <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">#ifndef MYCLASS_H <br> <font color="#0000ff">#define</font> MYCLASS_H <br> <br> #include &lt;QObject&gt; <br> <br> <font color="#0000ff">class</font> MyClassPrivate; <br> <font color="#0000ff">class</font> MyClass : <font color="#0000ff">public</font> QObject <br> { <br> Q_OBJECT <br> <font color="#0000ff">public</font> : <br> <font color="#0000ff">explicit</font> MyClass(QObject *parent = 0); <br> <font color="#0000ff">int</font> foo() <font color="#0000ff">const</font> ; <br> signals: <br> <font color="#0000ff">void</font> signal( <font color="#0000ff">int</font> ); <br> <font color="#0000ff">protected</font> : <br> MyClassPrivate * <font color="#0000ff">const</font> d_ptr; <br> MyClass(MyClassPrivate &amp;dd, QObject * parent); <br> <font color="#0000ff">private</font> : <br> Q_DECLARE_PRIVATE(MyClass); <br> }; <br> <br> <font color="#0000ff">#endif</font> // MYCLASS_H</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  myclass_p.h <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">#ifndef MYCLASS_P_H <br> <font color="#0000ff">#define</font> MYCLASS_P_H <br> #include <font color="#A31515">"myclass.h"</font> <br> <br> <font color="#0000ff">class</font> MyClassPrivate <br> { <br> Q_DECLARE_PUBLIC(MyClass); <br> <font color="#0000ff">public</font> : <br> MyClassPrivate(); <br> <font color="#0000ff">virtual</font> ~MyClassPrivate(); <br> <br> <font color="#0000ff">void</font> foo(); <br> <br> <font color="#0000ff">void</font> _q_boo(); <br> <br> <font color="#0000ff">int</font> i; <br> MyClass * q_ptr; <br> }; <br> <br> <font color="#0000ff">#endif</font> // MYCLASS_P_H</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  myclass.cpp <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">#include <font color="#A31515">"myclass.h"</font> <br> #include <font color="#A31515">"myclass_p.h"</font> <br> #include &lt;QDebug&gt;; <br> #include &lt;QCoreApplication&gt;; <br> MyClassPrivate::MyClassPrivate() <br> { <br> i = 5; <br> } <br> <br> MyClassPrivate::~MyClassPrivate() <br> { <br> <font color="#008000">//nothing to do</font> <br> } <br> <br> <font color="#0000ff">void</font> MyClassPrivate::foo() <br> { <br> Q_Q(MyClass); <br> emit(q-&gt;signal(i)); <br> } <br> <br> <font color="#0000ff">void</font> MyClassPrivate::_q_boo() <br> { <br> qDebug()&lt;&lt;i; <br> QCoreApplication::exit(1); <br> } <br> <br> MyClass::MyClass(QObject *parent) <br> :QObject(parent) <br> ,d_ptr( <font color="#0000ff">new</font> MyClassPrivate()) <br> { <br> Q_D(MyClass); <br> d-&gt;q_ptr = <font color="#0000ff">this</font> ; <br> } <br> <br> MyClass::MyClass(MyClassPrivate &amp;dd, QObject * parent) <br> :QObject(parent) <br> ,d_ptr(&amp;dd) <br> { <br> Q_D(MyClass); <br> d-&gt;q_ptr = <font color="#0000ff">this</font> ; <br> } <br> <br> <font color="#0000ff">int</font> MyClass::foo() <font color="#0000ff">const</font> <br> { <br> Q_D( <font color="#0000ff">const</font> MyClass); <br> <font color="#0000ff">return</font> d-&gt;i; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  myclassderived.h <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">#ifndef MYCLASSDERIVED_H <br> <font color="#0000ff">#define</font> MYCLASSDERIVED_H <br> #include <font color="#A31515">"myclass.h"</font> <br> <br> <font color="#0000ff">class</font> MyClassDerivedPrivate; <br> <font color="#0000ff">class</font> MyClassDerived : <font color="#0000ff">public</font> MyClass <br> { <br> Q_OBJECT <br> <font color="#0000ff">public</font> : <br> <font color="#0000ff">explicit</font> MyClassDerived(QObject *parent = 0); <br> signals: <br> <font color="#0000ff">void</font> signal2( <font color="#0000ff">int</font> ); <br> <font color="#0000ff">protected</font> : <br> MyClassDerived(MyClassDerivedPrivate &amp;dd, QObject * parent); <br> <font color="#0000ff">private</font> : <br> Q_DECLARE_PRIVATE(MyClassDerived); <br> Q_PRIVATE_SLOT(d_func(), <font color="#0000ff">void</font> _q_boo()); <br> }; <br> <br> <font color="#0000ff">#endif</font> // MYCLASSDERIVED_H</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  myclassderived_p.h <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">#ifndef MYCLASSDERIVED_P_H <br> <font color="#0000ff">#define</font> MYCLASSDERIVED_P_H <br> <br> #include <font color="#A31515">"myclassderived.h"</font> <br> #include <font color="#A31515">"myclass_p.h"</font> <br> <br> <font color="#0000ff">class</font> MyClassDerivedPrivate: <font color="#0000ff">public</font> MyClassPrivate <br> { <br> Q_DECLARE_PUBLIC(MyClassDerived); <br> <font color="#0000ff">public</font> : <br> MyClassDerivedPrivate(); <br> <font color="#0000ff">virtual</font> ~MyClassDerivedPrivate(); <br> <br> <font color="#0000ff">void</font> foo2(); <br> <font color="#0000ff">void</font> init(); <br> <font color="#0000ff">int</font> j; <br> }; <br> <br> <font color="#0000ff">#endif</font> // MYCLASSDERIVED_P_H</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  myclassderived.cpp <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">#include <font color="#A31515">"myclassderived.h"</font> <br> #include <font color="#A31515">"myclassderived_p.h"</font> <br> #include &lt;QTimer&gt;; <br> <br> MyClassDerivedPrivate::MyClassDerivedPrivate() <br> { <br> j=6; <br> i=7; <br> } <br> <br> MyClassDerivedPrivate::~MyClassDerivedPrivate() <br> { <br> <br> } <br> <br> <font color="#0000ff">void</font> MyClassDerivedPrivate::foo2() <br> { <br> Q_Q(MyClassDerived); <br> emit(q-&gt;signal2(j)); <br> emit(q-&gt;signal(j)); <br> } <br> <br> <font color="#0000ff">void</font> MyClassDerivedPrivate::init() <br> { <br> Q_Q(MyClassDerived); <br> QTimer::singleShot(1000,q,SLOT(_q_boo())); <br> } <br> <br> MyClassDerived::MyClassDerived(QObject *parent) <br> :MyClass(* <font color="#0000ff">new</font> MyClassDerivedPrivate(), parent) <br> { <br> Q_D(MyClassDerived); <br> d-&gt;init(); <br> <br> } <br> <br> MyClassDerived::MyClassDerived(MyClassDerivedPrivate &amp;dd, QObject * parent) <br> :MyClass(dd, parent) <br> { <br> Q_D(MyClassDerived); <br> d-&gt;init(); <br> } <br> <br> #include <font color="#A31515">"moc_myclassderived.cpp"</font></font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> </div><p>Source: <a href="https://habr.com/ru/post/76506/">https://habr.com/ru/post/76506/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../76495/index.html">SmartQ V7</a></li>
<li><a href="../76496/index.html">Exchange of information about users 1C through SPML gateway</a></li>
<li><a href="../76498/index.html">Competition "Big Fish"</a></li>
<li><a href="../76501/index.html">Linux: use 2 sound cards</a></li>
<li><a href="../76502/index.html">To invite to Tehconnection.eu</a></li>
<li><a href="../76507/index.html">Regular hours</a></li>
<li><a href="../76510/index.html">Invites to Google Wave</a></li>
<li><a href="../76513/index.html">ToDo software + Android</a></li>
<li><a href="../76516/index.html">Design as an engine of innovation</a></li>
<li><a href="../76518/index.html">Free wi-fi will appear at major railway stations in Russia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>