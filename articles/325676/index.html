<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Huawei USG 6300. Basic firewall configuration out of the box</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The idea to write this article arose after I tried to find at least some information on setting up Huawei firewalls on the Internet. In the Russian-sp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Huawei USG 6300. Basic firewall configuration out of the box</h1><div class="post__text post__text-html js-mediator-article">  The idea to write this article arose after I tried to find at least some information on setting up Huawei firewalls on the Internet.  In the Russian-speaking segment, I did not find anything, in the English-speaking, mostly outdated data on previous models and references to documentation (which, by the way, is on the manufacturer‚Äôs website in the public domain and quite detailed). <br><br>  If you have experience working with firewalls from other vendors, the documentation should be enough to run and work with Huawei USG, but I know from experience that manuals are being used when all options have been tried.  Therefore, one of the goals of this article is to save time during the initial commissioning of this relatively new equipment.  Of course, in one article it will not be possible to cover all the functionality, however, the main initial cases for setting up here will be considered.  Engineers can use the article as a cheat sheet for installing network equipment, since the basic settings that will be described here will usually have to be done in all installations. <br><br> <a href="https://habrahabr.ru/company/lanit/blog/325676/"><img src="https://habrastorage.org/getpro/habr/post_images/7fb/245/4c4/7fb2454c42cafdb9b52ed0a9c8d6211a.jpg"></a> <br>  <a href="">A source</a> <br><a name="habracut"></a><br>  The article will not compare with competitors and generally a minimum of marketing, it will be a story about administration.  I will only mention that the main competitors of Huawei USG are Cisco ASA, CheckPoint, FortiNet and others. Possibly, the recent interest in Chinese equipment, in particular, in information security equipment, is probably related to the topic of "import substitution" of the above American vendors. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  <font color="#0095b6">Huawei USG rulers and brief specifications</font> </h2><br>  Huawei USG - a new generation of information protection devices, or the so-called NGFW (Next Generation FireWall).  Unlike previous generation protection tools, NGFW is able to perform deep packet analysis (up to L7), inspect traffic at the application level, has integrated IPS, and can also interact with other similar devices, receiving information from them about potential attacks directed in its direction. .  It also has a simple DLP mechanism (detection of information leaks). <br><br>  The USG 6300 series is the youngest series of devices targeted at small and medium businesses.  Brief specifications are shown in the table below. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bda/169/388/bda16938881b6b9b629f723b90a49afa.png"><br><br>  The 6300 Series devices listed in the table are designed for 19-inch rack mounting.  When writing this article, the device used Huawei USG 6320, made in the desktop version: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1aa/3e7/a8a/1aa3e7a8ac3b9ba1463d976333fce6d0.png"><br><br><blockquote>  Its brief characteristics are as follows: <br>  Interfaces: 8GE <br>  Power: AC Adapter <br>  Firewall throughput: 2 Gbit / s <br>  IPS throughput: 700 Mbit / s <br>  IPS + AV throughput: 700 Mbit / s <br>  Concurrent sessions: 500,000 <br>  VPN Throughput (IPSec): 400Mbit / s </blockquote><br>  The main difference between the Huawei USG6320 and the rack-mount versions of this series is that you cannot put a hard disk into it, which is mainly used to keep logs and generate reports based on the device from the WEB interface.  Otherwise, all devices in the series (and even the older 6600 series) run under the same VRP operating system.  That is, at least at the time of writing this article, the ‚Äúfirmware‚Äù file for the 6300 and 6600 series is the same. <br><br><h2>  <font color="#0095b6">First turn on the device</font> </h2><br>  Connect to the console port with standard parameters (9600 baud, no parity), turn on the power and start the download: <br><br><pre><code class="hljs markdown"><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">**** *                                                         * *                       NGFW                           * *                                                         * **</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span><span class="hljs-strong"><span class="hljs-strong">*****</span></span>** Base      Bootrom Ver : 060 Dec  4 2015 06:55:42 Extended  Bootrom Ver : 060 Dec  4 2015 07:00:34 CPLD           BigVer : 02 CPLD           SmlVer : 00 2015-03-19 PCB               Ver : SUE1MPUB REV A BOM               Ver : 000 CPU L2 Cache          : 2048 KB CPU Core Frequency    : 1000 MHz BUS Frequency         : 600 MHz Mem Size              : 2048 MB Press Ctrl+B to enter main menu...</code> </pre> <br>  At the very beginning of the download, just in case, I will reset the device to the factory settings.  Also, this step will be useful to you if you are dealing with a non-new device that has already been configured, and the password to the console is not known. <br><br>  In order to enter the BootRom menu, you need to press Ctrl + B at the initial stage of loading.  The default password for logging into BootRom on most Huawei network devices: O &amp; m15213 (the first letter is O, not zero).  This is what the main menu of BootRom looks like: <br><br><pre> <code class="hljs ruby">====================&lt; Extend Main Menu &gt;==================== <span class="hljs-params"><span class="hljs-params">| &lt;1&gt; Boot System                                          |</span></span> <span class="hljs-params"><span class="hljs-params">| &lt;2&gt; Set Startup Application Software </span><span class="hljs-keyword"><span class="hljs-params"><span class="hljs-keyword">and</span></span></span><span class="hljs-params"> Configuration   |</span></span> <span class="hljs-params"><span class="hljs-params">| &lt;3&gt; File Management Menu...                              |</span></span> <span class="hljs-params"><span class="hljs-params">| &lt;4&gt; Load </span><span class="hljs-keyword"><span class="hljs-params"><span class="hljs-keyword">and</span></span></span><span class="hljs-params"> Upgrade Menu...                             |</span></span> <span class="hljs-params"><span class="hljs-params">| &lt;5&gt; Modify Bootrom Password                              |</span></span> <span class="hljs-params"><span class="hljs-params">| &lt;6&gt; Reset Factory Configuration                          |</span></span> <span class="hljs-params"><span class="hljs-params">| &lt;0&gt; Reboot                                               |</span></span> <span class="hljs-params"><span class="hljs-params">| ---------------------------------------------------------|</span></span> <span class="hljs-params"><span class="hljs-params">| Press Ctrl+T to Enter Manufacture Test Menu...           |</span></span> <span class="hljs-params"><span class="hljs-params">| Press Ctrl+Z to Enter Diagnose Menu...                   |</span></span> ============================================================ Enter your choice(<span class="hljs-number"><span class="hljs-number">0</span></span>-<span class="hljs-number"><span class="hljs-number">6</span></span>)<span class="hljs-symbol"><span class="hljs-symbol">:</span></span></code> </pre> <br>  Select menu item 6 to reset to factory settings and then menu item 0 to reboot. <br>  After the download is complete, the device will prompt you to enter a login and password to control through the console port.  Since we returned to the factory settings, the default login and password to the console will be: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Login</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">admin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Password</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Admin</span></span>@<span class="hljs-number"><span class="hljs-number">123</span></span></code> </pre><br><h2>  <font color="#0095b6">Command Line Huawei USG</font> </h2><br>  The Huawei USG command line is very similar to the Cisco command line with the exception of small nuances.  Cisco has three CLI command modes: <br><br><ul><li>  user mode (&gt; icon); </li><li>  privileged mode (# sign, enable input by command); </li><li>  global configuration mode (input by configure terminal command from privileged mode). </li></ul><br>  Unlike Cisco, the command line of Huawei network equipment (not only USG, but also switches and routers) consists of two modes: <br><br><ul><li>  user mode (also the&gt; icon); </li><li>  System view (icon #, system-view input from user mode). </li></ul><br>  System view mode combines privileged mode and global configuration mode. <br><br>  A few more differences: <br><br><ul><li>  Cisco's show command is similar to the display command in Huawei's VRP OS; </li><li>  Cisco's no command is similar to Huawei's undo. </li></ul><br>  Thus, a review of the current working configuration (for Cisco this show runn) in Huawei will be: <br><br><pre> <code class="hljs pgsql">display <span class="hljs-keyword"><span class="hljs-keyword">current</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span></code> </pre> <br>  Just as in the CLI, Cisco does not have to enter the entire command.  If part of the command is sufficient for recognition, the command will be accepted, or you can use TAB to add. <br><br>  The first step is to determine which version of the VRP OS currently controls the device, and if this is not the latest version, then you should install the latest one.  Check the version of the OS VRP can command <br><br><pre> <code class="hljs pgsql">display <span class="hljs-keyword"><span class="hljs-keyword">version</span></span></code> </pre> <br>  Cisco has a similar team <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">show</span></span> <span class="hljs-keyword"><span class="hljs-keyword">version</span></span></code> </pre> <br>  Checking: <br><br><pre> <code class="hljs pgsql">&lt;USG6300&gt;display <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>  <span class="hljs-number"><span class="hljs-number">2017</span></span>/<span class="hljs-number"><span class="hljs-number">03</span></span>/<span class="hljs-number"><span class="hljs-number">27</span></span> Huawei Versatile <span class="hljs-keyword"><span class="hljs-keyword">Security</span></span> Platform Software Software <span class="hljs-keyword"><span class="hljs-keyword">Version</span></span>: USG6300 V100R001C30SPC600PWE (VRP (R) Software, <span class="hljs-keyword"><span class="hljs-keyword">Version</span></span> <span class="hljs-number"><span class="hljs-number">5.30</span></span>) Copyright (C) <span class="hljs-number"><span class="hljs-number">2014</span></span><span class="hljs-number"><span class="hljs-number">-2016</span></span> Huawei Technologies Co., Ltd.. USG6320 uptime <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> week, <span class="hljs-number"><span class="hljs-number">0</span></span> day, <span class="hljs-number"><span class="hljs-number">0</span></span> hour, <span class="hljs-number"><span class="hljs-number">2</span></span> minutes Engine <span class="hljs-keyword"><span class="hljs-keyword">Version</span></span> : V200R001C10 AV Signature <span class="hljs-keyword"><span class="hljs-keyword">Database</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Version</span></span>   : IPS Signature <span class="hljs-keyword"><span class="hljs-keyword">Database</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Version</span></span>  : IPS Engine <span class="hljs-keyword"><span class="hljs-keyword">Version</span></span>  : V200R001C10SPC352 SA Signature <span class="hljs-keyword"><span class="hljs-keyword">Database</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Version</span></span>   : <span class="hljs-number"><span class="hljs-number">2015121601</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Location</span></span> Signature <span class="hljs-keyword"><span class="hljs-keyword">Database</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Version</span></span>  : <span class="hljs-number"><span class="hljs-number">2015020515</span></span> RPU<span class="hljs-string"><span class="hljs-string">'s Version Information: 2048M            bytes SDRAM  16M            bytes FLASH 1024M            bytes CFCARD 1024K            bytes SRAM PCB               Version : VER.A CPLD              Version : 200 Base     Bootrom  Version : 060 Dec  4 2015 06:55:42 Extended Bootrom  Version : 060 Dec  4 2015 07:00:34</span></span></code> </pre> <br>  In this case, the version of OS VRP: V100R001C30SPC600PWE.  That is, version 100, release 001, podrelyz 30, service pack 600. Also pay attention to the PWE suffix - this stands for Payload without encryption, i.e.  Our version of the software, besides being very old, besides, will not yet support strong encryption. <br><br><h2>  <font color="#0095b6">Device software update</font> </h2><br>  The current software version (as of March 2017) is v500-1001c30spc100. <br><br>  There is no point in starting to configure this device with the old software version.  First, the current V500 has even changed part of the CLI, the syntax of some commands has changed, including commands related to security policy. <br><br>  Secondly, the lack of strong encryption (namely, with this version of the software, the device will be shipped to Russia to simplify the import), I think, not many will do. <br><br>  Therefore, the first step is to upgrade the VRP Huawei USG software to the latest version at the moment.  You can download it from the manufacturer‚Äôs website, if your login has the corresponding rights (as a rule, they are given to Huawei partners).  If the latest software version is not available to you (you will see it on the site in any case, but you will not be able to download it), you should contact the company through which your equipment is delivered or to the Russian-speaking support of Huawei. <br>  I downloaded the file USG6000V500R001C30SPC100.bin VRP software from the site and put it in the folder of my TFTP server with the address 172.31.31.250. <br><br>  I connected the lowest port of Huawei USG to my local network 172.31.31.0 / 24 in order to download the new file with the software via the TFTP protocol to it.  But for this you need to register an IP address from the network.  We do this as follows: <br><br><pre> <code class="hljs pgsql">&lt;USG6300&gt;<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">view</span></span>             [USG6300]interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> [USG6300-GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>] ip address <span class="hljs-number"><span class="hljs-number">172.31</span></span><span class="hljs-number"><span class="hljs-number">.31</span></span><span class="hljs-number"><span class="hljs-number">.86</span></span> <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> [USG6300-GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>]quit [USG6300]</code> </pre> <br>  The address is registered.  But at the same time, it turns out that our tftp server is not pinged with USG.  All this is because the default security policy on the USG is enabled and the default action is deny, i.e.  to ban.  To speed up the initial settings, I suggest that you make the default rule, permit, and until the device is released to the Internet, this will not pose a threat to it.  At the same time, it will greatly simplify the initial setup: <br><br><pre> <code class="hljs pgsql">[USG6300] <span class="hljs-keyword"><span class="hljs-keyword">security</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span> [USG6300-<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">security</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> action permit <span class="hljs-built_in"><span class="hljs-built_in">Warning</span></span>:Setting the <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> packet filtering <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> permit poses <span class="hljs-keyword"><span class="hljs-keyword">security</span></span> risks. You are advised <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> configure the <span class="hljs-keyword"><span class="hljs-keyword">security</span></span> <span class="hljs-keyword"><span class="hljs-keyword">policy</span></span> based <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> the actual data flows. Are you sure you want <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>?[Y/N]Y [USG6300-<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">security</span></span>] quit [USG6300]Ctrl+Z</code> </pre> <br>  Check the reachability of the TFTP server: <br><br><pre> <code class="hljs pgsql">&lt;USG6300&gt;ping <span class="hljs-number"><span class="hljs-number">172.31</span></span><span class="hljs-number"><span class="hljs-number">.31</span></span><span class="hljs-number"><span class="hljs-number">.250</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">46</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span>  <span class="hljs-number"><span class="hljs-number">2017</span></span>/<span class="hljs-number"><span class="hljs-number">03</span></span>/<span class="hljs-number"><span class="hljs-number">27</span></span> PING <span class="hljs-number"><span class="hljs-number">172.31</span></span><span class="hljs-number"><span class="hljs-number">.31</span></span><span class="hljs-number"><span class="hljs-number">.250</span></span>: <span class="hljs-number"><span class="hljs-number">56</span></span>  data bytes, press CTRL_C <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> break   Reply <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-number"><span class="hljs-number">172.31</span></span><span class="hljs-number"><span class="hljs-number">.31</span></span><span class="hljs-number"><span class="hljs-number">.250</span></span>: bytes=<span class="hljs-number"><span class="hljs-number">56</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Sequence</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span> ttl=<span class="hljs-number"><span class="hljs-number">128</span></span> <span class="hljs-type"><span class="hljs-type">time</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span> ms   Reply <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-number"><span class="hljs-number">172.31</span></span><span class="hljs-number"><span class="hljs-number">.31</span></span><span class="hljs-number"><span class="hljs-number">.250</span></span>: bytes=<span class="hljs-number"><span class="hljs-number">56</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Sequence</span></span>=<span class="hljs-number"><span class="hljs-number">2</span></span> ttl=<span class="hljs-number"><span class="hljs-number">128</span></span> <span class="hljs-type"><span class="hljs-type">time</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span> ms</code> </pre> <br>  After that, we will load the new version of the software from the TFTP server into flash memory using the command: <br><br><pre> <code class="hljs css">&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">USG6300</span></span>&gt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">tftp</span></span> 172<span class="hljs-selector-class"><span class="hljs-selector-class">.31</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.31</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.250</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">get</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">USG6000V500R001C30SPC100</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.bin</span></span></code> </pre> <br>  Next, you need to tell the loader that after rebooting, you need to download the software from this image, and not from what we have loaded, for this we give the command: <br><br><pre> <code class="hljs mel">&lt;USG6300&gt;startup <span class="hljs-keyword"><span class="hljs-keyword">system</span></span>-software USG6000V500R001C30SPC100.bin Info:System software <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the next startup:hda1:/usg6000v500r001c30spc100.bin, start read <span class="hljs-keyword"><span class="hljs-keyword">file</span></span>.... Succeeded <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> setting the software <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> booting <span class="hljs-keyword"><span class="hljs-keyword">system</span></span>. &lt;USG6300&gt;</code> </pre> <br>  Let us check that with the next boot the device will boot with the version of software we need: <br><br><pre> <code class="hljs vhdl">&lt;USG6300&gt;display startup <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">50</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span>  <span class="hljs-number"><span class="hljs-number">2017</span></span>/<span class="hljs-number"><span class="hljs-number">03</span></span>/<span class="hljs-number"><span class="hljs-number">27</span></span> MainBoard: Configed startup system software:   hda1:/suempua15v1r1c30spc600pwe.bin Startup system software:              hda1:/suempua15v1r1c30spc600pwe.bin <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> startup system software:             hda1:/usg6000v500r001c30spc100.bin Startup saved-<span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">file</span></span>:         <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> startup saved-<span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">file</span></span>:    <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span></code> </pre> <br>  After that we save the configuration and reboot the device: <br><br><pre> <code class="hljs vhdl">&lt;USG6300&gt;save <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> &lt;USG6300&gt;reboot <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span>  <span class="hljs-number"><span class="hljs-number">2017</span></span>/<span class="hljs-number"><span class="hljs-number">03</span></span>/<span class="hljs-number"><span class="hljs-number">27</span></span> System will reboot! Do you want <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> save the running <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span>? [Y/N]:Y <span class="hljs-number"><span class="hljs-number">2017</span></span>-<span class="hljs-number"><span class="hljs-number">03</span></span>-<span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> USG6300 %%<span class="hljs-number"><span class="hljs-number">01</span></span>CFM/<span class="hljs-number"><span class="hljs-number">4</span></span>/SAVE(l): <span class="hljs-keyword"><span class="hljs-keyword">When</span></span> deciding whether <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> save <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> the device, the user admin chose Y. <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> config <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> name <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>,set <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Default</span></span>... <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> config <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> hda1:/vrpcfg.zip Now saving the current <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> the device.... Info:The current <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span> was saved <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> the device successfully.. System will reboot! Continue? [Y/N]:Y</code> </pre> <br>  After reboot, check the current software version: <br><br><pre> <code class="hljs pgsql">&lt;USG6300&gt;display <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> <span class="hljs-number"><span class="hljs-number">2017</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-27</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>:<span class="hljs-number"><span class="hljs-number">37</span></span>:<span class="hljs-number"><span class="hljs-number">42.590</span></span> Huawei Versatile Routing Platform Software VRP (R) Software, <span class="hljs-keyword"><span class="hljs-keyword">Version</span></span> <span class="hljs-number"><span class="hljs-number">5.160</span></span> (USG6300 V500R001C30SPC100) Copyright (C) <span class="hljs-number"><span class="hljs-number">2014</span></span><span class="hljs-number"><span class="hljs-number">-2016</span></span> Huawei Technologies Co., Ltd USG6320 uptime <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> week, <span class="hljs-number"><span class="hljs-number">0</span></span> day, <span class="hljs-number"><span class="hljs-number">0</span></span> hour, <span class="hljs-number"><span class="hljs-number">37</span></span> minutes</code> </pre> <br>  As you can see, our version is now the freshest.  From this point on, you can begin to tune the hardware. <br><br><h2>  <font color="#0095b6">Configuring interfaces and SSH for remote management</font> </h2><br>  Next, configure SSH for remote control, since  HTTPS control is enabled by default. <br><br>  We will enable the ability to control using ssh service on all interfaces that will participate in our work.  Let GigabitEthernet0 / 0/7 be the WAN interface with public IP, and GigabitEthernet0 / 0/1 will be the LAN interface with the 192.168.200.0 / 24 network: <br><br><pre> <code class="hljs pgsql">&lt;USG6300&gt; <span class="hljs-keyword"><span class="hljs-keyword">system</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">view</span></span> [USG6300] interface GigabitEthernet <span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">7</span></span> [USG6300-GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">7</span></span>] service-manage <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> [USG6300-GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">7</span></span>] service-manage ssh permit [USG6300-GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">7</span></span>] ip address <span class="hljs-number"><span class="hljs-number">195.26</span></span>.xxx.xxx <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.224</span></span> [USG6300-GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">7</span></span>] service-manage http permit [USG6300-GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">7</span></span>] service-manage https permit [USG6300-GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">7</span></span>] service-manage ping permit [USG6300-GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">7</span></span>] quit [USG6300] interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> [USG6300-GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>] undo shutdown [USG6300-GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>] ip address <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.200</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span> <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> [USG6300-GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>] service-manage http permit [USG6300-GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>] service-manage https permit [USG6300-GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>] service-manage ping permit [USG6300-GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>] service-manage ssh permit</code> </pre> <br>  By default, four firewall zones with targeted priorities (in parentheses) are created in Huawei USG: local (100), dmz (50), trust (85), untrust (5).  Everything is very similar to how it is done in Cisco ASA - users in the same zone have the same security attributes.  Below is described in more detail the mechanism of the work of security zones, but for now just define the newly configured interfaces into the corresponding zones: <br><br><pre> <code class="hljs pgsql">[USG6300] firewall <span class="hljs-type"><span class="hljs-type">zone</span></span> trust [USG6300-<span class="hljs-type"><span class="hljs-type">zone</span></span>-trust] <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> [USG6300-<span class="hljs-type"><span class="hljs-type">zone</span></span>-trust] quit [USG6300] firewall <span class="hljs-type"><span class="hljs-type">zone</span></span> untrust [USG6300-<span class="hljs-type"><span class="hljs-type">zone</span></span>-untrust] <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">7</span></span> [USG6300-<span class="hljs-type"><span class="hljs-type">zone</span></span>-untrust] quit</code> </pre> <br>  Next, configure the default gateway: <br><br><pre> <code class="hljs css"><span class="hljs-selector-attr"><span class="hljs-selector-attr">[USG6300]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ip</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">route-static</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> 195<span class="hljs-selector-class"><span class="hljs-selector-class">.26</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.xxx</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span></code> </pre> <br>  Configure the VTY interface to support AAA: <br><br><pre> <code class="hljs css"><span class="hljs-selector-attr"><span class="hljs-selector-attr">[USG6300]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">user-interface</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">vty</span></span> 0 4 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[USG6300-vty0-4]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">authentication-mode</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">aaa</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[USG6300-vty0-4]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">protocol</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">inbound</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ssh</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[USG6300-vty0-4]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">user</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">privilege</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">level</span></span> 15 <span class="hljs-selector-attr"><span class="hljs-selector-attr">[USG6300-vty0-4]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">quit</span></span></code> </pre> <br>  Create a userssh user who can manage the device via SSH: <br><br><pre> <code class="hljs pgsql">[USG6300] aaa [USG6300-aaa] manager-<span class="hljs-keyword"><span class="hljs-keyword">user</span></span> userssh [USG6300-aaa-manager-<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>-userssh] <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> Enter <span class="hljs-keyword"><span class="hljs-keyword">Password</span></span>: Confirm <span class="hljs-keyword"><span class="hljs-keyword">Password</span></span>:  [USG6300-aaa-manager-<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>-userssh] service-<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ssh [USG6300-aaa-manager-<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>-userssh] quit [USG6300-aaa] bind manager-<span class="hljs-keyword"><span class="hljs-keyword">user</span></span> userssh <span class="hljs-keyword"><span class="hljs-keyword">role</span></span> <span class="hljs-keyword"><span class="hljs-keyword">system</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">admin</span></span> [USG6300-aaa] quit</code> </pre> <br>  We generate a local rsa key pair: <br><br><pre> <code class="hljs pgsql">[USG6300] rsa <span class="hljs-keyword"><span class="hljs-keyword">local</span></span>-key-pair <span class="hljs-keyword"><span class="hljs-keyword">create</span></span></code> </pre> <br>  Enable Secure Telnet (SSH) service: <br><br><pre> <code class="hljs pgsql">[USG6300] stelnet <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span></code> </pre> <br>  Configure userssh as an SSH administrator. <br><br><pre> <code class="hljs pgsql">[USG6300] ssh <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> userssh [USG6300] ssh <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> userssh authentication-<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> [USG6300] ssh <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> userssh service-<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> stelnet</code> </pre> <br>  At this point, it is possible to consider the initial configuration completed and connect the cables of the external Internet and local network to the corresponding configured interfaces. <br><br><h2>  <font color="#0095b6">Setting using a web interface</font> </h2><br>  I prefer to make basic settings and upgrade of the operating system from the command line, like most other configurations.  Nevertheless, much (not everything) could be done through the Web interface, which, in my opinion, is very well implemented, does not require Java or a client program (such as ASDM for Cisco ASA).  Yes, and security policies, it seems to me, are much clearer and easier to create through a Web interface. <br><br>  By default, a web interface is enabled on the device and enabled on the Management port ‚Äî on port devices, this port is separate, and in our case, by default, this port in USG6320 is the youngest on board, the one we used to update the software.  By default, the Management port is assigned IP 192.168.0.1 / 24, all types of services are enabled, and DHCP is enabled, so for opponents of the command line, you can use the WEB interface from the very beginning, knowing these default settings.  They look like this: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">interface</span></span> GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> undo shutdown ip address <span class="hljs-number"><span class="hljs-number">192.168.0.1</span></span> <span class="hljs-number"><span class="hljs-number">255.255.255.0</span></span> anti-ddos flow-statistic enable anti-ddos syn-flood source-detect alert-rate <span class="hljs-number"><span class="hljs-number">100</span></span> service-manage http permit service-manage https permit service-manage ping permit service-manage ssh permit service-manage snmp permit service-manage telnet permit dhcp <span class="hljs-literal"><span class="hljs-literal">select</span></span> interface dhcp server ip-range <span class="hljs-number"><span class="hljs-number">192.168.0.1</span></span> <span class="hljs-number"><span class="hljs-number">192.168.0.254</span></span></code> </pre> <br>  The port for management via https is 8443, and since we changed the address on the port a little earlier to 172.31.31.86, we‚Äôll access the device from any browser as follows: <br><br><pre> <code class="hljs objectivec">https:<span class="hljs-comment"><span class="hljs-comment">//172.31.31.86:8443</span></span></code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/ee5/f88/0cd/ee5f880cde9e717a5fbd7b811a1912ac.png"><br>  <i>Huawei USG web interface Dashboard tab</i> <br><br>  First of all, you need to download purchased licenses in the System -&gt; License Management section: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5bd/276/930/5bd2769307fa09db16c4dd8974b075f2.png"><br><br>  You can also use trial licenses by selecting the appropriate item with the following restrictions: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/792/22a/7cf/79222a7cfacc098da07999b22244392c.png"><br>  Trial anti-virus and IPS subscriptions have a period of 2 months: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b6c/007/8da/b6c0078da29abfecc338fa1c3bb81495.png"><br><br>  Or, if you select Local manual activation, we substitute the generated file with the dat extension with the license, and our purchased licenses are activated: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/44a/357/fc8/44a357fc8d29b681c67fcfad580bfb45.png"><br><br><h2>  <font color="#0095b6">Configuring Security Policies and Signature Updates</font> </h2><br>  Next, I propose to configure the device to access the Internet and update signatures via the Internet.  Before proceeding with the settings, we briefly explain the mechanism of the security zones in the Huawei USG. <br><br>  As stated above, four security zones are configured by default: <br><br><ul><li>  Untrust (5).  Identifies an insecure network segment, such as the Internet, has the lowest level of security 5. </li><li>  DMZ (50).  Defines a segment in which, as a rule, servers are located, to which it is necessary to provide access from outside.  But at the same time, access to more secure network segments is prohibited from this zone. </li><li>  Trust (85).  Defines a secure network segment where, as a rule, user workstations are located. </li><li>  Local (100).  The area of ‚Äã‚Äãthe USG device itself, including its interfaces. </li></ul><br>  You can change the priorities of zones, as well as add new zones, if necessary.  This applies to all zones except local ‚Äî its priority cannot be changed, and no interface can be added to it. <br><br>  Data flows within the same security zone are trusted and do not require security policy settings.  If we need to configure the flow of data from one zone to another, then we will need to configure the security policy, taking into account the direction of traffic according to the following rules. <br><br><ul><li>  Inbound traffic: traffic is forwarded from a zone of lower priority to a zone with a higher priority. </li><li>  Outbound traffic: forwards traffic from a higher priority zone to a lower priority zone. </li></ul><br>  The direction of traffic is determined by the direction of the first packet. <br><br>  Let me remind you that we have already configured the interfaces and connected to GigabitEhternet0 / 0/7 cable from the provider, and to GigabitEthernet0 / 0/1 cable from our local network.  If you try to ping something outside (untrust zone) directly from our device (local zone), then we will see the following picture: <br><br><pre> <code class="hljs pgsql">[USG6300]ping <span class="hljs-number"><span class="hljs-number">8.8</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span> PING <span class="hljs-number"><span class="hljs-number">8.8</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span>: <span class="hljs-number"><span class="hljs-number">56</span></span>  data bytes, press CTRL_C <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> break   Request <span class="hljs-type"><span class="hljs-type">time</span></span> <span class="hljs-keyword"><span class="hljs-keyword">out</span></span>   Request <span class="hljs-type"><span class="hljs-type">time</span></span> <span class="hljs-keyword"><span class="hljs-keyword">out</span></span>   Request <span class="hljs-type"><span class="hljs-type">time</span></span> <span class="hljs-keyword"><span class="hljs-keyword">out</span></span>   Request <span class="hljs-type"><span class="hljs-type">time</span></span> <span class="hljs-keyword"><span class="hljs-keyword">out</span></span>   Request <span class="hljs-type"><span class="hljs-type">time</span></span> <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-comment"><span class="hljs-comment">--- 8.8.8.8 ping statistics ---   5 packet(s) transmitted   0 packet(s) received   100.00% packet loss</span></span></code> </pre> <br>  All packets are lost, although the default route is configured and the device is connected to the provider.  In a situation like this, a regular router would get the ICMP response back and the picture would be different.  But in our case, the security zones mechanism described above works, and there is an initiation of data flow from a zone with a priority of 100 (local) to a zone with a priority of 5 (untrust), so we need to configure the outbound security policy to allow walking in both directions.  If the outgoing policy is applied to traffic in the direction of LOCAL ‚Üí UNTRUST, our device will create a new entry in the session table after each initiation of a new session in this direction.  The entry will contain the outgoing and destination IP addresses, the corresponding port numbers and the protocol type. <br><br>  If the packets exchanged by the client from the LOCAL zone and the server in the Untrust zone correspond to the entries in the session table, the firewall processes the packets based on the outgoing security policy without re-checking the direction of packet transmission.  That is, in our case, we should receive ICMP ECHO from the address 8.8.8.8. <br><br>  Configure the policy in the Policy section by clicking the Add button with the name policy_to_Inet: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ba2/2eb/935/ba22eb935530ad42665c191625611edb.png"><br><br>  After applying the policy, we will check its performance by running a ping to the address 8.8.8.8 of our device: <br><br><pre> <code class="hljs pgsql">[USG6300]ping <span class="hljs-number"><span class="hljs-number">8.8</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span> PING <span class="hljs-number"><span class="hljs-number">8.8</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span>: <span class="hljs-number"><span class="hljs-number">56</span></span>  data bytes, press CTRL_C <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> break   Reply <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-number"><span class="hljs-number">8.8</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span>: bytes=<span class="hljs-number"><span class="hljs-number">56</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Sequence</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span> ttl=<span class="hljs-number"><span class="hljs-number">47</span></span> <span class="hljs-type"><span class="hljs-type">time</span></span>=<span class="hljs-number"><span class="hljs-number">19</span></span> ms   Reply <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-number"><span class="hljs-number">8.8</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span>: bytes=<span class="hljs-number"><span class="hljs-number">56</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Sequence</span></span>=<span class="hljs-number"><span class="hljs-number">2</span></span> ttl=<span class="hljs-number"><span class="hljs-number">47</span></span> <span class="hljs-type"><span class="hljs-type">time</span></span>=<span class="hljs-number"><span class="hljs-number">21</span></span> ms   Reply <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-number"><span class="hljs-number">8.8</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span>: bytes=<span class="hljs-number"><span class="hljs-number">56</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Sequence</span></span>=<span class="hljs-number"><span class="hljs-number">3</span></span> ttl=<span class="hljs-number"><span class="hljs-number">47</span></span> <span class="hljs-type"><span class="hljs-type">time</span></span>=<span class="hljs-number"><span class="hljs-number">19</span></span> ms   Reply <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-number"><span class="hljs-number">8.8</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span>: bytes=<span class="hljs-number"><span class="hljs-number">56</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Sequence</span></span>=<span class="hljs-number"><span class="hljs-number">4</span></span> ttl=<span class="hljs-number"><span class="hljs-number">47</span></span> <span class="hljs-type"><span class="hljs-type">time</span></span>=<span class="hljs-number"><span class="hljs-number">20</span></span> ms   Reply <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-number"><span class="hljs-number">8.8</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span>: bytes=<span class="hljs-number"><span class="hljs-number">56</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Sequence</span></span>=<span class="hljs-number"><span class="hljs-number">5</span></span> ttl=<span class="hljs-number"><span class="hljs-number">47</span></span> <span class="hljs-type"><span class="hljs-type">time</span></span>=<span class="hljs-number"><span class="hljs-number">20</span></span> ms <span class="hljs-comment"><span class="hljs-comment">--- 8.8.8.8 ping statistics ---   5 packet(s) transmitted   5 packet(s) received   0.00% packet loss   round-trip min/avg/max = 19/19/21 ms</span></span></code> </pre> <br>  In the System ‚Üí Update Center section, we will try to update the IPS and antivirus signatures by clicking Update immediately opposite, for example, Antivirus Signature Database: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/286/951/7a4/2869517a488cf42c2c8a57eecb6414d2.png"><br>  After some time in the Status column, we can see that the database download failed because the domain name of the update server (sec.huawei.com) could not be resolved.  Indeed, in order for the names to be resolved, you need to register the DNS server in the Network -&gt; DNS section by clicking the Add button: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7d5/046/f66/7d5046f66c5e9b1debbba764f3e7794e.png"><br><br>  After registering the DNS server, everything turned out: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/895/e0a/18a/895e0a18aa0807ac7f9da9c4fbedea8c.png"><br><br>  After that, all signatures will be updated according to their time in the Scheduled Update Time section, in this case every day at 6:38 in the morning. <br><br><h2>  <font color="#0095b6">Configure NAT / PAT for LAN access to the Internet</font> </h2><br>  Configure the Internet access for the local network 192.168.200.0 / 24 (our trust zone) using PAT.  Since in this case the direction of traffic will be from a zone with a higher priority (trust) towards the zone, a lower priority (untrust), you need to configure outbound policy security.  Here is exactly the same rule as we already did for the local zone.  You can configure a new rule, or you can, if all the other parameters are the same, add another Source Zone to the already created policy_to_Inet, in our case trust: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8a2/9cd/581/8a29cd581c3342b64197349d9b7e68b5.png"><br><br>  In the Content Security section, add the default preset profile to the Antivirus subsection and the strict profile to the Intrusion Preventions subsection. <br><br>  Then we will create a NAT policy for the trust zone to access the Internet, ‚Äúmasquerading‚Äù with the external IP address: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/309/0ce/64a/3090ce64ad132c25670101e598a234ea.png"><br><br>  After that, users from the network 192.168.200.0 / 24 will be able to access the Internet. <br><br>  The basic setting of Huawei USG can be considered complete.  The software of the VRP device has been upgraded to the latest version, SSH has been configured for remote management via the command line, setting up update of signatures over the Internet, and access to the Internet for users from the trusted zone. <br><br>  Once again, it is worth noting a very good configuration guide (the HUAWEI USG6000 &amp; USG9500 V500R001C30SPC200 &amp; NGFW Module V500R002C00SPC200 Product Documentation was used in this article.  In addition to the described functions, I configured IPsec site-to-site tunnels, SSL VPN for connecting remote users, integration with Microsoft Active Directory for authorizing remote SSL-VPN users and Single Sign On for domain users (accessing the Internet for domain users without additional authorization) and other. <br><br>  I hope this article will be useful for those who consider as a UTM / NGFW / Firewall device to replace similar devices known American vendors. </div><p>Source: <a href="https://habr.com/ru/post/325676/">https://habr.com/ru/post/325676/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325660/index.html">The State of Reactive in JS: A Practical Review of FRP Libraries</a></li>
<li><a href="../325664/index.html">How I learned to create my mobile apps</a></li>
<li><a href="../325666/index.html">Import Substitution in I2P: Signature in accordance with GOST R 34.10-2012</a></li>
<li><a href="../325668/index.html">Connect to FireBird from Python and monitor the fact of writing to the database</a></li>
<li><a href="../325672/index.html">‚ÄúApache Ignite is a high-tech product‚Äù: GridGain Systems about in-memory computing, open source, the Russian market and not only</a></li>
<li><a href="../325678/index.html">Write on C as a gentleman</a></li>
<li><a href="../325682/index.html">The fraudster pulled out of two companies $ 100 million with the help of social engineering</a></li>
<li><a href="../325684/index.html">"Do not think about support down": how to realize the hidden features of your support service</a></li>
<li><a href="../325686/index.html">Orange pi one</a></li>
<li><a href="../325688/index.html">Introduction to React Loadable</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>