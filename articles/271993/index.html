<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Experimental version of PVS-Studio supporting C #</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We have an experimental version of the PVS-Studio analyzer, which is able to analyze C # projects and which can be shown to the world. This is not Rel...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Experimental version of PVS-Studio supporting C #</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/949/12b/8d9/94912b8d93fe8bd1cd21879f5a5c09ae.png" alt="PVS-Studio for C / C ++ / C #" align="left"><br>  We have an experimental version of the PVS-Studio analyzer, which is able to analyze C # projects and which can be shown to the world.  This is not Release, and not even Beta.  This is just the current build of PVS-Studio.  We want to start getting feedback from our users or potential users regarding C # support as early as possible.  Therefore, we suggest enthusiasts to try the new version of PVS-Studio on their C # projects and tell us about the results, shortcomings and express their wishes.  Oh yeah, and of course the article will describe the results of checking the next project - SharpDevelop. <br><a name="habracut"></a><br><h2>  PVS-Studio </h2><br>  Now one of the important questions is: ‚ÄúWhy make another code analysis tool for C #?‚Äù. <br><br>  Let's try to answer both potential users and ourselves in order to clearly understand where and why we are moving. <br><br>  We have successfully created and continue to develop the PVS-Studio analyzer for the C / C ++ language.  This analyzer implements many interesting and unique ideas for identifying various types of errors.  Over time, it became clear that many of the implemented diagnostics have nothing to do with a specific programming language.  It doesn't matter what language you use.  There will always be typos, mistakes due to carelessness or unsuccessful Copy-Paste. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And then we decided to try to apply our experience to another programming language, to C #.  How far this will be a successful undertaking, time will tell.  We ourselves believe that we will gradually be able to create a very interesting tool that can benefit from a large number of C # developers. <br><br>  Now our task is to start getting feedback from our potential users as early as possible.  The full version of the PVS-Studio analyzer is not ready yet.  Now there are few diagnostics in it (at the time of writing this article there were 36 of them).  But this version can be installed and tried.  And we will be grateful to everyone who does it.  It is important for us to make sure that we are generally moving in the right direction and that the analyzer as a whole is operational.  And we will add new and new diagnostics very quickly. <br><br>  So, I invite everyone to download the current version of the PVS-Studio experimental version from this link: <a href="">http://files.viva64.com/beta/PVS-Studio_setup.exe</a> . <br><br>  <b>Note.</b>  Over time, the above link will become invalid.  Therefore, if you read this article after a month or more from the moment of publication, we suggest you install the current version of the distribution: <a href="http://www.viva64.com/ru/pvs-studio-download/">http://www.viva64.com/ru/pvs-studio-download/</a> <br><br>  If the reader has never tried PVS-Studio, I suggest reading the article " <a href="http://www.viva64.com/ru/b/0305/">PVS-Studio for Visual C ++</a> ".  As you can see, it is focused on C ++, but in fact there is no difference.  From the point of view of the interface, there is almost no difference at all whether you work with C ++ or with C # projects. <br><br>  To send your feedback and suggestions, you can use <a href="http://www.viva64.com/ru/about-feedback/">the feedback page</a> . <br><br><h2>  Check SharpDevelop project </h2><br>  For programmers, ordinary advertising does not work.  However, I know how to attract the attention of these serious and very busy creators.  We check various open projects and write <a href="http://www.viva64.com/ru/a/0084/">articles</a> about it.  There is no better advertising than to show what our tool can do. <br><br>  I see no reason to reinvent the wheel.  Now by the same method I will fascinate C # programmers.  And here is another article about checking open SharpDevelop project. <br><br>  <a href="http://www.sharpdevelop.com/OpenSource/SD/">SharpDevelop</a> is a free development environment for C #, Visual Basic .NET, Boo, IronPython, IronRuby, F #, C ++.  Typically used as an alternative to Visual Studio .NET.  There is also a fork on Mono / GTK + - MonoDevelop. <br><br>  For us, it is important that the project is written entirely in C #.  So, we can check it with an experimental version of PVS-Studio.  The project has 8522 files with the extension ‚Äúcs‚Äù, the total size of which is 45 megabytes. <br><br><h2>  Most suspicious code snippets </h2><br>  <b>Fragment N1</b> <br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> String.Format(<span class="hljs-string"><span class="hljs-string">"Thread Name = {1} Suspended = {2}"</span></span>, ID, Name, Suspended); }</code> </pre> <br>  PVS-Studio warning: V3025 Incorrect format.  A different number of actual arguments is expected while calling 'Format' function.  Expected: 2. Present: 3. Thread.cs 235 <br><br>  The variable ID is not used at all.  Perhaps there is no real error here.  However, this place is clearly worth checking out.  Perhaps it was planned to form a completely different line. <br><br>  <b>Fragment N2</b> <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> String.Format (<span class="hljs-string"><span class="hljs-string">"[Line {0}:{1,2}-{3,4}:{5}]"</span></span>, File, Row, Column, EndRow, EndColumn, Offset); }</code> </pre> <br>  PVS-Studio warning: V3025 Incorrect format.  A different number of actual arguments is expected while calling 'Format' function.  Expected: 4. Present: 6. MonoSymbolTable.cs 235 <br><br>  More interesting case.  What exactly the programmer wanted to do was not clear to me.  Perhaps he wanted to form a message like this: <br><br>  [Line file.cs: 10.20-30.40: 7] <br><br>  But apparently he missed some braces.  Therefore, it turns out that ", 2" and ", 4" sets the alignment of the fields, and does not display the values ‚Äã‚Äãof the EndRow and EndColumn variables at all. <br><br>  I would venture to suggest that the following formatting string will be correct: <br><pre> <code class="cpp hljs">String.Format (<span class="hljs-string"><span class="hljs-string">"[Line {0}:{1},{2}-{3},{4}:{5}]"</span></span>, File, Row, Column, EndRow, EndColumn, Offset);</code> </pre> <br>  <b>Fragment N3</b> <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> MemberCore </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetLaterDefinedMember</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MemberSpec a, MemberSpec b)</span></span></span><span class="hljs-function"> </span></span>{ var mc_a = a.MemberDefinition as MemberCore; var mc_b = b.MemberDefinition as MemberCore; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mc_a.Location.File != mc_a.Location.File) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mc_b; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mc_b.Location.Row &gt; mc_a.Location.Row ? mc_b : mc_a; }</code> </pre> <br>  PVS-Studio warning: V3001 There are identical sub-expressions 'mc_a.Location.File' to the left!  membercache.cs 1306 <br><br>  Here we are dealing with a typo.  I think the following comparison would be the right one: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mc_a.Location.File != mc_b.Location.File)</code> </pre> <br>  <b>Fragment N4</b> <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WhitespaceNode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> whiteSpaceText, TextLocation startLocation)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.WhiteSpaceText = WhiteSpaceText; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.startLocation = startLocation; }</code> </pre> <br>  PVS-Studio warning: V3005 The 'this. WhiteSpaceText' variable is assigned to itself.  WhitespaceNode.cs 65 <br><br>  Beautiful mistake.  Here the static analyzer showed its main essence.  He is attentive and, unlike a person, does not get tired.  So he noticed a typo.  Do you see her?  Agree to find the error is not easy. <br><br>  So a typo in one letter.  It was necessary to write "= whiteSpaceText".  And it says "= WhiteSpaceText".  As a result, the value of 'WhiteSpaceText' in the class remains unchanged. <br><br>  In general, this is a good example of how not to name variables.  A bad idea is to make a difference in the names of only one lowercase / uppercase letter.  However, reasoning about coding style is beyond the scope of the article.  Moreover, it smacks of a holy war of discussion. <br><br>  <b>Fragment N5</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Enabled { get { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> base.Enabled; } <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.InvokeRequired) { base.Enabled = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.VScrollBar.Enabled = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.hexView.Enabled =<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.textView.Enabled = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.side.Enabled = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.header.Enabled = value; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { base.Enabled = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.VScrollBar.Enabled = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.hexView.Enabled = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.textView.Enabled = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.side.Enabled = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.header.Enabled = value; } } }</code> </pre> <br>  PVS-Studio warning: V3004 The 'then' statement is equivalent to the 'else' statement.  Editor.cs 225 <br><br>  It is very suspicious that the same actions will be performed regardless of the value of 'this. InvokeRequired'.  I have a strong suspicion that the string "base.Enabled = ....." was copied.  And then they forgot to change something in it. <br><br>  <b>Fragment N6, N7, N8, N9</b> <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ .... ISolutionFolderNode solutionFolderNode = node as ISolutionFolderNode; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (node != null) { ISolutionFolder newSolutionFolder = solutionFolderNode.Folder.CreateFolder(....); solutionFolderNode.Solution.Save(); .... }</code> </pre> <br>  PVS-Studio warning: V3019 Possibly an incorrect variable is compared to null after type conversion using 'as' keyword.  Check variables 'node', 'solutionFolderNode'.  SolutionNodeCommands.cs 127 <br><br>  We wanted to perform some actions if the 'node' is inherited from the 'ISolutionFolderNode' interface.  But we checked the wrong variable.  The correct option is: <br><pre> <code class="cpp hljs">ISolutionFolderNode solutionFolderNode = node as ISolutionFolderNode; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (solutionFolderNode != null) {</code> </pre> <br>  By the way, this is a fairly common pattern of error in C # programs.  For example, in the SharpDevelop project, there were 3 more such errors: <ul><li>  V3019 Possibly incorrectly variable conversion compared to null after type conversion using 'as' keyword.  Check variables 'geometry', 'g'.  PathHandlerExtension.cs 578 </li><li>  V3019 Possibly incorrectly variable conversion compared to null after type conversion using 'as' keyword.  Check variables 'oldTransform', 'tg'.  ModelTools.cs 420 </li><li>  V3019 Possibly incorrectly variable conversion compared to null after type conversion using 'as' keyword.  Check variables 'node', 'solutionFolderNode'.  SolutionNodeCommands.cs 104 </li></ul><br>  <b>Fragment N10</b> <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VisitInvocationExpression</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... foundInvocations = (idExpression.Identifier == _varName); foundInvocations = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; .... }</code> </pre> <br>  PVS-Studio warning: V3008 The 'foundInvocations' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 211, 209. RedundantAssignmentIssue.cs 211 <br><br>  Very suspicious reassignment.  Perhaps the second assignment was written in the process of debugging the code, and then forgot about it. <br><br>  <b>Error n11</b> <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Snippet </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateAvalonEditSnippet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pos = <span class="hljs-number"><span class="hljs-number">0</span></span>; foreach (Match m in pattern.Matches(snippetText)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pos &lt; m.Index) { snippet.Elements.Add(....); pos = m.Index; } snippet.Elements.Add(....); pos = m.Index + m.Length; } .... }</code> </pre> <br>  PVS-Studio warning: V3008 The 'pos' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 151, 148. CodeSnippet.cs 151 <br><br>  Another suspicious reassignment.  Here either an error or the assignment ‚Äúpos = m.Index;‚Äù is redundant. <br><br>  <b>Fragment N12</b> <br><pre> <code class="cpp hljs">.... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> Text { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnKeyUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(KeyEventArgs e)</span></span></span><span class="hljs-function"> </span></span>{ .... editor.Text.Insert(editor.CaretIndex, Environment.NewLine); .... }</code> </pre> <br>  PVS-Studio warning: V3010 The return value of the function 'Insert' is required to be utilized.  InPlaceEditor.cs 166 <br><br>  C # strings are immutable.  Therefore, if we do something with a string, the result must be saved somewhere.  However, it is easy to forget about it, as for example it happened here.  The developer decided that by calling the Insert () method he would add something to the string.  But it is not.  The correct code is: <br><pre> <code class="cpp hljs">editor.Text = editor.Text.Insert(editor.CaretIndex, Environment.NewLine);</code> </pre> <br>  <b>Fragment N13, N14</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IEnumerable&lt;PropertyMapping&gt; GetMappingForTable(SSDL.EntityType.EntityType table) { var value = GetSpecificMappingForTable(table); var baseMapping = BaseMapping; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (baseMapping != null) value.Union(baseMapping.GetMappingForTable(table)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value; }</code> </pre> <br>  PVS-Studio warning: V3010 The return value of the function 'Union' is required to be utilized.  MappingBase.cs 274 <br><br>  In general, I have a premonition that in C # projects I will encounter quite a few errors related to the fact that the programmer is waiting for the object to change, but this does not happen. <br><br>  The extension method 'Union', defined for collections implementing the IEnumerable interface, allows you to get the intersection of two sets.  However, the container 'value' does not change.  The correct option is: <br><pre> <code class="cpp hljs">value = value.Union(baseMapping.GetMappingForTable(table));</code> </pre> <br>  Another such situation can be found here: V3010 The return value of the function 'OrderBy' is required to be utilized.  CodeCoverageMethodElement.cs 124 <br><br>  <b>Fragment N15</b> <br><br>  The PVS-Studio analyzer is trying to identify situations where the programmer could forget to do something in switch ().  The logic of deciding whether to warn or not is quite complicated.  Sometimes false alarms are obtained, sometimes there are obvious errors.  Consider one of these triggers. <br><br>  So, in the code there is such an enumeration: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> TargetArchitecture { I386, AMD64, IA64, ARMv7, }</code> </pre> <br>  In places, all variants of this listing are used: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">TargetArchitecture </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadArchitecture</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ var machine = ReadUInt16 (); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (machine) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x014c</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> TargetArchitecture.I386; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x8664</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> TargetArchitecture.AMD64; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x0200</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> TargetArchitecture.IA64; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x01c4</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> TargetArchitecture.ARMv7; } <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NotSupportedException (); }</code> </pre> <br>  However, there are also suspicious places.  For example, the analyzer called my attention to the following code: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">ushort </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetMachine</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">module</span></span>.Architecture) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TargetArchitecture.I386: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0x014c</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TargetArchitecture.AMD64: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0x8664</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> TargetArchitecture.IA64: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0x0200</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NotSupportedException (); }</code> </pre> <br>  PVS-Studio warning: V3002 The switch statement doesn‚Äôt cover all of the TargetArchitecture 'enum: ARMv7.  ImageWriter.cs 209 <br><br>  As you can see, the case is not considered if the architecture is ARMv7.  I do not know if it is a mistake or not.  But it seems to me that this is a mistake.  The name ARMv7 is at the end of the listing, which means it was added last.  As a result, the programmer could forget to fix the GetMachine () function and take this architecture into account. <br><br>  <b>Fragment N15</b> <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DetermineCurrentKind</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ..... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Brush is LinearGradientBrush) { linearGradientBrush = Brush as LinearGradientBrush; radialGradientBrush.GradientStops = linearGradientBrush.GradientStops; CurrentKind = BrushEditorKind.Linear; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Brush is RadialGradientBrush) { radialGradientBrush = Brush as RadialGradientBrush; linearGradientBrush.GradientStops = linearGradientBrush.GradientStops; CurrentKind = BrushEditorKind.Radial; } }</code> </pre> <br>  PVS-Studio warning: V3005 The 'linearGradientBrush.GradientStops' variable is assigned to itself.  BrushEditor.cs 120 <br><br>  A rather heavy piece of code to read.  And apparently so it made a mistake.  Most likely the code was written by the Copy-Paste method and was incorrectly changed in one place. <br><br>  Apparently, instead of: <br><pre> <code class="cpp hljs">linearGradientBrush.GradientStops = linearGradientBrush.GradientStops;</code> </pre> <br>  It should have been written: <br><pre> <code class="cpp hljs">linearGradientBrush.GradientStops = radialGradientBrush.GradientStops;</code> </pre> <br><h2>  Smells </h2><br>  Many of the fragments pointed to by the analyzer are hardly real errors.  On the other hand, messages issued on such a code cannot be called false alarms either.  Usually about such code they say that it smells. <br><br>  Above, I looked at a lot of code that seems to contain errors.  Now I will give a few examples of smells.  I will not consider all situations, it is not interesting.  I will confine myself to 3 examples.  Developers can familiarize themselves with the remaining odors by checking out the SharpDevelop project. <br><br>  <b>N1 code snippet snippet</b> <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CanExecuteCommand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ICommand command)</span></span></span><span class="hljs-function"> </span></span>{ .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (command == DockableContentCommands.ShowAsDocument) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (State == DockableContentState.Document) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (command == DockableContentCommands.ShowAsDocument) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (State == DockableContentState.Document) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } .... }</code> </pre> <br>  PVS-Studio warning: V3003 The use of if (A) {...} else if (A) {...} 'pattern was detected.  There is a possibility of logical error presence.  Check lines: 773, 798. DockableContent.cs 773 <br><br>  As you can see, the program contains two identical blocks.  The condition of the lower block 'if' will never be fulfilled.  But in my opinion this is not a mistake.  It seems to me that they simply accidentally duplicated the block, and it is superfluous.  Nevertheless, this is a place that is worth a look and fix. <br><br>  <b>N2 code snippet snippet</b> <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PropertyExpandButton_Click</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object sender, RoutedEventArgs e)</span></span></span><span class="hljs-function"> </span></span>{ .... ContentPropertyNode clickedNode = clickedButton.DataContext as ContentPropertyNode; clickedNode = clickedButton.DataContext as ContentPropertyNode; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (clickedNode == null) .... }</code> </pre> <br>  PVS-Studio warning: V3008 The 'clickedNode' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 105, 104. PositionedGraphNodeControl.xaml.cs 105 <br><br>  The code is redundant and can be simplified to: <br><pre> <code class="cpp hljs">ContentPropertyNode clickedNode = clickedButton.DataContext as ContentPropertyNode; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (clickedNode == null)</code> </pre> <br>  <b>N3 code snippet snippet</b> <br><pre> <code class="cpp hljs">IEnumerable&lt;ICompletionData&gt; CreateConstructorCompletionData(IType hintType) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(hintType.Kind == TypeKind.Interface &amp;&amp; hintType.Kind != TypeKind.Array)) { .... }</code> </pre> <br>  PVS-Studio warning: V3023 Consider inspecting this expression.  The expression is misprint.  CSharpCompletionEngine.cs 2392 <br><br>  Redundant code.  The expression can be simplified: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hintType.Kind != TypeKind.Interface) {</code> </pre> <br>  I can continue, but perhaps enough.  All other "smells" are quite monotonous and similar to those already listed. <br><br><h2>  Conclusion </h2><br>  Well, as you can see, C # itself does not protect against stupid errors.  Therefore, I can give this picture here with a clear conscience. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6bf/b62/ec9/6bfb62ec94eccf76aae30c1d174cd5f7.png" alt="PVS-Studio and C #"><br><br>  Long live the unicorn, which has now learned to find errors in C # programs! <br><br>  But seriously, then: <ul><li>  When programming, we all make not only complex, but also simple mistakes.  A lot of time is spent on finding simple errors.  And sometimes a <a href="http://www.viva64.com/ru/b/0221/">lot</a> . </li><li>  A large number of simple errors can be identified at the stage of writing code, if you use the tools of static code analysis.  The use of such tools significantly saves time, which can be spent on searching and debugging many errors. </li><li>  The most important thing in static analysis is regular use.  There is no point in one-time checks static analysis.  Its whole point is to find the error immediately after it appeared in the code.  Rare checks take a lot of time and do little good.  After all, those errors that could be found quickly and easily, already by this moment corrected by sweat and blood. </li></ul><br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0359/"><img src="https://habrastorage.org/getpro/habr/post_images/35e/064/ddf/35e064ddf91f5d99b620384893909ff7.png"></a> </div><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Andrey Karpov.  <a href="http://www.viva64.com/en/b/0359/">Experimental version of PVS-Studio with C # support</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio, version 2015</a> .  Please review the list. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/271993/">https://habr.com/ru/post/271993/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../271983/index.html">Linux, delayed driver loading and broken interrupts</a></li>
<li><a href="../271985/index.html">Quarterly site security check</a></li>
<li><a href="../271987/index.html">IBM Bluemix Business Quest - Special Project for Application Developers</a></li>
<li><a href="../271989/index.html">Welcome to PGConf 2016 - Russian PostgreSQL conference</a></li>
<li><a href="../271991/index.html">Covering graphs in software testing, part 1</a></li>
<li><a href="../271997/index.html">Configuration management in a software project</a></li>
<li><a href="../271999/index.html">Successful implementation of SIEM. Part 2</a></li>
<li><a href="../272003/index.html">Check Digit by Damme Method</a></li>
<li><a href="../272005/index.html">Swift! Protocol Oriented</a></li>
<li><a href="../272007/index.html">NextCastle Party 2015: how I showed my game</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>