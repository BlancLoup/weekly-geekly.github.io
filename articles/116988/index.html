<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automation of localization in Silverlight using Visual Studio macros</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. I want to share a small experience in the field of automation of localization of applications developed using SilverLight technology. After rea...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automation of localization in Silverlight using Visual Studio macros</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/habraeffect/c2/f8/c2f85dfacd8aac25a680915077919c20.jpg" alt="big red button"><br><br>  Hello.  I want to share a small experience in the field of automation of localization of applications developed using SilverLight technology.  After reading <a href="http://habrahabr.ru/blogs/silverlight/87450/">this</a> post (Localization in Silverlight), it became clear that all string constants would have to be put into resource files, which cannot be called a particularly intellectual work.  Therefore, I decided to go a long way and try to automate this process using macros built into Visual Studio. <br><br>  Due to the fact that I was also required to brush my code a little, it was decided to abandon full automation (complete scanning of all xaml files with searching for Russian letters and putting them into resources).  Plus I could not think of normal automation of replacing string constants in .cs files. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After analysis, the following macro requirements were developed: <br><ul><li>  analyze the phrase selected by the user (by pressing a certain key combination); </li><li>  find the translation of the phrase in google translate (so as not to strain the user by inventing the name of the resource); </li><li>  add a phrase to the previously specified resources (and it is necessary that the changes be made via VS, since we need a generated proxy class); </li><li>  replace the user selected phrase with a binding to the resource. </li></ul><br><a name="habracut"></a><br>  Visual Studio has a convenient macro editor.  To call it, you must select in the menu Tools / Macros / Macros IDE.  Before you start, you need to create a file with macros (the code is written on VB .Net).  Any public procedure without parameters is visible in the list of macros and can be called by pressing a hot key or via Macro Explorer. <br><br><h5>  Task 1. Definition of the highlighted word in VS </h5><br><pre><code class="hljs vbscript"><span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> doc As Document = DTE.ActiveDocument <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> d As TextDocument = doc.Object <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> bp = d.Selection.AnchorPoint.CreateEditPoint, ep = d.Selection.BottomPoint.CreateEditPoint <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> caption As <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> = bp.GetText(ep) <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.IsNullOrWhiteSpace(caption)) <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span> <span class="hljs-comment"><span class="hljs-comment">'       -  </span></span></code> </pre> <br><br>  We receive the active document, we bring it to the text document (more convenient class, for work with the text).  We get two points: the beginning and end of the selection (it could have been easier, via doc.Selection.Text, but when opening a new file in the studio and returning back to the file being edited, the selection gets lost, which is very inconvenient, and these points will help us to restore the text selection ). <br><br><h5>  Task 2. Getting the name of the resource </h5><br>  The easiest way to get the resource name is to translate the selected phrase into English (note: the easiest way is not the most correct one).  For the translation, it was decided to use the Google Translate service, as this service has a simple API. <br>  <b>As a result of the request, we get the following JSON object:</b> <br> <code>{"responseData": {"translatedText":"Organization Structure"}, "responseDetails": null, "responseStatus": 200} <br></code> <br><pre> <code class="hljs pgsql">Private <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> ConvertToResourceName(ByVal <span class="hljs-type"><span class="hljs-type">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> String) <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> String Dim result <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> String = (<span class="hljs-built_in"><span class="hljs-built_in">New</span></span> WebClient()).DownloadString("http://ajax.googleapis.com/ajax/services/language/translate?v=1.0&amp;q=" + <span class="hljs-type"><span class="hljs-type">text</span></span> + "&amp;langpair=ru|en") Dim stream <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-built_in"><span class="hljs-built_in">New</span></span> MemoryStream(<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span>.Unicode.GetBytes(result)) Dim serializer <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-built_in"><span class="hljs-built_in">New</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Runtime.Serialization.Json.DataContractJsonSerializer(GetType(TranslateResult)) <span class="hljs-keyword"><span class="hljs-keyword">Return</span></span> String.<span class="hljs-keyword"><span class="hljs-keyword">Join</span></span>("", CType(serializer.ReadObject(stream), TranslateResult).responseData.translatedText _ .Split(" ", ".", ",", "!", "(", ")", vbCrLf, vbCr) _ .<span class="hljs-keyword"><span class="hljs-keyword">Where</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">Function</span></span>(word) <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> String.IsNullOrWhiteSpace(word)) _ .<span class="hljs-keyword"><span class="hljs-keyword">Select</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">Function</span></span>(word) word(<span class="hljs-number"><span class="hljs-number">0</span></span>).ToString().ToUpper() + word.Substring(<span class="hljs-number"><span class="hljs-number">1</span></span>)) _ .ToArray()) <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span></code> </pre><br>  To receive a transfer, you must perform a special request to the Google service and pass it a string with text.  The only thing that has complicated this code quite a bit is that as a result, we are returned not just a string, but a JSON object, which must be deserialized first.  For deserialization, the DataContractJsonSerializer class was used.  To use the DataContractJsonSerializer in macros, you need to add the System.Runtime.Serialization.dll assembly to the references and implement the class corresponding to the Google answer, or rather two classes. <br><br>  <b>Note:</b> before using the name, you can ask the user to confirm the correctness of the choice of transfer (with the possibility of correction). <br><br>  <b>Note:</b> for LINQ to Object to work, you must add references to System.Core.dll <br><br><pre> <code class="hljs delphi">&lt;DataContract()&gt; _ <span class="hljs-keyword"><span class="hljs-keyword">Public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Class</span></span> TranslateResult &lt;DataContract()&gt; _ <span class="hljs-keyword"><span class="hljs-keyword">Public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Class</span></span> ResponseDataClass &lt;DataMember()&gt; _ <span class="hljs-keyword"><span class="hljs-keyword">Public</span></span> translatedText <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> &lt;DataMember()&gt; _ <span class="hljs-keyword"><span class="hljs-keyword">Public</span></span> responseDetails <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> &lt;DataMember()&gt; _ <span class="hljs-keyword"><span class="hljs-keyword">Public</span></span> responseStatus <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-keyword"><span class="hljs-keyword">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Class</span></span> &lt;DataMember()&gt; _ <span class="hljs-keyword"><span class="hljs-keyword">Public</span></span> responseData <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> ResponseDataClass <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Class</span></span></code> </pre><br>  After receiving the translation, you need to slightly decorate the result, namely: remove all prohibited characters and lead to <a href="http://ru.wikipedia.org/wiki/CamelCase">CamelCase</a> style. <br><br><h5>  Task 3. Adding a new line to resources </h5><br>  Initially, you must activate the window with the resource editor, or open a new window in VS.  And if a new window was opened, the focus will move to it.  In order not to knock down the user, you need to return the focus back. <br><pre> <code class="hljs pgsql">Private <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> FindWindow(ByVal fileName <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> String) <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Window</span></span> <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> <span class="hljs-type"><span class="hljs-type">Integer</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">To</span></span> DTE.Windows.Count <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> (DTE.Windows.Item(i).ProjectItem <span class="hljs-keyword"><span class="hljs-keyword">Is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Nothing</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> (DTE.Windows.Item(i).ProjectItem.FileNames(<span class="hljs-number"><span class="hljs-number">0</span></span>) = fileName) <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Return</span></span> DTE.Windows.Item(i) <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> Next Dim oldactive <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> Document = DTE.ActiveDocument Dim newf = DTE.ItemOperations.OpenFile(fileName, Constants.vsViewKindTextView) oldactive.Activate() <span class="hljs-keyword"><span class="hljs-keyword">Return</span></span> newf <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span></code> </pre><br>  Since resource files can be several for different languages, we memorize them in an array. <br><pre> <code class="hljs vbscript"><span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> resourceFiles() As <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> = {<span class="hljs-string"><span class="hljs-string">" \ProjectResources.resx"</span></span>, _ <span class="hljs-string"><span class="hljs-string">" \ProjectResources.kk-KZ.resx"</span></span>}</code> </pre><br>  You can optimize this piece and try to automatically find files with resources. <br>  Then we go over each resource file, open it, check the availability of the resource with the same name, and if not, add it. <br><pre> <code class="hljs vbscript"><span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> paramName As <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> = ConvertToResourceName(caption) <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Each</span></span> item As <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">In</span></span> resourceFiles <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> textDocument As TextDocument = FindWindow(item).Document.Object <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> startPoint = textDocument.StartPoint.CreateEditPoint, endPoint = textDocument.EndPoint.CreateEditPoint <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> root = XElement.Parse(startPoint.GetText(endPoint)) <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> param As XElement = root.Elements(<span class="hljs-string"><span class="hljs-string">"data"</span></span>).FirstOrDefault(<span class="hljs-keyword"><span class="hljs-keyword">Function</span></span>(el) el.Attribute(<span class="hljs-string"><span class="hljs-string">"name"</span></span>) = paramName) <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> (param <span class="hljs-keyword"><span class="hljs-keyword">Is</span></span> <span class="hljs-literal"><span class="hljs-literal">Nothing</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> root.Add(<span class="hljs-keyword"><span class="hljs-keyword">New</span></span> XElement(<span class="hljs-string"><span class="hljs-string">"data"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">New</span></span> XAttribute(<span class="hljs-string"><span class="hljs-string">"name"</span></span>, paramName) _ , <span class="hljs-keyword"><span class="hljs-keyword">New</span></span> XAttribute(XName.<span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>(<span class="hljs-string"><span class="hljs-string">"space"</span></span>, <span class="hljs-string"><span class="hljs-string">"http://www.w3.org/XML/1998/namespace"</span></span>), <span class="hljs-string"><span class="hljs-string">"preserve"</span></span>) _ , <span class="hljs-keyword"><span class="hljs-keyword">New</span></span> XElement(<span class="hljs-string"><span class="hljs-string">"value"</span></span>, caption))) startPoint.ReplaceText(endPoint, root.ToString(), vsEPReplaceTextOptions.vsEPReplaceTextAutoformat) textDocument.Parent.Save() <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span></code> </pre><br>  The resource file is a simple xml-ku with data fields, respectively, the easiest way to directly modify the entire contents of the file (the content is obtained from the open document) and then completely update the entire document. <br>  After modifying the document - you need to save the changes, which will lead to the generation of a proxy class. <br>  <b>Note:</b> for XElement to work, you need to add references to System.Xml, System.Xml.Linq; <br><br><h5>  Task 4. Replace the word selected by the user with the binding template to the new resource </h5><br>  Since the access to resources in xaml / cs / vb files is different, it is necessary to check the extension of the open file and form a line accordingly. <br><pre> <code class="hljs pgsql">Dim replaceString <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> String <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Case</span></span> <span class="hljs-type"><span class="hljs-type">Path</span></span>.GetExtension(doc.FullName).ToLower() <span class="hljs-keyword"><span class="hljs-keyword">Case</span></span> ".xaml" : replaceString = "{Binding Source={StaticResource ResourceProvider},Path=ProjectResources." + paramName + "}" <span class="hljs-keyword"><span class="hljs-keyword">Case</span></span> ".cs" : replaceString = "ProjectResources." + paramName <span class="hljs-keyword"><span class="hljs-keyword">Case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Else</span></span> : replaceString = paramName <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> bp.ReplaceText(ep, replaceString, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-string"><span class="hljs-string">'   d.Selection.MoveToPoint(bp) d.Selection.SwapAnchor() d.Selection.MoveToPoint(ep, True) '</span></span>    ,  </code> </pre><br><br>  All macro is ready to use. <br><br><h5>  Advantages / disadvantages of using macros </h5><br><ul><li>  the macro call can be hung up on hotkeys, through the menu item tools / options in the Keyboard section; </li><li>  it is very easy to correct the code, in case it is necessary to modify it a bit (for example, you can not write a complicated mechanism for finding files with resources, but simply start constant paths in the code and correct them if necessary); </li><li>  pretty easy debugging code; </li><li>  good integration with VS. </li></ul><br>  from obvious flaws <br><ul><li>  you cannot write C # code; </li><li>  poor performance, start long enough; </li><li>  frequent departures, especially during debugging. </li></ul><br>  The article provides a general approach to automating the formation of resource files, respectively, you can adjust it as you need. </div><p>Source: <a href="https://habr.com/ru/post/116988/">https://habr.com/ru/post/116988/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../116976/index.html">Shop of useful services for owners of Toshiba laptops</a></li>
<li><a href="../116977/index.html">Toshiba notebook family has been replenished with two budget models</a></li>
<li><a href="../116982/index.html">Export favorites Habra in FB2</a></li>
<li><a href="../116983/index.html">Data Mining Cup 2011</a></li>
<li><a href="../116985/index.html">Chinese tablet Gpad Gforce</a></li>
<li><a href="../116989/index.html">The Chinese will launch a licensed music service</a></li>
<li><a href="../116990/index.html">Effective and ineffective websites</a></li>
<li><a href="../116992/index.html">Director of the Linux Foundation: no need to offend Microsoft</a></li>
<li><a href="../116994/index.html">Using UpdatePanel and others like it</a></li>
<li><a href="../116997/index.html">A brilliant example of Chinese engineering is a 500 GB portable hard drive.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>