<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We program microcontrollers in QtCreator</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For some reason, there is little documentation on qbs on the Internet, and I decided to correct this situation a little. I will try to describe in the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We program microcontrollers in QtCreator</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/d14/884/8e9/d148848e9e2442e2a0cd684564c88f0f.png"><br><br>  For some reason, there is little documentation on qbs on the Internet, and I decided to correct this situation a little.  I will try to describe in the form of a narration what needs to be done so that in QtCreator you can compile (and not only) anything for anything. <br><a name="habracut"></a><br>  Somehow I got it so that the projects in which you need to do something just for one platform have practically disappeared.  Usually it is necessary to write the firmware for the microcontroller and the control program for a smartphone or desktop.  You can do everything the old-fashioned way: write code for each device in its native development environment. <br><br>  But believe me, it pretty quickly zadalbyvaet.  Under Windows - MSVC, under ARM - CooCox or Keil (I offer my condolences to work under IAR), under MSP - CCS, under android - eclipse, under ios - Xcode, under peaks - MPLAB.  And it would be okay, it would be possible to work with all this, but after all FIG: everywhere there are problems, subtleties and unwritten rules.  All this is superimposed on the total stagnation of the so popular eclipse multiplied by the curvature additions from manufacturers. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Some time ago I started to reduce all my development for mobile and desktop applications under one platform.  After quite a long time for Internet users, my choice was Qt.  There is everything you need, if necessary, you can pick up the native code.  In general, the task is closed. <br><br>  But with the microcontrollers, the situation did not want to emerge categorically.  Mainly due to the fact that everywhere their Wishlist and Wishlist.  Well, okay, I already complained about that.  I would have suffered for a long time until I suddenly came across a short description of qbs. <br><br>  Those interested can rummage around on an Internet themselves, but if briefly, then this is a substitute for make and cmake, using a normal (there should be a smail) programming language.  And QtCreator itself is going with her help, which means she has already got out of her pants ... <br><br>  Yes, the documentation for it as usual, the cat wept, but the source has not yet been canceled, so I quickly realized that this was practically what I was looking for.  Judge for yourself: you sit in the same development environment (very pleasant and fast by itself) and calmly write and edit files for several platforms.  And you, as a code writer, do not care for the presence of any problems with the "native" environments. <br><br>  Enough effusions, time to try.  Let's create a very simple project in which we will have a desktop and microcontroller component. <br><br>  Open the QtCreator, choose to create a Non-Qt Project (so long as you don‚Äôt bother much) and then choose where C and Qbs are.  Pay attention to the nice looking words. Platform independent <br><br><img src="https://habrastorage.org/files/d0b/7cd/7ab/d0b7cd7ab0d84b569ad9427d62c3d16e.png"><br><br>  As a result, we get one main.c and qbs.  You can already click ‚Äúbuild‚Äù and get the output of Hello World. <br><br>  Open qbs and do not understand anything.  Therefore, we erase everything, arm ourselves with the Internet and begin to write.  Javascript and all that. <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> qbs</code> </pre> <br>  So, here it seems clear.  We import all qbs necessary for work. <br><br><pre> <code class="javascript hljs">Project { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"simple"</span></span> }</code> </pre><br>  Save and watch the disappearance of main.c from the left panel.  When you try to start a project, QtCreator will ask: why start something up?  In principle, so far everything is logical. <br><br>  What does the qbs terminology project consist of?  Of the products.  And there may be several of them, but for the time being I will make one. <br><br><pre> <code class="javascript hljs">Project { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"simple"</span></span> Product { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"desktop"</span></span> } }</code> </pre><br>  Now for our "desktop" indicate the source. <br><br><pre> <code class="javascript hljs">Project { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"simple"</span></span> Product { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"desktop"</span></span> files: <span class="hljs-string"><span class="hljs-string">"main.c"</span></span> } }</code> </pre><br>  When you try to compile, nothing will change.  We‚Äôll see some tutorials and add dependency on cpp and indicate that this application is actually. <br><br><pre> <code class="javascript hljs">Project { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"simple"</span></span> Product { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"desktop"</span></span> files: <span class="hljs-string"><span class="hljs-string">"main.c"</span></span> Depends {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"cpp"</span></span>} type: <span class="hljs-string"><span class="hljs-string">"application"</span></span> } }</code> </pre><br>  And now, when trying to build an application, QtCreator will rustle a little with the disk and the required output will appear in the Application Output panel <br><br><img src="https://habrastorage.org/files/305/763/4b3/3057634b3a794284b5cdef435f602b35.png"><br><br>  Yeah, so we're on the right track.  It remains to figure out what those two magic lines are doing. <br><br><pre> <code class="javascript hljs">Depends {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"cpp"</span></span>}</code> </pre><br>  I read the documentation and understand that with this command I establish the dependence of the project on some module named cpp.  It became clearer?  I do not. <br><br>  With a simple search I find something similar in / usr / share / qtcreator / qbs / share / qbs / modules / ((If you have another operating system, then most likely the similar lies somewhere near QtCreator).  In short, there is a bunch of javascript that, depending on the platform, the compiler selects for this platform.  It makes no sense to repeat completely the same to me, so I leave it as it is. <br><br><pre> <code class="javascript hljs">type: <span class="hljs-string"><span class="hljs-string">"application"</span></span></code> </pre><br>  From the documentation: <i>The file tags matching the product's target artifacts</i> .  Artifact ... <i>An Rif or Transformer</i> . <i>Or</i> err ... Rule?  <i>Creates transformers for input tags.</i>  Reminds situation about Sepulcary ... Transformer?  <i>Creates files, typically from other files</i> <br><br>  I crawl on the available and I understand that approximately this is a certain set of rules that tells the build system how to build the compiled.  Well, roughly speaking, you need to get an application, a library or something else at the exit.  Again, though it became a little clearer, but not by much.  Again, while we take for granted. <br><br>  But back to our project.  Let's add another product, just for the microcontroller. <br><br><pre> <code class="javascript hljs">Project { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"simple"</span></span> Product { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"desktop"</span></span> files: <span class="hljs-string"><span class="hljs-string">"main.c"</span></span> Depends {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"cpp"</span></span>} type: <span class="hljs-string"><span class="hljs-string">"application"</span></span> } Product { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"micro"</span></span> files: <span class="hljs-string"><span class="hljs-string">"blink.c"</span></span> } }</code> </pre><br>  When we try to do something, we immediately get a message that there is no blink.c file at all.  Well, ok, let's add a blink.c file to the project.  As the name implies, this is the same HelloWorld, only for microcontrollers.  I took from the examples for the msp430 microcontroller family. <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;msp430.h&gt; int main(void) { WDTCTL = WDTPW + WDTHOLD; P1DIR |= 0x01; while (1) { P1OUT ^= 0x01; __delay_cycles(1000000); // 1 second @ 1MHz } return 0; }</span></span></span></span></code> </pre><br>  Being compiled and flooded, it will begin to pull the P1.0 foot at an interval of one second.  And since most of the demo and developer boards have a LED on this leg, it will flash. <br><br>  Now QtCreator does not swear, but nothing is poured into the microcontroller either.  Strange, yes? <br><br>  It makes no sense to add Depends {name: ‚Äúcpp‚Äù}, because the native gcc installed in the system is not aware of the existence of such a platform, and it will be useful in the future, for example, for peak controllers, where everything is in general. <br><br>  Now we will use fragments of those sacred letters that we met earlier. <br><br>  For a start, I prefer in microcontroller projects to paint each functional in my file.  Write each file by hand?  Laziness.  We peep the solution and rewrite the block <br><br><pre> <code class="javascript hljs">Product { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"micro"</span></span> Group { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"msp430 sources"</span></span> files: <span class="hljs-string"><span class="hljs-string">'src/*.c'</span></span> fileTags: [<span class="hljs-string"><span class="hljs-string">'c'</span></span>] } }</code> </pre><br>  Here we create a group of files that we call "msp430 sources" and stupidly include in it all the files that fit the src / *. C mask.  For further work with them, we tag them with the letter C. <br><br>  What to do with them?  In qbs there are two things for this case - Rule and Transformer.  In fact, they are close, but slightly different.  I will try to describe a difference on fingers. <br><br>  Rule can trigger on every file that falls under something.  It can work once for each file (for example, to call the compiler), or maybe once for everything (linker). <br><br>  Transformer is designed to trigger only on one file, with a predefined name.  For example, a flash driver or some tricky script. <br><br>  Ok, we add a rule that should work on all our files marked as ‚Äúc‚Äù. <br><br><pre> <code class="javascript hljs">Product { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"micro"</span></span> Group { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"msp430 sources"</span></span> files: <span class="hljs-string"><span class="hljs-string">'src/*.c'</span></span> fileTags: [<span class="hljs-string"><span class="hljs-string">'c'</span></span>] } Rule { <span class="hljs-attr"><span class="hljs-attr">inputs</span></span>: [<span class="hljs-string"><span class="hljs-string">"c"</span></span>] prepare: { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JavaScriptCommand(); cmd.description = <span class="hljs-string"><span class="hljs-string">"file passing"</span></span> cmd.silent = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; cmd.highlight = <span class="hljs-string"><span class="hljs-string">"compiler"</span></span>; cmd.sourceCode = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ print(<span class="hljs-string"><span class="hljs-string">"Nothing to do"</span></span>); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cmd; } } }</code> </pre><br>  In principle, everything is clear from the syntax.  There are inputs, there is prepare, into which javascript is thrust, which performs the necessary.  In this case, it should show file passing in the Compile Output window, and output Nothing to do somewhere.  Well, according to the documentation like that. <br><br>  We start recompilation of everything and we look.  I don‚Äôt know about you, but I don‚Äôt see anything.  Why?  Because qbs is painfully intelligent, and the documentation for it suffers from lacunae. <br><br>  The rule does not work, because qbs believes that it does not perform any actions in the system and nothing depends on it.  In principle, this corresponds to reality, but it prevents the verification. <br><br>  Ok, those artifacts are responsible for this.  They are the results of a Rule or Transformer activity.  This is best explained with a compilation example.  When we compile a .c file, then we will get an objectfile on the output.  We need it for further linking, but on the other hand, we can delete it, because then we can easily generate it anew. <br><br>  Again we copy the example from the documentation and slightly modernize it. <br><br><pre> <code class="javascript hljs">Rule { <span class="hljs-attr"><span class="hljs-attr">inputs</span></span>: [<span class="hljs-string"><span class="hljs-string">"c"</span></span>] Artifact { <span class="hljs-attr"><span class="hljs-attr">fileTags</span></span>: [<span class="hljs-string"><span class="hljs-string">'obj'</span></span>] filePath: <span class="hljs-string"><span class="hljs-string">'.obj/'</span></span> + qbs.getHash(input.baseDir) + <span class="hljs-string"><span class="hljs-string">'/'</span></span> + input.fileName + <span class="hljs-string"><span class="hljs-string">'.o'</span></span> } prepare: { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JavaScriptCommand(); cmd.description = <span class="hljs-string"><span class="hljs-string">"Compiling "</span></span>+ input.fileName cmd.silent = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; cmd.highlight = <span class="hljs-string"><span class="hljs-string">"compiler"</span></span>; cmd.sourceCode = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ print(<span class="hljs-string"><span class="hljs-string">"Nothing to do"</span></span>); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cmd; } }</code> </pre><br>  Now we say that after our activity there will be artifacts in the .obj directory (well, I added the output of which file we are working on now).  We start.  Again, nothing in return.  Why?  The answer is the same - nobody needs files with the 'obj' tag. <br><br>  Well, for verification, we will make it necessary for us.  And in general, our application is one continuous obj. <br><br><pre> <code class="javascript hljs">Product { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"micro"</span></span> type: <span class="hljs-string"><span class="hljs-string">"obj"</span></span> Group { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"msp430 sources"</span></span> files: <span class="hljs-string"><span class="hljs-string">'src/*.c'</span></span> fileTags: [<span class="hljs-string"><span class="hljs-string">'c'</span></span>] } Rule { <span class="hljs-attr"><span class="hljs-attr">inputs</span></span>: [<span class="hljs-string"><span class="hljs-string">"c"</span></span>] Artifact { <span class="hljs-attr"><span class="hljs-attr">fileTags</span></span>: [<span class="hljs-string"><span class="hljs-string">'obj'</span></span>] filePath: <span class="hljs-string"><span class="hljs-string">'.obj/'</span></span> + qbs.getHash(input.baseDir) + <span class="hljs-string"><span class="hljs-string">'/'</span></span> + input.fileName + <span class="hljs-string"><span class="hljs-string">'.o'</span></span> } prepare: { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JavaScriptCommand(); cmd.description = <span class="hljs-string"><span class="hljs-string">"Compiling "</span></span>+ input.fileName cmd.silent = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; cmd.highlight = <span class="hljs-string"><span class="hljs-string">"compiler"</span></span>; cmd.sourceCode = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ print(<span class="hljs-string"><span class="hljs-string">"Nothing to do"</span></span>); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cmd; } } }</code> </pre><br>  We try, and good luck!  The coveted ‚ÄúCompiling blink.c‚Äù appeared in the window.  Now let's add that it really compiles and immediately in bydlokoderkski, that is, stupidly scoring everything you need in one pile. <br><br><pre> <code class="javascript hljs">prepare: { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> args = []; args.push(<span class="hljs-string"><span class="hljs-string">"-mmcu=cc430f5137"</span></span>) args.push(<span class="hljs-string"><span class="hljs-string">"-g"</span></span>) args.push(<span class="hljs-string"><span class="hljs-string">"-Os"</span></span>) args.push(<span class="hljs-string"><span class="hljs-string">"-Wall"</span></span>) args.push(<span class="hljs-string"><span class="hljs-string">"-Wunused"</span></span>) args.push(<span class="hljs-string"><span class="hljs-string">'-c'</span></span>); args.push(input.filePath); args.push(<span class="hljs-string"><span class="hljs-string">'-o'</span></span>); args.push(output.filePath); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> compilerPath = <span class="hljs-string"><span class="hljs-string">"/usr/bin/msp430-elf-gcc"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Command(compilerPath, args); cmd.description = <span class="hljs-string"><span class="hljs-string">'compiling '</span></span> + input.fileName; cmd.highlight = <span class="hljs-string"><span class="hljs-string">'compiler'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cmd; }</code> </pre><br>  Recompile everything from scratch and look in the .obj directory <br><br><pre> <code class="bash hljs">$ ls -R1 .: f27fede2220bcd32 ./f27fede2220bcd32: blink.co</code> </pre><br>  Hooray!  File appeared.  Now, for verification, I am doing another file with the tricky name hz.s.  If I'm right, then after recompilation, another object file will appear next to it. <br><br>  Appeared in the output <br><br><pre> <code class="bash hljs">compiling blink.c compiling hz.c</code> </pre><br>  and in the catalog <br><br><pre> <code class="bash hljs">./f27fede2220bcd32: blink.co hz.co</code> </pre><br>  Everything seems ok.  Now you need to link this whole thing.  So again the rule, only now for linking. <br><br><pre> <code class="javascript hljs">Rule { <span class="hljs-attr"><span class="hljs-attr">multiplex</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> inputs: [<span class="hljs-string"><span class="hljs-string">'obj'</span></span>] Artifact { <span class="hljs-attr"><span class="hljs-attr">fileTags</span></span>: [<span class="hljs-string"><span class="hljs-string">'elf'</span></span>] filePath: project.name + <span class="hljs-string"><span class="hljs-string">'.elf'</span></span> } prepare: { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> args = []; args.push(<span class="hljs-string"><span class="hljs-string">"-mmcu=cc430f5137"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> inputs[<span class="hljs-string"><span class="hljs-string">"obj"</span></span>]) args.push(inputs[<span class="hljs-string"><span class="hljs-string">"obj"</span></span>][i].filePath); args.push(<span class="hljs-string"><span class="hljs-string">'-o'</span></span>); args.push(output.filePath); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> compilerPath = <span class="hljs-string"><span class="hljs-string">"/usr/bin/msp430-elf-gcc"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Command(compilerPath, args); cmd.description = <span class="hljs-string"><span class="hljs-string">'linking '</span></span> + project.name; cmd.highlight = <span class="hljs-string"><span class="hljs-string">'linker'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cmd; } }</code> </pre><br>  Where are the differences?  First, the multiplex flag was added, which says that this rule processes all files of this type at once in a crowd.  And secondly, input disappeared in the input parameters.  Appeared inputs, which is an array of files of this type.  Well, I used the product name to take the name for the final firmware. <br><br>  We put the type of application elf and try to build.  After some time, we will find the file simple.elf in the build directory. <br><br><pre> <code class="javascript hljs">$ file simple.elf simple.elf: ELF <span class="hljs-number"><span class="hljs-number">32</span></span>-bit LSB executable, TI msp430, version <span class="hljs-number"><span class="hljs-number">1</span></span>, statically linked, not stripped</code> </pre><br>  What we need.  It can already be poured into the board and enjoy the flashing LED. <br><br>  The initial goal has been achieved: we are doing everything in one development environment: both editing and compiling. <br><br><div class="spoiler">  <b class="spoiler_title">Just in case the final qbs</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> qbs Project { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"simple"</span></span> Product { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"desktop"</span></span> files: <span class="hljs-string"><span class="hljs-string">"main.c"</span></span> Depends {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"cpp"</span></span>} type: <span class="hljs-string"><span class="hljs-string">"application"</span></span> } Product { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"micro"</span></span> type: <span class="hljs-string"><span class="hljs-string">"elf"</span></span> Group { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"msp430 sources"</span></span> files: <span class="hljs-string"><span class="hljs-string">'src/*.c'</span></span> fileTags: [<span class="hljs-string"><span class="hljs-string">'c'</span></span>] } Rule { <span class="hljs-attr"><span class="hljs-attr">inputs</span></span>: [<span class="hljs-string"><span class="hljs-string">"c"</span></span>] Artifact { <span class="hljs-attr"><span class="hljs-attr">fileTags</span></span>: [<span class="hljs-string"><span class="hljs-string">'obj'</span></span>] filePath: <span class="hljs-string"><span class="hljs-string">'.obj/'</span></span> + qbs.getHash(input.baseDir) + <span class="hljs-string"><span class="hljs-string">'/'</span></span> + input.fileName + <span class="hljs-string"><span class="hljs-string">'.o'</span></span> } prepare: { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> args = []; args.push(<span class="hljs-string"><span class="hljs-string">"-mmcu=cc430f5137"</span></span>) args.push(<span class="hljs-string"><span class="hljs-string">"-g"</span></span>) args.push(<span class="hljs-string"><span class="hljs-string">"-Os"</span></span>) args.push(<span class="hljs-string"><span class="hljs-string">"-Wall"</span></span>) args.push(<span class="hljs-string"><span class="hljs-string">"-Wunused"</span></span>) args.push(<span class="hljs-string"><span class="hljs-string">'-c'</span></span>); args.push(input.filePath); args.push(<span class="hljs-string"><span class="hljs-string">'-o'</span></span>); args.push(output.filePath); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> compilerPath = <span class="hljs-string"><span class="hljs-string">"/usr/bin/msp430-elf-gcc"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Command(compilerPath, args); cmd.description = <span class="hljs-string"><span class="hljs-string">'compiling '</span></span> + input.fileName; cmd.highlight = <span class="hljs-string"><span class="hljs-string">'compiler'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cmd; } } Rule { <span class="hljs-attr"><span class="hljs-attr">multiplex</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> inputs: [<span class="hljs-string"><span class="hljs-string">'obj'</span></span>] Artifact { <span class="hljs-attr"><span class="hljs-attr">fileTags</span></span>: [<span class="hljs-string"><span class="hljs-string">'elf'</span></span>] filePath: project.name + <span class="hljs-string"><span class="hljs-string">'.elf'</span></span> } prepare: { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> args = []; args.push(<span class="hljs-string"><span class="hljs-string">"-mmcu=cc430f5137"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> inputs[<span class="hljs-string"><span class="hljs-string">"obj"</span></span>]) args.push(inputs[<span class="hljs-string"><span class="hljs-string">"obj"</span></span>][i].filePath); args.push(<span class="hljs-string"><span class="hljs-string">'-o'</span></span>); args.push(output.filePath); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> compilerPath = <span class="hljs-string"><span class="hljs-string">"/usr/bin/msp430-elf-gcc"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Command(compilerPath, args); cmd.description = <span class="hljs-string"><span class="hljs-string">'linking '</span></span> + project.name; cmd.highlight = <span class="hljs-string"><span class="hljs-string">'linker'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cmd; } } } }</code> </pre><br></div></div><br><br>  PS Moving "hard-coded" variables to a more convenient place I will leave on your conscience, for this is already a javascript tutor. </div><p>Source: <a href="https://habr.com/ru/post/258467/">https://habr.com/ru/post/258467/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../258457/index.html">TLS Logjam - FREAK with DH vulnerability</a></li>
<li><a href="../258459/index.html">Subscribe to 72 well-known PHP developers with one click</a></li>
<li><a href="../258461/index.html">Logjam - new TLS vulnerability</a></li>
<li><a href="../258463/index.html">Numerical characteristics of online games</a></li>
<li><a href="../258465/index.html">Amazon builds a 150 MW wind power station to provide its DC with "green" energy</a></li>
<li><a href="../258469/index.html">Internet of Things (IoT) and plumbing</a></li>
<li><a href="../258471/index.html">Not only software one we are alive from now on. Congratulations on the emergence of a new hub "Circuitry"</a></li>
<li><a href="../258475/index.html">Big Data: current reality</a></li>
<li><a href="../258477/index.html">Accessibility. How we make Yandex accessible to people with disabilities and why we consider it important.</a></li>
<li><a href="../258479/index.html">New features for application developers in Search Console</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>