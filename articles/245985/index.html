<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple leaderboard on Unity3D with facebook</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After participating in Ludum Dare 31, we had a game in which we could compete with friends and we decided to add a leaderboard to it, with authorizati...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple leaderboard on Unity3D with facebook</h1><div class="post__text post__text-html js-mediator-article">  After participating in Ludum Dare 31, we had a game in which we could compete with friends and we decided to add a leaderboard to it, with authorization through Facebook.  What difficulties may arise and how to make similar in your game read under the cut. <br><br><img src="https://habrastorage.org/files/1b2/0f5/a17/1b20f5a178284391958f53062fbd41ce.png" alt="image"><br><a name="habracut"></a><br><h4>  Facebook </h4><br>  The first thing we did was connect the Facebook SDK.  It can be downloaded for free from the <a href="https://www.assetstore.unity3d.com/en/">Asset Store</a> .  It should be noted that the SDK was written for a long time and is not actively updated.  In particular, for compatibility with Unity 4.6, you need to fix something.  Open the <i>FB.cs</i> file and change it there in line 411 <b>UNITY_4_5</b> to <b>UNITY_4_6</b> .  Will work now.  Well, or rewrite this define to the correct one, so that it works on both 4.5 and 4.6 and all subsequent ones. <br><br>  Next you need to create and configure the application on <a href="https://developers.facebook.com/">https://developers.facebook.com</a> .  After that, you get an App ID, which you enter in the settings through the inspector. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/97b/73c/372/97b73c372b194f57bc37ab7f9817534a.png"><br><br>  Next, you need to initialize Facebook to Unity.  To do this, call the function <i>FB.Init ()</i> . The documentation says that it needs to be called once and only once when you first start the game.  And here may be the first difficulty.  The fact is that you need to transfer 2 callbacks to it.  At the end of the initialization and the folding of the game library.  The question arises where to call this function.  If you have the whole game on the same stage and this scene never reboots, then there are no problems.  Just call some GameController in <i>Awake ()</i> . <br><br>  Otherwise, it is better to do either static functions or singleton at once.  We used <a href="http://wiki.unity3d.com/index.php/Singleton">this</a> implementation here.  It turned out quite simple. <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SocialController</span></span> : <span class="hljs-title"><span class="hljs-title">Singleton</span></span>&lt;<span class="hljs-title"><span class="hljs-title">SocialController</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { FB.Init(FacebookInited, OnHideUnity); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FacebookInited</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Debug.Log(<span class="hljs-string"><span class="hljs-string">"FacebookInited"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (FB.IsLoggedIn) { Debug.Log(<span class="hljs-string"><span class="hljs-string">"Already logged in"</span></span>); OnLoggedIn(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnHideUnity</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isGameShown</span></span></span><span class="hljs-function">)</span></span> { Debug.Log(<span class="hljs-string"><span class="hljs-string">"OnHideUnity"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isGameShown) { GameController gameController = FindObjectOfType&lt;GameController&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gameController != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { gameController.SetPause(); } } } ... }</code> </pre> <br>  After that, you can call some function SocialController, and it will automatically be created.  On any stage and will not be destroyed when moving on scenes.  In the <i>OnHideUnity ()</i> function, you can pause the game if the gameplay is active now, and in <i>FacebookInited ()</i> you can check if the user is not already logged in (this happens when the game restarts).  If the user has not logged in yet, then he should be given this opportunity.  To do this, we added a button that is shown in the game if the user is not logged in (this can be checked with <i>FB.IsLoggedIn</i> ). <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoginToFaceBook</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!FB.IsLoggedIn) { FB.Login(<span class="hljs-string"><span class="hljs-string">"user_friends"</span></span>, LoginCallback); } }</code> </pre><br>  The necessary permissions for the game are transferred to the <i>FB.Login ()</i> function.  And here the question arises, what permissions do we need?  And it depends on what we want from Facebook.  Initially, we wanted to use the <a href="https://developers.facebook.com/docs/games/scores%3Flocale%3Dru_RU">Facebook Scores API</a> for the leaderboard.  It was created specifically for leaderboards in games, and is positioned as something very simple.  And at first it seemed so.  We can easily get both our points and our friends' points, and at the same time a sorted list.  However, upon further study, everything was not so simple.  Firstly, you can store only 1 number for each user there.  So only 1 leaderboard and only among its friends. <br><br>  But the worst thing is that in order to update its own Score, the application must get permission to <i>publish_actions</i> .  And this permission implies the ability for the user to write to the tape and much more.  And your application must be reviewed to be able to request this permission from the user.  And the user may not give it to you.  The result is very difficult, and the possibilities are minimal.  So that decision had to be abandoned. <br>  What we need in this case from Facebook: <br><br><ul><li>  User ID </li><li>  Username </li><li>  Friends list - to implement the leaderboard of friends </li></ul><br>  Based on this, we <i>create</i> a list of permissions in the <i>FB.Login ()</i> function.  We now need only <i>user_friends</i> . <br>  Having logged in, you can request the information we need: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnLoggedIn</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Debug.Log(<span class="hljs-string"><span class="hljs-string">"Logged in. ID: "</span></span> + FB.UserId); FB.API(<span class="hljs-string"><span class="hljs-string">"/me?fields=name,friends"</span></span>, Facebook.HttpMethod.GET, FacebookCallback); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FacebookCallback</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">FBResult result</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.Error != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> get_data = result.Text; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dict = Json.Deserialize(get_data) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IDictionary; _userName = dict[<span class="hljs-string"><span class="hljs-string">"name"</span></span>].ToString(); friends = Util.DeserializeJSONFriends(result.Text); GotUser(); GetBestScoresFriends(); }</code> </pre><br>  The function <i>Util.DeserializeJSONFriends () is</i> taken from the official example and is available <a href="">here</a> .  As a result, in the <i>_userName</i> variable we will have the player's name, and in <i>friends the</i> list of his friends. <br><br><h4>  Parse </h4><br>  The next step is to save points and a list of players.  Since we refused the Facebook Score API, we will need a server.  The easiest way to get it is to use <a href="https://www.parse.com/">Parse</a> .  It has a library specifically for Unity and is available <a href="https://www.parse.com/docs/downloads">here</a> .  However, the library was obviously not created specifically for Unity, but simply the .NET version was taken, which would cause some difficulties. <br><br>  Setting up a Parse doesn‚Äôt cause much difficulty, since the official <a href="https://www.parse.com/apps/quickstart">guide is</a> written quite well.  I note only that <i>Parse Initialize Behavior</i> should be added to the new object, and not to the game controller, since with it the object will not be destroyed when the scene is reloaded. <br><br>  Parse provides great opportunities for developers, but what can we need?  The first thing we thought to use is <i>ParseUser</i> - a user in Parse terminology.  You can create a new one or update an existing one.  They are needed in order to unify users of different types and link different profiles of the same user.  Say, if a user first logged in to you via email, and then decided to specify another Facebook account.  Then you can add information about the player's FB account to his profile.  However, having tinker a bit with <i>ParseUser,</i> we realized that we don‚Äôt really need them, so we will not use them further. <br><br>  What we will definitely need is ParseObject.  Each such object is essentially a record in the data table.  In which table is given the name when creating the object.  Accordingly, write <i>new ParseObject ("DataTable")</i> - get a new entry in the DataTable table after calling the <i>Save ()</i> method.  It turns out a simple algorithm for leaderboard.  We are looking for an entry in the table with the current user, if not found, create a new one.  In any case, we will have ParseObject with the current user.  We write the player's name in it, his record and save. <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GotUser</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> query = ParseObject.GetQuery(<span class="hljs-string"><span class="hljs-string">"GameScore"</span></span>) .WhereEqualTo(<span class="hljs-string"><span class="hljs-string">"playerFacebookID"</span></span>, FB.UserId); query.FindAsync().ContinueWith(t =&gt; { IEnumerable&lt;ParseObject&gt; result = t.Result; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!result.Any()) { Debug.Log(<span class="hljs-string"><span class="hljs-string">"UserScoreParseObject not found. Create one!"</span></span>); _userScoreParseObject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ParseObject(<span class="hljs-string"><span class="hljs-string">"GameScore"</span></span>); _userScoreParseObject[<span class="hljs-string"><span class="hljs-string">"score"</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(_userName)) _userScoreParseObject[<span class="hljs-string"><span class="hljs-string">"playerName"</span></span>] = <span class="hljs-string"><span class="hljs-string">"Player"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> _userScoreParseObject[<span class="hljs-string"><span class="hljs-string">"playerName"</span></span>] = _userName; _userScoreParseObject[<span class="hljs-string"><span class="hljs-string">"playerFacebookID"</span></span>] = FB.UserId; _userScoreParseObject.SaveAsync(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Debug.Log(<span class="hljs-string"><span class="hljs-string">"Found score on Parse!"</span></span>); _userScoreParseObject = result.ElementAt(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> score = _userScoreParseObject.Get&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-string"><span class="hljs-string">"score"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (score &gt; GameController.BestScore) { GameController.BestScore = score; GameController.UpdateBestScore = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveScore</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> score</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_userScoreParseObject == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; Debug.Log(<span class="hljs-string"><span class="hljs-string">"Save new score on Parse! "</span></span> + score); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> oldScore = _userScoreParseObject.Get&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-string"><span class="hljs-string">"score"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (score &gt; oldScore) { _userScoreParseObject[<span class="hljs-string"><span class="hljs-string">"score"</span></span>] = score; _userScoreParseObject.SaveAsync(); } }</code> </pre><br>  <i>GameController.BestScore</i> and <i>GameController.UpdateBestScore</i> are static fields of the <i>GameController</i> class.  As I said, Parse was not originally designed for Unity, so the logic of its work is somewhat inconvenient.  Instead of the usual Unity programmers Corutin, the Task system class is used here.  It works asynchronously and the contents of <i>ContinueWith ()</i> will be called in another thread.  If you try to call some <i>MonoBehaviour</i> method, <i>you</i> will get an error.  Static fields are not the most beautiful way to get around this problem, but in our case it helped.  If someone from habr-users will tell in comments a normal way to return to the main flow of the application (maybe like <a href="http://developer.android.com/reference/android/os/Looper.html">Looper</a> from android programming) - I will be grateful. <br><br>  It remains only to get a list of the best players among all and among friends.  To do this, just make a correct request to Parse. <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetBestScoresOverall</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> query = ParseObject.GetQuery(<span class="hljs-string"><span class="hljs-string">"GameScore"</span></span>) .OrderByDescending(<span class="hljs-string"><span class="hljs-string">"score"</span></span>) .Limit(<span class="hljs-number"><span class="hljs-number">5</span></span>); query.FindAsync().ContinueWith(t =&gt; { IEnumerable&lt;ParseObject&gt; result = t.Result; <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> leaderboardString = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (ParseObject parseObject <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> result) { leaderboardString += parseObject.Get&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(<span class="hljs-string"><span class="hljs-string">"playerName"</span></span>); leaderboardString += <span class="hljs-string"><span class="hljs-string">" - "</span></span>; leaderboardString += parseObject.Get&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-string"><span class="hljs-string">"score"</span></span>).ToString(); leaderboardString += <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; } GameController.overallLeaderboardString = leaderboardString; }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetBestScoresFriends</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (friends != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; friends.Any()) { List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; friendIds = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; friend <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> friends) { friendIds.Add((<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>)friend[<span class="hljs-string"><span class="hljs-string">"id"</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (friendIds.Any()) { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> regexp = FB.UserId; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; friendIds.Count; i++) { regexp += <span class="hljs-string"><span class="hljs-string">"|"</span></span>; regexp += friendIds[i]; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> queryFriends = ParseObject.GetQuery(<span class="hljs-string"><span class="hljs-string">"GameScore"</span></span>) .OrderByDescending(<span class="hljs-string"><span class="hljs-string">"score"</span></span>) .WhereMatches(<span class="hljs-string"><span class="hljs-string">"playerFacebookID"</span></span>, regexp, <span class="hljs-string"><span class="hljs-string">""</span></span>) .Limit(<span class="hljs-number"><span class="hljs-number">5</span></span>); queryFriends.FindAsync().ContinueWith(t =&gt; { IEnumerable&lt;ParseObject&gt; result = t.Result; <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> leaderboardString = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (ParseObject parseObject <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> result) { leaderboardString += parseObject.Get&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(<span class="hljs-string"><span class="hljs-string">"playerName"</span></span>); leaderboardString += <span class="hljs-string"><span class="hljs-string">" - "</span></span>; leaderboardString += parseObject.Get&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-string"><span class="hljs-string">"score"</span></span>).ToString(); leaderboardString += <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; } GameController.friendsLeaderboardString = leaderboardString; }); } } }</code> </pre><br>  If everything is more or less clear with the function of obtaining a global leaderboard, then writing a friend selection function may not be trivial.  In this case, we create a regular expression that selects us and our friends from the table.  Not only does the documentation for <i>WhereMatches ()</i> function work slowly, the regular expression can also be quite long (depending on the number of friends playing this game too).  I think this method is not suitable for any large projects, but for a small game it works fine and did not cause problems.  However, I will be grateful if someone describes how in this case it is necessary to act "according to the mind." <br><br><h4>  Bonus </h4><br>  After all this, we got a working leaderboard with authorization through Facebook.  And since we already have authorization, why not make it possible to share the result with friends.  The great thing is that if you do not do this automatically, and offer the user a standard dialogue, you will not need special permissions. <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShareResults</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> socialText = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"I scored {0} in Sentinel. Can you beat it?"</span></span>, GameController.BestScore); FB.Feed( link: <span class="hljs-string"><span class="hljs-string">"https://apps.facebook.com/306586236197672"</span></span>, linkName: <span class="hljs-string"><span class="hljs-string">"Sentinel"</span></span>, linkCaption: <span class="hljs-string"><span class="hljs-string">"Sentinel @ LudumDare#31"</span></span>, linkDescription: socialText, picture: <span class="hljs-string"><span class="hljs-string">"https://www.dropbox.com/s/nmo2z079w90vnf0/icon.png?dl=1"</span></span>, callback: LogCallback ); }</code> </pre><br>  Thank you for reading to the end.  Make good games and push players to compete with leaderboards. <br><br>  Who cares how it ultimately works - the <a href="https://apps.facebook.com/306586236197672">final result</a> .  And <a href="http://ludumdare.com/compo/ludum-dare-31/%3Faction%3Dpreview%26uid%3D46923">here</a> you can play the original version. </div><p>Source: <a href="https://habr.com/ru/post/245985/">https://habr.com/ru/post/245985/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../245969/index.html">Deploy4Me reduces prices and fixes them in rubles</a></li>
<li><a href="../245975/index.html">Exporting data from PostgreSQL to Excel</a></li>
<li><a href="../245977/index.html">Why data centers need operating systems</a></li>
<li><a href="../245979/index.html">Profile the code with Cach√© Monitor</a></li>
<li><a href="../245981/index.html">Entry to the annual program of the Stratoplan School of Managers is open.</a></li>
<li><a href="../245987/index.html">We optimize the page with our own social buttons</a></li>
<li><a href="../245991/index.html">webpack: 7 troubles - one answer</a></li>
<li><a href="../245993/index.html">Media storage system with 10G access</a></li>
<li><a href="../245995/index.html">Brave support service against monstrous tickets</a></li>
<li><a href="../245997/index.html">A selection of interesting CSS recipes "Naked Fridays # 4"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>