<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Kudu - a new data storage engine in the Hadoop ecosystem</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kudu was one of the new products presented by Cloudera at the ‚ÄúStrata + Hadoop World 2015‚Äù conference. This is a new big data storage engine created t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Kudu - a new data storage engine in the Hadoop ecosystem</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/8e4/504/4cc/8e45044cc7444b8fb4e18d9a1e0da3eb.png" alt="image" align="right"><br>  Kudu was one of the new products presented by Cloudera at the ‚ÄúStrata + Hadoop World 2015‚Äù conference.  This is a new big data storage engine created to cover a niche between two existing engines: the HDFS distributed file system and the Hbase column database. <br><br>  Currently existing engines are not without flaws.  HDFS, coping well with large data scanning operations, shows poor results in search operations.  C Hbase everything is exactly the opposite.  In addition, HDFS has an additional limitation, namely, it does not allow to modify the already recorded data.  The new engine, according to the developers, has the advantages of both existing systems: <br>  - quick response search operations <br>  - possibility of modification <br>  - high performance when scanning large amounts of data <br><a name="habracut"></a><br>  Some variants of using Kudu can be time series analysis, analysis of logs and sensory data.  Currently, systems that use Hadoop for such things have a rather complex architecture.  As a rule, data are in several repositories simultaneously (the so-called ‚ÄúLambda architecture‚Äù).  It is necessary to solve a number of tasks on data synchronization between storages (inevitably there is a lag with which, as a rule, they simply accept and live).  It is also necessary to configure data access security policies for each storage separately.  And the rule ‚Äúthe simpler - the more reliable‚Äù has not been canceled.  Using Kudu instead of several simultaneous repositories, you can significantly simplify the architecture of such systems. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f71/32f/d06/f7132fd06df94192877cdcfa2e4b3500.png" alt="image"></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Kudu features:</b> <br>  - High performance when scanning large amounts of data <br>  - Fast response time in search operations <br>  - Column DB, type CP in the CAP theorem, supports several levels of data consistency <br>  - Support ‚Äúupdate‚Äù <br>  - Record level transactions <br>  - Fault tolerance <br>  - Adjustable level of data redundancy (for data safety in case of failure of one of the nodes) <br>  - API for C ++, Java and Python.  Access from Impala, Map / Reduce, Spark is supported. <br>  - Open source.  Apache License <br><br><h4>  SOME INFORMATION ABOUT ARCHITECTURE </h4><br>  Kudu cluster consists of two types of services: master - a service responsible for managing metadata and coordination between nodes;  tablet is a service installed on each node for data storage.  There can be only one active master in a cluster.  For fault tolerance, several more master services can be run in standby mode.  Tablet servers break down data into logical partitions (called ‚Äútablets‚Äù). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/cfa/c58/e7a/cfac58e7ab604edda244e215689e4b92.png" alt="image" width="600"></div><br><br>  From the user's point of view, data in Kudu is stored in tables.  For each table, it is necessary to determine the structure (rather unusual approach for NoSQL databases).  In addition to columns and their types, the user must define a primary key and partitioning policy. <br><br>  Unlike other components of the ecosystem, Hadoop Kudu does not use HDFS for data storage.  The OS file system is used (ext4 or XFS is recommended).  In order to guarantee the safety of data in case of failure of single nodes, Kudu replicates data between servers.  Typically, each tablet is stored on three servers (however, only one of the three servers accepts write operations, the rest accept read-only operations).  Synchronization between tablet-a replicas is implemented using the raft protocol. <br><br><h4>  THE FIRST STEPS </h4><br>  Let's try to work with Kudu from the user's point of view.  Create a table and try to access it using SQL and Java API. <br><br>  To fill the table with data, use this open dataset: <br><br>  <a href="">https://raw.githubusercontent.com/datacharmer/test_db/master/load_employees.dump</a> <br><br>  Currently, Kudu does not have its client console.  To create the table, we will use the Impala console (impala-shell). <br><br>  First of all, let's create the ‚Äúemployees‚Äù table with data storage in HDFS: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> employees ( emp_no <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span>, birth_date <span class="hljs-keyword"><span class="hljs-keyword">STRING</span></span>, first_name <span class="hljs-keyword"><span class="hljs-keyword">STRING</span></span>, last_name <span class="hljs-keyword"><span class="hljs-keyword">STRING</span></span>, gender <span class="hljs-keyword"><span class="hljs-keyword">STRING</span></span>, hire_date <span class="hljs-keyword"><span class="hljs-keyword">STRING</span></span> );</code> </pre> <br><br>  We load dataset on the machine with the impala-shell client and import the data into the table: <br><br><pre> <code class="bash hljs">impala-shell -f load_employees.dump</code> </pre><br><br>  After the command completes execution, run the impala-shell again and run the following query: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> employees_kudu TBLPROPERTIES( <span class="hljs-string"><span class="hljs-string">'storage_handler'</span></span> = <span class="hljs-string"><span class="hljs-string">'com.cloudera.kudu.hive.KuduStorageHandler'</span></span>, <span class="hljs-string"><span class="hljs-string">'kudu.table_name'</span></span> = <span class="hljs-string"><span class="hljs-string">'employees_kudu'</span></span>, <span class="hljs-string"><span class="hljs-string">'kudu.master_addresses'</span></span> = <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span>, <span class="hljs-string"><span class="hljs-string">'kudu.key_columns'</span></span> = <span class="hljs-string"><span class="hljs-string">'emp_no'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> employees;</code> </pre><br><br>  This query will create a table with similar fields, but with Kudu as storage.  Using the ‚ÄúAS SELECT‚Äù in the last line, copy the data from HDFS to Kudu. <br><br>  Without exiting the impala-shell, run several SQL queries to the newly created table: <br><br><pre> <code class="bash hljs">[vm.local:21000] &gt; select gender, count(gender) as amount from employees_kudu group by gender; +--------+--------+ | gender | amount | +--------+--------+ | M | 179973 | | F | 120051 | +--------+--------+</code> </pre><br><br>  It is possible to make requests to both storages (Kudu and HDFS) at the same time: <br><br><pre> <code class="bash hljs">[vm.local:21000] &gt; select employees_kudu.* from employees_kudu inner join employees on employees.emp_no=employees_kudu.emp_no <span class="hljs-built_in"><span class="hljs-built_in">limit</span></span> 2; +--------+------------+------------+-----------+--------+------------+ | emp_no | birth_date | first_name | last_name | gender | hire_date | +--------+------------+------------+-----------+--------+------------+ | 10001 | 1953-09-02 | Georgi | Facello | M | 1986-06-26 | | 10002 | 1964-06-02 | Bezalel | Simmel | F | 1985-11-21 | +--------+------------+------------+-----------+--------+------------+</code> </pre><br><br>  Now we will try to reproduce the results of the first request (counting male and female employees) using the Java API.  Here is the code: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.kududb.ColumnSchema; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.kududb.Schema; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.kududb.Type; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.kududb.client.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.ArrayList; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.List; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KuduApiTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ String tableName = <span class="hljs-string"><span class="hljs-string">"employees_kudu"</span></span>; Integer male = <span class="hljs-number"><span class="hljs-number">0</span></span>; Integer female = <span class="hljs-number"><span class="hljs-number">0</span></span>; KuduClient client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> KuduClient.KuduClientBuilder(<span class="hljs-string"><span class="hljs-string">"localhost"</span></span>).build(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { KuduTable table = client.openTable(tableName); List&lt;String&gt; projectColumns = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(<span class="hljs-number"><span class="hljs-number">1</span></span>); projectColumns.add(<span class="hljs-string"><span class="hljs-string">"gender"</span></span>); KuduScanner scanner = client.newScannerBuilder(table) .setProjectedColumnNames(projectColumns) .build(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (scanner.hasMoreRows()) { RowResultIterator results = scanner.nextRows(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (results.hasNext()) { RowResult result = results.next(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.getString(<span class="hljs-number"><span class="hljs-number">0</span></span>).equals(<span class="hljs-string"><span class="hljs-string">"M"</span></span>)) { male += <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result.getString(<span class="hljs-number"><span class="hljs-number">0</span></span>).equals(<span class="hljs-string"><span class="hljs-string">"F"</span></span>)) { female += <span class="hljs-number"><span class="hljs-number">1</span></span>; } } } System.out.println(<span class="hljs-string"><span class="hljs-string">"Male: "</span></span> + male); System.out.println(<span class="hljs-string"><span class="hljs-string">"Female: "</span></span> + female); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { e.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { client.shutdown(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { e.printStackTrace(); } } } }</code> </pre><br><br>  After compiling and running, we get the following result: <br><br><pre> <code class="bash hljs">java -jar kudu-api-test-1.0.jar [New I/O worker <span class="hljs-comment"><span class="hljs-comment">#1] INFO org.kududb.client.AsyncKuduClient - Discovered tablet Kudu Master for table Kudu Master with partition ["", "") [New I/O worker #1] INFO org.kududb.client.AsyncKuduClient - Discovered tablet f98e05a4bbbe49528f38b5a46ef3a7a4 for table employees_kudu with partition ["", "") Male: 179973 Female: 120051</span></span></code> </pre><br>  As you can see, the result is the same as the one that issued the SQL query. <br><br><h4>  CONCLUSION </h4><br>  For big data systems, in which both analytical operations on the entire volume of stored data and the search operation with fast response time are performed, Kudu seems to be a natural candidate as a data storage engine.  Thanks to its numerous APIs, it is well integrated into the Hadoop ecosystem.  In conclusion, it should be said that at the moment Kudu is under active development and is not ready for use in production. </div><p>Source: <a href="https://habr.com/ru/post/272267/">https://habr.com/ru/post/272267/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../272257/index.html">Access tables from C extensions for Postgres</a></li>
<li><a href="../272259/index.html">Law enforcement authorities dismantled the Dorkbot botnet</a></li>
<li><a href="../272261/index.html">Do you still store 404backup.zip on the server? I'm on 200D</a></li>
<li><a href="../272263/index.html">How to monitor all layers of infrastructure</a></li>
<li><a href="../272265/index.html">History of one optimization: transmission and processing of the results of the battle</a></li>
<li><a href="../272269/index.html">memset - side of darkness</a></li>
<li><a href="../272275/index.html">We invite speakers to the PHDays VI forum: tell us about your cyberwar</a></li>
<li><a href="../272277/index.html">When people make mistakes</a></li>
<li><a href="../272279/index.html">We get ramlog on distributions with systemd</a></li>
<li><a href="../272281/index.html">Creating Isometric Objects for Blender Games</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>