<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The history of the clock synchronizer DCF77</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Once I decided to please myself and bought a citizen watch. Among other things, these watches announced the ability to synchronize watches over the ai...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The history of the clock synchronizer DCF77</h1><div class="post__text post__text-html js-mediator-article">  Once I decided to please myself and bought a citizen watch.  Among other things, these watches announced the ability to synchronize watches over the air.  At the time of the order, I did not really imagine what it was, I thought that it would somehow do everything right.  But it turned out that radio synchronization in Russia practically does not work.  I decided to correct the situation.  The first thing I found was <a href="http://journal.gladkiy.me/radiosinhronizatsiya-chasov-s-vy-shkoj-dcf77-v-germanii/">an article</a> about signal amplification.  It was suggested to wind a large coil with a capacitor, put it on the window facing west and wait.  Also in this article, the dcf77 protocol was mentioned, according to which the clock synchronizes time, and I realized that it is not very complicated.  Although at the moment in electronics I was a complete zero, but it seemed to me that I could cope with the digital part, and somehow deal with the rest.  And I decided to start a project to develop a clock synchronization device using the dcf77 protocol. <br><br>  Here I will describe how I worked on this project, what problems I faced, being a novice in electronics, interesting solutions that I came across while working on a project, and I will try to justify them.  This text may be of interest to programmers who decide to engage in electronics.  Therefore, on the programming side, many things will be omitted. <br><br><img src="https://habrastorage.org/webt/59/cf/dd/59cfdd93a17d4979861527.png" alt="image"><br><a name="habracut"></a><br><h2>  Device concept </h2><br>  The first thing I started is to collect information about the protocol, possible finished devices, and thought out the requirements for the device.  I started thinking about the basic concept. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      1. Synchronization must be performed within the room. <br>  2. The synchronizer itself may have an error of 2s <br>  3. The synchronizer should be for hours. <br>  4. Must have a self-diagnostic system. <br>  5. Must be battery powered.  (I'm not sure I can make a device that can work safely on the network to others) <br>  6. From the battery, the device should work for about a month. <br>  7. Everything should be beautiful.  Housing  Screen.  Buttons.  Etc. <br><br><h2>  The first steps </h2><br>  Then I began to collect material about the protocol and similar devices.  Somewhere on the German resources were some ready-made <a href="http://www.elv.de/dcf-empfangsmodul-dcf-2.html">devices</a> .  Found a description of the protocol on <a href="https://ru.wikipedia.org/wiki/DCF77">Wikipedia</a> . <br>  Since this all started. <br><br>  What is dcf77?  This is a protocol in which the date and time is transmitted by zeros and units of an amplitude modulated signal.  At the beginning of each second, the amplitude is reduced to 15% by 0.1 or 0.2 s.  If the length of the reduced signal is 0.1 s, then 0, if 0.2 s, then 1. What is clearly visible when blinking the LED.  Read more <a href="https://ru.wikipedia.org/wiki/DCF77">here</a> and <a href="http://www.kaligraf.narod.ru/DCF77_protokol.html">here</a> . <br><br>  The first thing I did was implement the dcf77 protocol on a large computer in c ++.  I did this quickly.  It is clear that I tried to make flashing lights on arduino, therefore, it was not difficult to make flashing lights using dcf77 protocol on the LED.  Photos or schemes of the very first versions I, unfortunately, did not survive.  But the scheme was about the same as in the figure.  Only without a generator and on the Arduino Uno. <br><br><img src="https://habrastorage.org/webt/59/cf/d4/59cfd46362f4c862043703.png" alt="image"><br><br>  On the way to such a scheme encountered some difficulties. <br><br>  The first thing I encountered was that classes in the Arduino ide in the ino file cannot be implemented.  I had to rewrite everything to C. I did not immediately realize that it was possible to simply connect it from a separate file.  This problem was resolved quickly. <br><br>  Due to the fact that I started with the fact that the signal was visualized by the LED, the resistor was sequentially set to the LED at around 200 ohms (the picture is no longer the case).  To make it shine brighter.  This all led to the fact that the transistor was constantly ajar and the circuit did not work normally.  At random, I guessed to put two diodes in series. <br><br>  The transistor seems to be closing.  But it somehow looked wildly, even for me, and I realized that I needed to study the theory.  Ase know very important.  At least how the transistor works in key mode.  And here I encountered the following problem: few details and few tools.  For example, to make an antenna, you need a wire and ferrite.  From China to wait for them for a long time.  Fortunately, the hex invertor was in the Arduino starter.  But I did not find quartz at 77500 in Russia at all, and even in China, at ali, he was only in one place, a batch of 50 pieces.  By this time, I already realized that even if I put together a generator, I would not even be able to understand whether it works or not.  And I realized that I needed tools: I needed a frequency meter and / or an oscilloscope.  This gave me a break in the work on the device.  And I began to study electronics.  Listened to a number of YouTube videos on electronics, for example, <a href="https://www.youtube.com/user/Zefar91/videos">this</a> .  Related articles.  Articles on antennas.  Very worried that the antennas for this frequency should be about 700 meters long.  But still decided to try to make a magnetic antenna in the <a href="http://www.elv.de/dcf-empfangsmodul-dcf-2.html">receivers</a> . <br><br>  An antenna needs a circuit from a magnetic coil and a capacitor in resonance.  Resonance must somehow be sought.  This led to the transistor tester project.  He also wanted to implement it in between.  There was an inductance meter there, and I had a few Arduino mini (plz Arduino haters, don't react right away. Then I corrected a little).  But I realized that I was not ready to do it myself, ordered DYI, looked at his scheme and found his <a href="http://www.mikrocontroller.net/articles/AVR_Transistortester">source</a> . <br><br>  Also learned about some useful programs for the phone, it is EveryCircuit and ElectroDroid.  ElectroDroid I at this moment used to calculate the resonance of the antenna.  EveryCircuit allows you to simulate small schemes on the phone.  Decided to document and scheme.  Somewhere on the Internet I saw a beautiful picture on a breadboard.  I realized that this is what Fritzing does, in addition, he can design the circuit and the board.  Began to use fritzing. <br><br>  It was already time that the first parcels from China began to arrive.  Something had to urgently order in the "chip and dip".  This is where the first idea came about how to synchronize time.  It was decided to synchronize on the wifi module esp8266. <br><br>  Stumbled upon a similar <a href="https://www.sundgren.se/1-recreation/2-electronics/dcf77_simulator.htm">project</a> .  I decided to take the main ideas from it.  The radio part is completely borrowed from it.  It was impossible to use it without rework, because: <br><br>  1. It is rated at 12 volts. <br>  2. Based on microcontroller pic. <br><br><h2>  First successes </h2><br>  As the details arrived, I began to improve the device.  After the quartz and the transistor tester arrived, it became possible to finally assemble the first version capable of transmitting time.  Wound the coil on a ferrite rod - this is the antenna.  Looked at her inductance.  Picked up capacitors of 100 pf.  All kind of collected.  Should work.  And does not work.  And, of course, the problem cannot be diagnosed.  The oscilloscope has not arrived yet.  Even the multimer is the easiest.  According to him, little can be understood.  It is good that my father-in-law had instruments and an oscilloscope and a frequency meter.  I went to him with my device.  We looked at the frequency meter like the frequency is.  We looked at the oscilloscope, too, like nothing.  The sine is not clear, but still looks like.  I went home to understand further.  The problem is that how to understand it is not clear.  By the clock you can understand only if they saw the signal or not.  To understand the error is impossible.  But nevertheless, it is clear that the problem is not in the radio part, but in the modulator.  I tried to vary the parameters.  Without going far from the description from Wikipedia.  In the end, I decided to lengthen the pulses on in the frequency modulator.  And at that moment the clock finally hooked the signal.  And, after several attempts, AFTERMAN succeeded in performing the first synchronization.  Then it was decided to do time synchronization on the device itself. <br><br>  In the process of searching for problems, I also <a href="http://robotosha.ru/arduino/digitalwrite-optimizing-arduino.html">discovered</a> that digitalwrite works inefficiently. <br><br>  Redid everything so that it does not use.  Then I met this in other sources.  But for the first time I saw it <a href="http://robotosha.ru/arduino/digitalwrite-optimizing-arduino.html">here</a> .  This was the first retreat from the Arduino. <br><br>  I really like the oled screens, so it was decided to use the ssd1306 screen.  But the library from adafruit is terrible.  She is very slow.  Uses a lot of RAM.  Found an alternative to <a href="https://www.youtube.com/watch%3Fv%3DlkWZuAnHa2Y">u8glib</a> .  I really liked. <br><br>  The first solution I tried was based on the esp8266 module and implied time synchronization via the Internet.  But I did not like the fact that it is rather difficult to connect through this module.  And at that moment it was not very stable.  Therefore, it occurred to me to try time synchronization via GPS.  The module for ardino was like that.  The firmware for synchronization via GPS was easier, but there were problems that I encountered in the future. <br><br>  Finally managed to assemble a full-featured device on the development board. <br><br><img src="https://habrastorage.org/webt/59/cf/d4/59cfd4e2ee1f2046612644.png" alt="image"><br><br><h2>  Denial of Arduinio </h2><br>  I found some links to interesting dyi in the enclosures.  For me, it was important that the device had a neat look.  I saw several <a href="https://www.youtube.com/watch%3Fv%3DsNIMCdVOHOM%26index%3D1%26list%3DPLnOALHW_SnwoVHhkoyYadEQ9IuQ6nEj6M">videos</a> where atmega328 is stitched in Arduino.  The firmware by this time was already difficult.  To transfer it to something else did not want to.  Arduino IDE with such a scenario seemed to me a good tool.  Stitched Arduino using usbasp, which also ordered in China. <br><br>  I did not want to get involved in self-etched boards.  Therefore, I decided that I would unsolder the device on a special breadboard for soldering.  Therefore, the preferred chip in the dip package.  In the same cases, when there are no good alternatives in the dip package, I used adapters. <br><br><h2>  Transmission Improvement </h2><br>  Success in transmission allowed us to finally start experimenting with the transmitter and receiver.  I put the transmitter on and wore watches across the room in search of a better signal.  I found out that we will take it best when the antenna is directed with its axis on the clock.  And the clock is at a distance of no more than a meter - one and a half.  In addition, finally came the oscilloscope.  He also allowed to get an understanding of the processes taking place.  Conducted experiments with the coil, which is attached to the probes.  One could see that the amplitude of the signal changes, confirming the observations with the clock.  The maximum amplitude on the coil if it is near and along the antenna axis.  One and a half meters is not enough.  It was decided to increase the transmitter power.  The question is how?  In the circuit, which I took as a basis, 1 kŒ© resistors were installed.  I decided to reduce this resistance.  In addition, measured the resistance of the antenna.  It was about 300 ohms.  Looking ahead I will say that here I did not think about the reactive resistance.  But first things first.  Reduced the resistance of the transmitting antenna due to the use of a 0.3 section wire. <br><br><img src="https://habrastorage.org/webt/59/cf/d5/59cfd53746681758585006.png" alt="image"><br><br>  In order to work for sure, I decided to install the step-up module for the transmitting part.  And be able to turn it off to save energy.  In this configuration, everything was noticeably better.  There were many successful synchronizations within 2-3 meters on the transmitter axis.  Outside the axis, successful syncs were a meter away. <br><br><img src="https://habrastorage.org/webt/59/cf/d5/59cfd5657dafe392183878.png" alt="image"><br><br>  To increase the voltage used lt1302.  In addition, I found an <a href="http://radiokot.ru/circuit/power/charger/33/">interesting charge</a> on ltc4054-4.2, which fit well with the concept of the device. <br><br>  At this stage, I understood why datasheets are needed.  They are very helpful when using ICs, especially when it comes to specialized devices.  Connection diagrams lt1302 and ltc4054-4.2 I already took from datashita.  And I got into the habit of putting in git, in addition to the schemes, the source codes also the datasheets of all the devices used. <br><br><h2>  First attempt to assemble a device </h2><br>  So, I got close to the soldering project.  At this point, I had a device map.  And the project on fritzing, which repeated the breadboard. <br><br><img src="https://habrastorage.org/webt/59/cf/d5/59cfd5b5a9ce1685901812.png" alt="image"><br><br>  Separate hemorrhoids - create your own components for fritzing.  As it turned out, this is the nasty part at all in any CAD system. <br><br><img src="https://habrastorage.org/webt/59/cf/d5/59cfd5f4a98cf572871653.png" alt="image"><br><br>  Another task that lasts a long time - dilution of the board.  This may take several days.  But in principle, quite feasible.  The main point: we place the elements, then we connect them.  If something is inconveniently connected, try to rearrange the components a little. <br>  Noticed a fritzing flaw.  If you rearrange something on the breadboard or on the diagram, it affects the breadboard.  And there can be extra connections.  Therefore, with small changes in one place they need to be done in another.  In general, try it, but it tires a lot.  Although for simple fritzing schemes are not bad. <br><br>  That's what happened. <br><br><img src="https://habrastorage.org/webt/59/cf/d6/59cfd62380bda377011122.png" alt="image"><br><br>  Used a 15x9 breadboard.  Sawed it in half.  By the way, one more necessary device for radio handicrafts is Dremel. <br><br>  Payal a couple of days.  It seems to work.  But there was a lot of mounted installation.  It looked ugly. <br>  They write that the boards need to be washed after soldering.  Decided to try to wash.  Used for this flux-off.  But somehow it did not work out.  Laundered on Saturday at work, when almost no one was.  But he felt dizzy, although he used a little and carefully.  In short, laundered and threw it.  At the same time everything was washed off badly.  While decided to score. <br><br>  That's what happened. <br><br><img src="https://habrastorage.org/webt/59/cf/d6/59cfd6568bd54520269372.png" alt="image"><br><br>  Here is another GPS module.  I wanted the device to run on battery for a long time.  The GPS module consumes quite a lot, I decided to find a GPS device with the enable line so that it can be turned off.  Enable didn't work for me.  But the GPS on mtk3339 turned out that it consumes 2 times less than the neo-6m.  30ma against 60ma.  And the mtk3339 GPS module can be immersed in sleep. <br><br><h2>  Rethinking the project </h2><br><br>  I assembled the device, hoping that after soldering, everything will work much better.  But it did not happen.  Old problems have surfaced - unstable synchronization.  There was also a problem when turning on the device without a battery.  It did not work.  It was possible to find out that the problem arose because the step-up charged a large capacitor at start-up, and at the start the device consumed a large current, more than the current for which the power supply was calculated, which went into protection.  Everything was fine with the battery, so for now I decided not to pay attention to the problem.  Just picked up the capacitor, so that there was no interference and the shutdown happened less.  I did not want to install the resistor, so as not to increase the already large consumption of the device.  The device worked from strength - day.  What did not satisfy the requirements.  The problem with unstable synchronization was greatly reduced after I found an error in the protocol description on the Russian <a href="https://ru.wikipedia.org/wiki/DCF77">Wikipedia</a> <a href="http://www.kaligraf.narod.ru/DCF77_protokol.html">here</a> .  In the German version, everything was fine.  I corrected the error on Wikipedia.  It turned out that the amplitude should not fall by 15%, but to 15%.  I noticed this by conducting experiments, but then I found and confirm, for example, in the German wiki.  So, with synchronization everything was decided, but the radius was still small.  On the display with the edge was a strip of debris, with which I could not overcome. <br><br>  I did not like the switch that turns off the power.  He was very cumbersome.  In addition, in the transistor tester, I spied the idea that you can turn on the power by pressing a button that can be used for other purposes.  Transistor tester does not consume energy in an idle mode. <br><br>  The shape of the signal left much to be desired.  Spectrum analyzer showed a lot of unnecessary harmonics. <br><br>  I began to think how to improve the device.  Googled another version of the <a href="http://pda.teron.ru/index.php%3Fs%3D74c6aae329db3030d1b6cb47ad47051b%26showtopic%3D909610%26st%3D20">synchronizer</a> . <br><br>  It is interesting in him that behind the logic element there is a filter on the differential amplifier lvm824, and behind it the amplifier on the transistor.  Disassembled the device.  Fortunately, it consisted of two parts.  I used the logical part to control, and began to collect the transmitting part on the breadboard and experiment. <br><br>  As it is, I did not want to take the scheme.  Because the voltage drop across the bipolar transistor is 0.6 volts, and the supply voltage is already about 4v.  He began to think what to do. <br><br>  Considered options with sound amplifiers.  But, firstly, they are designed for frequencies up to 40khz, and secondly, they have a voltage drop of 2 volts.  Did not find anything suitable. <br>  I have already met the characteristic rail-to-rail, which means that the amplifier works in the whole power range, so I began to look for similar ones.  I realized that I need to understand how filters are made and calculated.  Found resources where you can count <a href="http://sim.okawa-denshi.jp/en/OPseikiLowkeisan.htm">filters</a> . <br><br>  With the filters had to suffer.  I began to experiment with them, using step-up to enhance them.  Step-up was adjustable, allowing you to set the balance between power and battery saving.  But in no way was it possible to choose the filter parameters so that it would act for a wide range of input voltages. <br><br>  The Q1 transistor in the <a href="http://pda.teron.ru/index.php%3Fapp%3Dcore%26module%3Dattach%26section%3Dattach%26attach_rel_module%3Dpost%26attach_id%3D516440">circuit</a> uses as an amplifier.  In order not to lose 0.6 volts, I first decided to do the same on a field-effect transistor, but reading further about amplifiers, I found an interesting amplifier circuit - a pavement, which better amplifies the signal in antiphase.  I tried such a circuit on lvm822 with a transistor at the output.  The advantage of this scheme is that with the same power the signal amplitude doubles.  This means that, ideally, power is quadrupled.  I also noticed that there is an ad8532 microcircuit, which is sufficient for the output power for my purposes and thus does not need to be done to set the output transistor.  Such a connection greatly reduced interference and allowed to abandon step up. <br><br>  I also stumbled upon the second transmitter improvement by chance.  I saw that the reactance of my oscillating circuit was 1.5 kOm.  This limits transmitter power. <br><br>  When I experimented with the level of the transfer to the coil, I thought that you can make a step-up transformer after the amplifier.  Then from the amplifier output to the input of the antenna will be supplied more voltage.  This was done by winding a few turns on the transmitting Antenna.  There are about 200 turns on the antenna itself, and about 10 turns on another winding.  The exact amount picked up by the oscilloscope and tester.  By this time I already had a tester with a frequency meter. <br><br>  Such changes gave a big increase in transmit power.  Theoretically, the increase in power compared with the old scheme will be approximately 400 times.  In addition, the signal became almost pure sinusoid.  But I had to add blocking capacitors to the antenna, because of the constant component, which crawled into the signal. <br><br>  The range has increased greatly.  You could even synchronize the clock in another room, not paying attention to the location of the antenna. <br><br>  But the device did not work at work.  I think when a lot of computers are turned on - a lot of noise. <br><br>  Another problem is that the transmitter sometimes did not start due to the fact that the generator did not start.  This was solved by the fact that I grounded the quartz body and due to a more stable power supply. <br><br>  Another problem was that I went too far in pursuit of amplification in the coupling coil.  I understood what the problem was, increased the number of turns a little, losing in gain, but the work of the transmitting part became more stable.  100% is synchronized now for almost a year, every night. <br><br><h2>  Final option </h2><br>  In addition to the improvements of the transmitting part, I wanted to make the switch off as in a transistor tester, but there it is made on a bipolar transistor.  In order to reduce losses, I decided to make it on a field with low resistance.  Here I <a href="http://everycircuit.com/circuit/5072084672184320/p-mosfet-based-electronic-switch">modeled it</a> .  Also tested on a breadboard.  Everything was fine: the voltage drop was about 0.05v, which suited me. <br><br>  I wanted to monitor energy efficiency.  Therefore, I decided to build an ina139 ammeter.  On the breadboard tried.  But I had to look for resistance of 0.05Om. <br><br>  The transmitter made it switchable all through the same AO3401 fieldbus (Rds = 60mOm).  In total, the voltage drop is 0.1V at the transmitter. <br><br>  Began to redo the scheme in fritzing.  And then the fritzing began to show the worst side.  The scheme began to fall apart.  The connections already made remained, but the contacts were considered disconnected.  Fix the problem failed.  The more you fix, the more the scheme fell apart.  At work by this time we organized a club of like-minded people.  I became interested in acquaintances who use what for designing circuits.  I was advised by kiCad and ToporLite.  I redid the circuit on kiCad.  Made new components that were not.  It all took a lot of time.  Used autotrace from topor.  Basically liked it.  A little later, I ran into deeptrace.  But he did not dare to switch to it.  Although I suspect that deeptrace is still better. <br><br>  Immediately decided that I would not sharpen the dip.  I will do everything on smd, but in order not to bother with etching, I will order the payment on Ali or in Zelenograd. <br><br>  I had already prepared the hull for a long time.  Therefore, the fee was diluted under the case. <br><br>  Diluted fee for several days.  And decided to still order in Zelenograd.  Done quickly.  It turned out beautifully.  He began to unsolder and found several errors.  I mixed up rx and tx gps.  I confused + and 0 current sensor.  Wrong with the dimensions of a couple of millimeters on each side.  Holes for mounting the display did less than necessary.  Somewhere on the components there was no mask.  Incorrectly spread the linear stabilizer for power from 9V - well, it took into account its cooling.  It was necessary to make a large polygon under it.  And incorrectly spread the connector 9c.  If the connector layout could be fixed, then overheating was difficult to get rid of.  Therefore, I removed the 9v connector. <br><br>  And there were a number of minor problems.  The most unpleasant of the first two.  I suffered with them for a very long time. <br><br>  Another problem with the layout is that I did not carefully read the datasheet.  Did not pay attention to how to part the GPS module.  It turned out necessary to make a hole.  All similar corrections made after Dremel.  Some corrections had to be made by surface mounting.  The worst was with the current sensor. <br><br>  Generally soldering was difficult.  The hardest thing was to unsolder the GPS module.  Even without errors, adjacent tracks are very simply closed. <br><br>  Missed with screen plume.  Not very neat connector turned out.  And bulky. <br>  But the device has assembled.  Again tried to wash the flux.  This time, washed with isopropyl alcohol.  So washed away much better and without consequences. <br>  That's what happened. <br><br><img src="https://habrastorage.org/webt/59/cf/db/59cfdb34d656c349223941.png" alt="image"><br><br><img src="https://habrastorage.org/webt/59/cf/db/59cfdb60ac5d5669340140.png" alt="image"><br><br>  Markers in the image above indicate errors found. <br><br><img src="https://habrastorage.org/webt/59/cf/db/59cfdb8c82b10503493806.png" alt="image"><br><br><h2>  The final touches.  Software update </h2><br>  The final touch was to reduce consumption by controlling power, controlling consumption and using the solar battery to recharge the device. <br><br>  Modified the fonts so that the firmware got into memory.  Fixed a problem with a strip on the screen.  It turned out that the Chinese sold me a screen on sh1106 instead of ssd1306 as it was written in the order.  Well, God bless them. <br><br>  For load control, use round robin database for current value.  By the way, this experience was interesting even from the point of view of a programmer.  There is little memory, and I wanted to store data for the year. <br><br>  Another subtle point is the definition when gps synchronized time to turn it off.  For this, we had to refine the gpstiny library. <br><br>  Now with all the modifications the device works for about a month without charging. <br><br><img src="https://habrastorage.org/webt/59/d0/a1/59d0a1f264518470065913.jpeg" alt="image"><br><br>  on the screen you can see that the consumption is 12 ma, but this is because of the maximum brightness of the screen. <br><br><h2>  Retrospective </h2><br>  I started the project in January 2015.  I got my first results in April.  Soldered on the breadboard in July.  After that there was a break until March 2016.  The iron version on the ordered board was assembled in June 2016. In July 31, 2016 was the last committe on the improvement of software.  So I spent a year and a half on this device.  Was it possible to approach the project differently?  Maybe yes.  But knowledge really lacked the beginning of the project.  Now it is clear that for such work you need tools and some details.  And it is clear what.  Need knowledge.  They appeared. <br><br>  Of course, I still confuse the emitter and collector in the circuit, and I cannot tell from memory how the transistor works in each of the connection modes.  But I know where to look quickly.  A lot of money was spent on the project.  It would probably be cheaper to buy a clock with GPS synchronization.  Could costs be reduced?  Yes you can, but not fundamentally.  Can I sell a device?  Yes you can.  But the labor costs for its production are too large.  It is more profitable just to work where I work now.  I saw the sale of the device easier for 150 euros, and I need to collect 2-3 days.  And I think it's hard to sell.  So, I don‚Äôt see any commercial success with the device.  Moreover, now began to appear clock with synchronization by gps.  They will soon become cheaper.  Did I enjoy the process?  Yes, I received.  It was very interesting to learn new things.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As a programmer, it was useful for me to increase my horizons. </font><font style="vertical-align: inherit;">Do I post it source?</font></font> May be.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> If it is necessary for someone. </font></font><br><br><h2>  Possible improvements </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I made a new revision of the fee, but did not order it. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is necessary to improve the power supply system of the controller. </font><font style="vertical-align: inherit;">It is necessary to turn off the gps power completely, since in the standby mode, gps still eats 1 ma. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is necessary to make the clock more accurate. </font><font style="vertical-align: inherit;">There is an idea how to do it, but only on stm32. </font><font style="vertical-align: inherit;">There you can use the function of adjusting the progress of the signal from the GPS. </font><font style="vertical-align: inherit;">Also stm32 will allow to refuse an extra chip. </font><font style="vertical-align: inherit;">Although ds3231 is more accurate, but for stm32 it is possible to make an adjustment. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Try using an e-ink screen to save energy. </font><font style="vertical-align: inherit;">Now basically the screen eats up the whole battery. </font><font style="vertical-align: inherit;">It consumes about 4 ma from 6 ma in standby mode, when only the current time is shown. </font><font style="vertical-align: inherit;">The transmitter consumes 60 ma when turned on. </font><font style="vertical-align: inherit;">It is 20 minutes a day. </font><font style="vertical-align: inherit;">GPS consumes 30 ma, but it synchronizes time in a minute.</font></font><br><br><div class="spoiler">  <b class="spoiler_title">Links</b> <div class="spoiler_text"> [1] <a href="http://journal.gladkiy.me/radiosinhronizatsiya-chasov-s-vy-shkoj-dcf77-v-germanii/">journal.gladkiy.me/radiosinhronizatsiya-chasov-s-vy-shkoj-dcf77-v-germanii</a> (     ) <br> [2] <a href="http://www.elv.de/dcf-empfangsmodul-dcf-2.html">www.elv.de/dcf-empfangsmodul-dcf-2.html</a> <br> [3] <a href="https://ru.wikipedia.org/wiki/DCF77">ru.wikipedia.org/wiki/DCF77</a> <br> [4] <a href="https://www.youtube.com/user/Zefar91/videos">www.youtube.com/user/Zefar91/videos</a> <br> [5] <a href="http://ikit.edu.sfu-kras.ru/CP_Electronics/pages/mm/index.html">ikit.edu.sfu-kras.ru/CP_Electronics/pages/mm/index.html</a> <br> <a href="http://digteh.ru/Sxemoteh/ShVklTrz/OK/">digteh.ru/Sxemoteh/ShVklTrz/OK</a> <br> [6] <a href="http://www.mikrocontroller.net/articles/AVR_Transistortester">www.mikrocontroller.net/articles/AVR_Transistortester</a> <br> [7] <a href="https://www.sundgren.se/1-recreation/2-electronics/dcf77_simulator.htm">www.sundgren.se/1-recreation/2-electronics/dcf77_simulator.htm</a> <br> [8] <a href="http://robotosha.ru/arduino/digitalwrite-optimizing-arduino.html">robotosha.ru/arduino/digitalwrite-optimizing-arduino.html</a> <br> [9] <a href="https://www.youtube.com/watch%3Fv%3DsNIMCdVOHOM%26index%3D1%26list%3DPLnOALHW_SnwoVHhkoyYadEQ9IuQ6nEj6M">www.youtube.com/watch?v=sNIMCdVOHOM&amp;index=1&amp;list=PLnOALHW_SnwoVHhkoyYadEQ9IuQ6nEj6M</a> <br> [10] <a href="http://radiokot.ru/circuit/power/charger/33/">radiokot.ru/circuit/power/charger/33</a> <br> [11] <a href="https://www.youtube.com/watch%3Fv%3DlkWZuAnHa2Y">www.youtube.com/watch?v=lkWZuAnHa2Y</a> <br> [12] <a href="http://pda.teron.ru/index.php%3Fs%3D74c6aae329db3030d1b6cb47ad47051b%26showtopic%3D909610%26st%3D20">pda.teron.ru/index.php?s=74c6aae329db3030d1b6cb47ad47051b&amp;showtopic=909610&amp;st=20</a> <br> [13] <a href="http://sim.okawa-denshi.jp/en/OPseikiLowkeisan.htm">sim.okawa-denshi.jp/en/OPseikiLowkeisan.htm</a> <br> [14] <a href="http://pda.teron.ru/index.php%3Fapp%3Dcore%26module%3Dattach%26section%3Dattach%26attach_rel_module%3Dpost%26attach_id%3D516440">pda.teron.ru/index.php?app=core&amp;module=attach&amp;section=attach&amp;attach_rel_module=post&amp;attach_id=516440</a> <br> [15] <a href="http://www.kaligraf.narod.ru/DCF77_protokol.html">www.kaligraf.narod.ru/DCF77_protokol.html</a> <br> [16] <a href="http://everycircuit.com/circuit/5072084672184320/p-mosfet-based-electronic-switch">everycircuit.com/circuit/5072084672184320/p-mosfet-based-electronic-switch</a> </div></div></div><p>Source: <a href="https://habr.com/ru/post/339052/">https://habr.com/ru/post/339052/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../339038/index.html">How to debug small programs</a></li>
<li><a href="../339044/index.html">How to bring the first project to the end. Part 2. Myths, mistakes and failures</a></li>
<li><a href="../339046/index.html">Work with resources, or how I pushed through @Cleanup</a></li>
<li><a href="../339048/index.html">Swift Generics: Styles for UIView and more. # 2</a></li>
<li><a href="../339050/index.html">Habr advise: how to win the NTI olympiad for schoolchildren in the Big Data profile</a></li>
<li><a href="../339054/index.html">How the MobX library helps to manage the state of web applications. Lecture in Yandex</a></li>
<li><a href="../339060/index.html">About interval indices</a></li>
<li><a href="../339064/index.html">MUK becomes an Oracle distributor</a></li>
<li><a href="../339066/index.html">Information security in process control systems: attack vector interface converters</a></li>
<li><a href="../339070/index.html">Winning the nomination ‚ÄúThe best startup with the prospect of entering the American market‚Äù, Spb Startup Day 2017 and thoughts about pitches</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>