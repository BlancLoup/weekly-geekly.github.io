<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Mercurial Utility</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I think almost everyone who reads knows what Mercurial is - a distributed version control system for source code and other (mostly text) files. Many u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Mercurial Utility</h1><div class="post__text post__text-html js-mediator-article">  I think almost everyone who reads knows what Mercurial is - a distributed version control system for source code and other (mostly text) files.  Many use it, and know the basic commands, such as deleting / adding files, creating a commit and sending local changes to other repositories.  However, Mercurial has many not-so-known functions and commands that are often quite useful and convenient.  Some of them can be used immediately after installation by default, some need to be enabled in the settings, and for others you may need to download an additional extension. <br><br>  A short list of what will be discussed in the article: <br><br><ul><li>  hg serve (hgweb) - embedded web server </li><li>  pager, progress and color extensions </li><li>  hg [c] record - select individual changes for commit </li><li>  revsets and filesets - search for commits and files with queries of any complexity </li><li>  hg evolve - Changeset Evolution or "changeable history" </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/a29/682/37c/a2968237c8e6dc72e218aec5eab6ce06.png" alt="logo"><br><a name="habracut"></a><br><br><h4>  hg serve (hgweb) </h4><br><br>  Mercurial comes standard with a web server that allows you to quickly view the repository with a convenient interface in any browser - all you have to do is to <code>hg serve</code> while in the repository folder and go to <code>localhost:8000</code> (standard port is 8000).  So you can view almost all the information that is available through the usual command line interface.  In this case, from another computer on the network, you can use <code>hg clone</code> with the address of the running hgweb for cloning. <br><br>  Of course, it would be strange if the web server could only be used for this - and this is not so.  Hgweb can be configured to process several repositories at once, for example from one folder, and also put nginx or another server in front of it (there are enough communication options - usual http through the port, or for example wcgi).  Configuration subtleties are discussed in particular in the official Mercurial wiki.  An important feature that is sometimes lacking in hgweb ‚Äî user authorization and read / write permissions ‚Äî can also be implemented by installing and configuring an additional frontend server.  For example, I use the usual http authorization in nginx for this, which prohibits any unauthorized access to private repositories, as well as push to public. <br><br>  As for the appearance, the set comes with several themes to choose from, the default is ‚Äúpaper‚Äù. <br><br>  Examples: <a href="http://selenic.com/hg">selenic.com/hg</a> - official repository, <a href="http://hg.python.org/">hg.python.org</a> - Python repositories, <a href="https://hg.aplavin.ru/">hg.aplavin.ru</a> - my (mostly) repositories. <br><br><h4>  Pager, progress, color extensions </h4><br><br>  These extensions are included in the Mercurial installation, and to use it, simply enable them in the settings.  To do this, add an <code>~/.hgrc</code> section to the <code>~/.hgrc</code> file: <br><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">extensions</span></span>] pager = progress = color =</code> </pre><br><br>  (yes, after the signs of equality there is nothing).  These extensions make working with the CLI interface somewhat more convenient: the output of many commands becomes colored, during long operations a progress bar is displayed, and long sheets of commands like <code>hg log</code> can be scrolled - they open in a standard pager (usually <code>less</code> ).  Unfortunately, the help pages ( <code>hg help</code> ) open as before, and for their easy viewing you need to manually add <code>| less</code>  <code>| less</code> .  These extensions are not enabled by default, as the author of Mercurial says, because of occasional unexpected problems with them, in particular on Windows. <br><br><h4>  hg [c] record </h4><br><br>  Often, after long editing the source, it is more convenient to break the changes into several commits, rather than making one big one.  In the standard Mercurial package, there is a <code>record</code> extension for this, which you simply enable in the settings for use.  After that, in order to select the changes, you will need to execute <code>hg record</code> and select the necessary parts in the text interface. <br><br>  However, this extension is not very convenient and is only suitable for episodic edits.  If you use this function more often, it is better to download and connect another extension, not from the standard kit: <a href="https://bitbucket.org/edgimar/crecord/wiki/Home">crecord</a> .  It provides a pseudographic interface that is quite convenient for use (an example from its author: <img src="https://habrastorage.org/getpro/habr/post_images/980/865/2c2/9808652c25055f47a348e5a53305440f.png" alt="image">  ).  Of course, there are also completely graphical utilities for this (I, for example, liked <a href="http://qct.sourceforge.net/">qct</a> written in Qt), but for simple edits right ‚Äúon the spot‚Äù in the console, the crecord is quite convenient. <br><br><h4>  revsets </h4><br><br>  Mercurial uses a query language that can be used for arbitrarily complex search criteria for commits, and it is supported in all commands that work with commits (and soon will be in hgweb).  For example, an almost ‚Äúclassic‚Äù example - there is a certain commit in which the bug is fixed, and you need to find releases to which this bugfix got.  Assuming that tags are used to set releases (all projects that have seen and are doing so), such a request can be formulated as <code>'tag() and descendants(x)'</code> or <code>'tag() and x::'</code> (where <code>x</code> is the identifier commit).  That is, if you execute <code>hg log 'tag() and x::'</code> , we will see all the required releases.  Detailed information about the syntax and all available functions - <code>hg help revsets</code> or <a href="http://selenic.com/hg/help/revsets">on the official site</a> . <br><br><h4>  filesets </h4><br><br>  Filesets is also a query language, similar to revsets, but for specifying files (for the corresponding commands that work with files).  It is used almost in the same way, only at the beginning you need to add <code>set:</code> so that there is no confusion with the usual file names.  As for the supported functions, they are also in the standard help: <code>hg help filesets</code> . <br><br><h4>  Changeset evolution </h4><br><br>  The <a href="https://bitbucket.org/marmoute/mutable-history/overview">evolve</a> extension is an experimental one that is currently being developed (mostly) by a member of the Mercurial team.  It is experimental because of the still not completely resolved issues with UI and performance in some cases, and not because of lack of stability (generally speaking, part of the code related to its functions is in Mercurial itself, but does not work by default) .  In particular, this extension is used in the most official Mercurial repository. <br><br>  Changeset Evolution when connecting not only adds new commands, but also changes the behavior of the standard (and from other extensions) - those that somehow edit the history: <code>commit --amend, rebase, histedit</code> and some others.  When using <code>evolve</code> no commits are completely removed from the repository (with the exception of the <code>strip</code> command, which is intended just for a complete removal, which can still be useful).  Any history editing simply marks more unnecessary commits as deleted (more precisely, obsolete - <code>obsolete</code> ), and new commits - as replacing them.  Thus, you can always find any version of the change that once existed. <br><br>  Also, from additional received ‚Äúbuns‚Äù - the ability to edit changes already sent to the public repository.  Moreover, those who have a local copy of it when downloading new changes will also receive information about remote (obsolete) commits and their local repositories will also change (provided, of course, that they also have this extension included).  Without <code>evolve</code> this can not be reached. <br><br><h4>  Conclusion </h4><br><br>  In general, there are other ‚Äúadvanced‚Äù features in Mercurial, but in this article I tried to describe those that can be useful to many users, and which people do not use often because of ignorance.  I would also like to add that Mercurial has a very strict backward compatibility policy - all changes made do not affect the existing functionality, but add a new one.  A very old version on the server can work with a new client, and vice versa (of course, functions that are not supported in the old version will not work).  Such serious backward compatibility applies to all commands and functions visible to the user, that is, the internal API can change (but without good reason this also does not do). <br><br>  I myself have been using Mercurial at a basic level for several years now, and this year I have been participating in Google Summer of Code with <a href="http://www.google-melange.com/gsoc/project/google/gsoc2013/aplavin/37001">the</a> <code>hgweb</code> improvement <code>hgweb</code> .  Along the way, communicating with the developers, I learned and began using the functions described in this article in particular. </div><p>Source: <a href="https://habr.com/ru/post/188418/">https://habr.com/ru/post/188418/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../188394/index.html">Nexus 7. What's new?</a></li>
<li><a href="../188400/index.html">Beautiful tracebacks in Python</a></li>
<li><a href="../188402/index.html">Cloud News Digest (July 22 - 28)</a></li>
<li><a href="../188404/index.html">What should we build an online store? Or how I started selling online</a></li>
<li><a href="../188406/index.html">CoffeeScript and AngularJS</a></li>
<li><a href="../188420/index.html">Intel Power Monitoring Tool - on guard energy efficiency</a></li>
<li><a href="../188422/index.html">Quip: word processor from Google Maps and FriendFeed</a></li>
<li><a href="../188424/index.html">3G Modem and MikroTik</a></li>
<li><a href="../188430/index.html">Seven skills of a professional programmer</a></li>
<li><a href="../188432/index.html">First PyPy3 beta released with Python 3 support</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>