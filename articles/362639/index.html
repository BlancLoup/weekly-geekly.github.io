<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We program our home on .NET</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I wrote here an article about the project of a smart home control system , in the development of which I am participating. This is a .NET Wi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We program our home on .NET</h1><div class="post__text post__text-html js-mediator-article">  Recently, I wrote here <a href="http://geektimes.ru/post/240170/">an article</a> about the <a href="https://github.com/dima117/thinking-home">project of a smart home control system</a> , in the development of which I am participating.  This is a .NET Windows Service that can control the home through scripts and through a web interface.  In October, just was the <a href="http://geektimes.ru/post/240170/">release of version 2.0</a> . <br><br>  All the functionality of the system is in the plugins.  If you are missing something, you can <a href="http://thinking-home.ru/system/plugins">easily write</a> your own plugin that will interact with the necessary hardware, Internet services or do something else.  To make it easier to write your own plugins, I created a small project that can be used as an example. <br><br>  This demo plugin collects information from nooLite temperature / humidity sensors and displays the received information in the web interface.  The result looks like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>temperature chart for the last two days</i> <br><img src="https://habrastorage.org/files/01c/5b5/ba9/01c5b5ba93ce4f56965d0b5a32e850ec.png"><br><br>  <i>the current temperature in the rooms (more precisely, the latest values ‚Äã‚Äãobtained from the sensors)</i> <br><img src="https://habrastorage.org/files/eab/449/9e7/eab4499e7430401baa4678880c9187af.png"><br><br>  I bring to your attention a slightly hardcore article on how this plugin was written.  There, the steps explain the process of developing your own plug-in for a smart home and provide links to GitHub, by which you can download ready-made code and run it.  In this article, you will learn how to create a plug-in and run it in debug mode, how to set up automatic creation of tables in the system database and save data there.  And finally, you will learn how to obtain information about temperature and humidity from sensors (if only this is interesting, then scroll through the article to the very end). <br><br><a name="habracut"></a><br><h4>  Setting up the environment and creating a project blank </h4><br>  So, the thing we are writing is a plugin for an application - a windows service.  Accordingly, you first need to deploy a service to your computer to which our plugin will connect.  It is very easy to do: you need to download the <a href="">installer</a> , run it and click ‚ÄúNext‚Äù several times.  During installation, no parameters are requested.  The service is installed in the folder <i>C: \ Program Files (x86) \ ThinkingHome \ service</i> . <br><br>  Fine!  Now in Visual Studio we will create an empty C # <i>Class Library</i> project, while creating, select <i>.NET Framework 4.5</i> .  In principle, not only VS, but also any other IDE, for example, the free <a href="http://xamarin.com/download">Xamarin Studio</a> (and, of course, you can use the free <a href="http://www.visualstudio.com/en-us/products/visual-studio-express-vs.aspx">Visual Studio Express</a> ). <br><br><img src="https://habrastorage.org/files/9bf/3a0/e66/9bf3a0e6645845bd8b6a399033c07338.png"><br><br>  Now you need to add to the project a link to the <a href="https://www.nuget.org/packages/ThinkingHome.Core.Plugins/">ThinkingHome.Core.Plugins</a> library, which contains the base classes for plugins.  The easiest way to do this is to connect it through the NuGet package manager.  Just type in the package manager console: <br><br><pre><code class="bash hljs">Install-Package ThinkingHome.Core.Plugins</code> </pre> <br>  Then everything is simple: create a class <i>MicroclimatePlugin</i> , inherit it from the base class <i>ThinkingHome.Core.Plugins.PluginBase</i> and mark it with the attribute <i>[ThinkingHome.Core.Plugins.PluginAttribute].</i>  The PluginBase class implements the basic functionality of the plugin (more on this later), and the attribute is needed to connect the plugin to the service through <a href="http://msdn.microsoft.com/ru-ru/library/dd460648(v%3Dvs.110).aspx">MEF</a> .  We try to compile the project and get an error.  Yeah, you forgot to add a reference to the System.ComponentModel.Composition library in the project (this library is included in the .NET Framework and it contains the MEF implementation).  Add it, the project began to compile without errors. <br><br>  Now we redefine the base class methods to add our own logic to the plugin. <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Plugin</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MicroclimatePlugin</span></span> : <span class="hljs-title"><span class="hljs-title">PluginBase</span></span> { <span class="hljs-comment"><span class="hljs-comment">//   ,     public override void InitPlugin() { Logger.Debug("init"); base.InitPlugin(); } //   ,     public override void StartPlugin() { Logger.Debug("start"); base.StartPlugin(); } //     public override void StopPlugin() { Logger.Debug("stop"); base.StopPlugin(); } }</span></span></code> </pre><br>  As you can see, we just added a record of messages to the log. <br><br>  Now we will try to connect our plugin to the service.  In the folder where the service was installed (C: \ Program Files (x86) \ ThinkingHome \ service), there is a Plugins folder from which the plugins are loaded at the start of the service.  Files of each of the plug-ins should be in a separate folder.  We create a folder for our plug-in there (for example, let's call it ‚ÄúThinkingHome.Plugins.Microclimate‚Äù) and in the project properties set the Output Path parameter to ‚ÄúC: \ Program Files (x86) \ ThinkingHome service \ Plugins \ ThinkingHome.Plugins.Microclimate ". <br><br>  <b>Attention!</b>  <b>For all references to third-party libraries, you must set the parameter Copy Local = False!</b> <br><br>  Now we compile the project and see that the DLL with our plugin has appeared in the folder indicated by us. <br><br><img src="https://habrastorage.org/files/d28/c3b/8c3/d28c3b8c3ab44f92a9fe3feb07b0a850.PNG"><br><br>  Since  in the development and debugging process, we will often start and stop the service, it makes sense to disable its automatic launch and run it as a console application.  In the folder with the service there is a file ThinkingHome.TestConsole.exe.  Run it (with administrator privileges!) And see: <br><br><img src="https://habrastorage.org/files/6ef/5a6/35a/6ef5a635a10047f3826d1ef395e1b1f7.png"><br><br>  Close the console, go to the folder with the logs (C: \ Program Files (x86) \ ThinkingHome \ service \ Logs) and look at the file <br>  <i>&lt;% date%&gt; - ThinkingHome.Plugins.Microclimate.MicroclimatePlugin.log</i> . <br>  We see some lines like this: <br><br><pre> <code class="bash hljs">2014-10-12 16:40:07.0981, Info, init 2014-10-12 16:40:07.1132, Info, start 2014-10-12 16:40:52.1292, Info, stop</code> </pre><br>  Thus, we installed the service, created a plug-in and checked that it successfully connects to the service. <br><br>  The code we wrote lies on GitHub at: <a href="https://github.com/dima117/thinking-home-plugins-microclimate/tree/6799b7e2f0fb7fc30d0d3d2a4b5cec45cb97fa10">github.com/dima117/thinking-home-plugins-microclimate/tree/6799b7e2f0fb7fc30d0d3d2a4b5cec45cb97fa10</a> .  You can download and run it. <br><br><h4>  Tables in the database for storing data </h4><br>  Any plugin connected to the system can store its data in the system database (MS SQL Server CE 4).  Tools for working with the database provides the base class <i>PluginBase</i> . <br><br><h5>  DB structure </h5><br>  So, we plan to receive information from nooLite temperature / humidity sensors.  Each sensor will be tied to a nooLite RX2164 USB adapter channel (receiver) and will periodically send it current temperature / humidity data. <br>  Thus, we should have a list of sensors in the system, for each of which an adapter channel should be specified, to which data is sent and, at a minimum, the name of the sensor for displaying it in the web interface. <br>  We also need another entity to store information from the sensor at a given point in time.  Accordingly, it will have the fields: "temperature value", "humidity value", "current time", "sensor ID". <br><br>  As a result, we get approximately the following database structure: <br><img src="https://habrastorage.org/files/905/fea/22a/905fea22a79c4bbb9f18f313fd1b7e92.PNG"><br><br>  In addition to the listed fields, another ‚ÄúShowHumidity‚Äù field has been added to the sensor model, the value of which determines whether the ‚Äúhumidity‚Äù parameter should be displayed in the interface.  The fact is that the manufacturer of the nooLite system offers two models of sensors: <a href="http://thinking-home.ru/product/50.aspx">PT111</a> , measuring temperature / humidity, and <a href="http://thinking-home.ru/product/51.aspx">PT112</a> , measuring only temperature, without humidity.  The format of the transmitted data is the same, but the PT112 in the "humidity" field always transmits the value "0".  So that an empty value is not displayed in the interface, and this setting has been added. <br><br><h5>  Creating tables </h5><br>  To automatically create the necessary database structure, the project uses the <a href="http://habrahabr.ru/post/138019/">ECM7.Migrator</a> tool ( <a href="http://habrahabr.ru/post/70884/">more</a> ).  Plugins can contain migrations ‚Äî small C # classes that describe portions of database changes.  Each migration has a database version number and the migrator can update the database to the latest version from any previous state.  Just add migrations to the project with the plugin and they will be automatically executed when the service starts. <br><br>  First you need to add to the project a link to the library <i>ECM7.Migrator.Framework</i> .  Again, the easiest way to do this is through NuGet.  Type in the package manager console: <br><pre> <code class="bash hljs">Install-Package ECM7Migrator</code> </pre><br>  <b>Do not forget to set for all assemblies added to the project, the parameter Copy Local = False!</b> <br><br>  Next, you need to mark the entire assembly with the <i>MigrationAssembly</i> attribute (for example, in the AssemblyInfo.cs file): <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">assembly: MigrationAssembly(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ThinkingHome.Plugins.Microclimate"</span></span></span><span class="hljs-meta">)</span></span>]</code> </pre><br>  This attribute is needed to ensure that the database versioning for our plugin is performed independently of other plugins.  As a parameter, you must pass some string - a unique key that will not be repeated in other plugins.  It is recommended to use for this the full name of the plugin. <br><br>  After that we add the migrations describing changes in the database.  As already mentioned, each migration is a separate class.  It must be inherited from the special base class <i>Migration</i> + it must be marked with the special attribute <i>MigrationAttribute</i> , which is given a unique version number of the database version as a parameter. <br><br>  <i>Migration for sensor table:</i> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ECM7.Migrator.Framework; . . . <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">ThinkingHome.Plugins.Microclimate.Migrations</span></span> { [Migration(<span class="hljs-number"><span class="hljs-number">1</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Migration01_TemperatureSensor</span></span> : <span class="hljs-title"><span class="hljs-title">Migration</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Apply</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Database.AddTable(<span class="hljs-string"><span class="hljs-string">"Microclimate_TemperatureSensor"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Column(<span class="hljs-string"><span class="hljs-string">"Id"</span></span>, DbType.Guid, ColumnProperty.PrimaryKey, <span class="hljs-string"><span class="hljs-string">"newid()"</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Column(<span class="hljs-string"><span class="hljs-string">"Channel"</span></span>, DbType.Int32, ColumnProperty.NotNull), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Column(<span class="hljs-string"><span class="hljs-string">"DisplayName"</span></span>, DbType.String.WithSize(<span class="hljs-number"><span class="hljs-number">255</span></span>), ColumnProperty.NotNull), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Column(<span class="hljs-string"><span class="hljs-string">"ShowHumidity"</span></span>, DbType.Boolean, ColumnProperty.NotNull, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Revert</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Database.RemoveTable(<span class="hljs-string"><span class="hljs-string">"Microclimate_TemperatureSensor"</span></span>); } } }</code> </pre><br>  It's simple.  As you can see, the Apply and Revert methods of the base class are overridden here.  <i>Apply</i> - update the database to the version specified in the [Migration] attribute parameter (in our case, version == 1).  <i>Revert</i> - rollback changes.  The Database property of the base class contains a special object that provides an API for performing various operations on the database.  The API has the means to perform all the basic operations with the database + as a last resort. There is the ExecuteNonQuery method with which you can execute an arbitrary SQL query. <br><br>  <i>Migration for data table:</i> <br><pre> <code class="cs hljs">. . . <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ECM7.Migrator.Framework; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ForeignKeyConstraint = ECM7.Migrator.Framework.ForeignKeyConstraint; . . . <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">ThinkingHome.Plugins.Microclimate.Migrations</span></span> { [Migration(<span class="hljs-number"><span class="hljs-number">2</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Migration02_TemperatureData</span></span> : <span class="hljs-title"><span class="hljs-title">Migration</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Apply</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Database.AddTable(<span class="hljs-string"><span class="hljs-string">"Microclimate_TemperatureData"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Column(<span class="hljs-string"><span class="hljs-string">"Id"</span></span>, DbType.Guid, ColumnProperty.PrimaryKey, <span class="hljs-string"><span class="hljs-string">"newid()"</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Column(<span class="hljs-string"><span class="hljs-string">"Temperature"</span></span>, DbType.Int32, ColumnProperty.NotNull, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Column(<span class="hljs-string"><span class="hljs-string">"Humidity"</span></span>, DbType.Int32, ColumnProperty.NotNull, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Column(<span class="hljs-string"><span class="hljs-string">"SensorId"</span></span>, DbType.Guid, ColumnProperty.NotNull) ); Database.AddForeignKey(<span class="hljs-string"><span class="hljs-string">"FK_Microclimate_TemperatureData_SensorId"</span></span>, <span class="hljs-string"><span class="hljs-string">"Microclimate_TemperatureData"</span></span>, <span class="hljs-string"><span class="hljs-string">"SensorId"</span></span>, <span class="hljs-string"><span class="hljs-string">"Microclimate_TemperatureSensor"</span></span>, <span class="hljs-string"><span class="hljs-string">"Id"</span></span>, ForeignKeyConstraint.Cascade); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Revert</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Database.RemoveTable(<span class="hljs-string"><span class="hljs-string">"Microclimate_TemperatureData"</span></span>); } } }</code> </pre><br>  This migration, in addition to the table, also adds a foreign key.  When rolling back, deleting it is not necessary - the migrator is smart and deleting the table will delete its foreign keys. <br><br>  Now check it all out.  Compile the build and run our test console. <br>  In the folder with the logs, we look at the contents of the file <i>&lt;% date%&gt; - ecm7-migrator-logger.log</i> and see the lines: <br><br><pre> <code class="sql hljs">2014-10-12 16:40:07.0981, Info, <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Version</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [SchemaInfo] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Key</span></span>] = <span class="hljs-string"><span class="hljs-string">'ThinkingHome.Plugins.Microclimate'</span></span> <span class="hljs-number"><span class="hljs-number">2014</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span>:<span class="hljs-number"><span class="hljs-number">07.1132</span></span>, Info, Latest <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> applied : <span class="hljs-number"><span class="hljs-number">0.</span></span> Target <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2014</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span>:<span class="hljs-number"><span class="hljs-number">07.1292</span></span>, Info, Applying <span class="hljs-number"><span class="hljs-number">1</span></span>: Migration01 temperature sensor <span class="hljs-number"><span class="hljs-number">2014</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span>:<span class="hljs-number"><span class="hljs-number">07.1612</span></span>, Info, <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> [Microclimate_TemperatureSensor] ([<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] UNIQUEIDENTIFIER <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> newid(),[Channel] <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>,[DisplayName] <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>,[ShowHumidity] <span class="hljs-built_in"><span class="hljs-built_in">BIT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">2014</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span>:<span class="hljs-number"><span class="hljs-number">07.1612</span></span>, Info, <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> [SchemaInfo] ([<span class="hljs-keyword"><span class="hljs-keyword">Version</span></span>],[<span class="hljs-keyword"><span class="hljs-keyword">Key</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-string"><span class="hljs-string">'1'</span></span>,<span class="hljs-string"><span class="hljs-string">'ThinkingHome.Plugins.Microclimate'</span></span>) <span class="hljs-number"><span class="hljs-number">2014</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span>:<span class="hljs-number"><span class="hljs-number">07.1822</span></span>, Info, Applying <span class="hljs-number"><span class="hljs-number">2</span></span>: Migration02 temperature <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-number"><span class="hljs-number">2014</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span>:<span class="hljs-number"><span class="hljs-number">07.1822</span></span>, Info, <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> [Microclimate_TemperatureData] ([<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] UNIQUEIDENTIFIER <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> newid(),[Temperature] <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>,[Humidity] <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>,[SensorId] UNIQUEIDENTIFIER <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) <span class="hljs-number"><span class="hljs-number">2014</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span>:<span class="hljs-number"><span class="hljs-number">07.1822</span></span>, Info, <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> [Microclimate_TemperatureData] <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> [FK_Microclimate_TemperatureData_SensorId] <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> ([SensorId]) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> [Microclimate_TemperatureSensor] ([<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ACTION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASCADE</span></span> <span class="hljs-number"><span class="hljs-number">2014</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span>:<span class="hljs-number"><span class="hljs-number">07.1912</span></span>, Info, <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> [SchemaInfo] ([<span class="hljs-keyword"><span class="hljs-keyword">Version</span></span>],[<span class="hljs-keyword"><span class="hljs-keyword">Key</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-string"><span class="hljs-string">'2'</span></span>,<span class="hljs-string"><span class="hljs-string">'ThinkingHome.Plugins.Microclimate'</span></span>)</code> </pre><br>  Oops, it seems we forgot to make a field for the current date in the second table.  It is better not to change the already completed migration, since  in the general case, someone may have already completed it and the state of the database will not correspond to the migrations to the DLL (that is, it will be incorrect).  Create another migration that adds the required field. <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Migration(3)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Migration03_TemperatureDataCurrentDate</span></span> : <span class="hljs-title"><span class="hljs-title">Migration</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Apply</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Database.AddColumn(<span class="hljs-string"><span class="hljs-string">"Microclimate_TemperatureData"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Column(<span class="hljs-string"><span class="hljs-string">"CurrentDate"</span></span>, DbType.DateTime, ColumnProperty.NotNull, <span class="hljs-string"><span class="hljs-string">"getdate()"</span></span>)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Revert</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Database.RemoveColumn(<span class="hljs-string"><span class="hljs-string">"Microclimate_TemperatureData"</span></span>, <span class="hljs-string"><span class="hljs-string">"CurrentDate"</span></span>); } }</code> </pre><br>  After starting the test console, we see the following entries in the log: <br><pre> <code class="sql hljs">2014-10-12 16:53:03.6288, Info, Latest version applied : 2. Target version : 3 2014-10-12 16:53:03.6498, Info, Applying 3: Migration03 temperature data current date 2014-10-12 16:53:03.6668, Info, <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> [Microclimate_TemperatureData] <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> [CurrentDate] DATETIME <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">getdate</span></span>() <span class="hljs-number"><span class="hljs-number">2014</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span><span class="hljs-number"><span class="hljs-number">-12</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-number"><span class="hljs-number">53</span></span>:<span class="hljs-number"><span class="hljs-number">03.6768</span></span>, Info, <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> [SchemaInfo] ([<span class="hljs-keyword"><span class="hljs-keyword">Version</span></span>],[<span class="hljs-keyword"><span class="hljs-keyword">Key</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-string"><span class="hljs-string">'3'</span></span>,<span class="hljs-string"><span class="hljs-string">'ThinkingHome.Plugins.Microclimate'</span></span>)</code> </pre><br>  As you can see, the migrator himself has determined which migrations have already been completed and only those that are missing are launched (that is, in our case, only the third migration). <br><br>  The code we just wrote lies on GitHub at: <br>  <a href="https://github.com/dima117/thinking-home-plugins-microclimate/tree/cbb180bf627ef6d7c07ca4eef43e7bbebf510bd7">github.com/dima117/thinking-home-plugins-microclimate/tree/cbb180bf627ef6d7c07ca4eef43e7bbebf510bd7</a> <br><br><h5>  Data model </h5><br>  Now let's describe the classes of our data model.  There are no features, except that all class members must be virtual (this is due to the peculiarities of the implementation of the NHibernate ORM, which is used to access data). <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//  public class TemperatureSensor { public virtual Guid Id { get; set; } public virtual int Channel { get; set; } public virtual string DisplayName { get; set; } public virtual bool ShowHumidity { get; set; } } //  public class TemperatureData { public virtual Guid Id { get; set; } public virtual DateTime CurrentDate { get; set; } public virtual TemperatureSensor Sensor { get; set; } public virtual int Temperature { get; set; } public virtual int Humidity { get; set; } }</span></span></code> </pre><br><br>  Also note that the names of the model properties coincide with the names of the table fields, but for the SensorId field, which is a reference to the sensor table, the Sensor property is described (without the ‚ÄúId‚Äù end), the type of which corresponds to the model type for the associated table. <br><br><h5>  Mapping model on the database table </h5><br>  Now we define how our model corresponds to the database tables.  To do this, override in your plugin the <i>InitDbModel</i> method from the base class. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitDbModel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ModelMapper mapper</span></span></span><span class="hljs-function">)</span></span> { mapper.Class&lt;TemperatureSensor&gt;(cfg =&gt; cfg.Table(<span class="hljs-string"><span class="hljs-string">"Microclimate_TemperatureSensor"</span></span>)); mapper.Class&lt;TemperatureData&gt;(cfg =&gt; cfg.Table(<span class="hljs-string"><span class="hljs-string">"Microclimate_TemperatureData"</span></span>)); }</code> </pre><br><br>  As an input parameter, an instance of the <i>NHibernate.Mapping.ByCode.ModelMapper</i> class is passed here.  By default, the mapper assumes that the names of the fields of the tables correspond to the names of the properties of the classes, and the names of the fields-links to other tables correspond to the properties of the same name, but without the ending Id.  Thus, in our case, it suffices to specify only the correspondence of classes to the tables in the database ‚Äî the rest of NHibernate will configure itself.  Naturally, ModelMapper provides the means by which you can configure any other, more complex mapping model on the database table. <br><br><h4>  Adding sensors and getting information from the database </h4><br>  To add a record to the database about the sensor or to retrieve its data from the database, you need to create a special object - an NHibernate session (this is something similar to DbConnection in ADO.NET).  The base class of the plugin has a Context property that contains the application context ‚Äî an object that implements the <i>IServiceContext</i> interface.  You can create an NHibernate session using its <i>OpenSession</i> method. <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//   var sensorId = Guid.NewGuid(); using (var session = Context.OpenSession()) { //   -  var sensor = new TemperatureSensor { Id = sensorId, DisplayName = " ", Channel = 1, ShowHumidity = true }; //     session.Save(sensor); //     session.Flush(); } //      using (var session = Context.OpenSession()) { var data = session.Query&lt;TemperatureData&gt;() .Where(d =&gt; d.Sensor.Id == sensorId) .ToList(); }</span></span></code> </pre><br><br>  But how do we test the performance of our code? <br><br><h4>  Calling plugin methods over HTTP </h4><br>  One of the easiest ways is to allow accessing the required plug-in methods using the HTTP protocol and call them from the address bar of the browser.  In addition, we will need this in the future, when we do the UI. <br><br>  To access the plug-in methods via HTTP, add a link to the <i>ThinkingHome.Plugins.Listener</i> plugin to the project, slightly change the method signature (parameter set and return type) and mark the methods with a special attribute. <br><br>  Now in order: <br><br>  1. As usual, the easiest way to connect another plugin to your project is via NuGet.  To connect the <i>ThinkingHome.Plugins.Listener</i> plugin, type the package manager in the console: <br><pre> <code class="bash hljs">Install-Package ThinkingHome.Plugins.Listener</code> </pre><br>  Do not forget to specify the option <i>Copy Local = False</i> for the added link. <br><br>  2. Methods that need to be called via HTTP must accept one parameter of type <i>ThinkingHome.Plugins.Listener.Api.HttpRequestParams</i> and return a value of type <i>object</i> .  Through HttpRequestParams, you can get the values ‚Äã‚Äãof the request parameters, and the return value will be serialized into JSON and transferred to the client. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ThinkingHome.Plugins.Listener.Api; . . . <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MicroclimatePlugin</span></span> : <span class="hljs-title"><span class="hljs-title">PluginBase</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddSensor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HttpRequestParams request</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> displayName = request.GetRequiredString(<span class="hljs-string"><span class="hljs-string">"displayName"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> channel = request.GetRequiredInt32(<span class="hljs-string"><span class="hljs-string">"channel"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> showHumidity = request.GetRequiredBool(<span class="hljs-string"><span class="hljs-string">"showHumidity"</span></span>); . . . } . . . }</code> </pre><br><br>  3. It is necessary to mark the method with a special attribute [ThinkingHome.Plugins.Listener.Attributes.HttpCommand], which as a parameter must be passed a URL (relative to the site root), which will be used to access this method. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ThinkingHome.Plugins.Listener.Attributes; . . . [HttpCommand(<span class="hljs-string"><span class="hljs-string">"/api/microclimate/sensors/add"</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddSensor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HttpRequestParams request</span></span></span><span class="hljs-function">)</span></span> { . . . }</code> </pre><br><br>  Now we can add a sensor by typing the address in the browser (note that all requests must be sent to port <b>41831</b> ): <br>  https: // localhost: 41831 <b>/ api / microclimate / sensors / add</b> ? channel = 1 &amp; displayName = Test + sensor &amp; showHumidity = false <br><br>  For the full code for adding a sensor and retrieving data from a database, see GitHub (the AddSensor and GetSensorData methods): <br>  <a href="">github.com/dima117/thinking-home-plugins-microclimate/blob/7f16f81090d70a6b60d0a6d664fe74abfa1922fa/ThinkingHome.Plugins.Microclimate/MicroclimatePlugin.cs</a> <br><br><h4>  Getting information from sensors </h4><br>  And finally, the most interesting (but not the most difficult) is obtaining information from sensors and storing it in the database. <br><br>  As I already wrote, the out-of-box system can work with nooLite wireless temperature / humidity sensors.  In order to receive information from sensors on the computer, you will also need a nooLite <a href="http://www.noo.com.by/adapter-dlya-kompyutera-rx2164.html">RX2164</a> USB adapter (receiver). <br><br>  There is a <a href="https://www.nuget.org/packages/ThinkingHome.Plugins.NooLite/">special plugin</a> for working with nooLite devices.  We connect it through NuGet.  As usual, do not forget to put <i>Copy Local = False</i> ; <br><br><pre> <code class="bash hljs">Install-Package ThinkingHome.Plugins.NooLite</code> </pre><br><br>  The plug-in that we just added starts to ‚Äúlisten‚Äù to the commands that arrive at the nooLite receiver (the adapter must be connected to the computer when the service starts).  When a command is received, the plug-in generates a special type of event inside the system, in the processor of which data received from the sensor are transmitted.  We can subscribe to this event and save the data in the database (in the tables that we recently created). <br><br>  To add a handler for the event "received information from the sensor," you need to describe in our plugin method and mark it with a special attribute [ThinkingHome.Plugins.NooLite.OnMicroclimateDataReceived].  The method must accept 3 parameters as input. <br><ul><li>  <b>int</b> channel - channel of the adapter for which the command came </li><li>  <b>decimal</b> temperature - the current temperature value (the sensor transmits the temperature value every hour or when the temperature changes by more than 0.5 ¬∞ C) </li><li>  <b>int</b> humidity - the current value of humidity, in% (if the sensor does not support the measurement of humidity, the value 0 is transmitted) </li></ul><br>  Inside the handler, we open the NHibernate session, get a list of sensors, go through the list and for all sensors whose channel number matches the channel parameter, add an entry to the table with data. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ThinkingHome.Plugins.NooLite; . . . [Plugin] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MicroclimatePlugin</span></span> : <span class="hljs-title"><span class="hljs-title">PluginBase</span></span> { . . . [OnMicroclimateDataReceived] <span class="hljs-comment"><span class="hljs-comment">//        public void MicroclimateDataReceived(int channel, decimal temperature, int humidity) { var now = DateTime.Now; //   NHibernate using (var session = Context.OpenSession()) { //       var sensors = session .Query&lt;TemperatureSensor&gt;() .Where(s =&gt; s.Channel == channel) .ToList(); //     foreach (var sensor in sensors) { //      var data = new TemperatureData { Id = Guid.NewGuid(), CurrentDate = now, Temperature = Convert.ToInt32(temperature), Humidity = humidity, Sensor = sensor }; //    session.Save(data); } //     session.Flush(); } } }</span></span></code> </pre><br><br>  Now we start the service, breathe on the sensor (or put it on the battery) and after a couple of minutes we see that new records have appeared in the database. <br><br>  You can download the code we have just written from GitHub (the whole project), compile and run it. <br>  <a href="https://github.com/dima117/thinking-home-plugins-microclimate/commit/7f16f81090d70a6b60d0a6d664fe74abfa1922fa">github.com/dima117/thinking-home-plugins-microclimate/commit/7f16f81090d70a6b60d0a6d664fe74abfa1922fa</a> <br><br><h4>  Conclusion </h4><br>  So, in this article we learned: <br><ul><li>  How to create a preset plug-in, connect the plug-in to the smart home service and how to run it in debug mode </li><li>  How to make the plugin itself create the necessary database structure </li><li>  How to work with DB </li><li>  How to subscribe to events of other plug-ins (using the example of obtaining temperature from nooLite sensors) </li></ul><br>  Please write in the comments if you were interested.  If you like this article, there will be a second part, in which you will learn: <br><ul><li>  How to add a separate section for the plug-in to the web interface of the smart home system </li><li>  How to draw beautiful graphs of temperature and humidity </li><li>  How to give the user the opportunity to bring the temperature / humidity values ‚Äã‚Äãto the start screen of the system‚Äôs web interface </li></ul><br><br>  The entire project (in the current state, the code is written for the second part of the article) is located at: <a href="https://github.com/dima117/thinking-home-plugins-microclimate">github.com/dima117/thinking-home-plugins-microclimate</a> <br>  Source code of the smart home system: <a href="https://github.com/dima117/thinking-home">github.com/dima117/thinking-home</a> <br>  Documentation <a href="http://thinking-home.ru/system">thinking-home.ru/system</a> <br>  Add to our VKontakte group to keep up with the latest news: <a href="https://vk.com/thinking_home">vk.com/thinking_home</a> </div><p>Source: <a href="https://habr.com/ru/post/362639/">https://habr.com/ru/post/362639/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../362627/index.html">Discussion of the film "Interstellar"</a></li>
<li><a href="../362629/index.html">Lechal insoles smart insoles overview</a></li>
<li><a href="../362633/index.html">Your virtual girl of the future</a></li>
<li><a href="../362635/index.html">Scientists are looking for time travelers</a></li>
<li><a href="../362637/index.html">Biological literacy: execute cannot be pardoned</a></li>
<li><a href="../362641/index.html">FBI arrests Silk Road 2.0 owner</a></li>
<li><a href="../362643/index.html">The first offenders. Fritz and Genius</a></li>
<li><a href="../362645/index.html">Psychological transformation to which only astronauts are subject</a></li>
<li><a href="../362647/index.html">Serious problems with reading Samsung 840 Evo data and how to fix it</a></li>
<li><a href="../362649/index.html">In the regiment arrived. War Thunder is now available on Linux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>