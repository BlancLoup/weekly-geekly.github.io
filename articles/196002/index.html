<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Derby.js Warrior's Way</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue our ‚Äúno day without Derby‚Äù rubric. Today we will begin (finally!) To write code and consider the basic moments of Derby.js. And also, you ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Derby.js Warrior's Way</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage3/00d/6da/272/00d6da2729d051eef0d03026204cb609.jpg" align="left"><br><br>  We continue our ‚Äúno day without Derby‚Äù rubric.  Today we will begin (finally!) To write code and consider the basic moments of Derby.js.  And also, you will find out why Derby programmers are usually alone, while their happier colleagues using other frameworks are working on similar projects in a fun friendly team and with longer deadlines. <br><br><br clear="all"><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      How to set up the environment, read <a href="http://habrahabr.ru/post/195864">here</a> . <br><br>  Let's start with creating and launching an application layout: <br><br><pre><code class="bash hljs">derby bare habr <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> habr npm start</code> </pre> <br><br>  We type in the browser <a href="http://localhost:3000/">http: // localhost: 3000 /</a> . <br><br>  We see the inscription Bare. <br>  What just happened?  Your request went to the server where all connect middleware was processed in turn from /lib/server/index.js, up to: <br><br><pre> <code class="javascript hljs">.use(app.router())</code> </pre><br><br>  What is the client app app router and located here /lib/app/index.js in the form: <br><br><pre> <code class="javascript hljs">app.get(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">page</span></span></span><span class="hljs-function">) </span></span>{ page.render(); });</code> </pre><br><br>  Here for the path '/' we generate html from the template /views/app/index.html.  Why index.html?  This is the default.  You can write like this, nothing will change: <br><br><pre> <code class="javascript hljs">app.get(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">page</span></span></span><span class="hljs-function">) </span></span>{ page.render(<span class="hljs-string"><span class="hljs-string">'index'</span></span>); });</code> </pre><br><br>  In index.html we have only the Body section.  There may also be Head, Header, Footer, Scripts, Title, etc.  Derby template engine, when it will collect html for us, will find the Body section and put its value in the appropriate place, and instead of other sections (since they are not specified), put empty or default values.  As a result, back to the client will return: <br><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$_css"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--$_page--&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> Bare <span class="hljs-comment"><span class="hljs-comment">&lt;!--$$_page--&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">defer</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">async</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/derby/lib-app-index.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  What we see?  Title is empty.  There are no styles.  Head is also almost empty.  As expected.  But something lies in the body. <br>  Why styles will be inline, not a separate file?  Nate somewhere wrote that when he worked in Google Search, they conducted a bunch of tests about this and came to the conclusion that in the vast majority of scripts, inline styles load faster than a separate file, so all styles from the / styles folder are loaded inline.  Nothing prevents you from adding links to your styles in the Head section. <br>  The /derby/lib-app-index.js script is just our client application that will connect as soon as the html generation is loaded and is already on the client. <br>  <code></code> - these are official tags of the derby template engine.  They are used to ensure that when the data is dynamically linked between the html and the model, when the model is changed, not to completely refresh the whole page, but to update only part of the html.  In this case, when the router is triggered, only the Body section will be overloaded, because we were too lazy to others, we didn‚Äôt specify and they are the same for all pages. <br><br>  You can change the text in the template (as well as styles) and see instant changes in the browser.  This is not related to any kind of dynamic data synchronization.  This is for the convenience of the developer.  If you change html and css, then it is automatically compiled, loaded onto the client and substituted for the old one.  If you change js, then the application restarts completely. <br><br>  Let's separate the view from the data.  There are two ways to do this in Derby.  Let's start with the context.  This is an object that we can add as the next argument to page.render () and the data from which we can display in html. <br><br><pre> <code class="javascript hljs">app.get(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">page</span></span></span><span class="hljs-function">) </span></span>{ page.render({<span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-string"><span class="hljs-string">'text from Context'</span></span>}); });</code> </pre><br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Body:</span></span></span><span class="hljs-tag">&gt;</span></span> {{text}}</code> </pre><br><br>  Double {{}} brackets in the template mean that the view is not dynamically associated with the data.  The template engine does not monitor data changes or html.  For context, this is not necessary, since the context is a simple js-object and does not change, therefore the use of this output method (context) is rather limited and is used, perhaps, only for some static pages.  All the power of working with data appears when using the Model object. <br><br>  <a href="http://habrahabr.ru/post/195664/">There is</a> already something written about the model, so as not to repeat. <br>  Where to get the model?  There are many ways (depending on whether you are on the client or on the server), but on the router it goes as the second argument (after page) and it is very convenient for us in this situation: <br><br><pre> <code class="javascript hljs">app.get(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">page, model</span></span></span><span class="hljs-function">) </span></span>{ page.render(); });</code> </pre><br><br>  Let's put the data into it: <br><br><pre> <code class="javascript hljs">app.get(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">page, model</span></span></span><span class="hljs-function">) </span></span>{ model.set(<span class="hljs-string"><span class="hljs-string">'_page.text'</span></span>, <span class="hljs-string"><span class="hljs-string">'text in model'</span></span>); page.render(); });</code> </pre><br><br>  _page.text is the path (path) in the model where our text will be located.  It corresponds to the object json.  In this case: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj = model.get(<span class="hljs-string"><span class="hljs-string">'_page'</span></span>); obj === {<span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-string"><span class="hljs-string">'text in model'</span></span>}</code> </pre><br><br>  An underscore means that this path is local.  That is, it exists only in this model.  And it does not synchronize with the database and other models (on other clients).  You can create any local paths, but the _page object is a bit special.  It is cleared every time the router is triggered, so it‚Äôs convenient to store data associated with this page. <br>  In order to see the data from the model, we change the template: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Body:</span></span></span><span class="hljs-tag">&gt;</span></span> {{_page.text}}</code> </pre><br><br>  Let's try to make a dynamic data link and html: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Body:</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{_page.text}</span></span></span><span class="hljs-tag"> /&gt;</span></span> {_page.text}</code> </pre><br><br>  Single brackets mean that the data from the model is dynamically linked to html.  If you change the value in input, the value in the model changes, which in turn changes the value of the text next to input.  This is how a two-way connection between the data and html is implemented. <br><br>  Well, that seems to be nothing complicated yet?  3 lines of code?  Somehow not even serious? <br>  Let's do some really serious stuff!  We will now create a web application whose clients are synchronized with each other.  We change html on one client, the data on this client dynamically changes, then this data flies to the server, where the conflict resolution algorithm works, there are clients who also subscribe to this data and, finally, the data is sent to all these clients, where they turn into html.  Will fit?  How long does it take to write this on your favorite (before Derby) framework?  How many lines of code? <br><br><pre> <code class="javascript hljs">app.get(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">page, model</span></span></span><span class="hljs-function">) </span></span>{ model.subscribe(<span class="hljs-string"><span class="hljs-string">'page.text'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!model.get(<span class="hljs-string"><span class="hljs-string">'page.text'</span></span>)) { model.set(<span class="hljs-string"><span class="hljs-string">'page.text'</span></span>, <span class="hljs-string"><span class="hljs-string">'text in model'</span></span>); } page.render(); }) });</code> </pre><br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Body:</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{page.text}</span></span></span><span class="hljs-tag"> /&gt;</span></span> {page.text}</code> </pre><br><br>  And it's all?  o_O Well, in general, yes.  Open <a href="http://localhost:3000/">http: // localhost: 3000 /</a> in several browser windows and play around. <br><br>  page.text is the remote path.  Unlike the local path, it points to the database.  In this case, we create a collection page and an object with an id text.  In real life, remote paths look like this: 'users.8ddd02f1-b82d-4a9c-9253-fe5b3b86ef41.name', 'customers.8ddd02f1-b82d-4a9c-9253-fe5b3b86ef41.properties.isLead', 'products.8ddd02f1-b82d 4a9c-9253-fe5b3b86ef41.prices.1.value '. <br>  model.subscribe - so we subscribe our client to the data in the path 'page.text'.  When changing this data in the database, the server will send us a new version of this data. <br><br>  <a href="https://github.com/vmakhaev/habr">Sources</a> :-) <br>  Do not forget to run npm install <br><br>  <a href="http://habrahabr.ru/post/196144/">Derby.js materials</a> </div><p>Source: <a href="https://habr.com/ru/post/196002/">https://habr.com/ru/post/196002/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../195988/index.html">Start loop: launch of payload into orbit for $ 3 / kg</a></li>
<li><a href="../195990/index.html">The role of team leader: what is left for managers?</a></li>
<li><a href="../195996/index.html">Introduction to the analysis of the complexity of algorithms (part 3)</a></li>
<li><a href="../195998/index.html">We water the flowers - simply and quickly</a></li>
<li><a href="../196000/index.html">Sales of Highscreen Boost 2: 6,000 mAh and the Guinness Book of Records began</a></li>
<li><a href="../196006/index.html">Collaboration of Aastra Blustar 8000i and Cisco CUCM 9.0 video terminals</a></li>
<li><a href="../196008/index.html">We write our book</a></li>
<li><a href="../196012/index.html">A new war has begun for Vkontakte. Durov threatened with dismissal</a></li>
<li><a href="../196014/index.html">Faces of Facebook: All FB users on one page</a></li>
<li><a href="../196018/index.html">Store the session on the client to simplify application scaling (3rd of 12 articles on Node.js from the Mozilla Identity team)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>