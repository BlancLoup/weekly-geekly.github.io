<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Migrating from Windows XP to 8.1 using SCCM 2012 R2 and MDT 2013</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, gentlemen. In connection with the recent death of Windows XP, this topic is quite relevant, therefore, let's start. 
 The main problem - USM...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Migrating from Windows XP to 8.1 using SCCM 2012 R2 and MDT 2013</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/911/938/e5b/911938e5bacbbee52cec0d3550b0c81a.jpg"><br>  Good day, gentlemen.  In connection with the recent death of Windows XP, this topic is quite relevant, therefore, let's start. <br>  The main problem - USMT 6.3 does not support Windows XP, and USMT 5.0 does not support Windows 8.1.  Have to use both versions. <br><br>  <b>High-level partitioning of works:</b> <br><br>  1. Preparing SCCM for OSD Procedure <br>  2. Creating the necessary packages <br>  3. Creating the necessary Task Sequence (hereinafter TS) <br>  4. Linking computers to SCCM <br>  5. Data migration from Windows XP to a data migration point. <br>  6. Install Windows 8.1 on a computer with the restoration of pre-migrated data. <br>  In addition, I assume that you have a ready and working infrastructure SCCM 2012 R2. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Limitations: <br><br>  1. SCCM Client must be installed on all machines running Windows XP <br>  2. You can migrate folders and files, the settings will not move. <br><br>  More under the cut. <br><br><a name="habracut"></a>  <b>Preparing SCCM for the OSD procedure</b> <br>  1. Preparing PXE <br>  Open the console, then go to the Administration&gt; Servers and Site Roles&gt; Distribution Point, open the properties, tick the ‚ÄúEnable PXE support for clients‚Äù, ‚ÄúEnable unknown computer support‚Äù and ‚ÄúAllow this distribution‚Äù.  In addition, you need to configure DHCP for PXE to work correctly. <br>  option 66 - NetBIOS PXE server name <br>  option 67 - \ smsboot \ x64 \ wdsnbp.com <br><br>  WDS settings do not need to touch. <br><br>  2. Installing the State Migration Point role <br>  Open the console, then stamp in the Administration&gt; Sites, right-click on the desired site ‚ÄúAdd Site System Roles‚Äù.  If you have a Standalone Primary Site (and this is true for 99.99% of those who read this), click on the ‚Äúnext‚Äù button N-th number of times, do not forget to choose the role of the State Migration Point, specify the folder for data storage and data retention after successful migration . <br><br>  <b>Creating the necessary packages</b> <br>  1. Adding a Windows 8.1 Image <br>  I personally added just install.wim from the installation disk (as part of the test), if you have a corporate image add it. <br><br>  2. Add USMT package. <br>  USMT 6.3 is created when SCCM is installed, we need USMT 5.0 (build 6.2.9200.16384), download ADK <a href="http://www.microsoft.com/en-us/download/details.aspx%3Fid%3D30652">from here</a> and install only USMT (not better on a machine with already installed USMT 6.3) and ‚Äútear out‚Äù USMT files from it ( the default folder is C: \ Program Files (x86) \ Windows Kits \ 8.0 \ Assessment and Deployment Kit \ User State Migration Tool) <br>  After that, we copy them to the server and create a package that includes the copied files, the program does not need to be created. <br><br>  3. Creating MDT Boot Image <br>  Open the console, then stamp in the Software Library&gt; Operating Systems&gt; Boot Images.  ‚ÄúCreate Boot Image using MDT‚Äù, enter the name, description, path to the storage location of the package, then select the bit depth and the size of ‚ÄúScratch Space‚Äù, it is recommended to choose a size of at least 128 MB.  It is necessary to create both x86 and x64 images.  After creation, you must go to the properties of the created images and tick the ‚ÄúDeploy this boot image from the PXE-enabled distribution point‚Äù <br><br>  <b>Creating the necessary TSs</b> <br>  1. Create TS to migrate data from Windows XP. <br>  We open the console, then we stamp in Software Library&gt; Operating Systems&gt; Task Sequence.  Create the usual ‚ÄúCustom Task Sequence‚Äù with three steps: Request State Store, Capture User State, Release State Store.  In the Capture User State step, select the ‚ÄúCustomize how user profiles are captured‚Äù option and add the MigDocs.xml and MigUser.xml files. <br>  This TS will use the USMT 5.0 package. <br><br>  2. Creating a TS for installing Windows 8.1 <br>  We open the console, then we stamp in Software Library&gt; Operating Systems&gt; Task Sequence.  Create MDT Task Sequence.  We set the name and comments, enter information about the organization, input to the domain, etc., on the next screen leave a tick "This task sequence will never be used."  Select the boot image and the Windows 8.1 package created earlier.  Create a new MDT Toolkit Package, fill in the information.  Select the item "Zero Touch Installation".  Select the SCCM client package.  Select the package USMT (6.3!) Create a new MDT Settings Package, fill in the information.  Click "next" to the end. <br><br>  3. TS modification <br>  It is necessary to modify our TS to <a href="http://www.deploymentresearch.com/Research/tabid/62/EntryId/80/Fixing-the-Computer-Replace-uberbug-in-MDT-2012-Update-1-With-ConfigMgr.aspx">work</a> .  This TS will use the USMT 6.3 package. <br>  We open the console, then we stamp in Software Library&gt; Operating Systems&gt; Task Sequence.  Choose our TS and click "Edit".  Find the ‚ÄúSet Status 5‚Äù step and add the ‚ÄúRequest State Store‚Äù step after it and select ‚ÄúRestore State from another computer‚Äù <br><img src="https://habrastorage.org/getpro/habr/post_images/e83/785/9f6/e837859f6cfe7778b7de2532e9c1b4d9.jpg"><br><br>  In the tab ‚ÄúOptions‚Äù add the condition ‚ÄúTask Sequence Variable‚Äù ‚ÄúUSMTLOCAL‚Äù ‚ÄúNot equals‚Äù ‚ÄúTrue‚Äù <br><img src="https://habrastorage.org/getpro/habr/post_images/bbd/7fc/c59/bbd7fcc592dc5391bd77dc0604f54c6e.jpg"><br><br>  Add ‚ÄúRelease State Store‚Äù under ‚ÄúRestore User State‚Äù and add the same condition for it. <br>  Next, in the ‚ÄúRestore User State‚Äù section, select the ‚ÄúCustomize how user profiles are restored‚Äù option and add the MigDocs.xml and MigUser.xml files <br><img src="https://habrastorage.org/getpro/habr/post_images/304/807/fc5/304807fc5d1fe123ccc3e03360a30ae1.jpg"><br><br>  In the ‚ÄúSet Variable for Drive Letter‚Äù item in the ‚ÄúInstall‚Äù group, change the value to ‚ÄúTrue‚Äù <br><br>  4. Modifying CustomSettings.ini <br>  When you create the MDT Setting Package, the CustomSettings.ini file was created, you must modify it.  Add the following lines to it: <br><br>  DeploymentType = NEWCOMPUTER <br>  SLShare = \\ servername \ xxx \ log - UNC path to the folder where TS will copy the logs, very convenient for troubleshooting. <br>  ScanStateArgs = / v: 5 / o / c / ue:% computername% \ * - attention, this command will exclude all local users from the migration process. <br>  LoadStateArgs = / v: 5 / c <br><br>  5. Distribute packages <br>  You must distribute all the packages and both boot images to the content distribution point.  (I, personally, always forget to do it) <br><br>  <b>Linking computers to SCCM</b> <br>  This step is necessary for successful migration, it is necessary to link computers for successful migration between different computers. <br><br>  We open the console, then we stamp in Assets And Compliance&gt; User State Migration.  Select the item ‚ÄúCreate Computer Association‚Äù and select the source computer (Windows XP) and the target (Windows 8.1).  If the target computer does not already exist, you must create it in SCCM. <br><br>  In case you need to implement the ‚ÄúRefresh‚Äù script, and not ‚ÄúReplace‚Äù you do not need to connect computers.  You simply start the data collection, then reboot the machine in PXE and start the installation of Windows 8.1. <br><br>  <b>The following paragraphs 5 and 6.</b> <br>  Naturally, for proper migration, you need to correctly create collections for which you ‚Äúincite‚Äù TS data. <br>  Collection with all Windows XP computers: <br>  select * from SMS_R_System inner join SMS_G_System_OPERATING_SYSTEM on SMS_G_System_OPERATING_SYSTEM.ResourceId = SMS_R_System.ResourceId where SMS_G_System_OPERATING_SYSTEM.Caption like "* Windows XP *" <br>  The collection for Windows 8.1 computers will also need to be created. <br><br>  Thus, it is possible to migrate both the settings from the old computer to the new one, and within the ‚Äúlimits‚Äù of one machine. <br>  <b>Of the benefits</b> - a copy of the user's files on the server is as much as needed, a single script for ‚ÄúRefresh‚Äù (this script is better implemented entirely through WinPE, but this requires a separate TS) and ‚ÄúReplace‚Äù scripts. <br><br>  <b>Of the minuses</b> - 2 TS, one is not done in WinPE because the user can somehow influence it, you need a lot of space at the State Migration Point to store user information. <br><br>  This post is a pseudo-random data set. <br>  4c74356b41 <br><br>  ps  I will answer the main question in the comments "Why?".  If you have thousands of machines on Windows XP, there can be no talk about manual migration, SCCM programs can be installed during the installation process, large companies always have some kind of corporate standards and the user usually does not need to ask what programs they need. <br>  Of course, everyone solves the problems that have arisen to him since it is more convenient for him, but I did not have a choice, I was given a specific task, according to the results of researching the problem, I wrote this opus. </div><p>Source: <a href="https://habr.com/ru/post/221201/">https://habr.com/ru/post/221201/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../221189/index.html">Free group calls to Skype for all</a></li>
<li><a href="../221193/index.html">Who came up with nanotechnology?</a></li>
<li><a href="../221195/index.html">Browser game "Cyber ‚Äã‚ÄãDevelopment" - update</a></li>
<li><a href="../221197/index.html">Particles System in crowd modeling (3)</a></li>
<li><a href="../221199/index.html">Revolutionary computers on the way. It remains to learn how to program them.</a></li>
<li><a href="../221203/index.html">Indikt - a new word in working with local data</a></li>
<li><a href="../221205/index.html">Digest KolibriOS # 4: and spring is not a hindrance</a></li>
<li><a href="../221209/index.html">Keyboards: separate, with even columns and half reversal</a></li>
<li><a href="../221213/index.html">Demo: Incremental Parser for Web IDE</a></li>
<li><a href="../221215/index.html">Inheritance of HTML files in xslt-style</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>