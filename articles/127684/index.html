<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A simple way to track the activity of Mail.Ru Agent users</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, dear habrapayazhety. 

 I do not think that this post will pull on any serious "cover failure", but, nevertheless, it can help someone faced...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A simple way to track the activity of Mail.Ru Agent users</h1><div class="post__text post__text-html js-mediator-article">  Good day, dear habrapayazhety. <br><br>  I do not think that this post will pull on any serious "cover failure", but, nevertheless, it can help someone faced with my problem.  So, given the task.  It is necessary to track how often a particular user of the mail.ru portal logs into the agent. <br><br><h5>  A bit of history </h5><br>  Once upon a time I solved this problem in the only way available to me at that time.  A small program was written (to call the utility the language will not turn) on Delphi, which constantly monitored the headers of the open windows.  Actually, for the program to function correctly, it was necessary that the window of dialogue with the user be present in the list of windows.  The program followed him and took some action when the title ‚ÄúVasily Pupkin - Disabled‚Äù disappeared, and ‚ÄúVasily Pupkin - Online‚Äù appeared. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Despite all the simplicity, the program worked flawlessly, waking me up with a melody from the speakers when the person I needed appeared online, and notifying him with a message in the open window that he was needed.  In principle, the program could be refined and adapted for any needs, such as recording the I / O log. <br><br>  However, such a solution to the problem is categorically not correct, as it requires the user to add the desired user to the contact list, keep the dialogue with him open, and generally assembled on his knee for half an hour from matches and acorns. <br><br>  Today, faced with such a problem, I came up with a new simple way to solve it, which I spread to your judgment. <br><a name="habracut"></a><br>  So, the task remains the same. <br><br><h5>  Training </h5><br>  To begin with, we will think about where the status of the user somehow ‚Äúburns‚Äù.  Climbing the mail.ru site, and briefly reviewing the specification of the mrim protocol, I came up with the following options: <br><br>  1) Actually, the status in the mail.ru agent. <br>  2) Status in the web-agent, displayed on the pages of mail and "My World". <br>  3) Status on the ‚ÄúMy World‚Äù page. <br><br>  Paragraph 1 is rejected because of the need for incineration of manuals using the mrim protocol.  It will take too long to figure out how to log in under a certain account, do a search for an address, and get status.  In addition, the user will need to create some kind of account on behalf of which this will be done.  For the latter reason, point 2 is discarded, plus the need to understand the web agent device.  But point 3 I was seriously interested, you can deal with it in more detail. <br><br>  As you know, the address of the user's page with the address ‚Äúaddress@mail.ru‚Äù is formed as ‚Äúmy.mail.ru/mail/address‚Äù.  We go to the page, and we see a green or a red "@" sign next to the username, indicating, in fact, the desired person is present in the agent or not. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/28a/1ec/2bc/28a1ec2bca19aa4d47053ee89d7ccc36.jpg" alt="image"><br><br>  It seems that this is the solution, but not everything is so simple.  If my memory serves me, some time ago it was so, but now, if you log out of your account, and see the page as an unauthorized user sees it, it is easy to see that the icon near the name disappears. <br><br>  However, back to your account, and take a closer look at what this icon represents.  More precisely, let's look at its attribute ‚Äústyle‚Äù. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/b36/065/987/b36065987dedf6155f041f73e83b6fa6.jpg" alt="image"><br><br>  Following the link ‚Äústatus.mail.ru?address@mail.ru‚Äù you can see the same 13x13 icon in the GIF format, which does not depend on authorization, and shows exactly whether a person is online or not.  So, the goal is defined, let's start working. <br><br><h5>  Actually, coding </h5><br>  To work, I chose PHP with the included GDLib library. <br><br><pre><code class="hljs ruby">function check_status($mail) { $image = imagecreatefromgif(<span class="hljs-string"><span class="hljs-string">"http://status.mail.ru/?"</span></span>.$mail); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   ,  .  ,     $x=<span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   ,    . $y=<span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  ,    ,     . $rgb = imagecolorsforindex($image,imagecolorat($image, $x, $y)); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  RGB   . $color = dechex($rgb[red]).dechex($rgb[green]).dechex($rgb[blue]); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     RGB  HEX  . <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($color == <span class="hljs-string"><span class="hljs-string">'d3f0dc'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'online'</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>      ,   . <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($color == <span class="hljs-string"><span class="hljs-string">'f8dddd'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'offline'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($color == <span class="hljs-string"><span class="hljs-string">'d8e9d8'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'away'</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  - ,        ,  <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"  "</span></span>  <span class="hljs-string"><span class="hljs-string">" ,  "</span></span>.   <span class="hljs-string"><span class="hljs-string">""</span></span>      ,     . }</code> </pre> <br><br>  That's all.  The input of the function is the e-mail address of the desired user, and at the output we get the status in the text version.  If desired, you can force the function to return true / false, depending on the situation. <br><br>  Of course, the decision is the most elementary.  But, nevertheless, at no extra cost, we got the desired result.  The resulting function can be applied extremely widely.  For example, set a task on Cron, and record the results in a database for further processing, or navigate a small widget in JavaScript that will track the appearance of people of interest on the network, and inform about this alert. </div><p>Source: <a href="https://habr.com/ru/post/127684/">https://habr.com/ru/post/127684/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../127677/index.html">Convert lib.ru library to epub format using Java tools.</a></li>
<li><a href="../127678/index.html">IFA 2011, day 4: Sony 3D Viewer, NEX-7, PS Vita and Toshiba Z830</a></li>
<li><a href="../127681/index.html">Stereo image is just</a></li>
<li><a href="../127682/index.html">NASA has released a browser 3D application ‚ÄúEyes on the Solar System‚Äù</a></li>
<li><a href="../127683/index.html">Russian microprocessors</a></li>
<li><a href="../127685/index.html">HP will split the webOS division into two parts</a></li>
<li><a href="../127688/index.html">Asset Pipeline Recipe</a></li>
<li><a href="../127689/index.html">Another Android game</a></li>
<li><a href="../127690/index.html">Mounting LVM-based volumes (LVM-in-LVM)</a></li>
<li><a href="../127692/index.html">OpenStreetMap and Flickr license (Creative Commons BY-SA version 2.0) translated into Russian</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>