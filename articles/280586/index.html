<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Saving Fragment State (Fragment)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A common problem is the incorrect behavior of the application when turning the device. The fact is that when you turn the Activity-host (Activity whic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Saving Fragment State (Fragment)</h1><div class="post__text post__text-html js-mediator-article">  A common problem is the incorrect behavior of the application when turning the device.  The fact is that when you turn the Activity-host (Activity which is the parent for the fragment) is destroyed.  At the moment this process occurs, the FragmentManager is responsible for the destruction of the child fragment.  FragmentManager runs methods of a fragment fading life cycle: <b>onPause ()</b> , <b>onStop ()</b> and <b>onDestroy ()</b> . <br><br>  If in the controller of our child fragment, for example, there is a <b>Media-Player</b> object, then in the fragment method <b>Fragment.onDestroy () an</b> instance of our sonorous player playing Media-Player will interrupt the playback of media data.  The first thing that comes to mind is to save the state of the Media-Player object by calling <b>Fragment.onSaveInstanceState (Bundle)</b> , which saves the data, and the new Activity loads it.  However, preserving the state of the <b>MediaPlayer</b> object and its subsequent restoration, anyway, interrupts playback and causes sharks to hate war in the heads of users. <br><a name="habracut"></a><br><h3>  Saving Fragments </h3><br>  Fortunately, Fragment has a mechanism by which an instance of <b>Media Player</b> can ‚Äú <i>survive</i> ‚Äù a configuration change.  By overriding the <b>Fragment.onCreate (...)</b> method and setting the fragment property. <br><br><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setRetainInstance(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); }</code> </pre> <br>  The fragment's <b>retainInstance</b> property, by <i>default</i> , is false.  This means that when the device turns around, the Fragment is not saved, but is destroyed and created in a new way along with the Activity-host.  When you call <b>setRetainInstance (true), the</b> fragment is not destroyed along with its host and is transferred to the new Activity in an unchanged form.  When saving a fragment, you can count on the fact that all its fields (including View) retain the same values.  We turn to them, and they already exist and that's it.  Using this approach, you can make sure that when you rotate the device, our <b>MediaPlayer</b> object will not interrupt its playback and the user will not freak out. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Turns and saved fragments </h3><br>  Now it's worth taking a closer look at how the saved fragments work.  Fragment is guided by the fact that the representation of a fragment can be destroyed and re-created without the need to destroy the Fragment itself.  When you change the configuration, the <b>FragmentManager</b> destroys and reassembles the fragment view.  Similarly behaves and Activity.  This is due to the considerations that new resources may be required in the new configuration.  In case there are more suitable resources for the new version, the presentation is built <i>from scratch</i> . <br><br>  <b>FragmentManager</b> checks the retainInstance property of each fragment.  If it <i>defaults</i> (false), the FragmentManager deletes the fragment instance.  Fragment and its representation will be recreated by a new instance of the FragmentManager belonging to the new activity. <br><br><img src="https://habrastorage.org/files/e98/75e/1b9/e9875e1b9ff74b2a924fc765197b430f.jpg" alt="image"><br><br>  What happens if the <b>retainInstance</b> value is <b>true</b> .  The representation of the fragment is destroyed but the fragment itself remains.  A new instance of the Activity will be created, and then a new FragmentManager will be created that will find the saved Fragment and recreate its View. <br><br><img src="https://habrastorage.org/files/867/ce3/70c/867ce370cea1406fba80bb2675b69673.jpg" alt="image"><br><br>  Our saved fragment is detached (detached) from the previous Activity and continues to live, but no longer having an Activity-host. <br><br><img src="https://habrastorage.org/files/e45/291/052/e4529105219343d9a8c0924387d03281.jpg" alt="image"><br><br>  Accordingly, the transition to the saved state occurs when the following conditions are met: <br><br><ul><li>  <b>setRetainInstance (true)</b> was called for the fragment </li><li>  Activity-host is destroyed to change the configuration (usually it is the turn of the <i>device</i> ) </li></ul><br>  In this case, <b>Fragment</b> lives quite briefly from the moment of disconnection from its first <b>Activity</b> to its transfer to use for an immediately created new <b>Acticvity</b> . <br><br><h3>  Saving Fragments: Really So Good? </h3><br>  Saved fragments: is it true, is it convenient?  Yes!  Really comfortable.  At first glance, they solve all the problems that arise with the destruction of the Activity and fragments during turns.  When you change the device configuration to select the most appropriate resources, a new view is created, and at your disposal there is an easy way to save data and objects. <br><br>  In this case, the question arises, why not save all fragments in a row and why fragments are not saved by default?  One gets the impression that Android without enthusiasm relates to the preservation of Fragments in the UI.  It is not clear to me why this is so. <br>  It should be noted that the saved Fragment continues to exist only when the Activity is destroyed - when the configuration changes.  If the Activity is destroyed due to the fact that the OS needed to free up memory, then all saved fragments will also be destroyed. <br><br><h3>  It's time to talk about onSaveInstanceState (Bundle) </h3><br>  This approach is more common in dealing with the problem of data loss during turns.  If your proposal easily handles this situation, then all thanks to the work behavior of <b>onSaveInstanceState (...)</b> by default. <br><br>  The <b>onSaveInstanceState (...)</b> method was designed to solve save and restore the state of the user interface of the application.  I think you guessed it - there is a fundamental difference between these approaches.  The main difference between redefining <b>Fragment.onSaveInstanceState (...)</b> and saving Fragment-a is the duration of the stored data. <br><br>  In the event that you want to save data for a moment while the configuration changes, saving a fragment will require significantly less work. This is especially true when saving an object developer does not need to worry about whether the object is Serializable. <br><br>  But in the event that the data should exist longer, saving the fragment will not help.  If the Activity is destroyed to free up memory after the <i>user‚Äôs</i> inaction, all saved fragments are destroyed in the same way as their not saved relatives. <br><br><h3>  Finally </h3><br>  So, if there is data in the Activity or in Fragment that must exist for a long time, they should be tied to the lifetime of the activity, overriding the <b>onSaveInstanceState (Bundle)</b> method to save the state and restore it later. </div><p>Source: <a href="https://habr.com/ru/post/280586/">https://habr.com/ru/post/280586/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../280576/index.html">‚ÄúPublic organizations and IT community: ideas and cooperation‚Äù. We invite you to Metap in Petersburg</a></li>
<li><a href="../280578/index.html">More than 60 tools for monitoring Windows</a></li>
<li><a href="../280580/index.html">Ostro Pot - open source multi-cooker based on OS Ostro</a></li>
<li><a href="../280582/index.html">Register for the webinar "How to guarantee and simply protect the company from encrypters and hidden threats"</a></li>
<li><a href="../280584/index.html">Microsoft has confirmed rumors about the integration of the Linux subsystem in Windows 10</a></li>
<li><a href="../280588/index.html">How to fly free to Paris with a girl and get a development contract</a></li>
<li><a href="../280596/index.html">How I VK Mobile Challenge accepted</a></li>
<li><a href="../280598/index.html">Trends in the development of cloud data centers</a></li>
<li><a href="../280602/index.html">As we broke up mobile Lenta.ru to the speed of light</a></li>
<li><a href="../280604/index.html">Legend of international avos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>