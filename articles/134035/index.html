<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Verilog. RAM wrappers and why it is needed</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The fact is that my acquaintance with the FPGA for two years. In my student years, reading code examples from Altera and Xilinx, I paid little attenti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Verilog. RAM wrappers and why it is needed</h1><div class="post__text post__text-html js-mediator-article">  The fact is that my acquaintance with the FPGA for two years.  In my student years, reading code examples from Altera and Xilinx, I paid little attention to the description of RAM and ROM, because this was not necessary.  I knew that there was a FIFO, but I didn‚Äôt even guess why I needed it.  So I defended my diploma by making my project head on. <br><br>  I found a job thanks to my ‚Äúknowledge‚Äù in the field of FPGA.  Immediately, problems emerged that I didn‚Äôt suspect: existing projects occupied 90% of the logical elements, and my work was to place digital filters in the projects.  It is clear that "in the forehead" to solve this problem was impossible.  Rewrite existing code?  It helped, but not much.  And only then did I understand how to play with RAM to solve the tasks. <br><br>  <em>Attention!</em>  <em>LEDs will not blink here.</em>  <em>Instead, the implementation of the shift register in the form of a wrapper for M4K will be considered.</em>  <em>This publication assumes minimal familiarity with FPGA and the Verilog language.</em> <br><a name="habracut"></a><br>  To begin with, having made the necessary filter in the forehead in a separate project, it became clear where there is a thin place in it.  It turned out to be a shift register of length 444 * 16 bits (444 is the order of the filter, 16 bits is the dimension of the word).  With this you need to do something.  The thought came to the conclusion that the shift is a trivial operation.  Get the current value of the register in step N and write there the value of the register taken in step N-1.  After reading through code examples, I found how to do this with RAM: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs delphi">module pip #(parameter DATA_WIDTH=<span class="hljs-number"><span class="hljs-number">16</span></span>, parameter ADDR_WIDTH=<span class="hljs-number"><span class="hljs-number">9</span></span>) ( input [(DATA_WIDTH-<span class="hljs-number"><span class="hljs-number">1</span></span>):<span class="hljs-number"><span class="hljs-number">0</span></span>] data, input [(ADDR_WIDTH-<span class="hljs-number"><span class="hljs-number">1</span></span>):<span class="hljs-number"><span class="hljs-number">0</span></span>] read_addr, write_addr, input we, clk, output reg [(DATA_WIDTH-<span class="hljs-number"><span class="hljs-number">1</span></span>):<span class="hljs-number"><span class="hljs-number">0</span></span>] q ); <span class="hljs-comment"><span class="hljs-comment">(*ramstyle = "M4K"*)</span></span>reg [DATA_WIDTH-<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] ram[<span class="hljs-number"><span class="hljs-number">2</span></span>**ADDR_WIDTH-<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]; always @ (posedge clk) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> q &lt;= ram[read_addr]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (we) ram[write_addr] &lt;= data; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> endmodule</code> </pre> <br><br>  This is taken directly from the examples, only the parameters have changed.  It now remains to make this RAM work, as described above.  For this, what I called the RAM wrapper was written.  A simple state machine: <br><br><pre> <code class="hljs pgsql">module upr #(parameter DATA_WIDTH = <span class="hljs-number"><span class="hljs-number">16</span></span>, parameter ADDR_WIDTH = <span class="hljs-number"><span class="hljs-number">9</span></span>) ( <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> wire clk, <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> wire en, <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> wire [ (DATA_WIDTH<span class="hljs-number"><span class="hljs-number">-1</span></span>) : <span class="hljs-number"><span class="hljs-number">0</span></span> ] ram_upr, <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> wire [ (DATA_WIDTH<span class="hljs-number"><span class="hljs-number">-1</span></span>) : <span class="hljs-number"><span class="hljs-number">0</span></span> ] data_in, output wire [ (DATA_WIDTH<span class="hljs-number"><span class="hljs-number">-1</span></span>) : <span class="hljs-number"><span class="hljs-number">0</span></span> ] upr_ram, output wire we_ram, output wire [ (ADDR_WIDTH<span class="hljs-number"><span class="hljs-number">-1</span></span>) : <span class="hljs-number"><span class="hljs-number">0</span></span> ] adr_out ); assign upr_ram = ram; assign we_ram = r_we; assign adr_out = r_adr; reg [ <span class="hljs-number"><span class="hljs-number">2</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span> ] r_state = state0; localparam state0 = <span class="hljs-number"><span class="hljs-number">3</span></span><span class="hljs-string"><span class="hljs-string">'b001, state1 = 3'</span></span>b010, state2 = <span class="hljs-number"><span class="hljs-number">3</span></span><span class="hljs-string"><span class="hljs-string">'b100; reg [ (ADDR_WIDTH-1) : 0 ] r_adr = {ADDR_WIDTH{1'</span></span>b0}}; reg [ (DATA_WIDTH<span class="hljs-number"><span class="hljs-number">-1</span></span>) : <span class="hljs-number"><span class="hljs-number">0</span></span> ] ram = {DATA_WIDTH{<span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b0}}; reg r_we = 1'</span></span>b0; <span class="hljs-keyword"><span class="hljs-keyword">always</span></span> @(posedge clk) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(en) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span>(r_state) state0: r_state &lt;= state1; state1: r_state &lt;= state2; state2: r_state &lt;= state1; endcase <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">always</span></span> @(posedge clk) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span>(r_state) state0: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> r_we &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b0; r_adr &lt;= {ADDR_WIDTH{1'</span></span>b0}}; ram &lt;= data_in; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> state1: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> r_we &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b1; if(r_adr == {ADDR_WIDTH{1'</span></span>b0}}) ram &lt;= data_in; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> ram &lt;= ram_upr; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> state2: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> r_adr &lt;= r_adr + <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">'b1; r_we &lt;= 1'</span></span>b0; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> endcase endmodule</code> </pre><br><br>  It works in two stages + one state that can be used during a reset.  The state machine is extremely simple - no conditions for the transition, only the front of the clock signal.  At the first step (State1) there is a capture of data, or a previous output value from RAM.  It was such a feedback.  To the second step, a write signal is set to one and the RAM captures what is needed. <br><br>  This approach has a significant disadvantage - the shift takes 2 bars, but this problem can be easily solved.  Another significant drawback is that it is impossible to ‚Äúpull out‚Äù at least two values ‚Äã‚Äãfrom the shift register in one measure.  This means that a convolutional encoder cannot be made on this.  The advantage of this approach is the saving of logical elements (LE or Slice) at the expense of memory. <br><br>  How to solve the problem of 2 cycles and, more interestingly, how to make a fully parameterized digital FIR filter based on this, I will tell if it will be interesting to anyone. </div><p>Source: <a href="https://habr.com/ru/post/134035/">https://habr.com/ru/post/134035/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../134030/index.html">CINEMA 3D - technological features and applications</a></li>
<li><a href="../134031/index.html">Business intelligence</a></li>
<li><a href="../134032/index.html">About hosting in RuNet from the inside</a></li>
<li><a href="../134033/index.html">Semantic Version Control 1.0.0-rc.1</a></li>
<li><a href="../134034/index.html">‚ÄúFeel‚Äù the difference or virtual textures that you can touch!</a></li>
<li><a href="../134036/index.html">Where in the MVC desktop application do you place the auto-update code?</a></li>
<li><a href="../134037/index.html">Writing GOST crypto-provider</a></li>
<li><a href="../134039/index.html">Using DSL in Visual Studio</a></li>
<li><a href="../134040/index.html">RedHat CEO: do not get caught in the "cloud" Vendor Lock-in</a></li>
<li><a href="../134041/index.html">Cliffhangers in everyday programming</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>