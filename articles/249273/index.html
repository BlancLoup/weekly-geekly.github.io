<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>STM32 and FreeRTOS. 1. Fun with streams</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This cycle of 5 articles is designed for those who have few opportunities of the usual "tinke" and arduynok, but all attempts to switch to more powerf...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>STM32 and FreeRTOS. 1. Fun with streams</h1><div class="post__text post__text-html js-mediator-article">  <i>This cycle of 5 articles is designed for those who have few opportunities of the usual "tinke" and arduynok, but all attempts to switch to more powerful controllers ended in failure or did not bring as much pleasure as they could.</i>  <i>All of the following was written by me many times at the ‚Äúeducational program‚Äù of the programmers of our studio (who often confessed that the transition from ‚Äútinek‚Äù to ‚Äútmki‚Äù opened up so many opportunities that you find yourself in a stupor, not knowing what to grab on). will be all.</i>  <i>When reading it is meant that the reader is a curious person and he could find and install Keil, STM32Cube and press the ‚ÄúOK‚Äù buttons.</i>  <i>For practice, I use the STM32F3DISCOVERY evaluation board, because it is cheap, there is a powerful processor on it and there is a bunch of LEDs.</i> <i><br><br></i>  <i>Each article is designed for "repetition" and "comprehension" somewhere around the evening of one evening, for a house, family or vacation ...</i> <i><br></i> <br><img src="https://habrastorage.org/files/2b7/340/ece/2b7340ece81145e79f8e336231b83325.jpg"><br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Very often (yes there often, almost always) microcontrollers are used in conditions where it is necessary to monitor several parameters at once.  Or vice versa, manage multiple devices simultaneously. <br><br>  Here is a task for an example: we have 4 exits on which it is necessary to output pulses of different duration with different pauses.  All we have is a system timer that counts in milliseconds. <br><br>  Complicate the task in the spirit of ‚Äútorturing myself on arduino‚Äù.  Timers are busy with others, PWM is not suitable, because it does not work on all legs, and you will not usually drive it into the necessary modes.  A little thought, we sit down and write about this code <br><br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//  int time1on=500; // ,   1    int time1off=250; // ,   1    unsigned int now=millis(); .... // -   if(millis()&lt;now+time1on) { port1=ON; } else { port1=OFF; if(millis()&gt;now+time1on+time1off) { now=millis(); } }</span></span></code> </pre> <br><br>  And one way or the other for all 4 ports.  It turns out a decent footwoman on several screens, but this footcloth works and works quite quickly, which is important for the microcontroller. <br><br>  Then suddenly the programmer notices that at each cycle the port is twitching, even if its state does not change.  Rules the whole footcloth.  Then the number of ports with the same needs is doubled.  The programmer spits and rewrites everything into one function of the PortBlink type (int port num). <br><br>  Happiness almost came, but suddenly it was necessary that at some port along with the ‚Äúexit‚Äù control something was previously read and the port was controlled based on that read.  The programmer is cursing again and doing another function, specifically for the port. <br><br>  Happiness?  But nevermind.  The customer has attached something and this can easily slow down the process for a second ... The moaning begins, the programmers once again rule the code, finally turning it into unreadable trash, the managers roll out the wild price lists to the customer for adding functionality, the customer curses and decides to never contact again with embedded solutions. <br><br>  (such as advertising and praise) And why?  Because it was originally made the wrong decision about the platform.  If possible, we offer a clever platform, even for primitive tasks.  By experience, the cost of development and support will later be much lower.  And now for control of 8 outputs I will take STM32F3, which can work at 72 MHz.  (in a whisper) In fact, I just have a handy payment with him (smail).  It was still with L1, but we inadvertently used it in one of the projects. <br><br>  Open the STM32Cube, select the board, turn on the tick near FreeRTOS and build the project as usual.  We do not need anything like that, so we leave everything by default. <br><br>  What is FreeRTOS?  This is an almost real-time operating system for microcontrollers.  That is all that you have heard about operating systems such as multitasking, semaphores and other mutexes.  Why FreeRTOS?  It is simply supported by the STM32Cube ;-).  There are a bunch of other similar systems - the same ChibiOS.  In essence, they are all the same, only differ in teams and their format.  Here I am not going to rewrite a mountain of books and instructions for working with operating systems, I‚Äôll just run through broad strokes on the most interesting things that help programmers greatly in their difficult work. <br><br>  Okay, I will assume that they read on the Internet and imbued.  See what has changed <br><br>  Somewhere at the beginning of main.c <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StartThread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * argument)</span></span></span></span>;</code> </pre><br><br>  and after all initializations <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* Create Start thread */</span></span> osThreadDef(USER_Thread, StartThread, osPriorityNormal, <span class="hljs-number"><span class="hljs-number">0</span></span>, configMINIMAL_STACK_SIZE); osThreadCreate (osThread(USER_Thread), <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* Start scheduler */</span></span> osKernelStart(<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>);</code> </pre><br><br>  And an empty StartThread with one infinite loop and osDelay (1); <br><br>  Surprised?  Meanwhile, in front of you are almost 90% of the functionality that you will use.  The first two lines create a thread with normal priority, and the last line starts the task scheduler.  And all this magnificence fits into 6 kilobytes of flash. <br><br>  But we need to check the work.  Change osDelay to the following code <br><br><pre> <code class="cpp hljs">HAL_GPIO_WritePin(GPIOE,GPIO_PIN_8,GPIO_PIN_RESET); osDelay(<span class="hljs-number"><span class="hljs-number">500</span></span>); HAL_GPIO_WritePin(GPIOE,GPIO_PIN_8,GPIO_PIN_SET); osDelay(<span class="hljs-number"><span class="hljs-number">500</span></span>);</code> </pre><br><br>  Compile and fill.  If everything is done correctly, then we should blink blue LED (on STM32F3Discovery on PE8-PE15 a bunch of LEDs are soldered, so if you have another board, then change the code) <br><br>  And now we take and replicate the resulting function for each LED. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PE8Thread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * argument)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PE9Thread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * argument)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PE10Thread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * argument)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PE11Thread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * argument)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PE12Thread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * argument)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PE13Thread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * argument)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PE14Thread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * argument)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PE15Thread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * argument)</span></span></span></span>;</code> </pre><br><br>  Add a stream for each LED <br><pre> <code class="cpp hljs">osThreadDef(PE8_Thread, PE8Thread, osPriorityNormal, <span class="hljs-number"><span class="hljs-number">0</span></span>, configMINIMAL_STACK_SIZE); osThreadCreate (osThread(PE8_Thread), <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>);</code> </pre><br>  And move the code there to ignite the LED <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PE8Thread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * argument)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(;;) { HAL_GPIO_WritePin(GPIOE,GPIO_PIN_8,GPIO_PIN_RESET); osDelay(<span class="hljs-number"><span class="hljs-number">500</span></span>); HAL_GPIO_WritePin(GPIOE,GPIO_PIN_8,GPIO_PIN_SET); osDelay(<span class="hljs-number"><span class="hljs-number">500</span></span>); } }</code> </pre><br><br>  In general, everything is the same. <br><br>  Compile, fill ... and get a fig.  Complete.  No LED flashes. <br><br>  Using terrible debugging using the commenting method, we find out that 3 threads are working, and 4 are no longer.  What is the problem?  The problem is in the allocated memory for the Sheduler and the stack. <br><br>  We look in FreeRTOSConfig.h <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> configMINIMAL_STACK_SIZE ((unsigned short)128) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> configTOTAL_HEAP_SIZE ((size_t)3000)</span></span></code> </pre><br><br>  3000 bytes for all and every task 128 bytes.  Plus, somewhere else you need to store information about the task and other useful things.  That's why, if you do nothing, the scheduler does not even start when there is a shortage of memory. <br><br>  Judging by the fakam, if you enable full optimization, FreeRTOS itself will take 250 bytes.  Plus, each task has 128 bytes for the stack, 64 for the internal list and 16 for the task name.  We count: 250 + 3 * (128 + 64 + 16) = 874.  Even to the kilobyte does not reach.  And we have 3 ... <br><br>  What is the problem?  The FreeRTOS version supplied with the STM32Cube is too old (7.6.0) to have vTaskInfo, so I go to the side: <br><br>  Before and after creating the stream, I set the following (fre is the usual size_t) <br><br><pre> <code class="cpp hljs">fre=xPortGetFreeHeapSize();</code> </pre><br><br>  We stick breakpoints and we get the following numbers: before the creation of the task there were 2376 free bytes, and after 1768. That is, 608 bytes go to one task.  Checking yet.  We get the numbers 2992-2376-1768-1160.  The figure is the same.  By simple logical reasoning, we understand that those figures from the fak are taken for some dead processor, with optimizations turned on and all sorts of modules turned off.  We look further and understand that the start of the scheduler eats about another 580 bytes. <br><br>  In general, we accept for calculations 610 bytes per task with a minimum stack and another 580 bytes for the OS itself.  Total in TOTAL_HEAP_SIZE should be written 610 * 9 + 580 = 6070.  Let us round and give 6100 bytes - let him eat. <br><br>  Compile, fill and watch all the LEDs blink at once.  We try to reduce the stack to 6050 - again, nothing works.  So we calculated correctly :) <br><br>  Now you can indulge and give each LED its own ‚Äúpulse‚Äù and ‚Äúpause‚Äù intervals.  In principle, if you update FreeRTOS or conjure in the code, then it is easy to give an accuracy of 0.01ms (by default, 1 tick - 1ms). <br><br>  Agree, working with 8 tasks alone is much more pleasant than one with 8 at a time?  In reality, in our projects, usually 30-40 threads are spinning.  How many programmers would be deaths, if I cram all their processing into one function, I‚Äôm even afraid to count them :) <br><br>  The next step we need to deal with priorities.  As in real life, some tasks are ‚Äúmore equal‚Äù than others and they need more resources.  To begin with, we will replace one flasher with a flasher, but made wrong, when the pause is made not by the OS means, but by a simple cycle. <br><br>  That is, instead of osDelay (), such a horror is inserted. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> c; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;<span class="hljs-number"><span class="hljs-number">1000000</span></span>;i++) { c++; }</code> </pre><br><br>  The number of cycles is usually chosen experimentally (for if there are several such delays, then a lot of headaches in the calculations are provided).  Aesthetes can read the execution time of commands. <br><br>  Replace, compile, run.  The LEDs are still flashing, but somehow sluggish.  Viewing with an oscilloscope makes it clear that instead of even borders (such as 50ms are on fire and 50ms are not on fire), the borders began to float for 1-2ms (the eye, oddly enough, it notices).  Why?  Because FreeRTOS is not a real-time system and can afford such liberties. <br><br>  And now let's raise the priority of this task by one small step, before osPriorityAboveNormal.  Run and see a lonely flashing LED.  Why? <br><br>  Because the scheduler assigns tasks to priorities.  What does he see?  That high priority task constantly requires a processor.  What is the result?  The remaining tasks time to work does not remain. <br><br>  And now we will lower the priority one step from normal to osPriorityBelowNormal.  As a result, the scheduler, giving normal tasks to work, gives the remaining resources "bad." <br><br>  From here you can easily derive the first rule of the programmer: if the functions have nothing to do, then give control to the scheduler. <br><br>  FreeRTOS has two options: ‚Äúwait.‚Äù <br><br>  The first option is ‚Äújust wait for N ticks‚Äù.  The usual pause, without any frills: as they said to wait, so much we wait.  This is vTaskDelay (osDelay is just a synonym).  If you look at the time at runtime, there will be something like the following (we assume that the useful task is performed 24ms): <br><br>  ... [0ms] - transfer control - work [24ms] pause in 100ms [124ms] - transfer control - work [148ms] pause in 100ms [248ms] ... <br><br>  It is easy to see that, because of the time required for work, the transfer of control does not occur every 100ms, as it might be initially assumed.  For such cases, there is vTaskDelayUntil.  With it, the time line will look like this. <br><br>  ... [0ms] - transfer of control - work [24ms] pause in 76ms [100ms] - transfer of control - work [124ms] pause in 76ms [200ms] ... <br><br>  As you can see, the task gets control in clearly defined time intervals, which is what we needed.  To check the accuracy of the scheduler in one of the streams, I asked to make pauses of 1ms each.  In the picture you can estimate the accuracy of work with 9 threads (we don‚Äôt forget about StartThread) <br><br><img src="//habrastorage.org/files/8cd/b1e/567/8cdb1e56700e4a51bd7d70cd282c54e2.png"><br><br>  <i>At this point, I usually finish, because people are so immersed in the game with priorities and finding out when it breaks, that it‚Äôs easier to shut up and have fun.</i> <i><br><br></i>  <i>Fully assembled project with all sources can be found at <a href="">kaloshin.ru/stm32/freertos/stage1.rar</a></i> <br><br>  Continued <a href="http://habrahabr.ru/post/249283/">Part 2. About semaphores</a> </div><p>Source: <a href="https://habr.com/ru/post/249273/">https://habr.com/ru/post/249273/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../249263/index.html">Model View Controller (MVC) usage experience, conclusions</a></li>
<li><a href="../249265/index.html">Raspberry and Telegram: prerequisites for creating a smart home</a></li>
<li><a href="../249267/index.html">Interface for Yandex.Disk in Ubuntu 14.04</a></li>
<li><a href="../249269/index.html">Linguistic aspects of what3words and technical analysis of dictionaries</a></li>
<li><a href="../249271/index.html">How we ‚Äúmarried‚Äù cloud PBX, GSM and realtors (part 1)</a></li>
<li><a href="../249275/index.html">Update cloud platform Jelastic 2.5 - scaling on the fly</a></li>
<li><a href="../249279/index.html">Flux for stupid people</a></li>
<li><a href="../249281/index.html">Germany's National Plan for Implementing the G8 Open Data Charter</a></li>
<li><a href="../249283/index.html">STM32 and FreeRTOS. 2. Semaforim black</a></li>
<li><a href="../249285/index.html">Some notes on VMware vSphere Security Permissions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>