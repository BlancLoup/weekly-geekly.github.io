<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Scheduling tasks in Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi Habr! I bring to your attention a free translation of the article " Schedule tasks and jobs intelligently in Android " by Ankit Sinhal. 


 In mode...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Scheduling tasks in Android</h1><div class="post__text post__text-html js-mediator-article"><p>  Hi Habr!  I bring to your attention a free translation of the article " <a href="https://android.jlelse.eu/schedule-tasks-and-jobs-intelligently-in-android-e0b0d9201777">Schedule tasks and jobs intelligently in Android</a> " by Ankit Sinhal. </p><br><p>  In modern application development, tasks are often performed asynchronously, and their volume goes beyond the life cycle of the application.  In some situations, we also need to do some work, but this is not necessarily done right now.  To schedule background work, Android introduced several APIs that we can competently use in our applications. </p><a name="habracut"></a><br><p>  Choosing the right scheduler can improve application performance and device battery life. </p><br><p>  There are several APIs available for scheduling tasks on Android: </p><br><ul><li>  Alarm Manager </li><li>  Job scheduler </li><li>  GCM Network Manager </li><li>  Firebase Job Dispatcher </li><li>  Sync adapter </li></ul><br><h3>  Service issues </h3><br><p>  Services allow you to perform lengthy operations in the background.  Running services in the background has a very negative effect on battery power. </p><br><p>  Services are especially harmful when they constantly use device resources, even if they do not perform useful tasks. </p><br><h3>  Scheduled tasks during the application life cycle </h3><br><p>  When an application is running and we want to schedule or run a task at a specific time, it is recommended to use the Handler class together with Timer and Thread. </p><br><h3>  Scheduled tasks with the application turned off </h3><br><h4>  <a href="https://developer.android.com/reference/android/app/AlarmManager.html">Alarm Manager</a> </h4><br><p>  AlarmManager provides access to notification services.  This makes it possible to perform any operations outside the life cycle of your application.  This way, you can trigger events or actions, even if your application is not running.  AlarmManager may start the service in the future. </p><br><blockquote>  We must use the AlarmManager API only for tasks that need to be performed at a specific time. </blockquote><p>  <b>Example use</b> : Suppose we want to complete a task after 1 hour or every hour.  In this case, AlarmManager will help us. </p><br><h3>  <a href="https://developer.android.com/reference/android/app/job/JobScheduler.html">Job scheduler</a> </h3><br><p>  This is one of the foremost planning options mentioned and very effective with background jobs.  <i>JobScheduler API</i> , which was introduced in Android 5.0 (API level 21). </p><br><p>  This API allows you to perform tasks when the device has more available resources or when the correct conditions are met.  All conditions can be defined when creating a task.  When the announced criteria are met, the system will perform this task in the <i>JobService of</i> your application.  <i>JobScheduler</i> also cancels the execution, if necessary, in order to comply with the restrictions of the <i>Doze</i> mode and <i>App Standby</i> . </p><br><h3>  <a href="https://developers.google.com/cloud-messaging/network-manager">GCM Network Manager</a> </h3><br><p>  GCM (Google Cloud Messaging) Network Manager has all the schedule features from JobScheduler.  GCM Network Manager is also designed to perform multiple or one-time, imminent work while maintaining battery life. </p><br><p>  It is used to support backward compatibility and can also be used under Android 5.0 (API level 21).  Starting at API level 23 or higher, GCM Network Manager uses JobScheduler for the platform.  GCM Network Manager uses the scheduling mechanism in Google Play services, so this class will only work if Google Play services are installed on the device. </p><br><p>  Google strongly encouraged GCM users to switch to FCM and instead use the Firebase Task Manager to schedule any tasks. </p><br><h3>  <a href="https://github.com/firebase/firebase-jobdispatcher-android">Firebase Job Dispatcher</a> </h3><br><p>  Firebase JobDispatcher is also a library for scheduling background jobs.  It is also used to support backward compatibility (below API 21) and works in all recent versions of Android (API 9+). </p><br><p>  This library will also work if there are no installed Google Play services on the device.  In this state, this library internally uses the AlarmManager.  If a Google Play application is available on the device, it uses the scheduling mechanism in Google Play services. </p><br><h3>  <a href="https://developer.android.com/reference/android/content/AbstractThreadedSyncAdapter.html">Sync adapter</a> </h3><br><p>  Sync adapters are designed specifically for data synchronization between the device and the cloud.  It should only be used for this type of task.  Synchronization can be caused by data changes in the cloud or on the device or by elapsed time. <br>  The system will try to synchronize only when the device is connected to the network. </p><br><h3>  Exercise </h3><br><p>  We discussed a lot of theory, so now let's see how to use the Android Task Scheduler. </p><br><h4>  Create Job Service </h4><br><p>  Create a <i>JobSchedulerService extends JobService</i> that requires two <i>onStartJob</i> ( <i>JobParameters</i> parameters) and <i>onStopJob</i> ( <i>JobParameters</i> parameters) to be created. </p><br><pre><code class="hljs scala">public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JobSchedulerService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JobService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> public boolean onStartJob(<span class="hljs-type"><span class="hljs-type">JobParameters</span></span> params) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> public boolean onStopJob(<span class="hljs-type"><span class="hljs-type">JobParameters</span></span> params) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } }</code> </pre> <br><p>  The <em>onStartJob</em> method <em>is</em> called when <em>JobScheduler</em> decides to start your work.  <em>The JobService</em> runs in the main thread, so any logic must be executed in a separate thread.  The <em>onStopJob</em> method <em>is</em> called if the system has decided that you must stop doing your work.  The method is invoked before <em>jobFinished (JobParameters, boolean)</em> . </p><br><p>  You also need to register your service in AndroidManifest. </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">‚Äù.JobSchedulerService</span></span></span><span class="hljs-tag"> ‚Äú </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:permission</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">‚Äùandroid.permission.BIND_JOB_SERVICE‚Äù</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:exported</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">‚Äùtrue‚Äù/</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h4 id="sozdat-obekt-jobinfo">  Create a JobInfo object </h4><br><p>  To build a <em>JobInfo</em> object, pass the <em>JobService</em> to <em>JobInfo.Builder ()</em> , as shown below.  This task designer allows you to set a variety of different control parameters when performing a task. </p><br><pre> <code class="hljs pgsql">ComponentName serviceName = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ComponentName(context, JobSchedulerService.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>); JobInfo jobInfo = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> JobInfo.Builder(JOB_ID, serviceName) .setRequiredNetworkType(JobInfo.NETWORK_TYPE_UNMETERED) .setRequiresDeviceIdle(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) .setRequiresCharging(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) .build();</code> </pre> <br><h4 id="zaplanirovannaya-zadacha">  Scheduled task </h4><br><p>  Now we have <em>JobInfo</em> and <em>JobService</em> , so it's time to plan our work.  All we need to do is schedule the job with the required <em>JobInfo</em> , as shown below: </p><br><pre> <code class="hljs pgsql">JobScheduler scheduler = (JobScheduler) context.getSystemService(Context.JOB_SCHEDULER_SERVICE); <span class="hljs-type"><span class="hljs-type">int</span></span> result = scheduler.schedule(jobInfo); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result == JobScheduler.RESULT_SUCCESS) { <span class="hljs-keyword"><span class="hljs-keyword">Log</span></span>.d(TAG, ‚ÄúJob scheduled successfully!‚Äù); }</code> </pre> <br><h3 id="zaklyuchenie">  Conclusion </h3><br><p>  When planning a task, you need to think carefully about when and what should trigger your task, and what should happen if it does not work for some reason.  You must be very careful with the performance of your application, as well as other aspects, such as battery power. </p><br><p>  <em>JobScheduler is</em> easily implemented and handles most of it for you.  When using <em>JobScheduler,</em> our scheduled tasks are saved, even if the system reboots.  At the moment, the only drawback of <em>JobScheduler</em> is that it is available only for level 21 api (Android 5.0). </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/336120/">https://habr.com/ru/post/336120/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../336110/index.html">"Magic Constant" 0x5f3759df</a></li>
<li><a href="../336112/index.html">DsPlus - project evaluation before ICO</a></li>
<li><a href="../336114/index.html">XBRL: just about the complex - Chapter 6. Immersion in XBRL - Part 3. Calculations and validation</a></li>
<li><a href="../336116/index.html">Next steps in black magic processor after you've mastered Harris & Harris</a></li>
<li><a href="../336118/index.html">Helm secrets - the missing part of Kubernetes</a></li>
<li><a href="../336124/index.html">Useful NaN</a></li>
<li><a href="../336128/index.html">Welcome to Moscow Data Science Meetup September 1</a></li>
<li><a href="../336132/index.html">Dive into Ethereum development. Part 1</a></li>
<li><a href="../336134/index.html">Engineering systems of our data centers and their monitoring, part one</a></li>
<li><a href="../336136/index.html">A little bit about pseudo-arrays (mass-like objects or collections). ‚ÄúWhat is this?‚Äù, ‚ÄúHow to work with them?‚Äù And so on</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>