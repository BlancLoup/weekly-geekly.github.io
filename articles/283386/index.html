<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Audits and correspondence in the design institute. Integration of easla.com and TDMS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article will deal with specific for project enterprises document management procedures, or rather, the integration of technical document managemen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Audits and correspondence in the design institute. Integration of easla.com and TDMS</h1><div class="post__text post__text-html js-mediator-article">  The article will deal with specific for project enterprises document management procedures, <nobr>or rather,</nobr> <nobr>the integration of</nobr> technical document management (in our case, based on TDMS) and external correspondence.  Other types of <nobr>enterprises</nobr> may also have similar needs, so <nobr>if you</nobr> have questions regarding integration or automation using easla.com, it is also worth reading the article - interesting technical details are described here. <br> <a href="https://habrahabr.ru/post/283386/"><img src="https://habrastorage.org/files/64a/6ed/a82/64a6eda82a744746bbc7d955a6320e94.png"></a> <br>  I was going to speak at the annual conference in Giprotyumenneftegaz, but due to the strong current load I just did not have time to get ready.  Than did not meet the expectations of my friends and colleagues (a small public discussion was expected).  The decision described below does not contain anything revolutionary from an organizational point of view, but, I dare to hope, it nevertheless deserves some attention. <br><br><a name="habracut"></a><br>  Several starting points in the article are devoted to "Why."  Further - ‚ÄúHow‚Äù (VBScript, <nobr>MS SQL + XML).</nobr>  If you are more interested in how - scroll to the 5th item. <br><hr><br><h4>  1. AUDITS.  WHAT IT IS. </h4><br>  Audits are versions of documents.  The word itself came from foreign standards, where the GOST standards of the 21st series have no distribution.  There, "they", on the documents in the main inscriptions there is a field "Rev.", which, in fact, stands for "Revision". <br><div class="spoiler">  <b class="spoiler_title">Note</b> <div class="spoiler_text">  To be honest, the revisions themselves are somewhat flawed.  For example, in order for a designer to replace a couple of sheets in a document, you need to issue a new revision <nobr>to the entire</nobr> document.  <nobr>And if</nobr> <nobr>the document has</nobr> 300 pages ... In the State Standards 21. *, <nobr>unlike</nobr> revisions, all possible situations <nobr>with sheets</nobr> are considered in detail <nobr>.</nobr> <br><br>  On the other hand, life leads us to ensure that the transfer of documents will be carried out electronically <nobr>(and, I note,</nobr> this is already the case in at least 60% of our orders, even GlavGosExpertiza accepts documentation <nobr>in electronic</nobr> form).  And in electronic form, it is inconvenient to keep track of changes, for example, <nobr>in</nobr> Word <nobr>documents</nobr> , to say the least.  With regard to files, for example, with 3D models, it is generally unclear which sheets are involved. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Companies with foreign participation began to actively introduce revisions about 3-4 years ago. <br>  Those.  revisions - to be.  Moreover, one of our Customers, after receiving the first documents <nobr>with revisions</nobr> (although he did not present such requirements), began to resent receiving documents without revisions.  Further it becomes clear why. <br></div></div><br>  In the process of developing project documentation, the designer does not just draw drawings.  The designer very actively communicates with experts of the Customer <nobr>and with designers</nobr> <nobr>of manufacturers.</nobr>  <nobr>Both informally</nobr> and formally.  <nobr>Those.</nobr>  <nobr>sends the</nobr> documentation <nobr>for approval</nobr> <nobr>with a cover</nobr> letter, responds <nobr>to comments</nobr> , amends, sends the documentation <nobr>with a cover letter</nobr> <nobr>, etc.</nobr> again <nobr>.</nobr> <nobr>To the bitter end.</nobr>  <nobr>While not agree.</nobr>  Every document under development. <br><br>  The correct way to work is to submit the document <nobr>to the archive</nobr> before sending <nobr>.</nobr>  <nobr>Upon delivery to the archive</nobr> , an inventory number <nobr>is</nobr> assigned <nobr>and the</nobr> change number <nobr>is put</nobr> <nobr>on the drawing.</nobr>  <nobr>But the transfer to the archive</nobr> is a long procedure, <nobr>it involves</nobr> <nobr>at least</nobr> two other units.  Therefore, designers avoid submitting documents <nobr>to the archive</nobr> each time <nobr>they are</nobr> submitted <nobr>for approval.</nobr>  <nobr>And if</nobr> only the designers - they avoid the GUIs, the Chief Engineer, <nobr>and even</nobr> <nobr>the Customer himself is</nobr> <nobr>not interested</nobr> <nobr>in</nobr> delaying the procedure for the coordination of documentation. <br><div class="spoiler">  <b class="spoiler_title">Note</b> <div class="spoiler_text">  Why do we need to surrender to the archive?  The fact is that there is a small but important difference between the transfer of ‚Äúfinished documentation‚Äù <nobr>and the transfer</nobr> <nobr>‚Äúfor approval‚Äù.</nobr>  When the finished documentation is transferred - the invoice is drawn up.  This imposes legal obligations <nobr>on the customer.</nobr>  <nobr>And therefore</nobr> there everything must be done exactly <nobr>in accordance with GOST.</nobr>  <nobr>But in terms of</nobr> agreeing on the requirements, <nobr>as a rule,</nobr> <nobr>they are not so</nobr> tough - the Customer is well aware that <nobr>it</nobr> takes time, which is as important to him <nobr>as the design institute</nobr> , <nobr>to submit</nobr> <nobr>to the archive</nobr> <nobr>.</nobr> <br></div></div><br><img src="https://habrastorage.org/files/cf8/a89/7e9/cf8a897e90614d698fd60a06bed1ccff.gif"><br>  Those.  accounting of revisions is introduced or not - the exchange ‚Äúwithout an archive‚Äù is going on anyway.  It is also impossible to <nobr>put the</nobr> change number <nobr>without the</nobr> archive.  As a result, confusion arises.  The documentation goes first <nobr>to the Customer</nobr> (can be identified by the outgoing number of the letter from the Designer), then <nobr>to the expert</nobr> (and here is the outgoing number from the Customer! The number of the Designer's letter is gone!).  Customer‚Äôs specialists can transfer (and transmit!) To different experts (and there are a lot of experts from the Customer) documentation of different versions, <nobr>and it is</nobr> impossible <nobr>to</nobr> <nobr>understand this</nobr> <nobr>until the</nobr> debriefing <nobr>begins</nobr> . <br><br>  In order that confusion did not occur - the accounting of audits is introduced.  On each document transmitted <nobr>in electronic</nobr> or paper form, the revision number, date of issue and comment are written.  <nobr>Thus, when the designer and the expert are</nobr> contacted by phone, it becomes clear by the revision <nobr>number</nobr> whether they hold the same documents in their hands or not. <br><hr><br><h4>  2. HOW USUALLY WORK WITH AUDITS. </h4><br>  Sadly, in most organizations, to this day, the usual situation is ‚Äúmanual automation‚Äù.  <nobr>Those.</nobr>  accounting <nobr>functions</nobr> are performed not by a machine, but by people.  For example, <nobr>using Excel.</nobr>  <nobr>In the ‚Äúgood‚Äù</nobr> case, there is a release team that controls the transfer of documentation.  <nobr>In the neglected</nobr> <nobr>(which is not uncommon)</nobr> - there is no such group, the designers themselves keep records. <br><br>  Those.  in order to transfer the document to the Customer, the design engineer assigns the revision number, prints the document, goes to the head of the group, signs, then to the chief specialist, <nobr>also signs,</nobr> then to the head of the department, then to the normal controller, then, possibly, <nobr>to the coordinators</nobr> departments, finally, to the PIU, and - can scan it (manually !!!).  <nobr>After scanning -</nobr> you need to make a cover letter, <nobr>sign it,</nobr> collect scans <nobr>and send</nobr> <nobr>it all,</nobr> for example, to the assistant engineer or specially designated person responsible <nobr>for the workflow.</nobr>  This person <nobr>will check everything;</nobr> God willing <nobr>, he</nobr> will not find any mistakes (can you imagine how <nobr>it is to go through all this</nobr> again <nobr>?).</nobr>  Then, finally, a letter with attachments is sent ( <nobr>oh yeah, the letter</nobr> is <nobr>also scanned,</nobr> because there are signatures!). <br><img src="https://habrastorage.org/files/e8b/054/d2b/e8b054d2b52147c0b81e57ac5b283c82.png"><br>  Customers, I must say, come across different.  One must by all means through the mail.  Even if there is a couple of gigabytes.  Another - certainly through a link to the resource Designer.  Third, you need to put everything <nobr>in a certain order</nobr> on the resource of the Customer.  In general, many options.  This, too, is usually done manually. <br><hr><br><h4>  3. AND WHAT IS NEEDED FROM AUDITS, OTHER THAN THEIR ACCOUNT? </h4><br>  After the transfer of the document begins the most interesting.  There are a lot of documents, so almost the very first thing <nobr>with which</nobr> design is started is the register of documentation (no, there is, of course, a title list, <nobr>but this</nobr> <nobr>is outside the scope of</nobr> this article).  Under this registry, as a rule, the readiness of work is then monitored.  Each document may, in terms of readiness, be in one of the statuses: <br><ul><li>  "In development" - has not yet been transferred to the Customer. </li><li>  "Transferred" - you need a letter number. </li><li>  ‚ÄúRevision‚Äù - there are comments. </li><li>  ‚ÄúAgreed‚Äù - the document has been agreed. </li></ul><br>  And still it is necessary to take into account that coordination is a multi- <nobr>step</nobr> process, there is an internal examination, <nobr>there is a GlavGosExpertiza,</nobr> there is a link to the design documentation, etc ... <br><br>  Such a registry in the "running" case is real, but it will take two weeks, and errors will be in 20% of cases.  <nobr>In the case of</nobr> "manual automation", it seems to be easier - because  there is a special person who, day <nobr>and night,</nobr> tracks (at least, should) the transfer of documentation <nobr>and its coordination.</nobr>  <nobr>What-no,</nobr> but still centralization.  That gives the result approximately ‚Äúin a day‚Äù and ... <nobr>10-15% of errors.</nobr>  Why?  But because coordination is a multi-step process, and the ‚Äúresponsible‚Äù is often far <nobr>from design, he</nobr> does not understand the nuances.  The correct process is the developer <nobr>himself.</nobr> <br><br>  In addition, there is the issue of controlling the compliance of the documentation with each other.  Project documents often mention other project documents.  A special ‚ÄúStatement of reference <nobr>and attached</nobr> documents‚Äù is even compiled.  According to GOST, a note must indicate the number of the document change.  Thus, according to the register of documents with change numbers, it is possible to track whether the document is correct with <nobr>respect to</nobr> references, or whether it is based on outdated data.  When accounting for revisions, <nobr>as a rule, they</nobr> require, in addition to the change number, to indicate the revision identifier.  For the same purposes. <br><hr><br><h4>  4. HOW AUTOMATED ACCOUNTING AUDITS WE. </h4><br>  When introducing accounting revisions, we proceeded from 2 prerequisites.  <b>First</b> , you need to reduce the amount of work the designer (all of these printing and scanning).  <b>Secondly</b> , you need to give a tool to track the coordination process.  Someone.  Best of all - the designer.  <nobr>Well, we do not have a</nobr> special person to track the agreement.  Therefore - to the designer, and this tool should be convenient! <br><br>  Let's start with the 1st point.  At the time of introducing accounting revisions, we already had an established process of filing <nobr>into the archive,</nobr> in which PDFs with signatures were created.  Designers with might and main used it to bypass the printing and scanning with signatures (true, the archive was very tense at the same time).  <nobr>Therefore, we</nobr> added several fields to our objects and implemented a procedure for fixing revisions, <nobr>which</nobr> included the automatic creation of PDF with signatures. <br><br>  Then, at first, just uploading the document files (source and PDF) was implemented.  And after that, a function was implemented that immediately resolved half of the confusion regarding tracking processes - <nobr>in TDMS, the</nobr> designer on the fixed revision presses the ‚ÄúAdd to letter‚Äù button, selects the letter, and the revision itself enters the letter in easla.com, and the link is also set on the object of audit <nobr>in TDMS.</nobr>  It seems to be a trifle, but how many problems it solves!  The designer saves time <nobr>on retrieving</nobr> <nobr>from TDMS,</nobr> collecting materials, archiving them and transferring them to the workflow service, <nobr>and the GUI</nobr> can get a <u><b>reliable</b></u> list of what has been sent in 5 minutes! <br><br>  And no one spends a lot of time archiving materials and their correct transfer to the customer. <br><div class="spoiler">  <b class="spoiler_title">Note</b> <div class="spoiler_text">  The dwarf, in fact, is based on the shoulders of giants.  The work with revisions has not been adjusted (which, in turn, implies stable operation of the ‚Äúlive‚Äù archive), automatic installation of signatures in PDF (to avoid scanning), etc.  - To introduce such "little things" is very problematic. <br></div></div><br><img src="https://habrastorage.org/files/be3/06b/ed6/be306bed6be54032bbe041a98c83c565.png"><br><br>  Under item 2, the following function was implemented - in the TDMS, the designer selects the revision of the document, clicks the ‚ÄúLetter of approval‚Äù button and selects the incoming letter from the list, which contains information on the approval of the document.  Also selected, agreed document, <nobr>or there are comments.</nobr>  Everything. <br><div class="spoiler">  <b class="spoiler_title">Note</b> <div class="spoiler_text">  It was possible to automate the approval process more fully - the designer would enumerate all the comments, contribute the answers, form the letter.  But it was decided to limit ourselves to these opportunities because there is not much interest in compiling a detailed report with all the comments. <br><br>  In this form, the process of coordination of design documentation is implemented.  There is interest there, <nobr>because</nobr>  <nobr>a lot of</nobr> departments prepare one common document, which is incredibly painful with ‚Äúmanual automation‚Äù.  Chukovsky's work (or rather, Hugh Loftting) mentions Tyani-Push, which, of course, was not an allegory of our society, but symbolically in terms of the way we do things is very consistent.  And not only "with us." <br></div></div><br>  What do we have as a result?  As a result, the designer: <br><ul><li>  obtains a method of storing in the system all the options that he developed for the Customer <nobr>and for related</nobr> departments; </li><li>  can indicate directly in the system, by which letter which option he sent; </li><li>  is engaged in sending not a day or two, as before, but only an hour (verification by higher specialists is necessary); </li><li>  he himself sees the state of his work (there are many documents, you can‚Äôt remember everything). </li><li>  does not distract weekly several times to the preparation of reports at the request of the Customer; the <nobr>ISU itself</nobr> prepares a registry in 5 minutes! </li><li>  etc. </li></ul><br>  Registry example: <br><br><img src="https://habrastorage.org/files/393/37d/159/39337d15979f44359cd545299741809e.png"><br><br>  The designer does not need to create a registry - there is a special sample for it <nobr>in the TDMS,</nobr> <nobr>in which the</nobr> information on the transfer and approval is shown for the selected position: <br><br><img src="https://habrastorage.org/files/273/462/f04/273462f04fb8409ebe8caaecc2004c72.png"><br><div class="spoiler">  <b class="spoiler_title">Note</b> <div class="spoiler_text">  No, we have not yet automated the referential integrity control by revision.  We can <nobr>do this,</nobr> but the designers are still not morally ready for this. <br></div></div><br><hr><br><h4>  5. TECHNICAL ASPECTS.  INTEGRATION TDMS WITH EASLA.COM. </h4><br>  Integration is implemented in 3 points: <br><ol><li>  The function "Add to the letter" </li><li>  ‚ÄúLetter of approval‚Äù function </li><li>  The Registry Preparation feature </li></ol><br>  The peculiarity of the task is that when you remove an application from easla.com from a letter, <nobr>this should</nobr> affect the registry.  In addition, if the designer prepares a letter, puts documents in it, and then, in the process of preparation, realizes that he added something not right there, <nobr>then he needs to</nobr> remove this ‚Äúsomething not right‚Äù from the letter, and that‚Äôs all!  References to objects in other systems should ‚Äúdie‚Äù for this particular file, no more! <br><br>  Each application file has fields for storing information.  Moreover, in each application file, easla.com allows you to store not just a description field with a length of, say, 256 bytes <nobr>(as is most often</nobr> done in other systems), but a whole list of ‚ÄúFile composition‚Äù, in which each element ‚ÄúName‚Äù can be stored , ‚ÄúRevision number‚Äù, ‚ÄúRevision name‚Äù and ‚ÄúVersion parameters‚Äù: <br><img src="https://habrastorage.org/files/d24/d11/c27/d24d11c275384b25b94286b5602f856f.png"><br><br>  We, in fact, were customers of this easla.com feature, and it was very useful to us.  <nobr>Different Customers</nobr> are asked to form archives in different ways, there may be <nobr>several</nobr> documents in one archive. <br><hr><br><h5>  5.1.  FUNCTION "ADD TO LETTER" AND FUNCTION "LETTER OF AGREEMENT" </h5><br>  Business logic development in TDMS is done on VBS.  Special thanks for the TDMS developers.  <nobr>Yes, VBS is already</nobr> obsolete, and it would be better if it was .Net, but at least they didn‚Äôt invent any special programming language.  What saved us from the limitations <nobr>and glitches of the</nobr> machine of its own design.  Not to mention the fact that BASIC is taught to write at school. <br><br>  In addition, the easla.com system has a COM interface for working with the system.  It is built into the agent that <nobr>is installed</nobr> on each workplace.  This interface has several useful tools.  In this case, we used a tool to select the list items that looks like this: <br><img src="https://habrastorage.org/files/011/898/96f/01189896f631461c9ae318526db9d318.png"><br><br>  At the top is a line for filtering elements, at the bottom is a list of objects (in this case, <nobr>outgoing letters,</nobr> <nobr>but there can be</nobr> any other elements). <br><br>  Next, a few pieces of code that show how the integration is implemented.  Some places of the code are surprisingly not very professional, you can write more compact and prettier, <nobr>but what to do</nobr> is not the gods, they burn pots.  The main thing is working. <br><br>  <u><i>Receive an outgoing letter from easla.com</i></u> <br><pre><code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> GetOutingLetter() <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> GetOutingLetter = <span class="hljs-literal"><span class="hljs-literal">Nothing</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> ea <span class="hljs-keyword"><span class="hljs-keyword">On</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Error</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Resume</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Err</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> ea = <span class="hljs-built_in"><span class="hljs-built_in">CreateObject</span></span>(<span class="hljs-string"><span class="hljs-string">"Easla.Agent"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Err</span></span> &lt;&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">MsgBox</span></span> <span class="hljs-string"><span class="hljs-string">"EaslaAgent  .   "</span></span>, VbOKOnly &amp; VbCritical, <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> ea = <span class="hljs-literal"><span class="hljs-literal">Nothing</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> <span class="hljs-comment"><span class="hljs-comment">'   ¬´ ¬ª Set process = ea.getProcessCOM("crs_management") If process Is Nothing Then MsgBox "EaslaAgent   .   ", VbOKOnly &amp; VbCritical, "" Set ea = Nothing Exit Function End If '   ¬´¬ª Set object_def = ea.getObjectdefCOM(process, "crs_management_outgoing", 0) Dim arr1(2) arr1(0) = "crs_management_outgoing_regnum" arr1(1) = "crs_management_outgoing_document" arr1(2) = "crs_management_outgoing_attachments" '  ,    ‚Äì   Set d = ea.CreateKeyValuesPairSoapItemCOM("status", Array("crs_management_outgoing_created")) '   Set result = ea.getObjectrefsCOM(object_def, arr1, Array(d)) '      Set kvps1 = CreateObject("EaslaAgent.com.easla.KeyValuePairSoap") kvps1.key = "" kvps1.value = "id" Set kvps2 = CreateObject("EaslaAgent.com.easla.KeyValuePairSoap") kvps2.key = "" kvps2.value = "description" Set kvps3 = CreateObject("EaslaAgent.com.easla.KeyValuePairSoap") kvps3.key = " " kvps3.value = "createtime" Set kvps4 = CreateObject("EaslaAgent.com.easla.KeyValuePairSoap") kvps4.key = "" kvps4.value = "status.name" '  Err = 0 Set ooo = ea.ShowSelectObjectDialogCOM(result, Array(kvps1, kvps2, kvps3, kvps4)) If Err = 0 Then Set GetOutingLetter = ooo End If Set ea = Nothing End Function</span></span></code> </pre> <br>  <u><i>Uploading a file to easla.com and setting parameters</i></u> <br><br><pre> <code class="vbscript hljs"><span class="hljs-comment"><span class="hljs-comment">'o ‚Äì   'commonname ‚Äì    'revision ‚Äì      'filename ‚Äì      'revdata ‚Äì      'guids ‚Äì    TDMS  TDMSSheet   ¬´ ¬ª Function AddFileToOutingLetter(o, commonname, revision, filename, guids, revdata) Set AddFileTotOutingLetter = Nothing Dim ea On Error Resume Next Err = 0 Set ea = CreateObject("Easla.Agent") If Err &lt;&gt; 0 Then MsgBox "EaslaAgent  .   ", VbOKOnly &amp; VbCritical, "" Set ea = Nothing Exit Function End If Set process = ea.getProcessCOM("crs_management") If process Is Nothing Then MsgBox "EaslaAgent   .   ", VbOKOnly &amp; VbCritical, "" Set ea = Nothing Exit Function End If ' ‚Äì ,       (- easla.com ,     ) '  ,   ‚Äì    set attrs = ea.GetAttrsFromObjectCOM(o) colKeys = attrs.Keys For Each strKey In colKeys If attrs.Item(strKey).code = "crs_management_outgoing_attachments" Then For Each f In attrs.Item(strKey).values If f.nowname = commonname And f.isdeleted = "0" Then MsgBox " :           " &amp; commonname, VbOKOnly &amp; VbCritical, "" Exit Function End If Next End If Next '  easla.com Set orss = CreateObject("EaslaAgent.com.easla.ObjectrefSimpleSoap") orss.id = o.id Err = 0 '  set uploadfile = ea.uploadFileCOM(orss, code, filename) If Err &lt;&gt; 0 or uploadfile is Nothing Then MsgBox "       .   ", VbOKOnly &amp; VbCritical, "" Set ea = Nothing Exit Function End If Set kvps1 = CreateObject("EaslaAgent.com.easla.KeyValuePairSoap") kvps1.key = "srcname" kvps1.value = commonname Set kvps2 = CreateObject("EaslaAgent.com.easla.KeyValuePairSoap") kvps2.key = "revcode" kvps2.value = revision Set kvps4 = CreateObject("EaslaAgent.com.easla.KeyValuePairSoap") kvps4.key = "revdata" kvps4.value = revdata '     set ooo = ea.updateFileCOM(uploadfile, Array(kvps1, kvps2,kvps4)) If Err = 0 Then Dim arrFCSS() ReDim Preserve arrFCSS(0) '  ¬´ ¬ª For Each ob in guids.Objects n = UBound(arrFCSS) ReDim Preserve arrFCSS(n + 1) arrFCSS(n) = ob.description '  n = UBound(arrFCSS) ReDim Preserve arrFCSS(n + 1) arrFCSS(n) = ob.guid '   TDMS n = UBound(arrFCSS) ReDim Preserve arrFCSS(n + 1) arrFCSS(n) = ob.Attributes("REV_LETTER").Classifier.Code &amp; ob.Attributes("REV_NUM") ' n = UBound(arrFCSS) ReDim Preserve arrFCSS(n + 1) arrFCSS(n) = ob.Attributes("REV_DESCRIPTION") '  Next '   Set AddFileTotOutingLetter = ea.updateFileConsistCOM2(ooo, arrFCSS) End If Set ea = Nothing End Function</span></span></code> </pre><br><br>  The functions ‚ÄúAdd to the letter‚Äù and ‚ÄúLetter of approval‚Äù in terms of receiving letter numbers are similar <nobr>as twins,</nobr> so <nobr>I will not</nobr> waste the reader‚Äôs time to receive the outgoing letter number from easla.com <nobr>.</nobr> <br><hr><br><h5>  5.2.  REGISTRY PREPARATION FUNCTION </h5><br>  There are data on the communication of letters and revisions in the systems; now it is worthwhile to attend to the extraction of this data <nobr>for the preparation of the report.</nobr>  The report can be built based on TDMS samples using the ‚ÄúQueryAfterExecute‚Äù event to communicate <nobr>with information</nobr> obtained from easla.com, but for reasons <nobr>of processing speed,</nobr> we decided to do it through SQL, since easla.com has the ability to receive data in SQL queries.  To do this, an extension is installed to the MS SQL server, which allows extracting any information from the easla.com database. <br><br>  I will not give all the request code, I‚Äôll focus on the key points. <br><br>  <i><u>Receiving a list of letters on the list of document identifiers</u></i> <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PROCEDURE</span></span> [dbo].[PR_TDMSReport_GetDocList_SENT] ( @guid uniqueidentifier ‚Äì ,      ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">bigint</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">id</span></span> = f_objid <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> tngptdms.dbo.tobject (nolock) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> f_guid = @guid; <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> @temp_revs <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> ([guid_rev] uniqueidentifier <span class="hljs-comment"><span class="hljs-comment">--GUID  ,descr varchar(max) --  ,letter varchar(10) --1-  -  ,id varchar(10) --2-  -  ,t datetime --   ,objid_rev bigint -- -  ); --  ,     insert into @temp_revs EXEC [TNGP].[dbo].[PR_TDMSRevision_GetListByObject] @guid = @guid --  GUID-  XML-  ESLA declare @subquery varchar (MAX) set @subquery = cast ((select '{'+cast([guid_rev] as varchar(50))+'}' from @temp_revs for xml path('item'), elements, type) as varchar(MAX)) --     XML- declare @query XML set @query = '&lt;conditions&gt; &lt;item&gt; &lt;key&gt;crs_management_outgoing_attachments&lt;/key&gt; &lt;values&gt;' + @subquery + '&lt;/values&gt; &lt;/item&gt; &lt;/conditions&gt;' --    ,   easla.com declare @temquerytbl table ( regnum varchar(32), regdate varchar(32), revguids xml, [SentStatus] varchar(40) ) --,     easla.com DECLARE @organization_id AS INT; DECLARE @process_id AS INT; DECLARE @objectdef_id AS INT; DECLARE @user_id AS INT; declare @ret int declare @logined int set @logined = 0 if(@subquery is not NULL) begin -- , ‚Äì           ESLA,      -- EASLAlogin ‚Äì     easla.com select @logined = [master].[dbo].[EASLAlogin](,) IF (@logined = 1) BEGIN --     easla.com SELECT @organization_id = organization.id, @process_id = process.id, @objectdef_id = objectdef.id FROM [master].[dbo].[EASLAgetOrganization] ('TNGP') AS organization LEFT JOIN [master].[dbo].[EASLAgetAllProcesses] () AS process ON process.oid = organization.id LEFT JOIN [master].[dbo].[EASLAgetAllObjectdefs] () AS objectdef ON objectdef.pid = process.id WHERE process.code = 'crs_management' AND objectdef.code = 'crs_management_outgoing'; -- -   easla.com SELECT @user_id = id FROM [master].[dbo].[EASLAgetOrganizationUser] (@organization_id, ) --  easla.com   insert into @temquerytbl SELECT attributerefs.value('(ArrayOfAttributerefSimpleSoap[1]/AttributerefSimpleSoap[1]/values/item/node())[1]','varchar(30)') as letternum ,attributerefs.value('(ArrayOfAttributerefSimpleSoap[1]/AttributerefSimpleSoap[2]/values/item/node())[1]','varchar(30)') as regdate ,cast(attributerefs.query('(ArrayOfAttributerefSimpleSoap[1]/AttributerefSimpleSoap[3]/values/item/consist/item/revdata)')as varchar(max)) as revguid ,cast([status].query('(StatusSimpleSoap[1]/name[1]/node())')as varchar(max)) as sentstatus from master.[dbo].[EASLAgetobjectrefs]( @process_id, @objectdef_id --   ,CAST(' &lt;attributerefs&gt; &lt;item&gt;crs_management_outgoing_regnum&lt;/item&gt; &lt;item&gt;crs_management_outgoing_sentdate&lt;/item&gt; &lt;item&gt;crs_management_outgoing_attachments&lt;/item&gt; &lt;/attributerefs&gt; ' AS XML) ,@query, @user_id ); end declare @temquerytbl1 table ( revguid varchar(50), regnum varchar(30), regdate varchar(30), sentstatus varchar(40) ) insert into @temquerytbl1 select cast(t2.loc.query('(./node())') as varchar(50)), regnum,replace(regdate,'/','.'),sentstatus from @temquerytbl as T CROSS APPLY revguids.nodes('/revdata') as T2(Loc) END IF (@logined = 1) BEGIN select @logined = 1 - [master].[dbo].[EASLAlogout]() end ‚Ä¶</span></span></code> </pre><br><br>  There is also a similar procedure PR_TDMSReport_GetDocList_RECEIVED, which asks for information on letters of approval.  Attributes that specify the letter of approval <nobr>are stored in the TDMS,</nobr> <nobr>so there are differences,</nobr> but in general, to describe the principle of operation are not essential. <br><br>  There is a set of procedures through the JOIN operation that combine all these data with data from the TDMS <nobr>(design</nobr> area, construction site, master plan position, etc., about 50 parameters).  Several procedures, because  There are quite specific requirements of some customers.  <nobr>They are called</nobr> <nobr>from macros</nobr> in MS Excel documents.  There are about 10 document templates - reports differ, each of the Customers has its own version. <br><hr><br><h4>  CONCLUSION </h4><br>  In my experience, the introduction of a very small number of types of accounting runs as smoothly as the introduction of accounting for audits.  After the introduction, the archive became really ‚Äúalive‚Äù, because the designers had the opportunity to significantly reduce their time for, let's say, not the most basic tasks.  <nobr>For two years</nobr> (which, I will note, it says about a certain level of stability) more than <nobr>20 thousand letters</nobr> (incoming <nobr>and outgoing)</nobr> have already been registered <nobr>, the</nobr> overwhelming part of which is related to the project documentation.  <nobr>I have no doubt that the</nobr> customers of our company note a significant difference in terms of the organization of the coordination process <nobr>in comparison</nobr> with other enterprises. <br><br>  A good role was also played by having a good working contact with the developers of easla.com.  <nobr>Justified requests</nobr> for the implementation of features (such as File Composition) were always discussed <nobr>and</nobr> implemented in a timely manner. </div><p>Source: <a href="https://habr.com/ru/post/283386/">https://habr.com/ru/post/283386/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../283376/index.html">Akamai Content Delivery Network made available to Azure users</a></li>
<li><a href="../283378/index.html">django-pkgconf</a></li>
<li><a href="../283380/index.html">Facebook has laid out its CTF platform on Github - Facebook CTF</a></li>
<li><a href="../283382/index.html">Big Jackpot: Why hackers attack SWIFT financial transfer system</a></li>
<li><a href="../283384/index.html">UI tests: Cucumber + Selenide</a></li>
<li><a href="../283388/index.html">How to design a mailing list that is not annoying: 10 simple tips</a></li>
<li><a href="../283390/index.html">The evolution of the application server on NodeJS</a></li>
<li><a href="../283394/index.html">New features in Intel Media Server Studio 2016</a></li>
<li><a href="../283396/index.html">Sign up for a new online course from Mail.Ru Group on Stepic</a></li>
<li><a href="../283398/index.html">When businesses need cloud and virtualization</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>