<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>KVM, PCI passthrough, Looking Glass and all-all</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After a successful transition to Linux software developers, it gained a moment when there was little work, and also changed the main OS. Fears were ca...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>KVM, PCI passthrough, Looking Glass and all-all</h1><div class="post__text post__text-html js-mediator-article">  After a successful transition to Linux software developers, it gained a moment when there was little work, and also changed the main OS.  Fears were caused by non-platform software to support existing projects.  Part of the software earned through wine.  However, it turned out that a certain software refuses to work under wine.  It was decided to run the software on the QEMU + KVM virtual machine.  The software began to run, but working in it was quite inconvenient.  Software virtual video cards do not differ in performance, and support for 3D graphics is very modest.  I had to uncover a tambourine and look for a way out. <br><a name="habracut"></a><br><h1>  Select a separate video card for the guest system! </h1><br>  It did not take long to find a way out, but the idea of ‚Äã‚Äãbeating a tambourine with a searchlight turned out to be very strange.  On the subject of forwarding video cards to a virtual machine, the Internet is replete with instructions from different times and for different hardware.  What is a huge article on the Arch Linux site <a href="https://habr.com/ru/post/433878/">[0]</a> .  I will give an abbreviated version of the instruction for forwarding a video card. <br><br><h3>  0. Check that the hardware supports IOMMU </h3><br>  For example, here <a href="https://habr.com/ru/post/433878/">[1]</a> . <br><br><h3>  1. Turn on IOMMU support in the kernel. </h3><br><div class="spoiler">  <b class="spoiler_title">cat / etc / default / grub</b> <div class="spoiler_text"><blockquote>  GRUB_CMDLINE_LINUX_DEFAULT = "quiet splash amd_iommu = on" <br>  or <br>  GRUB_CMDLINE_LINUX_DEFAULT = "quiet splash intel_iommu = on" <br></blockquote><br></div></div><br>  Do not forget <code>sudo update-grub</code> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  2. We select the video card from the driver </h3><br>  We are looking for the right devices and see which drivers use them. <br><br><div class="spoiler">  <b class="spoiler_title">lspci -nnk</b> <div class="spoiler_text"><blockquote>  <b>04: 00.0</b> VGA compatible controller [0300]: NVIDIA Corporation GT218 [GeForce 210] [ <b>10de: 0a65</b> ] (rev a2) <br>  Kernel driver in use: <b>nouveau</b> <br>  Kernel modules: nvidiafb, nouveau <br>  <b>04: 00.1</b> Audio device [0403]: NVIDIA Corporation High Definition Audio Controller [ <b>10de: 0be3</b> ] (rev a1) <br>  Kernel driver in use: <b>snd_hda_intel</b> <br>  Kernel modules: snd_hda_intel <br></blockquote><br></div></div><br>  Add the VFIO modules so that they load when loading. <br><br><div class="spoiler">  <b class="spoiler_title">cat / etc / modules |</b>  <b class="spoiler_title">grep vfio</b> <div class="spoiler_text"><blockquote>  vfio <br>  vfio_iommu_type1 <br>  vfio_pci <br>  vfio_virqfd <br></blockquote><br></div></div><br>  We configure the VFIO module so that it intercepts devices, preventing the main drivers from loading.  If necessary, add to the blacklist, the main driver. <br><br><div class="spoiler">  <b class="spoiler_title">cat /etc/modprobe.d/vfio.conf</b> <div class="spoiler_text"><blockquote>  options vfio-pci ids = <b>10de: 0a65,10de: 0be3</b> <br>  blacklist nouveau <br></blockquote><br></div></div><br><h3>  3. Reboot and check that everything worked out. </h3><br>  IOMMU turned on. <br><br><div class="spoiler">  <b class="spoiler_title">dmesg |</b>  <b class="spoiler_title">grep -e DMAR -e IOMMU -e AMD-Vi</b> <div class="spoiler_text"><blockquote>  DMAR: Intel¬Æ Virtualization Technology for Directed I / O <br>  or <br>  AMD-Vi: Found IOMMU at 0000: 00: 00.2 cap 0x40 <br>  AMD-Vi: Interrupt remapping enabled <br>  AMD-Vi: Lazy IO / TLB flushing enabled <br></blockquote><br></div></div><br>  Composite devices fell into one group. <br><br><div class="spoiler">  <b class="spoiler_title">for a in / sys / kernel / iommu_groups / *;</b>  <b class="spoiler_title">do find $ a -type l;</b>  <b class="spoiler_title">done |</b>  <b class="spoiler_title">sort - version-sort</b> <div class="spoiler_text"><blockquote>  <b>/sys/kernel/iommu_groups/15/devices/0000:01:00.0</b> <b><br></b>  <b>/sys/kernel/iommu_groups/15/devices/0000:01:00.1</b> <br>  /sys/kernel/iommu_groups/16/devices/0000:02:00.0 <br>  /sys/kernel/iommu_groups/17/devices/0000:03:00.0 <br>  <b>/sys/kernel/iommu_groups/18/devices/0000:04:00.0</b> <b><br></b>  <b>/sys/kernel/iommu_groups/18/devices/0000:04:00.1</b> <br></blockquote><br></div></div><br>  KVM and VFIO drivers are loaded. <br><br><div class="spoiler">  <b class="spoiler_title">lsmod |</b>  <b class="spoiler_title">grep -e kvm -e vfio</b> <div class="spoiler_text"><blockquote><pre> kvm_amd 94208 0
 ccp 90112 1 kvm_amd
 kvm 622592 1 kvm_amd
 vfio_pci 45056 0
 vfio_virqfd 16384 1 vfio_pci
 irqbypass 16384 2 vfio_pci, kvm
 vfio_iommu_type1 24576 0
 vfio 28672 2 vfio_iommu_type1, vfio_pci
</pre></blockquote><br></div></div><br>  Video card for guest OS captured VFIO. <br><br><div class="spoiler">  <b class="spoiler_title">lspci -nnk</b> <div class="spoiler_text"><blockquote>  <b>04: 00.0</b> VGA compatible controller [0300]: NVIDIA Corporation GT218 [GeForce 210] [ <b>10de: 0a65</b> ] (rev a2) <br>  Kernel driver in use: <b>vfio-pci</b> <br>  Kernel modules: nvidiafb, nouveau <br>  <b>04: 00.1</b> Audio device [0403]: NVIDIA Corporation High Definition Audio Controller [ <b>10de: 0be3</b> ] (rev a1) <br>  Kernel driver in use: <b>vfio-pci</b> <br>  Kernel modules: snd_hda_intel <br></blockquote><br></div></div><br><h3>  4. Configure QEMU and run the guest OS </h3><br><div class="spoiler">  <b class="spoiler_title">Install if not already installed</b> <div class="spoiler_text"><blockquote>  sudo apt install qemu-kvm qemu-utils seabios ovmf virt-viewer <br></blockquote></div></div><br><div class="spoiler">  <b class="spoiler_title">Create a disk where the guest OS will be installed</b> <div class="spoiler_text"><blockquote>  qemu-img create -f raw -o preallocation = full guest.img 50G <br>  or <br>  fallocate -l 50G guest.img <br></blockquote></div></div><br>  We start the virtual machine without forwarding the video card to install the guest OS.  Since the sight is on Looking Glass, then the guest should choose Windows 10. Windows 8 / 8.1 according to the latest data is also supported. <br><br><div class="spoiler">  <b class="spoiler_title">vga_qxl.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  remote-viewer spice: //127.0.0.1: 5900 &amp; <br>  sudo qemu-system-x86_64 \ <br>  -machine q35, accel = kvm \ <br>  -enable-kvm \ <br>  -cpu host, kvm = off, check \ <br>  -smp cpus = 2, sockets = 1, cores = 2, threads = 1 \ <br>  -m 6G \ <br>  -rtc base = localtime, clock = host \ <br>  -device piix3-usb-uhci \ <br>  -device usb-tablet \ <br>  -drive if = pflash, format = raw, readonly, file = / usr / share / OVMF / OVMF_CODE.fd \ <br>  -drive file = 'w10.iso', if = ide, format = raw, index = 2, media = cdrom, cache = none \ <br>  -drive file = 'virtio-win-0.1.141_st.iso', if = ide, format = raw, index = 3, media = cdrom, cache = none \ <br>  -drive file = 'guest.img', if = ide, format = raw, index = 4, media = disk, cache = writeback \ <br>  -vga qxl \ <br>  -spice port = 5900, addr = 127.0.0.1, disable-ticketing \ <br>  -monitor stdio \ <br>  -netdev user, id = n1, ipv6 = off, smb = "/ media / user / data" \ <br>  -device e1000, netdev = n1, mac = 67: 77: 78: 88: 89: 99 \ <br>  "$ @" <br></blockquote></div></div><br><h3>  5. We forward the video card to the guest OS </h3><br>  To begin, boot with two video cards.  We look that the forbidden card appeared in the system, put drivers on it and make sure that they have earned. <br><br><div class="spoiler">  <b class="spoiler_title">vga_qxl_pass.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  remote-viewer spice: //127.0.0.1: 5900 &amp; <br>  sudo qemu-system-x86_64 \ <br>  -machine q35, accel = kvm \ <br>  -enable-kvm \ <br>  -cpu host, kvm = off, check \ <br>  -smp cpus = 2, sockets = 1, cores = 2, threads = 1 \ <br>  -m 6G \ <br>  -rtc base = localtime, clock = host \ <br>  -device piix3-usb-uhci \ <br>  -device usb-tablet \ <br>  -drive if = pflash, format = raw, readonly, file = / usr / share / OVMF / OVMF_CODE.fd \ <br>  -drive file = 'virtio-win-0.1.141_st.iso', if = ide, format = raw, index = 3, media = cdrom, cache = none \ <br>  -drive file = 'guest.img', if = ide, format = raw, index = 4, media = disk, cache = writeback \ <br>  -vga qxl \ <br>  -spice port = 5900, addr = 127.0.0.1, disable-ticketing \ <br>  <b>-device ioh3420, bus = pcie.0, addr = 1c.0, multifunction = on, port = 1, chassis = 1, id = root \</b> <b><br></b>  <b>-device vfio-pci, host = 04: 00.0, bus = root, addr = 00.0, multifunction = on \</b> <b><br></b>  <b>-device vfio-pci, host = 04: 00.1, bus = root, addr = 00.1 \</b> <br>  -monitor stdio \ <br>  -netdev user, id = n1, ipv6 = off, smb = "/ media / user / data" \ <br>  -device e1000, netdev = n1, mac = 67: 77: 78: 88: 89: 99 \ <br>  "$ @" <br></blockquote></div></div><br>  After that, as the forwarded video card has earned, and in the device manager it says ‚ÄúThe device is working properly‚Äù, we start the virtual machine only with the forwarded video card. <br><br><div class="spoiler">  <b class="spoiler_title">vga_pass.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  sudo qemu-system-x86_64 \ <br>  -machine q35, accel = kvm \ <br>  -enable-kvm \ <br>  -cpu host, kvm = off, check \ <br>  -smp cpus = 2, sockets = 1, cores = 2, threads = 1 \ <br>  -m 6G \ <br>  -rtc base = localtime, clock = host \ <br>  -device piix3-usb-uhci \ <br>  -device usb-tablet \ <br>  -drive if = pflash, format = raw, readonly, file = / usr / share / OVMF / OVMF_CODE.fd \ <br>  -drive file = 'virtio-win-0.1.141_st.iso', if = ide, format = raw, index = 3, media = cdrom, cache = none \ <br>  -drive file = 'guest.img', if = ide, format = raw, index = 4, media = disk, cache = writeback \ <br>  -vga <b>none</b> \ <br>  -device ioh3420, bus = pcie.0, addr = 1c.0, multifunction = on, port = 1, chassis = 1, id = root \ <br>  -device vfio-pci, host = 04: 00.0, bus = root, addr = 00.0, multifunction = on \ <br>  -device vfio-pci, host = 04: 00.1, bus = root, addr = 00.1 \ <br>  -monitor stdio \ <br>  -netdev user, id = n1, ipv6 = off, smb = "/ media / user / data" \ <br>  -device e1000, netdev = n1, mac = 67: 77: 78: 88: 89: 99 \ <br>  "$ @" <br></blockquote></div></div><br>  We connect the monitor to it and admire the desktop image of the guest OS. <br><br><h1>  The place where simple solutions end </h1><br>  And here begins the most interesting.  For someone, everything is fine, the picture went and then everything is simple.  My experience stumbled twice in the absence of an image.  The first time was the probros of the integrated Intel 6700T HD 530 processor, the video outputs were empty and the failure was attributed to the fact that the inlays didn‚Äôt fit well.  The second time, the external Nvidia GF210 was being forwarded, which was already specially purchased for experiments.  The result was even more interesting.  In non EFI mode, the video card was successfully forwarded and even showed a picture, but shutting down the guest OS <abbr title="about 50 to 50">misfired</abbr> . <br><br>  Subsequent probros could just hang the host.  A couple of hours of light googling leads to the fact that the problem of video card hangup is quite common.  This results in both an incorrect shutdown of a virtual machine, and with some chance even a correct shutdown.  As an exit, it is recommended to forward in EFI mode.  But VBIOS Nvidia GF210 does not support EFI ... <br><br><h3>  Sew or not sew, that is the question </h3><br>  Do not sew.  QEMU supports substitution of VBIOS when forwarding a video card.  But VBIOS still have to learn how to support EFI mode.  Usually, it is recommended to check before starting a video card, for example, here <a href="https://habr.com/ru/post/433878/">[2]</a> .  But we have to deal with what we have, and we did not want to look for a fresh video card with EFI support.  So you need to patch VBIOS.  <u>All operations performed with VBIOS are done at your own risk.</u>  I used the software package and instructions for it from here <a href="https://habr.com/ru/post/433878/">[3]</a> .  After reading the VBIOS, we get the file <code>gt210.rom</code> , patch and at the output we have <code>gt210_uefi.rom</code> .  This is what you need to slip the video card when booting the virtual machine. <br><br><div class="spoiler">  <b class="spoiler_title">vga_pass_rom.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  sudo qemu-system-x86_64 \ <br>  -machine q35, accel = kvm \ <br>  -enable-kvm \ <br>  -cpu host, kvm = off, check \ <br>  -smp cpus = 2, sockets = 1, cores = 2, threads = 1 \ <br>  -m 6G \ <br>  -rtc base = localtime, clock = host \ <br>  -device piix3-usb-uhci \ <br>  -device usb-tablet \ <br>  -drive if = pflash, format = raw, readonly, file = / usr / share / OVMF / OVMF_CODE.fd \ <br>  -drive file = 'virtio-win-0.1.141_st.iso', if = ide, format = raw, index = 3, media = cdrom, cache = none \ <br>  -drive file = 'guest.img', if = ide, format = raw, index = 4, media = disk, cache = writeback \ <br>  -vga none \ <br>  -device ioh3420, bus = pcie.0, addr = 1c.0, multifunction = on, port = 1, chassis = 1, id = root \ <br>  -device vfio-pci, host = 04: 00.0, bus = root, addr = 00.0, multifunction = on, <b>romfile = gt210_uefi.rom</b> \ <br>  -device vfio-pci, host = 04: 00.1, bus = root, addr = 00.1 \ <br>  -monitor stdio \ <br>  -netdev user, id = n1, ipv6 = off, smb = "/ media / user / data" \ <br>  -device e1000, netdev = n1, mac = 67: 77: 78: 88: 89: 99 \ <br>  "$ @" <br></blockquote></div></div><br>  We start the virtual machine and look. <br><br><h3>  Darkness </h3><br>  The outputs of the video card shone with darkness.  Once again, morality was tested by failure.  The first thing that comes to mind is that the guest OS crashes at the start.  Logs, I need her logs.  To do this, run <code>vga_qxl.sh</code> .  We look at the previous launch.  And there everything is fine, except that the food dramatically pulled.  It turns out that it works, although it does not work.  The first idea was to connect via RDP and see what was happening there, but still it is better to use VNC for this, for example tightvnc <a href="https://habr.com/ru/post/433878/">[4]</a> .  Install VNC, configure port <code>5600</code> and push this port for access from the host. <br><br><div class="spoiler">  <b class="spoiler_title">vga_vnc_pass_rom.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  sudo qemu-system-x86_64 \ <br>  -machine q35, accel = kvm \ <br>  -enable-kvm \ <br>  -cpu host, kvm = off, check \ <br>  -smp cpus = 2, sockets = 1, cores = 2, threads = 1 \ <br>  -m 6G \ <br>  -rtc base = localtime, clock = host \ <br>  -device piix3-usb-uhci \ <br>  -device usb-tablet \ <br>  -drive if = pflash, format = raw, readonly, file = / usr / share / OVMF / OVMF_CODE.fd \ <br>  -drive file = 'virtio-win-0.1.141_st.iso', if = ide, format = raw, index = 3, media = cdrom, cache = none \ <br>  -drive file = 'guest.img', if = ide, format = raw, index = 4, media = disk, cache = writeback \ <br>  -vga none \ <br>  -device ioh3420, bus = pcie.0, addr = 1c.0, multifunction = on, port = 1, chassis = 1, id = root \ <br>  -device vfio-pci, host = 04: 00.0, bus = root, addr = 00.0, multifunction = on, romfile = gt210_uefi.rom \ <br>  -device vfio-pci, host = 04: 00.1, bus = root, addr = 00.1 \ <br>  -monitor stdio \ <br>  -netdev user, id = n1, <b>hostfwd = tcp: 127.0.0.1: 5600-: 5600,</b> ipv6 = off, smb = "/ media / user / data" \ <br>  -device e1000, netdev = n1, mac = 67: 77: 78: 88: 89: 99 \ <br>  "$ @" <br></blockquote></div></div><br>  Connect and see the working machine, only the monitor has a strange Generic Non-PnP Monitor (Universal Monitor is not PnP).  There is a picture, so you can try to run Looking Glass. <br><br><h3>  Looking glass </h3><br>  Although this technology uses OpenGL, no space is needed after gl.  But read the instructions <a href="https://habr.com/ru/post/433878/">[5]</a> on the project site is a must.  For the guest OS download the screen capture application <b>looking-glass-host.exe</b> <a href="https://habr.com/ru/post/433878/">[6]</a> , download and install Microsoft Visual C ++ 2015 Redistributable <a href="https://habr.com/ru/post/433878/">[7]</a> , download the driver for the IVSHMEM device <a href="https://habr.com/ru/post/433878/">[8]</a> .  For the host set dependencies, download and build the client application. <br><br><div class="spoiler">  <b class="spoiler_title">build_looking_glass_a12.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  sudo apt-get install cmake libsdl2-dev libsdl2-ttf-dev nettle-dev libspice-protocol-dev libfontconfig1-dev libx11-dev fonts-freefont-ttf libconfig-dev <br>  wget <a href="">github.com/gnif/LookingGlass/archive/a12.tar.gz</a> <br>  tar -xf a12.tar.gz <br>  cd lookingglass-a12 <br>  mkdir client / build <br>  cd client / build <br>  cmake ../ <br>  make <br></blockquote></div></div><br>  We start the virtual machine with an IVSHMEM device.  32Mb memory size is selected for 1920x1080 resolution. <br><br><div class="spoiler">  <b class="spoiler_title">vga_vnc_lg_pass_rom.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  <b>if [!</b>  <b>-f / dev / shm / looking-glass];</b>  <b>then</b> <b><br></b>  <b>touch / dev / shm / looking-glass</b> <b><br></b>  <b>chown `whoami`: kvm / dev / shm / looking-glass</b> <b><br></b>  <b>chmod 660 / dev / shm / looking-glass</b> <b><br></b>  <b>fi</b> <br>  sudo qemu-system-x86_64 \ <br>  -machine q35, accel = kvm \ <br>  -enable-kvm \ <br>  -cpu host, kvm = off, check \ <br>  -smp cpus = 2, sockets = 1, cores = 2, threads = 1 \ <br>  -m 6G \ <br>  -rtc base = localtime, clock = host \ <br>  -device piix3-usb-uhci \ <br>  -device usb-tablet \ <br>  -drive if = pflash, format = raw, readonly, file = / usr / share / OVMF / OVMF_CODE.fd \ <br>  -drive file = 'virtio-win-0.1.141_st.iso', if = ide, format = raw, index = 3, media = cdrom, cache = none \ <br>  -drive file = 'guest.img', if = ide, format = raw, index = 4, media = disk, cache = writeback \ <br>  -vga none \ <br>  -device ioh3420, bus = pcie.0, addr = 1c.0, multifunction = on, port = 1, chassis = 1, id = root \ <br>  -device vfio-pci, host = 04: 00.0, bus = root, addr = 00.0, multifunction = on, romfile = gt210_uefi.rom \ <br>  -device vfio-pci, host = 04: 00.1, bus = root, addr = 00.1 \ <br>  <b>-device ivshmem-plain, memdev = ivshmem, bus = pcie.0 \</b> <b><br></b>  <b>-object memory-backend-file, id = ivshmem, share = on, mem-path = / dev / shm / looking-glass, size = 32M \</b> <br>  -monitor stdio \ <br>  -netdev user, id = n1, hostfwd = tcp: 127.0.0.1: 5600-: 5600, ipv6 = off, smb = "/ media / user / data" \ <br>  -device e1000, netdev = n1, mac = 67: 77: 78: 88: 89: 99 \ <br>  "$ @" <br></blockquote></div></div><br>  We connect via VNC, install the driver on the IVSHMEM device, it is possible that a standard driver will be supplied to it, located in ‚ÄúSystem devices‚Äù.  We start <b>looking-glass-host.exe</b> .  On the host, run <code>./LookingGlass-a12/client/build/looking-glass-client</code> . <br><br>  This is where the NVidia GF210 system worked, and then the Intel HD530 was launched on the same route.  With the screen resolution there was a small problem, for changing to a rare resolution, for example 2048x1152, I had to use the Custom Resolution Utility <a href="https://habr.com/ru/post/433878/">[9]</a> . <br><br>  Another caveat, when adding a <b>looking-glass-host.exe application</b> to autoload, you need to configure the user to automatically log in, for security reasons the guest OS does not allow to capture the login screen. <br><br><h1>  Afterword </h1><br>  If you do not set the task of obtaining images on the physical video output, then this result will be enough to get a working virtual machine with a physical video card and responsive management.  Control is exercised from the host in a separate window or in full screen.  However, there are nuances. <br><br>  <b>Performance</b> .  Overhead resources for virtualization and not the most agile guest OS will not allow you to comfortably work on weak and medium-weak hardware.  You need a powerful processor of at least 6-8 cores, a good graphics card for the guest OS, 16GB + RAM, at least 8GB for each OS.  And dancing with a tambourine to squeeze the maximum out of iron. <br>  <b>Patience</b> .  If it does not work right away, then you will have to spend your time and energy decently.  Search, read, try.  Search again, read and try again.  Leave a few more links that I came across, maybe there will be some more useful information.  <a href="https://habr.com/ru/post/433878/">[10]</a> <a href="https://habr.com/ru/post/433878/">[11]</a> <a href="https://habr.com/ru/post/433878/">[12]</a> <br><br>  <b>Links</b> <br><br>  Caution, links open in this window. <br><br><a name="L0"></a>  <a href="https://wiki.archlinux.org/index.php/PCI_passthrough_via_OVMF">0. https://wiki.archlinux.org/index.php/PCI_passthrough_via_OVMF</a> <br><a name="L1"></a>  <a href="https://en.wikipedia.org/wiki/List_of_IOMMU-supporting_hardware">1. https://en.wikipedia.org/wiki/List_of_IOMMU-supporting_hardware</a> <br><a name="L2"></a>  <a href="https://www.techpowerup.com/vgabios/">2. https://www.techpowerup.com/vgabios/</a> <br><a name="L3"></a>  <a href="https://www.win-raid.com/t892f16-AMD-and-Nvidia-GOP-update-No-requests-DIY.html">3. https://www.win-raid.com/t892f16-AMD-and-Nvidia-GOP-update-No-requests-DIY.html</a> <br><a name="L4"></a>  <a href="https://www.tightvnc.com/download.php">4. https://www.tightvnc.com/download.php</a> <br><a name="L5"></a>  <a href="https://looking-glass.hostfission.com/quickstart">5. https://looking-glass.hostfission.com/quickstart</a> <br><a name="L6"></a>  <a href="https://github.com/gnif/LookingGlass/releases">6. https://github.com/gnif/LookingGlass/releases</a> <br><a name="L7"></a>  <a href="https://www.microsoft.com/en-us/download/details.aspx%3Fid%3D48145">7. https://www.microsoft.com/en-us/download/details.aspx?id=48145</a> <br><a name="L8"></a>  <a href="https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/upstream-virtio/">8. https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/upstream-virtio/</a> <br><a name="L9"></a>  <a href="https://www.monitortests.com/forum/Thread-Custom-Resolution-Utility-CRU">9. https://www.monitortests.com/forum/Thread-Custom-Resolution-Utility-CRU</a> <br><a name="L10"></a>  <a href="https://heiko-sieger.info/running-windows-10-on-linux-using-kvm-with-vga-passthrough">10. https://heiko-sieger.info/running-windows-10-on-linux-using-kvm-with-vga-passthrough</a> <br><a name="L11"></a>  <a href="https://ycnrg.org/vga-passthrough-with-ovmf-vfio/">11. https://ycnrg.org/vga-passthrough-with-ovmf-vfio/</a> <br><a name="L12"></a>  <a href="https://www.reddit.com/r/VFIO/comments/8h352p/guide_running_windows_via_qemukvm_and_intel_gvtg/">12. https://www.reddit.com/r/VFIO/comments/8h352p/guide_running_windows_via_qemukvm_and_intel_gvtg/</a> </div><p>Source: <a href="https://habr.com/ru/post/433878/">https://habr.com/ru/post/433878/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../433868/index.html">Why the Alphabet glucose meter didn't take off</a></li>
<li><a href="../433870/index.html">Why is it so difficult to continuously measure glucose levels?</a></li>
<li><a href="../433872/index.html">Mobile access - using a smartphone in access control systems</a></li>
<li><a href="../433874/index.html">Experiments with Neural Interfaces in JavaScript</a></li>
<li><a href="../433876/index.html">Three-dimensional presentation of products on Three.js for the smallest</a></li>
<li><a href="../433880/index.html">Life hacks for developers: efficient use of SQ (Source Qualifier) ‚Äã‚Äãin the Informatica Power Center</a></li>
<li><a href="../433884/index.html">Legal aspects of video surveillance: how to avoid problems with the law</a></li>
<li><a href="../433886/index.html">Python machine learning with interactive Jupyter demos</a></li>
<li><a href="../433888/index.html">Application of lithium-ion batteries in single-phase UPS</a></li>
<li><a href="../433892/index.html">FSTEC vs NIST: leakage protection in Russian and American style</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>