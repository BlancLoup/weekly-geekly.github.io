<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Handling Segmentation Fault in C ++</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introductory 
 C ++ is an ‚Äúunmanaged‚Äù language, so programs can crash ‚Äî crash without saving user data, error messages, etc. - it is only necessary, f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Handling Segmentation Fault in C ++</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introductory </h4><br>  C ++ is an ‚Äúunmanaged‚Äù language, so programs can crash ‚Äî crash without saving user data, error messages, etc.  - it is only necessary, for example, to get into an uninitialized memory.  For example: <br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> * s = <span class="hljs-string"><span class="hljs-string">"short_text"</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>(s,<span class="hljs-string"><span class="hljs-string">"This is very long text"</span></span>); }</code> </pre> <br>  or <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> * pointer = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; *pointer = <span class="hljs-number"><span class="hljs-number">13</span></span>; }</code> </pre><br><br>  It would be better for everyone if we could ‚Äúcatch‚Äù the crash of the program - just like in java we catch exceptions - and perform at least something before the program crashes (save the user's document, display a dialog with an error message and t .P.) <br><br>  There is no general solution to the problem, since C ++ does not have its own model for handling exceptions related to working with memory.  Nevertheless, we will consider two methods that use the features of the operating system that caused the exception. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br><h4>  Method 1: SEH </h4><br>  If you use Windows OS as a target OS and Visual C ++ as a compiler, then you can use <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms680657%2528v%3Dvs.85%2529.aspx">Structured Exception Handling</a> - an extension of the C ++ language from Microsoft, which allows you to catch any exceptions occurring in the program. <br><br>  The general syntax for exception handling is as follows: <br><br><pre> <code class="cpp hljs">__try { segfault1(); } __except( condition1 ) { <span class="hljs-comment"><span class="hljs-comment">//  ,  condition1 == EXCEPTION_EXECUTE_HANDLER. //  condition1  ()   ,  //  ,   EXCEPTION_EXECUTE_HANDLER //     ,     } __except( condition2 ) { //    } __finally { // ,          }</span></span></code> </pre><br><br>  Here is a ‚Äúworking example‚Äù - ‚Äúcopy and paste into Visual Studio‚Äù <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;windows.h&gt; #include &lt;excpt.h&gt; int memento() //  Segfault { MessageBoxA(NULL,"Memento Mori","Exception catched!",NULL); return 0; } void fall() //  segfault { int* p = 0x00000000; *p = 13; } int main(int argc, char *argv[]) { __try { fall(); } __except (EXCEPTION_EXECUTE_HANDLER) { memento(); } }</span></span></span></span></code> </pre><br><br>  I personally could not get to earn __finally (that's why I wrote __except with verification code, which always works), but this is probably the curvature of my hands. <br><br>  This technique, for all its attractiveness, has a number of disadvantages: <br><br><ul><li>  <b>One compiler.</b>  <b>One OS.</b>  <b>Not "pure C ++."</b>  If you want to work without MS - you can not use this technique </li><li>  <b>One thread - one table</b> .  If you write a construction from __try ... __except, inside __try, start another thread and, without leaving the __try, the second thread will call segfault, then ... nothing will happen, the program will fall ‚Äúas usual‚Äù.  Because you need to write a separate SEH handler for each thread. </li></ul><br><br>  There were so many minuses that you have to look for a second solution. <br><br><h4>  Method 2: POSIX Signals </h4><br><br>  The method is designed for the fact that at the time of the crash the program receives a POSIX SIGSEGV message.  This is <i>certainly true</i> in all UNIX systems, but this is <i>in fact the case</i> (although no one guaranteed, windows is not posix-compatible) in windows too. <br><br>  The technique is simple - we have to write a SIGSEGV message handler, in which the program will perform ‚Äúfarewell actions‚Äù and, finally, will fall: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">posix_death_signal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> signum)</span></span></span><span class="hljs-function"> </span></span>{ memento(); <span class="hljs-comment"><span class="hljs-comment">//   signal(signum, SIG_DFL); //   exit(3); //  .    ,     . }</span></span></code> </pre><br>  after which we must register this handler: <br><pre> <code class="cpp hljs">signal(SIGSEGV, posix_death_signal);</code> </pre><br><br>  Here is a finished example: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdio.h&gt; #include &lt;windows.h&gt; #include &lt;stdlib.h&gt; #include &lt;signal.h&gt; int memento() { int a=0; MessageBoxA(NULL,"Memento mori","POSIX Signal",NULL); return 0; } void fall() { int* p = 0x00000000; *p = 13; } void posix_death_signal(int signum) { memento(); signal(signum, SIG_DFL); exit(3); } int main(int argc, char *argv[]) { signal(SIGSEGV, posix_death_signal); fall(); }</span></span></span></span></code> </pre><br><br>  Unlike SEH, it always works: the solution is ‚Äúmulti-threaded‚Äù (you can drop the program in any thread, the handler will run anyway) and ‚Äúcross-platform‚Äù - it works under any compiler, and under any POSIX-compatible OS. </div><p>Source: <a href="https://habr.com/ru/post/131412/">https://habr.com/ru/post/131412/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../131404/index.html">HabraReader - client for reading Habra on WP7</a></li>
<li><a href="../131406/index.html">Xync: New Mobile Client for Micosoft UC</a></li>
<li><a href="../131409/index.html">HP is going to stay in the tablet business</a></li>
<li><a href="../131410/index.html">Authentication via PAM in MySQL</a></li>
<li><a href="../131411/index.html">7app chart # 4</a></li>
<li><a href="../131413/index.html">American vs. British</a></li>
<li><a href="../131414/index.html">BDSM style development management</a></li>
<li><a href="../131415/index.html">Tablets: why media albums are needed</a></li>
<li><a href="../131416/index.html">Animation and Particle System in Blender</a></li>
<li><a href="../131417/index.html">Samsung plans to launch flexible display phones in 2012</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>