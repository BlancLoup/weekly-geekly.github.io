<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>WPF and Box2D. How I did physics with WPF</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good time Habr. I'm a big fan of physics in games, I worked with some interesting physics engines, but today I‚Äôll tell you about Box2D. It is as simpl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>WPF and Box2D. How I did physics with WPF</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/ea4/f63/e14/ea4f63e1480eddd79b7655216994878c.jpg" alt="image"><br><br>  Good time Habr.  I'm a big fan of physics in games, I worked with some interesting physics engines, but today I‚Äôll tell you about Box2D.  It is as simple and straightforward as possible and is perfect for two-dimensional physics.  I noticed that there are very few Box2D tutorials on C # on the Internet, there are almost none.  I have been repeatedly asked to write an article about this.  Well, the time has come.  There will be a lot of code, letters and some comments.  To render the graphics, use WPF and the Viewport3D element.  Who cares, welcome tackle. <br><a name="habracut"></a><br>  <a href="https://ru.wikipedia.org/wiki/Box2D">Box2D</a> is a computer program, free open physics engine.  Box2D is a real-time physics engine and is designed to work with two-dimensional physical objects.  The engine is designed by Erin Catto (born Erin Catto), written in the C ++ programming language and distributed under the license zlib. <br><br>  The engine is used in two-dimensional computer games, including Angry Birds, Limbo, Crayon Physics Deluxe, Rolando, Fantastic Contraption, Incredibots, Transformice, Happy Wheels, Color Infection, Shovel Knight, King of Thieves. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      You can download the link <a href="https://vk.com/doc-71023327_447804791">Box2D.dll</a> <br><br><h3>  WPF and Viewport3D </h3><br>  For drawing the world, I decided for some reason to take WPF, of course you can draw on anything, even on the usual Grphics and PictureBox, but this is not desirable because  Graphics displays graphics through the CPU and will take a lot of CPU time. <br><br>  Let's write a small environment for working with graphics.  In the default project window, add the following XAML: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Viewport3D</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"viewport"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ClipToBounds</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"True"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Viewport3D.Camera</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PerspectiveCamera</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">FarPlaneDistance</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1000"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">NearPlaneDistance</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Position</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0, 0, 10"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">LookDirection</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0, 0, -1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">UpDirection</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0, 1, 0"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Viewport3D.Camera</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ModelVisual3D</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ModelVisual3D.Content</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Model3DGroup</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"models"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">AmbientLight</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#333"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DirectionalLight</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#FFF"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Direction</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"-1, -1, -1"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DirectionalLight</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#FFF"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Direction</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1, -1, -1"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Model3DGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ModelVisual3D.Content</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ModelVisual3D</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Viewport3D</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></div></div><br>  ClipToBounds - says that invisible faces will be cut off, although here it is not useful because  there will be a 2D projection, I will turn it on anyway. <br><br>  After the perspective camera is installed.  FarPlaneDistance - the maximum distance that the camera captures, NearPlaneDistance - the minimum distance, and then the position where the camera is looking and how it looks.  Next we create the Model3DGroup element in which we will throw the geometry through its name ‚Äúmodels‚Äù, and add 3 lights to it. <br><br>  Well, with XAML figured out, now you can start writing a class to create geometry: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyModel3D</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3D Position { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//   public Size Size { get; set; } //   private TranslateTransform3D translateTransform; //   private RotateTransform3D rotationTransform; //   public MyModel3D(Model3DGroup models, double x, double y, double z, string path, Size size, float axis_x = 0, double angle = 0, float axis_y = 0, float axis_z = 1) { this.Size = size; this.Position = new Vector3D(x, y, z); MeshGeometry3D mesh = new MeshGeometry3D(); //    mesh.Positions = new Point3DCollection(new List&lt;Point3D&gt; { new Point3D(-size.Width/2, -size.Height/2, 0), new Point3D(size.Width/2, -size.Height/2, 0), new Point3D(size.Width/2, size.Height/2, 0), new Point3D(-size.Width/2, size.Height/2, 0) }); //     mesh.TriangleIndices = new Int32Collection(new List&lt;int&gt; { 0, 1, 2, 0, 2, 3 }); mesh.TextureCoordinates = new PointCollection(); //         mesh.TextureCoordinates.Add(new Point(0, 1)); mesh.TextureCoordinates.Add(new Point(1, 1)); mesh.TextureCoordinates.Add(new Point(1, 0)); mesh.TextureCoordinates.Add(new Point(0, 0)); //   ImageBrush brush = new ImageBrush(new BitmapImage(new Uri(path))); Material material = new DiffuseMaterial(brush); GeometryModel3D geometryModel = new GeometryModel3D(mesh, material); models.Children.Add(geometryModel); translateTransform = new TranslateTransform3D(x, y, z); rotationTransform = new RotateTransform3D(new AxisAngleRotation3D(new Vector3D(axis_x, axis_y, axis_z), angle), 0.5, 0.5, 0.5); Transform3DGroup tgroup = new Transform3DGroup(); tgroup.Children.Add(translateTransform); tgroup.Children.Add(rotationTransform); geometryModel.Transform = tgroup; } //    public void SetPosition(Vector3D v3) { translateTransform.OffsetX = v3.X; translateTransform.OffsetY = v3.Y; translateTransform.OffsetZ = v3.Z; } public Vector3D GetPosition() { return new Vector3D(translateTransform.OffsetX, translateTransform.OffsetY, translateTransform.OffsetZ); } //   public void Rotation(Vector3D axis, double angle, double centerX = 0.5, double centerY = 0.5, double centerZ = 0.5) { rotationTransform.CenterX = translateTransform.OffsetX; rotationTransform.CenterY = translateTransform.OffsetY; rotationTransform.CenterZ = translateTransform.OffsetZ; rotationTransform.Rotation = new AxisAngleRotation3D(axis, angle); } public Size GetSize() { return Size; } }</span></span></code> </pre><br></div></div><br>  This class creates a square and draws a texture on it.  I think the names of the methods understand what method is responsible for what.  To draw geometric shapes, I will use a texture and lay it on a square with an alpha channel. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bce/6e5/666/bce6e5666349cc0b326dc1cd39d1b972.jpg" alt="image" width="100" height="100"><img src="https://habrastorage.org/getpro/habr/post_images/041/86c/7f4/04186c7f49143c820bb789df157b394b.jpg" alt="image" width="100" height="100"><br><br><h3>  Box2D - Hello world </h3><br>  Let's start with the most basic, with the creation of the world.  The world in Box2D has certain parameters, these are borders (square) in which physical bodies are processed. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a67/f1d/0ee/a67f1d0ee8217b3d86f836b7f83dc591.jpg" alt="image"><br><br>  In the parameters of the world, there is also a gravity vector and the ability of objects to ‚Äúfall asleep‚Äù if their inertia is zero, this is well suited for saving processor resources.  Of course there are more porametrov, but so far we only need these.  Create the Physics class and add the following constructor: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Physics</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> World world; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Physics</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> w, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> h, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> g_x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> g_y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> doSleep</span></span></span><span class="hljs-function">)</span></span> { AABB aabb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AABB(); aabb.LowerBound.Set(x, y); <span class="hljs-comment"><span class="hljs-comment">//       aabb.UpperBound.Set(w, h); //       Vec2 g = new Vec2(g_x, g_y); //    world = new World(aabb, g, doSleep); //   } }</span></span></code> </pre><br></div></div><br>  Next, you need to write methods to add different physical bodies, I will add 3 methods creating a circle and a square and a polygon.  Immediately add two constants to the Physics class: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> PATH_CIRCLE = <span class="hljs-string"><span class="hljs-string">@"Assets\circle.png"</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   private const string PATH_RECT = @"Assets\rect.png"; //  </span></span></code> </pre><br>  I describe a method for creating a square body: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> MyModel3D </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddBox</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> w, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> h, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> density, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> friction, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> restetution</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//     MyModel3D model = new MyModel3D(models, x, -y, 0, PATH_RECT, new System.Windows.Size(w, h)); //    , ,    ..      BodyDef bDef = new BodyDef(); bDef.Position.Set(x, y); bDef.Angle = 0; //      PolygonDef pDef = new PolygonDef(); pDef.Restitution = restetution; pDef.Friction = friction; pDef.Density = density; pDef.SetAsBox(w / 2, h / 2); //    Body body = world.CreateBody(bDef); body.CreateShape(pDef); body.SetMassFromShapes(); body.SetUserData(model); //   ,       object,              ,    step     return model; }</span></span></code> </pre><br></div></div><br>  And to create a round body: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> MyModel3D </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddCircle</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> radius, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> angle, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> density, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> friction, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> restetution</span></span></span><span class="hljs-function">)</span></span> { MyModel3D model = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyModel3D(models, x, -y, <span class="hljs-number"><span class="hljs-number">0</span></span>, PATH_CIRCLE, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System.Windows.Size(radius * <span class="hljs-number"><span class="hljs-number">2</span></span>, radius * <span class="hljs-number"><span class="hljs-number">2</span></span>)); BodyDef bDef = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BodyDef(); bDef.Position.Set(x, y); bDef.Angle = angle; CircleDef pDef = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CircleDef(); pDef.Restitution = restetution; pDef.Friction = friction; pDef.Density = density; pDef.Radius = radius; Body body = world.CreateBody(bDef); body.CreateShape(pDef); body.SetMassFromShapes(); body.SetUserData(model); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> model; }</code> </pre><br></div></div><br>  I will not do this here, but you can create polygons in a similar way: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> MyModel3D </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddVert</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, Vec2[] vert, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> angle, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> density, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> friction, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> restetution</span></span></span><span class="hljs-function">)</span></span> { MyModel3D model = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyModel3D(models, x, y, <span class="hljs-number"><span class="hljs-number">0</span></span>, Environment.CurrentDirectory + <span class="hljs-string"><span class="hljs-string">"\\"</span></span> + PATH_RECT, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System.Windows.Size(w, h)); <span class="hljs-comment"><span class="hljs-comment">//        BodyDef bDef = new BodyDef(); bDef.Position.Set(x, y); bDef.Angle = angle; PolygonDef pDef = new PolygonDef(); pDef.Restitution = restetution; pDef.Friction = friction; pDef.Density = density; pDef.SetAsBox(model.Size.Width / 2, model.Size.Height / 2); pDef.Vertices = vert; Body body = world.CreateBody(bDef); body.CreateShape(pDef); body.SetMassFromShapes(); body.SetUserData(model); return info; }</span></span></code> </pre><br></div></div><br>  It is very important to draw convex polygons so that collisions are processed correctly. <br><br>  It's all simple enough if you know English.  Next you need to create a method for processing logic: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Step</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dt, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> iterat</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//            world.Step(dt / 1000.0f, iterat, iterat); for (Body list = world.GetBodyList(); list != null; list = list.GetNext()) { if (list.GetUserData() != null) { System.Windows.Media.Media3D.Vector3D position = new System.Windows.Media.Media3D.Vector3D( list.GetPosition().X, list.GetPosition().Y, 0); float angle = list.GetAngle() * 180.0f / (float)System.Math.PI; //       MyModel3D model = (MyModel3D)list.GetUserData(); model.SetPosition(position); //      x,y model.Rotation(new System.Windows.Media.Media3D.Vector3D(0, 0, 1), angle); //    x } } }</span></span></code> </pre><br></div></div><br>  Remember that model in the <i>AddCircle</i> and <i>AddBox methods</i> that we <i>crammed</i> into <i>body.SetUserDate ()</i> ?  So, here we get it MyModel3D <i>model = (MyModel3D) list.GetUserData ();</i>  and we are turning as Box2D tells us. <br><br>  Now all this can be done, here is my code in the default window class: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MainWindow</span></span> : <span class="hljs-title"><span class="hljs-title">Window</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Game.Physics px; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainWindow</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeComponent(); px = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Game.Physics(<span class="hljs-number"><span class="hljs-number">-1000</span></span>, <span class="hljs-number"><span class="hljs-number">-1000</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-0.005f</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); px.SetModelsGroup(models); px.AddBox(<span class="hljs-number"><span class="hljs-number">0.6f</span></span>, <span class="hljs-number"><span class="hljs-number">-2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0.3f</span></span>, <span class="hljs-number"><span class="hljs-number">0.2f</span></span>); px.AddBox(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>, <span class="hljs-number"><span class="hljs-number">0.3f</span></span>, <span class="hljs-number"><span class="hljs-number">0.2f</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.LayoutUpdated += MainWindow_LayoutUpdated; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainWindow_LayoutUpdated</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, EventArgs e</span></span></span><span class="hljs-function">)</span></span> { px.Step(<span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>); <span class="hljs-comment"><span class="hljs-comment">//       ,   :) this.InvalidateArrange(); } }</span></span></code> </pre><br></div></div><br><img src="https://habrastorage.org/getpro/habr/post_images/9ca/b7b/bb2/9cab7bbb27884a20da9ef9c7f693f0b1.jpg" alt="image"><br><br>  Yes, I forgot to mention that I added the px.SetModelsGroup () method to the Physics class;  for the convenience of passing the reference to the Model3DGroup object.  If you use any other graphics engine, then you can do without it. <br><br>  You probably noticed that the coordinates of the cubes are too small, because we are used to working with a pixel.  This is due to the fact that in Box2D all metrics are calculated in meters, so if you want everything to be calculated in pixels, you need to divide the pixels by 30. For example, bDef.SetPosition (x / 30.0f, y / 30.0f);  and everything will be good. <br><br>  Already with this knowledge, you can successfully write a simple game, but Box2D has a few more chips, for example, tracking of columns.  For example, to know that the bullet hit the character, or to simulate a different ground, etc.  Create a Solver class: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Solver</span></span> : <span class="hljs-title"><span class="hljs-title">ContactListener</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">delegate</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EventSolver</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MyModel3D body1, MyModel3D body2</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> EventSolver OnAdd; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> EventSolver OnPersist; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> EventSolver OnResult; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> EventSolver OnRemove; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ContactPoint point</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Add(point); OnAdd?.Invoke((MyModel3D)point.Shape1.GetBody().GetUserData(), (MyModel3D)point.Shape2.GetBody().GetUserData()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Persist</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ContactPoint point</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Persist(point); OnPersist?.Invoke((MyModel3D)point.Shape1.GetBody().GetUserData(), (MyModel3D)point.Shape2.GetBody().GetUserData()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Result</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ContactResult point</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Result(point); OnResult?.Invoke((MyModel3D)point.Shape1.GetBody().GetUserData(), (MyModel3D)point.Shape2.GetBody().GetUserData()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Remove</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ContactPoint point</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Remove(point); OnRemove?.Invoke((MyModel3D)point.Shape1.GetBody().GetUserData(), (MyModel3D)point.Shape2.GetBody().GetUserData()); } }</code> </pre><br></div></div><br>  Please note that we inherit a class from ContactListener.  Used in Box2D to track collisions.  Then we simply pass the object of this class to the world object in the Physics class, for this we write the function: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetSolver</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ContactListener listener</span></span></span><span class="hljs-function">)</span></span> { world.SetContactListener(listener); }</code> </pre><br>  Create an object and pass it: <br><br><pre> <code class="cs hljs">Game.Solver solver = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Game.Solver(); px.SetSolver(solver);</code> </pre><br>  In the Solver class there are several callbacks that are called in turn in accordance with the names, hang one to audition: <br><br><pre> <code class="cs hljs">solver.OnAdd += (model1, model2) =&gt; { <span class="hljs-comment"><span class="hljs-comment">//    model1  model2 };</span></span></code> </pre><br>  You can also attach a property of type string name to the class MyModel3D, give it a value and, in the OnAdd callback, check specifically which body has collided with which body. <br><br>  Also Box2D allows you to make connections between the bodies.  They can be of different types, consider a couple: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Joint </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddJoint</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Body b1, Body b2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y</span></span></span><span class="hljs-function">)</span></span> { RevoluteJointDef jd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RevoluteJointDef(); jd.Initialize(b1, b2, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vec2(x, y)); Joint joint = world.CreateJoint(jd); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> joint; }</code> </pre><br></div></div><br>  This is a simple rigid connection of the body b1 and b2 at the point x, y.  You can view the properties of the RevoluteJointDef class.  There you can make the object rotate, suitable for creating a machine, or a mill.  Go ahead: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Joint </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddDistanceJoint</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Body b1, Body b2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> collideConnected = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hz = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1f</span></span></span></span></span><span class="hljs-function">)</span></span> { DistanceJointDef jd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DistanceJointDef(); jd.Initialize(b1, b2, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vec2(x1, y1), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vec2(x2, y2)); jd.CollideConnected = collideConnected; jd.FrequencyHz = hz; Joint joint = world.CreateJoint(jd); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> joint; }</code> </pre><br></div></div><br>  This is a more interesting connection, it emits a spring, the value of hz is the tension of the spring.  With such a connection, it is good to make a suspension for the car, or a catapult. <br><br><h3>  Conclusion </h3><br>  This is not all that Box2D can do.  What's great about this engine is that it is free and has a port for any platform, and the syntax is almost the same.  By the way, I tried to use it in Xamarin on 4.1.1 android, the garbage collector constantly slowed down applications due to the fact that Box2D produced a lot of garbage.  They say since the fifth android thanks to ART, everything is not so bad, although I did not check. <br><br>  Link to the GitHub project: <a href="https://github.com/Winster332/Habrahabr">github.com/Winster332/Habrahabr</a> <br>  Port on dotnet core: <a href="">github.com/Winster332/box2d-dotnet-core-1.0</a> </div><p>Source: <a href="https://habr.com/ru/post/333040/">https://habr.com/ru/post/333040/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../333030/index.html">Bare words in javascript</a></li>
<li><a href="../333032/index.html">Why the guide does not accept agile and what can you do about it</a></li>
<li><a href="../333034/index.html">Upsource 2017.2 released with support for external code inspections, Python, NPM, and more</a></li>
<li><a href="../333036/index.html">Yubikey 4 - purchase, delivery and receipt</a></li>
<li><a href="../333038/index.html">Experience Tutu.ru: how the schedule of trains</a></li>
<li><a href="../333042/index.html">Neuro Theater: ITMO University technologies help to create the ‚Äúart of new media‚Äù</a></li>
<li><a href="../333046/index.html">Semantics exactly-once in Apache Kafka</a></li>
<li><a href="../333056/index.html">How I created a printer installation system at work</a></li>
<li><a href="../333132/index.html">Information Security Europe: trends in the global information security market that you will not read about from Gartner</a></li>
<li><a href="../333274/index.html">With the new (IT) "year" you, friends</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>