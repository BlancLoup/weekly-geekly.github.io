<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SOLID principles in action: from Slack to Twilio</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It seems that nowadays the RESTful API exists absolutely for everything. From payments to booking tables, from simple notifications to deploying virtu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SOLID principles in action: from Slack to Twilio</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/11c/369/743/11c369743198bc984ae5fd64a673d06f.jpg"><br><br>  It seems that nowadays the <a href="https://www.twilio.com/docs/api/rest">RESTful API</a> exists absolutely for everything.  From payments to booking tables, from simple notifications to deploying virtual machines - almost everything is available through a simple HTTP interaction. <br><br>  If you develop your own service, you often want to make it work simultaneously on several platforms.  The time-tested principles of OOD (object-oriented design) will make your code more fault-tolerant and simplify extensibility. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this article we will explore one specific design approach called SOLID (this is an acronym).  We use it in practice in writing a service with <a href="https://api.slack.com/">Slack</a> integration, and then expand it for use with <a href="https://www.twilio.com/docs/api/rest">Twilio</a> . <br><a name="habracut"></a><br>  This service will send you a random Magic the Gathering card.  If you want to check it in action right now, then send the word <i>magic</i> to the number 1-929-236-9306 (only USA and Canada - you will receive an image via MMS, so the tariffs of your operator may apply).  You can also join my Slack organization by clicking <a href="https-3A__join.slack.com_t_random-2Dmagic-2Dcard_shared-5Finvite_enQtMjY4NjE4NDE5MDQ1LTg1MGU5YjhmYTM3MzcyMWFiMGRiZGU2YTAzNGE0ODg4MWJjNjZkYjIwNzM4MmNmN2I5NTE5ODUyZWJmNmYzMTM%26d%3DDwMFaQ%26c%3Dx_Y1Lz9GyeGp2OvBCa_eow%26r%3D-dXmeaeOne04Df2gPNIXv20X463I7_WEN16Q2GO_4oE%26m%3D5Dev1dCKYRUNbr2oyFzyBYgWCGCFV0MQzG_XHz8HnI0%26s%3DpsUebhSG0U_tAC88QJ3kPSaAr60Ot_5vFpgDDaKvW50%26e%3D">here</a> .  After logging in, type: <i>/ magic</i> . <br><br><h1>  SOLID for "Magic" </h1><br>  If you are not familiar with <a href="https://en.wikipedia.org/wiki/SOLID_(object-oriented_design)">SOLID</a> , this is a set of object-oriented design (OOD) principles that <a href="http://butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod">Uncle Bob Martin</a> popularized.  SOLID is an acronym for: <br><br><ul><li>  S - SRP - Single Responsibility Principle </li><li>  O - OCP - Open Closed Principle </li><li>  L - LSP - The Substitution Principle of Barbara Liskov </li><li>  I - ISP - Interface Segregation Principle </li><li>  D - DIP - Dependency Inversion Principle </li></ul><br>  If you follow this set of principles, you will make the code more fault tolerant and simplify extensibility.  Further in the article we will talk more about each of these principles. <br><br>  There are many good examples of SOLID in a variety of languages.  Instead of repeating the well-known example of <code>Shape</code> , <code>Circle</code> , <code>Rectangle</code> , <code>Area</code> I would like to show the advantages of SOLID in a full-featured real-world application. <br><br>  I recently played with the <a href="https://api.slack.com/">Slack API</a> .  It‚Äôs really really easy to build your teams with a slash.  I'm also a big fan of <a href="https://magic.wizards.com/en">Magic the Gathering</a> , so I got the idea to make a Slack slash command that produces an image of the random Magic the Gathering card. <br><br>  I quickly realized my plan with the help of <a href="https://projects.spring.io/spring-boot/">Spring Boot</a> .  As you will see, Spring Boot observes a couple of SOLID principles right out of the box. <br><br>  Twilio has a great API for voice and text messaging.  I thought it would be interesting to see how easy it is to take my Slack example and integrate it with Twilio.  The idea is that you send a text message with the team to a known phone number - and get a random image of Magic the Gathering. <br><br>  The following is an analysis of the SOLID principles (not in order) in action during this programming exercise. <br><br>  All code can be found <a href="https://github.com/dogeared/magic-with-slack-and-twilio">here</a> .  Later we will see how to apply this code on your own Slack and / or Twilio account if you wish. <br><br><h1>  First Pass: "Magic" with Slack </h1><br>  Just the fact of using Spring Boot to create a Magic application immediately provides two of the five SOLID principles without any special effort on your part.  However, you are still responsible for the proper architecture of the application. <br><br>  Since in the process of writing the code, we will study different principles, you can look at the sample code at any time by checking the corresponding tags in the GitHub project (you will find them in the ‚ÄúReleases‚Äù section).  The full code for this chapter is displayed by the <code><a href="https://github.com/dogeared/magic-with-slack-and-twilio/tree/slack-first-pass">slack-first-pass</a></code> tag. <br><br>  Look at the <code>SlackController</code> code (all Java sources are here: magic-app / src / main / java / com / afitnerd / magic), which presents an example of the principles <code>D</code> and <code>I</code> in SOLID: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RestController</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/api/v1"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SlackController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> MagicCardService magicCardService; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> SlackResponseService slackResponseService; <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>( value = <span class="hljs-string"><span class="hljs-string">"/slack"</span></span>, method = RequestMethod.POST, consumes = MediaType.APPLICATION_FORM_URLENCODED_VALUE, produces = MediaType.APPLICATION_JSON_VALUE ) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span> <span class="hljs-function"><span class="hljs-function">Map&lt;String, Object&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">slack</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@RequestBody SlackSlashCommand slackSlashCommand)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> slackResponseService.getInChannelResponseWithImage(magicCardService.getRandomMagicCardImage()); } }</code> </pre> <br><h3>  DIP: dependency inversion principle </h3><br>  The principle of <a href="https://en.wikipedia.org/wiki/Dependency_inversion_principle">DIP</a> says: <br><br><blockquote>  A. The modules of the upper levels should not depend on the modules of the lower levels.  Both types of modules must depend on abstractions. <br><br>  B. Abstractions should not depend on details.  Details must depend on abstractions. </blockquote><br>  Java and Spring Boot extremely simplify the implementation of this principle.  <code>SlackController</code> * has * <code>MagicCardService</code> .  This is * an abstraction * because it is a Java interface.  And since this is an interface, there are no details. <br><br>  The implementation of <code>MagicCardService</code> not specifically dependent on <code>SlackController</code> .  Later we will see how to provide such a separation between the interface and its implementation by breaking the application into modules.  Additionally, consider other modern ways to implement dependencies in Spring Boot. <br><br><h3>  ISP: interface separation principle </h3><br>  The <a href="https://en.wikipedia.org/wiki/Interface_segregation_principle">ISP</a> principle states: <br><br><blockquote>  Many separate client interfaces are better than one universal interface. </blockquote><br>  In <code>SlackController</code> we implemented two separate interfaces: <code>MagicCardService</code> and <code>SlackResponseService</code> .  One of them interacts with the Magic the Gathering site.  The other interacts with Slack.  Creating a single interface to perform these two separate functions would violate the ISP principle. <br><br><h1>  Next: ‚ÄúMagic‚Äù with Twilio </h1><br>  To track the code in this chapter, see the <code><a href="https://github.com/dogeared/magic-with-slack-and-twilio/tree/twilio-breaks-srp">twilio-breaks-srp</a></code> tag. <br><br>  Let's look at the TwilioController code: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RestController</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/api/v1"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TwilioController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MagicCardService magicCardService; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String MAGIC_COMMAND = <span class="hljs-string"><span class="hljs-string">"magic"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String MAGIC_PROXY_PATH = <span class="hljs-string"><span class="hljs-string">"/magic_proxy"</span></span>; ObjectMapper mapper = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ObjectMapper(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger log = LoggerFactory.getLogger(TwilioController.class); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TwilioController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MagicCardService magicCardService)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.magicCardService = magicCardService; } <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(value = <span class="hljs-string"><span class="hljs-string">"/twilio"</span></span>, method = RequestMethod.POST, headers = <span class="hljs-string"><span class="hljs-string">"Accept=application/xml"</span></span>, produces=MediaType.APPLICATION_XML_VALUE) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> TwilioResponse </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">twilio</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@ModelAttribute TwilioRequest command, HttpServletRequest req)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ log.debug(mapper.writeValueAsString(command)); TwilioResponse response = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TwilioResponse(); String body = (command.getBody() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) ? command.getBody().trim().toLowerCase() : <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!MAGIC_COMMAND.equals(body)) { response .getMessage() .setBody(<span class="hljs-string"><span class="hljs-string">"Send\n\n"</span></span> + MAGIC_COMMAND + <span class="hljs-string"><span class="hljs-string">"\n\nto get a random Magic the Gathering card sent to you."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response; } StringBuffer requestUrl = req.getRequestURL(); String imageProxyUrl = requestUrl.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, requestUrl.lastIndexOf(<span class="hljs-string"><span class="hljs-string">"/"</span></span>)) + MAGIC_PROXY_PATH + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + magicCardService.getRandomMagicCardImageId(); response.getMessage().setMedia(imageProxyUrl); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response; } <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(value = MAGIC_PROXY_PATH + <span class="hljs-string"><span class="hljs-string">"/{card_id}"</span></span>, produces = MediaType.IMAGE_JPEG_VALUE) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] magicProxy(<span class="hljs-meta"><span class="hljs-meta">@PathVariable</span></span>(<span class="hljs-string"><span class="hljs-string">"card_id"</span></span>) String cardId) <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> IOException { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> magicCardService.getRandomMagicCardBytes(cardId); } }</code> </pre> <br>  As mentioned earlier, a more modern approach to dependency injection is applied (best practices).  As you can see, we did this using the Spring Boot Constructor Injection.  This is just a beautiful way to say that in the latest version of Spring Boot, dependency injection is implemented as follows: <br><br>  1. Install one or more hidden fields in your class, for example: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MagicCardService magicCardService;</code> </pre> <br>  2. Define the constructor for the installed hidden fields: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TwilioController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MagicCardService magicCardService)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.magicCardService = magicCardService; }</code> </pre> <br>  Spring Boot will automatically handle object injection at runtime.  The advantage is that here it is possible to run error checking and validation on the embedded object inside the constructor. <br><br>  The controller contains two parts: <code>/twilio</code> and <code>/magic_proxy/{card_id}</code> .  The magic_proxy path requires a little explanation, so we first analyze it before talking about violation of the SRP principle. <br><br><h3>  TwiML Fun </h3><br>  <a href="https://www.twilio.com/docs/api/twiml">TwiML</a> is the Twilio Markup Language markup language.  This is the basis of all Twilio answers, because TwiML is a Twilio manual.  This is also XML.  Usually this is not a problem.  However, the URLs returned by Magic the Gathering site present a problem for inclusion in TwiML documents. <br><br>  The URL where the Magic the Gathering card image is retrieved looks like this: <br><br><pre> <code class="xml hljs">http://gatherer.wizards.com/Handlers/Image.ashx?multiverseid=144276&amp;type=card</code> </pre> <br>  Notice the ampersand (&amp;) in the URL.  There are only two valid ways to embed an ampersand in XML documents: <br><br>  1. Escape characters <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Response</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Message</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Body</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Media</span></span></span><span class="hljs-tag">&gt;</span></span>http://gatherer.wizards.com/Handlers/Image.ashx?multiverseid=144276&amp;‚Äãamp;type=card<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Media</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Message</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Response</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Here, instead of an ampersand, the element <code>&amp;‚Äãamp;</code>  . <br><br>  2. Fragment of CDATA (character data) <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Response</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Message</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Body</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Media</span></span></span><span class="hljs-tag">&gt;</span></span> &lt;![CDATA[http://gatherer.wizards.com/Handlers/Image.ashx?multiverseid=144276&amp;type=card]]&gt; <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Media</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Message</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Response</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Any of these options are easy to implement in Java with the <a href="https://github.com/FasterXML/jackson-dataformat-xml">Jackson Dataformat XML</a> extension in the Jackson JSON processor built into Spring Boot. <br><br>  The problem is that the first version leads to an error when retrieving an image from the Wizards of the Coast website (the Magic maintainers of the game Magic the Gathering), and the second version is not supported in Twilio (hey Twilio: maybe implement CDATA support in TwiML?) <br><br>  I circumvented this restriction using a proxy for requests.  In this case, this TwiML code is generated: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Response</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Message</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Body</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Media</span></span></span><span class="hljs-tag">&gt;</span></span> http://<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">my</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">magic</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">host</span></span></span><span class="hljs-tag">&gt;</span></span>/api/v1/magic_proxy/144276 <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Media</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Message</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Response</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  When such a code is received, Twilio refers to the endpoint <code>/magic_proxy</code> , and already behind the scenes, the proxy receives a picture from the Magic the Gathering site and issues it. <br><br>  Now let's continue studying the principles of SOLID. <br><br><h3>  SRP: sole responsibility principle </h3><br>  The SRP principle states: <br><br><blockquote>  A class must have only one function. </blockquote><br>  The above controller works as it is, but violates the SRP, because it is also responsible for returning the TwiML response, and for the proxy for the pictures. <br><br>  In this example, this is not a big problem, but it is easy to imagine how the situation quickly gets out of control. <br><br>  If you go through the <code><a href="https://github.com/dogeared/magic-with-slack-and-twilio/tree/twilio-fixes-srp">twilio-fixes-srp</a></code> tag, you will see a new controller called <code>MagicCardProxyController</code> : <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RestController</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/api/v1"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MagicCardProxyController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MagicCardService magicCardService; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MagicCardProxyController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MagicCardService magicCardService)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.magicCardService = magicCardService; } <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(value = MAGIC_PROXY_PATH + <span class="hljs-string"><span class="hljs-string">"/{card_id}"</span></span>, produces = MediaType.IMAGE_JPEG_VALUE) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] magicProxy(<span class="hljs-meta"><span class="hljs-meta">@PathVariable</span></span>(<span class="hljs-string"><span class="hljs-string">"card_id"</span></span>) String cardId) <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> IOException { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> magicCardService.getRandomMagicCardBytes(cardId); } }</code> </pre> <br>  His only task is to return the bytes of the image received on the proxy from the Magic the Gathering website. <br><br>  Now the only <code>TwilioController</code> function is to issue TwiML code. <br><br><h3>  DIP implementation modules </h3><br>  <a href="https://maven.apache.org/">Maven</a> makes it easy to split a project into modules.  They may have different areas (scopes), but they are the same: compilation (by default), execution and test. <br><br>  Regions take control when modules are involved in a given area.  The <code>runtime</code> field checks that the classes for a particular module are * not * available at compile time.  They are available only at run time.  This helps to realize the principle of DIP. <br><br>  Simply show an example.  See the code for the <code><a href="https://github.com/dogeared/magic-with-slack-and-twilio/tree/modules-ftw">modules-ftw</a></code> tag.  You can see that the project organization has radically changed (as seen in IntelliJ): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1dc/b34/901/1dcb34901a656194b425ed46f55f9882.png"><br><br>  Now there are four modules.  If you look at the <code>magic-app</code> module, then from <code>pom.xml</code> can see how it relies on other modules: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.afitnerd<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>magic-config<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.afitnerd<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>magic-api<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>compile<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.afitnerd<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>magic-impl<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>runtime<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Note that <code>magic-impl</code> is in the <code>runtime</code> , and <code>magic-api</code> is in the <code>compile</code> . <br><br>  In <code>TwilioController</code> we automatically bind to TwilioResponseService: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RestController</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(API_PATH) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TwilioController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> TwilioResponseService twilioResponseService; ‚Ä¶ }</code> </pre> <br>  And now look what happens if we try to automatically bind the implemented class like this: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RestController</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(API_PATH) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TwilioController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> TwilioResponseServiceImpl twilioResponseService; ‚Ä¶ }</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/38f/275/a92/38f275a92c17705e62e43efee69863d1.png"><br><br>  IntelliJ cannot find the TwilioResponseServiceImpl class because its * no * is in the <code>compile</code> . <br><br>  As a joke, you can try to delete the <code>runtime</code> line from <code>pom.xml</code> - and you will see that then IntelliJ will happily find the <code>TwilioResponseServiceImpl</code> class. <br><br>  As we have seen, maven modules in combination with scopes helps to realize the principle of DIP. <br><br><h1>  Finish line: Slack refactoring </h1><br>  When I wrote this application for the first time, I did not think about SOLID.  I just wanted to hack the Slack application to play around with the functionality of slash commands. <br><br>  In the first version, all Slack-related services and controllers simply gave out <code>Map&lt;String, Object&gt;</code> .  This is a good trick for Spring Boot applications ‚Äî to output any JSON response without worrying about the formal Java models that represent the structure of the response. <br><br>  As the application developed, the desire arose to create more formal models for readable and reliable code. <br><br>  See the source code for the <code><a href="https://github.com/dogeared/magic-with-slack-and-twilio/tree/slack-violates-lsp">slack-violates-lsp</a></code> . <br><br>  Let's look at the <code>SlackResponse</code> class in the <code>magic-api</code> module: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SlackResponse</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Attachment&gt; attachments = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-meta"><span class="hljs-meta">@JsonInclude</span></span>(JsonInclude.Include.NON_EMPTY) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Attachment&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAttachments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> attachments; } <span class="hljs-meta"><span class="hljs-meta">@JsonInclude</span></span>(JsonInclude.Include.NON_NULL) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-meta"><span class="hljs-meta">@JsonProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"response_type"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getResponseType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; ... }</code> </pre> <br>  Here we see that in the <code>SlackResponse</code> class <code>SlackResponse</code> is an <code>Attachments</code> array, a text string and a <code>response_type</code> string. <br><br>  <code>SlackResponse</code> declared the type <code>abstract</code> , and the implementation functions of the <code>getText</code> and <code>getResponseType</code> methods fall on the child classes. <br><br>  Now, take a look at one of the child classes of <code>SlackInChannelImageResponse</code> : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SlackInChannelImageResponse</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SlackResponse</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SlackInChannelImageResponse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String imageUrl)</span></span></span><span class="hljs-function"> </span></span>{ getAttachments().add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Attachment(imageUrl)); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getResponseType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"in_channel"</span></span>; } }</code> </pre> <br>  The <code>getText()</code> method returns <code>null</code> .  With this answer, the answer will contain * only * image.  Text is returned only in the case of an error message.  Here * clearly * smells like LSP. <br><br><h3>  LSP: Barbara Liskov substitution principle </h3><br>  The principle of the LSP says: <br><br><blockquote>  Objects in the program should be able to be replaced by their subtypes without changing the accuracy of the program. </blockquote><br>  When you are dealing with the inheritance hierarchy and the child class * always * returns null, this is a clear sign of a violation of the LSP principle.  Because the child class does not need this method, but it has to implement it because of the interface described in the parent class. <br><br>  Look at the <code><a href="https://github.com/dogeared/magic-with-slack-and-twilio/tree/master">master</a></code> branch in a project on github.  It refactored the <code>SlackResponse</code> hierarchy to match the LSP. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SlackResponse</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@JsonProperty</span></span>(<span class="hljs-string"><span class="hljs-string">"response_type"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getResponseType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre> <br>  Now the only thing common to all child classes that they have to implement is the <code>getResponseType()</code> method. <br><br>  In the <code>SlackInChannelImageResponse</code> class <code>SlackInChannelImageResponse</code> is everything you need for the correct answer with a picture: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SlackInChannelImageResponse</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SlackResponse</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Attachment&gt; attachments = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SlackInChannelImageResponse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String imageUrl)</span></span></span><span class="hljs-function"> </span></span>{ attachments.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Attachment(imageUrl)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Attachment&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAttachments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> attachments; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getResponseType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"in_channel"</span></span>; } ‚Ä¶ }</code> </pre> <br>  No more returning to <code>null</code> . <br><br>  There is another minor improvement: we used to have some JSON annotations in the <code>SlackResponse</code> class: <code>@JsonInclude(JsonInclude.Include.NON_EMPTY)</code> and <code>@JsonInclude(JsonInclude.Include.NON_NULL)</code> . <br><br>  They were needed to ensure that an empty array of attachments or a text field with a zero value does not fall into JSON.  Although these are powerful annotations, because of them the objects of our model become fragile, and it may not be clear to other developers what is happening. <br><br><h3>  OCP: the principle of openness / closeness </h3><br>  The last principle we‚Äôll look at in our SOLID journey is OCP. <br><br>  The principle of OCP says: <br><br><blockquote>  Software entities ... must be open for expansion, but closed for modification. </blockquote><br>  The idea is that if you change the terms of reference, your code will more effectively cope with any new requirements if you expand the classes and not add the code to existing classes.  This helps to keep the code from spreading. <br><br>  In the example above, there is no additional reason to change the <code>SlackResponse</code> class.  If we want to add support for other types of Slack responses to the application, we can easily describe these specifics in subclasses. <br><br>  Here again is the power of Spring Boot.  Take a look at the <code>SlackResponseServiceImpl</code> class in the <code>magic-impl</code> . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Service</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SlackResponseServiceImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SlackResponseService</span></span></span><span class="hljs-class"> </span></span>{ MagicCardService magicCardService; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SlackResponseServiceImpl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MagicCardService magicCardService)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.magicCardService = magicCardService; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> SlackResponse </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInChannelResponseWithImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SlackInChannelImageResponse(magicCardService.getRandomMagicCardImageUrl()); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> SlackResponse </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getErrorResponse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SlackErrorResponse(); } }</code> </pre> <br>  According to the interface conditions, the <code>getInChannelResponseWithImage</code> and <code>getErrorResponse</code> return a <code>SlackResponse</code> object. <br><br>  Inside these methods, various <code>SlackResponse</code> child objects are <code>SlackResponse</code> .  Spring Boot and its built-in jackson mapper for JSON are smart enough to produce the correct JSON for the particular object that is featured inside. <br><br>  If you want to provide integration for your own organization in Slack or to implement support for your Twilio account (or both), then read on!  Otherwise, you can go to the summary at the end of the article. <br><br><h1>  Deploying the application </h1><br>  If you want to use this application to its fullest, then you need to properly configure Slack and Twilio after deploying the application to Heroku. <br><br>  Alternatively, you can install either Slack or Twilio.  In any case, the first thing you need to deploy the application on Heroku.  Fortunately, it is simple. <br><br><h3>  Deploying to Heroku </h3><br>  The easiest way to deploy the application on Heroku is to press the friendly purple button in <a href="https://github.com/dogeared/magic-with-slack-and-twilio">the README section of the GitHub project</a> .  You will need to specify two details: <code>BASE_URL</code> and <code>SLACK_TOKENS</code> . <br><br>  <code>BASE_URL</code> is the full path and name of your Heroku application.  For example, my application is installed here: <a href="https://random-magic-card.herokuapp.com/">https://random-magic-card.herokuapp.com</a> .  Stick to the same format when choosing an application name: <code>https://&lt;app name&gt;.herokuapp.com</code> . <br><br>  There is a peculiar chicken and egg problem, because the Heroku application needs some information from Slack, and for Slack integration, some information about the Heroku application is needed.  At first, you can leave the default value in the <code>SLACK_TOKENS</code> field ‚Äî we will return later and update this value with this Slack API token. <br><br>  You can check the installation by going to <code>https://&lt;app name&gt;.herokuapp.com</code> .  You should see the random Magic the Gathering card in your browser.  If an error occurs, look at the error log in the Heroku web interface.  Here is <a href="https://random-magic-card.herokuapp.com/">an example of a web interface in action</a> . <br><br><h3>  Slack setup </h3><br>  Go to <a href="https://api.slack.com/apps">https://api.slack.com/apps</a> and click the <code>Create New App</code> button to get started: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/490/591/d0c/490591d0c324beebd5471a622c9d6682.png"><br><br>  Enter the name <code>App Name</code> and select the <code>Workspace</code> workspace where you will add the application: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f4e/238/a70/f4e238a702026a0dba23a6b413e92aa8.png"><br><br>  Next, click on the link with <code>Slash Commands</code> slash commands on the left, and then there is a button to create a new <code>Create New Command</code> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4a7/35f/3e5/4a735f3e598e4be981ee4c2eecdd1242.png"><br><br>  Fill in the values ‚Äã‚Äãfor the command (for example: <code>/magic</code> ), <code>Request URL</code> (for example: <code>https://&lt;your app name&gt;.herokuapp.com/api/v1/slack</code> ) and a short description.  Then click <code>Save</code> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/457/162/919/45716291997dfca0c064850a0a0fc701.png"><br><br>  Now your Slack slash command is fully configured: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/287/68e/ae1/28768eae1e16889b3964f61980305898.png"><br><br>  Go to the <code>Basic Information</code> section in the left pane and expand the <code>Install app to your workspace section</code> on the screen.  Click the <code>Install app to Workspace</code> button. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ecf/bf2/5b4/ecfbf25b409fe8ed84c5365c1df13fb8.png"><br><br>  Then the button for authorization: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/030/2a2/956/0302a2956aa441009f4646850fd1377e.png"><br><br>  Scroll to the <code>Basic Information</code> screen where you returned, and record the verification token. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b7d/855/8d4/b7d8558d4f1b12c773c2f8509a3f94db.png"><br><br>  If you installed the Heroku CLI, then you can correctly set the <code>SLACK_TOKENS</code> property <code>SLACK_TOKENS</code> following command: <br><br><pre> <code class="hljs pgsql">heroku config:<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> \ SLACK_TOKENS=&lt;comma separated tokens&gt; \ <span class="hljs-comment"><span class="hljs-comment">--app &lt;your heroku app name&gt;</span></span></code> </pre> <br>  Alternatively, go to <a href="https://dashboard.heroku.com/">the Heroku dashboard</a> , go to your application and change the value of <code>SLACK_TOKENS</code> in the settings. <br><br>  Now the slash command should work on your organization's Slack channel, and in return you will receive a Magic the Gathering card: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b4e/b34/ead/b4eb34eade4d648d39c6a9152615f696.png"><br><br><h3>  Twilio Setup </h3><br>  To configure Twilio integration, go to <a href="https://www.twilio.com/console">the Twilio dashboard in the console</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/312/437/179/312437179a21639161ae7b11a40bfc49.png"><br><br>  Click on the ellipsis and select <code>Programmable SMS</code> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/349/2af/d8f/3492afd8f1206b9abd1eb6cabbc450ee.png"><br><br>  Select <code>Messaging Services</code> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/920/f6a/c0f/920f6ac0f620cd5123e30b03b21df9cf.png"><br><br>  Create a new messaging service by clicking on the red plus button (or click ‚ÄúCreate new Messaging Service‚Äù if there are no services yet): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e80/f23/271/e80f23271aea37606a32c0dc756f34d2.png"><br><br>  Enter <code>Friendly Name</code> , select <code>Notifications, 2-Way</code> in the <code>Use Case</code> column and click the <code>Create</code> button: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/289/e21/988/289e21988648ec6cb120b1f897b51381.png"><br><br>  Check the <code>Process Inbound Messages</code> in <code>Process Inbound Messages</code> and enter the <code>Request URL</code> for your Heroku application (for example, <code>https://&lt;your app name&gt;.herokuapp.com/api/v1/twilio</code> ): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/62f/af7/e7d/62faf7e7da8fd9867de50ed0886137f0.png"><br><br>  Click the <code>Save</code> button to save the changes. <br><br>  Go to the <code>Numbers</code> section in the left menu and make sure that your Twilio number has been added to the messaging service: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c5e/833/b43/c5e833b43393e15226dd6dbc97c2b632.png"><br><br>  Now you can test the Twilio service by sending <code>magic</code> to your number as a text message: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8bf/e06/0b3/8bfe060b3545138ae2c0e62dbb2b14b1.png" width="450"><br><br>  ** Note: ** If you send anything other than the word <code>magic</code> (regardless of case), the error message shown above will pop up. <br><br><h1>  Summary of SOLID </h1><br>  Once again we publish the SOLID table, this time with the Github project tags that correspond to each principle: <br><br><ul><li>  S - SRP - The principle of sole responsibility.  Tag: <code>twilio-fixes-srp</code> .  Splits the <code>TwilioController</code> controller into two parts, where each controller has only one function. </li><li>  O - OCP - The principle of openness / closeness.  Tag: <code>master</code> .  The <code>SlackResponse</code> class <code>SlackResponse</code> solid and cannot be changed.  It can be expanded without changing the code of the existing service. </li><li>  L - LSP - Barbara Liskov substitution principle.  Tag: <code>master</code> .  None of the <code>SlackResponse</code> child classes return <code>null</code> , it does not contain unnecessary classes or annotations. </li><li>  I - ISP - The principle of interface separation.  Tag: <code>slack-first-pass</code> through <code>master</code> .  The <code>MagicCardService</code> and <code>SlackResponseService</code> perform different functions and therefore are separated from each other. </li><li>  D - DIP - The principle of dependency inversion.  Tag: <code>slack-first-pass</code> through <code>master</code> .  Dependent services are automatically associated with controllers.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Implementing a controller is the ‚Äúbest practice‚Äù of dependency injection. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There are some difficulties in developing this application. </font><font style="vertical-align: inherit;">I have already spoken above about the problem with TwiML. </font><font style="vertical-align: inherit;">But with Slack, there are special problems that I have outlined in </font></font><a href="https://afitnerd.com/2017/05/24/what-if-spring-boot-handled-forms-like-json/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> article. </font><font style="vertical-align: inherit;">TL; DR: Slack accepts for slash commands * only * POST requests </font></font><code>application/x-www-form-urlencoded</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, not more modern ones </font></font><code>application/json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Because of this, there are difficulties with processing incoming JSON data with Spring Boot. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The basic idea is that the SOLID principles have made the code much easier to work with and to further expand. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This concludes our review of the SOLID principles. </font><font style="vertical-align: inherit;">I hope it was more useful than the usual simple Java examples.</font></font></div><p>Source: <a href="https://habr.com/ru/post/343966/">https://habr.com/ru/post/343966/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../343956/index.html">How to calculate ROI when deploying Office 365 using a ROI calculator</a></li>
<li><a href="../343958/index.html">‚ÄúImg‚Äù evolution: Gif without GIF format</a></li>
<li><a href="../343960/index.html">Configuring DTO Validation in the Spring Framework</a></li>
<li><a href="../343962/index.html">Agile Kitchen office Tutu.ru</a></li>
<li><a href="../343964/index.html">ASO Monthly # 18 October 2017</a></li>
<li><a href="../343968/index.html">Productivity of unloading a large amount of data from Mongo to ASP.NET Core Web Api</a></li>
<li><a href="../343970/index.html">On the way to seizing the world. Vivaldi for ARM</a></li>
<li><a href="../343972/index.html">My Body Gadget (Part # 1)</a></li>
<li><a href="../343974/index.html">Performance as Perception: Managing Patience</a></li>
<li><a href="../343976/index.html">CRM system or Help Desk? What is the fundamental difference, where does the confusion come from, and what is on the Help Desk market?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>