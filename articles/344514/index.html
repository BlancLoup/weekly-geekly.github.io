<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We start the django-application in Docker on Vagrant under Windows</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi Habr! For several years I was in readonly mode on the Habrahabr website, occasionally leaving comments on other people's publications, and several ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We start the django-application in Docker on Vagrant under Windows</h1><div class="post__text post__text-html js-mediator-article">  Hi Habr!  For several years I was in readonly mode on the Habrahabr website, occasionally leaving comments on other people's publications, and several weeks before the new year, I wanted to change this state of affairs.  This was my recent assignment at work.  And when I began to look for information, I realized that, as always, there was a lot of it, it was written in a complicated way, and not what I would like to find.  And what if this person is new to this issue?  So I decided to try myself in this field.  Make a tutorial that would be useful to me first. <br><br>  Go. <br><a name="habracut"></a><br>  For several years now, Docker has been on my ear, but I have never had a chance to work with him.  And just then the management wanted to change its stack.  Words like Docker, containers and clouds began to speak.  What is not a reason to learn something new?  I work as a DevOps radio engineer.  My list of technologies is very simple: Octopus Deploy + TeamCity + and a self-written application cart.  It works flawlessly. <br><br>  In this article I want to share information in the form in which I myself personally would like to find it.  The goal is to launch Docker on Vagrant, create an image with Django project by default, initialize the container and get to the site from the main OS. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At work, I work under Windows.  First we need <a href="https://chocolatey.org/install">Chocolatey</a> to install the necessary software. <br><br>  Install a convenient terminal (cmder), VirtualBox and Vagrant: <br><br><pre><code class="markdown hljs">C:\&gt; choco install cmder C:\&gt; choco install vagrant C:\&gt; choco install virtualbox</code> </pre> <br>  If you do not want to use Chocolatey, you can put everything manually. <br><br>  Create a folder for our project, and add the Vagrantfile file to it: <br><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># -*- mode: ruby -*- # vi: set ft=ruby : Vagrant.configure("2") do |config| config.vm.box = "ubuntu/xenial64" config.vm.network "forwarded_port", guest: 5000, host: 8080, host_ip: "127.0.0.1" end</span></span></code> </pre><br>  Usually, this file can be generated by a single command <code>vagrant init ubuntu/xenial64</code> .  I added one line for port forwarding between the main and guest OS on the virtual machine.  This will be needed later when we want to visit our website running in a container. <br><br>  Start the virtual machine and connect to the terminal with the following two Vagrant commands: <br><br><pre> <code class="bash hljs">vagrant up vagrant ssh</code> </pre><br>  We must successfully connect to the virtual machine terminal. <br><br>  Let's proceed to the Docker installation: <br><br><pre> <code class="bash hljs">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - sudo add-apt-repository <span class="hljs-string"><span class="hljs-string">"deb [arch=amd64] https://download.docker.com/linux/ubuntu </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(lsb_release -cs)</span></span></span><span class="hljs-string"> stable"</span></span> sudo apt-get update sudo apt-get install -y docker-ce</code> </pre><br>  Let's verify that Docker is installed successfully and the service is running.  Run the following command: <br><br><pre> <code class="bash hljs">sudo systemctl status docker</code> </pre><br>  Create a Dockerfile file with the following content: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> python:latest ENV PYTHONUNBUFFERED <span class="hljs-number"><span class="hljs-number">1</span></span> RUN apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> RUN mkdir /code WORKDIR /code RUN pip install django==<span class="hljs-number"><span class="hljs-number">1.11</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span> RUN django-<span class="hljs-keyword"><span class="hljs-keyword">admin</span></span> startproject mysite RUN python mysite/manage.py migrate RUN echo "from django.contrib.auth.models import User; User.objects.create_superuser('admin', 'admin@example.com', 'pass')" | python mysite/manage.py shell <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> . /code/ CMD python mysite/manage.py runserver <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>:<span class="hljs-number"><span class="hljs-number">5000</span></span></code> </pre><br>  We have created a description of the future image with the default Django application.  In this description, we use the Python image, and add our seasonings, namely: installing Django, creating a default project, running scripts to initialize the database, and creating an admin user. <br><br>  Let's build an image by running: <br><br><pre> <code class="bash hljs">sudo docker build -t my/app:latest .</code> </pre><br>  This command pulls all the necessary images from the Docker registry, and adds our configuration to the final with the name my / app. <br><br>  Run the command and you will see your assembled image locally: <br><br><pre> <code class="bash hljs">sudo docker images</code> </pre><br>  This is just an image as a class that we need to initialize.  During initialization, we create a container (object).  A container is a running image in Docker. <br><br>  Create a container based on our image: <br><br><pre> <code class="bash hljs">sudo docker run -d -p 5000:5000 my/app</code> </pre><br>  Docker will return you the generated unique identifier (guid) of the running container.  We have just launched our application in a container.  In the team, we told Docker to map the ports inside the container and the external one on the guest OS. <br><br>  Minimize the remote terminal and launch the browser on the main system.  Go to: <a href="http://localhost:8080/">http: // localhost: 8080 /</a> <br><br>  You will see the main page of the Django application.  You can go to the admin page, and enter the control panel with <code>admin/pass</code> data. <br><br>  Why Vagrant?  For experiments, I never install anything on the main system, and work with virtual machines.  If something went wrong, you can always delete and start over.  The best documentation for me is the code. <br><br>  Let's go back to the console.  To view the logs, run the command: <br><br><pre> <code class="bash hljs">sudo docker logs &lt;guid &gt; | head</code> </pre><br>  The command will output the console output of the internal server running Django.  Everything you see is usually running <code>python manage.py runserver</code> locally. <br><br>  Turn off the container with the following command: <br><br><pre> <code class="bash hljs">sudo docker stop &lt;guid &gt;</code> </pre><br>  Again we return to our running browser in the main system, and overload the website.  It is unavailable. <br><br>  When the container is stopped, take it as a server off.  The state of the container is saved as if you did a hibeirnet on your desktop. <br><br>  This command will list all initialized containers: <br><br><pre> <code class="bash hljs">sudo docker ps -a</code> </pre><br>  Let's run our container again: <br><br><pre> <code class="bash hljs">sudo docker start &lt;guid &gt;</code> </pre><br>  The browser returns to us all the same website.  You can log in to the control panel, create a user, and then turn off and turn on the container.  You will see that the user is saved and available when the container is started again. <br><br>  I specifically used the old version of Django to show the next moment.  Open the Dockerfile, and edit it.  Remove the Django version when we install it using the <code>pip</code> command. <br><br>  Build a new image with the command: <br><br><pre> <code class="bash hljs">sudo docker build -t my/app:latest .</code> </pre><br>  Note that we did not stop the running container.  With the command above, we updated the image that is stored locally. <br><br>  Let's remove the current container with the command: <br><br><pre> <code class="bash hljs">sudo docker <span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> &lt;guid&gt;</code> </pre><br>  And we will launch a new container: <br><br><pre> <code class="bash hljs">sudo docker run -d -p 5000:5000 my/app</code> </pre><br>  Every time you launch a new container based on the image, Docker generates a unique identifier for it, which you can use with it (turn off, turn on, connect to the terminal, etc.) <br><br>  That's all, let's clean up after ourselves and remove all unnecessary. <br><br>  Log out of the SSH session in the terminal by typing: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre><br>  And you are again in your home directory of the main system.  Vagrant is still running, Docker and your container respectively.  You can check this again through the browser, to make sure that the site is still running. <br><br>  To remove a running virtual machine in Vagrant, run: <br><br><pre> <code class="bash hljs">vagrant halt vagrant destroy</code> </pre><br>  The first command turns off the virtual machine and saves its state, and the second removes the virtual machine from VirtualBox. </div><p>Source: <a href="https://habr.com/ru/post/344514/">https://habr.com/ru/post/344514/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../344504/index.html">Avito iOS Winter Edition - video, photos, slides, reviews</a></li>
<li><a href="../344506/index.html">Singleton, service locator and tests in iOS</a></li>
<li><a href="../344508/index.html">Dependency injection and unit implementation using Castle Windsor and NHibernate</a></li>
<li><a href="../344510/index.html">How does MEGA Belaya Dacha work: we open a shopping center on the other side</a></li>
<li><a href="../344512/index.html">We invite you to the results of the competition for data analysis</a></li>
<li><a href="../344516/index.html">Extended Validation not working</a></li>
<li><a href="../344518/index.html">Welcome to Christmas Agile MeetUp</a></li>
<li><a href="../344522/index.html">Tutorial on the Unreal Engine. Part 3: materials</a></li>
<li><a href="../344524/index.html">Case analysis about backup verification (SureBackup) and using vSAN</a></li>
<li><a href="../344526/index.html">C / C ++ application development using Tcl / Tk</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>