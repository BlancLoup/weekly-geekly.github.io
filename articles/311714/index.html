<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Installing OTRS 5 on a server with Nginx</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Installing Helpdesk OTRS, I was faced with the fact that the work is officially supported only with the Apache HTTP Server , and I needed Nginx . As i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Installing OTRS 5 on a server with Nginx</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/5c4/415/2df/5c44152df562482cb55b07244748cd9b.png"></div><br>  Installing Helpdesk <a href="https://www.otrs.com/">OTRS,</a> I was faced with the fact that the work is officially supported only with the <a href="httpd.apache.org/">Apache HTTP Server</a> , and I needed <a href="https://nginx.org/ru/">Nginx</a> .  As it turned out, there is no detailed installation guide for OTRS on a WEB server running Nginx on the Internet, we will try to fix it.  This article will describe only the installation of OTRS version 5.0.13, and its configuration is a separate topic.  CentOS 7 will be the OS on which the server will be deployed. <br><a name="habracut"></a><br><h1>  Nginx </h1><br>  We connect repositories of Epel and Nginx. <br><br><pre><code class="hljs sql">yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> epel-<span class="hljs-keyword"><span class="hljs-keyword">release</span></span> yum localinstall <span class="hljs-keyword"><span class="hljs-keyword">http</span></span>://nginx.org/packages/centos/<span class="hljs-number"><span class="hljs-number">7</span></span>/noarch/RPMS/nginx-<span class="hljs-keyword"><span class="hljs-keyword">release</span></span>-centos<span class="hljs-number"><span class="hljs-number">-7</span></span><span class="hljs-number"><span class="hljs-number">-0.</span></span>el7.ngx.noarch.rpm</code> </pre> <br>  Install Nginx. <br><br><pre> <code class="hljs sql">yum <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> &amp;&amp; yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> wget bzip2 nginx</code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We create an <b>approximate</b> Nginx configuration file, <a href="https://www.nginx.com/resources/wiki/start/topics/examples/full/">this article</a> was taken as a basis. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">mv</span></span> /etc/nginx/nginx.conf /etc/nginx/nginx.conf.orig vi /etc/nginx/nginx.conf</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">user</span></span> nginx; <span class="hljs-attribute"><span class="hljs-attribute">worker_processes</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">worker_rlimit_nofile</span></span> <span class="hljs-number"><span class="hljs-number">4096</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">error_log</span></span> /var/log/nginx/error.log <span class="hljs-literal"><span class="hljs-literal">warn</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">pid</span></span> /var/run/nginx.pid; <span class="hljs-section"><span class="hljs-section">events</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">worker_connections</span></span> <span class="hljs-number"><span class="hljs-number">1024</span></span>; } <span class="hljs-section"><span class="hljs-section">http</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">include</span></span> /etc/nginx/mime.types; <span class="hljs-attribute"><span class="hljs-attribute">default_type</span></span> application/octet-stream; <span class="hljs-attribute"><span class="hljs-attribute">log_format</span></span> main <span class="hljs-string"><span class="hljs-string">'\$remote_addr - \$remote_user [\$time_local] "\$request" '</span></span> <span class="hljs-string"><span class="hljs-string">'\$status \$body_bytes_sent "\$http_referer" '</span></span> <span class="hljs-string"><span class="hljs-string">'"\$http_user_agent" "\$http_x_forwarded_for"'</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">access_log</span></span> /var/log/nginx/access.log main; <span class="hljs-attribute"><span class="hljs-attribute">sendfile</span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">tcp_nopush</span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">keepalive_timeout</span></span> <span class="hljs-number"><span class="hljs-number">65</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">server_names_hash_bucket_size</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">server_tokens</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">gzip</span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">include</span></span> /etc/nginx/conf.d/<span class="hljs-regexp"><span class="hljs-regexp">*.conf</span></span>; }</code> </pre><br></div></div><br>  Create a host config by replacing <b>HOST</b> with your domain name. <br><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">vi</span></span> /etc/nginx/conf.d/<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>.conf</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="hljs dos">#server { # listen <span class="hljs-number"><span class="hljs-number">80</span></span>; # server_name otrs.HOST; # rewrite ^ https://$http_host$request_uri? permanent; #} server { listen <span class="hljs-number"><span class="hljs-number">80</span></span>; listen <span class="hljs-number"><span class="hljs-number">443</span></span> ssl; server_name otrs.HOST; root /opt/otrs/var/httpd/htdocs; error_log /var/log/nginx/otrs-error.log warn; ssl_certificate /etc/letsencrypt/live/HOST/fullchain.pem; ssl_certificate_key /etc/letsencrypt/live/HOST/privkey.pem; ssl_dhparam /etc/ssl/HOST/dhparam.pem; ssl_session_cache shared:SSL:<span class="hljs-number"><span class="hljs-number">1</span></span>m; ssl_session_timeout <span class="hljs-number"><span class="hljs-number">1</span></span>h; ssl_stapling on; ssl_stapling_verify on; ssl_trusted_certificate /etc/letsencrypt/live/otrs.HOST/fullchain.pem; resolver <span class="hljs-number"><span class="hljs-number">77</span></span>.<span class="hljs-number"><span class="hljs-number">88</span></span>.<span class="hljs-number"><span class="hljs-number">8</span></span>.<span class="hljs-number"><span class="hljs-number">88</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>.<span class="hljs-number"><span class="hljs-number">8</span></span>.<span class="hljs-number"><span class="hljs-number">8</span></span>.<span class="hljs-number"><span class="hljs-number">8</span></span> valid=<span class="hljs-number"><span class="hljs-number">300</span></span>s; resolver_timeout <span class="hljs-number"><span class="hljs-number">10</span></span>s; ssl_protocols TLSv1 TLSv1.<span class="hljs-number"><span class="hljs-number">1</span></span> TLSv1.<span class="hljs-number"><span class="hljs-number">2</span></span>; ssl_ciphers 'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:DES-CBC3-SHA:<span class="hljs-variable"><span class="hljs-variable">!RC4:!</span></span>aNULL:<span class="hljs-variable"><span class="hljs-variable">!eNULL:!</span></span>MD5:<span class="hljs-variable"><span class="hljs-variable">!EXPORT:!</span></span>EXP:<span class="hljs-variable"><span class="hljs-variable">!LOW:!</span></span>SEED:<span class="hljs-variable"><span class="hljs-variable">!CAMELLIA:!</span></span>IDEA:<span class="hljs-variable"><span class="hljs-variable">!PSK:!</span></span>SRP:<span class="hljs-variable"><span class="hljs-variable">!SSLv:!</span></span>aECDH:<span class="hljs-variable"><span class="hljs-variable">!EDH-DSS-DES-CBC3-SHA:!</span></span>EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA'; ssl_prefer_server_ciphers on; add_header Strict-Transport-Security "max-age=<span class="hljs-number"><span class="hljs-number">15768000</span></span>; includeSubDomains; preload;"; add_header X-Content-<span class="hljs-built_in"><span class="hljs-built_in">Type</span></span>-Options nosniff; add_header X-Frame-Options "SAMEORIGIN"; add_header X-XSS-Protection "<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">mode</span></span>=block"; add_header X-Robots-Tag none; add_header X-Download-Options noopen; add_header X-Permitted-Cross-Domain-Policies none; location = / { return <span class="hljs-number"><span class="hljs-number">301</span></span> https://otrs.HOST/otrs/customer.pl; } location /otrs-web { gzip on; alias /opt/otrs/var/httpd/htdocs; } location ~ ^/otrs/(.*.pl)(/.*)?$ { fastcgi_pass unix:/var/run/fcgiwrap.sock; fastcgi_index index.pl; fastcgi_param SCRIPT_FILENAME /opt/otrs/bin/fcgi-bin/$<span class="hljs-number"><span class="hljs-number">1</span></span>; include fastcgi_params; } }</code> </pre><br></div></div><br><h1>  Firewalld </h1><br>  Stop and mask NetworkManager. <br><br><pre> <code class="hljs sql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> NetworkManager systemctl <span class="hljs-keyword"><span class="hljs-keyword">mask</span></span> NetworkManager systemctl <span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> NetworkManager-<span class="hljs-keyword"><span class="hljs-keyword">wait</span></span>-online.service systemctl <span class="hljs-keyword"><span class="hljs-keyword">mask</span></span> NetworkManager-<span class="hljs-keyword"><span class="hljs-keyword">wait</span></span>-online.service</code> </pre><br>  We configure the Firewall, we will assume that the external interface is called <b>enp5s0</b> . <br><br><pre> <code class="hljs dos">firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --permanent --zone=external --change-interface=enp5s0 firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --permanent --zone=external --add-icmp-block=<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>-reply firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --permanent --zone=external --add-icmp-block=destination-unreachable firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --permanent --zone=external --add-icmp-block=<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>-request firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --permanent --zone=external --add-icmp-block=<span class="hljs-built_in"><span class="hljs-built_in">time</span></span>-exceeded firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --permanent --zone=external --add-icmp-block=parameter-problem firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --permanent --zone=external --add-service=http firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --permanent --zone=external --add-service=https firewall-<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> --reload</code> </pre><br>  Restart the firewall and check what happened. <br><br><pre> <code class="hljs pgsql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">restart</span></span> firewalld.service firewall-cmd <span class="hljs-comment"><span class="hljs-comment">--reload</span></span></code> </pre><br><h1>  Fastcgi </h1><br>  For the interaction of OTRS and Nginx, we need the FCGI wrapper.  Here the choice is not particularly great - use the Perl script from <a href="https://www.ruby-forum.com/topic/145858">Denis S. Filimonov,</a> or the <a href="https://github.com/gnosek/fcgiwrap">FastCGI wrapper from Grzegorz Nosek</a> .  As an example, I cite both options, but I will continue to use the latter. <br><br><h3>  fastcgi-wrapper.pl </h3><br><pre> <code class="hljs pgsql">wget http://nginxlibrary.com/downloads/perl-fcgi/fastcgi-<span class="hljs-keyword"><span class="hljs-keyword">wrapper</span></span> -O /usr/bin/fastcgi-<span class="hljs-keyword"><span class="hljs-keyword">wrapper</span></span>.pl</code> </pre><br>  To work through the Unix socket, insert into the <b>sub main</b> section <br><br><pre> <code class="hljs ruby">$socket = FCGI::OpenSocket( <span class="hljs-string"><span class="hljs-string">"/var/run/perl-fcgi/perl-fcgi.sock"</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span> );</code> </pre> <br>  and comment. <br><br><pre> <code class="hljs ruby">$socket = FCGI::OpenSocket( <span class="hljs-string"><span class="hljs-string">"127.0.0.1:8999"</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span> );</code> </pre> <br>  We also make the corresponding changes to the Nginx config. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">fastcgi_pass</span></span> unix:/var/run/perl-fcgi/perl-fcgi.sock;</code> </pre><br>  For his work wrote Systemd service. <br><br><pre> <code class="hljs pgsql">vi /etc/systemd/<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>/perl-fcgi.service</code> </pre><br><pre> <code class="hljs pgsql">[Unit] Description=Perl FastCGI service [Install] WantedBy=multi-<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.target [Service] <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>=otrs <span class="hljs-keyword"><span class="hljs-keyword">Group</span></span>=nginx <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>=simple <span class="hljs-keyword"><span class="hljs-keyword">Restart</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">always</span></span> PermissionsStartOnly=<span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ExecStartPre=/usr/bin/mkdir -p /var/run/perl-fcgi ExecStartPre=/usr/bin/chown otrs.nginx /var/run/perl-fcgi ExecStart=/usr/<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/bin/fastcgi-<span class="hljs-keyword"><span class="hljs-keyword">wrapper</span></span>.pl ExecStop=/usr/bin/rm -rf /var/run/perl-fcgi</code> </pre><br><h3>  fcgiwrap </h3><br>  Just download and install the <a href="">fcgiwrap</a> package <a href="">.</a> <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">yum</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">localinstall</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">fcgiwrap-1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0-3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.20150530git99c942c</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.el7</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.centos</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.x86_64</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.rpm</span></span></code> </pre><br>  and run it: <br><br><pre> <code class="hljs pgsql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> fcgiwrap.socket systemctl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> fcgiwrap.socket</code> </pre><br>  If someone has an attack of paranoia, here <a href="">srpm,</a> you can collect it yourself. <br><br><h1>  Mysql </h1><br>  We connect MariaDB repository. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">vi</span></span> /etc/yum.repos.d/MariaDB.repo</code> </pre><br><pre> <code class="hljs 1c"><span class="hljs-meta"><span class="hljs-meta"># http:</span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//downloads.mariadb.org/mariadb/repositories/ [mariadb] name = MariaDB baseurl = http://yum.mariadb.org/10.1/centos7-amd64 gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB gpgcheck=1</span></span></span></span></code> </pre><br>  Install MariaDB server. <br><br><pre> <code class="hljs sql">yum <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> &amp;&amp; yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> MariaDB-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span> MariaDB-<span class="hljs-keyword"><span class="hljs-keyword">client</span></span></code> </pre><br>  We start the service. <br><br><pre> <code class="hljs pgsql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> mysql</code> </pre><br>  Perform the initial setup. <br><br><pre> <code class="hljs">/usr/bin/mysql_secure_installation</code> </pre><br>  Create a database. <br><br><pre> <code class="hljs sql">mysql -u root -p <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> <span class="hljs-string"><span class="hljs-string">`otrs-db`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">character</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> utf8; <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> <span class="hljs-string"><span class="hljs-string">'USER'</span></span>@<span class="hljs-string"><span class="hljs-string">'localhost'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">identified</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-string"><span class="hljs-string">'PASS'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">GRANT</span></span> ALL <span class="hljs-keyword"><span class="hljs-keyword">PRIVILEGES</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-string"><span class="hljs-string">`otrs-db`</span></span>.* <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-string"><span class="hljs-string">`USER`</span></span>@<span class="hljs-string"><span class="hljs-string">`localhost`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">FLUSH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PRIVILEGES</span></span>; exit;</code> </pre><br>  Stop the service. <br><br><pre> <code class="hljs sql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> mysql</code> </pre><br>  For normal operation of OTRS, we make minor adjustments to server.cnf. <br><br><pre> <code class="hljs pgsql">vi /etc/my.cnf.d/<span class="hljs-keyword"><span class="hljs-keyword">server</span></span>.cnf</code> </pre><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">mysqld</span></span>] max_allowed_packet = <span class="hljs-number"><span class="hljs-number">20</span></span>M query_cache_size = <span class="hljs-number"><span class="hljs-number">32</span></span>M innodb_log_file_size = <span class="hljs-number"><span class="hljs-number">256</span></span>M</code> </pre><br>  In order for MySQL to start after changing the innodb_log_file_size parameter, you need to rename or delete old log files. <br><br><pre> <code class="hljs swift">mv /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/mysql/ib_logfile0 /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/mysql/ib_logfile0_1 mv /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/mysql/ib_logfile1 /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/mysql/ib_logfile1_1</code> </pre><br>  We start the service and add it to autoload. <br><br><pre> <code class="hljs pgsql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> mysql systemctl <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> mysql</code> </pre><br><h1>  OTRS </h1><br>  Installing dependencies. <br><br><pre> <code class="hljs sql">yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> bash-completion perl perl-<span class="hljs-keyword"><span class="hljs-keyword">Archive</span></span>-Zip perl-Crypt-SSLeay perl-DBI perl-IO-Socket-SSL perl-LDAP perl-Net-DNS perl-<span class="hljs-keyword"><span class="hljs-keyword">Template</span></span>-Toolkit perl-TimeDate perl-URI perl-<span class="hljs-keyword"><span class="hljs-keyword">XML</span></span>-LibXML perl-<span class="hljs-keyword"><span class="hljs-keyword">XML</span></span>-LibXSLT perl-<span class="hljs-keyword"><span class="hljs-keyword">XML</span></span>-Parser perl-Digest-<span class="hljs-keyword"><span class="hljs-keyword">SHA</span></span> perl-LWP-Authen-Negotiate perl-DBD-MySQL perl-YAML-LibYAML perl-Crypt-Eksblowfish perl-Mail-IMAPClient perl-<span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>-CSV_XS perl-core perl-libwww-perl procmail</code> </pre><br>  Disable SELINUX. <br><br><pre> <code class="hljs lua">vi /etc/selinux/<span class="hljs-built_in"><span class="hljs-built_in">config</span></span></code> </pre><br><pre> <code class="hljs">SELINUX=permissive</code> </pre><br>  Execute the command to disconnect without rebooting. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">setenforce</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br>  Download and unpack the archive OTRS. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">wget</span></span> http://ftp.otrs.org/pub/otrs/otrs-5.0.13.tar.gz tar -xvf otrs-<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">13</span></span>.tar.gz -C /opt/ mv /opt/otrs-<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">13</span></span> /opt/otrs cd /opt/otrs</code> </pre><br>  We create on the server "user otrs". <br><br><pre> <code class="hljs pgsql">useradd -d /opt/otrs/ -g nginx -s /sbin/<span class="hljs-keyword"><span class="hljs-keyword">nologin</span></span> -c <span class="hljs-string"><span class="hljs-string">'OTRS System User'</span></span> otrs</code> </pre><br>  Using the otrs.CheckModules.pl utility, we check for the presence of the necessary Perl modules and if everything is okay we continue further. <br><br><pre> <code class="hljs swift">su otrs -s /bin/bash -<span class="hljs-built_in"><span class="hljs-built_in">c</span></span> <span class="hljs-string"><span class="hljs-string">"/opt/otrs/bin/otrs.CheckModules.pl"</span></span></code> </pre><br>  Activate "Default Config Files". <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">cp</span></span> Kernel/Config.pm.dist Kernel/Config.pm for foo in var/cron/<span class="hljs-regexp"><span class="hljs-regexp">*.dist</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">do</span></span> mv <span class="hljs-variable"><span class="hljs-variable">$foo</span></span> var/cron/`basename <span class="hljs-variable"><span class="hljs-variable">$foo</span></span> .dist`; <span class="hljs-attribute"><span class="hljs-attribute">done</span></span> cp .procmailrc.dist .procmailrc cp .fetchmailrc.dist .fetchmailrc cp .mailfilter.dist .mailfilter</code> </pre><br>  We check that all required modules are installed. <br><br><pre> <code class="hljs pgsql">perl -cw /opt/otrs/bin/cgi-bin/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.pl /opt/otrs/bin/cgi-bin/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.pl syntax OK perl -cw /opt/otrs/bin/cgi-bin/customer.pl /opt/otrs/bin/cgi-bin/customer.pl syntax OK perl -cw /opt/otrs/bin/otrs.Console.pl /opt/otrs/bin/otrs.Console.pl syntax OK</code> </pre><br>  Configuring access rights to OTRS files. <br><br><pre> <code class="hljs cs">/opt/otrs/bin/otrs.SetPermissions.pl --otrs-user=otrs --web-<span class="hljs-keyword"><span class="hljs-keyword">group</span></span>=nginx</code> </pre><br>  We update the configuration and delete the cache. <br><br><pre> <code class="hljs swift">su otrs -s /bin/bash -<span class="hljs-built_in"><span class="hljs-built_in">c</span></span> <span class="hljs-string"><span class="hljs-string">"/opt/otrs/bin/otrs.Console.pl Maint::Config::Rebuild"</span></span>; su otrs -s /bin/bash -<span class="hljs-built_in"><span class="hljs-built_in">c</span></span> <span class="hljs-string"><span class="hljs-string">"/opt/otrs/bin/otrs.Console.pl Maint::Cache::Delete"</span></span>;</code> </pre><br>  We create systemd service OTRS. <br><br><pre> <code class="hljs pgsql">vi /etc/systemd/<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>/otrs.service</code> </pre><br><pre> <code class="hljs sql">[Unit] Description=OTRS <span class="hljs-keyword"><span class="hljs-keyword">Help</span></span> Desk. <span class="hljs-keyword"><span class="hljs-keyword">After</span></span>=network.target [Service] <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>=forking <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>=otrs <span class="hljs-keyword"><span class="hljs-keyword">Group</span></span>=nginx ExecStart=/opt/otrs/<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/otrs.Daemon.pl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> ExecStop=/opt/otrs/<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/otrs.Daemon.pl <span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Install</span></span>] WantedBy=multi-user.target</code> </pre><br>  We start services <br><br><pre> <code class="hljs pgsql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> nginx.service systemctl <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> otrs.service systemctl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> nginx.service systemctl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> otrs.service</code> </pre><br>  and go to the <a href="http://localhost/otrs/installer.pl">web interface</a> to complete the configuration. <br><br>  Push the "Forward" button. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/64e/370/230/64e370230f4c43e2a467460fe28d3e55.PNG"></div><br>  Accept user agreement. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f68/d3c/ae2/f68d3cae25b443508ea7c1691b33ed23.PNG"></div><br>  We choose the type of database, in my case it is MySQL. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/2ef/100/e19/2ef100e191704bd188059acd6b45bd6d.PNG"></div><br>  Enter your credentials: IP address and database name. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b52/906/1ec/b529061ecf0e4a10aa7b18b26f43987f.PNG"></div><br>  We check the connection and if everything goes fine. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/71d/736/804/71d736804dcf4f78aed8127928505bce.PNG"></div><br>  At this step, we select the numbering of tickets, specify the FQDN-server name and the account of the mailbox to which the letters will come. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/70d/68d/fe5/70d68dfe54554b21944c216a2c53c75c.PNG"></div><br>  Here we specify the settings of the mail server for receiving and sending mail. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/41c/3e1/4f2/41c3e14f25a54b50815dfa37c150cf6e.PNG"></div><br>  Go to the address we specified and log in to the WEB interface. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/9b4/262/b16/9b4262b16eec42debf831e76e33628a7.PNG"></div><br><br><h1>  Let's Encrypt </h1><br>  To get the Let's Encrypt certificate, you need to install CertBot. <br><br><pre> <code class="hljs sql">yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> certbot</code> </pre><br>  Here we indicate our mail and the domain name for which we receive the certificate. <br><br><pre> <code class="hljs scala">certbot certonly --webroot --email mail<span class="hljs-meta"><span class="hljs-meta">@HOST</span></span> -w /opt/otrs/<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/httpd/htdocs -d otrs.<span class="hljs-type"><span class="hljs-type">HOST</span></span></code> </pre><br>  Create a systemd service for CertBot to automatically renew the certificate. <br><br><pre> <code class="hljs pgsql">vi /etc/systemd/<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>/certbot.service</code> </pre><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">Unit</span></span>] Description=<span class="hljs-function"><span class="hljs-function">Renew Certbot </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">certificate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">nginx</span></span></span><span class="hljs-function">) After</span></span>=network-online.target [Service] Type=oneshot ExecStart=/usr/bin/certbot renew --renew-hook <span class="hljs-string"><span class="hljs-string">"/usr/bin/systemctl reload nginx.service"</span></span></code> </pre><br>  Create a timer <br><br><pre> <code class="hljs pgsql">vi /etc/systemd/<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>/certbot.timer</code> </pre><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">Unit</span></span>] Description=<span class="hljs-function"><span class="hljs-function">Renew Certbot </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">certificate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">nginx</span></span></span><span class="hljs-function">) [Timer] OnCalendar</span></span>=daily RandomizedDelaySec=<span class="hljs-number"><span class="hljs-number">1</span></span>day Persistent=<span class="hljs-literal"><span class="hljs-literal">true</span></span> [Install] WantedBy=timers.target</code> </pre><br>  And activate. <br><br><pre> <code class="hljs pgsql">sudo systemctl daemon-reload systemctl <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> certbot.timer systemctl <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> certbot.timer</code> </pre><br>  You can check the scheduled task with the command <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">systemctl</span></span> list-timers</code> </pre><br>  Create a file with parameters for DHE-cipher. <br><br><pre> <code class="hljs objectivec">openssl dhparam -<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> /etc/ssl/HOST/dhparam.pem <span class="hljs-number"><span class="hljs-number">2048</span></span></code> </pre><br>  Next, you need to uncomment the lines in the host configuration <br><br><pre> <code class="hljs nginx"><span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> otrs.HOST; <span class="hljs-attribute"><span class="hljs-attribute">rewrite</span></span><span class="hljs-regexp"><span class="hljs-regexp"> ^</span></span> https://<span class="hljs-variable"><span class="hljs-variable">$http_host</span></span><span class="hljs-variable"><span class="hljs-variable">$request_uri</span></span>? <span class="hljs-literal"><span class="hljs-literal">permanent</span></span>; }</code> </pre><br>  and comment out in the section with ssl. <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>;</code> </pre><br>  Then restart Nginx. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">systemctl</span></span> reloadt nginx.service</code> </pre><br><h1>  What else can you do? </h1><br><h3>  Automatic download of letters in tickets </h3><br>  By default, the mail server is polled once every 10 minutes to change this setting. <br><br>  OTRS: Administration ‚Üí System Administration ‚Üí System Configuration <br><br>  Insert Daemon :: SchedulerCronTaskManager :: Task into the ‚ÄúAction‚Äù field and click on ‚ÄúSearch‚Äù. <br>  Find the MailAccountFetch parameter and change the value from 10 minutes, for example, to 5. <br><br><h3>  Disable user registration via the Web interface </h3><br>  If there is no need to register users via the WEB interface, it should be disabled. <br><br>  Systems ‚Üí System configuration and in the ‚ÄúAction‚Äù field insert Frontend :: Customer and click on ‚ÄúSearch‚Äù.  Find the item CustomerPanelCreateAccount and select "No". </div><p>Source: <a href="https://habr.com/ru/post/311714/">https://habr.com/ru/post/311714/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../311700/index.html">"In all projects, they did exactly what they thought was necessary": Luxoft is about Java and not only</a></li>
<li><a href="../311702/index.html">Can I go to set up the equipment in Spain?</a></li>
<li><a href="../311704/index.html">How to design a super fast site</a></li>
<li><a href="../311706/index.html">Overview of deep convolutional neural network topologies</a></li>
<li><a href="../311708/index.html">How DLCs can increase the number of players: an example of Street Fighter V</a></li>
<li><a href="../311716/index.html">RetroBase - an analogue of Retrofit for database queries</a></li>
<li><a href="../311718/index.html">How much does it cost to enter the top cash categories of the app store and is there any point?</a></li>
<li><a href="../311720/index.html">WordCamp Europe in Vienna and the WordPress Development Vector</a></li>
<li><a href="../311722/index.html">All about Cisco FastLocation</a></li>
<li><a href="../311726/index.html">libsodium: Public-key authenticated encryption or how I decrypted the message without the private key</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>