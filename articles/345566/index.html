<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>My strategy for the Russian AI Cup 2017</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. 

 Astrologers have announced a week. It will be about the competition Russian AI Cup 2017 , or rather about the bot written by me. I have been...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>My strategy for the Russian AI Cup 2017</h1><div class="post__text post__text-html js-mediator-article">  Hello. <br><br>  <s>Astrologers have announced a week.</s> It will be about the competition <a href="http://russianaicup.ru/">Russian AI Cup 2017</a> , or rather about the bot written by me.  I have been participating in this competition for the 6th year in a row - starting from tanchik.  Some may know me by participating in the ML Boot Camp and HighLoad Cup. <br><br>  The place was taken (again) not the first, but there is something to write about the habr.  The article, first of all, may be of interest to the participants of this year, or those who want to learn some ideas for the next such competition, or just for those who are familiar with the subject of the Russian AI Cup. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/kc/zm/ur/kczmurmjtxpiz9dtjojuaff4enw.jpeg"><br><a name="habracut"></a><br>  I will not repeat the rules of the game.  Who is familiar with them - he is familiar, and who is not familiar - can watch a couple of leaderboard games.  <a href="http://russianaicup.ru/profile/tyamgin">Link to my profile.</a> <br><br>  The theme of this year was not very pleasant initially, but it was decided in advance that I would participate.  It was worth sending the first version, as the interest woke up sharply, and at least some ideas began to appear.  Therefore, who hesitates to participate or not in the next year, I advise you to send the very blockhead strategy.  Opinion can change a lot. <br><br>  The complexity of management has frightened off many participants, and especially newcomers.  The number of participants is record low.  And the majority of those who are in the top of the first three weeks, with obviously unpromising tactics.  But all this is just for me. <br><br>  Forces are spent on competition a lot.  I post 100% of my free time.  But this is not enough. <br><br>  Lyrical digression ended, move on to the description of his strategy. <br><br><h4>  Visualizer </h4><br>  A full-time technical visualizer in the local runner is not enough.  To draw debug information, you need to write your own, or use someone else's work.  On the very first day, I started adapting my last year‚Äôs simple, unprecedented Windows Forms visualizer to the new rules. <br><br>  It has a minimum of the necessary functionality: everything that a regular visualizer is able to do, as well as animation of selection, movement along a vector, capture of buildings, and other trifles. <br><br>  A short video of what it looks like: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/RZzGUmpA3QY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h4>  First version </h4><br>  As I wrote above, in order to feel the API, and in order for ideas to start to appear, you need to write at least some strategy.  Going ahead and clumsy "tornado" - a great strategy to test all subsequent versions, neatly "trimming" the enemy units. <br><br><h4>  It's time to write a basic strategy. </h4><br>  According to the experience of the past Russian AI Cup, a necessary component of a successful strategy was a bust of moves + an exact simulation of the game world.  What was most confusing was that a clear plan for the development of the strategy was not visible, as it was in past years.  The bet was made on a good microcontrol, and you can then think up the tactics after seeing what the rivals are doing.  While everything is settled there, you need to write a kernel that will not change much, and where it will be possible to increase the new functionality. <br><br>  The code architecture is very simple.  There is an object of type MyVehicle - a wrapper over the Model.Vehicle class, and a sandbox object (Sandbox).  The latter, in fact, is the God object.  He can be given any commands - all the same as Model.Move, and also simulate the world a few ticks ahead. <br><br>  Decision making is based on a global evaluation function.  There is one single function (hazard function), evaluating the state of the world, and returning a real number.  For 1 move, we strive to change the state of the world so that this number is as low as possible. <br><br>  I used the same idea in a previous CodeWizards competition.  Since  the wizard was only one (that is, two-dimensional space), it was possible to draw the value of the function in the form of a gradient scale ( <a href="https://www.youtube.com/watch%3Fv%3DpTVXVW2sYcI">link</a> to last year's video).  Here, 500 units (multidimensional space) with one common function, had to do without visualization. <br><br>  It will be more detailed later on how I calculated this function. <br><br>  Now you need to go through different moves.  The final option is to go through the following moves for each unit: <br><br><ul><li>  Nothing to do.  No orders are given, all continue to move in the same directions. </li><li>  Scale to the center of the squad. </li><li>  Scale from the center of the explosion of a nuclear bomb, if there is one.  With different factor. </li><li>  Rotate by ¬± 45 ¬∞. </li><li>  For ground-based equipment Move to capture the structure. </li><li>  For Move helicopters in the direction of armored personnel carriers to shelter from aircraft. </li><li>  For air Move equipment towards Arrv for treatment. </li><li>  Move in 12 directions for a fairly large distance (say, a quarter of a map). </li></ul><br>  This list was enough to cover all the variety of actions. <br><br><h4>  The calculation of the hazard function. </h4><br>  It consists of the sum of the following values ‚Äã‚Äã(with coefficients that were selected long and tediously): <br><br><ul><li>  <b>The total amount of health of their equipment.</b>  It also took into account the hidden pool of health, which replenished Arrv, so that the technique had a desire to be treated. </li><li>  <b>The total amount of health equipment of the enemy.</b> </li><li>  <b>The number of vehicles killed.</b> </li><li>  <b>The number of enemy vehicles killed.</b> </li><li>  <b>Potential damage from nuclear strikes.</b>  That is, it is as if a nuclear bomb would explode not through n ticks, but right now. </li><li>  <b>The number of points to capture buildings.</b> </li><li>  <b>Potential damage.</b>  It turned out something like a fine (exponentially decaying) for being in the affected area, or near it.  Namely, for each unit it is calculated (what damage it can do for 0 ticks) + (what damage it can do for 1 tick) / 2 + (what damage it can do for 2 ticks) / 4 +‚Ä¶.  All this without taking into account the cooldown, to be afraid of resting opponents, and not to break through them. </li></ul><br>  All items above are calculated for each unit individually, regardless of belonging to any unit. <br><br><ul><li>  <b>Penalty for collision units.</b>  For the conflict of units, or "almost" a conflict.  A fine for so much that it was more profitable to let a part of a detachment on cannon fodder than to go to the intersection with another detachment. </li></ul><br>  These are all melee factors.  Further, the most difficult.  How to make troops move to the enemy?  To the nearest, or most meaty?  How to make the troops flee from the enemy, hide the helicopters behind the armored personnel carriers?  How to make troops move to grab buildings?  How to make fly to be treated? <br><br>  Here you will need information about splitting into groups.  As well as clustering enemy units (only because debugging 5-7 groups is more convenient than 500). <br><br><ul><li> <b>Attracting / repulsive enemy fields.</b>  Double cycle in my units, enemy units ... one of the weakest and most distressful places of my strategy ... in general, there is a function that depends only on the types of units and their size (mixed units are rare, therefore we believe that they are not).  If, for example, I have 50 airplanes, the enemy has 50 helicopters, then the value of the function is very large positive.  If 50 tanks against 50 tanks, then a small positive.  If 50 helicopters against 50 aircraft, then a large negative.  If 50 helicopters against 1 aircraft, then a small negative (suddenly! 50 helicopters will not fly to 1 aircraft). <br><br>  This whole thing is multiplied by an exponentially decaying function of the distance between the groups.  The greater the distance - the less influence on the total amount.  It makes no sense to run to the goal on the opposite corner of the map, it is better to go to someone else closer. <br><br>  Also, all this is multiplied by the sum of the densities of the units, namely (the sum of the areas) ^ 0.25.  For heavily smeared units were compressed using SCALE. </li><li>  <b>Attractive fields to buildings.</b>  Here is the same scheme.  About how the buildings were distributed in groups below. </li><li>  <b>The attractive fields of helicopters to the BTR.</b>  Depends on the number of aircraft on the map, from the distance to the closest, the distance to the nearest ‚Äúpoint of cover‚Äù. </li><li>  <b>Attractive fields Arrv.</b>  Aviation in idle mode, or, when there is Arrv nearby, could use them.  The greater the loss of health, and the closer Arrv, the stronger the attracting field. </li></ul><br>  In general, all this has one fat plus and one fat minus.  Without crutches, you can add new items: nuclear, buildings, treatment.  Odds need to be constantly customized: to repair under some situations, but to break on others. <br><h4>  Simulation </h4><br>  To achieve high performance simulator data structure is needed, allowing you to quickly check the circle for collisions, and find neighbors in the vicinity of the battlefield. <br><br>  Shortly before the start of the contest, I watched the activity in the github repositories of the contest developers.  The <a href="">QuadTree.java</a> file was added to the <a href="https://github.com/Codeforces/codeforces-commons/">codeforces-commons</a> <a href="">repository</a> , and even then there were the first guesses that the competition would be with a large number of units.  Only after I started to implement my simulator, I remembered this structure, and began to use it.  After all, it is also used in the local runner.  In the above implementation, there was a lack of methods for deleting a point, changing the coordinates of a point (deleting and re-adding is inefficient), tree cloning.  I had to add them myself. <br><br>  Checking units for collisions is the most expensive operation in my code, and I hardly fit into the time limit. <br><br><h4>  Team manager </h4><br>  Team manager?  Prioritized queue for units?  Delayed and canceled commands?  All this is not.  As described above, all decisions are made only on the basis of the current situation, and knowing the last order for each unit.  The available actions are spread over 60 ticks evenly according to the TickIndex principle% 10 == 0. Calculations are too expensive to make from each tick. <br><br><h4>  Round 1 </h4><br>  It took several evenings to somehow adapt units like Arrv.  I decided to mix them with Tank and Ifv in a staggered manner.  The construction is not optimal, but so far it will come down. <br><br><div class="spoiler">  <b class="spoiler_title">Gif</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/qk/jp/9w/qkjp9wpaclbcpx51lloasq_wtsi.gif"><br></div></div><br>  By the beginning of the first round, I consistently defeated many leaders.  Involuntarily, one had to sharpen oneself for rivals like the ‚Äúsandwich‚Äù, although realizing that they are not suitable for the final.  Focused mainly on ud1 and GreenTea - their strategies were more similar to mine. <br><br><h4>  Preparation for the round 2. </h4><br>  By the second round, they had to learn how to seize buildings and manage production.  The kneading of Arrv units had to be thrown out.  It took too long - an average of 900 ticks.  Even with a potential optimization of 2 times it is still a lot, and the idea had to quit. <br><br>  Starting troops Arrv, Tank, Ifv, as well as newly built, ran to seize buildings to minimize the total path length.  This is a standard assignment problem solved by the Hungarian algorithm.  More than the building selection algorithm has not changed.  It was worth adding an account of the types of enemy equipment, but this did not seem to be a priority feature. <br><br>  The performance problem came not the first plan.  The number of units on the map has increased, the number of groups also, and therefore the number of various moves. <br><br>  About a week I spent on optimization.  It was necessary to optimize at the expense of accuracy.  Instead of simulating actions on the entire map, I did a simulation in the neighborhood of each group separately, and then glued the results. <br><br>  In order to avoid all kinds of embarrassment with nuclear bombs, I turned off these optimizations when there is at least one bomb on the map. <br><br>  I had to go further, and turn off collision checks when the groups move in a straight line, or spin. <br><br>  Well, the last thing - to sort through all 12 directions for the Move is meaningless if there are no enemies around. <br><br>  But no, not the last.  Groups with even numbers go on even turns, with odd numbers - on odd moves.  Just built (aka bums) - every third move.  There are exceptions for the detached units, both in the nuclear bomb mode and at the beginning of the game (&lt;3000 ticks). <br><br><h4>  Preparation for the final </h4><br>  In the final, it was necessary to control the number of enemy units, and where approximately they are located.  For each unit, Id remembered where it was last seen.  There are 3 arrays: <br><br>  Normal array of visible technology (visible) <br><br>  An array of proven invisible technology (checked).  It is known where each Id was last seen, but it is certain that it is no longer there. <br><br>  An array of unverified invisible technology (unchecked).  This means that we have to explore this territory for the presence of the enemy. <br><br>  Filling arrays is as follows: <br><br><ul><li>  At the beginning of the game we fill unchecked symmetrically to our units.  This gives at least some starting point.  Patterns in Id could not be found, but this is not a problem, you can generate them lazily by the first appearance. <br><br><div class="spoiler">  <b class="spoiler_title">What it looks like</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/QRGUnuNoSSc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div></li><li>  At the beginning of each tick we shift from unchecked to checked, if the point has become visible, and also from visible to unchecked, if the unit has disappeared from the scope.  If the unit remains in sight, but its Durability is 0, then it is killed. <br></li><li>  Game simulator puts Id in the order of the appearance of new technology.  There is all the information to accurately determine where and when a new unit will appear, with which Id, and with what type.  Collisions when in one tick several units appear are quite rare. </li></ul><br>  The radius of visibility is large enough to accurately determine whether the unit was killed, or disappeared from view.  The exception is the destruction of a nuclear strike, but this is a very rare case.  Therefore, "dead souls" almost did not remain. <br><br>  The same QuadTree coped with a quick check for visibility, especially since it needs to be done 1 time per tick. <br><br>  This is, perhaps, all that was done to support the game in the fog of war. <br><br><hr><br>  I did not overcome the time limits, my program is still with some opponents on some cards that does not fit into 220 seconds.  But, nevertheless, he manages to ensure an advantage on points before a fall. <br><br>  A little bit unlucky in the final - in the end I took the 4th place, and in the sandbox I took the 2nd.  Next time will be stronger. <br><br>  Thanks to all.  See you in the Russian AI Cup 2018, and with someone, maybe even earlier. <br><br><hr><br>  <a href="https://github.com/tyamgin/AiCup/tree/master/CodeWars">Code</a> </div><p>Source: <a href="https://habr.com/ru/post/345566/">https://habr.com/ru/post/345566/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345546/index.html">Asynchronous loading of large datasets into Tensorflow</a></li>
<li><a href="../345550/index.html">How EdTech Leaders Earn</a></li>
<li><a href="../345552/index.html">Service Workers. Instructions for use</a></li>
<li><a href="../345556/index.html">Load testing "non-HTTP". Part 1 JMeter</a></li>
<li><a href="../345560/index.html">New C ++ 17 that everyone should use</a></li>
<li><a href="../345570/index.html">Checklist of troubles that may occur when moving</a></li>
<li><a href="../345574/index.html">Tcl / Tk - creating extensions / packages based on dynamic libraries</a></li>
<li><a href="../345576/index.html">Developing AI for a turn-based game on Node.js (part 1)</a></li>
<li><a href="../345578/index.html">Bitcoin will not become new digital money: limited emission and money functions</a></li>
<li><a href="../345580/index.html">Build and heat applications in Kubernetes using dapp and GitLab CI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>