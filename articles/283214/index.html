<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>AngularJS and Ruby on Rails Single Page Application Building Architecture</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Having become interested in the methodology for building SPA applications on Ruby on Rails, I came up with some ideas that are now being implemented i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>AngularJS and Ruby on Rails Single Page Application Building Architecture</h1><div class="post__text post__text-html js-mediator-article">  Having become interested in the methodology for building SPA applications on Ruby on Rails, I came up with some ideas that are now being implemented in each of my applications and were even later singled out into a separate <a href="https://github.com/storuky/oxymoron">Oxymoron</a> gem.  Currently, Oxymoron has more than 20 fairly large commercial rail applications written.  I want to bring heme to public court.  Therefore, I will continue my further narration on its basis. <br><br>  <a href="https://github.com/storuky/oxymoron_app">An example of a</a> finished application. <br><a name="habracut"></a><br><h2>  What tasks does Oxymoron solve? </h2><br>  For me, this gem reduces the amount of routine code by an order of magnitude and, as a result, significantly increases the speed of development.  It makes it very easy to build AngularJS + RoR interaction. <br><br><ol><li>  Automatic construction of AngularJS routing based on routes.rb </li><li>  Autogenerating AngularJS resources from routes.rb </li><li>  Set architectural strictness for AngularJS controllers </li><li>  Registering constantly used configs </li><li>  Validation of forms </li><li>  FormBuilder automatically ng-model </li><li>  Notification </li><li>  Frequently used directives (ajax fileupload, click-outside, content-for, check-list) </li><li>  Implementation of a compact analog JsRoutes </li></ol><br><h2>  How it works? </h2><br>  First of all, it is necessary to connect gems in the Gemfile: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="ruby hljs">gem <span class="hljs-string"><span class="hljs-string">'oxymoron'</span></span></code> </pre> <br>  Now, each time you change <b>routes.rb</b> , or when you restart the application, the file <b>oxymoron.js</b> will be generated in <b>app / assets / javascripts</b> , containing all the necessary code for building the application. <br><br>  The next step is to configure the assets.  In the simplest case, it looks like this: <br><br>  <i>For application.js:</i> <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* = require oxymoron/underscore = require oxymoron/angular = require oxymoron/angular-resource = require oxymoron/angular-cookies = require oxymoron/angular-ui-router = require oxymoron/ng-notify = require oxymoron = require_self = require_tree ./controllers */</span></span></code> </pre><br>  <i>For application.css:</i> <br><br><pre> <code class="css hljs"><span class="hljs-comment"><span class="hljs-comment">/* *= require oxymoron/ng-notify *= require_self */</span></span></code> </pre><br>  We use the UI Router, which means you need to define the ui-view tag in our layout.  Since the application will use HTML5 routing, you must specify a base tag.  In our case, this is application.html.slim.  I use <a href="http://slim-lang.com/">SLIM</a> as a preprocessor and strongly recommend it to everyone. <br><br><pre> <code class="hljs vhdl">html ng-app=<span class="hljs-string"><span class="hljs-string">"app"</span></span> head title  base href=<span class="hljs-string"><span class="hljs-string">"/"</span></span> = stylesheet_link_tag <span class="hljs-symbol"><span class="hljs-symbol">'application</span></span>' <span class="hljs-keyword"><span class="hljs-keyword">body</span></span> ui-<span class="hljs-keyword"><span class="hljs-keyword">view</span></span> = javascript_include_tag <span class="hljs-symbol"><span class="hljs-symbol">'application</span></span>'</code> </pre><br>  For all AJAX requests, you must disable layout.  To do this, in ApplicationController we write the necessary logic: <br><br><pre> <code class="ruby hljs">layout proc { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> request.xhr? <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">"application"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> }</code> </pre><br>  For correct processing of forms and setting up of ng-model, it is necessary to create an initializer that overrides the default FormBuilder on OxymoronFormBuilder. <br><br><pre> <code class="ruby hljs">ActionView::Base.default_form_builder = OxymoronFormBuilder</code> </pre><br>  The last thing you need to do is inject the oxymoron module into your application and inform the UI Router that the automatically generated routing will be used: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> app = angular.module(<span class="hljs-string"><span class="hljs-string">"app"</span></span>, [<span class="hljs-string"><span class="hljs-string">'ui.router'</span></span>, <span class="hljs-string"><span class="hljs-string">'oxymoron'</span></span>]); app.config([<span class="hljs-string"><span class="hljs-string">'$stateProvider'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$stateProvider</span></span></span><span class="hljs-function">) </span></span>{ $stateProvider.rails() }])</code> </pre><br>  Everything is ready to create a full-fledged SPA application! <br><br><h2>  Let's write the simplest SPA blog </h2><br>  So.  First we will prepare a Post model and a RESTful controller for managing this model.  To do this, run the commands in the console: <br><br><pre> <code class="bash hljs">rails g model post title:string description:text rake db:migrate rails g controller posts index show</code> </pre><br>  In routes.rb, create a posts resource: <br><br><pre> <code class="ruby hljs">Rails.application.routes.draw <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> root <span class="hljs-symbol"><span class="hljs-symbol">to:</span></span> <span class="hljs-string"><span class="hljs-string">"posts#index"</span></span> resources <span class="hljs-symbol"><span class="hljs-symbol">:posts</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  Now we will describe the methods of our controller.  Often, the same method can return both JSON structures and HTML markup in the response, such methods need to be wrapped in <b>respond_to</b> . <br><br><div class="spoiler">  <b class="spoiler_title">An example of a typical Rails controller</b> <div class="spoiler_text"><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostsController</span></span></span><span class="hljs-class"> &lt; ActiveRecord::Base </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">before_action</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">set_post</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">only</span></span></span><span class="hljs-class">: [:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">show</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">edit</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">update</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">destroy</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">index</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">respond_to</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> |</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">format</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">format</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">html</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">format</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">json</span></span></span><span class="hljs-class"> { @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">posts</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Post</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">all</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">render</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">json</span></span></span><span class="hljs-class">: @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">posts</span></span></span><span class="hljs-class"> } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">show</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">respond_to</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> |</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">format</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">format</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">html</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">format</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">json</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">render</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">json</span></span></span><span class="hljs-class">: @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">post</span></span></span><span class="hljs-class"> } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">respond_to</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> |</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">format</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">format</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">html</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">format</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">json</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">render</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">json</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Post</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">edit</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">respond_to</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> |</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">format</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">format</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">html</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">format</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">json</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">render</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">json</span></span></span><span class="hljs-class">: @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">post</span></span></span><span class="hljs-class"> } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">create</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">post</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Post</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">post_params</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">post</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">save</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">render</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">json</span></span></span><span class="hljs-class">: {</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">post</span></span></span><span class="hljs-class">: @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">post</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg</span></span></span><span class="hljs-class">: "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Post</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">successfully</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">created</span></span></span><span class="hljs-class">", </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">redirect_to</span></span></span><span class="hljs-class">: "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">posts_path</span></span></span><span class="hljs-class">"} </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">else</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">render</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">json</span></span></span><span class="hljs-class">: {</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">errors</span></span></span><span class="hljs-class">: @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">post</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">errors</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg</span></span></span><span class="hljs-class">: @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">post</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">errors</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">full_messages</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">join</span></span></span><span class="hljs-class">(', ')}, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">status</span></span></span><span class="hljs-class">: 422 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">update</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">post</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">update</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">post_params</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">render</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">json</span></span></span><span class="hljs-class">: {</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">post</span></span></span><span class="hljs-class">: @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">post</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg</span></span></span><span class="hljs-class">: "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Post</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">successfully</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">updated</span></span></span><span class="hljs-class">", </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">redirect_to</span></span></span><span class="hljs-class">: "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">posts_path</span></span></span><span class="hljs-class">"} </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">else</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">render</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">json</span></span></span><span class="hljs-class">: {</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">errors</span></span></span><span class="hljs-class">: @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">post</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">errors</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg</span></span></span><span class="hljs-class">: @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">post</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">errors</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">full_messages</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">join</span></span></span><span class="hljs-class">(', ')}, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">status</span></span></span><span class="hljs-class">: 422 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">destroy</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">post</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">destroy</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">render</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">json</span></span></span><span class="hljs-class">: {</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg</span></span></span><span class="hljs-class">: "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Post</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">successfully</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">deleted</span></span></span><span class="hljs-class">"} </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">set_post</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">post</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Post</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">find</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">params</span></span></span><span class="hljs-class">[:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">]) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">post_params</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">params</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">require</span></span></span><span class="hljs-class">(:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">post</span></span></span><span class="hljs-class">).</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">permit</span></span></span><span class="hljs-class">(:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">description</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br></div></div><br>  Each Rails controller has an AngularJS controller.  The matching rule is very simple: <br><br><pre> <code class="ruby hljs">PostsController =&gt; PostsCtrl Admin::PostsController =&gt; AdminPostsCtrl <span class="hljs-comment"><span class="hljs-comment">#    namespace Admin</span></span></code> </pre><br>  Create the appropriate controller in <b>app / javascripts / controllers / post_ctrl.js</b> : <br><br><div class="spoiler">  <b class="spoiler_title">An example of a typical AngularJS controller</b> <div class="spoiler_text"><pre> <code class="javascript hljs">app.controller(<span class="hljs-string"><span class="hljs-string">'PostsCtrl'</span></span>, [<span class="hljs-string"><span class="hljs-string">'Post'</span></span>, <span class="hljs-string"><span class="hljs-string">'action'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Post, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ctrl = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     '/posts' action('index', function(){ ctrl.posts = Post.query(); }); //    '/posts/:id' action('show', function (params){ ctrl.post = Post.get({id: params.id}); }); //   '/posts/new' action('new', function(){ ctrl.post = Post.new(); //   ,       . . . ctrl.save = Post.create; }); //   '/posts/:id/edit' action('edit', function (params){ ctrl.post = Post.edit({id: params.id}); //      ctrl.save = Post.update; }) //  .     edit  new. action(['edit', 'new'], function(){ // }) action(['index', 'edit', 'show'], function () { ctrl.destroy = function (post) { Post.destroy({id: post.id}, function () { ctrl.posts = _.select(ctrl.posts, function (_post) { return _post.id != post.id }) }) } }) //     routes.rb     .  : '/posts/some_method' action('some_method', function(){ // }) // etc }])</span></span></code> </pre><br></div></div><br>  Pay attention to the <b>action</b> factory.  With it, it is very convenient to share code between application pages.  The factory is resolved through the generated state in oxymoron.js and, as a result, knows the current rail method of the controller. <br><br><pre> <code class="javascript hljs">action([<span class="hljs-string"><span class="hljs-string">'edit'</span></span>, <span class="hljs-string"><span class="hljs-string">'new'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      posts/new  posts/:id/edit })</span></span></code> </pre><br>  Next you should pay attention to the <b>Post</b> factory.  This factory is automatically generated from the resource defined in routes.rb.  For proper generation, the resource must have a show method defined.  The following methods of working with the resource are available from the box: <br><br><pre> <code class="javascript hljs">Post.query() <span class="hljs-comment"><span class="hljs-comment">// =&gt; GET /posts.json Post.get({id: id}) // =&gt; GET /posts/:id.json Post.new() // =&gt; GET /posts/new.json Post.edit({id: id}) // =&gt; GET /posts/:id/edit.json Post.create({post: post}) // =&gt; POST /posts.json Post.update({id: id, post: post}) // =&gt; PUT /posts/:id.json Post.destroy({id: id}) // =&gt; DELETE /posts/:id.json</span></span></code> </pre><br>  Custom resource methods (member and collection) work the same way.  For example: <br><br><pre> <code class="ruby hljs">resources <span class="hljs-symbol"><span class="hljs-symbol">:posts</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> member <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> get <span class="hljs-string"><span class="hljs-string">"comments"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">is_array:</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  Will create the appropriate method for the AngularJS resource: <br><br><pre> <code class="javascript hljs"> Post.comments({<span class="hljs-attr"><span class="hljs-attr">id</span></span>: id}) <span class="hljs-comment"><span class="hljs-comment">//=&gt; posts#comments</span></span></code> </pre><br>  Set the <b>is_array</b> option <b>: true</b> if it is expected that an array is expected in response.  Otherwise, AngularJS will throw an exception. <br><br>  It remains to create the missing view. <br><br><div class="spoiler">  <b class="spoiler_title">posts / index.html.slim</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">h1 Posts <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>.form-control <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>="text" ng-model="search" placeholder="" br <span class="hljs-keyword"><span class="hljs-keyword">table</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">table</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">table</span></span>-bordered thead tr th <span class="hljs-type"><span class="hljs-type">Date</span></span> th Title th tbody tr ng-repeat="post in ctrl.posts | filter:search" td ng-bind="post.created_at | date:'dd.MM.yyyy'" td a ui-sref="post_path(post)" ng-bind="post.title" td.w1 a.btn.btn-danger ng-click="ctrl.destroy(post)"  a.btn.btn-<span class="hljs-keyword"><span class="hljs-keyword">primary</span></span> ui-sref="edit_post_path(post)" </code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">posts / show.html.slim</b> <div class="spoiler_text"><pre> <code class="hljs perl">.small ng-<span class="hljs-keyword"><span class="hljs-keyword">bind</span></span>=<span class="hljs-string"><span class="hljs-string">"ctrl.post.created_at | date:'dd.MM.yyyy'"</span></span> a.btn.btn-primary ui-sref=<span class="hljs-string"><span class="hljs-string">"edit_post_path(ctrl.post)"</span></span>  a.btn.btn-danger ng-click=<span class="hljs-string"><span class="hljs-string">"ctrl.destroy(ctrl.post)"</span></span>  h1 ng-<span class="hljs-keyword"><span class="hljs-keyword">bind</span></span>=<span class="hljs-string"><span class="hljs-string">"ctrl.post.title"</span></span> p ng-<span class="hljs-keyword"><span class="hljs-keyword">bind</span></span>=<span class="hljs-string"><span class="hljs-string">"ctrl.post.description"</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">posts / new.html.slim</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">h1 <span class="hljs-built_in"><span class="hljs-built_in">New</span></span> post = render <span class="hljs-string"><span class="hljs-string">'form'</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">posts / edit.html.slim</b> <div class="spoiler_text"><pre> <code class="hljs mel">h1 Edit post = <span class="hljs-keyword"><span class="hljs-keyword">render</span></span> <span class="hljs-string"><span class="hljs-string">'form'</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">posts / _form.html.slim</b> <div class="spoiler_text"><pre> <code class="hljs ruby">= form_for Post.new <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|f|</span></span> div = f.label <span class="hljs-symbol"><span class="hljs-symbol">:title</span></span> = f.text_field <span class="hljs-symbol"><span class="hljs-symbol">:title</span></span> div = f.label <span class="hljs-symbol"><span class="hljs-symbol">:description</span></span> = f.text_area <span class="hljs-symbol"><span class="hljs-symbol">:description</span></span> = f.submit <span class="hljs-string"><span class="hljs-string">"Save"</span></span></code> </pre><br></div></div><br>  Particular attention should be paid to the result of generating the form_for helper. <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-submit</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"formQuery = ctrl.save({form_name: 'post', id: ctrl.post.id, post: ctrl.post}); $event.preventDefault();"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  It is enough to define the ctrl.save method inside the controller and it will be executed each time the form is submitted and transfer the parameters that you see.  But since these parameters are ideal as arguments for the update and create resource methods, we can only write <b>ctrl.save = Post.create</b> in our controller.  In the PostsCtrl listing, this moment is marked with a corresponding comment. <br><br>  For the <b>text_field</b> and <b>text_area</b> tags, the <b>ng-model</b> attribute was automatically added.  The rule of ng-model is the following: <br><br><pre> <code class="ruby hljs">ng-model=<span class="hljs-string"><span class="hljs-string">"ctrl._._"</span></span></code> </pre><br><h2>  Json render functionality: {} </h2><br>  In the PostsController rail listing you probably noticed the msg, redirect_to, and so on fields in the render method.  For these fields, a special interceptor works, which takes the necessary action before transmitting the result to the controller. <br><br>  <b>msg</b> - the content will be shown in a green pop-up at the top of the screen.  If you pass an error status to render, the color will change to red. <br><br>  <b>errors</b> - takes the errors object, serves to display the errors of the form fields themselves. <br><br>  <b>redirect_to</b> - redirect to the necessary UI Router state <br><br>  <b>redirect_to_options</b> - if the state requires an option, for example, the show page requires an id, then you must specify them in this field <br><br>  <b>redirect_to_url</b> - go to the specified url <br><br>  <b>reload</b> - completely reload the page to the user <br><br>  All these actions occur without reloading the user‚Äôs page.  Uses HTML5 routing based on UI Router. <br><br><h2>  Now without link_to </h2><br>  We used to use the <b>link_to</b> helper when we wanted to define a link depending on the name of the route.  Now this feature is implemented by <a href="http://angular-ui.github.io/ui-router/site/">ui-sref</a> in our usual manner of describing the route. <br><br><pre> <code class="hljs nginx"> <span class="hljs-attribute"><span class="hljs-attribute">a</span></span> ui-sref=<span class="hljs-string"><span class="hljs-string">"posts_path"</span></span>   a ui-sref=<span class="hljs-string"><span class="hljs-string">"post_path({id: 2})"</span></span>  ‚Ññ<span class="hljs-number"><span class="hljs-number">2</span></span> a ui-sref=<span class="hljs-string"><span class="hljs-string">"edit_post_path({id: 2})"</span></span>   ‚Ññ<span class="hljs-number"><span class="hljs-number">2</span></span> a ui-sref=<span class="hljs-string"><span class="hljs-string">"new_post_path"</span></span>   </code> </pre><br><h2>  Lightweight analog js-routes.  CONFLICT </h2><br>  In the global scope, you can find the variable Routes.  It works almost exactly the same way as js-routes.  The only difference is that this implementation accepts only the object and does not have sugar in the form of a number argument.  A conflict is possible, so I recommend disabling js-routes. <br><br><pre> <code class="javascript hljs">Routes.posts_path() <span class="hljs-comment"><span class="hljs-comment">// =&gt; "/posts" Routes.new_post_path() // =&gt; "/post/new" Routes.edit_posts_path({id: 1}) // =&gt; "/post/1/edit" //    Routes.defaultParams = {id: 1} Routes.post_path({format: 'json'}) // =&gt; "/posts/1.json"</span></span></code> </pre><br><h2>  Total </h2><br>  We wrote a primitive SPA application.  In this case, the code looks absolutely rail, the logic described at least, and the one that is already, is the most common.  I understand that there is no limit to perfection and that Oxymoron is far from ideal, however, I hope that I could interest someone with my approach.  I will be glad to any criticism and any positive participation in the life of the heme. <br><br>  <a href="https://github.com/storuky/oxymoron_app">An example of a</a> finished application. </div><p>Source: <a href="https://habr.com/ru/post/283214/">https://habr.com/ru/post/283214/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../283202/index.html">Laboratory: Rust - let's talk about Rust in Kaspersky Lab on May 17</a></li>
<li><a href="../283204/index.html">We build a pre-built dylib into the application.</a></li>
<li><a href="../283208/index.html">Using Matalysis in computer games (part 3)</a></li>
<li><a href="../283210/index.html">We are looking for vulnerabilities using google</a></li>
<li><a href="../283212/index.html">Big Data from A to Z. Part 5.1: Hive - SQL engine over MapReduce</a></li>
<li><a href="../283216/index.html">The law ‚ÄúOn Personal Data‚Äù and the practice of its application in Russian reality. Part 2</a></li>
<li><a href="../283218/index.html">Yandex Translate for Visual Studio Code</a></li>
<li><a href="../283220/index.html">Data transfer: fantastic speed and new methods</a></li>
<li><a href="../283222/index.html">Access to the Firebird database from YII2</a></li>
<li><a href="../283224/index.html">An interesting way to deliver malware or how ‚Äúhackers‚Äù break into ‚Äúscammers‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>