<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to create your first secure, ready-to-use web server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this guide, we will look at some of the best practices for creating your first secure server . We will step through the entire process step by step...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to create your first secure, ready-to-use web server</h1><div class="post__text post__text-html js-mediator-article">  In this guide, we will look at some of the best practices for creating your first <b>secure server</b> .  We will step through the entire process step by step, and as a result we will get a server that is fully ready for use in <b>production</b> for your application.  Of course, this is not an exhaustive guide.  A secure server is a constant search for new resources and endless improvements.  But with this material you can start creating your own infrastructure. <br><br>  To run the tests, we will use Amazon EC2, but you can take Amazon LightSail, Digital Ocean, Vultr, or another service.  All of them are configured the same, so choose the one that you like. <br><br><img src="https://habrastorage.org/webt/el/bm/t_/elbmt_gulj3i79vrnfu6qy97etc.jpeg"><br><a name="habracut"></a><br><h2>  Create public and private SSH keys </h2><br>  First, create a pair of keys that some hosts will need when installing the server.  You can skip this and some other steps if you decide to create your own pair of keys when starting the server on Amazon. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We will create SSH keys using ssh-keygen. <br><br><pre><code class="hljs ruby">$ ssh-keygen -t rsa -b <span class="hljs-number"><span class="hljs-number">4096</span></span></code> </pre> <br>  As a result, we get two files: id_rsa and id_rsa.pub (private and public keys).  <b>Never</b> pass your private key <b>to anyone</b> . <br><br>  Detailed instructions for creating keys can be found <a href="https://help.github.com/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent/">here</a> . <br><br><h2>  Importing a public key into Amazon </h2><br>  We import the newly created public key into the Amazon platform. <br><br><ol><li>  Go to the <a href="https://us-west-2.console.aws.amazon.com/console/home">management console Amazon</a> . </li><li>  Click AWS services ‚Üí Compute&gt; EC2 </li><li>  Click on the left menu Network &amp; Security ‚Üí Key Pairs </li><li>  Click ‚ÄúImport Key Pair‚Äù and load the public key (id_rsa.pub) </li></ol><br><h2>  Create your virtual machine </h2><br>  Install a virtual machine running Ubuntu in Amazon EC2.  The setting is described in detail <a href="https://aws.amazon.com/getting-started/tutorials/launch-a-virtual-machine">here</a> : <br><br><ol><li>  Go to the <a href="https://us-west-2.console.aws.amazon.com/console/home">management console Amazon</a> . </li><li>  Click AWS services ‚Üí Compute ‚Üí EC2 </li><li>  Select the instance to run. </li><li>  Choose one of the images.  In our case, it will be Ubuntu Server 16.04 LTS (HVM), with an SSD-drive (but you can choose what suits you best). </li><li>  Choose a virtual machine (according to your needs).  Click ‚ÄúReview‚Äù and ‚ÄúLaunch‚Äù. </li><li>  Open a new tab and import the created public key into Amazon. </li><li>  Here we will be asked to ‚Äúchoose an existing key pair or create a new key pair‚Äù.  Click "select an existing key pair").  Select the previously loaded key. </li><li>  Click ‚ÄúLaunch Instances‚Äù. </li><li>  Click on the link of the virtual machine that we just created. </li></ol><br>  Warning: some of the following steps can be configured on the Amazon home screen.  But since this is a general guide that can be used for other services, we‚Äôll talk about default configurations. <br><br><h2>  Connect to the new server </h2><br>  We are accessing the virtual machine via SSH. <br><br>  We write in the terminal: <br><br><pre> <code class="hljs xml">$ ssh <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">USR</span></span></span><span class="hljs-tag">&gt;</span></span>@<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">IP-ADDRSS</span></span></span><span class="hljs-tag">&gt;</span></span> -p 22 -i <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PATH-TO-PRIVT-KEY</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><ul><li>  <code>&lt;USR&gt;</code> : Linux user.  In the case of Amazon, use ubuntu, on other services - root </li><li>  <code>&lt;IP-ADDRSS&gt;</code> : The IP address of the virtual machine we created.  This field is "Public DNS (IPv4)" in the tab "Description" of our server. </li><li>  <code>&lt;PATH-TO-PRIVAT-KEY&gt;</code> : the full path to the previously generated private key (for example, /Users/flavio/.ssh/id_rsa). </li><li>  <code>-i &lt;PATH-TO-PRIVAT-KEY&gt;</code> : you can skip this if you added the key to your SSH agent. </li></ul><br><h2>  We give access to the new user </h2><br>  Create a new user account named ‚Äúwizard‚Äù: <br><br><pre> <code class="hljs ruby">$ sudo adduser wizard</code> </pre> <br>  Give the ‚Äúwizard‚Äù permission to execute sudo.  Open the file: <br><br><pre> <code class="hljs ruby">$ sudo nano /etc/sudoers.d/wizard</code> </pre> <br>  And set the content: <br><br><pre> <code class="hljs pgsql">wizard <span class="hljs-keyword"><span class="hljs-keyword">ALL</span></span>=(<span class="hljs-keyword"><span class="hljs-keyword">ALL</span></span>) NOPASSWD:<span class="hljs-keyword"><span class="hljs-keyword">ALL</span></span></code> </pre> <br>  Create directories: <br><br><pre> <code class="hljs pgsql">$ mkdir /home/wizard/.ssh # <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> authorized_keys file <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">copy</span></span> your <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> key here $ nano /home/wizard/.ssh/authorized_keys $ chown wizard /home/wizard/.ssh $ chown wizard /home/wizard/.ssh/authorized_keys</code> </pre> <br>  Copy the public key (PATH-TO-PUBLIC-KEY) and paste it into the remote instance /home/wizard/.ssh/authorized_keys.  Set permissions: <br><br><pre> <code class="hljs perl">$ <span class="hljs-keyword"><span class="hljs-keyword">chmod</span></span> <span class="hljs-number"><span class="hljs-number">700</span></span> /home/wizard/.ssh $ <span class="hljs-keyword"><span class="hljs-keyword">chmod</span></span> <span class="hljs-number"><span class="hljs-number">600</span></span> /home/wizard/.ssh/authorized_keys</code> </pre> <br><h2>  We provide security </h2><br>  We update all installed packages. <br><br><pre> <code class="hljs pgsql">$ sudo apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> $ sudo apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> upgrade</code> </pre> <br>  Change the SSH port from 22 to 2201. To configure the firewall (ufw, Uncomplicated Firewall, simple firewall), open the file / etc / ssh / sshd_config: <br><br><pre> <code class="hljs ruby">$ sudo nano /etc/ssh/sshd_config</code> </pre> <br>  and change this data: <br><br><pre> <code class="hljs pgsql">Port <span class="hljs-number"><span class="hljs-number">2201</span></span> PermitRootLogin <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> PasswordAuthentication <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> # <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> this <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> avoid problem <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> multiple sshd processes ClientAliveInterval <span class="hljs-number"><span class="hljs-number">600</span></span> ClientAliveCountMax <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br>  Restart the SSH service: <br><br><pre> <code class="hljs pgsql">$ sudo service ssh <span class="hljs-keyword"><span class="hljs-keyword">restart</span></span></code> </pre> <br>  Configure Uncomplicated Firewall (UFW) so that only incoming SSH connections (port 2201), HTTP (port 80), and NTP (port 123) are passed through. <br><br><pre> <code class="hljs vhdl"># close <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> incoming ports $ sudo ufw <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> deny incoming # <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> outgoing ports $ sudo ufw <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> allow outgoing # <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> ssh <span class="hljs-keyword"><span class="hljs-keyword">port</span></span> $ sudo ufw allow <span class="hljs-number"><span class="hljs-number">2201</span></span>/tcp # <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> http <span class="hljs-keyword"><span class="hljs-keyword">port</span></span> $ sudo ufw allow <span class="hljs-number"><span class="hljs-number">80</span></span>/tcp # <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> ntp <span class="hljs-keyword"><span class="hljs-keyword">port</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> sync the clock <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> your machine $ sudo ufw allow <span class="hljs-number"><span class="hljs-number">123</span></span>/udp # turn <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> firewall $ sudo ufw enable</code> </pre> <br><h2>  Configuring server clocks </h2><br>  Set as local time zone UTC: <br><br><pre> <code class="hljs ruby">$ sudo dpkg-reconfigure tzdata</code> </pre> <br>  Select the option 'None of the Above' and again UTC. <br><br><h2>  Disconnect and add our key to the SSH agent </h2><br>  To disable we enter: <br><br><pre> <code class="hljs pgsql">$ <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span></code> </pre> <br>  and then add the key. <br><br><h2>  Adding Port Permissions to Amazon </h2><br>  This must be done in Amazon.  Let's set the SSH port, which we will use also on Amazon. <br><br><ol><li>  Go to the <a href="https://us-west-2.console.aws.amazon.com/console/home">management console Amazon</a> . </li><li>  Click AWS services&gt; Compute&gt; EC2 </li><li>  Click on the left menu Network &amp; Security ‚Üí Security Groups </li><li>  Choose a security group related to our virtual machine. </li><li>  Click Action&gt; Edit Inbound Rules </li><li>  Click ‚Äúadd rule‚Äù (‚ÄúAdd Rule‚Äù) and set: Type: Custom TCP, Port Range: 2201, Source: 0.0.0.0/0 and Description: SSH </li></ol><br><h2>  Connect with new data </h2><br>  Now you can connect to the server on the new port as a new user: <br><br><pre> <code class="hljs pgsql">$ ssh wizard@&lt;IP-ADDRESS&gt; -p <span class="hljs-number"><span class="hljs-number">2201</span></span> -i &lt;<span class="hljs-type"><span class="hljs-type">PATH</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">TO</span></span>-PRIVATE-KEY&gt;</code> </pre> <br>  Now you have a server ready to serve your application. </div><p>Source: <a href="https://habr.com/ru/post/347500/">https://habr.com/ru/post/347500/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../347490/index.html">Method of progressive Heisenbag</a></li>
<li><a href="../347492/index.html">How to bargain about wages in the United States. American Conversation Etiquette</a></li>
<li><a href="../347494/index.html">The first user with a million on stack overflow</a></li>
<li><a href="../347496/index.html">Translation from human to botsky</a></li>
<li><a href="../347498/index.html">Ethics of Vulnerability Search and Research</a></li>
<li><a href="../347502/index.html">[Yekaterinburg, Announcement] UralJS # 6 - three reports on typing, this problems and optimization of React-application</a></li>
<li><a href="../347504/index.html">How Atlassian has built a $ 10 billion business. Part 1</a></li>
<li><a href="../347506/index.html">From philosophy to science: how Stephen Hawking and the COSMOS center will use HPE Superdome Flex</a></li>
<li><a href="../347508/index.html">Happy Birthday, Vivaldi !.</a></li>
<li><a href="../347510/index.html">Some aspects of the quality of training sequences</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>