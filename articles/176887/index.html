<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We send a thick client through an SSL tunnel with encryption according to GOST</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habrovchane! 

 Today we want to talk about the benefits of SSL VPN technology and the practice of working with Stonesoft SSL gateway. The article...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We send a thick client through an SSL tunnel with encryption according to GOST</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habrovchane! <img align="right" src="https://habrastorage.org/storage2/85f/ace/76a/85face76a29af2607f31ec319231537d.png"><br><br>  Today we want to talk about the benefits of SSL VPN technology and the practice of working with Stonesoft SSL gateway.  The article will describe the configuration of this solution for forwarding a thick client (for example, well-known 1C Accounting) via the HTTPS protocol using GOST encryption algorithms.  This will allow our beloved chief accountant to remotely work with 1C base on an encrypted channel directly from the dacha, for us to quickly connect a couple of hundreds of small offices scattered throughout the country to the system, and our organization to fulfill the requirements of legislation to protect personal data. <br><br>  The article describes how to securely publish client-server applications via the Web, guided by which, you can organize remote access to almost any corporate resource. <br><a name="habracut"></a><br><h4>  What is SSL VPN? </h4><br>  So let's see how SSL VPN can make our lives easier and save time and nerves.  I see no sense in describing technology, so as not to bother the advanced reader with dry technical information.  Refresh your SSL VPN knowledge <a href="http://ru.wikipedia.org/wiki/SSL">here</a> .  We will focus on the practice of use and think about what SSL VPN is so good compared to the classic IPSec VPN. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The essence of SSL VPN technology is as follows: the client connects to port 443 to the gateway, which in turn initiates a connection to the remote server (in our case, it is 1C), as a proxy server. <br><img src="https://habrastorage.org/storage2/688/d05/713/688d057134994b6143897a15db066427.png"><br>  First, it is convenient.  You can organize access to any service / resource from any user device from any place where there is Internet.  No need to install any VPN clients, configure them, as in the case of using IPSec VPN, just enter the address in the browser, authenticate and work.  The user will be able to get remote access to the corporate resource even through public or guest Wi-Fi, since  Port 443 is open in almost all networks. <br><br>  Secondly, it is simple.  Just for everyone.  You do not have to explain to the <s>aunt-accountant</s> user that in order to gain access to some resource, he needs to find the VPN client icon in the tray, right-click on it, select the gateway address from the list, click "Connect", enter the login and password (hello again ipsec VPN).  Just for administrators, because  No need to give the user a working laptop for travel with an installed and configured VPN client, antivirus, and other corporate software. <br><br>  Thirdly, it is safe.  There are many security mechanisms that an SSL VPN gateway can apply to a client.  The two main mechanisms are authentication and encryption.  You can choose various methods and means of authentication: by login / password, RADIUS, certificates, one-time passwords, integration with Active Directory and many others, depending on the SSL VPN solution chosen. <br><br>  Encryption is also for every taste, it all depends on the vendor.  For example, Stonesoft SSL, which we consider in this article, offers us to choose from the following algorithms: AES, DES, 3DES, RC2, RC4 and, in the version for Russia, GOST 28147-89, which is very pleasing to our state.  regulators.  Since we live in Russia and do not violate the laws, the availability of this product‚Äôs certificates of compliance with the FSTEC and the Federal Security Service allows us to significantly expand its scope. <br><br>  You can also highlight such interesting security mechanisms as checking the user's end device for compliance with the security policy and removing session traces after the end of the connection (cookies, URL history, cache data, and temporary files). <br><br><h4>  What we have and what we want </h4><br>  The task is the following: to organize secure access to the server via HTTPS using GOST encryption from the laptop of an accountant who likes to relax and work in the country.  In fact, we will prokidyvat thick client 1C, which works on "their" ports (1540 TCP, 1560-1591 TCP), through port 443 TCP. <br><br>  Below are two options for connecting via an SSL VPN gateway: <br><ul><li>  The 1C client works with the 1C server on ports 1540 TCP, 1560-1591 TCP, the base 1C is stored in a DBMS installed on the same server </li><li>  The 1C client works directly with the database, which is located in the shared folder. </li></ul><br>  To implement these scenarios, a stand was assembled in the laboratory: <br><ul><li>  1C Server: Windows Server 2008 R2 x64, MS SQL 2008 R2 Express, 1C 8.3.1.531 </li><li>  Client: Windows XP SP2, 1C 8.3.1.531 client, CryptoPro CSP 3.6 </li><li> Firewall (ME): Stonesoft FW / VPN 5.4.3.9685 </li><li>  SSL VPN gateway: Stonesoft SSL 1.5.200.2002 kc1 GOST, available to the client at <a href="https://ssl.sglab.ru/">https://ssl.sglab.ru/</a> </li><li>  Verification Center: CryptoPro Test Center </li></ul><br><img src="https://habrastorage.org/storage2/c5f/5b5/c28/c5f5b5c28cffa0795fd933b36b7be116.png"><br>  DOE stands for emulation of work via the Internet: only port 443 TCP is open on the external interface <br><img src="https://habrastorage.org/storage2/e8d/e7e/833/e8de7e833e50884e3daef49e6a0b7ec5.png"><br><br>  and configured NAT on the SSL VPN gateway interface. <br><img src="https://habrastorage.org/storage2/e3f/aa3/d9f/e3faa3d9f50ba53883f0f1d179765358.png"><br><br>  As can be seen from the scheme and rules on the ME, there is no access from the outside to the 1C server (safety first!). <br><br><h4>  Configuring SSL VPN </h4><br>  I will not describe the process of installing the firmware with GOST support for the SSL VPN gateway and its initial configuration, all this can be found on the <a href="http://www.newinfosec.ru/support/tekhnicheskaya_dokumentatsiya_stonegate_na_russkom_yazyke/">Internet</a> and in the <a href="http://stonesoft.com/opencms/export/system/galleries/download/product_docs/current/SSLVPN_Administrators_Guide_v1-5-200.pdf">guides</a> .  So let's agree that we have a clean Stonesoft SSL with installed crypto libraries of CrytoPro CSP, generated keys, imported certificates of the gateway and a trusted Certification Authority. <br><br>  Below are the Stonesoft SSL Gateway and User Certificates issued on the Test Trust Center. <br><br>  SSL VPN Gateway Certificate: <br><img src="https://habrastorage.org/storage2/24b/163/6e9/24b1636e9f6791c45d845c49042e6d4e.png"><img src="https://habrastorage.org/storage2/e1b/cda/4a6/e1bcda4a66caf78dc0c904bb32f59992.png"><br><br>  User certificate: <br><img src="https://habrastorage.org/storage2/470/68f/9d4/47068f9d4d37fdea740f00706857c63e.png"><img src="https://habrastorage.org/storage2/549/ec1/6f3/549ec16f3e61a9506c857e2dcbb80134.png"><br><br>  Configuring an SSL VPN gateway can be divided into the following steps: <br><ul><li>  Configure user authentication </li><li>  Publish resources on the SSL VPN gateway application portal <br><ul><li>  Option number 1: 1C client works with 1C server on ports 1540 TCP, 1560-1591 TCP <br><ul><li>  Creating a tunnel resource </li><li>  Creating an object in the application portal </li></ul></li><li>  Option number 2: 1C client works directly with the database, which is located in a shared folder <br><ul><li>  Creating a standard resource </li></ul></li></ul></li></ul><br>  Below is a detailed description of the settings with screenshots. <br><br><h6>  Configure user authentication </h6><br>  First, configure user authentication.  We chose the following scheme: authentication by certificates issued only by a trusted CA without being tied to any user repository.  Those.  if the user has a certificate issued by a CA that the gateway considers trusted, then the user can authenticate.  So, go to <a href="https://10.30.0.213:8443/">https://10.30.0.213:8443/</a> and get to the administration console of the Stonesoft SSL gateway. <br><br>  Go to the tab <i><b>Manage System - Authentication Methods</b></i> . <br><img src="https://habrastorage.org/storage2/391/a1b/e9b/391a1be9b760ee9f2f7ce7ebbf5f2f1a.png"><br><br>  Add a new method - click <i><b>Add Authentication Method ...</b></i> , select the type <i><b>User Certificate</b></i> , set the name to the method and select the CA that will be used for this type of authentication. <br><img src="https://habrastorage.org/storage2/f81/f42/0dc/f81f420dc8fb6e79bad6a3bcadc1c4a7.png"><br><br>  By default, not any user can be authenticated, but only the one whose account is known to the gateway.  For our scheme, we need to add a new attribute for the created authentication method: click <i><b>Add Extended Property ...</b></i> , select the attribute <i><b>Allow user,</b></i> and set the value of the attribute to <i><b>true</b></i> . <br><img src="https://habrastorage.org/storage2/8b4/d32/00c/8b4d3200c8335de78e1dd50e642ce9dd.png"><br><br>  That's all, the new authentication method is ready, to apply the changes click the <i><b>Publish</b></i> button.  This is probably the most important button when working with Stonesoft SSL, do not forget to press it every time you change something. <br><img src="https://habrastorage.org/storage2/41c/399/08f/41c39908fd65645c2e2f562607f196c4.png"><br><br><h6>  Publication of the resource.  Option number 1 </h6><br>  Now you need to publish the resource so that it is available to the user on the application portal of the SSL VPN gateway.  First, we will consider Option # 1: the 1C client connects to the 1C server and works with the database in the DBMS. <br><br>  The process of creating and publishing a resource can be described as follows: <br><ul><li>  Creating a host (in our case it is a 1C server) </li><li>  Creating a link in the SSL VPN gateway application portal </li></ul><br>  Go to the <i><b>Manage Resource Access - Tunnel Resources</b></i> tab, click <i><b>Add Tunnel Resource Host ...</b></i> Fill in the resource name, IP address and ports through which we want to access the 1C server. <br><img src="https://habrastorage.org/storage2/04d/139/7f6/04d1397f60874c3ddf4050b17e6f4e98.png"><br><br>  Now you need to create an item in the application portal.  Go to the <i><b>Manage Resource Access - Tunnel Sets</b></i> tab, click <i><b>Add Tunnel Set</b></i> and fill in the name, select the icon that will be visible to the user (you can choose from ready-made ones or load your own), in the <i><b>Link Text</b></i> field we write the text that will be displayed under the icon. <br><img src="https://habrastorage.org/storage2/c06/69f/c12/c0669fc125dcb97481b3b16f170d53d8.png"><br><br>  In the next step, we need to specify the SSL VPN gateway, what traffic to wrap in SSL, for this we add a dynamic tunnel, for which we click <i><b>Add Dynamic Tunnel to the Set ...</b></i> and from the drop-down list in the <i><b>Resource</b></i> field select the host with the 1C server.  All other fields are filled in automatically in accordance with the properties of the resource that we have selected. <br><img src="https://habrastorage.org/storage2/798/20c/ada/79820cada8d2580094b209e8827cca5e.png"><br><br>  Now the most crucial moment is to correctly write the command that will be executed on the client PC, automatically launching the 1C client with the required connection settings to the server.  In my <i>case,</i> it looks like this: <i>"C: \ Program Files \ 1cv8 \ 8.3.1.531 \ bin \ 1cv8c.exe" /Sray10.30.0.238\1c "</i> .  It is worth remembering that if there are several users, then all the path to the executable file should be the same.  If for some reason this is not possible, then you can leave the <i><b>Startup Command</b></i> field empty, then the 1C client will have to be started manually and all parameters must be specified after opening the resource on the application portal. <br><img src="https://habrastorage.org/storage2/f11/292/063/f112920633b211516068542eea15fa5c.png"><br><br>  After all the actions done, click Publish. <br><img src="https://habrastorage.org/storage2/41c/399/08f/41c39908fd65645c2e2f562607f196c4.png"><br><br>  Now we can check what happened with us.  We launch the browser, write in the address bar <a href="https://ssl.sglab.ru/">https://ssl.sglab.ru/</a> and see the window with the choice of certificate. <br><img src="https://habrastorage.org/storage2/1f4/9e0/48b/1f49e048b4e4bfa9e62afbb148e24ee5.png"><br><br>  After authentication, we get to the application portal. <br><img src="https://habrastorage.org/storage2/b6d/6fb/062/b6d6fb062579570ff031b9157fa6f1c1.png"><br><br>  We press on <i><b>1C</b></i> and we see how the <i>Access Client is</i> loaded, the command that we wrote in the <i>Tunnel Set</i> properties is launched and eventually the 1C: Enterprise client starts and connects to the server. <br><img src="https://habrastorage.org/storage2/274/858/e58/274858e582bd70246fc187af7582df9e.png"><br><br>  At the time of connection, you can view the logs on the ME and make sure that everything works through HTTPS. <br><img src="https://habrastorage.org/storage2/58a/232/cad/58a232cadf4809fc61f11d22b1db6a35.png"><br><br><h6>  Publication of the resource.  Option number 2 </h6><br>  Now we will configure another script - the user clicks on the 1C icon on the application portal and gets access to the folder with the base on the 1C server. <br><br>  Go to the administration console of the gateway, go to the tab <i><b>Manage Resource Access - Standard Resources - File Sharing Resources - Microsoft Windows File Share</b></i> and click <i><b>Add this Standard Resource</b></i> . <br><img src="https://habrastorage.org/storage2/345/051/1b6/3450511b63658703c2bf2ced2818803a.png"><br><br>  Fill in the name of the resource, the IP address of the 1C server, the name of the folder with the database that is shared, select the icon for the application portal and write the display name. <br><img src="https://habrastorage.org/storage2/1ac/70e/db8/1ac70edb833d5b1c08607fd66994bb97.png"><br><br>  Actually, everything.  Do not forget to post changes on the portal. <br><img src="https://habrastorage.org/storage2/41c/399/08f/41c39908fd65645c2e2f562607f196c4.png"><br><br>  Now from the client PC, we go again to <a href="https://ssl.sglab.ru/">https://ssl.sglab.ru/</a> and click on the created <b><i>Base 1C</i></b> icon. <br><img src="https://habrastorage.org/storage2/fe1/307/6ba/fe13076bab3dea2f58e261d81f1d1ca6.png"><br><br>  Then we see the folder with the base 1C. <br><img src="https://habrastorage.org/storage2/278/d77/600/278d77600eae3465bc1bbb6b7d0dcf4d.png"><br><br>  Then everything is simple and clear - we add a new information base in the 1C client, specify the path <i>\\ 10.30.0.238 \ 1cbase</i> and work with it over a secure channel via HTTPS. <br><br><h4>  Conclusion </h4><br>  Thus, we configured the SSL VPN gateway to work remotely with the 1C server in two versions via an encrypted channel using GOST algorithms and allowed our users to work safely with corporate resources through thick clients. <br><br>  This is not all that Stonesoft SSL VPN is capable of.  This configuration will be easy to ‚Äútune‚Äù to fit your needs. <br><br>  We hope this article will be useful to you.  In the future, we plan to continue to share our experience in the field of information security with haberdashers.  We will be glad to questions and wishes in the comments. <br><br>  Thank you all for your attention! <br><br>  <a href="http://habrahabr.ru/users/newmaxidrom/" class="user_link">newmaxidrom</a> </div><p>Source: <a href="https://habr.com/ru/post/176887/">https://habr.com/ru/post/176887/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../176877/index.html">How we did the Rubens Pipe</a></li>
<li><a href="../176879/index.html">ePayService at RIF + CIB 2013</a></li>
<li><a href="../176881/index.html">Mitap-group ‚ÄúMoscow Cassandra Users‚Äù starts</a></li>
<li><a href="../176883/index.html">Metric # 4 - Podcast on technologies and design of interfaces and services</a></li>
<li><a href="../176885/index.html">Electronic universe (a look at computer science from the 80s)</a></li>
<li><a href="../176891/index.html">RubyMine 5.4 is ready for Rails 4</a></li>
<li><a href="../176893/index.html">CDN for statics and measurement: how Yandex.Mail has become faster in the regions</a></li>
<li><a href="../176895/index.html">Prism Developer Guide - Part 7, creating a user interface</a></li>
<li><a href="../176897/index.html">Bootstrap-wysiwyg: a tiny text editor</a></li>
<li><a href="../176901/index.html">Trainings Nokia Developers Workshop in Russia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>