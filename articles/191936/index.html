<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dendy console in amateur constructions</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Often, radio amateurs are faced with the problem of creating a remote device control panel. If the number of buttons on it is large, then to reduce th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">🔎</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">📜</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">⬆️</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">⬇️</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dendy console in amateur constructions</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/c2c/48a/4f6/c2c48a4f649227ef09b0fb6a12ce5c21.jpg" alt="image"><br><br>  Often, radio amateurs are faced with the problem of creating a remote device control panel.  If the number of buttons on it is large, then to reduce the number of wires in the connecting cable, the console is equipped with an encoder for the commands of the pressed buttons, and the device with a decoder.  In this situation, the old joystick can help out, from the once popular game consoles «Dendy».  The task of the radio amateur is greatly simplified, since the joystick has a good design and is equipped with a ready-made encoder for the keystroke commands. <br><a name="habracut"></a><br><h4>  What's inside the joystick? </h4><br>  The approximate scheme of the encoder used in the joysticks "Dendy" is shown in <b>Fig.</b>  <b>6</b> , at the end of the article.  Information about the interface between the joystick and game console, a variant of the joystick circuit, as well as variants of the decoder circuits can be found on the pages of the magazine "Radio".  [l] Information about the pressed buttons of the joystick is transmitted in a sequential format using the clock signal "Clock" from the controlled device.  To synchronize with it, the joystick has an “Latch” input, which is supplied with a short pulse with a high logic level at the beginning of each cycle of receiving data from the joystick. <br><br><h4>  The device decoder and his work </h4><br>  The proposed device, electrical circuit diagram of which is shown in <b>Fig.</b>  <b>1</b> , is a decoder that converts joystick signals into discrete logic levels corresponding to the buttons pressed. <br><img src="https://habrastorage.org/getpro/habr/post_images/ce0/84d/0f6/ce084d0f6c0495a84cbca32c78498b40.jpg" alt="image"><br>  It is based on the 74HC595N (DD3) chip, which is an 8-bit shift register with serial input and serial and parallel information output.  Parallel information output is carried out through a buffer register with outputs that have three states.  The information signal is fed to the SER input (pin 14), the write signal to the SCK input (pin 11), and the output signal (“snap”) to the RSK input (pin 12).  This register receives a byte, which carries information about the pressed buttons, sequentially, and outputs the outputs Q0 - Q7 in parallel form.  Thus, the state of each individual output, the output register of the microcircuit, will correspond to the button associated with it on the joystick.  The correspondence between the register pins and the joystick buttons is shown in the <b>table below</b> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/d27/c4d/d51/d27c4dd51941ed140118a2a907700907.jpg" alt="image"><br><br>  On the DD2 microcircuit, the “Latch” clock shaper is assembled, necessary for fixing the state of the buttons on the joystick and outputting the high bit of data from the joystick to the “Data” output.  This happens on the positive edge of the pulse.  On the negative front of this pulse, the data byte reading cycle begins.  This moment is designated as the “joystick survey cycle” (see <b>Fig. 2</b> ).  The next bits in order will be output on the “Data” output with the appearance of a positive clock edge, at the input of the “Clock” joystick.  Also, the “Latch” clock pulse is fed to the RSK input of the shift register, this is necessary to “snap” the received byte in the output register and output it to the outputs Q0 - Q7 in parallel form.  The “latching” of the received byte occurs along the positive edge of the pulse.  This point in time is designated as the “information update cycle at the 74S595 register output” (see <b>Fig. 2</b> ).  With the arrival of each clock pulse, the information at the output of the register will be updated. <br><img src="https://habrastorage.org/getpro/habr/post_images/c56/60c/c42/c5660cc42c7fc2884f904985373b39cb.jpg" alt="image"><br>  On the chip DD1 assembled clock generator.  The frequency of which is 100 kilohertz.  Clock pulses are fed to the “Clock” input of the joystick and to the SCK input of the receiving register 74H595.  Data on the state of the joystick buttons is output to the “Data” output in order, starting with the high-order bit - D7, D6 ... D0.  This happens on the positive edge of the clock pulse at the input “Clock” of the joystick.  The bits read from the “Data” output are fed to the input of the SER register 74HS595.  Writing the received bit to the register also occurs on the positive front of the pulses of this generator. <br><br><blockquote>  <i>- dude!</i>  <i>You have the moment of updating the bit of information at the “Data” output combined with the moment of reading the set bit at the “Data” output!</i> <i><br></i>  <i>- yes ... that's for sure.</i>  <i>But the joystick is rather “braking”, and the bit update, after the arrival of a positive clock edge, occurs 120 nC later.</i>  <i>While the joystick is thinking, the smart 74HS595 manages to record the previous value of the “Data” output, for 20 nC.</i> <i><br></i>  <i>- uh, "Kulibin"!</i>  <i>For the duration of the “Latch” impulse, garbage is written in your output register 74HS595 - two bits of D7 in a row!</i> <i><br></i>  <i>- Yes, I confess - quick work.</i>  <i>But after the end of the cycle of recording the entire byte, the extra bits will "fall out" from the register to nowhere, and will not affect the accuracy of the received information.</i> </blockquote><br><h4>  SPI interface </h4><br>  And one more thing ... Many, looking at the picture ( <b>Fig. 2</b> ), saw the similarity with the timing of the SPI communication interface.  Yes, yes, yes ... with some differences, this is it!  It is necessary to replace the names of the signals: “Latch” on CS or SS, the signal “Clock” on CSLK or CLK, the signal “Data” on MISO, SDO or SO (as you like more).  The joystick can be polled using the SPI module integrated in the MC.  To do this, you need to send bytes to the device, no matter what, for example FF. <br><br><blockquote>  <i>True, if someone this byte can be useful, you can download the necessary information.</i>  <i>For example, for the register with LEDs.</i>  <i>Or do not download, and send the received information from the joystick to someone else.</i>  <i>That is, pin MOSI can be used</i> . </blockquote><br>  The received byte will contain information about the pressed buttons.  The pressed button will correspond to a bit equal to zero, and not to a pressed unit.  If no button is pressed on the joystick, then the FF byte will be received, if it manages to hold all the buttons at once, the received byte will contain 00. The SPI interface must be configured to work in Master mode, well, that is so clear ... while the synchronization mode is set to CPOL = 1, CPHA = 0 (Mode 2).  In this situation, the data from the “Data” output (MISO for MK) will be read by the microcontroller by the negative differential of the CSLK clock signal, fed to the “Clock” input of the joystick.  And the update of the information bit at the “Data” output of the joystick and at the MISO input of the microcontroller will occur on the positive front of the clock pulse.  In the same way, the joystick can be connected to the Arduino board. <br><img src="https://habrastorage.org/getpro/habr/post_images/37c/5e4/946/37c5e4946163458a4dd1689244d418e7.png" alt="image"><br><br><h4>  "Turbo A" and "Turbo B" </h4><br>  Early models of joysticks contained 8 buttons, later ten.  Added two buttons "Turbo A" and "Turbo B".  But on the data exchange protocol, it did not affect in any way - it remained the same.  The added turbo buttons are equivalent to buttons "A" and "B" with the only difference that when you press the "Turbo A" button, the button "A" will be pressed, only at a speed of 12 and a half times a second.  This is true for the buttons "Turbo B" and "B".  The generator of the turbo keystrokes was added to the joystick itself (see <b>Fig</b> . <b>6</b> , highlighted in red).  When you press the turbo button on the outputs Q6 and Q7 of the register DD3 there will be pulses with a period of 80 mS and a duty cycle of two. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d55/d4d/68b/d55d4d68b6a897bd1b6dbb3d11677e5c.jpg" alt="image"><br><br>  There are joysticks with even more buttons, as well as smaller ones.  Pressing additional buttons on such joysticks is equivalent to pressing two buttons on older models at once.  When connecting to the decoder control LEDs, to understand the operation of the buttons "super joysticks" will not be difficult.  <s>(I think it was the joysticks from the Sega Mega Drive)</s> <br><br><h5>  <b>UPD:</b> About SNES. </h5><br>  In the comments to the article it was fairly noted: <br><br><blockquote>  <i>In the text we are talking about the generator of turbo clicks, and to it comes a picture with joysticks, where there is no such generator.</i>  <i>Below it says “Pressing additional buttons on such joysticks is equivalent to pressing two buttons on old models at once,” but this is also unfair to SNES.</i> <br></blockquote><br>  There is no generator of turbo taps in the SNES joysticks.  That is, you will not see any pulses at the output of the decoder when you connect such a joystick.  Moreover, the SNES protocol is not radically, but differs from the NES protocol.  The difference is that it is 16 bit.  Informative bits only - D15 - D4, bits D3 - D0 are always equal to one.  When connecting such a joystick to the proposed decoder, you will receive information about the buttons: “B”, “Y”, “Select”, “Start”, “Up”, “Down”, “Left” and “Right”.  Information about the buttons: “A”, “X”, “L” and “R” will be lost.  The SNES connector is shown in <b>fig.</b>  <b>3</b> extreme right. <br><img src="https://habrastorage.org/getpro/habr/post_images/f23/630/d3c/f23630d3c581d9e3a469c77c4cf1d211.jpg" alt="image"><br><h4>  <b>UPD: The</b> benefit that gives us "Turbo" </h4><br>  Probably someone, reading about the pulses at the output of the decoder when you press the buttons "Turbo A" and "Turbo B" upset: <br><br><blockquote>  <i>- Uh ... so the button "Turbo" can not be used, as a shame, two buttons are lost.</i> <i><br></i>  <i>- Not!</i>  <i>They are not lost at all.</i> <br></blockquote><br>  Let's imagine that when you control any device, you need to increment any parameter in the direction of increasing or decreasing it.  If this requires a high resolution of the setting value, then you can be tired of squeezing the buttons "plus" and "minus", let it be buttons "A" and "B".  This is where the turbo buttons come in handy.  When using the joystick in conjunction with the microcontroller, you will be spared from writing an extra piece of software code, because you will no longer need to squeeze the advanced interface functionality into two buttons.  He has already expanded to four, and is equipped with the logic of work. <br><br><h4>  Interface SNES, NES </h4><br>  In conjunction with the proposed decoder, you can use any joystick that has an SNES, NES or “Virtual Boy” interface.  And also their numerous clones - “Dendy”, <s>“Sega”</s> and others.  The differences are in the design and the connector connecting the joystick to the game console.  The pin assignment of the connectors I know is shown in <b>fig.</b>  <b>3</b> <br><img src="https://habrastorage.org/getpro/habr/post_images/9d8/1eb/b86/9d81ebb86326901e05fe5cd13b7eef72.jpg" alt="image"><br><h4>  Connecting devices to the decoder </h4><br>  The signals at the decoder output correspond to TTL levels.  Pressed on the remote button corresponds to - high level, low - not pressed.  If the device connected to the decoder is matched by TTL levels, then no additional measures need to be agreed. <br><br>  If the output of the decoder requires inverse signal states (the button is pressed - zero, the button is not pressed - one), then the element DD1.4 ( <b>Fig. 1</b> ) must be excluded from the scheme. <br>  In cases where devices connected to the decoder cannot be controlled by logic levels or electrical isolation is required for power, a relay or optocoupler should be used <b>.</b>  <b>4 a, b</b> . <br><img src="https://habrastorage.org/getpro/habr/post_images/478/b81/ec1/478b81ec1f6a035b68c7f47d11cae1c8.jpg" alt="image"><br>  If for control, something needs control signals of a static type (the button is pressed, the pair is turned on, pressed again, turned off), the device must be supplemented with a trigger.  Applying a single chip K155TM2 (see <b>Fig. 4 c</b> ), the "Start" and "Select" buttons can be turned into switches.  Perhaps there will be a bounce effect of contacts (if the suppression is not implemented in the joystick itself).  In this case, it is necessary to reduce the frequency of the clock generator, for example, to 100 hertz.  In this case, the joystick will be polled 10 times per second, and the bounce problem will be solved. <br><br><h4>  Device design </h4><br>  Most of the parts are mounted on a printed circuit board of one-sided foiled fiberglass 1… 1.5 mm thick, a drawing of a printed circuit board is shown in <b>Fig.</b>  <b>5</b>  LEDs can be installed only at the configuration stage, for clarity. <br><img src="https://habrastorage.org/getpro/habr/post_images/d65/968/b47/d65968b47da32ee99506e82edd1ba5e3.jpg" alt="image"><br>  The device uses a resistor C2-23, MLT, a film capacitor C4 - C10-17, a ceramic capacitor C3 - KM-6, oxide capacitors C1, C2 - C50-35 or imported analogues of the types of parts listed.  The XR1 connector is borrowed in a faulty DVD player.  In the absence of the original connector, the device must be equipped with any other, suitable in design and overall dimensions.  Feed the device from a power source of 12 V and a current of 50 mA. <br>  <b>UPD:</b> If someone comes in handy, then according to the "NATO" classification: DD2 - SN7493, DD1 - SN7400, it will be 155 series.  Or SN74LSxx it will be 555 series, but in general put everything that you find, the main thing is to have the numbers 93, 00 and 74. <br><img src="https://habrastorage.org/getpro/habr/post_images/df1/1fe/3e1/df11fe3e17f65c01704f5173869ca1ea.jpg" alt="image"><br><h5>  Literature: </h5><br>  <a href="http://un7ppx.narod.ru/device/dendy.htm">Dendy Joystick - Remote Control</a> <br>  S. KULESHOV, Kurgan <br>  The magazine "Radio" №4 2002 <br><br>  <a href="http://www.chipinfo.ru/literature/radio/200406/p32-34.html">Joystick Teams Decoders from Video Game Consoles</a> <br>  S. Ryumik, Chernigov, Ukraine <br>  Magazine "Radio" №6 2004 <br><br>  <a href="http://www.radioway.ru/1996/06/remont_dzhoistika__dendi_.html">Repair joystick "Dandy"</a> <br>  S. Golubev, Omsk <br>  Magazine "Radio" №6 1996 <br><br>  <b>Ps.</b> <br>  If anyone needs it, there is a fee.  (archive is hidden in the picture) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/077/b4a/938/077b4a938a3609affa93c8e4a13349fa.jpg" alt="image"><br><br>  For movie lovers, I had some kind of video report - they say, a scheme for ointment ... <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/OwfrqzNBRrE%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700191,15700253&amp;usg=ALkJrhhOwZESSLL1aXEAhs2zqlXe1QRpxA" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/191936/">https://habr.com/ru/post/191936/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../191922/index.html">Experience in building a b2b product: 3 continents in 6 years and half a mile of stuffed cones</a></li>
<li><a href="../191926/index.html">C # async for iOS and Android</a></li>
<li><a href="../191928/index.html">Dog's life in the Jimdo office in Hamburg</a></li>
<li><a href="../191932/index.html">.NET 4.5 - on-site update .NET 4.0</a></li>
<li><a href="../191934/index.html">.NET and design patterns</a></li>
<li><a href="../191938/index.html">The prosecutor's office of St. Petersburg has blocked the site for bribing a moderator with virtual currency!</a></li>
<li><a href="../191940/index.html">How I use computer technology. Nestollman</a></li>
<li><a href="../191942/index.html">China will launch its "moonwalker" by the end of the year</a></li>
<li><a href="../191946/index.html">XAP (Shitty Architecture Ruins)</a></li>
<li><a href="../191948/index.html">Mobile applications and media decomposition</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>