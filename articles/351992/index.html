<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Visualization on the distribution map of votes in Moscow in the presidential elections of 2018</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Elections are an extremely mysterious process, when viewing the values ‚Äã‚Äãof the results of which the overall picture is not quite clear...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Visualization on the distribution map of votes in Moscow in the presidential elections of 2018</h1><div class="post__text post__text-html js-mediator-article"><h2>  Introduction </h2><br>  Elections are an extremely mysterious process, when viewing the values ‚Äã‚Äãof the results of which the overall picture is not quite clear.  I decided to show them on a map of Moscow with division by regions using InterSystems technologies, which provide both data storage and analysis.  In this case, the platform was used to integrate and develop InterSystems Ensemble applications, but you could equally well deploy the solution described below on the <a href="http://www.intersystems.com/ru/our-products/cache/cache-overview/">multi-model InterSystems Cach√© DBMS</a> and on the new InterSystems IRIS Data Platform product. <br><a name="habracut"></a><br><h2>  Stages: </h2><br>  To display the map, we will perform the following actions: <br><br><ul><li>  collection of voting data that will be displayed on the map; </li><li>  bringing the collected data to the required format; </li><li>  creating persistent classes and filling them out; </li><li>  creating OLAP-cube; </li><li>  making pivot (s); </li><li>  create and configure dashboards; </li><li>  installation of the MDX2JSON and DeepSeeWeb projects; </li><li>  collection of polygon coordinates; </li><li>  creating thermlists and adding controls. </li></ul><br><h2>  Data collection </h2><br>  To display the presidential election data, we need a data model. <br>  Create the following classes: <br><br><ul><li>  map.MoscowElections2018 - class with election results data </li><li>  map.MoscowRegion - a directory of districts of Moscow to which objects of the class map.MoscowElections2018 will refer </li></ul><br>  Let's start by creating the map.MoscowRegion class. <br>  Take data from <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BF%25D0%25B8%25D1%2581%25D0%25BE%25D0%25BA_%25D1%2580%25D0%25B0%25D0%25B9%25D0%25BE%25D0%25BD%25D0%25BE%25D0%25B2_%25D0%25B8_%25D0%25BF%25D0%25BE%25D1%2581%25D0%25B5%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B9_%25D0%259C%25D0%25BE%25D1%2581%25D0%25BA%25D0%25B2%25D1%258B">districts</a> and <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25B4%25D0%25BC%25D0%25B8%25D0%25BD%25D0%25B8%25D1%2581%25D1%2582%25D1%2580%25D0%25B0%25D1%2582%25D0%25B8%25D0%25B2%25D0%25BD%25D0%25BE-%25D1%2582%25D0%25B5%25D1%2580%25D1%2580%25D0%25B8%25D1%2582%25D0%25BE%25D1%2580%25D0%25B8%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25B4%25D0%25B5%25D0%25BB%25D0%25B5%25D0%25BD%25D0%2525B">administrative districts</a> from Wikipedia pages, create an <a href="">XML-enabled</a> class for this data 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">map.MoscowRegion</b> <div class="spoiler_text"><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Class</span></span> map.MoscowRegion Extends (%Persistent, %<span class="hljs-type"><span class="hljs-type">XML</span></span>.Adaptor) { <span class="hljs-keyword"><span class="hljs-keyword">Index</span></span> idIndex <span class="hljs-keyword"><span class="hljs-keyword">On</span></span> id [ IdKey, PrimaryKey, <span class="hljs-keyword"><span class="hljs-keyword">Unique</span></span> ]; ///  Property id <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %String [ Required ]; ///  .  Property <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %String(MAXLEN = <span class="hljs-number"><span class="hljs-number">250</span></span>); /// ,  Property area <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Float</span></span>; ///  Property population <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span>; ///   .  Property parentName <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %String; ///  .  Property parent <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> map.MoscowRegion; ///  .  Property parentId <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span>; ClassMethod populateRegions() <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %Status { #dim sc <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %Status = $$<span class="lua"><span class="lua">$OK #dim stream As %Stream.Object = ##class(%Dictionary.CompiledXData).%OpenId(..%ClassName(</span><span class="hljs-number"><span class="lua"><span class="hljs-number">1</span></span></span><span class="lua">) _ </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"||"</span></span></span><span class="lua"> _ </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"regions"</span></span></span><span class="lua">).Data #dim reader As %XML.Reader = ##class(%XML.Reader).%New() set sc = ..%KillExtent() </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">if</span></span></span><span class="lua"> $$</span></span>$ISERR(sc) quit sc <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> sc = reader.OpenStream(stream, "literal") <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> $$<span class="perl"><span class="perl">$ISERR(sc) quit sc </span><span class="hljs-keyword"><span class="perl"><span class="hljs-keyword">do</span></span></span><span class="perl"> reader.Correlate(</span><span class="hljs-string"><span class="perl"><span class="hljs-string">"region"</span></span></span><span class="perl">, ..%ClassName(</span><span class="hljs-number"><span class="perl"><span class="hljs-number">1</span></span></span><span class="perl">)) </span><span class="hljs-comment"><span class="perl"><span class="hljs-comment">#dim obj As map.MoscowRegion while reader.Next(.obj, .sc) { if $$</span></span></span></span>$ISERR(sc) quit <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj.parentId) { <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> obj.parent = ..%OpenId(obj.parentId) } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> sc = obj.%Save() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> $$<span class="bash"><span class="hljs-variable"><span class="bash"><span class="hljs-variable">$ISERR</span></span></span><span class="bash">(sc) quit </span><span class="hljs-built_in"><span class="bash"><span class="hljs-built_in">set</span></span></span><span class="bash"> obj = </span><span class="hljs-string"><span class="bash"><span class="hljs-string">""</span></span></span><span class="bash"> } quit sc } XData regions { } }</span></span></code> </pre> <br></div></div><br>  And we give the data to the format of XML <br><br><div class="spoiler">  <b class="spoiler_title">XData from map.MoscowRegion</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">regions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">region</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">parentName</span></span></span><span class="hljs-tag">&gt;</span></span>-<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">parentName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">area</span></span></span><span class="hljs-tag">&gt;</span></span>66.18<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">area</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">population</span></span></span><span class="hljs-tag">&gt;</span></span>769630<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">population</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>1001<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">region</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">region</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">parentName</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">parentName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">area</span></span></span><span class="hljs-tag">&gt;</span></span>7.62<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">area</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">population</span></span></span><span class="hljs-tag">&gt;</span></span>47504<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">population</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>2146<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">parentId</span></span></span><span class="hljs-tag">&gt;</span></span>1012<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">parentId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">region</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">regions</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  I turned to the <a href="http://www.izbirkom.ru/region/izbirkom">website of the</a> Central Election Commission of the Russian Federation for these elections.  Unfortunately, I did not find a normal API with the ability to get a suitable data set, so I had to take everything from the summary table of results.  There, with the help of filters, one can find the results of the election not only of the President of the Russian Federation, but also the election of deputies and heads of various administrative units of the Russian Federation.  Since we are interested in the presidential elections, we find a suitable <a href="http://www.vybory.izbirkom.ru/region/region/izbirkom%3Faction%3Dshow%26tvd%3D100100084849066%26vrn%3D100100084849062%26region%3D0%26global%3D1%26sub_region%3D0%26prver%3D0%26pronetvd%3Dnull%26vibid%3D100100084849200%26type%3D227">summary table of</a> election results in Moscow, upload, transform to the appropriate format (for this example, the XML format was chosen, since this format can be easily used to import into our database under the control of the InterSystems platform ). <br>  As a result, we have approximately the following data format: <br><br><div class="spoiler">  <b class="spoiler_title">XML election data</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">regions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">region</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">regionName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">regionName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">regionId</span></span></span><span class="hljs-tag">&gt;</span></span>2013<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">regionId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">votersIncludedInVotersList</span></span></span><span class="hljs-tag">&gt;</span></span>65519<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">votersIncludedInVotersList</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsReceivedByPrecinctElectionCommission</span></span></span><span class="hljs-tag">&gt;</span></span>58800<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsReceivedByPrecinctElectionCommission</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsIssuedToVotersWhoVotedEarly</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsIssuedToVotersWhoVotedEarly</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsIssuedInPollingStationOnElectionDay</span></span></span><span class="hljs-tag">&gt;</span></span>38056<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsIssuedInPollingStationOnElectionDay</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsIssuedOutsidePollingStationOnElectionDay</span></span></span><span class="hljs-tag">&gt;</span></span>1326<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsIssuedOutsidePollingStationOnElectionDay</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">canceledBallots</span></span></span><span class="hljs-tag">&gt;</span></span>19418<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">canceledBallots</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsInMobileBallotBoxes</span></span></span><span class="hljs-tag">&gt;</span></span>1326<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsInMobileBallotBoxes</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsInStationaryBallotBoxes</span></span></span><span class="hljs-tag">&gt;</span></span>38003<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsInStationaryBallotBoxes</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">invalidBallots</span></span></span><span class="hljs-tag">&gt;</span></span>538<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">invalidBallots</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">validBallots</span></span></span><span class="hljs-tag">&gt;</span></span>38791<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">validBallots</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lostBallots</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lostBallots</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsNotRecorded</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsNotRecorded</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Baburin</span></span></span><span class="hljs-tag">&gt;</span></span>356<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Baburin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grudinin</span></span></span><span class="hljs-tag">&gt;</span></span>4738<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grudinin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Zhirinovsky</span></span></span><span class="hljs-tag">&gt;</span></span>2060<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Zhirinovsky</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Putin</span></span></span><span class="hljs-tag">&gt;</span></span>27833<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Putin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Sobchak</span></span></span><span class="hljs-tag">&gt;</span></span>1602<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Sobchak</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Suraykin</span></span></span><span class="hljs-tag">&gt;</span></span>300<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Suraykin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Titov</span></span></span><span class="hljs-tag">&gt;</span></span>668<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Titov</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Yavlinsky</span></span></span><span class="hljs-tag">&gt;</span></span>1234<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Yavlinsky</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">region</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">region</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">regionName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">regionName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">regionId</span></span></span><span class="hljs-tag">&gt;</span></span>2142<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">regionId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">votersIncludedInVotersList</span></span></span><span class="hljs-tag">&gt;</span></span>103818<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">votersIncludedInVotersList</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsReceivedByPrecinctElectionCommission</span></span></span><span class="hljs-tag">&gt;</span></span>86145<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsReceivedByPrecinctElectionCommission</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsIssuedToVotersWhoVotedEarly</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsIssuedToVotersWhoVotedEarly</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsIssuedInPollingStationOnElectionDay</span></span></span><span class="hljs-tag">&gt;</span></span>63192<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsIssuedInPollingStationOnElectionDay</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsIssuedOutsidePollingStationOnElectionDay</span></span></span><span class="hljs-tag">&gt;</span></span>1123<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsIssuedOutsidePollingStationOnElectionDay</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">canceledBallots</span></span></span><span class="hljs-tag">&gt;</span></span>21829<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">canceledBallots</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsInMobileBallotBoxes</span></span></span><span class="hljs-tag">&gt;</span></span>1123<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsInMobileBallotBoxes</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsInStationaryBallotBoxes</span></span></span><span class="hljs-tag">&gt;</span></span>63139<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsInStationaryBallotBoxes</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">invalidBallots</span></span></span><span class="hljs-tag">&gt;</span></span>796<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">invalidBallots</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">validBallots</span></span></span><span class="hljs-tag">&gt;</span></span>63466<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">validBallots</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lostBallots</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">lostBallots</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsNotRecorded</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ballotsNotRecorded</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Baburin</span></span></span><span class="hljs-tag">&gt;</span></span>439<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Baburin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grudinin</span></span></span><span class="hljs-tag">&gt;</span></span>8723<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grudinin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Zhirinovsky</span></span></span><span class="hljs-tag">&gt;</span></span>3110<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Zhirinovsky</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Putin</span></span></span><span class="hljs-tag">&gt;</span></span>47192<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Putin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Sobchak</span></span></span><span class="hljs-tag">&gt;</span></span>1860<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Sobchak</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Suraykin</span></span></span><span class="hljs-tag">&gt;</span></span>345<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Suraykin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Titov</span></span></span><span class="hljs-tag">&gt;</span></span>734<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Titov</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Yavlinsky</span></span></span><span class="hljs-tag">&gt;</span></span>1063<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Yavlinsky</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">region</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">regions</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></div></div><br>  Created for data XML-enabled class map.MoscowElections2018 on the InterSystems platform: <br><br><div class="spoiler">  <b class="spoiler_title">Class code map.MoscowElections2018</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Class</span></span> map.MoscowElections2018 Extends (%Persistent, %<span class="hljs-type"><span class="hljs-type">XML</span></span>.Adaptor) { ///    Property region <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> map.MoscowRegion; ///   Property regionName <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %String; /// ID  Property regionId <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span>; ///  ,     Property votersIncludedInVotersList <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span>; ///   ,     Property ballotsReceivedByPrecinctElectionCommission <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span>; ///   ,  ,   Property ballotsIssuedToVotersWhoVotedEarly <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span>; ///   ,         Property ballotsIssuedInPollingStationOnElectionDay <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span>; ///   ,         Property ballotsIssuedOutsidePollingStationOnElectionDay <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span>; ///     Property canceledBallots <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span>; ///         Property ballotsInMobileBallotBoxes <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span>; ///        Property ballotsInStationaryBallotBoxes <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span>; ///     Property invalidBallots <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span>; ///     Property validBallots <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span>; ///     Property lostBallots <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span>; ///   ,     Property ballotsNotRecorded <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span>; ///    Property Baburin <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span>; ///    Property Grudinin <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span>; ///    Property Zhirinovsky <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span>; ///    Property Putin <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span>; ///    Property Sobchak <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span>; ///    Property Suraykin <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span>; ///    Property Titov <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span>; ///    Property Yavlinsky <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %<span class="hljs-type"><span class="hljs-type">Integer</span></span>; ClassMethod populateElectionsData() <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %Status { #dim sc <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %Status = $$<span class="lua"><span class="lua">$OK #dim stream As %Stream.Object = ##class(%Dictionary.CompiledXData).%OpenId(..%ClassName(</span><span class="hljs-number"><span class="lua"><span class="hljs-number">1</span></span></span><span class="lua">) _ </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"||"</span></span></span><span class="lua"> _ </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"elections"</span></span></span><span class="lua">).Data #dim reader As %XML.Reader = ##class(%XML.Reader).%New() set sc = ..%KillExtent() </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">if</span></span></span><span class="lua"> $$</span></span>$ISERR(sc) quit sc <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> sc = reader.OpenStream(stream, "literal") <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> $$<span class="perl"><span class="perl">$ISERR(sc) quit sc </span><span class="hljs-keyword"><span class="perl"><span class="hljs-keyword">do</span></span></span><span class="perl"> reader.Correlate(</span><span class="hljs-string"><span class="perl"><span class="hljs-string">"region"</span></span></span><span class="perl">, ..%ClassName(</span><span class="hljs-number"><span class="perl"><span class="hljs-number">1</span></span></span><span class="perl">)) </span><span class="hljs-comment"><span class="perl"><span class="hljs-comment">#dim obj As map.MoscowElections2018 while reader.Next(.obj, .sc) { if $$</span></span></span></span>$ISERR(sc) quit <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj.regionId) { <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> obj.region = ##<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(map.MoscowRegion).%OpenId(obj.regionId) } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> sc = obj.%Save() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> $$<span class="bash"><span class="hljs-variable"><span class="bash"><span class="hljs-variable">$ISERR</span></span></span><span class="bash">(sc) quit </span><span class="hljs-built_in"><span class="bash"><span class="hljs-built_in">set</span></span></span><span class="bash"> obj = </span><span class="hljs-string"><span class="bash"><span class="hljs-string">""</span></span></span><span class="bash"> } quit sc } XData elections { } }</span></span></code> </pre> <br></div></div><br><h2>  Creating a cube </h2><br>  To create an OLAP cube, we use the <a href="">DeepSee Architect</a> web application, to go to it, open the System Management Portal ‚Üí DeepSee ‚Üí Select Area ‚Üí Architect. <br>  In that case, if you do not see your area in the list of available DeepSee areas, go to the System Management Portal ‚Üí Menu ‚Üí Web Application Management ‚Üí / csp / area, and in the ‚ÄúEnabled‚Äù field, check the ‚ÄúDeepSee‚Äù box and click the save button.  After that, the selected area should appear in the list of available DeepSee areas. <br>  Create a new cube. <br><br>  Clicking on the button ‚ÄúCreate‚Äù we get to the screen of creating a new cube, there it is necessary to set the following parameters: <br><br><ul><li>  Cube name - the name of the cube used in queries to it </li><li>  Display Name - localized cube name (translation is performed by <a href="">standard</a> InterSystems <a href="">mechanisms</a> ) </li><li>  Cube source - use a fact table or another cube as a data source </li><li>  Initial class - if in the previous step a class was selected, then we specify the class map.MoscowElections2018 as the fact table. </li><li>  The class name for a cube is the name of the class in which the cube definition will be stored.  Automatically generated </li><li>  Class description - arbitrary description </li></ul><br>  This is what our new cube looks like: <br><br><img src="https://habrastorage.org/webt/94/jt/zu/94jtzu2nlcfiw4mwil9akzhb31o.png"><br><br><h3>  We define the properties of the cube. </h3><br>  After clicking OK, a new cube will be created: <br><br><img src="https://habrastorage.org/webt/im/ks/h_/imksh_dnj_svtq2lwosofhg6jjo.png"><br><br>  On the left, the properties of the base and related by the ‚Äúsnowflake‚Äù classes are displayed, which can be used when constructing a cube. <br><br>  The center of the screen is the skeleton of the cube.  It can be filled with class properties using drag-n-drop from the base class area, or by adding elements manually.  The main elements of the cube are measurements, indicators and lists. <br><br><h3>  Dimensions (Dimensions) </h3><br>  <a href="">Dimensions</a> are cube elements that group fact table entries.  In the measurement, the ‚Äúquality‚Äù attributes of the base class are usually referred to, which break all the records of the fact table according to one or another cut. <br><br>  For example, we would like to group all the facts by the municipality and, if deepened, by the district. <br><br>  Territory property is perfect for splitting facts by territory.  Since our hierarchy begins with a municipality, then the first level should have the dimension of the parent of the region, that is, we click the arrow on the region property in the left list, in the drop-down list we also expand the parent property and drag the name to the measurement region ‚Äî as a result The architect adds a dimension to the cube with one H1 hierarchy and one name level.  for convenience, rename the dimension from name to Territory and the first level in Region. <br><br>  Measurements besides grouping allow you to build hierarchies of nesting of facts from the general to the particular.  To do this, add the Subregion level by dragging the region name onto the H1 hierarchy, add the population and name properties to both dimensions and also while the coordsKey magic property with the dimension name value - this property will be used to search for coordinates corresponding to this municipality / region for highlighting on the map.  We indicate the displayed names in the signatures to the measurement and level. <br><br><img src="https://habrastorage.org/webt/ku/uh/ed/kuuhed-ni8rcvdbpsgkbkveadp0.png"><br><br><h3>  Indicators (Measures) </h3><br>  <a href="">Indicators</a> or metrics are such elements of the cube, to which any ‚Äúquantitative‚Äù data are to be counted, which must be calculated for the ‚Äúqualitative‚Äù dimensions of the cube (Dimensions). <br><br>  For example, in the fact table such indicators can be properties: <br><br><ul><li>  population (population), </li><li>  validBallots (Number of valid ballots), </li><li>  votersIncludedInVotersList (Number of Voters), </li><li>  separate indicators for each of the eight </li><li>  Baburin (Baburin SN), </li><li>  Grudinin (Grudinin Mon), </li><li>  Putin (VV Putin), </li><li>  Sobchak (Sobchak KA), </li><li>  Suraykin (Suraikin MA), </li><li>  Titov (Titov BYu), </li><li>  Yavlinsky (Yavlinsky GA), </li><li>  Zhirinovsky (Zhirinovsky explosives). </li></ul><br>  Drag each property to the area of ‚Äã‚Äãindicators and create a numeric indicator of the Integer type with the function SUM, which will count the total number of votes in the current slice.  Also for each indicator we will indicate the displayed name. <br><br><img src="https://habrastorage.org/webt/rh/xc/jz/rhxcjz5kslm96du7rctnocnnmbg.png"><br><br><h3>  Compilation cube </h3><br>  So, we added eight indicators to the cube, one measurement is enough and you can already see what happened. <br><br>  Compile the cube class (button "Compile").  If there are no compilation errors, then the cube is created correctly and you can fill it with data. <br><br>  To do this, click ‚ÄúBuild a cube‚Äù - as a result, DeepSee will load data from the fact table into the cube data store. <br><br>  To work with the cube data we need another web application - DeepSee Analyzer. <br><br><h2>  Pivot table construction (Pivot) </h2><br>  <a href="">DeepSee Analyzer</a> is a visual tool for directly analyzing cube data and preparing data sources for further visualization.  To go to DeepSee Analyzer, open the System Management Portal ‚Üí DeepSee ‚Üí Area Selection ‚Üí Analyzer, you can also go from the cube creation page by clicking on the ‚ÄúTools‚Äù tab in the left pane and then on the ‚ÄúAnalyzer‚Äù button.  The Analyzer working window opens. <br><br>  In the working analyzer window on the left we see the elements of the created cube: indicators and measurements.  Combining them, we build queries to the cube in <a href="">MDX</a> , an analogue of the SQL language for multidimensional OLAP cubes. <br><br>  To create a pivot table, drag the Baburin SN, Grudinin PN, Putin VV, Sobchak KA, Suraykin MA, Titov BYu, Yavlinsky GA, Zhirinovsky VV to the field of measurement columns.  Indicator choose "Administrative District".  As a result, we will get a table of the number of administrative districts with the possibility of deepening (DrillDown - the transition through the measurement hierarchy from the general to the particular) to the districts. <br><br><img src="https://habrastorage.org/webt/l9/kg/wk/l9kgwkx0hheealixmdzocut0dbq.png"><br><br>  In the Analyzer, double clicking on the dimension heading leads to the next dimension in the hierarchy (DrillDown).  In this case, a double click on the administrative district will lead to the transition to the areas of this administrative district.  As a result, you can see how many votes were cast by region. <br><br>  Also, to highlight certain AO / districts, we need an indicator by which the color of this polygon will be calculated - this value will be taken from the column with specials.  Name ColorHSLValue (link to instructions for setting up widgets using maps is at the end of the article) - the higher the value, the closer the color will be to red and green in the opposite case.  To derive the name of the polygon when you hover the cursor on it uses special.  the name of the TooltipValue column.  For the text in the pop-up window that appears when you click on a particular polygon, use the dimension name PopupValue, it is possible to use html to mark the value. <br><br>  These specials.  we will create fields as calculated values.  To do this, click on the button with a calculator in the left menu. <img src="https://habrastorage.org/webt/hd/h_/wx/hdh_wx0pusdl8kb2__bfcgj6er4.png">  , select the element type, the name of the dimension, the name of the element and the expression by which the value of this element will be calculated. <br><br><h4>  List of special fields for maps </h4><br>  ColorHSLValue: <br>  Item Type: Indicator <br>  Item Name: ColorHSLValue <br>  Type: Number <br>  Description: Determines the color of the polygon from green to red depending on the value. <br>  Expression: <br><br><pre> <code class="xml hljs">[Measures].[attandance]/[Measures].[votersIncludedInVotersList]</code> </pre> <br>  is the number of voters who came to the polls is the result of the ratio of the number of voters in a given AO / district, so the higher this proportion is, the closer the color is to red. <br><br>  PopupValue: <br>  Item Type: Dimension <br>  Dimension Name: custom <br>  Item Name: PopupValue <br>  Type: String <br>  Description: Determines the color of the polygon from green to red depending on the value. <br>  Expression: <br><br><pre> <code class="xml hljs">"<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>" + [Territory].[H1].[Region].CurrentMember.Properties("name") + "<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">/&gt;</span></span>: " + [Measures].[Population] + " .<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">/&gt;</span></span> : " + [Measures].[votersIncludedInVotersList] + "."</code> </pre> <br>  the name of the given AO / region, population, number of voters who voted will be displayed <br><br>  TooltipValue: <br>  Item Type: Dimension <br>  Dimension Name: custom <br>  Item Name: TooltipValue <br>  Type: String <br>  Description: Specifies the message that appears when you hover over a polygon. <br>  Expression: <br><br><pre> <code class="xml hljs">[Territory].[H1].[Region].CurrentMember.Properties("name")</code> </pre> <br>  And after adding these pivot columns, it looks like this: <br><br><img src="https://habrastorage.org/webt/nu/mw/nr/numwnrrhsrqhfqno6_2a7jl-044.png"><br><br>  Save this pivot as Moscow Elections / mainPivot2018. <br><br>  We will also create another pivot with information on all elected candidates for breeding as pay-char. <br><br>  Transfer the indicators of all candidates to the "Indicators" column and select in the parameters of indicators <img src="https://habrastorage.org/webt/dp/kw/lv/dpkwlvkx1csc3mlcg7qghyjpj2c.png">  - ‚ÄúPlace indicators on‚Äù - ‚Äúlines‚Äù <br><br><img src="https://habrastorage.org/webt/o5/td/am/o5tdamngnafx6aqt2lyev2mnm_a.png"><br><br>  Save the resulting pivot as Moscow Elections / countPivot2018 and proceed to the creation of the display panel <br><br><h2>  Building a panel of indicators (Dashboard) </h2><br>  User Portal is a web application for creating and using dashboards ( <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25B0%25D0%25BD%25D0%25B5%25D0%25BB%25D1%258C_%25D0%25B8%25D0%25BD%25D0%25B4%25D0%25B8%25D0%25BA%25D0%25B0%25D1%2582%25D0%25BE%25D1%2580%25D0%25BE%25D0%25B2">indicator panels</a> ).  Dashboards contain widgets: tables, graphs and maps based on summary tables created by analysts in the Analyzer. <br><br>  To go to the DeepSee User Portal, open the System Management Portal ‚Üí DeepSee ‚Üí Select Region ‚Üí User Portal. <br><br><img src="https://habrastorage.org/webt/jl/xb/gj/jlxbgjuso7fyvku4fk6md1et_6u.png"><br><br>  Create a new dashboard by clicking on the arrow on the right ‚Üí add ‚Üí add display panel. <br><br><img src="https://habrastorage.org/webt/po/o9/ax/poo9ax48pjzuc9a3ltn--bijtwe.png"><br><br>  Create three widgets. <br><br>  To create, click on the arrow on the right ‚Üí Widgets ‚Üí "+" ‚Üí select the type of widget in the left list ‚Üí data source and the name of the widget: <br><br>  Map widget: <br><br>  Type of widget - Map ‚Üí Map <br>  Data source - MoscowElections / mainPivot2018 <br>  The widget name is moscowElectionsMap <br><br>  Tabular widget with map data: <br><br>  Widget type - Pivot tables and charts ‚Üí Table <br>  Link to - moscowElectionsMap <br>  The widget name is tableWidget <br><br>  Pay chart widget with data of candidates: <br><br>  Widget Type - Pivot Tables &amp; Charts ‚Üí Pie Chart <br>  Data source - MoscowElections / countPivot2018 <br><br>  For the second and third widgets you need to create controls.  For a table widget, the control with which we will determine which of the incoming columns we will display (I recall that in the pivot we defined special columns that are needed for the map, but which should not be displayed in the table widget).  For the third - the filter by AO / areas, the value of which will be set automatically when you click on any AO / area.  You can do this as follows - click the arrow on the right ‚Üí Widgets ‚Üí tableWidget ‚Üí Controls ‚Üí "+" <br><br>  Location - Widget <br>  Target - tableWidget <br>  Action - Install specials.  column <br>  Type - hidden <br><br>  After confirming the creation of the control - we define the displayed columns - the required format is MDX <br><br><pre> <code class="xml hljs">{[Measures].[Baburin],[Measures].[Grudinin],[Measures].[Zhirinovsky],[Measures].[Putin],[Measures].[Sobchak],[Measures].[Suraykin],[Measures].[Titov],[Measures].[Yavlinsky]}</code> </pre> <br><img src="https://habrastorage.org/webt/fa/5q/5s/fa5q5srpsuhlf7_yc0qe6_lz-qi.png"><br><br>  We will create the widget control for the widget in the map widget. <br><br>  Location - Click <br>  Target - Widget3 <br>  Action - Apply Filter <br><br>  After that, save the dashboard. <br><br><h2>  Installing MDX2JSON and DeepSeeWeb </h2><br>  To visualize the created dashboard, you can use the following OpenSource solutions: <br><br><ul><li>  <a href="https://github.com/intersystems-ru/Cache-MDX2JSON">MDX2JSON</a> - REST API provides information about cubes, pivots, dashboards and many other DeepSee elements, in particular, the results of MDX queries, which allows you to embed the user interface of the analytical solution on the DeepSee into any modern Web or mobile application. </li><li>  <a href="https://github.com/intersystems-ru/DeepSeeWeb">DeepSeeWeb</a> - AngularJS application that provides an alternative implementation of the DeepSee user portal.  Can be easily customized.  Uses MDX2JSON as a backend. </li></ul><br><h3>  Installing MDX2JSON </h3><br>  To install MDX2JSON: <br><br><ol><li>  Download <a href="">Installer.xml</a> and import it to any area using Studio, System Management Portal or Do $ System.OBJ.Load (file). </li><li>  Run in terminal (user with% ALL role): Do ## class (MDX2JSON.Installer) .setup () </li></ol><br>  To check the installation, you need to open the page <code>http://server:port/MDX2JSON/Test?Debug</code> in the browser.  You may need to enter a username and password (depending on server security settings).  A server page should open.  If you get an error, you can read on the <a href="https://github.com/intersystems-ru/Cache-MDX2JSON">Readme</a> and <a href="https://github.com/intersystems-ru/Cache-MDX2JSON/wiki/Installation-Guide---RU">Wiki</a> . <br><br><h3>  Install DeepSeeWeb </h3><br>  To install DeepSeeWeb you need: <br><br><ol><li>  Download the <a href="https://github.com/intersystems-ru/DeepSeeWeb/releases">installer</a> and import it to any area using Studio, System Management Portal or Do $ System.OBJ.Load (file). </li><li>  Run in terminal (user with% ALL role): Do ## class (DSW.Installer) .setup () </li></ol><br>  To check the installation, open the browser page <code>http://server:port/dsw/index.html</code> .  The login page should open.  The SAMPLES area contains many ready-made dashboards and all of them are automatically displayed in DeepSeeWeb. <br><br><h2>  Collection of polygon coordinates </h2><br>  To display the collected data on the map, we need a set of coordinates of polygons of administrative districts and districts of Moscow.  You can take them for example on the <a href="http://gis-lab.info/qa/moscow-atd.html">gis-lab</a> website.  Further, since this data will be used by DeepSeeWeb, we need to bring them to a format that DSW can process: <br><br><div class="spoiler">  <b class="spoiler_title">The shortened code moscowElectionsMap.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadCoordinates</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">polygonCoordsArray</span></span></span><span class="hljs-function">) </span></span>{ polygonCoordsArray[<span class="hljs-string"><span class="hljs-string">'  '</span></span>] = <span class="hljs-string"><span class="hljs-string">'36.8031,55.44083,0 ... 37.37279,55.80868,0'</span></span> ... polygonCoordsArray[<span class="hljs-string"><span class="hljs-string">' '</span></span>] = <span class="hljs-string"><span class="hljs-string">'37.90613,55.70626,0 ... 37.37296,55.80745,0'</span></span> }</code> </pre> <br></div></div><br>  Let's save the received js file in the web application folder of our area and voila. <br><br><img src="https://habrastorage.org/webt/v-/wa/bz/v-wabzvrdymdcuhnbloybydco28.png"><br><br><h3>  Creating a list of terms </h3><br>  We can also add the ability to determine the coloring criteria of the map.  if at us now it is colored according to the relation of the total to the population of the AO / district, we can make a coloring by the ratio of votes for the candidate to the population.  You can do this as follows - we will create a list of terms - a list of key-value pairs; when a key is selected, the value will be inserted into the MDX query expression.  The mdx expression of our pivot is as follows: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> NON <span class="hljs-keyword"><span class="hljs-keyword">EMPTY</span></span> {[<span class="hljs-keyword"><span class="hljs-keyword">Measures</span></span>].[Putin],[<span class="hljs-keyword"><span class="hljs-keyword">Measures</span></span>].[Zhirinovsky],[<span class="hljs-keyword"><span class="hljs-keyword">Measures</span></span>].[Baburin],[<span class="hljs-keyword"><span class="hljs-keyword">Measures</span></span>].[Grudinin],[<span class="hljs-keyword"><span class="hljs-keyword">Measures</span></span>].[Sobchak],[<span class="hljs-keyword"><span class="hljs-keyword">Measures</span></span>].[Suraykin],[<span class="hljs-keyword"><span class="hljs-keyword">Measures</span></span>].[Titov],[<span class="hljs-keyword"><span class="hljs-keyword">Measures</span></span>].[Yavlinsky],[<span class="hljs-keyword"><span class="hljs-keyword">MEASURES</span></span>].[COLORRGBVALUE],[CUSTOM].[TooltipValue],[CUSTOM].[PopupValue]} <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>,NON <span class="hljs-keyword"><span class="hljs-keyword">EMPTY</span></span> [Territory].[H1].[Region].Members <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [ELECTIONS2018CUBE]</code> </pre> <br>  Replaced will be the part that is surrounded by curly braces. <br><br>  You can create a list of terms in the <a href="">Manager of the list of terms</a> - open the user portal ‚Üí Tools ‚Üí Manager of the list of terms <br><br>  For Putin will be the next line <br><br>  Key: 2. Putin <br>  Value: <br><br><pre> <code class="sql hljs">{[Measures].[Putin]\,%LABEL([Measures].[Putin]/[Measures].[votersIncludedInVotersList]\,"ColorRGBValue")\,[CUSTOM].[TooltipValue]\,%LABEL("&lt;b&gt;" + [Territory].[H1].[Region].CurrentMember.Properties("name") + "&lt;/b&gt;&lt;br/&gt;: " + [Measures].[Population] + " .&lt;br/&gt; : " + [Measures].[votersIncludedInVotersList] + " .&lt;br/&gt;  : " + [Measures].[Putin] + "."\,"PopupValue")}</code> </pre> <br>  Let's keep this list of terms as Moscow Elections2018. <br><br>  Next, create a control on the dashboard settings page for a pivot with a map: <br><br>  Location - Mouse Click <br>  Action - Select specials.  lines <br>  Click "OK" <br><br>  We define a name and a list of specials.  columns <br>  ‚Äî   <br>  .  ‚Äî MoscowElections2018.termlist <br><br>  Done! <br><br><h3>  :  URL - </h3><br>    ,  DeepSeeWeb       ,       ()       ‚Äî <code>https://{ac}.tile.openstreetmap.org/{z}/{x}/{y}.png</code> . <br><br>     , . .         <a href="https://switch2osm.org/manually-building-a-tile-server-16-04-2-lts/"></a> . <br><br>           : <br><br><ol><li>  json    DeepSeeWeb    ,   DeepSeeWeb </li><li>   ‚Äúapp.tileServer‚Äù   ‚Äî url    </li><li>   json    </li></ol><br><h4>  json    DeepSeeWeb </h4><br>       json      .      <img src="https://habrastorage.org/webt/wr/xp/ns/wrxpns_1dmksgoamzs9jtgjizpq.png">     DeepSeeWeb ‚Äî     DeepSeeWeb. <br><br><img src="https://habrastorage.org/webt/9f/0g/wt/9f0gwte2x7dmtw2sbhb4qwrvphs.png"><br><br>  ‚ÄúExport settings‚Äù.   json     ¬´tileServer¬ª    ¬´app¬ª.      URL OSM Wikipedia Maps ‚Äî <code>https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}.png</code> .    .    DeepSeeWeb    json     DeepSeeWeb.  Done! <br><br><h2>  Findings: </h2><br>       InterSystems Cach√©, OLAP DeepSee,  DeepSeeWeb, MDX2JSON.     , , ,                   InterSystems Ensemble,      InterSystems Cach√©     InterSystems IRIS Data Platform. <br><br>        : <br><br> ‚Üí <a href="http://37.139.6.217:57773/dsw/index.html"> </a> <br><br>  References: <br><br><ul><li> <a href="https://www.intersystems.com/resources/detail/intersystems-iris-data-platform/">InterSystems IRIS Data platform</a> </li><li> <a href="https://github.com/intersystems-ru/MoscowElections"></a> </li><li> <a href="https://www.intersystems.com/ru/wp-content/uploads/sites/11/DeepSeeWebMapsSetup.pdf">     DeepSeeWeb</a> </li><li> <a href="https://github.com/intersystems-ru/DeepSeeWeb">DeepSeeWeb</a> </li><li> <a href="https://github.com/intersystems-ru/Cache-MDX2JSON">MDX2JSON</a> </li><li> <a href="http://www.izbirkom.ru/region/izbirkom">       </a> </li><li> <a href="http://gis-lab.info/qa/moscow-atd.html">gis-lab</a> </li><li> <a href="https://wiki.openstreetmap.org/wiki/Tile_servers">   OSM</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/351992/">https://habr.com/ru/post/351992/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../351982/index.html">Matthias Noback on Ideal Architecture - Layers, Ports, and Adapters (Part 2 - Layers)</a></li>
<li><a href="../351984/index.html">PHP Digest 127 (March 1 - 25, 2018)</a></li>
<li><a href="../351986/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ307 (March 19 - 25, 2018)</a></li>
<li><a href="../351988/index.html">Uninvented story about performance, reflection and java.lang.Boolean</a></li>
<li><a href="../351990/index.html">Windows Server 2019: Linux and Kubernetes support</a></li>
<li><a href="../351994/index.html">NGINX and gRPC are real friends now</a></li>
<li><a href="../351996/index.html">Guava, Graal and Partial Escape Analysis</a></li>
<li><a href="../351998/index.html">The release of Krita 4.0, a free graphic editor for artists, took place.</a></li>
<li><a href="../352000/index.html">Digital events in Moscow from March 26 to April 1</a></li>
<li><a href="../352002/index.html">A manager from Amazon about layoffs in the US and programmer performance evaluation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>