<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Crossposting in twitter, facebook, livejournal, vkontakte</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When I wrote the project crafthunters.com , I noticed that customers use social networks for promotion. We used widgets and likes, but for good it was...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Crossposting in twitter, facebook, livejournal, vkontakte</h1><div class="post__text post__text-html js-mediator-article"><img src="http://habrastorage.com/images/crosspzkz.png" align="left"><br>  When I wrote the project <a href="http://crafthunters.com/">crafthunters.com</a> , I noticed that customers use social networks for promotion.  We used widgets and likes, but for good it was necessary to get into the news feed.  In addition, the popular VKontakte brought the news to the main page in September.  Those.  to distribute content, it was necessary to adapt the standalone blog for presentation on social networks, using a simple truth: get into the news feed of popular social networks.  Initially, this was done manually and brought more than half of the traffic.  Then the idea came to automate it all. <br>  We used popular social networks: <br><ul><li>  facebook </li><li>  in contact with </li><li>  livejournal </li><li>  twitter </li></ul><br>  It was necessary to set up automatic cross-posting to each of the social networks, which had previously been manually led.  It is also necessary to clarify that it was necessary to post entries in social networks not on the wall / blog, but in the group / community. <br><br>  Next, I want to present the implementation of crossposting for these four social networks for asp.net mvc. <br><a name="habracut"></a><br><br><h1>  0. Basic principles. </h1>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      First of all, you need to get the rights and save them in a database for later use.  The second step was to install content in which group / community (the task is essentially only for VK).  The third step was to create an entry in the group / community with an active link to the original post. <br><br>  For Twitter, Facebook and VKontakte, the OAuth-based API is used and to work with them it was necessary to register the application in each social network for these purposes. <br><br>  In order not to repeat myself, I will immediately tell you how OAuth works (for twitter xAuth).  First we pass the application id and the list of rights we want to get.  The list of permissions is what resources we allow access to for our application.  It looks like this: <br><br><img src="http://www.habrastorage.com/images/requestacc.png"><br><br>  After permission, we get the code by which we get the access token.  For each request to the server, we transfer this token and thus the service provider (VKontakte, facebook and twitter) know that we can be trusted and are allowed to perform the action (in our case, crossposting). <br><br><h1>  1. Livejournal </h1><br><br>  LJ has long been used for cross-posting and it does this through an XML-RPC command. <br>  After reading the documentation ( <a href="http://www.livejournal.com/doc/server/ljp.csp.xml-rpc.protocol.html">http://www.livejournal.com/doc/server/ljp.csp.xml-rpc.protocol.html</a> ) using the library for .net xml-rpc ( <a href="http://www.xml-rpc.net/">http://www.xml-rpc.net/</a> ) I started to implement. <br><br>  Create an interaction interface: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ILj</span></span> : <span class="hljs-title"><span class="hljs-title">IXmlRpcProxy</span></span> { [XmlRpcMethod(<span class="hljs-string"><span class="hljs-string">"LJ.XMLRPC.login"</span></span>)] <span class="hljs-function"><span class="hljs-function">LjUserInfo </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Login</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">UserPassword user</span></span></span><span class="hljs-function">)</span></span>; XmlRpcMethod(<span class="hljs-string"><span class="hljs-string">"LJ.XMLRPC.postevent"</span></span>)] <span class="hljs-function"><span class="hljs-function">PostLjAnswer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Post</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PostLj post</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre> <br><br><h3>  Getting access </h3><br><br>  Login and password are transmitted in the clear and transmitted via the web service protocol.  Create a class to get rights. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">UserPassword</span></span> { [JsonProperty(<span class="hljs-string"><span class="hljs-string">"username"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> username { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [JsonProperty(<span class="hljs-string"><span class="hljs-string">"password"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> password { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ver { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } } }</code> </pre><br><br>  With each publication, the login and password are also transmitted, so the Login method only essentially checks the correctness of the login / password pair. <br><br><h3>  Access check. </h3><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> LjUserInfo </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Auth</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">UserPassword username</span></span></span><span class="hljs-function">)</span></span> { ILj proxy = XmlRpcProxyGen.Create&lt;ILj&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ans = proxy.Login(username); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ans; }</code> </pre><br>  Answer ans we analyze a positive response otherwise we give an error. <br><br>  Adding an entry is just as trivial: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Publish</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">UserPassword username, Post message, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ljgroup = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span> { ILj proxy = XmlRpcProxyGen.Create&lt;ILj&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> post = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PostLj(); post.username = username.username; post.password = username.password; post.ver = <span class="hljs-number"><span class="hljs-number">1</span></span>; post.@<span class="hljs-keyword"><span class="hljs-keyword">event</span></span> = message.Content; post.subject = message.Title; post.lineendings = <span class="hljs-string"><span class="hljs-string">"pc"</span></span>; post.year = DateTime.Now.Year; post.mon = DateTime.Now.Month; post.day = DateTime.Now.Day; post.hour = DateTime.Now.Hour; post.min = DateTime.Now.Minute; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(ljgroup)) { post.usejournal = ljgroup; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { post.usejournal = username.username; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ans = proxy.Post(post); }</code> </pre><br>  Actually everything is very simple.  Of course, there are so many additional options and the library is quite extensive, but the task - to add our post in LJ - is easily solved. <br><br>  What did not like - the transfer of the password in clear text or in md5 over an unprotected channel. <br><br><h1>  2. Twitter </h1><br><br>  For Twitter, I used the popular <a href="http://www.twitterizer.net/">www.twitterizer.net</a> library, but first I had to register the application at: <a href="https://dev.twitter.com/apps">dev.twitter.com/apps</a> . <br><br>  The rights that the application will request - both for reading and for writing.  Among other things, the application receives a token that is infinite in expiration to use.  This token must be saved in the database.  (Table Social.JsonResource) <br><br>  Obtaining rights occurs in the following scenario: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Authorize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> redirectTo</span></span></span><span class="hljs-function">)</span></span> { OAuthTokenResponse requestToken = OAuthUtility.GetRequestToken(Config.twitterConsumerKey, Config.twitterConsumerSecret, redirectTo); <span class="hljs-comment"><span class="hljs-comment">// Direct or instruct the user to the following address: Uri authorizationUri = OAuthUtility.BuildAuthorizationUri(requestToken.Token); return authorizationUri.ToString(); }</span></span></code> </pre><br>  We transfer two keys (application key and secret key), and go to the twitter page to confirm the rights.  Twitter asks for rights and returns us to the address redirectTo where it additionally sends the code.  This code gives us an access token.  Next, we update the status (create a short message) through the application: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Publish</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Post post</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tokens = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OAuthTokens(); tokens.ConsumerKey = Config.twitterConsumerKey; tokens.ConsumerSecret = Config.twitterConsumerSecret; tokens.AccessToken = twitterAccessToken.Token; tokens.AccessTokenSecret = twitterAccessToken.TokenSecret; TwitterStatus.Update(tokens, post.TwitterText); }</code> </pre><br><br><h1>  3. Facebook </h1><br><br>  Register the application at: <a href="https://developers.facebook.com/apps">developers.facebook.com/apps</a> <br><br>  We receive access token.  First, we send to obtain permission rights: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Authorize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> redirectTo</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(AuthorizeUri, Config.AppId, redirectTo); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetFbCode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fbSocial = currentUser.Socials.Where(p =&gt; p.Provider == <span class="hljs-string"><span class="hljs-string">"facebook"</span></span>).FirstOrDefault(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fbSocial != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RedirectToAction(<span class="hljs-string"><span class="hljs-string">"Index"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Redirect(fbProvider.Authorize(<span class="hljs-string"><span class="hljs-string">"http://"</span></span> + HostName + <span class="hljs-string"><span class="hljs-string">"/Social/SaveFbCode"</span></span>)); } }</code> </pre><br>  We process the code to get the access token: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveFbCode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Request.Params.AllKeys.Contains(<span class="hljs-string"><span class="hljs-string">"code"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> code = Request.Params[<span class="hljs-string"><span class="hljs-string">"code"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ProcessFbCode(code)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RedirectToAction(<span class="hljs-string"><span class="hljs-string">"Index"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View(<span class="hljs-string"><span class="hljs-string">"CantInitialize"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessFbCode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> code</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fbProvider.GetAccessToken(code, <span class="hljs-string"><span class="hljs-string">"http://"</span></span> + HostName + <span class="hljs-string"><span class="hljs-string">"/Social/SaveFbCode"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> jObj = fbProvider.GetUserInfo(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fbUserInfo = JsonConvert.DeserializeObject&lt;FbUserInfo&gt;(jObj.ToString()); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fbAccess = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FbAccessToken() { AccessToken = fbProvider.AccessToken }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> jsonFbAccess = JsonConvert.SerializeObject(fbAccess); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fbSocial = currentUser.Socials.Where(p =&gt; p.Provider == <span class="hljs-string"><span class="hljs-string">"facebook"</span></span>).FirstOrDefault(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fbSocial == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { fbSocial = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Models.Social() { UserID = currentUser.ID, JsonResource = jsonFbAccess.ToString(), Provider = <span class="hljs-string"><span class="hljs-string">"facebook"</span></span>, UserInfo = jObj.ToString() }; repository.CreateSocial(fbSocial); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { fbSocial.UserInfo = jObj.ToString(); repository.UpdateSocial(fbSocial); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre><br>  Here, when receiving the perpetual access token, we need to request &amp; scope = ..., offline in the parameter request parameter, thereby saving ourselves to request this token all the time, but for greater secrecy, this fragment can also be redone to use a token with expiration date. <br><br><h3>  Post creation </h3><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CrossPostFb</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> post = repository.Posts.Where(p =&gt; p.ID == id).FirstOrDefault(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fbSocial = currentUser.SocialGetByProvider(<span class="hljs-string"><span class="hljs-string">"facebook"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (post != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; post.UserID == currentUser.ID &amp;&amp; fbSocial != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> postSocial = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Social.Post(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(post.PreviewUrl)) { <span class="hljs-comment"><span class="hljs-comment">//   postSocial.Preview = "http://" + HostName + post.PreviewUrl; } postSocial.Title = post.Title; postSocial.Teaser = post.Subtitle; //    postSocial.Link = "http://" + HostName + "/Post/" + post.ID.ToString(); //   var fbAccess = JsonConvert.DeserializeObject&lt;FbAccessToken&gt;(fbSocial.JsonResource); fbProvider.AccessToken = fbAccess.AccessToken; //  fbProvider.Publish(postSocial); repository.CrossPost(post, Post.CrossProvider.facebook); } return RedirectToAction("Index"); }</span></span></code> </pre><br>  Depending on the parameters set, a record will be created.  When you install the active link, facebook will independently select the image it needs. <br><br><h1>  4. Vkontakte </h1><br><br>  Vkontakte offers the most complex interaction algorithm. <br><br>  Let's start in order: create posts both on the wall and on the group wall can only Standalone application (and not the web), so register the application ( <a href="http://vkontakte.ru/editapp%3Fact%3Dcreate%26site%3D1">http://vkontakte.ru/editapp?act=create&amp;site=1</a> ) you need to specify [x ] Standalone application. <br><br>  Second: to add pictures to the recording, you need to download it beforehand. <br><br>  Third: to upload a picture, you need to request the address of the server that will be downloaded. <br><br>  Fourth: the link to the original post is placed in the attachments parameter and adding a link does not guarantee adding a note. <br><br>  Actually the rest is still the same, so let's get down and get the rights: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetVkCode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vkSocial = currentUser.Socials.Where(p =&gt; p.Provider == <span class="hljs-string"><span class="hljs-string">"vkontakte"</span></span>).FirstOrDefault(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (vkSocial != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RedirectToAction(<span class="hljs-string"><span class="hljs-string">"Index"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Redirect(vkProvider.Authorize(<span class="hljs-string"><span class="hljs-string">"http://"</span></span> + HostName + <span class="hljs-string"><span class="hljs-string">"/Social/SaveVkCode"</span></span>)); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Authorize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> redirectTo</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(AuthorizeUri, Config.AppKey, redirectTo); }</code> </pre><br><br>  For our crossposting, we request the following access levels: photos, groups, wall, offline. <br>  Those.  we can upload photos in groups on the wall at any time. <br><br><h3>  Publication </h3><br><br>  Before posting to a group wall, we need to find out the number of this group by name (groups.getById).  Surprisingly, groups (as well as personal pages) are numbered in the negative direction.  Those. <br>  after getting the result, the gid value should be multiplied by -1. <br><br>  Then we request the server to upload photos: photos.getWallUploadServer, not photos.getUploadServer - although they are almost identical. <br><br>  Next, we will send a photo to the server on VKontakte via the post url request received.  I used the UploadHelper library ( <a href="http://aspnetupload.com/">http://aspnetupload.com/</a> ). <br><br>  After uploading to the server, you need to send a command to save this image: photos.saveWallPhoto - to which we get the photo id.  If you used photos.getUploadServer instead of photos.getWallUploadServer, then the photo will not be saved. <br><br>  And the next step is to add a photo to the wall of the group / or personal page (wall.post). <br><br>  Actually everything. <br><br><h1>  5. Buns </h1><br><br>  You can try here: <a href="http://cocosanka.ru/">http://cocosanka.ru</a> (after registering, you can write something meaningless to the blog, and then ask for it). <br><br>  Download the source here: <a href="https://bitbucket.org/chernikov/cocosanka2">https://bitbucket.org/chernikov/cocosanka2</a> <br><br>  To work with the data, I used the Json.net library ( <a href="http://json.codeplex.com/">http://json.codeplex.com/</a> ) translating the automatically obtained strings into objects. <br><br>  Application keys are stored in Web.config, but you will need to register your own. </div><p>Source: <a href="https://habr.com/ru/post/131107/">https://habr.com/ru/post/131107/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../131099/index.html">Google blocks HTTP referrers from secure search</a></li>
<li><a href="../131100/index.html">HP New Solutions for FlexNetwork Architecture</a></li>
<li><a href="../131101/index.html">WikiLeaks stopped working</a></li>
<li><a href="../131103/index.html">Farminers Academy of Projects pays 1,000 euros for recommending a startup</a></li>
<li><a href="../131105/index.html">Cxxtools template library</a></li>
<li><a href="../131109/index.html">38 billion rubles for copyright infringement</a></li>
<li><a href="../131110/index.html">Test can not be pardoned</a></li>
<li><a href="../131111/index.html">MySQL replication one-slave-multi-master</a></li>
<li><a href="../131112/index.html">Secrets of Meterpreter Payload</a></li>
<li><a href="../131113/index.html">Configuring cisco aaa + tac_plus (tacacs +)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>