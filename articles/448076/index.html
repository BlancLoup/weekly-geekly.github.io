<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple simulation system on Go</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Simulation is a method in which the model under study is replaced by a model for conducting experiments. In this model, you can play as...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple simulation system on Go</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/pu/9e/eg/pu9eeg4seokrai0jac-5y9ojk1s.png" width="200" height="100"></div><br><br><h2>  Introduction </h2><br>  Simulation is a method in which the model under study is replaced by a model for conducting experiments.  In this model, you can play as individual situations, and many of them.  The collected statistics can help draw conclusions about the processes in the system, as well as outline ways to optimize. <br><a name="habracut"></a><br>  Simulation modeling is often considered as a kind of experimental tests, but at the same time it is less expensive, it allows you to quickly change the parameters and observe the simulated system over time. <br><br>  Already about half a century in the simulation modeling computer models are used.  For their development, a huge number of various programs and frameworks have been created, among which, in my opinion, the means for simulating queuing systems (QS) have received the greatest development.  One of the most well-known and simple programs for simulation of QS - GPSS World (General Purpose Simulation System - a general-purpose simulation system), can be found in more detail on the links <a href="http://www.minutemansoftware.com/general_information.htm">[1]</a> , <a href="http://www.gpss.ru/">[2]</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The concept of this program was the basis for the simulation framework for Go. <br><br><h2>  GPSS Modeling </h2><br>  A model in GPSS is a sequence of blocks (commands) describing the simulated objects between which transaction transactions are moved.  When a transaction enters the block, events are generated that lead either to a change in the state of the modeled object or to a change in the state / parameters of the transaction. <br><br>  The basic blocks of the order of ten: GENERATE, TERMINATE, ASSIGN, SEIZE, RELEASE, QUEUE, ADVANCE, DEPART, START.  Total blocks of the order of three dozen.  Blocks have parameters that can be numbers, function names, labels in the modeling program, variable names.  More details on the blocks can be found, for example, <a href="http://iu5.bmstu.ru/pluginfile.php/644/mod_page/content/7/GPSS.pdf">here</a> . <br><br>  Objects in GPSS have a set of standard numeric attributes (NAV) and standard logical attributes (ALS).  For example, for a queue, one of the NAV is the current length, and an example of an ALS for some equipment will be free (TRUE) or it is occupied (FALSE). <br>  In some versions of GPSS there is a visualization of the modeling process, but more often it is absent.  According to the results of modeling in GPSS, a report is generated, indicating the NAV and ALS for all objects. <br><br><h2>  Implementation in go </h2><br>  The implementation in Go is a development of a set of objects of similar functionality with GPSS blocks.  The first was created Pipeline - the object in which the simulation is performed. <br><br>  The <code>map</code> based on a list of components for describing the system being modeled.  Since the simulation of transaction must pass a sequence of blocks in a strict order, in the method of adding the <code>Append</code> components, the procedure of adding with the simultaneous indication of the destination of transactions from them was implemented.  The name of the component is used as the <code>map</code> key; therefore, each component must have a unique name. <br><br>  After adding all the components, you can run a simulation using the <code>Start</code> method.  Inside it is implemented a cyclic crawl of all components for a given simulation time.  At the end of the simulation, you can print a report containing the NAV and ALS. <br><br>  The second important element is the actual components for describing the simulation.  The following were implemented: Generator - generates tranzakty, Advance - creates delays on the transaction path, Queue - queue transacts, Facility - a device monopolistically captured by transact for some time, Hole - ‚Äúhole‚Äù in which transacts fail at the end of the road.  Of course, such a set is not enough to create complex simulation models, but to work out the solution and compare with the GPSS results is enough.  All components implement the IBaseObj interface, which covers the minimum necessary functionality. <br><br>  Each component has a queue of transactions.  Directly as a queue, it is used only in Queue, for other components it is just storage.  The queue is based on a <code>map</code> .  In the process of modeling the components pass through their turn and check the readiness (fulfillment of a certain condition) of the transaction for transfer to the next component.  Passing is done through the <code>AppendTransact</code> method of the next component.  If the transfer is successful, then the transaction is removed from the queue, respectively, the next component takes it in turn.  Since for each component is determined by several destinations, then if it was not possible to send a transaction to one destination, we try to send to a friend. <br><br>  To generate random variables when determining the time of the appearance of a transaction and the creation of delays, the PRNG functions in Go are used. <br><br>  Since, at the same time, during simulation, there can be a number of transacts moving between different components, the idea arose to use goroutines inside components.  Pipeline, passing through the components, runs for each of them a <code>HandleTransacts</code> handler, inside of which a goroutine is created.  After all goroutines work out, the model time counter is increased and <code>HandleTransacts</code> is called <code>HandleTransacts</code> . <br><br>  The last key object is actually the transaction itself.  He has an identifier, the time of birth and death, the owner (in which component he is now), a number of parameters for calculating the NAV and NAV. <br><br>  In fig.  1 shows the structural diagram of the interaction of the main objects of the framework during modeling. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ht/yc/x2/htycx2yszz-c_ljrthrmu5w0xdg.jpeg" width="400" height="200"></div><br>  <b>Fig.</b>  <b>1. A generalized structural diagram of the interaction of the main objects in the simulation</b> <br><br><h2>  Simulation example </h2><br>  Suppose you need to simulate the work of a barber shop.  This is a famous example of GPSS.  Visitors walk erratically, with a frequency of 18 ¬± 6 minutes, their number is not known in advance.  We have one hairdresser, he spends 16 ¬± 4 minutes on a haircut.  So, how many people will he cut for a working day?  How many people will be in line?  How much time will it take to cut and on average how long will people stay in line?  Many questions and simple simulation.  The block diagram in fig.  2 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1a/bb/sf/1abbsf7qcec5fugytkwjydq28mm.jpeg" width="300" height="150"></div><br>  <b>Fig.</b>  <b>2. The structural scheme of modeling barbershop</b> <br><br>  The code for building the model will be as follows. <br><br><pre> <code class="go hljs">barbershop := NewPipeline(<span class="hljs-string"><span class="hljs-string">"Barbershop"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-comment"><span class="hljs-comment">//   clients := NewGenerator("Clients", 18, 6, 0, 0, nil) //   chairs := NewQueue("Chairs") //  master := NewFacility("Master", 16, 4) //  hole := NewHole("Out") //  barbershop.Append(clients, chairs) //       barbershop.Append(chairs, master) //      barbershop.Append(master, hole) //     barbershop.Append(hole) //        barbershop.Start(480) //    &lt;-barbershop.Done //   barbershop.PrintReport()</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">The simulation results can be found here.</b> <div class="spoiler_text">  Pipeline name "Barbershop" <br>  Simulation time 480 <br>  Object name "Chairs" <br>  Max content 1 <br>  Total entries 26 <br>  Zero entries 11 <br>  Persent zero entries 42.31% <br>  In queue 0 <br>  Average time / trans 2.58 <br>  Average time / trans without zero entries 4.47 <br><br>  Object name "Clients" <br>  Generated 26 <br><br>  Object name "Master" <br>  Average advance 16.46 <br>  Average utilization 89.17 <br>  Number entries 26.00 <br>  Transact 26 in facility <br><br>  Object name "Out" <br>  Killed 25 <br>  Average advance 16.56 <br>  Average life 19.44 <br></div></div><br>  Served 25 customers, the 26th at the time of completion of the simulation was still in the chair of the master.  The queue was no more than 1 person, 11 people did not wait (zero pass) and immediately went to the haircut.  On average, people spent 2.58 minutes in the queue, and of those who waited (not a zero pass), 4.47 minutes.  89.17% of his time hairdresser strenuously cut. <br><br>  Of course, if you do another simulation, the results will change.  But when conducting a series of simulations, you will see the overall level of the master download and the number of clients served.  When conducting the same simulation in GPSS, similar results are obtained. <br><br>  Another example.  There is an office, it has 10 employees and one toilet.  People want to go to the toilet every 90 ¬± 60 minutes, go to the toilet for 5 ¬± 3 minutes, take a toilet for 15 ¬± 10 minutes, go back to the office for 5 ¬± 3 minutes.  Let's carry out simulation within 9 hours (8 business hours + 1 hour lunch), on fig.  3 shows the structural scheme. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ni/ef/qf/niefqf8bfmmuojr1xlo3jqjwe_e.jpeg"></div><br>  <b>Fig.</b>  <b>3. Block diagram of the model of employment of the toilet: left with one toilet, right with two</b> <br><br>  On the left is a model with one toilet, on the right with two.  The following is the model code. <br><br><pre> <code class="go hljs">waterclosetsim := NewPipeline(<span class="hljs-string"><span class="hljs-string">"Water Closet Simulation"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) office := NewGenerator(<span class="hljs-string"><span class="hljs-string">"Office"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) wantToToilet:= NewAdvance(<span class="hljs-string"><span class="hljs-string">"Wanted to use the toilet"</span></span>, <span class="hljs-number"><span class="hljs-number">90</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>) pathToWC := NewAdvance(<span class="hljs-string"><span class="hljs-string">"Path to WC"</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) queue := NewQueue(<span class="hljs-string"><span class="hljs-string">"Queue to the WC"</span></span>) pathFromWC := NewAdvance(<span class="hljs-string"><span class="hljs-string">"Path from WC"</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) wc := NewFacility(<span class="hljs-string"><span class="hljs-string">"WC"</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>) pathToOffice:= NewAdvance(<span class="hljs-string"><span class="hljs-string">"Path from WC"</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) waterclosetsim.Append(office, wantToToilet) waterclosetsim.Append(wantToToilet, pathToWC) waterclosetsim.Append(pathToWC, queue) waterclosetsim.Append(queue, wc) waterclosetsim.Append(wc, pathFromWC) waterclosetsim.Append(pathFromWC, wantToToilet) waterclosetsim.Start(<span class="hljs-number"><span class="hljs-number">540</span></span>) &lt;-waterclosetsim.Done waterclosetsim.PrintReport()</code> </pre><br><div class="spoiler">  <b class="spoiler_title">The simulation results are as follows.</b> <div class="spoiler_text">  Pipeline name "Water Closet Simulation" <br>  Simulation time 540 <br>  Object name "Office" <br>  Generated 10 <br><br>  Object name "Path from WC" <br>  Average advance 5.77 <br><br>  Object name "Path to WC" <br>  Average advance 5.22 <br><br>  Object name "Queue to the WC" <br>  Max content 4 <br>  Total entries 36 <br>  Zero entries 8 <br>  Persent zero entries 22.22% <br>  Current contents 4 <br>  Average content 1.78 <br>  Average time / trans 24.11 <br>  Average time / trans without zero entries 31.00 <br><br>  Object name "WC" <br>  Average advance 14.69 <br>  Average utilization 87.04 <br>  Number entries 32.00 <br>  Transact 2 in facility <br><br>  Object name "Wanted to use the toilet" <br>  Average advance 95.85 <br></div></div><br>  In the queue there were up to 4 people, 8 times a person immediately went to the toilet, during the working day the toilet is used by 87.04%.  The most significant thing, in my opinion, is that people are waiting for the order of half an hour (31 minutes) in the queue for the toilet.  Perhaps this is due to the fact that the toilet is one, and perhaps due to the fact that, on average, people sit in it for 14.69 minutes. <br><br>  Adding another toilet, I saw that the line was reduced to 3 people, 29 people immediately went to the toilet.  But most importantly, the expectation has decreased almost three times. <br><br><h2>  Conclusion </h2><br>  The framework created on the knee is fairly simple and as yet limited.  Plans to increase its functionality to the level of GPSS.  The practical value of the framework is the ability to easily and quickly build a simulation model on Go and get results. <br><br>  <a href="https://github.com/soldatov-s/go-gpss">The code is posted on github</a> . </div><p>Source: <a href="https://habr.com/ru/post/448076/">https://habr.com/ru/post/448076/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448058/index.html">Developing a hexapod from scratch (part 5) - electronics</a></li>
<li><a href="../448060/index.html">We write a simple NTP client</a></li>
<li><a href="../448068/index.html">American scientists have taught robots to use auxiliary tools</a></li>
<li><a href="../448072/index.html">Joins understanding is broken. This is definitely not a lap crossing, honestly</a></li>
<li><a href="../448074/index.html">ALU on 12 transistors (actually not)</a></li>
<li><a href="../448078/index.html">On autoregressive estimation of the spectral density of a stationary signal</a></li>
<li><a href="../448080/index.html">Robo-footballer from beginners. Competitions in MIPT. Android & Arduino & Bluetooth</a></li>
<li><a href="../448082/index.html">[Before Monday] Dry Eye Syndrome</a></li>
<li><a href="../448084/index.html">Photo of a black hole - will it benefit?</a></li>
<li><a href="../448088/index.html">Production of plasma engines in Russia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>