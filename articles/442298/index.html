<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Gatsby.js in detail</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As you know, on some boilerplates you won't get far, so you have to go deep into any technology to learn how to write something worthwhile. This artic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">🔎</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">📜</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">⬆️</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">⬇️</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Gatsby.js in detail</h1><div class="post__text post__text-html js-mediator-article"><p>  As you know, on some boilerplates you won't get far, so you have to go deep into any technology to learn how to write something worthwhile.  This article covers the details of <strong>Gatsby.js</strong> , the knowledge of which will allow you to create and maintain complex websites and blogs. </p><a name="habracut"></a><br><blockquote>  <a href="https://habr.com/ru/post/439232/">Previous article</a> on how to create and publish a personal blog using the JAM stack </blockquote><p>  Topics covered below: </p><br><ul><li>  <a href="https://habr.com/ru/post/442298/">Page structure and routing</a> </li><li>  <a href="https://habr.com/ru/post/442298/">Components, patterns and their interaction</a> </li><li>  <a href="https://habr.com/ru/post/442298/">Work with data</a> </li><li>  <a href="https://habr.com/ru/post/442298/">Plugins</a> </li><li>  <a href="https://habr.com/ru/post/442298/">Styling applications</a> </li><li>  <a href="https://habr.com/ru/post/442298/">React-helmet seo optimization</a> </li><li>  <a href="https://habr.com/ru/post/442298/">PWA Setup</a> </li></ul><br><h2 id="podgotovka">  Training </h2><br><div class="spoiler">  <b class="spoiler_title">Installing Gatsby on a PC</b> <div class="spoiler_text"><pre><code class="bash hljs">yarn global add gatsby-cli</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Minimum project cloning</b> <div class="spoiler_text"><pre> <code class="bash hljs"> npx gatsby new gatsby-tutorial https://github.com/gatsbyjs/gatsby-starter-hello-world <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> gatsby-tutorial</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Repository Initialization</b> <div class="spoiler_text"><pre> <code class="bash hljs"> git init git add . git commit -m <span class="hljs-string"><span class="hljs-string">"init commit"</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Health check</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> yarn start</code> </pre> <br><p>  If there are no errors in the console, and in the browser on the path <a href="http://localhost:8000/">http: // localhost: 8000 you</a> can see "Hello world!"  then everything is working properly.  You can try changing the contents of the <em>/src/pages/index.js</em> file to check the hot-reload. </p></div></div><br><h2 id="struktura-stranic-i-routing">  Page structure and routing </h2><br><p>  To create a page in Gatsby, simply place the new file in the <em>/ src / pages</em> folder, and it will be compiled into a separate HTML page.  <strong>It is important to note that the path to this page will correspond to the actual path with the name</strong> .  For example, add some more pages: </p><br><pre> <code class="plaintext hljs">src └── pages ├── about.js ├── index.js └── tutorial ├── part-four.js ├── part-one.js ├── part-three.js ├── part-two.js └── part-zero.js</code> </pre><br><p>  Content is not important yet, so you can use any text to distinguish between pages. </p><br><pre> <code class="plaintext hljs">import React from "react"; export default () =&gt; &lt;div&gt;Welcome to tutorial/part-one&lt;/div&gt;;</code> </pre> <br><p>  Check in the browser: </p><br><ul><li>  <a href="http://localhost:8000/tutorial/part-one">http: // localhost: 8000 / tutorial / part-one</a> </li><li>  <a href="http://localhost:8000/about">http: // localhost: 8000 / about</a> </li></ul><br><p>  In this way, by structuring the files, you can immediately solve the routing issues. </p><br><blockquote>  There is also a special <strong>createPage API</strong> , with which you can more flexibly manage the paths and names of pages, but to work with it we need an understanding of how the data works in Gatsby, so we will look at it a little further in the article. </blockquote><p>  Let's combine the created pages with the help of links, for this we will use the <code>&lt;Link /&gt;</code> component from the Gatsby package, which was created specifically for internal navigation.  For all external links, use the regular <code>&lt;a&gt;</code> tag. </p><br><p>  <em>/src/pages/index.js</em> </p><br><pre> <code class="plaintext hljs">import React from "react"; import { Link } from "gatsby"; export default () =&gt; ( &lt;div&gt; &lt;ul&gt; &lt;li&gt; &lt;Link to="/about"&gt;about&lt;/Link&gt; &lt;/li&gt; &lt;li&gt; &lt;Link to="/tutorial/part-zero"&gt;Part #0&lt;/Link&gt; &lt;/li&gt; &lt;li&gt; &lt;Link to="/tutorial/part-one"&gt;Part #1&lt;/Link&gt; &lt;/li&gt; &lt;li&gt; &lt;Link to="/tutorial/part-two"&gt;Part #2&lt;/Link&gt; &lt;/li&gt; &lt;li&gt; &lt;Link to="/tutorial/part-three"&gt;Part #3&lt;/Link&gt; &lt;/li&gt; &lt;li&gt; &lt;Link to="/tutorial/part-four"&gt;Part #4&lt;/Link&gt; &lt;/li&gt; &lt;/ul&gt; &lt;/div&gt; );</code> </pre> <br><blockquote>  <code>&lt;Link&gt;</code> under the hood has a very tricky mechanism for optimizing page load and is therefore used instead of <code>&lt;a&gt;</code> for navigating the site.  You can read more <a href="https://www.gatsbyjs.org/docs/gatsby-link/">here</a> . </blockquote><p><img src="https://habrastorage.org/webt/no/ev/fj/noevfjkjdbel6tonxughcn6mkfq.gif" alt="navigation"></p><br><p>  The pages are created, the links are added, it turns out that the navigation is finished. </p><br><h2 id="komponenty-shablony-i-ih-vzaimodeystvie">  Components, patterns and their interaction </h2><br><p>  As you know, in any project there are always duplicate elements, for websites it is a header, footer, navigation bar.  Also the pages, regardless of the content, are structured according to a certain structure, and since <strong>Gatsby</strong> is a compiler for <strong>React</strong> , the same component approach is used here to solve these problems. </p><br><p>  Create components for the header and navigation bar: </p><br><p>  <em>/src/components/header.js</em> </p><br><pre> <code class="plaintext hljs">import React from "react"; import { Link } from "gatsby"; /** *         *  ,     React-. *      ,    *  " ".     *    ""  GraphQL  gatsby- */ import logoSrc from "../images/logo.png"; export default () =&gt; ( &lt;header&gt; &lt;Link to="/"&gt; &lt;img src={logoSrc} alt="logo" width="60px" height="60px" /&gt; &lt;/Link&gt; That is header &lt;/header&gt; );</code> </pre> <br><p>  <em>/src/components/sidebar.js</em> </p><br><pre> <code class="plaintext hljs">import React from "react"; import { Link } from "gatsby"; export default () =&gt; ( &lt;div&gt; &lt;ul&gt; &lt;li&gt; &lt;Link to="/about"&gt;about&lt;/Link&gt; &lt;/li&gt; &lt;li&gt; &lt;Link to="/tutorial/part-zero"&gt;Part #0&lt;/Link&gt; &lt;/li&gt; &lt;li&gt; &lt;Link to="/tutorial/part-one"&gt;Part #1&lt;/Link&gt; &lt;/li&gt; &lt;li&gt; &lt;Link to="/tutorial/part-two"&gt;Part #2&lt;/Link&gt; &lt;/li&gt; &lt;li&gt; &lt;Link to="/tutorial/part-three"&gt;Part #3&lt;/Link&gt; &lt;/li&gt; &lt;li&gt; &lt;Link to="/tutorial/part-four"&gt;Part #4&lt;/Link&gt; &lt;/li&gt; &lt;/ul&gt; &lt;/div&gt; );</code> </pre> <br><p>  and add them to <em>/src/pages/index.js</em> </p><br><pre> <code class="plaintext hljs">import React from "react"; import Header from "../components/header"; import Sidebar from "../components/sidebar"; export default () =&gt; ( &lt;div&gt; &lt;Header /&gt; &lt;Sidebar /&gt; &lt;h1&gt;Index page&lt;/h1&gt; &lt;/div&gt; );</code> </pre> <br><p>  Checking: </p><br><p><img src="https://habrastorage.org/webt/bg/l6/jn/bgl6jndogi4j0qzvm9q0jvsiglk.jpeg" alt="index_page"></p><br><p>  Everything works, but we need to import Header and Sidebar into each page separately, which is not very convenient, and to solve this issue it is enough to create a layout component and wrap each page with it. </p><br><blockquote>  Gatsby layout == React container <br>  <em>Yes, yes, it is a non-strict equality, because it is "almost" the same thing.</em> </blockquote><p>  <em>/src/components/layout.js</em> </p><br><pre> <code class="plaintext hljs">import React from "react"; import Header from "./header"; import Sidebar from "./sidebar"; export default ({ children }) =&gt; ( &lt;&gt; &lt;Header /&gt; &lt;div style={{ margin: `0 auto`, maxWidth: 650, backgroundColor: `#eeeeee` }} &gt; &lt;Sidebar /&gt; {children} &lt;/div&gt; &lt;/&gt; );</code> </pre> <br><p>  <em>/src/pages/index.js</em> (and all other pages) </p><br><pre> <code class="plaintext hljs">import React from "react"; import Layout from "../components/layout"; export default () =&gt; ( &lt;Layout&gt; &lt;h1&gt;Index page&lt;/h1&gt; &lt;/Layout&gt; );</code> </pre> <br><p>  Done, look into the browser: </p><br><p><img src="https://habrastorage.org/webt/9p/9v/wo/9p9vwogkf2px--00mtzbgz2ke64.gif" alt="layout"></p><br><blockquote>  Why in the project all the file names in small letters?  To begin with, we decide that the namespacing for <strong>React</strong> comes from the fact that "every file is a class, and the class is always called with a capital letter."  In <strong>Gatsby,</strong> files still contain classes, but there is one “but” - “each file is a potential page, and its name is the URL to this page”.  The community has concluded that links like <code>http://domain.com/User/Settings</code> are not <em>comme-il-faut</em> and have approved kebab-case for file names. </blockquote><br><div class="spoiler">  <b class="spoiler_title">File structure</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> src ├── components │ ├── header.js │ ├── layout.js │ └── sidebar.js ├── images │ └── logo.png └── pages ├── about.js ├── index.js └── tutorial ├── part-eight.js ├── part-five.js ├── part-four.js ├── part-one.js ├── part-seven.js ├── part-six.js ├── part-three.js ├── part-two.js └── part-zero.js</code> </pre> </div></div><br><h2 id="rabota-s-dannymi">  Work with data </h2><br><p>  Now that the structure of the site is ready, you can proceed to filling the content.  The classic "hardcode" approach did not suit the creators of the JAM stack, as well as the "render content from AJAX requests" and therefore they suggested filling sites with content during compilation.  In the case of <strong>Gatsby</strong> , <strong>GraphQL</strong> is responsible for this, which makes it convenient to work with data streams from any sources. </p><br><blockquote>  To tell about GraphQL in a nutshell is impossible, so it is advisable to study it yourself or wait for my next article.  You can read more about working with GraphQL <a href="https://www.howtographql.com/">here</a> . </blockquote><p>  To work with <strong>GraphQL</strong> , from the second version, the <code>gatsby</code> package <code>gatsby</code> component, which can be used both on pages and in simple components, and this is its main difference from its predecessor - <a href="https://www.gatsbyjs.org/docs/page-query/">page query</a> .  So far, our site is not connected to any data sources, so we will try to display the metadata of the pages, for example, and then move on to more complex things. </p><br><p>  To build a <code>query</code> you need to open <a href="http://localhost:8000/___graphql">http: // localhost: 8000 / ___ graphql</a> , and use the sidebar with the documentation to find the available data on the site, and do not forget about autocompletion. </p><br><p><img src="https://habrastorage.org/webt/qw/im/yd/qwimydi9eummj2mlkdpuzxdlg_0.gif" alt="graphql"></p><br><p>  <em>/src/components/sidebar.js</em> </p><br><pre> <code class="plaintext hljs">import React from "react"; import { Link, StaticQuery, graphql } from "gatsby"; export default () =&gt; ( &lt;StaticQuery query={graphql` { allSitePage { edges { node { id path } } } } `} render={({ allSitePage: { edges } }) =&gt; ( &lt;ul&gt; {edges.map(({ node: { id, path } }) =&gt; ( &lt;li key={id}&gt; &lt;Link to={path}&gt;{id}&lt;/Link&gt; &lt;/li&gt; ))} &lt;/ul&gt; )} /&gt; );</code> </pre> <br><p>  Now we use <code>query</code> get data about the pages that we render in the navigation bar, and no longer need to worry about the fact that the link will not match the name, because all data is collected automatically. </p><br><p><img src="https://habrastorage.org/webt/nc/pk/6l/ncpk6l8hirx9guim5am6ikgpfvo.jpeg" alt="queried_navigation_panel"></p><br><p>  In fact, this is all the data that can be on our site without using third-party plug-ins and without the good old "hardcode", so we smoothly go to the next topic of our article - plug-ins. </p><br><h2 id="plaginy">  Plugins </h2><br><p>  At its core, Gatsby is a compiler with a bunch of buns, which are just plugins.  Using them, you can customize the processing of certain files, data types and various formats. </p><br><p>  Create the file <em>/gatsby-config.js</em> at the root level of the application.  which is responsible for the configuration of the compiler as a whole, and try to configure the first plugin to work with files: </p><br><p>  Installing the plugin: </p><br><pre> <code class="bash hljs">yarn add gatsby-source-filesystem</code> </pre> <br><p>  Configuration in the <em>/gatsby-config.js</em> file <em>:</em> </p><br><pre> <code class="plaintext hljs">module.exports = { plugins: [ { resolve: `gatsby-source-filesystem`, options: { name: `images`, path: `${__dirname}/src/images/`, } } ], }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">More about the file above</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> /** * gatsby-config.js     *     JS *     */ module.exports = { /** *  'plugins'  pipeline  * ,      */ plugins: [ /** *        , *         */ `gatsby-example-plugin`, { resolve: `gatsby-source-filesystem`, options: { name: `images`, path: `${__dirname}/src/images/`, } } ], }</code> </pre> </div></div><br><p>  Remember we talked about the "correct" import of pictures in <strong>Gatsby</strong> ? </p><br><p>  <em>/src/components/header.js</em> </p><br><pre> <code class="plaintext hljs">import React from "react"; import { Link, StaticQuery, graphql } from "gatsby"; export default () =&gt; ( &lt;StaticQuery query={graphql` { allFile(filter: { name: { eq: "logo" } }) { edges { node { publicURL } } } } `} render={({ allFile: { edges: [ { node: { publicURL } } ] } }) =&gt; ( &lt;header&gt; &lt;Link to="/"&gt; &lt;img src={publicURL} alt="logo" width="60px" height="60px" /&gt; &lt;/Link&gt; That is header &lt;/header&gt; )} /&gt; );</code> </pre> <br><p>  Nothing has changed on the site, but now the picture is substituted using GraphQL, instead of a simple webpack-import.  At first glance, it may seem that the constructions are too complicated and these were unnecessary gestures, but let's not be in a hurry with the conclusions, because everything is in the same plugins.  For example, if we decided to post thousands of photos on the site, then in any case we had to think about optimizing the download of all the content, and in order not to build our <a href="https://developers.google.com/web/fundamentals/performance/lazy-loading-guidance/images-and-video/">lazy-load process</a> from scratch, we would simply add a <a href="https://www.gatsbyjs.org/packages/gatsby-image/">gatsby-image</a> plugin that would optimize the loading of all images imported using <code>query</code> . </p><br><p>  Installing plug-ins for styling: </p><br><pre> <code class="bash hljs">yarn add gatsby-plugin-typography react-typography typography typography-theme-noriega node-sass gatsby-plugin-sass gatsby-plugin-styled-components styled-components babel-plugin-styled-components</code> </pre> <br><p>  <em>gatsby-config.js</em> </p><br><pre> <code class="plaintext hljs">module.exports = { plugins: [ { resolve: `gatsby-source-filesystem`, options: { name: `images`, path: `${__dirname}/src/images/` } }, // add style plugins below `gatsby-plugin-typography`, `gatsby-plugin-sass`, `gatsby-plugin-styled-components` ] };</code> </pre> <br><blockquote>  On the <a href="https://www.gatsbyjs.org/plugins/">official site</a> you can find a plugin for every taste. </blockquote><br><h2 id="stilizaciya-prilozheniya">  Styling applications </h2><br><p>  We proceed to the stylization of the application using various approaches.  In the previous step, we already installed plugins for working with <a href="https://sass-lang.com/">SASS</a> , <a href="https://www.styled-components.com/">styled-components</a> and the <a href="https://kyleamathews.github.io/typography.js/">typography.js</a> library, while it is important to note that css.modules are supported out of the box. </p><br><p>  Let's start working with global styles, which, like other things related to the whole site, should be configured in the <em>/gatsby-browser.js</em> file: </p><br><pre> <code class="plaintext hljs">import "./src/styles/global.scss";</code> </pre> <br><blockquote>  More about <a href="https://www.gatsbyjs.org/docs/browser-apis/">gatsby-browser.js</a> </blockquote><p>  <em>/src/styles/global.scss</em> </p><br><pre> <code class="plaintext hljs">body { background-color: lavenderblush; }</code> </pre> <br><p>  For various reasons, the trends of recent years tend towards the "CSS in JS" approach, so you should not abuse global styles and it’s better to limit yourself to specifying the font and reusable classes.  This particular project is planning to use <strong>Typography.js</strong> for this purpose, so global styles will remain empty. </p><br><p>  You may have already noticed changes in the appearance of the site after adding <code>gatsby-plugin-typography</code> to the configuration — this is because its default preset was applied, and now we will configure it for ourselves. </p><br><p>  <em>/src/utils/typography.js</em> </p><br><pre> <code class="plaintext hljs">import Typography from "typography"; import theme from "typography-theme-noriega"; const typography = new Typography(theme); export default typography;</code> </pre> <br><blockquote>  You can choose any other preset from the <a href="">list</a> or create your own using the API package (configuration <a href="">example of</a> the official Gatsby website) </blockquote><p>  <em>/gatsby-config.js</em> </p><br><pre> <code class="plaintext hljs">module.exports = { plugins: [ { resolve: `gatsby-source-filesystem`, options: { name: `images`, path: `${__dirname}/src/images/` } }, { resolve: `gatsby-plugin-typography`, options: { pathToConfigModule: `src/utils/typography` } }, `gatsby-plugin-sass`, `gatsby-plugin-styled-components` ] };</code> </pre> <br><p>  And depending on the selected preset, the global style of the site will be changed.  What approach to customize global styles is decided by yourself; this is a matter of personal preferences and there are no differences from a technical point of view, and we turn to styling components using <strong>styled-components</strong> : </p><br><p>  Add a file with global variables <em>/src/utils/vars.js</em> </p><br><pre> <code class="plaintext hljs">export const colors = { main: `#663399`, second: `#fbfafc`, main50: `rgba(102, 51, 153, 0.5)`, second50: `rgba(251, 250, 252, 0.5)`, textMain: `#000000`, textSecond: `#ffffff`, textBody: `#222222` };</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">/src/components/header.js</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> import React from "react"; import { Link, StaticQuery, graphql } from "gatsby"; import styled from "styled-components"; import { colors } from "../utils/vars"; const Header = styled.header` width: 100%; height: 3em; display: flex; justify-content: space-between; align-items: center; background-color: ${colors.main}; color: ${colors.textSecond}; padding: 0.5em; `; const Logo = styled.img` border-radius: 50%; height: 100%; `; const logoLink = `height: 100%;`; export default () =&gt; ( &lt;StaticQuery query={graphql` { allFile(filter: { name: { eq: "logo" } }) { edges { node { publicURL } } } } `} render={({ allFile: { edges: [ { node: { publicURL } } ] } }) =&gt; ( &lt;Header&gt; That is header &lt;Link to="/" css={logoLink}&gt; &lt;Logo src={publicURL} alt="logo" /&gt; &lt;/Link&gt; &lt;/Header&gt; )} /&gt; );</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">/src/components/sidebar.js</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> import React from "react" import { Link, StaticQuery, graphql } from "gatsby" import styled from "styled-components" import { colors } from "../utils/vars" const Sidebar = styled.section` position: fixed; left: 0; width: 20%; height: 100%; display: flex; flex-direction: column; justify-content: center; background-color: ${colors.second}; color: ${colors.textMain}; ` const navItem = ` display: flex; align-items: center; margin: 0 1em 0 2em; padding: 0.5em 0; border-bottom: 0.05em solid ${colors.mainHalf}; postion: relative; color: ${colors.textBody}; text-decoration: none; &amp;:before { content: ''; transition: 0.5s; width: 0.5em; height: 0.5em; position: absolute; left: 0.8em; border-radius: 50%; display: block; background-color: ${colors.main}; transform: scale(0); } &amp;:last-child { border-bottom: none; } &amp;:hover { &amp;:before { transform: scale(1); } } ` export default () =&gt; ( &lt;StaticQuery query={graphql` { allSitePage { edges { node { id, path } } } } `} render={({ allSitePage: { edges } }) =&gt; ( &lt;Sidebar&gt; { edges.map(({ node: { id, path } }) =&gt; ( &lt;Link to={path} key={id} css={navItem} &gt;{id}&lt;/Link&gt; )) } &lt;/Sidebar&gt; )} /&gt; )</code> </pre> </div></div><br><p><img src="https://habrastorage.org/webt/qf/1w/i6/qf1wi6f95fjjjx794g8qvujbksw.gif" alt="styled"></p><br><p>  Already existing elements are stylized, and it's time to link the content with <a href="https://www.contentful.com/">Contentful</a> , connect the markaun plugin and generate pages using the <strong>createPages API</strong> . </p><br><blockquote>  Read more about how to link Gatsby and Contentful in the <a href="https://habr.com/ru/post/439232/">previous article.</a> </blockquote><br><div class="spoiler">  <b class="spoiler_title">Structure of my data with contentful</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> [ { "id": "title", "type": "Symbol" }, { "id": "content", "type": "Text", }, { "id": "link", "type": "Symbol", }, { "id": "orderNumber", "type": "Integer", } ]</code> </pre> </div></div><br><p>  Package installation: </p><br><pre> <code class="bash hljs">yarn add dotenv gatsby-source-contentful gatsby-transformer-remark</code> </pre> <br><p>  <em>/gatsby-config.js</em> </p><br><pre> <code class="plaintext hljs">if (process.env.NODE_ENV === "development") { require("dotenv").config(); } module.exports = { plugins: [ `gatsby-transformer-remark`, { resolve: `gatsby-source-filesystem`, options: { name: `images`, path: `${__dirname}/src/images/`, } }, { resolve: `gatsby-plugin-typography`, options: { pathToConfigModule: `src/utils/typography`, }, }, { resolve: `gatsby-source-contentful`, options: { spaceId: process.env.CONTENTFUL_SPACE_ID, accessToken: process.env.CONTENTFUL_ACCESS_TOKEN, }, }, `gatsby-plugin-sass`, `gatsby-plugin-styled-components`, ], }</code> </pre> <br><p>  Delete the <em>/ src / pages</em> folder with all the files inside and create a new file to manage the nodes in Gatsby: </p><br><p>  <em>/gatsby-node.js</em> </p><br><pre> <code class="plaintext hljs">const path = require(`path`); /** *  ,      *       */ exports.createPages = ({ graphql, actions }) =&gt; { /** *        *        *    */ const { createPage } = actions; return graphql(` { allContentfulArticle { edges { node { title link content { childMarkdownRemark { html } } } } } } `).then(({ data: { allContentfulArticle: { edges } } }) =&gt; { /** *       *  createPage()    *      */ edges.forEach(({ node }) =&gt; { createPage({ path: node.link, component: path.resolve(`./src/templates/index.js`), context: { slug: node.link } }); }); }); };</code> </pre> <br><blockquote>  More about <a href="https://www.gatsbyjs.org/docs/node-apis/">gatsby-node.js</a> </blockquote><p>  Create a template file that will be the basis for the generated pages. <br>  <em>/src/templates/index.js</em> </p><br><pre> <code class="plaintext hljs">import React from "react"; import { graphql } from "gatsby"; import Layout from "../components/layout"; export default ({ data: { allContentfulArticle: { edges: [ { node: { content: { childMarkdownRemark: { html } } } } ] } } }) =&gt; { return ( &lt;Layout&gt; &lt;div dangerouslySetInnerHTML={{ __html: html }} /&gt; &lt;/Layout&gt; ); }; export const query = graphql` query($slug: String!) { allContentfulArticle(filter: { link: { eq: $slug } }) { edges { node { title link content { childMarkdownRemark { html } } } } } } `;</code> </pre> <br><blockquote>  Why isn't the <code>&lt;StaticQuery /&gt;</code> component used here?  The thing is that it does not support variables for building a query, and we need to use the <code>$slug</code> variable from the page context. </blockquote><br><div class="spoiler">  <b class="spoiler_title">We update the logic in the navigation bar</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> import React from "react"; import { Link, StaticQuery, graphql } from "gatsby"; import styled from "styled-components"; import { colors } from "../utils/vars"; const Sidebar = styled.section` position: fixed; left: 0; width: 20%; height: 100%; display: flex; flex-direction: column; justify-content: center; background-color: ${colors.second}; color: ${colors.textMain}; `; const navItem = ` display: flex; align-items: center; margin: 0 1em 0 2em; padding: 0.5em 0; border-bottom: 0.05em solid ${colors.main50}; postion: relative; color: ${colors.textBody}; text-decoration: none; &amp;:before { content: ''; transition: 0.5s; width: 0.5em; height: 0.5em; position: absolute; left: 0.8em; border-radius: 50%; display: block; background-color: ${colors.main}; transform: scale(0); } &amp;:last-child { border-bottom: none; } &amp;:hover { &amp;:before { transform: scale(1); } } `; export default () =&gt; ( &lt;StaticQuery query={graphql` { allContentfulArticle(sort: { order: ASC, fields: orderNumber }) { edges { node { title link orderNumber } } } } `} render={({ allContentfulArticle: { edges } }) =&gt; ( &lt;Sidebar&gt; {edges.map(({ node: { title, link, orderNumber } }) =&gt; ( &lt;Link to={link} key={link} css={navItem}&gt; {orderNumber}. {title} &lt;/Link&gt; ))} &lt;/Sidebar&gt; )} /&gt; );</code> </pre> </div></div><br><p><img src="https://habrastorage.org/webt/fn/bc/fs/fnbcfsl-qbdzkh1murfclmr7itk.gif" alt="data"></p><br><h2 id="seo-optimizaciya">  SEO optimization </h2><br><p>  On the technical side, the site can be considered ready, so let's work with its meta-data.  For this we need the following plugins: </p><br><pre> <code class="bash hljs">yarn add gatsby-plugin-react-helmet react-helmet</code> </pre> <br><blockquote>  <a href="https://github.com/nfl/react-helmet">react-helmet</a> generates a <code>&lt;head&gt;...&lt;/head&gt;</code> for HTML pages and in conjunction with Gatsby rendering is a powerful and convenient tool for working with SEO. </blockquote><p>  <em>/src/templates/index.js</em> </p><br><pre> <code class="plaintext hljs">import React from "react"; import { graphql } from "gatsby"; import { Helmet } from "react-helmet"; import Layout from "../components/layout"; export default ({ data: { allContentfulArticle: { edges: [ { node: { title, content: { childMarkdownRemark: { html } } } } ] } } }) =&gt; { return ( &lt;Layout&gt; &lt;Helmet&gt; &lt;meta charSet="utf-8" /&gt; &lt;title&gt;{title}&lt;/title&gt; &lt;/Helmet&gt; &lt;div dangerouslySetInnerHTML={{ __html: html }} /&gt; &lt;/Layout&gt; ); }; export const query = graphql` query($slug: String!) { allContentfulArticle(filter: { link: { eq: $slug } }) { edges { node { title link content { childMarkdownRemark { html } } } } } } `;</code> </pre> <br><p>  Now the <code>title</code> site will always correspond to the title of the article, which will significantly affect the issue of the site in the search results specifically on this issue.  Here you can also easily add <code>&lt;meta name="description" content=" "&gt;</code> with the description of each article separately, thus allowing the user to understand what the article is about on the search page, in general, all SEO features are now available and manageable in one place. </p><br><p><img src="https://habrastorage.org/webt/_7/l2/ht/_7l2hthmllnqdgycorxhaz2v_mw.png" alt="seo"></p><br><h2 id="nastroyka-pwa">  PWA Setup </h2><br><p>  <strong>Gatsby is</strong> designed to deliver premium out-of-the-box performance.  It takes care of the separation and minimization of code, as well as optimization in the form of preloading in the background, image processing, etc., so that the site you create has high performance without any manual configuration.  These performance features are an important part of supporting a progressive approach to web applications. </p><br><p>  But besides all the above, there are three basic criteria for the site, which define it as <a href="https://developers.google.com/web/progressive-web-apps/">PWA</a> : </p><br><ul><li>  https protocol </li><li>  availability <a href="https://www.w3.org/TR/appmanifest/">manifest.json</a> </li><li>  offline access to the site at the expense of <a href="https://developers.google.com/web/fundamentals/primers/service-workers/">service workers</a> </li></ul><br><p>  The first item cannot be solved by Gatsby, as the <em>domain</em> , <em>hosting</em> and <em>protocol</em> are deployment issues, and not development at all, but I can recommend <a href="https://www.netlify.com/">Netlify</a> , which solves the https issue by default. </p><br><p>  Go to the rest of the points, for this we install two plugins: </p><br><pre> <code class="bash hljs">yarn add gatsby-plugin-manifest gatsby-plugin-offline</code> </pre> <br><p>  and configure them <em>/src/gatsby-config.js</em> </p><br><pre> <code class="plaintext hljs">if (process.env.NODE_ENV === "development") { require("dotenv").config(); } module.exports = { plugins: [ { resolve: `gatsby-plugin-manifest`, options: { name: `GatsbyJS translated tutorial`, short_name: `GatsbyJS tutorial`, start_url: `/`, background_color: `#f7f0eb`, theme_color: `#a2466c`, display: `standalone`, icon: `public/favicon.ico`, include_favicon: true } }, `gatsby-plugin-offline`, `gatsby-transformer-remark`, { resolve: `gatsby-source-filesystem`, options: { name: `images`, path: `${__dirname}/src/images/` } }, { resolve: `gatsby-plugin-typography`, options: { pathToConfigModule: `src/utils/typography` } }, { resolve: `gatsby-source-contentful`, options: { spaceId: process.env.CONTENTFUL_SPACE_ID, accessToken: process.env.CONTENTFUL_ACCESS_TOKEN } }, `gatsby-plugin-sass`, `gatsby-plugin-styled-components`, `gatsby-plugin-react-helmet` ] };</code> </pre> <br><p>  You can customize your manifest using the <a href="https://www.w3.org/TR/appmanifest/">documentation</a> , as well as customize the service-workers strategy by <a href="https://www.npmjs.com/package/gatsby-plugin-offline">overwriting the plugin settings</a> . </p><br><p>  You will not notice any changes in the development mode, but the site already meets the latest requirements of the web world, and when it is placed on the https: // domain it will not be equal. </p><br><h2 id="vyvod">  Conclusion </h2><br><p>  A couple of years ago when I first encountered the problems of launching a React-application into the Internet, supporting it and updating content, I could not even imagine that there was already a JAM-stack approach on the market that simplifies all these processes, and now I can not stop wondering simplicity.  Gatsby solves most of the issues affecting the performance of the site simply out of the box, and if you understand the subtleties a little more to customize it to fit your needs, you can get 100% performance on all items in the <a href="https://developers.google.com/web/tools/lighthouse/">Lighthouse</a> , which will significantly affect the search engine results ( least in google). </p><br><p>  <a href="https://github.com/alexandrtovmach/gatsby-tutorial">Project repository</a> </p><br><h2 id="posleslovie">  Afterword </h2><br><p>  As you may have noticed, the draft considered in the article copies the main site with the documentation of Gatsby.js, and this is no accident, because I swung to translate at least an introductory tutorial into Russian and Ukrainian languages ​​to popularize this stack in our countries.  View the current version here: </p><br><p>  <a href="https://gatsbyjs-tutorial.alexandrtovmach.com/">https://gatsbyjs-tutorial.alexandrtovmach.com</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/442298/">https://habr.com/ru/post/442298/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../442284/index.html">NoVerify: Linter for PHP from Team VKontakte is now publicly available</a></li>
<li><a href="../442286/index.html">Russian ophthalmologists told about bionic vision. New mobile application demonstrates cybernet work</a></li>
<li><a href="../442290/index.html">Making ST-Link V2.1 from Chinese ST-Link V2</a></li>
<li><a href="../442292/index.html">Internship Sberseasons: Python, UX / UI, Data and more for students</a></li>
<li><a href="../442294/index.html">What is slightly wrong Oleg Artamonov</a></li>
<li><a href="../442300/index.html">I look and listen where I want. We integrate Chromecast into Android application</a></li>
<li><a href="../442302/index.html">The first launch of the spacecraft Dragon v2</a></li>
<li><a href="../442304/index.html">Folding smartphones: what about applications?</a></li>
<li><a href="../442310/index.html">Sonoff Basic firmware via Raspberry Pi</a></li>
<li><a href="../442316/index.html">Compact C ++ library for programming finite-difference methods in operator style. Part 1. Semantics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>