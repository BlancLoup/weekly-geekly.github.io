<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Document Access System for MODX</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Have a nice day, everyone. 

 I am writing at the moment for modx using individual documents for each regular user. 
 Since the admin panel did not wa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Document Access System for MODX</h1><div class="post__text post__text-html js-mediator-article">  Have a nice day, everyone. <br><br>  I am writing at the moment for modx using individual documents for each regular user. <br>  Since the admin panel did not want to score with these documents (if everything is fine with the site, there will be a lot of them there and the admin panel will start to slow down), I decided to put them into a separate database table, with output via one resource. <br><br>  So, consider our requirements for the document (at least, I had these): <br><ol><li>  The document should have a title and content; </li><li>  The document must have a type (for easier search of documents of the same type); </li><li>  The document owner always has access to edit and view it; </li><li>  The site owner and his lawyers have random access to any of the documents; </li><li>  The site owner and those to whom he has allowed it should be able to give the right users the right to view and edit an arbitrary document; </li><li>  An arbitrary registered user can get the right to only view or also edit an arbitrary document for a time or immediately forever. </li></ol><br><a name="habracut"></a><br><h4>  <b>1. Definition of data structure</b> </h4><br>  First, let's estimate the structure of the document record in the database: <br><div class="spoiler">  <b class="spoiler_title">Structure of a specific document</b> <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// TryLoadDocument </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> /** ,         (   JSON   ): { "type":"agreement", -  , , , : carta, license  .. "title":"", -   "text":".  .  : ______ ", -  , XSS  CLeditor,   .    -     . "owner":29, -   ,   ,      .            (..  "") "edit":[29,555,34,52], -  ,    . !!   Administrator,Jurists     ! "view":[5677,599677,5999898677,855677] - ,    http://.../docs?doc_id=5   (   ) "view-temp":[{"id":5,"until":1413640050},{"id":9,"until":1413640100},{"id":7,"until":1413640050}] -  view,  "until"( timestamp) ,         (    ) "edit-temp":[{"id":5,"until":1413640050},{"id":9,"until":1413640100},{"id":7,"until":1413640050}] -  edit,  "until"( timestamp) ,         (    ) }       : CREATE TABLE IF NOT EXISTS `documents` ( `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT 'id ', `type` varchar(255) NOT NULL COMMENT ' ', `title` varchar(255) NOT NULL COMMENT ' ', `text` text NOT NULL COMMENT ' ', `owner` bigint(20) NOT NULL COMMENT ' ', `edit` text NOT NULL COMMENT ' ,        ', `edit-temp` text NOT NULL COMMENT '   ', `view` text NOT NULL COMMENT ' ,      ', `view-temp` text NOT NULL COMMENT '   ', UNIQUE KEY `id` (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=cp1251 COMMENT='   - ...'; */</span></span></code> </pre> <br></div></div><br><h4>  <b>2. TryLoadDocument snippet</b> </h4><br><h5>  <b>2.1 Ensuring portability</b> </h5><br>  After determining the structure, it became clear that doing this set of functions would be a controversial decision, so the option with the PLO was chosen. <br>  Well, at the same stage, we recall that objects are conveniently reused in other modules (snippets, in this case), so we use saving this snippet in a static docs.php file (which also makes it possible in the future to quickly connect the Ajax, if necessary ), and also add a check whether this snippet is connected to another just for the sake of our class in this way: <br><div class="spoiler">  <b class="spoiler_title">Check whether the snippet is used as the source of the Document class.</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Document</span></span></span><span class="hljs-class"> </span></span>{...} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(DOC_API_MODE!=<span class="hljs-string"><span class="hljs-string">"API"</span></span>)<span class="hljs-comment"><span class="hljs-comment">//    Document,     ) { ...//    }</span></span></code> </pre><br></div></div><br>  Now to connect the Document class, write in another snippet: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="php hljs">define(<span class="hljs-string"><span class="hljs-string">"DOC_API_MODE"</span></span>,<span class="hljs-string"><span class="hljs-string">"API"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">include_once</span></span> <span class="hljs-string"><span class="hljs-string">'docs.php'</span></span>;</code> </pre><br><br><h5>  <b>2.2 We write the general logic of the class</b> </h5><br>  Now that all the preparations have been made, let's start working with the Document class itself. <br>  First, we define the data in our document: <br><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $data;<span class="hljs-comment"><span class="hljs-comment">//       ( $data['title'] -  ) private $uid;//=user id ‚Äî id ,     ( ) private $modx;//   modx API</span></span></code> </pre><br>  In the constructor, we will only find out <u>who</u> loads us, and not what document he needs, which will allow, for example, using the same class object to create multiple documents to the user at once. <br><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($modx)</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-comment"><span class="hljs-comment">//..    $modx   (    ),    $this-&gt;modx=$modx; $this-&gt;uid=$this-&gt;modx-&gt;user-&gt;get('id');//         }</span></span></code> </pre><br>  Next, let's estimate what we want the object of this class to give us?  In other words, public methods. <br>  Obviously, this: <br><br><ul><li>  Title and content of the document; </li><li>  Can the current user see the document? </li><li>  Will the current user be able to edit the document? </li><li>  Does he have the right to grant rights to others? </li></ul><br>  Also add here what we want this class to do: <br><ul><li>  Download the document by its number (id) - will be further in the text, because working directly with the database; </li><li>  Save the document in its current form - it will be further in the text, because working directly with the database; </li><li>  Create a new document, set the title, text, and the ability to edit it. </li></ul><br>  Here is the implementation of these functions: <br><div class="spoiler">  <b class="spoiler_title">Public methods</b> <div class="spoiler_text">  The simplest access to the fields outside the class: <br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> &amp;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__set</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $name , $value )</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-comment"><span class="hljs-comment">//(  )    title  text $allowed=["title","text"]; if(in_array($name,$allowed)) { if($this-&gt;editAllowed())//     $this-&gt;data[$name]=$value; } } public function &amp;__get ( $name ) {//          edit &amp; view,   ... if($this-&gt;isOwner() || $this-&gt;viewAllowed() || $this-&gt;editAllowed()) { switch ($name) { case "title":return $this-&gt;data['title']; case "text": return $this-&gt;data['text']; case "id": return $this-&gt;data['id']; case "uid": return $this-&gt;uid; } } return 'forbidden'; }</span></span></code> </pre><br>  Now check permissions + create a new document from the specified data: <br><div class="spoiler">  <b class="spoiler_title">There is no work directly with the database yet.</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MakeNew</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($type,$title,$text)</span></span></span><span class="hljs-function">//    ,    </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;data[<span class="hljs-string"><span class="hljs-string">'text'</span></span>]=$text;<span class="hljs-comment"><span class="hljs-comment">//  $this-&gt;data['title']=$title;// $this-&gt;data['view']=[];//    $this-&gt;data['view-temp']=[]; $this-&gt;data['edit']=[];//    $this-&gt;data['edit-temp']=[]; $this-&gt;load($this-&gt;saveAsNew($type));//        } public function viewAllowed() {// ,       ,  - .. $allowed= $this-&gt;isOwner()//  -   || in_array($this-&gt;uid,$this-&gt;data['view']);//      if($allowed) return true; else for($i=0; $i&lt;count($this-&gt;data['view-temp']);$i++) if($this-&gt;data['view-temp'][$i]-&gt;id==$this-&gt;uid) return $this-&gt;data['view-temp'][$i]-&gt;until &gt; time(); return false; } public function editAllowed() {// ,       ,  - .. $allowed = $this-&gt;isOwner() || //  -   in_array($this-&gt;uid,$this-&gt;data['edit']);//     if($allowed) return true; else for($i=0; $i&lt;count($this-&gt;data['edit-temp']);$i++) if($this-&gt;data['edit-temp'][$i]-&gt;id==$this-&gt;uid) return $this-&gt;data['edit-temp'][$i]-&gt;until &gt; time(); //     '-&gt;' -    json_decode return false; } public function manageAllowed() {//true         . false   . return $this-&gt;modx-&gt;user-&gt;isMember('Jurists')||$this-&gt;modx-&gt;user-&gt;isMember('Administrator'); } public function allow($new_user,$can_edit,$time=0) { // -   . $new_user -  , //$can_edit -   (     ,   ) //$time -     (  0 - .    $user_id=(int)$new_user; if($user_id!=0 &amp;&amp; $this-&gt;manageAllowed()) if($can_edit) { if($this-&gt;editAllowed()) { if($time==0)//   $this-&gt;data['edit'][]=$user_id; else//   $time  $this-&gt;data['edit-temp'][]=["id"=&gt;$user_id,"until"=&gt;time()+$time]; } } else { if($time==0)//   $this-&gt;data['view'][]=$user_id; else//   $time  $this-&gt;data['view-temp'][]=["id"=&gt;$user_id,"until"=&gt;time()+$time]; } } public function isOwner() { $usual=$this-&gt;uid==$this-&gt;data['owner'];//   : if($usual) return true;// , else//  return $this-&gt;manageAllowed(); }</span></span></code> </pre><br>  An auxiliary function that clears a document of obsolete temporary permissions: <br><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearTemp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-comment"><span class="hljs-comment">//    e       if(count($this-&gt;data['view-temp'])+count($this-&gt;data['edit-temp']) &gt; 0)//  -    { for($i=0; $i&lt;count($this-&gt;data['view-temp']);$i++) //   ,       (time()) { if($this-&gt;data['view-temp'][$i]-&gt;until &lt; time()) unset($this-&gt;data['view-temp'][$i]); } $this-&gt;data['view-temp']=array_values($this-&gt;data['view-temp']);//    ( [1,3,5]=&gt;[0,1,2)] for($i=0; $i&lt;count($this-&gt;data['edit-temp']);$i++) //   ,       (time()) { if($this-&gt;data['edit-temp'][$i]-&gt;until &lt; time()) unset($this-&gt;data['edit-temp'][$i]); } $this-&gt;data['edit-temp'] = array_values($this-&gt;data['edit-temp']);//    ( [1,3,5]=&gt;[0,1,2)] $this-&gt;save();//  } }</span></span></code> </pre><br></div></div><br></div></div><br><h5>  <b>2.3 We write functions for working with a specific database.</b> </h5><br>  So, the logical part of our code, independent of a specific database, is complete.  Now let's move to the level below, working directly with the database in MODX using PDO. <br><div class="spoiler">  <b class="spoiler_title">Work directly with the database</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id)</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-comment"><span class="hljs-comment">//   (     ,          ) $sql="SELECT * FROM `documents` WHERE `id`=:id"; $query = new xPDOCriteria($this-&gt;modx, $sql,array(':id'=&gt;$id)); if($query-&gt;prepare() &amp;&amp; $query-&gt;stmt-&gt;execute()) {//    $this-&gt;data = $query-&gt;stmt-&gt;fetchAll(PDO::FETCH_ASSOC)[0]; if(count($this-&gt;data)==0) return false;//   ,     $this-&gt;data['edit']=json_decode($this-&gt;data['edit']);///        $this-&gt;data['edit-temp']=json_decode($this-&gt;data['edit-temp']);///         $this-&gt;data['view']=json_decode($this-&gt;data['view']);///        $this-&gt;data['view-temp']=json_decode($this-&gt;data['view-temp']);///         $this-&gt;clearTemp();//  view-temp &amp; edit-temp    return true;//  , ,    } else return false;//   ,     } public function save() {//      $sql="UPDATE `documents` SET `title`=:title, `text`=:text, `view`=:view, `edit`=:edit, `view-temp`=:viewtemp, `edit-temp`=:edittemp WHERE `id`=:id";//  $this-&gt;data['view']=json_encode($this-&gt;data['view']);///        $this-&gt;data['view-temp']=json_encode($this-&gt;data['view-temp']);///         $this-&gt;data['edit']=json_encode($this-&gt;data['edit']);///        $this-&gt;data['edit-temp']=json_encode($this-&gt;data['edit-temp']);///         $query=new xPDOCriteria($this-&gt;modx, $sql, [":title"=&gt;$this-&gt;data['title'],":text"=&gt;$this-&gt;data['text'],":edit"=&gt;$this-&gt;data['edit'],":view"=&gt;$this-&gt;data['view'],":edittemp"=&gt;$this-&gt;data['edit-temp'],":viewtemp"=&gt;$this-&gt;data['view-temp'],":id"=&gt;$this-&gt;data["id"]]);//  $query-&gt;prepare() &amp;&amp; $query-&gt;stmt-&gt;execute();//  //     $this-&gt;data['view']=json_decode($this-&gt;data['view']); $this-&gt;data['view-temp']=json_decode($this-&gt;data['view-temp']); $this-&gt;data['edit']=json_decode($this-&gt;data['edit']); $this-&gt;data['edit-temp']=json_decode($this-&gt;data['edit-temp']); } private function saveAsNew($type) {//        $type $sql="INSERT INTO `documents` (`title`,`text`,`view`,`edit`,`owner`,`type`) VALUES(:title,:text,:view,:edit,:uid,:type)";//  $this-&gt;data['view']=json_encode($this-&gt;data['view']);///        $this-&gt;data['edit']=json_encode($this-&gt;data['edit']);///        $this-&gt;data['view-temp']=json_encode($this-&gt;data['view-temp']);///        $this-&gt;data['edit-temp']=json_encode($this-&gt;data['edit-temp']);///        $query=new xPDOCriteria($this-&gt;modx, $sql, [":title"=&gt;$this-&gt;data['title'],":text"=&gt;$this-&gt;data['text'],":edit"=&gt;$this-&gt;data['edit'],":view"=&gt;$this-&gt;data['view'],":uid"=&gt;$this-&gt;uid,":type"=&gt;$type]);//  //   ,           //$this-&gt;modx-&gt;log(modX::LOG_LEVEL_ERROR," : ".$query-&gt;toSQL()); $query-&gt;prepare(); $query-&gt;stmt-&gt;execute();//  return $this-&gt;modx-&gt;lastInsertId();// id   }</span></span></code> </pre><br></div></div><br>  <b>That's the whole Document class.</b>  Pretty simple, IMHO. <br><br><h5>  <b>2.4 Executable Snippet Code</b> </h5><br>  <b>Now let's see <i>what</i> our TryLoadDocument snippet does?</b> <br><br>  So‚Ä¶ <br><div class="spoiler">  <b class="spoiler_title">TryLoadDoc snippet executable code - parsing</b> <div class="spoiler_text"><div class="spoiler">  <b class="spoiler_title">We check if the anonymous user has come to us (his id is 0), in this case we send him to login.</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($modx-&gt;user-&gt;get(<span class="hljs-string"><span class="hljs-string">'id'</span></span>)==<span class="hljs-number"><span class="hljs-number">0</span></span>)<span class="hljs-comment"><span class="hljs-comment">//    , { $modx-&gt;sendRedirect($modx-&gt;makeUrl(14));//     14,       . exit;//      ,   (     ) }</span></span></code> </pre></div></div><br><br><div class="spoiler">  <b class="spoiler_title">We are trying to load the requested document (the resource where this snippet is used is / docs? Doc_id = N).</b> <div class="spoiler_text"><pre> <code class="php hljs">$doc=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Document($modx);<span class="hljs-comment"><span class="hljs-comment">//           if(!$doc-&gt;load($_GET['doc_id']))//     {//  , ... return '  ...'; }</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">We fill placeholders with values ‚Äã‚Äãthat will allow us not to display further the forms for editing a document and editing the rights for it to those who cannot do it.</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//!!!   Rights,      $modx-&gt;setPlaceholder('CanManage',$doc-&gt;manageAllowed()?'true':'false'); //!!!   DocText,     $modx-&gt;setPlaceholder('CanEdit',$doc-&gt;editAllowed()?'true':'false');</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Next is a simple function that parses what you entered as a user in the field of the rights editing form.</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DataToUID</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($userstr,$modx)</span></span></span><span class="hljs-function">//        "" </span></span>{ $link_rgx=<span class="hljs-string"><span class="hljs-string">"/(.*uid=)([\d]{1,})(.*)/"</span></span>;<span class="hljs-comment"><span class="hljs-comment">//    http://*   *?uid=56 $id_rgx="/([^\w]{0,})([\d]{1,})/";// id (      ) if(preg_match($link_rgx,$userstr)) {//   http://*   *?uid=56 $r="$2"; return preg_replace($link_rgx,$r,$userstr); } else if(preg_match($id_rgx,$userstr))//   " 234",  { $r="$2"; return preg_replace($id_rgx,$r,$userstr);//   } else//          ?    ? { $usr=$modx-&gt;getObject('modUser',["username"=&gt;$userstr]);//      return $usr?$usr-&gt;get('id'):'-1'; } }</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">We process adding rights, if there is one.</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_POST[<span class="hljs-string"><span class="hljs-string">'add'</span></span>]))<span class="hljs-comment"><span class="hljs-comment">//    "  ... { $userID=(int)DataToUID($_POST['userid'],$modx);// id     'userid' if($userID!='-1')//   { if($_POST['allow']=="edit")//       (   'allow') { //   $modx-&gt;log(modX::LOG_LEVEL_ERROR,"      #".$doc-&gt;id."  #".$doc-&gt;uid."  #".$userID); $doc-&gt;allow($userID,true,(int)$_POST['length']); $doc-&gt;save(); } else if($_POST['allow']=="view")////     (   'allow') { //   $modx-&gt;log(modX::LOG_LEVEL_ERROR,"      #".$doc-&gt;id."  #".$doc-&gt;uid."  #".$userID); $doc-&gt;allow($userID,false,(int)$_POST['length']); $doc-&gt;save(); } }else $modx-&gt;log(modX::LOG_LEVEL_ERROR,"DataToUID  . (".$_POST['userid'].")");//     ,    }</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Processing the document editing, if any</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_POST[<span class="hljs-string"><span class="hljs-string">'edit'</span></span>]))<span class="hljs-comment"><span class="hljs-comment">//      "" { $modx-&gt;log(modX::LOG_LEVEL_ERROR,"    #".$doc-&gt;id."  #".$doc-&gt;uid);//   if(!empty($_POST["text"]))//     (    ) { $doc-&gt;text=$_POST["text"];//   text   $doc-&gt;save(); $modx-&gt;log(modX::LOG_LEVEL_ERROR,"   #".$doc-&gt;id."  #".$doc-&gt;uid);//   } }</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">We return to the placeholder [[+ doc]] the content of the resource, consisting of the document and the forms for editing it, which the user has access to.</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/**********   *************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_POST[<span class="hljs-string"><span class="hljs-string">'ajax'</span></span>]))<span class="hljs-comment"><span class="hljs-comment">//     ,    . { $output=""; // ,  ,     //   DocTitle   title,    .     -   . $output.=$modx-&gt;getChunk('DocTitle',['title'=&gt;$doc-&gt;title]); //   DocText   title,    .     -   . $output.=$modx-&gt;getChunk('DocText',['text'=&gt;$doc-&gt;text]); $modx-&gt;setPlaceholder('doc', $output); return ''; }</span></span></code> </pre> <br></div></div><br></div></div><br>  For a better understanding, it may be more convenient for someone to look at the code in one block: <br><div class="spoiler">  <b class="spoiler_title">The entire snippet executable code of the TryLoadDocument</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($modx-&gt;user-&gt;get(<span class="hljs-string"><span class="hljs-string">'id'</span></span>)==<span class="hljs-number"><span class="hljs-number">0</span></span>)<span class="hljs-comment"><span class="hljs-comment">//    , { $modx-&gt;sendRedirect($modx-&gt;makeUrl(14));//     14,       . exit;//      ,   (     ) } /*******/ $doc=new Document($modx);//           if(!$doc-&gt;load($_GET['doc_id']))//     {//  , ... return '  ...'; } //!!!   Rights,      $modx-&gt;setPlaceholder('CanManage',$doc-&gt;manageAllowed()?'true':'false'); //!!!   DocText,     $modx-&gt;setPlaceholder('CanEdit',$doc-&gt;editAllowed()?'true':'false'); function DataToUID($userstr,$modx)//        "" { $link_rgx="/(.*uid=)([\d]{1,})(.*)/";//    http://*   *?uid=56 $id_rgx="/([^\w]{0,})([\d]{1,})/";// id (      ) if(preg_match($link_rgx,$userstr)) {//   http://*   *?uid=56 $r="$2"; return preg_replace($link_rgx,$r,$userstr); } else if(preg_match($id_rgx,$userstr))//   " 234",  { $r="$2"; return preg_replace($id_rgx,$r,$userstr);//   } else//          ?    ? { $usr=$modx-&gt;getObject('modUser',["username"=&gt;$userstr]);//      return $usr?$usr-&gt;get('id'):'-1'; } } /*********      ***********/ if(isset($_POST['add']))//    "  ... { $userID=(int)DataToUID($_POST['userid'],$modx);// id     'userid' if($userID!='-1')//   { if($_POST['allow']=="edit")//       (   'allow') { //   $modx-&gt;log(modX::LOG_LEVEL_ERROR,"      #".$doc-&gt;id."  #".$doc-&gt;uid."  #".$userID); $doc-&gt;allow($userID,true,(int)$_POST['length']); $doc-&gt;save(); } else if($_POST['allow']=="view")////     (   'allow') { //   $modx-&gt;log(modX::LOG_LEVEL_ERROR,"      #".$doc-&gt;id."  #".$doc-&gt;uid."  #".$userID); $doc-&gt;allow($userID,false,(int)$_POST['length']); $doc-&gt;save(); } }else $modx-&gt;log(modX::LOG_LEVEL_ERROR,"DataToUID  . (".$_POST['userid'].")");//     ,    } if(isset($_POST['edit']))//      "" { $modx-&gt;log(modX::LOG_LEVEL_ERROR,"    #".$doc-&gt;id."  #".$doc-&gt;uid);//   if(!empty($_POST["text"]))//     (    ) { $doc-&gt;text=$_POST["text"];//   text   $doc-&gt;save(); $modx-&gt;log(modX::LOG_LEVEL_ERROR,"   #".$doc-&gt;id."  #".$doc-&gt;uid);//   } } /**********   *************/ if(!isset($_POST['ajax']))//     ,    . { $output=""; // ,  ,     //   DocTitle   title,    .     -   . $output.=$modx-&gt;getChunk('DocTitle',['title'=&gt;$doc-&gt;title]); //   DocText   title,    .     -   . $output.=$modx-&gt;getChunk('DocText',['text'=&gt;$doc-&gt;text]); $modx-&gt;setPlaceholder('doc', $output); return ''; } return '...';//        ,     -   </span></span></code> </pre><br></div></div><br><h4>  <b>3. Formatting of the received data and output to the page.</b> </h4><br><h5>  <b>3.1 Required chunks</b> </h5><br>  Three simple chunks are used to output the document correctly: <br><div class="spoiler">  <b class="spoiler_title">Rights - a form for editing rights</b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"[[~[[*id]]]]?doc_id=[[!GET? &amp;param=`doc_id`]]"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fieldset</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span>  ...<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"userid"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" background: white; width: 340px; padding: 5px; font-size: 14px; margin: 0 15px; "</span></span></span><span class="hljs-tag">/&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">select</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"allow"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"view"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">selected</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"selected"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"edit"</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">select</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">select</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"length"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"60"</span></span></span><span class="hljs-tag">&gt;</span></span> 1 .<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"600"</span></span></span><span class="hljs-tag">&gt;</span></span> 10 .<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"3600"</span></span></span><span class="hljs-tag">&gt;</span></span> .<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"86400"</span></span></span><span class="hljs-tag">&gt;</span></span> .<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag">&gt;</span></span>.<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">select</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"add"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fieldset</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" !"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">DocTitle - the template for the display title of the document.</b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span>[[!+title]]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">DoctText * - document text template</b> <div class="spoiler_text"><pre> <code class="html hljs xml">[[!If? &amp;subject=`[[!+CanEdit]]` &amp;operator=`EQ` &amp;operand=`true` &amp;then=`<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"[[~[[*id]]]]?doc_id=[[!GET? &amp;param=`doc_id`]]"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"   ..."</span></span></span><span class="hljs-tag">/&gt;</span></span>`]] <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> &gt;</span></span> [[+text]] <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> CKEDITOR.replace( </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'text'</span></span></span><span class="actionscript"> ); CKEDITOR.config.height=</span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">800</span></span></span><span class="actionscript">; </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--    CKeditor--&gt;</span></span> [[!If? &amp;subject=`[[!+CanEdit]]` &amp;operator=`EQ` &amp;operand=`true` &amp;then=`<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"edit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"   ..."</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span>`]]</code> </pre><br></div></div><br>  <b>*</b> - if for some reason the form is never displayed, you should check if the <b>If</b> component is installed? <br>  And the simplest snippet to get a parameter from the address bar: <br><div class="spoiler">  <b class="spoiler_title">Get</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($param)?$_GET[$param.<span class="hljs-string"><span class="hljs-string">""</span></span>]:<span class="hljs-string"><span class="hljs-string">'0'</span></span>;</code> </pre><br></div></div><br>  The final code of the TryLoadDocument snippet can be found here: <a href="http://pastebin.com/R55bPUCH">pastebin.com/R55bPUCH</a> <br>  Well, almost everything is ready, it remains only to attach this to your content resource with your template. <br><br><h5>  <b>3.2 Resource to work with the document</b> </h5><br>  The code in the content field for the resource itself will be: <br><br><pre> <code class="html hljs xml">[[!TryLoadDocument]] [[!If? &amp;subject=`[[!+CanManage]]` &amp;operator=`EQ` &amp;operand=`true` &amp;then=`[[$Rights]]`]] [[!+doc]] [[!If? &amp;subject=`[[!+CanManage]]` &amp;operator=`EQ` &amp;operand=`true` &amp;then=`[[$Rights]]`]]</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The textarea with the text of our document (from the DocText chunk) should be wrapped in a WYSIWYG editor, for example, I used CKeditor. </font></font><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CKeditor put so</font></font></b> <div class="spoiler_text">       &lt;head&gt;* <br><pre> <code class="html hljs xml"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"//cdn.ckeditor.com/4.4.5/full/ckeditor.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br> * ‚Äî     TV <i>ExtraHeaders</i> ,    &lt;head&gt;  ,  ,      ,    TV.       DocText  textarea,  <b>   (    ).</b> <br></div></div><br><h4> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. An example of using the Document class in another snippet</font></font></b> </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Suppose you want to create your documents in a different snippet for the current user: </font></font><br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> ... define(<span class="hljs-string"><span class="hljs-string">"DOC_API_MODE"</span></span>,<span class="hljs-string"><span class="hljs-string">"API"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">include_once</span></span> <span class="hljs-string"><span class="hljs-string">'docs.php'</span></span>; ... $doc= <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Document($modx); $title=<span class="hljs-string"><span class="hljs-string">""</span></span>; $text=$modx-&gt;getChunk(<span class="hljs-string"><span class="hljs-string">'agreement_template'</span></span>);<span class="hljs-comment"><span class="hljs-comment">//         //        -  $doc-&gt;MakeNew('agreement',$title,$text);//,    ...</span></span></code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this article, I tried to show how an idea goes into logic, then into code, and eventually into a working mechanism. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I hope someone will be useful. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I apologize in advance for errors in the text of the article (even though I tried to catch everything). </font><font style="vertical-align: inherit;">I have no experience writing large texts. </font><font style="vertical-align: inherit;">I would welcome any comments.</font></font></div><p>Source: <a href="https://habr.com/ru/post/241357/">https://habr.com/ru/post/241357/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../241345/index.html">Pangu released iOS 8.1 jailbreak without Cydia</a></li>
<li><a href="../241347/index.html">Introduction to the home automation system HDL</a></li>
<li><a href="../241349/index.html">HDConf conference: photo-video-slide report</a></li>
<li><a href="../241353/index.html">Application Vulnerability Control</a></li>
<li><a href="../241355/index.html">Digital Media or Digital Signage - how to?</a></li>
<li><a href="../241359/index.html">Solving time problems in ExtJS 3 (after patch KB2998527)</a></li>
<li><a href="../241361/index.html">On Yandex.Maps you can now create heat maps</a></li>
<li><a href="../241363/index.html">IBM announces new Watson technology deployment projects and the opening of the Watson Group headquarters in New York</a></li>
<li><a href="../241365/index.html">Report: solar powered base station</a></li>
<li><a href="../241367/index.html">Monitoring of transport: CIS vs West. Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>