<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Qook: Port an old toy to Android and share it with the world.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In fact, I really like logical toys. No, ‚Äúthree in a row‚Äù, ‚Äúfind a similar one‚Äù and other ‚Äúfeed the dog‚Äù do not interest me much. But the really compl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Qook: Port an old toy to Android and share it with the world.</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/f15/b86/8a7/f15b868a773240d2aa64abe20da9d39c.png" alt="KDPV" height="250" width="512"><br><br>  In fact, I really like logical toys.  No, ‚Äúthree in a row‚Äù, ‚Äúfind a similar one‚Äù and other ‚Äúfeed the dog‚Äù do not interest me much.  But the really complicated thing can calmly pull for a couple of weeks.  Something like this happened to me in 2004, when a new Sony mobile phone came into my hands.  The ability of this T68I to call perfectly, show color pictures and, according to rumors, even sent their contacts via BT passed me unnoticed.  Q is not.  And how many hours I spent behind a small display, convulsively chasing balls to and fro I already don‚Äôt remember.  But, I remember well that the idea to write a port of this game for some of the modern platforms has not let me go since its very first Hello World.  True, all my attempts to rivet at least some kind of game engine in those good old days broke about ... in general, about something they broke.  But now I have been writing in Java for a long time and firmly, and from some (very recently) for Android, so that the idea of ‚Äã‚Äãa toy port has finally found an opportunity to be realized.  Want to see what it is and how it turned out?  Then - under the cat. <br><a name="habracut"></a><br><h4>  What's the point of the game? </h4><br>  <b>Q</b> is a very difficult logic game, the point of which is to roll all the colored balls on the playing field into the holes of the same color.  Almost like in billiards, yeah.  And just like in billiards, the balls move only in a straight line and only until the first obstacle, which can be either a fixed brick or another ball.  At the same time, all levels are built in such a way as to exclude the simplest solutions - this is the beauty. <br><br>  Still do not understand?  Well, here's a picture of the first level.  Come up, by the way, at your leisure how to pass this very level. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/8fa/5e1/2b1/8fa5e12b146f4e79a96ba35a0cdea6b9.jpg"><br><br>  That's better?  Then let's understand how to write it <br><br><h4>  What do we write on? </h4><br>  The first desire that occurred to me was to use some kind of physics engine.  Well, Unity, for example.  However, after I looked at <i>how much</i> such toys weigh and <i>how many</i> batteries they eat - the idea to use the whole engine only to roll the balls beautifully across the field died immediately.  But there was an idea to write my own little engine specifically for this game, especially since this part of me did not work in childhood.  So we will reinvent our bicycle: with balls and low power consumption.  By the way, we will invent it in Java, since Android.  Go? <br><br><h4>  Select the game elements </h4><br>  This is the first thing to do when writing code for anything.  Let's see what we have ... so let's look at the picture again ... <br><br>  Aha  On the field we have ... items!  Is it logical <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Item</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Color color; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Item</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Color color)</span></span></span><span class="hljs-function"> </span></span>{ setColor(color); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Color </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getColor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> color; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setColor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Color color)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.color = color; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Item{"</span></span> + <span class="hljs-string"><span class="hljs-string">"color="</span></span> + color + <span class="hljs-string"><span class="hljs-string">'}'</span></span>; } }</code> </pre> <br>  What, where are the coordinates?  And how does the ball know where it is located there?  Not his business. <br><br>  Now let's go down deeper and see exactly what elements we have here. <br><br>  <b>Block</b>  Everything is simple with him: he is square, gray and does not move anywhere.  Neither give nor take - the economy of some not very developed country.  True, we must not forget that the block is an element. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Block</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Item</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Block</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(Color.GRAY); } }</code> </pre><br>  <b>Ball</b> .  The ball is a little more difficult: it is round, multi-colored and always rolls somewhere.  And also an element. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Ball</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Item</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Ball</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Color color)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(color); } }</code> </pre><br>  <b>Hole</b> .  Well, or pocket - as you like.  We have something in between a ball and a block: seemingly square and motionless, but also multi-colored. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Hole</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Item</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hole</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Color color)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(color); } }</code> </pre><br>  So, we already dealt with basic elements.  Now, think about where they all lie. <br><br><h4>  Write level </h4><br>  We will deal with the levels themselves a little later, but for now we need a class that will be responsible for the location of the elements inside the field, since we decided that they themselves know nothing about themselves but the color and the name. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Level</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Item[][] field; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ballsCount; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Level</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Item[][] field)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.field = field; } }</code> </pre><br>  Well, the beginning is good.  We have some level that stores in itself some two-dimensional array of elements.  Since all the balls-blocks-holes we have elements, so it is possible.  We need the second variable in order not to count the number of balls left on the field each time.  However, once this case is to be considered honest, <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">countBallsOnLevel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Item[][] field)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ballsCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Item[] aField : field) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; field[<span class="hljs-number"><span class="hljs-number">0</span></span>].length; j++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (aField[j] != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; aField[j].getClass().equals(Ball.class)) { ballsCount++; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ballsCount; }</code> </pre><br>  Quadratic complexity, yeah.  That is why I do not want to recalculate this value after the next move.  Well, add one line to the constructor <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ballsCount = countBallsOnLevel(field);</code> </pre><br>  So, our level is ready.  Now, according to the plan, the most interesting <br><br><h4>  We write the engine </h4><br>  Let the whole game mechanics we have engaged in a separate special class.  Well, for example, Field, which will store the modified configuration of the level, as well as the number of balls remaining on the field <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Level level; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ballsCount; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Field</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Level level)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.level = level; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ballsCount = level.getBallsCount(); }</code> </pre><br>  Fine.  Now let's briefly digress from the engine and write a small enum <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Direction { LEFT, RIGHT, UP, DOWN, NOWHERE }</code> </pre><br>  Yeah, the direction of movement of the ball.  Now let's digress once again and write a very small classic who will keep the coordinates of the desired element on the field.  What for?  And then write less <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Coordinates</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> horizontal; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> vertical; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Coordinates</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> horizontal, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> vertical)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.horizontal = horizontal; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.vertical = vertical; } }</code> </pre><br>  Hooray, finally you can go back to the engine and continue our overwork. <br><br>  The first thing I want to do is to teach our field to move the balls. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Coordinates </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moveRight</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> xCoord, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> yCoord)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (level.getField()[yCoord][xCoord + <span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { level.getField()[yCoord][xCoord + <span class="hljs-number"><span class="hljs-number">1</span></span>] = level.getField()[yCoord][xCoord]; level.getField()[yCoord][xCoord++] = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ArrayIndexOutOfBoundsException ex) { } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Coordinates(xCoord, yCoord); }</code> </pre><br>  This method, for example, will roll the ball until a decent obstacle is encountered.  Well, or until the field is over.  By the way, this is probably the only time when the suppression of exceptions is at all somehow justified. <br><br>  No more difficult than this - other methods are written to move the ball to the left, up and down.  It is only necessary to learn how to call these methods somewhere higher. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Coordinates </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">moveItem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Coordinates coordinates, Direction direction)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> horizontal = coordinates.getHorizontal(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> vertical = coordinates.getVertical(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction.equals(Direction.NOWHERE) || level.getField()[vertical][horizontal] == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } Class clazz = level.getField()[vertical][horizontal].getClass(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!clazz.equals(Ball.class)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (direction) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RIGHT: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> moveRight(horizontal, vertical); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> LEFT: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> moveLeft(horizontal, vertical); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> UP: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> moveUp(horizontal, vertical); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> DOWN: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> moveDown(horizontal, vertical); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre><br>  Well, here our coordinates are useful.  I told you that less writing. <br><br>  So, more or less learned to ride.  Now we will learn to roll.  All the same, only the method we will have and return the result of the operation - it turned out to eat the ball or not <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">acceptRight</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Coordinates coordinates)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> horizontal = coordinates.getHorizontal(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> vertical = coordinates.getVertical(); Item upItem = level.getField()[vertical][horizontal + <span class="hljs-number"><span class="hljs-number">1</span></span>]; Item item = level.getField()[vertical][horizontal]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (upItem == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || !upItem.getClass().equals(Hole.class) || !(upItem.getColor().equals(item.getColor()))) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } level.getField()[vertical][horizontal] = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ArrayIndexOutOfBoundsException ex) { } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre><br>  And exactly the same wrapper level above <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">acceptHole</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Coordinates coordinates, Direction direction)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> isAccepted = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (direction) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> UP: isAccepted = acceptUp(coordinates); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> DOWN: isAccepted = acceptDown(coordinates); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RIGHT: isAccepted = acceptRight(coordinates); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> LEFT: isAccepted = acceptLeft(coordinates); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isAccepted) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } catchBall(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> checkWin(); }</code> </pre><br>  After the ball turned out to eat, you need to count the number of remaining ones.  No, there is no O (N). <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">catchBall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ballsCount--; }</code> </pre><br>  Why?  Because in one move we can move only one ball, which means that we will not be able to roll more.  Check that the level is over is made no more difficult. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkWin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ballsCount == <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br>  Well, now we can roll and roll the balls across the field.  It remains to learn how to walk <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeTurn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Coordinates coordinates, Direction direction)</span></span></span><span class="hljs-function"> </span></span>{ Coordinates newCoordinates = moveItem(coordinates, direction); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> newCoordinates != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; acceptHole(newCoordinates, direction); }</code> </pre><br>  Nothing new: they took the coordinates with the direction, if it happened, moved the ball to a new place and drove it into the hole if it was found there.  If found, they returned true. <br><br>  Well, that's the whole engine.  And was it because of this to cling to some kind of unity here? <br><br>  Now we just need to teach the phone to show the whole thing on the screen. <br><br><h4>  We write our view </h4><br>  The main interface element of the Android application is View.  View, that is.  This is a button, and an input box and ... our playing field.  True, it is strange to hope that someone has already written it for us.  So you have to do it yourself.  To do this, we will create a whole class and inherit it from the built-in View of the androyd, in order to get access to its life cycle, the ability to place this business on the screen and much more. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FieldView</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> ROUND_RECT_SIZE = <span class="hljs-number"><span class="hljs-number">0.15</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> PADDING_DIVIDER = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> paddingSize = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> elementSize; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Field field; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Size fieldSize; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Size maxViewSize; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FieldView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, AttributeSet attrs)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context, attrs); } }</code> </pre><br><br>  Why do we need constants here, we'll figure it out later, but for now let's think about how big the view should be.  It is clear that it should take up as much space on the screen as possible, but not get out of it.  And it is clear that the size of the elements must be proportional to the size of the view itself.  At the same time, we can‚Äôt set something constant - we don‚Äôt have to write our view for a couple of thousand different phones.  But we can do something with the view when it is placed on the screen.  Since in the XML markup it will have the dimensions math_parent, then we will be able to determine this size of runtime. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Size </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">countFieldSize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (maxViewSize == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { maxViewSize = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Size(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getWidth(), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getHeight()); } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> horizontalElementsNum = field.getField()[<span class="hljs-number"><span class="hljs-number">0</span></span>].length; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> verticalElementsNum = field.getField().length; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxHorizontalElSize = maxViewSize.getWidth() / horizontalElementsNum; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxVerticalElSize = maxViewSize.getHeight() / verticalElementsNum; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.elementSize = (maxHorizontalElSize &lt; maxVerticalElSize) ? maxHorizontalElSize : maxVerticalElSize; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> newWidth = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.elementSize * horizontalElementsNum; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> newHeight = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.elementSize * verticalElementsNum; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Size(newWidth, newHeight); }</code> </pre><br>  The size we have is about the same as the coordinates, only needed to store the size of Ox and Oy.  The algorithm is simple: we looked at whether someone had determined these dimensions before us, got height and width in pixels, estimated how much one element would occupy horizontally and vertically, chose a smaller one, and even recalculated the size of the view itself by multiplying the size of the element by their number by row and column. <br><br>  Oh, and do not forget to cause this thing: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onLayout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> changed, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> left, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> top, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> right, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bottom)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onLayout(changed, left, top, right, bottom); Size countedFieldSize = countFieldSize(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fieldSize == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || !fieldSize.equals(countedFieldSize)) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fieldSize = countedFieldSize; setFieldSize(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fieldSize); paddingSize = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) (Math.sqrt(elementSize) / PADDING_DIVIDER); } }</code> </pre><br>  What does setFieldSize do?  Yes please! <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setFieldSize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Size size)</span></span></span><span class="hljs-function"> </span></span>{ LinearLayout.LayoutParams params = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LinearLayout.LayoutParams(size.getWidth(), size.getHeight()); params.gravity = Gravity.CENTER_HORIZONTAL; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setLayoutParams(params); }</code> </pre><br>  They took a view, and they also attached sizes to it.  What do you want? <br><br>  So, with the size we decided.  Now we need to somehow draw the playing field.  This is not difficult and is done in onDraw.  However, before you draw something you need to find somewhere the game elements themselves. <br><br><h4>  We draw </h4><br>  The first thing that occurred to me was to get a whole bunch of markup files in a drawable and slip them onto the canvas at the coordinates.  Unfortunately, this brilliant idea broke about the impossibility of setting the relative sizes of the elements.  That is, I can make rounded corners of the block and set them in dp.  And they will actually be rounded.  The only problem is that the size of an element changes depending on the number of these elements on the field.  And if we have a field of 6 * 6 (the minimum size in the game), the blocks will be square with slightly rounded corners.  And if the field is 13 * 13 (maximum size), it will be slightly square balls.  Ugly. <br>  However, the idea of ‚Äã‚Äãpainting on canvas with ready-made elements I like more than bothering with some kind of low-level drawing, like drawRect.  Let's make a bunch of items? <br><br>  We will deal with the generation of Drawable in a separate method (although for some reason I wanted to bring it into a separate factory) selectDrawable, which accepts a copy of the element, finds out who he is and drawable for him.  For example, a block will be drawn like this: <br><br><pre> <code class="java hljs">Class clazz = item.getClass(); Color color = item.getColor(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (clazz.equals(Block.class)) { GradientDrawable bgShape = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GradientDrawable(); bgShape.setColor(ContextCompat.getColor(getContext(), R.color.gray)); bgShape.setCornerRadius((<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) (elementSize * ROUND_RECT_SIZE)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bgShape; }</code> </pre><br>  Well, that and constants come in handy.  Now the radius of rounding depends on the size of the element itself.  Just what we wanted. <br><br>  Now let's take a look at how a drawable is built for a ball that is multicolored: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (clazz.equals(Ball.class)) { GradientDrawable bgShape = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GradientDrawable(); bgShape.setColor(ContextCompat.getColor(getContext(), R.color.gray)); bgShape.setCornerRadius(elementSize); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (color) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> GREEN: bgShape.setColor(ContextCompat.getColor(getContext(), R.color.green)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bgShape; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RED: bgShape.setColor(ContextCompat.getColor(getContext(), R.color.red)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bgShape; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> BLUE: bgShape.setColor(ContextCompat.getColor(getContext(), R.color.blue)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bgShape; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> YELLOW: bgShape.setColor(ContextCompat.getColor(getContext(), R.color.yellow)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bgShape; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> PURPLE: bgShape.setColor(ContextCompat.getColor(getContext(), R.color.purple)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bgShape; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CYAN: bgShape.setColor(ContextCompat.getColor(getContext(), R.color.cyan)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bgShape; } }</code> </pre><br>  Yes, not much harder.  First drew a ball, and then poured it with the desired paint.  Why switch here and why you can not just set the color that we got out of the ball? <br>  Because it is a different color.  The color that is stored in the element is a normal enum, which is from Java, and the one that takes drawable as a color is a normal android resource with a normal string value.  For example, here's a red one: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">color</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"red"</span></span></span><span class="hljs-tag">&gt;</span></span>#D81B60<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">color</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Gluing one with the other is a bad idea, because someday it will occur to me that red is not blue enough and it‚Äôs time to play around with fonts and have to rewrite the whole thing instead of just fixing the resource file. <br><br>  Well, for a snack - we build a drawable hole: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (clazz.equals(Hole.class)) { GradientDrawable bgShape = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GradientDrawable(); bgShape.setCornerRadius((<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) (elementSize * ROUND_RECT_SIZE)); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (color) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> GREEN: bgShape.setColor(ContextCompat.getColor(getContext(), R.color.green)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bgShape; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RED: bgShape.setColor(ContextCompat.getColor(getContext(), R.color.red)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bgShape; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> BLUE: bgShape.setColor(ContextCompat.getColor(getContext(), R.color.blue)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bgShape; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> YELLOW: bgShape.setColor(ContextCompat.getColor(getContext(), R.color.yellow)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bgShape; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> PURPLE: bgShape.setColor(ContextCompat.getColor(getContext(), R.color.purple)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bgShape; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CYAN: bgShape.setColor(ContextCompat.getColor(getContext(), R.color.cyan)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bgShape; } }</code> </pre><br>  Again, nothing new: painted a hole, painted it and handed it to the petitioner <br><br>  So, do not forget anything?  Hmm ... Holes, balls, blocks ... And an empty space?  What, for example, will happen if null is encountered in the array? <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { GradientDrawable bgShape = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GradientDrawable(); bgShape.setColor(ContextCompat.getColor(getContext(), android.R.color.transparent)); bgShape.setCornerRadius((<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) (elementSize * ROUND_RECT_SIZE)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bgShape; }</code> </pre><br>  Yes, nothing new will be, because it is exactly the same beautiful rounded square.  Sorry, just invisible. <br><br>  Done, the elements we are able to build.  What are we staying at?  And ... yes!  On drawing them <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDraw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Canvas canvas)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (field == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; field.getField().length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; field.getField()[<span class="hljs-number"><span class="hljs-number">0</span></span>].length; j++) { Drawable d = selectDrawable(field.getField()[i][j]); d.setBounds(j * elementSize + paddingSize, i * elementSize + paddingSize, (j + <span class="hljs-number"><span class="hljs-number">1</span></span>) * elementSize - paddingSize, (i + <span class="hljs-number"><span class="hljs-number">1</span></span>) * elementSize - paddingSize); d.draw(canvas); } } }</code> </pre><br><br>  Here you go.  We walked across the field, for each element we find its graphic representation, set its dimensions and indents from each other and draw it on the canvas.  By the way, it is interesting that here it is drawable that draws on canvas, and not the canvas draws on itself drawable.  In order to do this, I would have to convert the drawable into a bitmap each time, which is a long time. <br><br>  Let's look at what happened?  To do this, we write some test level, where the elements are specified directly in the constructor (remove / remove, do not worry) <br><br><div class="spoiler">  <b class="spoiler_title">But this is better not to write</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Level</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Item[][] field; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Item[][] getField() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> field; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Level</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ field = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Item[<span class="hljs-number"><span class="hljs-number">6</span></span>][<span class="hljs-number"><span class="hljs-number">6</span></span>]; field[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Block(); field[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Block(); field[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Hole(Color.RED); field[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">3</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Block(); field[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">4</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Block(); field[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">5</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Block(); field[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Block(); field[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Ball(Color.RED); field[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Ball(Color.GREEN); field[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">3</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Ball(Color.YELLOW); field[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">4</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Ball(Color.CYAN); field[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">5</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Block(); field[<span class="hljs-number"><span class="hljs-number">2</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Block(); field[<span class="hljs-number"><span class="hljs-number">2</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Hole(Color.GREEN); field[<span class="hljs-number"><span class="hljs-number">2</span></span>][<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Hole(Color.YELLOW); field[<span class="hljs-number"><span class="hljs-number">2</span></span>][<span class="hljs-number"><span class="hljs-number">3</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Hole(Color.PURPLE); field[<span class="hljs-number"><span class="hljs-number">2</span></span>][<span class="hljs-number"><span class="hljs-number">4</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Hole(Color.CYAN); field[<span class="hljs-number"><span class="hljs-number">2</span></span>][<span class="hljs-number"><span class="hljs-number">5</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Hole(Color.BLUE); field[<span class="hljs-number"><span class="hljs-number">3</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Block(); field[<span class="hljs-number"><span class="hljs-number">3</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Ball(Color.PURPLE); field[<span class="hljs-number"><span class="hljs-number">3</span></span>][<span class="hljs-number"><span class="hljs-number">5</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Block(); field[<span class="hljs-number"><span class="hljs-number">4</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Block(); field[<span class="hljs-number"><span class="hljs-number">4</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Block(); field[<span class="hljs-number"><span class="hljs-number">4</span></span>][<span class="hljs-number"><span class="hljs-number">3</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Ball(Color.BLUE); field[<span class="hljs-number"><span class="hljs-number">4</span></span>][<span class="hljs-number"><span class="hljs-number">5</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Block(); field[<span class="hljs-number"><span class="hljs-number">5</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Block(); field[<span class="hljs-number"><span class="hljs-number">5</span></span>][<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Block(); field[<span class="hljs-number"><span class="hljs-number">5</span></span>][<span class="hljs-number"><span class="hljs-number">3</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Block(); field[<span class="hljs-number"><span class="hljs-number">5</span></span>][<span class="hljs-number"><span class="hljs-number">4</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Block(); } }</code> </pre><br></div></div><br>  Now let's hook our view to some kind of activity and run this case. <br><br><img src="https://habrastorage.org/files/740/3e4/c31/7403e4c31d1749cab7f879c30764e6ac.jpg" width="240"><br><br>  Finally, it shows something! <br><br>  And now, inspired by such a beautiful picture, we will teach our interactivity view. <br><br><h4>  Chasing balls </h4><br>  Since we already have an engine that can move elements, we just have to find a way to call the appropriate methods, somehow interacting with the view. <br><br>  Interact with the playing field in different ways.  If the users are not at all sorry, you can even make the control the same as in the original game - attach a virtual joystick and press it until it's blue.  And you can remember that the native gesture for the touch screen, it's still a swipe and brush the balls in the right direction.  Understand what we are going to do?  Then let's go <br><br>  In general, for Android there is a built-in GestureManager, but either I didn‚Äôt understand how to use it, or it works just like it on my test device, but for some reason I don‚Äôt run it so that there are no recognition errors anywhere in my curved handles. came out.  So now take and write your own <br><br>  So, our balls with you can move in exactly four directions: up, down, left and right.  True, besides this, they may not move anywhere at all, but this is not at all interesting.  So in order to determine the direction of movement of the ball, we need to recognize only 4 simple gestures. <br><br>  Not really bothering, we start writing another method: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Direction </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSwipeDirection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> downHorizontal, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> upHorizontal, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> downVertical, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> upVertical)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> xDistance = Math.abs(upHorizontal - downHorizontal); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> yDistance = Math.abs(upVertical - downVertical); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> swipeLength = getSwipeLength(xDistance, yDistance); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (swipeLength &lt; elementSize / <span class="hljs-number"><span class="hljs-number">2</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Direction.NOWHERE; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xDistance &gt;= yDistance) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (upHorizontal &gt; downHorizontal) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Direction.RIGHT; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Direction.LEFT; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (yDistance &gt; xDistance) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (upVertical &gt; downVertical) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Direction.DOWN; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Direction.UP; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Direction.DOWN; }</code> </pre><br>  Direction is Enum, which we described above, and everything else is quite simple: we received 4 coordinates (from where we got them is not important yet) and calculated the distance vertically and horizontally.  Then they remembered the course of geometry from high school and found the length of the svayp itself.  If it is absolutely small, we will think that the user has nothing to do with it and we will not do anything.  If the svayp was good, we will determine where it was so good and return the direction to the user.  Cool?  I like it too. <br><br>  Well, let's say, the direction of the svayp we have learned with grief in half.  And which of the balls, we forgive, svaypnuli?  Let's figure it out. <br><br>  So, we have the coordinates of the tangency point (we also have the coordinates of the separation point, but what will we do with them?) And from these coordinates we need to find an element ... Hmm. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Coordinates </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getElementCoordinates</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> horizontal, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> vertical)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> xElCoordinate = horizontal / elementSize; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> yElCoordinate = vertical / elementSize; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Coordinates((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) xElCoordinate, (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) yElCoordinate); }</code> </pre><br>  Nothing unusual.  If all the elements are of the same size, the size of which we know (we have defined ourselves), and we have already calculated the size of the field, it only remains to take and divide.  And working with an element according to its coordinates is the task of the engine. <br><br>  Now we know for sure that we svaypnuli and even guess where.  It remains only to transfer the whole thing to the engine and let it rumble.  That's just not the task of the view.  Her business is to show, and, to process some actions, it would be necessary either in fragments or in activation.  We don't have much with fragments, but there is some kind of activism.  Hang on the onTouchLictener view. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> OnTouchListener onFieldTouchListener = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OnTouchListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onTouch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v, MotionEvent event)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (event.getAction()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MotionEvent.ACTION_DOWN: downHorizontal = event.getX(); downVertical = event.getY(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MotionEvent.ACTION_UP: upHorizontal = event.getX(); upVertical = event.getY(); <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> isWin = fieldView.getField().makeTurn( fieldView.getElementCoordinates(downHorizontal, downVertical), fieldView.getSwipeDirection(downHorizontal, upHorizontal, downVertical, upVertical) ); }</code> </pre><br>  Here you go.  When we touch, we will save the coordinates, when we release the display, we will receive a couple of coordinates, and then - collect everything in a heap and transfer it to the view - let it be disassembled.  The view will give the whole thing further, get a boolean result, which is no less than a sign of the completion of the level and will return to us.  It only remains to process it, and not to forget to tell the view to redraw. <br><br>  Add to listener: <br><br><pre> <code class="java hljs">fieldView.invalidate(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isWin) { animateView(fieldView); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { levelManager.finishLevel(); openLevel(levelManager.getCurrentLevelNumber()); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (GameException ex) { onMenuClick(); } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>;</code> </pre><br>  Checked and even did something.  What exactly we have done, we understand a little later, but for now let's play.  Remove all unnecessary from our Level, leave only two balls and try to drive one of them into the pocket <br><br><img src="https://habrastorage.org/files/db6/146/a87/db6146a878e74e509c3d8668c970bf8b.jpg" width="240"><br><br>  Hehe.  It even works.  Then move on <br><br><h4>  Looking for levels </h4><br>  Here you go.  We wrote the work engine, we learned how to draw it beautifully, now it only remains to decide what we learned to draw.  With levels, aha. <br><br>  Initially, I was not going to draw the levels myself, because our goal is to port the game and not to write a new one.  ,  -   Q,   ,    -  Sony (,  -  )   ‚Äì . <br><br>        .   T68   ,    -  ,        2016- ‚Ä¶  ,  . . <br><br> ,    ,     <a href="http://www.kxsoft.ru/proj.php%3Fid%3D2">     Windows 98</a> .       ,   ,          ,      txt ,      ,  ,  .         ,           ,    . <br><br>  ,    txt-    ,    .        ‚Äì   .   .  <br><br><h4>  Level Manager </h4><br>  ,   ‚Äì   ,     txt-        .      ,     ,        . <br><br>        -  (,   ),  ,   - ,     ,         (    ,    ).      ,    <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LevelManager</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String LEVELS_FOLDER = <span class="hljs-string"><span class="hljs-string">"levels"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String LEVEL_FILE_EXTENSION = <span class="hljs-string"><span class="hljs-string">".lev"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> EMPTY_CELL = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> BLOCK_CELL = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> GREEN_BALL_CELL = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> RED_BALL_CELL = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> BLUE_BALL_CELL = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> YELLOW_BALL_CELL = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> PURPLE_BALL_CELL = <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CYAN_BALL_CELL = <span class="hljs-number"><span class="hljs-number">7</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> GREEN_HOLE_CELL = <span class="hljs-number"><span class="hljs-number">22</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> RED_HOLE_CELL = <span class="hljs-number"><span class="hljs-number">33</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> BLUE_HOLE_CELL = <span class="hljs-number"><span class="hljs-number">44</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> YELLOW_HOLE_CELL = <span class="hljs-number"><span class="hljs-number">55</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> PURPLE_HOLE_CELL = <span class="hljs-number"><span class="hljs-number">66</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CYAN_HOLE_CELL = <span class="hljs-number"><span class="hljs-number">77</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Context context; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> SharedSettingsManager sharedSettingsManager; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> LevelManager instance; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LevelManager</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> LevelManager </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context currentContext)</span></span></span><span class="hljs-function"> </span></span>{ context = currentContext; sharedSettingsManager = SharedSettingsManager.build(currentContext); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (instance == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { instance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LevelManager(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance; }</code> </pre><br>     ?   .   , <s></s>       <br><br><img src="https://habrastorage.org/files/431/900/2e8/4319002e817e4887a9b5d5d5bd69678f.PNG"><br><br>    -  .         ,          .  sharedSettingsManager,   -       ,               <br><br>  ,        -  .             Scanner,         <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Scanner </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openLevel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> levelNumber)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ AssetManager assetManager = context.getAssets(); InputStream inputStream = assetManager.open( LEVELS_FOLDER + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + String.valueOf(levelNumber) + LEVEL_FILE_EXTENSION); BufferedReader bufferedReader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BufferedReader (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputStreamReader(inputStream)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Scanner(bufferedReader); }</code> </pre><br> ,   .       assets ,       , , ,     .      . ,       ,    ,     . <br><br>  ‚Äì      Item. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Item </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertLegendToItem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> itemLegend)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (itemLegend) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> EMPTY_CELL: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> BLOCK_CELL: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Block(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> GREEN_BALL_CELL: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Ball(Color.GREEN); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RED_BALL_CELL: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Ball(Color.RED); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> BLUE_BALL_CELL: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Ball(Color.BLUE); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> YELLOW_BALL_CELL: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Ball(Color.YELLOW); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> PURPLE_BALL_CELL: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Ball(Color.PURPLE); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CYAN_BALL_CELL: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Ball(Color.CYAN); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> GREEN_HOLE_CELL: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Hole(Color.GREEN); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RED_HOLE_CELL: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Hole(Color.RED); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> BLUE_HOLE_CELL: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Hole(Color.BLUE); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> YELLOW_HOLE_CELL: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Hole(Color.YELLOW); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> PURPLE_HOLE_CELL: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Hole(Color.PURPLE); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CYAN_HOLE_CELL: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Hole(Color.CYAN); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre><br>  - switch   . <br><br>    ‚Äì     : <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Level </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLevel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> levelNumber)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ Scanner scanner = openLevel(levelNumber); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> levelWidth = scanner.nextInt(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> levelHeight = scanner.nextInt(); Item levelMatrix[][] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Item[levelHeight][levelWidth]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; levelHeight; i++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; levelWidth; j++) { levelMatrix[i][j] = convertLegendToItem(scanner.nextInt()); } } Level level = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Level(levelMatrix); sharedSettingsManager.setCurrentLevel(levelNumber); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> level; }</code> </pre><br>   ‚Äì  .  Miracles.  ,   ,    ¬´¬ª    ,     .  ‚Äì        ,         <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">finishLevel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ sharedSettingsManager.setCurrentLevel( sharedSettingsManager.getCurrentLevel() + <span class="hljs-number"><span class="hljs-number">1</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sharedSettingsManager.getCurrentLevel() &gt; sharedSettingsManager.getMaxLevel()) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GameException(GameExceptionCodes.INCORRECT_LEVEL); } }</code> </pre><br> ,    ,    ,     ,    ,  . ?      , ,   <br><br><img src="https://habrastorage.org/files/d5e/ba1/f11/d5eba1f112044ed4b8e525f446a0653a.jpg" width="240"><br><br> !  , .        <br><br><h4>    </h4><br>         ,     .    -        ,      . <br><br>     ,  Android  SharedSettings. ,     ,     .       <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String LAST_LEVEL = <span class="hljs-string"><span class="hljs-string">"current_level"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String MAX_LEVEL = <span class="hljs-string"><span class="hljs-string">"max_level"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String WAS_RAN_BEFORE = <span class="hljs-string"><span class="hljs-string">"was_ran_before"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String APP_PREFS = <span class="hljs-string"><span class="hljs-string">"qook_prefs"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Context context; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> SharedSettingsManager instance; SharedPreferences sharedPreferences; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SharedSettingsManager</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ sharedPreferences = context.getSharedPreferences(APP_PREFS, Context.MODE_PRIVATE); }</code> </pre><br>  , .    ,      ,   ‚Äì threadsafe   sharedsettings   - . <br><br> ,      . <br><br>  Time <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMaxLevel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sharedPreferences.getInt(MAX_LEVEL, <span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre><br>   <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCurrentLevel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sharedPreferences.getInt(LAST_LEVEL, <span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre><br> ,    .  -       ,     <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setMaxLevel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> maxLevel)</span></span></span><span class="hljs-function"> </span></span>{ SharedPreferences.Editor editor = sharedPreferences.edit(); editor.putInt(MAX_LEVEL, maxLevel); editor.apply(); }</code> </pre><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setCurrentLevel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> currentLevel)</span></span></span><span class="hljs-function"> </span></span>{ SharedPreferences.Editor editor = sharedPreferences.edit(); editor.putInt(LAST_LEVEL, currentLevel); editor.apply(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getMaxLevel() &lt; currentLevel) { setMaxLevel(currentLevel); } }</code> </pre><br> ,        ,       ‚Äì     .      ? <br><br><h4>   </h4><br><br>     ,  .       ‚Äì .        ¬´¬ª           .          <br><br><img src="https://habrastorage.org/files/052/5e1/e3c/0525e1e3c15d4007b15cda9c45dd05d3.png" width="240"><br><br>      ,   ,     .  , ,            <br><br><div class="spoiler"> <b class="spoiler_title">       ,  </b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:app</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:tools</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/tools"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/game_activity"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@color/background"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center_vertical"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:orientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/activity_vertical_margin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingLeft</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/activity_horizontal_margin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingRight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/activity_horizontal_margin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/activity_vertical_margin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layout_behavior</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/appbar_scrolling_view_behavior"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tools:context</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".ui.activities.LevelActivity"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/level_counter"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingLeft</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"01 / 60"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textSize</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"34sp"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"right"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10dp"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ImageButton</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/back_level_button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:padding</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@drawable/menu_icon"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ImageButton</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/reset_level_button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:padding</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@drawable/restore_level"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ImageButton</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/undo_step_button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:padding</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@drawable/undo_step"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">org.grakovne.qook.ui.views.FieldView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/field"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center_horizontal"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@drawable/field_ground"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:foregroundGravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>       .  -:   - ,    ,         . , ! <br><br><h4>     </h4><br>       ,    ,  :   ‚Äì ,        ,      .  ? <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/title_text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_weight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/app_name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textAllCaps</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textSize</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"48sp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textStyle</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bold"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">GridView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/level_grid"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_weight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"9"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:numColumns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">GridView</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>     ‚Äì  . ,      -  <br><br>      ,     ,   ,    clickListener    .  Like that: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> View </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position, View convertView, ViewGroup parent)</span></span></span><span class="hljs-function"> </span></span>{ LayoutInflater vi; vi = LayoutInflater.from(getContext()); <span class="hljs-meta"><span class="hljs-meta">@SuppressLint</span></span>(<span class="hljs-string"><span class="hljs-string">"ViewHolder"</span></span>) View view = vi.inflate(R.layout.level_item, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); Integer currentLevelNumber = getItem(position); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentLevelNumber != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { Button levelButton = (Button) view.findViewById(R.id.level_item_button); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (levelButton != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { levelButton.setText(String.valueOf(currentLevelNumber)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (position &lt; maxOpenedLevel) { levelButton.setBackgroundResource(R.drawable.opened_level_item); levelButton.setClickable(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); levelButton.setOnClickListener(clickListener); levelButton.setId(currentLevelNumber); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { levelButton.setBackgroundResource(R.drawable.closed_level_item); levelButton.setClickable(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> view; }</code> </pre><br>  Great.   ,      .  ,    Button    : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LevelButton</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Button</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onMeasure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> widthMeasureSpec, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> heightMeasureSpec)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onMeasure(widthMeasureSpec, widthMeasureSpec); } }</code> </pre><br>  Hehe.  ,   .    .         <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onResume</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onResume(); manager = LevelManager.build(getBaseContext()); View.OnClickListener levelClick = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ Intent intent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(getBaseContext(), LevelActivity.class); intent.putExtra(DESIRED_LEVEL, v.getId()); intent.addFlags(Intent.FLAG_ACTIVITY_NO_ANIMATION); startActivity(intent); } }; LevelGridAdapter adapter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LevelGridAdapter(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, R.layout.level_item, getListOfLevelNumbers(), manager.getMaximalLevelNumber(), levelClick); adapter.setNotifyOnChange(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); levelGrid.setAdapter(adapter); levelGrid.setVerticalScrollBarEnabled(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); }</code> </pre><br>    ‚Äì  .  Beauty. <br><br><h4>  </h4><br>  ,       ,  ,  , ¬´ ¬ª,      ,     . <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Zm2NJQH7deM%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiL6rebYIAlp3WRLMQv4wOWybrLKQ" frameborder="0" allowfullscreen=""></iframe><br>          ‚Äì   .  :         ,     ,        ‚Äì    . <br><br> ,     ‚Äì     Google Play, ,    <br><br> ,  $25 ,   ,  ,     ‚Ä¶      ¬´¬ª, , ,     <br><br> <a href="https://play.google.com/store/apps/details%3Fid%3Dorg.grakovne.qook%26utm_source%3Dglobal_co%26utm_medium%3Dprtnr%26utm_content%3DMar2515%26utm_campaign%3DPartBadge%26pcampaignid%3DMKT-Other-global-all-co-prtnr-py-PartBadge-Mar2515-1"><img alt="  Google Play" src="https://play.google.com/intl/en_us/badges/images/generic/ru_badge_web_generic.png"></a> <br><br>  Here you go.     .           .  , ,   ,      ¬´  ¬ª,            <br><br> <i> ,     , GrakovNe</i> </div><p>Source: <a href="https://habr.com/ru/post/283132/">https://habr.com/ru/post/283132/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../283116/index.html">DNS disorder Vkontakte and other companies</a></li>
<li><a href="../283118/index.html">Victor Gamov on In-Memory Data Grids and Hazelcast on jug.msk.ru</a></li>
<li><a href="../283122/index.html">Slit survey: implementation on bash (ffmpeg + imagemagick)</a></li>
<li><a href="../283128/index.html">RxSwift: working with GUI</a></li>
<li><a href="../283130/index.html">Goals against restrictions</a></li>
<li><a href="../283136/index.html">Geography package or library that knows geography well and speaks different languages</a></li>
<li><a href="../283138/index.html">The digest of interesting events from the world of Java, and around it # 1 (05/02/2016 - 05/05/2016)</a></li>
<li><a href="../283146/index.html">How to enable Intel AMT, if the manufacturer forgot it</a></li>
<li><a href="../283148/index.html">Why not use Backbone.js in 2016</a></li>
<li><a href="../283150/index.html">IBM TrueNorth-based computer chip helps predict epileptic seizures</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>