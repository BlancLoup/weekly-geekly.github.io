<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Introducing Kohana 3.0 - Part 4</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Meet the fourth part of a series of articles on development with Kohana PHP V3 (KO3). The previous parts can be found under the tag " familiarity with...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Introducing Kohana 3.0 - Part 4</h1><div class="post__text post__text-html js-mediator-article">  Meet the fourth part of a series of articles on development with Kohana PHP V3 (KO3).  The previous parts can be found under the tag " <a href="http://habrahabr.ru/tag/%25D0%25B7%25D0%25BD%25D0%25B0%25D0%25BA%25D0%25BE%25D0%25BC%25D1%2581%25D1%2582%25D0%25B2%25D0%25BE%2520%25D1%2581%2520kohana%25203.0/">familiarity with kohana 3.0</a> ".  This time it will be about working with models. <br><a name="habracut"></a><br>  The model definition is taken from the Kohana 2.x documentation: <br><blockquote>  Models are classes designed to work with information transmitted or requested by the controller.  For example, if you have a guest book, the controller queries the model for the last ten entries;  the model returns them;  the controller transmits this data to mind.  The controller can also add new records using the model and update or delete existing ones. </blockquote><br>  In essence, a model is a data manipulator. <br><br>  First of all, we need to determine what will be the data: XML tape, CSV, JSON, DB or something else?  I will not torture you and say that this time we will work with a long-time friend of MySQL.  Therefore, the next step is to set up a connection to the database. <br><br>  Let's open the boot file (‚Äúapplication / bootstrap.php‚Äù), find the line ‚Äú// 'database' =&gt; MODPATH.'database ', // Database access‚Äù and uncomment it.  The whole block should now look like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="php hljs">Kohana::modules(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-comment"><span class="hljs-comment">// 'auth' =&gt; MODPATH.'auth', // Basic authentication // 'codebench' =&gt; MODPATH.'codebench', // Benchmarking tool 'database' =&gt; MODPATH.'database', // Database access // 'image' =&gt; MODPATH.'image', // Image manipulation // 'orm' =&gt; MODPATH.'orm', // Object Relationship Mapping // 'pagination' =&gt; MODPATH.'pagination', // Paging of results // 'userguide' =&gt; MODPATH.'userguide', // User guide and API documentation ));</span></span></code> </pre> <br><br>  Now save the file.  We have just ordered the framework to load the database module, but it is not yet configured.  Copy ‚Äúdatabase.php‚Äù from ‚Äúmodules / database / config /‚Äù to ‚Äúapplication / config /‚Äù.  Open the file ‚Äúapplication / config / database.php‚Äù and edit it according to your settings.  My looks like this: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> defined(<span class="hljs-string"><span class="hljs-string">'SYSPATH'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>(<span class="hljs-string"><span class="hljs-string">'No direct access allowed.'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> ( <span class="hljs-string"><span class="hljs-string">'default'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> ( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'mysql'</span></span>, <span class="hljs-string"><span class="hljs-string">'connection'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-comment"><span class="hljs-comment">/** * The following options are available for MySQL: * * string hostname * integer port * string socket * string username * string password * boolean persistent * string database */</span></span> <span class="hljs-string"><span class="hljs-string">'hostname'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'localhost'</span></span>, <span class="hljs-string"><span class="hljs-string">'username'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'root'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>, <span class="hljs-string"><span class="hljs-string">'persistent'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>, <span class="hljs-string"><span class="hljs-string">'database'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'mykohana3'</span></span>, ), <span class="hljs-string"><span class="hljs-string">'table_prefix'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'charset'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'utf8'</span></span>, <span class="hljs-string"><span class="hljs-string">'caching'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>, <span class="hljs-string"><span class="hljs-string">'profiling'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">TRUE</span></span>, ), <span class="hljs-string"><span class="hljs-string">'alternate'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pdo'</span></span>, <span class="hljs-string"><span class="hljs-string">'connection'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-comment"><span class="hljs-comment">/** * The following options are available for PDO: * * string dsn * string username * string password * boolean persistent * string identifier */</span></span> <span class="hljs-string"><span class="hljs-string">'dsn'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'mysql:host=localhost;dbname=mykohana3'</span></span>, <span class="hljs-string"><span class="hljs-string">'username'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'root'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>, <span class="hljs-string"><span class="hljs-string">'persistent'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>, ), <span class="hljs-string"><span class="hljs-string">'table_prefix'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'charset'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'utf8'</span></span>, <span class="hljs-string"><span class="hljs-string">'caching'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>, <span class="hljs-string"><span class="hljs-string">'profiling'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">TRUE</span></span>, ), );</code> </pre> <br><br>  Save the file.  For this series of articles I have created the database ‚Äúmykohana3 ‚Ä≥, it is advisable for you to do the same.  We will create a table in the database using the following SQL code: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`posts`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> MEDIUMINT(<span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">UNSIGNED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`title`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`post`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">INNODB</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8 <span class="hljs-keyword"><span class="hljs-keyword">CHECKSUM</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span> DELAY_KEY_WRITE=<span class="hljs-number"><span class="hljs-number">1</span></span> ROW_FORMAT=DYNAMIC;</code> </pre> <br><br>  Run it in your favorite MySQL client, I personally prefer SQLYog.  Both in the database connection configuration and for the table I set the ‚Äúutf8 ‚Ä≥ encoding.  We will need this in the future. <br><br>  Let's create a new ‚Äúmodel‚Äù folder in ‚Äúapplication / classes‚Äù.  In it, create a new file and put the following there: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> defined(<span class="hljs-string"><span class="hljs-string">'SYSPATH'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>(<span class="hljs-string"><span class="hljs-string">'No direct script access.'</span></span>); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model_Post</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Kohana_Model</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Get the last 10 posts * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> ARRAY */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLastTenPosts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $sql = <span class="hljs-string"><span class="hljs-string">'SELECT *'</span></span>.<span class="hljs-string"><span class="hljs-string">"\n"</span></span>. <span class="hljs-string"><span class="hljs-string">'FROM `posts`'</span></span>.<span class="hljs-string"><span class="hljs-string">"\n"</span></span>. <span class="hljs-string"><span class="hljs-string">'ORDER BY `id` DESC'</span></span>.<span class="hljs-string"><span class="hljs-string">"\n"</span></span>. <span class="hljs-string"><span class="hljs-string">'LIMIT 0, 10'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_db-&gt;query(Database::SELECT, $sql, <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>) -&gt;as_array(); } }</code> </pre> <br><br>  Save it as ‚Äúpost.php‚Äù in ‚Äúapplication / classes / model /‚Äù.  Now we will sort the code line by line. <br><br><pre> <code class="php hljs">$sql = <span class="hljs-string"><span class="hljs-string">'SELECT *'</span></span>.<span class="hljs-string"><span class="hljs-string">"\n"</span></span>. <span class="hljs-string"><span class="hljs-string">'FROM `posts`'</span></span>.<span class="hljs-string"><span class="hljs-string">"\n"</span></span>. <span class="hljs-string"><span class="hljs-string">'ORDER BY `id` DESC'</span></span>.<span class="hljs-string"><span class="hljs-string">"\n"</span></span>. <span class="hljs-string"><span class="hljs-string">'LIMIT 0, 10'</span></span>;</code> </pre> <br><br>  This is a basic MySQL query that selects up to ten records from the database, which are sorted by the 'id' field in descending order. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_db-&gt;query(Database::SELECT, $sql, <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>) -&gt;as_array();</code> </pre> <br><br>  This returns an array with the result of the query.  The ‚Äúquery‚Äù method in this example takes three parameters.  The first is the type of the query, we have this ‚Äúselect‚Äù, so we are passing the constant ‚ÄúDatabase :: SELECT‚Äù.  There are also three others: ‚ÄúDatabase :: INSERT‚Äù, ‚ÄúDatabase :: UPDATE‚Äù and ‚ÄúDatabase :: DELETE‚Äù.  The ‚Äúas_array ()‚Äù method returns an array with the results, so there is no need to do ‚Äúwhile ($ row = mysql_fetch_array ())‚Äù. <br><br>  Now that we have a method in our model, we can start using it.  Open ‚Äúko3.php‚Äù in ‚Äú/ application / classes / controller‚Äù and add the following code to the class: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">action_posts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $posts = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Model_Post(); $ko3 = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;template-&gt;title = <span class="hljs-string"><span class="hljs-string">'Kohana 3.0 Model Test'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;template-&gt;meta_keywords = <span class="hljs-string"><span class="hljs-string">'PHP, Kohana, KO3, Framework, Model'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;template-&gt;meta_description = <span class="hljs-string"><span class="hljs-string">'A test of of the KO3 framework Model'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;template-&gt;styles = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;template-&gt;scripts = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-comment"><span class="hljs-comment">// Get the last 10 posts $ko3['posts'] = $posts-&gt;getLastTenPosts(); $this-&gt;template-&gt;content = View::factory('pages/posts', $ko3); }</span></span></code> </pre> <br><br>  We just called the ‚ÄúgetLastTenPosts ()‚Äù method from the model and placed the value returned by it into an array, which was then passed to our view.  Speaking of views: open a new file and place there: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($posts <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $post):<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;h1&gt;<span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $post[<span class="hljs-string"><span class="hljs-string">'title'</span></span>];<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span>&lt;/h1&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $post[<span class="hljs-string"><span class="hljs-string">'post'</span></span>];<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;hr /&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">endforeach</span></span>;<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br><br>  Save it as ‚Äúposts.php‚Äù in the ‚Äúapplication / views / pages /‚Äù folder.  This view enumerates the array transmitted by the controller and displays the records from the database.  Although, stop, we have no articles in the database yet!  Fix this with the following SQL queries: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> <span class="hljs-string"><span class="hljs-string">`posts`</span></span>(<span class="hljs-string"><span class="hljs-string">`id`</span></span>,<span class="hljs-string"><span class="hljs-string">`title`</span></span>,<span class="hljs-string"><span class="hljs-string">`post`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">'Test Post'</span></span>,<span class="hljs-string"><span class="hljs-string">'This is some sample text.'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> <span class="hljs-string"><span class="hljs-string">`posts`</span></span>(<span class="hljs-string"><span class="hljs-string">`id`</span></span>,<span class="hljs-string"><span class="hljs-string">`title`</span></span>,<span class="hljs-string"><span class="hljs-string">`post`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-string"><span class="hljs-string">'Another post'</span></span>,<span class="hljs-string"><span class="hljs-string">'Some more text'</span></span>);</code> </pre> <br><br>  Now, going to ‚Äúhttp: // localhost / mykohana3 / ko3 / posts‚Äù, you should see two entries. <br><br>  Let's now implement the addition of new data to the database.  Open our model ("application / classes / model / post.php") and add the following to the class: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addPost</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($title, $post)</span></span></span><span class="hljs-function"> </span></span>{ $sql = sprintf(<span class="hljs-string"><span class="hljs-string">'INSERT INTO `posts`'</span></span>.<span class="hljs-string"><span class="hljs-string">"\n"</span></span>. <span class="hljs-string"><span class="hljs-string">'SET `title` = %s,'</span></span>.<span class="hljs-string"><span class="hljs-string">"\n"</span></span>. <span class="hljs-string"><span class="hljs-string">' `post` = %s'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_db-&gt;escape($title), <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_db-&gt;escape($post)); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_db-&gt;query(Database::INSERT, $sql, <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>); }</code> </pre> <br><br>  Above is a fairly simple INSERT query, but what is ‚Äú$ this -&gt; _ db&gt; escape ()‚Äù?  This method will quote your string variables in quotes and clear them of garbage.  Save it and go back to ‚Äúposts.php‚Äù from ‚Äúapplication / views / pages‚Äù.  Replace its contents with this: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($msg)):<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $msg.<span class="hljs-string"><span class="hljs-string">'&lt;br /&gt;'</span></span>;<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">endif</span></span>;<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($posts <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $post):<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;h1&gt;<span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $post[<span class="hljs-string"><span class="hljs-string">'title'</span></span>];<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span>&lt;/h1&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $post[<span class="hljs-string"><span class="hljs-string">'post'</span></span>];<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;hr /&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">endforeach</span></span>;<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;form method=<span class="hljs-string"><span class="hljs-string">"POST"</span></span> action=<span class="hljs-string"><span class="hljs-string">"&lt;?php echo url::base();?&gt;ko3/posts/"</span></span>&gt; &lt;table&gt; &lt;tr&gt; &lt;td&gt; Title &lt;/td&gt; &lt;td&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"text"</span></span> name=<span class="hljs-string"><span class="hljs-string">"title"</span></span> style=<span class="hljs-string"><span class="hljs-string">"border: 1px solid #000000;"</span></span>/&gt; &lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt; Post &lt;/td&gt; &lt;td&gt; &lt;textarea cols=<span class="hljs-string"><span class="hljs-string">"20"</span></span> rows=<span class="hljs-string"><span class="hljs-string">"5"</span></span> name=<span class="hljs-string"><span class="hljs-string">"post"</span></span>&gt;&lt;/textarea&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"submit"</span></span> name=<span class="hljs-string"><span class="hljs-string">"submit"</span></span> value=<span class="hljs-string"><span class="hljs-string">"Submit"</span></span>/&gt; &lt;/td&gt; &lt;/table&gt; &lt;/form&gt;</code> </pre> <br><br>  Save the file and open the controller (‚Äúapplication / classes / controller / ko3.php‚Äù).  Add a new method to it: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_addPost</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($title, $post_content)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Load model $post = new Model_Post(); // Check required fields if(empty($title)) { return(array('error' =&gt; 'Please enter a title.')); } elseif(empty($post_content)) { return(array('error' =&gt; 'Please enter a post.')); } // Add to DB $post-&gt;addPost($title, $post_content); return TRUE; }</span></span></code> </pre> <br><br>  This code is an intermediate link between the ‚Äúaction_posts‚Äù and the model, it is used to directly save the record.  Let's go back to the ‚Äúaction_posts‚Äù method and bring it to this form: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">action_posts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Load model $posts = new Model_Post(); // Setup view stuff $ko3 = array(); $this-&gt;template-&gt;title = 'Kohana 3.0 Model Test'; $this-&gt;template-&gt;meta_keywords = 'PHP, Kohana, KO3, Framework, Model'; $this-&gt;template-&gt;meta_description = 'A test of of the KO3 framework Model'; $this-&gt;template-&gt;styles = array(); $this-&gt;template-&gt;scripts = array(); $ko3['msg'] = ""; // Handle POST if($_POST) { $ret = $this-&gt;_addPost((isset($_POST['title']) ? $_POST['title'] : ""), (isset($_POST['post']) ? $_POST['post'] : "")); if(isset($ret['error'])) { $ko3['msg'] = $ret['error']; } else { $ko3['msg'] = 'Saved.'; } } // Get the last 10 posts $ko3['posts'] = $posts-&gt;getLastTenPosts(); // Display it. $this-&gt;template-&gt;content = View::factory('pages/posts', $ko3); }</span></span></code> </pre> <br><br>  Save it and restart your browser.  A scary form should appear at the bottom.  Enter something and click "Send".  If you have filled both fields, your entry should appear at the top along with the inscription ‚ÄúSaved‚Äù.  Otherwise, an error message should appear. <br><br>  Before I finish familiarizing myself with the models, I want to show how it was still possible to add a record to the database.  There are several ways, but I will focus only on the so-called Query Builder.  A mysql query in the addPost () method with it would look like this: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addPost</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($title, $post)</span></span></span><span class="hljs-function"> </span></span>{ DB::insert(<span class="hljs-string"><span class="hljs-string">'posts'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span>,<span class="hljs-string"><span class="hljs-string">'post'</span></span>)) -&gt;values(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($title, $post)) -&gt;execute(); }</code> </pre> <br><br>  Query Builder is particularly useful in that it allows you to switch between different types of databases (from MySQL to Oracle, etc.) <br><br>  I did not implement the update of the records in the model, so you can consider this as homework. </div><p>Source: <a href="https://habr.com/ru/post/111871/">https://habr.com/ru/post/111871/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../111864/index.html">Web statistics, year 2010</a></li>
<li><a href="../111867/index.html">The magic of wind and silk</a></li>
<li><a href="../111868/index.html">Android Application Development Standard</a></li>
<li><a href="../111869/index.html">Preparation of a package of documents for the transfer of domains in the zone .RU and .SU</a></li>
<li><a href="../111870/index.html">WebMatrix Hosting is back!</a></li>
<li><a href="../111873/index.html">Subdivision into subtasks: why it works, and why not</a></li>
<li><a href="../111874/index.html">Trie, or loaded tree</a></li>
<li><a href="../111875/index.html">Signed final SP1 for Windows 7 and Windows Server 2008 R2</a></li>
<li><a href="../111876/index.html">Experimental characterization of cache memory: workshop</a></li>
<li><a href="../111878/index.html">Negative of YOTA as a service for the client</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>