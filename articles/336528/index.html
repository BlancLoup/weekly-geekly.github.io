<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating an outbound application in the 3CX Call Flow Designer development environment</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 In this article we will describe how to create an application for automatic outgoing dialing of subscribers (Dialer) in 3CX Call Flow D...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating an outbound application in the 3CX Call Flow Designer development environment</h1><div class="post__text post__text-html js-mediator-article"><h2>  Introduction </h2><br>  In this article we will describe how to create an application for automatic outgoing dialing of subscribers (Dialer) in <a href="https://www.3cx.com/phone-system/call-flow-designer/">3CX Call Flow Designer</a> using the MakeCall component.  The dialer automatically dials the subscribers from the list and connects the call to the extension number or the 3CX call queue.  The dialer application allows you to conduct efficient, automated outbound dialing campaigns.  Call center operators save time and effort by simply accepting dial-up calls - no need to search and dial the desired number! <a name="habracut"></a><br><br>  Recall that in previous articles we looked at the <a href="https://habrahabr.ru/company/3cx/blog/334472/">operation of CFDs with databases</a> (which can also be used to get a subscriber number) and the <a href="https://habrahabr.ru/company/3cx/blog/333958/">routing of incoming calls depending on the time of day</a> (which can be combined with outgoing dialing). <br><br>  Please note - the 3CX CFD development environment is free.  But voice applications will be run only on <a href="https://www.3cx.ru/ip-pbx/edition-comparison/">3CX Pro and Enterprise editions</a> .  Download CFD <a href="">from here</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The demo project of this voice application comes with the 3CX CFD distribution and is located in the <b>Documents \ 3CX Call Flow Designer Demos</b> folder. <br><br>  It is important to note that by default, the dialer starts working when the 3CX Queue Manager Service starts.  Therefore, it is necessary to specify a certain condition by which the dialer will make calls.  For this, the voice application uses the <b>Create a Condition</b> component (s).  For example, you can check (set) the time of day at which calls should be performed. <br><br>  Without setting the conditions, the call starts at the moment the service starts and continues until the 3CX Queue Manager Service service is stopped, or the Queue with this voice application is deleted, or the voice application is not deleted from the Call Queue.  Agree, it is inconvenient. <br><br>  Calling numbers can come from any source - a text file, a database, etc.  In our example, the numbers are taken from a text file.  The voice application also checks the current date and time (dialing is performed only on working days and during working hours), and the status of agents for call distribution (if there are no free agents, dialing is suspended). <br><br><h2>  Project creation </h2><br>  To create a CFD project, go to <b>File ‚Üí New ‚Üí Project</b> , specify the project folder and its name, for example, <b>OutboundDialerDemo</b> . <br><br>  The new project by default contains the voice application <b>Main.flow</b> .  It is not used in this project, so delete it in the Project Explorer window.  In the same window, add a new application - right-click on the project name and select <b>New Dialer</b> .  Call it <b>MainDialer</b> .  In the Project Explorer, select the <b>MailDialer</b> object and set its properties in the <b>Properties Window</b> , as shown below. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6cd/65c/8be/6cd65c8bedfcfb8d351fa4a83d184749.png"></div><br>  A dialer has two parameters defining its behavior: <br><br><ul><li>  <b>ParallelDialers</b> - the number of simultaneously running dialer entities; <br></li><li>  <b>PauseBetweenDialerExecution</b> - the time each entity waits for before making a call (strictly speaking, before starting the procedure for checking the conditions for making a call). <br></li></ul><br>  Let us explain this with an example.  Suppose we set ParallelDialers to 5, and PauseBetweenDialerExecution to 30 seconds.  The application will work as follows: <br><br><ol><li>  The first dialer (entity) is created, gets a number to call, rings and waits for 30 seconds. <br></li><li>  After 6 seconds  a second dialer is created, receives a number, calls and starts to wait 30 seconds. <br></li><li>  After 6 seconds  a third dialer is created, receives a number, calls and starts to wait 30 seconds. <br></li><li>  After 6 seconds  the fourth dialer is created, receives a number, calls and waits for 30 seconds. <br></li><li>  After 6 seconds  the fifth dialer is created, receives a number, calls and waits for 30 seconds. <br></li><li>  After 6 seconds  The first dialer wakes up, gets a number to call, rings and waits for 30 seconds. <br></li><li>  After 6 seconds  The second dialer ‚Äúwakes up‚Äù, receives a call number, calls and waits for 30 seconds, etc. <br></li></ol><br>  As you can see, these two parameters determine the frequency of dialing.  When ParallelDialers is set to 5 and PauseBetweenDialerExecution in 30 seconds, 10 calls per minute will be made.  Changing the parameters, we determine the desired frequency of calls. <br><br><h2>  Determining the appropriate time to call </h2><br>  In our example, dialing will be performed only from Monday to Friday from 9 to 17. To meet this condition, drag the <b>Create a condition</b> component from the sidebar of the components into the main window of the development environment and name it <b>checkTimeToCall</b> .  The component will have two branches: <b>timeToCall</b> - performed when the conditions (time) of the call are <b>met</b> and <b>nothingToDo</b> - is performed if the conditions are not met. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/049/386/db3/049386db3a86bdaf638e2e535f64d9b4.png"></div><br>  Create a condition to execute the <b>timeToCall</b> branch (Condition parameter).  In CFD, this uses the C # expression, which returns True when it falls into the time frame: <br><br><pre><code class="hljs vbscript">((<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>)DateTime.<span class="hljs-built_in"><span class="hljs-built_in">Now</span></span>.DayOfWeek) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; ((<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>)DateTime.<span class="hljs-built_in"><span class="hljs-built_in">Now</span></span>.DayOfWeek) &lt; <span class="hljs-number"><span class="hljs-number">6</span></span> &amp;&amp; DateTime.<span class="hljs-built_in"><span class="hljs-built_in">Now</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">Hour</span></span> &gt;= <span class="hljs-number"><span class="hljs-number">9</span></span> &amp;&amp; DateTime.<span class="hljs-built_in"><span class="hljs-built_in">Now</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">Hour</span></span> &lt; <span class="hljs-number"><span class="hljs-number">17</span></span></code> </pre> <br><h2>  Definition of free operators </h2><br>  Let me remind you that our dialer "takes" a number from a text file and commutes it with the number of the 3CX Call Queue, to which, of course, the operators must be connected.  Suppose that the Queue number is 800, and the numbers of the operators are 201, 202 and 203. It is necessary to check whether one of these operators is ready to accept the call.  To do this, run the <a href="https://www.3cx.com/blog/docs/call-control-api/">3CX Call Control API</a> script from the <b>Launch External Script</b> component. <br><br>  This script is also written in C #.  It checks the DN objects of each extension for the presence of the ActiveConnection attribute: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> TCX.Configuration; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">OutboundDialerDemo</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ExtensionStateHelper</span></span> {   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsThereAnyFreeExtension</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>   {     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PhoneSystem.Root.GetDNByNumber(<span class="hljs-string"><span class="hljs-string">"201"</span></span>).GetActiveConnections().Length == <span class="hljs-number"><span class="hljs-number">0</span></span> ||            PhoneSystem.Root.GetDNByNumber(<span class="hljs-string"><span class="hljs-string">"202"</span></span>).GetActiveConnections().Length == <span class="hljs-number"><span class="hljs-number">0</span></span> ||            PhoneSystem.Root.GetDNByNumber(<span class="hljs-string"><span class="hljs-string">"203"</span></span>).GetActiveConnections().Length == <span class="hljs-number"><span class="hljs-number">0</span></span>;   } } }</code> </pre> <br>  Save the script in a file named <b>CheckExtensionsState.cs</b> in the project <b>Libraries</b> folder.  Then drag the <b>Launch External Script</b> component to the <b>timeToCall</b> branch, name it <b>checkFreeExtensions</b> and configure it as shown below. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7f4/465/b6c/7f4465b6c249537fa835b169499a3bc6.png"><br><br>  Now you should check the result of the script.  Immediately below the <b>Launch External Script</b> component, add the <b>Create a condition component component</b> and name it <b>isThereAnyFreeExtension</b> .  The component will have two branches: <b>yesMakeCall</b> and <b>noFreeExtensions</b> , as shown below. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a78/3a1/089/a783a1089a2e1419202a10b2f2e4f6dc.png"><br><br>  Create a <b>yesMakeCall</b> branch <b>condition</b> , which is executed if the previous script returns True.  The expression has the form: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">checkFreeExtensions</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ReturnValue</span></span></code> </pre> <br>  When the condition is fulfilled, the <b>yesMakeCall</b> branch <b>is</b> executed, because all the necessary conditions are fulfilled: the right time and at least one free operator.  You can call the subscriber! <br><br><h2>  Receiving and switching subscriber numbers </h2><br>  Let me remind you that in our example, the numbers are taken from the file.  <b>Name the</b> file <b>NumbersToCall.txt</b> - each line of the file contains one number. <br><br>  For successful work with the file, you need to create an index variable for the line number, which will be common to all entities of the dialers.  Choosing a number, we increase the index, and the next dialer "takes" the number from the next line, and so on, in turn.  Let's create another C # <b>CallIndexHolder.cs</b> script in which we will define a static variable (the script should also be saved in the <b>Libraries</b> folder. <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">TCX</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CallIndexHolder</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> callIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>;    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCallIndex</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>   {     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> callIndex;   }    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetCallIndex</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index</span></span></span><span class="hljs-function">)</span></span>   {     callIndex = index;   } } }</code> </pre> <br>  Since the <b>callIndex</b> variable <b>is</b> declared as static, there is only one entity in the 3CX Queue Manager service process that is shared between the dialers. <br>  So, we need another <b>Launch External Script</b> component (let's call it <b>getCallIndex)</b> , which we put into the branch <b>yesMakeCall</b> and set up as shown below: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/09e/5b9/abf/09e5b9abff4bdb6e6e9a1692cdc5ee68.png"><br><br>  We now turn, in fact, to reading the numbers from a text file.  Immediately after the <b>getCallIndex</b> component <b>,</b> add the <b>Read / Write to File</b> component, name it <b>readNumberToCall</b> and configure it as shown below: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dfc/95b/19e/dfc95b19e02c9633fdac06e264ece113.png"><br><br>  Pay attention to the format of the path to the file with numbers and specify the path on your 3CX server. <br><br>  When all lines in the file are read, the <b>readNumberToCall</b> component counts the empty string.  At this point, calls must be suspended.  To do this, add another component, <b>Create a condition</b> , which will check whether the number is read from the file or not.  It has one branch with the following condition: <br><br><pre> <code class="hljs lisp">GREAT_THAN(<span class="hljs-name"><span class="hljs-name">LEN</span></span>(<span class="hljs-name"><span class="hljs-name">readNumberToCall</span></span>.Result),<span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br>  If the condition is fulfilled, the <b>CallIndexHolder.cs</b> script is <b>executed</b> , increasing the <b>callindex</b> variable, and the <b>Make Call</b> component makes the call.  The <b>Make Call</b> component is configured as shown below: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/15a/e8b/bfa/15ae8bbfabd67d97d571725e2d87d63f.png"><br><br>  He makes a call from the extension of Queue 800 (to which operators 201, 202 and 203 are connected) to the number read from the text file. <br><br>  Pay attention to the general view of the <b>yesMakeCall</b> branch after adding all the necessary components. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ceb/9b0/a57/ceb9b0a575840969df93a5f901cf2208.png"></div><br><h2>  Compiling and installing the application on the 3CX server </h2><br>  Voice application is ready!  Now it should be compiled and uploaded to the 3CX server.  For this: <br><br><ul><li>  Go to <b>Build&gt; Build All</b> , and CFD will create the <b>OutboundDialerDemo.tcxvoiceapp</b> file. <br></li><li>  Go to the 3CX management interface, in the <b>Call Queues</b> section.  Create a new Call Queue, specify the name and extension number of the Queue, and then set the <b>Voice Applications</b> option and download the compiled file. <br></li><li>  Save your changes to the Call Queue.  Voice application is ready to use. <br></li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/2d8/6c0/dd1/2d86c0dd18d0e2a0f758e4acac81e2d7.png"></div><p>Source: <a href="https://habr.com/ru/post/336528/">https://habr.com/ru/post/336528/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../336518/index.html">What to expect from Apple: the main thing about iOS, macOS, Watch 3, iPhone 8</a></li>
<li><a href="../336520/index.html">DevOps Evolution</a></li>
<li><a href="../336522/index.html">Who are all these people? Let's ask K50</a></li>
<li><a href="../336524/index.html">As a rule of thumb, ‚Äúwinner takes all‚Äù works and does not work in development.</a></li>
<li><a href="../336526/index.html">Why with NDFLka.ru you will love the queue</a></li>
<li><a href="../336530/index.html">Self-sufficient controls on Xamarin.Forms. Part 3. We understand with NuGet</a></li>
<li><a href="../336532/index.html">Do yourself and the company a service: reduce the meeting by 2 times</a></li>
<li><a href="../336540/index.html">Managing the development of technologically complex Internet applications in the context of an acute shortage of time</a></li>
<li><a href="../336542/index.html">3 main process of working with clients, which should automate the CRM system. How not to miss with a choice. Part 1</a></li>
<li><a href="../336550/index.html">Perl Script to help HTML coder</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>