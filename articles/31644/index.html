<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Integration of Zend_Acl and MVC. Part 2 (advanced use)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The second part of the article about introducing Zend_Acl in MVC by Aldemar Bernal appeared on DevZone and I hasten to offer you its translation. 

 I...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Integration of Zend_Acl and MVC. Part 2 (advanced use)</h1><div class="post__text post__text-html js-mediator-article">  <em>The <a href="http://devzone.zend.com/article/3510-Zend_Acl-and-MVC-Integration-Part-II-Advanced-Use">second part of the article about introducing Zend_Acl in MVC by</a> Aldemar Bernal appeared <a href="http://devzone.zend.com/article/3510-Zend_Acl-and-MVC-Integration-Part-II-Advanced-Use">on DevZone</a> and I hasten to offer you its translation.</em> <br><br>  In the <a href="http://devzone.zend.com/article/3509-Zend_Acl-and-MVC-Integration-Part-I-Basic-Use">first part,</a> we talked about how to set up an instance of Zend_Acl and include it in the MVC environment (using the front controller plugin).  But how to configure other actions to block access, or how to make editing the article only by its author?  This and something else will be discussed further. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As I said in the first part, this article is based on the following <a href="http://framework.zend.com/wiki/pages/viewpage.action%3FpageId%3D39025">sentence</a> , which is currently in the research stage. <br><br><h3>  1. Using Modules </h3><br>  Let's talk about the modules.  As an example for this article, we took a site like DevZone.  And what if we create an administrative module whose task is to implement the procedure for approving articles.  In addition, the module can implement a number of tasks, such as managing short links or categories.  In this case, we will have to change our resource model: <br><br>  <strong>Common module</strong> <br><ol><li>  User Controller. </li><li>  Controller articles. </li></ol><br>  <strong>Administrative module</strong> <br><ol><li>  Controller articles. </li><li>  Controller short links. </li><li>  Category controller. </li></ol><br>  Based on this new resource model, we will create an instance of Zend_Acl that will reflect it. <br><br>  <strong>Note</strong> : Remember that this code and the creation of an instance of a Zend_Acl object must be executed before calling the front controller's dispatch method (at boot time). <br><pre>  / ** Creating Roles * /
 require_once 'Zend / Acl / Role.php';
 $ myAcl-&gt; addRole (new Zend_Acl_Role ('guest'))
       -&gt; addRole (new Zend_Acl_Role ('writer'), 'guest')
       -&gt; addRole (new Zend_Acl_Role ('admin'), 'writer');

 / ** Creating resources * /
 require_once 'Zend / Acl / Resource.php';
 / ** Default module * /
 $ myAcl-&gt; add (new Zend_Acl_Resource ('user'))
       -&gt; add (new Zend_Acl_Resource ('article'));

 / ** Admin module * /
 $ myAcl-&gt; add (new Zend_Acl_Resource ('admin'))
       -&gt; add (new Zend_Acl_Resource ('admin: article', 'admin'))
       -&gt; add (new Zend_Acl_Resource ('admin: quick-link', 'admin'))
       -&gt; add (new Zend_Acl_Resource ('admin: category', 'admin'));

 / ** Creating permissions * /
 $ myAcl-&gt; allow ('guest', 'user')
       -&gt; deny ('guest', 'article')
       -&gt; allow ('guest', 'article', 'view')
       -&gt; allow (array ('writer', 'admin'), 'article', array ('add', 'edit'))
       -&gt; allow ('admin', 'admin');

 / ** Setting up the front controller * /
 require_once 'Zend / Controller / Front.php';
 $ front = Zend_Controller_Front :: getInstance ();
 $ front-&gt; setControllerDirectory (array ('default' =&gt; 'path / to / default / controllers',
                                      'admin' =&gt; 'path / to / admin / controllers'));

 / ** Registering the Plugin object * /
 require_once 'Zend / Controller / Plugin / Acl.php';
 $ front-&gt; registerPlugin (new Zend_Controller_Plugin_Acl ($ myAcl, 'guest')); 

 / ** Dispatching the front controller * /
 $ front-&gt; dispatch (); </pre><br><br>  I note that, as before, we have created a resource for each controller.  But in the case of the administrator module, we created a resource for the module and one for each controller inside this module in the ‚Äúmodule: controller‚Äù format, making them descendants of the module resource.  We also made the Administrator role the only one allowed access to the entire administration module. <br><br><h3>  2. Using roles </h3><br>  Once the user has entered the application, he should get the role.  In our example, this role can be ‚Äúguest‚Äù, ‚Äúauthor‚Äù, or ‚Äúadministrator‚Äù.  But how can we change the current ACL role in our component?  First, you must save this role in a variable that is in session space.  Thus, as soon as the user logs in, you must save the user role in the session.  On the next request, you will take this variable from the session and use it to configure the front controller plug-in during the boot phase. <br><br>  <strong>User Controller</strong> <br><pre>  class UserController extends Zend_Controller_Action
 {
     protected $ _application;

     public function init ()
     {
         require_once 'Zend / Session / Namespace.php';
         $ this -&gt; _ application = new Zend_Session_Namespace ('myApplication');
     }

     public function loginAction ()
     {
         ... Validation code
         if ($ valid) {
             / ** Setting role into session * /
             $ this -&gt; _ application-&gt; currentRole = $ user-&gt; role;
             $ this -&gt; _ application-&gt; loggedUser = $ user-&gt; username;
         }
     }

     public function logoutAction ()
     {
         $ this -&gt; _ application-&gt; currentRole = 'guest';
         $ this -&gt; _ application-&gt; loggedUser = null;
     }
 } </pre><br>  <strong>Loader file</strong> <br><pre>  / ** Loading application from session * /
 require_once 'Zend / Session / Namespace.php';
 $ application = new Zend_Session_Namespace ('myApplication');

 if (! isset ($ application-&gt; currentRole)) {
     $ application-&gt; currentRole = 'guest';
 }

 / ** Setting up the front controller * /
 require_once 'Zend / Controller / Front.php';
 $ front = Zend_Controller_Front :: getInstance ();
 $ front-&gt; setControllerDirectory ('path / to / controllers'); 

 / ** Registering the Plugin object * /
 require_once 'Zend / Controller / Plugin / Acl.php';
 $ front-&gt; registerPlugin (new Zend_Controller_Plugin_Acl ($ myAcl, $ application-&gt; currentRole));

 / ** Dispatching the front controller * /
 $ front-&gt; dispatch (); </pre><br><br><h3>  3. Setting the action for the error "access denied" </h3><br>  Maybe some of you (I hope no one = D) just do not like the idea of ‚Äã‚Äãhaving the ‚ÄúAccess Denied‚Äù action in the error controller, or just want to call it something else.  This can be done by calling the front controller plugin's setErrorPage method. <br><br><pre>  / ** Setting up the front controller * /
 require_once 'Zend / Controller / Front.php';
 $ front = Zend_Controller_Front :: getInstance ();
 $ front-&gt; setControllerDirectory ('path / to / controllers'); 

 / ** Setting default access denied action * /
 require_once 'Zend / Controller / Plugin / Acl.php';
 $ aclPlugin = new Zend_Controller_Plugin_Acl ($ myAcl, 'guest');
 $ aclPlugin-&gt; setErrorPage ('goaway', 'my-error-controller', 'my-module'); 

 / ** Registering the Plugin object * /
 $ front-&gt; registerPlugin ($ aclPlugin); 

 / ** Dispatching the front controller * /
 $ front-&gt; dispatch (); </pre><br>  The setErrorPage method can be called with only the name of the action.  In this case, the controller and the module will remain ‚Äúerror‚Äù and ‚Äúdefault‚Äù.  The same method can be called by passing the names of the action and the controller, or by passing all three parameters. <br><br><h3>  4. Using the action helper </h3><br>  Finally, we will see one of the most important parts of this sentence.  Until now, in our DevZone example, we have seen that we allow administrators and authors to edit articles.  But wait, there is still a missing part of our application.  Now, if I am an author and have access to article / edit /: id, this means that I have access to editing not only my articles, but also articles of other authors!  This is not very good, is it?  So what are we going to do about it?  We will manage this using an action helper, which means that you can access our ACLs within any controller, and not just at boot time. <br><br>  So, the first thing we do is register not only our front controller controller plugin, but also our action assistant in the Broker of action controller assistants. <br><br>  <strong>Loader file</strong> <br><pre>  / ** Loading application from session * /
 require_once 'Zend / Session / Namespace.php';
 $ application = new Zend_Session_Namespace ('myApplication');

 if (! isset ($ application-&gt; loggedUser)) {
     $ application-&gt; loggedUser = null;
 }

 / ** Setting up the front controller * /
 require_once 'Zend / Controller / Front.php';
 $ front = Zend_Controller_Front :: getInstance ();
 $ front-&gt; setControllerDirectory ('path / to / controllers'); 

 / ** Registering the Plugin object * /
 require_once 'Zend / Controller / Plugin / Acl.php';
 $ front-&gt; registerPlugin (new Zend_Controller_Plugin_Acl ($ myAcl, $ application-&gt; currentRole)); 

 / ** Registering the Action Helper object * /
 require_once 'Zend / Controller / Action / Helper / Acl.php';
 require_once 'Zend / Controller / Action / HelperBroker.php';
 Zend_Controller_Action_HelperBroker :: addHelper (new Zend_Controller_Action_Helper_Acl ()); 

 / ** Dispatching the front controller * /
 $ front-&gt; dispatch (); </pre><br>  And after registering an assistant, we can use it inside any controller.  Let's give change access rights only to the owner or any administrator. <br><br>  <strong>Article controller</strong> <br><pre>  class ArticleController extends Zend_Controller_Action
 {
     protected $ _acl;
     protected $ _application;

     public function init ()
     {
         / ** Get our Action Helper * /
         $ this -&gt; _ acl = $ this -&gt; _ helper-&gt; getHelper ('acl'); 

         require_once 'Zend / Session / Namespace.php';
         $ this -&gt; _ application = new Zend_Session_Namespace ('myApplication');
     } 

     ...

     public function editAction ()
     {
         / ** Load article by id * /
         $ article = new Article ($ this -&gt; _ request-&gt; id);

         / ** Validate if Admin
         if (($ article-&gt; author! = $ this -&gt; _ application-&gt; loggedUser)
              &amp;&amp; ($ this -&gt; _ application-&gt; currentRole! = 'admin')) {
             $ this -&gt; _ acl-&gt; denyAccess ();
         } 

         ...
     }
 } </pre><br><br><h3>  Conclusion </h3><br>  Some lovers of garbage in the trash all their lives trying to find the missing link (and they will die in the search for it) and some ZF-eryy old in trying to get the ACL to work properly in their MVC environment.  I hope the proposal expressed above may be one of the missing pieces in the world of ACL + MVC. <br><br>  In conclusion, I want to give a recommendation.  Adhere to the principle ‚ÄúMake it easier‚Äù: if you don‚Äôt need to have a dynamic ACL load, then manually loading and configuring it is not at all a sin, perhaps this is the best way to act in this situation. <br><br>  For more information on the topic, you can read the following: <br>  <a href="http://framework.zend.com/wiki/pages/viewpageattachments.action%3FpageId%3D39025">Zend_Acl &amp; MVC Integration</a> <br>  and a small example of the implementation of the approach described in the article: <br>  <a href="">Source code</a> <br><br>  Crosspost: <a href="http://lobach.info/develop/zf/zend_acl-and-mvc-integration-part-2/">http://lobach.info/develop/zf/zend_acl-and-mvc-integration-part-2/</a> </div><p>Source: <a href="https://habr.com/ru/post/31644/">https://habr.com/ru/post/31644/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../316430/index.html">The implementation of the protocol MIL-STD-1553 on STM32</a></li>
<li><a href="../316432/index.html">Three simple tips to help improve your icon design.</a></li>
<li><a href="../316434/index.html">7 tips on how to increase the likelihood that subscribers will open your e-mail</a></li>
<li><a href="../316436/index.html">‚ÄúChaos in the .NET world is a reasonable price for the speed of platform development‚Äù: an interview with Andrei Akinshin (JetBrains)</a></li>
<li><a href="../316438/index.html">Domain-Driven Design: strategic design. Part 1</a></li>
<li><a href="../316440/index.html">Attackers send phishing SMS messages on behalf of Apple</a></li>
<li><a href="../316444/index.html">ee javascript (run ReactOS in browser)</a></li>
<li><a href="../316448/index.html">Learning the gameplay cycle on the example of runners</a></li>
<li><a href="../31645/index.html">Love without copyright</a></li>
<li><a href="../316450/index.html">Overview of conferences we attended in 2016</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>