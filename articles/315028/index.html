<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Networks for the harshest. Part twelfth. MPLS L2VPN</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="How long is it short, but the gears were once again turned around and the linkmeup got up to Tier 2 level. And several sufficient solvency of enterpri...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Networks for the harshest. Part twelfth. MPLS L2VPN</h1><div class="post__text post__text-html js-mediator-article">  How long is it short, but the gears were once again turned around and the linkmeup got up to Tier 2 level. And several sufficient solvency of enterprises showed interest in organizing communication between their branches through the linkmeup network. <br><br>  L3VPN, which we reviewed in the last release, covers a huge number of scenarios that most customers need.  Huge, but not all.  It allows communication only at the network level and for only one protocol - IP.  How to deal with telemetry data, for example, or traffic from base stations operating via the E1 interface?  There are also services that use Ethernet, but also require communication on the data link layer.  Again, data centers love to communicate in the L2 language. <br><br>  Here and our customers take out and put L2. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Traditionally, before everything was simple: L2TP, PPTP and all, by and large.  Well, in the GRE it was still possible to hide Ethernet.  For everything else, they built separate networks, led dedicated lines at the cost of a tank (monthly). <br><br>  However, in our century of convergent networks, distributed data centers and international companies, this is not a way out, and a number of scalable channel-based Wi-Fi technologies have spilled onto the market. <br><br>  This time we will focus on MPLS L2VPN. <br><br><img src="https://habrastorage.org/files/eae/117/c69/eae117c6959a468186bbaf65bad18639.jpg" width="800"><br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">So, today in the program:</b> <div class="spoiler_text"><ul><li>  About L2VPN technology </li><li>  VPWS <br><ul><li>  Data plane </li><li>  Control plane </li><li>  Practice </li><li>  Types of VPWS </li></ul><br></li><li>  VPLS <br><ul><li>  Data plane </li><li>  Control plane </li><li>  VPLS Martini Mode (targeted LDP) <br><ul><li>  Practice </li></ul><br></li><li>  VPLS Kompella Mode (BGP) <br><ul><li>  Neighbor Discovery or Auto-Discovery </li><li>  Pass Prefixes </li><li>  Label Block Label Distribution and Mechanism </li><li>  Practice </li></ul><br></li></ul><br></li><li>  Hierarchical VPLS (H-VPLS) <br><ul><li>  Practice H-VPLS </li></ul><br></li><li>  VPLS problems </li><li>  useful links </li></ul><br></div></div><br><br><h3>  L2VPN technology </h3><br>  Before diving into the warm MPLS, take a look at what types of L2VPNs exist at all. <br><br><ul><li>  <b>VLAN / QinQ</b> - they can be attributed here, since the basic requirements of a VPN are fulfilled - a virtual L2 network between several points is organized, the data of which are isolated from others.  Essentially, VLAN per-user organizes Hub-n-Spoke VPN. </li><li>  <b>L2TPv2 / PPTP</b> - obsolete and boring things. </li><li>  <b>L2TPv3</b> along with <b>GRE</b> have problems scaling. </li><li>  <b>VXLAN, EVPN</b> - options for data centers.  Very interesting, but DCI is not included in the plans for this release.  But there was a separate podcast about them (listen to the recording on November 25th) </li><li>  <b>MPLS L2VPN</b> is a set of various technologies for which MPLS LSP is used.  It is he who is now the most widely spread in the networks of providers. </li></ul><br>  Why is he a winner?  The main reason, of course, is the ability of routers that transmit MPLS packets to abstract from their contents, but at the same time distinguish traffic from different services. <br><br>  For example, an E1 frame comes to PE, is immediately encapsulated in MPLS, and no one along the way will even suspect that there is inside - it is only important to change the label in time. <br><br>  And the Ethernet frame comes to another port and it can go over the network using the same LSP, only with a different VPN label. <br>  In addition, MPLS TE allows you to build channels based on traffic requirements for network parameters. <br><br>  In conjunction with LDP and BGP, it becomes easier to configure VPN and automatically find neighbors. <br><br>  The ability to encapsulate traffic of any data link layer in MPLS is called <b>AToM</b> - <u>Any Transport over MPLS</u> . <br><br>  Here is a list of AToM supported protocols: <br><br><ul><li>  ATM Adaptation Layer Type-5 (AAL5) over MPLS </li><li>  ATM Cell Relay over MPLS </li><li>  Ethernet over MPLS </li><li>  Frame Relay over MPLS </li><li>  PPP over MPLS </li><li>  High-Level Data Link Control (HDLC) over MPLS </li></ul><br><hr><br><h5>  Two worlds L2VPN </h5><br>  To build any L2VPN there are two conceptually different approaches. <br><br><ul><li>  <u><b>Point-to-Point</b></u> .  Apply to any types of data link layer protocols and, in principle, fully exhaust all L2VPN application scenarios.  Supports all conceivable and inconceivable protocols.  Moreover, some of them <a href="https://www.ietf.org/rfc/rfc4717.txt">can also be implemented</a> in different ways. <br>  It is based on the concept of PW - PseudoWire - pseudowire. <br><br>  You want to connect two nodes with each other.  Then the provider‚Äôs network for you will be like one virtual cable - what entered it at one end is sure to come out on the other without any changes. <br><br>  The general name of the service: <b>VPWS</b> - <u>Virtual Private Wire Service</u> . <br><br><img src="https://habrastorage.org/files/489/144/e71/489144e715634e0c9f55e1045751a439.png"><br></li><li>  <u><b>Point-to-Multipoint</b></u> .  This mode is only for Ethernet, because only in it there is actually such a need.  In this case, the client may have three to five to ten to one hundred connection points / branches, and all of them must transfer data to each other, and both to one specific branch and to all at once.  This is painfully <a href="">reminiscent of a regular Ethernet switch</a> , but it would be terrible to talk about it. <br><br>  Technology Name: <b>VPLS</b> - <u>Virtual Private LAN Service</u> . <br><img src="https://habrastorage.org/files/e11/5f4/d76/e115f4d76dba4d9d834c9f05461f2a75.png"><br></li></ul><br><hr><br><h5>  Terminology </h5><br>  Traditionally, terms will be entered as needed.  But about some at once. <br><br>  <b>PE</b> - <u>Provider Edge</u> - provider's MPLS network edge routers to which client devices (CE) are connected. <br>  <b>CE</b> - <u>Customer Edge</u> - customer equipment that directly connects to the provider's routers (PE). <br>  <b>AC</b> - <u>Attached Circuit</u> - PE interface for client connection. <br>  <b>VC</b> - <u>Virtual Circuit</u> is a virtual unidirectional connection through a common network that simulates the original environment for the client.  Connects to each other AC-interfaces of different PE.  Together they make up a one-piece channel: AC ‚Üí VC ‚Üí AC. <br>  <b>PW</b> - <u>PseudoWire</u> - a virtual bidirectional data link between two PEs - consists of a pair of unidirectional VCs.  This is the difference between PW and VC. <br><br><img src="https://habrastorage.org/files/579/f80/02c/579f8002c6544a3ba45244baa3e5f4ec.png"><br><hr><br><br><h1>  VPWS.  Point to point </h1><br>  <b>VPWS</b> - <u>Virtual Private Wire Service</u> . <br><br>  At the heart of any MPLS L2VPN solution is the idea of ‚Äã‚ÄãPW - PseudoWire - a virtual cable that is routed from one end of the network to the other.  But for VPWS, this PW itself is already a service. <br><br>  A kind of L2-tunnel through which you can safely pass anything you want. <br><br>  Well, for example, the client has a 2G base station in Kotelniki, and a controller in Mitino.  And this BS can only connect via E1.  In ancient times, I would have to stretch this E1 with the help of cable, radio circuits and all kinds of converters. <br><br>  Today, one common MPLS network can be used for both E1 and L3VPN, the Internet, telephony, television, and so on. <br><br>  <i>(Someone will say that instead of MPLS for PW, you can use L2TPv3, but who needs it with its scalability and lack of Traffic Engineering?)</i> <br><br>  VPWS is relatively simple, both in terms of traffic transmission and the work of service protocols. <br><br><h2>  VPWS Data Plane or user traffic transmission </h2><br><br><img src="https://habrastorage.org/files/acb/a47/d41/acba47d41cdd4bd5be609823a10745d4.png"><br>  <i>The tunnel tag is the same as the transport tag, just the long word ‚Äútransport‚Äù did not fit into the heading.</i> <br><br>  <b>0.</b> A transport LSP is already built between R1 and R6 using the LDP or RSVP TE protocol.  That is, R1 is known transport label and output interface to R6. <br><br>  <b>1.</b> R1 receives from the client CE1 some L2 frame on the AC interface (it may be Ethernet, TDM, ATM, etc. - it does not matter). <br><br>  <b>2.</b> This interface is tied to a specific client identifier ‚Äî the VC ID ‚Äî in a sense, an analog of the VRF in L3VPN.  R1 gives the frame a service tag, which remains unchanged until the end of the path.  The VPN label is internal to the stack. <br><br>  <b>3.</b> R1 knows the destination point - the IP address of the remote PE router is R6, finds out the transport label and inserts it into the MPLS label stack.  It will be external - transport label. <br><br>  <b>4.</b> An MPLS packet travels through the operator‚Äôs network through P-routers.  The transport tag is changed to a new one at each node, the service tag remains unchanged. <br><br>  <b>5.</b> On the penultimate router, the transport tag is removed ‚Äî <a href="http://lookmeup.linkmeup.ru/">PHP</a> happens.  R6 comes with a single VPN service tag. <br><br>  <b>6.</b> PE2, having received the packet, analyzes the service tag and determines which interface to transfer the unpacked frame to. <br><br><img src="https://habrastorage.org/files/a19/5a9/98a/a195a998a800472a97d486a8d3ec41a4.gif"><br><br>  If you read the <a href="http://linkmeup.ru/blog/204.html">previous release about L3VPN</a> , then you will not see anything new in the issue of the transmission of user traffic - a pair of MPLS tags and transmission over the transport LSP.  Ingress PE checks which tags to put and which interface to send, P changes the transport label, and Egress PE takes the VPN label to decide which AC interface to send the received frame to. <br><br><br><h2>  VPWS Control Plane or service protocols </h2><br><br><img src="https://habrastorage.org/files/32c/252/5e4/32c2525e405544ec96be3fe56991f8fb.png"><br><br>  <b>The transport label</b> can be assigned as LDP (see the <a href="http://linkmeup.ru/blog/154.html">MPLS release</a> ), and RSVP-TE (still waiting in the wings). <br><br>  For example, take LDP ‚Äî this protocol is launched across the entire network, which for each Loopback address of each MPLS router will distribute tags over the network. <br><br>  In our case, R1 after LDP operation will, roughly speaking, know 5 tags: how to get to each of the remaining routers. <br><br>  We are interested in LSP R1 ‚Üí R6 and back.  Note that in order for the VC to transition to the UP state, both LSPs must be forward and reverse. <br><br>  There are several different ways to implement a VPWS service.  We will talk about this below, and for example we will analyze the one that is most often used now. <br><br>  For the distribution of <b>service tags</b> is the same LDP, only genetically modified - <b><u>Targeted LDP</u></b> .  Now he can establish a connection with remote routers and exchange tags with them. <br><br>  In our example, clients are connected to R1 and R6.  R1 through LDP will report its label to this R6 client and vice versa. <br><br>  At both ends, we manually configure a remote LDP session.  It is not tied to the VPN.  That is, the same session can be used to exchange tags with any amount of VPN. <br><br>  A regular LDP is a link-local protocol and looks for neighbors among directly connected routers, that is, the TTL of its packets is 1. However, tLDP has sufficient IP connectivity. <br><br>  As soon as AC-interfaces with the same VC-ID appear on both sides, the LDP will help them communicate the tags to each other. <br><br>  What is the difference between tLDP and LDP? <br><table border="1"><tbody><tr><td>  <b>LDP</b> </td><td>  <b>tTLDP</b> </td></tr><tr><td>  Only directly connected routers can be neighbors. </td><td>  A neighbor in the network with which there is IP connectivity can be a neighbor. </td></tr><tr><td>  Search all possible neighbors </td><td>  Neighbors already defined by configuration. </td></tr><tr><td>  Discovery message broadcast </td><td>  Address sending a Discovery message to specific neighbors. </td></tr><tr><td>  The FEC is usually the IP address. </td><td>  VC ID is usually FEC. </td></tr></tbody></table><br>  In order not to run far away, immediately practice. <br><br><blockquote><h2>  How to build a lab for MPLS L2VPN? </h2><br>  UnetLab + CSR1000V bundle was used as a test bench.  Both of these can be obtained absolutely free and legal. <br>  <a href="http://www.unetlab.com/download/index.html">UnetLab OVA</a> . <br>  <a href="https://software.cisco.com/download/release.html%3Fmdfid%3D284364978%26softwareid%3D282046477">Cisco CSR1000V IOS-XE</a> . <br>  Instructions for installing UNL and adding images CSR1000V: Tyts. <br><br>  Accordingly, all the instructions for configuring MPLS L2VPN are given in Cisco IOS-XE notation. <br><br>  <i>Note: each CSR1000V node requires 2.5 GB of RAM.</i>  <i>Otherwise, the image will either not start, or there will be various problems, such as the fact that ports do not rise or losses are observed.</i> </blockquote><br><br><h2>  VPWS practice </h2><br>  Simplify the topology to four trunk nodes.  By clicking, you can open it in a new tab, to look at it with Alt + Tab, rather than turning the page up and down. <br><br> <a href=""><img src="https://habrastorage.org/files/092/3d4/7c1/0923d47c162d4e6b8732a6ae4d385d60.png"></a> <br><br>  Our task is to run Ethernet from Linkmeup_R1 (port Gi3) to Linkmeup_R4 (port Gi3). <br><br>  In step <b>0,</b> IP addressing, IGP routing, and basic MPLS are already configured (see <a href="http://linkmeup.ru/blog/154.html">how</a> ). <br><blockquote>  <a href="https://docs.google.com/document/d/1_o0-Fu0_g1JGCfxGQuDWrIVzaNFRbVPUpDXdk_Rvvdo/pub">Initial configuration file.</a> <br></blockquote><br><ol><li>  We configure xconnect at both ends on AC interfaces (PE-CE), note that the VC-ID must be the same. <br><br><pre><code class="cpp hljs">Linkmeup_R1(config)<span class="hljs-meta"><span class="hljs-meta">#interface Gi 3 Linkmeup_R1(config-</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">)#xconnect 4.4.4.4 127 encapsulation mpls</span></span></code> </pre> <br><pre> <code class="cpp hljs">Linkmeup_R4(config)<span class="hljs-meta"><span class="hljs-meta">#interface Gi 3 Linkmeup_R4(config-</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">)#xconnect 1.1.1.1 127 encapsulation mpls</span></span></code> </pre> <br>  The xconect <b>4.4.4.4 127 encapsulation mpls command</b> causes the LDP to raise the remote session with the 4.4.4.4 node and creates the MPLS PW with VC ID 127. It is important that the VC ID match on the two opposite AC interfaces - this is a pointer to the fact that they need to be spliced. <br><br></li><li>  Profit <br><br><img src="https://habrastorage.org/files/8d0/001/2be/8d00012be9854ac0ab9d4014aaee4d1a.PNG"></li></ol><br><blockquote>  <u><b>This completes the VPWS configuration.</b></u> <br>  <a href="https://docs.google.com/document/d/1snYb6UX2Lmh3oqSINmTBf1A4q8oTDiBCGlHOM7p8kwo/pub">VPWS configuration file</a> . </blockquote><br>  Let's follow what was going on behind the scenes of the protocols (the dump was removed from the GE1 Linkmeup_R1 interface).  There are major milestones: <br><br>  <b>0)</b> IGP converged, LDP identified neighbors, raised the session and distributed transport tags.  As you can see, Linkmeup_R4 allocated a transport label 19 for FEC 4.4.4.4. <br><br><img src="https://habrastorage.org/files/74a/1df/6c0/74a1df6c0dda4bfe9b03b36817512241.PNG"><br><br>  <b>1)</b> But tLDP has begun its work. <br><br>  <b>--BUT.</b>  First, we configured it to Linkmeup_R1 and tLDP began to periodically send its Hello to the address 4.4.4.4 <br><br><img src="https://habrastorage.org/files/b60/b1a/a0e/b60b1aa0e053458ea96796bdb89ca50e.PNG"><br><br>  As you can see, this is a unicast IP packet that is sent from the address of the Loopback interface 1.1.1.1 to the address of the same Loopback of the remote PE - 4.4.4.4. <br><br>  Packed in UDP and transmitted with one MPLS - transport tag - 19. Pay attention to the priority - the EXP field - 6 is one of the highest, since it is a service protocol packet.  We'll talk more about this in the QoS issue. <br><br>  The PW status is still in DOWN, because there is nothing on the back side. <br><br><img src="https://habrastorage.org/files/a52/4bd/9eb/a524bd9eb99644f1b03a363e4d7139f9.PNG"><br><br>  <b>--B.</b>  After setting up xconnect on the Linkmeup_R4 side, immediately Hello and establishing a TCP connection. <br><br><img src="https://habrastorage.org/files/e7e/ed9/87e/e7eed987e2564f75b32859b1c036311c.PNG"><br><br>  At this point, the LDP-neighborhood is established: <br><br><img src="https://habrastorage.org/files/2dd/932/884/2dd932884774462db64883d68423e1d0.png"><br><br>  <b>--AT.</b>  I went exchange tags: <br><img src="https://habrastorage.org/files/4ca/5c9/2ec/4ca5c92ec15f45b2af460c48ad6381ee.PNG"><br><br>  At the very bottom, you can see that the FEC in the case of VPWS is the VC ID that we specified in the xconnect command ‚Äî this is our VPN identifier - <b>127</b> . <br><br>  And just below it, the Linkmeup_R4 tag allocated to it is 0x16 or <b>22</b> in the decimal system. <br><br>  That is, with this message Linkmeup_R4 reported Linkmeup_R1, they say, if you want to transfer a frame to a VPN with VCID 127, then use the service tag 22. <br><br><blockquote>  Here you can also see a bunch of other Label Mapping messages - this LDP shares everything it has gained - information about all the FECs.  It interests us a little, well, and Lilnkmeup_R1 and even more so. </blockquote><br>  Linkmeup_R1 does the same thing - Linkmeup_R4 informs its label: <br><br><img src="https://habrastorage.org/files/c42/8f6/db9/c428f6db9d5c4b99a73cc14f558492e9.PNG"><br><br>  After that, the VCs are raised and we can see the labels and current statuses: <br><br><img src="https://habrastorage.org/files/7cc/231/289/7cc2312893174c6db8a66743b1f2b3ac.PNG"><br><br><img src="https://habrastorage.org/files/580/8c0/85b/5808c085bf5944078bea6edf15e9554d.png"><br><br>  The <b>show mpls l2transport vc detail</b> and <b>show l2vpn atom vc detail commands are</b> generally identical for our examples. <br><br>  <b>2)</b> Next, the neighbors will only maintain contact: <br><br><img src="https://habrastorage.org/files/956/bf1/2a8/956bf12a86b748a8b5b3acf7fe75ad90.PNG"><br><br>  <b>3)</b> Now everything is ready to transfer user data.  At this moment we launch ping.  Everything is predictable simply: two tags that we have already seen above. <br><br><img src="https://habrastorage.org/files/3ba/420/987/3ba4209872ce4807aa0b0b2239ba1e04.PNG"><br><br><blockquote>  For some reason, Wireshark did not understand the inside of MPLS, but I'll show you how to read the attachment: <br><br><img src="https://habrastorage.org/files/bda/b21/bc8/bdab21bc884a40deba3f8bb2af30f8ba.png"><br><br>  The two blocks highlighted in red are the MAC addresses.  DMAC and SMAC respectively.  The yellow block 0800 ‚Äî the Ethertype field of the Ethernet header ‚Äî means within IP. <br><br>  Next, the black block 01 - the Protocol field of the IP header is the ICMP protocol number.  And two green blocks - SIP and DIP, respectively. <br><br>  Now you can in Wireshark! </blockquote><br>  Accordingly, ICMP-Reply is returned only with the VPN label, because <a href="http://lookmeup.linkmeup.ru/">PHP</a> has taken the place of Linkmeup_R2 and the transport tag has been removed. <br><br><img src="https://habrastorage.org/files/1aa/f95/c89/1aaf95c89c6b4898a976ec7bcf288308.PNG"><br><br>  If the VPWS is just a wire, then he should calmly transmit a frame with a VLAN tag?  Yes, and for this we do not have to reconfigure anything.  Here is an example of a frame labeled VLAN: <br><br><img src="https://habrastorage.org/files/6d6/7a5/0cc/6d67a50ccf1a4b52adb15a5927bb743c.png"><br><br>  Here you see the Ethertype 8100 - 802.1q and a VLAN tag of 0x3F, or 63 in the decimal system. <br><br>  If we transfer the xconnect configuration to the subinterface with the VLAN indication, then it will terminate this VLAN and send a frame without the 802.1q header to the PW. <br><br><hr><br><br><h2>  Types of VPWS </h2><br>  The considered example is EoMPLS (Ethernet over MPLS).  It is part of the PWE3 technology, which is the essence of the development of VLL Martini Mode.  And all this together is VPWS.  The main thing is not to get lost in the definitions.  Let me be your guide. <br><br>  So, <b>VPWS</b> is the common name for point-to-point solutions for L2VPN. <br><br>  <b>PW</b> is a virtual L2 channel that underlies any L2VPN technology and serves as a tunnel for data transmission. <br><br>  <b>VLL</b> (Virtual Leased Line) is already a technology that allows you to encapsulate frames of various data link layer protocols in MPLS and transfer them through the provider's network. <br><blockquote>  There are the following types of VLL: <br><br>  <b>VLL CCC</b> - <u>Circuit Cross Connect</u> .  In this case, there is no VPN label, and the transport is manually assigned (static LSP) on each node, including the swap rules.  That is, there will always be only one label per stack, and each such LSP can carry only one VC traffic.  I have never met him in my life.  Its main advantage is that it can provide connectivity between two nodes connected to the same PE. <br><br>  <b>VLL TCC</b> - <u>Translational Cross Connect</u> .  Same as CCC, but allows using different data link layer protocols from different ends. <br><br>  It only works with IPv4.  PE removes the data link header when received, and inserts a new one into the AC interface. <br><br>  Interesting?  Start <a href="http://www.juniper.net/techpubs/en_US/junos13.3/information-products/pathway-pages/config-guide-mpls-applications/config-guide-mpls-applications-ccc-tcc.pdf">from here</a> . <br><br>  <b>VLL SVC</b> - <u>Static Virtual Circuit</u> .  The transport LSP is built using conventional mechanisms (LDP or RSVP-TE), and the VPN service tag is manually assigned.  tLDP is not needed in this case.  Cannot provide local connectivity (if two nodes are connected to the same PE). <br><br>  <b>Martini VLL</b> is just about what we dealt with above.  The transport LSP is constructed in the usual way, the VPN labels are distributed by the tLDP.  Beauty!  Does not support local connectivity. <br><br>  <b>Kompella VLL</b> - Transport LSP in the usual way, for distributing VPN tags - BGP (as it should be with RD / RT).  Wow!  Supports local connectivity.  Well, okay. </blockquote><br>  <b>PWE3</b> - <u>Pseudo Wire Emulation Edge to Edge</u> .  Strictly speaking, the scope of this technology is wider than just MPLS.  However, in the modern world in 100% of cases they work in conjunction.  Therefore, PWE3 can be considered as an analogue of Martini VLL with enhanced functionality - LDP + tLDP is also engaged in signaling. <br><br>  Briefly, its differences from Martini VLL can be represented as follows: <br><br><ul><li>  Reports the status of the PW using the LDP Notification message. </li><li>  Supports Multi-Segment PW, when the end-to-end channel consists of several smaller pieces.  In this case, the same PW can become segments for several channels. </li><li>  Supports TDM interfaces. </li><li>  Provides a mechanism for negotiating fragmentation. </li><li>  Other ... </li></ul><br>  Now PWE3 is a de facto standard and it was he who was in the example above. <br><br><blockquote>  I‚Äôm talking about Ethernet everywhere to show the most obvious example.  All that concerns the other channel protocols, it is for self-study, please. <br></blockquote><br><hr><br><br><h1>  VPLS.  Point-to-multipoint </h1><br>  I really like the term point-multipoint.  There is something childish in it, playful.  And this is what we will talk about now. <br><br>  VPLS - Virtual Private LAN Service.  At its core, it is a switch.  The provider connects several customer points to its network at its different ends and provides L2 connectivity.  And now it‚Äôs the task of the provider‚Äôs transport network to take care of correct frame switching, that is, learning MAC addresses. <br><br><h5>  Terminology </h5><br>  VPLS-domain is an isolated L2 virtual network, that is, roughly speaking, one separate L2VPN.  Two different clients - two different VPLS domains. <br><br>  <b>VSI</b> - <u>Virtual Switching Instance</u> .  Virtual switch within one node. <br><br>  For each client (or service) he has his own.  That is, traffic from different VSIs cannot migrate from one to another. <br><br>  Analog <a href="http://lookmeup.linkmeup.ru/">VRF / VPN-instance</a> in L3VPN. <br><br>  In Cisco terms, this is <b>VFI</b> - <u>Virtual Forwarding Instance</u> .  I allow myself to be free to use the terms VPLS-domain, VSI and VFI, sometimes using them as synonyms. <br>  <b>VE</b> - <u>VPLS Edge</u> - PE node, member of the VPLS domain. <br><br><br><h2>  VPLS Data Plane </h2><br>  In general terms, the transmission of user traffic looks the same as for the VPWS case, but a step is added to <b>study MAC</b> 's and check the MAC table during traffic transmission. <br><br><ol><li>  A user frame has arrived at the AC port of the PE router. </li><li>  The PE router looks at the Ethernet header and checks the MAC address of the sender. <br>  A) If it is already in the MAC table of this VSI, PE immediately proceeds to step 3. <br>  B) If this address is not yet present, it writes the corresponding MAC port to the table and also proceeds to step 3. </li><li>  The PE router looks at the Ethernet header and checks the destination MAC address. <br><br>  A) if present in the MAC table of a given VSI: <br><ol><li>  PE is looking for an output interface for a frame with this MAC.  This can be a physical interface or PW. </li><li>  If the destination port is a physical interface, it simply sends to that port. <br>  If it is PW, then add the appropriate label - service.  This label will be unchanged until the end of the path. </li><li>  PW is always a channel between two IP nodes, so knowing the IP address of a remote PE, the local PE extracts the transport PE from the label table and puts it on top of the stack ‚Äî it will change on each P router. </li></ol><br><br>  B) If the MAC address is unknown, then as a decent switch, our PE should perform a frame broadcast over all PEs of a given VSI.  And he does, scoundrel. <br><ol><li>  The local PE makes a list of all the remote PEs of this VSI, and, having made copies of this frame, inserts service tags into them - each with its own. </li><li>  Next to each copy of the frame is also hung a transport label (also its own for each PE). </li><li>  All this bunch of frames sent over the network provider. </li><li>  Also copies of the broadcast frame are sent to the AC interfaces, if any, without MPLS headers. </li></ol><br></li><li>  Remote PE after receiving a frame and unchecking tags (that is, when it has already defined VSI) also acts as a regular switch: <br><br>  A) If the <b>source</b> MAC address is not yet known, add it to the table.  PW for Ingress PE will be specified as the input interface. <br>  B) If the <b>destination</b> MAC address is known to it, it sends the frame to the port behind which it is learned.  An already clean Ethernet frame is being sent, without any MPLS headers. <br>  Q) If this MAC could not be found in the table?  Broadcast to all the AC ports of this VSI.  Note that <b>PE will not send this frame to the PW of this VSI</b> , because all other PEs have already received a copy of this frame from the input PE.  This is all the same split-horizon rule (Split Horizon), and so the absence of commutation loops and broadcast storms is achieved.  (Oh, if everything was so simple ...) </li></ol><br><blockquote>  There is just a <a href="">hyphae</a> , which shows what is happening.  And there is the same hyphae, only with a voice. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/TpDZ0r8XcHw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></blockquote><br><br>  As in a conventional switch, the records in the MAC table of the VSI periodically fade and delete. <br><br>  When it comes to learning MAC addresses in the VPLS, there is one thing that makes it very different from L3VPN.  PE should not just know the physical port where the frame came from - it is important to define a neighbor or, more precisely, PW as a virtual interface.  The fact is that the client frame needs to be sent not just to some physical port, but to the correct PW, in other words, to the right neighbor. <br><br>  For this purpose, each neighbor is given a personal tag with which he will send a frame to this PE in this VPLS domain.  And later on the VPN tag, looking at the LFIB, PE finds out which neighbor the frame came from. <br><br>  Let me remind you that L3VPN no matter where the IP packet came from, so the same tag is reported to all neighbors for the prefix in the VRF. <br><br><hr><br>  The delivery scheme for user traffic is straightforward.  But what about the notorious Control Plane?  Again, have to break the brains or small victims? <br><br>  Sorry, but then begins trash and sodomy.  Not immediately - later, but there will be.  You act at your own risk. <br><br><br><h2>  VPLS Control Plane </h2><br>  From the work of Data Plane, it is already clear that VPLS requires a fully connected PE topology for each VSI.  Moreover, not all PE MPLS networks of the provider will be neighbors, but only those with the same VSI. <br><br>  Therefore, one of the main issues in VPLS is the detection of all PEs where the clients of this VSI are connected.  There are two approaches here: <b>manual tuning</b> and <b>automatic detection</b> .  The first way was originally proposed by Cisco (Draft Martini), the father of the second is Juniper (Draft Compell). <br><br>  11 issues SDSM promoted the simplification of the engineer‚Äôs life and the automation of everything.  And so, that moment came when you need to forget everything that you were taught.  This is the first case (if you don‚Äôt raise holivar around VTP) when the solution with manual configuration of the neighbors is more popular. <br>  Became interesting? <br><br>  Before we open the scenes, I want to make a remark: no matter what we get up with VPN tags, transport LSPs are built as usual LDP or RSVP-TE.  Therefore, further we will deal with transport only in passing. <br><br>  Likewise, regardless of the mode used, the VPLS falls apart at a point-to-point PW.  That is, we do not have some kind of centralized cloud switching, but simply a set of virtual lines between all neighbors.  The frame transfer decision is made by Ingress PE or, more simply, selects the desired PW. <br><br><blockquote>  The word "draft", firmly entrenched in these two approaches, has long been illegal and is used by historical inertia.  Draft offer can be only six months. <br><br>  At the moment, the draft-martini has been reborn in RFC 4447 - the Internet standard about PWE3, and the Draft-Compell is outdated and dead. <br>  If we talk specifically about VPLS, then there are two standards: <br><br>  ‚ÄúVirtual Private LAN Service (VPLS) Using BGP for Auto-discovery and Signaling‚Äù.  <a href="https://tools.ietf.org/html/rfc4761">RFC 4761</a> . <br>  ‚ÄúVirtual Private LAN Service (VPLS) Signaling Protocol Distribution Protocol (LDP) Signaling‚Äù <a href="https://tools.ietf.org/html/rfc4762">RFC 4762</a> . <br>  <a href="http://www.networkers-online.com/blog/2009/01/draft-martini-draft-kompella-and-l2vpn-services/">Historical background on methods.</a> <br></blockquote><br><br><h2>  VPLS Martini Mode (LDP) </h2><br>  At the beginning of the two thousandth industry strenuously took up the search for solutions for L2VPN across the operator.  The criteria were as follows: <br><br><ul><li>  Ease of implementation (obvious requirement) </li><li>  On existing hardware (protocols should not require hardware revision) </li><li>  Support for existing protocols on the networks of operators. </li><li>  The principle of operation of the new mechanism should not be radically different from the existing models. </li></ul><br>  Luca Martini - a former Cisco employee - provided this unannounced tender with an LDP-based solution. <br>  It will work over the MPLS network. <br><br>  Label signaling will use LDP, which is already part of MPLS.  VPLS Martini Mode is described in <a href="https://tools.ietf.org/html/rfc4762">RFC4762</a> standard. <br><br>  It is this laconic solution that has become the de facto standard in most networks around the world.  We already met about how the Martini-mode works in the part about VPWS.  Exactly the same here, only remote LDP sessions are created for each VSI, not with one neighbor, but with several. <br><br>  LDP is used to distribute service tags.  Remote sessions with each neighbor in the VPLS domain are configured manually.  Since all the participants of this VPLS are known in advance, each of them has an LDP assigned an individual label in the LDP Label Mapping Message. <br><br>  If a new PE is added to the VPLS domain, you need to configure the LDP neighborhood with all existing PEs of this VPLS.  After that, with each of them a new PE will exchange tags. <br><br>  At all times, the LDP checks the availability of its neighbors.  If one of the neighbors leaves the group or becomes unavailable, the session is broken and all the studied MACs in PW to this neighbor are cleared. <br><br>  If the state of any of the AC ports of the VPLS domain goes to the Down state, or another event occurs that causes the MAC addresses to be cleared from the AC port, then PE notifies all its neighbors by insisting that the MAC addresses be removed in the LDP message MAC Withdraw (Unfortunately, CSR1000V on the test bench does not do this). <br><blockquote>  There are cases when, in the event of a change in the status of an AC port, PE sends a LDP MAC withdraw message without specifying which MACs it is.  This means that each neighbor must clear the entire MAC table of the given VPLS domain. <br><br>  Now imagine that the bill goes to hundreds, perhaps thousands of records.  And across the entire network, all PEs start learning MAC addresses.  And what do they do with the frame when they do not find the recipient MAC?  Send to all.  A short-term broadcast storm occurs without a switching loop. <br><br>  Without a loop yet.  The irony is that such an explosion of Broadcast can clog data transmission channels, especially narrow, for example, RRL.  And then the user data will start to get lost.  And if the priority traffic queues CS6-CS7, in which the protocol packets are transmitted, are clogged, then the STP can break and ERPS close the ring - and quite a real switching loop is formed with an increasing effect. <br><br>  If the VPLS domain is not limited to a small part of the network (and usually this is not so) everything can lie down.  There is no sadder story in the world than the storm in the VPLS network.  Please do not do this. <br><br>  In the end <a href="https://habr.com/ru/post/315028/">I will talk</a> about other unpleasant situations that may arise in the VPLS network. <br></blockquote><br><br><h3>  VPLS practice </h3><br>  Let us analyze the work of the VPLS in practice in steps here according to this scheme.  This is still the same network, but now the client has decided that two points are not enough for him, he wants four and combine them all into one network. <br><br> <a href=""><img src="https://habrastorage.org/files/eab/9cc/5e0/eab9cc5e0b8d4fea892cf5b513764949.png"></a> <br>  <i>Clickable</i> <br><blockquote>  Forgot that we had VPWS service before - this configuration no longer exists.  <a href="https://docs.google.com/document/d/1_o0-Fu0_g1JGCfxGQuDWrIVzaNFRbVPUpDXdk_Rvvdo/pub">Initial configuration file.</a> <br></blockquote><br>  So at step <b>0</b> , we have the necessary transport LSPs ready and, accordingly, the routing and so on. <br><br><ol><li>  Create a VFI - Virtual Forwarding Instance <br><br><pre> <code class="cpp hljs">Linkmeup_R1(config)#<span class="hljs-function"><span class="hljs-function">l2vpn vfi context Blue </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Linkmeup_R1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(config-vfi)</span></span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-meta">#vpn id 63 Linkmeup_R1(config-vfi)#member 3.3.3.3 encapsulation mpls Linkmeup_R1(config-vfi)#member 4.4.4.4 encapsulation mpls</span></span></span></span></code> </pre> <br>  The default mode is LDP signaling.  VPN ID - analogue of VCID from the previous example - unique identifier of VPN.  It must match on all nodes.  The next two teams, we indicate the neighbors <s>that interfere with sleep,</s> which are also members of this VPLS-domain.  Essentially, this is an indication to the LDP to establish a remote session with them, after which it starts sending LDP Hello to the configured neighbors. <br><br><div class="spoiler">  <b class="spoiler_title">Similar commands are executed on Linkmeup_R3 and Linkmeup_R4 ...</b> <div class="spoiler_text"><br><hr><br>  <b>Linkmeup_R3</b> <br><pre> <code class="cpp hljs">Linkmeup_R3(config)#<span class="hljs-function"><span class="hljs-function">l2vpn vfi context Blue </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Linkmeup_R3</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(config-vfi)</span></span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-meta">#vpn id 63 Linkmeup_R3(config-vfi)#member 1.1.1.1 encapsulation mpls Linkmeup_R3(config-vfi)#member 3.3.3.3 encapsulation mpls</span></span></span></span></code> </pre> <br><hr><br>  <b>Linkmeup_R4</b> <br><pre> <code class="cpp hljs">Linkmeup_R4(config)#<span class="hljs-function"><span class="hljs-function">l2vpn vfi context Blue </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Linkmeup_R4</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(config-vfi)</span></span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-meta">#vpn id 63 Linkmeup_R4(config-vfi)#member 1.1.1.1 encapsulation mpls Linkmeup_R4(config-vfi)#member 4.4.4.4 encapsulation mpls</span></span></span></span></code> </pre> <br><hr><br></div></div><br></li><li>  We create Service Instance on AC interfaces. <br><br><pre> <code class="cpp hljs">Linkmeup_R1(config)<span class="hljs-meta"><span class="hljs-meta">#interface gigabitEthernet 3 Linkmeup_R1(config-</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">)#service instance 10 ethernet Linkmeup_R1(config-</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">-srv)#description Blue-A Linkmeup_R1(config-</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">-srv)#encapsulation default</span></span></code> </pre><br><pre> <code class="cpp hljs">Linkmeup_R1(config)<span class="hljs-meta"><span class="hljs-meta">#interface gigabitEthernet 4 Linkmeup_R1(config-</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">)#service instance 12 ethernet Linkmeup_R1(config-</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">-srv)#description Blue-C Linkmeup_R1(config-</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">-srv)#encapsulation default</span></span></code> </pre><br>  In the interface configuration mode, we create a Service Instance - this is the interface binding to the services.  How exactly - set up later.  The Service Instance number is arbitrary - it is locally significant for the interface (as is the case of the classic subinterface). <br><br>  <b>encapsulation <i>default</i></b> means that we grab all the frames indiscriminately (and could choose by the VLAN tag or by the presence of two labels - QinQ, for example), that is, we attach the entire physical interface to the VFI. <br><br><div class="spoiler">  <b class="spoiler_title">I want to know more about Service Instance ...</b> <div class="spoiler_text"><br>  A reasonable question from Occam's razor supporters - why should any service instance - is it not enough just to register a bridge-domain? <br>  The thought is correct, but the service-instance is a ‚Äúnew‚Äù approach to the concept of processing tagged traffic and it is called EVC - Ethernet Virtual Circuit. <br>  Here we will switch to Ethernet switches for a moment to understand the origins of this idea. <br><br>  Traditionally, the VLAN tag has been used both to separate traffic on trunks and to decide on its switching within the device. <br>             802.1q 10,       VLAN 10  ,      .          4094 VLAN (   QinQ). <br>  EVC    ‚Äî  802.1q -      ,        Service instance. <br>   Service-instance ‚Äî                VLAN           . <br><br>  VLAN 10               PW    ,       VLAN 10           VLAN 10    . <br>       10,          xconnect    .    VLAN     . <br><br>   Service Instance       VLAN,        QinQ    CoS.     VLAN,    ,  ,    . <br>  :   xconnect   bridge-domain. <br><br>     - ( GE1/1 <b>.1234</b> )   Service instance       . <br><br> ,          EVC,      : <a href="https://supportforums.cisco.com/document/85231/understanding-ethernet-virtual-circuits-evc"> Cisco</a>  <a href="http://network-lab.ru/ethernet-virtual-circuits/"> </a> . <br></div></div><br></li><li>       AC- (service instance)  VFI.     bridge-domain. <br><br><pre> <code class="cpp hljs">Linkmeup_R1(config)<span class="hljs-meta"><span class="hljs-meta">#bridge-domain 255 Linkmeup_R1(config-bdomain)# member vfi Blue Linkmeup_R1(config-bdomain)# member gigabitEthernet 3 service-instance 10 Linkmeup_R1(config-bdomain)# member gigabitEthernet 4 service-instance 12</span></span></code> </pre> <br>  255  -  (0-4096).       VLAN, .        . <br><br>  <b>member</b>   bridge-domain   .    VFI,   AC- ‚Äî       . <br><br><div class="spoiler"> <b class="spoiler_title">    Bridge-domain...</b> <div class="spoiler_text"><br> Bridge-domain  -       .      brdige-domain   ,       .   VLAN,   .  ,  ,  L2-   .        VPLS. <br></div></div><br><div class="spoiler"> <b class="spoiler_title">  PE...</b> <div class="spoiler_text"><br><hr><br> <b>Linkmeup_R3</b> <br><pre> <code class="cpp hljs">Linkmeup_R3(config)<span class="hljs-meta"><span class="hljs-meta">#interface gigabitEthernet 3 Linkmeup_R3(config-</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">)#service instance 13 ethernet Linkmeup_R3(config-</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">-srv)#description Blue-D Linkmeup_R3(config-</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">-srv)#encapsulation default</span></span></code> </pre> <br><pre> <code class="cpp hljs">Linkmeup_R3(config)<span class="hljs-meta"><span class="hljs-meta">#bridge-domain 255 Linkmeup_R3(config-bdomain)# member vfi Blue Linkmeup_R3(config-bdomain)# member gigabitEthernet 3 service-instance 13</span></span></code> </pre> <br><hr><br> <b>Linkmeup_R4</b> <br><pre> <code class="cpp hljs">Linkmeup_R4(config)<span class="hljs-meta"><span class="hljs-meta">#interface gigabitEthernet 3 Linkmeup_R4(config-</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">)#service instance 11 ethernet Linkmeup_R4(config-</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">-srv)#description Blue-B Linkmeup_R4(config-</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">-srv)#encapsulation default</span></span></code> </pre> <br><pre> <code class="cpp hljs">Linkmeup_R4(config)<span class="hljs-meta"><span class="hljs-meta">#bridge-domain 255 Linkmeup_R4(config-bdomain)# member vfi Blue Linkmeup_R4(config-bdomain)# member gigabitEthernet 3 service-instance 11</span></span></code> </pre> <br></div></div></li></ol><br><blockquote> <u><b>   VPLS Martini Mode .</b></u> <br> <a href="https://docs.google.com/document/d/1ZYF7DncOPMUbpyPybdDu2ONuWhLpSWXvVg2in5KQwZk/pub">  VPLS Martini Mode</a> . <br><blockquote>        VPLS Martini Mode.    ,  .   <b>l2vpn vfi context Blue</b>  <b>l2 vfi Blue</b> .      ,  <b>member</b>   <b>neighbor</b> ,    Bridge-domain     bridge-domain,     vfi       Service instance. <br><br>      <a href="https://docs.google.com/document/d/1qG_j-ncx2V3aBPyDPxWPrOlnkfCJHzx5olZXyx0Ofe8/pub"> a  VPLS Martini Mode</a> . </blockquote></blockquote><br>  What happened? <br><br> <b>1.</b>      LDP    .  LDP    bridge-domain ‚Äî  ,   AC- (    .). <br><br>    Linkmeup_R1  Linkmeup_R3: <br><br><img src="https://habrastorage.org/files/f3e/e1a/b06/f3ee1ab060794e1097d65dc5ea491065.PNG"><br><br> FEC 63 ‚Äî   VPN.   0x18 ( 24). <br><br><img src="https://habrastorage.org/files/4a0/4cc/841/4a04cc841805491096db2674289cece2.png"><br><br>  ,  Linkmeup_R3      VFI AC-,   Linkmeup_R1,    VPN- 24.     ‚Äî 17. <br><br><img src="https://habrastorage.org/files/803/796/92f/80379692f9874af08ce45d644abbcf6d.png"><br><br> ,    Linkmeup_R1    ‚Äî   ,      MAC- . <br><br> <b>2.</b>     Blue-A,    (  Gi1 Linkmeup_R1)    ARP-: <br><br><img src="https://habrastorage.org/files/524/642/108/5246421085224d609f2a26add8787c4b.png"><br><img src="https://habrastorage.org/files/aab/fde/f5a/aabfdef5a18e4197a52399f1cbe3c063.PNG"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since it is broadcast, after it you can see its exact copy with only one difference - VPN and transport tags: </font></font><br><br><img src="https://habrastorage.org/files/af2/fe4/3b9/af2fe43b916046b0ab29dc23b61b3e13.PNG"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">One frame was sent to Linkmeup_R3, the other - to Linkmeup_R4. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In the MAC table we can see the MAC address of the Blue-A node (AABB-CC00-0700) - it is located behind the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GE3.EFP10</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> port </font><font style="vertical-align: inherit;">(Ethernet Flow Point and Service instance </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) - and the MAC corresponding to the IP address 192.168.0.2 (AABB -CC00-0300) - for the Pseudoport </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Blue.100401a</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> interface </font><font style="vertical-align: inherit;">.</font></font><br><br><img src="https://habrastorage.org/files/271/f27/bb3/271f27bb34f74cc0b504514595a56794.png"><br><br><blockquote>  ,    Pseudoport  pseudowire     .   ,   PW  MAC-?  <b>show l2vpn vfi</b>   ,      . <br><br><img src="https://habrastorage.org/files/e7a/d20/440/e7ad204404664b10b2a9f4a75ac28b49.PNG"><br><br>  -     Pseudoport  pseudowire,     . </blockquote><br> ,    .     ‚Äî VPLS   MAC'  PE,        Data Plane. <br><br>    : <br><br><ol><li>  VFI,   VPN ID   PE      . </li><li>  AC-  Service Instance. </li><li>  VFI  Service Instance   Bridge-domain. </li></ol><br>    Martini mode: <br><br><ul><li>    VPN   LDP ( <a href="http://lookmeup.linkmeup.ru/">DU</a> ). </li><li>    ‚Äî  - .    ,          . </li><li>      . (     <a href="https://habr.com/ru/post/315028/"> </a> ‚Äî     ). </li><li>    Martini,  ,   ‚Äî    .        . </li></ul><br><hr><br><br><h2> VPLS Kompella Mode (BGP) </h2><br>       ‚Äî  Juniper.      ,  ,  <a href="http://lookmeup.linkmeup.ru/">MBGP</a> ,   L3VPN,       . <br><br>    ,    VPNv4 ,         VPLS.  Route Target    .  -     ,     Martini Mode. <br><br>   VPLS Kompella-mode ‚Äî VPLS Auto-Discovery,          Martini.     VPLS BGP Signaling. <br><br> Control Plane     : <br><br> ‚Äî   <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Transfer route information and the exchange of tags. </font></font><br><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Neighbor Discovery or Auto-Discovery </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There was nothing new to invent. </font><font style="vertical-align: inherit;">The neighbor discovery scheme already used in L3VPN works great here. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Route Target, which is the Extended Community - the main sign of belonging to a particular VSI. </font><font style="vertical-align: inherit;">Roughly speaking - if the RTs match up - it means in one VSI. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Strictly speaking: If the RT of the received announcement coincides with that configured in VSI, then this VSI wants to know the information from the announcement. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As in L3VPN, you can flexibly organize interaction between different VSIs. </font><font style="vertical-align: inherit;">But so rarely does anyone do.</font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Slightly more </font></font></h5><br>  VSI   RT. <br><br>   BGP  VPLS   Address Family: L2VPN <a href="http://lookmeup.linkmeup.ru/">AFI</a> (25)  VPLS <a href="http://lookmeup.linkmeup.ru/">SAFI</a> (65) <br>        PE,     - VPLS-. ,      VSI. <br><br>   RR,      . <br><br>  BGP   L2-  PE  VSI,   BGP Update    ,     ,       .    ,   L3VPN ‚Äî  vpnv4-    PE. <br><br>   PE   BGP Update,   RT   NLRI    ,     VSI. <br><br>   , PE      VSI.   ‚Äî . <br>     Auto-Discovery. <br><br>     -  ,     VPLS-    ,     -    . <br><br><br><h3>   </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In general, the L2VPN prefix is ‚Äã‚Äãa rather artificial thing - PE, with its BGP Update, rather, reports the fact of its participation in the VPLS domain and the label of this fact. </font><font style="vertical-align: inherit;">But it does not play a big role. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Any addresses, especially MAC, in the NLRI field of the message BGP Update VPLS does not transmit. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remember that learning MAC addresses is a complete Data Plane feature</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, it is still necessary to distinguish between announcements of different VSI, so the familiar Route Distinguisher is also present. </font><font style="vertical-align: inherit;">Usually it is made automatically from the AS number and VPN ID. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, what is passed to the NLRI? </font><font style="vertical-align: inherit;">Only label and RD? </font><font style="vertical-align: inherit;">Not really: </font></font><br><br><img src="https://habrastorage.org/files/415/804/53c/41580453c5e341e7bd8357662e2f2461.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Formally, the prefix is ‚Äã‚Äãan RD + node sequence number in the VPLS domain + </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tag box</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tag distribution </font></font></h3><br>   " <i>     ‚Äî   .       ‚Äî   </i> "?     VPLS Kompella mode    .  PE      ‚Äî       . <br><br>     ,    -    ,    ‚Äî       .      ,     ,    ,       ‚Äî . <br><br><blockquote>  ,       . <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/k7H8fBvSKZ0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></blockquote><br>     ,    : <br><br><ol><li>   VSI  RD  RT ‚Äî      ,   L3VPN.  CSR1000V   ,    . RD     VSI  . RT  - ,   VSI    . RD  RT      BGP Update. <br><br></li><li>   BGP   - L2VPN VPLS,       PE. <br> -     .    ,   Route-Reflector'    ,      RR (     RR)? <br><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Each VSI PE router allocates a block from the label space. </font><font style="vertical-align: inherit;">And this is where the interesting begins. </font><font style="vertical-align: inherit;">The following information is sent to BGP Update from the local PE to the remote:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RD </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> RT </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The sequence number of the node in the VPLS domain. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MPLS Tag Block </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> VE ID </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> VE Block Offset </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> VE block size </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Label base </font></font></li></ul></li></ul></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let me remind you that </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VE</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VPLS Edge</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - the boundary of the network VPLS - PE-router on which VPLS is running. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Before I hit upon all the serious about formulas and values, I consider myself obliged to explain on the fingers in general how it works, because I spent a lot of time and nerves to figure it out.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> I sincerely believe that the RFC is a source of unconditional clarity, but sometimes in the same form in which it is the formula for the equivalence of mass and energy for Newton. </font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When a L2VPN frame arrives at the PE from the MPLS network, you need to know exactly which neighbor it is from ‚Äî it‚Äôs necessary to learn the MAC address, so as in the case of the Martini mode, the basic idea is that each neighbor's PE is in a specific VSI must report a unique tag to see who the frame came from. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Look at this simple picture in more detail: </font></font><br><br><img src="https://habrastorage.org/files/dc6/708/fea/dc6708feacf24a699704d26a1899c0a9.PNG"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let R1 be the main one. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In Kompella mode, R1 does not explicitly pass the label to its neighbors R2 and R3. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Instead, he informs them from which range the labels should be selected to identify the given VC. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Each PE has its own sequence number </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in the VPLS domain. Knowing </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">your</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">number and range of tags, neighbors calculate the outgoing service tag: count </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n-th</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in a row from the beginning. That is, R2 took the second (2), and R3 - the third (3). </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> R2 and R3 communicate their R1 numbers, and it also calculates which incoming service tag will be from R2, which is from R3, counting from the beginning of the range 2 and 3. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Similarly, R2 and R3 define their own ranges and communicate them to each other and R1. And the cycle of calculations is repeated. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In the end, everyone will know the outgoing tags for this VPLS and incoming tags. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">second iteration</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : digging deeper, what kind of matan lies under this simple idea.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The VE ID is manually configured - this is the PE router ID in the VPLS domain (its sequence number). Must be unique within one VSI. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LB</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Label Base</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is the beginning of the range, the first label that can be used. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VBS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VE Block Size</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is the length of the block of tags - or, more simply, the minimum number of tags in this VSI. For Cisco, the default is 10. For Juniper - 8 (may be reduced to 2 or increased). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is what the label set will look like: {LB, LB + 1, .., LB + VBS-1}. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In general, the scheme is simple: </font></font><br><br><img src="https://habrastorage.org/files/c5c/07f/996/c5c07f9969954734a47f9072db830e71.PNG"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VE ID 100-109 is taken from the balda for example</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . This animation shows the process of label distribution on PE1: If PE </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">X</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wants to send traffic to PE1, it must use the appropriate </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">X</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> label </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here's another example for PE5: </font></font><br><br><img src="https://habrastorage.org/files/0c5/788/5fc/0c57885fc0e440acb71fdd33602ddfbf.PNG"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tags are allocated in order ‚Äî the first of the block ‚Äî to the neighbor with the lowest VE-ID. The second - the second largest, and so on. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">That is, such a situation is </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">impossible</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/files/0b9/d86/b07/0b9d86b0793d49caa05625ba87c77256.PNG"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, if the allocated number of labels is small, then the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VBO</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VE Block Offset</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parameter </font><font style="vertical-align: inherit;">- the block offset - </font><font style="vertical-align: inherit;">will help </font><font style="vertical-align: inherit;">. It allows you to create multiple blocks. And those neighbors who did not have enough, tags are distributed on the same principle, but from a new unit, with a new LB. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The required VBO is calculated using the formula: VBO = WHOLE (VE-ID / VBS) * VBS.</font></font><br><br>  ,  VBO ‚Äî     ,   ,      VE.      ‚Äî    ,    ‚Äî   . <br><br>       ,      ,    {LB, LB+1,‚Ä¶ LB+VBS-1},  LB     VBO.      &lt;LB, VBO, VBS&gt; <br><br><img src="https://habrastorage.org/files/11b/31f/0b5/11b31f0b5b4a4e309ffa72d0e775d4cc.png"><br><br>     :   VE ID (VBO+n)   (LB+n). <br><br> <b> </b> ‚Äî   . <br><br>     . VBS    ‚Äî 10. VE-ID   : PE1 ‚Äî 101, PE2-102,‚Ä¶ PE 10 ‚Äî 110.     PE1  PE5. <br><br> <b>1.</b> PE1    <u>Label Base 1000</u> ‚Äî   1000-1009 ‚Äî   ,         . <br><br> <b>2.</b> PE1  VBO. <u>VBO=(101/10)*10=100</u> . <br><br> <b>3.</b> PE1      BGP Update   : <u>LB: 1000, VBS:10, VBO:100, VE-ID:101</u> .    RD, RT,     .  PE1      ‚Äî   Update  . <br><br> <b>4.</b> BGP Update  PE1  PE5.  <u>VE-ID: 105</u> .          VSI ( RT     BGP Update)  PE1. <br><br> <b>5.</b> ,   PE5 ‚Äî ,      ,  PE1.     VBO.    VBO ‚â§ PE5 VE-ID ‚â§ VBO+VBS-1.    100‚â§105‚â§109.  I will explain. PE1 ,   ID   100-109 (  100   10) ‚Äî     VE ID         . <br><br> <b>6.</b>  PE5    ,             <u>(PE1 LB + PE5 VE-ID ‚Äî VBO) = (1000 + 105 ‚Äî 100) = <b>1005</b></u> .     , ,   LB    ,     VE-ID  VBO. , PE5,   L2   VSI  PE1   MPLS- VPN- 1005. PE1   ,   1005 ‚Äî    ,    PE5.       VE ID. <br><br> <b>7.</b>  PE5    BGP Update   (,    7  ‚Äî      . PE5   BGP Update     ). <br><br><ul><li>  but.  <u>LB</u> , , <u>5000</u> . </li><li>  b.  <u>VBO = RND(105/10)*10=100</u> . </li><li>  at.  BGP Update. <u>LB: 5000, VBS:10, VBO:100, VE-ID: 105</u> . </li><li> .    PE. </li></ul><br> <b>8.</b>  PE1  VE-ID  ( BGP Update),          VSI.      : <br><br><ul><li>  but.     VBO  VBS: VBO ‚â§ PE1 VE-ID ‚â§ VBO+VBS. 100‚â§101‚â§109.  Fine. </li><li>  b.  <b></b> : <u>(PE1 LB + PE5 VE-ID ‚Äî VBO) = (1000 + 105 ‚Äî 100) = <b>1005</b></u> ‚Äî    ,    PE5   .    PE1     VPN 1005,      ,  VPN       ,      MAC,  . </li></ul><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> But that's not all. </font><font style="vertical-align: inherit;">PE1 should now calculate the outgoing label to PE5. </font><font style="vertical-align: inherit;">And all the data he has for this. </font></font><br><br> <u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(PE5 LB + PE1 VE-ID - VBO) = (5000 + 101 - 100) = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5001</font></font></b></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">That is, when sending frames to this VSI to PE5, PE1 will insert a 5001 VPN tag into them </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. 10.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PE5 calculates incoming: </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(PE5 LB + PE1 VE-ID - VBO) = (5000 + 101 - 100) = </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5001</font></font></b></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is what I call mutual assistance! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unfortunately, quite obvious and at the root of my logical mechanism I can only describe in such a complex language.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you have not yet evolved to understand the mechanism of the Label Block, go back to the </font></font><a href="https://habr.com/ru/post/315028/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">video four screens above</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></blockquote><br>   PE10,         PE.   ,       100-109   <u>VE ID 110</u> .  <u>VBO</u>  <u>110=(110/10)*10</u> .    <u>LB</u>   <u>10000</u> . <br><br>  PE10     PE5,  <b></b> : 110 ‚â§ 105 ‚â§ 119. <br>        . <br><br> <b>1.</b> PE5   <u>LB 5030</u> , <u>VBS</u>   PE10 ‚Äî <u>10</u> . <br> <b>2.</b>     PE10, <br><br><ul><li> . PE5     PE10: <u>(PE10 LB + PE5 VE-ID ‚Äî PE5 VBO) = 5 ‚Äî 100) = <b>10005</b></u> .  ,   <b> VBO</b> . </li><li> .     PE10: (PE5 New LB + PE10 VE-ID ‚Äî PE10 VBO) = (5030 + 110 ‚Äî 110) = <b>5030</b> .   LB  VBO PE10. </li></ul><br> <b>3.</b> PE5  PE10  BGP Update,    :  ‚Äî ,   ‚Äî <u>LB: 5030, VE ID: 105, VBS:10, VBO:110</u> . <br> <b>4.</b> VE-ID PE10        110-119, <br><br><ul><li> .      : <u>(PE5 LB + PE10 VE-ID ‚Äî PE10 VBO) = (5030 + 110 ‚Äî 110) = <b>5030</b></u> .   PE10     VSI  PE5   VPN- 5030. </li><li> .       PE5: <u>(PE10 LB + PE5 VE-ID ‚Äî PE5 VBO) = (10000 + 105 ‚Äî 100) = <b>10005</b></u> .     VBO,    PE5,   PE10. </li></ul><br> <b>5.</b>  PE       ,    PE10.  . <br><br>    Label Block  : <a href="https://kb.juniper.net/library/CUSTOMERSERVICE/technotes/Understanding_VPLS_Label_Blocks_Operation.pdf">Juniper</a> . <br><br>       . -     10    PE (9           ‚Äî     PE). -,  ,    VE-ID, ,     . -,       VE-ID  VE-range!    ,   MPLS    ! <br><br>     ,     ,      LDP  MBGP  L3VPN. <br><br> ,    ,  <a href="https://tools.ietf.org/html/rfc4761">RFC 4761</a> ? <br><blockquote> Using a distinct BGP Update message to send a demultiplexor to each <br> remote PE would require the originating PE to send N such messages <br> for N remote PEs. The solution described in this document allows a <br> PE to send a single (common) Update message that contains <br> demultiplexors for all the remote PEs, instead of N individual <br> messages. Doing this reduces the control plane load both on the <br> originating PE as well as on the BGP Route Reflectors that may be <br> involved in distributing this Update to other PEs. <br></blockquote><br> <i>  ,     Control Plane.</i> <br><br>     ,    .    , ,    ,           ,      . <i>  ,     ,       CCIE     </i> . <br><br>   -    Auto-discovery (    )   L2,    MAC-.        L3VPN,         . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So how does Auto-Discovery work in L3VPN? Some PEs try to tell the whole world about two things - firstly, what prefixes he knows, secondly, to whom they are intended. And he wants to tell everyone about it at once indiscriminately - everyone who is his MBGP neighbors will receive his Update, and RT will see if these announcements are interesting to them. To no - and no trial - will be discarded. And if they are interesting, then the received prefix and its VPN tag will be placed in their VPN routing table. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All the same is true for L2VPN. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Except for one: learn MAC addresses</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . BGP in L3VPN tells everyone the same label ‚Äî it makes no difference to him where the data packet comes from, his main concern is to transfer it to the correct client interface.</font></font><br><br>    VPLS.       ,    MAC- ,    .     ,         . <br><br>  -   . <b> BGP Auto-Discovery     ,    </b> . <br><br> , -,     BGP ,     Update      VPLS-,      ,       . <br><br>  ,    ¬´-¬ª (), , ¬´-¬ª. -,     . <i></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">when there is no RR, and one PE can send another Update addressable. Then each PE will receive only its message and only its own label. But the reality is that RR has become its (reality) part and, having a neighborhood only with RR, PE sends Update to it, and it sends to all its customers. And if PE sends several Update'ov, then they all scatter on all. It turns out that each of his neighbors will receive not only their own label, but also all the others who have not surrendered to him for nothing. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Just imagine a dump in which you see a hundred Update'ov for left devices.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And here the mechanism of automatic calculation of tags comes to the fore, as a very elegant solution to this problem. It is worth paying tribute to the flexibility of Kiriti Compell‚Äôs thought.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And you know, until this concept of a block of tags formed into a consistent set of synapses in my brain, I disregarded it. She seemed clumsy and outdated to me. Something like </font></font><a href="http://lookmeup.linkmeup.ru/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DVMRP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . But now I was inspired by the idea and even somewhat surprised that there is no intelligible explanation anywhere. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I would also note that the situation with the lost labels was somewhat revised with the release of </font></font><a href="http://mail.networksorcery.com/enp/rfc/rfc6624.txt"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC 6624</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (in which, by the way, Compella also took direct part)</font></font><br><blockquote> Label blocks and label values are managed by the PEs. As sites get <br> added and removed, labels are allocated and released. The easiest <br> way to manage these is to use fixed-size label blocks rather than <br> variable-size blocks, although the signaling described here supports <br> either. If an implementation uses fixed-size blocks, then allocating <br> a label for a new site may requiring allocating a new block; <br> similarly, freeing a label may require freeing a block. <br> If the implementation requires fixed-size blocks, there is probably a <br> default block size, but the implementation SHOULD allow the <br> administrator to choose a size. Larger label block sizes mean more <br> potential ¬´wasted¬ª labels but less signaling overhead, a trade-off <br> that the administrator might want to control. </blockquote><br>   ,  <a href="https://habr.com/ru/post/315028/">LDP-Signalling + BGP Auto-Discovery</a>     .         ‚Äî   ,   . <br><br><br><h3>  VPLS Kompella (BGP Signalling) </h3><br>     : <br><img src="https://habrastorage.org/files/eab/9cc/5e0/eab9cc5e0b8d4fea892cf5b513764949.png"><br><blockquote>      . <br> <a href="https://docs.google.com/document/d/1_o0-Fu0_g1JGCfxGQuDWrIVzaNFRbVPUpDXdk_Rvvdo/pub">  .</a> </blockquote><br><ol><li>  VFI,      Martini: <br><br><pre> <code class="cpp hljs">Linkmeup_R1(config)#<span class="hljs-function"><span class="hljs-function">l2vpn vfi context Blue </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Linkmeup_R1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(config-vfi)</span></span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-meta">#vpn id 63 Linkmeup_R1(config-vfi)#autodiscovery bgp signaling bgp Linkmeup_R1(config-vfi-autodiscovery)#ve id 101</span></span></span></span></code> </pre> <br>       VFI:  Martini   . <i>BGP Autodiscovery + <b>BGP</b> Signalling</i> ,  <i>BGP Autodiscovery + <b>LDP</b> Signalling</i> .       ‚Äî BGP. <br><br>       VPLS-.  cisco   ‚Äî 10.  <b>ve range <i></i></b>    11  100 (  ). Huawei ‚Äî   10,   (1-16000). Juniper ‚Äî   8,   (2,4,8, 16...) <br><br> Route Distinguisher  Route Target     ‚Äî    .      ‚Äî      VFI. <br><br>     <b>mpls label range 1000 1999</b> .       .      ,     MPLS (LDP, TE, BGP)  ,    <s>,     - - </s> .          . <br><br><pre> <code class="cpp hljs">Linkmeup_R1(config)<span class="hljs-meta"><span class="hljs-meta">#mpls label range 1000 1999 Label range change will cause 5 labels in the old dynamic range [16-1048575] to go out of range</span></span></code> </pre> <br>      ,          . <br><br></li><li>    Service Instance: <br><br><pre> <code class="cpp hljs">Linkmeup_R1(config)<span class="hljs-meta"><span class="hljs-meta">#interface gigabitEthernet 3 Linkmeup_R1(config-</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">)#service instance 10 ethernet Linkmeup_R1(config-</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">-srv)#description Blue-A Linkmeup_R1(config-</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">-srv)#encapsulation default Linkmeup_R1(config)#interface gigabitEthernet 4 Linkmeup_R1(config-</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">)#service instance 12 ethernet Linkmeup_R1(config-</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">-srv)#description Blue-C Linkmeup_R1(config-</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">-srv)#encapsulation default</span></span></code> </pre> <br></li><li>  VFI  Service Instance. <br><br><pre> <code class="cpp hljs">Linkmeup_R3(config)<span class="hljs-meta"><span class="hljs-meta">#bridge-domain 255 Linkmeup_R1(config-bdomain)#member vfi Blue Linkmeup_R1(config-bdomain)#member gigabitEthernet 3 service-instance 10 Linkmeup_R1(config-bdomain)#member gigabitEthernet 4 service-instance 12</span></span></code> </pre> <br></li><li>   ,     ‚Äî BGP. <br><br>      Linkmeup_R3  Linkmeup_R4. <br><br><pre> <code class="cpp hljs">Linkmeup_R1(config)<span class="hljs-meta"><span class="hljs-meta">#router bgp 64500 Linkmeup_R1(config-router)#neighbor 3.3.3.3 remote-as 64500 Linkmeup_R1(config-router)#neighbor 3.3.3.3 update-source Loopback 0 Linkmeup_R1(config-router)#neighbor 4.4.4.4 remote-as 64500 Linkmeup_R1(config-router)#neighbor 4.4.4.4 update-source Loopback 0</span></span></code> </pre> <br>   Address-Family L2VPN VPLS   ,     L2VPN. ,    VFI Blue,  . <br><br><pre> <code class="cpp hljs">Linkmeup_R1(config-router)<span class="hljs-meta"><span class="hljs-meta">#address-family l2vpn vpls Linkmeup_R1(config-router-af)#neighbor 3.3.3.3 activate Linkmeup_R1(config-router-af)#neighbor 3.3.3.3 send-community extended Linkmeup_R1(config-router-af)#neighbor 3.3.3.3 suppress-signaling-protocol ldp Linkmeup_R1(config-router-af)#neighbor 4.4.4.4 activate Linkmeup_R1(config-router-af)#neighbor 4.4.4.4 send-community extended Linkmeup_R1(config-router-af)#neighbor 4.4.4.4 suppress-signaling-protocol ldp</span></span></code> </pre> <br>    ,     Route Reflector' ‚Äî      ,   Auto-Discovery .     PE-   MPLS ‚Äî 100,   VPLS- ‚Äî 20,  L2VPN RR ‚Äî 2,    PE        RR.     ,     ? <br><br> <b>send-community extended</b> ‚Äî    L3VPN   Extended Community (RT). <br> <b>suppress-signaling-protocol ldp</b> ‚Äî    LDP. <br><br>   BGP   VPLS,     : <br><br><img src="https://habrastorage.org/files/7a4/041/bfb/7a4041bfbd4d4e7aa6db6411b79efc4d.PNG"><br><br>   ‚Äî  RD,  : AS:VPN ID.  ‚Äî  ,    . <br><br>     Linkmeup_R3  Linkmeup_R4. <br><br><div class="spoiler"> <b class="spoiler_title">  PE</b> <div class="spoiler_text"><br><hr><br> <b>Linkmeup_R1</b> <br><pre> <code class="cpp hljs">Linkmeup_R1(config)#<span class="hljs-function"><span class="hljs-function">l2vpn vfi context Blue </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Linkmeup_R1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(config-vfi)</span></span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-meta">#vpn id 63 Linkmeup_R1(config-vfi)#autodiscovery bgp signaling bgp Linkmeup_R1(config-vfi-autodiscovery)#ve id 101 Linkmeup_R1(config)#mpls label range 1000 1999 Linkmeup_R1(config)#bridge-domain 255 Linkmeup_R1(config-bdomain)#member vfi Blue Linkmeup_R1(config-bdomain)#member gigabitEthernet 3 service-instance 10 Linkmeup_R1(config-bdomain)#member gigabitEthernet 4 service-instance 12 Linkmeup_R1(config)#interface gigabitEthernet 3 Linkmeup_R1(config-</span></span><span class="hljs-meta-keyword"><span class="hljs-function"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span></span><span class="hljs-function"><span class="hljs-meta">)# service instance 10 ethernet Linkmeup_R1(config-</span></span><span class="hljs-meta-keyword"><span class="hljs-function"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span></span><span class="hljs-function"><span class="hljs-meta">-srv)#description Blue-A Linkmeup_R1(config-</span></span><span class="hljs-meta-keyword"><span class="hljs-function"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span></span><span class="hljs-function"><span class="hljs-meta">-srv)#encapsulation default Linkmeup_R1(config)#interface gigabitEthernet 4 Linkmeup_R1(config-</span></span><span class="hljs-meta-keyword"><span class="hljs-function"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span></span><span class="hljs-function"><span class="hljs-meta">)# service instance 12 ethernet Linkmeup_R1(config-</span></span><span class="hljs-meta-keyword"><span class="hljs-function"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span></span><span class="hljs-function"><span class="hljs-meta">-srv)#description Blue-C Linkmeup_R1(config-</span></span><span class="hljs-meta-keyword"><span class="hljs-function"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span></span><span class="hljs-function"><span class="hljs-meta">-srv)#encapsulation default Linkmeup_R1(config)#router bgp 64500 Linkmeup_R1(config-router)#neighbor 3.3.3.3 remote-as 64500 Linkmeup_R1(config-router)#neighbor 3.3.3.3 update-source Loopback 0 Linkmeup_R1(config-router)#neighbor 4.4.4.4 remote-as 64500 Linkmeup_R1(config-router)#neighbor 4.4.4.4 update-source Loopback 0 Linkmeup_R1(config-router)#address-family l2vpn vpls Linkmeup_R1(config-router-af)#neighbor 3.3.3.3 activate Linkmeup_R1(config-router-af)#neighbor 3.3.3.3 send-community extended Linkmeup_R1(config-router-af)#neighbor 3.3.3.3 suppress-signaling-protocol ldp Linkmeup_R1(config-router-af)#neighbor 4.4.4.4 activate Linkmeup_R1(config-router-af)#neighbor 4.4.4.4 send-community extended Linkmeup_R1(config-router-af)#neighbor 4.4.4.4 suppress-signaling-protocol</span></span></span></span></code> </pre> <br><hr><br> <b>Linkmeup_R3</b> <br><pre> <code class="cpp hljs">Linkmeup_R3(config)#<span class="hljs-function"><span class="hljs-function">l2vpn vfi context Blue </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Linkmeup_R3</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(config-vfi)</span></span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-meta">#vpn id 63 Linkmeup_R3(config-vfi)#autodiscovery bgp signaling bgp Linkmeup_R3(config-vfi-autodiscovery)#ve id 103 Linkmeup_R3(config)#mpls label range 3000 3999 Linkmeup_R3(config)#bridge-domain 255 Linkmeup_R3(config-bdomain)#member vfi Blue Linkmeup_R3(config-bdomain)#member gigabitEthernet 3 service-instance 13 Linkmeup_R3(config)#interface gigabitEthernet 3 Linkmeup_R3(config-</span></span><span class="hljs-meta-keyword"><span class="hljs-function"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span></span><span class="hljs-function"><span class="hljs-meta">)#service instance 13 ethernet Linkmeup_R3(config-</span></span><span class="hljs-meta-keyword"><span class="hljs-function"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span></span><span class="hljs-function"><span class="hljs-meta">-srv)#description Blue-D Linkmeup_R3(config-</span></span><span class="hljs-meta-keyword"><span class="hljs-function"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span></span><span class="hljs-function"><span class="hljs-meta">-srv)#encapsulation default Linkmeup_R3(config)#router bgp 64500 Linkmeup_R3(config-router)#neighbor 1.1.1.1 remote-as 64500 Linkmeup_R3(config-router)#neighbor 1.1.1.1 update-source Loopback 0 Linkmeup_R3(config-router)#neighbor 4.4.4.4 remote-as 64500 Linkmeup_R3(config-router)#neighbor 4.4.4.4 update-source Loopback 0 Linkmeup_R3(config-router)#address-family l2vpn vpls Linkmeup_R3(config-router-af)#neighbor 1.1.1.1 activate Linkmeup_R3(config-router-af)#neighbor 1.1.1.1 send-community extended Linkmeup_R3(config-router-af)#neighbor ppress-signaling-protocol ldp Linkmeup_R3(config-router-af)#neighbor 4.4.4.4 activate Linkmeup_R3(config-router-af)#neighbor 4.4.4.4 send-community extended Linkmeup_R3(config-router-af)#neighbor 4.4.4.4 suppress-signaling-protocol ldp</span></span></span></span></code> </pre> <br><hr><br> <b>Linkmeup_R4</b> <br><pre> <code class="cpp hljs">Linkmeup_R4(config)#<span class="hljs-function"><span class="hljs-function">l2vpn vfi context Blue </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Linkmeup_R4</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(config-vfi)</span></span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-meta">#vpn id 63 Linkmeup_R4(config-vfi)#autodiscovery bgp signaling bgp Linkmeup_R4(config-vfi-autodiscovery)#ve id 104 Linkmeup_R4(config)#mpls label range 4000 4999 Linkmeup_R4(config)#bridge-domain 255 Linkmeup_R4(config-bdomain)#member vfi Blue Linkmeup_R4(config-bdomain)#member gigabitEthernet 3 service-instance 131 Linkmeup_R4(config)#interface gigabitEthernet 3 Linkmeup_R4(config-</span></span><span class="hljs-meta-keyword"><span class="hljs-function"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span></span><span class="hljs-function"><span class="hljs-meta">)#service instance 11 ethernet Linkmeup_R4(config-</span></span><span class="hljs-meta-keyword"><span class="hljs-function"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span></span><span class="hljs-function"><span class="hljs-meta">-srv)#description Blue-B Linkmeup_R4(config-</span></span><span class="hljs-meta-keyword"><span class="hljs-function"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span></span><span class="hljs-function"><span class="hljs-meta">-srv)#encapsulation default Linkmeup_R4(config)#router bgp 64500 Linkmeup_R4(config-router)#neighbor 1.1.1.1 remote-as 64500 Linkmeup_R4(config-router)#neighbor 1.1.1.1 update-source Loopback 0 Linkmeup_R4(config-router)#neighbor 3.3.3.3 remote-as 64500 Linkmeup_R4(config-router)#neighbor 3.3.3.3 update-source Loopback 0 Linkmeup_R4(config-router)#address-family l2vpn vpls Linkmeup_R4(config-router-af)#neighbor 1.1.1.1 activate Linkmeup_R4(config-router-af)#neighbor 1.1.1.1 send-community extended Linkmeup_R4(config-router-af)#neighbor 1.1.1 suppress-signaling-protocol ldp Linkmeup_R4(config-router-af)#neighbor 3.3.3.3 activate Linkmeup_R4(config-router-af)#neighbor 3.3.3.3 send-community extended Linkmeup_R4(config-router-af)#neighbor 3.3.3 suppress-signaling-protocol ldp</span></span></span></span></code> </pre> <br><hr><br>       mpls label range,          . <br></div></div><br></li></ol><blockquote> <b>   MPLS Kompella Mode .</b> <br> <a href="https://docs.google.com/document/d/1-1OfZRlsMEFuka7bSV3JQpvsaMG6fxifMtXEjr55-Mw/pub">  VPLS Kompella Mode</a> .  ,     Martini  . </blockquote><br>  What happened? <br><br> <b>0.</b>   CE   <br><br><img src="https://habrastorage.org/files/a6a/125/215/a6a125215517499ab1a55c5fa211a457.PNG"><br><br> <b>1.</b> BGP      Update'. <br><br><img src="https://habrastorage.org/files/a14/428/fd3/a14428fd39ac45f99432164f0e60f676.png"><br><br>   Update   NLRI <br><br><img src="https://habrastorage.org/files/31c/e21/92d/31ce2192dc9d4d8f99654339bbbc3828.png"><br><br>  Linkmeup_R1  Linkmeup_R3,   VPN-  ,    VPLS  RT 65400:63. CE-ID (  VE ID)=101, VBO=100, VBS=10, LB=1000. <br><br><img src="https://habrastorage.org/files/cae/1ec/458/cae1ec45838e447c82ce03b35ea7aceb.png"><br><br>   Linkmeup_R3  Linkmeup_R1: CE-ID=103, VBO=100,VBS=10, LB=3000 <br><br><img src="https://habrastorage.org/files/0a3/464/ec2/0a3464ec29ce43a4bca707bc16df5f4a.png"><br><br>   Linkmeup_R4  Linkmeup_R1: CE-ID=104, VBO=100,VBS=10, LB=4000 <br><br> <i>Linkmeup_R1  Linkmeup_R4   ,    Linkmeup_R3</i> . <br><br> ,       PE, ,    ? <br><br><blockquote> <b>Linkmeup_R3‚ÜíLinkmeup_R1</b> <br>  VBO ‚â§ Local VE ID ‚â§ VBO+VBS-1 : 100‚â§103‚â§109. <br> : LB + Local VE ID ‚Äî VBO = 1000+103-100=1003. <br>  1003  Linkmeup_R3  ,     Linkmeup_R1   VFI. <br><br> <b>Linkmeup_R1‚ÜíLinkmeup_R3</b> <br>  VBO ‚â§ Local VE ID ‚â§ VBO+VBS-1 : 100‚â§101‚â§109. <br> : LB + Local VE ID ‚Äî VBO = 3000+101-100=3001. <br>  3001  Linkmeup_R1  ,     Linkmeup_R3   VFI. <br><br> <b>Linkmeup_R1‚ÜíLinkmeup_R4</b> <br>  VBO ‚â§ Local VE ID ‚â§ VBO+VBS-1 : 100‚â§101‚â§109. <br> : LB + Local VE ID ‚Äî VBO = 4000+101-100=4001. <br><br> <b>Linkmeup_R4‚ÜíLinkmeup_R1</b> <br>  VBO ‚â§ Local VE ID ‚â§ VBO+VBS-1 : 100‚â§104‚â§109. <br> : LB + Local VE ID ‚Äî VBO = 1000+104-100=1004. <br><br>    Linkmeup_R4‚ÜíLinkmeup_R3  Linkmeup_R3‚ÜíLinkmeup_R4. <br> <b>Linkmeup_R4‚ÜíLinkmeup_R3</b> <br>  VBO ‚â§ Local VE ID ‚â§ VBO+VBS-1 : 100‚â§104‚â§109. <br> : LB + Local VE ID ‚Äî VBO = 3000+104-100=3004. <br><br> <b>Linkmeup_R3‚ÜíLinkmeup_R4</b> <br>  VBO ‚â§ Local VE ID ‚â§ VBO+VBS-1 : 100‚â§103‚â§109. <br> : LB + Local VE ID ‚Äî VBO = 4000+103-100=4003. </blockquote><br> <b>2.</b>     PE. <br><br><img src="https://habrastorage.org/files/905/6ad/2be/9056ad2be166481bb638f97a7acc0fac.PNG"><br><br><img src="https://habrastorage.org/files/f13/c22/6c5/f13c226c56124cbfbe89b872506d9397.PNG"><br><br> , ,   .  ,        ,    .    ,         ‚Äî ,   ,    , . <br><br> <b>3.</b> ,     ping  Blue-A  Blue-D,    VPN- 3001  ICMP-Request  1003  ICMP-Reply: <br><br><img src="https://habrastorage.org/files/680/0bb/241/6800bb24140946c2b14f41a11414dc5a.PNG"><br><br> <i>    Wireshark -  ICMP  MPLS</i> <br><br><hr><br>  -    <b>show mpls l2transport vc detail</b>  <b>show l2vpan atom vc detail</b>   : <br><br><img src="https://habrastorage.org/files/5cb/430/7c0/5cb4307c0b1d4c61839d3a8c31e38590.PNG"><br><br><img src="https://habrastorage.org/files/5b1/280/e50/5b1280e5084c48a396fbf866612ebcff.PNG"><br><br>  <b>show bgp l2vpn vpls rd <i>X</i> ve-id <i>Y</i> block-offset <i>Z</i></b>           . <br><br><img src="https://habrastorage.org/files/35e/021/4a7/35e0214a7e714d25a227393f9f9be79b.PNG"><br><br>      : <br><br><img src="https://habrastorage.org/files/b03/dd8/7ce/b03dd87ce0594c60aca760de54afd1bd.PNG"><br><br><hr><br>       ,    Martini,   , : <br><br> 1)   .    PE  VPLS-,     (   RR).  Martini      PE  VPLS-. <br> 2)      ‚Äî   VE ID.  BGP    (   RR). <br><br>     : <br><br><ol><li>  VFI,  VPN ID, , VE ID. </li><li>  Service Instance  AC-. </li><li>  VFI  Service Instance  bridge-domain. </li><li>   BGP    RR  Address-family L2VPN VPLS. </li></ol><br>    VPLS Kompella mode   Juniper: <a href="https://habrahabr.ru/post/275787/">  </a> .     : <a href="http://www.cisco.com/c/en/us/support/docs/ios-nx-os-software/virtual-private-lan-services-vpls/116121-tech-vpls-bgp-00.html"> cisco</a> . <br><br><hr><br><br><h3> Matini vs Kompella </h3><br>  ,     BGP Kompella mode  Martini Mode? <br><br><ul><li> Auto-Discovery.     PE   LDP-     VPLS-.   RR     . <br><br></li><li>   Auto-Discovery BGP    /.      ,    . , ,  ,        BGP,  L2VPN   BGP    .          ,    ,   . <br><br></li><li>  BGP     Inter-AS VPN. Option C    (seamless) MPLS   AS      PW. </li></ul><br> <b>    ?  .</b> <br><br> <u> (Inter-AS) VPN       Martini    VPLS</u> ‚Äî       PE-  VPLS-.  H-VPLS   <a href="https://habr.com/ru/post/315028/"> </a> .       . <br><br>       <u>Auto-Discovery  Kompella</u> ,     : <br><br> <b>-</b> ,        .     ,   ,            . <br>       .  ,           NMS. <br><br> <b>-</b> , <a href="https://tools.ietf.org/html/rfc4762">RFC 4762</a>   Auto-Discovery   Martini.      RADIUS     BGP. <br><br> ,  cisco    LDP + BGP Autodiscovery  <b>autodiscovery LDP signaling BGP</b>   <b>l2vpn vfi</b> .          ,       (  BGP  ). <br><br>       Martini             . <br><br>      ,    , Martini Mode     ,  , -    .       . <br><br><hr><br>        VPLS,     . <br><br><br><h1>  VPLS (H-VPLS) </h1><br>  VPLS ‚Äî    ‚Äî    .    Kompella mode RR        ,  Martini Mode         ‚Äî       LDP-.    O(n^2): n*(n-1)/2 ‚Äî  n ‚Äî  . <br><br><img src="https://habrastorage.org/files/485/7c3/61f/4857c361f37b43e78ac87495cca44029.PNG"><br><br>        ‚Äî   Ethernet ‚Äî      ,     PE. <br><br>        -  BGP- Route Reflector'? <br><br> .     ‚Äî H-VPLS (Hierarchical VPLS),    <a href="https://tools.ietf.org/html/rfc4762">RFC 4762</a> . <br><br> H-VPLS   VPLS-   : PE-rs  MTU-s. <br><br> <b>PE-rs</b> ‚Äî <u>PE ‚Äî routing and switching</u> .    VPLS.    ,     PE.   PE-rs: <b><a href="http://lookmeup.linkmeup.ru/">PE-POP</a></b> , <b><a href="http://lookmeup.linkmeup.ru/">n-PE</a></b> . <br><br> <b>MTU-s</b> ‚Äî <u>Multi-Tenant Unit ‚Äî switching</u> .      ,    PE-rs   .       CE.   MTU-s: <b><a href="http://lookmeup.linkmeup.ru/">u-PE</a></b> , <b><a href="http://lookmeup.linkmeup.ru/">PE-CLE</a></b> . <br><br><img src="https://habrastorage.org/files/119/97e/d22/11997ed220d94f16bf1c7b9a81d96384.PNG"><br><br> MTU-s       PE-rs ‚Äî  .     .   MTU-s  PE-rs: MPLS PW  QinQ.     MPLS,      . <br><br> PE-rs      PE,        . <br><br>   PE-rs  MTU-s, PE-rs  PW  MTU-s  AC-,  ,   .  : <br><br> ‚Äî ,  PE-rs   MTU-s     PE-rs    MTU-s, <br> ‚Äî ,  PE-rs    PE-rs       MTU-s,     PE-rs. <br><br>  ,  MTU-s       ( ) ,   PE-rs  ,      .           PE-rs. <br><br>   Inter-AS VPN H-VPLS    . ,      ASBR   PE-rs    . <br><br>  H-VPLS ‚Äî    : <br><br><ul><li>      Contol Plane. </li><li>  Data Plane       . </li><li>   VPLS-         . </li></ul><br> ! ,    MAC-  PE-rs? ,    VPLS  P,  H-VPLS  PE,  ,     ‚Äî  MAC-.    MTU-s,    .          . <br><br> , ,    Control Plane       Data Plane.     , H-VPLS  .  MAC-          ,      ,   CPU   .      H-VPLS  . <br><br> ,    , ,    <i></i> . <br><br>  ,  ? <br><br><br><h3>  H-VPLS </h3><br>         Dual-Homing'.        ,  Linkmeup_R1  MTU-s,  Linkmeup_R2 ‚Äî PE-rs. <br><br><img src="https://habrastorage.org/files/bda/b21/bc8/bdab21bc884a40deba3f8bb2af30f8ba.png"><br><br><blockquote>    . <br> <a href="https://docs.google.com/document/d/1_o0-Fu0_g1JGCfxGQuDWrIVzaNFRbVPUpDXdk_Rvvdo/pub">  .</a> </blockquote><br>  H-VPLS        Kompella,      ,      Martini. <br><br><ol><li>    ‚Äî PE-rs.  Linkmeup_R2, Linkmeup_R3  Linkmeup_R4    PE-rs ‚Äî       VFI. <br><br><pre> <code class="cpp hljs">Linkmeup_R2(config)#<span class="hljs-function"><span class="hljs-function">l2vpn vfi context Blue </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Linkmeup_R2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(config-vfi)</span></span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-meta"># vpn id 63 Linkmeup_R2(config-vfi)# member 3.3.3.3 encapsulation mpls Linkmeup_R2(config-vfi)# member 4.4.4.4 encapsulation mpls</span></span></span></span></code> </pre> <br>   Linkmeup_R2 ,  bridge-domain  . <br><br><div class="spoiler"> <b class="spoiler_title"> Linkmeup_R3  Linkmeup_R4</b> <div class="spoiler_text"><br><hr><br> <b>Linkmeup_R3</b> <br><pre> <code class="cpp hljs">Linkmeup_R3(config)#<span class="hljs-function"><span class="hljs-function">l2vpn vfi context Blue </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Linkmeup_R3</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(config-vfi)</span></span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-meta"># vpn id 63 Linkmeup_R3(config-vfi)# member 2.2.2.2 encapsulation mpls Linkmeup_R3(config-vfi)# member 4.4.4.4 encapsulation mpls Linkmeup_R3(config-vfi)#bridge-domain 255 Linkmeup_R3(config-bdomain)# member vfi Blue Linkmeup_R3(config-bdomain)# member gigabitEthernet 3 service-instance 13 Linkmeup_R3(config-bdomain)#interface GigabitEthernet3 Linkmeup_R3(config-</span></span><span class="hljs-meta-keyword"><span class="hljs-function"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span></span><span class="hljs-function"><span class="hljs-meta">)# service instance 13 ethernet Linkmeup_R3(config-</span></span><span class="hljs-meta-keyword"><span class="hljs-function"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span></span><span class="hljs-function"><span class="hljs-meta">-srv)# description Blue-D Linkmeup_R3(config-</span></span><span class="hljs-meta-keyword"><span class="hljs-function"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span></span><span class="hljs-function"><span class="hljs-meta">-srv)# encapsulation default</span></span></span></span></code> </pre> <br><hr><br> <b>Linkmeup_R4</b> <br><pre> <code class="cpp hljs">Linkmeup_R4(config)#<span class="hljs-function"><span class="hljs-function">l2vpn vfi context Blue </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Linkmeup_R4</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(config-vfi)</span></span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-meta"># vpn id 63 Linkmeup_R4(config-vfi)# member 2.2.2.2 encapsulation mpls Linkmeup_R4(config-vfi)# member 3.3.3.3 encapsulation mpls Linkmeup_R4(config-vfi)#bridge-domain 255 Linkmeup_R4(config-bdomain)# member vfi Blue Linkmeup_R4(config-bdomain)# member gigabitEthernet 3 service-instance 11 Linkmeup_R4(config-bdomain)#interface GigabitEthernet3 Linkmeup_R4(config-</span></span><span class="hljs-meta-keyword"><span class="hljs-function"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span></span><span class="hljs-function"><span class="hljs-meta">)# service instance 13 ethernet Linkmeup_R4(config-</span></span><span class="hljs-meta-keyword"><span class="hljs-function"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span></span><span class="hljs-function"><span class="hljs-meta">-srv)# description Blue-D Linkmeup_R4(config-</span></span><span class="hljs-meta-keyword"><span class="hljs-function"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span></span><span class="hljs-function"><span class="hljs-meta">-srv)# encapsulation default</span></span></span></span></code> </pre> <br><hr><br></div></div><br></li><li>  Linkmeup_R1  PW  Linkmeup_R2. <br><br><pre> <code class="cpp hljs">Linkmeup_R1(config)#<span class="hljs-function"><span class="hljs-function">l2vpn xconnect context Blue_10 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Linkmeup_R1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(config-xconnect)</span></span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-meta"># member GigabitEthernet3 service-instance 10 Linkmeup_R1(config-xconnect)# member 2.2.2.2 6310 encapsulation mpls</span></span></span></span></code> </pre> <br>       xconnect,    AC-  VC-. <br><br> ID 6310 ,     ,     PE-rs.    63 ‚Äî   VPN ID,  11 ‚Äî   VC   MTU-s. <br><br>    : <br><br><pre> <code class="cpp hljs">Linkmeup_R1(config-xconnect)<span class="hljs-meta"><span class="hljs-meta">#interface GigabitEthernet3 Linkmeup_R1(config-</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">)# service instance 10 ethernet Linkmeup_R1(config-</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">-srv)#encapsulation default</span></span></code> </pre> <br><div class="spoiler"> <b class="spoiler_title">  Gi4    </b> <div class="spoiler_text"><br><pre> <code class="cpp hljs">Linkmeup_R1(config)#<span class="hljs-function"><span class="hljs-function">l2vpn xconnect context Blue_10 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Linkmeup_R1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(config-xconnect)</span></span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-meta"># member GigabitEthernet4 service-instance 12 Linkmeup_R1(config-xconnect)# member 2.2.2.2 6320 encapsulation mpls Linkmeup_R1(config-xconnect)#interface GigabitEthernet4 Linkmeup_R1(config-</span></span><span class="hljs-meta-keyword"><span class="hljs-function"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span></span><span class="hljs-function"><span class="hljs-meta">)# service instance 12 ethernet Linkmeup_R1(config-</span></span><span class="hljs-meta-keyword"><span class="hljs-function"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span></span><span class="hljs-function"><span class="hljs-meta">-srv)#encapsulation default</span></span></span></span></code> </pre> <br></div></div><br></li><li>    PW   Linkmeup_R2: <br><br><pre> <code class="cpp hljs">Linkmeup_R2(config)<span class="hljs-meta"><span class="hljs-meta">#bridge-domain 255 Linkmeup_R2(config-bdomain)# member vfi Blue Linkmeup_R2(config-bdomain)# member 1.1.1.1 6310 encapsulation mpls Linkmeup_R2(config-bdomain)# member 1.1.1.1 6320 encapsulation mpls</span></span></code> </pre> <br></li></ol><blockquote> <u><b>    H-VPLS Martini Mode .</b></u> <br> <a href="https://docs.google.com/document/d/1cBPLqIVZyFf7xmWEXUyCq6yicvwH9qoMEt7pDqs_qEU/pub">  H-VPLS</a> <br></blockquote><br><hr><br>  What happened? PW : <br><br><img src="https://habrastorage.org/files/705/5d9/cb1/7055d9cb11674bda9755c1b166ff2587.PNG"><br><br> VFI  Linkmeup_R2   : <br><br><img src="https://habrastorage.org/files/342/93e/5d2/34293e5d2ec845c88e4d49d851445cd5.PNG"><br><br> MAC'  : <br><br><img src="https://habrastorage.org/files/c80/a92/18f/c80a9218f10e44cd9cfec17927af7dd4.PNG"><br><br>  H-VPLS   ,      : <br><br><ol><li>  Reservation. Dual-Homing MTU-s   PE-rs.   . </li><li> H-VPLS  QinQ  ,  MPLS PW. </li><li>       STP BPDU   VPLS. </li></ol><br>         : <a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/mp_l2_vpns/configuration/xe-3s/mp-l2-vpns-xe-3s-book/mp-hvpls-npe-red.html">H-VPLS PE-rs Redundancy for QinQ Access</a>  <a href="https://habrahabr.ru/post/259645/"> VPLS Multihoming   Juniper tutorial</a> . <br><br><hr><br>       L2 c   . <br><br><h2>   </h2><br>  -    ‚Äî  ,     . <br><br>  ,  .    - ,   MAC- .         VPLS-.   ,         ,   --. <br><br>      ,    ,     QoS,  ,    .          ,        . <br><br><h2>   </h2><br> -     ,       .       .   : <br><br><img src="https://habrastorage.org/files/7d4/86c/3c0/7d486c3c0f724ab58e82a349194ee717.PNG"><br><br>  ,             100 /.       . <br><br> ,  -    MAC- .     VSI,        MAC- ,  .  , ,      400 /,   400 /    ,    100 /  .          MAC-.         . <br><br><h2>   </h2><br>   .        ,   .         -.    ,      , , ,  . <br><img src="https://habrastorage.org/files/863/3b6/5df/8633b65df77c483c99f5da170a1b202e.PNG"><br><br>  ,    ,     ,         -     : STP  -  .    ‚Äî   .   -    ,         , . <br><br>      ‚Äî ,         .         CS6/CS7,      .     ‚Äî   ,   ,   ,   ?     100 / ,   . <br><br>        ,         . <br><br><h2>   </h2><br>     .         .   . <br><br><img src="https://habrastorage.org/files/d5d/02f/d39/d5d02fd3959b4331b3b3cade9cb72017.PNG"><br><br>     ,    PE   PW       (    ).    ‚Äî    ,    MPLS-. <br><br>       ,    . <br><blockquote> ,  ,     . ,    . , ,      . </blockquote><br>     ‚Äî           , ,        VSI. <br><br>    ,                     .       <a href="http://lookmeup.linkmeup.ru/"> </a> ,       . <br><br> ,       , PE  ,    PW    Down,          .  ,     (   )       .   ?      ,     PE    ,       VSI.          .    PE        ,            . <br><br><img src="https://habrastorage.org/files/e54/154/6ac/e541546acbce40a8b1f0a6222673f794.PNG"><br><br><h2>   </h2><br>   VPLS    PE. ,   <a href="http://lookmeup.linkmeup.ru/">DCI</a> . 1    PE ‚Äî   Dual-Homing ‚Äî  Active/Active ‚Äî         .       ‚Äî   . <br><img src="https://habrastorage.org/files/1d5/a75/0bc/1d5a750bcb284559a3492cb470279531.png"><br><br>  ,            .      . ,   1    ,    . <br><br>  ,  .    L2. PE1   MAC-   ‚Äî   ,    1    PE2,       MAC-. ,         -. <br><br><hr><br> ,    ‚Äî   . ,     ¬´¬ª,       ,  Ethernet ‚Äî   ‚Äî  .    ‚Äî     ‚Äî        ,   . <br><br> , ,  ,       L2,       ,     ,  L3VPN.  , -  .       ,  ,      . <br><br>   ,     .               Ethernet,       . <br><br>         ‚Äî EVPN.  ,     MAC-  Control Plane     BGP. <br><br><hr><br><br><h1>  useful links </h1><br>   ,      . :   . <br><br><ul><li>    MPLS : <a href="https://www.nanog.org/meetings/nanog49/presentations/Sunday/mpls-nanog49.pdf"></a> . </li><li>    AToM': <a href="http://www.cisco.com/application/pdf/en/us/guest/tech/tk891/c1482/cdccont_0900aecd80162184.pdf"></a> . </li><li>   : <a href="https://habrahabr.ru/post/275787/"></a> . </li><li> Juniper  ,    Label Block: <a href="https://kb.juniper.net/library/CUSTOMERSERVICE/technotes/Understanding_VPLS_Label_Blocks_Operation.pdf"></a>  <a href="https://www.juniper.net/documentation/en_US/junos15.1/topics/concept/vpls-label-blocks-overview.html"></a> . </li><li>  VPLS BGP  Cisco    : <a href="http://www.cisco.com/c/en/us/support/docs/ios-nx-os-software/virtual-private-lan-services-vpls/116121-tech-vpls-bgp-00.html"></a> . </li><li>    : <a href="http://www.nanog.org/meetings/nanog46/presentations/Tuesday/Martini_Pseudowires_N46.pdf"></a> . </li><li>    : <a href="http://www.opennet.ru/docs/RUS/mpls/vplssig.html"></a> . </li><li>    : <a href="http://www.networkers-online.com/blog/2009/01/draft-martini-draft-kompella-and-l2vpn-services/"></a> . </li><li>     H-VPLS: <a href="http://www.juniper.net/us/en/local/pdf/app-notes/3500116-en.pdf"></a> . </li><li> H-VPLS  ,   : <a href="http://www.cisco.com/c/en/us/td/docs/ios-xml/ios/mp_l2_vpns/configuration/xe-3s/mp-l2-vpns-xe-3s-book/mp-hvpls-npe-red.html"></a> . </li><li> H-VPLS Multihoming  STP -: <a href="https://habrahabr.ru/post/259645/"></a> . </li><li>   ‚Äî EVPN: <a href="http://forums.juniper.net/jnet/attachments/jnet/ATJUG/10/2/EVPN%2520update%2520Atlanta%2520Juniper%2520User%2520Group.pdf"></a> . </li></ul><br> <b> </b> <br><br> Luc De Ghein. <a href="https://www.amazon.com/MPLS-Fundamentals-Luc-Ghein/dp/1587051974">MPLS Fundamentals 1st Edition</a> . Ina Minei, Julian Lucek. <a href="https://www.amazon.com/MPLS-Enabled-Applications-Emerging-Developments-Technologies/dp/0470665459%3Fie%3DUTF8%26*Version*%3D1%26*entries*%3D0">MPLS-Enabled Applications: Emerging Developments and New Technologies 3rd Edition</a> . <br><br>  ,        <a href="http://linkmeup.ru/page/bb"></a> . <br><br>  ,   ,     <a href="http://lookmeup.linkmeup.ru/"> linkmeup</a> . <br><br>  <b>Thanks</b> <br><br> ¬ª  ,     JDima     . <br> ¬ª     . <br> ¬ª    . <br> ¬ª    ,     ,      . <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"> <a href="http://linkmeup.ru/blog/248.html">11.1.</a>  <a href="http://linkmeup.ru/blog/248.html">Networks for the smallest.</a> <a href="http://linkmeup.ru/blog/248.html"> ‚Ññ6. MPLS L3VPN    </a> <br> <a href="http://linkmeup.ru/blog/204.html">11.    .  . MPLS L3VPN</a> <br> <a href="http://linkmeup.ru/blog/154.html">10.    .  .  MPLS</a> <br> <a href="http://linkmeup.ru/blog/129.html">9.    .  . </a> <br> <a href="http://linkmeup.ru/blog/92.html">8.1    .  ‚Ññ3. IBGP</a> <br> <a href="http://linkmeup.ru/blog/65.html">8.    .</a>  <a href="http://linkmeup.ru/blog/65.html">Part Eight</a>  <a href="http://linkmeup.ru/blog/65.html">BGP and IP SLA</a> <br> <a href="http://linkmeup.ru/blog/50.html">7.    .  .</a>  <a href="http://linkmeup.ru/blog/50.html">VPN</a> <br> <a href="http://linkmeup.ru/blog/33.html">6.    .  .  </a> <br> <a href="http://linkmeup.ru/blog/16.html">5.    :  . NAT  ACL</a> <br> <a href="http://linkmeup.ru/blog/15.html">4.    :  .</a>  <a href="http://linkmeup.ru/blog/15.html">STP</a> <br> <a href="http://linkmeup.ru/blog/14.html">3.    :  .  </a> <br> <a href="http://linkmeup.ru/blog/13.html">2.    .</a>  <a href="http://linkmeup.ru/blog/13.html">Part two.</a> <a href="http://linkmeup.ru/blog/13.html"></a> <br> <a href="http://linkmeup.ru/blog/12.html">1.    .</a>  <a href="http://linkmeup.ru/blog/12.html">Part one.</a> <a href="http://linkmeup.ru/blog/12.html">   cisco</a> <br> <a href="http://linkmeup.ru/blog/11.html">0.    .  .</a>  <a href="http://linkmeup.ru/blog/11.html">Planning</a> <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/315028/">https://habr.com/ru/post/315028/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../315018/index.html">Useful features of dbForge for administering MS SQL Server databases</a></li>
<li><a href="../315020/index.html">VMware Replication and Disaster Recovery Solutions: vSphere Replication and Site Recovery Manager (SRM)</a></li>
<li><a href="../315022/index.html">Haskell. Monads. Monad transformers. Game types</a></li>
<li><a href="../315024/index.html">Includor.js, or @j includor</a></li>
<li><a href="../315026/index.html">CTF from Bi.Zone on ZeroNights2016</a></li>
<li><a href="../315030/index.html">The frontend build system in the CleverStyle Framework or why you may not need a custom</a></li>
<li><a href="../315032/index.html">A little bit about quantum cryptography</a></li>
<li><a href="../315034/index.html">We invite you to the GeekWeek 2016 online conference</a></li>
<li><a href="../315036/index.html">Improving SQL Server Performance with Entry Level Storage System MSA 2042</a></li>
<li><a href="../315038/index.html">Analysis of malicious chrome extension</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>