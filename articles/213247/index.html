<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>FDB switch tables. Adventures in the zoo. Part 1 - SNMP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For many years, in view of the specifics of the work, we are constantly confronted with the need to retrieve FDB tables (Forwarding DataBase) of manag...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>FDB switch tables. Adventures in the zoo. Part 1 - SNMP</h1><div class="post__text post__text-html js-mediator-article">  For many years, in view of the specifics of the work, we are constantly confronted with the need to retrieve FDB tables <i>(Forwarding DataBase) of</i> managed switches with data about switching the MAC addresses of subscribers and devices.  During this time, several hundred different models of devices from many manufacturers passed by us, and the number of versions of their firmware is difficult to count.  Having accumulated experience - you can share it. <br><br>  In this case, we will only touch upon the topic of retrieving the required data via the SNMP protocol. <br><br>  I note in advance that we are not lobbying and are not trying to belittle any vendor or model.  The models given for the example are indicated for informational purposes and were at hand at the time of writing the article. <br><a name="habracut"></a><br><h5>  So - SNMP-information retrieval method </h5><br>  <b>Pros:</b> <br><ul><li>  SNMP connectivity - there are libraries and standard functions for many programming languages.  There is no need to warm your head with a Telnet connection and authorization <i>(a separate topic)</i> ; </li><li>  some models of budget switches do not have the ability to Telnet connections; </li><li>  in most cases, standard OIDs are used to obtain the required information. </li></ul><br>  <b>Minuses:</b> <br><ul><li>  speed of obtaining information.  Slow enough on volumes <i>(removing 2000 MAC addresses via snmpwalk will take, at best, about 40 seconds, while Telnet will issue them instantly)</i> ; </li><li>  SNMP loads the switch processor more heavily - in some cases, at 100% when large volumes are removed on low-end models; </li><li>  for each VLAN <i>(and there may be hundreds of them)</i> , a separate connection is often required (more on this below); </li><li>  sometimes the features of the implementation of the functional differ from different vendors and models. </li></ul><br>  A separate moment - connection via different SNMP protocols - v.1 or v.2.  The second version is faster, but some (obsolete) models do not support it, or they can give only part of the data. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Some theory </h5><br>  The FDB table of the switchboard contains records about which MAC address on which switch interface is located.  An important clarification is that the interface is not a port.  This <i>CAN</i> be a port, and maybe a VLAN number or other logical entity.  And since we just need to know the port number, then, in fact, the whole further procedure is started. <br><br><h5>  The procedure for obtaining information </h5><br><ol><li>  Get the VLAN list <br><ul><li>  for most switches: <br><pre><code class="bash hljs">snmpwalk -v2c -c public 192.168.0.1 .1.3.6.1.2.1.17.7.1.4.3.1.1</code> </pre> <br></li><li>  for Cisco and similar <br><pre> <code class="bash hljs">snmpwalk -v2c -c public 192.168.0.1 .1.3.6.1.4.1.9.9.46.1.3.1.1.2</code> </pre><br></li></ul><br>  However, some models (FoxGate S6224-S4) may swear and do not give anything: <br><pre> <code class="bash hljs">iso.3.6.1.4.1.9.9.46.1.3.1.1.2 = No Such Object available on this agent at this OID iso.3.6.1.2.1.17.7.1.4.3.1.1 = No Such Instance currently exists at this OID</code> </pre><br></li><li>  Connect to each VLAN and request port-interface indexes for each VLAN.  I remind you that the default connection via SNMP is performed to the VLAN default, and to connect to a specific VLAN you need to specify it after the community via @, for example: <br><br><pre> <code class="bash hljs">snmpwalk -v2c -c public@999 192.168.0.1 .1.3.6.1.2.1.17.1.4.1.2</code> </pre><br>  will produce a port-to-interface ratio for VLAN ID: 999 <br><br>  The fact is that some VLANs may be given a part of the ports, to other VLANs - another part, etc.  And only by polling all the VLANs can you add up the overall picture on the device.  Cisco WS-C3550-48 example ‚Äî first VLAN entries: <br><br><pre> <code class="bash hljs">iso.3.6.1.2.1.17.1.4.1.2.1 = INTEGER: 1 iso.3.6.1.2.1.17.1.4.1.2.6 = INTEGER: 6 iso.3.6.1.2.1.17.1.4.1.2.8 = INTEGER: 8 iso.3.6.1.2.1.17.1.4.1.2.9 = INTEGER: 9 iso.3.6.1.2.1.17.1.4.1.2.10 = INTEGER: 10</code> </pre><br>  It is given only 5 ports.  In this case, the interface numbers are the same as the port numbers. <br><br></li><li>  Request FDB table by VLAN default: <br><pre> <code class="bash hljs">snmpwalk -v2c -c public 192.168.0.1 .1.3.6.1.2.1.17.4.3.1</code> </pre><br><pre> <code class="bash hljs">iso.3.6.1.2.1.17.4.3.1.1.0.12.66.164.241.225 = Hex-STRING: 00 0C 42 A4 F1 E1 iso.3.6.1.2.1.17.4.3.1.2.0.12.66.164.241.225 = INTEGER: 25 iso.3.6.1.2.1.17.4.3.1.3.0.12.66.164.241.225 = INTEGER: 3</code> </pre><br>  The returned data consists of three logical parts - the MAC address itself, the interface number and the record type, namely: <br><br><pre> <code class="bash hljs">1 - other - ,        2 - invalid -  ,     3 - learned - ,   4 - self ‚Äì  MAC-  5 - mgmt - ,  </code> </pre><br>  Records differ in the eleventh (in this example) digit (1, 2, 3) and characterize which parameter is contained in the value. <br><br>  However, the devil is in the details - sometimes the data is returned corrupted <br><br><pre> <code class="bash hljs">iso.3.6.1.2.1.17.4.3.1.1.40.16.123.134.116.160 = Hex-STRING: 28 10 7B 86 74 A0 iso.3.6.1.2.1.17.4.3.1.1.44.171.37.96.118.116 = STRING: <span class="hljs-string"><span class="hljs-string">",&lt;%`vt"</span></span> iso.3.6.1.2.1.17.4.3.1.1.48.133.169.66.201.219 = STRING: <span class="hljs-string"><span class="hljs-string">"0:cB"</span></span> iso.3.6.1.2.1.17.4.3.1.1.64.97.134.11.180.236 = STRING: <span class="hljs-string"><span class="hljs-string">"@a‚îº_"</span></span> iso.3.6.1.2.1.17.4.3.1.1.64.97.134.24.59.113 = Hex-STRING: 40 61 86 18 3B 71</code> </pre><br>  Therefore, it does not interfere with checking for validity of the MAC address. <br><br>  And sometimes for the MAC-address may not find the second and third entry (interface number and record type).  SNMP is SNMP ... <br><br></li><li>  We are requesting a FDB table for other VLANs <i>(the default VLAN will also be there, but more on that later)</i> <br><pre> <code class="bash hljs">snmpwalk -v2c -c public 192.168.0.1 .1.3.6.1.2.1.17.7.1.2</code> </pre><br><pre> <code class="bash hljs">iso.3.6.1.2.1.17.7.1.2.1.1.2.1 = Counter32: 8 iso.3.6.1.2.1.17.7.1.2.1.1.2.888 = Counter32: 1 iso.3.6.1.2.1.17.7.1.2.2.1.2.888.0.12.66.164.241.225 = INTEGER: 25 iso.3.6.1.2.1.17.7.1.2.2.1.2.1.0.21.153.136.45.223 = INTEGER: 2 iso.3.6.1.2.1.17.7.1.2.2.1.2.1.0.33.133.202.27.110 = INTEGER: 1</code> </pre><br>  At the beginning - information will be received on the number of entries in each of the VLANs.  Unfortunately, it is sometimes not true. <br><br>  For example in FoxGate S6224-S4 showed: <br><br><pre> <code class="bash hljs">iso.3.6.1.2.1.17.7.1.2.1.1.2.1 = Counter32: 21 iso.3.6.1.2.1.17.7.1.2.1.1.2.888 = Counter32: 114</code> </pre><br>  But in reality (further in the list) the records were: <br><ul><li>  VLAN 1: 22 </li><li>  VLAN 82: 1 </li><li>  VLAN 130: 4 </li><li>  Vlan 888: 115 </li><li>  Vlan 2085: 4 </li></ul><br>  And the records themselves go, which have a special structure: <br><pre> <code class="bash hljs">iso.3.6.1.2.1.17.7.1.2.2.1.2.888.0.12.66.164.241.225 = INTEGER: 25</code> </pre><br>  From the end: <br><ul><li>  6 blocks (0.12.66.164.241.225) - MAC address in decimal form </li><li>  1 block (888) - VLAN number </li></ul><br>  Well, the interface, as can be seen from the value, is number 25. <br><br>  However, Cisco may not provide a table for all OIDs. <br><br><pre> <code class="bash hljs">iso.3.6.1.2.1.17.7.1.2 = No Such Object available on this agent at this OID</code> </pre><br>  And then a fascinating lesson begins - connecting to each VLAN and removing from it the tables indicated by the item above. <br><br></li><li>  Having received all the necessary data - combine and get first <br>  <b>MAC - Interface - Port</b> <br>  And then: <br>  <b>MAC - Port</b> <br>  Finally. <br></li></ol><br><h5>  Important points </h5><br><ul><li>  if there are a lot of VLANs on the switch <i>(one hundred-other)</i> , then you can not even try to remove the FDB table by it.  No sane timeout is enough - to bypass them all.  It will take a long time. </li><li>  individual solutions for different models.  Here we are talking about local dopilivaniya final data.  Alcatel OmniStack LS 6224 and Allied Telesyn AT-8000S / 24 - though the port numbers are 49-52, but in reality, the port switches have less and the firmware from the older models is used here.  It is required to replace port 49 with 25, 50 with 26, etc. </li><li>  In some cases, the interface table of the INTERFACE-PORT provides conflicting data.  Although Huawei S2326TP-EI-AC provides a correspondence table, FDB displays data with PORT numbers, not interfaces, and standard interface number conversion leads to incorrect data <i>(double conversion)</i> </li><li>  stackable switches and chassis will have special interface numbers </li><li>  Some budget models of switches will not give out information about the FDB-table for all VLANs at all.  Not provided by the manufacturer.  Example: D-Link DES-21XX </li></ul><br><h5>  Total </h5><br>  Despite all the above ‚Äúfeatures‚Äù, the SNMP protocol remains the most popular and convenient method for obtaining an FDB table.  In most cases, there is no need for these dances with a tambourine and the usual fit D-Link, which has a single VLAN, will immediately issue a beautiful list with MAC addresses, and the port numbers will match the interfaces, but who knows ... <br><br>  If the article will be in demand - next time I will tell the features of removal via Telnet. <br><br><div class="spoiler">  <b class="spoiler_title">In the process of writing the article, the following devices were at hand</b> <div class="spoiler_text"><ol><li>  Cisco WS-C3550-48 Cisco IOS Software, C3550 Software (C3550-IPSERVICESK9-M), Version 12.2 (35) SE5, RELEASE SOFTWARE (fc1) Copyright 1986-2007 by Cisco Systems, Inc.  Compiled Fri 20-Jul-07 02:23 by nachen </li><li>  D-Link DES-3028G Fast Ethernet Switch 2.00.B2700.B27 </li><li>  D-Link DES-3200-18 / C1 Fast Ethernet Switch Build 4.36.B009 </li><li>  Edge-Core FE L2 Switch ES3528M </li><li>  Foxgate S6224-S2 Device, May 24 2008 14:57:13 HardWare version is V1.00 SoftWare version is S6224-S2_1.6.7.0 OS version is 5.1.35.48 MiniRom version is S6224-S2_1.6.3 BootRom version is S6224-S2_1 .6.3 Copyright 2001-2008 by Foxgate, Inc. </li><li>  Huawei S2326TP-EI Versatile Routing Platform Software VRP software, Version 5.70 (S2300 V100R006C05) Copyright 2003-2013 Huawei Technologies Co., Ltd. </li></ol><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/213247/">https://habr.com/ru/post/213247/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../213237/index.html">As we brought the smart outlet to the level of a mass product</a></li>
<li><a href="../213239/index.html">Google Fiber expands to 9 more US cities</a></li>
<li><a href="../213241/index.html">Camp game "Torrents"</a></li>
<li><a href="../213243/index.html">Our controller for smart home</a></li>
<li><a href="../213245/index.html">Facebook buys WhatsApp for $ 16 billion</a></li>
<li><a href="../213251/index.html">First blog post: moving from idea to project layout</a></li>
<li><a href="../213253/index.html">Making the game right before your eyes - part 4: Shader for fade in on the palette (a la NES)</a></li>
<li><a href="../213257/index.html">Therascale OCP Solution</a></li>
<li><a href="../213259/index.html">Code Obfuscation Techniques with LLVM</a></li>
<li><a href="../213261/index.html">CodeFest number 5 - again cake</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>