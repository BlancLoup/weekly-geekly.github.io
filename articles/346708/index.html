<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unit testing for applications on the IBM Notes / Domino platform</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I will touch on a topic that is virtually unknown in the world of Notes / Domino - unit testing, and I‚Äôll bring to your attention a tool for writing u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unit testing for applications on the IBM Notes / Domino platform</h1><div class="post__text post__text-html js-mediator-article">  I will touch on a topic that is virtually unknown in the world of Notes / Domino - unit testing, and I‚Äôll bring to your attention a tool for writing unit tests for Notes / Domino under the LotusScript language.  The article is mainly designed for those who work with the IBM Notes / Domino platform (Lotus Notes) and is developing using the LotusScript language. <br><a name="habracut"></a><br>  Some terminology to be used in the article: <br><br><ul><li>  An application is an IBM Notes / Domino database or collection of databases if they are a single logical unit. </li><li>  The client is a fat client, IBM (Lotus) Notes software. </li><li>  Server - IBM Domino server software. </li></ul><br>  I'll start by describing how the development looks, so that everyone can look at themselves.  This, in the first place, is about writing applications for a fat client using @-formulas and the LotusScript language.  Both languages ‚Äã‚Äãare scripted, and you can write code almost everywhere: in events and actions of UI objects (such as forms and views), in libraries (only for LotusScript language), agents, and other elements of the base design.  In addition, for each event and action, you can independently select the language in which to write.  In the end, if you do not have some approach to the organization of the code, it turns out a terrible noodle-like porridge from the code scattered throughout all imaginable and inconceivable places.  And now we add to this a large zoo of applications, and, usually, a small staff of specialists. <br><br>  I was vaccinated (for which I am very grateful) a certain approach to writing code, which I later developed.  The result was a whole system that talks not only about where to write, but how to write.  If in brief: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  all business logic is written in LotusScript, using @ formulas is minimal; </li><li>  all code is in libraries, and is divided into: <br><br><ul><li>  code that can be used both on the server and on the client; </li><li>  code that can be used exclusively on the client; </li></ul><br></li><li>  in visual elements (forms, representations) only calls to the library code are used, and, in the overwhelming majority, single-line ones; </li><li>  maximum use of object and minimum use of procedural features of the LotusScript language. </li></ul><br>  So what's the deal with unit testing?  The more complex, multi-link system is obtained, the more difficult it is to keep all its components in mind.  Inevitably, edits in one place lead to breakdowns in another.  Often, a large number of options for what is happening, the number of parameters and dependencies with limited resources, make it almost impossible to manually test all variations.  You can not dismiss the fear of change, because it is not always possible to remember, and even more to know the features of the code that underlies.  The presence of tests can both delineate the boundaries of the interactions, as well as guarantee the performance check.  Yes, this is an additional effort to cover the tests, their preparation, but, as it seems to me, they are worth it. <br><br>  A google companion who assisted in finding the means of unit testing for IBM Notes / Domino under the LotusScript language resulted in only one very old version of the project on <a href="">OpenNTF.org</a> .  In general, the idea that was spinning in my head was similar, but the implementation promised a few more.  Therefore, it was decided to write my own, not afraid of this word, the framework for unit testing <s>with blackjack and courtesans is</s> quite flexible and extensible. <br><br>  For the basis of building the test logic, I took the usual for any (probably) framework for unit-testing: a class with test methods.  These tests should be collected in a bunch and chased away.  So, in my head made some list of what is needed for the minimum set: <br><br><ol><li>  tests will be written in the form of class methods; </li><li>  tests will run the agent; </li><li>  when writing tests, you will need a set of checks (asserts, assert); </li><li>  as part of the test run, test success statistics should be maintained and the string displayed in the test where the error occurred. </li></ol><br>  Some aspects and assumptions that were made in the design of implementation: <br><br><ul><li>  LotusScript has neither reflection nor annotations in its arsenal, which means that it will be necessary to explicitly indicate which methods are test methods.  Variants, for example, with parsing the library with test classes were swept away, at least for the first stage. </li><li>  Minimum set of checks: <br><br><ul><li>  comparison of expression with truth; </li><li>  a lie; </li><li>  equality comparison.  Since  the question of equality is a context-sensitive thing, an object will be passed to the equality comparison method.  The class of this object must be inherited from the interface class (there are no pure interfaces in LotusScript) with one public method that returns a logical value; </li><li>  error checking, namely, the error code. </li></ul></li></ul><br>  When implementing the question arose: how to fix the statistics?  Again, there is no means of reflection and annotations, which means: <br><br><ul><li>  or wrap each test method in the agent that runs them with a code with statistics; </li><li>  or enter it into the test method itself. </li></ul><br>  Decided to go the second way.  As a result, the AbstractTest class was born with two public methods: BeginTest (TEST_NAME), EndTest (TEST_NAME).  Why public?  This was done for convenience, due to the features of the built-in IDE based on Eclipse: private methods of the superclass are visible to descendants and are available for redefinition, but they are not included in the hints of the IDE itself.  The pattern of each test method for a successful script looks like this: <br><br><pre><code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span> TestMethod() <span class="hljs-keyword"><span class="hljs-keyword">On</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Error</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GoTo</span></span> ErrorHandler <span class="hljs-keyword"><span class="hljs-keyword">Const</span></span> FuncName = <span class="hljs-string"><span class="hljs-string">"TestClassName.TestSubName ()"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Me</span></span>.BeginTest(funcName) <span class="hljs-comment"><span class="hljs-comment">'     Call Me.EndTest(funcName) GoTo endh ErrorHandler: Error Err, "(" &amp; DESIGN &amp; ") " &amp; FuncName &amp; ", line " &amp; Erl &amp; Chr(10) &amp; Error$ endh: End Sub</span></span></code> </pre> <br>  For test methods with the expected error, it is slightly different and looks like this: <br><br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span> TestError() <span class="hljs-keyword"><span class="hljs-keyword">On</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Error</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GoTo</span></span> ErrorHandler <span class="hljs-keyword"><span class="hljs-keyword">Const</span></span> FuncName = <span class="hljs-string"><span class="hljs-string">"DemoTest.TestAssertErrorExample ()"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Me</span></span>.BeginTest(funcName) <span class="hljs-comment"><span class="hljs-comment">'     On Error ERROR_CODE_TO_TEST GoTo AssertErrorHandler ',    ,     GoTo endh AssertErrorHandler: Call Me.EndTest(funcName) Resume endh ErrorHandler: Error Err, "(" &amp; DESIGN &amp; ") " &amp; FuncName &amp; ", line " &amp; Erl &amp; Chr(10) &amp; Error$ endh: End Sub</span></span></code> </pre> <br>  From these reflections, a test context was born that stores test runtime information: <br><br><ul><li>  data on the status of passing tests; </li><li>  the ability to add tests and status changes; </li><li>  logging </li></ul><br>  The class responsible for running the tests has undergone standardization.  If you minimize the code, it consists of the main Run () method and the method that should be overridden in the agent that runs the DoRunTests () tests.  The DoRunTests method should just contain the creation of test classes and a call to the corresponding test methods: <br><br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Class</span></span> AbstractTestRunner <span class="hljs-keyword"><span class="hljs-keyword">Public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> Run() <span class="hljs-keyword"><span class="hljs-keyword">On</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Error</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GoTo</span></span> ErrorHandler <span class="hljs-keyword"><span class="hljs-keyword">Const</span></span> FuncName = <span class="hljs-string"><span class="hljs-string">"AbstractTestRunner.Run ()"</span></span> [...] <span class="hljs-keyword"><span class="hljs-keyword">Call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Me</span></span>.DoRunTests() [...] <span class="hljs-keyword"><span class="hljs-keyword">GoTo</span></span> endh ErrorHandler: <span class="hljs-keyword"><span class="hljs-keyword">Error</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Err</span></span>, <span class="hljs-string"><span class="hljs-string">"("</span></span> &amp; DESIGN &amp; <span class="hljs-string"><span class="hljs-string">") "</span></span> &amp; FuncName &amp; <span class="hljs-string"><span class="hljs-string">", line "</span></span> &amp; Erl &amp; <span class="hljs-built_in"><span class="hljs-built_in">Chr</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) &amp; <span class="hljs-keyword"><span class="hljs-keyword">Error</span></span>$ endh: <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span> DoRunTests() <span class="hljs-keyword"><span class="hljs-keyword">On</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Error</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GoTo</span></span> ErrorHandler <span class="hljs-keyword"><span class="hljs-keyword">Const</span></span> FuncName = <span class="hljs-string"><span class="hljs-string">"AbstractTestRunner.RunTests ()"</span></span> <span class="hljs-comment"><span class="hljs-comment">'Override GoTo endh ErrorHandler: Call Me.TestFailed(Error$) Resume Next endh: End Sub End Class</span></span></code> </pre> <br>  Everything is simple with checks.  Only a comparison method for equality can deserve a small separate attention: <br><br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span> Equals(matcher As IMatcher) <span class="hljs-keyword"><span class="hljs-keyword">On</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Error</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GoTo</span></span> ErrorHandler <span class="hljs-keyword"><span class="hljs-keyword">Const</span></span> FuncName = <span class="hljs-string"><span class="hljs-string">"Assert.Equals ()"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> Matcher.Matches() <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Me</span></span>.Throwerror(funcName) <span class="hljs-keyword"><span class="hljs-keyword">GoTo</span></span> endh ErrorHandler: <span class="hljs-keyword"><span class="hljs-keyword">Error</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Err</span></span>, <span class="hljs-string"><span class="hljs-string">"("</span></span> &amp; DESIGN &amp; <span class="hljs-string"><span class="hljs-string">") "</span></span> &amp; FuncName &amp; <span class="hljs-string"><span class="hljs-string">", line "</span></span> &amp; Erl &amp; <span class="hljs-built_in"><span class="hljs-built_in">Chr</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) &amp; <span class="hljs-keyword"><span class="hljs-keyword">Error</span></span>$ endh: <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Sub</span></span></code> </pre> <br>  As mentioned above, it accepts an object whose class is inherited from the interface class (IMatcher), which has only one public method Matches () as boolean. <br><br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Class</span></span> IMatcher <span class="hljs-keyword"><span class="hljs-keyword">Public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> Matches() As Boolean <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Class</span></span></code> </pre> <br>  It also implemented several simple matchers that were moved to a separate library: <br><br><ul><li>  SimpleValueMatcher is a simple comparison of 2 values.  Values ‚Äã‚Äãare accepted with type Variant. <br></li><li>  DocumentItemsMatcher - a comparison of the specified fields in two specified documents.  The comparison is made for the presence of a field, for type and value. </li><li>  DatabaseMatcher - a comparison of two databases: replica id, path and name.  Essence - we deal with the same base.  It is advisable here to add another comparison to the server. </li><li>  DocumentMatcher - comparison of 2 documents for identity: they are in the same database, have the same UniversalId, match in all fields. </li></ul><br>  The project is publicly available on <a href="https://github.com/MrArtemAA/DUnit">GitHub</a> , distributed under the Apache 2.0 license and provided with detailed installation and use documentation.  Also, the project was placed on the most popular site for domino- <a href="">vodov</a> - <a href="">Openntf.org</a> . <br><br>  As a development I see: <br><br><ol><li>  simplify the writing of tests so that you can get rid of a number of conventions when they are created; </li><li>  get rid of the need to manually create test classes and call test methods; </li><li>  create a centralized application to run and collect test results. </li></ol><br>  It so happened that the system, which showed all the need to create a unit-test for Domino and prompted me to write the presented tool, is currently not covered by tests.  However, I am preparing another project that should initially become public.  The first version is ready and 100% covered by tests created on the framework described.  I am going to apply statistics of passing tests to each release. <br><br>  Constructive ideas, suggestions and comments are always welcome! </div><p>Source: <a href="https://habr.com/ru/post/346708/">https://habr.com/ru/post/346708/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346698/index.html">Work with AVRO format in python - fastavro library</a></li>
<li><a href="../346700/index.html">Undocumented line tag "This is a translation, stupid!" On Habr√©</a></li>
<li><a href="../346702/index.html">We create a portrait of Central Asia that really works: the rules, methods, tips and analysis of errors</a></li>
<li><a href="../346704/index.html">Creating parametric database objects in nanoCAD Mechanics</a></li>
<li><a href="../346706/index.html">Java conference with English roots. XXXL size overview</a></li>
<li><a href="../346710/index.html">What can we learn from the four-color theorem in software development</a></li>
<li><a href="../346714/index.html">News from the world of OpenStreetMap ‚Ññ390 (01/02/2018-02.01.2018)</a></li>
<li><a href="../346718/index.html">Typescript. Object type</a></li>
<li><a href="../346720/index.html">Robots inside the office: what can be done in 3 days instead of six months</a></li>
<li><a href="../346722/index.html">PLF launch - how to launch a product so that someone will know about it</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>