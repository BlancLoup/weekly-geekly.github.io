<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Loading currency rates into the R / 3 system using ABAP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I work as an ABAP programmer at one very large industrial enterprise. I am mainly engaged in support and maintenance, because in work there are often ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Loading currency rates into the R / 3 system using ABAP</h1><div class="post__text post__text-html js-mediator-article">  I work as an ABAP programmer at one very large industrial enterprise.  I am mainly engaged in support and maintenance, because in work there are often lulls.  I decided to write an article about ABAP. <br><br>  When I got a job in R / 3, I already saw and could do something.  ABAP / 4 we studied at the institute.  They showed the basic syntax, and a couple of programs wrote simple ones. <br><br>  The first week at work, I read a book on ABAP and missed frankly.  After some time, I was finally given the assignment. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Who are interested in welcome. <br><a name="habracut"></a><br>  As it turned out, the task was aimed at solving a fairly common problem.  Namely, the download rates in the system from the site of the central bank. <br><br>  In our company there is a person who is engaged in the introduction of these courses. <br><br>  How it worked before my intervention.  The user went to the site of the centro-bank, copied the plate with the courses, then the script written in python, the case was brought into the desired form, and then the user started the transaction in R / 3 and fed the program the resulting text file.  Extremely tricky operation. <br><br>  I started to work. <br><br>  At first, I looked at the central bank website and found out that it is possible to pick up exchange rates as an XML file from the site.  I decided not to eat the brain for myself and write to start a program that will eat this file and shove it into the inner table. <br>  R / 3 knows how to eat XML files, but I didn‚Äôt manage to figure out how to use the Function Module for working with XML and decided to write my bicycle, it was young.  By the method of not frail instillation into the Internet, a help and a smart book, I found a FM that reads a file into an internal table.  The result is such a form: <br><br><pre><code class="java hljs">*    . form get_file tables table_name using file_name like rlgrap-filename. call function <span class="hljs-string"><span class="hljs-string">'WS_UPLOAD'</span></span> exporting CODEPAGE = <span class="hljs-string"><span class="hljs-string">' '</span></span> FILENAME = FILE_NAME FILETYPE = <span class="hljs-string"><span class="hljs-string">'ASC'</span></span> tables DATA_TAB = TABLE_NAME exceptions CONVERSION_ERROR = <span class="hljs-number"><span class="hljs-number">1</span></span> FILE_OPEN_ERROR = <span class="hljs-number"><span class="hljs-number">2</span></span> FILE_READ_ERROR = <span class="hljs-number"><span class="hljs-number">3</span></span> INVALID_TYPE = <span class="hljs-number"><span class="hljs-number">4</span></span> NO_BATCH = <span class="hljs-number"><span class="hljs-number">5</span></span> OTHERS = <span class="hljs-number"><span class="hljs-number">6</span></span>. *   . <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> sy-subrc. when <span class="hljs-number"><span class="hljs-number">1</span></span>. write <span class="hljs-string"><span class="hljs-string">'  .'</span></span>. exit. when <span class="hljs-number"><span class="hljs-number">2</span></span>. write <span class="hljs-string"><span class="hljs-string">'  .'</span></span>. exit. when <span class="hljs-number"><span class="hljs-number">3</span></span>. write <span class="hljs-string"><span class="hljs-string">'  .'</span></span>. exit. when <span class="hljs-number"><span class="hljs-number">4</span></span>. write <span class="hljs-string"><span class="hljs-string">'  .'</span></span>. exit. when <span class="hljs-number"><span class="hljs-number">5</span></span>. write <span class="hljs-string"><span class="hljs-string">'Front-End Function Cannot Be Executed in Backgrnd.'</span></span>. exit. when <span class="hljs-number"><span class="hljs-number">6</span></span>. write <span class="hljs-string"><span class="hljs-string">' .'</span></span>. exit. endcase. endform.</code> </pre> <br><br>  FM issues a TABLE_NAME sign in which each line is a line of the downloaded file.  There was a question as from lines of a type: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Valute</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ID</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"R01010"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NumCode</span></span></span><span class="hljs-tag">&gt;</span></span>036<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NumCode</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CharCode</span></span></span><span class="hljs-tag">&gt;</span></span>AUD<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CharCode</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Nominal</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Nominal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Value</span></span></span><span class="hljs-tag">&gt;</span></span>27,0138<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Valute</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Get the currency code, denomination and the actual rate.  At the previous work I was engaged in web development, I didn‚Äôt achieve much success in this field, but I got some useful knowledge.  In general, during the next immersion in the help, I found out that in the ABAP language I can work with regular expressions.  Without hesitation, I built a structure of the type: <br><br><pre> <code class="java hljs">*    . read table valuta into valuta index <span class="hljs-number"><span class="hljs-number">2</span></span>. RE-PLACE REGEX <span class="hljs-string"><span class="hljs-string">'(\W\w+\W\w+\W+)(\d+)(\D)(\d+)(\D)(\d+)(\W+\w+\W+\w+.\w+)'</span></span> IN valuta WITH `$<span class="hljs-number"><span class="hljs-number">2</span></span>.$<span class="hljs-number"><span class="hljs-number">4</span></span>.$<span class="hljs-number"><span class="hljs-number">6</span></span>`. <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sy-subrc = <span class="hljs-number"><span class="hljs-number">0</span></span>. date = valuta. endif. *     . loop at l_val into l_val. clear val. <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> l_val-waers &lt;&gt; <span class="hljs-string"><span class="hljs-string">'UE'</span></span>. *       XML   . concatenate <span class="hljs-string"><span class="hljs-string">'&lt;CharCode&gt;'</span></span> l_val-waers <span class="hljs-string"><span class="hljs-string">'&lt;/CharCode&gt;'</span></span> into s_val. find s_val in table valuta match line index. <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sy-subrc = <span class="hljs-number"><span class="hljs-number">0</span></span>. val-kodv = l_val-waers. val-datan = date. add <span class="hljs-number"><span class="hljs-number">1</span></span> to index. read table valuta into valuta index index. *   . REPLACE REGEX <span class="hljs-string"><span class="hljs-string">'(\W+\w+\W)(\d+)(\W+\w+\W)'</span></span> IN valuta WITH <span class="hljs-string"><span class="hljs-string">'$2'</span></span>. nom = valuta. add <span class="hljs-number"><span class="hljs-number">2</span></span> to index. read table valuta into valuta index index. *     . RE-PLACE REGEX <span class="hljs-string"><span class="hljs-string">'(\W+\w+\W)(\d+)(\D)(\d+)(\W+\w+\W)'</span></span> IN valuta WITH <span class="hljs-string"><span class="hljs-string">'$2.$4'</span></span>. <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sy-subrc = <span class="hljs-number"><span class="hljs-number">0</span></span>. tmp = valuta / nom. val-kyrsp = tmp. replace all occurrences of <span class="hljs-string"><span class="hljs-string">'.'</span></span> in val-kyrsp with <span class="hljs-string"><span class="hljs-string">','</span></span>. *    . append val. endif. <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>. s_val = text-wv1. replace <span class="hljs-string"><span class="hljs-string">'&amp;1'</span></span> in s_val with l_val-waers. message s_val type <span class="hljs-string"><span class="hljs-string">'I'</span></span>. endif. endif. endloop.</code> </pre><br><br>  Sloppy, but then I was proud of myself, when the whole thing worked. <br><br>  By this time, I was given a login and password to access the Internet.  And the chief offered to look towards the HTTP_GET function module.  But unfortunately there was no documentation on this module in our system, I had to guess by touch how to work with this miracle. <br><br>  I tried to feed the URL password and login to the proxy, but there was no result.  After several experiments, I determined that the proxy server does not allow access to the outside world. <br><br>  I had to dig into Google again and forums.  On one of the forums I found a solution.  It turns out that HTTP_GET is crookedly communicating with proxies and offering a solution. <br><br>  The proxy data must be entered in the THTTP table, the function module 'HTTP_PROXY_CONFIG' must be entered in the EXITFUNC field of this table (it determines if a proxy is required to connect to the URL, if yes, then the data from the table string is transmitted). <br><br>  Well, the function module call itself looks like this for me: <br><br><pre> <code class="java hljs">call function <span class="hljs-string"><span class="hljs-string">'HTTP_GET'</span></span> exporting absolute_uri = url blankstocrlf = <span class="hljs-string"><span class="hljs-string">'x'</span></span> timeout = <span class="hljs-number"><span class="hljs-number">500</span></span> rfc_destination = <span class="hljs-string"><span class="hljs-string">'SAPHTTP'</span></span> tables response_entity_body = file_table response_headers = file_headers exceptions connect_failed = <span class="hljs-number"><span class="hljs-number">1</span></span> timeout = <span class="hljs-number"><span class="hljs-number">2</span></span> internal_error = <span class="hljs-number"><span class="hljs-number">3</span></span> tcpip_error = <span class="hljs-number"><span class="hljs-number">4</span></span> data_error = <span class="hljs-number"><span class="hljs-number">5</span></span> system_failure = <span class="hljs-number"><span class="hljs-number">6</span></span> communication_failure = <span class="hljs-number"><span class="hljs-number">7</span></span>.</code> </pre><br><br>  After all the manipulations and dances with the R / 3 tambourine, I began to break into the site and collect the necessary data in the internal table.  The program took data from the site, then from the resulting label, codes and exchange rates are pulled out using regular expressions, and then all this is entered into the system by batch input. </div><p>Source: <a href="https://habr.com/ru/post/150112/">https://habr.com/ru/post/150112/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../150107/index.html">All that surrounds us - objects</a></li>
<li><a href="../150108/index.html">When is the best time to hold technical conferences?</a></li>
<li><a href="../150109/index.html">How I learned to program myself in 8 weeks</a></li>
<li><a href="../150110/index.html">Webasyst Photo: an application for organizing and publishing photos</a></li>
<li><a href="../150111/index.html">Presented a working prototype of Khovbika</a></li>
<li><a href="../150115/index.html">How the London Olympics were broadcast through the cloud</a></li>
<li><a href="../150116/index.html">Black Isle Studios revived</a></li>
<li><a href="../150118/index.html">Hard prioritization, or the first 5 steps to an excellent application for Windows 8. Functionality</a></li>
<li><a href="../150119/index.html">Tesla's laboratory will be turned into a museum - with the help of crowdfunding almost a million dollars was collected</a></li>
<li><a href="../150120/index.html">How to conduct business in the dark light of a crisis of confidence?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>