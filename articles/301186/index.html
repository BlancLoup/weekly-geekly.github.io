<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Magento 2: cookies, registry, session</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sometimes when processing requests in web applications, there is a need for short-term storage of intermediate information. A cookie mechanism is used...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Magento 2: cookies, registry, session</h1><div class="post__text post__text-html js-mediator-article"><p>  Sometimes when processing requests in web applications, there is a need for short-term storage of intermediate information.  A cookie mechanism is used to write information to the client‚Äôs browser, a registry is used to save data within one request, and a session is used to save data between requests.  Under the cut - examples for Magento 2. </p><a name="habracut"></a><br><h2>  Cookies </h2><br><p>  <a href="https://github.com/magento/magento2/blob/develop/lib/internal/Magento/Framework/Stdlib/CookieManagerInterface.php">CookieManagerInterface</a> </p><br><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CookieHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> COOKIE_REFERRAL = <span class="hljs-string"><span class="hljs-string">'referral'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $_cookieManager; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( \Magento\Framework\Stdlib\CookieManagerInterface $cookieManager )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_cookieManager = $cookieManager; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCookie</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $result = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_cookieManager-&gt;getCookie(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::COOKIE_REFERRAL, <span class="hljs-string"><span class="hljs-string">'default value'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $result; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setCookie</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// set public cookie (can be accessed by JS) $meta = new \Magento\Framework\Stdlib\Cookie\PublicCookieMetadata(); $meta-&gt;setPath('/'); // use meta to define cookie props: domain, duration, security, ... $meta-&gt;setDurationOneYear(); $this-&gt;_cookieManager-&gt;setPublicCookie(self::COOKIE_REFERRAL, $value, $meta); // or set HTTP only cookie (is not accessible from JavaScript ) /** @var \Magento\Framework\Stdlib\Cookie\SensitiveCookieMetadata $meta */ $meta = null; // use meta to define cookie props: domain, duration, security, ... $this-&gt;_cookieManager-&gt;setSensitiveCookie(self::COOKIE_REFERRAL, $value, $meta); } }</span></span></code> </pre> <br><h2>  Registry </h2><br><p>  <a href="https://github.com/magento/magento2/blob/develop/lib/internal/Magento/Framework/Registry.php">The registry</a> makes it possible to use the "global variables" in Magento (although the global variables themselves are not welcomed by the modern programmer community).  The registry throws an exception when trying to write data to it with an already existing key (if the parameter $ graceful = false) or simply ignores overwriting (if $ graceful = true): </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RegistryHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> REG_REFERRAL = <span class="hljs-string"><span class="hljs-string">'referral'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $_registry; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( \Magento\Framework\Registry $registry )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_registry = $registry; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// save value into the registry $value = 'u54321'; $graceful = true; // don't throw exception if variable with the same name exists $this-&gt;_registry-&gt;register(self::REG_REFERRAL, $value, $graceful); // get value from registry $registered = $this-&gt;_registry-&gt;registry(self::REG_REFERRAL); // replace value if ($this-&gt;_registry-&gt;registry(static::REG_REFERRAL)) { $this-&gt;_registry-&gt;unregister(static::REG_REFERRAL); } $this-&gt;_registry-&gt;register(static::REG_REFERRAL, $value); } }</span></span></code> </pre> <br><p>  For some reason, Magento does not provide a method for rewriting any value in the registry, although, in my opinion, this function is a logical continuation of the register / unregister pair. </p><br><h2>  Session </h2><br><p>  <a href="https://github.com/magento/magento2/blob/develop/lib/internal/Magento/Framework/Session/SessionManagerInterface.php">SessionManagerInterface</a> allows <a href="https://github.com/magento/magento2/blob/develop/lib/internal/Magento/Framework/Session/SessionManagerInterface.php">you</a> to write and read data to / from the storage ( <a href="https://github.com/magento/magento2/blob/develop/lib/internal/Magento/Framework/Session/StorageInterface.php">StorageInterface</a> ).  The storage is a <a href="https://github.com/magento/magento2/blob/develop/lib/internal/Magento/Framework/DataObject.php">DataObject</a> , so get / set accessors are working for the session (through the __call magic method): </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SessionHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $_sessionManager; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( \Magento\Framework\Session\SessionManagerInterface $sessionManager )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_sessionManager = $sessionManager; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// save variable with name 'referral_code' into the session (using 'magic' methods) $this-&gt;_sessionManager-&gt;setReferralCode('u54321'); // restore saved value from the session $saved = $this-&gt;_sessionManager-&gt;getReferralCode(); } }</span></span></code> </pre> <br><p>  In this example, the default namespace is used to save data, so there is a chance that names will intersect with the developers of other modules.  To reduce this probability, you can use prefixes in variable names, create miraculous method names like <code>setYourCompanyNameReferralCode($data)</code> , or use your own <a href="">implementations of</a> SessionManager and its associated SessionStorage with a different namespace. </p><br><p>  PS <br>  Thanks <a href="https://habrahabr.ru/users/isxam/" class="user_link">isxam</a> for additions and clarifications. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/301186/">https://habr.com/ru/post/301186/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../301174/index.html">Generics in Kotlin vs. Generics in JAVA: similarities, differences, features</a></li>
<li><a href="../301176/index.html">R in Microsoft Azure to win the hackathon. Instructions for use</a></li>
<li><a href="../301178/index.html">Exploration and engineering: 3D-models of buildings, junctions and quarries by photo</a></li>
<li><a href="../301180/index.html">Digest of recent advances in cryptography. Zero release</a></li>
<li><a href="../301182/index.html">[St. Petersburg, Announcement] Meeting with Andrey Pangin - Everything you wanted to know about stack-traces and hip dumps</a></li>
<li><a href="../301188/index.html">10 types of insane customers</a></li>
<li><a href="../301190/index.html">We control the computer from an Android device</a></li>
<li><a href="../301192/index.html">[Terraform + SaltStack] Cooking PrestoDB Cluster in a Pressure Cooker (Part # 1)</a></li>
<li><a href="../301194/index.html">How to create eye-catching images if you are not a designer</a></li>
<li><a href="../301196/index.html">Criminals infecting ATMs with a virus caught hot</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>