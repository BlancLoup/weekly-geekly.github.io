<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Parser RSS to bash for Lostfilm: gentle mode for RSS server, check downloaded</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day! 
 Once, thanks to this topic, a good parser for Lostfilm was written. Now I would like to share my own refinement of the script related to c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Parser RSS to bash for Lostfilm: gentle mode for RSS server, check downloaded</h1><div class="post__text post__text-html js-mediator-article"> Good day! <br>  Once, thanks to <a href="http://habrahabr.ru/blogs/p2p/87042/">this</a> topic, a good parser for Lostfilm was written.  Now I would like to share my own refinement of the script related to changing the format of links on Lostfilm, adding a check for updating the tape and checking the downloaded one. <br><br>  First of all, to reduce the load on the RSS server, when requesting a tape using <b>wget,</b> you need to use "If-Modified-Since:".  Then, in the absence of updates, we will not download and process the entire tape.  This approach will reduce the load on the server (and a little on our computer). <br>  Use the following command option: <br><br> <code>#   If-Modified-Since <br> lastmod="$( grep -m 1 Last-Modified response.out )" <br> <br> header="If-Modified-Since:"${lastmod#*:} <br></code> <br><a name="habracut"></a><br>  The <b>response.out</b> file stores the last response of the RSS server. <br>  Using <b>$ {lastmod # *:}</b> from the Last-Modified line found in the last server's answer, we cut off all unnecessary to ":". 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The title is ready, now we will create filters to search for the necessary series: <br><br> <code>movies='House.MD|IT.Crowd|Persons.Unknown|Legend.of.the.Seeker|Leverage|Warehouse.13|Futurama' <br> <br> quality='\.720p\.|\.HD\.|Persons.Unknown|Legend.of.the.Seeker|IT.Crowd' <br></code> <br>  <b>movies</b> contains a list of downloadable TV shows.  But on Lostfilm they usually come in two quality versions, and I personally try to download everything in high quality.  So you need an additional filter - <b>quality</b> .  But not all serials were released in 720p or HD, so we will add them to the end of the filter so that they can also pass the quality check! <br><br>  With the filters finished, proceed to processing the tape.  In the topic I mentioned at the beginning, the construction of regular expressions for filters and the wget command option is considered in great detail, so I omit them. <br>  The command uses the prepared header and the server's response is stored right there in response.out.  By the way, if response.out is missing (first launch or forced update), then nothing terrible will happen. <br><br> <code><a href=""></a> wget -vS -O - --header="$header" www.lostfilm.tv/rssdd.xml -o response.out | grep -ioe "http.*torrent" | egrep -i "$movies" | egrep "$quality" | while read link; <br> do <br> #    "&amp;amp;"  "&amp;" <br> link="${link/&amp;amp;/&amp;}" <br></code> <br>  For convenience, save separately the name of the torrent (cut everything to "&amp;").  We need it to check the downloaded and save the torrent file. <br> <code>name="${link#*&amp;}" <br></code> <br>  Now we check by the name the presence of the file in the downloaded directory.  If there is no such file, download by reference and save with this name.  Then (optionally) copy our client's auto-load directory. <br> <code>#     ./Downloaded,   <br> if [ ! -e Downloaded/$name ] <br> then <br> wget -q --header "Cookie: uid=123456; pass=xxxxxxxxxxxx; usess=xxxxxxxxxxx" $link -O "Downloaded/$name" <br> cp "$name" "$path_to_your_autoload_dir/$name" <br> fi <br> done <br></code> <br>  <b>Cookies</b> for Losstfilm can be ripped out of any browser, and the <b>usess</b> parameter is in your profile at <a href="http://www.lostfilm.tv/">www.lostfilm.tv</a> <br><br>  Here is the full version of my script: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash cd $your/rssdownloader/dir #   If-Modified-Since lastmod="$( grep -m 1 Last-Modified response.out )" #  header header="If-Modified-Since:"${lastmod#*:} #   movies='House.MD|IT.Crowd|Persons.Unknown|Legend.of.the.Seeker|Leverage|Warehouse.13|Futurama' #   quality='\.720p\.|\.HD\.|Persons.Unknown|Legend.of.the.Seeker|IT.Crowd' wget -vS -O - --header="$header" http://www.lostfilm.tv/rssdd.xml -o response.out | grep -ioe "http.*torrent" | egrep -i "$movies" | egrep "$quality" | while read link; do link="${link/&amp;amp;/&amp;}" name="${link#*&amp;}" #     ./Downloaded,   if [ ! -e Downloaded/$name ] then wget -q --header "Cookie: uid=123456; pass=xxxxxxxxxxxx; usess=xxxxxxxxxxx" $link -O "Downloaded/$name" cp "Downloaded/$name" "$path_to_your_autoload_dir/$name" fi done</span></span></code> </pre><br>  Thanks for attention! <br>  <b>PS: I</b> realize that the code is far from ideal, I will be glad to accept tips for improvement! <br><br>  <b>Update:</b> I think that now, with all the amendments, this script can be called RTM.  Thanks to all who participated in bringing it to mind, especially <a href="http://habrahabr.ru/blogs/linux/127588/">GreyCat</a> with his detailed explanations! <br><br>  <b>Update 2:</b> If there are problems downloading the tape, <b>wget returns the</b> line we need several times.  Therefore, we take only the first found option, using the key "-m 1" (the maximum download once again the old tape). <br> <code>lastmod="$( grep -m 1 Last-Modified response.out )"</code> </div><p>Source: <a href="https://habr.com/ru/post/127588/">https://habr.com/ru/post/127588/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../127582/index.html">AviSynth + VirtualDub: Extract Audio from the Command Line</a></li>
<li><a href="../127583/index.html">Programming Windows Phone 7. Lecture 1. Introduction</a></li>
<li><a href="../127584/index.html">Grab - python library for parsing sites</a></li>
<li><a href="../127585/index.html">Taxer - concluding a tax online agreement</a></li>
<li><a href="../127587/index.html">Idea 10.5.2 released</a></li>
<li><a href="../127589/index.html">Canobuvosti, 107th edition</a></li>
<li><a href="../127590/index.html">OpenStreetMap News ‚Ññ7</a></li>
<li><a href="../127591/index.html">Opera Dragonfly 1.1</a></li>
<li><a href="../127592/index.html">My grandmother is a programmer</a></li>
<li><a href="../127593/index.html">The mechanism for the exercise of their legal rights by the owners of personal data</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>