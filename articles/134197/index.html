<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Shadow Detection Algorithm on Video</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 In this article I wanted to talk about the algorithm that allows you to share real objects and shadows on the video image. 



 This al...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Shadow Detection Algorithm on Video</h1><div class="post__text post__text-html js-mediator-article"><h2>  Introduction </h2><br>  In this article I wanted to talk about the algorithm that allows you to share real objects and shadows on the video image. <br><br><img src="https://habrastorage.org/storage1/7650ad7a/b91ad898/e3bce2c0/38f3ee9a.jpg"><br><br>  This algorithm was first implemented by me during the development of video analytics algorithms for the <a href="http://synesis.ru/ru/surveillance/products/dk-6467-enc2">MagicBox IP video server</a> , which is being developed by <a href="http://synesis.ru/ru/home">Synesis</a> , in which I currently work.  As you know, when detecting motion in a video sequence, the lighting conditions are not always perfect.  And the simplest motion detector based on the difference between the current frame and a certain averaged background will react not only to real objects, but also to virtual ones: moving shadows and light hares.  What is undesirable, as it can lead to a distortion of the shape of the detected objects and also to false alarms of the motion detector.  This is true in sunny weather, and especially in the case of variable cloudiness.  Therefore, the presence of an algorithm for the selection of shadows can have a very positive effect on the accuracy of the entire detector.  But let's look at everything in order. <br><a name="habracut"></a><br><h2>  Motion detection </h2><br>  A simple algorithm was chosen for motion detection: from the averaged background 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage1/b20145a1/37164628/f1797b2f/be05f7d0.jpg"><br><br>  pixel subtracts the current frame <br><br><img src="https://habrastorage.org/storage1/bfb6b2e6/83bd309f/bc6f2335/1c1f547f.jpg"><br><br>  And it turns out the mask, which unfortunately includes not only a real object (my hand), but also a virtual (shadow from it). <br><br><img src="https://habrastorage.org/storage1/bc595e45/d3c37d2b/5f5292b3/724b8c35.jpg"><br><br><h2>  Shadow properties </h2><br>  In order to separate the image of the real object from the image of the shadow (light hare), you need to select a set of properties (criteria) that they have different.  The most important feature of the image of the shadow, which distinguishes it from the image of a real object is transparency.  And indeed, through the shadow, the features of the background on which it overlaps clearly appear, although its overall illumination varies considerably.  Therefore, to separate the real object and the shadow, you need to check the object for transparency, for which you should analyze the correlation between the original image and the background, taking into account changes in illumination.  To do this, there are two fairly quick method, which we consider below. <br><br><h2>  Method 1: Gradient Direction </h2><br>  The direction of the gradient has the remarkable property that is invariant to the illumination of the object.  Indeed, if the left pixel is darker than the right, then this ratio will be maintained at any uniform illumination.  Therefore, if we compare the deviation of the gradient direction for the background and the current frame with a certain threshold, then we can, in theory, divide the points belonging to the real object and the shadow. <br><br><img src="https://habrastorage.org/storage1/be14e57f/ae8c94b0/f74acfc3/444d0195.jpg"><br><br>  In reality, due to noise, this method gives a significant error, which is clearly seen on the ghost image. <br><br><h2>  Method 2: Relative Correlation </h2><br>  For a completely uniform darkening of the background, for each of its points the condition is satisfied: <br><br>  Current [x, y] = k * Background [x, y], <br><br>  where k is some dimming factor, the same for the whole image.  In reality, blackout is of course not uniform for the entire image, but with a high degree of confidence it can be considered uniform in a certain neighborhood of a given point.  Therefore, if the deviation from equality <br><br>  Current [x, y] * AverageBackground [x, y] = Background [x, y] * AverageCurrent [x, y] <br><br>  does not exceed a certain threshold for the neighborhood of the point [x, y], then it can be considered a shadow. <br><br><img src="https://habrastorage.org/storage1/beeb39ab/3c4c6665/c207815e/790dc5d0.jpg"><br><br>  However, as practice shows, this method also has a significant error, as significant areas of a real object are recognized as a shadow. <br><br><h2>  Method 3: Mixed Method </h2><br>  The logical next step is to combine these two methods.  If the results of the previous two methods are combined (the shadow will count only those points that are the same for both methods), then we get the following result: <br><br><img src="https://habrastorage.org/storage1/e37806a7/da0e9044/89d568e0/9133843a.jpg"><br><br>  Of course, in this case too, a substantial error of both types is preserved: a part of a real object is considered a shadow, and vice versa.  However, from the statistical point of view, the areas of the shadow and the real object are already well distinguished.  If we apply the averaging filter, we can clearly separate the shadow area and the real object area: <br><br><img src="https://habrastorage.org/storage1/7650ad7a/b91ad898/e3bce2c0/38f3ee9a.jpg"></div><p>Source: <a href="https://habr.com/ru/post/134197/">https://habr.com/ru/post/134197/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../134190/index.html">GLPI + Fusion Inventory</a></li>
<li><a href="../134192/index.html">All your impressions about dishes and tastes in Evernote Food</a></li>
<li><a href="../134194/index.html">Color Schemes in Vim</a></li>
<li><a href="../134195/index.html">DARPA is looking for developers of mobile applications for military purposes.</a></li>
<li><a href="../134196/index.html">Our new app Evernote Hello helps you to remember all</a></li>
<li><a href="../134198/index.html">Curiosity to the SDK will bring</a></li>
<li><a href="../134200/index.html">Speech by Stallman in Moscow - how our team leader bought a plush toy for 12k</a></li>
<li><a href="../134201/index.html">Backward compatibility in iOS SDK</a></li>
<li><a href="../134202/index.html">How we designed the Toozla mobile guide for Symbian and MeeGo</a></li>
<li><a href="../134203/index.html">HTC Flyer - tablet analysis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>