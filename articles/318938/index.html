<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Game HellWorm. Development history</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day! I would like to tell you about my experience of creating a mobile game on Unity called HellWorm. From the name you can understand that the g...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Game HellWorm. Development history</h1><div class="post__text post__text-html js-mediator-article">  Good day!  I would like to tell you about my experience of creating a mobile game on Unity called HellWorm.  From the name you can understand that the game is about a worm.  We crawl, eat coins, do not crash into obstacles.  It would seem a clone of the classic game, on which most of us grew up.  But, in fact, the parallel with the snake ends here. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/bcd/075/966/bcd075966ac746fb974cfc83c1ff71d5.png"></div><br>  The game also positions itself as an endless runner, in which there is a constant movement forward, without the ability to turn off the vertical route.  And with all this, the worm itself can somehow wriggle (yes, yes, and even creep through itself).  As a result, I would like to focus on the difficulties that I experienced trying to realize the movement of such a simple character. <br><a name="habracut"></a><br>  Management is quite simple and is described by only one phrase: <br>  <i>‚ÄúWherever you click, it crawls there‚Äù.</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/4cc/6c7/ccd/4cc6c7ccde9e43b9a4814530b1841b83.gif"></div><br>  The first implementation of the motion algorithm is clearly demonstrated in the diagram below. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/files/02a/9ee/da9/02a9eeda9af34250bdcad25ed6e8d8a7.PNG"></div><br>  The essence of the movement is as follows: with the speed n the length of the first segment (head) increases and the length of the last (tail) decreases with the same speed, and at the moment of pressing the screen a new segment is created.  The connection goes along the central lines of the rectangles.  And at the joints, to smooth the cuts, placed a circle of radius equal to the width of the segment.  However, this method, unfortunately, did not fit, since the visual style of the game does not imply the use of rounded corners.  I had to reinvent the wheel further, so please read the following implementation. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/54f/c5e/340/54fc5e340f68408a82b63f44db4ae8e3.PNG"></div><br>  Docking occurs not along the central lines, but along the corners of the segments: along the left or along the right, where the side is selected depending on which side of the new point P lies on the side of the line AB <br><br><blockquote>  <i>(Bx - Ax) * (Py - Ay) - (By - Ay) * (Px - Ax), if the expression&gt; 0 then the point P lies on the left side.</i> </blockquote><br>  How to find the coordinate of the docking point, I will not paint, because  nothing special about it, simple geometry.  Better to tell you more about the approach itself. <br><br>  I want to immediately say that in this case the maximum angle between the segments should be no more than 90 degrees, otherwise, as you can guess, the corners will come out.  Therefore, during steep (&gt; 90 degrees) turns, a transition segment is added. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/bea/49d/87b/bea49d87b78f42ddba2fe479da3288e5.PNG"></div><br>  When a player clicks on the screen, the angle the worm must rotate is remembered and as soon as the head segment reaches the allowable length, a new segment is created at a given angle, provided that it is no more than 90 degrees, otherwise a transition segment is created, and when it reaches a given length, then there is a final turn.  This strategy allows you to avoid chaotic distortions with a very quick touch on the screen, and also makes the movement more natural.  I would like to note that there are no visual delays in the management at all. <br><br>  The experiments ended and the development of the game continued: various types of obstacles were added, level generation, a store with skins, bonus coin mode when selecting a shard, changing the color of the environment depending on the distance traveled, etc.  During this time, my eyes decently ‚Äúzamililsya‚Äù and I just did not notice a misfire in my algorithm for the movement of the worm.  Namely, small jerks when changing direction.  As it turned out, the whole thing is in joining the segments at the extreme points. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/269/059/4b3/2690594b3d894d149190c625756db651.PNG"></div><br>  When creating a new segment in this way, it is not possible to connect the centers of the sides of the segments (red and blue dots in the figure).  And since the worm's head is always tied to the center point of the first segment (and the tail is tied to the center of the edge of the last one), a jerk occurs when turning, and the greater the angle of turn, the more jerk is noticeable.  Of course, at the final stages of development, it is very disappointing to deal with this, because you need to redo the whole algorithm.  But the desire to finish the project polished and without jambs took over.  It was decided to return to the first implementation of the algorithm, since  It is much simpler and more logical to calculate with respect to the broken solid line around which the body is built.  It remains to solve the problem with the joints of rectangles, namely, how to fill them. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/175/931/9d7/1759319d74fd42ab8584904307cab6b1.PNG"></div><br>  After some thought, the idea came of extending the segments towards each other to eliminate the gap. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/0f4/6ef/af7/0f46efaf79d94c4388debd96942dfc3e.PNG"></div><br>  The decision turned out to be quite working, and, surprisingly, everything worked the first time.  The mathematical steps are as follows: <br><br><ul><li>  determine which way the new segment is looking relative to the previous one (left or right) </li><li>  find the corner points B, C and the points on the other end of the segments B ', C' </li><li>  find the intersection of A lines BB 'and CC': <br><br><blockquote>  <i>Ax = ((Bx * B'y - By * B'x) * (Cx - C'x) - (Bx - B'x) * (Cx * C'y - Cy * C'x)) / (( Bx - B'x) * (Cy - C'y) - (By - B'y) * (Cx - C'x))</i> <i><br><br></i>  <i>Ay = ((Bx * B'y - By * B'x) * (Cy - C'y) - (By - B'y) * (Cx * C'y - Cy * C'x)) / (( Bx - B'x) * (Cy - C'y) - (By - B'y) * (Cx - C'x))</i> </blockquote><br></li><li>  extend the segments by the lengths of the segments BA and CA, respectively </li></ul><br>  In general, the development of the algorithm for the movement of the worm was successfully completed.  Separately, I would like to note that this algorithm can be used to create a worm or a snake with rounded (realistic) edges when bending.  To do this, it is enough to set the maximum turning angle of about 10-15 degrees, and also to reduce the allowable length of the segment for the turn.  The result is shown below: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/6d5/67f/09b/6d567f09b8384ce996c0970f132c4f91.PNG"></div><br>  In addition, I would like to tell a few words about the generation of the surrounding world.  All objects are saved in sprite sheets in black and white.  Frames that change colors during the game are painted over with white, because by changing the color of the Sprite Renderer all the white areas become exactly the chosen color. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/053/379/7bd/0533797bd1b34151ab392b6dc013e0cf.PNG"></div><br>  <i>(side walls with Polygon Collider 2D added, and background image)</i> <br><br>  The same technique is used for game obstacles and the main character. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/cb8/409/74f/cb840974f2534e00959904f448edc3fb.PNG"></div><br>  In the screenshot with obstacles you can see blue and yellow diamonds, these are places where a coin can appear (yellow) or a shard (blue).  They are empty gameobject with the selected icon. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/dff/86e/c00/dff86ec008304304b7c91feb8e9b6974.PNG"></div><br>  I chose this approach, firstly, to simplify the task of adding coins / skulls to the scene (do not bother with random generation) and, secondly, that they appear in places that are interesting for the gameplay.  And, since in the game there are about 70 different tunnels, rocks and aisles, then the player is not so noticeable predefined places. <br><br>  I'll tell you a few words about the worm, namely his head.  The player has the opportunity to change it (like other parts of the body), and, including, the color of the skin and eyes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d79/143/36b/d7914336bd1b43e68e1ef74ea35848b0.PNG"></div><br>  It was not obvious to me how to implement this.  Therefore, the solution that appeared may not be the most competent, but working one. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/8e2/0c3/e5a/8e20c3e5a0b94bfda1afbc67fbc9ae58.PNG"></div><br>  There is a worm_head head prefab, in which all head + n heads are located, consisting of head objects (white sprite head) and eyes (sprite with eyes located on top of the head, which is also white).  By default, all head + n objects are invisible.  During the start of the game, the number of the installed head is checked to make the head + n object visible.  Along with this, the color scheme chosen by the player is applied: the main color is set for the sprite of the head, body, tail, and additional colors are set for the eyes and spikes. <br><br><pre><code class="cs hljs">head.GetComponent&lt;SpriteRenderer&gt;().color = headColor; eyes.GetComponent&lt;SpriteRenderer&gt;().color = eyesColor;</code> </pre> <br>  In my opinion, I told about the most interesting and not obvious moments of development, but if someone has questions, I will be glad to answer them! <br><br>  Thanks for attention.  You can play the game on Google Play. <br><br>  <i><b>PS There is no</b> publisher for the game, we are trying to unwind on our own.</i> </div><p>Source: <a href="https://habr.com/ru/post/318938/">https://habr.com/ru/post/318938/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../318926/index.html">GitLab 8.15 released</a></li>
<li><a href="../318928/index.html">Promotion of new agency on upwork from scratch - personal experience</a></li>
<li><a href="../318930/index.html">Client communities at a glance</a></li>
<li><a href="../318934/index.html">Abstracted from hotkeys in desktop applications, or how to debug in any IDE with the same buttons</a></li>
<li><a href="../318936/index.html">Solution Architecture in 2017: interview with Eli Feldman, SRT EPAM</a></li>
<li><a href="../318940/index.html">We're friends with Prometheus with Cach√©</a></li>
<li><a href="../318944/index.html">In search of free tickets, the study of the game Aeroflot: Mission 2017</a></li>
<li><a href="../318946/index.html">How to find a way to win the Russian AI Cup 2016, but in the wrong direction</a></li>
<li><a href="../318948/index.html">Finding GDI Object Leaks: How to Drive a Mastodon</a></li>
<li><a href="../318950/index.html">NativeScript, what kind of beast and what is it for?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>