<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Test Pass Library</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not always just to use. It was with such a thought that the writing of the library for Android and the subsequent writing of this article began. Sudde...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Test Pass Library</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/8c0/a2b/ecc/8c0a2becc83146859dcf8ba63be3cc20.jpg"><br><br>  Not always just to use.  It was with such a thought that the writing of the library for Android and the subsequent writing of this article began.  Suddenly someone come in handy.  Under the cut that eventually turned out. <br><a name="habracut"></a><br><h3>  Introduction </h3><br>  One long winter evening, my friends and I had an argument about how to implement one of the necessary functionals.  It was necessary to write * something * that could: <br><br><ul><li>  Draw formula </li><li>  Draw several blocks with letters / numbers </li><li>  Allow the user to move blocks and fill in gaps in the formula with them. </li></ul><br>  As the most active, I was impatient to try my hand, and on the very first night a view was written, which based on the formula tree drew a formula.  Friends looked at this case and put forward more demands. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  The tree is, of course, good, but it is fooled to understand your logic, and it is inconvenient to store formulas.  Therefore, the formula should be specified in a string, like a formula in mathematics (you can add some of your characters, but everything should be transparent). </li><li>  Kohl so smart, then write it so that the implementation of the project was as easy as possible. </li></ul><br>  The good fellow got upset, scratched his little head and sat down to write the library.  And to make it even more interesting, I set myself an additional condition: <br><br><ul><li>  View should be as customizable as possible. </li></ul><br><h3>  PS </h3><br>  There will not be a phased schedule of how to write a library and how to publish it - on the Internet, including Habr√©, there are already instructions on this.  I will talk a little about my logic, about the problems and difficulties that I encountered and how I solved them.  To some, this will seem trivial, to someone wrong - I do not pretend to make the right decision and I‚Äôll take all the comments.  I hope that this article or library will be useful to someone.  The github link will be at the end.  In the description of the repository there is a link to the demo library and instructions for it. <br><br><h3>  Stage One - Tree Drawing </h3><br>  By this stage, I had my initial demo, requirements and firm confidence that everything will work out.  First of all, it was decided to take up drawing, and leave the conversion from string to tree for last. <br><br>  <i>And so, the logic of the tree is:</i> <br><br>  A sheet is a set of characters.  For example, a multiplication sign or some number.  The sheet knows about its size, about whether there is someone after it, and how to arrange them in relation to itself.  I have identified several types. <br><br><ol><li>  <b>Constable sheet.</b>  These are +, -, * and numbers.  This sheet has a single height and length, depending on the internal text.  Everything behind it is drawn on the same axis with it.  That is, the center of this sheet along the Y axis coincides with the center along the Y axis of everything that is behind it. <br><br></li><li>  <b>Changeable sheet.</b>  It is the same as constable, only it has a state of empty and full.  Height is a single unit.  The width is taken not by its insides, but by the longest text of all the sheets being changed and moved. <br><br></li><li>  <b>Movable sheet.</b>  Looks like a changeable, only to it the state is visible, invisible, moves. <br><br></li><li>  <b>Power sheet.</b>  It has the width of the size of what should be in degree.  And its peculiarity is that everything behind it draws not on the same axis with the previous sheet.  The bottom edge of the whole subsequent area should be shifted to the floor of the block relative to the previous sheet.  It sounds muddled, but you just have to put the number in the degree.  (22) The degree is drawn on the floor row above.  But unlike this degree, in my number to the degree does not decrease in font.  This sheet knows who is next in the drawing degree, and who is next, after the drawing degree.  That is, in the formula (2 ^ (1 + 3) -4), the sign of the degree knows about "1" and about "-". <br><br></li><li>  <b>Division sheet.</b>  As the name implies, this is a sheet denoting division.  It is drawn in 4 stages.  A line is drawn along the center, as long as the larger of the numerator and denominator lengths.  The numerator is drawn so that it is pressed to the line with the lower edge and is located in the center of the entire length of the line (in case the denominator is longer).  The denominator is drawn so that it is pressed with the top edge to the line and is located centrally from the entire length of the line (in case the numerator is longer).  And at the end of the drawing is transferred to those sheets that go after the division. </li></ol><br><img src="https://habrastorage.org/files/391/bae/fa7/391baefa7fe74a50a87e7e6c13cb46d3.jpg"><br><br>  For logic to work, each sheet must be able to: <br><br><ol><li>  Tell your length and height </li><li>  Say the length and height of yourself and what is behind it.  Not just the next leaf, but the entire leaf branch.  That is, in the formula 2 + 3-4, the sign ‚Äú+‚Äù knows the dimensions of the part ‚Äú+ 3-4‚Äù.  This helps determine the size of the entire formula. </li><li>  To say how much he needs to move from the center along the Y axis (the rule is introduced specifically for the Power sheet) </li><li>  To be able to draw yourself and correctly transfer the coordinates for drawing to all your descendants. </li></ol><br><h3>  Stage Two - Scaling Blocks and Text </h3><br>  In order to fill the resolved area as much as possible, there is a scaling stage before drawing.  The principle is simple.  I have a single unit, on the basis of which all calculations are carried out and the variable responsible for how many times it is necessary to increase the scale.  The scaling logic is as follows: we get the size of the formula, compare it with the size of the available area, change the scaling factor. <br><br>  And then I ran into a small problem.  The width of the text increases in proportion to the textSize attribute.  That is, suppose we had a block of text with a width of y and textSize x.  If we increase the textSize by 2 times - the width of the block will not be equal to 2 * y.  In this regard, the scaling value constantly fluctuated in close values, which is why the picture was ‚Äúshaken‚Äù when redrawing.  To solve this problem, I have seen 2 ways: <br><br><ol><li>  It was possible before each step to reset the value of scaling to the initial value.  But the option did not suit me, t to then the size error in width would be too large. <br><br></li><li>  To set the formula before each step of scaling in the same conditions.  For this, I added 0.5 to the coefficient and rounded it up. </li></ol><br>  Going through the second method, I ran into a problem in the very first calculation, when the coefficient is still 1. To solve this, at first, I did the calculation using the second method 2 times, but this affected performance.  To avoid the second extra calculation, it was decided to keep the previous value and compare it with the new one.  If they are the same, then it makes no sense a second time.  Thinking again, I rendered the recalculation to the onSizeChanged method, and also additionally called when setting a new formula / sheets for movement. <br><br><h3>  Stage Three - Movement </h3><br>  Everything is very simple here.  A little trick was adopted.  Instead of moving the sheet that we selected, we hide it and start a new one, the coordinates of which are constantly changing when an onTouchEvent is triggered.  When MotionEvent.ACTION_DOWN is triggered, we are looking for whether our contact has hit the moving sheet, hide it, and copy the value into the sheet that we are moving.  When MotionEvent.ACTION_UP is triggered, we run through the tree and see if we intersect with any Changeable sheet. <br><br><h3>  Stage Four - Parser </h3><br>  Here in some measure the decision in the forehead.  To begin, it was determined 2 specials.  character.  The first one points to those blocks that will become Changeable.  The second symbol, a pair, indicates the area that should be defined as Constable or Changeable without internal transformations (for example, the division symbol).  We get a string, delete all spaces that are not included in the area allocated to the second spec.  symbol, transform the division signs and begin to read character by character.  To make it easier to convert everything, the division signs from the form 2/3 are converted to / (2) (3). <br><br><h3>  Stage Five - Customization </h3><br>  For ease of customization, almost all the variables that appear in the drawing or parser code are in separate fields of the classes.  In this connection, you can successfully change almost everything that you see. <br><br><h3>  Conclusion </h3><br>  As it turned out, this library is quite suitable for ‚Äúformulas‚Äù not only mathematical, but also, for example, for checking knowledge of vocabulary words.  I would also like to add for the future, for those who decide to write their own libraries too - in android studio there is a creation of a module library, and remove everything from the application tag in the library manifest.  If you have any questions, I will be happy to answer.  All comments and suggestions I will consider. <br><br>  ‚Üí <a href="https://github.com/KuznetsSudby/FormulLib">Library on github</a> </div><p>Source: <a href="https://habr.com/ru/post/321792/">https://habr.com/ru/post/321792/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../321782/index.html">Simple technology for classifying recognized pages of business documents based on the Template Matching method</a></li>
<li><a href="../321784/index.html">VR rendering and optimization</a></li>
<li><a href="../321786/index.html">Minimalism in game design: examples, tips and ideas. Part one</a></li>
<li><a href="../321788/index.html">From multichannel to omnicanality</a></li>
<li><a href="../321790/index.html">Reverse engineering messages Protocol Buffers</a></li>
<li><a href="../321796/index.html">Where do your ads live?</a></li>
<li><a href="../321798/index.html">Dynamic Shadow Tactics Detection</a></li>
<li><a href="../321800/index.html">Omnichannel: facilitating communication to customers and employees</a></li>
<li><a href="../321802/index.html">Dmitry Sorin, Senior Software Engineer at Atlassian, shared his impressions of five years of work at Yandex</a></li>
<li><a href="../321804/index.html">Acquaintance with Styled components</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>