<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Check Point R80.10 API. Management through CLI, scripts and not only</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I am sure that everyone who has ever worked with Check Point has a complaint about the impossibility of editing the configuration from the command lin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Check Point R80.10 API. Management through CLI, scripts and not only</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/59/df/12/59df12557d488051933654.png"><br><br>  I am sure that everyone who has ever worked with <a href="https://tssolution.ru/checkpoint/">Check Point has</a> a complaint about the <b>impossibility of editing the configuration from the command line</b> .  This is especially wild for those who have previously worked with Cisco ASA, where absolutely everything can be configured in the CLI.  Check Point is the opposite - all security settings were made exclusively from the graphical interface.  However, it‚Äôs not at all convenient to do some things through the GUI (even as convenient as Check Point).  For example, the task of adding 100 new hosts or networks turns into a long and tedious procedure.  For each object, you have to click the mouse several times and type in the ip-address.  The same goes for creating a group of sites or mass enabling / disabling IPS signatures.  In this case, it is likely to make a mistake. <br><br>  A relatively recent ‚Äúmiracle‚Äù happened.  With the release of the new version of <b>Gaia R80</b> , the possibility of <b>using the API</b> was announced, which opens up broad possibilities for automating settings, administration, monitoring, etc.  Now you can: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  create objects; </li><li>  add or edit access-lists; </li><li>  enable / disable blades; </li><li>  configure network interfaces; </li><li>  install policies; </li><li>  and much more. </li></ul><br>  To be honest, I do not understand how this news passed by Habr.  In this article we will briefly describe how to use the API and give some practical examples of <b>CheckPoint configuration using scripts</b> . <a name="habracut"></a><br><br>  At once I would like to make a reservation, the API is used only for the Management server.  Those.  it is still impossible to manage gateways without the Management Server. <br><br><h2>  Who, in principle, can this API be useful for? </h2><br><ol><li>  System administrators who want to simplify or automate routine tasks for configuring Check Point; </li><li>  Companies that want to integrate Check Point with other solutions (virtualization systems, ticket systems, configuration management systems, etc.); </li><li>  System integrators who want to standardize settings or create additional products associated with Check Point. </li></ol><br><h2>  Typical scheme </h2><br>  And so, let's imagine a typical scheme with Check Point: <br><br><img src="https://habrastorage.org/webt/59/df/14/59df14c5e44a0942370294.png"><br><br>  As usual, we have a gateway ( <b>SG</b> ), a management server ( <b>SMS</b> ) and an administrator console ( <b>SmartConsole</b> ).  In this case, the usual gateway configuration process is as follows: <br><br><img src="https://habrastorage.org/webt/59/df/15/59df1537b1e87566975025.png"><br><br>  Those.  you first need to start <b>SmartConsole</b> on the administrator‚Äôs computer, through which we connect to the Management server ( <b>SMS</b> ).  On the SMS, the security settings are made, and then they are applied ( <b>install policy</b> ) to the gateway ( <b>SG</b> ). <br><br>  When using the <b>Management API</b> , we can, in principle, skip the first item (launch SmartConsole) and apply <b>API commands</b> directly to the Management server (SMS). <br><br><h2>  Ways to use API </h2><br>  There are four basic ways to edit a configuration using the API: <br><br><h4>  1) Using the mgmt_cli utility </h4><br>  Example - <b># mgmt_cli add host name host1 ip-address 192.168.2.100</b> <br>  This command is run from the command line of the Management server (SMS).  I think the command syntax is clear - host1 is created with the address 192.168.2.100. <br><br><h4>  2) Enter the command API via clish (in expert mode) </h4><br>  In fact, all you need is to log in at the command line ( <b>mgmt login</b> ) under the account that is used when connecting via SmartConsole (or root account).  Then you can enter <b>API commands</b> (in this case there is no need to use the utility <b>mgmt_cli</b> before each command).  You can create full <b>BASH scripts</b> .  An example of a script that creates a host: <br><br><div class="spoiler">  <b class="spoiler_title">Bash script</b> <div class="spoiler_text"><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash main() { clear #LOGIN (don't ask for username and password, user is already logged in to Management server as 'root' user) mgmt_cli login --root true &gt; id_add_host.txt on_error_print_and_exit "Error: Failed to login, check that the server is up and running (run 'api status')" #READ HOST NAME printf "Enter host name:\n" read -e host_name on_empty_input_print_and_exit "$host_name" "Error: The host's name cannot be empty." #READ IP ADDRESS printf "\nEnter host IP address:\n" read -e ip on_empty_input_print_and_exit "$ip" "Error: The host's IP address cannot be empty." #CREATE HOST printf "Creating new host: $host_name with IP address: $ip\n" new_host_response=$(mgmt_cli add host name $host_name ip-address $ip -s id_add_host.txt 2&gt; /dev/null) on_error_print_and_exit "Error: Failed to create host object. \n$new_host_response" #PUBLISH THE CHANGES printf "\nPublishing the changes\n" mgmt_cli publish --root true -s id_add_host.txt &amp;&gt; /dev/null on_error_print_and_exit "Error: Failed to publish the changes." #LOGOUT logout printf "Done.\n" } logout(){ mgmt_cli logout --root true -s id_add_host.txt &amp;&gt; /dev/null } on_error_print_and_exit(){ if [ $? -ne 0 ]; then handle_error "$1" fi } handle_error(){ printf "\n$1\n" #print error message mgmt_cli discard --root true -s id_add_host.txt &amp;&gt; /dev/null logout exit 1 } on_empty_input_print_and_exit(){ if [ -z "$1" ]; then printf "$2\n" #print error message logout exit 0 fi } # Script starts here. Call function "main". main</span></span></code> </pre> <br></div></div><br>  If interested, then you can watch the corresponding video: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/JUU7_r15_pw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><h4>  3) Via SmartConsole, opening the CLI window </h4><br>  All you need to do is launch the <b>CLI</b> window directly from the <b>SmartConsole</b> , as shown in the image below. <br><br><img src="https://habrastorage.org/webt/59/df/18/59df18b53cb4a612396799.png"><br><br>  In this window, you can immediately begin to enter API commands. <br><br><h4>  4) Web Services.  Use HTTPS Post request (REST API) </h4><br>  In our opinion, this is one of the most promising ways, since  allows you to ‚Äúbuild‚Äù entire <b>management server management</b> applications (I apologize for the tautology).  Below we consider this method in more detail. <br><br><h4>  To recap: </h4><br><ol><li>  <b>API + cli is</b> more suitable for people who are used to Cisco; </li><li>  <b>API + shell</b> to use scripts and perform routine tasks; </li><li>  <b>REST API</b> for automation. </li></ol><br><h2>  Enable API </h2><br>  By default, the API is enabled on management servers with more than 4GB RAM and standalone configurations with more than 8GB RAM.  You can check the status using the command: <b>api status</b> <br><br>  If it turns out that api is turned off, then it is quite simple to enable it via SmartConsole: <b>Manage &amp; Settings&gt; Blades&gt; Management API&gt; Advanced Settings</b> <br><br><img src="https://habrastorage.org/webt/59/df/1a/59df1a1f6fd57250757086.png"><br><br>  Then publish the changes and execute the <b>api restart</b> command. <br><br><h2>  Web requests + Python </h2><br>  For executing API commands, you can use Web requests using <b>Python</b> and the <b>requests</b> , <b>json</b> libraries.  In general, the structure of a web request consists of three parts: <br><br>  <b>1) Address</b> <br><br><pre> <code class="hljs lisp"><code class="python">(<span class="hljs-name"><span class="hljs-name">https</span></span><span class="hljs-symbol"><span class="hljs-symbol">://&lt;managemenet</span></span> server&gt;<span class="hljs-symbol"><span class="hljs-symbol">:&lt;port&gt;/web_api/&lt;command&gt;</span></span>)</code></code> </pre> <br>  <b>2) HTTP Headers</b> <br><br><pre> <code class="hljs pgsql"><code class="python">content-<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>: application/<span class="hljs-type"><span class="hljs-type">json</span></span> x-chkp-sid: &lt;<span class="hljs-keyword"><span class="hljs-keyword">session</span></span> ID token <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> returned <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">login</span></span> command&gt;</code></code> </pre> <br>  <b>3) Request payload</b> <br><br>  Text in JSON format containing the different parameters <br><br>  An example for calling various commands: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">api_call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ip_addr, port, command, json_payload, sid)</span></span></span><span class="hljs-function">:</span></span> url = <span class="hljs-string"><span class="hljs-string">'https://'</span></span> + ip_addr + <span class="hljs-string"><span class="hljs-string">':'</span></span> + str(port) + <span class="hljs-string"><span class="hljs-string">'/web_api/'</span></span> + command <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sid == ‚Äú‚Äù: request_headers = {<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span> : <span class="hljs-string"><span class="hljs-string">'application/json'</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: request_headers = {<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span> : <span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, <span class="hljs-string"><span class="hljs-string">'X-chkp-sid'</span></span> : sid} r = requests.post(url,data=json.dumps(json_payload), headers=request_headers,verify=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> r.json() <span class="hljs-string"><span class="hljs-string">'xxx.xxx.xxx.xxx'</span></span> -&gt; Ip address GAIA</code> </pre><br>  Here are some typical tasks that most often come across when administering Check Point. <br><br>  1) An example of authorization functions and logout: <br><br><div class="spoiler">  <b class="spoiler_title">Script</b> <div class="spoiler_text"><pre> <code class="python hljs">payload = {<span class="hljs-string"><span class="hljs-string">'user'</span></span>: <span class="hljs-string"><span class="hljs-string">'your_user'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span> : <span class="hljs-string"><span class="hljs-string">'your_password'</span></span>} response = api_call(<span class="hljs-string"><span class="hljs-string">'xxx.xxx.xxx.xxx'</span></span>, <span class="hljs-number"><span class="hljs-number">443</span></span>, <span class="hljs-string"><span class="hljs-string">'login'</span></span>,payload, <span class="hljs-string"><span class="hljs-string">''</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response[<span class="hljs-string"><span class="hljs-string">"sid"</span></span>] response = api_call(<span class="hljs-string"><span class="hljs-string">'xxx.xxx.xxx.xxx'</span></span>, <span class="hljs-number"><span class="hljs-number">443</span></span>,<span class="hljs-string"><span class="hljs-string">'logout'</span></span>, {} ,sid) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response[<span class="hljs-string"><span class="hljs-string">"message"</span></span>]</code> </pre><br></div></div><br>  2) Enable blades and network setup: <br><br><div class="spoiler">  <b class="spoiler_title">Script</b> <div class="spoiler_text"><pre> <code class="python hljs">new_gateway_data = {<span class="hljs-string"><span class="hljs-string">'name'</span></span>:<span class="hljs-string"><span class="hljs-string">'CPGleb'</span></span>,<span class="hljs-string"><span class="hljs-string">'anti-bot'</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>,<span class="hljs-string"><span class="hljs-string">'anti-virus'</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>,<span class="hljs-string"><span class="hljs-string">'application-control'</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>,<span class="hljs-string"><span class="hljs-string">'ips'</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>,<span class="hljs-string"><span class="hljs-string">'url-filtering'</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>,<span class="hljs-string"><span class="hljs-string">'interfaces'</span></span>: [{<span class="hljs-string"><span class="hljs-string">'name'</span></span>:<span class="hljs-string"><span class="hljs-string">"eth0"</span></span>,<span class="hljs-string"><span class="hljs-string">'topology'</span></span>:<span class="hljs-string"><span class="hljs-string">'external'</span></span>,<span class="hljs-string"><span class="hljs-string">'ipv4-address'</span></span>: <span class="hljs-string"><span class="hljs-string">'xxx.xxx.xxx.xxx'</span></span>,<span class="hljs-string"><span class="hljs-string">"ipv4-network-mask"</span></span>: <span class="hljs-string"><span class="hljs-string">"255.255.255.0"</span></span>}, {<span class="hljs-string"><span class="hljs-string">'name'</span></span>:<span class="hljs-string"><span class="hljs-string">"eth1"</span></span>,<span class="hljs-string"><span class="hljs-string">'topology'</span></span>:<span class="hljs-string"><span class="hljs-string">'internal'</span></span>,<span class="hljs-string"><span class="hljs-string">'ipv4-address'</span></span>: <span class="hljs-string"><span class="hljs-string">'xxx.xxx.xxx.xxx'</span></span>,<span class="hljs-string"><span class="hljs-string">"ipv4-network-mask"</span></span>: <span class="hljs-string"><span class="hljs-string">"255.255.255.0"</span></span>}]} new_gateway_result = api_call(<span class="hljs-string"><span class="hljs-string">'xxx.xxx.xxx.xxx'</span></span>, <span class="hljs-number"><span class="hljs-number">443</span></span>,<span class="hljs-string"><span class="hljs-string">'set-simple-gateway'</span></span>, new_gateway_data ,sid) print(json.dumps(new_gateway_result))</code> </pre><br></div></div><br>  3) Changing firewall rules: <br><br><div class="spoiler">  <b class="spoiler_title">Script</b> <div class="spoiler_text"><pre> <code class="python hljs">new_access_data={<span class="hljs-string"><span class="hljs-string">'name'</span></span>:<span class="hljs-string"><span class="hljs-string">'Cleanup rule'</span></span>,<span class="hljs-string"><span class="hljs-string">'layer'</span></span>:<span class="hljs-string"><span class="hljs-string">'Network'</span></span>,<span class="hljs-string"><span class="hljs-string">'action'</span></span>:<span class="hljs-string"><span class="hljs-string">'Accept'</span></span>} new_access_result = api_call(<span class="hljs-string"><span class="hljs-string">'xxx.xxx.xxx.xxx'</span></span>, <span class="hljs-number"><span class="hljs-number">443</span></span>,<span class="hljs-string"><span class="hljs-string">'set-access-rule'</span></span>, new_access_data ,sid) print(json.dumps(new_access_result))</code> </pre><br></div></div><br>  4) Adding Application layer: <br><br><div class="spoiler">  <b class="spoiler_title">Script</b> <div class="spoiler_text"><pre> <code class="python hljs">add_access_layer_application={ <span class="hljs-string"><span class="hljs-string">'name'</span></span> : <span class="hljs-string"><span class="hljs-string">'application123'</span></span>,<span class="hljs-string"><span class="hljs-string">"applications-and-url-filtering"</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>,<span class="hljs-string"><span class="hljs-string">"firewall"</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>} add_access_layer_application_result = api_call(<span class="hljs-string"><span class="hljs-string">'xxx.xxx.xxx.xxx'</span></span>, <span class="hljs-number"><span class="hljs-number">443</span></span>,<span class="hljs-string"><span class="hljs-string">'add-access-layer'</span></span>, add_access_layer_application ,sid) print(json.dumps(add_access_layer_application_result)) set_package_layer={<span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"Standard"</span></span>,<span class="hljs-string"><span class="hljs-string">"access"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>,<span class="hljs-string"><span class="hljs-string">"access-layers"</span></span> : {<span class="hljs-string"><span class="hljs-string">"add"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"application123"</span></span>,<span class="hljs-string"><span class="hljs-string">"position"</span></span> :<span class="hljs-number"><span class="hljs-number">2</span></span>}]} ,<span class="hljs-string"><span class="hljs-string">"installation-targets"</span></span> : <span class="hljs-string"><span class="hljs-string">"CPGleb"</span></span>} set_package_layer_result = api_call(<span class="hljs-string"><span class="hljs-string">'xxx.xxx.xxx.xxx'</span></span>, <span class="hljs-number"><span class="hljs-number">443</span></span>,<span class="hljs-string"><span class="hljs-string">'set-package'</span></span>, set_package_layer ,sid) print(json.dumps(set_package_layer_result))</code> </pre><br></div></div><br>  5) Publish and install policy, check command execution (task-id): <br><br><div class="spoiler">  <b class="spoiler_title">Script</b> <div class="spoiler_text"><pre> <code class="python hljs">publish_result = api_call(<span class="hljs-string"><span class="hljs-string">'xxx.xxx.xxx.xxx'</span></span>, <span class="hljs-number"><span class="hljs-number">443</span></span>,<span class="hljs-string"><span class="hljs-string">"publish"</span></span>, {},sid) print(<span class="hljs-string"><span class="hljs-string">"publish result: "</span></span> + json.dumps(publish_result)) new_policy = {<span class="hljs-string"><span class="hljs-string">'policy-package'</span></span>:<span class="hljs-string"><span class="hljs-string">'Standard'</span></span>,<span class="hljs-string"><span class="hljs-string">'access'</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>,<span class="hljs-string"><span class="hljs-string">'targets'</span></span>:[<span class="hljs-string"><span class="hljs-string">'CPGleb'</span></span>]} new_policy_result = api_call(<span class="hljs-string"><span class="hljs-string">'xxx.xxx.xxx.xxx'</span></span>, <span class="hljs-number"><span class="hljs-number">443</span></span>,<span class="hljs-string"><span class="hljs-string">'install-policy'</span></span>, new_policy ,sid) print(json.dumps(new_policy_result) task_id=(json.dumps(new_policy_result [<span class="hljs-string"><span class="hljs-string">"task-id"</span></span>])) len_str=len(task_id) task_id=task_id[<span class="hljs-number"><span class="hljs-number">1</span></span>:(len_str<span class="hljs-number"><span class="hljs-number">-1</span></span>)] show_task_id ={<span class="hljs-string"><span class="hljs-string">'task-id'</span></span>:(task_id)} show_task=api_call(<span class="hljs-string"><span class="hljs-string">'xxx.xxx.xxx.xxx'</span></span>,<span class="hljs-number"><span class="hljs-number">443</span></span>,<span class="hljs-string"><span class="hljs-string">'show-task'</span></span>,show_task_id,sid) print(json.dumps(show_task))</code> </pre><br></div></div><br>  6) Add host: <br><br><div class="spoiler">  <b class="spoiler_title">Script</b> <div class="spoiler_text"><pre> <code class="python hljs">new_host_data = {<span class="hljs-string"><span class="hljs-string">'name'</span></span>:<span class="hljs-string"><span class="hljs-string">'JohnDoePc'</span></span>, <span class="hljs-string"><span class="hljs-string">'ip-address'</span></span>: <span class="hljs-string"><span class="hljs-string">'192.168.0.10'</span></span>} new_host_result = api_call(<span class="hljs-string"><span class="hljs-string">'xxx.xxx.xxx.xxx'</span></span>, <span class="hljs-number"><span class="hljs-number">443</span></span>,<span class="hljs-string"><span class="hljs-string">'add-host'</span></span>, new_host_data ,sid) print(json.dumps(new_host_result))</code> </pre><br></div></div><br>  7) Add a Threat Prevention field: <br><br><div class="spoiler">  <b class="spoiler_title">Script</b> <div class="spoiler_text"><pre> <code class="python hljs">set_package_layer={<span class="hljs-string"><span class="hljs-string">'name'</span></span>:<span class="hljs-string"><span class="hljs-string">'Standard'</span></span>,<span class="hljs-string"><span class="hljs-string">'threat-prevention'</span></span> :<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>,<span class="hljs-string"><span class="hljs-string">'installation-targets'</span></span>:<span class="hljs-string"><span class="hljs-string">'CPGleb'</span></span>} set_package_layer_result = api_call(<span class="hljs-string"><span class="hljs-string">'xxx.xxx.xxx.xxx'</span></span>, <span class="hljs-number"><span class="hljs-number">443</span></span>,<span class="hljs-string"><span class="hljs-string">'set-package'</span></span>,set_package_layer,sid) print(json.dumps(set_package_layer_result))</code> </pre><br></div></div><br>  8) View a list of sessions <br><br><div class="spoiler">  <b class="spoiler_title">Script</b> <div class="spoiler_text"><pre> <code class="python hljs">new_session_data = {<span class="hljs-string"><span class="hljs-string">'limit'</span></span>:<span class="hljs-string"><span class="hljs-string">'50'</span></span>, <span class="hljs-string"><span class="hljs-string">'offset'</span></span>:<span class="hljs-string"><span class="hljs-string">'0'</span></span>,<span class="hljs-string"><span class="hljs-string">'details-level'</span></span> : <span class="hljs-string"><span class="hljs-string">'standard'</span></span>} new_session_result = api_call(<span class="hljs-string"><span class="hljs-string">'xxx.xxx.xxx.xxx'</span></span>, <span class="hljs-number"><span class="hljs-number">443</span></span>,<span class="hljs-string"><span class="hljs-string">'show-sessions'</span></span>, new_session_data ,sid) print(json.dumps(new_session_result))</code> </pre><br></div></div><br>  9) Create a new profile: <br><br><div class="spoiler">  <b class="spoiler_title">Script</b> <div class="spoiler_text"><pre> <code class="python hljs">add_threat_profile={<span class="hljs-string"><span class="hljs-string">'name'</span></span>:<span class="hljs-string"><span class="hljs-string">'Apeiron'</span></span>, <span class="hljs-string"><span class="hljs-string">"active-protections-performance-impact"</span></span> : <span class="hljs-string"><span class="hljs-string">"low"</span></span>,<span class="hljs-string"><span class="hljs-string">"active-protections-severity"</span></span> : <span class="hljs-string"><span class="hljs-string">"low or above"</span></span>,<span class="hljs-string"><span class="hljs-string">"confidence-level-medium"</span></span> : <span class="hljs-string"><span class="hljs-string">"prevent"</span></span>, <span class="hljs-string"><span class="hljs-string">"confidence-level-high"</span></span> : <span class="hljs-string"><span class="hljs-string">"prevent"</span></span>, <span class="hljs-string"><span class="hljs-string">"threat-emulation"</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>,<span class="hljs-string"><span class="hljs-string">"anti-virus"</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>,<span class="hljs-string"><span class="hljs-string">"anti-bot"</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>,<span class="hljs-string"><span class="hljs-string">"ips"</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">"ips-settings"</span></span> : { <span class="hljs-string"><span class="hljs-string">"newly-updated-protections"</span></span> : <span class="hljs-string"><span class="hljs-string">"staging"</span></span>,<span class="hljs-string"><span class="hljs-string">"exclude-protection-with-performance-impact"</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>,<span class="hljs-string"><span class="hljs-string">"exclude-protection-with-performance-impact-mode"</span></span> : <span class="hljs-string"><span class="hljs-string">"High or lower"</span></span>}, <span class="hljs-string"><span class="hljs-string">"overrides"</span></span> : [ {<span class="hljs-string"><span class="hljs-string">"protection"</span></span> : <span class="hljs-string"><span class="hljs-string">"3Com Network Supervisor Directory Traversal"</span></span>,<span class="hljs-string"><span class="hljs-string">"capture-packets"</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>,<span class="hljs-string"><span class="hljs-string">"action"</span></span> : <span class="hljs-string"><span class="hljs-string">"Prevent"</span></span>,<span class="hljs-string"><span class="hljs-string">"track"</span></span> : <span class="hljs-string"><span class="hljs-string">"Log"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"protection"</span></span> : <span class="hljs-string"><span class="hljs-string">"7-Zip ARJ Archive Handling Buffer Overflow"</span></span>, <span class="hljs-string"><span class="hljs-string">"capture-packets"</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>,<span class="hljs-string"><span class="hljs-string">"action"</span></span> : <span class="hljs-string"><span class="hljs-string">"Prevent"</span></span>,<span class="hljs-string"><span class="hljs-string">"track"</span></span> : <span class="hljs-string"><span class="hljs-string">"Log"</span></span>} ]} add_threat_profile_result=api_call(<span class="hljs-string"><span class="hljs-string">'xxx.xxx.xxx.xxx'</span></span>,<span class="hljs-number"><span class="hljs-number">443</span></span>,<span class="hljs-string"><span class="hljs-string">'add-threat-profile'</span></span>,add_threat_profile,sid) print(json.dumps(add_threat_profile_result))</code> </pre><br></div></div><br>  10) Change the action for IPS signatures: <br><br><div class="spoiler">  <b class="spoiler_title">Script</b> <div class="spoiler_text"><pre> <code class="python hljs">set_threat_protection={ <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"3Com Network Supervisor Directory Traversal"</span></span>, <span class="hljs-string"><span class="hljs-string">"overrides"</span></span> : [{ <span class="hljs-string"><span class="hljs-string">"profile"</span></span> : <span class="hljs-string"><span class="hljs-string">"Apeiron"</span></span>,<span class="hljs-string"><span class="hljs-string">"action"</span></span> : <span class="hljs-string"><span class="hljs-string">"Detect"</span></span>,<span class="hljs-string"><span class="hljs-string">"track"</span></span> : <span class="hljs-string"><span class="hljs-string">"Log"</span></span>,<span class="hljs-string"><span class="hljs-string">"capture-packets"</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>}, { <span class="hljs-string"><span class="hljs-string">"profile"</span></span> : <span class="hljs-string"><span class="hljs-string">"Apeiron"</span></span>, <span class="hljs-string"><span class="hljs-string">"action"</span></span> : <span class="hljs-string"><span class="hljs-string">"Detect"</span></span>, <span class="hljs-string"><span class="hljs-string">"track"</span></span> : <span class="hljs-string"><span class="hljs-string">"Log"</span></span>, <span class="hljs-string"><span class="hljs-string">"capture-packets"</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>} ]} set_threat_protection_result=api_call(<span class="hljs-string"><span class="hljs-string">'xxx.xxx.xxx.xxx'</span></span>,<span class="hljs-number"><span class="hljs-number">443</span></span>,<span class="hljs-string"><span class="hljs-string">'set-threat-protection'</span></span>,set_threat_protection,sid) print(json.dumps(set_threat_protection_result))</code> </pre><br></div></div><br>  11) Add your service: <br><br><div class="spoiler">  <b class="spoiler_title">Script</b> <div class="spoiler_text"><pre> <code class="python hljs">add_service_udp={ <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"Dota2_udp"</span></span>, <span class="hljs-string"><span class="hljs-string">"port"</span></span> : <span class="hljs-string"><span class="hljs-string">'27000-27030'</span></span>, <span class="hljs-string"><span class="hljs-string">"keep-connections-open-after-policy-installation"</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">"session-timeout"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"match-for-any"</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">"sync-connections-on-cluster"</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">"aggressive-aging"</span></span> : {<span class="hljs-string"><span class="hljs-string">"enable"</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">"timeout"</span></span> : <span class="hljs-number"><span class="hljs-number">360</span></span>,<span class="hljs-string"><span class="hljs-string">"use-default-timeout"</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> }, <span class="hljs-string"><span class="hljs-string">"accept-replies"</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>} add_service_udp_results=api_call(<span class="hljs-string"><span class="hljs-string">'xxx.xxx.xxx.xxx'</span></span>,<span class="hljs-number"><span class="hljs-number">443</span></span>,<span class="hljs-string"><span class="hljs-string">"add-service-udp"</span></span>,add_service_udp,sid) print(json.dumps(add_service_udp_results))</code> </pre><br></div></div><br>  12) Add a category, site or group: <br><br><div class="spoiler">  <b class="spoiler_title">Script</b> <div class="spoiler_text"><pre> <code class="python hljs">add_application_site_category={ <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"Valve"</span></span>,<span class="hljs-string"><span class="hljs-string">"description"</span></span> : <span class="hljs-string"><span class="hljs-string">"Valve Games"</span></span>} add_application_site_category_results=api_call(<span class="hljs-string"><span class="hljs-string">'xxx.xxx.xxx.xxx'</span></span>,<span class="hljs-number"><span class="hljs-number">443</span></span>,<span class="hljs-string"><span class="hljs-string">"add-application-site-category"</span></span>,add_application_site_category,sid) print(json.dumps(add_application_site_category_results)) add_application_site={ <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"Dota2"</span></span>, <span class="hljs-string"><span class="hljs-string">"primary-category"</span></span> : <span class="hljs-string"><span class="hljs-string">"Valve"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span> : <span class="hljs-string"><span class="hljs-string">"Dotka"</span></span>, <span class="hljs-string"><span class="hljs-string">"url-list"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"www.dota2.ru"</span></span> ], <span class="hljs-string"><span class="hljs-string">"urls-defined-as-regular-expression"</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>} add_application_site_results=api_call(<span class="hljs-string"><span class="hljs-string">'xxx.xxx.xxx.xxx'</span></span>,<span class="hljs-number"><span class="hljs-number">443</span></span>,<span class="hljs-string"><span class="hljs-string">"add-application-site "</span></span> , add_application_site , sid) print(json.dumps(add_application_site_results)) add_application_site_group={<span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"Games"</span></span>,<span class="hljs-string"><span class="hljs-string">"members"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"Dota2"</span></span>]} add_application_site_group_results=api_call(<span class="hljs-string"><span class="hljs-string">'xxx.xxx.xxx.xxx'</span></span>,<span class="hljs-number"><span class="hljs-number">443</span></span>,<span class="hljs-string"><span class="hljs-string">"add-application-site-group"</span></span>,add_application_site_group,sid) print(json.dumps(add_application_site_group_results))</code> </pre><br></div></div><br>  In addition, using the <b>Web API,</b> you can add and delete networks, hosts, access roles, etc.  It is possible to configure <b>Antivirus, Antibot, IPS, VPN blades</b> .  It is even possible to install licenses using the <b>run-script</b> command.  All API Check Point commands are available <a href="https://sc1.checkpoint.com/documents/latest/APIs/index.html">here</a> . <br><br><h2>  Check Point API + Postman </h2><br>  It is also convenient to use <b>Check Point Web API</b> in conjunction with <a href="https://www.getpostman.com/">Postman</a> .  Postman has desktop versions for Windows, Linux and MacOS.  In addition, there is a plugin for Google Chrome.  We will use it.  First you need to find Postman in the Google Chrome Store and install: <br><br><img src="https://habrastorage.org/webt/59/df/22/59df22a902b2a190155919.png"><br><br>  Using this utility, we will be able to form Web requests to the Check Point API.  In order not to memorize all API commands, it is possible to import the so-called collection (s), which already contain all the necessary commands: <br><br><img src="https://habrastorage.org/webt/59/df/24/59df2452a74a0393001536.png"><br><br>  <a href="https://drive.google.com/file/d/0B-5kZl7ixcSKY0YzenVJUElsNzA/view%3Fusp%3Dsharing">Here</a> you will find a <b>collection</b> for <b>R80.10</b> .  After the import, API command templates will be available to us: <br><br><img src="https://habrastorage.org/webt/59/df/25/59df25bb63b3f756202277.png"><br><br>  In my opinion, it is very convenient.  You can quickly start developing applications using the Check Point API. <br><br><h2>  Check Point + Ansible </h2><br>  I would also like to note that there is <b>Ansible</b> <a href="https://community.checkpoint.com/docs/DOC-1928">module</a> for CheckPoint API.  The module allows you to manage configurations, but it is not so convenient for solving exotic problems.  Writing scripts in any programming language provides more flexible and convenient solutions. <br><br><h2>  Conclusion </h2><br>  On this, perhaps we will finish our small review of the Check Point API.  In my opinion, this function was very welcome and necessary.  The advent of the API opens up very wide opportunities for both system administrators and system integrators who work with Check Point products.  Orchestration, automation, feedback from SIEM ... all this is now possible. <br><br>  PS As always, you can find more articles about <a href="https://tssolution.ru/checkpoint/">Check Point</a> in our <a href="https://habrahabr.ru/company/tssolution/">Habr</a> blog or in a blog on the <a href="https://tssolution.ru/blog/">site</a> . </div><p>Source: <a href="https://habr.com/ru/post/339924/">https://habr.com/ru/post/339924/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../339912/index.html">Zoia.js: another web framework on Node</a></li>
<li><a href="../339914/index.html">Jupyter Widgets for implementing the Turing UI machine</a></li>
<li><a href="../339916/index.html">SLA philosophy: what is escalation and why is it needed?</a></li>
<li><a href="../339918/index.html">How to gather a chat chat bot from scrap materials in a day and a half</a></li>
<li><a href="../339920/index.html">Zabbix conference 2017: how was the second day</a></li>
<li><a href="../339926/index.html">A practical guide to analyzing application performance</a></li>
<li><a href="../339928/index.html">How to maintain a Telegram channel with 20,000 subscribers? Interview with the creator of All-in-One Person</a></li>
<li><a href="../339930/index.html">Development for Sailfish OS: displaying graphs using D3.js and QML Canvas</a></li>
<li><a href="../339932/index.html">Development for Sailfish OS: working with maps and geolocation</a></li>
<li><a href="../339936/index.html">We are looking for treasures in the source code Aladdin</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>