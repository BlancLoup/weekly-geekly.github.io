<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to stop being afraid and fall in love with mbed [Part 1]</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We are engaged in the supply of electronic components. To do our job well, it is not enough just to be able to bring and sell electronic components - ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to stop being afraid and fall in love with mbed [Part 1]</h1><div class="post__text post__text-html js-mediator-article">  We are engaged in the supply of electronic components.  To do our job well, it is not enough just to be able to bring and sell electronic components - it is still important to be able to demonstrate their advantages.  That is why we not only write review articles, but also create guidelines for the use of various ‚Äúhardware‚Äù and develop small demonstration projects. <br><br><img src="https://habrastorage.org/files/372/e1b/26c/372e1b26cbcd4a16906ee0fc1867bd4e.JPG"><br><br>  I will tell you about the history of the creation of one of such demonstration projects - I will consistently describe the process of creating a prototype device equipped with a capacitive touch screen and designed to measure relative humidity and temperature. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Of particular interest is the approach to writing firmware - software is completely written in the online IDE from mbed.  That is, the program for the microcontroller was created on a single tab of Google Chrome and works equally well on debug boards from different manufacturers. <br><br>  Content of the publication cycle: <br><ul><li>  <b>[Part 1] Overview of the used software and hardware solutions.</b> </li><li>  <a href="https://habrahabr.ru/company/efo/blog/309918/">[Part 2] Getting Started with the FT800 Graphics Controller.</a>  <a href="https://habrahabr.ru/company/efo/blog/309918/">Use of ready mbed-libraries for peripheral devices.</a> </li><li>  <a href="https://habrahabr.ru/company/efo/blog/310058/">[Part 3] Connecting the sensor HYT-271.</a>  <a href="https://habrahabr.ru/company/efo/blog/310058/">Create and publish in mbed your own library for peripherals.</a> </li><li>  <a href="https://habrahabr.ru/company/efo/blog/310720/">[Part 4] Application development: Program structure, working with a touch screen.</a> </li><li>  <a href="https://habrahabr.ru/company/efo/blog/311816/">[Part 5] Application development: Display images, Russification problems.</a> </li><li>  <a href="https://habrahabr.ru/company/efo/blog/312484/">[Part 6] Printing Body Parts</a> </li></ul><br>  The first part under the cut. <br><a name="habracut"></a><br>  So, the device consists of three main components: <br><br><ul><li>  HYT-271 digital relative humidity sensor from IST </li><li>  Riverdi's TFT display with FTDI's integrated FT801 graphics controller </li><li>  debug board with ARM Cortex based microcontroller and mbed support </li></ul><br>  The protagonists of the play are the Riverdi display and the IST sensor, since the project is designed to demonstrate their capabilities.  But as a control node, you can use any debugging board on which the necessary interfaces are implemented and displayed - SPI for TFT-display and I2C for sensor.  In my case, when I really want to play around with mbed, its support in mbed IDE is added to the requirements for the microcontroller platform. <br><br><img src="https://habrastorage.org/files/a8c/e39/483/a8ce394836734554bb84076e6b5c6f8a.png"><br><br>  The SLSTK3400A board from Silicon Labs with the EFM32 Gecko series controller onboard was chosen as the base platform.  In the first photo she is in the center.  However, my goal is to create a program in mbed that would work on other mbed-based debugging boards.  Therefore, different debugs from SiLabs, Atmel and Wiznet will be alternately included as a control module at each development stage. <br><br>  Now consider the components in more detail. <br><br><h1>  HYT-271 Digital Relative Humidity Sensor from IST </h1><hr><br>  HYT series sensors have already been devoted to <a href="https://habrahabr.ru/company/efo/blog/303350/">an article on Habr√©</a> , today I will give a less detailed description. <br><br><img src="https://habrastorage.org/files/cec/694/82c/cec69482c68f4cf3b61954f901a7c13e.jpg" align="right"><br>  HYT-271 is a digital relative humidity sensor with I2C interface, which is manufactured by the Swiss company IST.  Like most modern sensors of relative humidity, it has a capacitive sensing element and is equipped with an additional temperature sensor.  The latter is necessary first of all for automatic thermal compensation of the results of humidity measurement, however, it is also an independent sensitive element from which it is possible to obtain data on the ambient temperature. <br><table border="1" cellpadding="5" cellspacing="1"><tbody><tr><td></td><td>  <strong>Relative humidity</strong> </td><td>  <strong>Temperature</strong> </td></tr><tr><td>  Measuring range </td><td>  from 0 to 100% RH </td><td>  from -40 to +125 ¬∞ C </td></tr><tr><td>  Accuracy (maximum error) </td><td>  ¬± 1.8% RH (in the range of 0 ... 80% RH) </td><td>  ¬± 0.2 ¬∞ C (in the range of 0 ... 60 ¬∞ C) </td></tr><tr><td>  Response time </td><td>  HYT 271 &lt;4 s </td><td>  HYT 271 &lt;5 s </td></tr><tr><td>  Repeatability </td><td>  ¬± 0.2% RH </td><td>  ¬± 0.1 ¬∞ C </td></tr><tr><td>  Hysteresis </td><td>  &lt;¬± 1% RH </td><td></td></tr><tr><td>  Long term drift characteristics </td><td>  &lt;¬± 0.5% RH / year </td><td>  &lt;¬± 0.05 ¬∞ C / year </td></tr><tr><td>  Supply voltage </td><td colspan="2" rowspan="1">  2.7 - 5.5 V </td></tr></tbody></table><br>  The key advantages of the HYT-271 sensor are high accuracy in measuring humidity and a very fast response.  Such characteristics are in demand in the management of such technological processes as drying, evaporation and distillation - this is the widest class of tasks from making pasta to controlling the hardening of concrete structures. <br><br>  High-end sensors are also needed in devices for measuring residual moisture, or, for example, in the climate control of rooms where moisture-sensitive materials like wood or grain are stored.  Among the targeted applications are also incubators, medical equipment and other important tasks <s>, among which there is no home weather station !!!</s> <br><br>  The price of sensors of this class in the Russian Federation is from 40 to 100 dollars.  We offer HYT-271 individually from the warehouse for 37 euros, and for wholesale purchases the price naturally decreases.  For example, if you order 50 sensors, the price will be about 30 euros per sensor.  Well, there are discounts, <a href="https://habrahabr.ru/users/uuuulala/">contact</a> . <br><br>  Integral sensors with a digital interface are factory calibrated, so for work it is usually sufficient to connect the sensor to the control controller (in our case via the I2C interface) and master the data exchange protocol.  The data exchange protocol describes the format of control commands and data packages.  We will turn to one of the following articles to the software implementation of the HYT-271 sensor polling procedure. <br><br>  <a href="http://www.ist-ag.com/eh/ist-ag/resource.nsf/imgref/Download_AHHYTM_E2.2.5.pdf/%24FILE/AHHYTM_E2.2.5.pdf">HYT Series Sensor Documentation</a> <br><br><h1>  Riverdi touchscreen TFT display and FT801 graphics controller </h1><hr><br>  Riverdi is a Polish manufacturer of TFT modules, i.e. TFT displays with integrated graphics controllers. <br><br><img src="https://habrastorage.org/files/e77/c31/965/e77c3196549a4f63a20edacfa48e80fc.jpg" align="right">  Displays differ in size, parameters of the matrix, the presence of a capacitive or resistive touch screen and additional options such as a mounting frame.  Most modern Riverdi displays are equipped with FTDI graphics controllers - the FT80x and FT81x microcircuits, which execute commands for drawing graphics primitives, process data from the touch input channel and the audio channel.  In other words, FTDI microcircuits perform the role of a graphic coprocessor, on which all complex resource-intensive tasks are shifted from the main microcontroller.  The program, which "turns" on the control microcontroller, uses the libraries from FTDI and with their help forms simple commands for managing the graphics module.  For communication between the central controller and the FT80x / FT81x chip, I2C or SPI serial interface is used. <br><br>  The order of control of the graphics controller and the features of FTDI development tools will also be discussed in the following articles. <br><br>  The assortment of TFT modules can be found on <a href="https://riverdi.com/product-category/displays/">the manufacturer‚Äôs website</a> and on our website.  On display with a diagonal of 2.83 ", 5" and 7 "just <a href="http://www.efo.ru/doc/Riverdi/Riverdi.pl%3F10020">special prices are valid</a> . <br><br>  For the demonstration project, the RVT43ULFNWC00 uxTouch series TFT module is used.  It has a 4.3 ‚Äùdiagonal, capacitive touchscreen and an integrated graphics controller FT801. <br><br>  UxTouch displays are the cutest of all existing Riverdi modules.  They are made in a decorative frame, covered with protective glass and do not have external mounting fixtures and holes.  To install the display in the case, an adhesive surface is provided, which is located on the back side of the decorative frame around the entire perimeter of the display.  All this looks really great - when you twist the module in your hands, your hands and eyes that are used to the ipad do not feel any trick. <br><br><h1>  Debug board and mbed </h1><hr><br>  To interrogate the sensor and display the data on the TFT-display, in the presence of the FT801 chip, a high-performance microcontroller is not required.  Most often, even an 8-bit crystal is enough, in this is actually the chip of using an FTDI graphics controller. <br><br>  However, for the sake of my desire to get acquainted with mbed, I still use the ARM Cortex-M platform - I use the SLSTK3400A as the main working board, and the ATSAMD21-XPRO from Atmel and WIZwiki-W7500P from Wiznet as alternatives.  In addition to the required I2C and SPI interfaces, target controllers have a fairly decent amount of memory - at least 64 KB Flash.  This bonus will allow to realize not only the beautiful display of information received from the sensor, but also, for example, the storage of images. <br><br><img src="https://habrastorage.org/files/40d/536/4d5/40d5364d5c544c05906b68c5459faafe.png"><br><br>  On debug boards, we don‚Äôt need most of the available peripherals.  SiLabs power metering circuits, Wiznet's hardware Ethernet, as well as endless controllers, touch and mechanical buttons, LEDs and LCDs - everything goes in the forest.  We pay attention only to the presence of the built-in USB debugger and the conclusions of the necessary digital signals. <br><a name="example"></a><br>  <b>Now about mbed.</b> <br><br>  Mbed is a software platform for developing IoT devices based on microcontrollers with an ARM Cortex-M core.  The platform is developed by the ARM company itself and manufacturers of microcontrollers.  I will not touch on many of the mbed tools (cloud services, encryption tools, mbed OS, etc.).  Only the online IDE, the mbed ‚Äúbase‚Äù library and drivers for pairing the debug card with other devices will be considered. <br><br>  The mbed libraries provide a level of abstraction at which a program is written not for a specific STM32 / Atmel / NXP controller, but immediately for any platform that is supported in mbed.  Platform support means that mbed calls correctly address the entire HAL of the target microcontroller, that mbed understands the topology of the debugging board, and that the debugging board is recognized on the PC as an external drive and is flashed by simply copying the binary file to this drive. <br><br>  For instructions on how to register on developer.mbed.org, compile and run a demo program, detailed instructions have already been written.  <a href="https://habrahabr.ru/company/efo/blog/277899/">Here</a> , for example, a guide to the flashing LED of my authorship. <br><br>  Therefore, we will immediately proceed to the <a href="">preparation of the future project</a> - a simple program for outputting the seconds counter to the serial port. <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"mbed.h"</span></span></span><span class="hljs-meta"> Serial pc(USBTX, USBRX); Ticker timeKeeping; volatile uint64_t seconds = 0; void secondsCallback(void) { pc.printf(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Number of seconds: %x\r\n"</span></span></span><span class="hljs-meta">, seconds); seconds ++; } int main() { timeKeeping.attach(&amp;secondsCallback, 1.0f); while(1) {} }</span></span></code> </pre> <br>  Create a project consisting of the main.cpp file and the mbed library package, compile the program, get the automatically downloaded binary file and copy it to the SLSTK3400A board, which is defined by the computer as an external disk. <br><br>  Now, by running Terminal, we get the required data from the controller. <br><br><img src="https://habrastorage.org/files/4ec/c31/6fe/4ecc316fec904a41a9aee760f174fcd3.png"><br><br>  In order to generate firmware for the Atmel and Wiznet boards, it is enough to change the target platform, <br><br><img src="https://habrastorage.org/files/a80/060/70b/a8006070b6454fa69d80f7ca3bfce1e1.png"><br><br>  After that, re-compile the project and copy the resulting file to the appropriate disk - XPLAINED or MBED (yes, the Koreans were different in inventing names). <br><br><img src="https://habrastorage.org/files/9b7/2c6/7ef/9b72c67ef27d48e0a5cbf567406be0e2.png"><br><br>  On the Mac, the program immediately started working on all three boards, and on Windows it was necessary to install the mbed <a href="https://developer.mbed.org/handbook/Windows-serial-configuration">COM port driver</a> .  Without it, only the SiLabs board wanted to communicate via the serial interface.  However, this is a regular situation, well described by ARM itself. <br><br>  Here it is time to notice one of the main disadvantages of mbed: printf - this is in fact the only available debugging tool.  In addition to debugging with breakpoints and access to the microcontroller registers, mbed has other obvious limitations.  For example, universal peripheral drivers by definition cannot support all the features of the peripherals of each controller, that is, mbed may not have libraries for unusual modules or support for some non-standard modes of operation of your microcontroller's peripherals.  And it can be exactly those modes and modules, because of which you chose your own klistall. <br><br>  Also, of course, mbed is not the best tool for creating complex applications related to scheduling tasks and multithreading (although I am not aware of what the new mbed OS 5 can do).  Well, in the end, the list of supported hardware platforms is far from complete. <br><br>  To fall in love with mbed, you need to understand well the range of tasks for which it is intended (thanks, captain).  In my opinion, the mbed platform works best: <br><br>  a) for prototyping and rapid development of new components, <br>  b) to get acquainted with the programming of microcontrollers. <br><br>  The key features of mbed are the versatility, accessibility and ease of use of software libraries, as well as the ability to export software written in mbed to ‚Äúadults‚Äù IDE. <br><br><img src="https://habrastorage.org/files/43e/4ba/0b2/43e4ba0b27114d7e86883f7cad1dbc8a.png"><br><br>  When prototyping, the scenario ‚Äúquickly launched a working solution out of the box -&gt; exported the program to a familiar IDE and brought to mind‚Äù becomes possible, and to master programming of microcontrollers, the transition from flashing the arduino LED to more serious things is simplified. <br><br>  Another plus of mbed is the integration of the version control system into the compiler, as well as the very idea of ‚Äã‚Äãsimply exchanging software modules.  It is believed that developers of embedded systems use version control systems rather reluctantly.  Mbed is an excellent reason to finally feel the advantages of using version control, if you didn‚Äôt reach your hands before.  As for the publication of our own developments and the use of foreign libraries and projects, taking into account the iron-independent mbed-programs, the idea of ‚Äã‚Äãopensource for embedded looks much more attractive than usual. <br><br><hr><br>  Returning to my project, I will immediately say that the final program, originally written for the SiLabs microcontroller, works absolutely correctly on the Atmel and Wiznet boards.  In theory, everything should work on other available microcontroller platforms, the full list of which is available on <a href="https://developer.mbed.org/platforms/">developer.mbed.org/platforms/</a> . <br><br>  It also makes sense to look at the list of supported <a href="https://developer.mbed.org/components/">developer.mbed.org/components/</a> components.  For all the listed displays, servo drives, sensors, wireless controllers and other modules, a library and an example of its use are available.  For my Riverdi TFT module (more precisely for the FT800 series of controllers), such a library was <a href="https://developer.mbed.org/components/EVE-FT800/">already created by one of the users</a> , while the driver for the HYT sensor was written during the development of this project. <br><br>  The application development process will be consistently described in the following articles, and I can show the video with a working build now. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/nYildtT047Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><h1>  Conclusion </h1><hr><br>  In conclusion, I traditionally thank the reader for his attention and remind you that questions about the use of products, about which we write on Habr√©, can also be asked by email, specified in my profile. </div><p>Source: <a href="https://habr.com/ru/post/308440/">https://habr.com/ru/post/308440/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../308426/index.html">Increase conversion</a></li>
<li><a href="../308428/index.html">Music, Mathematica and Computational Universe: Automatic Music Creation Based on Cellular Automata</a></li>
<li><a href="../308432/index.html">Everything is under control: we protect corporate conversations. Part 3: Secure SIM Card</a></li>
<li><a href="../308434/index.html">Financial accounting in the text console</a></li>
<li><a href="../308438/index.html">Mobile App Metrics Overview</a></li>
<li><a href="../308442/index.html">Becoming a PostgreSQL Contributor</a></li>
<li><a href="../308444/index.html">Alawar experience: how to increase eCPM advertising in the game by 150%</a></li>
<li><a href="../308446/index.html">Why am I still using function in javascript?</a></li>
<li><a href="../308448/index.html">Neural networks for curious programmers (with an example in c #)</a></li>
<li><a href="../308450/index.html">History of programming languages: from Objective C to Swift</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>