<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GWT + Hibernate + Dispatch</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When creating a portal, very often the main function of BackEnd is to work with the database. As a rule, now no one uses the usual and not very conven...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GWT + Hibernate + Dispatch</h1><div class="post__text post__text-html js-mediator-article"> When creating a portal, very often the main function of BackEnd is to work with the database.  As a rule, now no one uses the usual and not very convenient for writing Statement'y, and in place of this use ORM frameworks.  In the case of GWT, this framework is likely to become Hibernate, since we have Java on the server.  I was not the first to think that it would be extremely convenient and simple to transfer not individual data but the entire POJO (persistent objects) used by Hibernate.  So I created my service, returning to the client part of the POJO.  POJO is inherited from Serializable.  I run the application and get the following exception: <br><br> <code>Caused by: com.google.gwt.user.client.rpc.SerializationException: Type 'org.hibernate.collection.PersistentSet' was not included in the set of types which can be serialized by this SerializationPolicy or its Class object could not be loaded. For security purposes, this type will not be serialized. <br> at com.google.gwt.user.server.rpc.impl.StandardSerializationPolicy.validateSerialize(StandardSerializationPolicy.java:83) <br> at com.google.gwt.user.server.rpc.impl.ServerSerializationStreamWriter.serialize(ServerSerializationStreamWriter.java:591 <br></code> <br><br>  It was not immediately clear what went wrong.  The fact is that as soon as an object becomes persistent, a number of changes occur in it that are necessary for Hibernate to work.  For example, the usual Set is changed to PersistentSet.  Because of this, the browser can no longer deserialize the object sent to it, under any circumstances. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Integration Ways </h5><br>  As I have already said, I am not the first who wanted to transfer the POJO to the client side, and as a result, it was not the first who faced a similar problem.  On the Internet, you can find three main ways to solve this problem and integrate Hibernate with GWT. <br>  ‚Ä¢ DTO (Data Transfer Objects) - you can create your objects to transfer data to the client side of the application that are not persistent, but otherwise contain all the same fields as in the POJOs you use. <br>  ‚Ä¢ Using the Dozer library for mapping objects - This library automatically copies data from one object to another.  For it to work correctly, Objects must contain the same fields and getters and setters named according to JavaBean notation. <br>  ‚Ä¢ Using the Gilead library, also known as hibernate4gwt. <br>  The first option is quite trivial, and I will not consider it, as well as the second, which is just a little more advanced first.  If you are interested in the second option, you can find all the necessary information about the library on the official website <a href="http://dozer.sourceforge.net/">dozer.sourceforge.net</a> <br><br><h5>  Gilead </h5><br>  Much more interesting is the last option, which I will now tell.  Glead is an open library that provides the ability to freely transfer POJOs between the client and server parts of an application.  When using this library, a layer called PersistentBeanManager appears on the server between the Java server and the client.  When an object is transferred from the server to the client, the PBM automatically clones the POJO into a similar client object, while ignoring all LazyInitiaslization and replacing the fields that have not yet been initialized with NULL.  At the same time keeping the POJO in memory.  On the reverse PBM, the client object is stored with the POJO stored in it and sends the POJO with already updated data to the server. <br>  To use this incredibly convenient miracle you need to add a library project.  Connect the required module to gwt.xml, examine all POJO LightEntity, and use the servlet instead of the RemoteServiceServlet PersistantRemoteService.  Perhaps it would be worthwhile to simply describe this process and end with this article, but as you can see in the title of the article there is the word Dispatch.  The fact is that a lot of people use the Dispatch programming pattern with the gwt-dispatch library based on dependency injection using the Guice library to reuse code.  When using such a library in your project there is no service class.  You use the standard GuiceStandardDispatchServlet service, which is sewn inside the gwt-dispatch library.  In order to get around this, I slightly rebuilt this library. <br><br><h5>  Gilead + Dispatch </h5><br>  First you need to rebuild the gwt-dispatch library.  For this we use some mercury client and take the surases from the repository. <code><a href="https://code.google.com/p/gwt-dispatch/"></a> hg clone code.google.com/p/gwt-dispatch</code> <br>  We create a project in the IDE in which it is more convenient for you, where all this is and we push.  I use Eclipse.  Further that the project would gather I added the following libraries to .classpath <br>  ‚Ä¢ gilead-core-1.3.2.1839.jar <br>  ‚Ä¢ gliead-hibernate-1.3.2.1839.jar <br>  ‚Ä¢ glead4gwt-1.3.2.1839.jar <br>  ‚Ä¢ gin-1.5-post-gwt-2.2.jar <br>  ‚Ä¢ guice-3.0.jar <br>  ‚Ä¢ hibernate.jar <br>  ‚Ä¢ org.springframework.beans-3.1.2.RELEASE.jar <br>  ‚Ä¢ org.springframework.context-3.1.2.RELEASE.jar <br>  ‚Ä¢ org.springframework.web-3.1.2.RELEASE.jar <br>  Open the net.customware.gwt.dispatch.server.standard.AbstractStandardDispatchServlet class and make several changes to it in order for our library to work correctly: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractStandardDispatchServlet</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PersistentRemoteService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StandardDispatchService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AbstractStandardDispatchServlet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ HibernateUtil hibernateUtil = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HibernateUtil(); SessionFactory sf; Configuration conf = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Configuration(); conf.configure(); conf.getProperties(); sf = conf.buildSessionFactory(); hibernateUtil.setSessionFactory(sf); PersistentBeanManager persistentBeanManager = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PersistentBeanManager(); persistentBeanManager.setPersistenceUtil(hibernateUtil); StatelessProxyStore sps = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StatelessProxyStore(); sps.setProxySerializer(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GwtProxySerialization()); persistentBeanManager.setProxyStore(sps); setBeanManager(persistentBeanManager); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> &lt;R extends Result&gt; <span class="hljs-function"><span class="hljs-function">R </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Action&lt;R&gt; action)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> DispatchException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Dispatch dispatch = getDispatch(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dispatch == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServiceException(<span class="hljs-string"><span class="hljs-string">"No dispatch found for servlet '"</span></span> + getServletName() + <span class="hljs-string"><span class="hljs-string">"' . Please verify your server-side configuration."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dispatch.execute(action); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (RuntimeException e) { log(<span class="hljs-string"><span class="hljs-string">"Exception while executing "</span></span> + action.getClass().getName() + <span class="hljs-string"><span class="hljs-string">": "</span></span> + e.getMessage(), e); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServiceException(e); } } <span class="hljs-comment"><span class="hljs-comment">/** * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> The Dispatch instance. */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> Dispatch </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDispatch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre><br>  After all the changes have been made, we can safely build the library and add it to the project (or you can simply replace the .class file in the old one).  It is also necessary to add the following libraries to the project. <br>  ‚Ä¢ beanlib-5.0.5.jar <br>  ‚Ä¢ beanlib-hibernate-5.0.5.jar <br>  ‚Ä¢ com.springsource.net.sf.cglib-2.2.0.jar <br><br>  We include in gwt.xml gilead so that the client side knows about our LightEntity <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">inherits</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"net.sf.gilead.Gilead4Gwt"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  And inherited by all POJO LightEntity as shown below. <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"CARD"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Card</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LightEntity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue</span></span>(strategy = GenerationType.IDENTITY) <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"CARDID"</span></span>, columnDefinition = <span class="hljs-string"><span class="hljs-string">"BIGINT NOT NULL AUTO_INCREMENT"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> cardId; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"CARDNUMBER"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String cardNumber; <span class="hljs-meta"><span class="hljs-meta">@ManyToOne</span></span> <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"USERID"</span></span>, insertable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, updatable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> User user; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"ACTIVATED"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Integer activated; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Long </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCardId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cardId; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setCardId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long cardId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cardId = cardId; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCardNumber</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cardNumber; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setCardNumber</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String cardNumber)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cardNumber = cardNumber; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> User </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> user; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(User user)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.user = user; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Integer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getActivated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> activated; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setActivated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Integer activated)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.activated = activated; } }</code> </pre><br>  Well, that's all.  Now you can safely transfer your persistent objects between the server and client parts of the GWT application while continuing to use Dispatch. <br></div><p>Source: <a href="https://habr.com/ru/post/154321/">https://habr.com/ru/post/154321/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../154311/index.html">How I Boost.Any with Boost.mpl was friends</a></li>
<li><a href="../154313/index.html">ORM for Sitecore do it yourself</a></li>
<li><a href="../154315/index.html">In-depth review of freshly baked Linux 3.6</a></li>
<li><a href="../154317/index.html">Meet the free and free Scada headset</a></li>
<li><a href="../154319/index.html">Popular about pseudo-elements: Before and: After</a></li>
<li><a href="../154323/index.html">Granular restoration of virtualized application objects</a></li>
<li><a href="../154325/index.html">Time capsule</a></li>
<li><a href="../154327/index.html">Continuous Delivery & Sitecore: our implementation</a></li>
<li><a href="../154331/index.html">About a dozen useful opensource libraries for iOS developers</a></li>
<li><a href="../154333/index.html">The best way to learn English for single men</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>