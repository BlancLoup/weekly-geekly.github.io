<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How many neurons do you need to find out if the Alexander Nevsky Bridge is divorced?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 


 That week darkk described his approach to the problem of recognizing the state of a bridge (reduced / divorced). 


 The algorithm de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How many neurons do you need to find out if the Alexander Nevsky Bridge is divorced?</h1><div class="post__text post__text-html js-mediator-article"><p><img src="http://xn--80aame3bgcj.xn--p1ai/wp-content/uploads/2015/08/%D0%9C%D0%BE%D1%81%D1%82-%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B0%D0%BD%D0%B4%D1%80%D0%B0-%D0%9D%D0%B5%D0%B2%D1%81%D0%BA%D0%BE%D0%B3%D0%BE-4.jpg" alt="image"></p><br><h1>  Introduction </h1><br><p>  That week <a href="https://habrahabr.ru/users/darkk/" class="user_link">darkk</a> described his <a href="https://habrahabr.ru/post/306798/">approach</a> to the problem of recognizing the state of a bridge (reduced / divorced). </p><br><p>  The algorithm described in the article used computer vision techniques to extract features from pictures and fed them logistic regression to estimate the likelihood that the bridge is collapsed. </p><br><p>  In the comments, I asked to post pictures so that you can play yourself.  <a href="https://habrahabr.ru/users/darkk/" class="user_link">darkk</a> responded to the request, for which he thanks a lot. </p><br><p>  In the past few years, neural networks have gained a strong popularity, as an algorithm that manages to automatically extract features from data and process them, and this is done so simply from the point of view of who writes the code and such high accuracy is achieved that in many tasks ( ~ 5% of all tasks in machine learning) they tear competitors into the British flag with such a margin that other algorithms are not even considered.  One of these successful areas for neural networks is image manipulation.  After convincing victory of convolutional neural networks at the ImageNet competition in 2012, the public in academic and not-so-rounder circles got so excited that scientific results, as well as software products in this direction, appear almost every day.  And, as a result, in many cases it became very simple to use neural networks and they turned from ‚Äúfashionable and youth‚Äù into an ordinary tool used by machine learning experts, and simply everyone. </p><br><a name="habracut"></a><br><h1>  Formulation of the problem. </h1><br><p>  <a href="https://habrahabr.ru/users/darkk/" class="user_link">darkk</a> posted images of the Alexander Nevsky Bridge in St. Petersburg.  30k + in raised position, 30k + in lowered position, 9k + in intermediate position. </p><br><p>  The task we are trying to solve: using images from a static camera, which is aimed at the Alexander Nevsky Bridge at different times of day, night, and season, determine the probability that the bridge belongs to the classes (raised / lowered / process).  I will work with the classes raised / lowered for reasons that this is important from a practical point of view. </p><br><p>  Neural networks can solve quite complex tasks with images, noisy data, in conditions when there is very little data for training and other exotics (For example, <a href="https://www.kaggle.com/c/state-farm-distracted-driver-detection">this is a problem about distracted drivers</a> or <a href="https://www.kaggle.com/c/ultrasound-nerve-segmentation">this one about nerve segmentation</a> . But! The task of classification is on balanced data, there is enough data and the object of classification practically does not change - for neural networks, and indeed for machine learning tasks - this is somewhere between simple and very simple, which <a href="https://habrahabr.ru/users/darkk/" class="user_link">darkk</a> demonstrated using rather simple and <a href="https://habrahabr.ru/users/darkk/" class="user_link">inactive</a>  A conceptualized combination of computer vision and machine learning. </p><br><p>  The task that I will try to solve is to evaluate what neural networks can offer on this issue. </p><br><h1>  Data preparation. </h1><br><p>  Despite the fact that the neural networks are sufficiently resistant to noise, nevertheless, slightly clean the data - it never hurts.  In this case, it is to crop the picture so that there is at the maximum of the bridge and at the minimum of everything else. </p><br><p>  It was in this way: </p><br><img src="https://habrastorage.org/files/d80/e03/6b7/d80e036b7b60424abd3f5dc5455a0e65.jpeg" alt="image"><br><p>  And it became like this: </p><br><img src="https://habrastorage.org/files/587/4d7/838/5874d78383de44f2aac1460ef081ab9d.jpeg"><br><p>  You also need to divide the data into three parts: </p><br><ol><li>  train </li><li>  validation </li><li>  test </li></ol><br><p>  train - May 19 - July 17 <br>  validation - July 18, 19, 20 <br>  test - July 21, 22, 23 </p><br><p>  Actually, on this the preparation of images is over.  Trying to isolate the lines, angles, some other signs are not necessary. </p><br><p>  <a href="https://github.com/ternaus/spb_bridges/blob/master/src/split_data.py">code</a> </p><br><h1>  Training model </h1><br><p>  We define a simple convolutional network in which the convolutional layers extract features, and the last layer tries to answer our question. <br>  (I‚Äôll use <a href="https://keras.io/">Keras</a> with <a href="http://deeplearning.net/software/theano/">Theano</a> as a backend simply because it's cheap and <a href="https://keras.io/">good-tempered</a> .) </p><br><img src="https://habrastorage.org/files/e53/c28/66e/e53c2866ecc349249dd5fda1af55f195.png"><br><p>  We have a fairly simple task, a simple network structure with a small number of free parameters, so the network converges remarkably.  All pictures can be shoved into memory, but I don‚Äôt want to, so we will train to read pictures from a disk in batches. </p><br><p>  The training process looks something like this: </p><br><pre><code class="bash hljs">Using Theano backend. Using gpu device 0: GeForce GTX 980 Ti (CNMeM is disabled, cuDNN 5103) Found 59834 images belonging to 2 classes. Found 6339 images belonging to 2 classes. [2016-08-06 14:26:48.878313] Creating model Epoch 1/10 59834/59834 [==============================] - 54s - loss: 0.1785 - acc: 0.9528 - val_loss: 0.0623 - val_acc: 0.9882 Epoch 2/10 59834/59834 [==============================] - 53s - loss: 0.0400 - acc: 0.9869 - val_loss: 0.0375 - val_acc: 0.9880 Epoch 3/10 59834/59834 [==============================] - 53s - loss: 0.0320 - acc: 0.9870 - val_loss: 0.0281 - val_acc: 0.9883 Epoch 4/10 59834/59834 [==============================] - 53s - loss: 0.0273 - acc: 0.9875 - val_loss: 0.0225 - val_acc: 0.9886 Epoch 5/10 59834/59834 [==============================] - 53s - loss: 0.0228 - acc: 0.9896 - val_loss: 0.0182 - val_acc: 0.9915 Epoch 6/10 59834/59834 [==============================] - 53s - loss: 0.0189 - acc: 0.9921 - val_loss: 0.0142 - val_acc: 0.9961 Epoch 7/10 59834/59834 [==============================] - 53s - loss: 0.0158 - acc: 0.9941 - val_loss: 0.0129 - val_acc: 0.9940 Epoch 8/10 59834/59834 [==============================] - 53s - loss: 0.0137 - acc: 0.9953 - val_loss: 0.0108 - val_acc: 0.9964 Epoch 9/10 59834/59834 [==============================] - 53s - loss: 0.0118 - acc: 0.9963 - val_loss: 0.0094 - val_acc: 0.9979 Epoch 10/10 59834/59834 [==============================] - 53s - loss: 0.0111 - acc: 0.9964 - val_loss: 0.0083 - val_acc: 0.9975 [2016-08-06 14:35:46.666799] Saving model [2016-08-06 14:35:46.809798] Saving <span class="hljs-built_in"><span class="hljs-built_in">history</span></span> [2016-08-06 14:35:46.810558] Evaluating on <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> Found 6393 images belonging to 2 classes. [0.014433901176242065, 0.99405599874863126] ...</code> </pre> <br><p>  <a href="https://github.com/ternaus/spb_bridges/blob/master/src/simple_cnn.py">code</a> </p><br><p>  Or in the pictures: </p><br><img src="https://habrastorage.org/files/f31/5d1/07a/f315d107ac7a44ce88927a61bbb9592f.png"><br><img src="https://habrastorage.org/files/249/1c8/38d/2491c838d9074584b36b83df3c570c7b.png"><br><p>  It can be seen that we have not tested and the accuracy of the model can be improved simply by increasing the training time.  But, as careless teachers like to say in universities, this is a homework for those who wish. </p><br><h1>  Estimation of prediction accuracy </h1><br><h2>  Numerical </h2><br><p>  Accuracy assessment will be made on July 21-23. <br>  accuracy_score = 0.994 <br>  roc_auc_score = 0.985 <br>  log_loss_score = 0.014 </p><br><h2>  Visual </h2><br><img src="https://habrastorage.org/files/be6/f8d/bdc/be6f8dbdc2eb4478bc091c63ee988c97.png"><br><p>  The green line is what is marked in the pictures. <br>  The blue line is the running average of the previous 20 predictions. </p><br><p>  <a href="https://github.com/ternaus/spb_bridges/blob/master/notebooks/Postprocessing.ipynb">code that creates pictures</a> </p><br><h1>  What is behind the scenes. </h1><br><ul><li><p>  Why when training a model, the accuracy on val is better than on train.  Answer: =&gt; because on train - this precision is with a dropout, but on val - not </p><br></li><li><p>  Why was chosen such a model architecture.  Answer =&gt; I would like to say: ‚ÄúBut this is obvious!‚Äù, But the correct answer is probably all the same - we read the lecture notes at <a href="http://cs231n.github.io/">http://cs231n.github.io/</a> , we watch a series of lectures at <a href="https://www.youtube.com/watch%3Fv%3DPlhFWT7vAEw">https://www.youtube .com / watch? v = PlhFWT7vAEw</a> and chasing competitions on <a href="https://www.kaggle.com/">kaggle.com</a> until the insight comes as an answer: "This architecture was chosen because it works on very similar MNIST tasks" </p><br></li><li><p>  On which pictures the model gives an error.  Answer: =&gt; I looked with one eye - these are the pictures where a person cannot be distinguished simply because the camera did not work.  Perhaps there are adequate images in which the model gives an error, but it requires a more thoughtful analysis. </p><br></li><li><p>  Where to get the code from all of the above?  Answer =&gt; <a href="https://github.com/ternaus/spb_bridges">https://github.com/ternaus/spb_bridges</a> </p><br></li><li><p>  Will the model work on other bridges?  Answer =&gt; it is possible, but who knows, you have to try. </p><br></li><li><p>  And if the task was this: According to the images of the Alexander Nevsky Bridge to create a model to predict the dilution of the Foundry Bridge, would you act the same way?  Answer =&gt; No.  They have a different lifting system, so there they had to look at the data, try and think.  The question of correct cross validation would be very acute.  In general, this would be an interesting task. </p><br></li><li><p>  And if you do not crop the image, so that only the bridge remains, then the task would become much more difficult?  Answer =&gt; Would, but not much. </p><br></li><li><p>  And what if the classification is not done in two classes (reduced / divorced), but in three (reduced / divorced / in motion)?  Answer =&gt; If we classify into three classes, we get an estimate of belonging to one of the three classes.  But you need to change a few lines in the file that divides the data into parts, and one in the definition of the model.  =&gt; Homework for enthusiasts. </p><br></li><li><p>  An example of a complex task, on which it is necessary to break the brain, to make the model work well =&gt; Answer: Right now I‚Äôll finish the text, brush my <a href="https://github.com/ternaus/spb_bridges">github</a> c code.  and start thinking about <a href="https://www.kaggle.com/c/ultrasound-nerve-segmentation">segmentation of the nerves in the images.</a> </p><br></li><li><p>  Where can I get pictures of bridges?  Answer: =&gt; This is to <a href="https://habrahabr.ru/users/darkk/" class="user_link">darkk</a> </p><br></li><li>  How many neurons do you need to find out if the Alexander Nevsky Bridge is divorced?  Answer: =&gt; And one neuron, that is, the logistic regression will produce a remarkable result. </li></ul><br><h1>  Afterword. </h1><br><p>  This is indeed a very simple task for neural networks at this stage of development of this direction in machine learning.  And here even non-neural networks, but also simpler algorithms will work with a bang.  The advantage of neural networks is that they work in the mode of automatic extraction of signs, in the presence of a large amount of noise, and on some types of data, for example, when working with images, they give accuracy at the level of State Of The Art.  And with this text with the attached code I tried to dispel the opinion that working with neural networks is very difficult.  No, it is not.  Working with neural networks so that they show good accuracy on complex tasks is difficult, but many tasks do not fall into this category and the threshold for entering this area is not as high as it may seem after reading news on popular resources. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/307218/">https://habr.com/ru/post/307218/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../307206/index.html">HEIST allows you to receive encrypted information in the HTTPS channel in clear text</a></li>
<li><a href="../307208/index.html">Debian Linux and Tor for a secure deb</a></li>
<li><a href="../307210/index.html">Common mistakes of the novice HTML maker-up</a></li>
<li><a href="../307212/index.html">Do not Perseids uniform or Model flash satellite with their own hands</a></li>
<li><a href="../307214/index.html">Mikrotik QOS in distributed systems or smart shapers</a></li>
<li><a href="../307220/index.html">This little miracle is the Knut-Morris-Pratt (KMP) algorithm.</a></li>
<li><a href="../307222/index.html">About pricing for indie games</a></li>
<li><a href="../307224/index.html">Fairy, evil corporation and duck. How games are really made. Part 2. Programmer</a></li>
<li><a href="../307226/index.html">New x features: Bind in UWP</a></li>
<li><a href="../307228/index.html">Sensor of absolute pressure BMP180</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>