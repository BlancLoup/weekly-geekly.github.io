<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Android O and background services</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. Like most developers, I was too lazy to make complex changes from version to version of Android. The first such difficult change was ‚ÄúRuntime p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Android O and background services</h1><div class="post__text post__text-html js-mediator-article">  Hello.  Like most developers, I was too lazy to make complex changes from version to version of Android.  The first such difficult change was ‚ÄúRuntime permissions‚Äù, which came to us with the 6th android.  But this is already in the past. <br><br>  The topic of this publication will be changes in Android Oreo.  You can read more <a href="https://developer.android.com/about/versions/oreo/android-8.0-changes.html">here</a> .  All the articles that I found, with a possible solution to the problems, said "Just inherit the service from the <a href="https://developer.android.com/reference/android/support/v4/app/JobIntentService.html">JobIntentService</a> and use it in enqueueWork ()". <br><a name="habracut"></a><br>  Cool, yeah.  But not everything is so simple.  If you look at the CommandProcessor, you can see that the service stops immediately after running onHandleWork ().  This is because the IntentService is not intended to perform complex work, it is created for things like: event delivery, start of other services, and so on. <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((work = dequeueWork()) != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (DEBUG) Log.d(TAG, <span class="hljs-string"><span class="hljs-string">"Processing next work: "</span></span> + work); onHandleWork(work.getIntent()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (DEBUG) Log.d(TAG, <span class="hljs-string"><span class="hljs-string">"Completing work: "</span></span> + work); work.complete(); } <span class="hljs-comment"><span class="hljs-comment">//Work @Override public void complete() { if (DEBUG) Log.d(TAG, "Stopping self: #" + mStartId); stopSelf(mStartId); }</span></span></code> </pre> <br>  These articles and their solutions did not help me, as they are just a copy from developer.android.com.  Therefore, I continued to test and search for simple options for using services while the application is in the background (in compatibility with Android O).  And I found a way. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Using JobIntentService, you can try to start your service in the old-fashioned way, but the context provided by JobIntentService is not suitable for these purposes, but we can always request the application context.  But even when we have the application context, at the start of the service, the limitations of the android will stop us. <br><br>  What next?  These restrictions on background execution work only when you try to start the service with startService (), and if you use bindService, the android will not give you any errors.  But, in the case of a bind, the service will only be created and attached to the application and you need to do it all along with the creation and implementation of the ServiceConnection, on the call of which you need to run the required method (onHandleWork () or onHandleIntent () or the required method of your service). <br><br>  Doing all this, I came to the conclusion that this is not the easiest way.  So I wrote a small and simple library that can do it all for you.  It also allows you to use background services without their declaration in the manifest and the creation of any classes.  You can find it <a href="https://github.com/Euzee/serviceManager">here</a> . <br><br>  And a small example from the gita: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//No need to create classes and add manifest declarations ServiceManager.runService(context, () -&gt; {Logg.e(TAG,"Some Action");},true); //if you have already prepared service you can us it as : ServiceManager.runService(context, GeofenceTransitionsIntentService.class); //or if you need to add some data or actions you can use it like : Intent geo = new Intent(context, GeofenceTransitionsIntentService.class); geo.setAction(GeofenceTransitionsIntentService.ACTION_REQUEST_LOCATIONS); ServiceManager.runService(context, geo);</span></span></code> </pre><br>  In order to use the last 2 options - you need to examine the CompatService <br>  An example can be found <a href="https://github.com/Euzee/serviceManagerExample">here</a> . <br><br>  And going back to the topic of what I started with ‚ÄúThe first such difficult change was-Runtime permissions‚Äù, you can also evaluate <a href="https://github.com/Euzee/permissionUtil">my</a> solution to this problem. </div><p>Source: <a href="https://habr.com/ru/post/341106/">https://habr.com/ru/post/341106/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../341092/index.html">Results of web activity after 10 years</a></li>
<li><a href="../341094/index.html">Stryker, mutation testing in javascript</a></li>
<li><a href="../341096/index.html">Fake emails from almost any person in less than 5 minutes and ways to protect</a></li>
<li><a href="../341100/index.html">We help taxi service: redesign of the logo and the appearance of corporate identity</a></li>
<li><a href="../341102/index.html">Sharing with RAIDIX and Apple Xsan. Apple saved for video editors</a></li>
<li><a href="../341108/index.html">Moxy Strategies (Part 2)</a></li>
<li><a href="../341110/index.html">Another operating system architecture</a></li>
<li><a href="../341112/index.html">Another virtual machine architecture (part one)</a></li>
<li><a href="../341114/index.html">Another virtual machine architecture (part two)</a></li>
<li><a href="../341116/index.html">‚ÄúI will find out! I recognize my brother Kohl! "- The realities of modern information security in the field of wireless technologies</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>