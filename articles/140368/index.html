<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Overview Typesafe Stack 2.0 and an introduction to the model of actors on the example of Akka 2.0</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Typesafe Stack is a modern software platform that provides the ability to create highly scalable software systems in Java and Scala. The stack runs on...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Overview Typesafe Stack 2.0 and an introduction to the model of actors on the example of Akka 2.0</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/df6/fbf/7b3/df6fbf7b379cfe0d23ef5f72de96e2f8.png" alt="image"><br><br>  <a href="http://typesafe.com/">Typesafe Stack</a> is a modern software platform that provides the ability to create highly scalable software systems in Java and Scala.  The stack runs on the JVM, includes the <a href="http://akka.io/">Akka 2.0</a> and <a href="http://www.playframework.org/">Playframework 2.0</a> frameworks.  The core of the platform, which provides virtually unlimited scalability of the developed system, is the Akka library, which implements multitasking based on the model of actors. <a name="habracut"></a><br><br><h5>  Actor model </h5><br>  A rigorous definition of the model of actors, as well as the history of its origin and fundamental concepts can be found in <a href="http://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25B4%25D0%25B5%25D0%25BB%25D1%258C_%25D0%25B0%25D0%25BA%25D1%2582%25D0%25BE%25D1%2580%25D0%25BE%25D0%25B2">Wikipedia</a> .  In short, the model of actors proceeds from the philosophy that everything around is actors.  This is similar to the philosophy of object-oriented programming with the only difference that in the model of actors, calculations essentially coincide in time, as in object-oriented programming, as a rule, programs are executed sequentially.  In the actor model, there is no shared state, and data is exchanged using the mechanism for transferring messages from one actor to another.  Each actor has a queue of incoming messages that are processed by it sequentially.  Due to the lack of a shared state and sequential processing of messages, parallelization of computations in programs based on the model of actors is greatly simplified, and the reliability of such programs increases. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Akka </h5><br>  As written above, Akka implements the model of actors on the JVM.  Actors are also called lightweight threads (green threads).  Such streams are really lightweight, their number can reach ~ 2.7 million per 1 GB of RAM, and the number of transmitted messages is more than 20 million / s on a single node.  It is possible to organize the interaction of actors through the network, which provides almost unlimited scalability of the developed application.  More information about the features of Akka can be found on the <a href="http://akka.io/">official website</a> . <br><br><h5>  Typesafe and Akka usage example </h5><br>  Original: <a href="http://typesafe.com/resources/getting-started/tutorials/getting-started-with-akka-scala.html">here</a> <br><br>  Starting to use Akka as part of the Typesafe Stack is quite simple.  The configuration process is reduced to <a href="http://typesafe.com/resources/getting-started/typesafe-stack/downloading-installing.html">downloading the stack distribution kit and installing it</a> .  Although it is possible to use both Java and Scala for development, the use of the latter makes the program especially slim and easy to read and understand, so we will use Scala later in the example. <br><br><h6>  Formulation of the problem </h6><br>  In this example, we will use the actors to calculate the value of the PI number.  This operation uses a processor intensively, so Akka will allow parallel computing to be scalable on a multi-core machine.  The algorithm used is well parallelized because  Each of the calculations is independent, which is perfectly projected onto the model of actors.  The formula for the calculation is as follows: <br><br><img src="http://typesafe.com/resources/getting-started/_images/pi-formula.png" alt="image"><br><br>  The main actor will divide this series into components and send each of the members to the auxiliary actor for calculation (one auxiliary actor for each member of the series).  Upon completion of the calculation, each of the auxiliary actors will return the result to the main actor.  After receiving the results of all calculations, the main actor will form the answer. <br><br><h6>  Creating a project </h6><br>  First, you need to create a project from the <i>giter8</i> template (Typesafe Stack must be installed): <br> <code>c:\temp&gt;g8 typesafehub/akka-scala-sbt <br> <br> Akka 2.0 Project Using Scala and sbt <br> <br> organization [org.example]: akka.tutorial <br> package [org.example]: akka.tutorial.first.scala <br> name [Akka Project In Scala]: PI Calculator <br> akka_version [2.0]: <br> version [0.1-SNAPSHOT]: <br> <br> Applied typesafehub/akka-scala-sbt.g8 in pi-calculator <br></code> <br>  Now that the project has been created, go to the project folder: <br> <code>c:\temp&gt;cd pi-calculator <br></code> <br><h6>  Start writing code </h6><br>  First of all, you need to create a <code>./src/main/scala/akka/tutorial/first/scala/</code> file in the appropriate folder ( <code>./src/main/scala/akka/tutorial/first/scala/</code> ) and import the necessary libraries: <br> <code>import akka.actor._ <br> import akka.routing.RoundRobinRouter <br> import akka.util.Duration <br> import akka.util.duration._ <br></code> <br><h6>  Creating message templates </h6><br>  We clarify the architecture of our application briefly described above.  There is one <code>Master</code> actor that creates a multitude of <code>Worker</code> actors and initializes the calculation.  To do this, he divides the entire task into small operations and sends these operations for the <code>Worker</code> to perform to the actors.  After performing the operations, the <code>Worker</code> actors return the results for the aggregation.  After the calculation is completed, the <code>Master</code> actor sends the result <code>Listener</code> actor, which displays it on the screen. <br><br>  Based on this description, we will create messages that will be transmitted in the system: <br><ul><li>  <code>Calculate</code> - sent to the <code>Master</code> actor to start the calculation </li><li>  <code>Work</code> - sent by <code>Master</code> actor <code>Worker</code> actors, contains descriptions of the operation to be performed </li><li>  <code>Result</code> - sent by <code>Worker</code> actors <code>Master</code> actor </li><li>  <code>PiApproximation</code> - sent by <code>Master</code> <code>Listener</code> actor to actor, contains the result of the calculation and the time spent on the calculation </li></ul><br>  Messages sent to actors must be immutable in order to exclude a common mutable state.  In Scala, case classes are great for this.  We will also create a common basic trait for messages, which we denote as sealed in order to avoid the uncontrolled addition of messages: <br><pre> sealed trait PiMessage
 case object Calculate extends PiMessage
 case class Work (start: Int, nrOfElements: Int) extends PiMessage
 case class Result (value: Double) extends PiMessage
 case class PiApproximation (pi: Double, duration: Duration)
</pre><br><h6>  Creating the <code>Worker</code> Actor </h6><br>  Now we can create a <code>Worker</code> actor.  This is done by mixing the <code>Actor</code> trait and defining the <code>receive</code> method.  This method is a handler for incoming messages: <br><pre> class Worker extends Actor {

   // calculatePiFor ...

   def receive = {
     case Work (start, nrOfElements) ‚áí
       sender!  Result (calculatePiFor (start, nrOfElements)) // perform the work
   }
 }
</pre><br>  As you can see, we added the <code>Work</code> message handler, which creates a <code>Result</code> response message after the <code>calculatePiFor</code> operation and sends it back to the sender.  Now let's implement <code>calculatePiFor</code> : <br><pre> def calculatePiFor (start: Int, nrOfElements: Int): Double = {
   var acc = 0.0
   for (i ‚Üê start until (start + nrOfElements))
     acc + = 4.0 * (1 - (i% 2) * 2) / (2 * i + 1)
   acc
 }
</pre><br><br><h6>  Creating a <code>Master</code> Actor </h6><br>  <code>Master</code> actor is a bit more complicated.  a cyclic router is created in its constructor to facilitate the distribution of operations between <code>Worker</code> actors: <br><pre> val workerRouter = context.actorOf (
   Props [Worker] .withRouter (RoundRobinRouter (nrOfWorkers)), name = "workerRouter")
</pre><br>  Now we will write <code>Master</code> Actor.  This actor is created with the following parameters: <br><ul><li>  nrOfWorkers - the number of <code>Worker</code> actors </li><li>  nrOfMessages - the total number of chains of operations </li><li>  nrOfElements - the number of operations in one chain calculated by each <code>Worker</code> actor </li></ul><br>  So we have the following code: <br><pre> class Master (nrOfWorkers: Int, 
   nrOfMessages: Int, 
   nrOfElements: Int, 
   listener: ActorRef) extends Actor {

   var pi: Double = _
   var nrOfResults: Int = _
   val start: Long = System.currentTimeMillis

   val workerRouter = context.actorOf (
     Props [Worker] .withRouter (RoundRobinRouter (nrOfWorkers)), name = "workerRouter")

   def receive = {
     // handle messages ...
   }

 }
</pre><br>  In addition to the parameters described above, the <code>ActorRef</code> object, which is a reference to the <code>Listener</code> actor, is passed to the <code>Master</code> actor.  It should be noted that the transfer of messages between actors is always done through such links. <br><br>  But that's not all, because  we did not implement message handlers, which we will write now: <br><pre> def receive = {
   case Calculate ‚áí
     for (i ‚Üê 0 until nrOfMessages) 
       workerRouter!  Work (i * nrOfElements, nrOfElements)
   case Result (value) ‚áí
     pi + = value
     nrOfResults + = 1
     if (nrOfResults == nrOfMessages) {
       // Send the result to the listener
       listener!  PiApproximation (pi, duration = (System.currentTimeMillis - start) .millis)
       // Stops this actor and children
       context.stop (self)
     }
 }
</pre><br>  In general, the code should be clear, it should only be noted that after completing the calculation and sending the result to print, the <code>Master</code> actor stops using the <code>context.stop(self)</code> command. <br><br><h6>  Create <code>Listener</code> Actor </h6><br>  The implementation of this actor is quite simple.  It accepts the <code>PiApproximation</code> message from the <code>Master</code> actor, prints the result and stops the actor system: <br><pre> class Listener extends Actor {
   def receive = {
     case PiApproximation (pi, duration) ‚áí
       println ("\ n \ tPi approximation: \ t \ t% s \ n \ tCalculation time: \ t% s"
         .format (pi, duration))
       context.system.shutdown ()
   }
 }
</pre><br><br><h6>  Writing an Application Object </h6><br>  Now it remains only to write an application object and our program is ready: <br><pre> object Pi extends App {

   calculate (nrOfWorkers = 4, nrOfElements = 10000, nrOfMessages = 10000)

   // actors and messages ...

   def calculate (nrOfWorkers: Int, nrOfElements: Int, nrOfMessages: Int) {
     // Create an Akka system
     val system = ActorSystem ("PiSystem")

     // create the result listener 
     // shutdown the system
     val listener = system.actorOf (Props [Listener], name = "listener")

     // create the master
     val master = system.actorOf (Props (new Master (
       nrOfWorkers, nrOfMessages, nrOfElements, listener)),
       name = "master")

     // start the calculation
     master!  Calculate

   }
 }
</pre><br><br><h6>  Application launch </h6><br>  The easiest way to run an application from sbt.  To do this, go to the folder with the application and type the command <code>sbt</code> .  Then we execute the following sequence of commands: <br> <code>c:\temp\pi-calculator&gt;sbt <br> [info] Loading project definition from C:\temp\pi-calculator\project <br> [info] Set current project to PI Calculator (in build file:/C:/temp/pi-calculator/) <br> &gt; compile <br> [success] Total time: 0 s, completed 20.03.2012 16:33:03 <br></code> <br> <code>&gt; run <br> [info] Running akka.tutorial.first.scala.Pi <br> <br> Pi approximation: 3.1415926435897883 <br> Calculation time: 423 milliseconds <br> [success] Total time: 1 s, completed 20.03.2012 16:33:25 <br></code> <br>  If you reduce the number of actors to 1, the result will change: <br> <code>&gt; run <br> [info] Running akka.tutorial.first.scala.Pi <br> <br> Pi approximation: 3.1415926435897883 <br> Calculation time: 1160 milliseconds <br> [success] Total time: 2 s, completed 20.03.2012 16:35:16 <br></code> <br>  If you increase to 8, the result will be as follows: <br> <code>&gt; run <br> [info] Running akka.tutorial.first.scala.Pi <br> <br> Pi approximation: 3.1415926435897905 <br> Calculation time: 388 milliseconds <br> [success] Total time: 1 s, completed 20.03.2012 16:36:55 <br></code> <br>  The result is predictable, given that the tests were conducted on a 4-nuclear machine.  So increasing the number of actors to 16 gives almost no performance gain: <br> <code>&gt; run <br> [info] Running akka.tutorial.first.scala.Pi <br> <br> Pi approximation: 3.141592643589789 <br> Calculation time: 372 milliseconds <br> [success] Total time: 1 s, completed 20.03.2012 16:40:04 <br></code> <br>  The post about Play 2.0 is planned soon.  Good luck! </div><p>Source: <a href="https://habr.com/ru/post/140368/">https://habr.com/ru/post/140368/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../140361/index.html">Amazon buys robots company for $ 775 million</a></li>
<li><a href="../140362/index.html">Ruby 2.0 Lazy Enumerable</a></li>
<li><a href="../140363/index.html">What should a cyclist do in winter?</a></li>
<li><a href="../140364/index.html">What we do online. Alternative version</a></li>
<li><a href="../140367/index.html">The evening of Badoo at RHS ++ will end with the drawing of iPad 3!</a></li>
<li><a href="../140369/index.html">PHP warning / notice messages in the JS console + secret button</a></li>
<li><a href="../140372/index.html">Tablet Review: Sony Tablet P</a></li>
<li><a href="../140373/index.html">Steganography. Hide text information in the bmp file. Practical implementation in C #</a></li>
<li><a href="../140374/index.html">Using parse_transform</a></li>
<li><a href="../140375/index.html">Cloud Platform Overview</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>