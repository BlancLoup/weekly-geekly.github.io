<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Search for vulnerabilities in habrosite</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It was evening time, there was nothing to do ... It was decided to surprise the masters. But how? Banal searches for vulnerabilities on well-known sit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Search for vulnerabilities in habrosite</h1><div class="post__text post__text-html js-mediator-article">  It was evening time, there was nothing to do ... It was decided to surprise the masters.  But how?  Banal searches for vulnerabilities on well-known sites are no longer interesting to anyone.  Well, then we turn on the fantasy ... After all, users also have websites!  Urgently check their resistance! <br><a name="habracut"></a><br><h4>  How it all happened: </h4><br>  It was necessary to come up with a plan of action.  In principle, it was all about parsing as many user pages as possible and then parsing the pages of sites into them.  Then put all this on the scanner.  Something like this‚Ä¶ <br><br><h4>  How it works? </h4><br>  <b>Point one: Sparse pages.</b> <br>  Not everything is so simple, so you know ... On the / users page there is not as much as you want, users.  It was decided to recursively go through users and take there from subscribers of other users, and there are more users and more ... <br><br>  Uncovered a favorite python, imagination is included, this is written: <br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> urllib2, re start = <span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-string"><span class="hljs-string">"""    ,        """</span></span> page = urllib2.urlopen(<span class="hljs-string"><span class="hljs-string">"http://habrahabr.ru/users/"</span></span>+start+<span class="hljs-string"><span class="hljs-string">"/subscription/followers/"</span></span>).read() names = re.findall(<span class="hljs-string"><span class="hljs-string">'&lt;div class="username"&gt;&lt;a href="/users/(.*?)/"&gt;(.*?)&lt;/a&gt;&lt;/div&gt;'</span></span>, page) <span class="hljs-string"><span class="hljs-string">"""  , ,    ,        """</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">going</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(names)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> name <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> names: page = urllib2.urlopen(<span class="hljs-string"><span class="hljs-string">"http://habrahabr.ru/users/"</span></span>+name[<span class="hljs-number"><span class="hljs-number">0</span></span>]+<span class="hljs-string"><span class="hljs-string">"/subscription/followers/"</span></span>).read() names = re.findall(<span class="hljs-string"><span class="hljs-string">'&lt;div class="username"&gt;&lt;a href="/users/(.*?)/"&gt;(.*?)&lt;/a&gt;&lt;/div&gt;'</span></span>, page) <span class="hljs-string"><span class="hljs-string">"""       """</span></span> base = open(<span class="hljs-string"><span class="hljs-string">'habrs.txt'</span></span>, <span class="hljs-string"><span class="hljs-string">'a'</span></span>) writed = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> names: base.write(item[<span class="hljs-number"><span class="hljs-number">0</span></span>]+<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) writed = writed + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'Saved habrs\'s: '</span></span>+str(writed) going(names) going(names)</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After some time of work, a sufficient number of habra people (about 10k) were sparsened.  It is clear that most of these people repeat ... What to do? <br><br>  <b>Point two: Unify</b> <br>  Thinking, I decided that it would be unfair to ship the python.  Therefore the idea about array_unique from php got into my brain.  Thought - done. <br><br>  The whole script is to open-close the file, but on the other hand, uniqueization itself into one function. <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $arr = file_get_contents(<span class="hljs-string"><span class="hljs-string">"habrs.txt"</span></span>); $arr = explode(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>, $arr); $arr = array_unique($arr); $string = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($arr <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $name){ $string = $string.$name.<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>; } file_put_contents(<span class="hljs-string"><span class="hljs-string">"habrs2.txt"</span></span>, $string); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br><br>  Everything started from the console, everything works fine. <br>  It turned out a little less than 2k of unique habrois ... So now we need to go and find their sites. <br><br>  <b>Point three: Search sites</b> <br>  Again, I got a python, and wrote this.  It's very simple, go through the file (line by line), go to user pages, look for sites.  We find, we hide in the file. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> urllib2, re sites = <span class="hljs-string"><span class="hljs-string">""</span></span> users = file(<span class="hljs-string"><span class="hljs-string">"habrs2.txt"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> user <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> users: user = re.split(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>, user)[<span class="hljs-number"><span class="hljs-number">0</span></span>] page = urllib2.urlopen(<span class="hljs-string"><span class="hljs-string">"http://habrahabr.ru/users/"</span></span>+user+<span class="hljs-string"><span class="hljs-string">"/"</span></span>).read() site = re.findall(<span class="hljs-string"><span class="hljs-string">'&lt;a href="(.*?)" class="url icon" target="_blank"&gt;(.*?)&lt;/a&gt;'</span></span>,page) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(site) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> site, fake <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> site: sites += site+<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">"sites.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"a"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: f.write(sites)</code> </pre><br><br>  Sites turned out a decent amount, and if they did not repeat, they had an indigestible look. <br>  We need to clean them ... <br><br>  <b>Point Four: We Clean Websites</b> <br><br>  Use preg_match in php. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $arr = file_get_contents(<span class="hljs-string"><span class="hljs-string">"sites.txt"</span></span>); $arr = explode(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>, $arr); $string = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($arr <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $name){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (preg_match(<span class="hljs-string"><span class="hljs-string">'/http:\/\/([^\/]+)\//i'</span></span>, $name, $matches)) { $name = $matches[<span class="hljs-number"><span class="hljs-number">1</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> (preg_match(<span class="hljs-string"><span class="hljs-string">'/^http:\/\/([^\/]+)$/i'</span></span>, $name, $matches)) { $name = $matches[<span class="hljs-number"><span class="hljs-number">1</span></span>]; } $string = $string.$name.<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>; } file_put_contents(<span class="hljs-string"><span class="hljs-string">"sites2.txt"</span></span>, $string); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br><br>  We get a good list, ala: <br>  yandex.ru <br>  google.com <br>  yahoo.com <br><br>  Now you need to screw it all to the scanner, get an answer, hide it in a file ... <br><br>  <b>Point five: flight with a scanner</b> <br><br>  A firmware was written on python to manipulate the console. <br>  I am writing from memory, because this script was written on production (BackTrack r3 on a virtual machine), and after happy finding a huge heap of vulnerabilities the whole thing was closed, without saving (virtualka in the sense), so the script itself was not saved <br>  The point is to run the nikto.pl script for 60 seconds, and that it will have time during this time, write to the file with the name of the site (for ease of further processing). <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os, time sites = file(<span class="hljs-string"><span class="hljs-string">"sites2.txt"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> site <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sites: os.system(<span class="hljs-string"><span class="hljs-string">"perl nikto.pl -h "</span></span>+site+<span class="hljs-string"><span class="hljs-string">" | tee "</span></span>+site+<span class="hljs-string"><span class="hljs-string">".txt"</span></span>) os.system(<span class="hljs-string"><span class="hljs-string">"pidof perl | tee perlID.txt"</span></span>) time.sleep(<span class="hljs-number"><span class="hljs-number">60</span></span>) pid = file(<span class="hljs-string"><span class="hljs-string">"perlID.txt"</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>] os.system(<span class="hljs-string"><span class="hljs-string">"taskkill "</span></span>+pid)</code> </pre><br><br>  After this scanner was working, it was found in files of the form: site.txt, quickly found vulnerabilities (within 60 seconds). <br><br>  <b>Point Six: Debriefing</b> <br><br>  After some time of work (left for the night) I decided to see what kind of holes there ... <br>  Because the habrasoobshchestvo quite prosharenno in this case (in the information security in the sense), some reports were completely without pleasing the eyes of the plus sign ... <br><br>  However, among the 3 hundred sites were found and "holey" sites. <br><br><h4>  Vulnerability rating </h4><br>  one).  All sorts of open folders and files not allowed to access.  (40 ~ sites) <br>  2).  Various possible SQL and XSS sites.  (20 ~ sites) <br>  3).  Hazardous information exchange protocols, non-password memcached and all sorts of holes in admin areas (no check for file access, or an empty password = full password).  (10 ~ sites) <br>  four).  Candid bugs (or flaws).  The lack of a password for the admin panel (the script cursed as many as 12 files, and sent to see what was interesting there).  (2 sites) <br>  five).  An error encountered in a single copy, and then by mistake (I think), direct access to phpmyadmin with root login and without a password (default settings).  There were NO ANY vulnerabilities found on this site, so I think this is just an oversight. <br><br>  Not all users were checked, not all sites, not all possibilities from all possibilities! <br><br>  I hope that this post will be useful to someone (some administrator will suddenly check something on his site). <br>  Administrators of vulnerable sites notified.  I hope for positive thoughts in your heads! </div><p>Source: <a href="https://habr.com/ru/post/191434/">https://habr.com/ru/post/191434/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../191424/index.html">Simple 4-color multichannel garland based on the ATTINY13A microcontroller</a></li>
<li><a href="../191426/index.html">Three rules for good programming</a></li>
<li><a href="../191428/index.html">Calculation of the booster circuit for maximum battery power</a></li>
<li><a href="../191430/index.html">Create autonomous robot Frank. Part one</a></li>
<li><a href="../191432/index.html">Algorithm for generating a course for the game Scrabble</a></li>
<li><a href="../191436/index.html">Automatic code generation in Yii</a></li>
<li><a href="../191438/index.html">Why is not everything normal with normal distribution</a></li>
<li><a href="../191440/index.html">Delegation</a></li>
<li><a href="../191442/index.html">Android - Live Wallpaper on OpenGL ES 2.0 with Simplified DOF Effect</a></li>
<li><a href="../191444/index.html">Acer Aspire R7 laptop video review</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>