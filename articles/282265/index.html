<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating super-long flat panoramic images from video</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prehistory 
 A couple of years ago on Habr√© there was an article dedicated to Adam Magyar Einstein's Camera: how one photographer depicts time . I fou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating super-long flat panoramic images from video</h1><div class="post__text post__text-html js-mediator-article"><img width="500" src="https://habrastorage.org/files/aaa/f1f/556/aaaf1f556f37433fbf45896fdb8dff6e.jpg"><br><br><h3>  Prehistory </h3><br>  A couple of years ago on Habr√© there was an article dedicated to Adam Magyar <a href="https://habrahabr.ru/post/208820/">Einstein's Camera: how one photographer depicts time</a> .  I found it very interesting, but, to be honest, I didn‚Äôt understand the technology for shooting Stainless video.  I especially admired his photos of the subway train.  After that, I wondered: can I create something like this myself? <a name="habracut"></a><br><br><h3>  Formulation of the problem </h3><br>  Not far from the village where my relatives live, the railway passes and once went to visit me, I grabbed a camera and a tripod with me.  The essence of the task that I set for myself was to create a panoramic image of the train, long enough so that it could not be removed simply by assembling a flat panorama.  That is, I was going to shoot a video and cut along the central strip from each frame to combine them in the hope of getting a very long and beautiful panorama.  Since I was the proud owner of a Canon EOS 600D camera ( <a href="http://www.canon.ru/for_home/product_finder/cameras/digital_slr/eos_600d/">specifications</a> ) with a maximum frequency of 60 FPS with a video resolution of 1280x720, I did not have to rely on a higher frequency.  On the other hand, a panorama of 1280 pixels exceeds the vertical resolution of most monitors.  Therefore, I believed, the quality of the result should suit me. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Internet examples </h3><br>  Before proceeding, I would like to give a list of references to work on this topic that I was able to detect. <ul><li>  <a href="http://elm-chan.org/works/lcam/report.html">Fundamentals and Experiments of Line Scan Camera</a> .  Actually panoramas themselves: <a href="">one</a> and <a href="">two</a> </li><li>  <a href="https://medium.com/%40readmatter/bending-time-5106c5ad720c">Bending time.</a>  <a href="https://medium.com/%40readmatter/bending-time-5106c5ad720c">A showcase of photographs from Andreas Chudowski and Adam Magyar</a> </li><li>  <a href="http://www.kropilak.com/works/trains">Kropilak</a> </li></ul><br><br><h3>  Shooting!  Motor!  Go! </h3><br>  So, I set the tripod at a distance of about 10 meters from the rails (the closer to the rails, the stronger the shaking of the camera) and set the camera in an upright position.  Since we need only a middle bar from the entire video frame, it is more correct to install the camera in a vertical, not horizontal position, since in this case the resolution of the panorama will be higher.  For example, if the horizontal orientation is 1920X1080, it will give us a panorama of 1080 pixels in height, and a vertical orientation of 1080x1920 will give us a panorama of 1920 pixels in height. <br><img src="https://habrastorage.org/files/dd4/84b/686/dd484b686db24e258eab1b45892c186b.jpg"><br>  Shooting video is best done in manual mode, that is, without the participation of automation.  When an object enters the frame, the illumination of the scene can change dramatically, causing the camera to change the shutter speed or aperture, and this is undesirable.  Otherwise, different parts, for example, trains may be different in brightness.  The frame rate for the selected resolution should naturally be maximal.  We start shooting for 5-10 seconds before the moment the object enters the frame.  Firstly, just in case, secondly, the camera stopped moving after pressing the record button, and thirdly, you could select a background frame (if the lighting changes quickly, for example, because of clouds).  We also finish the shooting not immediately, but after 5 seconds. From my personal experience, I became convinced that when shooting, it is advisable to calculate whether the object will enter the frame completely and whether there will be extra empty space.  I have a few panoramas of the upper part of the trains a little cropped.  And of course, it is advisable to focus manually and focus on the object in advance (although it is difficult to do this, because the object itself is not yet available). <br><br><h3>  Software part </h3><br>  I have written the program Trainz Pano (C ++ Builder XE3).  64-bit application, OS - Windows 7/8/10.  She sharpened precisely on the creation of panoramas from the video.  The program is available as a commercial product and easily googled. <br><br><h3>  Work with the application </h3><br>  In order to make life easier for myself and users, I have broken the process of creating a panorama into two parts: the actual assembly and editing.  This was done due to the fact that a large amount of data should be saved at an intermediate stage in order not to lose them.  For this reason, the application is 64-bit. <br><br><h3>  Opening video </h3><br><br><img src="https://habrastorage.org/files/092/cfa/2fa/092cfa2faf16447cb507a185486b2be8.jpg"><br>  I did not bother with decoding the video myself, my application uses FFMPEG and first receives a set of images from the video, and then it works with them. <br><br><h3>  Background settings </h3><br><br><img src="https://habrastorage.org/files/4d6/1ae/d52/4d61aed52bcc4ba78202f22bc81915b0.jpg"><br>  In the very first image you can see a repeating pattern as a background.  This is due to the fact that a strip with a width of the order of several tens of pixels is cut out of each frame.  Actually they are repeated, if not overlapped by the object.  To get rid of such a background and replace it with monotonous lines in the application, it is possible to automate this process.  Unfortunately, the result sometimes disappoints me a little, so to get a quality result after the build process, you can proceed to retouching. So, set up the background parameters. <br><br><h3>  Assembling the panorama </h3><br>  When shooting a video camera, with respect to the object, it may not be located directly, but at a certain angle.  In addition, the camera may be located at an angle to the trajectory of the object.  To compensate for their influence, the application has two controls: <b>Rotation</b> and <b>Perspective</b> .  They are determined by selection in such a way that the resulting image does not have chipping when joining individual sections.  Another parameter is <b>Width</b> .  It is needed to specify the width of the strips that will be cut from the current frame and added to the resulting panorama.  All three parameters can be changed in the process of assembling the panorama.  However, <b>Rotation</b> and <b>Perspective</b> are most often configured at the initial stage and do not change in the future.  But the <b>Width</b> parameter may vary, since the speed of the object may be variable.  In my case, I have many times encountered acceleration and deceleration of trains. <br><img src="https://habrastorage.org/files/78c/e74/775/78ce747759e647e3ba31fa1157c5ae3c.jpg"><br>  If we shoot a video in a vertical orientation, then we will need to specify in the main menu a rotation angle multiple of 90 degrees.  There is one more thing to consider.  When I wrote the program, I proceeded from the fact that the movement of an object is carried out from right to left.  What if the object is actually moving from left to right?  To do this, you can use the item at the assembly stage to <b>reflect from left to right</b> , with all the inscriptions we will receive in mirror image.  And at the retouching stage we will use the <b>Reflection Panorama</b> command <b>from left to right</b> and everything will fall into place. <br><br><h3>  Retouching panorama </h3><br><br><img src="https://habrastorage.org/files/0dc/539/b98/0dc539b983b14edc940aaf44a266f818.jpg"><br>  To get rid of the repeating background (if the program could not do it itself) or to restore the image of the object, if it was incorrectly defined as the background, we load our image (more precisely, the image layers, there are 3 of them) into the program Trainz Pano Editor.  Here is a brief list of features that the program provides: <ul><li>  Retouching </li><li>  Adding pillars </li><li>  Deleting columns </li><li>  Vertical background shading </li><li>  Adding lines </li><li>  Delete rows </li><li>  Horizontal background shading </li><li>  Gradient transition </li><li>  Accelerated motion </li></ul><br><br><h3>  Video of work with the program </h3><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/8S331Rj-4mQ%3Ffeature%3Doembed&amp;xid=17259,15700002,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhinALMKPiYdZv2NwlgWX-tNOZMv3g" frameborder="0" allowfullscreen=""></iframe>  On-line help is <a href="http://www.aapsoftware.ru/products/trainz_pano/help/">here</a> . <br><br><h3>  View panoramas </h3><br>  When saving panoramas, one unpleasant detail emerged, namely, the JPEG format has a limit on the size of the image.  2 bytes are used for length and width, therefore, a panorama of more than 65535 pixels in length will not be recorded.  At the same time, I had panoramas of 200,000 pixels or more in length.  Saving in BMP and PNG does not create problems, only images in these formats take up a lot of disk space.  When I tried to open large panoramas for viewing, there were also some problems.  XnView and XnViewMP show a mash of pixels, what I wrote to the program's author, I hope this bug will be fixed in the next versions.  The built-in Windows Photo Viewer opened with a bang, and InfanView did not let us down.  In general, it should be assumed that not all viewers will show us long panoramas correctly. <br><br><h3>  Examples of my work </h3><br>  You can get acquainted with some examples of my work on the <a href="http://www.xn----7sbajjfo1bhkddcgl2p.xn--p1ai/">site</a> .  True, there they are significantly reduced in size. <br><img src="https://habrastorage.org/files/4f0/66e/9e2/4f066e9e23e8477e8970999586f7f5c4.jpg"><br><br><br><h3>  Possible scope </h3><br>  In addition to panoramic shooting of trains, the program can be used to create panoramas of columns of cars or motor vehicles, vessels, columns of people at parades, demonstrations, and demonstrations.  If there are good roads, you can try to take panoramic images of streets or landscapes, for example, from a train, tram or car. <br><br><h3>  Plans to improve the application </h3><br><ul><li>  Reading frames directly to the application without the need to intermediately save images to disk. </li><li>  Improve the speed of the assembly of panoramas. </li><li>  Write a new algorithm for determining the background. </li><li>  Write a JavaScript library using HTML5 Canvas to display very long panoramas. </li></ul><br><br><h3>  findings </h3><br><ul><li>  Currently there are no applications on the market for creating panoramic images from video files. </li><li>  Those single examples of panoramas that are available on the web are usually created using home-made blanks that are not ready-made commercial products. </li><li>  The program Trainz Pano to some extent solves the problem voiced above. </li><li>  Unfortunately, the Trainz Pano program has so far implemented an insufficiently high-quality technology for separating objects from the background, which (in general) leads to the need to retouch the panorama in a rather large volume. </li><li>  However, with proper use (choosing a good place to shoot against a monotonous background), the program can be used by both professionals and digital photo lovers. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/282265/">https://habr.com/ru/post/282265/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../282253/index.html">Solving the problems of organizing business logic in PHP or how to go your own way</a></li>
<li><a href="../282257/index.html">Generator iterator in promis or CryptoPro integration browser plugin</a></li>
<li><a href="../282259/index.html">Windows migration experience On Linux / Unix. Part 2</a></li>
<li><a href="../282261/index.html">Tinkoff Bank. Hackathon "Era Bots"</a></li>
<li><a href="../282263/index.html">Persistent OS: nothing is blocked</a></li>
<li><a href="../282267/index.html">A brief history of the World Wide Web according to web developers</a></li>
<li><a href="../282275/index.html">One way to find unshielded characters with new JavaScript tools</a></li>
<li><a href="../282277/index.html">Notes with MBC Symposium: applying deep learning in brain modeling</a></li>
<li><a href="../282281/index.html">How to use JSON restrictions when working with PostgreSQL</a></li>
<li><a href="../282283/index.html">Student projects within the Google Summer of Code</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>