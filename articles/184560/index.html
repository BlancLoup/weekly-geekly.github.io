<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>VKontakte iOS SDK</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good evening! 

 It all started with the fact that a more or less convenient tool was needed to work with the VKontakte social networking API for iOS....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>VKontakte iOS SDK</h1><div class="post__text post__text-html js-mediator-article">  Good evening! <br><br>  It all started with the fact that a more or less convenient tool was needed to work with the VKontakte social networking API for iOS.  However, Google quickly upset me with search results: <br><ul><li>  <a href="https://github.com/StonerHawk/Vkontakte-iOS-SDK">Stonewhawk - github</a> </li><li>  <a href="https://github.com/maiorov/VKAPI">maiorov / VKAPI - GitHub</a> </li></ul><br>  It seems to be all right, the most important thing is, but the use does not cause pleasant sensations. <br><br>  Under the cut, I will tell you how the new version of the VKontakte iOS SDK works, how it all began and what came to the end. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Pre-project </h4><br>  It all started with the fact that at work we received the task to connect social networks to the application.  We wanted the user to not notice any difference when interacting with different social networks (posting photos on the wall, sending a message, uploading photos, etc.). <br>  It was decided to look for ready-made solutions that would contain several social networks like VKontakte, Odnoklassniki, Twitter and Facebook, but nothing was found.  The use of ready-made solutions separately did not give the desired results, so we decided to write our bikes, having previously studied the Facebook iOS SDK, MGTwitterEngine and several other prominent libraries. <br><br>  As a result, we received <a href="https://github.com/AndrewShmig/ASASocialServices">ASASocialServices</a> (GitHub). <br>  The project was easy to use and install, more attention was paid to working with Twitter and Vkontakte, it was decided not to concentrate on Facebook. <br><br>  In ASASocialServices, work with three social networks (hereinafter, we will talk only about two) was carried out according to a single principle: the programmer creates a UIWebView, positions it and displays it, then starts the authorization process by the user of the application and, depending on the user‚Äôs decision, one of the three blocks is called handlers (success, error, cancel). <br><br>  When viewed in context, ViewController.h looks like this: <br><pre><code class="hljs scala">#<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> &lt;<span class="hljs-type"><span class="hljs-type">UIKit</span></span>/<span class="hljs-type"><span class="hljs-type">UIKit</span></span>.h&gt; #<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"ASASocialServices.h"</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> <span class="hljs-type"><span class="hljs-type">ViewController</span></span> : <span class="hljs-type"><span class="hljs-type">UIViewController</span></span> <span class="hljs-meta"><span class="hljs-meta">@property</span></span> <span class="hljs-type"><span class="hljs-type">UIWebView</span></span> *webView; <span class="hljs-meta"><span class="hljs-meta">@property</span></span> <span class="hljs-type"><span class="hljs-type">ASATwitterCommunicator</span></span> *tw; <span class="hljs-meta"><span class="hljs-meta">@end</span></span></code> </pre> <br><br>  ViewController.m <br><pre> <code class="hljs kotlin">#<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"ViewController.h"</span></span> NSString *<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> kTWITTER_CONSUMER_KEY = @<span class="hljs-string"><span class="hljs-string">"v8146mdwpo05uEroMnhozg"</span></span>; NSString *<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> kTWITTER_CONSUMER_SECRET = @<span class="hljs-string"><span class="hljs-string">"5AFkvjCKxqGBRId2fpSQFLClJLKtGcPGS1DzK7o"</span></span>; <span class="hljs-meta"><span class="hljs-meta">@implementation</span></span> ViewController - (void)viewDidLoad { [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> viewDidLoad]; <span class="hljs-comment"><span class="hljs-comment">//  WebView        CGRect frame = [[UIScreen mainScreen] bounds]; _webView = [[UIWebView alloc] initWithFrame:frame]; [self.view addSubview:_webView]; //  TwitterCommunicator    _tw = [[ASATwitterCommunicator alloc] initWithWebView:_webView]; //         [_tw startOnCancelBlock:^{ NSLog(@"User canceled app authorization..."); } onErrorBlock:^(NSError *error) { NSLog(@"error during app authorization...%@", error); } onSuccessBlock:^(ASATwitterUserAccount *account) { NSLog(@"Account: %@", account); }]; } @end</span></span></code> </pre><br><br>  It was enough to replace ASATwitterCommunicator with ASAVkontakteCommunicator or ASAFacebookCommunicator in order to connect and start working with another social network. <br>  In the last block, success, the user account of the corresponding network was transferred (access token, user ID, time at which the access token expires, etc.) <br><br>  Subsequent requests on behalf of the current user could be made as follows: <br><pre> <code class="hljs objectivec">[account performTwitterMethod:kTWITTER_FOLLOWERS_LIST_URL HTTPMethod:<span class="hljs-string"><span class="hljs-string">@"GET"</span></span> options:@{<span class="hljs-string"><span class="hljs-string">@"user_id"</span></span> : account.twitterUserID, <span class="hljs-string"><span class="hljs-string">@"include_entities"</span></span>: <span class="hljs-string"><span class="hljs-string">@"true"</span></span>} success:^(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span> response) { <span class="hljs-built_in"><span class="hljs-built_in">NSLog</span></span>(<span class="hljs-string"><span class="hljs-string">@"response: %@"</span></span>, response); } failure:^(<span class="hljs-built_in"><span class="hljs-built_in">NSError</span></span> *error) { <span class="hljs-built_in"><span class="hljs-built_in">NSLog</span></span>(<span class="hljs-string"><span class="hljs-string">@"error: %@"</span></span>, error); }];</code> </pre><br><br>  Here's what the Twitter status update looks like: <br><pre> <code class="hljs objectivec">[account performTwitterMethod:kTWITTER_STATUSES_UPDATE_URL HTTPMethod:<span class="hljs-string"><span class="hljs-string">@"POST"</span></span> options:@{<span class="hljs-string"><span class="hljs-string">@"status"</span></span>: <span class="hljs-string"><span class="hljs-string">@"Hello from ASASocialServices Framework!"</span></span>} success:^(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span> response) { <span class="hljs-built_in"><span class="hljs-built_in">NSLog</span></span>(<span class="hljs-string"><span class="hljs-string">@"response: %@"</span></span>, response); } failure:^(<span class="hljs-built_in"><span class="hljs-built_in">NSError</span></span> *error) { <span class="hljs-built_in"><span class="hljs-built_in">NSLog</span></span>(<span class="hljs-string"><span class="hljs-string">@"error: %@"</span></span>, error); }];</code> </pre><br><br>  Everything would be fine, but in the course of use, we understood that leaving the programmer to save the token, the subsequent download was not entirely correct because our main goal is to simplify the work with the library so much that we don‚Äôt have to think about trifles like this (the library on this stage died and its development / support had to deal with one, as well as all subsequent developments). <br><br>  Minuses: <br><ul><li>  The programmer needed to remember that the access token can be saved and used in subsequent requests, and not to hang requests in the success-block </li><li>  Leaving the programmer to configure and work with UIWebView was also a mistake </li><li>  The library seemed too complicated and incomprehensible, most did not want to think about using POST or GET when querying </li></ul><br><br><h4>  VKontakte iOS SDK v1.0 </h4><br>  I did not want to bother with ASASocialServices anymore, so I decided that I would start writing SDK for VKontakte in my free time.  Sketched on a sheet of diagram of the interaction of classes, ‚Äúhung‚Äù for two days above it, eventually decided that it seemed to be the first version - it started to implement. <br><br>  I love Ruby and I like Rails and, for some reason, it always and still seems that they influenced to some extent the appearance of Vkontakte iOS SDK. <br><br>  The user is associated with objects such as: <br><ul><li>  Groups </li><li>  Wall </li><li>  Friends </li><li>  Audio Albums </li><li>  Video Albums </li><li>  Photo albums </li><li>  Records </li><li>  Documents </li><li>  td </li></ul><br><br>  Each object has a list of actions that the user can perform on his own behalf: <br><ul><li>  Create photo album </li><li>  Join the group </li><li>  Set / change status </li><li>  Get a list of friends who are online </li><li>  etc </li></ul><br><br>  Here's how the above steps will look like on VKontakte iOS SDK v1.0: <br><br>  Creating a photo album: <br><pre> <code class="hljs vbscript"> VKUser *<span class="hljs-keyword"><span class="hljs-keyword">me</span></span> = [VKUser currentUser]; [[<span class="hljs-keyword"><span class="hljs-keyword">me</span></span> photoAlbums] createTitle:@<span class="hljs-string"><span class="hljs-string">", !"</span></span> description:@<span class="hljs-string"><span class="hljs-string">"    "</span></span>];</code> </pre><br><img src="http://s1.ipicture.ru/uploads/20130624/RvVHpn6o.png" alt="image"><br><br>  Join the group: <br><pre> <code class="hljs vbscript"> VKUser *<span class="hljs-keyword"><span class="hljs-keyword">me</span></span> = [VKUser currentUser]; [[<span class="hljs-keyword"><span class="hljs-keyword">me</span></span> groups] joinGroupID:<span class="hljs-number"><span class="hljs-number">100500</span></span>];</code> </pre><br><br>  Set status: <br><pre> <code class="hljs vbscript"> VKUser *<span class="hljs-keyword"><span class="hljs-keyword">me</span></span> = [VKUser currentUser]; [[<span class="hljs-keyword"><span class="hljs-keyword">me</span></span> status] setStatus:@<span class="hljs-string"><span class="hljs-string">", !"</span></span>];</code> </pre><br><br>  Get a list of friends who are online: <br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">id</span></span> result = [[[VKUser currentUser] friends] online];</code> </pre><br><br><h5>  Where to begin? </h5><br>  Suppose that you have already added Vkontakte IOS SDK v1.0 to your project and do not know what to do next with this. <br><br>  We will work with the VKConnector class, which will allow us to receive + save + use the received access token once, and at the right time he will notify us that it is necessary to update the token and call the appropriate delegate method, which may follow (or maybe not) VKConnectorProtocol. <br><br>  Here's what the easiest way to connect to ASAAppDelegate.m will look like: <br><pre> <code class="hljs pgsql">// // ASAAppDelegate.m // Vkontakte iOS SDK_Project // // Created <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> AndrewShmig <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-number"><span class="hljs-number">05</span></span>/<span class="hljs-number"><span class="hljs-number">27</span></span>/<span class="hljs-number"><span class="hljs-number">13.</span></span> // Copyright (c) <span class="hljs-number"><span class="hljs-number">2013</span></span> AndrewShmig. <span class="hljs-keyword"><span class="hljs-keyword">All</span></span> rights reserved. // #<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> "ASAAppDelegate.h" #<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> "ASAViewController.h" #<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> "VKUser.h" static NSString *const kVKAppID = @"3541027"; static NSString *const kVKPermissionsArray = @"photos,friends,wall,audio,video,docs,notes,pages,status,groups,messages"; @implementation ASAAppDelegate - (<span class="hljs-type"><span class="hljs-type">BOOL</span></span>)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions { self.<span class="hljs-keyword"><span class="hljs-keyword">window</span></span> = [[UIWindow alloc] initWithFrame:[[UIScreen mainScreen] bounds]]; [[VKConnector sharedInstance] setDelegate:self]; [[VKConnector sharedInstance] startWithAppID:kVKAppID permissons:[kVKPermissionsArray componentsSeparatedByString:@","]]; // Override <span class="hljs-type"><span class="hljs-type">point</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> customization <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> application launch. self.viewController = [[ASAViewController alloc] initWithNibName:@"ASAViewController" bundle:nil]; self.<span class="hljs-keyword"><span class="hljs-keyword">window</span></span>.rootViewController = self.viewController; [self.<span class="hljs-keyword"><span class="hljs-keyword">window</span></span> makeKeyAndVisible]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> YES; } - (<span class="hljs-type"><span class="hljs-type">void</span></span>)VKConnector:(VKConnector *)connector willShowModalView:(KGModal *)<span class="hljs-keyword"><span class="hljs-keyword">view</span></span> { NSLog(@"%s", __FUNCTION__); } - (<span class="hljs-type"><span class="hljs-type">void</span></span>)VKConnector:(VKConnector *)connector willHideModalView:(KGModal *)<span class="hljs-keyword"><span class="hljs-keyword">view</span></span> { NSLog(@"%s", __FUNCTION__); } - (<span class="hljs-type"><span class="hljs-type">void</span></span>)VKConnector:(VKConnector *)connector accessTokenInvalidated:(VKAccessToken *)accessToken { NSLog(@"%s", __FUNCTION__); } - (<span class="hljs-type"><span class="hljs-type">void</span></span>)VKConnector:(VKConnector *)connector accessTokenRenewalFailed:(VKAccessToken *)accessToken { NSLog(@"%s", __FUNCTION__); } - (<span class="hljs-type"><span class="hljs-type">void</span></span>)VKConnector:(VKConnector *)connector accessTokenRenewalSucceeded:(VKAccessToken *)accessToken { NSLog(@"%s", __FUNCTION__); } - (<span class="hljs-type"><span class="hljs-type">void</span></span>)VKConnector:(VKConnector *)connector connectionErrorOccured:(NSError *)error { NSLog(@"%s", __FUNCTION__); } - (<span class="hljs-type"><span class="hljs-type">void</span></span>)VKConnector:(VKConnector *)connector parsingErrorOccured:(NSError *)error { NSLog(@"%s", __FUNCTION__); } @<span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><br>  After the launch, a modal window appears in front of the user (KGModal was used) to authorize the application: <br><img src="https://habrastorage.org/getpro/habr/post_images/10a/c1e/dfa/10ac1edfa0d6c37413852d41cd832b54.png" alt="image"><br><br>  If you have questions or you do not know why this or that method is needed (for what is responsible), then feel free to contact the documentation.  The documentation is generated using AppleDoc and looks generally like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/a13/cf6/570/a13cf65703391898f972b584f793a467.png" alt="image"><br><br>  VKConnectorProtocol: <br><img src="http://s1.ipicture.ru/uploads/20130625/P1XJT4qI.png" alt="image"><br><br>  Xcode helps with this: <br><img src="http://1.bp.blogspot.com/-OdwoN2wEMt0/UcSUBL7FaDI/AAAAAAAACBY/j4Y5XAy1WGY/s640/Screen+Shot+2013-06-21+at+9.56.35+PM.png" alt="image"><br><br><h4>  In conclusion </h4><br>  The article, it seems to me, turned out to be quite long, so I‚Äôll stop on this, although unfortunately I didn‚Äôt mention much of what I planned (file upload, token update, error handling, etc.) <br><br>  I want to note that the project is actively developing and supported.  The current status of the project is ‚ÄúReady‚Äù, therefore in v1.0 errors will only be corrected and minor corrections made.  All global changes are transferred to v2.0. <br><br>  Find the most current version at this link: GitHub ( <a href="https://github.com/AndrewShmig/Vkontakte-iOS-SDK">https://github.com/AndrewShmig/Vkontakte-iOS-SDK</a> ) <br><br>  Some information on Vkontakte iOS SDK v2.0 can be found here: GitHub ( <a href="https://github.com/AndrewShmig/Vkontakte-iOS-SDK-v2.0/issues%3Flabels%3DFuture%2Bfeatures%26state%3Dopen">https://github.com/AndrewShmig/Vkontakte-iOS-SDK-v2.0/issues?labels=Future+features&amp;state=open</a> ) <br><br>  Thank you for attention. </div><p>Source: <a href="https://habr.com/ru/post/184560/">https://habr.com/ru/post/184560/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../184550/index.html">O Backbone.js is very simple and brief for fans of MVC frameworks.</a></li>
<li><a href="../184552/index.html">DXperience 13.1 - New version of .NET components from DevExpress</a></li>
<li><a href="../184554/index.html">Crazy DIY toy: a homemade cell phone with a built-in dosimeter. Part 1</a></li>
<li><a href="../184556/index.html">Iterative search program</a></li>
<li><a href="../184558/index.html">The development of custom data types in programming</a></li>
<li><a href="../184562/index.html">Thread concurrency C ++ 11, your bike technology (Apple) GCD</a></li>
<li><a href="../184566/index.html">LinkMeUp. Release 4</a></li>
<li><a href="../184570/index.html">Digest of new MSDN materials in Russian for May and June</a></li>
<li><a href="../184572/index.html">Port "Age of Empires" for smartphones will be released before the end of the year</a></li>
<li><a href="../184574/index.html">SMS filtering of spam using a naive Bayes classifier (R code)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>