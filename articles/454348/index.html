<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>State control with React Hooks - without Redux and Context API</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! My name is Arthur, I work on VKontakte in the mobile web team, I work on the VKUI project - the library of React-components, with the help of w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>State control with React Hooks - without Redux and Context API</h1><div class="post__text post__text-html js-mediator-article">  Hello!  My name is Arthur, I work on VKontakte in the mobile web team, I work on the <a href="https://github.com/VKCOM/VKUI">VKUI</a> project - the library of React-components, with the help of which some of our interfaces are written in mobile applications.  The issue of working with the global state is still open.  There are several well-known approaches: Redux, MobX, Context API.  Recently I came across an article by Andr√© Gardi <a href="https://medium.com/javascript-in-plain-english/state-management-with-react-hooks-no-redux-or-context-api-8b3035ceecf8">State Management with React Hooks - No Redux or Context API</a> , in which the author suggests using React Hooks to manage the state of the application. <br><br>  Hooks are rapidly breaking into the lives of developers, offering new ways to solve or rethink different tasks and approaches.  They change our understanding not only of how to describe components, but also how to work with data.  Read the article and interpreter commentary under the cut. <br><br><img src="https://habrastorage.org/webt/_t/kp/9x/_tkp9x7oiiowebtqtcvbhlblydo.jpeg" alt="image"><br><a name="habracut"></a><br><h2>  React Hooks are more powerful than you think. </h2><br>  Today, we will explore React Hooks and develop a custom hook to manage the global application state, which will be simpler than the Redux implementation and more productive than the Context API. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Basics of React Hooks </h3><br>  You can skip this part if you are already familiar with hooks. <br><br><h4>  useState () </h4><br>  Before the advent of hooks, functional components did not have the ability to specify a local state.  The situation has changed with the advent of <code>useState()</code> . <br><br><img src="https://habrastorage.org/webt/eh/uc/_k/ehuc_krferg3j4eccjos_rkf_fq.jpeg"><br><br>  This call returns an array.  Its first element is a variable that provides access to the state value.  The second element is a function that updates the state and redraws the component to reflect the changes. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { useState } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Example</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [state, setState] = useState({<span class="hljs-attr"><span class="hljs-attr">counter</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> add1ToCounter = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newCounterValue = state.counter + <span class="hljs-number"><span class="hljs-number">1</span></span>; setState({ <span class="hljs-attr"><span class="hljs-attr">counter</span></span>: newCounterValue}); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">You clicked {state.counter} times</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{add1ToCounter}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Click me </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); }</code> </pre><br><h4>  useEffect () </h4><br>  Class components respond to side effects using lifecycle methods such as <code>componentDidMount()</code> .  The <code>useEffect()</code> hook allows you to do the same in functional components. <br><br>  By default, effects start after every redraw.  But you can make them run only after changing the values ‚Äã‚Äãof specific variables, passing them to the second optional parameter in the form of an array. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     useEffect(() =&gt; { console.log('     '); }); //    useEffect(() =&gt; { console.log('     valueA'); }, [valueA]);</span></span></code> </pre><br>  To achieve a result similar to <code>componentDidMount()</code> , we will pass an empty array with the second parameter.  Since the contents of an empty array always remain the same, the effect will be executed only once. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     useEffect(() =&gt; { console.log('    '); }, []);</span></span></code> </pre><br><h3>  State sharing </h3><br>  We have seen that the state hooks work the same way as the state of the class component.  Each component instance has its own internal state. <br><br>  For sharing between components, we will create our own hook. <br><br><img src="https://habrastorage.org/webt/hp/lw/ke/hplwkebnp9jtdu7vywj5phhsndi.jpeg"><br><br>  The idea is to create an array of listeners and only one state.  Each time a component changes its <code>getState()</code> , all subscribing components call their own <code>getState()</code> and are updated due to this. <br><br>  We can achieve this by calling <code>useState()</code> inside our custom hook.  But instead of returning the <code>setState()</code> function, we add it to the listeners array and return a function that internally updates the state object and calls all the listeners. <br><br><h4>  Wait a minute  How will it make my life easier? </h4><br>  Yes you are right.  I created an <a href="https://www.npmjs.com/package/use-global-hook">NPM package</a> that encapsulates all the logic described. <br><br>  You do not have to implement it in every project.  If you no longer want to spend time reading and want to see the final result, just add this package to your application. <br><br><pre> <code class="plaintext hljs">npm install -s use-global-hook</code> </pre> <br>  To understand how to work with the package, study the examples in the documentation.  And now I propose to focus on how the package is arranged inside. <br><br><h3>  First version </h3><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useState, useEffect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> listeners = []; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> state = { <span class="hljs-attr"><span class="hljs-attr">counter</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> setState = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newState</span></span></span><span class="hljs-function">) =&gt;</span></span> { state = { ...state, ...newState }; listeners.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">listener</span></span></span><span class="hljs-function">) =&gt;</span></span> { listener(state); }); }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> useCustom = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newListener = useState()[<span class="hljs-number"><span class="hljs-number">1</span></span>]; useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { listeners.push(newListener); }, []); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [state, setState]; }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> useCustom;</code> </pre><br><h4>  Use in component </h4><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> useCustom <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./customHook'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Counter = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [globalState, setGlobalState] = useCustom(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> add1Global = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newCounterValue = globalState.counter + <span class="hljs-number"><span class="hljs-number">1</span></span>; setGlobalState({ <span class="hljs-attr"><span class="hljs-attr">counter</span></span>: newCounterValue }); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> counter: {globalState.counter} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{add1Global}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> +1 to global </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Counter;</code> </pre><br>  This version already provides sharing of the state.  You can add an arbitrary number of counters to your application, and they will all have a common global state. <br><br><h3>  But we can do better. </h3><br>  What you want: <br><br><ul><li>  remove the listener from the array when unmounting the component; </li><li>  make the hook more abstract to use it in other projects; </li><li>  control <code>initialState</code> with parameters; </li><li>  rewrite the hook in a more functional style. </li></ul><br><h4>  Calling a function just before unmounting a component </h4><br>  We have already found that calling <code>useEffect(function, [])</code> with an empty array works the same way as <code>componentDidMount()</code> .  But if the function passed in the first parameter returns another function, then the second function will be called right before unmounting the component.  Just like <code>componentWillUnmount()</code> . <br><br>  So, in the code of the second function, you can write the logic for removing a component from the array of listeners. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> useCustom = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newListener = useState()[<span class="hljs-number"><span class="hljs-number">1</span></span>]; useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//     listeners.push(newListener); return () =&gt; { //     listeners = listeners.filter(listener =&gt; listener !== newListener); }; }, []); return [state, setState]; };</span></span></code> </pre><br><h3>  Second version </h3><br>  In addition to this update, we also plan: <br><br><ul><li>  pass the React parameter and get rid of the import; </li><li>  do not export customHook, but the function returning customHook with the given <code>initalState</code> ; </li><li>  create a <code>store</code> object that will contain the <code>state</code> value and the <code>setState()</code> function; </li><li>  replace the arrow functions with the usual ones in <code>setState()</code> and <code>useCustom()</code> so that you can associate the <code>store</code> with <code>this</code> . </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newState</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = { ...this.state, ...newState }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listeners.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">listener</span></span></span><span class="hljs-function">) =&gt;</span></span> { listener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state); }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useCustom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">React</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newListener = React.useState()[<span class="hljs-number"><span class="hljs-number">1</span></span>]; React.useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//     this.listeners.push(newListener); return () =&gt; { //     this.listeners = this.listeners.filter(listener =&gt; listener !== newListener); }; }, []); return [this.state, this.setState]; } const useGlobalHook = (React, initialState) =&gt; { const store = { state: initialState, listeners: [] }; store.setState = setState.bind(store); return useCustom.bind(store, React); }; export default useGlobalHook;</span></span></code> </pre><br><h3>  Separate actions from components </h3><br>  If you have ever worked with complex libraries for managing a state, then you know that manipulating a global state of components is not a good idea. <br><br>  It would be more correct to separate the business logic by creating actions to change the state.  Therefore, I want the latest version of the package to provide components with access not to <code>setState()</code> , but to a set of actions. <br><br>  To do this, we will supply our <code>useGlobalHook(React, initialState, actions)</code> third argument.  Just want to add a couple of comments. <br><br><ul><li>  Action games will have access to the <code>store</code> .  Thus, actions can read the contents of <code>store.state</code> , update the <code>store.setState()</code> calling <code>store.setState()</code> and even call other <code>store.actions</code> by <code>store.actions</code> . </li><li>  In order to avoid porridge, the action object may contain sub-objects.  Thus, you can transfer <code>actions.addToCounter(amount</code> ) to a sub-object with all the actions of the counter: <code>actions.counter.add(amount)</code> . </li></ul><br><h3>  Final version </h3><br>  The following snippet is the current NPM version of the <code>use-global-hook</code> package. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newState</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = { ...this.state, ...newState }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listeners.forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">listener</span></span></span><span class="hljs-function">) =&gt;</span></span> { listener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state); }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useCustom</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">React</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> newListener = React.useState()[<span class="hljs-number"><span class="hljs-number">1</span></span>]; React.useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listeners.push(newListener); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listeners = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listeners.filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">listener</span></span></span><span class="hljs-function"> =&gt;</span></span> listener !== newListener); }; }, []); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.actions]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">associateActions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">store, actions</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> associatedActions = {}; <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(actions).forEach(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> actions[key] === <span class="hljs-string"><span class="hljs-string">'function'</span></span>) { associatedActions[key] = actions[key].bind(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, store); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> actions[key] === <span class="hljs-string"><span class="hljs-string">'object'</span></span>) { associatedActions[key] = associateActions(store, actions[key]); } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> associatedActions; } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> useGlobalHook = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">React, initialState, actions</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = { <span class="hljs-attr"><span class="hljs-attr">state</span></span>: initialState, <span class="hljs-attr"><span class="hljs-attr">listeners</span></span>: [] }; store.setState = setState.bind(store); store.actions = associateActions(store, actions); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> useCustom.bind(store, React); }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> useGlobalHook;</code> </pre><br><h3>  Examples of using </h3><br>  You no longer have to deal with <code>useGlobalHook.js</code> .  Now you can focus on your application.  Below are two examples of using the package. <br><br><h4>  Multiple counters, one value </h4><br>  Add as many counters as you want: they all have global meaning.  Each time one of the counters increments the global state, all others will be redrawn.  No redrawing is required for the parent component. <br>  <a href="https://codesandbox.io/s/wqvykj5497%3Ffontsize%3D14">Living example</a> . <br><br><h4>  Asynchronous Ajax Requests </h4><br>  Search GitHub repositories by username.  We process ajax requests asynchronously using async / await.  We update the query counter with each new search. <br>  <a href="https://codesandbox.io/s/wqvykj5497%3Ffontsize%3D14">Living example</a> . <br><br><h3>  Well that's all </h3><br>  Now we have our own state management library for React Hooks. <br><br><h3>  Translator comment </h3><br>  Most existing solutions are essentially separate libraries.  In this sense, the approach described by the author is interesting in that it uses only the built-in capabilities of React.  In addition, compared with the same Context API, which also comes out of the box, this approach reduces the number of unnecessary redrawing and therefore gains in performance. </div><p>Source: <a href="https://habr.com/ru/post/454348/">https://habr.com/ru/post/454348/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../454334/index.html">Moto. Mokai AWS</a></li>
<li><a href="../454336/index.html">Client: - How much is a copy of Facebook?</a></li>
<li><a href="../45434/index.html">Partnership program of the Ministry of Communications and Mass Media of Russia</a></li>
<li><a href="../454340/index.html">% tuzuvuzu% - the world's first university, where officially develop jet packs</a></li>
<li><a href="../454346/index.html">Efficiency Algorithms: Nobelic 2019 Surveillance Camera Review</a></li>
<li><a href="../45435/index.html">Safari 3.2.1 Update</a></li>
<li><a href="../454350/index.html">‚ÄúThick and thin‚Äù or how I mastered neural networks</a></li>
<li><a href="../454352/index.html">Mathematical uncertainties on the example of Python</a></li>
<li><a href="../454354/index.html">Internship at JetBrains and how I almost managed to get on it</a></li>
<li><a href="../454356/index.html">3rd edition podcast. Runet vs TV, ARM vs Intel, state data unification, without a smartphone in 2019, Soviet dreams of the future</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>