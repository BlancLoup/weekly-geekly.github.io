<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Software protection: Major errors when programming a program registration unit (or one bit can change the world)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In order to write a good program, as a rule, it takes a lot of time and effort from a programmer. Most programmers do not even realize how simple thei...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Software protection: Major errors when programming a program registration unit (or one bit can change the world)</h1><div class="post__text post__text-html js-mediator-article">  In order to write a good program, as a rule, it takes a lot of time and effort from a programmer.  Most programmers do not even realize how simple their programs can be hacked.  The standard time required for hacking a program with errors in protecting the user's legality checker is usually less than 5 minutes.  In my articles, I want to talk about the main shortcomings that programmers allow in application registration blocks.  To do this, I wrote a small program on which I will try to show how easy it is to bypass a piece of code responsible for checking the legality of a copy of the software.  If this topic is of interest to readers, it will be continued in subsequent publications. <br><br><a name="habracut"></a><br><br>  First we need: <br>  ‚Ä¢ Disassembler (I used the IDA Free disassembler <a href="http://www.hex-rays.com/idapro/idadownfreeware.htm">www.hex-rays.com/idapro/idadownfreeware.htm</a> ) <br>  ‚Ä¢ Hex editor (I took the editor with the built-in disassembler BIEW <a href="http://biew.sourceforge.net/ru/biew.html">biew.sourceforge.net/ru/biew.html</a> ) <br>  ‚Ä¢ A little brain :) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The first step is to define the compiler used to create the loadable module.  To do this, we use the small utility PEiD (http://www.peid.info/).  Step two - start the program.  These are very important steps that will allow us to gather important information for choosing a search strategy in the disassembled listing of the registration data validation block.  The interface window of the program looks like this: <br><br><img src="http://img8.imageshost.ru/imgs/100116/0fdb21785c/31e3c.jpg" alt="image"><br><br>  The first thing we see is the inscription in the title bar: ‚Äúregistration data is not correct!‚Äù.  This means that the program checks the availability of a registration number and code when downloading.  This simplifies the task.  By changing the logic of the algorithm at the very beginning of the program launch, we will later receive a full-featured copy.  Now we will try to enter some data into the input fields. <br><br><img src="http://img8.imageshost.ru/imgs/100116/e92bc6e099/47c39.jpg" alt="image"><br><br>  Naturally, we will receive a message that the entered code does not match the user name.  Using the PEiD utility, we learn that the program was written and compiled in the Delphi integrated environment.  By the appearance of the message box, it can be concluded that the procedure from the internal component library was used to create the dialog message.  You can also determine the compiler by visually inspecting the executable module, paying attention to the features of the program section entries, additional lines of copyright.  In order to study the source code of a program, we disassemble it using IDA. <br>  To begin with, we will try to find in the ShowMessage function window, which was probably used to display the message window.  As you can see, there are two cross-references to this procedure in the program listing. <br><br><img src="http://img8.imageshost.ru/imgs/100116/0d4a7b23e3/b5203.jpg" alt="image"><br><br>  It is logical to assume that one of these windows gives a message about the successful registration of the program, the other about the unsuccessful registration.  Our attention should be drawn to the function at the virtual address .0047120E.  It is on the results of its work that the further branching of the algorithm depends.  As a rule, the logical result of the function is passed to the register al.  Thus, it can be concluded that the sub_470FFC function is responsible for checking the correctness of the entered program registration data.  Further, all we need is to replace the results of the function.  To do this, go to the address.  00470FFC.  There are two ways to falsify the results of the function: reduce its execution with only the necessary lines or find a place in the program where al is reported as 0. In the first case, opening the executable module in BIEW and going to the above address, enter the following code: 33C0B001C3 which corresponds to register clearing battery (eax), telling him the true result and the command to return to the address in the stack.  The disadvantage of this method is too large changes to the source code of the program.  The fewer modifications of the source code will be made, the more effectively it will look and the less likely the program will work incorrectly in the future.  Our attention should be drawn to the following code snippet. <br><br><img src="http://img8.imageshost.ru/imgs/100116/ebc143d077/1b24e.jpg" alt="image"><br><br>  The virtual address .0047106E actually assigns the result of the function.  By changing the value of the code 0x75 to 0x74 in the conditional branch operator, which is one line higher, we will force the program to consider any name / code combinations as legal except the correct combinations to be legal.  We launch the modified program, we immediately see the inscription in the title bar that the program is already registered. <br><br><img src="http://img8.imageshost.ru/imgs/100116/982545f644/993b1.jpg" alt="image"><br><br>  Entering an arbitrary combination of the registration name / code, we will receive a notification of the successful registration of the program. <br><br><img src="http://img8.imageshost.ru/imgs/100116/48b4f2229e/cfde0.jpg" alt="image"><br><br>  Thus, we bypassed the program registration block and avoided possible program bookmarks that could be inside the registration function (when modifying the program code in the first way described, the application could not work correctly despite the registration success messages). <br>  So consider the main mistakes. <br>  1. Using the same function to check the legality of a copy (there should be many functions, despite the fact that they actually do the same thing) <br>  2. Using standard notification dialogs (it is better to write your own notification forms for messages to the user) <br>  3. Notifications to the user of successful registration (only notification of the registration data entry and a proposal to restart the program are permissible) <br>  4. No additional checks of the legality of the copy, no binding of the results of the program from the entered data (the name / password combination should produce correction factors that affect the result of the application) <br>  These are not all recommendations that can be given to authors of software, but their implementation can make it difficult to hack a program.  Perhaps this will be enough to stop the beginner, but obviously not enough for a person who has been studying the source code of programs for a long time.  In any case, no matter how complicated and intricate protection is, it can be hacked.  The whole question is in the qualification of a person and time.  The ideal option is when a hacking program costs more than buying a legal copy.  Good luck to all :). </div><p>Source: <a href="https://habr.com/ru/post/80933/">https://habr.com/ru/post/80933/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../80926/index.html">The administrator of the torrent tracker OiNK acquitted after two years of litigation</a></li>
<li><a href="../80927/index.html">Email Notification Setup</a></li>
<li><a href="../80928/index.html">another bike or TreeDb - NoSQL Database startup</a></li>
<li><a href="../80929/index.html">Portable Stereo UMPC - USB Only</a></li>
<li><a href="../80932/index.html">MS Shortcut Link</a></li>
<li><a href="../80934/index.html">A hint with a live video demonstrates HTML5 video, and canvas (canvas), and Ext</a></li>
<li><a href="../80936/index.html">7 steps to port a program to a 64-bit system</a></li>
<li><a href="../80937/index.html">Polaroid returns</a></li>
<li><a href="../80938/index.html">Using the built-in search on Habr√©. How to make it more convenient?</a></li>
<li><a href="../80939/index.html">Open Source Humor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>