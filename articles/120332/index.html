<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DIY Quadcopter: Part II.1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ATTENTION, the article is outdated, but it can still be used for informational purposes. 
 In the last article I talked about a set of parts for build...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>DIY Quadcopter: Part II.1</h1><div class="post__text post__text-html js-mediator-article">  <b>ATTENTION, the article is outdated, but it can still be used for informational purposes.</b> <br>  In the <a href="http://habrahabr.ru/blogs/DIY/120266/">last article</a> I talked about a set of parts for building my quadrocopter, and now it‚Äôs time to talk about sensors and brains. <br><a name="habracut"></a><br><h4>  Sensors and their acquisition methods </h4><br>  The easiest option is to buy a ready-made shawl with 4 main sensors (9 <a href="http://en.wikipedia.org/wiki/Degrees_of_freedom_(mechanics)">DOF</a> ): <br><ul><li>  gyroscope - to measure the angular acceleration </li><li>  accelerometer - to measure acceleration and gravity (in fact, you can find out the angle of inclination) </li><li>  barometer - for measuring height and keeping the copter at this very height </li><li>  magnetometer (compass) - to keep the direction of movement </li></ul><br>  Just now another shawl appeared, on which, <a href="http://cgi.ebay.com/HMC5883L-BMA180-BMP085-ITG3200-Ublox-NEO-6Q-M-GPS-/260789777975">besides the four sensors, there is a GPS receiver</a> , which is useful for autonomous flight. <br>  If you decide to buy just such a board with sensors (then you made the right choice!), Then you can not read about the sensors, but if suddenly you already have at least a gyroscope with an accelerometer or want to play with luck when ordering Wii Motion Plus from Chinese stores, then read this part of the article to the end. <br><br><h5>  We get the ITG3200 gyroscope </h5><br>  Maybe you recently bought a Wii Motion Plus for your game console from sites like <a href="http://www.dealextreme.com/p/premium-motionplus-for-wii-remote-white-32506">dealextreme</a> or <a href="http://www.buyincoins.com/details/motionplus-motion-plus-4-nintendo-wii-remote-controller-product-2264.html">buyincoins</a> , then open it and see which gyro chip is used there, most likely it will be ITG3205, aka ITG3200: <br><div style="text-align:center;"><img src="https://habrastorage.org/storage/0c72dbd4/099fa8a3/c724602c/e3f0cf62.jpg" alt="ITG3205 wii motion plus"></div><br>  <sup>I will use the image from the forum <a href="http://forum.xufo.net/bb/viewtopic.php%3Fp%3D171796">http://forum.xufo.net/bb/viewtopic.php?p=171796</a></sup> <br>  If your board looks like this, then you are very lucky and the next step is to finish this WMP to a good gyro: <br><div style="text-align:center;"><img src="https://habrastorage.org/storage/37406896/d9aa3e21/0f876160/7fe878ab.jpg" alt="WMP to ITG3200"></div><br>  <sup>red indicates the place of cutting the track, there is also a track leading to the chip on the reverse side, we also saw it through and on the reverse side there is a convenient place for soldering the GND wiring (ground, common)</sup> <br><br><h5>  We get the accelerometer BMA020 or BMA180 </h5><br>  And here it is already harder and easier at the same time, I was lucky and the <a href="http://forum.rcdesign.ru/member.php%3Fu%3D18681">kind user</a> from the <a href="http://forum.rcdesign.ru/">rcdesign.ru</a> forum soldered my BMA020 to a handkerchief with minimal strapping, which I put on a thin 2-sided adhesive tape: <br><div style="text-align:center;"><img src="https://habrastorage.org/storage/3a09f731/a90e2309/2b98a2c0/e5d63ea9.png" alt="BMA020"></div><br>  You can search for a separate sensor and independently make a similar scarf or ask friends or buy a finished one with a BMA020 or BMA180 sensor. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Other sensor options </h5><br>  In fact, any available gyroscope with an accelerometer with an <a href="http://ru.wikipedia.org/wiki/I%25C2%25B2C">I2C bus will do</a> , but you will have to rewrite the relevant parts of the code or insert the already prepared code from the <a href="http://airm.ru/articles/2">MultiWii</a> project, for example, for the L3G4200D gyroscope or the adxl335 analog accelerometer.  But sometimes you have to tinker with the orientation of the axes of the sensors (change the signs and axes in the code) and the fight against vibration. <br><br><h4>  Brain building </h4><br>  For ease of installation, everything you need can be placed on some kind of prototyping shawl, for example, I did it like this (not nice, but it works, the connection module from the previous project is not used to the left above): <br><img src="https://habrastorage.org/storage/32a35025/d4a1bbab/7543d2cb/f0164b64.png"><br>  The pinout of the connection may be slightly different, since the firmware periodically changes, but at the time of this writing, the motors, sensors, receiver, etc.  should be connected as follows (from release note): <br><table><tbody><tr><th colspan="2">  Motors <br>  <sup>(top view, in front of the copter at the top,</sup> <sup><br></sup>  <sup>the direction of rotation and the corresponding propellers can be <a href="">viewed on this picture</a> or <a href="http://www.rcgroups.com/forums/attachment.php%3Fattachmentid%3D3540582">this one</a> )</sup> </th></tr><tr><td>  Front left </td><td align="right">  2 </td></tr><tr><td>  Front right </td><td align="right">  five </td></tr><tr><td>  Rear left </td><td align="right">  6 </td></tr><tr><td>  Rear right </td><td align="right">  3 </td></tr><tr><th colspan="2">  Receiver <br>  <sup>(at least the first 4, you can take the connector from the IDE cable and cut off the excess to insert into the receiver)</sup> </th></tr><tr><td>  Throttle </td><td align="right">  A8 </td></tr><tr><td>  Roll </td><td align="right">  A9 </td></tr><tr><td>  Pitch </td><td align="right">  A10 </td></tr><tr><td>  Yaw </td><td align="right">  A11 </td></tr><tr><td>  Mode (Aux1) </td><td align="right">  A12 </td></tr><tr><td>  Aux2 </td><td align="right">  A13 </td></tr><tr><td>  Cam1 </td><td align="right">  A14 </td></tr><tr><td>  Cam2 </td><td align="right">  A15 </td></tr><tr><th colspan="2">  Brain and receiver power </th></tr><tr><td colspan="2">  Arduino can be powered from the speed controller (if it has a power converter), by soldering the power output to USB and Vin, another option is to power directly from the battery through a special power connector on the board </td></tr><tr><td colspan="2">  The receiver is powered from the Arduino through the corresponding outputs + 5v and GND </td></tr><tr><th colspan="2">  Other </th></tr><tr><td>  Switch to command line mode (aha, will be console) and settings <br>  <sup>for convenience, you can put a jumper or switch</sup> </td><td align="right">  A5 short circuit with GND </td></tr><tr><td>  GPS module </td><td align="right">  RX2, TX2 </td></tr><tr><td>  Xbee module </td><td align="right">  RX3, TX3 </td></tr><tr><td>  Sonar / range finder </td><td align="right">  9 - tx, 10 - echo </td></tr><tr><td>  LEDs (do not forget about the resistors in series) </td><td align="right">  13,30,31 </td></tr></tbody></table><br><br><h4>  Firmware setup and download </h4><br>  This part of the article may become irrelevant, so watch the thread of the forum <a href="http://forum.rcdesign.ru/f123/thread232641.html">ArduCopter Mega: port on a regular Arduino (test)</a> <br><ol><li>  Download the <a href="">archive with the firmware</a> and unpack </li><li>  The libraries folder should be copied over (with replacement) to the same folder in the Arduino IDE (arduino-0022) </li><li>  In the libraries / AP_ADC folder in the AP_ADC_ADS7844.cpp file, select the sensor type: uncomment one of the options #define FFIMU, #define ALLINONE, or simultaneously #define ALLINONE and #define BMA_020 for the version with sensors ITG3200 and BMA020 </li><li>  If you do not have a barometer (like mine), then you will have to comment out the I2C bus code with this sensor in the libraries / APM_BMP085 / APM_BMP085.cpp file </li><li>  Open through the Arduino IDE any of the files in the MegaPirate folder </li><li>  In the APM_Config.h tab, select your type of copter, to do this, after #define FRAME_CONFIG, insert one of the options: <b>QUAD_FRAME</b> TRI_FRAME HEXA_FRAME Y6_FRAME OCTA_FRAME, as well as the orientation type of the frame #define FRAME_ORIENTATION, setting PLUS PLUS or <b>X_FRAME</b> </li><li>  If you do not have GPS, it is better to change the #define GPS_PROTOCOL value to GPS_PROTOCOL_NONE at the beginning, so as not to wait 10-15 seconds for GPS to initialize (when it is not there!) </li><li>  Now you can connect the Arduino Mega and download this sketch to the controller </li></ol><br><br><h4>  Setting up the copter </h4><br>  After a successful download of the sketch firmware to Arduino, you can <a href="">download the setup program</a> (attention, it works only in Windows and is very crooked in Linux with Wine) and close the A5 contact with GND. <br>  After starting the program in the Options menu, select the Arduino COM port: <br><img src="https://habrastorage.org/storage/c49c9210/5da6139f/f4f1de20/e902c481.png"><br>  In the Action menu, select AC2 Setup <br><img src="https://habrastorage.org/storage/2b31187b/bdecbd2c/65f8e88f/1fe5bc25.png"><br>  And we see a huge button that you need to click and follow the instructions. It is especially important not to miss the first window with a bunch of text, in which you will be asked to move the console handles to their minimum and maximum values, as well as another window, in which you will be asked to make sure that The copter stands flat for calibrating the sensors. <br>  After completing the settings, you can open A5 from GND and select the AC2 Sensor item in the menu to check the adequacy of the sensors in the Raw Sensor tab: turns the sensors with sensors should be clearly worked out - both the arrow was turned and the arrow got up, if it swims or flies over, There are problems with sensors or coefficients in your code. <br><img src="https://habrastorage.org/storage/3359f35e/f73a9488/59e3dd98/7567f908.png"><br><br>  It is also worth checking the receiver in the next tab and if the levels move as it should, then turn the gas joystick (in Mode 2 remote left) down to the right for 2 seconds (I hope at this stage you do not have a battery connected and there are no propellers) the LED on the controller should start flashing.  And now slowly move the throttle stick up, while in the left column, the levels should be about the same increase. <br><img src="https://habrastorage.org/storage/b67b2b70/20649606/6f367ace/b398bccf.png"><br><br><h4>  Result </h4><br>  Well, everything seems to be all =) Now you can fasten the propellers (do not confuse where, what rotation and check that the motors turn in the right direction) and try to take off, for this, put the copter away from yourself (or hold it in your hand over your head) tilt the left knob down and to the right for 2 seconds and slowly add gas.  If the copter takes off - this is already good, if it starts to shake, then you need to adjust the <a href="http://ru.wikipedia.org/wiki/%25D0%259F%25D0%2598%25D0%2594-%25D1%2580%25D0%25B5%25D0%25B3%25D1%2583%25D0%25BB%25D1%258F%25D1%2582%25D0%25BE%25D1%2580">PIDs</a> . To do this, select the PID Config - AC2 item in the Action menu, be horrified by the number of digits and start adjusting the values ‚Äã‚Äãto suit yourself.  I can‚Äôt talk about how to do this, as it was done almost by typing, but it‚Äôs worth starting with parameter P. I fly well with these settings: <br><img src="https://habrastorage.org/storage/be62304e/32108802/133429b8/72c7c0a5.png"><br>  After landing, <b>do not forget to turn off the motors</b> by turning the left joystick knob down and to the left for the same 2 seconds and make sure that the status LED does not flash anymore. <br>  Good luck in assembling and setting up your copter and do not forget to read about new chips <a href="http://forum.rcdesign.ru/f123/thread232641.html">on the forum</a> . <br><br><h6>  A small video of the fall of the copter in the bushes </h6><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/wD86Y1neCLc%3Ffeature%3Doembed&amp;xid=25657,15700022,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhjlsDpiBPzEPYgK31u4KOiXLhgREw" frameborder="0" allowfullscreen=""></iframe><br><h6>  As well as adequate flight with GoPro on board </h6><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/vT7DOa4lyf0%3Ffeature%3Doembed&amp;xid=25657,15700022,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhjJHq4Fem7OXjXdWYJDLVNSCPUjXw" frameborder="0" allowfullscreen=""></iframe><br><br>  Perhaps the next article will be about a fully autonomous flight, but not earlier than in a month, watch your habranth. </div><p>Source: <a href="https://habr.com/ru/post/120332/">https://habr.com/ru/post/120332/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../120326/index.html">Create your own schedule DrupalCamp Kyiv 2011</a></li>
<li><a href="../120328/index.html">Vertex Coverage Problem</a></li>
<li><a href="../120329/index.html">Intel at Computex 2011: Ultrabook, new Atom's and lots and lots of tablets</a></li>
<li><a href="../120330/index.html">Ultra fast image markup</a></li>
<li><a href="../120331/index.html">Apple will introduce Lion, iCloud and iOS 5 at WWDC on Monday</a></li>
<li><a href="../120333/index.html">Google Chrome Plugin Security</a></li>
<li><a href="../120334/index.html">The thinnest Computex laptops: ASUS UX21 and Lenovo X1 and Chinatown under the cut</a></li>
<li><a href="../120336/index.html">Cross-domain "ajax" - a simple solution</a></li>
<li><a href="../120337/index.html">How do you think the right to contact the site visitor?</a></li>
<li><a href="../120339/index.html">Proprietary provider modems 2/3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>