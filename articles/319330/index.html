<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>RID Master Recovery Features</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Everyone knows that all domain controllers are equal, but some are more equal. These special controllers are called operation masters or FSMO Masters ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>RID Master Recovery Features</h1><div class="post__text post__text-html js-mediator-article">  Everyone knows that all domain controllers are equal, but some are more equal.  These special controllers are called <a href="https://habrahabr.ru/post/133370/">operation masters or FSMO Masters</a> .  Holders of these roles require special attention - you need to plan how to transfer them and when to capture them if something went wrong.  If you support the Active Directory domain and some of the above for you news, I strongly recommend that you read the article on the link that I brought, or read about it in any other place. <br><br>  However, there is one role that stands out from all - RID Master.  Several times I saw how people forgot about the additional actions that are required when working with this role, and I had a desire to tell what is worth remembering when you restore your Active Directory environment from a backup or capture the role of RID Master. <br><br>  If you want to remember, or, all the more, do not know <a href="https://social.technet.microsoft.com/wiki/contents/articles/34060.active-directory-transferring-and-seizing-the-rid-master-role.aspx">what rIDAvailablePool</a> and disability of the RID range are, then welcome to cat. <br><a name="habracut"></a><br><h3>  RID Master </h3><br>  To begin with, let's remember why we, in general, need a RID Master and what troubles it helps us to avoid. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The security identifier (SID) of each object in the domain is - <i>Domain SID-RID</i> .  Where the uniqueness of the relative identifier (RID) guarantees the uniqueness of the SID of the object within the domain.  If each controller generated RID independently, it would be difficult to come up with a clear and simple mechanism to ensure their uniqueness.  If you make one controller responsible for generating the RID each time you create an object (by analogy with the schema and domain naming wizards), you lose the main plus multimaster of the Active Directory system ‚Äî the ability to distribute and modify data.  Therefore, there is a RID Master in the domain, which allocates RID blocks to each controller and, as a result, each controller can create new SIDs for the objects (after all, the unit is given to it for its sole use) and, if the RID Master is turned off or broken, the system will continue to work Because the block size allows Active Directory to function for some time without an active wizard. <br><br>  What is so scary to get multiple objects with the same SID?  To answer this question, let's take a look at how access control lists (ACL) and local groups work on domain servers and workstations.  Both those and others distribute the rights to users based on their SID and not their name (which is why you can sometimes see the SID in graphical snap-ins - the system simply could not resolve it to your pleasant name and shows it as it is). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/aaf/0b2/556/aaf0b255638446a4accce47a97a3e3f5.png"></div><br>  That is, if we imagine that there are two users in your environment, say, users with the same SID, then they will receive the same rights.  And what is most unpleasant, if administrators in two different parts of your domain try to give these two users rights to different resources, then the rights will be granted to this matching SID and there will be no possibility, later, to determine who they were intended for.  In general, it is very unpleasant and it is impossible to prevent this, with which RID Master copes successfully. <br><br><h3>  RIDAvailablePool attribute </h3><br>  Everything is fine exactly until we try to restore the RID Master from the backup.  Here you need to make a retreat.  Restoring controllers from a backup is <a href="https://technet.microsoft.com/en-us/library/cc526503.aspx">not necessary</a> .  In case of problems with the controller, it will be correct to remove it from the domain, rearrange the server completely and re-enter it into the domain as a controller.  However, there are scenarios where backup is your only choice.  For example, if your entire AD DS infrastructure has been destroyed and you need to restore it.  What can go wrong? <br><br>  RID Master stores the role data in the <b>DOMAIN \ System \ RID Manager $</b> system object: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f6b/b6d/bde/f6bb6dbde3d64f5f8d51a88330057a1b.PNG"></div><br>  The attributes of this object let you know, for example, who the current RID Master is in your domain.  We are also interested in the <b>rIDAvailablePool</b> attribute: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/cd0/c59/6f3/cd0c596f36b242038a84c8fa2752b4dd.PNG"></div><br>  It is here that information is stored about which block was issued last and how many more RIDs remained in your domain.  The problem is that if your AD infrastructure was restored from a backup, the value of this attribute will be obsolete.  At the same time, membership in local groups on servers or in applications is specified by the SID of users and groups.  That is, if you leave everything as it is, the new objects will receive the rights of old ones.  To avoid this, we will have to manually change the rIDAvailablePool value.  If you paid attention, then on the previous screenshot it has a strange very great value.  The point is that this value is stored in a large integer format and includes both the upper and lower limits of the range.  For viewing, you can use any tool for working with upper and lower parts of large integer values.  For example, <b>Large Integer Converter</b> to <b>ldp</b> in the <b>Utilities</b> section: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/3b0/6da/003/3b06da00347d4f26bb0fa8445b507337.PNG"></div><br>  If we want to protect ourselves from conflicts, then the lower part needs to be changed by adding to it a number that is obviously greater than the objects in the domain could be created after removing this backup.  For this, no special utilities are needed - as much as you want to add to the bottom, as much as you add to the attribute, as a whole. <br><br>  Now, our new master will display the RID ranges starting from the new value.  Have we protected ourselves from conflicts?  Not. <br><br><h3>  RID Range Disability </h3><br>  Despite the fact that we guaranteed that the new RID ranges will be issued correctly, we still have one problem - our restored domain controller, at the time of the backup, already had its own range.  This range has not gone away after recovery and can cause us trouble if it is used. <br><br>  In order to avoid this, we need to carry out the operation " <i>invalidation</i> " (if someone has met or knows a more suitable Russian word, then voice it, please, in the comments).  To do this, we will use the iRIDPool.vbs script <a href="https://technet.microsoft.com/en-us/library/ee411069(v%3Dws.10).aspx">offered by Microsoft</a> .  We create this script on our controller and run it with administrator rights.  Microsoft kindly warns us that every time we perform such an operation we reduce the number of theoretically available to us in the RID domain, since invalid identifiers can no longer be used. <br><br>  Now we are safe and can continue restoring our environment after what happened to us (for AD, for example, further it makes sense to clear the metadata and enter new controllers into the domain, etc.). <br><br>  I hope the article helped you learn or brush up on why, of all the FSMO roles, it was the RID master that required special attention. </div><p>Source: <a href="https://habr.com/ru/post/319330/">https://habr.com/ru/post/319330/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../319320/index.html">Working with DSL: creating your own analyzer using Python libraries</a></li>
<li><a href="../319322/index.html">How not to do protection against exploits for example Norton Security</a></li>
<li><a href="../319324/index.html">What is common between writing the Lord of the Rings and programming?</a></li>
<li><a href="../319326/index.html">A simple but effective Explorer extension (shell extension) for rendering files</a></li>
<li><a href="../319328/index.html">Sevastopol on Baikal and other wonders of nature</a></li>
<li><a href="../319332/index.html">The play "Technical duty"</a></li>
<li><a href="../319334/index.html">What is in my name to you: how to ‚Äúpierce‚Äù a person on the Internet qualitatively?</a></li>
<li><a href="../319336/index.html">FRAM via I2C for Arduino as a replacement for EEPROM</a></li>
<li><a href="../319338/index.html">Real-time BeagleBone: Using High-Speed ‚Äã‚ÄãPins</a></li>
<li><a href="../319340/index.html">Get an investment of up to $ 100,000 and launch joint projects with the leaders of the advertising industry</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>