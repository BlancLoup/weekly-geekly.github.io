<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Labs on ROUTE: EIGRP - Solution</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="EIGRP Lab | EIGRP Lab - Answers 

 We continue the study lab for the ROUTE exam of the course CCNP. 

 I thought to combine the answers to the tasks o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Labs on ROUTE: EIGRP - Solution</h1><div class="post__text post__text-html js-mediator-article">  <sub><a href="http://habrahabr.ru/blogs/cisconetworks/125972/">EIGRP Lab</a> |</sub>  <sub>EIGRP Lab - Answers</sub> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/145/233/3e7/1452333e78f737029fa0546c03ece113.jpg" align="left">  We continue the study lab for the ROUTE exam of the course CCNP. <br><br>  I thought to combine the answers to the tasks of the <a href="http://habrahabr.ru/blogs/cisconetworks/125972/">past labs</a> with the lab on OSPF, but this topic is already so large that, I'm afraid, as if everyone read it to the end.  There will be a lot of configs, screenshots from Wireshark and the wilds of technology, but all this is just to better illustrate the internal logic of EIGRP, without understanding which this exam is impossible to pass. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Future, former and present CCNP, welcome under kat! <br><a name="habracut"></a><br>  I suggest, going through the points of the labs, to consider all possible options and reasons, and not to go purposefully to the well-known conclusion.  The same problem can cause several things, and, anyway, you need to know everything - after all, there is still a TSHOOT exam. <br><br>  For convenience, I will repeat here the topology of the labs from the last post: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8e5/e01/a20/8e5e01a207c1adf64301695b43c7295a.jpg" alt="image"><br><br><h4>  Problem solving </h4><br>  <b>1. Why can't the Hub router establish an EIGRP neighborhood with Spoke 2?</b>  <b>Fix it.</b> <br><br>  Indeed, the show ip eigrp neighbors command shows that a neighborhood with four routers has been established, but among them there is no Spoke 2 with the address 192.168.100.3: <br><br><pre><code class="tex hljs">MainOfficeHub#show ip eigrp neighbors IP-EIGRP neighbors for process 100 H Address Interface Hold Uptime SRTT RTO Q Seq (sec) (ms) Cnt Num 1 192.168.201.2 Fa0/1 11 00:00:03 1 3000 2 0 3 192.168.101.2 Se0/0.204 159 00:00:27 1306 5000 0 5 2 192.168.100.2 Se0/0.202 171 00:01:08 451 2706 0 3 0 192.168.200.2 Fa0/0 12 00:02:49 427 2562 0 19</code> </pre> <br>  Does the traffic go between two routers? <br><br><pre> <code class="tex hljs">MainOfficeHub#ping 192.168.100.3 Type escape sequence to abort. Sending 5, 100-byte ICMP Echos to 192.168.100.3, timeout is 2 seconds: !!!!! Success rate is 100 percent (5/5), round-trip min/avg/max = 40/112/296 ms</code> </pre> <br>  Walks  There is a connection, the EIGRP neighborhood does not.  Need to watch interfaces. <br>  According to the Frame Relay Switch data, the DLCI 203 leads to Spoke 2 from the Hub. We also see that all Frame Relay connections use the subinterfaces of the Serial 0/0 port.  Check which DLCIs are assigned to which of the subinterfaces. <br><br><pre> <code class="tex hljs">MainOfficeHub#show running-config interface serial 0/0.202 Building configuration... Current configuration : 148 bytes ! interface Serial0/0.202 multipoint ip address 192.168.100.1 255.255.255.248 frame-relay interface-dlci 202 frame-relay interface-dlci 203 end MainOfficeHub#show running-config interface serial 0/0.204 Building configuration... Current configuration : 138 bytes ! interface Serial0/0.204 point-to-point bandwidth 100 ip address 192.168.101.1 255.255.255.248 frame-relay interface-dlci 204 end</code> </pre> <br>  Yeah, we see that the Serial0 / 0.202 subinterface leads to Spoke 2, this subinterface is multipoint, and the connection to Spoke 1 also hangs on it. There are no filters on the interfaces.  Let's look at the EIGRP settings. <br><br><pre> <code class="tex hljs">MainOfficeHub#show running-config | section router eigrp 100 router eigrp 100 variance 5 network 192.168.0.0 0.0.255.255 auto-summary neighbor 192.168.100.2 Serial0/0.202</code> </pre> <br>  We see that Spoke1 is specified as a static neybor on the Serial0 / 0.202 interface.  Why then is Spoke2 not dynamically located? <br><br>  It's all about the features of the work of EIGRP with static neyborami.  By default, EIGRP sends Hello multicast packets, directing them to all routers that work with EIGRP.  But when a neybor is specified statically, the router starts sending unicast EIGRP packets, directing them only to those devices that are configured as neybor.  Multicast packets on this port are no longer sent. <br><br>  This is the reason why it is impossible to establish a neighborhood with Spoke2.  Sending a unicast Spoke1 packet, the Hub router does not send a multicast from the Serial0 / 0.202 interface and does not accept it.  The second neybor remains without communication. <br><br>  To fix this, you can either configure the second nibor statically, or remove the first.  I suggest to go first option: <br><br><pre> <code class="tex hljs">BranchOfficeSpoke2(config-router)#neighbor 192.168.100.1 serial 0/0</code> </pre> <br><pre> <code class="tex hljs">MainOfficeHub(config-router)#neighbor 192.168.100.3 serial 0/0.202 MainOfficeHub#show ip eigrp neighbors IP-EIGRP neighbors for process 100 H Address Interface Hold Uptime SRTT RTO Q Seq (sec) (ms) Cnt Num 4 192.168.100.3 Se0/0.202 162 00:00:18 161 1449 0 3 1 192.168.201.2 Fa0/1 11 00:00:44 1 5000 2 0 3 192.168.101.2 Se0/0.204 162 00:16:11 1199 5000 0 5 2 192.168.100.2 Se0/0.202 163 00:16:52 511 3066 0 3 0 192.168.200.2 Fa0/0 14 00:18:33 345 2070 0 22</code> </pre> <br>  Neighborhood set, everything is in order. <br><br>  <b>2. How to view the Hello timer on the Serial0 / 0.202 interface of the MainOfficeHub router?</b>  <b>Which team see the Hold Timer value?</b> <br><br>  The standard show ip eigrp interfaces command does not help here: <br><br><pre> <code class="tex hljs">MainOfficeHub#show ip eigrp interfaces serial 0/0.202 IP-EIGRP interfaces for process 100 Xmit Queue Mean Pacing Time Multicast Pending Interface Peers Un/Reliable SRTT Un/Reliable Flow Timer Routes Se0/0.202 2 0/0 336 0/15 1326 0</code> </pre> <br>  To it you need to add the keyword details. <br><br><pre> <code class="tex hljs">MainOfficeHub#show ip eigrp interfaces detail serial 0/0.202 IP-EIGRP interfaces for process 100 Xmit Queue Mean Pacing Time Multicast Pending Interface Peers Un/Reliable SRTT Un/Reliable Flow Timer Routes Se0/0.202 2 0/0 336 0/15 1326 0 Hello interval is 60 sec Next xmit serial &lt;none&gt; Un/reliable mcasts: 0/0 Un/reliable ucasts: 0/11 Mcast exceptions: 0 CR packets: 0 ACKs suppressed: 5 Retransmissions sent: 2 Out-of-sequence rcvd: 0 Interface has all stub peers Authentication mode is not set Use unicast</code> </pre> <br>  Here you can see that multicasts are disabled on this interface and unicast packages are used to ‚Äúcommunicate‚Äù with neyborami. <br><br>  But I don‚Äôt know how to look at the Hold timer :-) The only option: often and often enter the show ip eigrp neighbors command and, by changing the Hold value of the timer, knowing the Hello value, guess the Hold value.  So if someone tells me the correct way to find out this information, I will be very grateful. <br><br>  <b>3. Will EIGRP lose its Spoke router neighborhood if I change the Hello value of the timer on the Hub router for 5 seconds?</b>  <b>And if in 120 seconds?</b>  <b>What will be the value of the Hold timer in Hub Router, if you put Hello an interval of 5 seconds?</b>  <b>How to check it?</b> <br><br>  For EIGRP, it is not necessary that the neybor timers match; it is enough that Hello packets arrive before the Hold timer expires.  Hello, the default interval depends on the type of interface and encapsulation, so for serial interfaces with bandwidth T1 or lower, Hello is 60 seconds. <br>  Therefore, if you put Hello an interval of 5 seconds on the Serial 0 / 0.202 interface, for example, the neighborhood will remain.  And if 120 is not. <br><br>  An interesting nuance: Hold timer for our new Hello value, you need to look at the router-nEbor.  By default, the value of the Hold timer is three times the value of the <i>default</i> Hello, and the Hold value is announced by the router to its neighbor.  As if telling him: if Hello does not come from me during this period of time, consider me dead.  But while changing the Hello timer, the Hold value does not automatically change: <br><br><img src="https://habrastorage.org/storage1/22fa306f/7f9357f9/0220f35d/91b23d2f.jpg"><br><br>  Because the value of the Hold timer on Spoke 1, for example, never drops below 170: <br><br><pre> <code class="tex hljs">BranchOfficeSpoke1#show ip eigrp neighbors IP-EIGRP neighbors for process 100 H Address Interface Hold Uptime SRTT RTO Q Seq (sec) (ms) Cnt Num 0 192.168.100.1 Se0/0 171 00:27:32 323 1938 0 20 BranchOfficeSpoke1#show ip eigrp neighbors IP-EIGRP neighbors for process 100 H Address Interface Hold Uptime SRTT RTO Q Seq (sec) (ms) Cnt Num 0 192.168.100.1 Se0/0 179 00:27:32 323 1938 0 20</code> </pre> <br>  In such a situation, however, confirmation of the death of the Hub of the Spoke 1 router will have to wait too long.  Therefore, it makes sense to reduce this waiting time: <br><br><pre> <code class="tex hljs">MainOfficeHub(config-subif)#ip hold-time eigrp 100 30</code> </pre> <br><pre> <code class="tex hljs">BranchOfficeSpoke1#show ip eigrp neighbors IP-EIGRP neighbors for process 100 H Address Interface Hold Uptime SRTT RTO Q Seq (sec) (ms) Cnt Num 0 192.168.100.1 Se0/0 25 00:30:42 323 1938 0 20</code> </pre> <br><img src="https://habrastorage.org/storage1/f5a56f8c/3a0328f5/44c7cfdb/de0275c1.jpg"><br><br>  This exercise illustrates the feature of setting up EIGRP timers: when you specify Hello interval on an interface, you really specify how often EIGRP Hello packets are sent through this interface.  But when you configure the Hold timer, it does not mean that you change the time your router will expect Hello packets from neybor from this interface.  This means that you change the time that the neybor from this interface will wait for Hello packages from you. <br><br>  <b>4. Now the Spoke3 interface of the router and the router's Hub subinterface are located on the network 192.168.101.0/29 and have the addresses .1 and .2, respectively.</b>  <b>If I change the address mask of the Spoke interface of the router to / 30, will the EIGRP neighborhood remain?</b> <br><br>  Another interesting nuance: to establish an EIGRP neighborhood, the neybor interfaces do not necessarily have to be on the same network.  It is enough that each of them considers that the address of the dialer is in its network.  Therefore, with this change, the neighborhood will continue: <br><br><pre> <code class="tex hljs">BranchOfficeSpoke3#show run interface serial 0/0 Building configuration... Current configuration : 128 bytes ! interface Serial0/0 ip address 192.168.101.2 255.255.255.248 encapsulation frame-relay frame-relay interface-dlci 103 end BranchOfficeSpoke3#show ip eigrp neighbors IP-EIGRP neighbors for process 100 H Address Interface Hold Uptime SRTT RTO Q Seq (sec) (ms) Cnt Num 0 192.168.101.1 Se0/0 5 00:00:26 460 2760 0 22 BranchOfficeSpoke3#conf t Enter configuration commands, one per line. End with CNTL/Z. BranchOfficeSpoke3(config)#int s0/0 BranchOfficeSpoke3(config-if)#ip address 192.168.101.2 255.255.255.252 BranchOfficeSpoke3(config-if)# *Mar 1 00:02:39.537: <span class="hljs-comment"><span class="hljs-comment">%DUAL-5-NBRCHANGE: IP-EIGRP(0) 100: Neighbor 192.168.101.1 (Serial0/0) is down: address changed BranchOfficeSpoke3(config-if)# *Mar 1 00:02:45.923: %DUAL-5-NBRCHANGE: IP-EIGRP(0) 100: Neighbor 192.168.101.1 (Serial0/0) is up: new adjacency BranchOfficeSpoke3(config-if)#^Z BranchOfficeSpoke3#sh *Mar 1 00:02:50.487: %SYS-5-CONFIG_I: Configured from console by console BranchOfficeSpoke3#show ip eigrp neighbors IP-EIGRP neighbors for process 100 H Address Interface Hold Uptime SRTT RTO Q Seq (sec) (ms) Cnt Num 0 192.168.101.1 Se0/0 5 00:00:09 1 4500 2 0</span></span></code> </pre> <br>  <b>5. 10.10.10.10 and 20.20.20.20 - the loopback addresses of the interfaces of the routers Spoke 1 and Spoke 2, respectively.</b>  <b>Both networks are visible on the Hub router, but Spoke 1 does not see the network 20.20.20.20, and Spoke 2 does not see 10.10.10.10.</b>  <b>At the same time, they see the other networks (for example, the 30.30.30.30 network of the Spoke 3 router) normally.</b>  <b>Why is this and how to fix this situation?</b> <br><br>  Indeed, the Spoke 1 router sees all networks except the networks of the Spoke 2 router, and the Spoke 2 router sees all the networks except the networks of the Spoke 1 router. Because of what could happen? <br><br>  The first assumption: filtering routes.  We look: <br><br><pre> <code class="tex hljs">BranchOfficeSpoke1#show running-config | section router eigrp 100 router eigrp 100 network 10.0.0.0 network 172.16.0.0 network 192.168.0.0 0.0.255.255 auto-summary eigrp stub connected summary neighbor 192.168.100.1 Serial0/0</code> </pre> <br><pre> <code class="tex hljs">BranchOfficeSpoke2#show running-config | section router eigrp 100 router eigrp 100 network 20.0.0.0 network 192.168.0.0 0.0.255.255 auto-summary eigrp stub connected summary</code> </pre> <br>  No filtering.  Look further: all the information about the routes both of these Spoke routers receive from a single Hub router.  But there is no filtering there - we already looked at its router eigrp 100 section.  What else could be the reason that routes are announced so selectively? <br><br>  The reason for this is that EIGRP is a distance vector protocol.  He does not know the whole topology, he knows only some kind of metric and direction to the network (next hop router).  In these circumstances, distance vector protocols are much easier to obtain a routing loop, and they all use three mechanisms to prevent such loops: Route Poisoning, Holddown Timer, and Split Horizon.  Remember how Split Horizon works?  The router does not announce the network through the interfaces through which he learned about them. <br><br>  Now look at our topology.  Spoke 1 and Spoke 2 routers are connected to the Hub via a single multipoint subinterface: Serial0 / 0.202.  According to the rule of Route Poisoning, the Hub router does not announce through it those networks that he learned about from him.  Therefore, the Hub router will not announce Spoke 1 network 20.20.20.20 - he learned about it through the same interface, albeit from another nibor. <br><br>  Therefore, in order to fix this glitch, you need to turn off Split Horizon on the Serial 0 / 0.202 interface of the router Hub.  At the same time, in order to minimize damage, it can be turned off for a specific instance (AS Number) of a specific protocol: <br><br><pre> <code class="tex hljs">MainOfficeHub(config-subif)#no ip split-horizon eigrp 100</code> </pre> <br><pre> <code class="tex hljs">BranchOfficeSpoke1#show ip route Codes: C - connected, S - static, R - RIP, M - mobile, B - BGP D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2 E1 - OSPF external type 1, E2 - OSPF external type 2 i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2 ia - IS-IS inter area, * - candidate default, U - per-user static route o - ODR, P - periodic downloaded static route Gateway of last resort is not set D 20.0.0.0/8 [90/2809856] via 192.168.100.1, 00:02:19, Serial0/0 172.16.0.0/16 is variably subnetted, 2 subnets, 2 masks ! Output omitted</code> </pre> <br>  <b>6. Spoke 1 and Spoke 2 routers are configured as eigrp stub, but the networks of their loopback interfaces are still announced by the hub router.</b>  <b>Why does this happen and how can they not announce anything?</b> <br><br>  Spoke 1 and Spoke 2 routers, as Spoke routers rely on in the Hub &amp; Spoke topology, are configured as stub routers with the eigrp stub command.  However, notice that in the config it is displayed as eigrp stub connected summary.  By default, despite the fact that you do not select these options, the router selects the stub mode, in which it does not announce anything other than connected networks and summary networks.  In order for the router not to announce anything, you need to enter the command eigrp stub receive-only. <br><br>  <b>7. If the hub router loses the link to the network on 10.10.10.10, where will it send the EIGRP Query and why?</b> <br><br>  As you know, when an EIGRP router loses a path to some network, it transfers it to the Active state and starts sending EIGRP Query messages to neighbors with the words: do you know, by chance, the path to this network, because I just lost it ? <br><br>  Let's see live where he will send them to Hub router if he loses the path to the network 10.10.10.10. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2ce/e85/52b/2cee8552b3d78b4e75c48bb04665cf8e.jpg" alt="image"><br><br>  These are the EIGRP Query packages that the Hub router sent from the FastEthernet 0/0 and FastEthernet 0/1 interfaces, but it did not send them from the Serial 0 / 0.202 and Serial 0 / 0.204 interfaces, although they also had neybor.  What is the reason for this? <br><br>  The hub router does this because all the neybor on the Serial 0 / 0.202 and Serial 0 / 0.204 interfaces are configured as stub routers.  Being configured as a stub, the router informs all the neybor about this, including this information in its Hello packages: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5c4/aa1/807/5c4aa1807df665503ce87636b0dc535c.jpg" alt="image"><br><br>  Stub routers do not make sense to send EUGRP Query, and this is logical, because they do not relay other people's networks via EIGRP, therefore, they can not provide an alternative route for the lost prefix.  Because Hub router and does not send Query to all three Spoke routers. <br><br>  <b>8. How much bandwidth to a Spoke 3 bandwidth can EIGRP packets take?</b> <br><br>  One of the EIGRP features is bandwidth control.  It was invented to prevent cases where a slow WAN link can be completely clogged with EIGRP messages (in the case, for example, when a new EIGRP network appears on this link or there is some big change in the network).  Therefore, by default, EIGRP can occupy a maximum of half the interface bandwidth.  But in the case of subinterfaces and Frame Relay, this calculation is not obvious. <br><br>  Each subinterface receives as a reference bandwidth of the interface on which it is configured.  So both interfaces on the Hub router: Serial 0 / 0.202 and Serial 0 / 0.204 will have a bandwidth of 1544 kbit / s.  One subinterface leads to Spoke 3: Serial 0 / 0.204, and EIGRP in a data stream can occupy a maximum of half the bandwidth: 772 kbps. <br><br>  For multipoint subinterfaces, EIGRP limits not only the transfer of updates through a single interface, but also the maximum load of these updates on a single DLCI.  Thus, the total bandwidth of the interface is divided by the amount of DLCI in it, and from the result obtained for each DLCI, half the bandwidth is allocated for EIGRP.  So for the Serial 0 / 0.202 subinterface, the maximum bandwidth of 386 kbit / s will be available for each DLCI for EIGRP. <br><br>  <b>9. EIGRP authentication is configured between the Hub router and R5, but routers cannot establish a neighborhood.</b>  <b>In this case, on the Hub router, the neighborhood with R5 is then installed, then lost.</b>  <b>What is the reason for this and how to eliminate it?</b> <br><br>  And indeed, a rather strange activity occurs on the Hub router, the neighborhood with 192.168.201.2 (R5) is either set or disappears: <br><br><pre> <code class="tex hljs">MainOfficeHub# *Mar 1 01:03:20.658: <span class="hljs-comment"><span class="hljs-comment">%DUAL-5-NBRCHANGE: IP-EIGRP(0) 100: Neighbor 192.168.201.2 (FastEthernet0/1) is down: retry limit exceeded MainOfficeHub# *Mar 1 01:03:22.974: %DUAL-5-NBRCHANGE: IP-EIGRP(0) 100: Neighbor 192.168.201.2 (FastEthernet0/1) is up: new adjacency MainOfficeHub# *Mar 1 01:04:42.500: %DUAL-5-NBRCHANGE: IP-EIGRP(0) 100: Neighbor 192.168.201.2 (FastEthernet0/1) is down: retry limit exceeded MainOfficeHub# *Mar 1 01:04:46.006: %DUAL-5-NBRCHANGE: IP-EIGRP(0) 100: Neighbor 192.168.201.2 (FastEthernet0/1) is up: new adjacency</span></span></code> </pre> <br>  At the same time, nothing like this happens on the R5 itself, the router does not even think of establishing a neighborhood with Hub: <br><br><pre> <code class="tex hljs">IP-EIGRP neighbors for process 100 H Address Interface Hold Uptime SRTT RTO Q Seq (sec) (ms) Cnt Num 0 192.168.203.2 Fa0/0 10 01:06:39 281 2529 0 71</code> </pre> <br><br>  What could be the reason? <br><br>  On the FastEthernet0 / 1 interface of the Hub router, authentication for EIGRP neybor is configured: <br><br><pre> <code class="tex hljs">MainOfficeHub#show running-config interface fastEthernet 0/1 Building configuration... Current configuration : 188 bytes ! interface FastEthernet0/1 ip address 192.168.201.1 255.255.255.252 ip authentication mode eigrp 100 md5 ip authentication key-chain eigrp 100 main-chain duplex auto speed auto end MainOfficeHub#show key chain main-chain Key-chain main-chain: key 1 -- text "qwerty" accept lifetime (always valid) - (always valid) [valid now] send lifetime (always valid) - (always valid) [valid now]</code> </pre> <br>  The same is configured for R5: <br><br><pre> <code class="tex hljs">R5#show running-config interface fa0/1 Building configuration... Current configuration : 185 bytes ! interface FastEthernet0/1 ip address 192.168.201.2 255.255.255.252 ip authentication mode eigrp 100 md5 ip authentication key-chain eigrp 100 mychain duplex auto speed auto end R5#show key chain mychain Key-chain mychain: key 1 -- text "qwerty" accept lifetime (12:00:00 UTC Apr 1 2012) - (infinite) send lifetime (always valid) - (always valid) [valid now]</code> </pre> <br>  The names of the key chain on the routers do not match, but they should not - the neighborhood is not a hindrance.  The reason for the strange behavior in the lifetime on R5.  This router constantly ‚Äúsigns‚Äù its messages with a password that is valid for the Hub of the router, but Hello will start to be signed only with April 1, 2012. <br><br>  It turns out that the Hub router receives a Hello packet with the correct password, identifies R5 as a neybora (displays a line to the terminal), and tries to exchange routes with it.  But R5 does not respond to such a request, because, although it sends this password, it does not accept it as a correct one.  The hub router waits for a response for a while, after which it identifies R5 as a dead person (it displays a line to the terminal) and the circle closes. <br><br>  In order to interrupt it, you need to remove the temporary restriction on the password on R5: <br><br><pre> <code class="tex hljs">R5(config)#key chain mychain R5(config-keychain)#key 1 R5(config-keychain-key)#no accept-lifetime 12:00:00 Apr 1 2012 infinite R5(config-keychain-key)# *Mar 1 01:14:01.048: <span class="hljs-comment"><span class="hljs-comment">%DUAL-5-NBRCHANGE: IP-EIGRP(0) 100: Neighbor 192.168.201.1 (FastEthernet0/1) is up: new adjacency</span></span></code> </pre> <br>  Neighborhood established. <br><br>  <b>10. ASBR has an Internet connection through the loopback 4 interface with the address 50.0.0.1/24.</b>  <b>It is necessary to announce on EIGRP default route to this network.</b> <br><br>  <i>(Here I complicated the task a bit: I changed the network address from 150.0.0.1/24 to 50.0.0.1/24)</i> <br><br>  To announce a default route, EIGRP supports the concept of a default network ‚Äî a full-class network can be announced via EIGRP as a default gateway.  West traffic for which no route is found will be routed to a router connected to this network. <br><br>  But - such a network should be full-class.  We have our way to the provider has the address: 50.0.0.1/24.  How to be in this case? <br><br>  To announce via EIGRP, we need a full-class network - you can‚Äôt get out.  As a result, all traffic will be delivered to us.  But then we are already free to do with him what we want, right?  It is not necessary to push it into this very full-class network, we can send it with a static route, wherever we want. <br><br>  Therefore - we will create another loopback interface, say, loopback 10 with a full class address: 160.0.0.1/24. <br><br><pre> <code class="tex hljs">ASBR(config)#int loopback 10 *Mar 1 01:42:07.148: <span class="hljs-comment"><span class="hljs-comment">%LINEPROTO-5-UPDOWN: Line protocol on Interface Loopback10, changed state to up ASBR(config-if)#ip address 160.0.0.1 255.255.255.0</span></span></code> </pre> <br>  Next, create a static route on the ASBR for the default route - to the network 50.0.0.1/24 through the loopback interface 4. <br><br><pre> <code class="tex hljs">ASBR(config)#ip route 0.0.0.0 0.0.0.0 loopback 4</code> </pre> <br>  <i>(Yes, I know that is so incorrect, but what can you do - Lupbek. Consider that I indicated hext hop IP address here)</i> <br><br>  Now we define the network 160.0.0.1/24 as the default-network and announce it by EIGRP. <br><br><pre> <code class="tex hljs">ASBR(config)#ip default-network 160.0.0.0 ASBR(config)#router eigrp 100 ASBR(config-router)#network 160.0.0.0</code> </pre> <br>  As a result, we get on all routers of our network, except ASBR, the default route - to the network 160.0.0.0: <br><br><pre> <code class="tex hljs">MainOfficeHub#show ip route Codes: C - connected, S - static, R - RIP, M - mobile, B - BGP D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2 E1 - OSPF external type 1, E2 - OSPF external type 2 i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2 ia - IS-IS inter area, * - candidate default, U - per-user static route o - ODR, P - periodic downloaded static route Gateway of last resort is 192.168.200.2 to network 160.0.0.0 ! Output omitted D* 160.0.0.0/16 [90/158720] via 192.168.200.2, 00:01:19, FastEthernet0/0 MainOfficeHub#ping 50.0.0.1 Type escape sequence to abort. Sending 5, 100-byte ICMP Echos to 50.0.0.1, timeout is 2 seconds: !!!!! Success rate is 100 percent (5/5), round-trip min/avg/max = 24/149/465 ms</code> </pre> <br>  And the ASBR is a static route that redirects traffic from loopback 10 (which represents the default network) to a real provider to a classless network. <br><br>  <b>11. On the Hub router, the summary route for the 192.168.100.0/22 ‚Äã‚Äãnetwork is configured.</b>  <b>Why is its metric set to 2169856?</b> <br><br>  In order to figure this out, we need to look at the EIGRP topology table on the Hub router. <br><br><pre> <code class="tex hljs">MainOfficeHub#show ip eigrp topology IP-EIGRP Topology Table for AS(100)/ID(192.168.200.1) Codes: P - Passive, A - Active, U - Update, Q - Query, R - Reply, r - reply Status, s - sia Status P 30.30.30.30/32, 1 successors, FD is 2297856 via 192.168.101.2 (2297856/128256), Serial0/0.204 P 10.0.0.0/8, 1 successors, FD is 2297856 via 192.168.100.2 (2297856/128256), Serial0/0.202 P 192.168.100.0/22, 1 successors, FD is 2169856 via Summary (2169856/0), Null0 P 192.168.100.0/24, 1 successors, FD is 2169856 via Summary (2169856/0), Null0 P 192.168.100.0/29, 1 successors, FD is 2169856 via Connected, Serial0/0.202 P 192.168.101.0/24, 1 successors, FD is 4168960 via Summary (4168960/0), Null0 P 192.168.101.0/29, 1 successors, FD is 4168960 via Connected, Serial0/0.204 P 20.0.0.0/8, 1 successors, FD is 2297856 via 192.168.100.3 (2297856/128256), Serial0/0.202 P 160.0.0.0/16, 1 successors, FD is 158720 via 192.168.200.2 (158720/156160), FastEthernet0/0 P 192.168.200.0/24, 1 successors, FD is 28160 via Summary (28160/0), Null0 P 192.168.200.0/30, 1 successors, FD is 28160 via Connected, FastEthernet0/0 P 192.168.201.0/24, 1 successors, FD is 28160 via Summary (28160/0), Null0 P 192.168.201.0/30, 1 successors, FD is 28160 via Connected, FastEthernet0/1 P 192.168.202.0/24, 1 successors, FD is 30720 via 192.168.200.2 (30720/28160), FastEthernet0/0 P 192.168.203.0/24, 1 successors, FD is 33536 via 192.168.201.2 (33536/30976), FastEthernet0/1 P 172.16.0.0/16, 1 successors, FD is 158720 via 192.168.200.2 (158720/156160), FastEthernet0/0 via 192.168.100.2 (2297856/128256), Serial0/0.202</code> </pre> <br>  As can be seen from the topology table, summary route 192.168.100.0/22 ‚Äã‚Äãcombines routes to networks 192.168.100.0/29 and P 192.168.101.0/29.  2169856 - the smallest metric of them.  For the summary route, EIGRP sets the minimum metric of all aggregated routes as a metric. <br><br>  <b>12. In connection with the automatic summation of routes, the network of the Loopback 1 interface of the Spoke 1 router and the Loopback network of the 0‚Äì3 ASBR routers are advertised as the same 172.16.0.0/16 networks.</b>  <b>Where do you need to remove the automatic summation, so that all the network routers see them as different networks?</b> <br><br> EIGRP      connected ,   EIGRP      auto-summary  ( ,            ).   172.16.10.1/24  172.16.0.1/24, 172.16.1.1/24, 172.16.2.1/24   Spoke 1  ASBR ,       summary.  ,      ,       .         ,   auto-summary . <br><br><pre> <code class="tex hljs">MainOfficeHub#show running-config | section eigrp 100 router eigrp 100 variance 5 network 192.168.0.0 0.0.255.255 auto-summary neighbor 192.168.100.3 Serial0/0.202 neighbor 192.168.100.2 Serial0/0.202 MainOfficeHub#show ip route Codes: C - connected, S - static, R - RIP, M - mobile, B - BGP D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2 E1 - OSPF external type 1, E2 - OSPF external type 2 i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2 ia - IS-IS inter area, * - candidate default, U - per-user static route o - ODR, P - periodic downloaded static route Gateway of last resort is 192.168.200.2 to network 160.0.0.0 172.16.0.0/24 is subnetted, 4 subnets D 172.16.10.0 [90/2297856] via 192.168.100.2, 00:05:57, Serial0/0.202 D 172.16.0.0 [90/158720] via 192.168.200.2, 00:05:53, FastEthernet0/0 D 172.16.1.0 [90/158720] via 192.168.200.2, 00:05:53, FastEthernet0/0 D 172.16.2.0 [90/158720] via 192.168.200.2, 00:05:53, FastEthernet0/0 ! Output omitted</code> </pre> <br> <b>13.  Hub         .  variance 2.      EIGRP (   ),      15000  16000,          .   ?</b> <br><br>         ‚Äì    ,   ,  EIGRP.        .  ,  EIGRP ‚Äì - ,         . <br><br> EIGRP     ,  ,     (next hop)   .  DUAL,    EIGRP,  loop-free      successor/feasible successor  .    loop-free,     . <br><br> DUAL  feasible successor      .                next hop,       .   successor/feasible successor! <br><br> EIGRP, -,   .           .  ,      ,    , ,   loop-free .       ,   , ,  ,   loop-free ,        ,  -    .       feasible successor. <br><br>   ,      .    ,   EIGRP Query    .      . <br><br>       Hub    ASBR: <br><br><pre> <code class="tex hljs">MainOfficeHub#show ip eigrp topology all-links IP-EIGRP Topology Table for AS(100)/ID(192.168.200.1) Codes: P - Passive, A - Active, U - Update, Q - Query, R - Reply, r - reply Status, s - sia Status ! Output omitted P 172.16.0.0/24, 1 successors, FD is 158720, serno 40 via 192.168.200.2 (158720/156160), FastEthernet0/0 via 192.168.201.2 (161536/158976), FastEthernet0/1 P 172.16.1.0/24, 1 successors, FD is 158720, serno 41 via 192.168.200.2 (158720/156160), FastEthernet0/0 via 192.168.201.2 (161536/158976), FastEthernet0/1 P 172.16.2.0/24, 1 successors, FD is 158720, serno 42 via 192.168.200.2 (158720/156160), FastEthernet0/0 via 192.168.201.2 (161536/158976), FastEthernet0/1</code> </pre> <br>  ,     172.16.0.0/24   ,     FD ,    AD  Hub .               . <br><br><h4>  Conclusion </h4><br>    ,   ,          . ,    ,                . <br><br> <b>PS</b>  - ,       ,       , ‚Äì , ,   . </div><p>Source: <a href="https://habr.com/ru/post/126450/">https://habr.com/ru/post/126450/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../126442/index.html">Chinese online store from the inside</a></li>
<li><a href="../126443/index.html">Jelastic - easy and fast swap domains between environments</a></li>
<li><a href="../126445/index.html">International startup acceleration</a></li>
<li><a href="../126446/index.html">Why should a programmer teach usability?</a></li>
<li><a href="../126447/index.html">Oatmeal - Why is it better not to say that you understand computers?</a></li>
<li><a href="../126453/index.html">New simple JavaScript editor in Firefox</a></li>
<li><a href="../126455/index.html">7 reasons to suffer the customer</a></li>
<li><a href="../126456/index.html">SmartOS: fully modern OS</a></li>
<li><a href="../126458/index.html">Expansion of functionality without source code</a></li>
<li><a href="../126459/index.html">Life abroad</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>