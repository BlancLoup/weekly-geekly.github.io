<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Training course. Working with concurrency with the Entity Framework in an ASP.NET MVC application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the final part of a series of articles devoted to developing using the Entity Framework and ASP.NET MVC 3. You can find the first chapters at ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Training course. Working with concurrency with the Entity Framework in an ASP.NET MVC application</h1><div class="post__text post__text-html js-mediator-article">  This is the final part of a series of articles devoted to developing using the Entity Framework and ASP.NET MVC 3. You can find the first chapters at the following links: <br><ul><li>  <a href="http://blogs.msdn.com/b/vyunev/archive/2011/10/04/entity-framework-asp-net-mvc.aspx">Creating the Entity Framework data model for an ASP.NET MVC application</a> </li><li>  <a href="http://blogs.msdn.com/b/vyunev/archive/2011/10/05/crud-entity-framework-asp-net-mvc.aspx">Implementing Basic CRUD Functionality with the Entity Framework in an ASP.NET MVC Application</a> </li><li>  <a href="http://blogs.msdn.com/b/vyunev/archive/2011/10/06/entity-framework-asp-net-mvc-part4.aspx">Sorting, filtering and paging with the Entity Framework in an ASP.NET MVC application</a> </li><li>  <a href="http://blogs.msdn.com/b/vyunev/archive/2011/10/07/asp-net-mvc-p6.aspx">Creating a complex data model for an ASP.NET MVC application</a> </li><li>  <a href="http://blogs.msdn.com/b/vyunev/archive/2011/10/07/asp-net-mvc-2.aspx">Creating a complex data model for an ASP.NET MVC application, part 2</a> </li><li>  <a href="http://blogs.msdn.com/b/vyunev/archive/2011/10/12/entity-framework-asp-net-mvc-part5.aspx">Loading data from the Entity Framework in an ASP.NET MVC application</a> </li><li>  <a href="http://blogs.msdn.com/b/vyunev/archive/2011/10/17/entity-framework-asp-net-mvc-part6.aspx">Updating related data using the Entity Framework in an ASP.NET MVC application</a> </li></ul>  In previous lessons you worked with related data.  In this lesson we will look at simultaneous access issues.  You will create pages that work with the Department entity, and pages for editing and deleting Department entities will also handle concurrency errors.  The results of the work are shown in the illustrations. <br><br><img title="clip_image001" alt="clip_image001" src="https://habrastorage.org/getpro/habr/post_images/172/306/0bc/1723060bcb29184bd2937e55b52534d6.png" width="549" height="450"><br><a name="habracut"></a><br><img title="clip_image002" alt="clip_image002" src="https://habrastorage.org/getpro/habr/post_images/8c9/339/fc3/8c9339fc311b0478b66f5fbaf0e69a7b.png" width="294" height="450"><br><br>  <b>Concurrent access conflicts</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A concurrent access conflict occurs when one user views data about one entity and then edits it, and at the same time another user updates this same data before changes made by the first user are saved to the database.  If the EF is not configured to detect such conflicts, the one who last updates the database will overwrite changes made earlier.  In many applications, risk is not critical: if there are several users, or several updates, or rewriting changes is not very critical, the price of concurrency-oriented programming will be higher than the benefit from this.  In this case, it is not necessary to set up applications to handle such situations. <br><br>  <b>Pessimistic Concurrency (Locking)</b> <br><br>  If an application needs to prevent accidental data loss due to concurrent access conflicts, one of the methods to solve the problem is to lock the tables.  This is called pessimistic <i>concurrency</i> .  For example, before loading a record from a database, you request a lock for read-only or update access.  If you block change access in this way, no other user can block this record for read-only or change access, as they only get a copy of the data.  If you block a record for read-only access, others can also block it for read-only access, but not for a change. <br><br>  Managing locks has its drawbacks.  Programming can be too complicated, locks need serious database resources, and the overhead of loading increases as the number of users of the application increases.  In this regard, not all DBMSs support pessimistic parallelism.  The Entity Framework does not provide a built-in mechanism for providing pessimistic concurrency, and this approach will not be considered in this lesson. <br><br>  <b>Optimistic concurrency</b> <br><br>  As an alternative to pessimistic concurrency (pessimistic concurrency), optimistic concurrency appears.  Optimistic concurrency allows simultaneous access conflicts to occur, but allows you to adequately respond to such situations.  For example, John opens the Departments Edit page, changes the <b>Budget</b> value for an English branch from $ 350,000.00 to $ 100,000.00. <br><br><img title="clip_image003" alt="clip_image003" src="https://habrastorage.org/getpro/habr/post_images/7a6/473/663/7a6473663756cbac68b8cbbc4527851b.png" width="347" height="450"><br><br>  Before John saves the Save button, Jane opens the same page and changes the <b>Start</b> <b>Date</b> value to 1/1/1999. <br><br><img title="clip_image004" alt="clip_image004" src="https://habrastorage.org/getpro/habr/post_images/5aa/26b/483/5aa26b483a57b47393110322c61f39de.png" width="344" height="450"><br><br>  John presses the <b>Save</b> button first and sees his changes, and at that moment Jane presses the button.  What follows from this depends on how you handle this kind of situation.  They can be processed by the following methods: <br><ul><li>  You can keep a record of which property has been edited and update only the corresponding columns in the database.  In the example, the data will not be lost, since different properties have been edited by different users.  The next time you view the data about the English branch, the user will see the changes made by both John and Jane. </li></ul>  This method can reduce the number of situations with data loss, but will not be able to help when editing a single entity property.  However, the use of this method is rarely found in web applications due to the large amount of data that needs to be managed to keep track of old and new property values.  Managing large amounts of data can affect application performance. <br><ul><li>  You can let Jane's changes overwrite John's changes.  Then the next user will see 1/1/1999 and the old value of $ 350,000.00.  This script is called <i>Client</i> <i>Wins</i> or <i>Last</i> <i>in</i> <i>Wins</i> .  This happens automatically if you do not change the behavior of the application. </li><li>  You can not update the database for changes Jane: give an error, show the current state of the data and allow it to refresh the page and enter your data again.  This script is called <i>Store</i> <i>Wins</i> .  We will use this scenario in this lesson.  It guarantees that the changes will not be lost, and the user will be promptly notified of a concurrent access conflict. </li></ul>  <b>Concurrent Access Detection</b> <br><br>  You can resolve such conflicts with the exception handling of the OptimisticConcurrencyException thrown by the EF.  In order to know when to throw out this exception, the EF must be able to determine the moment of the occurrence of the conflict.  Therefore, it is necessary to properly configure the database and data model.  You can use the following options for such a setting: <br><ul><li>  In the table in the database include a "tracking" column, which can be used to determine the moment of change records.  You can then include this column in the Where clause of Update or Delete requests. </li></ul>  The data type of this column is usually timestamp, but in fact it does not store the date or time.  Instead, the value is equal to the digit increasing by one each time data is updated (the same data type can be of rowversion type in recent versions of SQL Server).  In Update or Delete requests, the Where clause includes the original value of the ‚Äúwitness‚Äù column.  If the record is being edited by the user during the update process, the value in this column is different from the original one, so the Update and Delete queries will not be able to find this record.  When EF detects that nothing has been updated with the Update or Delete request, it regards this as a concurrent access conflict. <br><ul><li>  Configure EF to include the source data for each column in the Where clause of Update and Delete requests. </li></ul>  As one of the options, if nothing in the record has changed since it was first loaded, the Where operator will not return the record for updating, which EF will perceive as a conflict.  This option is as effective as the ‚Äútracking‚Äù column option.  However, if there is a table with multiple columns, this approach can result in a large number of Where clauses and the need to manage large arrays of data and states.  This approach is not recommended for use in most cases. <br><br>  In this lesson, we will add a ‚Äútracking‚Äù column to the Department entity, create the controller and views, and test everything in conjunction. <br><br>  Note If you implement concurrency without a ‚Äúwitness‚Äù column, you must mark all non-primary keys with the ConcurrencyCheck attribute, specifying for EF that all columns will be included in the Where statement of the Update request <br><br>  <b>Adding a ‚Äúwitness‚Äù column to a</b> <b>Department</b> <b>entity</b> <br><br>  In <i>Models</i> <i>\</i> <i>Department</i> <i>.</i>  <i>cs</i> add a ‚Äúwitness‚Äù column: <br><br><pre><code class="hljs pgsql">[<span class="hljs-type"><span class="hljs-type">Timestamp</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Byte[] <span class="hljs-type"><span class="hljs-type">Timestamp</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre> <br>  The Timestamp attribute specifies that this column will be included in the Where clause of Update and Delete requests. <br><br>  <b>Creating a</b> <b>controller</b> <br><br>  Create a Department controller and views: <br><br><img title="clip_image005" alt="clip_image005" src="https://habrastorage.org/getpro/habr/post_images/2a1/866/791/2a18667918df8adf82ba15f6b826a58b.png" width="550" height="384"><br><br>  In <i>Controllers \ DepartmentController.cs,</i> add using: <br><br>  using System.Data.Entity.Infrastructure; <br><br>  Change LastName to FullName in the entire file (four entries) so that the drop-down lists of faculty administrators display the full name instead of the last name. <br><br>  Replace the code for the HttpPost Edit method with: <br><br><pre> <code class="hljs pgsql">[HttpPost] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> ActionResult Edit(Department department) { try { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ModelState.IsValid) { db.Entry(department).State = EntityState.Modified; db.SaveChanges(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RedirectToAction("Index"); } } catch (DbUpdateConcurrencyException ex) { var entry = ex.Entries.Single(); var databaseValues = (Department)entry.GetDatabaseValues().ToObject(); var clientValues = (Department)entry.Entity; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (databaseValues.Name != clientValues.Name) ModelState.AddModelError("Name", "Current value: " + databaseValues.Name); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (databaseValues.Budget != clientValues.Budget) ModelState.AddModelError("Budget", "Current value: " + String.Format("{0:c}", databaseValues.Budget)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (databaseValues.StartDate != clientValues.StartDate) ModelState.AddModelError("StartDate", "Current value: " + String.Format("{0:d}", databaseValues.StartDate)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (databaseValues.InstructorID != clientValues.InstructorID) ModelState.AddModelError("InstructorID", "Current value: " + db.Instructors.Find(databaseValues.InstructorID).FullName); ModelState.AddModelError(string.Empty, "The record you attempted to edit " + "was modified by another user after you got the original value. The " + "edit operation was canceled and the current values in the database " + "have been displayed. If you still want to edit this record, click " + "the Save button again. Otherwise click the Back to List hyperlink."); department.Timestamp = databaseValues.Timestamp; } catch (DataException) { //<span class="hljs-keyword"><span class="hljs-keyword">Log</span></span> the error (<span class="hljs-keyword"><span class="hljs-keyword">add</span></span> a variable <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>) ModelState.AddModelError(string.Empty, "Unable to save changes. Try again, and if the problem persists contact your system administrator."); } ViewBag.InstructorID = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> SelectList(db.Instructors, "InstructorID", "FullName", department.InstructorID); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">View</span></span>(department); }</code> </pre><br>  The view displays the original value of the ‚Äúwitness‚Äù column in a hidden field.  When creating a department instance, this object will have no value in the Timestamp property.  Then, after creating the EF Update request, the query will include a Where clause with the search condition for the record with the original Timestamp value. <br><br>  If no records are updated by the Update request, EF will throw a DbUpdateConcurrencyException exception, and the code in the catch block will return the Department entity associated with the exception.  This entity has original and new property values: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> entry = ex.<span class="hljs-type"><span class="hljs-type">Entries</span></span>.<span class="hljs-type"><span class="hljs-type">Single</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> databaseValues = (<span class="hljs-type"><span class="hljs-type">Department</span></span>)entry.<span class="hljs-type"><span class="hljs-type">GetDatabaseValues</span></span>().<span class="hljs-type"><span class="hljs-type">ToObject</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> clientValues = (<span class="hljs-type"><span class="hljs-type">Department</span></span>)entry.<span class="hljs-type"><span class="hljs-type">Entity</span></span>;</code> </pre><br>  Next, the code adds an error message for each column that has values ‚Äã‚Äãin the database that differ from what the user entered on the Edit page: <br><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (databaseValues.Name != currentValues.Name) ModelState.AddModelError(<span class="hljs-string"><span class="hljs-string">"Name"</span></span>, <span class="hljs-string"><span class="hljs-string">"Current value: "</span></span> + databaseValues.Name); <span class="hljs-comment"><span class="hljs-comment">// ...</span></span></code> </pre><br>  If an error occurs, a detailed message is displayed: <br><br><pre> <code class="hljs smalltalk"><span class="hljs-type"><span class="hljs-type">ModelState</span></span>.<span class="hljs-type"><span class="hljs-type">AddModelError</span></span>(string.<span class="hljs-type"><span class="hljs-type">Empty</span></span>, <span class="hljs-comment"><span class="hljs-comment">"The record you attempted to edit "</span></span> + <span class="hljs-comment"><span class="hljs-comment">"was modified by another user after you got the original value. The"</span></span> + <span class="hljs-comment"><span class="hljs-comment">"edit operation was canceled and the current values in the database "</span></span> + <span class="hljs-comment"><span class="hljs-comment">"have been displayed. If you still want to edit this record, click "</span></span> + <span class="hljs-comment"><span class="hljs-comment">"the Save button again. Otherwise click the Back to List hyperlink."</span></span>);</code> </pre><br>  Finally, the code sets the value of the Timestamp property for the Department object to a new value obtained from the database.  This new value will be saved in a hidden field when the Edit page is refreshed, and the next time you click Save, only those parallelism errors that have occurred since the page was reloaded will be captured. <br><br>  In <i>Views</i> <i>\</i> <i>Department</i> <i>\</i> <i>Edit</i> <i>.</i>  <i>cshtml</i> add a hidden field to save the Timestamp value, immediately after the hidden field for the DepartmentID property: <br><br>  <a href="http://habrahabr.ru/users/html/" class="user_link">Html</a> .HiddenFor (model =&gt; model.Timestamp) <br><br>  In <i>Views</i> <i>\</i> <i>Department</i> <i>\</i> <i>Index</i> <i>.</i>  <i>cshtml</i> replace the code so that you move the links of the records to the left and change the page headers and columns: <br><br><pre> <code class="hljs xml">@model IEnumerable<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ContosoUniversity.Models.Department</span></span></span><span class="hljs-tag">&gt;</span></span> @{ ViewBag.Title = "Departments"; } <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span>Departments<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.ActionLink("Create New", "Create") <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>Name<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>Budget<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>Start Date<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>Administrator<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> @foreach (var item in Model) { <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.ActionLink("Edit", "Edit", new { id=item.DepartmentID }) | @Html.ActionLink("Details", "Details", new { id=item.DepartmentID }) | @Html.ActionLink("Delete", "Delete", new { id=item.DepartmentID }) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.DisplayFor(modelItem =&gt; item.Name) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.DisplayFor(modelItem =&gt; item.Budget) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.DisplayFor(modelItem =&gt; item.StartDate) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.DisplayFor(modelItem =&gt; item.Administrator.FullName) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> } <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><h4>  Optimistic Concurrency Performance Review </h4><br>  Run the project and click on <b>Departments</b> : <br><br><img title="clip_image001 [1]" alt="clip_image001[1]" src="https://habrastorage.org/getpro/habr/post_images/172/306/0bc/1723060bcb29184bd2937e55b52534d6.png" width="549" height="450"><br><br>  Click the <b>Edit</b> link and then in the new browser window open another Edit page.  Windows should display identical information. <br><br><img title="clip_image006" alt="clip_image006" src="https://habrastorage.org/getpro/habr/post_images/2e9/606/1ca/2e96061ca578aad05386379625f45699.png" width="348" height="450"><br><br>  Change the field in the first browser window and click <b>Save</b> . <br><br><img title="clip_image007" alt="clip_image007" src="https://habrastorage.org/getpro/habr/post_images/be2/1a6/79e/be21a679e924e803725e9a2834f3f2d0.png" width="348" height="450"><br><br>  The Index page is displayed with the changed data. <br><br><img title="clip_image008" alt="clip_image008" src="https://habrastorage.org/getpro/habr/post_images/059/d65/61a/059d6561ab2eeabb8a164a2aaa03c5d2.png" width="550" height="447"><br><br>  Change the same field to a different value in the second browser window. <br><br><img title="clip_image009" alt="clip_image009" src="https://habrastorage.org/getpro/habr/post_images/414/826/3f6/4148263f6693081b0e503d8cd5aa3755.png" width="348" height="450"><br><br>  Click <b>Save</b> to see the error message: <br><br><img title="clip_image002 [1]" alt="clip_image002[1]" src="https://habrastorage.org/getpro/habr/post_images/8c9/339/fc3/8c9339fc311b0478b66f5fbaf0e69a7b.png" width="294" height="450"><br><br>  Click <b>Save</b> again.  The value you entered in the second browser window is saved in the database and you will see that the changes appear on the Index page. <br><br><img title="clip_image010" alt="clip_image010" src="https://habrastorage.org/getpro/habr/post_images/904/f68/507/904f68507e4a24cd18389470aa946295.png" width="550" height="449"><br><br>  <b>Add Delete Page</b> <br><br>  For the Delete page, concurrency issues are handled in a similar way.  When the confirmation window is displayed by the HttpGet Delete method, the view includes the original Timestamp value in a hidden field.  This value is available to the HttpPost Delete method, which is called when the user confirms the deletion.  When EF creates a Delete request, this request includes a Where clause with the original Timestamp value.  If the request returns nothing, a parallelism exception is thrown, and the HttpGet Delete method is called with the error parameter set to true to reload the confirmation page with an error message. <br><br>  In the <i>DepartmentController</i> <i>.</i>  <i>cs</i> replace the code of the HttpGet Delete method with: <br><br><pre> <code class="hljs smalltalk">public <span class="hljs-type"><span class="hljs-type">ActionResult</span></span> <span class="hljs-type"><span class="hljs-type">Delete</span></span>(int id, bool? concurrencyError) { if (concurrencyError.<span class="hljs-type"><span class="hljs-type">GetValueOrDefault</span></span>()) { <span class="hljs-type"><span class="hljs-type">ViewBag</span></span>.<span class="hljs-type"><span class="hljs-type">ConcurrencyErrorMessage</span></span> = <span class="hljs-comment"><span class="hljs-comment">"The record you attempted to delete "</span></span> + <span class="hljs-comment"><span class="hljs-comment">"was modified by another user after you got the original values. "</span></span> + <span class="hljs-comment"><span class="hljs-comment">"The delete operation was canceled and the current values in the "</span></span> + <span class="hljs-comment"><span class="hljs-comment">"database have been displayed. If you still want to delete this "</span></span> + <span class="hljs-comment"><span class="hljs-comment">"record, click the Delete button again. Otherwise "</span></span> + <span class="hljs-comment"><span class="hljs-comment">"click the Back to List hyperlink."</span></span>; } <span class="hljs-type"><span class="hljs-type">Department</span></span> department = db.<span class="hljs-type"><span class="hljs-type">Departments</span></span>.<span class="hljs-type"><span class="hljs-type">Find</span></span>(id); return <span class="hljs-type"><span class="hljs-type">View</span></span>(department); }</code> </pre><br>  The method accepts an optional parameter that determines whether the page needs to be reloaded after a parallel error.  If the parameter is set to true, the error message is sent to the view in the ViewBag property. <br><br>  Replace the code of the HttpPost Delete (DeleteConfirmed) method with: <br><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">HttpPost, ActionName(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Delete"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DeleteConfirmed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Department department</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { db.Entry(department).State = EntityState.Deleted; db.SaveChanges(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RedirectToAction(<span class="hljs-string"><span class="hljs-string">"Index"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (DbUpdateConcurrencyException) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RedirectToAction(<span class="hljs-string"><span class="hljs-string">"Delete"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System.Web.Routing.RouteValueDictionary { { <span class="hljs-string"><span class="hljs-string">"concurrencyError"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (DataException) { <span class="hljs-comment"><span class="hljs-comment">//Log the error (add a variable name after Exception) ModelState.AddModelError(string.Empty, "Unable to save changes. Try again, and if the problem persists contact your system administrator."); return View(department); } }</span></span></code> </pre><br>  Initially, the method accepted only the value of the record ID: <br><br><blockquote>  public ActionResult DeleteConfirmed (int id) <br></blockquote><br><br>  We changed this parameter to the Department entity, which gives us access to the Timestamp property. <br><br>  public ActionResult DeleteConfirmed (Department department) <br><br>  If a parallelism error is thrown, the code reloads the confirmation page with the error parameter set. <br><br>  In <i>Views</i> <i>\</i> <i>Department</i> <i>\</i> <i>Delete</i> <i>.</i>  <i>cshtml</i> replace the code with the code that provides the formatting and the field for the error message: <br><br><pre> <code class="html hljs xml">@model ContosoUniversity.Models.Department @{ ViewBag.Title = "Delete"; } <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span>Delete<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"error"</span></span></span><span class="hljs-tag">&gt;</span></span>@ViewBag.ConcurrencyErrorMessage<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span>Are you sure you want to delete this?<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fieldset</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">legend</span></span></span><span class="hljs-tag">&gt;</span></span>Department<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">legend</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display-label"</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.LabelFor(model =&gt; model.Name) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display-field"</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.DisplayFor(model =&gt; model.Name) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display-label"</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.LabelFor(model =&gt; model.Budget) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display-field"</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.DisplayFor(model =&gt; model.Budget) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display-label"</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.LabelFor(model =&gt; model.StartDate) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display-field"</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.DisplayFor(model =&gt; model.StartDate) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display-label"</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.LabelFor(model =&gt; model.InstructorID) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display-field"</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.DisplayFor(model =&gt; model.Administrator.FullName) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fieldset</span></span></span><span class="hljs-tag">&gt;</span></span> @using (Html.BeginForm()) { @Html.HiddenFor(model =&gt; model.DepartmentID) @Html.HiddenFor(model =&gt; model.Timestamp) <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Delete"</span></span></span><span class="hljs-tag"> /&gt;</span></span> | @Html.ActionLink("Back to List", "Index") <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> }</code> </pre><br>  This code adds an error message between the h2 and h3 headers: <br><br>  &lt;p class = "error"&gt; @ ViewBag.ConcurrencyErrorMessage &lt;/ p&gt; <br><br>  It replaces LastName with FullName in the Administrator field: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display-label"</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.LabelFor(model =&gt; model.InstructorID) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display-field"</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.DisplayFor(model =&gt; model.Administrator.FullName) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  And finally, hidden fields for DepartmentID and Timestamp are added: <br><br><pre> <code class="html hljs xml">@Html.HiddenFor(model =&gt; model.DepartmentID) @Html.HiddenFor(model =&gt; model.Timestamp)</code> </pre><br>  Open the Departments Index page in different browser windows. <br><br>  In the first window, click <b>Edit</b> and change one of the values, but do not click <b>Save</b> : <br><br><img title="clip_image003 [1]" alt="clip_image003[1]" src="https://habrastorage.org/getpro/habr/post_images/7a6/473/663/7a6473663756cbac68b8cbbc4527851b.png" width="347" height="450"><br><br>  In the second window, click Delete in the same department.  A confirmation window will appear. <br><br><img title="clip_image011" alt="clip_image011" src="https://habrastorage.org/getpro/habr/post_images/82f/827/d54/82f827d54b0c7ccb9d6e01b332f5f9eb.png" width="354" height="450"><br><br>  Click <b>Save</b> in the first browser window.  Changes are confirmed. <br><br><img title="clip_image012" alt="clip_image012" src="https://habrastorage.org/getpro/habr/post_images/0cd/fde/c6b/0cdfdec6b4242687a7ba2b060044eb39.png" width="550" height="449"><br><br>  Now click Delete in the second browser window to see the concurrency error message.  Data will be updated. <br><br><img title="clip_image013" alt="clip_image013" src="https://habrastorage.org/getpro/habr/post_images/2cb/05d/c2d/2cb05dc2d6ccffb2bb7ebfe5b25dc847.png" width="300" height="450"><br><br>  If you click Delete again, the Index page will open, confirming that the faculty record has been deleted. <br><br>  We have completed the entry into handling concurrent access conflicts.  For more information, see <a href="http://blogs.msdn.com/b/adonet/archive/2011/02/03/using-dbcontext-in-ef-feature-ctp5-part-9-optimistic-concurrency-patterns.aspx">Optimistic Concurrency Patterns</a> and <a href="http://blogs.msdn.com/b/adonet/archive/2011/01/30/using-dbcontext-in-ef-feature-ctp5-part-5-working-with-property-values.aspx">Working with Property Values</a> .  In the next lesson, we will show you how to implement inheritance for Instructor and Student entities. <br><br><h5>  Acknowledgments </h5><br>  Thanks for the help in the translation of Alexander Belotserkovsky. </div><p>Source: <a href="https://habr.com/ru/post/136328/">https://habr.com/ru/post/136328/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../136321/index.html">Biosensors, or the Sixth Sense</a></li>
<li><a href="../136322/index.html">Competition for developers of Windows Phone 7</a></li>
<li><a href="../136323/index.html">5 basic anti-patterns of system administration</a></li>
<li><a href="../136324/index.html">RAW vs DNG</a></li>
<li><a href="../136326/index.html">Talking machine from the old cell phone</a></li>
<li><a href="../136329/index.html">Organization of document circulation at the exchange of distant work</a></li>
<li><a href="../136330/index.html">I would go to U.M.N.IK. and ...</a></li>
<li><a href="../136331/index.html">Internet 2.0 Concepts</a></li>
<li><a href="../136333/index.html">Samsung's Smart Window</a></li>
<li><a href="../136334/index.html">How to improve the selection of countries from the list</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>