<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Apple Subscriptions Notifications for iOS Guide. Are they really good?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="So, you have an application with automatic renewable subscriptions. It works great, users unrestrainedly make out premium subscriptions and write laud...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Apple Subscriptions Notifications for iOS Guide. Are they really good?</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/getpro/habr/post_images/fa5/f52/a07/fa5f52a07612fe9b040dad35421024ec.jpg"></p><br><p>  So, you have an application with automatic renewable subscriptions.  It works great, users unrestrainedly make out premium subscriptions and write laudatory reviews.  Beauty! </p><br><p>  Hello everyone, my name is Denis, I am the project manager for Apphud, an analytics service for auto-renewable subscriptions for iOS apps. </p><br><p>  As a project manager, you need to be aware of key product metrics.  One of the most important is Life time value (LTV) - the average income per user for the entire time of using the application.  But how to calculate it in the case of auto-renewable subscriptions for iOS?  How to track the time of the renewal, cancellation, renewal of the subscription by the user? <a name="habracut"></a></p><br><p>  Until recently (namely, until 2017), the only way to do this was the so-called Subscriptions Status Polling.  At any time you can get information about the status of a subscription by sending the desired receipt (receipt) to the URL: <a href="https://buy.itunes.apple.com/verifyReceipt">https://buy.itunes.apple.com/verifyReceipt</a> .  After receiving it, you can view basic information about the subscription, including the end date.  True, its value, you still do not get it. </p><br><p>  To implement Status Polling, you must: </p><br><ol><li>  send and store on the server all the checks for all subscriptions of each user, </li><li>  implement a complex server logic, which will be used to <strong>regularly</strong> check these checks. </li></ol><br><p>  It's complicated.  But in 2017, Apple seemed to solve this problem.  At WWDC, under the applause of the audience, they represent Apple Subscriptions Status Update Notifications. </p><br><h2 id="chto-takoe-subscriptions-notifications">  What are Subscriptions Notifications? </h2><br><p>  Apple Subscriptions Status Update Notifications is a mechanism for sending webhook-s to your Apple server when events related to auto-renewable subscriptions occur.  To enable them, you must first configure your server to accept them: the server must support the App Transport Security protocol (usually everything works by default).  After that, you need to go to <a href="https://appstoreconnect.apple.com/">App Store Connect</a> and in the ‚ÄúApp Store‚Äù section of the settings of your application insert a link by which Apple will send a POST request every time an event occurs: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/011/e97/844/011e97844357cc016a2a8258bacfd354.png" alt="Configuring Apple Subscriptions Status Update Notifications"></p><br><blockquote>  Note that Apple recommends using Subscriptions Notifications along with Status Polling.  Bad sign ... </blockquote><p>  Done!  Now you should receive notifications whenever, for example, you subscribe, renew, or cancel a subscription. </p><br><h2 id="raznovidnosti-uvedomleniy">  Kinds of notifications </h2><br><p>  Apple sends 6 types of notifications occurring at various events.  Let us examine each of them. </p><br><h3 id="initial_buy">  INITIAL_BUY </h3><br><p>  Apple sends this notification when a user first subscribes to a <strong>group of subscriptions</strong> . </p><br><blockquote>  You can read more about subscription groups in our <a href="https://habr.com/ru/post/453442/">article</a> . </blockquote><p><img src="https://habrastorage.org/getpro/habr/post_images/bce/b16/6de/bceb166ded34b6e3efe67b0fbd22ae01.png" alt="INITIAL_BUY event"></p><br><h3 id="cancel">  CANCEL </h3><br><p>  This event is dispatched when a user cancels a subscription through Apple Care support and returns money for the purchase.  We emphasize that this is <strong>not</strong> about the usual cancellation of a subscription through iOS settings. </p><br><blockquote> The <code>CANCEL</code> event is not sent during a normal subscription cancellation via iOS settings. </blockquote><p><img src="https://habrastorage.org/getpro/habr/post_images/52c/692/9ce/52c6929ced9ea6d4d887581722f5612a.png" alt="CANCEL event"></p><br><h3 id="did_change_renewal_status">  DID_CHANGE_RENEWAL_STATUS </h3><br><p>  This event has been added recently.  It is sent when the user disconnects or (re-enables) the renewal of the subscription through the iOS settings, the App Store application or Apple support: </p><br><blockquote>  Do not confuse this event with the <code>CANCEL</code> event, which is triggered when a subscription is canceled and funds are returned via Apple Care support. </blockquote><p><img src="https://habrastorage.org/getpro/habr/post_images/987/be2/829/987be28296f3367163ff3af07a4fb29a.png" alt="Event DID_CHANGE_RENEWAL_STATUS"></p><br><h3 id="renewal">  RENEWAL </h3><br><p>  The first thing that comes to mind when you see the name of this event: Apple sends it when the subscription automatically renews.  No matter how wrong! </p><br><p>  The <code>RENEWAL</code> event <code>RENEWAL</code> dispatched when: </p><br><ol><li><p>  the user's subscription was automatically canceled <strong>due to problems with the user's bank card ...</strong> </p><br></li><li><p>  and after that the user renewed the subscription.  This is <code>RENEWAL</code> event is <code>RENEWAL</code> . </p><br></li></ol><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e56/ed6/4e9/e56ed64e9a4f804a69c32b15df6e614f.jpg"></p><br><blockquote>  The RENEWAL <code>RENEWAL</code> <strong>not dispatched</strong> in the case of a regular renewal of a subscription.  Instead, Apple offers to check the subscription check via <code>/VerifyReceipt</code> before and after the expected renewal and analyze the resulting value of <code>expiration_date</code> </blockquote><p><img src="https://habrastorage.org/getpro/habr/post_images/2d9/e2d/544/2d9e2d5440a690903f0182b5c08cc9a4.png" alt="RENEWAL event"></p><br><h3 id="interactive_renewal">  INTERACTIVE_RENEWAL </h3><br><p>  This event is dispatched if: </p><br><ol><li><p>  The user canceled the subscription and <strong>some time after that ...</strong> </p><br></li><li><p>  User renewed subscription.  It is at this point that <code>INTERACTIVE_RENEWAL</code> sent. </p><br><blockquote>  A new subscription (which is listed in clause 2) may differ from the subscription from clause 1, but they both must belong to the same shopping group.  For example, a user may cancel a subscription to the Bronze tariff plan and after a while resume the subscription by selecting the Gold plan.  In this case, Apple will send the <code>INTERACTIVE_RENEWAL</code> event to your server (provided that the Bronze and Gold subscriptions belong to the same shopping group).  You can read more about subscription groups <a href="https://habr.com/ru/post/453442/">here</a> . </blockquote><br></li></ol><br><p><img src="https://habrastorage.org/getpro/habr/post_images/7b0/d77/fe3/7b0d77fe3921cf4bf9c4d9b4a04bec03.png" alt="Event INTERACTIVE_RENEWAL"></p><br><h3 id="did_change_renewal_pref">  DID_CHANGE_RENEWAL_PREF </h3><br><p>  <code>DID_CHANGE_RENEWAL_PREF</code> sent when a user goes from one subscription to another within the same shopping group: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ab1/8d5/359/ab18d53594ec3b04615f38598aa0c787.png" alt="Event DID_CHANGE_RENEWAL_PREF"></p><br><h3 id="chto-v-itoge">  What is the result? </h3><br><p>  Apple offers as many as 6 events, but none of them are sent when the subscription is automatically renewed normally.  Why did they do that?  It is not clear.  Additionally, the names of these events are misleading. </p><br><p>  The table below summarizes the events. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/3ba/c0f/fc1/3bac0ffc178eaad092d199d6dd0e8d19.png"></p><br><h2 id="kak-ispolzovat-apple-subscriptions-notifications">  How to use Apple Subscriptions Notifications? </h2><br><p>  Due to the fact that the most important event that is needed for calculating LTV - subscription renewal in the normal mode - is not sent, you still have to use Status Polling.  There is a possibility that Apple will add this event in the near future, but even if this happens, you will not be able to do without your own server.  This server will act as an ‚Äúinterlayer‚Äù between Apple and another analytics system (for example, Amplitude, Flurry or Mixpanel).  By receiving events and checking checks, you will send information about renewals, cancellations and returns. </p><br><blockquote><h1 id="odnazhdy-my-stolknulis-s-etoy-problemoy-i-reshili-razrabotat-servis-kotoryy-by-reshil-eti-problemy-tak-rodilas-ideya-servisa-nad-kotorym-my-seychas-rabotaem--servisa-analitiki-podpisok-dlya-ios-kotoryy-zapolnyaet-bresh-v-otpravke-sobytiy-so-storony-apple">  Once we ran into this problem and decided to develop a service that would solve these problems.  This is how the idea of ‚Äã‚Äãthe service we are working on was born - the subscription analytics service for iOS, which fills the gap in sending events from Apple. </h1><br></blockquote><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  Apple Subscriptions Notifications are not as good as they seem, because it is not possible to solve the main task only with the help of them: find out how much money one user brings to you.  Perhaps Apple will make life easier for developers in the future, but one thing is for sure: the current implementation of Subscriptions Notifications is not very obvious and looks like crutches. </p><br><h2 id="chto-pochitat">  What to read? </h2><br><ul><li>  <a href="https://habr.com/ru/post/453442/">7 things to know about auto-renewable subscriptions</a> </li><li>  <a href="https://habr.com/ru/post/453514/">Introductory Offers Guide for iOS</a> </li><li>  <a href="https://developer.apple.com/documentation/storekit/in-app_purchase/enabling_status_update_notifications">Apple Status Update Notifications Guide</a> </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/453770/">https://habr.com/ru/post/453770/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../453760/index.html">Training camp on circuit design for tanks and bookmarks to processors</a></li>
<li><a href="../453764/index.html">Voluntary amnesia: manipulation of the hippocampus to remove painful memories</a></li>
<li><a href="../453766/index.html">Software Defined Radio - how does it work? Part 6</a></li>
<li><a href="../453768/index.html">Overview of SMS Mailing Services: Popular Services</a></li>
<li><a href="../45377/index.html">Routes. The beginning</a></li>
<li><a href="../453772/index.html">Project Athena - Reinventing a Laptop</a></li>
<li><a href="../453776/index.html">We pump over designers in the company: from junior to art director</a></li>
<li><a href="../453778/index.html">How we created an online bank for business. Part One: Rebranding</a></li>
<li><a href="../45378/index.html">Pre-project documentation: what is it and why is it so important?</a></li>
<li><a href="../453780/index.html">How to choose a Grandstream SIP phone - in general and in particular?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>