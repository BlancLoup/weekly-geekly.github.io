<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Add disk space for a Linux ‚Äì server in the Azure Pack Infrastructure cloud, and at the same time, we are working with LVM</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article will look at the process of increasing disk space on a Linux ‚Äì server in the Azure Pack Infrastructure cloud from InfoboxCloud . This is ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Add disk space for a Linux ‚Äì server in the Azure Pack Infrastructure cloud, and at the same time, we are working with LVM</h1><div class="post__text post__text-html js-mediator-article">  This article will look at the process of increasing disk space on a Linux ‚Äì server in the <a href="https://infoboxcloud.ru/services/azurepack/">Azure Pack Infrastructure</a> cloud from <a href="https://infoboxcloud.ru/">InfoboxCloud</a> .  This is a standard procedure performed using LVM, which is in any Linux ‚Äì image in our cloud. <br><br>  This instruction is useful not only to increase the size of a single disk, but also to create a common space of connected virtual disks, which allows you to overcome the maximum size of a virtual disk (for a VHD - 2048 GB) and create a single large space for data. <br><br><div style="text-align:center;"><img src="https://infoboxcloud.ru/community/uploads/images/00/00/01/2016/10/16/d24769.png" width="600"></div><br>  If you do not want to understand this, just email us a ticket to technical support and we will do everything for you. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  <b>What is LVM?</b> </h4><br>  LVM is a logical disk management system for Linux, a high-level view of the storage subsystem on a server (higher than disks and partitions).  This technology gives system administrators the flexibility to allocate disk space for applications and users, including the ability to resize a logical volume. <br><a name="habracut"></a><br>  When Linux is installed on the server - one of the tasks of choice is how to partition the disk.  With LVM, the disk is included in the volume group (volume group) and logical volumes are created for example for the root of the disk /.  In the future, you can change the size of logical volumes. <br><br><h4>  <b>LVM device</b> </h4><br>  By itself, the high-level abstraction of LVM includes logical volumes (LV) and physical volumes (PV). <br><br>  <strong>Physical volume (PV, physical volume)</strong> - a virtual disk of the server or a regular hard disk (or it can be a RAID). <br><br>  <strong>A logical volume (LV, logical volume)</strong> is the equivalent of a partition.  It is represented by the OS as a standard block device and may contain a file system. <br><br>  <strong>A volume group (VG, volume group)</strong> is a logical union of volumes. <br><br>  <strong>Physical block (PE, physical extent)</strong> - pieces of data on a physical volume, within a volume group have an identical <strong>logical block</strong> size <strong>(LE, logical extent)</strong> , the size of which, in turn, is constant within the volume group. <br><br><div style="text-align:center;"><img src="https://infoboxcloud.ru/community/uploads/images/00/00/01/2016/10/16/4f7e06.png" width="400"></div><br>  <em>View LVM view with physical and logical volumes.</em> <br><br><div style="text-align:center;"><img src="https://infoboxcloud.ru/community/uploads/images/00/00/01/2016/10/16/356bea.png" width="400"></div><br>  <em>A view of LVM with physical and logical blocks, which is the same for the entire volume group.</em> <br><br>  Example: Let's imagine that we have a volume group VG1 and it has a physical block size of 4 MB.  Within the volume group 2 are hard disks / dev / hda1 and / dev / hdb1.  These disks will become physical partitions PV1 and PV2.  Since the physical block size is 4 mb - the same size will be logical blocks.  The disks have a different size and the first includes 99 blocks, and the second 248 blocks.  Now we will create a logical volume.  It can be any size between 1 and 347 blocks (248 + 99 blocks).  When a logical volume is created, a connection is established between the logical and physical blocks, for example, logical block 1 can be connected to physical block 51 of PV1, and the data written to the first 4 megabytes of the logical volume will actually be written to 51y block PV1. <br><br>  There are 2 types of communication between physical and logical blocks: <br><br><ul><li>  <strong>Linear mapping</strong> ‚Äî when multiple physical blocks will be consistently linked to multiple logical blocks, for example, LE1-99 will be connected to PV1, and LE 100‚Äì347 will be connected to PV2. </li><li>  <strong>interleaved mapping</strong> - when each next logical block will use the next disk, which in physical systems can increase performance, but in the cloud does not make sense, since virtual disks are created in the storage system, which already uses multiple disks in parallel to increase performance at the hardware level. </li></ul><br><h5>  <b>Nepshots LVM</b> </h5><br>  LVM snapshots allow an administrator to create a new block device that stores a copy of a logical volume frozen at a specific point in time.  This feature can be used for batch processing, creating backups or experiments where you do not want to hurt live data on the system. <br><br>  In LVM2, used in modern versions of Linux, snapshots are available for reading and writing by default.  When creating a snapshot, an exception table is created, which is used to save information about which block has been changed.  If a block is changed on the source volume from which the snapshot was created, it is first copied to the snapshot, marked as copied in the exception table, then the new data is written to the original volume.  If data is written to a snapshot, the block is marked as used in the exception table and never copied from the source volume. <br><br><h4>  <b>Increasing the Linux server partition</b> </h4><br><h5>  <b>Creating a server for testing</b> </h5><br>  If you do not have access to the Azure Pack Infrastructure, fill out an application for a free trial version on the main page <a href="https://infoboxcloud.ru/">https://infoboxcloud.ru</a> . <br><br>  Create a network with Internet access, a server with Linux (for example, with Ubuntu 16.04) and forward its port 22 to an external ip, as shown in <a href="https://infoboxcloud.ru/community/blog/azurepack/397.html">this article</a> .  Connect to the server <a href="https://infoboxcloud.ru/community/blog/linuxvps/304.html">via SSH</a> . <br><br>  On all servers with Linux in the Azure Pack Infrastructure is already pre-installed LVM. <br><br><h5>  <b>Creating a checkpoint</b> </h5><br>  Before increasing the disk volume, creating a control point is highly recommended.  If something goes wrong, you can restore the server to this state.  If there is not enough space in your subscription, email us a ticket in <a href="https://support.infobox.ru/">the service control panel</a> &gt; Support Center&gt; Write a ticket. <br><br>  Click on the name of your server and go to the ‚ÄúCheckpoints‚Äù section. <br><br><div style="text-align:center;"><img src="https://infoboxcloud.ru/community/uploads/images/00/00/01/2016/10/22/cde235.png" width="800"></div><br>  Click the Create button to create a control point. <br><br><div style="text-align:center;"><img src="https://infoboxcloud.ru/community/uploads/images/00/00/01/2016/10/22/c7546b.png" width="600"></div><br>  Specify the name of the control point and, if necessary, the description and click the tick ‚ÄúDone‚Äù.  A checkpoint will be created.  Now you can perform further operations safely. <br><br><h5>  <b>Increasing disk partition in Azure Pack Infrastructure control panel</b> </h5><br>  Log in to <a href="https://portal.infoboxcloud.com/">the control panel</a> , select your server on which you want to increase the partition and click the Stop button.  Wait for the server to stop. <br><br><div style="text-align:center;"><img src="https://infoboxcloud.ru/community/uploads/images/00/00/01/2016/10/22/5864c7.png" width="800"></div><br>  Now click on the server name and go to the "Configure" section.  Click on the name of the disk you want to enlarge. <br><br><div style="text-align:center;"><img src="https://infoboxcloud.ru/community/uploads/images/00/00/01/2016/10/22/4eeaf6.png" width="800"></div><br>  The "Expand" button will appear - click it. <br><br><div style="text-align:center;"><img src="https://infoboxcloud.ru/community/uploads/images/00/00/01/2016/10/22/f4e9cd.png" width="600"></div><br>  Specify the desired disk size (only zoom is available) and click the "Finish" checkbox.  The size of the virtual disk will be increased.  However, this is not enough - it is necessary to increase the LV partition on the virtual machine, read about it below. <br><br><h5>  <b>Create a new physical partition on disk (PV)</b> </h5><br>  First, on the appeared free space, you need to create a new physical partition (PV), which can then be connected to LVM.  To do this, you can use the command: <br><br><pre><code class="bash hljs">cfdisk</code> </pre> <br><div style="text-align:center;"><img src="https://infoboxcloud.ru/community/uploads/images/00/00/01/2016/10/22/895ece.png" width="800"></div><br>  Select the free disk space (Free Space, marked in green) using the arrows on the keyboard and then press Enter, which will launch the <strong>New</strong> command. <br><br><div style="text-align:center;"><img src="https://infoboxcloud.ru/community/uploads/images/00/00/01/2016/10/22/cefc97.png" width="800"></div><br>  The size of the partition being created will be requested.  By default - the maximum, for all added space, just press Enter. <br><br><div style="text-align:center;"><img src="https://infoboxcloud.ru/community/uploads/images/00/00/01/2016/10/22/1d9147.png" width="800"></div><br>  Now the arrows on the keyboard with the new section marked, select <strong>Type</strong> . <br><br><div style="text-align:center;"><img src="https://infoboxcloud.ru/community/uploads/images/00/00/01/2016/10/22/5e38fc.png" width="800"></div><br>  Press Enter to select the partition type. <br><br><div style="text-align:center;"><img src="https://infoboxcloud.ru/community/uploads/images/00/00/01/2016/10/22/7bd051.png" width="400"></div><br>  Select type <strong>8e Linux LVM</strong> and press Enter. <br><br>  Now select the item Write and press Enter to save the changes to the disk. <br><br><div style="text-align:center;"><img src="https://infoboxcloud.ru/community/uploads/images/00/00/01/2016/10/22/f5b0d1.png" width="800"></div><br>  Permission to apply changes will be requested.  Type <strong>yes</strong> and press Enter. <br><br><div style="text-align:center;"><img src="https://infoboxcloud.ru/community/uploads/images/00/00/01/2016/10/22/1433a9.png" width="800"></div><br>  A message will appear indicating that the partition table has changed successfully. <br><br><div style="text-align:center;"><img src="https://infoboxcloud.ru/community/uploads/images/00/00/01/2016/10/22/7c709c.png" width="800"></div><br>  Remember the device path, in this case <strong>/ dev / sda3</strong> .  The device path will be required later when adding a partition to the volume group (VG). <br><br>  To exit the partitioning program, select <strong>Quit</strong> and press Enter. <br><br><img src="https://infoboxcloud.ru/community/uploads/images/00/00/01/2016/10/22/85f0d3.png" width="800"><br><br>  Reboot the server with the command: <br><br><pre> <code class="bash hljs">reboot</code> </pre> <br>  and connect to it over ssh again. <br><br><h5>  <b>Add the created physical partition to the volume group (VG)</b> </h5><br>  To find out the name of the created volume group, use the command: <br><br><pre> <code class="bash hljs">vgdisplay</code> </pre> <br><div style="text-align:center;"><img src="https://infoboxcloud.ru/community/uploads/images/00/00/01/2016/10/22/d4f6bc.png" width="600"></div><br><br>  where in the VG name parameter will be the name of the volume group, in this case - <strong>ubuntu-vg</strong> . <br><br>  To add a physical partition to a volume group, use the command: <br><br><pre> <code class="bash hljs">vgextend ubuntu-vg /dev/sda3</code> </pre> <br>  where ubuntu-vg is the name of the volume group, and / dev / sda3 is the path to the device to the new partition. <br><br><img src="https://infoboxcloud.ru/community/uploads/images/00/00/01/2016/10/22/eb081b.png" width="600"><br><br>  Using the command: <br><br><pre> <code class="bash hljs">pvdisplay</code> </pre> <br>  You can see the list of disks connected to the volume group. <br><br><div style="text-align:center;"><img src="https://infoboxcloud.ru/community/uploads/images/00/00/01/2016/10/22/f83126.png" width="600"></div><br><h5>  <b>Increase the size of the logical partition LVM root and file system partition to the maximum available</b> </h5><br>  Using the command <br><br><pre> <code class="bash hljs">lvdisplay</code> </pre> <br>  You can see the list of LVM logical partitions. <br><br><div style="text-align:center;"><img src="https://infoboxcloud.ru/community/uploads/images/00/00/01/2016/10/22/512453.png" width="600"></div><br>  We see that 2 partitions are created: / dev / ubuntu-vg / swap_1 and <strong>/ dev / ubuntu-vg / root</strong> .  Using the command: <br><br><pre> <code class="bash hljs">vgdisplay</code> </pre> <br>  We see the parameters of the volume group. <br><br><div style="text-align:center;"><img src="https://infoboxcloud.ru/community/uploads/images/00/00/01/2016/10/22/151c92.jpg" width="600"></div><br>  We see that now available space for the expansion of volumes LVM (Free PE / Size) in the amount of 75 GB. <br><br>  We need to increase the partition <strong>/ dev / ubuntu-vg / root</strong> to the maximum available, and at the same time increase the size of the file system. <br><br>  To do this, run the command: <br><br><pre> <code class="bash hljs">lvextend -r -l +100%FREE /dev/ubuntu-vg/root</code> </pre> <br><div style="text-align:center;"><img src="https://infoboxcloud.ru/community/uploads/images/00/00/01/2016/10/23/5ef5dc.jpg" width="800"></div><br>  Now run the command: <br><br><pre> <code class="bash hljs">df -h</code> </pre> <br>  in order to see the new size of the system partition. <br><br><div style="text-align:center;"><img src="https://infoboxcloud.ru/community/uploads/images/00/00/01/2016/10/22/278ca9.jpg" width="800"></div><br>  <strong>We successfully added disk space for the Linux ‚Äì server in the Azure Pack Infrastructure cloud, and at the same time we learned how to use LVM.</strong> <br><br>  If you have any questions about using Azure Pack Infrastructure, we will be happy to help and advise!  You can email us through your account <a href="https://support.infobox.ru/">https://support.infobox.ru</a> &gt; Support Center&gt; Write a ticket. <br><br>  If you can not leave comments on Habr√©, write to us in the <a href="https://infoboxcloud.ru/community/blog/azurepack/395.html">InfoboxCloud Community</a> . <br><br>  Successful work! </div><p>Source: <a href="https://habr.com/ru/post/313356/">https://habr.com/ru/post/313356/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../313340/index.html">Thematic modeling on the way to exploratory information search. Lecture in Yandex</a></li>
<li><a href="../313342/index.html">MikroTik. Correct dst nat when using 2 or more providers</a></li>
<li><a href="../313344/index.html">How to order and promote a mobile application: digest of useful materials</a></li>
<li><a href="../313346/index.html">Diary of a bug: how I repaired pictures in e-mail</a></li>
<li><a href="../313350/index.html">Lambda and anonymous classes: who eats more</a></li>
<li><a href="../313364/index.html">Experience in building and operating large file storage</a></li>
<li><a href="../313366/index.html">Sharding - patterns and antipatterns</a></li>
<li><a href="../313370/index.html">Elements of functional programming in C ++: partial application</a></li>
<li><a href="../313372/index.html">Elections 2016. Part 2 is amazing nearby and it is allowed</a></li>
<li><a href="../313374/index.html">JavaScript: includes vs indexOf</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>