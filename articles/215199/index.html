<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Side effect: check CryEngine 3 SDK with PVS-Studio</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We have finished comparing static code analyzers Cppcheck, PVS-Studio and the analyzer built in Visual Studio 2013. During this, more than 10 open sou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Side effect: check CryEngine 3 SDK with PVS-Studio</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/25f/98c/a02/25f98ca02335bbee0bb9693cade8bd9f.png" align="left"><br>  We have finished comparing static code analyzers Cppcheck, PVS-Studio and the analyzer built in Visual Studio 2013. During this, more than 10 open source projects were tested.  And about some of them you can write articles.  Here is another such article about the results of the verification of the CryEngine 3 SDK project. <br><a name="habracut"></a><br><h2>  CryEngine 3 SDK </h2><br>  Wikipedia: <a href="http://www.viva64.com/go.php%3Furl%3D1355">CryEngine 3 SDK</a> is a set of software tools for developing computer games on the CryEngine 3 game engine. The CryEngine 3 SDK, like CryEngine 3, is developed and maintained by the German company Crytek.  CryEngine 3 SDK is a proprietary freeware for downloading, installing, and using a development tool with which anyone can develop computer games and distribute them for free.  For commercial distribution (sales) of games developed on the CryEngine 3 SDK, it is necessary to make license deductions in Crytek. <br><br><h2>  PVS-Studio </h2><br>  Let's see what interesting can be found in this library with the help of the <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> analyzer. <br><br>  Yes, PVS-Studio finds a bit more if you enable level 3 warnings.  However, I cannot call it serious defects.  Example: <br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetNameForFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* baseFileName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> uint32 fileIdx, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> outputName[</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">512</span></span></span></span><span class="hljs-function"><span class="hljs-params">] )</span></span></span><span class="hljs-function"> </span></span>{ assert(baseFileName != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>( outputName, <span class="hljs-string"><span class="hljs-string">"%s_%d"</span></span>, baseFileName, fileIdx ); }</code> </pre> <br>  V576 Incorrect format.  Consider checking the fourth argument of the 'sprintf' function.  The SIGNED integer type argument is expected.  igame.h 66 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Formally, to print the unsigned variable 'fileIdx', you must use "% u".  However, it is doubtful that this variable will reach values ‚Äã‚Äãgreater than INT_MAX.  So actually the error does not manifest itself. <br><br><h2>  Test results </h2><br>  Brief result - you need to use static code analyzers.  And then the errors in the program will be less and I will not write about what articles. <br><br><h3>  Double check </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CVehicleMovementArcadeWheeled::InternalPhysicsTick(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span> dt) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fabsf(m_movementAction.rotateYaw)&gt;<span class="hljs-number"><span class="hljs-number">0.05f</span></span> || vel.GetLengthSquared()&gt;<span class="hljs-number"><span class="hljs-number">0.001f</span></span> || m_chassis.vel.GetLengthSquared()&gt;<span class="hljs-number"><span class="hljs-number">0.001f</span></span> || angVel.GetLengthSquared()&gt;<span class="hljs-number"><span class="hljs-number">0.001f</span></span> || angVel.GetLengthSquared()&gt;<span class="hljs-number"><span class="hljs-number">0.001f</span></span>) .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0090/">V501</a> There are identical sub-expressions 'angVel. GetLengthSquared ()&gt; 0.001f'  operator.  vehiclemovementarcadewheeled.cpp 3300 <br><br>  The check ‚ÄúangVel.GetLengthSquared ()&gt; 0.001f‚Äù is performed twice.  One check is superfluous.  Or is it a typo, for which another value is not checked. <br><br><h3>  The same action under different conditions. </h3><br>  <b>Fragment N1.</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CVicinityDependentObjectMover::HandleEvent(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(szEventName, <span class="hljs-string"><span class="hljs-string">"ForceToTargetPos"</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span> ) { SetState(eObjectRangeMoverState_MovingTo); SetState(eObjectRangeMoverState_Moved); ActivateOutputPortBool( <span class="hljs-string"><span class="hljs-string">"OnForceToTargetPos"</span></span> ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(szEventName, <span class="hljs-string"><span class="hljs-string">"ForceToTargetPos"</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span> ) { SetState(eObjectRangeMoverState_MovingTo); SetState(eObjectRangeMoverState_Moved); ActivateOutputPortBool( <span class="hljs-string"><span class="hljs-string">"OnForceToTargetPos"</span></span> ); } .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0106/">V517</a> The use of if (A) {...} else if (A) {...} 'pattern was detected.  There is a possibility of logical error presence.  Check lines: 255, 261. Locationsdependentobjectmover.cpp 255 <br><br>  It seems to me that this code was written using Copy-Paste.  And it seems to me that in this code, after copying, they forgot to fix something. <br><br>  <b>Fragment N2.</b>  The ShouldGiveLocalPlayerHitableFeedbackOnCrosshairHoverForEntityClass () function is implemented in a very strange way.  That's what I understand NAME! <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> CGameRules:: ShouldGiveLocalPlayerHitableFeedbackOnCrosshairHoverForEntityClass (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> IEntityClass* pEntityClass) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { assert(pEntityClass != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(gEnv-&gt;bMultiplayer) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (pEntityClass == s_pSmartMineClass) || (pEntityClass == s_pTurretClass) || (pEntityClass == s_pC4Explosive); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (pEntityClass == s_pSmartMineClass) || (pEntityClass == s_pTurretClass) || (pEntityClass == s_pC4Explosive); } }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0112/">V523</a> The 'then' statement is equivalent to the 'else' statement.  gamerules.cpp 5401 <br><br>  <b>Similar extremely suspicious places:</b> <ul><li>  environmentalweapon.cpp 964 </li><li>  persistantstats.cpp 610 </li><li>  persistantstats.cpp 714 </li><li>  recordingsystem.cpp 8924 </li><li>  movementtransitions.cpp 610 </li><li>  gamerulescombicaptureobjective.cpp 1692 </li><li>  vehiclemovementhelicopter.cpp 588 </li></ul><br><h3>  Uninitialized cell array </h3><br><pre> <code class="cpp hljs">TDestructionEventId destructionEvents[<span class="hljs-number"><span class="hljs-number">2</span></span>]; SDestructibleBodyPart() : hashId(<span class="hljs-number"><span class="hljs-number">0</span></span>) , healthRatio(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>) , minHealthToDestroyOnDeathRatio(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>) { destructionEvents[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-number"><span class="hljs-number">-1</span></span>; destructionEvents[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-number"><span class="hljs-number">-1</span></span>; }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0108/">V519</a> The 'destructionEvents [0]' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 75, 76. bodydestruction.h 76 <br><br>  The array 'destructionEvents' consists of two elements.  In the constructor, we wanted to initialize the array.  But it did not work out. <br><br><h3>  Not there put the bracket </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShouldRecordEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> eventID, IActor* pActor=</span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">NULL</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CActorTelemetry::SubscribeToWeapon(EntityId weaponId) { .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(pMgr-&gt;ShouldRecordEvent(eSE_Weapon), pOwnerRaw) .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0257/">V639</a> Consider inspecting the expression for 'ShouldRecordEvent' function call.  It is possible that one of the closing ')' brackets was positioned incorrectly.  actortelemetry.cpp 288 <br><br>  A rare and interesting mistake.  Not there is a closing bracket. <br><br>  The fact is that the second argument of the function ShouldRecordEvent () is optional.  It turns out that in the beginning the function ShouldRecordEvent () is called.  Then, the comma operator ',' returns the value that is on the right.  The condition depends only on the variable 'pOwnerRaw'. <br><br>  In general, damn what happened. <br><br><h3>  Forgot to write the name of the function </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> pMessage = (<span class="hljs-string"><span class="hljs-string">"%s:"</span></span>, currentSeat-&gt;GetSeatName()); .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0110/">V521</a> Such expressions using the ',' operator are dangerous.  Make sure the expression '"% s:", currentSeat-&gt; GetSeatName ()' is correct.  flowvehiclenodes.cpp 662 <br><br>  In this expression, the variable pMessage is assigned the value currentSeat-&gt; GetSeatName ().  No formatting happens.  As a result, the string will be missing a colon ':'.  Though a trifle, but an error. <br><br>  It should have been: <br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">string</span></span> pMessage = <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>().Format(<span class="hljs-string"><span class="hljs-string">"%s:"</span></span>, currentSeat-&gt;GetSeatName());</code> </pre> <br><h3>  Senseless and merciless checks </h3><br>  <b>Fragment N1.</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> != (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SEfResTexture &amp;m) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (stricmp(m_Name.c_str(), m_Name.c_str()) != <span class="hljs-number"><span class="hljs-number">0</span></span> || m_TexFlags != m.m_TexFlags || m_bUTile != m.m_bUTile || m_bVTile != m.m_bVTile || m_Filter != m.m_Filter || m_Ext != m.m_Ext || m_Sampler != m.m_Sampler) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0139/">V549</a> The first argument of the "stricmp" function is equal to the second argument.  ishader.h 2089 <br><br>  If you have not noticed an error, then I prompt.  The string m_Name.c_str () is compared to itself.  It should be written: <br><pre> <code class="cpp hljs">stricmp(m_Name.c_str(), m.m_Name.c_str())</code> </pre> <br>  <b>Fragment N2.</b>  Now the logical error: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">SearchSpotStatus </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetStatus</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_status; } SearchSpot* SearchGroup::FindBestSearchSpot(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(searchSpot.GetStatus() != Unreachable || searchSpot.GetStatus() != BeingSearchedRightAboutNow) .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0137/">V547</a> Expression is always true.  Probably the '&amp;&amp;' operator should be used here.  searchmodule.cpp 469 <br><br>  Check in this code does not make sense.  I will give an analogy: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (A != <span class="hljs-number"><span class="hljs-number">1</span></span> || A != <span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre> <br>  The condition is always satisfied. <br><br>  <b>Fragment N3.</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> CCircularBufferTimeline * CCircularBufferStatsContainer::GetTimeline( <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> inTimelineId) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inTimelineId &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)inTimelineId &lt; m_numTimelines) { tl = &amp;m_timelines[inTimelineId]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { CryWarning(VALIDATOR_MODULE_GAME,VALIDATOR_ERROR, <span class="hljs-string"><span class="hljs-string">"Statistics event %"</span></span> PRISIZE_T <span class="hljs-string"><span class="hljs-string">" is larger than the max registered of %"</span></span> PRISIZE_T <span class="hljs-string"><span class="hljs-string">", event ignored"</span></span>, inTimelineId,m_numTimelines); } .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0137/">V547</a> Expression 'inTimelineId&gt; = 0' is always true.  Unsigned type value is always&gt; = 0. circularstatsstorage.cpp 31 <br><br>  <b>Fragment N4.</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> CryStringT&lt;T&gt;::size_type CryStringT&lt;T&gt;::rfind( value_type ch,size_type pos ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { const_str str; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pos == npos) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pos == npos) pos = length(); .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0169/">V571</a> Recurring check.  The 'if (pos == npos)' condition was already verified in line 1447. crystring.h 1453 <br><br>  The assignment ‚Äúpos = length ()‚Äù will never be executed. <br><br>  <b>Similar code here:</b> cryfixedstring.h 1297 <br><br><h2>  Pointers </h2><br>  Programmers love to check for a pointer to equality to zero.  Now, if they still knew how often they did it wrong.  Check when it's too late. <br><br>  I will give one example, the rest will list. <br><pre> <code class="cpp hljs">IScriptTable *p; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( IScriptSystem *pSS, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bCreateEmpty=</span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p) p-&gt;Release(); p = pSS-&gt;CreateTable(bCreateEmpty); p-&gt;AddRef(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (p)?<span class="hljs-literal"><span class="hljs-literal">true</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0205/">V595</a> The 'p' pointer was used against it.  Check lines: 325, 326. scripthelpers.h 325 <br><br>  <b>Promised list of 35 messages:</b> <a href="http://www.viva64.com/external-pictures/txt/CryEngineSDK-595.txt">CryEngineSDK-595.txt</a> <br><br><h3>  Undefined behavior </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddSample</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( T x )</span></span></span><span class="hljs-function"> </span></span>{ m_index = ++m_index % N; .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0162/">V567</a> Undefined behavior.  The m_index variable  inetwork.h 2303 <br><br><h3>  One-time cycles </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CWeapon::AccessoriesChanged(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> initialLoadoutSetup) { .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; numZoommodes; i++) { CIronSight* pZoomMode = .... <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SZoomModeParams* pCurrentParams = .... <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SZoomModeParams* pNewParams = .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(pNewParams != pCurrentParams) { pZoomMode-&gt;ResetSharedParams(pNewParams); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0228/">V612</a> An unconditional 'break' within a loop.  weapon.cpp 2854 <br><br>  The body of the loop will perform only once.  The reason is the unconditional 'break' operator.  At the same time, there is no 'continue' operator in the loop. <br><br>  <b>There are several more such suspicious cycles</b> : <ul><li>  gunturret.cpp 1647 </li><li>  vehiclemovementbase.cpp 2362 </li><li>  vehiclemovementbase.cpp 2382 </li></ul><br><h3>  Strange assignments </h3><br>  <b>Fragment N1.</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CPlayerStateGround::OnPrePhysicsUpdate(....) { .... modifiedSlopeNormal.z = modifiedSlopeNormal.z; .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0168/">V570</a> The 'modifiedSlopeNormal.z' variable is assigned to itself.  playerstateground.cpp 227 <br><br>  <b>Fragment N2.</b> <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> SRWIParams&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... objtypes=ent_all; flags=rwi_stop_at_pierceable; org=_org; dir=_dir; objtypes=_objtypes; .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0168/">V519</a> The 'objtypes' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 2807, 2808. physinterface.h 2808 <br><br>  Member of the class 'objtypes' is assigned a value twice. <br><br>  <b>Fragment N3.</b> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> SPickAndThrowParams::SThrowParams::SetDefaultValues() { .... maxChargedThrowSpeed = <span class="hljs-number"><span class="hljs-number">20.0f</span></span>; maxChargedThrowSpeed = <span class="hljs-number"><span class="hljs-number">15.0f</span></span>; }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0108/">V519</a> The 'maxChargedThrowSpeed' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 1284, 1285. weaponsharedparams.cpp 1285 <br><br>  <b>And a few more such anomalous assignments</b> : <ul><li>  The 'bExecuteCommandLine' variable.  Check lines: 628, 630. isystem.h 630 </li><li>  The 'flags' variable.  Check lines: 2807, 2808. physinterface.h 2808 </li><li>  The 'entTypes' Variable.  Check lines: 2854, 2856. physinterface.h 2856 </li><li>  The 'geomFlagsAny' variable.  Check lines: 2854, 2857. physinterface.h 2857 </li><li>  The 'm_pLayerEffectParams' variable.  Check lines: 762, 771. ishader.h 771 </li></ul><br><h3>  Need to be careful with entity names </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CGamePhysicsSettings::Debug(....) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { .... sprintf_s(buf, bufLen, pEntity-&gt;GetName()); .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0235/">V618 is</a> dangerous to the sprintf_s.  The example of the safe code: printf ("% s", str);  gamephysicssettings.cpp 174 <br><br>  This is probably not a mistake, but a dangerous code.  If the symbol '%' is encountered in the entity name, the results can be quite unexpected. <br><br><h3>  Lone Wanderer </h3><br><pre> <code class="cpp hljs">CPersistantStats::SEnemyTeamMemberInfo *CPersistantStats::GetEnemyTeamMemberInfo(EntityId inEntityId) { .... insertResult.first-&gt;second.m_entityId; .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0222/">V607</a> Ownerless expression 'insertResult.first-&gt; second.m_entityId'.  persistantstats.cpp 4814 <br><br>  A lonely expression that does nothing.  Mistake?  Unfinished code? <br><br>  <b>Another place in the code:</b> recordingsystem.cpp 2671 <br><br><h3>  New operator </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateWriteBuffer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint32 bufferSize)</span></span></span><span class="hljs-function"> </span></span>{ FreeWriteBuffer(); m_pWriteBuffer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> uint8[bufferSize]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_pWriteBuffer) { m_bufferSize = bufferSize; m_bufferPos = <span class="hljs-number"><span class="hljs-number">0</span></span>; m_allocated = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0293/">V668</a> against _ _ _ _ pointer against pointer against pointer pointer pointer pointer pointer _ _ _ _  The exception will be generated in the case of memory allocation error.  crylobbypacket.h 88 <br><br>  Code is outdated.  Now, with a memory allocation error, the 'new' operator throws an exception. <br><br>  <b>Other places waiting for refactoring</b> : <ul><li>  cry_math.h 73 </li><li>  datapatchdownloader.cpp 106 </li><li>  datapatchdownloader.cpp 338 </li><li>  game.cpp 1671 </li><li>  game.cpp 4478 </li><li>  persistantstats.cpp 1235 </li><li>  sceneblurgameeffect.cpp 366 </li><li>  killcamgameeffect.cpp 369 </li><li>  downloadmgr.cpp 1090 </li><li>  downloadmgr.cpp 1467 </li><li>  matchmakingtelemetry.cpp 69 </li><li>  matchmakingtelemetry.cpp 132 </li><li>  matchmakingtelemetry.cpp 109 </li><li>  telemetrycollector.cpp 1407 </li><li>  telemetrycollector.cpp 1470 </li><li>  telemetrycollector.cpp 1467 </li><li>  telemetrycollector.cpp 1479 </li><li>  statsrecordingmgr.cpp 1134 </li><li>  statsrecordingmgr.cpp 1144 </li><li>  statsrecordingmgr.cpp 1267 </li><li>  statsrecordingmgr.cpp 1261 </li><li>  featuretester.cpp 876 </li><li>  menurender3dmodelmgr.cpp 1373 </li></ul><br><br><h2>  findings </h2><br>  I have no particular conclusions.  But I imagine how much interesting things can be found not in the CryEngine 3 SDK, but in the CryEngine 3 engine itself. <br><br>  I wish you all a reckless code! <br><br><h2>  PS </h2><br>  Someone constantly sends foreigners a link to a Russian article.  Here is the translation: <a href="http://www.viva64.com/en/b/0240/">A Spin-off: CryEngine 3 SDK Checked with PVS-Studio</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Answers on questions</b> <div class="spoiler_text"><h2>  Pps </h2><br>  Often our articles are asked the same questions.  We collected the answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio and CppCat, version 2014</a> . <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/215199/">https://habr.com/ru/post/215199/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../215183/index.html">The digest of interesting news and materials from the world of PHP No. 37 (February 24 - March 9, 2014)</a></li>
<li><a href="../215185/index.html">Sample Application - Phonebook on AngularJS + Bootstrap v3</a></li>
<li><a href="../215189/index.html">Python Meetup: January Meeting</a></li>
<li><a href="../21519/index.html">EeePC is the perfect gadget for bloggers</a></li>
<li><a href="../215197/index.html">Interesting and informative: the flight to the ISS on the PTK NP</a></li>
<li><a href="../2152/index.html">LiveJournal compensates for the ‚Äúpayday‚Äù break in their work</a></li>
<li><a href="../21520/index.html">Logos. Google Design</a></li>
<li><a href="../215203/index.html">Is IntelliJ based .NET support a reality?</a></li>
<li><a href="../215205/index.html">Cebit 2014 through the eyes of a robot webot</a></li>
<li><a href="../215207/index.html">IBM Watson supercomputer has learned to create its own recipes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>