<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We update the sketch by air</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the process of developing code for Arduino compatible boards, it is often necessary to update the firmware in the controller, very often it is diff...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We update the sketch by air</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/d962548c/c7f12310/fe01b0c0/370924ab.jpg" align="left">  In the process of developing code for Arduino compatible boards, it is often necessary to update the firmware in the controller, very often it is difficult to do this, because the device is already assembled and pulling shield and heaps of wires back and forth - it becomes tiresome and annoying.  My first Arduino was a kit of parts (assemble it yourself) Freeduino Through-Hole, the kit upon arrival was immediately soldered and tested, but in this analog of Arduino Diecimila there was one nice detail missing ... namely, an automatic switch of the power source, in my case it was suggested to poke the jumper on the board, which further complicated updating the sketch for my <s>childhood dream</s> model. <br><br>  In this post I will describe how in 5 minutes with a soldering iron to modify the XBee Shield to update the sketch via a wireless communication channel.  You can also project these changes to other XBee Shield counterparts without too much difficulty. <a name="habracut"></a><br><br>  To begin with, I had two XBee Shields, the difference was that one of the shields had a mini-usb connector and an FTDI USB-Serial chip for directly connecting the XBee module to a PC, so they bother with third-party USB-Serial cords for me did not have to.  As it turned out, working with modules through this shield is very convenient, the RTS and DTR pins were divorced where necessary, the firmware was updated, configs were flooded.  Attention!  If you try to update the firmware without connecting pins, RTS and DTR, the module will brittle, but this is fixable.  It is necessary only to specify the API mode of working with the module in the X-CTU connection settings and update the firmware again. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And so proceed: <br><br><h4>  1. Modification of the transmitting module </h4><br>  Let's start with iron.  In my case, the transmitting label has undergone minor and at the same time <s>elegant</s> reversible changes.  I used the XBee modules of the non-PRO version and on my label the pads for the PRO module were not soldered (it is 20 percent more), the pitch between the holes of this pad successfully coincided with the PLS connector (these are male-type pins inserted into the arduino), pins from which has long been gathering dust in the box.  I bit off a couple of pins from the main "comb".  According to the <a href="http://ftp1.digi.com/support/documentation/90000982_B.pdf">datasheet</a> for XBee and XBee PRO, the RTS and DIO3 pins are located on 16 and 17 pins, respectively, which is very convenient in our situation.  We solder our contacts into the 16 and 17 hole on the shield, as well as simultaneously pull the jumper (jumper) from the old unnecessary screw or motherboard and close the freshly soldered contacts.  This will, in case of anything, promptly remove the jumper without consequences.  This completes the iron modification of the transmitting module. <br><br>  Go to the settings of the module itself.  If you have used XBee modules at least once in your handicrafts, then you are most likely already familiar with the <a href="http://www.digi.com/support/productdetl.jsp%3Fpid%3D3352%26osvid%3D57%26s%3D316%26tp%3D5%26tp2%3D0">X-CTU</a> program and its capabilities.  About setting up with it further and will be discussed. <br><br>  The first thing we need to do is connect our XBee module to the computer and check the connection.  If you are doing this for the first time, then the parameters will be as follows (the COM port should of course choose your own): <br><br><img src="https://habrastorage.org/storage1/fc959634/98d76b86/67d82e08/b04a7e6a.gif"><br><br>  After setting the parameters, click " <b>Test / Query</b> " and after a second in response you should receive a message with the serial number and model of the module. <br><br><img src="https://habrastorage.org/storage1/328e0123/b678898b/83f0c56c/73465815.gif"><br><br>  If this does not happen - then somewhere there is an error.  As an option, try to cross the port speed (Baud). <br><br>  Go to the <b>Modem Configuration</b> tab and click Read to get the current settings and the firmware version of the module. <br><br>  The first value that we change is PAN ID. <br>  PAN ID consists of 4 digits in HEX format and will determine the ID of the network in which this module will work.  The PAN ID must be the same on both the receiver and transmitter.  It is also recommended not to configure any more modules on this ID in order to avoid conflicts. <br><br><img src="https://habrastorage.org/storage1/24b7e73f/62d00cb6/b9b0ceaa/b501e27b.gif"><br><br>  The next item in the settings should change the speed of the port.  It should correspond to the speed necessary for the firmware of a specific chip (there are also alternative loaders that increase the speed of the firmware).  For a 168 chip, this is 19200, and for a 328p 57600. Note that to work with the module in the future, you need to make corrections to the sketch (for example, if you used the standard 9600 speed before), change the speed of work with the port. <br><br><img src="https://habrastorage.org/storage1/878400b1/4cedb795/761ade28/36d370cb.gif"><br><br>  Packetization Timeout - timeout that determines how long to wait before being broadcast.  May require a value greater than 10 - is selected individually based on the size of the sketch, 10 = 10kb sketch. <br><br><img src="https://habrastorage.org/storage2/553/908/4e7/5539084e7b80dcabe50347b991d0a6ae.gif"><br><br>  Now set the D3 pin (Digital Input / Output) to the 3-DI position, which means that the pin will be used as a digital input. <br><br><img src="https://habrastorage.org/storage2/a9a/ce5/005/a9ace5005d11d7618d542479bebd7669.gif"><br><br>  Set the parameter Digital IO change detect to FF.  You can also specify instead of FF, 0x08.  Then we specifically point out that the changes in DI need to be heard on the D3 pin, but it works fine as well. <br><br><img src="https://habrastorage.org/storage2/8b3/120/958/8b3120958f23c3d1f83accd18dc687fe.gif"><br><br>  Now the transmitter (transmitter) is configured to send the current D3 pin status to any modems within reach.  We will write the changes to our module by clicking the Write button on the top panel. <br><br>  And it is also worth mentioning the predictable rake of Windows users (in MacOS and Linux this is provided by default). <br><br>  It is necessary to specify the Set RTS on close option in the COM port settings (a different name is possible in the Russian version) <br><br><img src="https://habrastorage.org/storage2/5a2/693/970/5a2693970fa4a5239a2456f0a13cd5f2.jpg"><br><br><img src="https://habrastorage.org/storage2/ec3/4ae/b45/ec34aeb45ff1d62dda70d4ba3f776fa7.jpg"><br><br><img src="https://habrastorage.org/storage2/008/bfa/c20/008bfac200327e2f2d2ed3722f8cd06e.jpg"><br><br>  Make sure the box is checked and apply the settings. <br><br><h4>  2. Modification of the receiving module </h4><br>  We will begin the modification according to the tradition with iron, namely, we solder into a heap (so far better on weight for further debugging of the circuit) a capacitor, a transistor and a resistor according to the following scheme: <br><br><img src="https://habrastorage.org/storage2/0df/f37/dd6/0dff37dd64642f2bb96a5f11100a2b61.png"><br><br>  Reset signal from XBee - leads directly to D3 pin.  Reset to Arduino - directly to the Reset pin on Arduin. <br><br>  You should get something like this. <br><br><img src="https://habrastorage.org/storage2/fb5/8ce/cdc/fb58cecdc237ebc1ee4d97a056b8f9a8.jpg"><br><br>  I will repeat just in case, do not forget to adjust the exchange rate in your project. <br><br>  Now we connect the receiver (receiving module) to the computer and open the already familiar X-CTU to set the following parameters <br><br>  PAN ID - Must match the transmitting module <br><br><img src="https://habrastorage.org/storage1/24b7e73f/62d00cb6/b9b0ceaa/b501e27b.gif"><br><br>  Interface Data Rate - Must be the same as the transmitter. <br><br><img src="https://habrastorage.org/storage1/878400b1/4cedb795/761ade28/36d370cb.gif"><br><br>  Packetization Timeout - also as I understood it is similar to the transmitter <br><br><img src="https://habrastorage.org/storage2/553/908/4e7/5539084e7b80dcabe50347b991d0a6ae.gif"><br><br>  Set the pin D3 of our receiver 5-DO HIGH (Digital Out Default High) <br><br><img src="https://habrastorage.org/storage2/aeb/c76/9ea/aebc769ea48720a2d60c967a42cfc9c3.gif"><br><br>  I / O Output In Disabled.  To prevent status messages from entering the serial port <br><br><img src="https://habrastorage.org/storage2/cf7/f8d/ce9/cf7f8dce9721d221b308e0b095dacc60.gif"><br><br>  And finally, we set the I / O input address to the FFFF - to receive I / O messages from all broadcasters.  You can also specify the address of the transmitter. <br><br><img src="https://habrastorage.org/storage2/3df/bac/dab/3dfbacdabe26ed9033d2cda179d093ab.gif"><br><br><img src="https://habrastorage.org/storage2/793/a09/604/793a09604f253a4cd5c1035c08604115.gif"><br><br>  Now we write the changes to our module by clicking the Write button. <br><br>  I recommend once to configure and save profiles for both modules on your computer in order to avoid confusion in the future.  Top Profile -&gt; Save. <br><br>  Do not forget to connect all the GND together and connect the transmitting module to the computer (via an adapter or label) and install the receiving on the target Arduino.  Once again we check everything, suddenly I was mistaken or some other trifle remained where.  We check everything quickly with a glance again and you can try it!  :) <br><br>  The rakes that I had: The sketch refused to flood, although the Arduino sometimes rebooted, it put me in a stupor, but it soon became clear that if you quickly click <b>twice</b> on the Upload in the IDE, the Arduino sketch was successfully flooded, though not always (I blame Wifi and Blutooth around there was a lot) Apparently it‚Äôs worth digging in the direction of the condenser (playing with volume) Well, or in extreme cases, edit the IDE code so that the RTS pin itself jumped twice :) <br><br>  I apologize for the confusion, I began to write satatiya almost a year ago, I have already forgotten a lot, but said everything that I wanted to say.  Suggestions and suggestions are welcome.  Inaccuracies in the article or errors according to tradition, write in a personal, I hope the article was useful to you. <br><br>  My article can be considered a translation of <a href="http://www.ladyada.net/make/xbee/arduino.html">this</a> <br>  I just added a bit and embellished where I could. <br><br>  My question in Q &amp; A is <a href="http://habrahabr.ru/qa/6670/">here</a> and thanks to the respondent <a href="http://geektimes.ru/users/djmorgan/" class="user_link">djmorgan</a> </div><p>Source: <a href="https://habr.com/ru/post/126539/">https://habr.com/ru/post/126539/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../126534/index.html">Monument to the Internet in Petersburg. We listen to public opinion</a></li>
<li><a href="../126535/index.html">Procrastination ruined my life!</a></li>
<li><a href="../126536/index.html">Beeline and Opera Mini: this music will be eternal (Detail of only 8650 rubles per month!)</a></li>
<li><a href="../126537/index.html">Programming vs Patterns</a></li>
<li><a href="../126538/index.html">In Kenya, Android smartphones for $ 80 fly like hotcakes</a></li>
<li><a href="../126541/index.html">Using thermal scanners to steal PIN codes</a></li>
<li><a href="../126542/index.html">The history of the creation of a network game on the ZX Spectrum</a></li>
<li><a href="../126543/index.html">Future Lisp</a></li>
<li><a href="../126546/index.html">Learn Ruby The Hard Way</a></li>
<li><a href="../126548/index.html">Admission to the department of information security in Moscow State Technical University named after NE Bauman through the program ‚ÄúStep into the Future. Moscow"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>