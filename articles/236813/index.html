<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PHP + Javascript Event Calendar</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently there was a need to create a calendar of events, where each date in the calendar will be highlighted with a link if any event is present for ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PHP + Javascript Event Calendar</h1><div class="post__text post__text-html js-mediator-article">  Recently there was a need to create a calendar of events, where each date in the calendar will be highlighted with a link if any event is present for each number.  If I‚Äôm allowed to leave a link, <a href="http://temperaments.org/afisha/">here‚Äôs a demonstration of how the calendar works</a> . <br><br>  The task seems to be not complicated, but among the few solutions on the Internet I did not find the right one for the following reasons: too complicated and incomprehensible code, slow queries to the database (this is especially felt if there are many records in the database), using the jQuery library to which I belong not very good. <br><br>  So, the advantages of my calendar include the following: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  All code is placed in 200 lines and consists of one file, which is connected via include </li><li>  The script consists of pure php + javascript without using the jQuery library </li><li>  Simple and optimized database queries are used. </li><li>  The next (previous) month is loaded via AJAX </li></ol><br>  Now everything is in order. <br><a name="habracut"></a><br><h4>  Logics </h4><br>  The calendar is generated by php for the current month.  For each day, we check if there are any records in the database, if any, we form a link to the event.  We add the javascript code for browsing months that accesses the script via ajax.  The task is complicated by the fact that events are stretched in time, that is, they begin in one day and end in a few days or even months.  On the entire time span, the existence of the event should be highlighted with a link for each day. <br><br><h4>  We generate a calendar for PHP </h4><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//,      .  ,   . if (isset($_REQUEST['date'])) { //,     ... $pattern = "/^([0-9]{4})-([0-9]{2})-([0-9]{2})$/"; if (preg_match($pattern, $_REQUEST['date'])) { $date = $_REQUEST['date']; } else { die(' '); } } else { $date=date("Ymd"); } $sd = explode("-", $date); $year = $sd[0]; $month = $sd[1]; $day = $sd[2]; //       $dayofmonth = date('t', mktime(0, 0, 0, $month, 1, $year)); //    $todate = "$year-$month-$dayofmonth"; $fromdate = "$year-$month-01"; $query = "SELECT date,enddate from sobytia WHERE startdate&lt;='$todate' AND enddate&gt;=$fromdate"; $res_db = $db-&gt;sql($query);</span></span></code> </pre> <br><br>  Thus, we have selected all the records that are in the current month. <br><br>  Then the most interesting thing: fill the bypass array.  In order not to twist it all over again, if a match is found, the element of the array is removed and the next cycle has less iterations. <br><br><pre> <code class="php hljs">$d = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>();$k=<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>($i = <span class="hljs-number"><span class="hljs-number">1</span></span>; $i&lt;=$dayofmonth; $i++){ $k[$i] = $i; } $i=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ($a = mysqli_fetch_row($res_db)) { <span class="hljs-comment"><span class="hljs-comment">//for($i = 1; $i&lt;=$dayofmonth; $i++){ foreach ($k as $i) { // 0   if($i&lt;10) $cd = "$year-$month-0".$i; else $cd = "$year-$month-$i"; if ($cd &gt;= $a[0] &amp;&amp; $cd &lt;= $a[1]) { $d[$i] = $cd; unset($k[$i]); } } }</span></span></code> </pre><br><br>  Actually, the calendar itself: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//     $day_count = 1; // 1.   $num = 0; for($i = 0; $i &lt; 7; $i++) { //       $dayofweek = date('w', mktime(0, 0, 0, $month, $day_count, $year)); //      1 - , ..., 6 -  $dayofweek = $dayofweek - 1; if($dayofweek == -1) $dayofweek = 6; if($dayofweek == $i) { //    , //   $week //   $week[$num][$i] = $day_count; $day_count++; } else { $week[$num][$i] = ""; } } // 2.    while(true) { $num++; for($i = 0; $i &lt; 7; $i++) { $week[$num][$i] = $day_count; $day_count++; //     -  //   if($day_count &gt; $dayofmonth) break; } //     -  //   if($day_count &gt; $dayofmonth) break; } // 3.    $week //    //   echo '&lt;table id="calendar"&gt;'; // $rusdays = array('','','','','','',''); $rusmonth = array('','','','','','','','','','','',''); echo '&lt;thead&gt; &lt;tr&gt; &lt;td onclick="monthf(\'prev\');"&gt;&lt;&lt;/td&gt; &lt;td colspan="5"&gt;'.$rusmonth[$month-1].', '.$year.'&lt;/td&gt; &lt;td onclick="monthf(\'next\');"&gt;&gt;&lt;/td&gt; &lt;/tr&gt;'; echo '&lt;tr&gt;'; foreach ($rusdays as $rusday){ echo '&lt;td&gt;'.$rusday.'&lt;/td&gt;'; } echo '&lt;/tr&gt;'; echo '&lt;/thead&gt;'; //  for($i = 0; $i &lt; count($week); $i++) { echo "&lt;tr&gt;"; for($j = 0; $j &lt; 7; $j++) { if(!empty($week[$i][$j])) { //        ee if($week[$i][$j]==$day) { echo '&lt;td class="today"&gt;'; } else { echo '&lt;td&gt;'; } //        ,   if($d[$week[$i][$j]]) { echo '&lt;a href="/afisha/'.$d[$week[$i][$j]].'/"&gt;'.$week[$i][$j].'&lt;/a&gt;'; } else { echo $week[$i][$j]; } echo '&lt;/td&gt;'; } else echo "&lt;td&gt; &lt;/td&gt;"; } echo "&lt;/tr&gt;"; } </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br><br><h4>  Javascript code for rewinding months </h4><br>  It is slightly simplified for clarity (there are no sliding effects): <br><br><pre> <code class="javascript hljs">&lt;script&gt; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mon = <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(<span class="hljs-string"><span class="hljs-string">"&lt;?php echo $month; ?&gt;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> year = <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(<span class="xml"><span class="php"><span class="hljs-meta"><span class="xml"><span class="php"><span class="hljs-meta">&lt;?php</span></span></span></span><span class="xml"><span class="php"> </span></span><span class="hljs-keyword"><span class="xml"><span class="php"><span class="hljs-keyword">echo</span></span></span></span><span class="xml"><span class="php"> $year; </span></span><span class="hljs-meta"><span class="xml"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span></span><span class="xml">); function monthf(pn){ if (pn == 'next'){ mon++; }else if (pn == 'prev'){ mon--; }else{ alert(' '); return false; } if (mon &gt; 12){ year ++; mon = 1; } if (mon </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span><span class="xml"><span class="hljs-tag">){ </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">year</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">--</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">mon</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">12;</span></span></span></span><span class="xml"><span class="hljs-tag"> } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span></span><span class="xml"><span class="hljs-tag"> ((</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">mon</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">10</span></span></span></span><span class="xml"><span class="hljs-tag">) &amp;&amp; (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">mon</span></span></span></span><span class="xml"><span class="hljs-tag"> &gt;</span></span></span><span class="xml">= 1)){ mon = '0'+mon; } var nextDate = year+'-'+mon+'-00'; var ajaxaddr = "___?date='+nextDate; var http = new XMLHttpRequest(); if (http) { http.open('get', ajaxaddr); http.onreadystatechange = function () { if(http.readyState == 4){ if (http.status == 200) { document.getElementById('calendar').innerHTML = http.responseText; } } } http.send(null); } } </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br><br>  Close the table tag: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;/table&gt;"</span></span>; <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br><br><h4>  findings </h4><br>  Thus, we have a simple and easily embedded calendar of events that works quickly and is easily configured, working in pure PHP + javascript without additional libraries. <br><br><h4>  Literature </h4><br><ol><li>  <a href="http://www.php.su/articles/%3Fcat%3Dexamples%26page%3D051">PHP Calendar</a> </li><li>  <a href="http://shpargalkablog.ru/2013/11/calendar.html">Javascript calendars</a> </li><li>  <a href="https://toster.ru/q/95077">Sampling from the database - the answers to the toaster</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/236813/">https://habr.com/ru/post/236813/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../236799/index.html">Life imitation: our e-friends</a></li>
<li><a href="../236801/index.html">A series of 24 laboratory work on the development, testing and lifecycle management software for Visual Studio 2013</a></li>
<li><a href="../236805/index.html">Debugging and optimization of gstreamer scripts using live streaming as an example</a></li>
<li><a href="../236807/index.html">The feeling of pain as the software foundation of strong artificial intelligence</a></li>
<li><a href="../236811/index.html">Through difficulties and mistakes to a flawless self-service checkout interface</a></li>
<li><a href="../236815/index.html">Local Motors company printed the car in just 6 days</a></li>
<li><a href="../236819/index.html">Back at the desk</a></li>
<li><a href="../236823/index.html">Introduction to machine learning and a quick start with Azure ML</a></li>
<li><a href="../236829/index.html">Google introduced 100-dollar smartphones on Android One</a></li>
<li><a href="../236831/index.html">Python on Assembler (Tasm)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>