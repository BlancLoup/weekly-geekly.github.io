<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>As we broke an old shack and built a skyscraper in its place</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Zurab Bely, team leader, Java practice, tells his story of work in a project for one large company and shares his experience. 

 How I settled ... 
 I...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>As we broke an old shack and built a skyscraper in its place</h1><div class="post__text post__text-html js-mediator-article">  Zurab Bely, team leader, Java practice, tells his story of work in a project for one large company and shares his experience. <br><br><h4>  How I settled ... </h4><br>  I got to the project in the late summer of 2017 as an ordinary developer.  I will not say that at that time I liked it a lot: the technology used in the project was old, communication within the team was minimized, communication with the customer was difficult and unproductive.  So the project met me.  At that time, I had only one desire: to get out of it quickly. <br><br>  I'll tell you a little about the project as a whole.  This is the official portal of a large company with general information, news, promotions and other content.  All marketing newsletters contain links to certain pages of the site, that is, the load is consistently average, but at certain points in time can reach high values.  Special attention is required to the stability and availability of the web application - every minute of service downtime leads to large losses for the customer. <br><a name="habracut"></a><br><h4>  Khibara, which glanced from the wind </h4><br>  At first, I mainly studied the technical condition of the project, fixed frivolous bugs and made minor improvements.  From a technical point of view, the application looked awful: a monolithic architecture built around an outdated commercial version of dotCMS, code written in Java 6th version, when the ninth, server-side rendering of the client part on the Velocity framework, which by that time was not maintained.  Each instance was launched in JBoss AS and routed using Nginx.  Memory leaks led to constant restarts of the nodes, and the lack of normal caching led to an increase in server load.  But the biggest splinter was the changes made in the CMS code.  They excluded the possibility of a painless update to a more recent version.  A good illustration of this was the transition from version 3.2 to 3.7, which was just ending at that time.  The transition to the next minor version took more than a year.  There were no popular solutions, such as the Spring Framework, React.js, microservice architecture, Docker, etc.  Going deeper into the project, the consequences of such a technical condition became visible.  The most acute of them was the impossibility of running the local application for development and debugging.  The whole team of 8 people worked on one developer stand, where a copy of the production version of the application was deployed.  Accordingly, only one developer could debug his code at a time, and rolling up the updated code blocked the entire command.  The failure was the apogee, during which millions of letters were sent via various channels, SMS and push notifications to users - tens of thousands of sessions were opened simultaneously.  Servers could not stand, and most of the time the portal was unavailable.  The application did not scale well.  There was only one way to do this: deploy another copy next to it and balance the load between them using Nginx.  And each delivery of the code for the production involved a large amount of manual work and took several hours. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Six months after my involvement in the project, when the situation had already begun to spin out of control, it was decided to radically change the situation.  The transition process has begun.  The changes affected all areas: team composition, work processes, architecture and technical component of the application. <br><br><h4>  We built, built ... </h4><br>  First of all, there were personnel changes.  Replaced several developers, I was made timlidom.  The transition to modern solutions began with the involvement in the team of people who had experience working with them. <br><br>  Procedural changes were more global.  By that time, the development was carried out according to Agile- + Scrum-methodology, two-week sprints with delivery at the end of each iteration.  But in fact, this not only did not increase the speed of work, but on the contrary, it slowed down.  Daily meetings were delayed for a half to two hours and did not give any results.  Planning and grooming turned into controversy, swearing or simple communication.  It was necessary to do something with it.  Initially, it was very difficult to change something in this vein - the team almost lost confidence in the person of the customer, especially after a failed sale.  Each change had to be justified, discussed and proved for a long time.  Oddly enough, but the initiative came from the customer.  From their side, a scrum-master was involved to control the correctness of applying approaches and methodologies, debugging processes and setting up teams in a working manner.  Although he was attracted to just a few sprints, it helped us to properly build the foundation.  The approach to communication with the customer has changed a lot.  We began to discuss the problems in the processes more often, retrospectives began to be more productive, the developers were more willing to give feedback, and the customer, on his part, went forward and supported the transition process in every way. <br><br>  But, honestly, I will honestly say: there were quite a few moments when some changes within the team were carried out "in the dark", and already after the appearance of positive results this was reported to the customer.  For six months, the attitude has changed to a comfortable working communication.  This was followed by several teambuildings, one-day and two-day meetings of the entire development team with the customer's team (marketing specialist, analyst, designer, product-product, content managers, etc.), joint visits to the bar.  A year later, and to this day, communication can be called friendly.  The atmosphere has become welcoming, relaxed and comfortable.  Of course, it is not without conflicts, but sometimes even in the happiest family there are quarrels. <br><br>  No less interesting changes occurred during this period in the application code, in its architecture and in the solutions used.  If you are not technically savvy, feel free to skip all the text to the conclusion.  And if you are lucky as I am - welcome!  The entire transition can be divided into several stages.  About each detail. <br><br>  <b>Stage 1. Identification of critical problem areas.</b> <br><br>  Everything was as simple and clear as possible.  First of all, it was necessary to get rid of the dependence of a third-party commercial product, cut the monolith and make the possibility of local debugging.  I wanted to separate client and server code, spread it out architecturally and physically.  Another problematic place is qualification.  The project completely lacked any automated testing.  This made the transition process a bit more difficult, since everything had to be checked manually.  Considering that there were never any technical assignments for the functionality (this is due to the specifics of the project), there was a great chance to miss something.  Having painted problem areas, we looked at the list again.  Looked like a plan.  It's time to build a skyscraper! <br><br>  <b>Stage 2. Updating the code base.</b> <br><br>  The longest playing stage.  It all started with the transition to a service architecture (not to be confused with microservices).  The idea was as follows: to split the application into several separate services, each of which will be engaged in its specific task.  The services were supposed to be not ‚Äúmicro‚Äù, but they didn‚Äôt want to put everything in one pot either.  Each service had to be a Spring Boot application written in Java SE 8 and run on Tomcat. <br><br>  The first was the so-called.  "Content service", which became the layer between the future application and CMS.  He became an abstraction on the path to content.  It was assumed that all requests that we previously made directly to the CMS will be executed through this service, but now via the HTTP protocol.  This solution allowed us to reduce connectivity and made it possible later to replace dotCMS with a more modern analogue or even eliminate the use of commercial products and write our solution, tailored to our tasks (looking ahead, I‚Äôll say that we went this way). <br><br>  Immediately created the ground for the separation of the front and backend code.  We created a front-service that became responsible for the distribution of code written in the reactor.  Screwed npm, configured the node and debugged the assembly - everything is as it should be according to the current trends of the client part. <br><br>  In general, the functional was allocated to the service according to the following algorithm: <br><br><ul><li>  created a new Spring Boot application with all the necessary dependencies and settings; </li><li>  ported all the basic logic (they often wrote it from scratch, referring to the old code, only to make sure that they didn‚Äôt forget about any nuance), for example, for the caching service, these are the possibilities to add to the cache, read from it and disable it; </li><li>  all new features are always written using the new service; </li><li>  Gradually rewrote the old pieces of the application in the new service in order of importance. </li></ul><br>  At the start we had a few of them: <br><br><ul><li>  Content service.  Served as a layer between the application and CMS. </li><li>  Cash service.  Simple storage on Spring Cache. </li><li>  AA service.  At the start, he was engaged only in the distribution of information about an authorized user.  The rest remained inside the dotCMS. </li><li>  Front service.  Responsible for the distribution of client code. </li></ul><br>  <b>Stage 3. Autotest.</b> <br><br>  Taking into account all the experience of the project, it was decided that the availability of functional tests greatly simplifies life and possible further update of the application.  It's time to introduce them into the project.  The unit tests of the code, sadly to talk about it, stalled almost immediately.  They took a lot of time to write and support, and we had very little of it, because, in addition to rewriting the code, we had current tasks for the new functionality, and bugs often surfaced.  It was decided to stop only on testing the application interface using Selenium.  On the one hand, it simplified our regression testing before deliveries to production, on the other hand, it became possible to refactor on the server side, monitoring the state on the client side.  The team did not have an automator, and writing and maintaining the relevance of autotests require additional costs.  They did not retrain any of the testers, and one more person was added to the team. <br><br>  <b>Stage 4. Deploy automation.</b> <br><br>  Now that we have separate services, when the frontend has separated from the backend, when the main functionality began to be covered by autotests, it‚Äôs time to open a can of beer and automate all the manual work of deploying and supporting the application locally, on demo and prod servers.  Cutting the monolith into pieces and using Spring Boot opened up new horizons for us. <br><br>  The developers were able to debug the code locally, running only that part of the functionality that is necessary for this.  Test benches finally began to be used for their intended purpose - there already got more or less debugged code ready for initial and qualification testing.  But still there is a lot of manual work that takes us precious time and energy.  After studying the problem and sorting out solutions, we stopped at a bunch of Gradle + TeamCity.  Since the project builder was Gradle, adding something new did not make sense, and the written scripts turned out to be platform independent, they can be run on any OS, remotely or locally.  And it allowed not only to use any solution for CI / CD, but also to change the platform to any other without serious consequences.  TeamCity was chosen because of the rich built-in functionality, the presence of a large community and a long list of plug-ins for all occasions, as well as integration with the Intellij IDEA development environment. <br><br>  At the moment there are more than 100 optimization scripts and more than 300 tasks in the CI system to run them with different parameters.  It is not only deploying test benches and delivery in production, but also working with logs, server management, routing, and just solutions for routine tasks of the same type.  Part of the task was removed from our shoulders.  Content managers were able to reset the cache themselves.  Technical support guys were able to independently pull individual services, conduct primary resuscitation actions.  Developers sleep has become deeper and calmer. <br><br>  <b>Stage 5. Own CMS.</b> <br><br>  After we managed to abstract from a commercial CMS, it became possible to receive data from another source as well, without rewriting the application code.  Where to get this or other data was decided by the service for working with content.  After searching for ready-made solutions and analyzing them, we decided to write our own content management system, since none of them met our needs completely.  Writing your own CMS is an endless process, new needs and wishes are constantly emerging.  Chose a few basic features and went to the wonderful world of development.  To launch the first version in the prod, we have had one and a half man-months.  As soon as the functionality in the new CMS is ready, we transfer the content from the old one to it.  All new pages have nothing to do with dotCMS.  Over time, this allowed to abandon the paid version and go to the community version, and later to completely abandon something third-party. <br><br>  <b>Stage 6. Warehouse.</b> <br><br>  Rolling up our pants, we began our journey into the world of hipster programming.  This stage for my project was the final in the process of restructuring.  He continues to this day.  The main sphere for which this stage appeared in general is scaling.  The Docker + Kubernetes + Consul bundle allows you not only to facilitate deployments to different servers and manage each service separately, but also flexibly scale the entire application, only in places where it is needed, and only while it is required.  I can only describe in more detail when we fully switch to this solution in production. <br><br><h4>  ... and finally built.  Hooray! </h4><br><br>  A year has passed since the beginning of the application update.  Now it is 26 REST services written in Spring Boot.  Each has detailed API documentation in Swagger UI.  The client part is written in React.js and is separated from the server.  All main portal pages are covered with tests.  There have been several large sales.  The transition to modern technology, getting rid of the old code and the stable operation of the servers strongly motivate developers.  From ‚Äúas they said, and we are doing‚Äù the project moved to the mainstream, where everyone is interested in success, offers his own options for improvements and optimization.  The attitude of the customer to the team has changed, a friendly atmosphere has been created. <br><br>  This is the result of the work of the whole team, each developer and tester, managers and the customer.  It was very hard, nervously and sometimes on the verge of a foul.  But the team cohesion, good planning and awareness of the results made it possible to overcome all difficulties. </div><p>Source: <a href="https://habr.com/ru/post/457624/">https://habr.com/ru/post/457624/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../457614/index.html">Secrets of finding a job abroad from a practicing headhunter</a></li>
<li><a href="../457616/index.html">My ‚ÄúWow, I didn't know that!‚Äù Moments with Jest</a></li>
<li><a href="../457618/index.html">Being a contemporary full-developer</a></li>
<li><a href="../45762/index.html">The golden era of Linux?</a></li>
<li><a href="../457622/index.html">Measuring Qt performance</a></li>
<li><a href="../457626/index.html">Auditing user access levels using Power BI using the example of CMS Bitrix (BEADS)</a></li>
<li><a href="../457628/index.html">Effective management of programs and projects using the P2M methodology</a></li>
<li><a href="../45763/index.html">Developer ammunition. Latest news.</a></li>
<li><a href="../457630/index.html">Experience in developing the requirements for a professional data scientist</a></li>
<li><a href="../457632/index.html">How much do unit tests cost?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>