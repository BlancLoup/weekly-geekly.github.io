<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Node Webkit without webkit</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We once discussed desktop applications nw.js. Everything is good, but the need to distribute the entire browser engine (which over time and the additi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Node Webkit without webkit</h1><div class="post__text post__text-html js-mediator-article">  We once discussed desktop applications nw.js.  Everything is good, but the need to distribute the entire browser engine (which over time and the addition of new features does not become less and compressed 30MB now weighs) is depressing. <br>  And what if you make a module for node.js, which can show UI in the system browser? <br>  Under the cut I will tell about the attempt - how it is, whether it is worth the effort, whether it can be used, and what happened as a result. <br><a name="habracut"></a><br><h1>  Dicslaimer </h1><br>  Basically, the project was made more like a proof-of-concept: play around, see, check how it is.  I made 3-4 orders on it in the style ‚ÄúI want a small application with a built-in webview‚Äù or ‚ÄúI want a wrapper for the site in the desktop application window‚Äù.  Maybe someone my experience will be useful, so laid out in public.  The code <a href="https://github.com/antelle/io-ui">on the githaba</a> .  I will not describe the nuances of the code in detail, the goal is not to describe the code, but rather to think about the suitability of the result. <br><br><h1>  How it works </h1><br>  An application is statically assembled with node.js with its entry point.  When launched, a native module with the window display logic is added to the node, and control is passed to _thirdPartyMain.js (there is such a possibility in the node).  From there, the user main.js is loaded, where the ui module is connected.  The module starts the http-server, opens a window with the specified config and sends a webview to the address of the embedded server that delivers user-generated content.  The window generates events (move, minimize, ...) and is able to execute methods (for example, to close). <br><br><h1>  Webview </h1><br>  Under Windows, the ActiveX <a href="https://msdn.microsoft.com/en-us/library/aa752040(v%3Dvs.85).aspx">WebBrowser is</a> inserted (this is the same MSIE, but without Tublars, address lines, etc.).  By default, it shows a lot of unnecessary dialogs (which are turned off in a strange way), but in general it works as you want.  IE, it <a href="https://en.wikipedia.org/wiki/Internet_Explorer_versions">doesn‚Äôt matter</a> , but it was necessary to support XP, so for older versions of Windows you can download a webcam (chrome embedded framework).  If necessary, if the user does not mind, the application downloads the library, unpacks them and works already with the webcam. <br>  Under poppy, everything is more transparent, WebKit WebView compared to IE in the integration is much easier and more understandable;  under Linux is webkit-gtk. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  Packaging application </h1><br>  It was necessary that the applications were packaged in one EXE.  ZIP turned out to be the most suitable format: it is read from the end, allowing you to add anything to the executable file and unpack it from yourself;  on this principle, and work SFX.  To use from node.js, you can hang a hook on calls to fs and redirect requests to files that are in the archive to the virtual file system instead of reading from the disk. <br><br><h1>  Browser interaction </h1><br>  IE and WebKit offer ways to interact from C ++ to JS, and vice versa.  In IE, a javascript object, including a function, is an IDispatch object.  If you check the typeof of such an object, the javascript engine will return unknown, these are the so-called host objects (the use of such results of the typeof operator in the ES6 standard is no <a href="https://people.mozilla.org/~jorendorff/es6-draft.html">longer recommended</a> , but earlier nothing was said about non-standard types).  You can call something from C ++ by accessing the window.external object, provided that the host has implemented this method. <br>  Similarly to a webcast, you can add a window property as an object with methods available for invoking. <br><br><h1>  Interacting with node.js </h1><br>  In the node, the plug-in creation process is well <a href="https://nodejs.org/api/addons.html">documented</a> .  Inline add-ons are created in the same way, but they are registered by another macro.  After creating the addon class, it inherits from EventEmitter and is able to generate events by getting a reference to the emit method. <br>  Node.js intentionally lives in a separate thread, so long-running operations do not block the UI, so the UV library is used to send messages to the node and synchronize. <br><br><h1>  What worked out well </h1><br><h3>  Application size </h3><br>  It is 2-3 MB (unpacked 7).  In principle, you can make the assembly smaller, if you only need to open a page in the application, without node.js (in general, for the sake of size, everything was done). <br><br><h3>  Start time </h3><br>  Since  the application does not use additional frameworks, it starts quickly in an average of 1 second (about the time of the first launch, see below);  By adding profiling, you can make sure that most of the time is spent on browser initialization. <br><br><h1>  Problems </h1><br><h3>  First start </h3><br>  Windows optimizes the launch of applications and components that you use more often.  If IE is rarely used, the time of the first launch of the application is about 3..10 seconds, depending on the operating system and computer. <br><br><h3>  Browser Versions </h3><br>  Very often, IE is <s>used as a tool for downloading the browser and is</s> never updated at all (although the situation improves with the latest versions of Windows).  IE cannot be forced to be updated (show the dialog, update IE from the application is tantamount to suicide: updating IE is difficult, long, often requires a reboot - it‚Äôs impossible to mock the user, he will simply find another application). <br>  Browser versions are tied to OSes: for Windows XP, there is no IE10, for OS X Lion there is no Safari 8. <br><br><h3>  Javascript contexts </h3><br>  Objects node.js cannot be used in the browser and vice versa, the interaction occurs either in the classic client-server application (xhr), or in the manner provided by the program (postMessage in the window or node) ‚Äîthat is,  as in a web worker, only simple data can be transferred.  It was possible to make the context bridge, but firstly it‚Äôs difficult and cumbersome, secondly it‚Äôs short-sighted, because ES6 is almost there, and it‚Äôs not known what to do, for example, with the proxy object in IE10. <br><br><h1>  What is </h1><br>  There is an assembly under win / mac / linux, which in principle can be used, customized, and so on.  I use it to create customized ‚Äúbrowser applications‚Äù, when it happens to someone suddenly.  It is relatively stable, but I did not bring it to mind and release quality, because ... <br><br><h1>  findings </h1><br>  Applications are rarely downloaded, the Internet is now quite fast (and in the case of installing applications, EDGE can really be neglected, because the application is not a site, it will not be installed on the road), unsolvable problems in using the system browser are present.  In most cases, now the game is not worth the candle and use the webkit seems more correct.  If the goal is to create a small application mainly for new OSes - or maybe it can be so. <br><br><h1>  Links </h1><br><ul><li>  <a href="https://github.com/antelle/io-ui">github</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/260789/">https://habr.com/ru/post/260789/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../260777/index.html">Favicons, Touch Icons, Tile Icons, etc. What to choose?</a></li>
<li><a href="../260779/index.html">Contracts in D</a></li>
<li><a href="../260781/index.html">Why I do not teach SOLID and the "principle of eliminating dependencies"</a></li>
<li><a href="../260783/index.html">Acquaintance with the robotic constructor TRIK: reverse pendulum</a></li>
<li><a href="../260787/index.html">The digest of interesting materials for the mobile developer # 108 (June 15-21)</a></li>
<li><a href="../260791/index.html">Howto Qemu-kvm Debian 8</a></li>
<li><a href="../260795/index.html">Hackathon in deep learning</a></li>
<li><a href="../260797/index.html">What is the best programming language to learn in 2015?</a></li>
<li><a href="../260801/index.html">Writing a wrapper for FUSE in Java Native Runtime</a></li>
<li><a href="../260803/index.html">Beginner site optimization guide. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>