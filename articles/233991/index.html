<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Mojolicious Perl Style</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to describe the programming style in the Perl language, to which I aspire and which I basically adopted from the modern Mojolicious web framewo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Mojolicious Perl Style</h1><div class="post__text post__text-html js-mediator-article">  I want to describe the programming style in the Perl language, to which I aspire and which I basically adopted from the modern <a href="http://mojolicio.us/">Mojolicious</a> web framework, but probably many other similar ones are used.  It seems to me to develop the correct coding style - it is very important. <br><br>  Example 1: <br>  Methods in one line. <br>  If each function argument is called only once, and the order of their application in the code corresponds to the order of the arguments passed, it is proposed to extract them using the standard <i>shift</i> function, which, if called without arguments, by default works with the <i>@_</i> array, which stores all function arguments passed, pushes the first argument out of the array and returns it. <br><pre><code class="perl hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">node</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">shift</span></span>-&gt;tree-&gt;[<span class="hljs-number"><span class="hljs-number">0</span></span>] } <span class="hljs-comment"><span class="hljs-comment"># sub parse { shift-&gt;_delegate(parse =&gt; shift) } # sub _tag { shift-&gt;new-&gt;tree(shift)-&gt;xml(shift) }</span></span></code> </pre> <br>  Example 2: <br>  First, we retrieve the first parameter, the name of the class, for example, we pass all other arguments to another function and let it process them. <br><pre> <code class="perl hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tree</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">shift</span></span>-&gt;_delegate(<span class="hljs-string"><span class="hljs-string">tree =&gt;</span></span> @_) } <span class="hljs-comment"><span class="hljs-comment"># ..     _delegate(tree =&gt; [], deep =&gt; 5)   _delegate(tree =&gt; [], 5, 0) sub log { shift-&gt;emit('message', lc shift, @_) }</span></span></code> </pre><br>  Example 3: <br>  Also for the one line method. <br>  Here, the same argument is accessed as many as 3 times, therefore, to access the argument, a direct access to the element of the $ _ [0] argument array is used. <br><pre> <code class="perl hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> _</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">instance</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> $_[<span class="hljs-number"><span class="hljs-number">0</span></span>] ? $_[<span class="hljs-number"><span class="hljs-number">0</span></span>] : $_[<span class="hljs-number"><span class="hljs-number">0</span></span>]-&gt;singleton } <span class="hljs-comment"><span class="hljs-comment"># sub find { $_[0]-&gt;_collect(@{$_[0]-&gt;_css-&gt;select($_[1])}) }</span></span></code> </pre><br><a name="habracut"></a><br>  Example 4: <br>  You can declare a variable in a conditional one-line <i>if</i> , <i>else if</i> or <i>unless block</i> , and then if the condition is not met, the code will continue to be executed and the new declared variable can then be used there. <br><pre> <code class="perl hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">at</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $self = <span class="hljs-keyword"><span class="hljs-keyword">shift</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">undef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unless</span></span> <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $result = $self-&gt;_css-&gt;select_one(@_); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _tag($self, $result, $self-&gt;xml); }</code> </pre><br>  Example 5: <br>  Declaring a variable and immediately using it in a condition. <br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $tree = $self-&gt;tree)-&gt;[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">ne</span></span> <span class="hljs-string"><span class="hljs-string">'tag'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $tree-&gt;[<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">unless</span></span> $type; <span class="hljs-comment"><span class="hljs-comment"># return if !(my $expires = delete $session-&gt;{expires}) &amp;&amp; $expiration;</span></span></code> </pre><br>  Example 6: <br>  The very useful Mojo :: EventEmitter module, by the way, is exactly the same in Node JS, it is also one of the key modules there, it performs the same functionality, only in my opinion in Mojolicious its code looks much simpler and shorter.  You can use it in your projects that do not even use this framework.  It is necessary to make it basic for your module and using it you can add methods for events, and within some of your own methods you can call them using <i>emit</i> . <br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> Cat; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> Mojo::Base <span class="hljs-string"><span class="hljs-string">'Mojo::EventEmitter'</span></span>; <span class="hljs-comment"><span class="hljs-comment"># Emit events sub poke { my $self = shift; $self-&gt;emit(roar =&gt; 3); } package main; # Subscribe to events my $tiger = Cat-&gt;new; $tiger-&gt;on(roar =&gt; sub { my ($tiger, $times) = @_; say 'RAWR!' for 1 .. $times; }); $tiger-&gt;poke;</span></span></code> </pre><br>  Example 7: <br>  Elimination of memory leaks.  For example, in the Mojo :: EventEmitter module, there is a <i>once</i> method that could have caused a memory leak if it had not used the <i>weaken</i> function. <br>  If you have a link to a function that either uses the variable that references it (directly or indirectly) itself, then <i>weaken</i> (Scalar :: Util) should be used, otherwise there will be a memory leak! <br><pre> <code class="perl hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">once</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> ($self, $name, $cb) = @_; weaken $self; <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $wrapper; $wrapper = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span></span>{ $self-&gt;unsubscribe($name =&gt; $wrapper); $cb-&gt;(@_); }; $self-&gt;on($name =&gt; $wrapper); weaken $wrapper; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $wrapper; } <span class="hljs-comment"><span class="hljs-comment">#   sub timeout { my $self = shift; # weaken $self; $self-&gt;{timer} = $reactor-&gt;timer($timeout =&gt; sub { $self-&gt;emit_safe('timeout')-&gt;close }); return $self; }</span></span></code> </pre><br>  Example 8: <br>  Slice array. <br><pre> <code class="perl hljs">$_ eq $child ? <span class="hljs-keyword"><span class="hljs-keyword">last</span></span> : $i++ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> @$parent[$i .. $#$parent];</code> </pre><br>  Example 9: <br>  You can perform the same action for several variables on one line by typing them separated by a comma in the <i>for</i> loop. <br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">s</span></span>/\%20/\+<span class="hljs-regexp"><span class="hljs-regexp">/g for $name, $value;</span></span></code> </pre><br>  Example 10: <br>  Assignment of one value to several variables at once.  In addition, it is very convenient to assign the value of a class variable or a hash value to a simple variable, which is written shorter and then used in a function or block; for example, it is easier to use it when dereferencing an array or hash, without unnecessary curly braces. <br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $params = $self-&gt;{params} = []; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $params <span class="hljs-keyword"><span class="hljs-keyword">unless</span></span> <span class="hljs-keyword"><span class="hljs-keyword">length</span></span> $str;</code> </pre><br>  Example 11: <br>  If in blocks <i>if</i> , <i>else if</i> or <i>else the</i> code is simple from one expression, then it is better to write the condition and the block in one line. <br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($params-&gt;[$i] eq $name) { <span class="hljs-keyword"><span class="hljs-keyword">splice</span></span> @$params, $i, <span class="hljs-number"><span class="hljs-number">2</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $i += <span class="hljs-number"><span class="hljs-number">2</span></span> }</code> </pre><br>  Example 12: <br>  Using Mojo :: Base as a base for your module.  Enables a number of default pragmas (modules) such as <i>strict</i> , <i>warnings</i> , <i>utf8,</i> and Perl 5.10 innovations. <br>  Adds to our class the <i>has</i> method, a similar style from Moose, which can be used to create class variables in the following way. <br>  If you pass the hash to the class constructor, as in the last line of the example, it initializes the object variables. <br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> Foo; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> Mojo::Base -base; has [<span class="hljs-string"><span class="hljs-string">qw(kept_alive local_address original_remote_address remote_port)</span></span>]; <span class="hljs-comment"><span class="hljs-comment">#          has req =&gt; sub { Mojo::Message::Request-&gt;new }; has max =&gt; 4; #          has str =&gt; 'Hi!'; has list =&gt; sub { [] }; #        has dict =&gt; sub { {} }; #        has hint =&gt; &lt;&lt;EOF; #   See 'APPLICATION help COMMAND' for more information on a specific command. EOF # my $Foo = Foo-&gt;new({kept_alive =&gt;$kept_alive, local_address =&gt; $local_address});</span></span></code> </pre><br>  Example 13: <br>  The method of the base class that you want to override in the child. <br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> Carp <span class="hljs-string"><span class="hljs-string">'croak'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">server_write</span></span></span><span class="hljs-function"> </span></span>{ croak <span class="hljs-string"><span class="hljs-string">'Method "server_write" not implemented by subclass'</span></span> }</code> </pre><br>  Example 14: <br>  Constants, several or one. <br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> constant { <span class="hljs-string"><span class="hljs-string">PC_BASE =&gt;</span></span> <span class="hljs-number"><span class="hljs-number">36</span></span>, <span class="hljs-string"><span class="hljs-string">PC_TMIN =&gt;</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">PC_TMAX =&gt;</span></span> <span class="hljs-number"><span class="hljs-number">26</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> constant <span class="hljs-string"><span class="hljs-string">PC_BASE =&gt;</span></span> <span class="hljs-number"><span class="hljs-number">36</span></span>;</code> </pre><br>  Example 15: <br>  The string containing the variable inside and double quotes, it is better to write so. <br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">die</span></span> <span class="hljs-string"><span class="hljs-string">qq{Unknown command "$name", maybe you need to install it?\n}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unless</span></span> $module; <span class="hljs-comment"><span class="hljs-comment"># sub quote { my $str = shift; $str =~ s/(["\\])/\\$1/g; return qq{"$str"}; }</span></span></code> </pre><br>  Example 16: <br>  Creating a hash variable and then passing it to a function.  Big hash is better to create separately, and not directly in the argument anonymous, so it is more convenient. <br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $options = { <span class="hljs-string"><span class="hljs-string">domain =&gt;</span></span> $self-&gt;cookie_domain, <span class="hljs-string"><span class="hljs-string">expires =&gt;</span></span> $session-&gt;{expires}, <span class="hljs-string"><span class="hljs-string">httponly =&gt;</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">path =&gt;</span></span> $self-&gt;cookie_path, <span class="hljs-string"><span class="hljs-string">secure =&gt;</span></span> $self-&gt;secure }; $c-&gt;signed_cookie($self-&gt;cookie_name, $value, $options);</code> </pre><br>  Example 17: <br>  If a variable is created in a one-line condition block and is planned to be used in a tele block, then it cannot be done, it will be unavailable, therefore you need to declare the variable before the block. <br>  In the second case, in the example, when using the created variable, braces are used in the block, an example of extracting the value from the hash by key is also shown there, if possible, the hash has not yet been created. <br>  // - operator that returns true if one of the expressions is defined, i.e.  not equal to <i>undef</i> . <br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $new; <span class="hljs-keyword"><span class="hljs-keyword">unless</span></span> ($new = $self-&gt;_class($old, $field)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !!<span class="hljs-keyword"><span class="hljs-keyword">defined</span></span> $new } <span class="hljs-comment"><span class="hljs-comment"># if (my $code = ($tx-&gt;req-&gt;error // {})-&gt;{advice}) { $res-&gt;code($code) } # my $stash = {}; if (my $sub = $tx-&gt;can('stash')) { ($stash, $tx) = ($tx-&gt;$sub, $tx-&gt;tx) }</span></span></code> </pre><br>  Example 18: <br>  Performing the same function with different arguments, where the values ‚Äã‚Äãof the array are simple words, it‚Äôs better to use the standard <i>qw</i> function, it‚Äôs not necessary to separate each element with a comma, so it‚Äôs shorter and more beautiful. <br>  In the second case, in the example, the use of the <i>qw</i> function if too many elements of the array must be set manually, it is better to divide it into several lines, separated by commas and call this function in each line. <br><pre> <code class="perl hljs">$self-&gt;plugin($_) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-string"><span class="hljs-string">qw(HeaderCondition DefaultHelpers TagHelpers EPLRenderer EPRenderer)</span></span>; <span class="hljs-comment"><span class="hljs-comment"># my %NORMALCASE = map { lc($_) =&gt; $_ } ( qw(Accept Accept-Charset Accept-Encoding Accept-Language Accept-Ranges), qw(Allow Authorization Cache-Control Connection Content-Disposition), # ... ); #        for my $name (qw(app flash param stash session url_for validation)) { $app-&gt;helper($name =&gt; sub { shift-&gt;$name(@_) }); }</span></span></code> </pre><br>  Example 19: <br>  Such a construction is often used if the first is true and the second is false, so that the second condition is not met, if the first is false.  In the second expression of the example, the <i>$ class</i> variable is created; if it is not empty, and the second expression is false, then we exit the function, if the second expression is true, then we continue execution and in this code we can use this variable. <br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $self-&gt;emit(<span class="hljs-string"><span class="hljs-string">read =&gt;</span></span> $chunk) <span class="hljs-keyword"><span class="hljs-keyword">unless</span></span> $self-&gt;is_compressed &amp;&amp; $self-&gt;auto_relax; <span class="hljs-comment"><span class="hljs-comment"># return unless (my $class = ref $self || $self) &amp;&amp; $attrs; # return unless $self-&gt;cleanup &amp;&amp; defined(my $path = $self-&gt;path);</span></span></code> </pre><br>  Example 20: <br>  Writing single-line expressions that do not fit even on two lines. <br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">warn</span></span> qq/Problem loading URL <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">@{[$tx-&gt;req-&gt;url-&gt;to_abs]}</span></span></span><span class="hljs-string">"</span></span>. ($err-&gt;{message})\n/ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> $err &amp;&amp; !$err-&gt;{code}; <span class="hljs-comment"><span class="hljs-comment"># $app-&gt;helper($_ =&gt; $self-&gt;can("_$_")) for qw(accepts content content_for csrf_token current_route delay), qw(inactivity_timeout is_fresh url_with); # return $self-&gt;error( {message =&gt; 'Maximum buffer size exceeded', advice =&gt; 400}) if $self-&gt;content-&gt;is_limit_exceeded;</span></span></code> </pre><br>  Example 21: <br>  Using eval for example to check module existence. <br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">eval</span></span> <span class="hljs-string"><span class="hljs-string">"use Mojolicious::Lite; 1"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">die</span></span> $@; <span class="hljs-comment"><span class="hljs-comment"># use constant IPV6 =&gt; $ENV{MOJO_NO_IPV6} ? 0 : eval 'use IO::Socket::IP 0.20 (); 1';</span></span></code> </pre><br>  Example 22: <br>  Adding a new method to a class, <i>no strict</i> and <i>no warnings</i> , only acts locally, in a function or block.  It is also worth noting that symbolic links work only with global variables, which is what we need here. <br><pre> <code class="perl hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">monkey_patch</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> ($class, %patch) = @_; <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> strict <span class="hljs-string"><span class="hljs-string">'refs'</span></span>; <span class="hljs-comment"><span class="hljs-comment">#     no warnings 'redefine'; #   ,     *{"${class}::$_"} = $patch{$_} for keys %patch; }</span></span></code> </pre><br>  Example 23: <br>  The ojo.pm module, created specifically to use in the console, write small cool one-liners.  The -M option connects the module and thus the name of the -Mojo framework is obtained.  There some functions are collected, in the import method, the <i>monkey_patch</i> function described above is added.  And now, as shown at the end of the example, you can get the title of any site, for example, here we get the header of the official site Mojolicious or the headers of posts on the main site habrahabr.ru. <br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> ojo; <span class="hljs-comment"><span class="hljs-comment"># sub import { # monkey_patch $caller, # ... g =&gt; sub { _request($ua, 'GET', @_) }, # ... x =&gt; sub { Mojo::DOM-&gt;new(@_) }; #  ,   perl -Mojo -E 'say g("mojolicio.us")-&gt;dom-&gt;at("title")-&gt;text' #     habrahabr.ru perl -Mojo -C -E 'g("habrahabr.ru")-&gt;dom-&gt;find("a.post_title")-&gt;each(sub{ say $_-&gt;text })'</span></span></code> </pre><br>  Example 24: <br>  The function call for each element of the collection, the element is available as the first function argument or through <i>$ _</i> here, as in the example above with the list of post headers.  I would like to emphasize that the peculiarity is that it is made so that each element is accessible through <i>$ _</i> , this is convenient.  In the same way as in standard functions <i>grep</i> , <i>map</i> . <br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> Mojo::Collection; <span class="hljs-comment"><span class="hljs-comment"># sub each { my ($self, $cb) = @_; return @$self unless $cb; my $i = 1; $_-&gt;$cb($i++) for @$self; return $self; } # $dom-&gt;find('p[id]')-&gt;each(sub { say $_-&gt;{id} });</span></span></code> </pre><br>  Example 25: <br>  Creating a random unique value among the hash keys.  Also creating a hash, if it has not yet been created, and just like in the example above, assigning a simple local variable in order to make it easier to use in a block or function. <br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $timers = $self-&gt;{timers} //= {}; <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $id; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { $id = md5_sum(<span class="hljs-string"><span class="hljs-string">'t'</span></span> . steady_time . <span class="hljs-keyword"><span class="hljs-keyword">rand</span></span> <span class="hljs-number"><span class="hljs-number">999</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> $timers-&gt;{$id};</code> </pre><br>  Example 26: <br>  Comment before the block <i>else</i> or <i>else if</i> . <br><pre> <code class="perl hljs">} <span class="hljs-comment"><span class="hljs-comment"># New socket else {</span></span></code> </pre><br>  Example 27: <br>  Using the <i>shift</i> function as a hash key, you must call it with parentheses, otherwise it will be interpreted as a string <i>"shift"</i> . <br>  Also for a reminder, if anyone has forgotten, in this example, accessing immediately to several elements of the hash, deleting several keys at once. <br><pre> <code class="perl hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reset</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> @{<span class="hljs-keyword"><span class="hljs-keyword">shift</span></span>()}{<span class="hljs-string"><span class="hljs-string">qw(io poll timers)</span></span>} } <span class="hljs-comment"><span class="hljs-comment"># sub get { (shift-&gt;{cache} || {})-&gt;{shift()} }</span></span></code> </pre><br>  Example 28: <br>  Overloading operations to work with this object, <i>fallback =&gt; 1 is</i> needed if the overloaded operation is not defined, so that an error does not pop up and that there is a search for a suitable operation. <br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> Mojo::Collection; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> Mojo::Base -strict; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> overload <span class="hljs-string"><span class="hljs-string">bool =&gt;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span></span>{ !!@{<span class="hljs-keyword"><span class="hljs-keyword">shift</span></span>()} }, <span class="hljs-string"><span class="hljs-string">'""'</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">shift</span></span>-&gt;<span class="hljs-keyword"><span class="hljs-keyword">join</span></span>(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>) }, <span class="hljs-string"><span class="hljs-string">fallback =&gt;</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">#     my $collection = Mojo::Collection-&gt;new(qw(just works)); say $collection; say "empty" unless $collection;</span></span></code> </pre><br>  Example 29: <br>  In the block condition <i>for</i> , perhaps there is no reference to the hash. <br><pre> <code class="perl hljs">$self-&gt;_finish($_, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">keys</span></span> %{$self-&gt;{connections} || {}};</code> </pre><br>  Example 30: <br>  Transfer of a long expression with assignment to another string. <br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">my</span></span> $stream = $self-&gt;_loop($c-&gt;{nb})-&gt;stream($id)-&gt;timeout($self-&gt;inactivity_timeout);</code> </pre><br>  Example 31: <br>  Difference between <i>return</i> and <i>return undef</i> .  Just <i>return</i> will return in the context of the list an empty list, in scalar context will return <i>undef</i> .  While <i>return undef</i> in any context returns <i>undef</i> . <br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">undef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> $self-&gt;tree-&gt;[<span class="hljs-number"><span class="hljs-number">0</span></span>] eq <span class="hljs-string"><span class="hljs-string">'root'</span></span>; <span class="hljs-comment"><span class="hljs-comment"># return unless defined $lines-&gt;[0][$num - 1]; #      sub foo { return undef } if (my @x = foo()) { print "oops, we think we got a result"; } # sub foo { return } %x = ('foo' =&gt; foo(), 'bar' =&gt; 'baz'); if (!exists $x{'bar'}) { print "oops, bar became a value, not a key"; }</span></span></code> </pre><br>  Example 32: <br>  Convert any type to boolean. <br><pre> <code class="perl hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">sub</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">has_data</span></span></span><span class="hljs-function"> </span></span>{ !!<span class="hljs-keyword"><span class="hljs-keyword">keys</span></span> %{<span class="hljs-keyword"><span class="hljs-keyword">shift</span></span>-&gt;input} }</code> </pre><br><br>  Well, something like that, the most interesting pieces of code brought here, if anyone is interested, you need to look through <a href="https://github.com/kraih/mojo">GitHub</a> again.  And if you bring your code to this, you should probably get a good application. </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/233991/">https://habr.com/ru/post/233991/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../233979/index.html">Master's degree in Norway</a></li>
<li><a href="../233981/index.html">New Cisco Security Courses</a></li>
<li><a href="../233983/index.html">Habra, karma, ad hominem, leveling and heavy legacy of developed socialism</a></li>
<li><a href="../233985/index.html">Tickle will teach children and teens to create their own games and applications for iOS</a></li>
<li><a href="../233987/index.html">Full cost of the loan (loan) - an example / calculation algorithm</a></li>
<li><a href="../233993/index.html">Career IT project manager. How to get a job in a leading technology company</a></li>
<li><a href="../233995/index.html">Steve Ballmer finally left Microsoft</a></li>
<li><a href="../233997/index.html">What to expect from the new Samsung Galaxy Note 4</a></li>
<li><a href="../233999/index.html">How we protected the administration of the Kaluga region from spam</a></li>
<li><a href="../234001/index.html">BlueJ - java IDE for beginners</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>