<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>New 5 ways to speed up Facebook API requests</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last fall, I posted a post on Habr√© Five ways to speed up Facebook API requests in practice , which turned out to be a good collection of recipes. Dur...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>New 5 ways to speed up Facebook API requests</h1><div class="post__text post__text-html js-mediator-article">  Last fall, I posted a post on Habr√© <a href="http://habrahabr.ru/post/132794/">Five ways to speed up Facebook API requests in practice</a> , which turned out to be a good collection of recipes.  During this time, the Facebook API has changed a lot, becoming even better.  Now I rarely meet tasks with which I could not cope with a single HTTP request to the API.  And all thanks to the new features, which I will talk about now. <br><br><img src="https://habrastorage.org/storage1/3da3ebed/72043ad6/8f917454/6ff9672b.png" alt="image"><br><br>  Here are the ways that were last time: <br><ol><li>  Requesting only required fields <br>  <i>me? fields = id, name, birthday</i> </li><li>  We request data of several objects in one request <br>  <i>? ids = 4,501012028</i> </li><li>  We use filtering and pagination <br>  <i>me / friends? limit = 10 &amp; offset = 10</i> </li><li>  We use FQL queries <br>  <i>fql? q = SELECT uid, name, birthday_date FROM user WHERE uid IN (SELECT uid2 FROM friend WHERE uid1 = me ())</i> </li><li>  We send Batch Request with several requests <br>  <i>batch = [{"method": "GET", "relative_url": "me"}, {"method": "GET", "relative_url": "me / friends? limit = 50"}]</i> </li></ol><br><a name="habracut"></a><br>  All queries can be executed in the <a href="https://developers.facebook.com/tools/explorer/">Graph API Explorer</a> , which now supports FQL queries. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  1) Multi-query </h4><br>  Multi-query are several FQL queries that are sent in a single Graph API query.  Multi-query are processed faster than the same FQL packet of requests sent via the Batch Request.  At the same time, they not only can transmit the answer on several objects, but also solve one of the problems of simple FQL queries. <br><br>  Suppose you want to get a list of users who are going to attend a certain event.  You are writing a FQL query: <br>  <i>SELECT name, url, pic FROM profile WHERE id IN (SELECT uid FROM event_member WHERE eid = 12345678)</i> <br><br>  But such a request gives you all users without giving status information (attending, unsure, declined, not_replied).  All is well, if you need to display information only those who go to the event.  Then you simply add <i>AND rsvp_status = 'attending'</i> to the condition of the <i>subquery</i> .  But what do you do if on one page you need to display all the users, breaking them down by RSVP status.  Make 4 FQL queries with different conditions and send them using batch? <br><br>  Facebook invites you to make two requests and use the data of one in the second.  For our example, the requests will be as follows: <br>  <i>"Query1": "SELECT uid, rsvp_status FROM event_member WHERE eid = 12345678"</i> <br>  <i>"Query2": "SELECT name, url, pic FROM profile WHERE id IN (SELECT uid FROM # query1)"</i> <br>  Now, in one request you will receive all the necessary data, and it will be faster than through batch. <br><br>  Read more about Multi-query in the <a href="https://developers.facebook.com/docs/reference/fql/">documentation</a> . <br><br><h4>  2) Batch Requests containing multiple methods and dependencies between operations </h4><br>  Now in one batch request you can pass different HTTP methods: GET, POST, DELETE.  For example, publish a new status and return the user's news feed in one request.  But the buns are not in this, but in ‚Äúdependencies‚Äù. <br><br>  Initially requests were independent.  But now you can use the data of one request in another, while managing dependencies using <a href="http://code.google.com/p/jsonpath/">JSONPath</a> expressions. <br><br>  The simplest example: get the data of 5 friends.  This can be done using this query: <br>  <i>batch = [{"method": "GET", "name": "get-friends", "relative_url": "me / friends? limit = 5",}, {"method": "GET", "relative_url" : "? ids = {result = get-friends: $. data. *. id}"}]</i> <br><br>  Stop!  So we can do the same with Multi-Query, you say.  Yes, you need to pick another example to show all the power.  And how about this one: <br>  <i>batch = [{"method": "GET", "name": "one-friend", "relative_url": "me / friends? limit = 1",}, {"method": "POST", "relative_url" : ‚ÄúMe / feed‚Äù, ‚Äúbody‚Äù: ‚Äúmessage = {result = one-friend: $. Data.0.name} is my friend‚Äù}]</i> <br>  We get one of the friends of the user and use his data in order to publish a new post.  No need for two separate requests. <br><br>  You can use up to 50 requests in batch, control the behavior of requests using the omit_response_on_success and depends_on parameters, and use different access_token (user, page, application) in different requests.  <a href="https://developers.facebook.com/docs/reference/api/batch/">Batch Requests</a> documentation. <br><br><h4>  3) ETags </h4><br>  At the beginning of the year, Facebook supported <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html">HTTP ETags</a> .  The principle of their work is simple: <br><ol><li>  When you execute a Graph API request, you will receive an ETag header with a value that is a hash of data returned via the API. </li><li>  The next time you call the same request, send an If-None-Match header with the data obtained from clause 1. </li><li>  If the data has not changed, you will receive in response 304 - Not Modified without data. </li><li>  If the data has changed - the data is returned as usual (point 1). </li></ol><br>  Use this preferably with data that does not change often.  For example, you should not use ETags in news feed or post requests.  But for friend list requests in mobile applications on slow connections, performance will certainly increase. <br><br>  More about ETags as well as sample code you can see <a href="https://developers.facebook.com/blog/post/627/">in this post</a> on the developer blog. <br><br><h4>  4) Field expansion </h4><br>  Above, I have already described two ways to get data from linked objects in a single request using Multi-query and Batch with JSONPath.  But for the Graph API requests there is an easier option. <br><br>  For example, we want to display the user name, his birthday and the last 10 photos on the page.  We can do all this with this request: <br>  <i>me? fields = name, birthday, photos.limit (10) .fields (id, picture)</i> <br><br>  Or we want to display comments on the photo, but standard fields are not enough for us, and we want to add another birthday of commentators.  The request is as follows: <br>  <i>&lt;photo_id&gt; /comments?fields=from.fields (id, name, birthday)</i> <br><br>  You can create such queries for all identifiers, fields and connections.  Is not it much easier and more convenient?  <a href="https://developers.facebook.com/docs/reference/api/field_expansion/">Field expansion</a> documentation. <br><br><h4>  5) Pagination </h4><br>  In the last article I already wrote about filtering and pagination using filter and offset.  Although this method is very useful, but it still has one big drawback.  In each query, you display the previous and next links regardless of whether there is data behind them or not. <br><br>  Facebook offers a new solution: cursor-based offset paging.  You will no longer show previous and next if there is no more data.  If there is a previous / next page, the before / after links in the request will be displayed.  You will save ‚Äúone pass‚Äù by viewing each collection of objects. <br><br>  Unfortunately, Cursor-based Pagination is not available for all objects yet.  But it is a matter of time.  Follow the <a href="https://developers.facebook.com/docs/reference/api/pagination/">documentation</a> and use more efficient solutions. <br><br>  Well, if you have used all the features for optimization, do not forget to look at the article <a href="http://habrahabr.ru/post/124195/">Optimizing Facebook Graph API requests using Real-Time Updates</a> . <br><br>  In conclusion, I would like to remind you that Facebook Developer HACK 2012 will be in Moscow on October 1st. If you are unable to attend in person, leave your questions in the comments.  Personally, I have accumulated enough questions for Facebook engineers. </div><p>Source: <a href="https://habr.com/ru/post/151143/">https://habr.com/ru/post/151143/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../151134/index.html">The first chip to measure the strength of Casimir</a></li>
<li><a href="../151135/index.html">How to watch videos with two subtitle streams</a></li>
<li><a href="../151137/index.html">WebStorm 5 Released - Become More Productive</a></li>
<li><a href="../151139/index.html">Demos from the Past - United Crackers League (UCL)</a></li>
<li><a href="../151141/index.html">Ubuntu 12.10 Quantal Quetzal (Quantum Quetzal / Quezal)</a></li>
<li><a href="../151145/index.html">ISN Digest # 0. Using sensors and optimizing power consumption in Windows 8 applications</a></li>
<li><a href="../151146/index.html">Conference "Windows Azure Cloud Platform for Mobile Applications"</a></li>
<li><a href="../151148/index.html">RailsClub'Moscow 2012. Interview with Wynn Netherland</a></li>
<li><a href="../151150/index.html">web and MVC: debriefing</a></li>
<li><a href="../151152/index.html">Client for SOAP API Russian Post in Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>