<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The story of Ruby on Windows Azure</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ruby developers could use Windows Azure from the earliest stage of platform development, and every year Ruby platform support increased both through t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The story of Ruby on Windows Azure</h1><div class="post__text post__text-html js-mediator-article">  Ruby developers could use Windows Azure from the earliest stage of platform development, and every year Ruby platform support increased both through the creation and development of Ruby development tools for Windows Azure, and indirectly ‚Äî for example, with the release of virtual machines, the possibility of developing Ruby applications in IaaS-environment.  For those who do not want to perplex themselves with infrastructural realities, there is already a pre-configured Ruby image in the VMDepot virtual machine storage.  Below I will talk about several ways to develop Ruby in Windows Azure, which of these methods will be more convenient - you decide. <br><a name="habracut"></a><br>  Having studied the milestones of the development of the platform in the direction of development for Ruby, there are several stages, each of which is important in its own way: <br><br>  ‚Ä¢ Creating a Windows Azure SDK for Ruby ( <a href="http://www.windowsazure.com/en-us/develop/ruby/">Windows Azure SDK Ruby</a> ), with which you can use various Windows Azure services from a Ruby application.  This is a very important milestone, since without the efforts that the platform vendor itself invests in a specific direction, it will not be possible to say that this direction is a full-fledged ‚Äúinhabitant‚Äù of the ecosystem.  Like many other Microsoft tools, the Ruby SDK is Open Source and is located on GitHub - <a href="https://github.com/WindowsAzure/azure-sdk-for-ruby">github.com/WindowsAzure/azure-sdk-for-ruby</a> <br>  ‚Ä¢ Publication of IaaS in the form of virtual machines.  With this, everything is clear - you can make a virtual server for yourself. <br>  ‚Ä¢ Exit to <a href="http://vmdepot.msopentech.com/">VMDepot</a> image <a href="http://vmdepot.msopentech.com/">storage</a> .  For those who want to get a ready-made image and start working immediately. <br><br><h4>  Method 1: Windows Azure Linux Server, Ubuntu 12.04 LTS <br></h4><br>  Manually deploy a Linux server and set up a working environment for you.  To do this, go to <a href="http://manage.windowsazure.com/">the</a> Windows Azure <a href="http://manage.windowsazure.com/">Management Portal</a> and click New =&gt; COMPUTE =&gt; VIRTUAL MACHINE =&gt; QUICK CREATE. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Enter the data: <br><br>  ‚Ä¢ DNS NAME: the name under which the virtual machine will be accessible from the outside <br>  ‚Ä¢ IMAGE: the image from which the virtual machine will be deployed.  Choose Ubuntu Server 12.04 LTS. <br>  ‚Ä¢ SIZE: one of the available VM sizes.  Choose Medium. <br>  ‚Ä¢ USER NAME: the default is azureuser.  Cannot be changed on the portal. <br>  ‚Ä¢ NEW PASSWORD / CONFIRM: password. <br>  ‚Ä¢ REGION / AFFINITY GROUP: region in which the VM will be located, or affine group (to ensure maximum proximity within the data center). <br><br>  For more precise settings, choose FROM GALLERY - more settings will be available. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/74b/cd2/867/74bcd286772fcaf51ebc2e57070f8c8a.png"><br><br>  Connection data (for example, by Putty) is obtained after clicking on the VM name in the SSH Details section of the Dashboard tab. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2b9/682/178/2b96821785b48c9af5ed99600c36c1bf.png"><br><br>  Run the sudo apt-get update command.  Do not forget to use sudo on VM under Linux, this is additional security and confidence.  Further it is desirable to install for convenience window manager: <br><br><pre><code class="bash hljs">sudo apt-get install ubuntu-desktop</code> </pre> <br><br>  Enable RDP access to the GUI.  This is done on the Endpoints tab: you need to click Add and enter data - an access point using the TCP protocol and a port value of 3389. <br>  In the VM, install xrdp: <br><br><pre> <code class="bash hljs">sudo apt-get install xrdp</code> </pre><br><br>  Now you can set the environment for Ruby on Rails: <br><br><pre> <code class="bash hljs">sudo apt-get upgrade sudo apt-get install ruby1.9.1 ruby1.9.l-dev build-essential libsqlite3-dev nodejs -y sudo gem install bundler ‚Äìno-rdoc ‚Äìno-ri sudo apt-get -y install git-core curl curl -L https://get.rvm.io | bash -s stable</code> </pre><br><br>  We will also install Ruby Version Manager (RVM), which is useful for managing different versions of Ruby and other features.  Add RVM to the environment: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'source ~/.rvm/scripts/rvm'</span></span> &gt;&gt; ~/.bash_aliases &amp;&amp; bash</code> </pre><br><br>  And check if everything is set to work correctly: <br><br><pre> <code class="bash hljs">rvm requirements</code> </pre><br>  If everything is in order, you can install Ruby and specify it to use the default: <br><br><pre> <code class="bash hljs">rvm install 1.9.3 rvm use 1.9.3 ‚Äìdefault</code> </pre><br><br><h4>  Method 2: Install VM from VMDepot </h4><br>  From VMDepot, you can install pre-configured community VM images, and they will be automatically deployed and run on Windows Azure in your account. <br>  Let's go straight to the <a href="http://vmdepot.msopentech.com/Vhd/Show%3FvhdId%3D7678%26version%3D8714">page of the</a> desired image. <br>  Click DEPLOYMENT SCRIPT to get the deployment script.  The script is designed for the Azure CLI, and if you do not have the CLI installed, you will not be able to use it (you can download it from the <a href="http://www.windowsazure.com/en-us/develop/nodejs/how-to-guides/command-line-tools/">link</a> ). <br>  Run CLI.  Next, run the following commands to configure the environment for the CLI: <br><br><pre> <code class="bash hljs">azure account download (     ) azure account import [____] azure storage account list (    ,   ,  ) azure storage account <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> [__]</code> </pre><br><br>  After all commands have been executed, the script copied from VMDepot can be executed.  This will take some time, after which the new VM will appear in the VM list on the Windows Azure management portal.  This VM is an excellent set of various development environments and environments, including PHP, Ruby, Python, Java and various frameworks, as well as such DBMS as mysql, postgresql, and apache / nginx. <br><br><h4>  Method 3: PaaS, Ruby + Sinatra + Azure </h4><br><br>  As PaaS on Windows Azure, the concept of Cloud Service is used - an application consisting of several traditional projects (frontend and backend, for example) and one new one - the Cloud Service itself, which contains all the configuration used by the platform to deploy and configure the application in the cloud.  You can read more <a href="http://msdn.microsoft.com/ru-ru/jj656840.aspx">here</a> . <br><br>  Create a Cloud Service project in Visual Studio and add Worker Role to it.  In this role project, the installation of the Ruby environment and application will occur.  Now you need to download the Ruby installer - we will put it in Worker Role, on which VM the environment will then be deployed.  The installer can be downloaded from RubyInstaller.com.  Add the installer to the Worker Role project and set the Copy to output directory attribute to Copy if newer so that it is included in the package.  Add the file install.cmd with the same value of the Copy to output directory attribute and the following content: <br><br><pre> <code class="bash hljs">rubyinstaller-2.0.0-p0-x64.exe /silent D:\Ruby200-x64\bin\gem.bat install sinatra --no-ri --no-rdoc</code> </pre><br><br>  All files must be saved with US-ASCII encoding, otherwise errors may occur. <br>  Add the main.rb file to Worker Role with the value of the copy if newer attribute and content: <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'sinatra'</span></span> set <span class="hljs-symbol"><span class="hljs-symbol">:environment</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:production</span></span> set <span class="hljs-symbol"><span class="hljs-symbol">:port</span></span>, <span class="hljs-number"><span class="hljs-number">8080</span></span> get <span class="hljs-string"><span class="hljs-string">'/'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-string"><span class="hljs-string">"Hello World!"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  Add a start.cmd file with the same attribute value and the following content: <br><br><pre> <code class="bash hljs">D:\Ruby200-x64\bin\ruby.exe main.rb</code> </pre><br>  However, everything will not automatically start, so you need to make adjustments to the configuration of the role itself in the project Cloud Service.  Open the ServiceDefinition.csdef file and add the code highlighted below: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ServiceDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RubyTest"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/ServiceHosting/2008/10/ServiceDefinition"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">schemaVersion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2013-10.2.2"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WorkerRole</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"WorkerRole1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">vmsize</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Small"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Startup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Task</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">commandLine</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"install.cmd"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">executionContext</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"elevated"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">taskType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"simple"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Task</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Task</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">commandLine</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"start.cmd"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">executionContext</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"elevated"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">taskType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"background"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Task</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Startup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Imports</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Import</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">moduleName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Diagnostics"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Imports</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Endpoints</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">InputEndpoint</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Endpoint1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">protocol</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tcp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">port</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"80"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">localPort</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"8080"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Endpoints</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">WorkerRole</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ServiceDefinition</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Thus, we set up the configuration so that when the VM starts, the install.cmd and start.cmd files will be launched with elevated privileges, and port 80 (for external clients) will be opened, which will redirect traffic to the internal port 8080. <br>  Now, if you have a Windows Azure emulator installed, you can press F5 (during startup, pay attention to the startup files ‚Äî these are install.cmd and start.cmd) and watch the result at <a href="http://localhost/">localhost</a> : 81 (the local emulator automatically remaps from 80 port 81 to avoid conflicts). <br><br>  The process of further development can be divided into several stages: <br>  1) Creation of software code and .rb files <br>  2) Perform modification of the install.cmd and start.cmd files, or develop new executable files, to automate changes or create a completely new development environment and edit the corresponding section in ServiceDefinitions.csdef <br>  3) Entering the commands for managing the program code in start.cmd <br><br>  In this article, I briefly reviewed the deployment of the simplest Ruby development ecosystem.  Then the choice is yours - to develop locally or have a constantly accessible development environment with which you can do anything, and which you can go from anywhere - according to the latest data, this is becoming more and more important.  :) <br><br>  UPD: and even in the comments suggest that there is an <a href="http://www.windowsazure.com/en-us/gallery/store/engine-yard-platform-as-a-service/engine-yard-platform-as-a-service/">addon</a> for automation.  We take and use.  :) <br><br></div><p>Source: <a href="https://habr.com/ru/post/214763/">https://habr.com/ru/post/214763/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../214743/index.html">Google maps auto travel planning</a></li>
<li><a href="../214745/index.html">How can using randomness help make your code faster? Lecture of Michael Sluggish in Yandex</a></li>
<li><a href="../214755/index.html">Using DSP SB Live! for the benefit of radio amateurs (KX Driver's) - Part [1/2]</a></li>
<li><a href="../214759/index.html">We program robots on Windows 8. We control Sphero from a tablet using an accelerometer and a collision sensor</a></li>
<li><a href="../214761/index.html">Only developers of the 90s remember this.</a></li>
<li><a href="../214765/index.html">Prudence</a></li>
<li><a href="../214767/index.html">Conference DUMP-2014: Section "Analytics"</a></li>
<li><a href="../214769/index.html">Start problem</a></li>
<li><a href="../214771/index.html">BPM or ERP?</a></li>
<li><a href="../214775/index.html">Free HTML5 Font Editor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>