<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>An overview of the capabilities of PlayCanvas for creating Web VR applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PlayCanvas is a visual platform for developing interactive web applications. Everything developed with PlayCanvas is based on HTML5 features. PlayCanv...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>An overview of the capabilities of PlayCanvas for creating Web VR applications</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/mu/fu/yq/mufuyqm46wxnzg_gaz5wyehcajs.png"><br><br>  <a href="https://github.com/playcanvas">PlayCanvas</a> is a visual platform for developing interactive web applications.  Everything developed with PlayCanvas is based on HTML5 features.  PlayCanvas is a web application, which means you do not need to install special programs and you can access your project from any device anywhere in the world via the Internet.  All projects that you create can be placed on the network with just one click. <br><a name="habracut"></a><br><h2>  Workflow in PlayCanvas </h2><br><img src="https://habrastorage.org/webt/ws/oo/di/wsoodieak3-adlz0md5-wl_ojlc.png"><br><br>  Everything in PlayCanvas starts with a visual editor. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      On the left side of the screen is the entity hierarchy section.  It allows you to create as empty entities, and already pre-installed, such as: cameras, light, primitives, audio, interfaces, particle systems or models.  Any entity added to the hierarchy automatically enters the scene. <br><br>  In the center of the screen is the scene editor.  Here you can change the location of the entities, select them for editing and simply view what your application's scene will look like. <br><br>  At the bottom of the scene editor is the Assets section.  Assets are all files and other elements that can be added to your entities.  There are several types of assets in PlayCanvas: folder, css, cubemap, HTML, JSON, material, script, shader and text.  They all have a different purpose. <br><br>  And finally, on the right side of the screen is the section of the properties of the entity.  An entity has basic properties: location, rotation, scale, name, tags, settings for added components.  Properties change depending on which entity is added.  For example, if we add a cube, it will have the following properties: type, material, shadow settings, layers, and groups. <br><br>  The overall process of developing applications and games in PlayCanvas looks something like this: <br><br><ol><li>  We add the necessary assets.  For example: models, materials, audio, video. </li><li>  Create the environment of our scene.  For example: city, house, landscape. </li><li>  Add interactive elements.  For example: the player and his enemies. </li><li>  Add application logic using scripts. </li><li>  We publish a game or application online. </li></ol><br><h2>  PlayCanvas and JavaScript </h2><br><img src="https://habrastorage.org/webt/ba/ho/_t/baho_trfpv1_buk71c4wj8gfzqi.png"><br><br>  To add logic to our game or application in PlayCanvas there is a special component: a script.  Scripts can be global, in which case they should be added to the root of the scene hierarchy.  Local scripts are added directly to the entity within the hierarchy (for example, to the game character model).  All scripts must be written in JavaScript.  after all we write games in the browser.  Lovers of ES6, unfortunately, are disappointed, because  PlayCanvas is still using ES5, and when I try to write any construction from ES6, the built-in linter will start to swear.  In general, the script anatomy is the following pattern: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NewScript = pc.createScript(<span class="hljs-string"><span class="hljs-string">'newScript'</span></span>); NewScript.attributes.add(<span class="hljs-string"><span class="hljs-string">'someString'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'string'</span></span>, <span class="hljs-attr"><span class="hljs-attr">default</span></span>: <span class="hljs-string"><span class="hljs-string">'any'</span></span>, <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">'Some string'</span></span> }); NewScript.prototype.initialize = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.startPosition = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.entity.getPosition(); }; NewScript.prototype.update = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dt</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.entity.setLocalPosition(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.newPosition); }; NewScript.prototype.calcaulateNewPosition = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.newPosition = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.startPosition.dot(pc.Vec3.ZERO) };</code> </pre> <br>  Here we create a new script.  It gets two main methods: initialize - will be called when the entity is added to the scene.  Update - every frame is called.  The dt parameter in update is delta time -% of the second for which the last frame was drawn.  This is well illustrated by the following example: you need to rotate a certain object in one second by 360 degrees.  We write the following code: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.entity.rotate(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">360</span></span> * dt, <span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre> <br>  Finally, the last <i>calcaulateNewPosition</i> method is a custom method and can be used to structure the code. <br><br>  Also in the code there is the ability to add a new attribute <i>someString</i> .  This design allows you to define parameters that can later be set through the editor interface.  To add a script to the selected entity and click the <b>‚ÄúParse‚Äù</b> button.  If the script had a construction with attributes, then a special field will appear to fill in the value.  This value will override the default value.  PlayCanvas supports many different types of attributes for the script.  Read more about this <a href="https://developer.playcanvas.com/en/api/pc.ScriptAttributes.html">here</a> . <br><br>  You can edit scripts both in the built-in editor and on your local machine in an IDE that is convenient for you.  But in the second case, you will have to play around with the settings, because you need to raise the server associated with PlayCanvas. <br><br>  Well, now that we‚Äôve sorted out the main features of PlayCanvas, we can talk about how to create virtual reality scenes in PlayCanvas. <br><br><h2>  VR out of the box </h2><br><img src="https://habrastorage.org/webt/ih/qs/rb/ihqsrbmkce9ju7q-dzb93z8c7oa.png"><br><br>  PlayCanvas allows you to create a VR scene out of the box.  To do this, select the appropriate option (VR Starter Kit) when creating a new project.  So, let's see what PlayCanvas offers to us by default (spoiler: not as much as we would like). <br><br>  Running the scene, you will see three cubes in front of you.  When you look at them (gaze control), the progress bar will be launched, which will make the cube transparent.  No controllers and WASD control for PC.  In fact, this control allows you to create a small application for cardboards, because there, by default, there is support for touch events. <br><br>  The code of our starting VR set is actually not very well structured and some parts of it are directly tied to the logic of this scene.  That is, to make something of your own, you will have to figure out how it all works and adapt it to your needs.  There is no API that allows you to connect any functionality separately. <br><br>  Now let's try to go through the start-up files to figure out what is responsible for what and how it can be used for your purposes. <br><br><ul><li>  <b>look-camera.js</b> .  Here is the logic that is responsible for the pairing of the VR display and the camera.  In addition, using mouse-controller.js or touch-controller.js, we can transmit pitch and yaw to control the camera from a PC or mobile phone. </li><li>  <b>selector-camera.js</b> .  This file has hidden logic for the implementation of eye control.  Each element that is available for interaction must be added through the selectorcamera event: add.  Moreover, its <a href="https://ru.wikipedia.org/wiki/AABB">AABB</a> must be calculated manually. Also here you can find the logic of the ray (ray \ raycaster).  In PlayCanvas there is a special object this._ray = new pc.Ray ();  which is able to find intersections with <a href="https://developer.playcanvas.com/en/api/pc.BoundingBox.html">BoundingBox</a> or <a href="https://developer.playcanvas.com/en/api/pc.BoundingSphere.html">BoundingSphere</a> . </li><li>  <b>web-vr-ui.js</b> .  Just adds a VR login interface.  Frankly, this is not done very elegantly.  All styles and HTML are right in this script.  Apparently this was done due to the fact that the <a href="https://developer.playcanvas.com/en/user-manual/packs/components/screen/">2D Screen</a> for interfaces has its limitations, and the button should be located strictly in the lower right corner. </li><li>  <b>box.js</b>  Here we will find all the logic associated with the cube - management of the scale of progress, etc. </li></ul><br>  As can be seen from the above, in the starting VR set there‚Äôs nothing to count on.  All that can be done is an application for a cardboard and this, in my opinion, is not very interesting, because cardboards are a kind of toy that does not give an idea of ‚Äã‚Äãthe normal experience of using VR.  You can really dive into virtual reality with Oculus Go, Oculus Rift or HTC Vive. <br><br>  And now let's talk about how we can add controller support to our application. <br><br><h2>  VR controllers </h2><br><img src="https://habrastorage.org/webt/tu/ev/9f/tuev9fuqge3rucidyes50bkmaeo.png"><br><br>  It would be nice if PlayCanvas adapted its <a href="https://store.playcanvas.com/">storage</a> so that with one button you can connect various elements to your application that are connected with the necessary logic.  But today it is impossible to do so, so let's try to do it differently.  In order not to write all the logic for comparing the position of the controllers, we can use already existing solutions.  There is a great example of <a href="https://developer.playcanvas.com/ru/tutorials/webvr-lab/">Web VR Lab</a> .  There are many interesting things there, but according to the code ... the devil himself will break his leg.  There is also a small <a href="https://developer.playcanvas.com/en/tutorials/webvr-tracked-controllers/">VR Tracked Controllers</a> scene - just a base scene with two controllers.  Here it is just the same and is suitable for borrowing items in your project. <br><br>  Open the VR Tracked Controllers scene for editing.  First we need to move the controller: <br><br><ol><li>  Select the controller, in the properties section we find the model, click on it, get on it as an asset. </li><li>  In the settings there will be a Download button, which we click and download the model and textures. </li><li>  Unzip the assets and load them into your application.  To do this, simply drag them to the asset window, which is located below.  You need to transfer everything: a model in JSON format and all textures. </li><li>  The model will appear in our list of assets.  Drag it onto the stage.  And now she is already there.  Let's call it Left Controller. </li></ol><br>  Now we need to add material: <br><br><ol><li>  Create a new material by clicking on the <b>‚Äú+‚Äù</b> button on the asset panel.  Let's call the material Controller Material. </li><li>  Now you need to open the source project and find the tracked-controller material there and copy all the settings into our material, including normals, emissive, specular and diffuse maps (maps). </li></ol><br>  Now you can copy the controller using the special Duplicate button on the hierarchy panel and name the second controller Right Controller. <br><br>  Everything, controllers at us on a scene.  But for now these are just two models and in order for it to work, we need to move the scripts.  Let's take a closer look at what is needed there and how it works: <br><br><ul><li>  <b>vr-gamepad-manager.js</b> - essentially contains all the necessary logic for your controllers to get the position and rotation of the real controller.  There is a fake elbow logic implemented for 3-dof helmets such as Oculus Go, Gear VR or Daydream.  _updatePadToHandMappings here is responsible for detecting controllers and mapping them to our controllers.  The whole logic of mapping a real and virtual controller is in the _poseToWorld function.  In fact, the data from the WebXR API is taken through the controller instance itself - padPose.position, padPose.poseRotation.  The logic, which is further, is responsible for the nuances associated with different types of devices.  The script itself must be global (that is, added to the root of the hierarchy). </li><li>  <b>input-vr.js</b> - responsible for registering our controllers and working with buttons.  In fact, it simply determines the pressing of the buttons and sends the number of the pressed button.  This is not very convenient, since different devices may have different buttons and the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Gamepad_API/Using_the_Gamepad_API">GamePad API</a> , and it‚Äôs not a fact that the first button on the Oculus Go will be the trigger for the HTC Vive controller.  Therefore, you have to manually map.  This script needs to be connected to the controller element. </li></ul><br>  If everything is done correctly, you will be able to enter virtual reality and wave your controllers.  Not bad, although the process of integrating the necessary functionality is rather inconvenient and tedious. <br><br><h2>  Total </h2><br>  PlayCanvas is an excellent engine that you can use to create WebGL games or applications.  But, you have to admit that it is poorly adapted for WebVR.  It seems that the task was set to demonstrate that PlayCanvas can, in order to stir up the interest of the public.  But the development of this direction, apparently, has not received.  Therefore, you can make a VR game or application, but you will have to copy a lot and understand the confusing code that was created only for demonstration (Web VR Lab). <br><br>  In the next article, I would like to conduct a small lesson on how to create a teleport control, so that we have some kind of set that allows you to start a Web VR game or application.  Thank you all for your attention! </div><p>Source: <a href="https://habr.com/ru/post/445692/">https://habr.com/ru/post/445692/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445676/index.html">New in git 3: closures</a></li>
<li><a href="../445678/index.html">4. Check Point Getting Started R80.20. Installation and Initialization</a></li>
<li><a href="../445682/index.html">PVS-Studio for Java is sent to the path. Next stop - Elasticsearch</a></li>
<li><a href="../445684/index.html">Monoblock vs. modular UPS</a></li>
<li><a href="../445686/index.html">Developing an application for an old PDA (Cybiko Xtreme) in 2019</a></li>
<li><a href="../445696/index.html">How are robots created that can pass in the same place as we</a></li>
<li><a href="../445698/index.html">NanoCAD licensing</a></li>
<li><a href="../445700/index.html">‚Äú33 words about design‚Äù: who and why makes a movie about design in Russia</a></li>
<li><a href="../445702/index.html">SlowPochta - messenger of non-guaranteed message delivery with indefinite forwarding time</a></li>
<li><a href="../445704/index.html">Citymobil - a guide for startups to increase stability against the background of growth. Part 2. What are the types of accidents?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>