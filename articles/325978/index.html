<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>WebRTC, Safari</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last April, a press release rolled around the network that Apple was rolling out WebRTC support in Safari browsers for Mac OS and iOS. Since the relea...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>WebRTC, Safari</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/214/344/1c1/2143441c12084cad878446094574736a.png"></div><br>  Last April, a press release rolled around the network that Apple was rolling out WebRTC support in Safari browsers for Mac OS and iOS.  Since the release of the press release, exactly one year will soon pass, as Apple continues to roll out WebRTC for Safari.  We wait. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/89c/9bc/f66/89c9bcf66dd74025946df4ed6ca086c6.png"></div><br>  However, not everyone is waiting.  Someone needs a real-time video in Safari right now and in this article we will explain how to do without WebRTC in the iOS Safari and Mac OS Safari browser and how you can replace it. <a name="habracut"></a><br><br>  Today we know the following options: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Hls </li><li>  Flash </li><li>  Websockets </li><li>  WebRTC Plugin </li><li>  iOS native app </li></ul><br>  Since we are looking for an alternative to RTC (Real Time Communication), we compare these options not only on iOS / Mac OS platforms, but also on average delay (Latency) in seconds. <br><table><tbody><tr><td></td><td>  <b>iOS</b> </td><td>  <b>Mac OS</b> </td><td>  Latency </td></tr><tr><td>  HLS, DASH </td><td>  <font color="#088A08"><b>Yes</b></font> </td><td>  <font color="#088A08"><b>Yes</b></font> </td><td>  15 </td></tr><tr><td>  Flash rtmp </td><td>  Not </td><td>  <font color="#088A08"><b>Yes</b></font> </td><td>  3 </td></tr><tr><td>  Flash RTMFP </td><td>  Not </td><td>  <font color="#088A08"><b>Yes</b></font> </td><td>  one </td></tr><tr><td>  Websockets </td><td>  <font color="#088A08"><b>Yes</b></font> </td><td>  <font color="#088A08"><b>Yes</b></font> </td><td>  3 </td></tr><tr><td>  WebRTC Plugin </td><td>  Not </td><td>  <font color="#088A08"><b>Yes</b></font> </td><td>  0.5 </td></tr></tbody></table><br><h3>  Hls </h3><br>  As can be seen from this table, HLS completely drops out of real-time with its 15 or more seconds of delay, although it works fine on both platforms. <br><br><h3>  Flash rtmp </h3><br>  Despite the fact that Flash is dead, it continues to work on Mac OS and gives a real-time delay.  But things on Flash on Safari really are not very.  It happens that Flash is simply disabled. <br><br><h3>  Flash RTMFP </h3><br>  Same as Flash RTMP, with the only difference being that it works via UDP and can drop packets, which is undoubtedly better for realtime.  Good delay.  Does not work on iOS. <br><br><h3>  Websockets </h3><br>  Some alternative for HLS if you need a relatively low latency.  Works in iOS and Mac OS. <br><br>  In this case, the video stream comes through Websockets (RFC6455), is decoded at the JavaScript level, and drawn to the <b>HTML5 canvas</b> using <b>WebGL</b> .  This method works much faster than HLS, but has its drawbacks: <br><br><ol><li>  One-way delivery. You can only play the stream in real-time, but you cannot capture it from the device's camera and send it to the server. </li><li>  Restrictions on permission.  With a resolution of 800x400 and higher, we need an already powerful CPU on the latest iPhone or iPad for smooth decoding of such a stream into JavaScript.  With iPhone5 and iPhone6, the resolution will most likely not be able to be raised above 640x480 and left smooth. </li></ol><br><h3>  WebRTC Plugin </h3><br>  On Mac OS, you can install the WebRTC plugin that implements WebRTC.  This certainly gives the best latency, but it does require the user to download and install third-party software.  It can be fairly noted that Adobe Flash Player is also a plugin and may also require manual installation, but Adobe's ‚Äúdead flash‚Äù plugin obviously surpasses Noname WebRTC plugins in terms of prevalence.  In addition, WebRTC plugins do not work in iOS Safari. <br><br><h2>  Other WebRTC Alternatives for iOS </h2><br>  If you are not limited to the Safari browser, you can consider the following options: <br><br><h3>  iOS native app </h3><br>  Implement an iOS application with WebRTC support and get low latency and all the power of WebRTC technology.  Not a browser.  Requires installation from the App Store. <br><br><h3>  Bowser </h3><br>  Browser with WebRTC support for iOS.  They say that supports WebRTC, but we have not tested.  Not very popular browser.  But if you can force users to use it, you can try to do it. <br><br><h3>  Ericsson </h3><br>  Same as Bowser.  It is not clear how well it works with WebRTC.  Not popular on iOS. <br><br><h3>  Waiting </h3><br>  You can wait for the introduction of Apple's WebRTC.  A year has passed.  Perhaps it remains to wait not so long.  Maybe someone has an insider? <br><br><h2>  Websockets as a replacement for WebRTC on iOS </h2><br>  The table above shows that on iOS Safari there are only two options: <b>HLS</b> and <b>Websockets</b> .  The first has a delay of more than <b>15 seconds</b> .  The second has its limitations and a delay of about <b>3 seconds</b> .  There is <b>MPEG DASH</b> , but this is the same HLS / HTTP in terms of realtime. <br><br>  Due to the above limitations: <br><br><ul><li>  JavaScript decoding and low resolution support </li><li>  One-way streaming (playback only) </li></ul><br>  Web sockets, of course, cannot claim to be a full replacement for WebRTC in the iOS Safari browser, but allow you to play real-time streams right now. <br><br>  In this case, the real-time broadcast scheme looks like this: <br><br><ol><li>  We send a WebRTC video stream, for example, from Mac OS or Win, the Chrome browser to a WebRTC server with support for converting to webboxes. </li><li>  The WebRTC server converts the stream to MPEG + G.711 and wraps it in the Websockets transport protocol. </li><li>  iOS Safari establishes a connection to the server using the Websockets protocol and collects the video stream.  Next, it unpacks the video stream and decodes the audio and video.  Audio plays through the Web Audio API, and video renders to Canvas using WebGL. </li></ol><br><div style="text-align:center;"><img src="https://habrastorage.org/files/3aa/3e7/7ff/3aa3e77ffbe54a55b78d8390e531e7ee.png"></div><br><br><h2>  Testing Websockets playback in iOS Safari </h2><br>  The server used is Web Call Server 5, which supports this conversion and sends the stream to iOS Safari via Websockets.  The source of a real-time video stream can be a webcam that sends video to the server or an IP camera that uses RTSP. <br><br>  This is how sending a real-time WebRTC video stream to a server in Google Chrome browser from the desktop: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f52/0e2/531/f520e253155c4755be900e1f8ffedc04.png"></div><br>  And this is the playback of the same video stream in realtime, in the iOS Safari browser: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/591/d70/608/591d7060848f4e4ba1f95a743d8e7471.png"></div><br>  Here we have specified <b>d3c6</b> as the name of the video stream, i.e.  The video stream that was sent from the Chrome browser via WebRTC. <br><br>  In case the video stream is taken from an IP camera, in iOS Safari it will look like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a5a/d94/6ad/a5ad946ad8544fb1819b3dd7d539ec34.png"></div><br>  As you can see from the screenshot, we used the RTSP address as the video stream name.  The server took the RTSP stream and converted it to Websockets for iOS Safari. <br><br><h2>  Integration of the player for iOS Safari into a web page </h2><br>  The source code of the player is available <a href="https://github.com/flashphoner/flashphoner_client/tree/wcs_api-2.0/examples/demo/streaming/player">here</a> .  However, the link player works not only for iOS Safari.  It can switch between three technologies: WebRTC, Flash, Websockets in order of priority and contains a bit more code than is required for playback in iOS Safari. <br><br>  Let's try to minimize the player code to demonstrate the minimum configuration that will play in iOS Safari <br><br>  The minimal code of the HTML page will look like this: <b>player-ios-safari.html</b> <br><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">language</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"flashphoner.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">language</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"player-ios-safari.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onLoad</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"init_page()"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>The player<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"remoteVideo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width:320px;height:240px;border: 1px solid"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"start"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"start()"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"status"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  From this code, you can see that the main element on the page is a div block. <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"remoteVideo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width:320px;height:240px;border: 1px solid"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  It is this block that will be responsible for playing the video after the API scripts insert the HTML5 Canvas there. <br><br>  Next comes the player script.  Script size: 80 lines: <b>player-ios-safari.js</b> <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> SESSION_STATUS = Flashphoner.constants.SESSION_STATUS; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> STREAM_STATUS = Flashphoner.constants.STREAM_STATUS; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> remoteVideo; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stream; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init_page</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//init api try { Flashphoner.init({ receiverLocation: '../../dependencies/websocket-player/WSReceiver2.js', decoderLocation: '../../dependencies/websocket-player/video-worker2.js' }); } catch(e) { return; } //video display remoteVideo = document.getElementById("remoteVideo"); onStopped(); } function onStarted(stream) { //on playback start } function onStopped() { //on playback stop } function start() { Flashphoner.playFirstSound(); var url = "wss://wcs5-eu.flashphoner.com:8443"; //create session console.log("Create new session with url " + url); Flashphoner.createSession({urlServer: url}).on(SESSION_STATUS.ESTABLISHED, function(session){ setStatus(session.status()); //session connected, start playback playStream(session); }).on(SESSION_STATUS.DISCONNECTED, function(){ setStatus(SESSION_STATUS.DISCONNECTED); onStopped(); }).on(SESSION_STATUS.FAILED, function(){ setStatus(SESSION_STATUS.FAILED); onStopped(); }); } function playStream(session) { var streamName = "12345"; var options = { name: streamName, display: remoteVideo }; options.playWidth = 640; options.playHeight = 480; stream = session.createStream(options).on(STREAM_STATUS.PLAYING, function(stream) { setStatus(stream.status()); onStarted(stream); }).on(STREAM_STATUS.STOPPED, function() { setStatus(STREAM_STATUS.STOPPED); onStopped(); }).on(STREAM_STATUS.FAILED, function() { setStatus(STREAM_STATUS.FAILED); onStopped(); }); stream.play(); } //show connection or remote stream status function setStatus(status) { //display stream status }</span></span></code> </pre><br>  The most important parts of this script are API initialization. <br><br><pre> <code class="javascript hljs">Flashphoner.init({ <span class="hljs-attr"><span class="hljs-attr">receiverLocation</span></span>: <span class="hljs-string"><span class="hljs-string">'../../dependencies/websocket-player/WSReceiver2.js'</span></span>, <span class="hljs-attr"><span class="hljs-attr">decoderLocation</span></span>: <span class="hljs-string"><span class="hljs-string">'../../dependencies/websocket-player/video-worker2.js'</span></span> });</code> </pre><br><br>  At initialization two more scripts are loaded: <br><br><ul><li>  WSReceiver2.js </li><li>  video-worker2.js </li></ul><br>  These scripts are the core of the web socket player.  The first is responsible for the delivery of the video stream, and the second for its processing.  The <b>flashphoner.js</b> , <b>WSReceiver2.js</b> and <b>video-worker2.js scripts</b> are available for download in the <a href="https://flashphoner.com/wcs-web-sdk">Web SDK</a> assembly for Web Call Server and must be connected in order to play the stream in iOS Safari. <br><br>  Thus, we have the following required scripts: <br><br><ul><li>  flashphoner.js </li><li>  WSReceiver2.js </li><li>  video-worker2.js </li><li>  player-ios-safari.js </li></ul><br>  The connection to the server is established using the following code: <br><br><pre> <code class="javascript hljs">Flashphoner.createSession({<span class="hljs-attr"><span class="hljs-attr">urlServer</span></span>: url}).on(SESSION_STATUS.ESTABLISHED, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">session</span></span></span><span class="hljs-function">)</span></span>{ setStatus(session.status()); <span class="hljs-comment"><span class="hljs-comment">//session connected, start playback playStream(session); }).on(SESSION_STATUS.DISCONNECTED, function(){ setStatus(SESSION_STATUS.DISCONNECTED); onStopped(); }).on(SESSION_STATUS.FAILED, function(){ setStatus(SESSION_STATUS.FAILED); onStopped(); }); }</span></span></code> </pre><br>  Directly play the video stream using the API method <b>createStream (). Play ()</b> .  When playing a video stream in the div-element <b>remoteVideo</b> will be embedded HTML-element Canvas, which will be the rendering of the video stream. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">playStream</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">session</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> streamName = <span class="hljs-string"><span class="hljs-string">"12345"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> options = { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: streamName, <span class="hljs-attr"><span class="hljs-attr">display</span></span>: remoteVideo }; options.playWidth = <span class="hljs-number"><span class="hljs-number">640</span></span>; options.playHeight = <span class="hljs-number"><span class="hljs-number">480</span></span>; stream = session.createStream(options).on(STREAM_STATUS.PLAYING, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">stream</span></span></span><span class="hljs-function">) </span></span>{ setStatus(stream.status()); onStarted(stream); }).on(STREAM_STATUS.STOPPED, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ setStatus(STREAM_STATUS.STOPPED); onStopped(); }).on(STREAM_STATUS.FAILED, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ setStatus(STREAM_STATUS.FAILED); onStopped(); }); stream.play(); }</code> </pre><br>  We have hardcoded two things in the code: <br><br>  1) server url <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url = <span class="hljs-string"><span class="hljs-string">"wss://wcs5-eu.flashphoner.com:8443"</span></span>;</code> </pre> <br>  This is a public demo server Web Call Server 5. If something is wrong with it, you need to <a href="https://flashphoner.com/download">install your own</a> for testing. <br><br>  2) the name of the stream to play <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> streamName = <span class="hljs-string"><span class="hljs-string">"12345"</span></span>;</code> </pre> <br>  This is the name of the video stream we are playing.  In case this is a stream from an RTSP IP camera, it can be set as follows. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> streamName = <span class="hljs-string"><span class="hljs-string">"rtsp://host:554/stream.sdp"</span></span>;</code> </pre> <br>  The most inconspicuous, but very important function: <br><br><pre> <code class="javascript hljs">Flashphoner.playFirstSound();</code> </pre> <br>  On mobile platforms, in particular on iOS Safari, there is a restriction to the Web Audio API, which does not allow the sound to be played from the speakers until the user clicks on any element of the web page.  Therefore, when you click the Start button, we call the playFirstSound () method, which plays a short piece of generated audio so that the video can finally play with audio. <br><br>  In the end, our custom minimal player consisting of four scripts and one HTML file <b>player-ios-safari.html</b> looks like this: <br><br><ul><li>  flashphoner.js </li><li>  WSReceiver2.js </li><li>  video-worker2.js </li><li>  player-ios-safari.js </li><li>  player-ios-safari.html </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/files/070/c88/459/070c884597724ba0b7bd201cd7028269.png"></div><br>  Download the source code of the player <a href="">here</a> . <br><br>  Thus, we talked about current WebRTC alternatives for iOS Safari and analyzed the example of a real-time player with the transfer of video using Websockets technology.  Perhaps he will help someone to wait for the arrival of WebRTC on Safari. <br><br><h2>  Links </h2><br>  <a href="https://www.theregister.co.uk/2016/04/13/apple_rolling_webrtc_into_webkit/">Press release</a> - Apple rolls out WebRTC for Safari <br>  <a href="https://tools.ietf.org/html/rfc6455">Websockets</a> - RFC6455 <br>  <a href="https://www.khronos.org/registry/webgl/specs/1.0/">WebGL</a> Specification <br>  <a href="https://flashphoner.com/">Web Call Server</a> - a WebRTC server that can convert a stream to Websockets for playback on iOS Safari <br>  <a href="https://flashphoner.com/download">WCS installation</a> - download and install <br>  <a href="https://aws.amazon.com/marketplace/pp/B01D1L5EAK">Launch on Amazon EC2</a> - launch a ready-made server image on Amazon AWS <br>  <a href="">Source code</a> is an example of a player: player-ios-safari.js and player-ios-safari.html <br>  <a href="https://flashphoner.com/wcs-web-sdk">Web SDK</a> - web API for WCS server, containing scripts flashphoner.js, WSReceiver2.js, video-worker2.js </div><p>Source: <a href="https://habr.com/ru/post/325978/">https://habr.com/ru/post/325978/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325960/index.html">Free plugins, tools and services for the development of a game on a unit</a></li>
<li><a href="../325966/index.html">Kotlin for Android: simplify working with weak links in asynchronous calls</a></li>
<li><a href="../325968/index.html">Archaic video compression algorithms of the era of FMV games</a></li>
<li><a href="../325972/index.html">Security Week 14: Hacking a bank with a Brazilian scale, ATMs throw money in bitch, 54 hours Mirai</a></li>
<li><a href="../325976/index.html">How an IaaS provider can make payment for services more convenient: 2 simple rules</a></li>
<li><a href="../325980/index.html">Using IMS QTI in ePUB e-learning courses</a></li>
<li><a href="../325982/index.html">Photo-realistic graphics in a mobile game or the world's first "video" game (mobile)</a></li>
<li><a href="../325986/index.html">EGaaS Digital Ecosystem</a></li>
<li><a href="../325988/index.html">Checking the integrity of the roulette game on the Ethereum smart contract</a></li>
<li><a href="../325990/index.html">Character Design 2B for Nier: Automata</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>