<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Adding Wi-Fi to various devices</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword 
 One of my good friend is engaged in building automation. And somehow over a beer, he complained to me about one of the objects that he had ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Adding Wi-Fi to various devices</h1><div class="post__text post__text-html js-mediator-article"><h4>  Foreword </h4><br>  One of my good friend is engaged in building automation.  And somehow over a beer, he complained to me about one of the objects that he had in use.  The ‚Äúhead‚Äù of all the automation there is the <a href="http://www.owen.ru/catalog/programmiruemij_logicheskij_kontroller_oven_plk_100/opisanie">PLC 100 of the</a> well-known domestic manufacturer OWEN.  It works autonomously, without outside intervention, but once a month it is necessary to remove logs from it and monitor the overall health of all automation in the building.  The problem is that, for some reason, the Ethernet from the local grid was not carried out in the cabinet in which the PLC is located.  To pull the wire, for some organizational reasons is not possible.  And you can not hang a GSM modem, because  the closet is in the basement where there is no network.  At the same time, a local Wi-Fi network finishes the cabinet with the PLC, however, the PLC 100 does not have Wi-Fi. <br>  And here it is necessary to travel every month to an object with a laptop, plug in a USB-RS232 adapter into the device and remove logs.  As a result, I promised to ‚Äúfinish‚Äù the PLC by adding Wi-Fi to it. <a name="habracut"></a><br><br><h4>  General idea </h4><br>  Looking at the description of the device, I saw that on board it has Ethernet, two RS-232 and RS-485.  At the same time, Ethernet, for the reasons described above, was useless for me.  RS-485 was used as a fieldbus to control automation.  But RS-232 was used only to remove logs.  It was decided to modify it in Wi-Fi. <br>  This required getting a UART-WIFI module, dismantling the PLC, finding the UART-RS232 chip and soldering directly to its UART (in other words, to the UART of the internal PLC processor on which the RS232 sits). <br>  Having opened the PLC package, near the RS232 connectors, driver chips were quickly detected and identified.  Interestingly, for two different RS232 ports, 2 different drivers are used: <a href="http://datasheets.maximintegrated.com/en/ds/MAX3222-MAX3241.pdf">MAX3232</a> from Maxim and <a href="http://www.analog.com/media/en/technical-documentation/data-sheets/ADM3251E.pdf">ADM3251E</a> from Analog Devices. <br><img src="https://habrastorage.org/files/575/e8c/4fc/575e8c4fcd66449bbb1868856a7560cf.jpg" alt="image"><br>  Well, for us it is not so important, because  The driver will be removed from the board and replaced with a Wi-Fi module. <br><br>  The second part is the search for a Wi-Fi module.  The following requirements were set for him: <br><ol><li>  output module mounting (ie, not SMD) - so that it is easy to solder to the terminals, and not iron the board under it </li><li>  availability of Transparent mode (UART-TCP bridge) - i.e.  minimum number of AT commands required for operation </li><li>  the presence of the antenna directly on the module or the possibility of its easy connection </li><li>  Of course, UART control </li><li>  preferably, price up to $ 10 </li></ol><br>  First of all, there was an idea to use a module based on the esp8266 chip rattling the entire runet.  But after reading about it on the Internet, I didn‚Äôt understand whether it contains the Transparent mode and, besides, many hints that the firmware with the AT commands is not stable enough yet.  In general, I decided to look for more. <br>  As a result, on aliexpress, a module named <a href="http://www.aliexpress.com/item/MCU-System-Transparent-WIFI-Module-Low-Power-WIFI-Module-with-Tiny-Size/2009689344.html">RAK425</a> was found to be very suitable for the description.  The manufacturer of this miracle was easily fucked by the module name.  The manufacturer‚Äôs website had imputed documentation and some other files that I didn‚Äôt see.  The guys impressed me as "decent" Chinese, so it was decided to take.  True, it was not possible to find a piece sale, so I bought a ‚Äúpackage‚Äù of 5 stuff for $ 50, not counting the delivery - let it lie, I will find the use and the rest over time. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  We work as a soldering iron </h4><br>  First of all, open the datasheet on the ADM3251E chip and look for contacts to power its TTL level - Vcc, GND (pins 2 and 10 respectively).  Our Wi-Fi module is powered by 3.3V, so just in case you need to measure what is powered by ADM3251E in ARIES.  Here is a bummer - a multimeter showed 4.9V. <br>  Try happiness with MAX3232.  According to the datasheet, the power goes to pins 15 and 16. I was lucky and the power supply there is 3.3V, so we decide to connect the module here. <br><div class="spoiler">  <b class="spoiler_title">And what if the power is not 3.3V?</b> <div class="spoiler_text">  If the power supply is more, then you can use an inexpensive and easily accessible linear voltage regulator a la krenka, in some output package of the type TO-92.  Type LP2950CZ-3.3 / NOPB - apparently must pull on current. </div></div><br>  We prepare the Wi-Fi module by soldering 4 wires to the necessary contacts (Vcc, GND, RxD and TxD according to the pinout from the documentation).  The module itself can be put directly into the enclosure of the PLC100.  In order that he there did not hesitate to wrap the module in heat shrinkage. <br><img src="https://habrastorage.org/files/6e1/203/b70/6e1203b7041544f7ac88ac08009aeacf.jpg" alt="image"><br>  Now we find in the datasheet on the microcircuit contacts to which you need to solder the lines RxD and TxD.  We take out the driver and put our module in its place: <br><img src="https://habrastorage.org/files/e57/885/074/e578850749da457d8d42e9d8e01ebfa0.jpg" alt="image"><br>  Now we put the module inside the PLC and assemble it.  Everything fits very well, so the PLC looks outside pristine untouched. <br><br><h4>  Configuring W-Fi Module </h4><br>  What I liked about the RAK425 is that the transparent transmission is beautifully realized in it, i.e.  the transparent UART-WIFI bridge in it is organized in general without the support of AT commands, i.e.  for the program in the PLC100, the transfer process to the computer did not have to be changed at all - it still believes that it is transmitting data to RS232. <br>  It works like this: after powering on the module raises its own access point.  Having connected with the laptop to this point, we type in the browser the address of the module (by default 192.168.7.1) and get to its web page settings.  There we write the name of the Wi-Fi network to which we want to connect and the password to it.  As well as the TCP connection parameters: I opened a TCP server on the module on port 1234. We reboot the PLC100 on power (and therefore our module) and after the restart the module connects to our Wi-Fi network.  Now all the data that we send to our server are automatically relayed to the UART module (and therefore to the UART of the PLC100 processor). <br>  I don‚Äôt see any point in screenshots of the configuration process, everything is very simple, understandable and described in the documentation. <br>  On this, in general, that's all.  The only thing that was needed next was to forward the port to the IP of our module in the router at the facility and monitor the status of the automation over the Internet.  Already the second month is running out, how everything works there and you don‚Äôt have to go to the site every month.  Comrade laf, me a bottle of brandy. <br><br><h4>  Conclusion </h4><br>  The purpose of the article is not to show how to fasten W-Fi to a specific PLC100 (it is unlikely that someone else will have the same task), but to demonstrate one of the possible approaches for setting up remote access to any equipment that was not originally intended for this. <br><br><div class="spoiler">  <b class="spoiler_title">The way is easier and faster.</b>  <b class="spoiler_title">But not so exciting.</b> <div class="spoiler_text">  After everything was done and started, I was told about a simpler way of implementing the same.  As it turned out, many modern routers are able to work in reverse mode, i.e.  Wi-Fi is used as WAN, and Ethernet is used as LAN.  I just didn't know that then. <br>  Potential disadvantages of such a decision: <br><ol><li>  it is necessary to feed the router with something - not the fact that there is such an opportunity in the closet; </li><li>  a DIN rail router is expensive and not a fact that it can do that.  Not DIN-rail router can "not please the gaze" of local electricians </li></ol><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/251167/">https://habr.com/ru/post/251167/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../251155/index.html">Creating MMC Management Console</a></li>
<li><a href="../251157/index.html">The most needed plugins for Grunt</a></li>
<li><a href="../251161/index.html">Introduction to the course "Image and video analysis". Lectures from Yandex</a></li>
<li><a href="../251163/index.html">About Intel Hyper-Threading and Virtual Machine Performance</a></li>
<li><a href="../251165/index.html">22 tips, tricks and shokkat for Android Lollipop</a></li>
<li><a href="../251171/index.html">Operating systems lost and acquired by extra-browser javascript</a></li>
<li><a href="../251173/index.html">Why less does not mean more boring</a></li>
<li><a href="../251175/index.html">Solving the problem of resetting heavy logic to one of the many open tabs</a></li>
<li><a href="../251177/index.html">MessagePack analog JSON, but faster and less</a></li>
<li><a href="../251179/index.html">As a well-meaning person, you can lose an intelligent person or a little about delegation.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>