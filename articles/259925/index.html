<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Arduino + ESP8266 from scratch on the example of a Wi-Fi thermometer, part one</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Part 1. Preparing ESP8266 

 Why this article? On Habr√© there are already a number of articles on the use of ESP in different configurations, but for ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Arduino + ESP8266 from scratch on the example of a Wi-Fi thermometer, part one</h1><div class="post__text post__text-html js-mediator-article"> Part 1. Preparing ESP8266 <br><br>  Why this article?  On Habr√© there are already a number of articles on the use of ESP in different configurations, but for some reason without any details about exactly how everything is connected, stitched and programmed.  Like "I took ESP, two finger-type batteries, DHT22, threw it in a box, shook the hour and the thermometer is ready!".  In the end, it turns out strange: those who are already working with ESP do not see anything unusual in the work done, and those who want to learn do not understand where to start.  Therefore, I decided to write a detailed article on how ESP is connected and stitched, how to connect it with the Arduino and the outside world and what problems I came across on this way.  Links to Aliexpress cite only to represent the order of prices and the appearance of the components. <br><br>  So, I had two microcontrollers, seven different sensors, five power supplies, a DHT22 temperature sensor and a whole lot of wiring of all sorts and colors, as well as countless resistances, capacitors and diodes.  It is not that all this was necessary for the thermometer, but if I started studying microelectronics, it becomes difficult to stop. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/f9e/40f/562/f9e40f562ed74bcbae5d7e19c106f3d5.jpg"><br><a name="habracut"></a><br>  <b>Nutrition</b> <br><br>  To operate the ESP8266, you need a voltage of 3.3V and a current not lower than 300mA.  Unfortunately, the Arduino Uno is not able to provide such a current as the USB-UART adapters (programmers) of the type <a href="http://www.aliexpress.com/item/For-Arduino-FTDI-Basic-Program-Downloader-USB-to-TTL-FT232/1061832966.html%3Fspm%3D2114.32010308.4.2.ONXAGb">FT232RL</a> are not able to provide it <a href="http://www.aliexpress.com/item/For-Arduino-FTDI-Basic-Program-Downloader-USB-to-TTL-FT232/1061832966.html%3Fspm%3D2114.32010308.4.2.ONXAGb">either</a> - their limit is about 50mA.  So you have to organize a separate meal.  And it would be better if Arduino also worked from 3.3V to avoid problems like ‚ÄúI gave a five-volt signal to the output of the RSP module ESP, why does it smell like burning plastic?‚Äù. <br><br>  There are three solutions. <br><br>  1. Buy a ready <a href="http://www.aliexpress.com/item/Precision-3-3V-450mA-5W-switching-power-supply-module-bare-board-LED-voltage-regulator-AC-220/32355474364.html">-</a> made <a href="http://www.aliexpress.com/item/Precision-3-3V-450mA-5W-switching-power-supply-module-bare-board-LED-voltage-regulator-AC-220/32355474364.html">power supply</a> for 3.3V. <br><br>  2. Buy a <a href="http://www.aliexpress.com/item/5V-To-3-3V-DC-DC-Step-Down-Power-Supply-Buck-Module-AMS1117-800MA/32334466200.html">ready-made module</a> with a voltage regulator, reducing 5V to 3.3V.  Perhaps this is the most convenient option. <br><br>  3. Assemble the module itself from the AMS1117 regulator and one 22mkF tantalum capacitor. <br><br>  I chose the third item, because I often need 3.3V, I am greedy and I like to build in regulators directly in power supplies. <br><br>  With AMS1117, everything is simple: if you put it text up, then the voltage on the legs grows from left to right: 0 (Gnd), 3.3V (Vout), 5V (Vin). <br>  Between zero and output you need a 22mkF tantalum capacitor ( <a href="http://pdf1.alldatasheet.com/datasheet-pdf/view/49118/ADMOS/AMS1117.html">according to the instructions</a> , what happens if you put the electrolytic one - I did not check).  In tantalum SMD-capacitor plus where the strip.  A bit of monstrous soldering of SMD components not intended for such barbarism and: <br><br><img src="https://habrastorage.org/files/183/d2a/637/183d2a6372284783943f49a6243d5f01.png" alt="image"><br><br><img src="https://habrastorage.org/files/02a/6be/cc8/02a6becc81294f708b9de8d4b5bbab1d.png"><br><br>  Be sure to check the output voltage.  If it is significantly less than 3.3V (for example, 1.17V) - let the regulator cool down after soldering and check the contacts.  If you set the capacitor to more than 22¬µF, then the multimeter may show a higher voltage. <br><br>  Why choose AMS1117?  It is widely used.  You can find it almost everywhere, even in the Arduino Uno, as a rule, it costs AMS1117-5.0. <br>  If you know something of similar size and price, even easier to use - please write. <br><br>  An important point.  I do not know why, but AMS1117 is extremely capricious about the quality of connections.  Contacts must be reliable.  Better - soldered.  Otherwise, it produces 3.3V on tests, but it does not produce anything under load. <br><br>  <b>ESP8266 Connection</b> <br><br>  I chose model 07 because it has an excellent metal screen that acts as a protection against interference, mechanical effects and as a radiator.  The latter provides the difference between a burned-out module and just getting hot.  In addition, there is a jack for an external antenna. <br><br>  To start the chip you need to connect VCC and CH_P through a 10kŒ© resistor.  If this is not the case, then any one from the range of 1-20 kOhm will do.  In addition, specifically, model 07 still requires that GPIO15 (closest to GND) be ‚Äúon the ground‚Äù (this is not visible in the picture, because the connection is from the other side). <br><br><img src="https://habrastorage.org/files/6ca/f54/6f6/6caf546f6d8148ebb29daf81c9314cb6.png"><br><br>  Now we take the USB-UART adapter, switch it to 3.3V and connect the RX to TX, TX to RX and GND to ‚Äúground‚Äù (my transmission is unstable without this).  If you cannot switch to 3.3V, then <a href="http://www.martyncurrey.com/arduino-to-esp8266-serial-commincation/">you can use the</a> simplest resistor voltage divider: connect the ESP RX to the TX adapter via a 1 kŒ© resistor, and ESP RX to the ground via 2 kŒ©.  There are <a href="http://we.easyelectronics.ru/Shematech/soglasovanie-logicheskih-urovney-5v-i-33v-ustroystv.html">many more complex and more reliable ways</a> to tie 3.3V and 5V, but in this case it will come down. <br><br><img src="https://habrastorage.org/files/918/ec4/023/918ec4023e414deb84c44beaecebdc00.jpg"><br><br>  And we connect at the speed of 9600 on the desired COM port (you can see it in the device manager). <br><img src="https://habrastorage.org/files/7a0/eeb/aa2/7a0eebaa2cd649fc8b21deff2adc3887.png"><br><br>  I use SecureCRT, Putty is also suitable, and Linux lovers already know what to do and where to look. <br><img src="https://habrastorage.org/files/3fa/7a7/2ad/3fa7a72adbb84a049441c8f73b01e4f5.png"><br><br>  (AT + RST reloads the chip) <br><br>  If nothing happens - turn off - turn on the power, if nothing happens anyway - check the TX / RX compliance, try to rearrange them or solder them to the chip. <br><br>  Sometimes the chip freezes during the <s>bullying</s> experiments and then it must be de-energized, including turning off the adapter (for example, pulling it out of USB), because the chip even has enough incoming crumbs of power to stubbornly and not work. <br><br>  Sometimes tricks with an adapter hang a USB port.  It is possible to use another USB port as a temporary solution, but in general it is better to reboot the computer. <br><br>  Sometimes this changes the number of the COM port.  Under Linux, this can be solved with udev. <br><br>  If garbage comes instead of text, then check the speed settings.  Some older chips work on 115200. <br><br>  At the start, the chip heats up, but if it is really hot and continues to heat up, disconnect and check all connections.  So that the case does not fall + 3.3V, so that 5V does not come to it at all, so that the "earth" of the adapter is connected to the "earth" of the chip.  Models with a metal screen are very difficult to burn (but nothing is impossible), and they complain about models without screens, saying that even a small mistake may be the last in the life of the chip.  But I did not check it. <br><br>  <b>Firmware</b> <br><br>  My choice is <a href="https://github.com/nodemcu/nodemcu-firmware">NodeMCU</a> .  She has problems with memory and iron support, but it pays off many times by the simplicity of the code and the ease of debugging. <br><br>  <a href="https://github.com/nodemcu/nodemcu-flasher">NodeMCU flasher</a> and <a href="https://github.com/GeoNomad/LuaLoader">LuaLoader</a> will also be required (the latter is optional, there are other clients to work with this firmware). <br><img src="https://habrastorage.org/files/234/e37/ebc/234e37ebceb04483a53326346f5ae7f5.png"><br><br>  Turn off the chip.  Connect GPIO0 to the ground and turn on the chip: <br><br><img src="https://habrastorage.org/files/83e/9de/23f/83e9de23ffc5499282ed060753519dab.png"><br><br>  If nothing happens and the MAC / STA MAC AP fields are empty - check again that GPIO0 is on the ‚Äúground‚Äù. <br>  If the firmware started, but hung up - look at the Log tab, for some reason, I specifically refused to flash this chip on the FT232RL, but it didn‚Äôt flush to <a href="http://www.aliexpress.com/item/PL2303HX-USB-to-TTL-RS232-Module-Serial-Cable-for-Cubieboard-Free-Shipping-Dropshipping/1741669623.html%3Fspm%3D2114.32010308.4.2.DUCT0C">PL2303HX</a> at the speed of 576000 without any problems. You need to open the plastic case and solder the wire from 5V to 3.3V, <a href="http://www.aliexpress.com/item/WholeSale-Free-Shipping-PL2303-USB-To-RS232-TTL-Converter-Adapter-Module-with-PL2303HX/32345829369.html%3Fspm%3D2114.32010308.4.2.QrAXpU">there are options with five outputs</a> : 3.3, 5, TX, RX, Gnd. <br><br><img src="https://habrastorage.org/files/073/181/5b3/0731815b3d5841a0b9b0eca9c9beff30.png"><br>  Please note: STA MAC has changed.  I suspect that the flasher showed it incorrectly, but check is required. <br><br>  To save strength and nerves, you can take ready or semi-finished version. <br><br>  There are disposable <a href="http://www.aliexpress.com/item/ESP8266-serial-WIFI-module-adapter-plate-Applies-to-ESP-07-ESP-08-ESP-12/32276261380.html">adapters</a> with convenient wiring. <br>  There are <a href="https://www.tindie.com/products/Ba0sh1/esp8266-esp-0712-full-io-breadboard-adapter/">ready for firmware</a> . <br>  There are options with <a href="http://www.aliexpress.com/item/Note-that-the-ESP-12-ESP8266-serial-WIFI-industrial-grade-stable-version-of-the-test-plate/32311206593.html%3Fspm%3D2114.32010308.4.2.wM8RGE">simple whale kits</a> and <a href="https://www.olimex.com/Products/IoT/ESP8266-EVB/open-source-hardware">more complicated - ESP8266-EVB</a> <br>  There is a ready USB-adapter - <a href="http://www.aliexpress.com/item/NodeMcu-Lua-WIFI-development-board-based-on-ESP8266-Internet-of-things/32264797795.html">NodeMCU Development Board</a> .  Under it, even some shildy do. <br><br>  If you, like me, do not like ready-made solutions too much, I recommend taking it all with a margin, because experience, as they say, is directly proportional to the number of burned components. <br><br>  Valuable links from comments: <br>  <a href="http://frightanic.com/nodemcu-custom-build/">NodeMCU custom builds</a> <br>  <a href="https://olimex.wordpress.com/2015/03/31/programming-esp8266-evb-with-arduino-ide/">Programming ESP8266-EVB with Arduino IDE</a> <br>  <a href="http://electronics.stackexchange.com/questions/18384/why-does-the-lm1117-data-sheet-specifically-specify-tantalum-capacitors">Explanation of tantalum capacitor.</a> <br><br>  Update: replaced in the text ‚Äúprogrammer‚Äù with ‚ÄúUSB-UART adapter‚Äù or just ‚Äúadapter‚Äù.  In my experience, the term "programmer" is <a href="http://habrahabr.ru/post/128939/">used</a> more often, but perhaps the "USB-UART adapter" will be more accurate. </div><p>Source: <a href="https://habr.com/ru/post/259925/">https://habr.com/ru/post/259925/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../259915/index.html">Processing Russian text data in Azure Machine Learning</a></li>
<li><a href="../259917/index.html">Welcome to the Softlayer Workshop June 16</a></li>
<li><a href="../259919/index.html">USB adapter for a B7-28 digital voltmeter based on Arduino Mega</a></li>
<li><a href="../259921/index.html">Typical billing scheme</a></li>
<li><a href="../259923/index.html">Preparing reports for the board of directors in 20 minutes</a></li>
<li><a href="../259927/index.html">‚ÄúAlfa-Bank, Microsoft, VISA and IIDF gather developers for the 8-week hackaton‚Äú AlfaCamp 2.0 ‚Äù</a></li>
<li><a href="../259929/index.html">Video of reports from Golang Moscow</a></li>
<li><a href="../259937/index.html">Limiting outgoing messages on a server with postfix and postfwd</a></li>
<li><a href="../259939/index.html">Is ReactJS so fast?</a></li>
<li><a href="../259941/index.html">Google Chrome for Work</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>