<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>collectd - collect system and user statistics</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Question number 0 - why? 

 In a post about pnp4nagios, I wrote ‚ÄúNagios / Pnp4Nagios is not a replacement for the system statistics collection complex...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>collectd - collect system and user statistics</h1><div class="post__text post__text-html js-mediator-article"><h4>  Question number 0 - why? </h4><br><br>  In a post about <a href="http://coolcold.habrahabr.ru/blog/79354/">pnp4nagios,</a> I wrote ‚ÄúNagios / Pnp4Nagios is not a replacement for the system statistics collection complex‚Äù.  Why do I think so?  Because 1) the system status statistics is extensive and includes many indicators 2) it does not always make sense to monitor them, or rather to generate alerts.  For example, knowing how many I / O operations make a disk or context switching takes place well, but almost never critical.  Well, besides, Nagios is simply not meant for that.  In this article I will not make a complete description of the system, I will confine myself to especially interesting moments, from my point of view. <br><br><h4>  Question number 1 - why collectd? </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The main points why I chose collectd from Munin, Cacti and others: <br><ol><li>  Scalability </li><li>  Lightness </li><li>  Concept - everything has plugins </li><li>  Data collection and recording is divided </li><li>  Number of indicators collected </li><li>  Extensibility </li></ol><br><br><a name="habracut"></a><br><br>  The general scheme of work collectd: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/ff6/285/e10/ff6285e10da688195a4bc61548855bdf.png" alt="image"></a> <br><br><h5>  Scalability </h5><br>  To take data to the central node (s), push is used (as opposed to Cacti / Munin‚Äôs poll / pull).  More than one node can store data and moreover, it is possible to separate data for storage on different nodes.  Data transfer is handled by a separate plugin - network. <br><br><h5>  Lightness </h5><br>  The main daemon and plugins are written in C and easily survive the 10-second data collection interval without loading the system. <br><br><h5>  Everything has plugins </h5><br>  CPU load data collector - plugin.  Information about the processes - plugin.  Record and create RRD / CSV - plugin. <br><br><h5>  Data collection and recording is divided </h5><br>  Data can be both read and written.  collectd divides plug-ins into "readers" and "writers."  Those that collect information - readers.  After while the data is read, it is sent to registered writers, who can generally be any.  The most "popular" writer is the network plugin which sends data to the central node and RRDTool, as RRD, as a rule, implies statistics.  Thus, a node can have both statistics in the RRD and send data for further processing. <br><br><h5>  Number of indicators collected </h5><br>  Currently there are more than 90 basic plugins for collecting information about the system and applications. <br><br><h5>  Extensibility </h5><br>  To add your own data sources exist: <br><ol><li>  The <a href="http://collectd.org/wiki/index.php/Plugin:Exec">exec</a> plugin is generally a standard extension method - the program is started, the data output to stdout is processed, but collectd plus also has here - the program does not have to exit after outputting values, moreover, it is recommended to start and output data in a loop, saving resources on startup, which especially relevant for scripts. <br></li><li>  Python / Perl / Java Binding - are both readers and writers, more detailed description below <br></li></ol><br><br><h4>  Expansion due to bindings </h4><br>  Bindings are essentially plugins for accessing internal collectd mechanisms from other languages ‚Äã‚Äãand writing plugins for them.  Java / Perl / Python are currently supported.  For example, for Python, the interpreter starts at the start of collectd, is contained in memory, saving startup resources every few seconds and allows scripts to have access to the API. <br><br>  So the script can register as a data provider (reader) and / or as a writer, the registered procedure will be called every time interval specified in the configuration.  If everything is clear with the reader, then a separate attention should be paid to the writer - your script can easily be embedded to process all the data passing through, i.e.  You can, for example, make your database of stored values.  A simple <a href="http://collectd.org/documentation/manpages/collectd-python.5.shtml">example of</a> such a Python plugin is in the project documentation. <br><br><h4>  Interesting and useful features of plugins </h4><br><ul><li>  First of all, I liked the <a href="http://collectd.org/wiki/index.php/Plugin:Disk">disk</a> plugin - it out of the box knew how to measure the average response time of a disk: <br> <a href="http://web.coolcold.org/screens/2.6.28.8/list.html"><img src="https://habrastorage.org/getpro/habr/post_images/25c/de7/788/25cde7788444a18318a6b92b18a3ce0f.png" alt="sdb disk access time"></a> <br><br><br></li><li>  The <a href="http://collectd.org/wiki/index.php/Plugin:Tail">tail</a> plugin - allows you to read files as tail (1) and pull values ‚Äã‚Äãusing regexps.  You can take the minimum / maximum / average from the defaulted values, calculate the total number of records, sum up, for example, for nginx you can collect statistics on response time and requests for the locus like this: <br><ol><li> Add a record about the service time of the request to the nginx log: <br> <code>log_format maintime '$remote_addr - - [$time_local] reqtime=$request_time "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" "$host" upstream: $upstream_addr gzip:"$gzip_ratio"'; <br></code> <br></li><li>  Create an entry in the collectd config: <br><pre> LoadPlugin tail
 &lt;Plugin "tail"&gt;
         &lt;File "/var/log/nginx/somesite.access.log"&gt;
                 Instance "nginxproxy"
                 &lt;Match&gt;
                         Regex "reqtime = ([0-9] + \\. [0-9] +)"
                         DSType "GaugeMax"
                         Type "latency"
                         Instance "max responce time"
                 &lt;/ Match&gt;
                 &lt;Match&gt;
                         Regex "reqtime = ([0-9] + \\. [0-9] +)"
                         DSType "GaugeAverage"
                         Type "latency"
                         Instance "avg responce time"
                 &lt;/ Match&gt;
                 &lt;Match&gt;
                         Regex ". *"
                         DSType "CounterInc"
                         Type "derive"
                         Instance "requests"
                 &lt;/ Match&gt;
         &lt;/ File&gt;
 &lt;/ Plugin&gt;
</pre><br></li></ol><br>  We obtain graphs of the total number of requests, the maximum response time and the average response time, respectively: <br><img src="https://habrastorage.org/getpro/habr/post_images/d7e/e0a/ce9/d7ee0ace947a21ba72722eb87aeeedc6.png" alt="image"><br><img src="https://habrastorage.org/getpro/habr/post_images/724/f0d/7ac/724f0d7aced1205cecfc9452fb101273.png" alt="image"><br><img src="https://habrastorage.org/getpro/habr/post_images/9b2/1ca/ee6/9b21caee6eb7fec91e6fff70c653ee20.png" alt="image"><br>  The Curl plugin has similar capabilities. <br></li><li>  Plug-in processes - can collect information on the number of running processes that fall under the filter, the number of their threads, the size of the memory, input / output, for example: <br><img src="https://habrastorage.org/getpro/habr/post_images/efa/3ee/760/efa3ee760dfa5ebecb20fb0ca47f098d.png" alt="image"><br>  In this case, the data is not entirely correct - it is not read / write disk operations, but in general everything, i.e.  write to socket is also counted.  I informed the authors, maybe they will fix it in the next version. <br></li><li>  <a href="http://collectd.org/wiki/index.php/Plugin:UnixSock">UnixSock</a> plugin will allow to exchange data using a <a href="http://collectd.org/wiki/index.php/Plain_text_protocol">simple text protocol</a> , in particular, you can receive or send the value of the counter.  With this plugin, integration into Nagios is possible. <br></li></ul><br><br><h4>  Other features </h4><br><h5>  Filters and chains </h5><br>  Starting from version 4.6, a filter and chain mechanism appeared, similar to chains in iptables.  Using this mechanism, you can filter data, for example, to cut off values ‚Äã‚Äãfor which the timestamp is more or less than the current time by N, which can be useful if a clock gets stuck on a server.  RRD will get time from the future and the readings will be distorted. <br><br><h5>  Notification and threshholds </h5><br>  The basic system of <a href="http://collectd.org/wiki/index.php/Notifications_and_thresholds">notifications</a> and <a href="http://collectd.org/documentation/manpages/collectd.conf.5.shtml">threshold values</a> appeared since version 4.3.  Similarly, readers and writers, there are "producers" and "consumers" - the first produce notifications, the second process them.  In particular, the Exec plugin can both respond to notifications, for example, run a script, and transmit notifications from scripts. <br><br>  By configuring a set of threshold values, you can create alerts for deviations from the norm.  However, it should be understood that these basic capabilities do not replace the same Nagios.  For full-fledged work with Nagios, you can use the bundled <a href="http://collectd.org/documentation/manpages/collectd-nagios.1.shtml">collectd-nagios program</a> that allows you to poll the socket created by the UnixSock plugin and return the result in a standard format for Nagios'a <br><br><h4>  disadvantages </h4><br>  I can only rank the display system of graphs as disadvantages.  Considering that about 200 tons of counters can be generated from a single host, visualization becomes not in the last place.  Standard interface collection3 is not bad, but far from perfect.  To date, several independent graph display systems are being developed, but I cannot recommend any yet. <br><br><h4>  Other </h4><br>  One of the developers of Sebastian Harl (tokee) is the maintainer of a package in Debian, therefore there is almost always the latest version in backports </div><p>Source: <a href="https://habr.com/ru/post/93205/">https://habr.com/ru/post/93205/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../93199/index.html">New Ubuntu Netbook Edition Interface</a></li>
<li><a href="../93201/index.html">The customer and his rake</a></li>
<li><a href="../93202/index.html">Industrial Revolution. Part 2. Atoms - new bits</a></li>
<li><a href="../93203/index.html">Skills and work ("I do not appreciate")</a></li>
<li><a href="../93204/index.html">How I put AndroidOS on iPhone3G (brief history-instruction)</a></li>
<li><a href="../93206/index.html">Chess</a></li>
<li><a href="../93209/index.html">ToCyrillic: Google Chrome Extension</a></li>
<li><a href="../93210/index.html">A brief introduction to SIM cards</a></li>
<li><a href="../93213/index.html">Multi-armed Shiva Syndrome: Knowledge vs Skills</a></li>
<li><a href="../93219/index.html">I'm 64-bit! And you?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>