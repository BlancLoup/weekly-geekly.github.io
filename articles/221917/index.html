<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>As I bind'om looking for viruses ...</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Well, I‚Äôll say right away that it‚Äôs not the viruses themselves, but their activity, but nevertheless discovered a lot of new things about where my com...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>As I bind'om looking for viruses ...</h1><div class="post__text post__text-html js-mediator-article">  Well, I‚Äôll say right away that it‚Äôs not the viruses themselves, but their activity, but nevertheless discovered a lot of new things about where my computers, phones and tablet go. <br><img src="http://habrastorage.org/files/d2a/acd/20b/d2aacd20b60746bfac875480c797d161.png" alt="image"><br>  But it was evening, there was nothing to do ... It was raining, the Internet suspiciously slowed down, although it seemed like 8 megabits and everything had to ‚Äúfly‚Äù.  The home equipment park that is connected to the world wide web is small - a desktop computer, a laptop, a tablet, a satellite tuner with Linux, 3 smartphones and a deadly servachoon-cheonchik with debian and xen (with five more constantly running virtual OCs).  Not a lot is not enough, but to constantly maintain, update and check for viruses all this economy takes money (licensed software) and time, which, as always, does not exist.  And at some point, it was decided to completely abandon the antiviruses, or buy them, update ... Yes, and subjectively slows down with them all ... <br><a name="habracut"></a><br>  More than a year has passed since I refused anti-virus software.  Everything works, everything is fine, But ... "You lead a hamster?  - And he is! <br><br>  I‚Äôm a web programmer, so I set up dns (bind9) for myself on the server, in which I created a .dev zone for development (sooooo convenient, see <a href="http://habrahabr.ru/post/127374/">[tyts]</a> ), and for one I turned on logging, let it be just in case.  The address of my local DNS server distributes the DHCP ADSL modem as the main DNS server on the network. <br><br>  Then one day I decided to see what was written in the DNS server logs.  It turned out that one of the home computers is constantly knocking; do not understand where: <br><pre><code class="bash hljs">01-Nov-2013 23:11:03.128 queries: info: client 192.168.1.11<span class="hljs-comment"><span class="hljs-comment">#63500: query: yfp2lvdyye86s78.pp.ua IN A + (192.168.1.1) 01-Nov-2013 23:11:04.138 queries: info: client 192.168.1.11#63500: query: yfp2lvdyye86s78.pp.ua IN A + (192.168.1.1) 01-Nov-2013 23:11:09.867 queries: info: client 192.168.1.11#58461: query: yfp2lvdyye86s78.free IN A + (192.168.1.1) 01-Nov-2013 23:11:15.390 queries: info: client 192.168.1.11#52119: query: yfp2lvdyye86s78.ce.ms IN A + (192.168.1.1) 01-Nov-2013 23:11:21.006 queries: info: client 192.168.1.11#50737: query: yfp2lvdyye86s78.net IN A + (192.168.1.1) 01-Nov-2013 23:11:26.512 queries: info: client 192.168.1.11#54267: query: 35pa1j6h47e1l7v.tk IN A + (192.168.1.1)</span></span></code> </pre> <br>  I definitely did not go there, it means someone else.  Virus prophylaxis was carried out, and a malware was indeed found and ‚Äúcured‚Äù.  This would be the end of a fairy tale, but I did not stop at that.  I wanted to analyze the accumulated DNS server logs more deeply and in a convenient form, maybe something else was happening besides my will and desires. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And bingo - I was counted (as in that cartoon).  I watch advertisements and I am persistently considered all sorts of counters.  Of course, it is not a secret to anyone that on most of the sites a wide variety of attendance counters, metrics and advertisements are placed from various advertising sites, there is even LIKE social services.  networks I don't even know.  And why, what would they think of me, would they show annoying ads, why should I not need them?  With this we need to do something. <br><br>  It is necessary to solve two problems - to analyze the logs in a convenient form, and to block unnecessary sites (counters, advertising, etc.), because  putting an advertisement hall on all computers is somehow not an option, and I also did not want to do the Internet through a proxy.  Ways to block a lot, but for myself I chose to substitute the real IP address of the DNS with my local one.  That is, local DNS configurations. <br><br>  With the first point it was thought, there will be no problems.  All good is written to us.  A wonderful <a href="http://www.pablumfication.co.uk/2010/09/03/bind-logs-top-dns-queries/">bash script</a> was found - able to show the most visited sites, parsing logs and a Ruby project <a href="https://github.com/tommyblue/Bind-Log-Analyzer">Bind log analyzer</a> that converts logs to a mysql database and it was stated that it has a web interface for viewing results.  Just hot on the heels was found the resource <a href="http://pgl.yoyo.org/adservers/">http://pgl.yoyo.org/adservers/</a> on which everything seems to be there, and lists of domains that can be safely banned, and a description of how to do it, but ... I do not know how in bind8, but bind9 strongly cursed the empty zone offered on that site, and browsers convulsively did not complete the page loading process, trying to load counters and advertisements on the page, not understanding where the dog was digging. <br><br>  The first script did not fit right away since  Logies were for half a year, there was no rotation of logs, and, besides, the option to save the access time to the DNS server was not enabled.  The second Bind log analyzer, in which the log analysis was set up, but it was possible to launch the web interface as well.  I had to bike. <br><br>  So, about the bike.  Called statdnslog, it lies on a <a href="https://github.com/mcdir/statdnslog">githaba</a> and consists of two parts: utilities and a web interface. <br>  Utilities can: <br>  - parse the log files of requests to DNS Bind9; <br>  - save the data to the database (mysql); <br>  - create prohibition lists based on lists from <a href="http://pgl.yoyo.org/">pgl.yoyo.org</a> (for example); <br>  - adding new DNS to the list of prohibitions from its list (a text file with DNS listings); <br>  - generate DNS presets for BIND9. <br><br>  WEB interface: <br>  - displays statistics sorted by date (by default, the top visited) and other fields; <br>  - shows the most visited DNS and how many times visited; <br>  - highlight with color (red) in the general list of visited DNS, DNS from the list of prohibited. <br><br>  By the way, I will say that redefining the DNS will not save anything from anything and this is not a means of protection.  Protection can be antiviruses, firewalls, a proxy with a traffic analyzer, and other specialized means of protection, however, in the case of DNS traffic analysis, it‚Äôs warned, which means it‚Äôs armed, and who, where and when you go from family, you can see. <br><br>  Once again the link to github: <a href="https://github.com/mcdir/statdnslog">https://github.com/mcdir/statdnslog</a> <br>  Website: <a href="http://statdns.nedze.com/">http://statdns.nedze.com/</a> <br>  Demo version of the WEB interface: <a href="http://demo.statdns.nedze.com/">http://demo.statdns.nedze.com/</a> <br><br>  Additional material <br>  Enabling DNS BIND9 logging Clause logs - <a href="http://www.zytrax.com/books/dns/ch7/logging.html">http://www.zytrax.com/books/dns/ch7/logging.html</a> <br>  How to enable the named / bind / DNS full logging - <a href="http://stackoverflow.com/questions/11153958/how-to-enabled-named-bind-dns-full-logging">http://stackoverflow.com/questions/11153958/how-to-enabled-named-bind-dns-full-logging</a> <br>  Bind Logs - Top DNS Queries <a href="http://www.pablumfication.co.uk/2010/09/03/bind-logs-top-dns-queries/">http://www.pablumfication.co.uk/2010/09/03/bind-logs-top-dns-queries/</a> </div><p>Source: <a href="https://habr.com/ru/post/221917/">https://habr.com/ru/post/221917/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../221903/index.html">Easy controllers with Angular Classy</a></li>
<li><a href="../221905/index.html">Results of the InterSystems nomination at Golden Byte 2014</a></li>
<li><a href="../221907/index.html">Parsing RAW in a browser: how we did it</a></li>
<li><a href="../221913/index.html">Back-engineering Caesar III</a></li>
<li><a href="../221915/index.html">Stack implementation details - part two</a></li>
<li><a href="../221919/index.html">Interview with KillHouse Games</a></li>
<li><a href="../221921/index.html">Why do engineers in Russia need 3D solutions</a></li>
<li><a href="../221931/index.html">Special rocket magic Ilona Mask</a></li>
<li><a href="../221935/index.html">30th anniversary of Mario Bros. is dedicated to. HTML5 Virtual Game Museum</a></li>
<li><a href="../221937/index.html">And again about the danger of eval ()</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>