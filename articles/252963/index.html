<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to steal money that is not. Or something new about cryptocurrencies</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! 

 Of course, you know a lot about cryptocurrencies, but today we have brought you something new: a study of malware created to steal 80 kri...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to steal money that is not. Or something new about cryptocurrencies</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr! <br><br>  Of course, you know a lot about cryptocurrencies, but today we have brought you something new: a study of malware created to steal 80 kriptocurrency wallets, including bitcoin, along with all the details of access to them. <br><br>  We found it during the program of continuous monitoring of Internet security and immediately dismantled several samples of malware for parts.  For the time being, owners have so few such combines with the automated hijacking of cryptocars, but we will be more, we are sure. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Below we describe how the malware works, and how not to be at risk.  And of course once again let us sum up the information about the cryptonomones themselves and their relatives. <br><br>  By the way, financial regulators consider bitcoin and all of its friends to be currency substitutes, and we do not in any way advocate their use, but, on the contrary, urge to use fiat money as a reliable and stable payment instrument.  (There could be a smile) <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">And what kind of cryptocurrencies are these?</b> <div class="spoiler_text"><br>  Cryptocurrencies in our usual form appeared in 2009, when someone Satoshi Nakamoto, after 2 years of development, launched a decentralized payment data exchange network and published a client to work with Bitcoin currency. <br><br>  It is worth noting that Satoshi‚Äôs personality is still not 100% confirmed, and the idea of ‚Äã‚Äãcryptocurrency does not belong to him at all.  For the first time such ideas were expressed in 1998 in the thematic mailings of cryptographic enthusiasts, and in 1999 the writer Neil Stephenson put the idea of ‚Äã‚Äãcryptocurrency in the heads of the characters of his cult novel ‚ÄúCryptonomicon‚Äù (We highly recommend reading. Approx. Aut.).  The first attempts to create such payment systems are known, which had all the prerequisites for successful work long before the announcement of the Bitcoin network. <br><br>  However, it was the brainchild of Nakamoto, whether he was a real individual or the pseudonym of a group of authors, that became commercially successful.  "Infomonet", have risen in price millions of times from the tenth fractions of a cent in 2009 to thousands of dollars and higher in 2013.  This is particularly interesting, given that the currency is not provided by anything other than user confidence in the cryptographic complexity of the algorithm and investments in the computing power of computers necessary to mine Bitcoin mining. <br><br>  A significant correction in the cost of cryptocurrency occurred at the end of 2013, then the bitcoins resumed their growth until the next fall in the second half of 2014.  What expects "coins" in the future is unknown to us and we will not deal with forecasts, however, suppose that the development of malware like that described can deprive the cryptocurrency of trust and lead to an outflow of users. <br><br>  The features of cryptocurrencies considered by us using Bitcoin as an example include the following: <br>  ‚Ä¢ Anonymity of the current owner; <br>  ‚Ä¢ Lack of a centralized regulator; <br>  ‚Ä¢ Store all wallet data in a single file. <br><br>  Naturally, this type of payment instrument became a convenient tool for illegal transactions (which at a certain stage inflated its popularity and cost), as well as the object of numerous thefts and fraudulent transactions. <br></div></div><br><h3>  <font color="#4b87b7">Where are the coins kept?</font> </h3><br>  The representation of a Bitcoin wallet, on the owner‚Äôs machine, is a wallet.dat file containing the user's private key.  This file is created during the first launch of the Bitcoin client and is stored in the% AppData% / Bitcoin directory.  An attacker can just copy the wallet file to get full access to the user's accounts. <br><br>  In order to secure the wallet file, the encryption function is provided.  A password is set for access to the wallet, the wallet.dat file is additionally encrypted, and for conducting any transactions, knowledge of the passphrase is required. <br><br><h6>  <b>Bitcoin wallet encryption module source code</b> </h6><br><img src="https://habrastorage.org/files/026/622/0b1/0266220b1ef24550b39fb31cc274f14c.png"><br><br>  If encryption is used, even after the attacker gains access to the wallet.dat file, it will be impossible to transfer funds from it without obtaining access details. <br><br>  However, the unique capabilities of the malware sample being investigated are not only covert copying of Bitcoin wallets and 80 other cryptocurrencies (Bitcoin forks), but also extracting passwords for encrypted wallets without using any keyloggers (keyloggers) by integrating directly into client service processes BY.  We will understand the process of obtaining the virus data required for the theft of bitcoin wallets. <br><br><h3>  <font color="#4b87b7">What is CryptoStealer?</font> </h3><br>  The PE header of the captured and studied file contains the compile time and debugging information that refers to the original name of the project from which the file was compiled.  So we have established that its name is CryptoStealer, and the time of creation of the sample under study is the end of January 2014. <br><br><h6>  <b>The header of the file with the date of compilation of the sample and debug information</b> </h6><br><img src="https://habrastorage.org/files/10f/62d/855/10f62d855c43498683116396e1c47a70.png"><br><br><h3>  <font color="#4b87b7">How is the theft?</font> </h3><br>  The covert copy of the wallet files is as follows: <br>  ‚Ä¢ CryptoStealer checks the presence of the% APPDATA% \ [Cryptocurrency name] and% COMMON_APPDATA% \ [Cryptocurrency name] directory for all 80 supported cryptocurrencies, for example, ‚ÄúC: \ Documents and Settings \ Owner \ Application Data \ Bitcoin \‚Äù; <br>  ‚Ä¢ If the path exists, the existence of the wallet.dat file is checked, which, if present, is copied to a temporary folder; <br>  ‚Ä¢ The wallet file is sent to the attackers server. <br><br>  It is noteworthy that the Bitcoin security forums give advice not to store the wallet files in the default locations, it is proposed to place them on removable media, and to start the Bitcoin client with the bitcoin-qt.exe ‚Äìdatadir = X: \ wallet command, such thus clearly pointing the client software to the location of the purse file.  But even in this case, the parameters for running a Bitcoin client can be read, and the treasured wallet.dat file is copied from the -datadir directory. <br><br><h6>  <b>Pseudo-code for sending the file wallet.dat</b> </h6><br><img src="https://habrastorage.org/files/af7/cba/5af/af7cba5afbc84b429406b005c4544887.png"><br><br><h3>  <font color="#4b87b7">And if the wallet file is encrypted?</font> </h3><br><br>  Another important feature of CryptoStealer is the interception of wallets encryption passwords.  It is based on the following algorithm: <br>  ‚Ä¢ A search for processes of programs for working with cryptocurrency, such as ‚Äúbitcoin-qt.exe‚Äù, ‚Äúlitecoin-qt.exe‚Äù, etc., is performed.  All active processes are listed, and their names are sequentially compared with a pre-generated base of 8 dozen bitcoin forks, to which the substring "-qt.exe" is added. <br>  ‚Ä¢ The code is injected into the found process and the remote thread is started in it (CreateRemoteThread). <br><br><h6>  <b>Pseudocode of process enumeration and code injection functions</b> </h6><br><img src="https://habrastorage.org/files/09b/c26/8d0/09bc268d0e4e4dfc9cc1f1bf1a888ce8.png"><br><br><h6>  <b>Pseudocode splicing function</b> </h6><br><img src="https://habrastorage.org/files/e7f/011/2b3/e7f0112b310b4e2a95e6a276344d2e54.png"><br><br><br>  ‚Ä¢ Splicing (interception) of the strlen function from the msvcrt.dll library is performed.  This function checks the length of the entered password string and, accordingly, operates with the password phrase itself. <br>  ‚Ä¢ The new handler code of the intercepted function strlen searches for the active windows for entering the encryption password to the wallet (class QWidget, heading ‚ÄúUnlock wallet‚Äù, ‚ÄúEncrypt wallet‚Äù, etc.) and intercepts input into them, filtering calls to the function of counting the length of the string for service "lines of the Bitcoin application. <br><br><h6>  <b>Pseudocode hook function handler</b> </h6><br><img src="https://habrastorage.org/files/30f/ce7/ddf/30fce7ddf63848be8b8af425201754bd.png"><br><br><h6>  <b>Debugging password interception code</b> </h6><br><img src="https://habrastorage.org/files/bd3/92b/f87/bd392bf879d243128c2fcde7380e7b43.png"><br><br><img src="https://habrastorage.org/files/33e/714/669/33e7146696354266a47c5cf3b32130dd.png"><br><br>  ‚Ä¢ The password to the wallet is sent to the control center of attackers.  The request in encrypted form includes, in addition to the password, the hardware identifier of the computer and the name of the cryptocurrency type.  The request is encoded in the Base64 encoding system, and its interpretation is not difficult. <br><br><h6>  Capture and decode application traffic </h6><br><img src="https://habrastorage.org/files/768/10e/1f8/76810e1f862246e99fb6a88565b51600.png"><br><br><img src="https://habrastorage.org/files/8e1/97c/5f9/8e197c5f90244fadacf18cac3ade8904.png"><br><br>  Thus, the considered sample of malware effectively implements the functions incorporated in its algorithm for stealing all the files and details necessary for assigning money.  It is important to note that at the time of the study, the software successfully avoided detection by most popular anti-virus packages and the traffic generated by it also did not arouse suspicion of a significant part of intrusion detection systems. <br><br>  Based on the above, the typical user does not have the ability to effectively counteract and even detect the CryptoStealer. <br><br>  Nevertheless, there are a number of recommendations that can significantly reduce the risk of infection of PCs with virus software, including the sample considered in the study: <br>  ‚Ä¢ For any financial transactions and other sensitive transactions, you must use a separate computer.  A virtual machine can be used that is isolated from the effects of an external operating system, but a dedicated device is better; <br>  ‚Ä¢ A computer or virtual machine should be used exclusively for the above operations; visits to sites that are not related to the goals described and connection of untrusted external storage media should be excluded; <br>  ‚Ä¢ This computer must be equipped with antivirus software with the latest updates of signature databases and firewalling tools with current filtering rules; <br>  ‚Ä¢ Internet filtering to ‚Äúfinancial‚Äù PC is applicable only in permissive format.  Check everything except the white list of required addresses.  It is better to do this with an external device; <br>  ‚Ä¢ You should recheck the addresses that are used to navigate on the Internet for phishing (replacing the characters in the host name with similar characters in order to divert the user to a fraudulent resource). <br><br><h3>  <font color="#4b87b7">List of cryptocurrency at risk</font> </h3><br>  Bitcoin, Litecoin, 42Coin, Alphacoin, Americancoin, AndroidsTokens, AnonCein, C√©n√© av, umin Argent, mos Argent, Argentic, As Asic, As, ic, ing, ao, ao, ao, ao, ao, ao, ge, Bottlege, ount, ount, ountount, ount,, ao, ge, ount , CPU2coin, Craftcourse, Craftman, Cairo, Caveman , Gamecoin, GlobalCoin, Goldcoin, Grain, GrandCoin, Growthcoin, HoboNickels, infinitecoin, ItalyCoin, Ixcoin, Joulecoin, Jupitercoin, KingCoin, krugercoin, last Coin, Lebowskis, Liquidcoin, Lucky7Coin, LuckyCoin, Maples, mastercoin, masterCoin, Mavro, Megacoin, MEMEcoin, MemoryCoin, Mincoin, NaanaYaM, Namecoin, NanoTokens, Neocoin, NetCoin, NovaCoin, Nuggets, NXTCoin, Onecoin, OpenSourcecoin, Orbitcoin, Paycoin, PEERCoin, Pennies, Peopl  eCoin, Phenixtech, Philosurus, Philippe , TicketsCoin, tumcoin, UnitedScryptCoin, Unobtanium, UScoin, ValueCoin, Worldcoin, XenCoin, YACoin, Ybcoin, ZcCoin, ZenithCoin, Zetacoin <br></div><p>Source: <a href="https://habr.com/ru/post/252963/">https://habr.com/ru/post/252963/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../252947/index.html">3/14/15 9:26:53 Century Celebration of the "Day of the Pi Number", as well as a story about how to get your very personal piece of pi</a></li>
<li><a href="../252949/index.html">Google Code closes and invites everyone to go to GitHub</a></li>
<li><a href="../252955/index.html">Vesta CP: Installing Ruby and Python Web Applications</a></li>
<li><a href="../252957/index.html">Powershell for testers</a></li>
<li><a href="../252959/index.html">Microsoft has released EMET 5.2</a></li>
<li><a href="../252965/index.html">Neuroplasticity in artificial neural networks</a></li>
<li><a href="../252967/index.html">How not to configure antifraud rules on user geography</a></li>
<li><a href="../252969/index.html">Localization of Android applications using Google Sheets</a></li>
<li><a href="../252971/index.html">Building a Nodejs Modular System</a></li>
<li><a href="../252973/index.html">Proper increase in disk size in a virtual machine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>