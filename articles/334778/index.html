<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Basics of computer networks. Subject number 8. Link Aggregation Protocol: Etherchannel</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="And hello again! After a short break, we continue to gnaw the granite of network science. This article focuses on the Etherchannel protocol. Within th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Basics of computer networks. Subject number 8. Link Aggregation Protocol: Etherchannel</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/9cc/a95/34f/9cca9534f81e461ba54540f3f895d98e.jpg"><br>  And hello again!  After a short break, we continue to gnaw the granite of network science.  This article focuses on the Etherchannel protocol.  Within the framework of this topic, we will talk about aggregation, fault tolerance, load balancing.  Topics important and interesting.  I wish you a pleasant reading. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Content</b> <div class="spoiler_text">  1) <a href="https://habrahabr.ru/post/307252/">Basic network terms, OSI network model and TCP / IP protocol stack.</a> <br>  2) <a href="https://habrahabr.ru/post/307714/">Top-level protocols.</a> <br>  3) <a href="https://habrahabr.ru/post/308636/">Protocols of lower levels (transport, network and channel).</a> <br>  4) <a href="https://habrahabr.ru/post/312340/">Network devices and types of cables used.</a> <br>  5) <a href="https://habrahabr.ru/post/314484/">The concept of IP addressing, subnet masks and their calculation.</a> <br>  6) <a href="https://habrahabr.ru/post/319080/">The concept of VLAN, Trunk and VTP and DTP protocols.</a> <br>  7) <a href="https://habrahabr.ru/post/321132/">Spanning Tree Protocol: STP.</a> <br>  8) Channel Aggregation Protocol: Etherchannel. <br>  9) Routing: static and dynamic on the example of RIP, OSPF and EIGRP. <br>  10) Network Address Translation: NAT and PAT. <br>  11) Reservation protocols for the first transition: FHRP. <br>  12) Computer network security and virtual private networks: VPN. <br>  13) Global networks and protocols used: PPP, HDLC, Frame Relay. <br>  14) Introduction to IPv6 configuration and routing. <br>  15) Network management and network monitoring. <br><br>  PS Perhaps over time, the list will be added. </div></div><br>  So let's start with a simple one. <br><br>  Etherchannel is a technology that allows you to combine (aggregate) several physical wires (channels, ports) into a single logical interface.  Typically, this is used to increase resiliency and increase channel capacity.  Usually, to connect critical nodes (switch-switch, switch-server, etc.).  The very word Etherchannel introduced by Cisco and everything related to aggregation, it includes it.  Other vendors call aggregation differently.  Huawei calls it Link Aggregation, D-Link calls LAG and so on.  But the essence does not change. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let us analyze the work of aggregation in more detail. <br><img src="https://habrastorage.org/web/86d/141/f4a/86d141f4a2af41dd9e53e655d92e2a7b.PNG"><br>  There are 2 switches connected together by one wire.  Networks of departments and groups are connected to both switches (size is not important).  The main thing is that there are a number of users behind the switches.  These users are actively working and communicating with each other.  Accordingly, in no case can they remain without communication.  There are 2 questions: <br><br><ol><li>  If the link between the switches fails, the connection will be lost.  The work will rise, and the administrator in fear will run to understand what is the matter. </li><li>  The second question is not so critical, but with a reserve for the future.  The company is growing, there are new employees, traffic is growing, and the channels are the same.  We need to somehow increase the bandwidth. </li></ol><br>  The first thing that comes to mind is to throw a few more wires between the switches.  But this campaign is fundamentally wrong.  Adding redundant links will cause loops to appear on the network, as already mentioned in the previous article.  One could argue that we have a wonderful family of STP protocols and they will decide everything.  But this is also not entirely true.  I show the example of the same Packet Tracer. <br><img src="https://habrastorage.org/web/7df/e44/0cf/7dfe440cf9eb4421ba423b620921f3c2.PNG"><br>  As you can see, from 2 channels, only one is active.  The second will wait until it fails active.  That is, we will achieve some fault tolerance, but we will not solve the issue with an increase in throughput.  And the second channel will just be idle.  The rule of good tone is such an approach that the elements of the network are not idle.  The best solution would be to create one large logical one from several physical interfaces and drive traffic through it.  And Etherchannel comes to the rescue.  In Cisco OS 3 types of aggregation: <br><br><ol><li>  1) LACP or Link Aggregation Control Protocol is an open IEEE standard. </li><li>  2) PAgP or Port Aggregation Protocol is a proprietary Cisco protocol. </li><li>  Manual aggregation. </li></ol><br>  All 3 types of aggregation will be performed only in the following cases: <br><br><ul><li>  Same Duplex </li><li>  Same interface speed </li><li>  Same allowed VLANs and Native VLANs </li><li>  Same interface mode (access, trunk) </li></ul><br>  That is, the ports must be identical to each other. <br><br>  Now about their differences.  The first 2 allow you to dynamically agree, and in case of failure of any of the links to notify about it. <br><br>  Manual aggregation is done at the administrator's risk.  The switches will not coordinate anything and will rely on what the administrator has foreseen.  Despite this, many vendors recommend using manual aggregation, since in any case, the rules described above must be followed in order to work properly, and the switches will not have to generate service messages for LACP or PAgP approval. <br><br>  I'll start with the LACP protocol.  To make it work, you need to transfer it to <b>active</b> or <b>passive</b> mode.  The difference between the modes is that the <b>active</b> mode immediately turns on the LACP protocol, and the <b>passive</b> mode turns on the LACP if it detects a LACP message from a neighbor.  Accordingly, in order for the aggregation to work with LACP, it is necessary that both be in <b>active</b> mode, or one in <b>active</b> and the other in <b>passive</b> .  I will make a sign. <br><table><tbody><tr><th>  Mode </th><th>  Active </th><th>  Passive </th></tr><tr><td>  <b>Active</b> </td><td>  Yes </td><td>  Yes </td></tr><tr><td>  <b>Passive</b> </td><td>  Yes </td><td>  Not </td></tr></tbody></table><br>  We now turn to the lab and fix in the practical part. <br><img src="https://habrastorage.org/web/038/442/440/038442440b3f40c18c13f3d575d8b870.PNG"><br>  There are 2 switches connected by 2 wires.  As you can see, one link is active (it is green), and the second one is backup (it is orange) due to the STP protocol.  It is good, the protocol fulfills.  But we want to link both links together.  Then the STP protocol will assume that this is one wire and stop blocking. <br><br>  We come on switches and we aggregate ports. <br><br><pre><code class="hljs vhdl">SW1(config)#interface fastEthernet <span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> -    SW1(config-<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>)#shutdown -   (     ,  STP   ) %LINK-<span class="hljs-number"><span class="hljs-number">5</span></span>-CHANGED: Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> administratively down %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> down SW1(config-<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>)#channel-<span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> mode active -   <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>-channel <span class="hljs-number"><span class="hljs-number">1</span></span> (      )      active. Creating a <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>-channel interface <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span>-channel <span class="hljs-number"><span class="hljs-number">1</span></span> -      . SW1(config-<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>)#no shutdown -  . %LINK-<span class="hljs-number"><span class="hljs-number">5</span></span>-CHANGED: Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up %LINK-<span class="hljs-number"><span class="hljs-number">5</span></span>-CHANGED: Interface <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span>-channel <span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span>-channel <span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up SW1(config)#interface fastEthernet <span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span> -     SW1(config-<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>)#shutdown - . %LINK-<span class="hljs-number"><span class="hljs-number">5</span></span>-CHANGED: Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">2</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> administratively down %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">2</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> down SW1(config-<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>)#channel-<span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> mode active -   <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>-channel <span class="hljs-number"><span class="hljs-number">1</span></span> SW1(config-<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>)#no shutdown - . %LINK-<span class="hljs-number"><span class="hljs-number">5</span></span>-CHANGED: Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">2</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">2</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up</code> </pre> <br>  The configuration on the first switch is completed on this.  For accuracy, you can type the show etherchannel port-channel command: <br><br><pre> <code class="hljs pgsql">SW1#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> etherchannel port-channel Channel-<span class="hljs-keyword"><span class="hljs-keyword">group</span></span> listing: <span class="hljs-comment"><span class="hljs-comment">---------------------- Group: 1 ---------- Port-channels in the group: --------------------------- Port-channel: Po1 (Primary Aggregator) ------------ Age of the Port-channel = 00d:00h:08m:44s Logical slot/port = 2/1 Number of ports = 2 GC = 0x00000000 HotStandBy port = null Port state = Port-channel Protocol = LACP Port Security = Disabled Ports in the Port-channel: Index Load Port EC state No of bits ------+------+------+------------------+----------- 0 00 Fa0/1 Active 0 0 00 Fa0/2 Active 0 Time since last port bundled: 00d:00h:08m:43s Fa0/2</span></span></code> </pre><br>  We see that there is such a port-channel and both interfaces are present in it. <br><br>  Go to the second device. <br><br><pre> <code class="hljs vhdl">SW2(config)#interface <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> fastEthernet <span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>-<span class="hljs-number"><span class="hljs-number">2</span></span> -      . SW2(config-<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">range</span></span>)#shutdown -  . %LINK-<span class="hljs-number"><span class="hljs-number">5</span></span>-CHANGED: Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> administratively down %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> down %LINK-<span class="hljs-number"><span class="hljs-number">5</span></span>-CHANGED: Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">2</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> administratively down %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">2</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> down SW2(config-<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">range</span></span>)#channel-<span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> mode passive -  <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>-channel     passive (,   LACP-). Creating a <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>-channel interface <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span>-channel <span class="hljs-number"><span class="hljs-number">1</span></span> -  . SW2(config-<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">range</span></span>)#no shutdown -  . %LINK-<span class="hljs-number"><span class="hljs-number">5</span></span>-CHANGED: Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up %LINK-<span class="hljs-number"><span class="hljs-number">5</span></span>-CHANGED: Interface <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span>-channel <span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span>-channel <span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up %LINK-<span class="hljs-number"><span class="hljs-number">5</span></span>-CHANGED: Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">2</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">2</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up</code> </pre> <br><br>  After that, the channel is consistent.  You can look at it with the show etherchannel summary command: <br><br><pre> <code class="hljs vhdl">SW1#show etherchannel summary Flags: D - down P - <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>-channel I - stand-alone s - suspended H - Hot-standby (LACP only) R - Layer3 S - Layer2 U - <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> f - failed <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> allocate aggregator u - unsuitable <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> bundling w - waiting <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> be aggregated d - <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">port</span></span> Number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> channel-groups <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> Number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> aggregators: <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span>-channel Protocol Ports <span class="hljs-comment"><span class="hljs-comment">------+-------------+-----------+---------------------------------------------- 1 Po1(SU) LACP Fa0/1(P) Fa0/2(P)</span></span></code> </pre> <br>  Here you can see the port-channel group, the protocol used, the interfaces and their status.  In this case, the parameter SU says that the second level aggregation is performed and that this interface is used.  And the P parameter indicates that the interfaces are in the port-channel state. <br><div style="text-align:center;"><img src="https://habrastorage.org/web/2cf/804/3c5/2cf8043c57a7428bab9ce7edc455004c.PNG"></div><br>  All links are green and active.  STP does not work for them. <br><br>  I'll warn you right away that there is a glitch in the packet tracer.  The bottom line is that after setting up the interfaces can go to stand-alone (parameter I) and will not want to leave it in any way.  At the time of this writing, I had this glitch and decided to re-create labs. <br><br>  Now we delve a little into the work of LACP.  Turn on the simulation mode and select only the LACP filter, so that the others do not distract. <br><br><img src="https://habrastorage.org/web/bb0/b1b/5ab/bb0b1b5ab6cf4c88adccbf789f32d5fe.PNG"><br><br>  See that SW1 sends a LACP message to the neighbor.  We look at the Ethernet field.  In the Source, it records its MAC address, and in the Destination the multicast address is 0180.C200.0002.  This address is listening to the LACP protocol.  Well and above is the "long footcloth" from LACP.  I will not dwell on each field, but only note those that, in my opinion, are important.  But before that, a few words.  This message is used by devices for many purposes.  This is synchronization, collection, aggregation, activity check, and so on.  That is, it has several functions.  And before this all starts working, they choose a virtual MAC address for themselves.  This is usually the smallest available. <br><br><img src="https://habrastorage.org/web/8d1/741/ee6/8d1741ee667e4621a6001d0542f6e343.PNG"><br>  And they will write these addresses in the LACP fields. <br><br><img src="https://habrastorage.org/web/1b7/b45/f06/1b7b45f0670f411aa7b1a571ff162385.PNG"><br><br>  On the move, it may not immediately go to the head.  I think it will be easier to lay down with pictures.  In CPT, the LACP format is a bit crooked, so I‚Äôll provide a screen for a real dump. <br><br><img src="https://habrastorage.org/web/1c3/185/ec9/1c3185ec93a544f1991e4e5215217b6f.PNG"><br><br>  The highlighted line shows for exactly what purpose the message was sent.  That is the essence of his work.  Now it‚Äôs a single logical port-channel interface.  You can go to him and make sure: <br><br><pre> <code class="hljs pgsql">SW1(config)#interface port-channel <span class="hljs-number"><span class="hljs-number">1</span></span> SW1(config-<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>)#? arp <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> arp <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> (arpa, probe, snap) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> timeout bandwidth <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> bandwidth informational parameter cdp <span class="hljs-keyword"><span class="hljs-keyword">Global</span></span> CDP <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span> subcommands delay Specify interface throughput delay description Interface specific description duplex Configure duplex operation. <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> interface <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span> mode hold-queue <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> hold queue depth <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> Negate a command <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> its defaults service-<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span> Configure QoS Service <span class="hljs-keyword"><span class="hljs-keyword">Policy</span></span> shutdown Shutdown the selected interface spanning-tree Spanning Tree Subsystem speed Configure speed operation. storm-control storm <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span> switchport <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> switching mode <span class="hljs-keyword"><span class="hljs-keyword">characteristics</span></span> tx-ring-<span class="hljs-keyword"><span class="hljs-keyword">limit</span></span> Configure PA <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> transmit ring <span class="hljs-keyword"><span class="hljs-keyword">limit</span></span></code> </pre> <br>  And all actions performed on this interface will automatically lead to changes on the physical ports.  Here is an example: <br><br><pre> <code class="hljs vhdl">SW1(config-<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>)#switchport mode trunk %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span>-channel <span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> down %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span>-channel <span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> down %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">2</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> down %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">2</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up</code> </pre> <br>  As soon as the port-channel was switched to trunk mode, it automatically pulled the physical interfaces behind it.  We type <b>show running-config</b> : <br><br><pre> <code class="hljs erlang-repl">SW1#show running-config Building configuration... Current configuration : <span class="hljs-number"><span class="hljs-number">1254</span></span> bytes ! version <span class="hljs-number"><span class="hljs-number">12.2</span></span> no service timestamps log datetime msec no service timestamps debug datetime msec no service password-encryption ! hostname SW1 ! ! ! ! ! spanning-tree mode pvst ! interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span> channel-group <span class="hljs-number"><span class="hljs-number">1</span></span> mode active switchport mode trunk ! interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">2</span></span> channel-group <span class="hljs-number"><span class="hljs-number">1</span></span> mode active switchport mode trunk ! *************************************** interface Port-channel <span class="hljs-number"><span class="hljs-number">1</span></span> switchport mode trunk !</code> </pre> <br>  And indeed it is. <br><br>  Now I‚Äôll tell you about such a technology that deserves special attention, like Load-Balance or in Russian ‚Äúbalancing‚Äù.  When creating an aggregated channel, one should not forget that within it the physical interfaces and they let traffic through.  There are cases that the channel seems to be aggregated, everything works, but there is a situation that all traffic goes through one interface and the rest are idle.  As it happens I will explain on a usual example.  Let's see how Load-Balance works in the current lab. <br><br><pre> <code class="hljs pgsql">SW1#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> etherchannel <span class="hljs-keyword"><span class="hljs-keyword">load</span></span>-balance EtherChannel <span class="hljs-keyword"><span class="hljs-keyword">Load</span></span>-Balancing Operational State (src-mac): Non-IP: Source MAC address IPv4: Source MAC address IPv6: Source MAC address</code> </pre> <br>  At the moment, it performs balancing based on the value of the MAC address.  By default, balancing is done this way.  That is, it will pass the 1st MAC address through the first link, the 2nd MAC address through the second link, the 3rd MAC address again through the first link and will alternate.  But this approach is not always true.  Explain why. <br><img src="https://habrastorage.org/web/1ac/5a0/a70/1ac5a0a70d9044df8be1402cebd7684a.PNG"><br>  There is some kind of conditional network.  2 computers are connected to SW1.  Next, this switch connects to the SW2 aggregated channel.  And the router is connected to SW2.  By default, Load-Balance is configured for src-mac.  And that's what will happen.  Frames with MAC address 111 will be transmitted on the first link, and with MAC address 222 on the second link.  Right here.  Go to SW2.  Only one router with MAC address 333 is connected to it. And all the frames from the router will be sent to SW1 via the first link.  Accordingly, the second will always be idle.  Therefore, it is more logical to set up balancing here not by the Source MAC address, but by the Destination MAC address.  Then, for example, everything that is sent to the 1st computer will be sent on the first link, and the second on the second link. <br><br>  This is a very simple example, but it reflects the essence of this technology.  It changes as follows: <br><br><pre> <code class="hljs vhdl">SW1(config)#<span class="hljs-keyword"><span class="hljs-keyword">port</span></span>-channel load-balance ? dst-ip Dst IP Addr dst-mac Dst Mac Addr src-dst-ip Src <span class="hljs-keyword"><span class="hljs-keyword">XOR</span></span> Dst IP Addr src-dst-mac Src <span class="hljs-keyword"><span class="hljs-keyword">XOR</span></span> Dst Mac Addr src-ip Src IP Addr src-mac Src Mac Addr</code> </pre> <br>  I think this is understandable.  I note that this is an example of balancing not only for LACP, but also for other methods. <br><br>  I finish the conversation about LACP.  Finally, I can only say that this protocol is used most often due to its openness and can be used on most vendors. <br><br>  Those who thought it was not enough can get LACP <a href="http://www.ieee802.org/3/hssg/public/apr07/frazier_01_0407.pdf">here</a> , <a href="http://www.ieee802.org/3/ad/public/mar99/seaman_1_0399.pdf">here</a> and <a href="https://www.ieee.org/searchresults/index.html%3Fcx%3D006539740418318249752%253Af2h38l7gvis%26cof%3DFORID%253A11%26qp%3D%26ie%3DUTF-8%26oe%3DUTF-8%26q%3D802.3ad">here</a> .  And in addition, a <a href="https://drive.google.com/open%3Fid%3D0BzKZChrEeV7zQmk4eU1SZ1U2LVU">link</a> to this lab. <br><br>  Now about a colleague PAgP.  As mentioned above, this is a purely ‚Äútsiskovsky‚Äù protocol.  It is used less frequently (as there are fewer networks built exclusively on Cisco equipment than heterogeneous).  It works and is configured similarly to LACP, but Cisco requires it to be known and proceed to the review. <br><br>  PAgP also has 2 modes: <br><br><ol><li>  Desirable - includes PAgP. </li><li>  Auto - turn on if a PAgP message arrives. </li></ol><br><table><tbody><tr><th>  Mode </th><th>  Desirable </th><th>  Auto </th></tr><tr><td>  <b>Desirable</b> </td><td>  Yes </td><td>  Yes </td></tr><tr><td>  <b>Auto</b> </td><td>  Yes </td><td>  Not </td></tr></tbody></table><br>  We assemble a similar lab. <br><div style="text-align:center;"><img src="https://habrastorage.org/web/2a8/6ff/293/2a86ff293fef49ca9bc032a4343affe6.PNG"></div><br>  And go to SW1: <br><br><pre> <code class="hljs vhdl">SW1(config)#interface <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> fastEthernet <span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>-<span class="hljs-number"><span class="hljs-number">2</span></span> -   . SW1(config)#shutdown - . %LINK-<span class="hljs-number"><span class="hljs-number">5</span></span>-CHANGED: Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> administratively down %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> down %LINK-<span class="hljs-number"><span class="hljs-number">5</span></span>-CHANGED: Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">2</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> administratively down %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">2</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> down SW1(config-<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">range</span></span>)#channel-<span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> mode desirable -  <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>-channel      desirable (  ). Creating a <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>-channel interface <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span>-channel <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  Now we are going to configure SW2 (do not forget that the interfaces are turned off on SW1 and should be returned after them): <br><br><pre> <code class="hljs vhdl">SW2(config)#interface <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> fastEthernet <span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>-<span class="hljs-number"><span class="hljs-number">2</span></span> -   . SW2(config-<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">range</span></span>)#channel-<span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> mode auto -  <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>-channel    auto (,   PAgP-). Creating a <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>-channel interface <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span>-channel <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  Go back to SW1 and enable the interfaces: <br><br><pre> <code class="hljs vhdl">SW1(config)#interface <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> fastEthernet <span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>-<span class="hljs-number"><span class="hljs-number">2</span></span> SW1(config-<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">range</span></span>)#no shutdown %LINK-<span class="hljs-number"><span class="hljs-number">5</span></span>-CHANGED: Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up %LINK-<span class="hljs-number"><span class="hljs-number">5</span></span>-CHANGED: Interface <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span>-channel <span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span>-channel <span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up %LINK-<span class="hljs-number"><span class="hljs-number">5</span></span>-CHANGED: Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">2</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">2</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up    . . SW1: &lt;source&gt;SW1#show etherchannel summary Flags: D - down P - <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>-channel I - stand-alone s - suspended H - Hot-standby (LACP only) R - Layer3 S - Layer2 U - <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> f - failed <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> allocate aggregator u - unsuitable <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> bundling w - waiting <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> be aggregated d - <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">port</span></span> Number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> channel-groups <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> Number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> aggregators: <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span>-channel Protocol Ports <span class="hljs-comment"><span class="hljs-comment">------+-------------+-----------+---------------------------------------------- 1 Po1(SU) PAgP Fa0/1(P) Fa0/2(P)</span></span></code> </pre> <br>  SW2: <br><br><pre> <code class="hljs vhdl">SW2#show etherchannel summary Flags: D - down P - <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>-channel I - stand-alone s - suspended H - Hot-standby (LACP only) R - Layer3 S - Layer2 U - <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> f - failed <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> allocate aggregator u - unsuitable <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> bundling w - waiting <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> be aggregated d - <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">port</span></span> Number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> channel-groups <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> Number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> aggregators: <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span>-channel Protocol Ports <span class="hljs-comment"><span class="hljs-comment">------+-------------+-----------+---------------------------------------------- 1 Po1(SU) PAgP Fa0/1(P) Fa0/2(P)</span></span></code> </pre> <br>  Now go to the simulation and tune in to the PAgP filter.  We see, the departing message from SW2.  We look. <br><br><img src="https://habrastorage.org/web/d13/1fb/ae2/d131fbae22e043a88cecb6b70cf2ead0.PNG"><br><br>  That is, we see in the Source MAC address SW2.  In Destination multicast address for PAgP.  Higher protocols LLC and SNAP.  They do not interest us in this case and go to PAgP.  In one of the fields, he writes the virtual MAC address of SW1 (he is chosen according to the same principle as in LACP), and below he writes his name and the port from which this message came out. <br><br>  In principle, there are practically no differences from LACP, except for the structure itself.  Who wants to read more, <a href="https://drive.google.com/file/d/0BzKZChrEeV7zdWFRbXlZejZSQzA/view">link</a> to the laboratory.  And this is how it looks real: <br><br><img src="https://habrastorage.org/web/e26/78f/dcf/e2678fdcfc8c4d8cade926aa78011a1c.PNG"><br><br>  The last thing left is manual aggregation.  Everything is simple with aggregation: <br><table><tbody><tr><th>  Mode </th><th>  On </th></tr><tr><td>  <b>On</b> </td><td>  Yes </td></tr></tbody></table><br>  With other settings, the channel will not work. <br><br>  As mentioned above, there is no additional protocol negotiation, verification.  Therefore, before aggregation, you need to verify the identity of the interface settings.  Or reset the interface settings with the command: <br><br><pre> <code class="hljs kotlin">Switch(config)#<span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">faX</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">X</span></span></span></span></code> </pre> <br>  In the lab, everything is created by default.  Therefore, I turn immediately to the settings. <br><br><pre> <code class="hljs vhdl">SW1(config)#interface <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> fastEthernet <span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>-<span class="hljs-number"><span class="hljs-number">2</span></span> SW1(config-<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">range</span></span>)#shutdown %LINK-<span class="hljs-number"><span class="hljs-number">5</span></span>-CHANGED: Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> administratively down %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> down %LINK-<span class="hljs-number"><span class="hljs-number">5</span></span>-CHANGED: Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">2</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> administratively down %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">2</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> down SW1(config-<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">range</span></span>)#channel-<span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> mode <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> -  <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>-channel   . Creating a <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>-channel interface <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span>-channel <span class="hljs-number"><span class="hljs-number">1</span></span> SW1(config-<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">range</span></span>)#no shutdown %LINK-<span class="hljs-number"><span class="hljs-number">5</span></span>-CHANGED: Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up %LINK-<span class="hljs-number"><span class="hljs-number">5</span></span>-CHANGED: Interface <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span>-channel <span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span>-channel <span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up %LINK-<span class="hljs-number"><span class="hljs-number">5</span></span>-CHANGED: Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">2</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">2</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up</code> </pre> <br>  And similarly on SW2: <br><br><pre> <code class="hljs vhdl">SW2(config)#interface <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> fastEthernet <span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>-<span class="hljs-number"><span class="hljs-number">2</span></span> SW2(config-<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">range</span></span>)#channel-<span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> mode <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Creating a <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>-channel interface <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span>-channel <span class="hljs-number"><span class="hljs-number">1</span></span> %LINK-<span class="hljs-number"><span class="hljs-number">5</span></span>-CHANGED: Interface <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span>-channel <span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span>-channel <span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> down %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">2</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> down %LINEPROTO-<span class="hljs-number"><span class="hljs-number">5</span></span>-UPDOWN: <span class="hljs-literal"><span class="hljs-literal">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface FastEthernet0/<span class="hljs-number"><span class="hljs-number">2</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> up</code> </pre> <br>  Setup is complete.  Check with the show etherchannel summary command: <br><br><pre> <code class="hljs vhdl">SW1#show etherchannel summary Flags: D - down P - <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>-channel I - stand-alone s - suspended H - Hot-standby (LACP only) R - Layer3 S - Layer2 U - <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> f - failed <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> allocate aggregator u - unsuitable <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> bundling w - waiting <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> be aggregated d - <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">port</span></span> Number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> channel-groups <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> Number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> aggregators: <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span>-channel Protocol Ports <span class="hljs-comment"><span class="hljs-comment">------+-------------+-----------+---------------------------------------------- 1 Po1(SU) - Fa0/1(P) Fa0/2(P)</span></span></code> </pre> <br>  Ports with the necessary parameters, and in the field protocol "-".  That is, in addition, nothing is used. <br><br>  As you can see all the methods of setting up the aggregation do not cause any difficulties and differ only in a couple of commands. <br><br>  By the end of the article I will quote a small Best Practice on correct aggregation.  All labs used 2 cables for aggregation.  In fact, you can use 3 and 4 (up to 8 interfaces in a single port-channel).  But it is better to use 2, 4 or 8 interfaces.  And all because of the hashing algorithm that Cisco came up with.  The algorithm calculates hash values ‚Äã‚Äãfrom 0 to 7. <br><table><tbody><tr><th>  four </th><th>  2 </th><th>  one </th><th>  Decimal value </th></tr><tr><td>  0 </td><td>  0 </td><td>  0 </td><td>  0 </td></tr><tr><td>  0 </td><td>  0 </td><td>  one </td><td>  one </td></tr><tr><td>  0 </td><td>  one </td><td>  one </td><td>  3 </td></tr><tr><td>  one </td><td>  0 </td><td>  0 </td><td>  four </td></tr><tr><td>  0 </td><td>  0 </td><td>  one </td><td>  one </td></tr><tr><td>  one </td><td>  0 </td><td>  one </td><td>  five </td></tr><tr><td>  one </td><td>  one </td><td>  0 </td><td>  6 </td></tr><tr><td>  one </td><td>  one </td><td>  one </td><td>  7 </td></tr></tbody></table><br>  This table displays 8 values ‚Äã‚Äãin binary and decimal form. <br><br>  Based on this value, an Etherchannel port is selected and assigned a value.  After that, the port receives a certain ‚Äúmask‚Äù that displays the values ‚Äã‚Äãfor which that port is responsible.  Here is an example.  We have 2 physical interfaces, which we combine into one port-channel. <br><br>  Values ‚Äã‚Äãare spread out as follows: <br><br>  1) 0x0 - fa0 / 1 <br>  2) 0x1 - fa0 / 2 <br>  3) 0x2 - fa0 / 1 <br>  4) 0x3 - fa0 / 2 <br>  5) 0x4 - fa0 / 1 <br>  6) 0x5 - fa0 / 2 <br>  7) 0x6 - fa0 / 1 <br>  8) 0x7 - fa0 / 2 <br><br>  As a result, we get that half of the values ‚Äã‚Äãor patterns will be taken by fa0 / 1, and the second half by fa0 / 2.  That is, we get 4: 4.  In this case, balancing will work correctly (50/50). <br><br>  Now let's move on and explain why it is not recommended to use, for example, 3 interfaces.  We make a similar comparison: <br><br>  1) 0x0 - fa0 / 1 <br>  2) 0x1 - fa0 / 2 <br>  3) 0x2 - fa0 / 3 <br>  4) 0x3 - fa0 / 1 <br>  5) 0x4 - fa0 / 2 <br>  6) 0x5 - fa0 / 3 <br>  7) 0x6 - fa0 / 1 <br>  8) 0x7 - fa0 / 2 <br><br>  Here we get that fa0 / 1 will take on 3 patterns, fa0 / 2 also 3 patterns, and fa0 / 3 2 patterns.  Accordingly, the load will not be evenly distributed.  We get 3: 3: 2.  That is, the first two links will always be more loaded than the third. <br><br>  I will not consider all other options, as the article will stretch to even more characters.  One can only estimate that if we have 8 values ‚Äã‚Äãand 8 links, then each link will take for itself a pattern and it will turn out 1: 1: 1: 1: 1: 1: 1: 1.  This means that all interfaces will be loaded in the same way.  There is still some claim that you only need to aggregate an even number of wires in order to achieve proper balancing.  But this is not entirely true.  For example, if you combine 6 wires, then balancing will not be uniform.  Try to find yourself.  I hope the algorithm is clear. <br><br>  Cisco on the site in this case has a good article with a sign.  You can read on this <a href="http://www.cisco.com/c/ru_ru/support/docs/lan-switching/etherchannel/12023-4.html">link</a> .  If you still have questions, write! <br><br>  Since I‚Äôve been so deep, I‚Äôll tell you about the increase in throughput.  I specifically touched on this topic at the end.  There are cases that urgently need to increase the bandwidth.  There is no money for equipment, but there are free ports that can be collected and put into one ‚Äúthick‚Äù stream.  Many sources (books, forums, websites) say that connecting eight 100-megabit ports, we get a stream of 800 Mb / s or eight gigabit ports will give 8 Gb / s.  Here is a piece of text from the "ciskovskaya" <a href="https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst4500/12-2/3-1-1SG/configuration/guide/config/channel.pdf">article</a> . <br><br><img src="https://habrastorage.org/web/882/bdf/f9d/882bdff9dae640c19fb9c803dccbb337.PNG"><br><br>  Theoretically, this is possible, but in practice it is almost unattainable.  I at least have not met.  If there are people who were able to achieve this, I will be glad to hear.  That is, to get it, you need to take into account a bunch of formalities.  And those that I described, only part.  This does not mean that there will be no increase at all.  It certainly will, but not as much as possible. <br><br>  This article has come to an end.  In this article, we learned how to aggregate channels manually, as well as using LACP and PAgP protocols.  We learned what balancing is, how it can be controlled and how to properly assemble the Etherchannel to obtain the maximum load distribution.  See you in the next article! </div><p>Source: <a href="https://habr.com/ru/post/334778/">https://habr.com/ru/post/334778/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../334766/index.html">About "Elegant Objects" and Evangelicals</a></li>
<li><a href="../334770/index.html">Kubernetes success stories in production. Part 2: Concur and SAP</a></li>
<li><a href="../334772/index.html">Using async / await in nodejs today</a></li>
<li><a href="../334774/index.html">Simple initial authorization using iptables</a></li>
<li><a href="../334776/index.html">Laravel - an ecosystem, not just a PHP framework</a></li>
<li><a href="../334780/index.html">Register for the webinar "How to safely and profitably protect the company from unknown threats and cryptographers"</a></li>
<li><a href="../334782/index.html">As another large courier company, the personal data of its customers handed out</a></li>
<li><a href="../334786/index.html">MMO from scratch. Part 2. Building functionality + Diamond Square algorithm</a></li>
<li><a href="../334788/index.html">Offshore and foreign trade transactions: advantages and pitfalls</a></li>
<li><a href="../334790/index.html">As I made the fastest resize of images. Part 3, fixed-point numbers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>