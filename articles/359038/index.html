<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Vulnerability Mikrotik allows you to get a list of all users through the winbox</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mikrotik devices have become widespread because of their price relative to functionality. But the mistakes in the software has not been canceled. And ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Vulnerability Mikrotik allows you to get a list of all users through the winbox</h1><div class="post__text post__text-html js-mediator-article"><p>  Mikrotik devices have become widespread because of their price relative to functionality.  But the mistakes in the software has not been canceled.  And this time I got a serious bug. </p><br><p>  On March 25, one of the users of the Mikrotik forum <a href="https://forum.mikrotik.com/viewtopic.php%3Ft%3D132368">reported</a> on the detection of suspicious activity of mikrotik routers using telnet (TCP port 23), TR-069 (TCP port 7547) and WINBOX (TCP 8291) ports. </p><br><p>  Employees of the company referred to a bug that was closed a year ago.  Later it turned out that this was a new vulnerability, and on April 23, the company Mikrotik <a href="https://forum.mikrotik.com/viewtopic.php%3Ft%3D133533">announced the release of</a> firmware, where this vulnerability was removed. </p><br><p>  Despite the fact that the company rather quickly released a bugfix, devices exposed to a network vulnerability amount to thousands. </p><br><img src="https://habrastorage.org/webt/qp/yp/rd/qpyprdhvre6mjevcfwznusbm8xe.png"><a name="habracut"></a><br><br>  I recommend all RouterOS users to upgrade to at least version 6.40.8 [bugfix] or 6.42.1 [current] <br><p>  Also in the public domain appeared tools that allow ordinary users to gain access to devices that are not protected by the firewall or not updated to the current version. </p><br><p>  In view of the recent events, I suggest that all users of the Mikrotik and CHR devices make at least the minimum setting. </p><br><h2>  Minimum security settings </h2><br><p>  Analyzing devices with a bug, I noticed that almost everyone ignores the firewall settings, despite the fact that it is the most effective tool to protect your network infrastructure.  And 90% of devices have an "admin" account with full rights.  Straight dream for brodforserov. </p><br><p>  Regarding RouterOS protection, take a few simple steps to ensure minimum security: </p><br><ol><li><p>  Make sure you have the latest firmware. </p><br></li><li><p>  You should not hope for the absence of bugs in the new firmware and configure the firewall: <br>  2.1.  In the INPUT chain, access to the device is allowed only from trusted ip addresses.  For example, the range of the home network or ip addresses of network administrators. <br>  Note that the INPUT chain applies only to packets addressed directly to this router.  Transit packages belong to the FORWARD chain. <br>  2.2.  Drop all packages that do not match the allowed ones. <br>  2.3.  In case you need to periodically access from dynamic addresses, use "port knocking" to add your ip to the allowed for a certain time. </p><br></li><li><p>  Turn off all services that you do not use (api, ssh, telnet etc.) </p><br></li><li>  After setting up the firewall and updating the firmware, change the password. </li></ol><br><p>  If you use the account name "admin", also create your account, for example, "Vasya".  Go under it, check permissions and block the "admin". </p><br><h3>  Firewall </h3><br><p> With the use of the terminal. <br>  Create a list of addresses that will be allowed to connect to the router <br> <code>/ip firewall address-list</code> <br> <code>add address=192.168.1.0/24 list=allow-ip</code> <br> <code>add address=192.168.88.10/32 list=allow-ip</code> </p> <br><p>  Add a rule that allows all actions from these addresses </p><br><p> <code>/ip firewall filter</code> <br> <code>add action=accept chain=input comment="Allow Address List" src-address-list=allow-ip</code> </p> <br><p>  If I need access from unknown addresses, I wait for the icmp packet (ping) of a certain size.  If such a package arrives, the source address is added to the allow-ip list with a time of 1 hour.  If desired, you can make a cascade of such packages. </p><br><p> <code>/ip firewall filter</code> <br> <code>add action=add-src-to-address-list address-list=allow-ip address-list-timeout=1h chain=input packet-size=783 protocol=icmp</code> </p> <br><p>  Pay attention to the packet size of 783 bytes.  But when pinging, you should indicate 28 bytes less.  In this case, ping from windows: </p><br><p> <code>ping -l 755 myhostname.domain</code> </p> <br><p>  Denying access to all ports that are not allowed above: </p><br><p> <code>/ip firewall filter add action=drop chain=input</code> </p> <br><h3 id="servisy">  Services, </h3><br><p>  which you do not use, too, must be turned off for these are extra points of failure. <br> <code>/ip service</code> <br> <code>set api disabled=yes</code> <br> <code>set api-ssl disabled=yes</code> <br>  and so on. </p><br><h3 id="tozhe-samoe-pri-pomoschi-vinboks">  Same thing with a winbox. </h3><br><p>  We allow in our address list. <br></p><br><img src="https://habrastorage.org/webt/j3/nf/c-/j3nfc-aekcw3dboprbj3emwdeu0.png"><br><br><img src="https://habrastorage.org/webt/yu/kp/nh/yukpnh6rgek33kz6f_g2kaqagh4.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/_t/sb/2a/_tsb2aa95lg7y6leplte11i7ndg.png"><br><br><img src="https://habrastorage.org/webt/et/o2/qh/eto2qhxbih_pgnplcvrkuk1mwjy.png"><br><br><img src="https://habrastorage.org/webt/r0/3n/1v/r03n1vsv5pjaw_wzrkyemlcea6k.png"><br><br>  The rule of adding to the address list by ping <br><br><img src="https://habrastorage.org/webt/hi/v8/70/hiv870px1jbpuqze7mwsq8eqpc8.png"><br><br><img src="https://habrastorage.org/webt/ba/2i/0e/ba2i0egu9a9fc03unanywi0zyps.png"><br><br><img src="https://habrastorage.org/webt/ux/ji/r-/uxjir-vj1rbizeb3jndr29bgy2a.png"><br><br>  The rule of prohibition of everything and everything is put the most recent <br><br><img src="https://habrastorage.org/webt/tz/s4/mw/tzs4mwzrmfw1sjghm0yw05vkwfy.png"><br><br><img src="https://habrastorage.org/webt/mq/ci/um/mqciumjfi92upnedp0vlesh_q4o.png"><br><br>  That is, it should look like this. <br><br><img src="https://habrastorage.org/webt/eu/xm/6f/euxm6fsg2oopempr7nccpa3d82o.png"><br><br>  Services are configured here <br><br><img src="https://habrastorage.org/webt/ej/b2/mo/ejb2mo3bqeryxdkyufoqfnuxta0.png"><br><br><img src="https://habrastorage.org/webt/_a/1d/6v/_a1d6v1lyln9ngfuavbtyewjnog.png"><br><br>  Users can add and delete "admin", and also change the password here. <br><br><img src="https://habrastorage.org/webt/je/fx/tg/jefxtgc1zeqe-rakypihk4th2se.png"><br><br><img src="https://habrastorage.org/webt/d1/sa/_8/d1sa_8ovl2fmqtd93soybvjwizk.png"><br><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  I really hope that my brief instruction will help your device not to get control of any botnet network, including Hajim. </p></div><p>Source: <a href="https://habr.com/ru/post/359038/">https://habr.com/ru/post/359038/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../359028/index.html">Meeting with Vitaly Friedman (Smashing Magazine) in the Wrike office</a></li>
<li><a href="../359030/index.html">CI / CD Pipeline on the example of one small project of the Ural IT Directorate</a></li>
<li><a href="../359032/index.html">The Protected icon for HTTPS sites will disappear from Chrome, and this is correct.</a></li>
<li><a href="../359034/index.html">Security Week 18: cryptic hysteria</a></li>
<li><a href="../359036/index.html">Java labor market - what we know about him, what he knows about us</a></li>
<li><a href="../359040/index.html">"The principle of pasta": scientists have organized random access to DNA memory</a></li>
<li><a href="../359042/index.html">Quick setup of Continuous Integration for .NET Core using Travis - CI. Very short</a></li>
<li><a href="../359044/index.html">50 announcements of Build 2018. Part 2. Azure & Bots</a></li>
<li><a href="../359046/index.html">What was the first Windows you? Windows 3.0 birthday</a></li>
<li><a href="../359050/index.html">Marvin Minsky "The Emotion Machine": Chapter 5 Thinking</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>