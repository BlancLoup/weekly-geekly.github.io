<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Moving cloud CRM to boxed version</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When the capacity of the cloud service is already becoming scarce, and the transition to the boxed version is seen as the next logical step for the fu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Moving cloud CRM to boxed version</h1><div class="post__text post__text-html js-mediator-article">  When the capacity of the cloud service is already becoming scarce, and the transition to the boxed version is seen as the next logical step for the further development of the corporate portal and the CRM system, then the companies have a question: how to do it, what is waiting for them and will everything remain after transfer? <br><a name="habracut"></a><br>  It would seem that everything is quite simple: <br><br><ul><li>  Expand the host with the box; </li><li>  We write in technical support; </li><li>  We order backup; </li><li>  Looking forward to receive it; </li><li>  We expand the backup and enjoy the wide possibilities of the boxed version. </li></ul><br>  But practice shows that the transition from the cloud to the boxed version is far from trivial and requires a clear plan of action, analysis of possible risks and readiness for the fact that everything goes wrong. <br><br>  We were approached by a major developer with a high-loaded CRM system on the cloudy Bitrix24.  CRM actively worked with sales managers from several branches of the company, the portal was integrated with Asterisk IP telephony for automated lead creation, recording conversations with customers and recording the facts of a call on a client card in CRM.  More than 100 leads were created per day in CRM through various channels. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It was clear that any idle time in the process of transferring to the boxed version threatens the Customer with huge losses.  After talking with the customer about the seriousness of the transition and possible risks, we set to work. <br><br>  First of all, we analyzed the existing cases and publications on the transfer of the cloud to the box, made a detailed check-list of errors that we may encounter: <br><br><ul><li>  Applications running in the cloud are not on the box; </li><li>  The cost of licenses for applications for the cloud version and the box may vary; </li><li>  The risk of losing data due to temporary lag during the transfer; </li><li>  Some users from different branches will continue to work on the cloud service after the transfer, and it will be necessary to additionally search and transfer the entities they have created to CRM; </li><li>  The service‚Äôs mobile application will not work on the closed portal; </li><li>  After the transfer, some users will not be able to log in with their old password; </li><li>  There may be a malfunction in chat bots; </li><li>  Frequent dropping of authorization when working on the portal; </li><li>  Only a portion of task comments can be displayed; </li><li>  The database will be without a search index. </li></ul><br>  Next, a rosary algorithm of actions was broken down by roles, which had to be performed both by the Contractor and by the Customer: <br><br>  <b>Phase 1 (Medium Urgency)</b> <br><br><ul><li>  Deploying the Production Environment (Artist); </li><li>  Testing the deployed environment (Contractor); </li><li>  Deploying the boxed version on hosts (Contractor); </li><li>  Purchase and installation of SSL-certificate for telephony operation (Customer-purchase, Contractor-installation); </li><li>  Testing the boxed version - performance, parameters, internal tests (Contractor). </li><li>  Deploying the Pre-Production Environment - a full copy of Production (Artist). </li></ul><br>  <b>2 phase (high urgency)</b> <br><br><ul><li>  Application for unloading backup.  Coordination with the technical support of the service date of the backup (Customer); </li><li>  Informing users about the backup date and drawing up a plan for temporary storage of information from CRM (Customer); </li><li>  Deploying a backup to Production (Contractor); </li><li>  Portal configuration after backup (Contractor); </li><li>  Setting up a telephony server for working with the portal (Customer); </li><li>  Telephony module setup (Contractor); </li><li>  Primary telephony testing (Customer); </li><li>  In-depth testing of CRM, telephony, business processes CRM (Customer Sales Department); </li><li>  Health statement.  Delete test data (Customer); </li><li>  Stopping the work of sales managers in the cloud service (Customer); </li><li>  Transfer of transactions, leads, contacts since the backup was created from the cloud version to the box (Contractor); </li><li>  Start of work of sales managers on the boxed version (Customer). </li></ul><br>  <b>3 phase (low urgency)</b> <br><br><ul><li>  Testing the boxed version within 2-3 days (Customer); </li><li>  Approval of full working capacity (Customer); </li><li>  Pre-Production Update - Transfer a full copy of Production (Artist). </li></ul><br>  Having made this plan and having a checklist with possible errors, we realized that we have too great risks due to the large number of uncertainties: <br><br><ul><li>  How fast will the service provide backup? </li><li>  How long will it take to deploy a backup, given that the CRM database is huge? </li><li>  How quickly can I reconfigure the module and telephony server to work correctly with CRM? </li><li>  What specific bugs can appear on the portal, how critical will they be for users, and how long will it take to fix them? </li></ul><br>  We realized that we have an indefinite time lag, which, as it increases, would bring more and more losses for the client.  To minimize the time lag, it was necessary to understand how much time we would spend on porting the portal and debugging it. <br><br>  So we came to the conclusion that one backup from the cloud will not be enough, and in order to minimize losses, it is necessary to deploy one backup - to identify all possible risks and estimate the time lag, and then the second backup, which we could plan so as to minimize losses . <br><br>  Bitrix provides only one backup and only once, since the process of transferring from cloud to box is technically complex.  Contacting technical support and connecting the Customer to this issue, we still got the go-ahead to provide two backups from the cloud at different times.  The time of the first backup was agreed upon and the transfer work began. <br><br><h3>  Volume, speed and broken parts </h3><br>  In order to understand how much and what time it will take for us, we began to keep a journal in which we recorded every step. <br><br>  So, the portal started backing up the service on Thursday night, that is, CRM had the latest data at the end of Thursday, and provided us with a link to the backup on Friday lunch.  Here we faced the first difficulty - the backup weighed about 30 GB, and the download speed from Amazon.com servers that hosted the cloud was far from ideal (800 Kb / s on average).  Having calculated approximately the time for which several parts of the backup were loaded, we realized that in total, it would take about 10 hours to download the backup. <br><br>  The next problem was the appearance of errors during the pumping of various parts of the backup, which was detected only during deployment.  These parts, as a rule, also caused a hash sum mismatch error, because of this, it was necessary to detect the broken part of the archive in the error text and manually transfer it over SSH, after which the unpacking was restarted from scratch of the entire backup. <br><br>  Successfully downloading and deploying a backup on our hosts, we received a working copy of the cloud in the box and proceeded to the next stage - testing and debugging the portal. <br><br><h3>  Small bugs and insidious push &amp; pull </h3><br>  To our surprise, the testing of the box went relatively smoothly.  We tested the CRM, went through all the service tools, checked the performance of the messenger, drove the internal tests and revealed only 3 errors: <br><br><ul><li>  The file attachment icon disappeared in the messenger and the sending of files in the messenger as a whole did not work; </li><li>  The links in the notifications had an address without a domain, for example: <a href="https://company/personal/user/1250/tasks/task/view">company / personal / user / 1250 / tasks / task / view</a> , respectively, were not working; </li><li>  Some users could not log in to the portal with an incorrect login / password error. </li></ul><br>  We knew about the impossibility of logging in after the transfer in advance, the service immediately warns about this when providing a backup.  Unfortunately, this problem is solved only by recovering the password by users or manually changing the password for each user by the administrator, since the passwords from Bitrix24.Network are not stored on the portal. <br><br>  The error with the links in the notifications was resolved quite quickly - by prescribing the portal domain in the site settings and the settings of the main module. <br><br>  But the missing file attachment icon in the messenger delivered quite a few worries.  The task took another couple of hours of unsuccessful attempts to understand the cause of the missing icon.  As a result, we found that the reason was far from being in the disk module, as was originally supposed.  The reason was in the disconnected push server in the settings of the push &amp; pull module, which automatically disconnected the file transfer in the messenger. <br><br><h3>  Final Testing </h3><br>  After successful testing and debugging of the portal, a detailed report was made to the Customer and the next step was in-depth testing by the Customer‚Äôs CRM sales department, as well as setting up the telephony server to work with the box and testing calls. <br><br>  During testing, significant problems have been identified.  We deployed the test host and rolled a full copy of the combat portal onto it, in case we had a 100% working version of the portal and we could make a comparison in the settings if non-standard errors occurred that were not detected during testing of the first backup. <br><br>  After deploying a copy of the portal, we went over to an analysis of the journal, in which we fixed errors and the time they were resolved.  After analyzing the magazine in detail, we updated the second backup transfer plan, realized how much we can lose leads during the final transfer and put additional time on manual import of lost leads from the cloud version.  All the details and risks were also spoken to the Customer and made up a letter to the technical support of the service with a request to prepare a second backup. <br><br><h3>  The second backup and why can things go wrong? </h3><br>  Having coordinated the time for creating a backup also on Thursday, we prepared the team for operational actions by 12 noon on Friday.  In the area of ‚Äã‚Äã12-13 hours we received a long-awaited link and launched the download.  A few hours later it was clear that the archive would be pumped out no longer than 10 hours, but about 14!  The bandwidth of our provider's channel and Amazon.com servers on this day left much to be desired.  We were preparing for night work, as the leads continued to fall, and the Customer was waiting for a report to begin setting up the telephony server. <br><br>  As it often happens - not everything went according to plan.  The next step was to transfer the accumulated leads from the cloud version to the box - the process is simple and straightforward, but has its own nuances.  If in the list of leads you select those leads that need to be exported and click ‚ÄúExport to CSV‚Äù, then all existing leads in CRM will be unloaded, not just the selected ones.  Logically, with a large lead database, the cloud fell into error.  The solution was to use a filter, only in this case the leads were unloaded correctly. <br><br>  Further testing has passed without surprises, since we already knew: what will not work, how to edit it and where.  Having successfully connected and tested the telephony, on Monday, sales managers have already fully worked with CRM in the boxed version.  And already in working order, during the week, we tweaked the portal, backing up, made the final copy of the portal to the test host. <br><br>  The entire transfer process took about a week of work from the moment of planning to the final settings. <br><br>  As a result, I would like to note the importance of planning such complex and risky projects, the mandatory involvement of the customer in the process and the disclosure of possible risks, although, as practice shows, deviations from the plan are no exception. </div><p>Source: <a href="https://habr.com/ru/post/425911/">https://habr.com/ru/post/425911/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../425899/index.html">An anthill or a fortress? Building a house for the price of an apartment. 1 part</a></li>
<li><a href="../425901/index.html">Weather Station on Arduino from A to Z. Part 1</a></li>
<li><a href="../425903/index.html">Holiday comes to us: SCR has expanded the ISM-range of 868 MHz twice</a></li>
<li><a href="../425905/index.html">How to write an assembler program with overlapping instructions (another bytecode obfuscation technique)</a></li>
<li><a href="../425907/index.html">Making a machine learning project in Python. Part 2</a></li>
<li><a href="../425915/index.html">How inter-transport communication can replace traffic lights and shorten the way to work</a></li>
<li><a href="../425917/index.html">The fighter for justice did not give Waymo to patent the key technology of lidar</a></li>
<li><a href="../425919/index.html">Hexagon maps in Unity: save and load, textures, distances</a></li>
<li><a href="../425921/index.html">Meet the .NET community at CLRium # 4 + online</a></li>
<li><a href="../425923/index.html">25 years DOOM</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>