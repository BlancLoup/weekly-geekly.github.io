<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Knee monitoring</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The task of tracking a moving object is widespread. In the simplest case, you need to take the phone with android, put OsmAnd there and set up live mo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Knee monitoring</h1><div class="post__text post__text-html js-mediator-article">  The task of tracking a moving object is widespread.  In the simplest case, you need to take the phone with android, put OsmAnd there and set up live monitoring.  Sit yourself and look at the map (OpenStreetMap of course) moving the device.  I would have done so, but suddenly it turned out that on the right day I would have no Internet, no computer, no time. <br><br>  And I began to look for a way out. <a name="habracut"></a>  First, short consultations and discussions took place <a href="http://irc.latlon.org/logs/osm-ru/%2523osm-ru.2012-04-17.log.html">with the chat</a> , and then, after lunch, the decision came. <br><br>  There is a mobile phone and there is a service of the operator email2sms.  So in my case, the task is reduced to a simple receipt of a human-readable text no more than 1000 characters long.  But first I will try to outline my train of thought. <br><ul><li>  The tracking service provided by Opsos is dismissed immediately, as inaccurate and due to the absence of the SIM of any of the designated operators. </li><li>  In <a href="http://www.openstreetmap.ru/">OSM</a> there is a good search ( <a href="http://habrahabr.ru/post/142129/">not without sin, as habra users found out</a> , but acceptable).  And what if it is deployed in the opposite direction and, using the transmitted coordinates, we obtain the name of a nearby ground object.  What does this have to do with my task? .. But not with it!  It‚Äôs just that the text should be more human-readable.  In general, the idea is interesting, we must leave it for later.  The author of the site even has something in store. </li><li>  ‚ÄúThe observed has moved 350 meters to the north from the past,‚Äù seems to be good, but then you need to somehow save all the points.  Even if the last two ... Where can I get this hosting? </li><li>  Arrange the WPT in advance and upon reaching them let the device discard the message.  Well, here, firstly, the route is not known in advance, but only the destination.  Secondly, there was no such application.  About this below. </li><li>  And so it is not always responsive <b>juick_ppl</b> and it <a href="http://juick.com/1850207">did not help here</a> . </li><li>  ‚ÄúObserved‚Äù - ‚Äúrelative‚Äù - ‚Äúdestination‚Äù ... Eureka! </li></ul><br>  So, 100,500 applications from the market are able to do the same, that OsmAnd collects tracks, shows a location on a map, shares coordinates.  The problem is that they are divided only by pressing the ‚Äúshare‚Äù menu item, and the dependence on manual actions of an unschooled android user should be excluded.  And then to say - a pair of coordinates ( <i>lat</i> , <i>lon</i> ) is good except to hang a frame on the wall, but not to tell the person where the object has already reached.  Other suitable options have not been found, perhaps not enough time.  I will mention only OruxMaps - undoubtedly useful and highly functional program.  So functional that it scared me to shiver at my knees.  Leave her study for later ... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At this point, the thought was clearly formed about the format of the message received every 5 minutes: ‚Äú <i>There is XXX km to the destination point</i> ‚Äù, this will be enough for me.  It could be less often, but 5 minutes is the maximum that can be set.  The approximate limit on the number of email2sms messages is 100 per day.  That's enough for as much as 8 hours, good enough. <br><br>  Unexpectedly, I just managed to find hosting, on the terms of placing an extremely simple php script, without a database and other goodies.  So it's time to start coding.  On the website from the tabs ( <a href="http://gis-lab.info/qa/great-circles.html">GIS-LAB.info</a> , which is to be hidden) there was a sensible description of large circles with the ready-made algorithm ‚ÄúCalculation of the distance and initial azimuth between two points on the sphere‚Äù, I brazenly distort and unscrupulously alter in php: <br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">#   $slat=53.393055555556; $slon=58.755555555556; $flat=55.3; $flon=61.5; #pi -  pi, rad -   () $pi = pi(); $rad = 6372795; #  $lat1 = deg2rad($slat); $long1 = deg2rad($slon); $lat2 = deg2rad($flat); $long2 = deg2rad($flon); #       $cl1 = cos($lat1); $cl2 = cos($lat2); $sl1 = sin($lat1); $sl2 = sin($lat2); $delta = $long2 - $long1; $cdelta = cos($delta); $sdelta = sin($delta); #    $y = sqrt(pow($cl2*$sdelta,2)+pow($cl1*$sl2-$sl1*$cl2*$cdelta,2)); $x = $sl1*$sl2+$cl1*$cl2*$cdelta; $ad = atan2($y,$x); $dist = $ad*$rad; #   $x = ($cl1*$sl2) - ($sl1*$cl2*$cdelta); $y = $sdelta*$cl2; $z = rad2deg(atan(-$y/$x)); if ($x &lt; 0) $z = $z+180; $z2 = ($z+180.) % 360. - 180.; $z2 = - deg2rad($z2); $anglerad2 = $z2 - ((2*$pi)*floor(($z2/(2*$pi))) ); $angledeg = rad2deg($anglerad2); echo 'Distance &gt;&gt; ' . $dist . ' [meters]'; echo '&lt;br/&gt;Initial bearing &gt;&gt; ' . $angledeg . ' [degrees]'; ?&gt;</span></span></code> </pre> <br>  <i>Distance &gt;&gt; 276805.84112453 [meters]</i> <i><br></i>  <i>Initial bearing &gt;&gt; 39 [degrees]</i> <br><br>  As a test example <a href="http://www.world-airport-codes.com/dist/%3Fa1%3DMQF%26a2%3DCEK">, airport points were taken</a> , roughly corresponding to the direction and distance of the trip. <br><br>  <i>Distance between MQF and CEK</i> <i><br></i>  <i>The distance has been calculated as being: 277 kilometers (173 miles)</i> <br><br>  Ok, works!  We make out the function, the initial azimuth is discarded as unnecessary and to simplify.  We attach the missing functionality, not forgetting to post the data in the direction for which Live Tracking originally appeared in OsmAnd 0.7.1. <br><br><img src="https://habrastorage.org/storage2/2e8/790/388/2e8790388317bd62d868249796c6b357.png" title="Chelyabinsk, bus station"><br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($llat1,$llong1,$llat2,$llong2)</span></span></span><span class="hljs-function"> #   </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//[......] return $dist; } import_request_variables('G', 'hhsb_'); //       -   .   ! # c - current; f - final; s - start $d1 = distance($hhsb_clat,$hhsb_clon,$hhsb_flat,$hhsb_flon); $d2 = distance($hhsb_clat,$hhsb_clon,$hhsb_slat,$hhsb_slon); #  $emailfrom = $hhsb_rpl; $replyemail = $emailfrom; $emailto = $hhsb_eml; $headers = "MIME-Version: 1.0\r\n"; $headers .= "From: ".$emailfrom."\r\n"; $headers .= "Reply-To: ".$replyemail."\r\n"; $headers .= "X-Priority: 3 (Normal)\r\n"; $headers .= "X-Mailer: yourhoster.com\r\n"; $headers .= "Content-Type: text/plain; charset=Windows-1251\r\n"; $headers .= "Content-Transfer-Encoding: 8bit"; $message = "Distance &gt;&gt; ".$d1." to final destination and ".$d2." from start (meters)\r\n"; $message .= "Speed &gt;&gt; ".round($hhsb_speed,2)." (m/s)"; $subject = "distance"; mail($emailto, $subject, $message, $headers); #        $esya = 'http:///?'.$hhsb_clat.':'.$hhsb_clon.':'.$hhsb_hdop.':'.$hhsb_alt.':'.$hhsb_speed.':'.$hhsb_usr.':'.$hhsb_n; $ch = curl_init($esya); $res=curl_exec($ch); curl_close($ch); $ans=json_decode($res); echo $ans-&gt;response; //{"s":1} -,    </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br><br>  A very important step - in OsmAnd, enter the line <i>Web address of the Live tracking</i> type: <br><br> <code>hÕátÕátÕápÕá://hosting_does_not_advertise/fd.php?clat={0}&amp;clon={1}&amp;hdop={3}&amp;alt={4}&amp;speed={5}&amp;slat=53.393&amp;slon=58.756&amp;flat=55.3&amp;flon=61.5&amp;eml=emailto@gmail.com&amp;rpl=emailfrom@mail.ru&amp;usr=[osmohash]&amp;n=[num]</code> <br> <br><img src="https://habrastorage.org/storage2/6c0/2ec/1bb/6c02ec1bbc124fd973c9b2c4d0443b88.png" title="hundreds of mail" vspace="5" hspace="5" align="right"><br><br>  You can <s>rob cows</s> in the same concept to add waypoints, and if you have a little bit of database in general, turn around in full.  However, my knee minimum has already been met ... <br>  ... <a href="">Good luck</a> !  It remains to be sure to charge the android.  After all, if you do not <s>blow</s> charge, then the focus will not work. <br><br>  Of the deficiencies identified: <br><ul><li>  The maximum interval of 5 minutes, I would like more.  Ideally, generally be able to enter a number, and not choose from the list. </li><li>  By the end of the second hour, the application died, it is not clear who tried.  I suspect that the android summed up, because  the user has not been active all this time - as soon as the first data transfer took place, the device was immediately in the bag and regularly gave signals.  I had to induce panic and ask to reanimate OsmAnd.  Managed, OK. </li><li>  There is still a dependency on an untrained user - do not turn off remotely.  The instructions did not help, it's hard to see ... It turned out to be easier to turn off the power of the ‚Äútracker‚Äù on arrival. </li></ul><br><img src="https://habrastorage.org/storage2/604/b3b/17c/604b3b17c50154ffdc817e0c86f9d07f.png" title="soloist, without ensemble" vspace="5" hspace="5" align="left">  But it is enough to wash the bones of such a spherically ideal, thoughtful and logically complete life hacking, after all, we have already arrived at the scene. <br>  <i>Distance &gt;&gt; 29 to final destination and 247194 from start (meters)</i> <br>  <i>Speed ‚Äã‚Äã&gt;&gt; 0.0 (m / s)</i> </div><p>Source: <a href="https://habr.com/ru/post/142689/">https://habr.com/ru/post/142689/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../142677/index.html">Program, aport!</a></li>
<li><a href="../142680/index.html">Participation in Google Summer of Code 2012. Part One: Proposal Submission</a></li>
<li><a href="../142684/index.html">[Poll] Photoshop and Linux. Usage patterns</a></li>
<li><a href="../142685/index.html">Automatic staircase lighting with Arduino</a></li>
<li><a href="../142688/index.html">The Habrahabr ribbon is now provided with the ‚ÄúAll‚Äù tab, and this tab contains not only blog entries, but also questions</a></li>
<li><a href="../142690/index.html">How does a programmer think</a></li>
<li><a href="../142694/index.html">Droider Show # 37. Holivar, senseless and merciless</a></li>
<li><a href="../142696/index.html">Accessibility - OS test for people with disabilities (Part 1)</a></li>
<li><a href="../142697/index.html">Writing your Core Image Filter</a></li>
<li><a href="../142699/index.html">MS SCOM and group policies: are there any drawbacks?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>