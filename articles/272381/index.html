<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Useful Snippets for Nginx Configs</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, dear habravchane! In Elasticweb, we secretly support Nginx and, probably, we are one of the few hosting sites that do not support Apache and...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Useful Snippets for Nginx Configs</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/ddf/206/50c/ddf20650ceb746499571710d4a1e1a31.png"><br><br>  Good day, dear habravchane!  In <a href="http://habrahabr.ru/post/272241/">Elasticweb,</a> we secretly support Nginx and, probably, we are one of the few hosting sites that do not support Apache and .htaccess, respectively.  In this regard, a large number of calls to those.  support is associated with assisting in writing a configuration file for Nginx.  Therefore, we decided to assemble a <a href="https://github.com/elasticweb/nginx-snippets">collection of useful snippets</a> and a <a href="https://github.com/elasticweb/nginx-configs">collection of ready-made Nging configs</a> for the most popular CMS / CMF / Framework for PHP. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Ready configs: </h4><br><ul><li>  <a href="https://github.com/elasticweb/nginx-configs">Asgard cms</a> </li><li>  <a href="https://github.com/elasticweb/nginx-configs">Bolt CMS</a> </li><li>  <a href="https://github.com/elasticweb/nginx-configs">CMS Made Simple</a> </li><li>  <a href="https://github.com/elasticweb/nginx-configs">Codeigniter</a> </li><li>  <a href="https://github.com/elasticweb/nginx-configs">Data Life Engine</a> </li><li>  <a href="https://github.com/elasticweb/nginx-configs">Drupal 7, 8</a> </li><li>  <a href="https://github.com/elasticweb/nginx-configs">FuelPHP</a> </li><li>  <a href="https://github.com/elasticweb/nginx-configs">Joomla 2, 3</a> </li><li>  <a href="https://github.com/elasticweb/nginx-configs">KodiCMS</a> </li><li>  <a href="https://github.com/elasticweb/nginx-configs">Kohana</a> </li><li>  <a href="https://github.com/elasticweb/nginx-configs">Laravel</a> </li><li>  <a href="https://github.com/elasticweb/nginx-configs">MaxSite CMS</a> </li><li>  <a href="https://github.com/elasticweb/nginx-configs">Mediawiki</a> </li><li>  <a href="https://github.com/elasticweb/nginx-configs">MODx Revolution</a> </li><li>  <a href="https://github.com/elasticweb/nginx-configs">Octobercms</a> </li><li>  <a href="https://github.com/elasticweb/nginx-configs">OpenCart 1.5</a> </li><li>  <a href="https://github.com/elasticweb/nginx-configs">phpBB3</a> </li><li>  <a href="https://github.com/elasticweb/nginx-configs">ProcessWire 2</a> </li><li>  <a href="https://github.com/elasticweb/nginx-configs">Symfony</a> </li><li>  <a href="https://github.com/elasticweb/nginx-configs">Wordpress 4</a> </li><li>  <a href="https://github.com/elasticweb/nginx-configs">Yii Advanced</a> </li><li>  <a href="https://github.com/elasticweb/nginx-configs">Yii Basic</a> </li><li>  <a href="https://github.com/elasticweb/nginx-configs">ZenCart 1.5</a> </li><li>  <a href="https://github.com/elasticweb/nginx-configs">Zend Framework</a> </li></ul><br><br><h4>  Nginx commands </h4><br><br>  Basic commands for performing basic operations while running Nginx. <br><br><ul><li>  <b>nginx -V</b> - check the version of Nginx, its compiled configuration parameters and installed modules. </li><li>  <b>nginx -t</b> - test the configuration file and check its location. </li><li>  <b>nginx -s reload</b> - restart the configuration file without rebooting Nginx. </li></ul><br><br><h4>  PHP location block </h4><br>  A simple template for quick and easy installation of PHP, FPM or CGI to your site. <br><br><pre><code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">location</span></span> <span class="hljs-regexp"><span class="hljs-regexp">~ \.php$</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">try_files</span></span> <span class="hljs-variable"><span class="hljs-variable">$uri</span></span> =<span class="hljs-number"><span class="hljs-number">404</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">client_max_body_size</span></span> <span class="hljs-number"><span class="hljs-number">64m</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">client_body_buffer_size</span></span> <span class="hljs-number"><span class="hljs-number">128k</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">include</span></span> fastcgi_params; <span class="hljs-attribute"><span class="hljs-attribute">fastcgi_param</span></span> SCRIPT_FILENAME <span class="hljs-variable"><span class="hljs-variable">$document_root</span></span><span class="hljs-variable"><span class="hljs-variable">$fastcgi_script_name</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">fastcgi_pass</span></span> unix:/path/to/php.sock; }</code> </pre> <br><br><h4>  Rewrite and Redirection </h4><br><h5>  Force www </h5><br>  <a href="http/converting_rewrite_rules.html">The correct way to</a> identify a remote server by domain without <i>www</i> and redirect it to <i>www</i> : <br><br><pre> <code class="nginx hljs"><span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> example.org; <span class="hljs-attribute"><span class="hljs-attribute">return</span></span> <span class="hljs-number"><span class="hljs-number">301</span></span> <span class="hljs-variable"><span class="hljs-variable">$scheme</span></span>://www.example.org<span class="hljs-variable"><span class="hljs-variable">$request_uri</span></span>; } <span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> www.example.org; ... }</code> </pre><br>  <i>Also works for https.</i> <br><br><h5>  Force no-www </h5><br>  The correct way to determine the remote server for the domain c <i>www</i> and redirect it without <i>www</i> : <br><br><pre> <code class="nginx hljs"><span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> example.org; } <span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> www.example.org; <span class="hljs-attribute"><span class="hljs-attribute">return</span></span> <span class="hljs-number"><span class="hljs-number">301</span></span> <span class="hljs-variable"><span class="hljs-variable">$scheme</span></span>://example.org<span class="hljs-variable"><span class="hljs-variable">$request_uri</span></span>; }</code> </pre><br><br><h5>  Force HTTPS </h5><br>  Method for redirecting from HTTP to HTTPS: <br><br><pre> <code class="nginx hljs"><span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">return</span></span> <span class="hljs-number"><span class="hljs-number">301</span></span> https://<span class="hljs-variable"><span class="hljs-variable">$host</span></span><span class="hljs-variable"><span class="hljs-variable">$request_uri</span></span>; } <span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">443</span></span> ssl; <span class="hljs-comment"><span class="hljs-comment"># let the browsers know that we only accept HTTPS add_header Strict-Transport-Security max-age=2592000; ... }</span></span></code> </pre><br><br><h5>  Force trailing slash </h5><br>  This line adds a slash <code>/</code> at the end of each URL, only in that case if the URL does not have a dot or parameters.  Ie after <em>example.com/index.php</em> or <em>example.com/do?some=123</em> slash is not set. <br><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">rewrite</span></span><span class="hljs-regexp"><span class="hljs-regexp"> ^([^.\?]*[^/])$</span></span> <span class="hljs-variable"><span class="hljs-variable">$1</span></span>/ <span class="hljs-literal"><span class="hljs-literal">permanent</span></span>;</code> </pre><br><br><h5>  Redirect to page </h5><br><pre> <code class="nginx hljs"><span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> = /oldpage.html { <span class="hljs-attribute"><span class="hljs-attribute">return</span></span> <span class="hljs-number"><span class="hljs-number">301</span></span> http://example.org/newpage.html; } }</code> </pre><br><br><h5>  Redirect to the site </h5><br><pre> <code class="nginx hljs"><span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> old-site.com return <span class="hljs-number"><span class="hljs-number">301</span></span> <span class="hljs-variable"><span class="hljs-variable">$scheme</span></span>://new-site.com<span class="hljs-variable"><span class="hljs-variable">$request_uri</span></span>; }</code> </pre><br><br><h5>  Redirect to a specific path in a URI </h5><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">location</span></span> /old-site { <span class="hljs-attribute"><span class="hljs-attribute">rewrite</span></span><span class="hljs-regexp"><span class="hljs-regexp"> ^/old-site/(.*)</span></span> http://example.org/new-site/<span class="hljs-variable"><span class="hljs-variable">$1</span></span> <span class="hljs-literal"><span class="hljs-literal">permanent</span></span>; }</code> </pre><br><br><h4>  Performance </h4><br><h5>  Caching </h5><br>  Allow browsers to permanently cache static content.  Nginx will install both headers: Expires and Cache-Control. <br><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">location</span></span> /static { <span class="hljs-attribute"><span class="hljs-attribute">root</span></span> /data; <span class="hljs-attribute"><span class="hljs-attribute">expires</span></span> max; }</code> </pre><br><br>  You can disable browser caching (for example, to track requests) as follows: <br><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">location</span></span> = /empty.gif { empty_gif; <span class="hljs-attribute"><span class="hljs-attribute">expires</span></span> -<span class="hljs-number"><span class="hljs-number">1</span></span>; }</code> </pre><br><br><h5>  Gzip compression </h5><br><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">gzip</span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">gzip_buffers</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">8k</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">gzip_comp_level</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">gzip_http_version</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">gzip_min_length</span></span> <span class="hljs-number"><span class="hljs-number">256</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">gzip_proxied</span></span> any; <span class="hljs-attribute"><span class="hljs-attribute">gzip_vary</span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">gzip_types</span></span> text/xml application/xml application/atom+xml application/rss+xml application/xhtml+xml image/svg+xml text/javascript application/javascript application/x-javascript text/x-json application/json application/x-web-app-manifest+json text/css text/plain text/x-component font/opentype application/x-font-ttf application/vnd.ms-fontobject image/x-icon; <span class="hljs-attribute"><span class="hljs-attribute">gzip_disable</span></span> <span class="hljs-string"><span class="hljs-string">"msie6"</span></span>;</code> </pre><br><br><h5>  File cache </h5><br>  If you cache a large number of static files through Nginx, then caching the metadata of these files will save the delay time. <br><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">open_file_cache</span></span> max=<span class="hljs-number"><span class="hljs-number">1000</span></span> inactive=<span class="hljs-number"><span class="hljs-number">20s</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">open_file_cache_valid</span></span> <span class="hljs-number"><span class="hljs-number">30s</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">open_file_cache_min_uses</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">open_file_cache_errors</span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span>;</code> </pre><br><br><h5>  SSL cache </h5><br>  Connecting SSL caching will allow you to resume the SSL session and reduce the time for the following calls to the SSL / TLS protocol. <br><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">ssl_session_cache</span></span> shared:SSL:<span class="hljs-number"><span class="hljs-number">10m</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">ssl_session_timeout</span></span> <span class="hljs-number"><span class="hljs-number">10m</span></span>;</code> </pre><br><br><h5>  Upstream support </h5><br>  Activating caching using upstream connections: <br><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">upstream</span></span> backend { <span class="hljs-attribute"><span class="hljs-attribute">server</span></span> <span class="hljs-number"><span class="hljs-number">127.0.0.1:8080</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">keepalive</span></span> <span class="hljs-number"><span class="hljs-number">32</span></span>; } <span class="hljs-section"><span class="hljs-section">server</span></span> { ... <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> /api/ { <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://backend; <span class="hljs-attribute"><span class="hljs-attribute">proxy_http_version</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Connection <span class="hljs-string"><span class="hljs-string">""</span></span>; } }</code> </pre><br><br><h5>  Monitoring </h5><br>  By default, the <a href="http_stub_status_module.html">Stub Status</a> module is not built, its assembly must be enabled using the ‚Äîwith-http_stub_status_module configuration parameter and activated using: <br><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">location</span></span> /status { <span class="hljs-attribute"><span class="hljs-attribute">stub_status</span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">access_log</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span>; }</code> </pre><br><br>  This setting will allow you to receive status in plain text format for the total number of requests and client connections (accepted, processed, active). <br><br>  More informative status from Nginx can be obtained using <a href="https://luameter.com/">Luameter</a> , which is somewhat more complicated to install and requires the Nginx Lua module.  It will provide the following metrics for various configuration groups in JSON format: <br><br><ul><li>  The total number of requests / responses. </li><li>  The total number of responses grouped by status codes: 1xx, 2xx, 3xx, 4xx, 5xx. </li><li>  The total number of bytes received / sent to the client. </li><li>  Intermediate periods of time for estimating the minimum, maximum, medians, delays, and so on. </li><li>  The average number of requests for ease of monitoring and forecasting load. </li><li>  <a href="https://luameter.com/metrics">And so on‚Ä¶</a> </li></ul><br><br>  <a href="https://luameter.com/demo">Luameter dashboard example</a> . <br><br>  Also <a href="https://github.com/lebinh/ngxtop">ngxtop</a> is great for collecting statistics. <br><br><h4>  Security </h4><br><h5>  Activate Basic Authentication </h5><br>  First you need to create a password and save it in a plain text file: <br><br><pre> <code class="nginx hljs">:</code> </pre><br><br>  Then set up the nickeys for the server / location of the block you want to protect: <br><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">auth_basic</span></span> <span class="hljs-string"><span class="hljs-string">"This is Protected"</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">auth_basic_user_file</span></span> /path/to/password-file;</code> </pre><br><br><h5>  Open local access only </h5><br><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">location</span></span> /local { <span class="hljs-attribute"><span class="hljs-attribute">allow</span></span> <span class="hljs-number"><span class="hljs-number">127.0.0.1</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">deny</span></span> all; ... }</code> </pre><br><br><h5>  SSL security settings </h5><br><br><ul><li>  Disable SSLv3 if enabled by default.  This will prevent the <a href="http://nginx.com/blog/nginx-poodle-ssl/">POODLE SSL Attack</a> . </li><li>  The ciphers that best provide protection.  <a href="https://wiki.mozilla.org/Security/Server_Side_TLS">Mozilla Server Side TLS and Nginx</a> . <br><br><pre> <code class="nginx hljs"><span class="hljs-comment"><span class="hljs-comment"># don't use SSLv3 ref: POODLE CVE-2014-356 - http://nginx.com/blog/nginx-poodle-ssl/ ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # Ciphers set to best allow protection from Beast, while providing forwarding secrecy, as defined by Mozilla (Intermediate Set) - https://wiki.mozilla.org/Security/Server_Side_TLS#Nginx ssl_ciphers 'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA'; ssl_prefer_server_ciphers on;</span></span></code> DHE-DSS-AES256-SHA: DHE-RSA-AES256-SHA: AES128-GCM-SHA256: AES256-GCM-SHA384: AES128-SHA256: AES256-SHA256: AES128-SHA: AES256- <code class="nginx hljs"><span class="hljs-comment"><span class="hljs-comment"># don't use SSLv3 ref: POODLE CVE-2014-356 - http://nginx.com/blog/nginx-poodle-ssl/ ssl_protocols TLSv1 TLSv1.1 TLSv1.2; # Ciphers set to best allow protection from Beast, while providing forwarding secrecy, as defined by Mozilla (Intermediate Set) - https://wiki.mozilla.org/Security/Server_Side_TLS#Nginx ssl_ciphers 'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA'; ssl_prefer_server_ciphers on;</span></span></code> </pre><br></li></ul><br><br><h4>  Other </h4><br><h5>  Subqueries after completion </h5><br>  There are situations when you need to transfer a request to another backend <strong>in addition or after its processing</strong> .  The first case is to track the number of completed downloads by calling the API after the user has downloaded the file.  The second case is to track the request to which you would like to return as quickly as possible (possibly with an empty .gif) and make the corresponding entries in the background.  <a href="http://wiki.nginx.org/HttpCoreModule"><strong>post_action</strong></a> , which allows you to define a subquery and will be rejected at the end of the current request - is the <a href="http://mailman.nginx.org/pipermail/nginx/2008-April/004524.html">best solution</a> for both options. <br><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">location</span></span> = /empty.gif { empty_gif; <span class="hljs-attribute"><span class="hljs-attribute">expires</span></span> -<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">post_action</span></span> <span class="hljs-variable"><span class="hljs-variable">@track</span></span>; } <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> <span class="hljs-variable"><span class="hljs-variable">@track</span></span> { internal; <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://tracking-backend; }</code> </pre><br><br><h5>  Resource allocation between sources </h5><br>  The easiest and most well-known method of cross-domain request to your server: <br><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">location</span></span> <span class="hljs-regexp"><span class="hljs-regexp">~* .(eot|ttf|woff)</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">add_header</span></span> Access-Control-Allow-Origin *; }</code> </pre><br><br><h4>  Sources </h4><br><br><ul><li>  <a href="http://nginx.com/resources/admin-guide/">Nginx Official Guide</a> </li><li>  <a href="https://github.com/h5bp/server-configs-nginx">HTML 5 Boilerplate's Sample Nginx Configuration</a> </li><li>  <a href="http://wiki.nginx.org/Pitfalls">Nginx pitfalls</a> </li></ul><br><br>  Thank you all very much for your attention! <br></div><p>Source: <a href="https://habr.com/ru/post/272381/">https://habr.com/ru/post/272381/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../272365/index.html">DreemChest: Chain Reaction</a></li>
<li><a href="../272367/index.html">Several "buns" for symfony 2 && Doctrine</a></li>
<li><a href="../272371/index.html">Hacker mathematician</a></li>
<li><a href="../272373/index.html">Use TSQL to play Sudoku</a></li>
<li><a href="../272375/index.html">Apple has released Swift source code</a></li>
<li><a href="../272383/index.html">Postulates Go</a></li>
<li><a href="../272385/index.html">True Snowden</a></li>
<li><a href="../272387/index.html">Resources for designers and front-end developers</a></li>
<li><a href="../272389/index.html">Desktop JavaScript applications. Part 1</a></li>
<li><a href="../272391/index.html">The story of how I wrote OS in Minecraft</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>