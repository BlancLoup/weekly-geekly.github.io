<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using V8, Conclusion</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Using V8, Conclusion 

 Part 3 is here: habrahabr.ru/blogs/development/72765 

 Part 2 is here: habrahabr.ru/blogs/development/72592 

 Part 1 is here...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using V8, Conclusion</h1><div class="post__text post__text-html js-mediator-article"> Using V8, Conclusion <br><br>  Part 3 is here: <a href="http://habrahabr.ru/blogs/development/72765/">habrahabr.ru/blogs/development/72765</a> <br><br>  Part 2 is here: <a href="http://habrahabr.ru/blogs/development/72592/">habrahabr.ru/blogs/development/72592</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Part 1 is here: <a href="http://habrahabr.ru/blogs/development/72474/">habrahabr.ru/blogs/development/72474</a> <br><br><a name="habracut"></a><br><br>  In conclusion, we will go over all trifles. <br><br>  <b>- Memory</b> <br><br>  The algorithm of the garbage collector in V8 is designed to work well in Chrome, that is, its main task is to minimize delays.  Hence his desire to postpone the cleaning of garbage as long as possible.  This is bad news for the server application.  The good news is that there is a way to trigger the garbage manually.  To do this, you need to fix the <i>flag-definitions.h</i> file before <i>building v8.lib</i> . <br><br>  In the file <i>flag-definitions.h,</i> you need to find the line with <b>expose_gc</b> : <br><br> <code>DEFINE_bool(expose_gc, false, "expose gc extension")</code> <br> <br>  And set " <i>true</i> " (instead of " <i>false</i> "). <br><br>  After building v8.lib in the global JavaScript object, the function " <i>gc ()</i> " is available, which performs the complete garbage collection.  However, in my experience it is difficult to find the time of her call.  If this is done after the completion of a session, then a massive session halt will cause a long delay.  In a word, it is necessary to use gc () somehow cunningly, not "head on." <br><br>  Attention!  After fixing the <i>flag-definitions.h</i> file, it will no longer be managed by subversion.  Before the next source download from the trunk branch, restore the file (or delete it so that it downloads again). <br><br>  <b>- Error processing</b> <br><br>  In the example of a console application that executes JavaScript, error handling is rather primitive.  In fact, the information about the error that caused the exception is more extensive.  You can access the samples / shell.cc file and study the ReportException function: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">void</font> ReportException(v8::TryCatch* try_catch) { <br> v8::HandleScope handle_scope; <br> v8:: <font color="#2B91AF">String</font> ::Utf8Value exception(try_catch-&gt;Exception()); <br> <font color="#0000ff">const</font> <font color="#0000ff">char</font> * exception_string = ToCString(exception); <br> v8::Handle&lt;v8::Message&gt; message = try_catch-&gt;Message(); <br> <font color="#0000ff">if</font> (message.IsEmpty()) { <br> <font color="#008000">// V8 didn't provide any extra information about this error; just</font> <br> <font color="#008000">// print the exception.</font> <br> printf( <font color="#A31515">"%s\n"</font> , exception_string); <br> } <font color="#0000ff">else</font> { <br> <font color="#008000">// Print (filename):(line number): (message).</font> <br> v8:: <font color="#2B91AF">String</font> ::Utf8Value filename(message-&gt;GetScriptResourceName()); <br> <font color="#0000ff">const</font> <font color="#0000ff">char</font> * filename_string = ToCString(filename); <br> <font color="#0000ff">int</font> linenum = message-&gt;GetLineNumber(); <br> printf( <font color="#A31515">"%s:%i: %s\n"</font> , filename_string, linenum, exception_string); <br> <font color="#008000">// Print line of source code.</font> <br> v8:: <font color="#2B91AF">String</font> ::Utf8Value sourceline(message-&gt;GetSourceLine()); <br> <font color="#0000ff">const</font> <font color="#0000ff">char</font> * sourceline_string = ToCString(sourceline); <br> printf( <font color="#A31515">"%s\n"</font> , sourceline_string); <br> <font color="#008000">// Print wavy underline (GetUnderline is deprecated).</font> <br> <font color="#0000ff">int</font> start = message-&gt;GetStartColumn(); <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; start; i++) { <br> printf( <font color="#A31515">" "</font> ); <br> } <br> <font color="#0000ff">int</font> end = message-&gt;GetEndColumn(); <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = start; i &lt; end; i++) { <br> printf( <font color="#A31515">"^"</font> ); <br> } <br> printf( <font color="#A31515">"\n"</font> ); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  <b>- Getting the current context</b> <br><br>  Sometimes inside the C ++ function callback, we need to get the current V8 context.  There are several methods in the Context class: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">static</font> Local&lt;Context&gt; GetCurrent(); <font color="#008000">//     V8</font> <br> <br> <font color="#0000ff">static</font> Local&lt;Context&gt; GetEntered(); <font color="#008000">//   ""  V8</font> <br> <br> <font color="#0000ff">static</font> Local&lt;Context&gt; GetCalling(); <font color="#008000">//  ,   </font> <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Normally, use GetCurrent (). <br><br>  <b>- Listing the properties of a V8 object</b> <br><br>  To get a list of properties of a V8 object, use the GetPropertyNames () call.  You can get the names and values ‚Äã‚Äãof all properties of an object as follows: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">Local&lt;Object&gt; rec; <font color="#008000">// </font> <br> <br> Local&lt;Array&gt; names = rec-&gt;GetPropertyNames(); <font color="#008000">//    </font> <br> <font color="#0000ff">for</font> (unsigned j = 0; j &lt; names-&gt;Length(); j++) <br> { <br> <font color="#008000">//  </font> <br> Local&lt; <font color="#2B91AF">String</font> &gt; name = Local&lt; <font color="#2B91AF">String</font> &gt;::Cast(names-&gt;Get(Integer::New(j))); <br> <font color="#008000">//  </font> <br> Local&lt;Value&gt; val = rec-&gt;Get(name); <br> <font color="#008000">// ...</font> <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  <b>- Creation of a context with a binding of a global object to a functional</b> <br><br>  In the previous parts, we considered only the creation of an empty context (by calling Context :: New () without parameters).  V8 allows you to use a warm object for a global object: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">... <br> <font color="#008000">//    </font> <br> Handle&lt;ObjectTemplate&gt; global = ObjectTemplate::New(); <br> <br> <font color="#008000">//  </font> <br> global-&gt;Set( <font color="#2B91AF">String</font> ::NewSymbol( <font color="#A31515">"foo"</font> ), FunctionTemplate::New(Foo)); <br> global-&gt;Set( <font color="#2B91AF">String</font> ::NewSymbol( <font color="#A31515">"bar"</font> ), FunctionTemplate::New(Bar)); <br> <br> <font color="#008000">//  </font> <br> Context::New(NULL, global); <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  <b>- Conclusion</b> <br><br>  Overall, we are pleased with the embedding of the V8.  If I have time, I will write about our platform.  In short, we have ‚Äúwrapped‚Äù JavaScript embedded SQLITE, processing HTTP requests and exchanging asynchronous messages.  This is a bit like what ERLANG does, but in a more ‚Äúhuman‚Äù language;  more simple and convenient to use. <br><br>  <b>UPD: By the</b> way, here is a link to my article about this platform: <a href="http://habrahabr.ru/blogs/development/48842/">habrahabr.ru/blogs/development/48842</a> <br></div><p>Source: <a href="https://habr.com/ru/post/72886/">https://habr.com/ru/post/72886/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../72878/index.html">Apple reported for 4Q 2009</a></li>
<li><a href="../72879/index.html">uPackinglist - or how we were going on the road</a></li>
<li><a href="../72880/index.html">Is YouTube traffic free? Welcome to the New Internet</a></li>
<li><a href="../72882/index.html">I will translate a good article, offer it!</a></li>
<li><a href="../72883/index.html">Android NDK vs SDK vs iPhone</a></li>
<li><a href="../72889/index.html">Olympic medals from old gadgets</a></li>
<li><a href="../72891/index.html">Spectacular object creation in Perl</a></li>
<li><a href="../72892/index.html">3D-TVs expand the angle of view</a></li>
<li><a href="../72894/index.html">Interesting Applescript Behavior</a></li>
<li><a href="../72905/index.html">Estonian electronic voting on Ubuntu</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>