<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Easy Hack: Java application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="From time to time pentesters have to deal with Java applications. These can be various servers, clients or just desktop programs. And sometimes it bec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Easy Hack: Java application</h1><div class="post__text post__text-html js-mediator-article">  From time to time pentesters have to deal with Java applications.  These can be various servers, clients or just desktop programs.  And sometimes it becomes necessary to patch such an application.  Why do you need it?  Each case of such a need is unique.  For example: <br><br><ul><li>  Sophisticated communication protocol between server and client.  To send arbitrary requests - patchim; </li><li>  Zakhardkozheny settings.  To change - patchim; </li><li>  To demonstrate the effects of problems like race condition - patchim. </li></ul><br>  Of course, in each case, you can solve the problem without resorting to modification of the application.  But often this is the easiest and fastest way to achieve the desired result.  In this article, we will describe how to quickly and easily change the functionality of a Java application. <br><a name="habracut"></a><br><h3>  Application </h3><br>  For the story we need an experimental application.  Of course, we will write it ourselves.  Its structure is shown in Figure 1. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/75f/ab2/97e/75fab297e5ffa9d5c40c67cbc3553e1f.jpg" alt="image"><br>  <i>picture 1</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As you can see, it is quite simple: two classes that run the application and draw the GUI.  Here are their sources.  Main.java: <br><br><pre><code class="java hljs"><span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany; <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> 4 </span></span>{ <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> 6 </span></span>{ <span class="hljs-number"><span class="hljs-number">7</span></span> javax.swing.SwingUtilities.invokeLater(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Runnable() <span class="hljs-number"><span class="hljs-number">8</span></span> { <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Window(); <span class="hljs-number"><span class="hljs-number">11</span></span> } <span class="hljs-number"><span class="hljs-number">12</span></span> }); <span class="hljs-number"><span class="hljs-number">13</span></span> } <span class="hljs-number"><span class="hljs-number">14</span></span> } <span class="hljs-number"><span class="hljs-number">15</span></span></code> </pre> <br><pre> <code class="java hljs">Window.java <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany; <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.mycompany.Targets.*; <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.swing.*; <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Window</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JFrame</span></span></span><span class="hljs-class"> 7 </span></span>{ <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> JPanel panel1; <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> JLabel Level1Value; <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> JLabel Level2Value; <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> JLabel Level3Value; <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Window</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> 14 </span></span>{ <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(<span class="hljs-string"><span class="hljs-string">"Simple example"</span></span>); <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> Level1Value.setText(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Level1().getText()); <span class="hljs-number"><span class="hljs-number">18</span></span> Level2Value.setText(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Level2().getText()); <span class="hljs-number"><span class="hljs-number">19</span></span> Level3Value.setText(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Level3().getText()); <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> getContentPane().add(panel1); <span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span> setSize(<span class="hljs-number"><span class="hljs-number">300</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-number"><span class="hljs-number">24</span></span> setLocationRelativeTo(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-number"><span class="hljs-number">26</span></span> setVisible(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-number"><span class="hljs-number">27</span></span> setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE); <span class="hljs-number"><span class="hljs-number">28</span></span> } <span class="hljs-number"><span class="hljs-number">29</span></span> } <span class="hljs-number"><span class="hljs-number">30</span></span></code> </pre><br>  Classes are very simple.  Main - creates a window.  Window - prints text in 3 fields.  He takes the text from our target classes, by the example of which we will consider methods of modification.  How does the running application, see figure 2. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2d9/56f/a7f/2d956fa7f7722e28d24037c607d9cf67.jpg" alt="image"><br>  <i>picture 2</i> <br><br>  From the tools we need only JDK and JavaDecompiler.  Getting down to the patch. <br><br><h3>  Level 1 </h3><br>  Our application is a jar archive.  To begin with, simply insert it into JavaDecompiler and get the source of the class of interest to us.  Level1.java: <br><br><pre> <code class="java hljs"><span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.Targets; <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Level1</span></span></span><span class="hljs-class"> 4 </span></span>{ <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> 6 </span></span>{ <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Data"</span></span>; <span class="hljs-number"><span class="hljs-number">8</span></span> } <span class="hljs-number"><span class="hljs-number">9</span></span> } <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre><br>  Great, now we copy this code into a text file with the extension "java".  This is the easiest class to think of.  Now we change this source as we wish.  We replaced the return value with ‚ÄúMy msg‚Äù.  Next, execute the command: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/274/d1d/e46/274d1de4669bc9e9b278b09a0fd8b9e5.jpg" alt="image"><br><br>  As a result, we get the finished Level1.class.  Then we just need to add it to our jar-archive.  Let's do this with the following command: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/003/4d5/c84/0034d5c841efff972123833b2e175fd1.jpg" alt="image"><br><br>  Note that we have created a path identical to the name of the package in which our class is located, and put the binary there. <br>  The result is in Figure 3. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cf2/b8a/d5d/cf2b8ad5d814af48187ec4da601d2b2b.jpg" alt="image"><br>  <i>picture 3</i> <br><br>  Consider the case more difficult. <br><br><h3>  Level 2 </h3><br>  We do the same thing and get the source.  Level2.java: <br><br><pre> <code class="java hljs"><span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.Targets; <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Level2</span></span></span><span class="hljs-class"> 4 </span></span>{ <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> 6 </span></span>{ <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Super "</span></span> + (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Level1().getText()); <span class="hljs-number"><span class="hljs-number">8</span></span> } <span class="hljs-number"><span class="hljs-number">9</span></span> }</code> </pre><br>  In it, I will change the "Super" to "New".  And try to compile: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2a9/385/e62/2a9385e62ef767bfcc5be87b95e73232.jpg" alt="image"><br><br>  It did not work, because the class has a link to another object from this package.  But java is very friendly and allows you to specify when compiling any way where the classes are located.  Those.  you can simply execute the command: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/468/e64/eaa/468e64eaa5e0985f77d7a55b9eecca18.jpg" alt="image"><br><br>  As a result, we have a ready-made binary again.  In the same way, we update the jar-archive and see the result in Figure 4: <br><img src="https://habrastorage.org/getpro/habr/post_images/6dc/23f/3a5/6dc23f3a5bd92e7975230009782d86a2.jpg" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/6ef/56e/839/6ef56e8397bb3121c2411e4d04714c2a.jpg" alt="image"><br>  <i>figure 4</i> <br><br>  Well, consider the last case, which will add a little more complexity. <br><br><h3>  Level 3 </h3><br>  We decompile our class.  Level3.java: <br><br><pre> <code class="java hljs"><span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.Targets; <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> jd.core.CoreConstants; <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Level3</span></span></span><span class="hljs-class"> 6 </span></span>{ <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> 8 </span></span>{ <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CoreConstants.class.getSimpleName() + <span class="hljs-string"><span class="hljs-string">" "</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> + (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Level2().getText()); <span class="hljs-number"><span class="hljs-number">11</span></span> } <span class="hljs-number"><span class="hljs-number">12</span></span> }</code> </pre><br>  Here we add the line "-update-".  As we can see right away, a third-party package has been added.  And, if we try to collect, we get an error: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/965/cbc/80c/965cbc80c7098305e06011a338d903d8.jpg" alt="image"><br><br>  And again, java helps out with its friendliness.  She can simply specify the path where the jar-archives of dependencies are located.  This is done like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/29e/99f/506/29e99f506f58917c9296e57ace700a49.jpg" alt="image"><br><br>  (yes, the indication of the class path is superfluous here, since it is packed in the archive and lies in the same directory, but since this is not always the case, I still pointed it out) <br><br>  And then everything is the same - the result in Figure 5. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a2e/2ce/f59/a2e2cef59d8ca0f616183df788a34c57.jpg" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a5c/b0c/e84/a5cb0ce84e4ec10099fea95bc6c20ddf.jpg" alt="image"><br>  <i>Figure 5</i> <br><br><h3>  Total </h3><br>  As a result, we looked at examples of how to quickly and easily modify Java applications.  Of course, we looked at the example of the jar-archive, but you understand that if the classes are not packed, then everything is much simpler? </div><p>Source: <a href="https://habr.com/ru/post/282934/">https://habr.com/ru/post/282934/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../282922/index.html">Work with WAV files using PHP</a></li>
<li><a href="../282924/index.html">Test Gradle Plugins Correctly</a></li>
<li><a href="../282926/index.html">About Modbus and Intel Edison Protocol</a></li>
<li><a href="../282930/index.html">Smart or virtual hardware drivers</a></li>
<li><a href="../282932/index.html">About the usefulness of indexes by expressions</a></li>
<li><a href="../282936/index.html">Efficient Rails - a new book on optimizing the development of Rails applications</a></li>
<li><a href="../282938/index.html">Redmine: Migration from MySQL to PostgreSQL 9.5</a></li>
<li><a href="../282940/index.html">How to write an IO monad in C # (not) without the help of a parallel universe and time machine</a></li>
<li><a href="../282944/index.html">About order management on the new 1C-Bitrix platform</a></li>
<li><a href="../282946/index.html">Quick transition to a new platform</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>