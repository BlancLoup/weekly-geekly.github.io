<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Free sending SMS notifications in Zabbix</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Everyone is aware of the need for continuous monitoring of a large distributed network and for this there are many monitoring systems. I note right aw...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Free sending SMS notifications in Zabbix</h1><div class="post__text post__text-html js-mediator-article">  Everyone is aware of the need for continuous monitoring of a large distributed network and for this there are many monitoring systems.  I note right away that I work for a major provider and, so to speak, shoulders my shoulders with monitoring the status of a large number of access nodes, which are often at a very large distance from me. <br><br>  Now I am actively using the Zabbix 2.0 branch: I managed to fasten the constant monitoring of the parameters of the ADSL subscriber lines at all access nodes, about 200,000 parameters.  Descriptions of how it was done will be enough for a separate article.  I will tell you how to make the notification of any events via SMS in a simple and accessible way, and not to use for this specific hardware. <br><br>  I will tell you how to make the notification of any events via SMS in a simple and accessible way, and not to use for this specific hardware. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Alert option using free email2sms features of the sms.ru service </h2><br>  <b>UPD:</b> In connection with the change of the corporate telecom operator, the way email2sms from biline is no longer acceptable for me.  Found an interesting offer in the form of a web service <a title="sms.ru" href="http://sms.ru/">sms.ru</a> What attracted me to it?  Firstly, when registering as a programmer, we get the following items: <br><br><ul><li>  Advanced API - you can send messages, check their status, find out the cost, check the balance through simple HTTP requests. </li><li>  The ability to replace the sender - as the sender can use the Latin name of your website or company </li><li>  Messages to own number </li><li>  Free up to 60 SMS per day, then paid at standard rates. </li><li>  SMS to your number is free only if the text fits into 1 SMS message </li><li>  e-mail2sms </li></ul><br><br>  Registration is simple, the phone will receive a confirmation in the form of SMS.  I registered as a programmer. <br>  Actually, in order not to go beyond free SMS, it is enough to observe the following conditions <br><br><ol><li>  No more than 10 SMS to numbers other than theirs used at registration.  The limit, cost, status of the message can be checked by simple queries. </li><li>  No more than 160 Latin characters in SMS. </li><li>  No more than 60 SMS to your number </li></ol><br><br>  By default, the sender will be your number specified during registration, it seemed to me not beautiful and I sent a request to the name of the zabbix sender from the control panel, the application was not reviewed for a long time, maybe 2 hours maybe and I began to receive messages from the zabbix sender. <br><br><h2>  Email2sms setting </h2><br>  Select the menu item Applications - Mail @ sms.ru.  Something like this will open: <br><img src="https://habrastorage.org/storage2/193/207/5b4/1932075b438a6f29438e3a1a4d5728e5.png"><br><br>  Click edit and see the following image: <br><img src="https://habrastorage.org/storage2/24a/754/915/24a754915f08f756f7c9f6b15c15f7a1.png"><br><br>  Go through the points <br><ol><li>  The first is your address of the form xxx @ sms.ru to which you need to send email notifications </li><li>  Tick ‚Äã‚Äãoff </li><li>  Tick ‚Äã‚Äãoff (I do not need the name of the action) </li><li>  Put a tick </li><li>  Tick ‚Äã‚Äãset otherwise SMS will be paid </li><li>  We select from what sender the message will come (I already have the name zabbix) </li><li>  Put a tick </li><li>  Then we can enter additional phone numbers where SMS will be duplicated.  those.  sending a letter to one SMS box can receive several clients at once with different phones. </li><li>  Enter the addresses of the mailboxes from which emails will be sent to the email2sms inbox.  If the field is left blank, then the letters will be paid. </li></ol><br><br>  Click save and it should be like this <br><img src="https://habrastorage.org/storage2/2bc/067/0f4/2bc0670f4378c515c51d1969481f0ce0.png"><br><br>  Setup on the sms.ru service is over. <br><br>  There are two ways to send messages <br><ul><li>  Using smtp server services </li><li>  Using your mail server </li></ul><br><br><h2>  Configure zabbix using smtp server service </h2><br>  Create a notification method for the first method.  <b>Administration - Alert methods</b> . <br><img src="https://habrastorage.org/storage2/237/9ec/b3f/2379ecb3f368af7ed6609c7dfe4f425c.png"><br>  As an outgoing email, we specify our emai2sms issued by <a title="sms.ru" href="http://sms.ru/">sms.ru</a> <br><br>  Now you need to assign a notification method to the user.  <b>Administration - Users</b> Select a user and select the <b>alert</b> tab. Next <b>add</b> <br><img src="https://habrastorage.org/storage2/5e9/05f/9da/5e905f9da0a59865e83152d8377be278.png"><br><br><img src="https://habrastorage.org/storage2/115/3ca/92c/1153ca92c939eca6950da367352e6e86.png"><br><br>  If necessary, adjust the levels and time for the alert. <br><br><h2>  Configure zabbix using your mail server </h2><br>  For the second method, using your mail server, which requires authorization, we will do another script-type notification method <br><img src="https://habrastorage.org/storage2/b85/9a9/e1a/b859a9e1ac145361cd558f6e260693f6.png"><br><br>  The script is located in the <i>AlertScriptsPath</i> (decree in the zabbix configuration files).  In my case, this is <i>/ usr / local / share / zabbix / alertscripts /</i> <br>  Script itself <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash export smtpemailfrom=ss@cbx.ru export zabbixemailto=$1 export zabbixsubject=$2 export zabbixbody=$3 export smtpserver=.x.ru export smtplogin=@.ru export smtppass=password /usr/bin/sendEmail -f $smtpemailfrom -t $zabbixemailto -u $zabbixsubject -m "$zabbixbody" -s $smtpserver:25 -xu $smtplogin -xp $smtppass -o message-format=raw</span></span></code> </pre> <br><br>  Do not forget to give rights 755 to the file <i>zabbix_sendemai</i> . <br><br>  Now you need to assign a notification method to the user.  <b>Administration - Users</b> Select a user and select the <b>alert</b> tab. Next <b>add</b> <br><img src="https://habrastorage.org/storage2/115/3ca/92c/1153ca92c939eca6950da367352e6e86.png"><br><br><h2>  Create an action zabbix sending an alert via sms </h2><br>  Set up an action on a triggered trigger.  For example, I took the trigger to drop the port fa 0/5 of the d-link switch.  Go to <b>Settings - Actions - Create an action</b> (event source - trigger) <br><br>  On the action tab, set up so <br><img src="https://habrastorage.org/storage2/509/5f6/02c/5095f602cec1f75a933e17ad4c485f13.png"><br><br>  On the tab, the condition is set as a condition trigger with the value of the problem <br><img src="https://habrastorage.org/storage2/008/d9f/6aa/008d9f6aaca459d0714b6d2b03b716af.png"><br><br>  On the operation tab, we make the type of operation to <b>send a message,</b> add a user and select the desired type of <b>send_email</b> or <b>email sms.ru</b> from the <b>user</b> in <b>‚Äúsend only‚Äù</b> and do not forget to click the <b>update</b> button and then <b>save</b> . <br><img src="https://habrastorage.org/storage2/f5f/914/cce/f5f914cce52573c823371f71c786374a.png"><br><br>  If everything is done, a new action will appear. <br><img src="https://habrastorage.org/storage2/568/96e/ac3/56896eac3fceed9f070d2555486a8abf.png"><br><br><h2>  Check sending sms </h2><br>  Put the port handles on long.  When viewing an event, you can see a successful reaction to the event: text, sending address, sending time. <br><img src="https://habrastorage.org/storage2/16d/881/2ca/16d8812ca81f90eea90a53b44cc607aa.png"><br><br>  Photo of the screen of the phone to which the sms came with a delay of less than a minute. <br><br><img src="https://habrastorage.org/storage2/1df/ca5/381/1dfca53811fc21f6008ddca21d6348c2.jpg"><br><br><h2>  Old making email2sms </h2><br>  The solution is completely free when using Beeline phones.  (I have not studied other operators, but I will be glad if you tell me). <br>  There is a site beonline.ru where you can learn how to enable the receipt of letters from an e-mail in the form of SMS-messages.  This is done either by <strong>calling</strong> to the toll-free number <strong>06849909</strong> or by sending the following command to number 784: <strong>SIM ON-POCHTANASMS YES</strong> . <br>  SMS <strong>SIM&gt; VKL-POSTANASMS YES</strong> will come <strong>back (Your phone has the Postal address: 79031234567@sms.beemail.ru).</strong>  <strong>&lt;&gt; - more.</strong> <br><br>  We remember this address, although what is there to memorize? <br><br>  Everyone probably guessed that further it was necessary to set up notifications via e-mail to the address obtained above, but not everything is so simple.  Zabbix does not allow standard means to send notifications via e-mail if the smtp server requires authentication. <br>  There is a solution - using scripts that can be found <a href="http://www.zabbix.com/forum/showthread.php%3Ft%3D1323">on the Zabbix forum</a> .  I used the <a href="http://caspian.dotconf.net/menu/Software/SendEmail/">sendEmail option</a> . <br><br>  Create a zabbix_sendemail script with 755 access rights <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh export smtpemailfrom=zabbix@yourdomain.com export zabbixemailto=$1 export zabbixsubject=$2 export zabbixbody=$3 export smtpserver=yoursmtpserver.com export smtplogin=smtpuser export smtppass=smtppassword /usr/bin/sendEmail -f $smtpemailfrom -t $zabbixemailto -u $zabbixsubject -m $zabbixbody -s $smtpserver:25 -xu $smtplogin -xp $smtppass</span></span></code> </pre><br><br>  Substituting the necessary data and save it in the directory specified as AlertScriptsPath in the configuration file /etc/zabbix/zabbix_server.conf <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">### Option: AlertScriptsPath # Location of custom alert scripts # # Mandatory: no # Default: AlertScriptsPath=/home/zabbix/bin/</span></span></code> </pre><br><br>  The next step is to create a new <em>Transmission type</em> in the <em>Administration</em> menu - <em>Transmission medium types</em> . <br>  In the description we write for example <strong>send email</strong> <br>  type choose a <strong>script</strong> <br>  Script name write <strong>zabbix_sendemail</strong> <br>  We save. <br><br>  Specify the transmission medium for the user who will need to send SMS.  This is done in the <em>Administration</em> - <em>Users</em> menu.  Select the desired user click <strong>add transfer medium</strong> . <br>  Type - select <strong>send email</strong> <br>  Send - enter the received e-mail from Beeline <br>  Further at will (it is better to leave the default). <br><br>  Now you need to create an action on the trigger that will send us an SMS. <br>  This is done in the <em>Settings</em> - <em>Action</em> menu. <br><br>  Create an action on the inaccessibility of iron. <br><br>  <strong>SMS</strong> Name <br>  Event <strong>Trigger</strong> <br>  The default theme is <strong>{TRIGGER.NAME}: {STATUS}</strong> (it doesn‚Äôt matter much since the SMS will come without a theme) <br>  The default message is <strong>{HOSTNAME} unreachable {STATUS}</strong> <br>  Post a recovery set if necessary to receive a message about the restoration and fill in by analogy with the above written <br><br>  Next, select the conditions of action <br>  I did, you can write the conditions that you need. <br>  <strong>Calculation Type (A) and (B) and and (D) and (E)</strong> <strong><br></strong>  <strong>(A) Host Group = ‚ÄúEspecially Important‚Äù</strong> <strong><br></strong>  <strong>(B) The trigger description contains "not available"</strong> <strong><br></strong>  <strong>Trigger importance = ‚ÄúEmergency‚Äù</strong> <strong><br></strong>  <strong>(D) Trigger Value = "PROBLEM"</strong> <strong><br></strong>  <strong>(E) The time period in "1-7.08: 00-23: 59"</strong> <strong><br></strong> <br><br>  When all the conditions coincide, a message is sent. <br><br>  We set up an operation for action <br>  Type of operation <strong>Send message</strong> <br>  Send message <strong>One user</strong> <br>  Send only <strong>send email</strong> <br>  The default message set kryzhik. <br>  We save. <br><br>  The message will come if there is a triggered trigger containing in the description ‚Äúunavailable‚Äù in the group of network nodes ‚Äúespecially important‚Äù and all days of the week from 8 am to 12 at night. <br>  And so we received an SMS notification system without using any complicated or paid solutions. <br><br>  <b>UPD</b> <a href="http://osj.habrahabr.ru/blog/82465/">The second article "Automatic renaming of hosts in Zabbix, according to data from snmp sysName"</a> </div><p>Source: <a href="https://habr.com/ru/post/81630/">https://habr.com/ru/post/81630/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../81620/index.html">Briton wants to marry a laptop</a></li>
<li><a href="../81622/index.html">Do not get fooled by Osteomed. Job Offer for Freelancers</a></li>
<li><a href="../81624/index.html">Mail.Ru Agent 1.0-beta for Mac OS</a></li>
<li><a href="../81628/index.html">TLA Toolbox - Microsoft Research Releases Linux Software</a></li>
<li><a href="../81629/index.html">Attention! Spammers have become smarter and got to freelancing</a></li>
<li><a href="../81632/index.html">Working with forms in Django</a></li>
<li><a href="../81633/index.html">We draw volumetric images in Inkscape</a></li>
<li><a href="../81635/index.html">Nontraditional animals in the house</a></li>
<li><a href="../81637/index.html">Otrivin Sea</a></li>
<li><a href="../81638/index.html">SSH Layer 3 Tunnel Organization</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>