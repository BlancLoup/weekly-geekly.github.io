<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using Xapian Full-Text Search Library in Python</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today, in the era of Web 2.0, when content on sites is becoming more and more, developers face the challenge of implementing full-text search. 

 Ther...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using Xapian Full-Text Search Library in Python</h1><div class="post__text post__text-html js-mediator-article">  Today, in the era of Web 2.0, when content on sites is becoming more and more, developers face the challenge of implementing full-text search. <br><br>  There are few options: <br><ul><li>  use widgets from search engine developers (Google, Yandex, etc): easy to implement, familiar to the user interface, morphology support, vocabulary correction, faster site indexing by search engines, but usually limited configuration options and inevitable indexing delay ; </li><li>  use the tools built into the DBMS (for example, <a href="http://dev.mysql.com/doc/refman/5.1/en/fulltext-search.html">FULLTEXT-index for MySQL</a> ): it is easy enough to implement, the current search index, full control over the configuration and appearance, but most often very poor performance on large amounts of data, lack of consideration of morphology, or, at worst case, the complete absence of such funds in the database; </li><li>  use a separate library / full-featured search system. </li></ul><br>  The third option seems to be the best, because it combines the advantages of the other two options.  The truth is not without flaws here either - the library requires installation, sometimes even starting the daemon (for example, <a href="http://sphinxsearch.com/">Sphinx</a> ), which can be unacceptable. <br><br>  There are many solutions, each has its own advantages and disadvantages.  I would like to dwell in more detail on the relatively obscure Xapian library. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Overview </h4><br>  This open (GPL) cross-platform library is written in C ++, there are bindings to Python, PHP, Ruby, Perl, Java, Tcl, and C #. <br><br>  Library features: <br><ul><li>  full unicode support; </li><li>  Boolean search, search with ranking, by mask, synonyms, there is support for sorting results; </li><li>  <a href="http://ru.wikipedia.org/wiki/%25D0%25A1%25D1%2582%25D0%25B5%25D0%25BC%25D0%25BC%25D0%25B8%25D0%25BD%25D0%25B3">Stemming</a> support for 15 world languages ‚Äã‚Äã(including Russian); </li><li>  dictionary query support support (for example, <b>xapain</b> request will be replaced by <b>xapian</b> ) </li><li>  search for documents in the image; </li><li>  support for indexing documents in different formats out of the box (PDF, HTML, RTF, Microsoft Office, OpenDocument, even RPM and Debian packages), it is easy to add filters to support the new format. </li></ul><br>  In a sense, the main disadvantage of Xapian is the binding to programming languages ‚Äã‚Äãother than C ++.  <a href="http://www.swig.org/">SWIG is</a> used to generate the binding code, so the API in it completely coincides with <a href="http://xapian.org/docs/apidoc/html/annotated.html">the version for C ++</a> . <br><br>  Fortunately for Python there is a simple and effective <a href="http://xappy.org/">Xappy</a> wrapper that takes care of all the dirty work. <br><br><h4>  Installation </h4><br>  The first step is to install Xapian itself, a binding to Python and Xappy.  Most GNU / Linux distributions already have all the necessary packages in the repositories, for example, you need to install the packages in Ubuntu 10.10: <br><pre><code class="bash hljs">sudo apt-get install libxapian15 python-xapian python-xappy</code> </pre> <br>  Xappy is also available via easy_install or pip: <br><pre> <code class="bash hljs">sudo pip install xappy</code> </pre> <br><h4>  Indexing </h4><br>  Let's try to index something: <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> xappy <span class="hljs-comment"><span class="hljs-comment">#         #        connection = xappy.IndexerConnection('/path/to/base') #    connection.add_field_action( 'title', xappy.FieldActions.INDEX_FREETEXT, weight=5, language='ru') connection.add_field_action( 'description', xappy.FieldActions.INDEX_FREETEXT, language='ru')</span></span></code> </pre><br>  When you open a connection for indexing, a new (or already existing) search index database will be created - a folder with a set of files.  The base format is independent of the operating system. <br><br>  After opening, you must specify the properties of the index fields: name, type, and other attributes. <br><br>  Field type can be: <br><ul><li>  INDEX_FREETEXT: the text is stored in the field, you only need to create an index without storing the text itself.  For this field type, you can specify additional attributes, in the example language = 'ru' to take into account the morphology of the language and weight = 5 - ‚Äúweight‚Äù of the field when ranking; </li><li>  INDEX_EXACT: the exact value of the word is stored in the field (suitable for searching for exact values, for example book identifiers), the text is stored in the index; </li><li>  SORTABLE: the field will be sorted.  By default, sorting is in a lexicographic format, regardless of what is stored in it.  This behavior can be changed through the type = 'date' attribute to sort dates (in the format YYYYMMDD, YYYY-MM-DD or YYYY / MM / DD) and type = 'float' to sort real numbers (in any supported Python format); </li><li>  COLLAPSE: grouping will take place across the field (analogous to GROUP BY in SQL, for example, find one document most appropriate for a query in each category); </li><li>  STORE_CONTENT: similar to INDEX_FREETEXT, only text is <b>also</b> stored in the index. </li></ul><br>  To add a document like this code: <br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#    doc = xappy.UnprocessedDocument() #   doc.fields.append(xappy.Field('title', '  ')) doc.fields.append(xappy.Field('description', '  ')) #    connection.add(doc)</span></span></code> </pre> <br>  Each document should have a unique identifier, in the example above it will be added automatically, but you can specify your own: <br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#      for posts_item in posts: doc = xappy.UnprocessedDocument() #       #    ! doc.id = posts_item.id doc.fields.append(xappy.Field('title', posts_item.title)) doc.fields.append(xappy.Field('description', posts_item.description) connection.add(doc)</span></span></code> </pre> <br>  After adding documents, it is necessary to write all changes to the disk and close the connection: <br><pre> <code class="python hljs">connection.flush() connection.close()</code> </pre> <br>  Everything, the index is created! <br><br><h4>  Search </h4><br>  To search for an existing index, you need to open a connection to search the search index database: <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> xappy <span class="hljs-comment"><span class="hljs-comment">#         #        connection = xappy.SearchConnection('/path/to/base')</span></span></code> </pre> <br>  It is possible that new documents were indexed after the discovery of the search connection.  In this case, you need to re-open the connection to gain access to the current database: <br><pre> <code class="python hljs">connection.reopen()</code> </pre> <br>  There are several methods for performing a search query (the <a href="http://code.google.com/p/xappy/source/browse/trunk/xappy/searchconnection.py">SearchConnection</a> class), the simplest is query_parse: <br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#    query = connection.query_parse('') #    10  #      10, 20  .. results = connection.search(query, 0, 10) # -  if results.matches_estimated &gt; 0: for results_item in results: print(results_item.rank, results_item.id) else: print('  ')</span></span></code> </pre> <br>  For fields with the type STORE_CONTENT or INDEX_EXACT, you can display their contents, which allows, for example, not to select the selected records from the main database by ID, and only get by with the search index: <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> results_item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> results: print(results_item.data[<span class="hljs-string"><span class="hljs-string">'title'</span></span>])</code> </pre> <br><br><h4>  Related Links </h4><br>  Of course, this is not all what Xapian is capable of.  These and other features are discussed in more detail in the Xappy 0.5 <a href="http://xappy.org/docs/0.5/introduction.html">documentation</a> , you can also refer to the <a href="http://xapian.org/docs/">official</a> Xapian <a href="http://xapian.org/docs/">documentation</a> and some materials are in <a href="http://xapian.wordpress.com/">this</a> Xapian <a href="http://xapian.wordpress.com/">blog</a> in English. <br></div><p>Source: <a href="https://habr.com/ru/post/113657/">https://habr.com/ru/post/113657/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../113650/index.html">Android tablets now in Indian buses</a></li>
<li><a href="../113652/index.html">Choosing a job, do not forget to choose a boss</a></li>
<li><a href="../113653/index.html">30% increase in Windows Phone 7 Marketplace</a></li>
<li><a href="../113654/index.html">Formal description of L4 hardware microkernel</a></li>
<li><a href="../113655/index.html">Accident in Oversan Scalaxi</a></li>
<li><a href="../113658/index.html">"Hello World" BPMN2.0 or Activiti Introduction</a></li>
<li><a href="../113660/index.html">The Japanese announced the simplest emergency phone</a></li>
<li><a href="../113663/index.html">Extend log4net. Competitive Logging</a></li>
<li><a href="../113670/index.html">BUNKER DataCenter - Radiation Threat Canceled</a></li>
<li><a href="../113671/index.html">Presented tablet Galaxy Tab 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>