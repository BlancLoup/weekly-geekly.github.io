<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OpenStreetMap as a geodata source</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the work of the programmer sometimes there is a need for geodata. You can use OpenStreetMap (OSM) for this. The appeal of OSM is the ability to per...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>OpenStreetMap as a geodata source</h1><div class="post__text post__text-html js-mediator-article">  In the work of the programmer sometimes there is a need for geodata.  You can use OpenStreetMap (OSM) for this.  The appeal of OSM is the ability to perfectly use high-quality map information. <br><br>  The purpose of the publication is to analyze the process of extracting geodata OSM using working examples.  The result will be a program code (in C #), which can be assembled in Visual or Xamarin Studio, run it on different OS (under Mono) and get the result in CSV and geoJSON formats.  There are no restrictions on the size of processed OSM data (from minimum to full).  The publication is designed for software developers with no experience with OSM. <br><a name="habracut"></a><br><h4>  Introduction </h4><br>  How to independently get an answer to seemingly simple and understandable questions (just for fun): <br>  - how many states on Earth, what is their population? <br>  - where are the cities on Earth with a population of, for example, more than a million people? <br>  - how many volcanoes on Earth? <br><br>  Or (easy to get based on examples): <br>  - where are the hospitals, hotels in your / foreign city?  And between cities? <br>  - where are gas stations, zoos, museums, restaurants?  Yes, whatever. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The task, in general, can be formulated something like this - to find the necessary objects, to determine their exact location (latitude, longitude), name and other available information. <br><br>  Further, these objects can be displayed, for example, on a map (OSM, Google, Yandex).  In the publication, for visualization of results, it is used ( <a href="http://habrahabr.ru/post/183288/">automatic display on GitHub of data in the format geoJSON</a> ). <br><br><h4>  Basic concepts and terminology </h4><br><h5>  Point (node) </h5><br>  <a href="http://wiki.openstreetmap.org/wiki/RU:%25D0%25AD%25D0%25BB%25D0%25B5%25D0%25BC%25D0%25B5%25D0%25BD%25D1%2582%25D1%258B_%25D0%25BA%25D0%25B0%25D1%2580%25D1%2582%25D1%258B">The basic element</a> of the OSM data structure is a point (node) with geographic coordinates - latitude (latitude) and longitude (longitude).  The height of the point above sea level, at present, is not indicated. <br><br>  A point can be an independent object (traffic light, kiosk, spring) and, without limitation, be part of other objects (lines and relationships).  Dots can be marked and large objects - countries, cities and even continents with a set of corresponding tags. <br><br><div class="spoiler">  <b class="spoiler_title">Examples of points without tags and with tags (XML):</b> <div class="spoiler_text"><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">node</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"231477"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lat</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"52.2600355"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.0172928"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">timestamp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2011-02-27T02:33:27Z"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">changeset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"7406582"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"39894"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">user</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"markpeers"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">node</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"231478"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lat</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"52.2552032"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.0281442"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">timestamp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2011-02-27T02:33:25Z"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">changeset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"7406582"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"39894"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">user</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"markpeers"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">k</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"exit_to"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">v</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Bar Hill B1050; Longstanton"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">k</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fixme"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">v</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"What is with all the layer=3s around this junction?"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">k</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"highway"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">v</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"motorway_junction"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">k</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"layer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">v</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"3"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">k</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">v</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Bar Hill"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">k</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ref"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">v</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"29"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">node</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Attributes node: <br>  - id - unique identifier in the OSM database (used for way and relation); <br>  - lat - latitude, lon - longitude; <br>  - uid and user ‚Äî identifier and name of the operator who made the changes (used for way and relation); <br>  - version - version of the change (used for way and relation); <br>  - timestamp - change time (used for way and relation); <br>  - changeset - change number (something like a transaction that can be applied or canceled) (used for way and relation). <br><br>  Tags: <br>  - k = "highway" v = "motorway_junction" - <a href="http://wiki.openstreetmap.org/wiki/RU:Tag:highway%253Dmotorway_junction">indicates the beginning of the exit from the road</a> ; <br>  - k = "ref" v = "29" is the exit number; <br>  - k = "name" v = "Bar Hill" - the name; <br>  - k = "exit_to" v = "Bar Hill B1050;  Longstanton "- where; <br>  - k = "layer" v = "3" - level; <br>  - k = "fixme" v = "What is this layer? 3s around this junction?" - the author made a "memory knot". <br></div></div><br>  The number of points in OSM is currently approaching a value that exceeds the capacity of 32-bit storage.  Therefore, OSM switched to 64 bits (to monitor the number of points in OSM, an <a href="http://textual.ru/64/">on-line monitor was</a> even made). <br><br><h5>  Line </h5><br>  A line is a sequence of points.  You can not change the sequence.  Several lines, logically, can represent one object.  For example, a long road consists of several lines.  The lines of one road are connected in a single whole by observing the condition - the point of the end of one line strictly corresponds to the point of the beginning of another line or several lines (in case of branching of the road or exit to another road).  This point integrity for lines in OSM is well respected. <br><br>  The polygon is a closed line where the first and last points coincide.  The landfill is not a separate element of OSM.  For large polygons (borders of states, coastlines), which consist of a set of unclosed lines, the rules are defined.  For example, when determining coastlines, the land will be on the left in the direction of travel, water on the right.  For administrative boundaries it is clearly indicated - who is on the left along the way of movement, who on the right. <br><br><div class="spoiler">  <b class="spoiler_title">Line example (XML):</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">way</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"9933583"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"18"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">timestamp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2013-01-06T20:59:43Z"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">changeset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"14555667"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"30525"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">user</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"The Maarssen Mapper"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nd</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2098832234"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nd</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"81448050"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nd</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1263117830"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nd</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1263117982"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nd</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"81448052"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nd</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"81448053"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nd</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"81448054"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nd</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1297466013"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nd</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"81448063"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">k</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"admin_level"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">v</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"6"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">k</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"boundary"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">v</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"administrative"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">k</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"left:county"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">v</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Cambridgeshire"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">k</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"right:county"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">v</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Essex"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">k</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"source"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">v</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"OS_OpenData_Boundary-Line"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">way</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  The ref attribute points to the point id (to get the lat, lon coordinates).  It is important to consider the sequence of nd elements. <br><br>  Tags: <br>  - k = "boundary" v = "administrative" - <a href="http://wiki.openstreetmap.org/wiki/RU:Tag:boundary%253Dadministrative">administrative boundary</a> ; <br>  - k = "admin_level" v = "6" - level 6; <br>  - k = "left: county" v = "Cambridgeshire" - who is on the left; <br>  - k = "right: county" v = "Essex" - who is to the right; <br>  - k = "source" v = "OS_OpenData_Boundary-Line" - link to the source of information. <br></div></div><br><h5>  Relation </h5><br>  Attitude is a logical combination of points, lines and other relationships into a single object. <br><br><div class="spoiler">  <b class="spoiler_title">Relationship Example (XML):</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">relation</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2839278"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">timestamp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2013-03-25T13:56:31Z"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">changeset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"15491865"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"322785"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">user</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"BCNorwich"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">member</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"way"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"74424273"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">role</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"outer"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">member</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"way"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4950089"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">role</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"inner"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">member</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"way"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"212392511"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">role</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"inner"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">member</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"way"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"212392522"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">role</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"inner"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">k</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"leisure"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">v</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"park"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">k</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"type"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">v</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"multipolygon"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">relation</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  member - members of the relationship; <br>  type - an object type (node, way, relation); <br>  ref - link to object id; <br>  role - the role of the object in the relationship. <br><br>  This example describes a multipolygon (multipolygon) - a park with internal areas (these can be, for example, ponds, glades, or vice versa, places with vegetation). <br><br>  Note: not all multipolygons are so described. <br></div></div><br>  Despite the seemingly high functionality, the relationship in OSM is used a little.  Although there are attempts to apply relationships to different objects.  For example, such a purely point object as a <a href="http://wiki.openstreetmap.org/wiki/RU:Tag:highway%253Dbus_stop">bus stop</a> , according to OSM internal statistics (statistics are maintained for most objects), is represented by: 1572243 points, 2479 lines and 1140 ratios. <br><br><h5>  Objects and tags (tag) </h5><br>  An object is an element (point, line, relation) with a set of tags (attributes).  Tag (tag) is defined as k = "key" v = "value".  If an element has no tags, then it is not an object, but is part of other objects (it can also be included with tags). <br><br>  The object has no required tags.  There are no mandatory requirements for the number, content and order of the tags.  The one who enters the data in the OSM, he determines the composition and content of the tags ( <a href="http://wiki.openstreetmap.org/wiki/RU:%25D0%259E%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582%25D1%258B_%25D0%25BA%25D0%25B0%25D1%2580%25D1%2582%25D1%258B">List of recommended to use common tags</a> ). <br><br>  In different countries, regions or regions, the same objects can vary considerably in composition and content of tags.  For example, a <a href="http://wiki.openstreetmap.org/wiki/RU:Tag:place%253Dcity">city ‚Äã‚Äã(city)</a> can be indicated by a dot or a line (polygon).  There are clear regional preferences in OSM statistics. <br><br>  Cities marked by dots: <img src="https://habrastorage.org/files/119/adc/7c5/119adc7c55b645348818e377683d8cd1.PNG" alt="Cities marked by dots"><br><br>  Cities marked with lines: <img src="https://habrastorage.org/files/902/8c2/e7e/9028c2e7eb5343f69d50dc9013b5ceda.PNG" alt="Cities marked with lines"><br><br>  Therefore, before using a new object, it is advisable to examine it for what tags are actually used in it. <br><br><h5>  Coordinates and distances </h5><br>  Exact geographical measurements are quite complex.  It is necessary to take into account: the fact that the Earth is not an ideal ball, height above sea level, relief, <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BF%25D0%25B8%25D1%2581%25D0%25BE%25D0%25BA_%25D0%25BA%25D0%25B0%25D1%2580%25D1%2582%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D1%2584%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B8%25D1%2585_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B5%25D0%25BA%25D1%2586%25D0%25B8%25D0%25B9">different projection models</a> for displaying a spherical Earth on a plane. <br><br>  The Internet maps use the projection <a href="http://spatialreference.org/ref/epsg/4326/">EPSG: 4326 - WGS-84</a> , which is based on the latitude and longitude of the satellite GPS navigation.  Degrees are specified in decimal form: latitude (lat = 52.2600355), longitude (lon = 0.0172928). <br><br>  For example, there are two points ( <a href="http://en.wikipedia.org/wiki/List_of_mountains_and_hills_of_Saint_Helena,_Ascension_and_Tristan_da_Cunha">volcanoes on the island of Tristan da Cunha</a> ): <br>  1. Volcano ‚ÄúGreen Hill‚Äù (id = 2079122352, lat = -37.1324274, lon = -12.3096104); <br>  2. Red Hill Volcano (id = 2079124574, lat = -37.1200039, lon = -12.2383527). <br><br><div class="spoiler">  <b class="spoiler_title">Rate accuracy</b> <div class="spoiler_text">  The length of one angular minute of latitude on the surface of the Earth is (approximately) 1,852 meters - ( <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D1%2580%25D1%2581%25D0%25BA%25D0%25B0%25D1%258F_%25D0%25BC%25D0%25B8%25D0%25BB%25D1%258F">one nautical mile</a> ).  ‚ÄúApproximately‚Äù, because 1852 meters is an average value: 1862 meters at the pole and 1843 meters at the equator. <br><br>  The length of one degree of latitude: 1852 * 60 = 111120 m. (The length of one degree of longitude: 1852 * 60 * COS (angle of latitude)). <br><br>  Thus, the coordinates of a point in OSM (0.0000001) are specified with an accuracy of ~ 1 cm. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Calculate the distance between points</b> <div class="spoiler_text">  The distance between two nearby points (without taking into account the spherical shape of the Earth) can be calculated by the Pythagorean theorem. <br><br>  The distance between the volcanoes "Green Hill" and "Red Hill": <br>  ¬≤‚àö ((37.1324274 - 37.1200039) ¬≤ + (12.3096104 - 12.2383527) ¬≤) = ¬≤‚àö0.00523200316154 ‚âà 0.072332587 (or 0.072332587 * 111120 ‚âà 8037.6 meters) <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Translate coordinate values ‚Äã‚Äãfrom decimal to angular and back</b> <div class="spoiler_text">  In the corner view: <br>  37.1324274 = 37 ¬∞ <br>  Decimal balance per minute: 0.1324274 ¬∞ * 60 = 7.945644 ' <br>  Decimal balance in seconds: 0.945644 '* 60 = 56.73864 "‚âà 57" <br>  Total: 37.1324274 ¬∞ ‚âà 37 ¬∞ 07'57 " <br><br>  In decimal view: <br>  37 ¬∞ 07'57 "= 37 ¬∞ + 7/60 + 57/3600 ‚âà 37 + 0.11666667 + 0.01583333 ‚âà 37.1325 ¬∞ <br><br>  Taking into account all rounding, the error was: <br>  37.1325 ¬∞ - 37.1324274 ¬∞ = 0.0000726 ¬∞ (or 0.0000726 * 111120 ‚âà 8 meters) <br></div></div><br><h4>  Where to download OSM data </h4><br>  OSM data is stored in a database (DB).  On a regular basis, a snapshot of the database is prepared in XML format in the <a href="http://planet.openstreetmap.org/">planet.osm</a> file.  Archived bzip2 file is 45Gb, in unpacked form - more than 600Gb.  In addition, there are <a href="">mirrors of planet.osm and links to Internet resources</a> , where you can download OSM data cut by regions. <br><br>  For publishing examples, data is taken from the <a href="http://download.geofabrik.de/">geofabrik</a> server.  Data is conveniently cut by region and laid out, for unloading, in different formats: Shape-files (shp.zip), PBF-files (osm.pbf), XML-files (osm.bz2).  The publication examples use XML files. <br><br>  When reading XML, you need to consider: <br><div class="spoiler">  <b class="spoiler_title">High integrity of XML files:</b> <div class="spoiler_text">  Integrity means: <br>  - All objects are presented in the XML file once. <br>  - All references to id objects will be present in the XML file (for example, when describing a line there will be no references to non-existent points). <br>  - If the object is partially beyond the boundaries of the described area, it will still be fully described.  Therefore, in the two XML files that describe the boundary areas, there are duplicate objects that go from one area to another.  For example, if a relation is duplicated, then both the way and the node and relation that it contains are duplicated. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Differences in the organization of XML data taken from different sources:</b> <div class="spoiler_text">  An example of the following <a href="http://download.geofabrik.de/">geofabrik</a> XML attributes: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">node</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"231477"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lat</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"52.2600355"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.0172928"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">timestamp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2011-02-27T02:33:27Z"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">changeset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"7406582"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"39894"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">user</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"markpeers"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br>  An example of the following <a href="http://gis-lab.info/projects/osm_dump/">gis-lab</a> XML attributes: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">node</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"36725955"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"7"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">timestamp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2012-02-05T19:48:59Z"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"237247"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">user</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"masta"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">changeset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10597500"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lat</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"43.0735049"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"47.4662786"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">When describing a line, the order of the points cannot be changed:</b> <div class="spoiler_text">  An example of a closed line (simple quadrilateral structure): <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">way</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"243383077"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">timestamp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2013-10-25T08:52:05Z"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"371711"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">user</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"knockpenny"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">changeset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"18532019"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nd</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2508041246"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nd</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2508041226"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nd</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2508041210"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nd</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2508041208"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nd</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2508041246"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">k</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"building"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">v</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"yes"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">way</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><br><h4>  Explanation of examples </h4><br>  The publication discusses two examples of data acquisition: <br>  1. node-objects (countries, cities with a million population, volcanoes); <br>  2. way-objects (desert). <br><br>  The data types are chosen so that, after processing the complete OSM data, clear and visual content is obtained, but, at the same time, the result files would not be too large and could be shown on the map. <br><br><div class="spoiler">  <b class="spoiler_title">Why not a utility?</b> <div class="spoiler_text">  And why not just develop a utility in which to provide all possible mechanisms for filtering and selecting OSM data?  The idea was such (and even an attempt to implement it).  But nothing happened.  Indeed, working with OSM-XML is simple.  But the logic of the conditions of selection and interaction of tags of objects can be completely unpredictable.  Therefore, it is easier to have a kind of template that can be easily modified to obtain the necessary data.  Examples are such patterns. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">When developing examples, the following requirements were taken into account:</b> <div class="spoiler_text">  1. OSM data should be taken directly from the archive; <br>  2. Results data should be submitted in CSV and geoJSON formats; <br>  3. It is very good if work is provided on any (from minimum to full) amount of OSM data; <br>  4. It is very good if data cleansing from duplicates is ensured; <br>  5. Very well, if it is ensured performance on different operating systems; <br>  6. Examples must be fully functional and complete. <br></div></div><br><h5>  Processing OSM Files </h5><br>  OSM-XML is taken directly from the archived bzip2 files (* .osm.bz2).  <a href="http://icsharpcode.github.io/SharpZipLib/">SharpZipLib</a> library is used to work with the archive.  When processing large files, no problems were detected. <br><div class="spoiler">  <b class="spoiler_title">All * .osm.bz2 files in the input directory are processed sequentially:</b> <div class="spoiler_text"><pre> <code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">/.. /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/       /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ string dirIn = @".\in\"; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    (*.osm.bz2) string dirOut = @".\out\"; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/.. /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      -  /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ if (!Directory.Exists(dirOut)) Directory.CreateDirectory(dirOut); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/.. /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   *.osm.bz2     /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ foreach (string fileFullName in Directory.GetFiles(dirIn, "*.osm.bz2")) { FileInfo fileInfo = new FileInfo(fileFullName); using (FileStream fileStream = fileInfo.OpenRead()) { using (Stream unzipStream = new ICSharpCode.SharpZipLib.BZip2.BZip2InputStream(fileStream)) { XmlReader xmlReader = XmlReader.Create(unzipStream); while (xmlReader.Read()) { if (xmlReader.Name == "node") OSM_ProcessNode(xmlReader.ReadOuterXml()); else if (xmlReader.Name == "way") OSM_ProcessWay(xmlReader.ReadOuterXml()); else if (xmlReader.Name == "relation") OSM_ProcessRelation(xmlReader.ReadOuterXml()); } } } OSM_WriteResultToFiles(); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/     csv  geojson }</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Conditions for the selection of objects:</b> <div class="spoiler_text">  In order to find the desired object, it is necessary to analyze all the tags (Key: Value pair).  For example, the following conditions are defined for the selection of way-objects (desert): <br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OSM_ProcessWay</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> xmlWay</span></span></span><span class="hljs-function">)</span></span> { XmlDocument xmlDoc = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XmlDocument(); xmlDoc.LoadXml(xmlWay); <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> wayId = Int64.Parse(xmlDoc.DocumentElement.Attributes[<span class="hljs-string"><span class="hljs-string">"id"</span></span>].Value); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (XmlNode wayTag <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xmlDoc.DocumentElement.ChildNodes) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (wayTag.Name == <span class="hljs-string"><span class="hljs-string">"tag"</span></span> &amp;&amp; wayTag.Attributes[<span class="hljs-string"><span class="hljs-string">"k"</span></span>].Value == <span class="hljs-string"><span class="hljs-string">"natural"</span></span> &amp;&amp; wayTag.Attributes[<span class="hljs-string"><span class="hljs-string">"v"</span></span>].Value == <span class="hljs-string"><span class="hljs-string">"desert"</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//..      } } }</span></span></code> </pre><br>  To search for another object, you simply need to specify another Key: Value pair of values ‚Äã‚Äãor several pairs, if you need to simultaneously find several objects of different types. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">The selected point objects are saved in string buffers:</b> <div class="spoiler_text">  When processing node-objects, the selected data prepared in the string form is written to the string buffer.  After processing the next OSM file, the buffer is written to the result files and reset.  Periodic recording in the result files is necessary in order not to overload the system (errors like - out of memory). <br><pre> <code class="hljs pgsql">// Country // static StringBuilder sbCsvCountry = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> StringBuilder(); static StringBuilder sbGeojsonCountry = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> StringBuilder(); // City // static StringBuilder sbCsvCity = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> StringBuilder(); static StringBuilder sbGeojsonCity = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> StringBuilder(); static <span class="hljs-type"><span class="hljs-type">int</span></span> numPopulationCityFiltr = <span class="hljs-number"><span class="hljs-number">1000000</span></span>; //    Population (  &gt;= numPopulationCityFiltr) // Volcano // static StringBuilder sbCsvVolcano = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> StringBuilder(); static StringBuilder sbGeojsonVolcano = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> StringBuilder();</code> </pre><br>  In the example of processing node-objects all way-and relation-objects are taken into account for statistics (which can be viewed in the log). <br></div></div><br><div class="spoiler">  <b class="spoiler_title">To save the lines, the following structures are used (in the form of class lists):</b> <div class="spoiler_text">  Preparation of way objects takes place in two stages (in fact, two complete XML parsing of the same file).  First, all way objects are defined.  Then, when re-parsing, the latitude (lat) and longitude (lon) of all points (node) in the way-objects are determined.  The fact is that the description of points (node) comes before the description of lines (way). <br><pre> <code class="hljs pgsql">//   // <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> NodeAttrItem //  node- (  node,    way    ) { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> long NodeId = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">double</span></span> Lat = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">double</span></span> Lon = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string <span class="hljs-type"><span class="hljs-type">Name</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string NameEn; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string NameRu; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string Attrs; } <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> WayAttrItem //  way- { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> long WayId = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string <span class="hljs-type"><span class="hljs-type">Name</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string NameEn; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string NameRu; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string Attrs; } <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> WayToNodeItem //    { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> long WayId = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> long NodeId = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">double</span></span> Lat = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">double</span></span> Lon = <span class="hljs-number"><span class="hljs-number">0</span></span>; } //       // static List&lt;NodeAttrItem&gt; nodeAttrList = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;NodeAttrItem&gt;(); static List&lt;WayAttrItem&gt; wayAttrList = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;WayAttrItem&gt;(); static List&lt;WayToNodeItem&gt; wayToNodeList = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;WayToNodeItem&gt;();</code> </pre><br>  In fact, when you have to select a lot of objects (for example, coastlines, roads), errors like ‚ÄúOut of memory‚Äù can occur.  To eliminate such errors, it is sufficient to periodically record the data in the result files (for example, after processing the next file). <br></div></div><br><h5>  CSV and geoJSON </h5><br>  The CSV format is compact and convenient for recording a large amount of data, which can then be easily imported, for example, into a database. <br><br>  The geoJSON format, by contrast, is redundant and verbose in structure, but is convenient because the data is immediately ready for display on the map.  In the examples, for visualization, the GitHub feature for displaying geodata (files with a geojson extension) is used. <br><br><div class="spoiler">  <b class="spoiler_title">A little bit about how geojson is implemented:</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">//   -       // string geojsonHeader = "{\"<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>\":\"FeatureCollection\",\"features\":["; string geojsonFooter = Environment.NewLine + "{}]}"; //      (way  node) // string geojsonFeatureBegin = Environment.NewLine + "{" + Environment.NewLine + "\"<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>\":\"Feature\"," + Environment.NewLine + "\"geometry\":"; string geojsonFeatureEnd = Environment.NewLine + "},"; //  node // string geojsonPointBegin = "{\"<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>\":\"<span class="hljs-type"><span class="hljs-type">Point</span></span>\",\"coordinates\":"; string geojsonPointEnd = "},"; //  way (   <span class="hljs-type"><span class="hljs-type">Polygon</span></span>) // string geojsonPolygonBegin = "{\"<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>\":\"<span class="hljs-type"><span class="hljs-type">Polygon</span></span>\",\"coordinates\":[["; string geojsonPolygonEnd = "]]}"; //   // string geojsonPropBegin = Environment.NewLine + "\"properties\":{"; string geojsonPropEnd = "}";</code> </pre><br>  Line breaks, when preparing geojson, are used for easy viewing.  Sometimes in OSM-XML there are combinations of characters that can make geoJSON invalid.  This happens when the XML data is correct, and, after parsing, JSON perceives it as an error (the reasons for the errors have to be found in rather large files).  For example, double quotes ["] should be corrected if they are found in tags. In the example, double quotes are corrected to single [']. Or the latitude / longitude can be indicated as, for example," 32. "(corrected to" 32.0 "). <br><br>  In order for the lines not to be lost on the map, they are marked with dots that are clearly visible (in the example, each line is marked with a point object, the tags of which are taken from the line - the OSM_WriteResultToFilesGeojson function). <br></div></div><br><h5>  Explanation of working with XML </h5><br><div class="spoiler">  <b class="spoiler_title">When referring to attributes, names are indicated, not indexes:</b> <div class="spoiler_text">  When reading XML elements and XML attributes, it is advisable to specify a name, not an index.  This of course slows down a little, but it guarantees against unpleasant surprises, for example, when OSM data is taken from different sources with different order of attributes. <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">xmlDoc</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.DocumentElement</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Attributes</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">["lat"]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Value</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">xmlDoc</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.DocumentElement</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Attributes</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">["lon"]</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Value</span></span>;</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">All tags are saved in CSV as a Key: Value pair:</b> <div class="spoiler_text">  When reading object tags, the XML block is reread twice.  The first time to determine the type of object.  The second time, if the desired object is found, in order to save tags. <br><pre> <code class="hljs pgsql">//   -     // <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (XmlNode nodeTag <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xmlDoc.DocumentElement.ChildNodes) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nodeTag.Name == "tag") { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nodeTag.Attributes["k"].<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span> == "place" &amp;&amp; nodeTag.Attributes["v"].<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span> == "country") { string strAttrs = ""; <span class="hljs-type"><span class="hljs-type">bool</span></span> isAttr = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; //   -     // <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (XmlNode nodeTag <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xmlDoc.DocumentElement.ChildNodes) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nodeTag.Name == "tag") { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isAttr) strAttrs += ","; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> isAttr = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; strAttrs += String.Format("\"{<span class="hljs-number"><span class="hljs-number">0</span></span>}\":\"{<span class="hljs-number"><span class="hljs-number">1</span></span>}\"", nodeTag.Attributes["k"].<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>, nodeTag.Attributes["v"].<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>.Replace(<span class="hljs-string"><span class="hljs-string">'\"'</span></span>, <span class="hljs-string"><span class="hljs-string">'\'')); } } } } }</span></span></code> </pre><br>  The full composition of tags is needed, for example, if you need to analyze the composition of all tags for a new object.  Some objects (big cities, countries) may have a lot of tags.  The full list of tags is saved only in a CSV file. <br></div></div><br><h4>  Speed ‚Äã‚Äãand duplicates </h4><br>  Factors that affect performance: <br><div class="spoiler">  <b class="spoiler_title">1. The speed of reading the OSM file (unzipping and parsing XML elements):</b> <div class="spoiler_text">  For node-objects, the OSM file must be read once, and for way-objects, 2 times. <br><br>  The need for double-reading is caused by the fact that in the XML-file first go node-, and only for them way-objects.  In this case, double-reading simply simplifies the algorithm, avoiding the use of intermediate structures for storing the latitude and longitude of points. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">2. Remove duplicates and set latitude and longitude for points included in the way:</b> <div class="spoiler_text">  In order not to create duplicate objects and reduce the time for determining the latitude and longitude of points included in the way, a single mechanism is used based on the use of index arrays.  This approach can significantly increase the processing speed due to the optimization of search operations. <br><br>  In the example of deserts (for Africa), the difference in processing time is without an index array (useIndexedCheck = false) ‚âà 3.5 hours, with an index array (useIndexedCheck = true) ‚âà 1 hour.  But, if, for example, you need to select all the roads or coastlines on the complete OSM data, then without indexation the processing time can last for days or even weeks (the greater the number of selected objects is, the more time is spent), and with indexing it will take all the time a little more than a day. <br><br>  How it works? <br><br>  If, with each new parsing of a node or a way, to know - was the object with such an id already processed before? <br><br>  If you quickly (without search) determine that the read point enters the line, then this gives a significant gain in speed.  Since the total number of points can be quite significant (more than three billion on complete data), then the time spent on search operations for each point (on the internal arrays nodeAttrList, wayAttrList, wayToNodeList), with the accumulation of data, turn into significant.  That is - the use of the index array helps to get rid of "idle" search operations. <br><br>     ? <br><br>  node-  way-        id    (    id   ).     node-  way-    byte,     id . <br><pre> <code class="hljs coffeescript">bool useIndexedCheck = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> <span class="hljs-regexp"><span class="hljs-regexp">/    /</span></span>/    (<span class="hljs-literal"><span class="hljs-literal">false</span></span>),      *.bz2 ,         <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   (<span class="hljs-literal"><span class="hljs-literal">true</span></span>),    &gt; <span class="hljs-number"><span class="hljs-number">4</span></span> GB RAM <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>-- long wayIdxSize = <span class="hljs-number"><span class="hljs-number">512</span></span> * <span class="hljs-number"><span class="hljs-number">1024</span></span> * <span class="hljs-number"><span class="hljs-number">1024</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>; byte[] wayIdx; long nodeIdxSize = (<span class="hljs-number"><span class="hljs-number">2</span></span>L * <span class="hljs-number"><span class="hljs-number">1024</span></span> * <span class="hljs-number"><span class="hljs-number">1024</span></span> * <span class="hljs-number"><span class="hljs-number">1024</span></span> - <span class="hljs-number"><span class="hljs-number">57</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>); byte[] nodeIdx1; byte[] nodeIdx2; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>--    ,    &gt; <span class="hljs-number"><span class="hljs-number">4</span></span> GB RAM <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useIndexedCheck) { wayIdx = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> byte[wayIdxSize + <span class="hljs-number"><span class="hljs-number">1</span></span>]; nodeIdx1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> byte[nodeIdxSize + <span class="hljs-number"><span class="hljs-number">1</span></span>]; nodeIdx2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> byte[nodeIdxSize + <span class="hljs-number"><span class="hljs-number">1</span></span>]; }</code> </pre><br>    node  way (  XML)        . <br><pre> <code class="hljs lua">//    // <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useIndexedCheck) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(OSM_WayIdxAdd(wayId) &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } //.. //        // private static <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> OSM_NodeIdxAdd(long nodeId) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nodeId &lt;= nodeIdxSize) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ++nodeIdx1[nodeId]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ++nodeIdx2[nodeId - nodeIdxSize]; }</code> </pre><br>        ,     id   ,        . <br><pre> <code class="hljs pgsql">//    // private static long OSM_NodeIdxDuplCount() { long numDupl = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (long n = <span class="hljs-number"><span class="hljs-number">0</span></span>; n &lt;= nodeIdxSize; n++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nodeIdx1[n] &gt; <span class="hljs-number"><span class="hljs-number">2</span></span>) numDupl++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nodeIdx2[n] &gt; <span class="hljs-number"><span class="hljs-number">2</span></span>) numDupl++; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> numDupl; }</code> </pre><br></div></div><br><h4>     </h4><br>     Mono (     ). <br><br>     Visual Studio Community 2015  Windows 7. ,  EXE-   ICSharpCode.SharpZipLib.dll ( )    Linux (  OpenSuse, Mint, Ubuntu  Oracle Virtual Box)    Mono ( <a href="http://www.mono-project.com/download/">  Mono</a> ).   ,     . <br><br><div class="spoiler"> <b class="spoiler_title">     ,     :</b> <div class="spoiler_text">  . <br><pre> <code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">/.. string dirIn = @".\in\"; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    (*.bz2) string dirOut = @".\out\"; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    (   -  ) /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/.. OperatingSystem os = Environment.OSVersion; PlatformID pid = os.Platform; if (pid == PlatformID.Unix || pid == PlatformID.MacOSX) /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ 0 - Win32S, 1 - Win32Windows, 2 - Win32NT, 3 - WinCE, 4 - Unix, 5 - Xbox, 6 - MacOSX { dirIn = dirIn.Replace(@"\", @"/</span></span><span class="hljs-string"><span class="hljs-string">"); dirOut = dirOut.Replace(@"</span></span>\<span class="hljs-string"><span class="hljs-string">", @"</span></span>/<span class="hljs-string"><span class="hljs-string">"); }</span></span></code> </pre><br>        Environment.NewLine. <br><pre> <code class="hljs vbscript"><span class="hljs-built_in"><span class="hljs-built_in">string</span></span> geojsonFeatureBegin = Environment.NewLine + <span class="hljs-string"><span class="hljs-string">"{"</span></span> + Environment.NewLine + <span class="hljs-string"><span class="hljs-string">"\"</span></span>type\<span class="hljs-string"><span class="hljs-string">":\"</span></span>Feature\<span class="hljs-string"><span class="hljs-string">","</span></span> + Environment.NewLine + <span class="hljs-string"><span class="hljs-string">"\"</span></span>geometry\<span class="hljs-string"><span class="hljs-string">":"</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> geojsonFeatureEnd = Environment.NewLine + <span class="hljs-string"><span class="hljs-string">"},"</span></span>;</code> </pre><br></div></div><br><h4>   GitHub </h4><br>   (  ): <br> <a href=""> node-</a> <br> <a href=""> way-</a> <br><br>    (geoJSON): <br> <a href="https://github.com/apelserg/data-osm-getdata/blob/master/geojson/osmnode-country.geojson">   .</a> <br> <a href="https://github.com/apelserg/data-osm-getdata/blob/master/geojson/osmnode-city.geojson">        .</a> <br> <a href="https://github.com/apelserg/data-osm-getdata/blob/master/geojson/osmnode-volcano.geojson">   .</a> <br> <a href="https://github.com/apelserg/data-osm-getdata/blob/master/geojson/osmway-desert.geojson">   .</a> <br><br><h4>  Links </h4><br> <a href="http://wiki.openstreetmap.org/wiki/RU:%25D0%259E%25D0%25B1%25D1%258A%25D0%25B5%25D0%25BA%25D1%2582%25D1%258B_%25D0%25BA%25D0%25B0%25D1%2580%25D1%2582%25D1%258B">  (     )</a> <br> <a href="http://wiki.openstreetmap.org/wiki/RU:%25D0%25AD%25D0%25BB%25D0%25B5%25D0%25BC%25D0%25B5%25D0%25BD%25D1%2582%25D1%258B_%25D0%25BA%25D0%25B0%25D1%2580%25D1%2582%25D1%258B"> </a> <br> <a href="">   Planet.osm</a> <br> <a href="http://wiki.openstreetmap.org/wiki/Database">  </a> <br> <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BF%25D0%25B8%25D1%2581%25D0%25BE%25D0%25BA_%25D0%25BA%25D0%25B0%25D1%2580%25D1%2582%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D1%2584%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B8%25D1%2585_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B5%25D0%25BA%25D1%2586%25D0%25B8%25D0%25B9"> </a> <br> <a href="https://en.wikipedia.org/wiki/GeoJSON"> GeoJSON</a> <br> <a href="http://habrahabr.ru/post/183288/">   GitHub    geoJSON</a> <br> <a href="http://download.geofabrik.de/">  geofabrik</a> <br> <a href="http://gis-lab.info/projects/osm_dump/">  gis-lab</a> <br> <a href="http://wiki.openstreetmap.org/wiki/Frameworks">      OSM</a> <br> <a href="http://icsharpcode.github.io/SharpZipLib/">     (SharpZipLib)</a> <br> <a href="http://www.mono-project.com/download/"> Mono</a> </div><p>Source: <a href="https://habr.com/ru/post/270513/">https://habr.com/ru/post/270513/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270501/index.html">Very short intro</a></li>
<li><a href="../270503/index.html">Analysis of shopping carts in retail</a></li>
<li><a href="../270505/index.html">Time to materialize: 5 days left until the end of the competition</a></li>
<li><a href="../270507/index.html">Regular expression searches can be quick and easy.</a></li>
<li><a href="../270509/index.html">GDG DevFest Voronezh 2015: photo and video report from the event</a></li>
<li><a href="../270515/index.html">‚ÄúBig data‚Äù - is it boring?</a></li>
<li><a href="../270517/index.html">Another virtual interface</a></li>
<li><a href="../270519/index.html">Symfony2 two-factor authentication with a certificate</a></li>
<li><a href="../270521/index.html">Docker 1.9 + Weave 1.2.1 bridge mode</a></li>
<li><a href="../270523/index.html">Colocation in theory and practice</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>