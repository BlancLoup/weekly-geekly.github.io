<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Loading javascript files. We solve the problem Ctrl-F5</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We all know a hundred ways to load scripts. Each has its pros and cons. 

 I want to introduce you to the next method of downloading js-files. I also ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Loading javascript files. We solve the problem Ctrl-F5</h1><div class="post__text post__text-html js-mediator-article">  We all know a hundred ways to load scripts.  Each has its pros and cons. <br><br>  I want to introduce you to the next method of downloading js-files.  I also understand that this method is actively used in the network, but I have not seen articles about it. <br>  Therefore, I will describe the way that I use myself, in the hope that you will also like it. <br><br>  Goals: <b>development modularity, fast loading, valid cache</b> . <br>  Bonus: download indicator 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>UPD.</b>  Marked the main purpose of this method - valid cache. <br>  When using this method, you will not have uncertainty about whether the script will be updated and whether it will work for the end user. <br><br>  <b>UPD 2.</b> For those who do not finish reading to the end (I understand you perfectly), in the end it says how everything can be done much easier. <br>  Instead of core.633675510761.js write core.js? V = 633675510761.  And there it is stated why so much has been written. <br><br>  <b>UPD 3.</b> In the comments from <a href="https://habrahabr.ru/users/david_mz/" class="user_link">david_mz</a> , <a href="https://habrahabr.ru/users/webbyte/" class="user_link">WebByte</a> there was a suggestion to use the urlrewrite instead of JSHandler to process the request. <br><br><a name="habracut"></a><br><br>  By modularity, I mean that each component of the system is located in a separate file: core.js, utils.js, control.js, button.js, etc. <br>  From this principle, I do not refuse even when loading the page.  Although I know that downloading 1 file is 100Kb faster than 10 by 10Kb. <br>  I will solve this problem through caching further. <br><br>  The speed of loading is all sorts of tricks to display the page as quickly as possible. <br>  The method of combining scripts in the packages I brushed off above.  I think its main disadvantages are: <br><ul><li>  change in one component necessitates overloading the entire package </li><li>  high probability of duplication of components in different packages </li></ul><br>  Therefore, minimization, compression and caching remain. <br>  I also refused to compress, because  There are opinions that the gain in the speed of downloading a file is lost in the speed of its unpacking. <br>  Caching  Here comes the <b>highlight of my way</b> . <br><br>  In addition to using the ‚ÄúIf-Modified-Since‚Äù and ‚ÄúIf-None-Match‚Äù (ETag) headers, I install Expires in a year! <br>  Now why am I so boldly doing that, and I am confident that my file will be valid year. <br><br>  Because I attribute to the file name the date of its last modification! <br>  Those.  there is core.js, inclusion happens like this <br><br><br>  Everything, the next change in this file will change its name to core.635675530761.js, and a completely new script will be loaded. <br>  Now I will list the advantages of this method, they are not immediately obvious: <br><ul><li>  we get a reliable file cache.  Even operating with Last-Modified and ETag headers, we do not always get the latest version of the file.  The browser or proxy server does not always request information about the file.  Often they take their cash.  In such cases, it is normal to reset the cache by Ctrl-F5.  Familiar?  Now, take the old file from the internal cache, since  we actually request a new file with a new name. </li><li>  All If-None-Match and If-Modified-Since verification requests disappear.  Even if the file has not changed and the server returns Not Modified 304, anyway, each file is a new request - this is a delay.  Now repeated calls to one file immediately take it from the cache.  Wow, isn't it? </li></ul><br><br>  For clarity, here are a couple of screenshots.  The Internet is very slow. <br>  The first access to the page. <br><img src="http://metalex.at.tut.by/habr/ctrlf5/first.png"><br>  Second: <br><img src="http://metalex.at.tut.by/habr/ctrlf5/next.png"><br>  We change one file - the third appeal <br><img src="http://metalex.at.tut.by/habr/ctrlf5/modified.png"><br><br>  <b>As you can see from the second and third drawings, the browser has updated the modified script.</b>  You can also see that he did not bother to check all files for changes.  Those.  There are a lot of pictures on the page, but for some reason he checked only two.  The same thing happens with scripts.  They are not always updated.  The web server can set additional headers for static files, like Set-Expires + (1-9999) minutes.  Plus, the internal logic of the browser and proxy servers.  In general, what we can not affect. <br><br>  It was a theory.  It is not difficult to implement in practice. <br>  I will give an example of how I solve this on ASP.NET.  Step by step <br><br>  1. To include files on the page, I use a special object that checks for the uniqueness of the included file.  And then when rending it writes my files with the date prefix. <br><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> ScriptHelper <br> { <br> <font color="#0000ff">protected</font> StringCollection includeScripts = <font color="#0000ff">new</font> StringCollection(); <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> Include( <font color="#2B91AF">String</font> filename ) <br> { <br> filename = filename.ToLower(); <br> StringCollection container; <br> <font color="#0000ff">switch</font> ( System.IO.Path.GetExtension( filename ) ) <br> { <br> <font color="#0000ff">case</font> <font color="#A31515">".js"</font> : container = includeScripts; <font color="#0000ff">break</font> ; <br> <font color="#0000ff">default</font> : <font color="#0000ff">throw</font> <font color="#0000ff">new</font> ArgumentException( <font color="#A31515">"Not supported include file: "</font> + filename, <font color="#A31515">"filename"</font> ); <br> } <br> <font color="#0000ff">if</font> ( !container.Contains( filename ) ) container.Add( filename ); <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> RegisterScripts( <font color="#2B91AF">Page</font> page ) <br> { <br> <font color="#2B91AF">StringBuilder</font> clientScript = <font color="#0000ff">new</font> <font color="#2B91AF">StringBuilder</font> (); <br> <font color="#0000ff">foreach</font> ( <font color="#2B91AF">String</font> filename <font color="#0000ff">in</font> includeScripts ) <br> clientScript.AppendFormat( includeJS, prefix + FileSystemWatcherManager.GetModifiedName( <font color="#A31515">"Scripts/"</font> + filename ) ); <br> page.ClientScript.RegisterClientScriptBlock( page.GetType(), <font color="#A31515">"clientscripts"</font> , clientScript.ToString(), <font color="#0000ff">false</font> ); <br> } <br> } <br> <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  <i>Comment:</i> <br>  prefix - relative folder prefix with scripts <br>  FileSystemWatcherManager is a manager for working with physical files.  This class allows you to avoid frequent calls to System.IO.File.GetLastWriteTimeUtc (), and is a simple file system monitor wrapper.  Let me give you the full code. <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">using</font> System; <br> <font color="#0000ff">using</font> System.IO; <br> <font color="#0000ff">using</font> System.Collections. <font color="#2B91AF">Generic</font> ; <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> FileSystemWatcherManager <br> { <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#2B91AF">String</font> physicalAppPath; <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> SortedList&lt; <font color="#2B91AF">String</font> , <font color="#2B91AF">Int64</font> &gt; lastModifiedFiles = <font color="#0000ff">new</font> SortedList&lt; <font color="#2B91AF">String</font> , <font color="#2B91AF">Int64</font> &gt;(); <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> StartDirectoryWatcher( <font color="#2B91AF">String</font> directory, <font color="#2B91AF">String</font> filter ) <br> { <br> <font color="#0000ff">#if</font> DEBUG <br> <font color="#0000ff">return</font> ; <br> <font color="#0000ff">#endif</font> <br> <font color="#0000ff">if</font> ( physicalAppPath == <font color="#0000ff">null</font> &amp;&amp; System.Web. <font color="#2B91AF">HttpContext</font> .Current.Request != <font color="#0000ff">null</font> ) <br> physicalAppPath = System.Web. <font color="#2B91AF">HttpContext</font> .Current.Request.PhysicalApplicationPath; <br> <br> <font color="#0000ff">foreach</font> ( <font color="#2B91AF">String</font> pattern <font color="#0000ff">in</font> filter.Split( <font color="#A31515">','</font> ) ) <br> { <br> FileSystemWatcher dirWatcher = <font color="#0000ff">new</font> FileSystemWatcher( directory, pattern ); <br> dirWatcher.NotifyFilter = NotifyFilters.FileName | NotifyFilters.LastWrite; <br> dirWatcher.IncludeSubdirectories = <font color="#0000ff">true</font> ; <br> dirWatcher.EnableRaisingEvents = <font color="#0000ff">true</font> ; <br> dirWatcher.Changed += <font color="#0000ff">new</font> FileSystemEventHandler( OnFileSystemChanged ); <br> dirWatcher.Created += <font color="#0000ff">new</font> FileSystemEventHandler( OnFileSystemChanged ); <br> dirWatcher.Renamed += <font color="#0000ff">new</font> RenamedEventHandler( OnFileSystemRenamed ); <br> <br> UpdateLastModifiedFiles( directory, pattern, <font color="#0000ff">true</font> ); <br> } <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> OnFileSystemRenamed( <font color="#0000ff">object</font> sender, RenamedEventArgs e ) <br> { <br> UpdateLastModifiedFiles( Path.GetDirectoryName( e.FullPath ), ( (FileSystemWatcher)sender ).Filter, <font color="#0000ff">true</font> ); <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> OnFileSystemChanged( <font color="#0000ff">object</font> sender, FileSystemEventArgs e ) <br> { <br> UpdateLastModifiedFiles( Path.GetDirectoryName( e.FullPath ), ((FileSystemWatcher)sender).Filter, <font color="#0000ff">true</font> ); <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> UpdateLastModifiedFiles( <font color="#2B91AF">String</font> directory, <font color="#2B91AF">String</font> filter, Boolean logAction ) <br> { <br> <font color="#0000ff">lock</font> ( lastModifiedFiles ) <br> { <br> <font color="#0000ff">if</font> ( logAction )  WL.Logger.Instance.Log( <font color="#2B91AF">String</font> .Format( <font color="#A31515">"Update modified files {1} at \"{0}\""</font> , directory, filter ) ); <br> <br> <font color="#0000ff">foreach</font> ( <font color="#2B91AF">String</font> subDir <font color="#0000ff">in</font> <font color="#2B91AF">Directory</font> .GetDirectories( directory ) ) <br> UpdateLastModifiedFiles( subDir, filter, <font color="#0000ff">false</font> ); <br> <font color="#0000ff">foreach</font> ( <font color="#2B91AF">String</font> file <font color="#0000ff">in</font> <font color="#2B91AF">Directory</font> .GetFiles( directory, filter ) ) <br> lastModifiedFiles[file.Substring( physicalAppPath.Length ).ToLower().Replace( <font color="#A31515">'\\'</font> , <font color="#A31515">'/'</font> )] = <font color="#2B91AF">File</font> .GetLastWriteTimeUtc( file ).Ticks / 1000000; <br> } <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#2B91AF">String</font> GetModifiedName( <font color="#2B91AF">String</font> clientPath ) <br> { <br> <font color="#0000ff">#if</font> DEBUG <br> <font color="#0000ff">return</font> clientPath; <br> <font color="#0000ff">#endif</font> <br> <font color="#0000ff">lock</font> ( lastModifiedFiles ) <br> { <br> <font color="#2B91AF">Int64</font> ticks; <br> <font color="#0000ff">if</font> ( !lastModifiedFiles.TryGetValue( clientPath.ToLower(), <font color="#0000ff">out</font> ticks ) ) <font color="#0000ff">return</font> clientPath; <br> <font color="#0000ff">return</font> <font color="#2B91AF">String</font> .Format( <font color="#A31515">"{0}/{1}.{2}{3}"</font> , Path.GetDirectoryName( clientPath ).Replace( <font color="#A31515">'\\'</font> , <font color="#A31515">'/'</font> ), Path.GetFileNameWithoutExtension( clientPath ), ticks, Path.GetExtension( clientPath ) ); <br> } <br> } <br> } <br> <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Call global.asax <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">void</font> Application_Start( <font color="#0000ff">object</font> sender, <font color="#2B91AF">EventArgs</font> e ) <br> { <br> FileSystemWatcherManager.StartDirectoryWatcher( <font color="#2B91AF">HttpContext</font> .Current.Request.PhysicalApplicationPath, <font color="#A31515">"*.js,*.css"</font> ); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  I think comments are superfluous, the only thing I will note is that under DEBUG mode, I use real file names so that the debugger can cling to them. <br><br>  The next item is a js file handler. <br>  Enabled via web.config <br> <code>&lt;httpHandlers&gt; <br> &lt;add verb="GET" path="*.js" type="WL.JSHandler"/&gt; <br> &lt;/httpHandlers&gt; <br></code> <br><br>  The handler is needed to remove the prefix with the time of the change and give the real file.  It also checks the If-None-Match headers, If-Modified-Since, sets LastModified, ETag and Expires.  It is also possible to select a file, original, minimized, compressed, checking rights and so on. <br><br>  I give the clothed version. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> JSHandler : IHttpHandler <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> ProcessRequest( <font color="#2B91AF">HttpContext</font> context ) <br> { <br> <font color="#0000ff">try</font> <br> { <br> <font color="#2B91AF">String</font> filepath = context.Request.PhysicalPath; <br> <font color="#2B91AF">String</font> [] parts = filepath.Split( <font color="#A31515">'.'</font> ); <br> <font color="#2B91AF">Int64</font> modifiedTicks = 0; <br> <font color="#0000ff">if</font> ( parts.Length &gt;= 2 ) <br> { <br> <font color="#0000ff">if</font> ( <font color="#2B91AF">Int64</font> .TryParse( parts[parts.Length - 2], <font color="#0000ff">out</font> modifiedTicks ) ) <br> { <br> <font color="#2B91AF">List</font> &lt; <font color="#2B91AF">String</font> &gt; parts2 = <font color="#0000ff">new</font> <font color="#2B91AF">List</font> &lt; <font color="#2B91AF">String</font> &gt;( parts ); <br> parts2.RemoveAt( parts2.Count - 2 ); <br> filepath = <font color="#2B91AF">String</font> .Join( <font color="#A31515">"."</font> , parts2.ToArray() ); <br> } <br> } <br> <br> FileInfo fileInfo = <font color="#0000ff">new</font> FileInfo( filepath ); <br> <font color="#0000ff">if</font> ( !fileInfo.Exists ) <br> { <br> context.Response.StatusCode = 404; <br> context.Response.StatusDescription = <font color="#A31515">"Not found"</font> ; <br> } <br> <font color="#0000ff">else</font> <br> { <br> <font color="#2B91AF">DateTime</font> lastModTime = <font color="#0000ff">new</font> <font color="#2B91AF">DateTime</font> ( fileInfo.LastWriteTime.Year, fileInfo.LastWriteTime.Month, fileInfo.LastWriteTime.Day, fileInfo.LastWriteTime.Hour, fileInfo.LastWriteTime.Minute, fileInfo.LastWriteTime.Second, 0 ).ToUniversalTime(); <br> <font color="#2B91AF">String</font> ETag = <font color="#2B91AF">String</font> .Format( <font color="#A31515">"\"{0}\""</font> , lastModTime.ToFileTime().ToString( <font color="#A31515">"X8"</font> , System.Globalization.CultureInfo.InvariantCulture ) ); <br> <font color="#0000ff">if</font> ( ETag == context.Request.Headers[ <font color="#A31515">"If-None-Match"</font> ] ) <br> { <br> context.Response.StatusCode = 304; <br> context.Response.StatusDescription = <font color="#A31515">"Not Modified"</font> ; <br> } <br> <font color="#0000ff">else</font> <br> <font color="#0000ff">if</font> ( context.Request.Headers[ <font color="#A31515">"If-Modified-Since"</font> ] != <font color="#0000ff">null</font> ) <br> { <br> <font color="#2B91AF">String</font> modifiedSince = context.Request.Headers[ <font color="#A31515">"If-Modified-Since"</font> ]; <br> <font color="#2B91AF">Int32</font> sepIndex = modifiedSince.IndexOf( <font color="#A31515">';'</font> ); <br> <font color="#0000ff">if</font> ( sepIndex &gt; 0 ) modifiedSince = modifiedSince.Substring( 0, sepIndex ); <br> <font color="#2B91AF">DateTime</font> sinceDate; <br> <font color="#0000ff">if</font> ( <font color="#2B91AF">DateTime</font> .TryParseExact( modifiedSince, <font color="#A31515">"R"</font> , <font color="#0000ff">null</font> , System.Globalization.DateTimeStyles.AssumeUniversal, <font color="#0000ff">out</font> sinceDate ) &amp;&amp; <br> lastModTime.CompareTo( sinceDate.ToUniversalTime() ) == 0 ) <br> { <br> context.Response.StatusCode = 304; <br> context.Response.StatusDescription = <font color="#A31515">"Not Modified"</font> ; <br> } <br> } <br> <font color="#0000ff">if</font> ( context.Response.StatusCode != 304 ) <br> { <br> <font color="#2B91AF">String</font> file = fileInfo.FullName; <br> <br> <font color="#008000">/*  String encoding = context.Request.Headers["Accept-Encoding"];</font> <br> <font color="#008000">if( encoding != null &amp;&amp; encoding.IndexOf( "gzip", StringComparison.InvariantCultureIgnoreCase ) &gt;= 0 &amp;&amp;</font> <br> <font color="#008000">File.Exists( file + ".jsgz" ) )</font> <br> <font color="#008000">{</font> <br> <font color="#008000">file = file + ".jsgz";</font> <br> <font color="#008000">context.Response.AppendHeader( "Content-Encoding", "gzip" );</font> <br> <font color="#008000">}</font> <br> <font color="#008000">else*/</font> <br> <font color="#0000ff">if</font> ( <font color="#2B91AF">File</font> .Exists( file + <font color="#A31515">".jsmin"</font> ) ) file = file + <font color="#A31515">".jsmin"</font> ; <br> <br> <font color="#0000ff">if</font> ( context.Request.HttpMethod == <font color="#A31515">"GET"</font> ) <br> { <br> context.Response.TransmitFile( file ); <br> } <br> <br> context.Response.Cache.SetCacheability( HttpCacheability.Public ); <br> context.Response.Cache.SetLastModified( lastModTime ); <br> context.Response.Cache.SetETag( ETag ); <br> <font color="#0000ff">if</font> ( modifiedTicks != 0 ) <br> context.Response.Cache.SetExpires( <font color="#2B91AF">DateTime</font> .UtcNow.AddYears( 1 ) ); <br> context.Response.AppendHeader( <font color="#A31515">"Content-Type"</font> , <font color="#A31515">"text/javascript"</font> ); <br> <br> context.Response.StatusCode = 200; <br> context.Response.StatusDescription = <font color="#A31515">"OK"</font> ; <br> } <br> } <br> } <br> <font color="#0000ff">catch</font> ( Exception ex ) <br> { <br> WL.Logger.Instance.Error( ex ); <br> context.Response.StatusCode = 500; <br> context.Response.StatusDescription = <font color="#A31515">"Internal Server Error"</font> ; <br> } <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">bool</font> IsReusable { <font color="#0000ff">get</font> { <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; } } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  <i>Remark</i>  If I noticed, I give away either the original file, or .jsmin, or .jsgz. <br>  These are minimized and compressed versions, which are built automatically by a separate tool when building a server.  To prevent direct access to them, add them to web.config <br><br> <code><br> &lt;httpHandlers&gt; <br> &lt;add verb="*" path=".jsmin" type="System.Web.HttpForbiddenHandler"/&gt; <br> &lt;add verb="*" path=".jsgz" type="System.Web.HttpForbiddenHandler"/&gt; <br> &lt;/httpHandlers&gt; <br></code> <br><br><h2>  Instead of ending </h2><br>  Perhaps you will say a lot of difficulties with the implementation of a separate handler. <br>  I can advise a simpler way to handle the file.  Instead of writing <br>  Then do not need JSHandler.  But I'm not sure how the cache will work.  In fact, the file name does not change, but only an additional parameter appears.  Those.  The same problem with Ctrl-F5 may occur due to the internal browser cache or proxy server. <br>  But I still need a separate JSHandler to check the rights to access scripts, for example, from the Admin folder I give only to admins. <br>  Plus, it will be useful and interesting for someone to see the implementations of JSHander and the file system monitor. <br><br>  If the JSHandler task is only in cutting the modification key, then it can be replaced by the urlrewrite module. <br><br>  <u>Obviously, in this way you can load other types of files, for example .css.</u>  I do that, it can be seen on the first screenshot, I deliberately pointed the cursor on the css-file. <br>  You can expand to other types, such as images.  But it is inappropriate.  First of all, you are tortured in the code to put down the right names, and secondly, the pictures change extremely rarely, so if one gets stuck in the browser cache, then it‚Äôs not scary.  And if it's scary, rename this picture manually. <br><br><h2>  And the promised bonus with the download indicator. </h2><br>  While your scripts are being loaded for the first time, you can visually speed up the process by showing the download process. <br>  Remember the place where I write include files?  There actually is a code like this: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#2B91AF">StringBuilder</font> clientScript = <font color="#0000ff">new</font> <font color="#2B91AF">StringBuilder</font> (); <br> <font color="#0000ff">if</font> ( includeScripts.Count &gt; 0 ) <br> { <br> clientScript.Append( <font color="#A31515">@"&lt;div id="</font> <font color="#A31515">"preloader"</font> <font color="#A31515">" style="</font> <font color="#A31515">"display:none"</font> <font color="#A31515">"&gt;&lt;div&gt;&lt;/div&gt;Loading Scripts...&lt;/div&gt;"</font> ); <br> } <br> clientScript.Append( scriptStart ); <br> <font color="#0000ff">if</font> ( includeScripts.Count &gt; 0 ) <br> { <br> clientScript.Append( <font color="#A31515">@"var pl=document.getElementById("</font> <font color="#A31515">"preloader"</font> <font color="#A31515">");pl.style.display="</font> <font color="#A31515">""</font> <font color="#A31515">";pl=pl.firstChild;"</font> ); <br> } <br> clientScript.Append( scriptEnd ); <br> <font color="#0000ff">if</font> ( includeScripts.Count &gt; 0 ) <br> { <br> Single dx = 100f / includeScripts.Count; <br> Single pos = 0f; <br> <font color="#0000ff">foreach</font> ( <font color="#2B91AF">String</font> filename <font color="#0000ff">in</font> includeScripts ) <br> { <br> clientScript.AppendFormat( includeJS, prefix + FileSystemWatcherManager.GetModifiedName( <font color="#A31515">"Scripts/"</font> + filename ) ); <br> clientScript.AppendFormat( <font color="#A31515">@"&lt;script type="</font> <font color="#A31515">"text/javascript"</font> <font color="#A31515">"&gt;pl.style.width="</font> <font color="#A31515">"{0}%"</font> <font color="#A31515">";&lt;/script&gt;"</font> , ( <font color="#2B91AF">Int32</font> )pos ); <br> pos += dx; <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Draw two div'a.  And the second as the load increases the width. <br>  In CSS, it looks like this: <br><blockquote> <code>#preloader { width:218px;height:92px;background:transparent url("../images/preload.jpg") no-repeat scroll left top;position:relative;text-align:right;color:#383922;font-weight:bold;margin-left:20px;margin-right:auto; } <br> #preloader div { width:0px;height:92px;background:transparent url("../images/preload.jpg") no-repeat scroll left bottom;position:absolute;left:0px;top:0px; }</code> </blockquote> <br><br><h2>  Thanks for attention.  Ready to listen to criticism, comments and answer questions </h2></div><p>Source: <a href="https://habr.com/ru/post/51258/">https://habr.com/ru/post/51258/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../51251/index.html">Extensions in May</a></li>
<li><a href="../51252/index.html">Points for (ki) Borg</a></li>
<li><a href="../51253/index.html">The public download of Windows 7 beta will close soon.</a></li>
<li><a href="../51254/index.html">Feedburner</a></li>
<li><a href="../51256/index.html">Tactical positioning: a couple of recommendations for text animation</a></li>
<li><a href="../51259/index.html">Interesting coincidences. Part two.</a></li>
<li><a href="../51260/index.html">Help me choose an OS for a thin client.</a></li>
<li><a href="../51261/index.html">Brief testing of free antiviruses</a></li>
<li><a href="../51262/index.html">Commercial Twitter Spam Tool</a></li>
<li><a href="../51264/index.html">AddVenture - a crisis medicine for a Russian startup</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>