<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Recover killed MBR and partition table</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="0. Intro. 
 The situation is as follows. There is a screw on 160GB. It has 2 sections - 40GB and 120GB. In order to install ubunt as a second system, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Recover killed MBR and partition table</h1><div class="post__text post__text-html js-mediator-article"><h4>  0. Intro. </h4><br>  The situation is as follows.  There is a screw on 160GB.  It has 2 sections - 40GB and 120GB.  In order to install ubunt as a second system, a breakdown of 120GB -&gt; 100 + 10 + 2 + 8 was made. <br><br>  Further, in order to roll back the changes, the disks (10, 2 and 8) were merged back into one 20GB and formatted with NTFS.  In the load to this, operations were carried out with the MBR, the result of which was her death. <br><br><h5>  Results </h5><br>  1. When the system is booted, the message MBR helper not found; <br>  2. fdisk shows one big 160GB disk. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Fool it is clear that this is the beginning of a fun night. <br>  Further, under the cut, address the issue. <br><a name="habracut"></a><br><h4>  1. Restore Partition Table </h4><br><h5>  1.1.  Parted magic </h5><br>  This LiveCD \ USB <a href="http://partedmagic.com/doku.php">distribution</a> , 100 MB in size carries a huge pile of software for working with disks.  From breakdown to recovery. <br>  Of these, we will need <b>gpart</b> , <b>testdisk</b> , <b>fdisk,</b> and <b>ms-sys</b> . <br><br><h5>  1.2.  Gpart </h5><br>  <a href="http://www.brzitwa.de/mb/gpart/index.html">gpart</a> is a utility that scans sector-by-sector for the presence of partitions that are present on the media but not in the table.  In her work, she ignores an already existing table (if present).  The program was developed by the German programmer Michail Brzitwa and is no longer supported by them.  Sluggish development is done by the Fedora and Debian teams.  The current version is 0.1h. <br><br>  The utility allows you to quickly and easily restore the partition table, but it has several drawbacks.  Firstly, the development was abandoned long ago, and secondly, it sometimes does not quite correctly define sections. <br><br>  gpart can work in 2 modes.  This is a quick analysis and detailed scan.  In some cases, the first mode is sufficient.  We will look at the second. <br><br> <code>gpart -if /dev/sda <br></code> <br>  <em>-i</em> - interactive mode.  For each partition found, a question will be asked, save it, or skip it. <br>  <em>-f</em> - full disk scan. <br><br>  After quite a long time, a report will be created with possible sections.  It is something that you should definitely review as carefully as possible before recording. <br>  Report example (not mine): <br><br> <code>Begin scan... <br> Possible partition(DOS FAT), size(1907mb), offset(0mb) <br> Possible partition(SGI XFS filesystem), size(5730mb), offset(1907mb) <br> End scan. <br> Checking partitions... <br> Partition(DOS or Windows 95 with 32 bit FAT, LBA): primary <br> Partition(Linux ext2 filesystem): primary <br> Ok. <br> Guessed primary partition table: <br> Primary partition(1) <br> type: 012(0x0C)(DOS or Windows 95 with 32 bit FAT, LBA) <br> size: 1907mb #s(3906544) s(16-3906559) <br> chs: (0/1/1)-(1023/19/16)d (0/1/1)-(12207/19/16)r <br> Primary partition(2) <br> type: 131(0x83)(Linux ext2 filesystem) <br> size: 5730mb #s(11736000) s(3906560-15642559) <br> chs: (1023/19/16)-(1023/19/16)d (12208/0/1)-(48882/19/16)r <br> Primary partition(3) <br> type: 000(0x00)(unused) <br> size: 0mb #s(0) s(0-0) <br> chs: (0/0/0)-(0/0/0)d (0/0/0)-(0/0/0)r <br> Primary partition(4) <br> type: 000(0x00)(unused) <br> size: 0mb #s(0) s(0-0) <br> chs: (0/0/0)-(0/0/0)d (0/0/0)-(0/0/0)r <br></code> <br><br>  If everything is OK, then we agree to write to the partition table, cross our fingers and reboot. <br>  In my case, the program identified sections that were before the breakdown (40 and 120), which did not fit and forced to look for alternative ways to restore. <br><br><h5>  1.3.  testdisk </h5><br>  Note: this utility is described in more detail in <a href="http://habrahabr.ru/blogs/personal/78579/">this post</a> , I will not repeat here. <br><br>  This utility is similar to the previous one, but it has a number of advantages: <br>  1. more recent and actively maintained; <br>  2. subjectively, it works much faster; <br>  3. more functional; <br>  4. There is a simple console interface based on ncurses. <br><br>  Go! <br>  1. in the first window, select Create a new log file; <br>  2. select the desired disk (/ dev / sda) -&gt; Proceed; <br>  3. mark the type of partitions as Intel; <br>  4. select the Analyze current partition structure; <br>  5. If the partitions found are correct, click Backup and go to step 6, you can quickly rescan the disk if there is an error somewhere (Quick search); <br>  6. There is already a green list with sections.  If ok, then write, otherwise run Deep search .; <br><br>  In my case, the result was similar to the result of gpart, which is incorrect. <br>  Having started the Deep search, after waiting for about 40 minutes, I received an answer, from which my heart felt so good. <br>  Several partitions were found that overlapped one another (they were the original (before manipulations) 120GB and new, 100GB).  Noting the unnecessary, as remote, I wrote the table to disk and rebooted.  Fortunately, everything worked out and the computer returned to the state it was in, and I could go to bed with a clear conscience. <br><br><h4>  3. Recovery MBR </h4><br>  For this task, we have ms-sys tools in our arsenal. <br>  First, we learn that with our MBR. <br><br> <code>ms-sys /dev/sda <br> /dev/sda has an x86 boot sector <br> it is unknown boot sector <br></code> <br>  Now you can see that there is no boot sector on this disk. <br>  The utility can work with the MBR of various operating systems.  The list can be obtained by running the program without arguments.  In my case, it was necessary from Windows 7. <br>  Write the MBR to disk: <br><br> <code>ms-sys -7 /dev/sda <br> Windows 7 master boot record successfully written to /dev/sda <br></code> <br>  Checking: <br><br> <code>ms-sys /dev/sda <br> it is Microsof 7 master boot record, like the one this <br> program creates with the switch -7 on a hard disk device. <br></code> <br>  That's all, the necessary MBR is installed and you can reboot. <br><br><h4>  3. Outro </h4><br>  This post is an example of how from scratch you can create a problem for yourself and do not do half the night with what you need.  But it gave invaluable experience, which I tried to present here. <br>  Perhaps someone will find it useful.  After all, it is not very difficult to get into such a situation, but there is no particular manual. </div><p>Source: <a href="https://habr.com/ru/post/117661/">https://habr.com/ru/post/117661/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../117653/index.html">Simple analog projection clock</a></li>
<li><a href="../117654/index.html">We work with kernel modules in Linux</a></li>
<li><a href="../117657/index.html">Ar. Drone: Linux on board</a></li>
<li><a href="../117658/index.html">BAE Systems is developing a microwave gun.</a></li>
<li><a href="../117659/index.html">Integration CMS Joomla and Ejabberd</a></li>
<li><a href="../117662/index.html">The Program of Encouraging the Authors is ‚Äúpitfalls‚Äù about which it is better to learn in advance</a></li>
<li><a href="../117663/index.html">Accelerate Visual Studio Part I. Unity Builds</a></li>
<li><a href="../117664/index.html">Source Board - hosting code</a></li>
<li><a href="../117668/index.html">What we should build a network</a></li>
<li><a href="../117670/index.html">Accelerate Visual Studio Part II. Compilation experiments</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>