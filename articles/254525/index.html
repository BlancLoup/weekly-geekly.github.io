<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>I want from API a line, and a point, and a point</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. 

 Many probably had to design and develop a RESTful API in their lives. With the release of the Web API technology, this has become much easie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>I want from API a line, and a point, and a point</h1><div class="post__text post__text-html js-mediator-article">  Hello. <br><br>  Many probably had to design and develop a RESTful API in their lives.  With the release of the Web API technology, this has become much easier, and with the release of Web API 2 it‚Äôs also much more pleasant.  The routing system, migrated from ASP.NET MVC, does an excellent job with its task, and allows us not only to freely construct paths, but also to spice them up with various parameters, indicating them in curly brackets.  It is unlikely that a template like ‚Äúapi / {controller} / {id}‚Äù causes anyone to be reverently awed.  However, what happens if one of our API's methods as this {id} itself does not accept a number in a string representation, not a Guid, but, say, an email address?  Well, for example, to check the presence of this address in the database.  Then nothing will work, but the fault is a small and seemingly completely harmless point.  How to live with it further and is told under the cut. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Immediately it is worth making a reservation that the very existence of the problem is not that far-fetched, but, let's say, easily walked in two completely standard ways: <br>  - no need to stand, email can be transferred to the model; <br>  - no need to emit, email can be passed as a parameter to the query string. <br><br>  On the other hand, when e-mail is precisely that identifier, it seems to be more logical and ideologically to place it on a path, and not in a model or attribute.  However, I am sure you can argue and debate on this topic for a long time, we are faced with a very specific problem: the presence of a dot in the email leads to the 404th error.  The root cause, I think, is completely transparent: the web server is trying to search for a file (the exact same point), but of course there is no such file. <br><br>  How can this be dealt with?  There are many ways, they are all different, probably not even all possible ones will appear below (I hope, comments to help us). <br><br>  <b>Method 1.</b> <br><br>  Slash  If we add it to the end of the path after our {id} parameter, everything will suddenly work.  This is because this segment will be understood not as a file name, but as a folder name.  The solution is very simple, but not very, you see, beautiful, because you have to inform the service consumer that it is necessary to put a slash at the end for this method, but not for others at all (yes, nobody usually puts them).  Here it is worth mentioning another interesting point related to folders and points.  If we put a dot at the end of the segment right before the slash, we also get 404. They can‚Äôt say that folder names in post-MSDOS systems (and their legs grow from there) end in a full stop.  For the same reason, the following literals are used in the path of nonella: COM1-9, LPT1-9, AUX, PRT, NUL, CON.  There is, of course, a way to get around this, in particular by using the attribute <br><br><pre><code class="cs hljs">&lt;httpRuntime relaxedUrlToFileSystemMapping=<span class="hljs-string"><span class="hljs-string">"true"</span></span> /&gt;</code> </pre> <br>  <b>Method 2</b> <br><br>  In the system.webServer section of the configuration file, we write <br><br><pre> <code class="cs hljs">&lt;modules runAllManagedModulesForAllRequests=<span class="hljs-string"><span class="hljs-string">"true"</span></span> /&gt;</code> </pre><br>  and voila, everything works.  The bad way is very bad, although many people recommend it right away.  Sometime without this option, it was really just impossible to do, but by and large it means that instead of native modules to get static content, such as images, CSS, scripts, etc., each request will pass through the entire set of managed modules your application, which is fraught with significant performance losses, at a minimum.  That is why such a solution is a kind of such ‚Äúbrute force‚Äù. <br><br>  <b>Method 3.</b> <br><br>  We can achieve the desired effect with the following setting in the same configuration file: <br><br><pre> <code class="cs hljs">&lt;modules&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">remove</span></span> name=<span class="hljs-string"><span class="hljs-string">"UrlRoutingModule-4.0"</span></span> /&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">add</span></span> name=<span class="hljs-string"><span class="hljs-string">"UrlRoutingModule-4.0"</span></span> type=<span class="hljs-string"><span class="hljs-string">"System.Web.Routing.UrlRoutingModule"</span></span> preCondition=<span class="hljs-string"><span class="hljs-string">""</span></span> /&gt; &lt;/modules&gt;</code> </pre><br>  The point here is that we clear the preCondition attribute of the UrlRoutingModule, thus allowing this managed module to handle all incoming requests.  The method is very similar to the previous one with the only difference that there every request was processed by <i>all</i> control modules, and here only one.  Horseradish, in general, radish is not sweeter. <br><br>  <b>Method 4.</b> <br><br>  Back in 2010, Microsoft released a patch for IIS 7.0 and 7.5, which allowed handlers with the path attribute = "*."  understand not only the path ending point, but the path without it.  So the era of the so-called.  extensionless URLs, and our way number two is no longer relevant.  The patch description, by the way, can be found <a href="http://support.microsoft.com/en-us/kb/980368">here</a> .  Now, in your web.config, you can easily find a similar entry in the handlers section: <br><br><pre> <code class="cs hljs">&lt;<span class="hljs-keyword"><span class="hljs-keyword">remove</span></span> name=<span class="hljs-string"><span class="hljs-string">"ExtensionlessUrlHandler-Integrated-4.0"</span></span> /&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">add</span></span> name=<span class="hljs-string"><span class="hljs-string">"ExtensionlessUrlHandler-Integrated-4.0"</span></span> path=<span class="hljs-string"><span class="hljs-string">"*."</span></span> verb=<span class="hljs-string"><span class="hljs-string">"*"</span></span> type=<span class="hljs-string"><span class="hljs-string">"System.Web.Handlers.TransferRequestHandler"</span></span> preCondition=<span class="hljs-string"><span class="hljs-string">"integratedMode,runtimeVersionv4.0"</span></span> /&gt;</code> </pre><br>  How does this solve our problem?  Yes, in general, nothing.  Unless we change the value of the path attribute to a lonely asterisk.  It is also a kind of way out, and our email will even work, though we will not get a single file with the extension, because  we will get a fair 500th error from the same handler. <br><br>  The question arises: so what to do?  The answer to it alone may not be.  The best solution in my highly personal opinion here is to use the latter method, but only partially.  Let's say if we know that all the paths to methods (and only methods, not static resources!) APIs start with the corresponding prefix (‚Äúapi / {controller} / {id}‚Äù), then we can add another handler of the same Type for addresses like "api / *": <br><br><pre> <code class="cs hljs">&lt;<span class="hljs-keyword"><span class="hljs-keyword">remove</span></span> name=<span class="hljs-string"><span class="hljs-string">"ExtensionlessUrlHandler-Integrated-4.0"</span></span> /&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">add</span></span> name=<span class="hljs-string"><span class="hljs-string">"API-ExtensionlessUrlHandler-Integrated-4.0"</span></span> path=<span class="hljs-string"><span class="hljs-string">"api/*"</span></span> verb=<span class="hljs-string"><span class="hljs-string">"*"</span></span> type=<span class="hljs-string"><span class="hljs-string">"System.Web.Handlers.TransferRequestHandler"</span></span> preCondition=<span class="hljs-string"><span class="hljs-string">"integratedMode,runtimeVersionv4.0"</span></span> /&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">add</span></span> name=<span class="hljs-string"><span class="hljs-string">"ExtensionlessUrlHandler-Integrated-4.0"</span></span> path=<span class="hljs-string"><span class="hljs-string">"*."</span></span> verb=<span class="hljs-string"><span class="hljs-string">"*"</span></span> type=<span class="hljs-string"><span class="hljs-string">"System.Web.Handlers.TransferRequestHandler"</span></span> preCondition=<span class="hljs-string"><span class="hljs-string">"integratedMode,runtimeVersionv4.0"</span></span> /&gt;</code> </pre><br>  Thus, we, as they say, separate flies from cutlets at the API design level. <br><br>  PS If anyone has other ways of solving this problem, as well as additional information and explanations, then the comments on their own and not only their own clever ideas are welcome in every way.  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/254525/">https://habr.com/ru/post/254525/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../254507/index.html">Creating a universal web application site Habrahabr.ru using the Web App Template</a></li>
<li><a href="../254509/index.html">Unit testing of Yii2 behavior with Codeception</a></li>
<li><a href="../254513/index.html">Homemade do-it-yourself microcontroller</a></li>
<li><a href="../254521/index.html">Interesting and utility will no longer be</a></li>
<li><a href="../254523/index.html">Designer interactive exercises for online learning</a></li>
<li><a href="../254527/index.html">Android - Custom View or ToggleButton 4x4</a></li>
<li><a href="../254529/index.html">Comparison of online consultants for the site: flour choice</a></li>
<li><a href="../254531/index.html">Programming Philosophy 6 - Product and Project</a></li>
<li><a href="../254533/index.html">Tarantool 1.6 - let's get started</a></li>
<li><a href="../254537/index.html">Document generator docx and xlsx</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>