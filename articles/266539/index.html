<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Indoor navigation - from idea to working prototype</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The developers of the internal practice of DataArt "Travel and Hotel Business" represent the internal positioning system and tell us how it is interes...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Indoor navigation - from idea to working prototype</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/382/c9a/1dc/382c9a1dc1154547981922b84d89b702.png"></div><br>  <i>The developers of the internal practice of DataArt "Travel and Hotel Business" represent the internal positioning system and tell us how it is interesting for the industry.</i> <br><br><h6>  <b>What is an indoor positioning system?</b> </h6><br>  Based on a Wikipedia article, this is a solution for finding objects and people inside a building using radio waves, magnetic fields, acoustic signals, or other sensory information collected using mobile devices.  Simply put, using this system, you can determine your location in a large building, using only a special application on your smartphone.  For people who do not work in the technical field, it sounds like magic;  for those who are lost in airports, shopping centers and other buildings - as a panacea;  for developers of hardware and software - as a serious challenge. <br><a name="habracut"></a><br><h6>  <b>Why not use GPS?</b> </h6><br>  Significant disadvantages of GPS are its dependence on signal stability and multipath propagation leading to fatal errors.  Of course, you can use GPS repeaters, but this is not a cheap pleasure.  Therefore, the positioning system in the interior is an extremely profitable alternative. <br><br><h6>  <b>Why do we do this</b> </h6><br>  First, this is a new global trend, and no one has yet offered a cheap and easy-to-use product that would meet the requirements of the trend.  Therefore, development is a great opportunity to test the strength in this segment. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Secondly, we received several requests from companies that need solutions for internal navigation. <br><br>  Thirdly, it is important and interesting for ourselves.  Personally, even after five years spent on higher education and a degree, it is interesting for me to discover something new and solve complex mathematical and technical problems. <br><br><h6>  <b>Necessary equipment</b> </h6><br><ul><li>  iPhone with iOS 8.0 or higher.  It is desirable that a motion processor (M7 / M8) be installed in the device. </li><li>  BLE beacons.  This is probably the cheapest option for a Bluetooth connection with a capacious battery, an average work radius (15 - 30 meters) and support for the UDID / Major / Minor configuration. </li></ul><br><br><h6>  <b>Modern approaches to solving problems</b> </h6><br><ul><li>  Triangulation and trilateration are two mathematical approaches that rely on the angle and distance scales, respectively.  They have similar principles - searching for the locus of intersection points, good performance in a laboratory environment (low noise, limit of visibility of beacons, etc.) and average or unsatisfactory results when working in a living environment due to several intersections or their absence. </li><li>  Mesh - beacons are arranged on a mesh pattern.  At any time, your device will be in view of a limited number of beacons, allowing you to roughly determine your location. </li><li>  Advanced filtering approaches (particle filters and Kalman filters) - use probability theory and complex mathematical models to reduce the effect of noise and adjust filter coefficients when changing location, signal power, etc. </li><li>  Hybrid systems - combine two or more of the approaches described above to minimize errors in positioning, or to switch between approaches depending on external conditions. </li></ul><br><br><h6>  <b>Main problems</b> </h6><br>  Multipath and attenuation.  Indoor navigation systems based on BLE all rely on electromagnetic waves.  This can lead either to incorrect readings from beacons that are far away from the user, or to: <br><ol><li>  Disappearing beacons.  Sometimes CoreLocation shows that the range of the beacon is unknown, although a second ago it was listed as the closest. </li><li>  Intervals in measurement.  Unfortunately, it is impossible to change the intervals of measurement and delivery of information, which are registered within CoreLocation (updates go every second). </li><li>  Mapping engine.  All of the above things do not matter if you do not have a working map with metadata.  The map is the heart of the navigation application, and the navigation and navigation engines are the brain. </li></ol><br><br><h6>  <b>Some technical details of the current implementation</b> </h6><br>  The first problem we encountered is directly related to the map.  "What is the problem?  - you ask.  - MapKit allows you to use custom items.  If that doesn't help, use OSM and MapBox. ‚Äù  Yes, this is true, but if you use MapKit, you end up with a lot of obstacles: <br><br><ul><li>  Elements must be aligned and adjusted in size in accordance with the existing grid of the created map. </li><li>  The plan of the building is made in the plane, the maps use the Mercator projection. </li></ul><br><br>  That's why we decided to stick with the CATiledLayer based approach: the map is an image made up of small tiles, and the image has several levels of detail. <br><br>  The second (and main) problem was, of course, the search for the current location.  We tested both trilateration and triangulation in two-dimensional space, but the results were significantly affected by the absence of Z-coordinates.  After switching to 3D (each lighthouse has Vx, Vy, Vz coordinates), things went better, but not as much as expected. <br><br>  After several brainstorming sessions, it was decided to use the normal distribution to simulate the height of the device and switch to the principle of Center of Force.  In each iteration, the device calculates the influence vectors of each beacon on the coordinate and applies them to the current position, thus correcting errors.  The direct distance to the beacons is calculated using their RSSI values.  The only problem in this case is related to the fact that such calculations lack accuracy at small RSSI values ‚Äã‚Äãdue to signal attenuation.  This can lead to significant calculation errors. <br><br><h6>  <b>Perspectives</b> </h6><br><br>  Despite the fact that the prototype allows to achieve very good results (an approximate error is three meters, which, in general, is enough for airports and shopping centers), we see a lot of things that can be added or improved.  Here are some: <br><ul><li>  Motion detection for the implementation of adaptive filtering, which allows you to make changes to the filtering algorithm on the fly or adjust its coefficients. </li><li>  A more sophisticated solution to the problem of ‚Äúdisappearing beacons‚Äù is the introduction of a level of trust in the indications of the beacon and its threshold value in order to rely on the ‚Äútrusted‚Äù beacons in each iteration. </li><li>  A more sophisticated "geometric filter" for driving direction and determining turns. </li><li>  Metadata - a schedule of routes and waypoints ("intersections", POI, etc.). </li><li>  The option ‚ÄúBind current position to grid‚Äù, as is done in real maps and navigation applications. </li><li>  Routing algorithm for finding the (shortest) path. </li></ul><br><br><div class="spoiler">  <b class="spoiler_title">Few screenshots</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/files/59d/a08/536/59da08536a85459484bec20d619e440c.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/2f0/fd0/002/2f0fd0002a7d4a8996dadf26b7bf6554.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/7fc/518/fd3/7fc518fd379a4778b812455cdd900e03.png"></div><br></div></div><br><br>  Author: Yaroslav Vorontsov, Senior iOS Developer. </div><p>Source: <a href="https://habr.com/ru/post/266539/">https://habr.com/ru/post/266539/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../266521/index.html">Release Phalcon 2.1.0 beta 1</a></li>
<li><a href="../266527/index.html">One customer, two premises, four providers and eight connections</a></li>
<li><a href="../266529/index.html">Zigbee for the little ones. Post number 1</a></li>
<li><a href="../266533/index.html">A variety of network security tests: a review of IXIA solutions</a></li>
<li><a href="../266537/index.html">How to stop freezing in the data center?</a></li>
<li><a href="../266541/index.html">As one of the operators increased the capacity of 3G in a densely populated district of Minsk, not forgetting about the coming on the heels of LTE</a></li>
<li><a href="../266545/index.html">Installation programs - how much do they influence the product or company image?</a></li>
<li><a href="../266547/index.html">JetBrains IDE is now only available for rent.</a></li>
<li><a href="../266549/index.html">Healthcare IT: or how to throw out $ 34 million</a></li>
<li><a href="../266551/index.html">Recognize cannot be left a picture, or something about difficult cases of optical character recognition</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>