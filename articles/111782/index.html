<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we did the guitar tuner</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this post we will talk about creating our free Guitar Tuner app for Android. 



 At the very beginning, at the stage of the emergence of an idea, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we did the guitar tuner</h1><div class="post__text post__text-html js-mediator-article">  In this post we will talk about creating <a href="http://www.e-legion.com/">our</a> free <b>Guitar Tuner</b> app for Android. <br><br><img src="http://img811.imageshack.us/img811/6268/34160617.png" alt="image"><br><br>  At the very beginning, at the stage of the emergence of an idea, I wanted to make a universal tuner: the phone hears a sound, determines the note, shows it.  In theory, this is realized quite simply: sound is an oscillation, oscillation has a frequency, oscillation frequency is a note. <br><a name="habracut"></a><br>  There is such a wonderful thing in mathematics as the Fourier transform.  This conversion gives the frequency spectrum of the analog signal.  That is, any signal can be represented as the sum of sinusoidal curves of different frequencies and different amplitudes. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="http://img703.imageshack.us/img703/1331/75262833.png" alt="image"><br><br>  Thus, if the signal itself is a sinusoid, then in the frequency decomposition it will have only one member, that is, there will be one frequency in the signal.  If the signal is complex, then the spectrum is complex. <br><img src="https://habrastorage.org/getpro/habr/post_images/330/ed7/08a/330ed708a1aa493498f25de98a59cf09.gif" alt="tumblr statistics"><br><br>  Musical instruments play a certain note and at the same time a multitude of overtones (overtones), which means that the spectrum has a complex structure, but the played note (frequency) in the spectrum has the greatest amplitude.  As a rule, there is also a certain number of harmonics in the signal, that is, frequencies that are multiples of the fundamental (doubled, tripled, etc.). <br><br><img src="http://img291.imageshack.us/img291/4456/81141505.png" alt="image"><br><br>  Thus, to determine the note sounding on the guitar, it is necessary to remove the audio stream from the microphone of the phone, take the Fourier transform from it, find the frequency with the highest amplitude, and match the frequency and the note. <br><br><h4>  Problems </h4><br>  At each stage we were in trouble.  In addition to the latter, of course, where the correspondence tables are known, and easily computable from the known frequency of 440 Hz for the note A of the 1st octave, as well as the known relation between the frequencies of one note of the neighboring octaves (2 times) and the known number of notes in the octave. <br><br>  First, in those old times of the first version of <b>Android OS</b> , there was no open Java API for working with sound stream from a microphone.  There was an API for playing the sound, but not for reading the stream from the microphone.  However, there was a Native-code Speech Recongnition system, which worked with a removable audio stream.  As a result, as a hack, a wrapper was written to work with these Native streams.  As it turned out, this responded to very sad results.  But more about that later. <br><br>  The next step was to obtain the Fourier transform of the signal.  Naturally, the Fast Fourier Transform (FFT) algorithm was used.  We immediately thought that this, as the most computationally difficult task, would be the bottleneck in the performance of the tuner.  The natural solution would be to write this part in C, not in Java, but we decided to compare both solutions.  Having implemented the <a href="http://en.wikipedia.org/wiki/Cooley%25E2%2580%2593Tukey_FFT_algorithm">Cooley ‚Äì Tukey</a> version of the FFT algorithm in Java and C, we held a small benchmark and saw that the time difference was almost two orders of magnitude!  Who won, obviously.  However, we managed to improve the results of the Java version by almost an order of magnitude, replacing working with complex numbers as with Complex objects with simple pairs of numbers.  As a result, the result of the Java-version was quite fast, and we decided to use it in order to avoid the use of excess native-code (in general, less portable). <br><br>  Then the most interesting problems began.  Looking at the spectral images, we did not see what we expected.  Instead of a large amplitude of the fundamental frequency and much smaller amplitudes of multiple harmonics, we saw a barely noticeable fundamental frequency and amplitudes of the harmonics obeying incomprehensible laws.  After long attempts to understand the dependencies that came before us, in the end we blamed everything on <a href="http://en.wikipedia.org/wiki/Voice_to_text">Speech Recongnition</a> .  Like, it is he who identifies those frequencies that prevail in human speech. <br><br><h4>  Solutions </h4><br>  Since we didn‚Äôt have an alternative source for reading the stream at that time, it was necessary to get out somehow.  We had to abandon the initial goal of making a universal tuner, and instead make a tuner for pre-beat instruments: six- and seven-string guitars, four-, five-, six-string bass guitars and others.  In other words, the user of the tuner, before making a sound on the instrument, chooses the string that he wants to tune himself, and then only plays.  Thus, we already know the reference frequency that should ideally be obtained.  And knowing from the spectral picture of the signal one of the harmonics of the desired note, we can (by division) know the deviation of the actual fundamental frequency from the reference frequency.  In other words, the frequency with the maximum amplitude in a ‚Äúcorrupted‚Äù speech is, with a recognizer, an integer divided by the desired frequency, the harmonic number is obtained.  Further, by division, the main frequency of the sounding note is actually calculated, the difference between the desired and sounding frequencies is calculated, normalized to the length of the displayed scale, displayed to the user. <br><br>  Later, an API appeared to work with audio stream from a microphone, and the tuner was redone using it, but there is no support for it at the moment. <br>  resources, so it is not in perfect condition.  Despite this, it is actively used by more than 50,000 Android users. <br><br>  Such is the instructive story.  I hope the information received will be useful to you in the future.  I am pleased to answer all questions. </div><p>Source: <a href="https://habr.com/ru/post/111782/">https://habr.com/ru/post/111782/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../111775/index.html">Cords, adapters and cables</a></li>
<li><a href="../111776/index.html">Expand your team or outsource a project</a></li>
<li><a href="../111778/index.html">FOSS Lviv 2011 and Dragobrat Winter FOSS Fest 2011</a></li>
<li><a href="../111779/index.html">My new project - Rollergrad.ru</a></li>
<li><a href="../111781/index.html">Class-level instance variables</a></li>
<li><a href="../111786/index.html">WP7 ported to HD2</a></li>
<li><a href="../111787/index.html">Japan will build the largest wind power plant</a></li>
<li><a href="../111790/index.html">Multiply-connected network synthesis algorithm</a></li>
<li><a href="../111791/index.html">Chrome extension for memorizing foreign words</a></li>
<li><a href="../111792/index.html">Unveiled the look of a Universal Electronic Card</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>