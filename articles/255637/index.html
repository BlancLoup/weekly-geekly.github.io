<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Is there a USB in this MK?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not all yogurts are equally beneficial. 
 Until wireless technologies finally won, USB (U) became (or is about to become) the most frequently used int...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Is there a USB in this MK?</h1><div class="post__text post__text-html js-mediator-article"><h5>  Not all yogurts are equally beneficial. </h5><br>  Until wireless technologies finally won, USB (U) became (or is about to become) the most frequently used interface in microcontroller devices (MK) and surely occupies the niche of a standard communication device, displacing the UART.  Let's not forget that at the moment in the most well-known and widespread series of motherboards based on the MC - Arduino - even the UART itself is implemented through a converter from the U interface, and in some advanced versions the converter is implemented on the MC itself.  So, the presence of a U module in an MK becomes one of the criteria for choosing a specific device from a variety of options.  Unfortunately, it is impossible to just look at the table in the documentation and make sure that there is a plus in the corresponding row.  Consider some features of the interface in terms of functionality. <br><a name="habracut"></a><br>  First of all, Yu has three options for execution of 1, 2 and (who would have thought) 3, as well as version versions. <br>  Option 1 supports low speed (LS = 1.5 MB) and full speed (FS = 12 MB), and low speed can be implemented in hardware on any MC with 2 digital ports, a clock frequency of 10 MHz and one interrupt of these legs (the latter requirement can be removed under certain restrictions on the application program).  The topic is more than a tattered one and is mentioned only in order to emphasize the author's erudition.  Therefore, it can be said with confidence that almost every MC has onboard U of the first version in LS mode and the topic is closed (there is one feature, but about it later). <br><br>  Option 2 also supports high speed (HS = 480 MB), but the implementation of such devices in the MC is still not very common, especially in terms of the physical (PHY) interface, so it is not relevant yet and will not be discussed further (please disagree with the comments) .  So we can focus on the features of the FS mode. <br><br>  I don‚Äôt see much point in considering option 3, since it is not intended for the MK, the performance requirements are too high, and its hardware features are still hidden in the external transceiver (which is also true for most HS implementations). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, what pitfalls can be hidden in the MC, for which we are sure that it has PHY USB FS Device, as it is written in the documentation, which (stones) can become an obstacle in the implementation of the requirements for our device. <br><br>  First of all, these are termination resistors (here it is a feature).  As is known, the presence of a resistor on one of the data lines is a sign of the speeds supported by the device, but at the same time a sign of connecting the device to the bus.  Therefore, if the selected MK has no internal termination resistors (in modern MKs it is unlikely, but this has happened before, especially when implementing LS devices on ports), you will not be able to initialize the process of re-connecting the device by disconnecting the resistor from the data line.  Of course, such an opportunity may not be necessary, but it should be remembered. <br><br>  The requirements of compliance with the standards will be considered fulfilled if there is an U icon for the concern on the device, although I personally would not have hoped for it.  There was a very specific situation when the analyzer reported on single packets in the middle of the line, although the device functioned normally and the matter was clearly in the inconsistency of the levels.  Well, this parameter cannot be influenced in any way, because nobody writes in the documentation about partial compliance with the standard. <br><br>  And now really interesting things begin, which we can read in the documentation.  First of all, this is the number of end points (OT), since it is this parameter that directly determines the implemented functionality.  Well, first of all, without zero OT, the device will not work at all, so its presence is not discussed.  I did not find an indication that the zero OT can be used for any other purposes, except for configuring the device when it is turned on, if anyone has other information, share it. <br>  Therefore, we need exactly more than one OT, the nearest integer 2, but still they are made at least 4. Why - because the simplest devices use one OT to control, and the second (and third) to transmit data, that's just 4 and it turned out.  This amount is quite enough for the implementation of almost any U device, but only until you need to create a combination device.  This is where the ambush exists - unfortunately, it is impossible to use one OT for the implementation of various functions. <br>  Here you can create a combined HID device as you like, all reports can be sent to the host one by one from OT, and one by one from the transfer of reports and data from the mass memory is no longer possible.  Therefore, the number of OTs (and this parameter is determined by the hardware and cannot be increased programmatically, although there are options) is a serious limitation in the design of combined devices. <br><br>  The next important detail is the OT parameters, namely the size of the buffer for the data, the possibility of coupling the buffers, and the ability to work on receiving and transmitting simultaneously.  Let's start with the last - for full duplex transmission one by one, you need to have separate readiness flags for reading and writing (in principle this requirement can be bypassed programmatically with certain host requirements) and separate receive and transmission buffers (and there‚Äôs nothing to do they are really needed).  If such requirements in this MK are met, then the number of OTs doubles, as it were, and this facilitates the construction of combined devices. <br><br>  The next important parameter is the size of the OT memory buffer, since the maximum data packet size directly depends on it.  Again, this parameter is not so important for HID devices, but for data transmission devices it can limit the bandwidth in a very significant way.  The presence of more than one buffer for one direction of transmission of one OT to organize the switching of buffers is directly related to bandwidth.  An important parameter to ensure maximum throughput is the ability of the Yu controller to work with the PDU MK mechanism. <br><br>  As you can see, the above requirements for the implementation of Yu in the MC are reduced to two groups - speed and functionality.  And if nothing can be done with speed, and it is tightly limited by hardware capabilities (another question is that inaccurate writing of the driver can limit these possibilities even more - see specific implementations), then from the point of view of the functional there is one absolutely charming trick that allows making devices of unlimited functionality . <br>  This trick is to implement a pseudo-hub, since in this case you can imagine a combination device as a set of devices connected to the hub and thereby remove all restrictions on the number and type of OT.  Of course, this will require careful programming and does not represent a trivial task, but, nevertheless, it is completely realizable.  However, for this option there is a categorical requirement for the U interface - the ability to receive packets with any address, that is, the ability to disable the address filter, which is not realized in every MC. <br><br>  I summarize all of the above, you can say that if you plan to create a relatively simple U device (HID), then the plus in the description of the MC in the corresponding line is enough, but if you plan a combined heterogeneous device, or a device with intensive data transmission, you should be very careful read the specification of the UU controller selectable MK to avoid unpleasant disappointments. <br><br>  As the reader probably understands, this post is the result of walking on a rake, so a small practical recommendation, created as a result of a very specific project - the use of Milander‚Äôs MK to implement the devices described in the previous paragraph cannot be recommended.  The MKs themselves are not bad at all, but here‚Äôs the U interface implemented in them with very limited capabilities.  But the STM-ny MK with this task completely coped, it is felt that the experience of the developers of the U interface at this company is very large (or maybe a good license is purchased). </div><p>Source: <a href="https://habr.com/ru/post/255637/">https://habr.com/ru/post/255637/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../255625/index.html">Features of creating programs in NODEMCU ESP8266 for the ‚ÄúInternet of Things‚Äù</a></li>
<li><a href="../255627/index.html">Building signs and comparing images: global signs. Lectures from Yandex</a></li>
<li><a href="../255629/index.html">Reports and competitions for NeoQUEST-2015</a></li>
<li><a href="../255631/index.html">"Operator Overloading" in Scala</a></li>
<li><a href="../255633/index.html">Nakapcha Mail.Ru - captcha, which is not shown</a></li>
<li><a href="../255643/index.html">Online streaming. Monitoring: from server to application. System Center Operations Manager 2012 R2</a></li>
<li><a href="../255645/index.html">Again about AUTO_INCREMENT</a></li>
<li><a href="../255647/index.html">Levitron on Arduino</a></li>
<li><a href="../255649/index.html">Best approaches to moving a MATLAB code to a fixed point</a></li>
<li><a href="../255651/index.html">Create a beautiful date / time / data picker in android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>