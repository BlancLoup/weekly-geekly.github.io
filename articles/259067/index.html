<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple Web Service with Jetty Embedded</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The development of information technology is increasingly involving the use of the Internet infrastructure. Distributed and mobile applications are in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple Web Service with Jetty Embedded</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img width="300" src="https://habrastorage.org/files/6ac/463/83c/6ac46383ca0b4107a564834ab9f28d78.png"></div><br><br>  The development of information technology is increasingly involving the use of the Internet infrastructure.  Distributed and mobile applications are increasingly using HTTP communications.  At the same time, the Client-Server architecture remains the most common and easiest to master, build and operate.  The principle of the Client-Server architecture is simple - the server provides the resource, and the client uses this resource. <br><br>  This article is an attempt to provide a clear description of creating a simple web service.  A simple, practical and detailed example often brings more value to the study of technology than a diligent reading of literature.  The article discusses creating a simple calculator based web service based on REST, JSON using Eclipse and the built-in Jetty server. <br><a name="habracut"></a><br><h2>  Task </h2><br>  Consider creating a calculator as a web service that implements simple arithmetic with two numbers.  A web service can be treated in the same way as a remote function that accepts input parameters and produces a result.  Therefore, its functionality can be described as follows: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Input parameters: <br><ul><li>  <b>a</b> is the first argument; </li><li>  <b>b</b> is the second argument; </li><li>  <b>op</b> is an arithmetic operator expressed by one of the signs +, -, /, *. </li></ul><br>  Output Parameters: <br><ul><li>  <b>error</b> - the first argument; </li><li>  <b>result</b> is the second argument; </li></ul><br><h3>  Sample request / response - amount </h3><br>  Request: <a href="http://localhost:8080/func%3Fa%3D8.78%26b%3D4.15%26op%3D%2B">http: // localhost: 8080 / func? A = 8.78 &amp; b = 4.15 &amp; op = +</a> <br><br>  Answer: <br><br><pre><code class="java hljs">{ ‚Äúerror‚Äù:<span class="hljs-number"><span class="hljs-number">0</span></span>, ‚Äúresult‚Äù:<span class="hljs-number"><span class="hljs-number">12.93</span></span> }</code> </pre> <br><h3>  Sample request / response - the difference </h3><br>  Request: <a href="http://localhost:8080/func%3Fa%3D8.78%26b%3D4.15%26op%3D-">http: // localhost: 8080 / func? A = 8.78 &amp; b = 4.15 &amp; op = -</a> <br><br>  Answer: <br><br><pre> <code class="java hljs">{ ‚Äúerror‚Äù:<span class="hljs-number"><span class="hljs-number">0</span></span>, ‚Äúresult‚Äù:<span class="hljs-number"><span class="hljs-number">4.63</span></span> }</code> </pre><br><h3>  Sample request / response - product </h3><br>  Request: <a href="http://localhost:8080/func%3Fa%3D8.78%26b%3D4.15%26op%3D-">http: // localhost: 8080 / func? A = 8.78 &amp; b = 4.15 &amp; op = *</a> <br><br>  Answer: <br><br><pre> <code class="java hljs">{ ‚Äúerror‚Äù:<span class="hljs-number"><span class="hljs-number">0</span></span>, ‚Äúresult‚Äù:<span class="hljs-number"><span class="hljs-number">36.437</span></span> }</code> </pre><br><h3>  Sample request / response - private </h3><br>  Request: <a href="http://localhost:8080/func%3Fa%3D8.78%26b%3D4.15%26op%3D-">http: // localhost: 8080 / func? A = 8.78 &amp; b = 4.15 &amp; op = /</a> <br><br>  Answer: <br><br><pre> <code class="java hljs">{ ‚Äúerror‚Äù:<span class="hljs-number"><span class="hljs-number">0</span></span>, ‚Äúresult‚Äù:<span class="hljs-number"><span class="hljs-number">2.1156626506</span></span> }</code> </pre><br><h3>  Sample request / response - error "division by 0" </h3><br>  Request: <a href="http://localhost:8080/func%3Fa%3D8.78%26b%3D4.15%26op%3D-">http: // localhost: 8080 / func? A = 8.78 &amp; b = 0 &amp; op = /</a> <br><br>  Answer: <br><br><pre> <code class="java hljs">{ ‚Äúerror‚Äù:<span class="hljs-number"><span class="hljs-number">1</span></span> }</code> </pre><br><h3>  Sample request / response - error "invalid number format" </h3><br>  Request: <a href="http://localhost:8080/func%3Fa%3D8.78%26b%3D4.15%26op%3D-">http: // localhost: 8080 / func? A = 8.78 &amp; b = 4.15m &amp; op = /</a> <br><br>  Answer: <br><br><pre> <code class="java hljs">{ ‚Äúerror‚Äù:<span class="hljs-number"><span class="hljs-number">1</span></span> }</code> </pre><br><h2>  Installing Jetty Libraries </h2><br>  Jetty is very convenient for creating web applications.  Using it as an embedded server frees the developer from deploying a web application to an external server each time it is launched.  It also does not require the installation of an external application server. <br><br>  For most cases, it is enough to load the server libraries, register them in Eclipse as a user library, and then use the link to this library.  This approach is simple for novice Java programmers because it does not require the presence and skills of assembly automation tools, such as Maven or Gradle. <br><br>  You can install the necessary Jetty libraries in Eclipse as follows: <br><br>  1. Download the compressed file at <a href="http://download.eclipse.org/jetty/">http://download.eclipse.org/jetty/</a> and unpack it; <br><br>  2. In the root project folder (usually Workspace), create a jars folder, and in it the jetty folder; <br><br>  3. Copy the contents of the lib folder from the previously unpacked file into the created jetty folder; <br><br>  4. In the <b>Window / Preferences</b> menu, select the <b>Java / Build Path / User Libraries</b> section. <br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/files/a4d/f10/750/a4df10750b154328a52033b68f0967f3.png"></div><br><br>  5. Click the <b>New ...</b> button, enter the name of the <b>jetty</b> library and click the OK button. <br><br><div style="text-align:center;"><img width="200" src="https://habrastorage.org/files/a36/e71/f1b/a36e71f1bf724e219e6a8982063415d7.png"></div><br><br>  6. Next, with the jetty library just selected in the <b>Preferences</b> window, click the <b>Add External JARs ...</b> button.  In the <b>JAR Selection</b> window, select all the JAR files from the previously created jars / jetty folder. <br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/files/baf/938/0ae/baf9380aee4d4839b01e65d7bb30bd4f.png"></div><br><br>  7. As a result, the JAR files will be loaded into the custom jetty library.  Although files in sub-folders will not be uploaded, for most cases they are not necessary. <br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/files/2b0/5ce/e6d/2b05cee6d2464716be5471036539114c.png"></div><br><br><h2>  Creating a web server project </h2><br>  In the <b>File / New</b> menu, select <b>Dynamic Web Project</b> .  In the <b>Project</b> name field <b>,</b> enter the SCalculator.  Click the <b>Finish</b> button. <br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/files/3d1/59b/52a/3d159b52ab904d27b7f30c445753188d.png"></div><br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/files/79c/0a6/671/79c0a66714104a84871eb60499e412db.png"></div><br><br><h2>  Adding a link to the jetty library </h2><br>  Immediately after creating the project does not contain a link to the jetty library.  Connected libraries can be viewed in the <b>Project Explorer</b> in the <b>Java Resources</b> tab, in the <b>Libraries</b> sub-tab. <br><br><div style="text-align:center;"><img width="200" src="https://habrastorage.org/files/d87/da9/23a/d87da923a20443c381e2a220c5935731.png"></div><br><br>  Right-click on the project label and select <b>Build Path</b> in the context menu and then <b>Configure Build Path ....</b>  In the <b>Java Build Path</b> tab of the <b>Libraries</b> page, click the <b>Add Library ...</b> button. <br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/files/968/882/4ea/9688824ea68c470da206fd2145cc58ed.png"></div><br><br>  Select <b>User Library</b> and click <b>Next</b> .  Select jetty and click <b>Finish</b> . <br><br><div style="text-align:center;"><img width="350" src="https://habrastorage.org/files/09e/646/a0e/09e646a0eeff4e80a15524271abe7ee4.png"></div><br><br><div style="text-align:center;"><img width="350" src="https://habrastorage.org/files/618/9a0/153/6189a0153dce4fdfa632c78180214329.png"></div><br><br>  As a result, after confirming the inclusion of the custom jetty library, the presence of a link to it can be seen in the <b>Project Explorer</b> . <br><br><div style="text-align:center;"><img width="200" src="https://habrastorage.org/files/1ef/b8b/310/1efb8b310d204de69c23893da29a446f.png"></div><br><br><h2>  Creating a calculator servlet </h2><br><h3>  Creating a servlet file </h3><br>  The calculator servlet will contain all the code for decoding input data, calculating, and generating a response.  To create a servlet, right-click on the project name in the <b>Project Explorer</b> panel, select <b>New</b> in the context menu, and then <b>Servlet</b> .  In the class name we enter SrvltCalculator and click the <b>Finish</b> button. <br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/files/af4/70c/f5e/af470cf5ed8245018d3861fdb8ea6f6c.png"></div><br><br>  In the <b>Project Explorer</b> panel you can see the generated file SrvltCalculator.java.  Its contents automatically open in the editor. <br><br><h3>  Removing excess code </h3><br>  To simplify further editing of files, remove the unused servlet constructor SrvltCalculator and the doPost method. <br><br><h3>  Add imported modules </h3><br>  The code to be added to the servlet file will require the addition of the following lines of code for the inclusion of modules.  Add these lines. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.IOException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.UnsupportedEncodingException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.servlet.ServletException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.servlet.annotation.WebServlet; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.servlet.http.HttpServlet; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.servlet.http.HttpServletRequest; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.servlet.http.HttpServletResponse;</code> </pre><br><h3>  Adding code to the doGet method </h3><br>  The doGet method contains the code for processing GET requests.  In this method, add the following code snippets sequentially. <br><br>  Reception of parameters in the corresponding string variables. <br><br><pre> <code class="java hljs">String str_a = request.getParameter(<span class="hljs-string"><span class="hljs-string">"a"</span></span>); String str_b = request.getParameter(<span class="hljs-string"><span class="hljs-string">"b"</span></span>); String str_op = request.getParameter(<span class="hljs-string"><span class="hljs-string">"op"</span></span>);</code> </pre><br>  Declaring variables for accepting numeric parameters a and b decoded from string variables. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">double</span></span> value_a = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> value_b = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre><br>  Declare a noError error control variable. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> noError = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>;</code> </pre><br>  An attempt to decode the numeric parameters a and b from the corresponding string variables.  If a decoding error occurs, the noError variable is set to false. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { value_a = Double.parseDouble(str_a); value_b = Double.parseDouble(str_b); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> ( Exception ex ) { noError = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; }</code> </pre><br>  Opening of the code section for the case if the error did not occur during decoding of numeric parameters. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( noError ) {</code> </pre><br>  Declaring a numeric result variable to store the result. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">double</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre><br>  Open the try section to enable the calculation code and error control.  The section is necessary, since during arithmetic operations a floating-point error may occur. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {</code> </pre><br>  For the case of the operation of addition, we call the function functionSum, which we will describe later. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str_op.equals(<span class="hljs-string"><span class="hljs-string">"+"</span></span>)) result = functionSum( value_a, value_b ); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span></code> </pre><br>  For the case of the subtraction operation, we call the functionDif function, which we will describe later. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str_op.equals(<span class="hljs-string"><span class="hljs-string">"-"</span></span>)) result = functionDif( value_a, value_b ); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span></code> </pre><br>  For the case of multiplication, we call the functionMul function, which we will describe later. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str_op.equals(<span class="hljs-string"><span class="hljs-string">"*"</span></span>)) result = functionMul( value_a, value_b ); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span></code> </pre><br>  For the case of a division operation, we call the functionDiv function, which we will describe later.  As for the double type, the error of dividing by zero on modern platforms does not occur, the situation in which the divisor is zero is controlled manually. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str_op.equals(<span class="hljs-string"><span class="hljs-string">"/"</span></span>) &amp;&amp; (value_b!=<span class="hljs-number"><span class="hljs-number">0</span></span>)) result = functionDiv( value_a, value_b ); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span></code> </pre><br>  After checking all four operations, set the check box for no error to false.  This is done to identify that the arithmetic operation is not identified. <br><br><pre> <code class="java hljs">noError = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>;</code> </pre><br>  We close the try block with the setting of the check box if there is no error in ‚Äúfalse‚Äù in case of an exceptional situation. <br><br><pre> <code class="java hljs">} <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> ( Exception ex ) { noError = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; }</code> </pre><br>  If there is no error, send the result using the doSetResult method, which we describe below.  Since the work of the doGet method ends here, we return as the return operator. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( noError ) { doSetResult( response, result ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre><br>  Close the section started by the ‚Äúif (noError) {‚Äù operator: <br><br><pre> <code class="java hljs">}</code> </pre><br>  Since an error somewhere occurred while processing the request and the doGet function did not return control with a successful calculation, we return an error message using the doSetError method, which we describe below. <br><br><pre> <code class="java hljs">doSetError( response );</code> </pre><br><h3>  Cross Domain Requests </h3><br>  Cross-domain requests (also such requests are called cross-domain / cross domain) occur when you request from web pages located outside the network domain of the service server.  Answers to such requests are usually blocked to counter inter-domain attacks.  To disable blocking in server responses, you can set the Access-Control-Allow-Origin header: *. <br><br><h3>  DoSetResult method </h3><br>  The doSetResult method formats the response and sets the HTTP response parameters.  The value of the method lines is as follows: <br><ul><li>  The first line forms the JSON response.  Since the response structure is simple, the specialized JSON library is not used; </li><li>  In the second line, the JSON response is encoded into the HTTP response body in binary form using UTF-8 encoding; </li><li>  The third line indicates the content type of the HTTP response body; </li><li>  The fourth line sets the permission for cross-domain requests; </li><li>  The fifth line sets the OK HTTP response flag. </li></ul><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSetResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( HttpServletResponse response, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> result )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> UnsupportedEncodingException, IOException </span></span>{ String reply = <span class="hljs-string"><span class="hljs-string">"{\"error\":0,\"result\":"</span></span> + Double.toString(result) + <span class="hljs-string"><span class="hljs-string">"}"</span></span>; response.getOutputStream().write( reply.getBytes(<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>) ); response.setContentType(<span class="hljs-string"><span class="hljs-string">"application/json; charset=UTF-8"</span></span>); response.setHeader(<span class="hljs-string"><span class="hljs-string">"Access-Control-Allow-Origin"</span></span>, <span class="hljs-string"><span class="hljs-string">"*"</span></span>); response.setStatus( HttpServletResponse.SC_OK ); }</code> </pre><br><h3>  DoSetError method </h3><br>  The doSetError method formats the response of the error message and the necessary setting of the HTTP response parameters.  The value of the method lines is as follows: <br><ul><li>  The first line forms the JSON response.  Since the response structure is simple, the specialized JSON library is not used; </li><li>  In the second line, the JSON response is encoded into the HTTP response body in binary form using UTF-8 encoding; </li><li>  The third line indicates the content type of the HTTP response body; </li><li>  The fourth line sets the permission for cross-domain requests; </li><li>  The fifth line sets the OK HTTP response flag.  Note that the message contains an error associated with arithmetic calculations.  Since this error is not related to the HTTP protocol, the status flag is set to OK. </li></ul><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSetError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( HttpServletResponse response )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> UnsupportedEncodingException, IOException </span></span>{ String reply = <span class="hljs-string"><span class="hljs-string">"{\"error\":1}"</span></span>; response.getOutputStream().write( reply.getBytes(<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>) ); response.setContentType(<span class="hljs-string"><span class="hljs-string">"application/json; charset=UTF-8"</span></span>); response.setHeader(<span class="hljs-string"><span class="hljs-string">"Access-Control-Allow-Origin"</span></span>, <span class="hljs-string"><span class="hljs-string">"*"</span></span>); response.setStatus( HttpServletResponse.SC_OK ); }</code> </pre><br><h3>  Methods for implementing arithmetic operations </h3><br>  The architecture of this simple example involves the separation of code into functional parts.  Because of this, arithmetic operations are implemented as separate functions, and are not included in the body of the doGet method.  Since the functions are simple, we will not comment on their code. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">functionSum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + b; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">functionDif</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a - b; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">functionMul</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a * b; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">functionDiv</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a / b; }</code> </pre><br>  The source code of the program can be found in <a href="https://github.com/dgakh/Studies/tree/master/Java/SWS-Embedded-Jetty">the GitHub repository</a> . <br><br><h3>  Creating a base class </h3><br>  The main class of the application will contain the function main - the so-called entry point, from which the program starts.  The main function will enable the initialization, configuration, and launch of the embedded Jetty server. <br><br>  To create the main class of the application, right-click on the name of the project in the <b>Project Explorer</b> panel, select <b>New</b> in the context menu and then <b>Class</b> .  In the class name we enter Main.  Check the box to create a static main function and click the <b>Finish</b> button. <br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/files/5bc/1e5/4d7/5bc1e54d76ef48f1a31a2fde9b197db7.png"></div><br><br>  Just as in the case of a servlet, the corresponding file is created and opened in a text editor. <br><br><h3>  Add imported modules </h3><br>  Code that will be added to the main application class file will require the addition of the following lines of module inclusion code.  We introduce these lines. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.eclipse.jetty.server.Handler; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.eclipse.jetty.server.Server; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.eclipse.jetty.server.handler.HandlerList; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.eclipse.jetty.servlet.ServletContextHandler; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.eclipse.jetty.servlet.ServletHolder;</code> </pre><br><h3>  Adding code to the main method </h3><br>  The main method code begins by declaring the port variable and assigning it the port number that the server will listen to.  This approach allows you to quickly and easily change the port if necessary in case of further growth of the program. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> port = <span class="hljs-number"><span class="hljs-number">8080</span></span>;</code> </pre><br>  Create a server class. <br><br><pre> <code class="java hljs">Server server = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Server(port);</code> </pre><br>  Specify the parameters that will associate the path of the query string with the servlet created above. <br><br><pre> <code class="java hljs">ServletContextHandler context = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServletContextHandler( ServletContextHandler.SESSIONS ); context.setContextPath( <span class="hljs-string"><span class="hljs-string">"/"</span></span> ); <span class="hljs-comment"><span class="hljs-comment">// http://localhost:8080/func context.addServlet(new ServletHolder( new SrvltCalculator( ) ),"/func");</span></span></code> </pre><br>  We specify the request handler to the server. <br><br><pre> <code class="java hljs">HandlerList handlers = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HandlerList( ); handlers.setHandlers( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Handler[] { context } ); server.setHandler( handlers );</code> </pre><br>  We try to start the server.  To ensure that the program does not stop, we wait for the main process to terminate the server process by calling server.join ().  If an error occurs, a corresponding message is printed. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { server.start(); System.out.println(<span class="hljs-string"><span class="hljs-string">"Listening port : "</span></span> + port ); server.join(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { System.out.println(<span class="hljs-string"><span class="hljs-string">"Error."</span></span>); e.printStackTrace(); }</code> </pre><br>  The source code of the program can be found in <a href="https://github.com/dgakh/Studies/tree/master/Java/SWS-Embedded-Jetty">the GitHub repository</a> . <br><br><h2>  Access to the service from the browser </h2><br><h3>  Server startup </h3><br>  When you start the server, Eclipse can offer two options.  Since the server contains a full-fledged servlet, the program can be run on an application server, such as, for example, Tomcat or a standalone Jetty.  However, since we built jetty into an application, it can work independently - like a Java Application. <br><br><div style="text-align:center;"><img width="200" src="https://habrastorage.org/files/fc5/4d4/b7e/fc54d4b7e93f40858f6d39b4a40e5e16.png"></div><br><br>  After starting the application, it issues the corresponding notifications and the line Listening port: port indicating that our server is running and waiting for requests. <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/files/32b/aa8/a93/32baa8a93c5f4cac97112a0cc9baebc6.png"></div><br><br><h3>  Making requests through the browser </h3><br>  The easiest way to check server functionality is to access it through a browser. <br><br>  When sending a query string, such as <a href="http://localhost:8080/func%3Fa%3D8.78%26b%3D4.15%26op%3D%2B">http: // localhost: 8080 / func? A = 8.78 &amp; b = 4.15 &amp; op = +</a> , the server gives an error.  The point is that the string does not comply with the standard of requests and must be encoded as a URL (the + symbol is not valid). <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/files/374/c69/798/374c69798ef84346b8f55ea8dd1da5d8.png"></div><br><br>  After coding, everything works without error.  The + character is encoded by the URL as% 2B, which makes the request compliant with the standard.  There are many online URL encoders / de-encoders on the Internet that can be used for this purpose. <br><br>  Standardized request: <a href="http://localhost:8080/func%3Fa%3D8.78%26b%3D4.15%26op%3D%252B">http: // localhost: 8080 / func? A = 8.78 &amp; b = 4.15 &amp; op =% 2B</a> <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/files/707/aa5/210/707aa52106ce4ec3954e57fa75551daf.png"></div><br><br>  In a similar way, you can check the server's responses to other requests. <br><br><h3>  Server clients </h3><br>  Using a browser and sending requests directly is impractical, since it is very likely that an error would be made when manually forming a query string.  The use of such a resource can be organized by: <br><ul><li>  specialized web page with automatic generation of the query string and formatting the response using JavaScipt; </li><li>  mobile application; </li><li>  another server consuming the created resource for its internal needs. </li></ul><br><h3>  Client - web page </h3><br>  A specialized web page is a simple type of client application. <br><br><div style="text-align:center;"><img width="300" src="https://habrastorage.org/files/ae2/c23/b9a/ae2c23b9a7084ea1938cd57caf11234e.png"></div><br><br>  The HTML code for the page can be found in <a href="https://github.com/dgakh/Studies/tree/master/Java/SWS-Embedded-Jetty">the GitHub repository</a> . <br><br><h3>  Creating a startup module </h3><br>  The created server can be arranged as a single independent JAR file to be launched.  Such a file will only require the presence of the installed Java runtime environment and run from any folder of the file system.  To create such a file, right-click on the project name in the <b>Project Explorer</b> panel, select <b>Export</b> and then <b>Export ...</b> in the context menu.  In the <b>Java</b> section <b>,</b> select the <b>Runnable JAR file</b> and click the <b>Next</b> button. <br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/files/a87/6f4/63f/a876f463f80b4f718d7e5aad77849ef8.png"></div><br><br>  In the settings of the created JAR file, we specify the <b>Launch configuration</b> as <b>Main-SCalculator</b> , the full name of the exported file and the checkbox for packing the necessary modules into this file. <br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/files/4a1/b54/4a6/4a1b544a669548f3a4dbd2e54d575f13.png"></div><br><br>  A correctly created JAR file named SCalculator is launched by a simple command (when started from the same folder as it is located): <br><br><pre> <code class="java hljs">java -jar SCalculator.jar</code> </pre><br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/files/f6b/eb5/124/f6beb51244774c388ec7ae4406109949.png"></div><br><br>  It is also possible to start the server by double clicking on the JAR file. <br><br><h2>  Results </h2><br>  Many of the elements described in this release were practically used to create high-load servers.  Undoubtedly, more advanced techniques were used to achieve high speed and reliability, such as using the NGINX server in reverse proxy mode.  However, it all starts with a simple one and I hope that I could simply and clearly describe the techniques that will be useful in practical development. <br><br><h2>  Links </h2><br>  For more information about embedding Jetty into an application, see <a href="http://docs.codehaus.org/display/JETTY/Embedding%2BJetty">http://docs.codehaus.org/display/JETTY/Embedding+Jetty</a> <br><br>  Connection of user libraries by the example of Tomcat is described by the link <a href="http://www.avajava.com/tutorials/lessons/what-is-a-user-library-and-how-do-i-use-it.html%3Fpage%3D1">http://www.avajava.com/tutorials/lessons/what-is-a-user-library-and-how-do-i-use-it.html?page=1</a> <br><br>  You can find the GitHub repository here: <a href="https://github.com/dgakh/Studies/tree/master/Java/SWS-Embedded-Jetty">https://github.com/dgakh/Studies/tree/master/Java/SWS-Embedded-Jetty</a> <br><br>  The presented material is based on the use of Eclipse Luna for Java EE Developers and Ubuntu 14.04. </div><p>Source: <a href="https://habr.com/ru/post/259067/">https://habr.com/ru/post/259067/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../259051/index.html">That new versions of UEFI standards are prepared for us, part one, PI 1.4</a></li>
<li><a href="../259053/index.html">The second version of the Evernote SDK for Android: new Evernote features in your applications</a></li>
<li><a href="../259055/index.html">We test Spring Rest controllers: simpler, shorter, more reliable. Spring Security Test + JSON Matcher</a></li>
<li><a href="../259057/index.html">SMS chat on my knees</a></li>
<li><a href="../259065/index.html">Digest news of the gaming industry</a></li>
<li><a href="../259069/index.html">Memory Optimization DataTable</a></li>
<li><a href="../259071/index.html">New to Wolfram SystemModeler: FMI Import</a></li>
<li><a href="../259073/index.html">Browser history sniffing using favicon</a></li>
<li><a href="../259075/index.html">Creating AUX input for Kenwood GX806EF2 radio with i2c bus grab</a></li>
<li><a href="../259077/index.html">Encryption of personal correspondence. Friday post</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>