<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Blow from the past: DIPS-attack RIPv1, or the old routers are dangerous</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Attacks using the outdated routing protocol RIPv1 have been seen again since May 16, 2015, after more than a year of oblivion. They were recorded firs...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Blow from the past: DIPS-attack RIPv1, or the old routers are dangerous</h1><div class="post__text post__text-html js-mediator-article"> Attacks using the outdated routing protocol RIPv1 have been seen again since May 16, 2015, after more than a year of oblivion.  They were recorded first by Akamai, and after a couple of days - by DDoS-GUARD. <br><br>  RIPv1 was first introduced in the ‚Äúhistorical‚Äù RFC1045 (the original specification is no longer supported).  The protocol only supports class routing.  Thus, if the network advertised via RIPv1 belongs to class ‚ÄúA‚Äù (for example, 10.1.2.0/24), then the actual announcement sent will look like 10.0.0.0/8.  This, among other things, significantly limits the use of RIPv1 by internal networks, it is of little use for the Internet. <br><br>  The main characteristics of the attack under consideration 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      ‚Ä¢ traffic volume: up to 12.8 Gbps <br>  ‚Ä¢ packets per second: up to 3.2 million <br>  ‚Ä¢ attack vector: amplification of RIPv1 <br>  ‚Ä¢ outgoing port: UDP: 520 <br>  ‚Ä¢ incoming port: random <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4d3/5cd/663/4d35cd663a0139a42857b2985c991a7a.jpg" alt="image"><br><br><a name="habracut"></a>  RIPv1 (Routing Information Protocol, version 1) has been around for many years and is considered a quick and easy way to exchange information about routes in a small network with several routers. <br><br>  A router supporting RIP sends a request upon initial setup or upon power-up.  Any other device that accepts such requests will respond with a route list.  Route table updates are periodically broadcast. <br><br>  To change the behavior of RIPv1 for conducting a DdoS attack, an attacker can send the same request by replacing the outgoing IP address of the attack object.  The addressees are selected according to a previously prepared list of routers with RIPv1 support, which have a suspiciously large number of routes in the tables. <br><br>  As a result of a single request, a large number of packets with a 504-byte load are sent to the address being attacked.  Multiple responses can be sent to one request due to the restriction of 25 routes per RIP packet. <br><br>  In the listing below, the RIP responses are taken from a real attack.  From the side of the attacker, only responses to RIPv1 requests are visible, which he, of course, did not do. <br><br>  <b>Load examples</b> <br><br>  A typical RIPv1 request contains 24 bytes.  The answer given is 504 bytes.  This particular router responds with ten replies of 504 bytes and one in 164 bytes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/364/68a/018/36468a0188bca6285d1959252ca6362d.jpg" alt="image"><br><br>  When calculating the gain by the above requests, taking into account the Ipv4 [IP (IP (10) UDP10) UDP (8)] headers, the final gain for a single RIPv1 request is 131.24 (more than 13,000%).  The coefficient will vary depending on the number of routes in the router table.  During the first attack, most routers responded with multiple 504-byte responses to each request. <br><br>  A surface scan of the attack sources suggests that the victims used to create the storm of RIP responses used primitive routers (of the SOHO class).  The RIPv1 implemented on them works in accordance with the specification, the attackers simply use its features for their own purposes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/351/52e/752/35152e752807111a29b7b47b32681f11.jpg" alt="image"><br><br>  <b>Poisoning RIPv1</b> <br><br>  Can an attacker further increase the gain by forcing the router to learn new routes?  The idea seems feasible.  <b>But</b> there are three main factors that prevent the effective use of such a scenario in DdoS-attacks. <br><br>  The first factor is the ‚Äúsplit horizon‚Äù used by default on some devices supporting RIPv1.  Simply put, a router that receives an update of routes will not send it back through the same interface it received.  This means that a device connected to the Internet will not send spurious routes to the object of attack.  However, it will update these routes when they become obsolete until the 16th metric. <br><br>  This results in another overwhelming factor.  Route tables are often cleared, and too old routes will not persist for long.  As they become obsolete, another update will be required in order for the router to save them.  For example, in Cisco devices, the routes that arrived with an injection will not appear until they become unused (metric 16) and remain only 1 minute after they are marked unused, after which they will be erased from the route table. <br><br>  Thus, continuous regular updates will be required to maintain the ‚Äúpoisoning‚Äù of the tables.  The need for repeated injections leads to a decrease in the gain, because instead of a single 24-byte request, you will have to send multiple announcements up to 504 bytes each (depending on the number of routes per injection) in order to maintain route tables in the desired attacker state. <br><br>  The third problem is that RIPv1 responses coming from networks not directly connected to the router will be ignored.  This means that the address of the source of updates must be falsified so as to get into the network directly connected with the ‚Äúpoisoned‚Äù router so that the update is at least just accepted. <br><br>  All this together makes attempts to poison RIPv1 route tables unprofitable and unattractive for an attacker. <br><br>  With local access to a device (router), routes can be manipulated within the capabilities of the device itself.  Such a scenario is possible in the case when the control of the roadizer is available with default credentials or no user identity at all.  Such shortcomings in configuring routers are more common than we would like. <br><br>  <b>Considered attack</b> <br><br>  The attack on May 16, 2015, with a peak load of 12.81 Gbit and 3.2 million packets per second.  In the table below, the load, broken down by geographical location of traffic sources, shows that the largest traffic came from Europe.  London and Frankfurt recorded a total of 4.75 Gbps. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bc3/c39/3f0/bc3c393f006a22a8614dc4326859ae18.jpg" alt="image"><br><br>  <b>RIPv1 scan results on the Internet</b> <br><br>  According to Akamai, a total of 53,693 devices responded to RIPv1 requests on the Internet.  Although many of them are not suitable as DdoS amplifiers, they are still vulnerable to repel and other attacks, due to the low security of the protocol.  In general, about 500 unique sources were identified, sending 504-byte responses. <br><br>  Most of the 53,693 possible sources respond with a single route ‚Äî which makes them the usual ‚Äúreflectors‚Äù, without additional amplification. <br><br>  Considering the sizes of RIPv1 responses received on the Internet, a sufficiently large number of devices can be seen that provide at least a small gain factor.  It was possible to identify 24,212 devices providing a gain of at least 83%.  The table below shows the 5 most common packet lengths obtained during testing. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/554/575/5e7/5545755e7011066597e47ed378395e10.jpg" alt="image"><br><br>  Another interesting finding is that when RIPv1 implementations are detected, an incorrectly structured request is answered with a message that does not contain real information about their routing tables.  Although this eliminates the gain, reducing the attack to a simple reflection, this effect can be used <b>to mask the true source of malicious traffic</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/801/484/1a9/8014841a947ffceaf1474a065fd1033e.jpg" alt="image"><br><br>  Identified addresses were sorted to identify device models.  Of the 53,693 devices that responded to the request, more than 20,000 also listened to the TCP port: 80 (often used by the web-based administrator interface).  An attempt was made to extract and record the results of queries in the search for leaks of information about models (authentication requests, HTTP headers, model numbers on the home pages, etc.).  Below are the three most common devices (among those discovered) that support RIPv1.  Netopia devices are probably old equipment that became popular during the ADSL boom. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9ca/a57/85c/9caa5785c6b21c1cbd6fb3b65f359e80.jpg" alt="image"><br><br>  The following figure shows the distribution by providers (based on whois answers) of the addresses of detected Netopia devices.  Most of them are used by AT &amp; T customers. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/14e/6a3/7ad/14e6a37adb559d51058b679a4aaed571.jpg" alt="image"><br><br>  Most of the devices are geographically located in the USA, as shown in the following figure.  As mentioned above, the sources of malicious traffic recorded during recent attacks were mainly in Europe.  This means that there is a significant potential (not yet used) resource that can be used for attacks with amplification and reflection. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f37/10f/07a/f3710f07a40534c51bd48ee9ac4e08a2.jpg" alt="image"><br><br>  The distribution of traffic sources by country is shown in the following figure.  What unites them is that each of them, in response to a request, reports an unusually large number of routes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/daa/f54/92c/daaf5492c21bcaaa64369e5a3feaeeb6.jpg" alt="image"><br><br>  <b>Recommended Protective Measures</b> <br><br>  For victims of such attacks, for example, sources of ‚Äúreflected‚Äù traffic, there are several ways to protect against this method. <br>  Switch to RIPv2 or later using authentication. <br>  If RIPv1 is needed, reconsider the need for RIPv1 support on external interfaces.  If it is not needed there, mark external interfaces as passive for RIPv1 (where this feature is supported). <br>  Access to the RIP can also be limited by using an ACL, allowing access only to well-known routers. <br><br>  Objects of attack by reflected RIPv1 traffic can use ACLs to prohibit traffic from an outgoing UDP port: 520 on the Internet.  If the attack is too powerful, then you may need the services of a security provider against DdoS. <br><br>  <b>findings</b> <br><br>  The list of possible attack vectors is considerable, and some are harder to control than others because of their ubiquitous distribution (for example, DNS, SSDP).  As already mentioned, RIPv1 has certain opportunities to remain an attractive resource for organizing DDoS attacks.  Most of the sources of this resource are outdated routers that have been working in homes or home offices for years. <br><br>  A large number of Netopia devices illustrates this well.  Providers will not replace previously installed equipment if it performs its functions properly.  If there are no problems - why change something? <br><br>  Thus, devices that support obsolete protocols and contain known software vulnerabilities remain in service.  Providers will have the greatest influence on this situation.  First of all, you should close the UDP: 520 port from the Internet.  This will significantly reduce the possibility of implementing the described DDoS attacks.  Another option, more expensive, is to organize the upgrade of client equipment, its replacement with new routers (with the correct configurations);  This will be especially true for devices that are no longer supported by manufacturers. <br><br>  <i>Adapted translation prepared by <a href="https://www.facebook.com/ddosguard">DDoS-GUARD</a> technical specialists</i> <i><br></i> </div><p>Source: <a href="https://habr.com/ru/post/263503/">https://habr.com/ru/post/263503/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263489/index.html">Developer Path (Part 0x01)</a></li>
<li><a href="../263491/index.html">Analyzing large amounts of data with Apache Spark</a></li>
<li><a href="../263493/index.html">Implementation of the Hough Transform algorithm (Hough Transform) (+ work visualization)</a></li>
<li><a href="../263495/index.html">Digest of useful materials for iOS developers</a></li>
<li><a href="../263497/index.html">Intel lectures and training on software engineering. August, Moscow</a></li>
<li><a href="../263505/index.html">We display data from Serial in Chrome Application</a></li>
<li><a href="../263507/index.html">Python meetup - 2 years</a></li>
<li><a href="../263509/index.html">Developer Path, Part 3: The Game Creation History</a></li>
<li><a href="../263511/index.html">Improving Fody MethodDecoratorEx for asynchronous methods</a></li>
<li><a href="../263513/index.html">Continuous Success and why this should not be forgotten when developing a project (using the example of Drupal)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>