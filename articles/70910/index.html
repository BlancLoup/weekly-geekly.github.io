<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>My escape (html)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The purpose of the post - criticize. 

 I study Django in a small way, by creating a blog engine. There was a problem outputting custom content, i.e. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>My escape (html)</h1><div class="post__text post__text-html js-mediator-article">  <i>The purpose of the post - criticize.</i> <br><br>  I study Django in a small way, by creating a blog engine.  There was a problem outputting custom content, i.e.  its shielding.  I wrote my function.  Having some experience in creating content for different sites with different ideologies for shielding user data (rather negative, mostly sites are asked to do extra work), I developed a philosophy. <br><br>  Comment.  In my blog in the database is always stored in no way processed the original user input.  The task of the function is to make from this input html suitable for display.  In the simplest case, the function can be called while the content is displayed (in a template or view).  To improve performance, you can create a separate field in the database, which will be the result of the screening function, and will be updated during the content update. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, philosophy functions: <br><a name="habracut"></a><br><ul><li>  This is a fundamental principle - any user data is initially considered invalid.  Therefore, all that is not allowed will be screened. </li><li>  Minimum work for the user.  If I want to write a construction with angle brackets, I will write angle brackets, and I will not think about "&amp; lt;"  etc.  The function itself converts the wrong characters. </li><li>  However, you can use some tags.  Which - is set by the function parameter, or the default set is used.  Each tag has a set of valid attributes.  The function will leave valid tags and valid attributes.  Invalid attributes will simply be removed from the output, non-valid tags will be escaped. </li><li>  Following the first principle (and common sense) - unclosed tags will be automatically closed.  Closing tags without opening will be escaped. </li><li>  The blog is programmatic-oriented, i.e.  The blog will be pieces of code.  These pieces should be escaped entirely (it will be a piece of code, anyone, even html).  For this there are tags &lt;pre&gt; &lt;code [class = "language"]&gt; ... &lt;/ code&gt; &lt;/ pre&gt;.  I was guided by the highlight.js code <a href="http://softwaremaniacs.org/soft/highlight/">highlighting</a> library, it uses exactly this format of the code frame.  All that is inside this unit will be shielded entirely.  And highlighted. </li><li>  I love koloboks :) Therefore, the function should optionally replace smiles with images. </li></ul><br>  So everything is simple for the user - write what you want, everything will be screened, except for the allowed tags. <br><br>  Why not ready markup, bbcode, markdown: <br><ul><li>  That users do not learn this new markup. </li><li>  What would the text of the post was the most "standard" (html) and portable.  Copy-paste the original text of the post, screen the areas with the code, insert it into another blog - it is displayed correctly. </li></ul><br>  Although to make your own compact tags, which would be revealed in bulky html tags, it is a good idea.  Most likely, I will make it so that you can assign a filter to each user input. <br><br>  Here are some examples taken from the tests: <br> <code># New line test <br> text: 'New' + os.linesep + os.linesep + 'line' <br> html(text): 'New' + '&lt;br/&gt;' + os.linesep + '&lt;br/&gt;' + os.linesep + 'line') <br> <br> # Simple smile test <br> text: ':)' <br> html(text): '&lt;img src="/files/smile.gif"/&gt;') <br> <br> # Smile in code block test <br> text: '&lt;pre&gt;&lt;code&gt;there will be no image :)&lt;/code&gt;&lt;/pre&gt;' <br> html(text): '&lt;pre&gt;&lt;code&gt;there will be no image :)&lt;/code&gt;&lt;/pre&gt;') <br> <br> # Plain text test <br> text: 'Some simple text without any tags' <br> html(text): 'Some simple text without any tags') <br> <br> # Simple tags test <br> text: 'This is &lt;b&gt;important&lt;/b&gt; information' <br> html(text): 'This is &lt;b&gt;important&lt;/b&gt; information') <br> <br> # Wrong tag test <br> text: 'This is &lt;b&gt;important&lt;/b&gt; information and this is &lt;h5&gt;title&lt;/h5&gt;' <br> html(text): 'This is &lt;b&gt;important&lt;/b&gt; information and this is &amp;lt;h5&amp;gt;title&amp;lt;/h5&amp;gt;') <br> <br> # Wrong attributes test <br> text: 'This is &lt;b onclick="javascript:alert();"&gt;probable XSS&lt;/b&gt;' <br> html(text): 'This is &lt;b&gt;probable XSS&lt;/b&gt;') <br> <br> # Simple tags test <br> text: 'This is &lt;img src="image.jpg" onclick="javascript:alert();"/&gt;image' <br> html(text): 'This is &lt;img src="image.jpg"/&gt;image') <br> <br> # Text without tags <br> text: 'Sample code: &lt;?php print "Hello World"; ?&gt;' <br> html(text): 'Sample code: &amp;lt;?php print &amp;quot;Hello World&amp;quot;; ?&amp;gt;') <br> <br> # Code test <br> text: 'Sample code: &lt;pre&gt;&lt;code&gt;&lt;a href="home.html"&gt;link&lt;/a&gt;&lt;/code&gt;&lt;/pre&gt;' <br> html(text): 'Sample code: &lt;pre&gt;&lt;code&gt;&amp;lt;a href=&amp;quot;home.html&amp;quot;&amp;gt;link&amp;lt;/a&amp;gt;&lt;/code&gt;&lt;/pre&gt;') <br> <br> # Closing tag without opening tag <br> text: '&lt;/b&gt;bold text ended' <br> html(text): '&amp;lt;/b&amp;gt;bold text ended') <br> <br> # Autoclosing tags test <br> text: '&lt;b&gt;bold and &lt;i&gt;italic&lt;/i&gt; text' <br> html(text): '&lt;b&gt;bold and &lt;i&gt;italic&lt;/i&gt; text&lt;/b&gt;') <br> <br> # Overlapping areas test <br> text: 'if 1 &lt; 2 &lt;b&gt;only&lt;/b&gt; then it is ok, but if 1 &lt; 2 or 2 &lt; 3 then &lt;i&gt;bad&lt;/i&gt;' <br> html(text): 'if 1 &amp;lt; 2 &lt;b&gt;only&lt;/b&gt; then it is ok, but if 1 &amp;lt; 2 or 2 &amp;lt; 3 then &lt;i&gt;bad&lt;/i&gt;')</code> <br> <br>  Unfortunately, I do not have a server where I could show the function.  It is here: <a href="http://pastebin.com/f591d71e5">http://pastebin.com/f591d71e5</a> . <br><br>  I hope for criticism, thanks. </div><p>Source: <a href="https://habr.com/ru/post/70910/">https://habr.com/ru/post/70910/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../70898/index.html">Fat = sick! Or how to lose weight</a></li>
<li><a href="../70900/index.html">Did you do everything? Did you buy milk?</a></li>
<li><a href="../70902/index.html">New ideas on the API of RabbitMQ AMQP for PHP</a></li>
<li><a href="../70906/index.html">Tales of the DBMS</a></li>
<li><a href="../70909/index.html">The shelf of electronic readers has arrived again.</a></li>
<li><a href="../70912/index.html">The most difficult puzzle Revomaze</a></li>
<li><a href="../70915/index.html">Usability Marathon 2 - now free and online</a></li>
<li><a href="../70916/index.html">Apple hired the creator of Apple Newton</a></li>
<li><a href="../70917/index.html">The geography of the affairs of the Federal Antimonopoly Service against Svyazinvest is growing and expanding!</a></li>
<li><a href="../70920/index.html">Anonymous Web Surfing with Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>