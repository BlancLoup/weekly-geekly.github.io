<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Installing and configuring a VPS with a CentOS 6.x pair of commands with VestaCP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings, Habr! 

 For my product, I made an installer for pure VPS with CentOS 6.x and 512MB + RAM. This is a VPS that can be purchased from Digital...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Installing and configuring a VPS with a CentOS 6.x pair of commands with VestaCP</h1><div class="post__text post__text-html js-mediator-article">  Greetings, Habr! <br><br>  For my product, I made an installer for pure VPS with CentOS 6.x and 512MB + RAM.  This is a VPS that can be purchased from DigitalOcean.com for $ 5 per month.  But the installer turned out to be quite universal, and you can fork it from the github to eliminate the components you don't need. <br><br>  I chose <a href="http://vestacp.com/">VestaCP</a> as the control panel, which I hadn‚Äôt heard about before, since I have been blindly using cPanel / WHM for several years, most recently with CloudLinux.  But this is a paid panel, and CloudLinux is also paid, and the last thing is to ask users to pay more for something, except for the product. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  <b>When</b> I got acquainted with <b>VestaCP</b> , I really liked it, although I still need to refine it.  For example, there is no documentation on the console commands v- * and you have to use the method of typing to determine what kind of data you need to submit to the input.  Sometimes this is not obvious from the synopsis of using the command, if called without parameters. <br><br>  So, imagine that we have a clean VPS, from <b>DigitalOcean</b> , <b>FirstVDS</b> or <b>Linode</b> .  About FirstVDS I want to immediately say that it is better to choose their package with <b>KVM</b> virtualization, since the <b>OpenVZ</b> technology (which is the cheapest at FirstVDS) does not allow you to include swap files, and as I read, swap is exposed at the level of the OpenVZ virtual machine manager, but FirstVDS is the documentation clearly indicates that they have no swap, and that if the application briefly needs more memory than is physically allocated, it will be nailed down and the server may hang. <br><br>  For the installer, I created a repository on GitHub: <a href="https://github.com/jetapps-eu/publigator-vps-installer">https://github.com/jetapps-eu/publigator-vps-installer</a> <br><br>  To start the installation, we go via SSH to the server, and execute the command: <br><br><pre><code class="bash hljs">curl -O https://raw.githubusercontent.com/jetapps-eu/publigator-vps-installer/master/publigator-install-step1.sh &amp;&amp; bash publigator-install-step1.sh</code> </pre> <br><br>  This command will download the configurator, ask you for the host name, the e-mail to which VestaCP access data will be sent, the domain name that will be created automatically for the admin user, and the IP for this domain.  In addition, the database name, user, and password will be asked, which will also be created during the installation process for the admin user. <br><br>  After that, the EPEL and RPMForge repositories will be installed, the system will be updated, and wget, htop, mc, and the Development Tools group will be installed. <br><br>  In addition, a 512MB swap file / swapfile will be created and enabled temporarily, without being written in / etc / fstab.  Further steps for the swap file can be found in the article on <a href="https://www.digitalocean.com/community/tutorials/how-to-add-swap-on-centos-6">DigitalOcean</a> . <br><br>  Further httpd will be removed if it is.  In some images that use VPS providers, it is installed by default. <br><br>  At the end of step 1, the VestaCP control panel will be installed, and you will see the access data in the console.  And also get them by e-mail. <br><br>  By default, VestaCP installs PHP 5.4.x, Apache 2.2.x, MySQL 5.5.x, Nginx as a proxy.  If you have a server with 1GB + RAM, then SpamAssassin and ClamAV will also be installed, and the FGCID for Apache will also be installed, and the corresponding Apache template will be added. <br><br>  In my repository there is a special step publigator-fcgid-install.sh, which is not used by default, but which you can use if you need to fortify the repository.  It allows you to set fgcid and a template with settings for timeouts and resources, and also sets an optimized fcgid-starter for servers with a small amount of memory, in particular the parameter PHP_FCGI_CHILDREN is exported without a value, as advised on the <a href="httpd.apache.org/mod_fcgid/mod/mod_fcgid.html">mod_fcgid</a> page. <br><br>  Next, proceed to step 2: <br><br><pre> <code class="bash hljs">curl -O https://raw.githubusercontent.com/jetapps-eu/publigator-vps-installer/master/publigator-install-step2.sh &amp;&amp; bash publigator-install-step2.sh</code> </pre><br><br>  By default, this step will take the following actions: <br><br><ul><li>  Installs the mysqlnd package for PHP instead of the usual php-mysql.  Maybe you don‚Äôt need it, but in my case, Yii2 currently does not work correctly with the usual libmysql driver, in terms of getting values ‚Äã‚Äãfrom BIT type fields.  Yii2 expects a converted value of 0 or 1, which correspond to ord (48) and ord (49), and libmysql returns a RAW bit value that corresponds to ord (0) and ord (1), respectively.  There is a misunderstanding. </li><li>  Installs the latest IonCube Loader. </li><li>  Updates ICU library to version 54.1 </li><li>  Installs updated php-intl version 3.0 from PECL to support the new ICU (which can be achieved by recompiling PHP, but in this case PHP is installed by the package and it is easier to update the intl from PECL). </li><li>  Install PHP extensions from PECL: oauth, igbinary, pecl_http, imagick, geoip.  Download and install dependencies. </li><li>  Compiles and installs the opendkim PHP extension, which can be used in swiftmailer. </li><li>  Changes the /etc/php.ini settings: <br><ul><li>  realpath_cache_size = 1M </li><li>  realpath_cache_ttl = 120 </li><li>  max_execution_time = 300 </li><li>  post_max_size = 32M </li><li>  default_charset = UTF-8 </li><li>  display_errors = On </li><li>  max_input_vars = 10000 </li><li>  upload_max_filesize = 32M </li></ul><br></li><li>  Changes the /etc/my.cnf settings: <br><ul><li>  wait_timeout = 1800 </li><li>  interactive_timeout = 1800 </li></ul><br></li><li>  Creates additional NGINX configuration files for the domain in which longer timeouts are specified. </li><li>  Downloads, compiles and installs SuPHP 0.7.2 and dependencies for compiling.  Adds templates for Apache and Nginx for this business and adds a hosting package called suphp. </li><li>  Increases timeout in /etc/httpd/conf/httpd.conf </li></ul><br><br>  After this, there is a preparation step for installing my Publigator script, but again you can fork the repository and redo it for you.  Also in this step: <br><br><ul><li>  The suphp package for the admin user is enabled, and the use of nginx for the domain with the suphp template is also enabled. </li><li>  Removed default.domain for admin </li><li>  Removed hosting packages palegreen, gainsboro, slategrey, which VestaCP sets by default. </li></ul><br><br><h4>  Total </h4><br><br>  After executing the commands, you have VPS with CentOS 6.x, VestaCP as a control panel, Apache 2.2.x, PHP 5.4.x, Nginx as a proxy, SuPHP as a PHP mode of operation, updated ICU and php-intl, as well as installed PECL oauth, igbinary, pecl_http, imagick, geoip and PHP opendkim extensions, and a slightly customized php.ini. <br><br>  If you will fork the repository, then pay attention to the WEBSOURCE variable in the files publigator-config-tpl.sh and publigator-install-step1.sh - it should refer to your repository. <br><br>  Also, the publigator-suphp-0.7.2-install.sh installation step can be replaced by the publigator-fcgid-install.sh step. <br><br>  I plan to develop a repository and add support for Debian and Ubuntu.  You can ask questions in the comments or in the Issues on github. <br><br>  Thanks for attention! <br><br><h4>  UPD 12/20/2014 </h4><br><br>  I removed the SuPHP installation from the standard step, i.e.  remains mod_ruid2, which installs VestaCP.  Instead, I made several choices for step 2: <br><br><pre> <code class="bash hljs">curl -O https://raw.githubusercontent.com/jetapps-eu/publigator-vps-installer/master/publigator-install-step2-suphp.sh &amp;&amp; bash publigator-install-step2-suphp.sh</code> </pre><br><br>  This is the name of the variant with SuPHP. <br><br>  SuPHP 0.7.2 is compiled and installed.  A <b>suphp</b> hosting package is <b>added</b> and <b>suphp</b> templates for Apache and Nginx are added.  The config for SuPHP is added: /etc/suphp.conf and the config for Apache is added: /etc/httpd/conf.d/php.suphp.conf <br><br>  For the admin user, the hosting package is changed to suphp, Nginx support for the created domain is added, and suphp templates for Apache and Nginx for the created domain are set. <br><br><pre> <code class="bash hljs">curl -O https://raw.githubusercontent.com/jetapps-eu/publigator-vps-installer/master/publigator-install-step2-fcgid.sh &amp;&amp; bash publigator-install-step2-fcgid.sh</code> </pre><br><br>  This option with the installation of Fcgid (the installation itself is performed only on microservers with &lt;1GB RAM, as Vesta installs in other cases on its own).  A <b>phpfcgid</b> hosting package is <b>created</b> and <b>pbl_phpfcgid</b> templates for Apache and Nginx are added. <br><br>  For the admin user, the hosting package is changed to phpfcgid, Nginx support is added for the created domain, and pbl_phpfcgid templates for Apache and Nginx for the created domain are set. <br><br>  The following mod_fcgid parameters are set in the Apache templates: <br><br><pre> <code class="bash hljs">FcgidBusyTimeout 900 FcgidIdleTimeout 900 FcgidIOTimeout 900 FcgidMaxRequestLen 104857600 FcgidMaxRequestInMem 128000000 FcgidMaxRequestsPerProcess 1000</code> </pre><br><br>  And also fcgi-starter is copied with the following parameters: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh PHPRC=/usr/local/lib export PHPRC export PHP_FCGI_MAX_REQUESTS=1000 export PHP_FCGI_CHILDREN exec /usr/bin/php-cgi</span></span></code> </pre><br><br>  The variable PHP_FCGI_CHILDREN is exported without a value to save memory. </div><p>Source: <a href="https://habr.com/ru/post/246223/">https://habr.com/ru/post/246223/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../246203/index.html">Online project user support: 3 working tools</a></li>
<li><a href="../246205/index.html">JSOC: how to prepare incidents</a></li>
<li><a href="../246211/index.html">What tests do you need? Part 1. On the goals and objectives that affect the choice of tests</a></li>
<li><a href="../246213/index.html">Toaster. Related tags, first page of tag subscriptions</a></li>
<li><a href="../246221/index.html">A chance to learn from Yandex what he knows best</a></li>
<li><a href="../246235/index.html">Habr, meet - new LinguaLeo with a personalized system of learning a foreign language</a></li>
<li><a href="../246237/index.html">And IT, and PI: tell where small businesses get money for development</a></li>
<li><a href="../246239/index.html">Kiev Ciklum Speakers' Corner: "Manage your energy, not time", December 24</a></li>
<li><a href="../246241/index.html">BLE from Nordic Semiconductor. Getting started with a stack using the nRF51822 chip</a></li>
<li><a href="../246245/index.html">Smartphone owners, on average, spend 5‚Öì hours a year waiting for video to load.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>