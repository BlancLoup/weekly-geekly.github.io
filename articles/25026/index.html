<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Gelatin again</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continuation of the history of the study of the "virus" of gelatin, aka Storm Worm, aka Peacomm, and so on. See the beginning in the last issue . 

 S...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Gelatin again</h1><div class="post__text post__text-html js-mediator-article">  <i>Continuation of the history of the study of the "virus" of gelatin, aka Storm Worm, aka Peacomm, and so on.</i>  <i>See the beginning <a href="http://nchaly.habrahabr.ru/blog/36497.html">in the last issue</a> .</i> <br><br>  So, gelatin.  Hm  Again. <br><br>  The first thing I encountered was the absence of any technical information about gelatin.  Google, of course, sends straight to Wikipedia [WIKI].  Here we learn a little. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      1. The virus includes infected machines in the botnet [WIKI1]; <br>  2. The gelatin network is a modification of the Overnet network. <br><br>  A little history of gelatin in Russian is also contained in [KASP]. <br><br>  Understanding how Overnet works is the basis for further fights.  Therefore, in this issue we will study this framework. <br><br>  After going a few links, I found a description of the gelatin network [PPT].  Attempts to find ready-made sales of Overnet customers have also been crowned with success [KADC].  One glance at the KadC library was enough to recognize the vague features of the dismantled valentine malware code.  Even with some changes, but the KadC code in the field can be a base for gelatin.  Only this reason can explain the completely arrogant statement of McAffee specialists: <br><blockquote>  "Bot technology is rapidly evolving, often aided and <br>  abetted, unfortunately, by the open-source movement. ‚Äù </blockquote><br>  <font color="#333333">[MCAF] is also discussed in [CNET1] and [ASHIMMY].</font>  <font color="#333333">I would very much like to draw the attention of comrades from McAffee that it would be nice for them to expand their view of the world by including the brave MIT scientists who developed Kademlia in the accusation.</font> <br><a name="habracut"></a><br>  One of the most valuable resources was [REC].  There you can take the original version of one of the very first gelatins.  Then it was almost a normal :) encrypted executable file, traces of which were carefully conspired by the rootkit driver.  The advantage of the first versions is that they do not create messages, and therefore wireshark will be able to decode them in edonkey format. <br><br>  By the way, about the "obxoren" traffic.  The fact is that the penultimate type of gelatin (and the latter, as we know, was distributed on the first of April), creates ordinary messages that are understandable to both past modifications and to Overnet customers, by the way.  But before sending it is traversed by it xor, using a hard-coded table.  The fact that only representatives of the ‚Äúvalentine strain‚Äù are able to process the traffic of their ‚Äúbrothers‚Äù indicates a decrease in the size of the botnet, which is based on this modification [HAC].  There were other, earlier data that Bonet was divided into several small [ZD]. <br><br>  Strictly speaking, gelatin and others like it ... er ... programs ... are not viruses.  They do not infect files on local media, they do not commit destructive actions.  They only :) spread themselves, spam, participate in dos-attacks and, probably, do something else [SCH].  Obviously, first of all you need to find out how individual instances of gelatin communicate with each other. <br><br>  Gelatin uses the Overnet [WIKI2] network, which is a realization of the idea of ‚Äã‚ÄãKademlia [WIKI3], a model of a <b>distributed hash table</b> developed at MIT, this is not good for you.  The main combat unit of the network is the node, peer.  The primary task of any conscious node is first of all to enter the network.  For this, gelatin has a list of nodes to which it tries to connect first.  In the first versions this list was hardcoded right in the body of the virus, in the last versions it was also hardcoded in the body, but it was extracted and stored in the ini file.  Without it, - without a file, - by the way, valentine gelatin refuses to work.  The addresses of the nodes of the "first circle" are written approximately as follows: <br><br><blockquote>  00003D6C8F338A3FDD3DF3648666F55C = BE56062A5DC600 <br>  0100A634122F3553A046EC451061927C = 4B6EB028151500 <br>  02007E238D780D25FD5511285E2E596E = 58E941B3100A00 <br></blockquote><br><br>  where the number before the sign is different - this is the OvernetID (oid), or the hash of the node, a 128-bit number that is generated as if randomly generated. In detail we will talk about it later.  Following the sign are the IP address (BE56062A = BE.56.06.2A = 190.86.5.42), the port (5DC6 = 24006) and the last byte is the type of the node. <br><br>  The first (and most frequently used) message that the new node sends to other nodes is ‚ÄúPUBLICIZE‚Äù.  This is a kind of ping, with which the parties make sure that each other is available.  This message is strongly referred to in some sources as ‚ÄúHELLO‚Äù.  Inside it is sent the oid of the sending node, its IP address, port and type.  In general, the same data as in the ini file. <br><br>  After the new node has made sure that the addressee is available and responded (the ‚ÄúPUBLICIZE_ACK‚Äù message, two bytes long ‚Äî the header and the message code), it sends a CONNECT request.  The message structure is identical to the ‚ÄúPUBLICIZE‚Äù message.  In response to this message, the receiving party <br><br>  1. Sends a list of nodes known to him and <br>  2. adds the sender to this list (and, accordingly, will send the ‚Äúnew‚Äù address in response to the new ‚ÄúCONNECT‚Äù). <br><br>  The new node adds the addresses it received to its list of hosts.  If you count on the fingers, the diperto.ini in the composition of the valentine gelatin contained the addresses of 823 nodes.  And if at least half answered twenty addresses, then ... Fortunately, the gelatin is written "correctly."  The size of the list of known nodes is limited to 1024 elements. <br><br>  The next step is to find out what address our node looks like for the destination node.  To do this, gelatin opens the tcp port and starts listening to it.  He transmits the port in the IP_REQ message, to which the recipient receives this message responds with the IP_REQ_RES message with the address from which he received this message.  This is done to bypass the limitations of NAT and firewalls. <br><br>  This completes the process of connecting to the network, but the gelatin will continue to ping with great frequency the nodes from its list in order to promptly remove those that for some reason have become unavailable. <br><br>  By the way, in order to stop the cycle of processing incoming messages, it is enough to send him the number 74BE2A5Dh.  This is not a bug - he sends it to himself to complete the work.  Perhaps, even for upgrading your executable code, but the fact is that gelatin works, but completely refuses to process incoming messages.  Such a clumsy method can be tried to neutralize it on infected machines. <br><br>  So, the following messaging followed (Z - Gelatin, H - host): <br>  Z ‚Üí <b>PUBLICIZE</b> ‚Üí H <br>  Z ‚Üê <b>PUBLISIZE_ASK</b> ‚Üê H <br>  Z ‚Üí <b>CONNECT</b> ‚Üí H <br>  Z ‚Üê <b>CONNECT_RES</b> ‚Üê H <br>  Z ‚Üí <b>IP_REQ</b> ‚Üí H <br>  Z ‚Üê <b>IP_REQ_RES</b> ‚Üê H <br><br>  Now let's make a small lyrical digression on the subject of the main goal of the Overnet network as a distributed hash table.  The main purpose of the network is to exchange files, or rather publish data about files and their location in such a way as to speed up the search.  Simplified, this scheme looks like. <br><br>  A host that needs to publish some data computes an MD4 hash of the file contents (or keywords, depending on what information is being published), then searches for the node whose OID is closest to that hash.  (The degree of proximity is determined by the result of the XOR operation, which, as we know, returns zero for identical bits. That is, for absolutely identical hashes, we get zero).  To do this, the publisher sends a SEARCH message that contains the desired hash to all hosts from its list.  The nodes that received such a message find several (?) Addresses from their lists, in descending order of proximity, and send back this list with the message SEARCH_NEXT.  The search ends if the node sends its own address inside SEARCH_NEXT.  Meta-data and data about the site from which this file can be downloaded are published separately. <br><br>  In the same way, but in the other direction, the search also occurs.  The hash is calculated in a certain way, and then the exchange is SEARCH-SEARCH_NEXT, after which the TCP connection parameters are determined, after which the file is downloaded. <br><br>  In the simplest version, the gelatin finds the right host, downloads a list of emails from it and starts spamming. <br><br>  For example, like this: <br><blockquote><pre>  220 hnicpmaa01.vnn.vn ESMTP Service (7.3.118.8) ready
 HELO xxxx.xxx.xxxx.com
 250 hnicpmaa01.vnn.vn
 MAIL From: pcec-vmi-onsite@aliceadsl.fr
 250 MAIL FROM: pcec-vmi-onsite@aliceadsl.fr OK
 RCPT TO: dmchn@hn.vnn.vn
 550 RCPT TO: dmchn@hn.vnn.vn User unknown
 Quit
 221 hnicpmaa01.vnn.vn QUIT
</pre></blockquote><br><br>  a href = "mailto:" is not my invention, for some reason automatically substitutes ( <br><br>  About what specifically and how looking for gelatin in the network, let's talk in the next issue. <br><br>  Literary. <br><br><table><tbody><tr><td>  ASHIMMY. </td><td>  <a href="http://www.stillsecureafteralltheseyears.com/ashimmy/open_source/index.html">McAfee's Matt Asay.</a> </td></tr><tr><td>  CNET1. </td><td>  <a href="http://www.cnet.com/8301-13505_1-9917989-16.html">McAfee's libel against open source.</a> </td></tr><tr><td>  HAC. </td><td>  <a href="http://www.xakep.ru/post/40401/default.asp">Botnets are getting smaller.</a> </td></tr><tr><td>  KADC. </td><td>  <a href="http://kadc.sourceforge.net/">KadC library.</a> </td></tr><tr><td>  KASP. </td><td>  <a href="http://www.viruslist.com/ru/analysis%3Fpubid%3D204007605">Modern information threats, I quarter 2008 // Storm continues.</a> </td></tr><tr><td>  MCAF. </td><td>  <a href="http://www.mcafee.com/us/local_content/white_papers/wp_botnet.pdf">Killing Botnets.</a> </td></tr><tr><td>  Ppt. </td><td>  <a href="http://noh.ucsd.edu/~bmenrigh/exposing_storm.ppt">Brandon Enright.</a> </td></tr><tr><td>  REC. </td><td>  <a href="">Peacomm.C - Cracking the nutshell.</a> </td></tr><tr><td>  SCH. </td><td>  <a href="http://www.schneier.com/blog/archives/2007/10/the_storm_worm.html">The Storm Worm.</a> </td></tr><tr><td>  WIKI. </td><td>  <a href="http://en.wikipedia.org/wiki/Storm_Worm">Storm Worm.</a> </td></tr><tr><td>  WIKI1. </td><td>  <a href="http://en.wikipedia.org/wiki/Storm_botnet">Storm botnet.</a> </td></tr><tr><td>  WIKI2. </td><td>  <a href="http://en.wikipedia.org/wiki/Overnet">Overnet.</a> </td></tr><tr><td>  WIKI3. </td><td>  <a href="http://en.wikipedia.org/wiki/Kademlia">Kademlia.</a> </td></tr><tr><td>  ZD. </td><td>  <a href="http://blogs.zdnet.com/security/%3Fp%3D592%26tag%3Dnl.e539">Storm Worm botnet partitions for sale.</a> </td></tr></tbody></table></div><p>Source: <a href="https://habr.com/ru/post/25026/">https://habr.com/ru/post/25026/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../25025/index.html">Forget about canvas for a moment</a></li>
<li><a href="../250251/index.html">VKPLS - Generate streaming audio playlist from vk.com</a></li>
<li><a href="../250255/index.html">The first build of Opera 29 with tab synchronization</a></li>
<li><a href="../250257/index.html">What is wrong with air service interfaces and how to fix it: Aviageek project approach</a></li>
<li><a href="../250259/index.html">5 major trends in hosting in 2015</a></li>
<li><a href="../250261/index.html">Trees in Diablo 3</a></li>
<li><a href="../250267/index.html">We spy on everyone with Yandex.Metro</a></li>
<li><a href="../250269/index.html">CSS file visualization</a></li>
<li><a href="../25027/index.html">Do you know that‚Ä¶</a></li>
<li><a href="../250271/index.html">Domain .tp will be deleted</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>