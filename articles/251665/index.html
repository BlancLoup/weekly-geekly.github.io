<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Run SQL queries in SAP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When implementing information solutions based on SAP ERP, as a rule, three systems are deployed: 

 1. Development system. 
 2. Testing system. 
 3. T...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Run SQL queries in SAP</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/files/358/fc0/6ea/358fc06ea30840b3a73aded2a3602cc2.jpg">  When implementing information solutions based on SAP ERP, as a rule, three systems are deployed: <br><br>  1. Development system. <br>  2. Testing system. <br>  3. The system of productive operation. <br><br>  In the process of developing programs, it is often necessary to promptly test SQL queries in a productive or test system, since the development system usually contains minimal data and is not always enough.  Let's look at the existing options for this, evaluate their shortcomings and ultimately develop our own tool. <br><a name="habracut"></a><br>  I managed to count the 5 available options: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  <b>1.</b> Transaction SE16 / SE16N </h5><br>  With this transaction, you can only select from one table.  Not suitable for queries with multiple tables. <br><br><h5>  <b>2.</b> Transaction ST04 (Additional Functions -&gt; SQL Command Editor) </h5><br>  This tool allows you to perform SQL queries of any complexity, but has 2 drawbacks: <br><br><ul><li>  firstly, it perceives only Native SQL queries (DBMS syntax), which imposes some inconveniences, since when developing ABAP programs, Open SQL queries are used for universality, somewhat different in syntax, but this could have been survived if not Secondly"; </li><li>  secondly, it works only if Oracle is used as a DBMS. </li></ul><br><h5>  <b>3.</b> Transaction SQVI </h5><br>  You cannot write SQL queries directly in a transaction, but you can use the constructor to build fairly complex samples from several tables with JOINs.  Does not know how to work with subqueries, and besides, the designer has to perform too many mouse manipulations, so it is not suitable for testing queries. <br><br><h5>  <b>4.</b> Write a simple program with the test query and transfer it to the test system </h5><br>  The process of transferring the modified code to the test (productive) system requires some routine manipulations and takes an average of 5-7 minutes, so this option is also not suitable, since there is not enough patience to do all this after each query edit. <br><br><h5>  <b>5.</b> Direct access to the DBMS </h5><br>  In most cases, it is not possible for developers to get such access on projects, so this option is not suitable. <br><br><h5>  <b>Conclusion</b> </h5><br>  It turns out that there is no convenient universal tool that would allow to quickly test SQL queries of any complexity in SAP.  Having come to this conclusion, I decided to develop such a tool. <br><br><h2>  Getting to the development </h2><br>  First, in the transaction SE80, we create the ZSQL program, the MAIN100 GUI status with the Run button, and Screen 0100. <br><br>  In large scale, the program's algorithm looks like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ade/9d1/8ca/ade9d18cac5f4839b33bd02a2960e16a.png"></div><br><br><h5>  Getting SQL SELECT query </h5><br>  To obtain the SQL query, we will use a text editor, which we will create on the screen using the <b>CL_GUI_TEXTEDIT</b> class.  To do this, add to the Screen 0100 an empty container named MYEDIT, into which we will display the editor. <br><br><div class="spoiler">  <b class="spoiler_title">Code snippet creating a text editor on the screen</b> <div class="spoiler_text"><pre><code class="hljs pgsql">data: g_editor <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> cl_gui_textedit, g_editor_container <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> cl_gui_custom_container. <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> g_editor <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> initial. <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> g_editor_container exporting container_name = `MYEDIT` exceptions cntl_error = <span class="hljs-number"><span class="hljs-number">1</span></span> cntl_system_error = <span class="hljs-number"><span class="hljs-number">2</span></span> create_error = <span class="hljs-number"><span class="hljs-number">3</span></span> lifetime_error = <span class="hljs-number"><span class="hljs-number">4</span></span> lifetime_dynpro_dynpro_link = <span class="hljs-number"><span class="hljs-number">5.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> g_editor exporting parent = g_editor_container wordwrap_mode = cl_gui_textedit=&gt;wordwrap_at_fixed_position wordwrap_to_linebreak_mode = cl_gui_textedit=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span> exceptions others = <span class="hljs-number"><span class="hljs-number">1.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sy-subrc &lt;&gt; <span class="hljs-number"><span class="hljs-number">0.</span></span> leave program. endif. endif.</code> </pre> </div></div><br><h5>  SQL Parsing </h5><br>  From the entered SQL query, we need to get a list of selectable fields and tables in order to dynamically generate an ALV-Grid structure based on this list to produce the result. <br><br><div class="spoiler">  <b class="spoiler_title">Code snippet parsing the query</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">types</span></span>: ty_simple_tab <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> standard <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> ty_simple_struc. <span class="hljs-keyword"><span class="hljs-keyword">types</span></span>: ty_t_code <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> standard <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> rssource-<span class="hljs-type"><span class="hljs-type">line</span></span>. data lt_sql_query <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ty_simple_tab. lt_fields <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ty_simple_tab, lt_tables <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ty_simple_tab, l_use_cnt(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> c. "   " <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> at lt_sql_query assigning &lt;fs_sql_query&gt;. "   - replace all occurrences of con_tab in &lt;fs_sql_query&gt;-line with space. concatenate ` ` &lt;fs_sql_query&gt;-line ` ` into &lt;fs_sql_query&gt;-line. "     " refresh lt_parsed_sql_line. split &lt;fs_sql_query&gt;-line at space into table lt_parsed_sql_line. delete lt_parsed_sql_line where line = ''. loop at lt_parsed_sql_line assigning &lt;fs_parsed_sql_line&gt;. translate &lt;fs_parsed_sql_line&gt;-line to upper case. if &lt;fs_parsed_sql_line&gt;-line = 'SELECT'. continue. endif. "    * - ,     " if &lt;fs_parsed_sql_line&gt;-line = '*'. l_field_names_obtained = 'X'. continue. endif. "    <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span>  <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> - ,     . "     " <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> &lt;fs_parsed_sql_line&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span> = <span class="hljs-string"><span class="hljs-string">'FROM'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> &lt;fs_parsed_sql_line&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span> = <span class="hljs-string"><span class="hljs-string">'JOIN'</span></span>. l_field_names_obtained = <span class="hljs-string"><span class="hljs-string">'X'</span></span>. l_is_tabname = <span class="hljs-string"><span class="hljs-string">'X'</span></span>. <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>. endif. "   " <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> l_field_names_obtained <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> initial. "   COUNT()" find <span class="hljs-string"><span class="hljs-string">'COUNT('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;fs_parsed_sql_line&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span> ignoring <span class="hljs-keyword"><span class="hljs-keyword">case</span></span>. <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sy-subrc = <span class="hljs-number"><span class="hljs-number">0.</span></span> l_use_cnt = <span class="hljs-string"><span class="hljs-string">'X'</span></span>. <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>. endif. "        ~" <span class="hljs-keyword"><span class="hljs-keyword">search</span></span> &lt;fs_parsed_sql_line&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-string"><span class="hljs-string">'~'</span></span>. <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sy-subrc = <span class="hljs-number"><span class="hljs-number">0.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> sy-fdpos. endif. append &lt;fs_parsed_sql_line&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span>+sy-fdpos <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> lt_fields. endif. "   " <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> l_is_tabname = <span class="hljs-string"><span class="hljs-string">'X'</span></span>. append &lt;fs_parsed_sql_line&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> lt_tables. clear l_is_tabname. endif. endloop. endloop.</code> </pre> </div></div><br><h5>  Execute SQL query </h5><br>  To execute our query, we use the <b>generate subroutine pool</b> statement, which allows us to dynamically generate temporary ABAP programs based on the source code passed as a parameter, which we will prepare from the entered SQL query. <br><br><div class="spoiler">  <b class="spoiler_title">Code snippet generating an ABAP program</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">types</span></span>: ty_t_code <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> standard <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> rssource-<span class="hljs-type"><span class="hljs-type">line</span></span>. data: code <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ty_t_code, prog(<span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> c, msg(<span class="hljs-number"><span class="hljs-number">120</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> c, lt_parsed_sql_line <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ty_simple_tab, l_sub_order(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> c. field-symbols: &lt;fs_sql_query&gt; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ty_simple_struc, &lt;fs_parsed_sql_line&gt; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ty_simple_struc. append `program z_sql.` <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> code. append `form get_data <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> fs_data <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> standard <span class="hljs-keyword"><span class="hljs-keyword">table</span></span>.` <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> code. append `try.` <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> code. <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> at lt_sql_query assigning &lt;fs_sql_query&gt;. clear: lt_parsed_sql_line. split &lt;fs_sql_query&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span> at space <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> lt_parsed_sql_line. <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> lt_parsed_sql_line <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-type"><span class="hljs-type">line</span></span> = <span class="hljs-string"><span class="hljs-string">''</span></span>. <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> at lt_parsed_sql_line assigning &lt;fs_parsed_sql_line&gt;. concatenate ` ` &lt;fs_parsed_sql_line&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span> ` ` <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> &lt;fs_parsed_sql_line&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span>. translate &lt;fs_parsed_sql_line&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> upper <span class="hljs-keyword"><span class="hljs-keyword">case</span></span>. "  into‚Ä¶  1 ,      " <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> &lt;fs_parsed_sql_line&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span> = <span class="hljs-string"><span class="hljs-string">' FROM '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> l_sub_order <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> initial. append `<span class="hljs-keyword"><span class="hljs-keyword">into</span></span> corresponding fields <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> fs_data` <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> code. l_sub_order = <span class="hljs-string"><span class="hljs-string">'X'</span></span>. endif. append &lt;fs_parsed_sql_line&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> code. endloop. endloop. append `.` <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> code. append `<span class="hljs-keyword"><span class="hljs-keyword">rollback</span></span> <span class="hljs-keyword"><span class="hljs-keyword">work</span></span>.` <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> code. append `catch cx_root.` <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> code. append `<span class="hljs-keyword"><span class="hljs-keyword">rollback</span></span> <span class="hljs-keyword"><span class="hljs-keyword">work</span></span>.` <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> code. append `message ``-   ,  `` <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ``i``.` <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> code. append `endtry.` <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> code. append `endform.` <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> code. generate subroutine pool code <span class="hljs-type"><span class="hljs-type">name</span></span> prog message msg.</code> </pre></div></div><br><h5>  Displaying the result on the screen </h5><br>  Since the composition of the fields and their type are unknown to us in advance, to obtain the result and display it on the screen, we need to dynamically generate the internal table and the ALV-Grid structure based on the fields selected in the query.  For this we will use the <b>create_dynamic_table</b> method of the <b>cl_alv_table_create</b> class. <br><br><div class="spoiler">  <b class="spoiler_title">Code snippet generating the ALV-Grid structure</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">data: ref_table_descr <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> cl_abap_structdescr, lt_tab_struct <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> abap_compdescr_tab, ls_fieldcatalog <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> slis_fieldcat_alv. field-symbols: &lt;fs_tab_struct&gt; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> abap_compdescr, &lt;fs_tables&gt; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ty_simple_struc, &lt;fs_fields&gt; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ty_simple_struc. <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> at lt_tables assigning &lt;fs_tables&gt;. <span class="hljs-keyword"><span class="hljs-keyword">refresh</span></span> lt_tab_struct. "      " ref_table_descr ?= cl_abap_typedescr=&gt;describe_by_name( &lt;fs_tables&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span> ). lt_tab_struct[] = ref_table_descr-&gt;components[]. <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> at lt_tab_struct assigning &lt;fs_tab_struct&gt;. "       SQL- -     " <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> lines( lt_fields ) &gt; <span class="hljs-number"><span class="hljs-number">0.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> lt_fields transporting <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> fields <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> key <span class="hljs-type"><span class="hljs-type">line</span></span> = &lt;fs_tab_struct&gt;-<span class="hljs-type"><span class="hljs-type">name</span></span>. <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sy-subrc &lt;&gt; <span class="hljs-number"><span class="hljs-number">0.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>. endif. endif. "       ,    " <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> lt_fieldcatalog transporting <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> fields <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> key fieldname = &lt;fs_tab_struct&gt;-<span class="hljs-type"><span class="hljs-type">name</span></span>. <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sy-subrc = <span class="hljs-number"><span class="hljs-number">0.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>. endif. clear ls_fieldcatalog. ls_fieldcatalog-fieldname = &lt;fs_tab_struct&gt;-<span class="hljs-type"><span class="hljs-type">name</span></span>. ls_fieldcatalog-ref_tabname = &lt;fs_tables&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span>. append ls_fieldcatalog <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> lt_fieldcatalog. endloop. endloop. "     COUNT() ‚Äì     CNT   INT" <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> l_use_cnt = <span class="hljs-string"><span class="hljs-string">'X'</span></span>. clear ls_fieldcatalog. ls_fieldcatalog-fieldname = <span class="hljs-string"><span class="hljs-string">'CNT'</span></span>. ls_fieldcatalog-seltext_l = <span class="hljs-string"><span class="hljs-string">'-'</span></span>. ls_fieldcatalog-seltext_m = <span class="hljs-string"><span class="hljs-string">'-'</span></span>. ls_fieldcatalog-seltext_s = <span class="hljs-string"><span class="hljs-string">'-'</span></span>. ls_fieldcatalog-datatype = <span class="hljs-string"><span class="hljs-string">'INT4'</span></span>. <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> p_tech_names = <span class="hljs-string"><span class="hljs-string">'X'</span></span>. ls_fieldcatalog-seltext_l = <span class="hljs-string"><span class="hljs-string">'CNT'</span></span>. ls_fieldcatalog-seltext_m = <span class="hljs-string"><span class="hljs-string">'CNT'</span></span>. ls_fieldcatalog-seltext_s = <span class="hljs-string"><span class="hljs-string">'CNT'</span></span>. ls_fieldcatalog-reptext_ddic = <span class="hljs-string"><span class="hljs-string">'CNT'</span></span>. endif. append ls_fieldcatalog <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> lt_fieldcatalog. endif.</code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">The dynamic code snippet</b> <div class="spoiler_text"><pre> <code class="bash hljs">data: dyn_table <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> ref to data, dyn_line <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> ref to data, lt_lvc_fieldcatalog <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> lvc_t_fcat, ls_lvc_fieldcatalog <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> lvc_s_fcat. field-symbols: &lt;fs_fieldcatalog&gt; <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> slis_fieldcat_alv. <span class="hljs-string"><span class="hljs-string">"     "</span></span> loop at lt_fieldcatalog assigning &lt;fs_fieldcatalog&gt;. clear ls_lvc_fieldcatalog. move-corresponding &lt;fs_fieldcatalog&gt; to ls_lvc_fieldcatalog. ls_lvc_fieldcatalog-ref_table = &lt;fs_fieldcatalog&gt;-ref_tabname. append ls_lvc_fieldcatalog to lt_lvc_fieldcatalog. endloop. <span class="hljs-string"><span class="hljs-string">"   "</span></span> call method cl_alv_table_create=&gt;create_dynamic_table exporting it_fieldcatalog = lt_lvc_fieldcatalog importing ep_table = dyn_table. assign dyn_table-&gt;* to &lt;fs_data&gt;. create data dyn_line like line of &lt;fs_data&gt;. assign dyn_line-&gt;* to &lt;fs_wa_data&gt;.</code> </pre></div></div><br>  Full listing of source code of the ZSQL program: <br><br><div class="spoiler">  <b class="spoiler_title">To uncover</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span>-pools: slis. <span class="hljs-keyword"><span class="hljs-keyword">types</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> ty_simple_struc, line(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> c, <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> ty_simple_struc. <span class="hljs-keyword"><span class="hljs-keyword">types</span></span>: ty_simple_tab <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> standard <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> ty_simple_struc. <span class="hljs-keyword"><span class="hljs-keyword">types</span></span>: ty_t_code <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> standard <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> rssource-<span class="hljs-type"><span class="hljs-type">line</span></span>. data: g_editor <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> cl_gui_textedit, g_editor_container <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> cl_gui_custom_container, g_ok_code <span class="hljs-keyword"><span class="hljs-keyword">like</span></span> sy-ucomm, p_tech_names(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> c. field-symbols: &lt;fs_data&gt; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> standard <span class="hljs-keyword"><span class="hljs-keyword">table</span></span>, &lt;fs_wa_data&gt; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span>. <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> screen <span class="hljs-number"><span class="hljs-number">100.</span></span> module pbo output. <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> pf-status `MAIN100`. "       SQL-" <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> g_editor <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> initial. <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> g_editor_container exporting container_name = `MYEDIT` exceptions cntl_error = <span class="hljs-number"><span class="hljs-number">1</span></span> cntl_system_error = <span class="hljs-number"><span class="hljs-number">2</span></span> create_error = <span class="hljs-number"><span class="hljs-number">3</span></span> lifetime_error = <span class="hljs-number"><span class="hljs-number">4</span></span> lifetime_dynpro_dynpro_link = <span class="hljs-number"><span class="hljs-number">5.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> g_editor exporting parent = g_editor_container wordwrap_mode = cl_gui_textedit=&gt;wordwrap_at_fixed_position wordwrap_to_linebreak_mode = cl_gui_textedit=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span> exceptions others = <span class="hljs-number"><span class="hljs-number">1.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sy-subrc &lt;&gt; <span class="hljs-number"><span class="hljs-number">0.</span></span> leave program. endif. endif. endmodule. module pai <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>. <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> sy-ucomm. <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> `<span class="hljs-keyword"><span class="hljs-keyword">EXIT</span></span>`. leave program. <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> `EXEC`. "   ¬´¬ª perform exec. endcase. endmodule. form exec. "     " data lt_sql_query type ty_simple_tab. clear lt_sql_query. call method g_editor-&gt;get_text_as_r3table importing table = lt_sql_query exceptions others = 1. delete lt_sql_query where line = ''. "         " data: lt_fields type ty_simple_tab, lt_tables type ty_simple_tab, l_use_cnt(1) type c. clear: lt_fields, lt_tables, l_use_cnt. perform parse_sql_query using lt_sql_query changing lt_fields lt_tables l_use_cnt. "  ABAP-   <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span>-" data: code type ty_t_code, prog(8) type c, msg(120) type c. clear: code, prog, msg. perform create_get_function using lt_sql_query changing code. generate subroutine pool code name prog message msg. if sy-subrc &lt;&gt; 0. message msg type 'I'. return. endif. "   ALV-Grid      " data: lt_fieldcatalog type slis_t_fieldcat_alv. refresh: lt_fieldcatalog. perform get_fieldcat using lt_tables lt_fields p_tech_names l_use_cnt changing lt_fieldcatalog. " ,      ,   &lt;fs_data&gt;, "       " <span class="hljs-keyword"><span class="hljs-keyword">perform</span></span> create_itab_dynamically <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> lt_fieldcatalog. "  SQL-,     " <span class="hljs-keyword"><span class="hljs-keyword">perform</span></span> get_data <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> program (prog) <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> &lt;fs_data&gt;. "    " <span class="hljs-keyword"><span class="hljs-keyword">perform</span></span> show_alv <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> lt_fieldcatalog. endform. "   " form parse_sql_query <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> lt_sql_query <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ty_simple_tab changing lt_fields <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ty_simple_tab lt_tables <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ty_simple_tab l_use_cnt. data: l_field_names_obtained(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> c, l_is_tabname(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> c, lt_parsed_sql_line <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ty_simple_tab. clear: l_field_names_obtained, l_is_tabname. field-symbols: &lt;fs_sql_query&gt; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ty_simple_struc, &lt;fs_parsed_sql_line&gt; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ty_simple_struc. constants: con_tab <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> cl_abap_char_utilities=&gt;horizontal_tab. "   " <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> at lt_sql_query assigning &lt;fs_sql_query&gt;. "   - replace all occurrences of con_tab in &lt;fs_sql_query&gt;-line with space. concatenate ` ` &lt;fs_sql_query&gt;-line ` ` into &lt;fs_sql_query&gt;-line. "     " refresh lt_parsed_sql_line. split &lt;fs_sql_query&gt;-line at space into table lt_parsed_sql_line. delete lt_parsed_sql_line where line = ''. loop at lt_parsed_sql_line assigning &lt;fs_parsed_sql_line&gt;. translate &lt;fs_parsed_sql_line&gt;-line to upper case. if &lt;fs_parsed_sql_line&gt;-line = 'SELECT'. continue. endif. "    * - ,     " if &lt;fs_parsed_sql_line&gt;-line = '*'. l_field_names_obtained = 'X'. continue. endif. "    <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span>  <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> - ,     . "     " <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> &lt;fs_parsed_sql_line&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span> = <span class="hljs-string"><span class="hljs-string">'FROM'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> &lt;fs_parsed_sql_line&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span> = <span class="hljs-string"><span class="hljs-string">'JOIN'</span></span>. l_field_names_obtained = <span class="hljs-string"><span class="hljs-string">'X'</span></span>. l_is_tabname = <span class="hljs-string"><span class="hljs-string">'X'</span></span>. <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>. endif. "   " <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> l_field_names_obtained <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> initial. "   COUNT()" find <span class="hljs-string"><span class="hljs-string">'COUNT('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;fs_parsed_sql_line&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span> ignoring <span class="hljs-keyword"><span class="hljs-keyword">case</span></span>. <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sy-subrc = <span class="hljs-number"><span class="hljs-number">0.</span></span> l_use_cnt = <span class="hljs-string"><span class="hljs-string">'X'</span></span>. <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>. endif. "        ~" <span class="hljs-keyword"><span class="hljs-keyword">search</span></span> &lt;fs_parsed_sql_line&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-string"><span class="hljs-string">'~'</span></span>. <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sy-subrc = <span class="hljs-number"><span class="hljs-number">0.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> sy-fdpos. endif. append &lt;fs_parsed_sql_line&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span>+sy-fdpos <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> lt_fields. endif. "   " <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> l_is_tabname = <span class="hljs-string"><span class="hljs-string">'X'</span></span>. append &lt;fs_parsed_sql_line&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> lt_tables. clear l_is_tabname. endif. endloop. endloop. endform. "     ABAP-   " form create_get_function <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> lt_sql_query <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ty_simple_tab changing code <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ty_t_code. data: lt_parsed_sql_line <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ty_simple_tab, l_sub_order(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> c. clear l_sub_order. field-symbols: &lt;fs_sql_query&gt; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ty_simple_struc, &lt;fs_parsed_sql_line&gt; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ty_simple_struc. append `program z_sql.` <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> code. append `form get_data <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> fs_data <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> standard <span class="hljs-keyword"><span class="hljs-keyword">table</span></span>.` <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> code. append `try.` <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> code. <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> at lt_sql_query assigning &lt;fs_sql_query&gt;. clear: lt_parsed_sql_line. split &lt;fs_sql_query&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span> at space <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> lt_parsed_sql_line. <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> lt_parsed_sql_line <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-type"><span class="hljs-type">line</span></span> = <span class="hljs-string"><span class="hljs-string">''</span></span>. <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> at lt_parsed_sql_line assigning &lt;fs_parsed_sql_line&gt;. concatenate ` ` &lt;fs_parsed_sql_line&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span> ` ` <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> &lt;fs_parsed_sql_line&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span>. translate &lt;fs_parsed_sql_line&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> upper <span class="hljs-keyword"><span class="hljs-keyword">case</span></span>. "  into‚Ä¶  1 ,      " <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> &lt;fs_parsed_sql_line&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span> = <span class="hljs-string"><span class="hljs-string">' FROM '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> l_sub_order <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> initial. append `<span class="hljs-keyword"><span class="hljs-keyword">into</span></span> corresponding fields <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> fs_data` <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> code. l_sub_order = <span class="hljs-string"><span class="hljs-string">'X'</span></span>. endif. append &lt;fs_parsed_sql_line&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> code. endloop. endloop. append `.` <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> code. append `<span class="hljs-keyword"><span class="hljs-keyword">rollback</span></span> <span class="hljs-keyword"><span class="hljs-keyword">work</span></span>.` <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> code. append `catch cx_root.` <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> code. append `<span class="hljs-keyword"><span class="hljs-keyword">rollback</span></span> <span class="hljs-keyword"><span class="hljs-keyword">work</span></span>.` <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> code. append `message ``-   ,  `` <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ``i``.` <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> code. append `endtry.` <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> code. append `endform.` <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> code. endform. "    ALV-" form get_fieldcat <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> lt_tables <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ty_simple_tab lt_fields <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ty_simple_tab p_tech_names l_use_cnt changing lt_fieldcatalog <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> slis_t_fieldcat_alv. data: ref_table_descr <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> cl_abap_structdescr, lt_tab_struct <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> abap_compdescr_tab, ls_fieldcatalog <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> slis_fieldcat_alv. field-symbols: &lt;fs_tab_struct&gt; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> abap_compdescr, &lt;fs_tables&gt; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ty_simple_struc, &lt;fs_fields&gt; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ty_simple_struc. <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> at lt_tables assigning &lt;fs_tables&gt;. <span class="hljs-keyword"><span class="hljs-keyword">refresh</span></span> lt_tab_struct. "      " ref_table_descr ?= cl_abap_typedescr=&gt;describe_by_name( &lt;fs_tables&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span> ). lt_tab_struct[] = ref_table_descr-&gt;components[]. <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> at lt_tab_struct assigning &lt;fs_tab_struct&gt;. "       SQL- -     " <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> lines( lt_fields ) &gt; <span class="hljs-number"><span class="hljs-number">0.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> lt_fields transporting <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> fields <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> key <span class="hljs-type"><span class="hljs-type">line</span></span> = &lt;fs_tab_struct&gt;-<span class="hljs-type"><span class="hljs-type">name</span></span>. <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sy-subrc &lt;&gt; <span class="hljs-number"><span class="hljs-number">0.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>. endif. endif. "       ,    " <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> lt_fieldcatalog transporting <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> fields <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> key fieldname = &lt;fs_tab_struct&gt;-<span class="hljs-type"><span class="hljs-type">name</span></span>. <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sy-subrc = <span class="hljs-number"><span class="hljs-number">0.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>. endif. clear ls_fieldcatalog. ls_fieldcatalog-fieldname = &lt;fs_tab_struct&gt;-<span class="hljs-type"><span class="hljs-type">name</span></span>. ls_fieldcatalog-ref_tabname = &lt;fs_tables&gt;-<span class="hljs-type"><span class="hljs-type">line</span></span>. append ls_fieldcatalog <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> lt_fieldcatalog. endloop. endloop. "     COUNT() ‚Äì     CNT   INT" <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> l_use_cnt = <span class="hljs-string"><span class="hljs-string">'X'</span></span>. clear ls_fieldcatalog. ls_fieldcatalog-fieldname = <span class="hljs-string"><span class="hljs-string">'CNT'</span></span>. ls_fieldcatalog-seltext_l = <span class="hljs-string"><span class="hljs-string">'-'</span></span>. ls_fieldcatalog-seltext_m = <span class="hljs-string"><span class="hljs-string">'-'</span></span>. ls_fieldcatalog-seltext_s = <span class="hljs-string"><span class="hljs-string">'-'</span></span>. ls_fieldcatalog-datatype = <span class="hljs-string"><span class="hljs-string">'INT4'</span></span>. <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> p_tech_names = <span class="hljs-string"><span class="hljs-string">'X'</span></span>. ls_fieldcatalog-seltext_l = <span class="hljs-string"><span class="hljs-string">'CNT'</span></span>. ls_fieldcatalog-seltext_m = <span class="hljs-string"><span class="hljs-string">'CNT'</span></span>. ls_fieldcatalog-seltext_s = <span class="hljs-string"><span class="hljs-string">'CNT'</span></span>. ls_fieldcatalog-reptext_ddic = <span class="hljs-string"><span class="hljs-string">'CNT'</span></span>. endif. append ls_fieldcatalog <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> lt_fieldcatalog. endif. endform. "     " form create_itab_dynamically <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> lt_fieldcatalog <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> slis_t_fieldcat_alv. data: dyn_table <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> data, dyn_line <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> data, lt_lvc_fieldcatalog <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> lvc_t_fcat, ls_lvc_fieldcatalog <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> lvc_s_fcat. field-symbols: &lt;fs_fieldcatalog&gt; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> slis_fieldcat_alv. "     " <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> at lt_fieldcatalog assigning &lt;fs_fieldcatalog&gt;. clear ls_lvc_fieldcatalog. <span class="hljs-keyword"><span class="hljs-keyword">move</span></span>-corresponding &lt;fs_fieldcatalog&gt; <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> ls_lvc_fieldcatalog. ls_lvc_fieldcatalog-ref_table = &lt;fs_fieldcatalog&gt;-ref_tabname. append ls_lvc_fieldcatalog <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> lt_lvc_fieldcatalog. endloop. "   " <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> cl_alv_table_create=&gt;create_dynamic_table exporting it_fieldcatalog = lt_lvc_fieldcatalog importing ep_table = dyn_table. assign dyn_table-&gt;* <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> &lt;fs_data&gt;. <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> data dyn_line <span class="hljs-keyword"><span class="hljs-keyword">like</span></span> <span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> &lt;fs_data&gt;. assign dyn_line-&gt;* <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> &lt;fs_wa_data&gt;. endform. "   ALV-Grid  " form show_alv <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> lt_fieldcatalog <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> slis_t_fieldcat_alv. data: ls_event <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> slis_alv_event, lt_event <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> slis_t_event, ls_layout <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> slis_layout_alv, l_repid <span class="hljs-keyword"><span class="hljs-keyword">like</span></span> sy-repid. ls_layout-colwidth_optimize = <span class="hljs-string"><span class="hljs-string">'X'</span></span>. l_repid = sy-repid. <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-string"><span class="hljs-string">'REUSE_ALV_GRID_DISPLAY'</span></span> exporting i_callback_program = l_repid is_layout = ls_layout it_fieldcat = lt_fieldcatalog i_save = <span class="hljs-string"><span class="hljs-string">'X'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">tables</span></span> t_outtab = &lt;fs_data&gt; exceptions program_error = <span class="hljs-number"><span class="hljs-number">1</span></span> others = <span class="hljs-number"><span class="hljs-number">2.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sy-subrc &lt;&gt; <span class="hljs-number"><span class="hljs-number">0.</span></span> leave program. endif. endform.</code> </pre></div></div><br>  The developed program allows you to perform Open SQL SELECT queries of any complexity.  It is only necessary to observe one rule when writing a query: if the COUNT () construct is used, then ‚ÄúAS cnt‚Äù must be added after it in order for the ALV-Grid to be generated correctly. <br><br>  The program, in theory, can be slightly refined and used not only for testing requests, but also for generating custom reports. <br><br>  In the article, I did not address security issues.  An incoming request is not checked for correctness in any way, after it you can write any ABAP code and it will be executed.  To exclude this possibility, it suffices to add simple checks. <br><br>  <b><u>Full source code</u></b> : <a href="https://github.com/RusZ/SAP-SQL-Executor">https://github.com/RusZ/SAP-SQL-Executor</a> </div><p>Source: <a href="https://habr.com/ru/post/251665/">https://habr.com/ru/post/251665/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../251647/index.html">Futuristic thinking</a></li>
<li><a href="../251649/index.html">Another way to organize OOP in JS</a></li>
<li><a href="../251653/index.html">McPaintio - a program that converts an image into a set of mouse commands that draw this image</a></li>
<li><a href="../251659/index.html">Backup Linux and restore it on another hardware</a></li>
<li><a href="../251663/index.html">How can a sysadmin stay out of work</a></li>
<li><a href="../251669/index.html">How REST-architecture affects the speed and reliability of the site</a></li>
<li><a href="../251675/index.html">How we prepare future big data specialists</a></li>
<li><a href="../251683/index.html">LotCat</a></li>
<li><a href="../251687/index.html">Conversational bot for Vkontakte in PHP</a></li>
<li><a href="../251689/index.html">6 principles of visual hierarchy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>