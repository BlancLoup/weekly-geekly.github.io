<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to avoid SQL queries inside loops</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will try to show how to avoid one of the signs of the "decaying" code, namely SQL queries inside loops. The examples will be in plai...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to avoid SQL queries inside loops</h1><div class="post__text post__text-html js-mediator-article">  In this article I will try to show how to avoid one of the signs of the "decaying" code, namely SQL queries inside loops.  The examples will be in plain PHP without using OOP.  This will greatly facilitate understanding.  Reading will take from 5 to 10 minutes. <br><a name="habracut"></a><br><h4>  Why should you avoid queries inside loops? </h4><br>  Everything is very simple.  Each request is a loss of time for "preparatory" and "final" operations for accessing the database.  Suppose for each product there is a separate table for pictures, discounts and some options (for example, the choice of the color of the dress).  That is, to obtain information about each product, you will need to fulfill 3 requests.  Those.  300 requests for withdrawal of 100 products + request for a list of products.  Total 301 requests for 100 products.  And as a result, a significant decrease in the performance of your application.  This can and should be avoided. <br><br>  Below is a piece of code from OpenCart 3: <br><br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getProducts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($data = array</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//..... $query = $this-&gt;db-&gt;query($sql); foreach ($query-&gt;rows as $result) { // for never get one more time with same product id if(!isset($product_data[$result['product_id']])){ $product_data[$result['product_id']] = $this-&gt;getProduct($result['product_id']); } } return $product_data; } /* $this-&gt;getProduct($result['product_id'])   1   . ..  getProducts  product_id-  ,     ""      .    (). */</span></span></code> </pre> <br><h4>  Task for optimization </h4><br>  Consider a problem with two tables - Products and Prices.  One product may have several prices of different types.  The result must be obtained as an array: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="php hljs">print_r($products) <span class="hljs-comment"><span class="hljs-comment">/* Array ( [1] =&gt; Array ( [product_id] =&gt; 1 [name] =&gt;  1 [prices] =&gt; Array ( [0] =&gt; Array ( [price_id] =&gt; 45 [product_id] =&gt; 1 [type] =&gt; 3 [price] =&gt; 95.00 ) [1] =&gt; Array ( [price_id] =&gt; 55 [product_id] =&gt; 1 [type] =&gt; 1 [price] =&gt; 90.00 ) [2] =&gt; Array ( [price_id] =&gt; 58 [product_id] =&gt; 1 [type] =&gt; 2 [price] =&gt; 90.00 ) ) ) ) */</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Product table:</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> ( <span class="hljs-string"><span class="hljs-string">`product_id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`name`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`product_id`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8; <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">' 1'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">' 2'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">' 3'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">' 4'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">' 5'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">' 6'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">' 7'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">' 8'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-string"><span class="hljs-string">' 9'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product`</span></span> (<span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">' 10'</span></span>);</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Price Table:</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> ( <span class="hljs-string"><span class="hljs-string">`price_id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span> enum(<span class="hljs-string"><span class="hljs-string">'1'</span></span>,<span class="hljs-string"><span class="hljs-string">'2'</span></span>,<span class="hljs-string"><span class="hljs-string">'3'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">decimal</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">71</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8; <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">55</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-number"><span class="hljs-number">90.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">58</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'2'</span></span>, <span class="hljs-number"><span class="hljs-number">90.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">45</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'3'</span></span>, <span class="hljs-number"><span class="hljs-number">95.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">56</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-number"><span class="hljs-number">90.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">49</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'2'</span></span>, <span class="hljs-number"><span class="hljs-number">45.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">42</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'3'</span></span>, <span class="hljs-number"><span class="hljs-number">96.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">57</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-number"><span class="hljs-number">23.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">47</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'2'</span></span>, <span class="hljs-number"><span class="hljs-number">53.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">51</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'3'</span></span>, <span class="hljs-number"><span class="hljs-number">12.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">43</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-number"><span class="hljs-number">89.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">46</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'2'</span></span>, <span class="hljs-number"><span class="hljs-number">4.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">52</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'3'</span></span>, <span class="hljs-number"><span class="hljs-number">15.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">54</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-number"><span class="hljs-number">43.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">41</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">'2'</span></span>, <span class="hljs-number"><span class="hljs-number">44.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">48</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">'3'</span></span>, <span class="hljs-number"><span class="hljs-number">34.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">44</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-number"><span class="hljs-number">26.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">59</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'2'</span></span>, <span class="hljs-number"><span class="hljs-number">26.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'3'</span></span>, <span class="hljs-number"><span class="hljs-number">26.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">53</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-number"><span class="hljs-number">87.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">61</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">'2'</span></span>, <span class="hljs-number"><span class="hljs-number">87.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">'3'</span></span>, <span class="hljs-number"><span class="hljs-number">77.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">62</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-number"><span class="hljs-number">77.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">63</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">'2'</span></span>, <span class="hljs-number"><span class="hljs-number">77.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">'3'</span></span>, <span class="hljs-number"><span class="hljs-number">77.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">65</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-number"><span class="hljs-number">77.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">66</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-string"><span class="hljs-string">'2'</span></span>, <span class="hljs-number"><span class="hljs-number">77.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">67</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-string"><span class="hljs-string">'3'</span></span>, <span class="hljs-number"><span class="hljs-number">77.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">68</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-number"><span class="hljs-number">77.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">69</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">'2'</span></span>, <span class="hljs-number"><span class="hljs-number">77.00</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`product_price`</span></span> (<span class="hljs-string"><span class="hljs-string">`price_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`product_id`</span></span>, <span class="hljs-string"><span class="hljs-string">`type`</span></span>, <span class="hljs-string"><span class="hljs-string">`price`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">70</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">'3'</span></span>, <span class="hljs-number"><span class="hljs-number">77.00</span></span>);</code> </pre><br></div></div><br>  Variant with queries inside loops: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> define(<span class="hljs-string"><span class="hljs-string">'DB_HOST'</span></span> , <span class="hljs-string"><span class="hljs-string">'localhost'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'DB_USER'</span></span> , <span class="hljs-string"><span class="hljs-string">'mysqluser'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'DB_PASSWORD'</span></span> , <span class="hljs-string"><span class="hljs-string">'password'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'DB_NAME'</span></span> , <span class="hljs-string"><span class="hljs-string">'habr'</span></span>); $conn = mysqli_connect(DB_HOST , DB_USER , DB_PASSWORD) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>(<span class="hljs-string"><span class="hljs-string">'Can not connect to db'</span></span>); mysqli_select_db($conn , DB_NAME) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>(mysqli_error($conn)); mysqli_query($conn , <span class="hljs-string"><span class="hljs-string">'SET NAMES utf8'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   - 7 . $sql = 'select * from product'; $product_result = mysqli_query($conn , $sql); //       $products = array(); while ($product = mysqli_fetch_assoc($product_result)) { //     . $prices = array(); $sql = 'select * from product_price WHERE product_id = ' . (int) $product['product_id']; $price_result = mysqli_query($conn , $sql); while ($price = mysqli_fetch_assoc($price_result)) { $prices[] = $price; } //      $product['prices'] = $prices; //     $products[] = $product; } print_r($products); if ($conn) { mysqli_close($conn); }</span></span></code> </pre><br>  So, in order to display 7 products we made 1 + 7 requests.  How to optimize: <br><br><ol><li>  Choose products from the table.  We place them into an array, but we will use product_id as keys; </li><li>  Choose all prices for the items found; </li><li>  Found prices "we shove" on the goods. </li></ol><br>  The same, but in plain language PHP: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> define(<span class="hljs-string"><span class="hljs-string">'DB_HOST'</span></span> , <span class="hljs-string"><span class="hljs-string">'localhost'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'DB_USER'</span></span> , <span class="hljs-string"><span class="hljs-string">'mysqluser'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'DB_PASSWORD'</span></span> , <span class="hljs-string"><span class="hljs-string">'password'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'DB_NAME'</span></span> , <span class="hljs-string"><span class="hljs-string">'habr'</span></span>); $conn = mysqli_connect(DB_HOST , DB_USER , DB_PASSWORD) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>(<span class="hljs-string"><span class="hljs-string">'Can not connect to db'</span></span>); mysqli_select_db($conn , DB_NAME) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>(mysqli_error($conn)); mysqli_query($conn , <span class="hljs-string"><span class="hljs-string">'SET NAMES utf8'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// 3  $sql = 'select * from product LIMIT 3'; $product_result = mysqli_query($conn , $sql); //       $products = array(); while ($product = mysqli_fetch_assoc($product_result)) { //  $product['prices'] = array(); //  .      product_id $products[(int) $product['product_id']] = $product; } //   ,     . if (count($products) &gt; 0 ) { //  product_id-       . $product_ids = array_keys($products); //    $sql = 'select * from product_price where product_id in (' . implode(',' , $product_ids ). ')'; $prices_result = mysqli_query($conn , $sql) or die(mysqli_error($conn)); while ($price = mysqli_fetch_assoc($prices_result)) { $products[(int) $price['product_id']]['prices'][] = $price; } } print_r($products); if ($conn) { mysqli_close($conn); }</span></span></code> </pre><br>  So now, to select any number of products, you will need to complete only 2 requests.  The work of such a script will have a tangible difference on samples of a large number of goods.  This approach can be generalized.  For example, avoid cycle access to external resources (file system, memcache, redis), if this is possible.  And remember the principle of rationality in the decisions made. </div><p>Source: <a href="https://habr.com/ru/post/350468/">https://habr.com/ru/post/350468/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../350456/index.html">Digital events in Moscow from March 5 to 11</a></li>
<li><a href="../350458/index.html">Publish the game on Google Play. Configuring Play Games Plugin for Unity</a></li>
<li><a href="../350462/index.html">Configuring VoIP FXS of the Yeastar Neogate TAXXX gateway to work with 3CX</a></li>
<li><a href="../350464/index.html">Fintech news. Another pair of national cryptocurrency and cryptonalogues</a></li>
<li><a href="../350466/index.html">Adaptive Layout with SCSS and Gulp</a></li>
<li><a href="../350470/index.html">Hacking Nuclear Crackme</a></li>
<li><a href="../350472/index.html">On the black market they sell valid signature certificates of executable code to bypass antiviruses</a></li>
<li><a href="../350474/index.html">SOC is people. How to build a team in terms of personnel hunger</a></li>
<li><a href="../350476/index.html">One-to-many translation: do you need a media server?</a></li>
<li><a href="../350478/index.html">Emotion AI and Emotional Technologies: Neurodata Lab and NRU ITMO Conference</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>