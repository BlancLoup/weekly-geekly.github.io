<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Traits in php 5.4. Parse implementation details</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Most recently , the first beta php 5.4 was released , but for now I wrote a topic and the second one arrived . One of the innovations in 5.4 is traits...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Traits in php 5.4. Parse implementation details</h1><div class="post__text post__text-html js-mediator-article">  Most recently <a href="http://habrahabr.ru/blogs/php/128544/">, the first beta php 5.4 was released</a> , but for now I wrote a topic <a href="http://habrahabr.ru/blogs/php/130806/">and the second one arrived</a> .  One of the innovations in 5.4 is traits (types).  I propose to understand all the details of what types are of themselves in php. <br><br>  A simple example of a type, so as not to look <a href="http://en.wikipedia.org/wiki/Trait_(computer_programming)">at Wikipedia</a> : <pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//  trait Pprint { public function whoAmI() { return get_class($this) . ': ' . (string) $this; } } class Human { use Pprint; // ,   use protected $_name = 'unknown'; public function __construct($name) { $this-&gt;_name = $name; } public function __toString() { return (string) $this-&gt;_name; } } $a = new Human('Nikita'); echo $a-&gt;whoAmI(), PHP_EOL; //=&gt; Human: Nikita</span></span></code> </pre> <br>  As you can see, the behavior from the <code>Pprint</code> type has been added to the <code>Human</code> class. <br><br>  But everything has its own details. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Syntax </h2><br>  In general, everything is simple.  You can connect types to an unlimited number of classes through one or more <code>use</code> constructs within the class definition.  <code>use</code> can be specified anywhere in the class. <br><br>  Additionally in the block ( <code>{...}</code> ) after <code>use</code> you can: <br><ul><li>  assign alias to type methods ( <code>Trait::method <strong>as</strong> myMethod</code> - the <code>method</code> from Trait will be additionally available, like <code>myMethod</code> ); </li><li>  specify the overlap of the method of one type, the method of the other, if they have the same name ( <code>TraitA::method <strong>insteadof</strong> TraitB</code> - the <code>TraitA</code> method will be used instead of the <code>TraitB</code> method of the same name); </li><li>  To increase or decrease access to the method from the type, with the exception of transferring a method to a static one ( <code>Trait::publicMethod as <strong>protected</strong></code> ), you can immediately rename it ( <code>Trait::publicMethod as <strong>protected _myProtectedMethod</strong></code> ). </li></ul><br>  The type itself is recorded as a <code>trait</code> and may include other types, by specifying them in the <code>use</code> keyword.  The syntax and capabilities are similar to <code>use</code> in a class. <br><br>  More complicated example: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">trait</span></span> Pprint { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">whoAmI</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> get_class(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>) . <span class="hljs-string"><span class="hljs-string">': '</span></span> . (string) <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">trait</span></span> Namer { <span class="hljs-comment"><span class="hljs-comment">//     use Pprint; public function getMyName() { return $this-&gt;whoAmI(); } public function getMyLastName() { return 'Unknown =('; } public function getMyNickname() { return preg_replace('/[^az]+/i', '_', strtolower($this-&gt;getMyName())); } } trait SuperNamer { public function getMyLastName() { return 'Ask me'; } } class Human { use SuperNamer; use Namer { SuperNamer::getMyLastName insteadof Namer; Namer::getMyNickname as protected _getMyLogin; } protected $_name = 'unknown'; public function __construct($name) { $this-&gt;_name = $name; } public function __toString() { return (string) $this-&gt;_name; } public function getLogin() { return $this-&gt;_getMyLogin(); } } $a = new Human('Nikita'); echo join(', ', get_class_methods($a)), PHP_EOL; //__construct, __toString, getLogin, getMyLastName, //getMyName, getMyNickname, whoAmI echo $a-&gt;getMyName(), PHP_EOL; //Human: Nikita echo $a-&gt;getMyLastName(), PHP_EOL; //Ask me echo $a-&gt;getLogin(), PHP_EOL; //human_nikita echo $a-&gt;getMyNickname(), PHP_EOL; //human_nikita</span></span></code> </pre><br>  It is important to pay attention to two points.  First, the block after <code>use</code> seems to be associated with the type around which it is described, but it is not.  The rules in the block are global and can be declared anywhere. <br><br>  In order to avoid confusion, it will be good practice to write down all types first, separated by commas, and then on a separate line, overlap rules and alias.  Or describe all the rules for the type next to its connection.  The choice is yours. <pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// use SuperNamer, Namer, Singleton, SomeOther { SuperNamer::getMyLastName insteadof Namer; SomeOther::getSomething as private; } //  use Namer; use Singleton; use SuperNamer { SuperNamer::getMyLastName insteadof Namer; } use SomeOther { SomeOther::getSomething as private; }</span></span></code> </pre><br>  Secondly, pay attention to the list of methods, <code>getMyNickname</code> remained in the list, and <code>_getMyLogin</code> just its alias with reduced access.  You can eliminate the original method at all, but more on that below in the section of magic. <br><br>  Types are initialized, like classes, dynamically.  With a great desire, you can write like this: <pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($isWin) { <span class="hljs-keyword"><span class="hljs-keyword">trait</span></span> A { <span class="hljs-comment"><span class="hljs-comment">/* ‚Ä¶ */</span></span>} } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">trait</span></span> A { <span class="hljs-comment"><span class="hljs-comment">/* ‚Ä¶ */</span></span>} }</code> </pre><br><h2>  Properties in types </h2><br>  Before that, I operated on methods, but the type may include properties that will be added to the class.  In this regard, "types" in php - it is rather a mixin. <pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">trait</span></span> WithId { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $_id = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_id; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_id = $id; } }</code> </pre><br>  Immediately I propose a good practice, so that once it does not turn out that the <code>_id</code> property in the type conflict with that used in the class or its descendants, the properties of the types write with the prefixes: <pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">trait</span></span> WithId { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $_WithId_id = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $_WithId_checked = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//... public function getId() { return $this-&gt;_WithId_id; } public function setId($id) { $this-&gt;_WithId_id = $id; } }</span></span></code> </pre><br><h2>  Area of ‚Äã‚Äãvisibility </h2><br>  It is important to understand how the various calls within the type will be resolved.  This will help the rule to think about connecting the type as ‚Äúcopy-paste‚Äù code into the target class.  In the very first example, the interpreter would have made the ‚Äúcopy-paste‚Äù of the <code>whoAmI</code> method into the <code>Human</code> class, respectively, all calls to <code>parent</code> , <code>self</code> , <code>$this</code> will work as well as the call in the class methods.  The exception will be some magic constants, for example inside <code>whoAmI</code> __METHOD__ === 'Pprint :: whoAmI'. <br><br>  Inside the type methods, all properties of the object are accessible for direct access, no additional scopes are added.  One would get just <code>$this-&gt;_name</code> , instead of calling <code>__toString</code> .  However, it is worth thinking a few times before doing this, since on complex implementations this will cause quite a bit of confusion.  I would recommend always using clear methods, if necessary, even describe them in the interface and "force" classes to implement it. <br><br><h2>  Static methods and properties </h2><br>  In a typesetter, you can declare static methods, but <strong>you cannot</strong> declare static properties.  Inside static methods, you can use both static binding (self: :) and dynamic (static: :), everything will work as if caused from the class method ("copy-paste"). <br><br>  Restriction on the storage of static properties can be circumvented, as it will show later with an appeal to magic. <br><br><h2>  The coincidence of methods of types between themselves and with the methods of the class </h2><br>  The method described in the class overrides the type of method.  But if a method is described in the parent class, and a type is connected in the child class with the same method, it <strong>will override the</strong> method from the parent class (again, recall ‚Äúcopy-paste‚Äù). <br><br>  If several methods specified by the class use the same methods, php will generate an error at the class initialization stage: <pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">trait</span></span> A { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">abc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} } <span class="hljs-keyword"><span class="hljs-keyword">trait</span></span> B { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">abc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">A</span></span>, <span class="hljs-title"><span class="hljs-title">B</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//Fatal error: Trait method abc has not been applied, //because there are collisions with other trait methods //on C in %FILE% on line %line%</span></span></code> </pre>  To the rescue comes <code>insteadof</code> , through which you will need to resolve all conflicts. <br><br>  A tricky mistake can be in the case when the class also has a method that caused a collision, in which case php will skip this check, since  he checks only the ‚Äúsurviving‚Äù type methods: <pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">trait</span></span> A { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">abc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} } <span class="hljs-keyword"><span class="hljs-keyword">trait</span></span> B { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">abc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">A</span></span>, <span class="hljs-title"><span class="hljs-title">B</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">abc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} } <span class="hljs-comment"><span class="hljs-comment">//OK</span></span></code> </pre>  Sometime later, by transferring the <code>abc</code> method to the parent class, we get a strange error on the collision of type methods, which can be confusing.  So, it is better to resolve conflicts in advance.  ( <em>On the other hand, if the type and class methods in the code are the same, something is probably wrong.</em> ) <br><br><h2>  The match of the properties of the type with the properties of another type and properties of the class </h2><br>  In this moment we face unpleasant problems.  Just an example: <pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">trait</span></span> WithId { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $_id = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//protected $_var = 'a'; public function getId() { return $this-&gt;_id; } //... } trait WithId2 { protected $_id = null; //protected $_var = null; //... } class A { use WithId, WithId2; } class B { use WithId2, WithId; } class C { use WithId; protected $_id = '0'; } // $a = new A(); var_dump($a-&gt;getId()); //NULL $b = new B(); var_dump($b-&gt;getId()); //false $c = new C(); var_dump($c-&gt;getId()); //false (!) //  $_var // WithId and WithId2 define the same property ($_var) // in the composition of A. However, the definition differs // and is considered incompatible. Class was composed // in %FILE% on line %LINE%</span></span></code> </pre><br>  I explain.  In the general case, when crossing the properties of the types between themselves or the properties of the type and class, an error is generated.  But for some reason for the "compatible" properties an exception is made and they work according to the principle "who is the last, that is right".  Therefore, in class <code>A</code> , <code>getId</code> was NULL, and in class <code>B</code> , false.  In this case, class properties are considered lower than the type property (with methods equal to the opposite) and in <code>C</code> instead of the expected '0', we get false. <br><br>  Compatible values ‚Äã‚Äãare considered to be non-strict comparison of which gives true, and since in php there are many implicit conversions, there can be unpleasant errors when using strictly comparing returned values. <br><pre> <code class="php hljs">var_dump(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span> == <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-comment"><span class="hljs-comment">//true var_dump('0' == false); //true var_dump('a' == null); //false</span></span></code> </pre><br>  So the practice with prefixes suggested above will be useful in such cases.  I hope that this part of the implementation will be revised to the release. <br><br><h2>  Errors and exceptions in types </h2><br>  If you follow the mnemonic rule trait == "copy-paste", everything becomes immediately clear with errors: <pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">trait</span></span> Slug { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">error</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;a; <span class="hljs-comment"><span class="hljs-comment">//5 } public function someMethod() { $this-&gt;error(); } public function testExc() { throw new Exception('Test'); //16 } } class Brain { use Slug; public function plurk() { $this-&gt;testExc(); //25 } } error_reporting(E_ALL); $b = new Brain(); $b-&gt;someMethod(); //Notice: Undefined property: Brain::$a in %FILE% on line 5 try { $b-&gt;plurk(); //35 } catch(Exception $e) { echo $e; } // exception 'Exception' with message 'Test' in %FILE%:16 // Stack trace: // #0 %FILE%(25): Brain-&gt;testExc() // #1 %FILE%(35): Brain-&gt;plurk() // #2 {main}</span></span></code> </pre><br>  The object no longer knows where it came from the method in which there was a Notice or Exception, but you can find out in the stack trace by the lines of code in which there were calls.  If you store types in separate files, it will be even easier to determine. <br><br><h2>  Little <s>white</s> black magic </h2><br>  I will show a couple of dirty tricks with types, use them at your own peril and risk. <br><br><h3>  Type removal method </h3><br>  To remove the type method, for example, when an alias was given to it, you can do this: <pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">trait</span></span> A { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} } <span class="hljs-keyword"><span class="hljs-keyword">trait</span></span> B { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">d</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;e(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">A</span></span> { //   <span class="hljs-title"><span class="hljs-title">A</span></span>::<span class="hljs-title"><span class="hljs-title">b</span></span> <span class="hljs-title"><span class="hljs-title">insteadof</span></span> <span class="hljs-title"><span class="hljs-title">A</span></span>; A::b <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> c; } <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">B</span></span> { //   <span class="hljs-title"><span class="hljs-title">B</span></span>::<span class="hljs-title"><span class="hljs-title">e</span></span> <span class="hljs-title"><span class="hljs-title">insteadof</span></span> <span class="hljs-title"><span class="hljs-title">B</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> join(<span class="hljs-string"><span class="hljs-string">", "</span></span>, get_class_methods(<span class="hljs-string"><span class="hljs-string">'C'</span></span>)), PHP_EOL; <span class="hljs-comment"><span class="hljs-comment">//a, c, d</span></span></code> </pre><br>  But in this approach lies a great danger, because  some methods of type can potentially call other methods: <pre> <code class="php hljs">$c = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> C(); $c-&gt;d(); <span class="hljs-comment"><span class="hljs-comment">//Fatal error: Call to undefined method C::e()</span></span></code> </pre><br>  When renaming a type, it does not know that the method has been renamed.  Therefore, by default, if you specify alias, the original method is preserved. <br><br><h3>  "Inheritance" in types </h3><br>  Using a similar trick, you can implement "inheritance" in types with the ability to call "parent" methods. <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">trait</span></span> Namer { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Name'</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">trait</span></span> Namer2 { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Name2'</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">trait</span></span> Supernamer { <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Namer</span></span>, <span class="hljs-title"><span class="hljs-title">Namer2</span></span> { <span class="hljs-title"><span class="hljs-title">Namer</span></span>::<span class="hljs-title"><span class="hljs-title">getName</span></span> <span class="hljs-title"><span class="hljs-title">insteadof</span></span> <span class="hljs-title"><span class="hljs-title">Namer</span></span>; Namer::getName <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> _Namer_getName_; Namer2::getName <span class="hljs-keyword"><span class="hljs-keyword">insteadof</span></span> Namer2; Namer2::getName <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> _Namer2_getName_; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_Namer_getName_() . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_Namer2_getName_(); } }</code> </pre><br><h2>  Two ways to implement Singleton with types </h2><br>  To smooth out this magical disgrace I will show one useful example.  Often, a Singleton is given as a type, although without the possibility of setting a static variable in a type, it would not be as easy to make it as it seems at first glance.  You can use two tricks. <br><br>  The first is to get inside the called method the name of the class to which it was called, and then use a separate class with a static method as storage, like this: <pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">trait</span></span> Singleton { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInstance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $class = get_called_class(); <span class="hljs-comment"><span class="hljs-comment">//  static:: if (!Storage::hasInstance($class)) { $new = new static(); Storage::setInstance($class, $new); } return Storage::getInstance($class); } }</span></span></code> </pre><br>  The second is to use toli features, toli php bug, which is associated with the use of the <code>static</code> when declaring a variable.  These variables should retain their value when the method is called, but apparently the structure for storing these variables is initialized at each place where the method is used.  The result is such a scheme: <pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">trait</span></span> Singleton { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInstance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $instance = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($instance === <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { $instance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $instance; } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyClass</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Singleton</span></span>; } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyExtClass</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyClass</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> get_class(MyClass::getInstance()), PHP_EOL; <span class="hljs-comment"><span class="hljs-comment">//MyClass echo get_class(MyExtClass::getInstance()), PHP_EOL; //MyExtClass</span></span></code> </pre><br><br><h2>  PS </h2>  Thank you <a href="https://habrahabr.ru/users/aveic/" class="user_link">aveic</a> for help and interesting ideas on working with types. </div><p>Source: <a href="https://habr.com/ru/post/130000/">https://habr.com/ru/post/130000/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../129990/index.html">phpBBex is an enhanced version of phpBB 3</a></li>
<li><a href="../129991/index.html">ZBOX nano VD01 - Dual-core micro-PC with FullHD support</a></li>
<li><a href="../129993/index.html">Eero - Objective-C without parentheses</a></li>
<li><a href="../129994/index.html">Fragmentation?</a></li>
<li><a href="../129998/index.html">10 Practical WordPress Shortcodes</a></li>
<li><a href="../130001/index.html">Radio Pianorama. To heaven in a week</a></li>
<li><a href="../130002/index.html">How anime is created</a></li>
<li><a href="../130003/index.html">Intrusive localization</a></li>
<li><a href="../130004/index.html">Creating a color picker from an HTML5 image</a></li>
<li><a href="../130006/index.html">How to avoid problems with firmware LG P500 Optimus One</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>