<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Abnormal Programming in InterSystems Cach√©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Perhaps not everyone who is familiar with InterSystems Cach√© is aware of the extensions of the Studio for working with the source code. In fact, you c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Abnormal Programming in InterSystems Cach√©</h1><div class="post__text post__text-html js-mediator-article">  Perhaps not everyone who is familiar with InterSystems Cach√© is aware of the extensions of the Studio for working with the source code.  In fact, you can create your own type of source code in it, compile it into an interpretable (INT) and object code, and even provide code completion in some cases.  Those.  theoretically, it is possible to implement support in the Studio of any programming language that will be executed by a DBMS no worse than Cach√© ObjectScript.  In this article I will describe a simple example of how to implement the ability to write programs on some similarity of JavaScript in Cach√© Studio.  If interested, welcome under cat. <a name="habracut"></a><br><br>  The article was prepared on version 2014.1, but I suppose it should work on earlier versions. <br>  In the SAMPLES area, you can find an example of working with custom file types.  The example suggests opening a document like ‚ÄúExample User Document (.tst)‚Äù, and there is only one TestRoutine.TST file, which is actually generated on the fly.  The class that allows working with this type of file is Studio.ExampleDocument.  We will not dwell on this example in detail, but create our own.  The type of the .JS file in the studio is already taken, and the JavaScript, the support of which we want to implement, <s>is not a cake</s> at all but original JavaScript.  Let's call it CacheJavaScript, and the file type will be .CJS.  Let's create the class% CJS.StudioRoutines as a successor of the class% Studio.AbstractDocument and, for a start, we will write in it support for a new file type. <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/// The extension name, this can be a comma separated list of extensions if this class supports more than one Projection RegisterExtension As %Projection.StudioDocument(DocumentDescription = "Cach√©JavaScript Routine", DocumentExtension = "cjs", DocumentIcon = 1, DocumentType = "JS");</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      DocumentDescription - is displayed as a description for the type in the window of opening files in the list of filters; <br>  DocumentExtension - extension of files that will be processed by this class; <br>  DocumentIcon - the number of the icon is numbered from scratch and the options for the available icons: <img src="https://habrastorage.org/getpro/habr/post_images/d2c/d69/e89/d2cd69e893d32d22194b1a2a13e32ab9.png"><br>  DocumentType - the type will be used to highlight code and errors, the available types are: <br><ul><li>  INT - Cache Object Script INT code </li><li>  MAC - Cache Object Script MAC code </li><li>  INC - Cache Object Script macro include </li><li>  CSP - Cache Server Page </li><li>  CSR - Cache Server Rule </li><li>  JS - JavaScript code </li><li>  CSS - HTML Style Sheet </li><li>  XML - XML ‚Äã‚Äãdocument </li><li>  XSL - XML ‚Äã‚Äãtransform </li><li>  XSD - XML ‚Äã‚Äãschema </li><li>  MVB - Multivalue Basic mvb code </li><li>  MVI - Multivalue Basic mvi code </li></ul><br>  Now we will implement all the necessary methods to correctly support the new type of source code in the Studio. <br>  The ListExecute and ListFetch methods are used to get a list of available files in the region and to display them in the open file dialog. <br><blockquote>  ClassMethod ListExecute (ByRef qHandle As% Binary, Directory As% String, Flat As% Boolean, System As% Boolean) As% Status <br>  { <br>  <font color="#000000"><font color="#0000ff">Set</font> <font color="#800000">qHandle</font> <font color="#000000">=</font> <font color="#0000ff">$ listbuild</font> <font color="#000000">(</font> <font color="#800000">Directory</font> <font color="#000000">,</font> <font color="#800000">Flat</font> <font color="#000000">,</font> <font color="#800000">System</font> <font color="#000000">,</font> <font color="#008000">""</font> <font color="#000000">)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">Quit $$$ OK</font></font> <br>  } <br><br>  ClassMethod ListFetch (ByRef qHandle As% Binary, ByRef Row As% List, ByRef AtEnd As% Integer = 0) As% Status [PlaceAfter = ListExecute] <br>  { <br>  <font color="#000000"><font color="#0000ff">Set</font> <font color="#800000">Row</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#000000">,</font> <font color="#800000">AtEnd</font> <font color="#000000">= 0</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">If</font> <font color="#800000">qHandle</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#0000ff">Set</font> <font color="#800000">AtEnd</font> <font color="#000000">= 1</font> <font color="#0000ff">Quit $$$ OK</font></font> <font color="#000000"><font color="#0000ff"><br></font></font>  <font color="#000000"><font color="#0000ff">If $ list</font> <font color="#000000">(</font> <font color="#800000">qHandle</font> <font color="#000000">) '=</font> <font color="#008000">""</font> <font color="#000000">|| (</font> <font color="#0000ff">$ list</font> <font color="#000000">(</font> <font color="#800000">qHandle</font> <font color="#000000">, 4) = 1)</font> <font color="#0000ff">Set</font> <font color="#800000">AtEnd</font> <font color="#000000">= 1</font> <font color="#0000ff">Quit $$$ OK</font></font> <font color="#000000"><font color="#0000ff"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">AtEnd</font> <font color="#000000">= 1</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">Set</font> <font color="#800000">rtnName</font> <font color="#000000">=</font> <font color="#0000ff">$ listget</font> <font color="#000000">(</font> <font color="#800000">qHandle</font> <font color="#000000">, 5)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">For</font> <font color="#800080">{</font></font> <font color="#000000"><font color="#800080"><br></font></font>  <font color="#000000"><font color="#0000ff">Set</font> <font color="#800000">rtnName</font> <font color="#000000">=</font> <font color="#0000ff">$ order</font> <font color="#000000">(^ rCJS (</font> <font color="#800000">rtnName</font> <font color="#000000">))</font> <font color="#0000ff">Quit</font> <font color="#000000">:</font> <font color="#800000">rtnName</font> <font color="#000000">=</font> <font color="#008000">""</font></font> <font color="#000000"><font color="#008000"><br></font></font>  <font color="#000000"><font color="#0000ff">continue</font> <font color="#000000">:</font> <font color="#0000ff">$ get</font> <font color="#000000">(^ rCJS (</font> <font color="#800000">rtnName</font> <font color="#000000">,</font> <font color="#008000">"LANG"</font> <font color="#000000">)) '=</font> <font color="#008000">"CJS"</font></font> <font color="#000000"><font color="#008000"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">timeStamp</font> <font color="#000000">=</font> <font color="#0000ff">$ zdatetime</font> <font color="#000000">(</font> <font color="#0000ff">$ get</font> <font color="#000000">(^ rCJS (</font> <font color="#800000">rtnName</font> <font color="#000000">, 0)), 3)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">size</font> <font color="#000000">= +</font> <font color="#0000ff">$ get</font> <font color="#000000">(^ rCJS (</font> <font color="#800000">rtnName</font> <font color="#000000">, 0,</font> <font color="#008000">"SIZE"</font> <font color="#000000">))</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">Set</font> <font color="#800000">Row</font> <font color="#000000">=</font> <font color="#0000ff">$ listbuild</font> <font color="#000000">(</font> <font color="#800000">rtnName</font> <font color="#000000">_</font> <font color="#008000">".cjs"</font> <font color="#000000">,</font> <font color="#800000">timeStamp</font> <font color="#000000">,</font> <font color="#800000">size</font> <font color="#000000">,</font> <font color="#008000">""</font> <font color="#000000">)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">AtEnd</font> <font color="#000000">= 0</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">set $ list</font> <font color="#000000">(</font> <font color="#800000">qHandle</font> <font color="#000000">, 5) =</font> <font color="#800000">rtnName</font></font> <font color="#000000"><font color="#800000"><br></font></font>  <font color="#000000"><font color="#0000ff">Quit</font></font> <font color="#000000"><font color="#0000ff"><br></font></font>  <font color="#000000"><font color="#800080">}</font></font> <font color="#000000"><font color="#800080"><br></font></font>  <font color="#000000"><font color="#0000ff">Quit $$$ OK</font></font> <br>  } <br></blockquote><br>  We will store the description of the programs in the global rCJS, respectively, the ListFetch method bypasses this global, and returns rows that contain: name, date and size of the found file.  In order for the results to appear in the dialog, you need to describe the Exists method, which checks whether a file with the specified name exists or not. <br><blockquote>  /// Return 1 if the routine is 'name' exists and 0 if it does not. <br>  ClassMethod Exists (name As% String) As% Boolean <br>  { <br>  <font color="#000000"><font color="#0000ff">Set</font> <font color="#800000">rtnName</font> <font color="#000000">=</font> <font color="#0000ff">$ piece</font> <font color="#000000">(</font> <font color="#800000">name</font> <font color="#000000">,</font> <font color="#008000">"."</font> <font color="#000000">, 1,</font> <font color="#0000ff">$ length</font> <font color="#000000">(</font> <font color="#800000">name</font> <font color="#000000">,</font> <font color="#008000">"."</font> <font color="#000000">) -1)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">Set</font> <font color="#800000">rtnNameExt</font> <font color="#000000">=</font> <font color="#0000ff">$ piece</font> <font color="#000000">(</font> <font color="#800000">name</font> <font color="#000000">,</font> <font color="#008000">"."</font> <font color="#000000">,</font> <font color="#0000ff">$ Length</font> <font color="#000000">(</font> <font color="#800000">name</font> <font color="#000000">,</font> <font color="#008000">"."</font> <font color="#000000">))</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">Quit $ data</font> <font color="#000000">(^ rCJS (</font> <font color="#800000">rtnName</font> <font color="#000000">)) &amp;&amp; (</font> <font color="#0000ff">$ get</font> <font color="#000000">(^ rCJS (</font> <font color="#800000">rtnName</font> <font color="#000000">,</font> <font color="#008000">"LANG"</font> <font color="#000000">)) =</font> <font color="#0000ff">$ zconvert</font> <font color="#000000">(</font> <font color="#800000">rtnNameExt</font> <font color="#000000">,</font> <font color="#008000">"U"</font> <font color="#000000">))</font></font> <br>  } <br></blockquote><br>  The TimeStamp method should return the date and time of the program, the result is also displayed in the file open dialog. <br><blockquote>  /// Return the timestamp of the routine 'name' in% TimeStamp format.  This is used to determine if the routine has <br>  /// been updated on the server.  So the format should be $ zdatetime ($ horolog, 3), <br>  /// or "" if the routine does not exist. <br>  ClassMethod TimeStamp (name As% String) As% TimeStamp <br>  { <br>  <font color="#000000"><font color="#0000ff">Set</font> <font color="#800000">rtnName</font> <font color="#000000">=</font> <font color="#0000ff">$ piece</font> <font color="#000000">(</font> <font color="#800000">name</font> <font color="#000000">,</font> <font color="#008000">"."</font> <font color="#000000">, 1,</font> <font color="#0000ff">$ length</font> <font color="#000000">(</font> <font color="#800000">name</font> <font color="#000000">,</font> <font color="#008000">"."</font> <font color="#000000">) -1)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">Set</font> <font color="#800000">timeStamp</font> <font color="#000000">=</font> <font color="#0000ff">$ zdatetime</font> <font color="#000000">(</font> <font color="#0000ff">$ get</font> <font color="#000000">(^ rCJS (</font> <font color="#800000">rtnName</font> <font color="#000000">, 0)), 3)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">Quit</font> <font color="#800000">timeStamp</font></font> <br>  } </blockquote><br>  Now you need to load the program and save the changes to the file.  The text of the program is stored line by line all in the same global ^ rCJS. <br><blockquote>  /// Load the routine into the stream code <br>  Method Load () As% Status <br>  { <br>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">source</font> <font color="#000000">= ..</font> <font color="#0000ff">Code</font></font> <font color="#000000"><font color="#0000ff"><br></font></font>  <font color="#000000"><font color="#0000ff">do</font> <font color="#800000">source</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">Clear</font> <font color="#000000">()</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">pCodeGN</font> <font color="#000000">=</font> <font color="#0000ff">$ name</font> <font color="#000000">(^ rCJS (..</font> <font color="#0000ff">ShortName</font> <font color="#000000">, 0))</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">for</font> <font color="#800000">pLine</font> <font color="#000000">= 1: 1:</font> <font color="#0000ff">$ get</font> <font color="#000000">(@</font> <font color="#800000">pCodeGN</font> <font color="#000000">@ (0), 0)</font> <font color="#800080">{</font></font> <font color="#000000"><font color="#800080"><br></font></font>  <font color="#000000"><font color="#0000ff">do</font> <font color="#800000">source</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">WriteLine</font> <font color="#000000">(@</font> <font color="#800000">pCodeGN</font> <font color="#000000">@ (</font> <font color="#800000">pLine</font> <font color="#000000">))</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#800080">}</font></font> <font color="#000000"><font color="#800080"><br></font></font>  <font color="#000000"><font color="#0000ff">do</font> <font color="#800000">source</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">Rewind</font> <font color="#000000">()</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">Quit $$$ OK</font></font> <br>  } <br><br>  /// Save the routine stored in Code <br>  Method Save () As% Status <br>  { <br>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">pCodeGN</font> <font color="#000000">=</font> <font color="#0000ff">$ name</font> <font color="#000000">(^ rCJS (..</font> <font color="#0000ff">ShortName</font> <font color="#000000">, 0))</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">kill</font> <font color="#000000">@</font> <font color="#800000">pCodeGN</font></font> <font color="#000000"><font color="#800000"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#000000">@</font> <font color="#800000">pCodeGN</font> <font color="#000000">=</font> <font color="#0000ff">$ ztimestamp</font></font> <font color="#000000"><font color="#0000ff"><br></font></font>  <font color="#000000"><font color="#0000ff">Set</font> <font color="#000000">..</font> <font color="#0000ff">Code</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">LineTerminator</font> <font color="#000000">=</font> <font color="#0000ff">$ char</font> <font color="#000000">(13,10)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">source</font> <font color="#000000">= ..</font> <font color="#0000ff">Code</font></font> <font color="#000000"><font color="#0000ff"><br></font></font>  <font color="#000000"><font color="#0000ff">do</font> <font color="#800000">source</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">Rewind</font> <font color="#000000">()</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">WHILE</font> <font color="#000000">'(</font> <font color="#800000">source</font> <font color="#000000">.</font> <font color="#0000ff">AtEnd</font> <font color="#000000">)</font> <font color="#800080">{</font></font> <font color="#000000"><font color="#800080"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">pCodeLine</font> <font color="#000000">=</font> <font color="#800000">source</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">ReadLine</font> <font color="#000000">()</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#000000">@</font> <font color="#800000">pCodeGN</font> <font color="#000000">@ (</font> <font color="#0000ff">$ increment</font> <font color="#000000">(@</font> <font color="#800000">pCodeGN</font> <font color="#000000">@ (0)) =</font> <font color="#800000">pCodeLine</font></font> <font color="#000000"><font color="#800000"><br></font></font>  <font color="#000000"><font color="#800080">}</font></font> <font color="#000000"><font color="#800080"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#000000">@</font> <font color="#800000">pCodeGN</font> <font color="#000000">@ (</font> <font color="#008000">"SIZE"</font> <font color="#000000">) = ..</font> <font color="#0000ff">Code</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">Size</font></font> <font color="#000000"><font color="#0000ff"><br></font></font>  <font color="#000000"><font color="#0000ff">Quit $$$ OK</font></font> <br>  } </blockquote><br>  Now the most interesting: compilation of our program.  We will compile into INT code, and in this way we will get full compatibility with Cach√©.  This article is just an example, so for compilation I implemented quite a few features of the Cach√©JavaScript language: variable declaration (var), read (read) and output (println). <br><blockquote>  /// CompileDocument is when compiled <br>  /// It has already been called the control hooks at this point. <br>  Method CompileDocument (ByRef qstruct As% String) As% Status <br>  { <br>  <font color="#000000"><font color="#0000ff">Write</font> <font color="#000000">!,</font> <font color="#008000">‚ÄúCompile:‚Äû</font> <font color="#000000">, ..</font> <font color="#0000ff">Name</font></font> <font color="#000000"><font color="#0000ff"><br></font></font>  <font color="#000000"><font color="#0000ff">Set</font> <font color="#800000">compiledCode</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">% Routine</font> <font color="#000000">).</font></font>  <font color="#000000"><font color="#0000ff">% OpenId</font> <font color="#000000">(..</font> <font color="#0000ff">ShortName</font> <font color="#000000">_</font> <font color="#008000">‚Äú.INT"</font> <font color="#000000">)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">Set</font> <font color="#800000">compiledCode</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">Generated</font> <font color="#000000">= 1</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">do</font> <font color="#800000">compiledCode</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">Clear</font> <font color="#000000">()</font></font> <font color="#000000"><font color="#000000"><br><br></font></font>  <font color="#000000"><font color="#0000ff">do</font> <font color="#800000">compiledCode</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">WriteLine</font> <font color="#000000">(</font> <font color="#008000">"; generated at"</font> <font color="#000000">_</font> <font color="#0000ff">$ zdatetime</font> <font color="#000000">(</font> <font color="#0000ff">$ ztimestamp</font> <font color="#000000">, 3))</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">do</font> <font color="#000000">..</font> <font color="#0000ff">GenerateIntCode</font> <font color="#000000">(</font> <font color="#800000">compiledCode</font> <font color="#000000">)</font></font> <font color="#000000"><font color="#000000"><br><br></font></font>  <font color="#000000"><font color="#0000ff">do</font> <font color="#800000">compiledCode</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">% Save</font> <font color="#000000">()</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">do</font> <font color="#800000">compiledCode</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">Compile</font> <font color="#000000">()</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">Quit $$$ OK</font></font> <br>  } <br><br>  Method GenerateIntCode (aCode) [Internal] <br>  { <br>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">varMatcher</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">% Regex.Matcher</font> <font color="#000000">).</font></font>  <font color="#000000"><font color="#0000ff">% New</font> <font color="#000000">(</font> <font color="#008000">"[\ t] * (var [\ t] +)? (\ W [\ w \ d] *) [\ t] * (\ = [\ t] * (. *))?"</font> <font color="#000000">)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">printlnMatcher</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">% Regex.Matcher</font> <font color="#000000">).</font></font>  <font color="#000000"><font color="#0000ff">% New</font> <font color="#000000">(</font> <font color="#008000">"[\ t] * (?: console \ .log | println) \ (([^ \)] +) \)?"</font></font>  <font color="#000000"><font color="#000000">)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">readMatcher</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">% Regex.Matcher</font> <font color="#000000">).</font></font>  <font color="#000000"><font color="#0000ff">% New</font> <font color="#000000">(</font> <font color="#008000">"[\ t] * read \ ((. *) \, (. *) \)"</font> <font color="#000000">)</font></font> <font color="#000000"><font color="#000000"><br><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">source</font> <font color="#000000">= ..</font> <font color="#0000ff">Code</font></font> <font color="#000000"><font color="#0000ff"><br></font></font>  <font color="#000000"><font color="#0000ff">do</font> <font color="#800000">source</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">Rewind</font> <font color="#000000">()</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">while</font> <font color="#000000">'</font> <font color="#800000">source</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">AtEnd</font> <font color="#800080">{</font></font> <font color="#000000"><font color="#800080"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">tLine</font> <font color="#000000">=</font> <font color="#800000">source</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">ReadLine</font> <font color="#000000">()</font></font> <font color="#000000"><font color="#000000"><br><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">pos</font> <font color="#000000">= 1</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">while $ locate</font> <font color="#000000">(</font> <font color="#800000">tLine</font> <font color="#000000">,</font> <font color="#008000">"(([^ \ '\" "\; \ r \ n] | [\' \" "] [^ \ '\" "] * [\' \" ")) +) "</font> <font color="#000000">,</font> <font color="#800000">pos</font> <font color="#000000">,</font> <font color="#800000">pos</font> <font color="#000000">,</font> <font color="#800000">tCode</font> <font color="#000000">)</font> <font color="#800080">{</font></font> <font color="#000000"><font color="#800080"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">tPos</font> <font color="#000000">= 1</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">if $ zstrip</font> <font color="#000000">(</font> <font color="#800000">tCode</font> <font color="#000000">,</font> <font color="#008000">"* W"</font> <font color="#000000">) =</font> <font color="#008000">""</font> <font color="#800080">{</font></font> <font color="#000000"><font color="#800080"><br></font></font>  <font color="#000000"><font color="#0000ff">do</font> <font color="#800000">aCode</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">WriteLine</font> <font color="#000000">(</font> <font color="#800000">tCode</font> <font color="#000000">)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">continue</font></font> <font color="#000000"><font color="#0000ff"><br></font></font>  <font color="#000000"><font color="#800080">}</font></font> <font color="#000000"><font color="#800080"><br></font></font>  <font color="#000000"><font color="#0000ff">if</font> <font color="#800000">varMatcher</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">Match</font> <font color="#000000">(</font> <font color="#800000">tCode</font> <font color="#000000">)</font> <font color="#800080">{</font></font> <font color="#000000"><font color="#800080"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">varName</font> <font color="#000000">=</font> <font color="#800000">varMatcher</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">Group</font> <font color="#000000">(2)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">if</font> <font color="#800000">varMatcher</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">Group</font> <font color="#000000">(1) '=</font> <font color="#008000">""</font> <font color="#800080">{</font></font> <font color="#000000"><font color="#800080"><br></font></font>  <font color="#000000"><font color="#0000ff">do</font> <font color="#800000">aCode</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">WriteLine</font> <font color="#000000">(</font> <font color="#0000ff">$ char</font> <font color="#000000">(9) _</font> <font color="#008000">¬´new‚Äû</font> <font color="#000000">_</font> <font color="#800000">varName</font> <font color="#000000">)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#800080">}</font></font> <font color="#000000"><font color="#800080"><br></font></font>  <font color="#000000"><font color="#0000ff">if</font> <font color="#800000">varMatcher</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">Group</font> <font color="#000000">(3) '=</font> <font color="#008000">‚Äú‚Äù</font> <font color="#800080">{</font></font> <font color="#000000"><font color="#800080"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">expr</font> <font color="#000000">=</font> <font color="#800000">varMatcher</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">Group</font> <font color="#000000">(4)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">expr</font> <font color="#000000">= ..</font> <font color="#0000ff">Expression</font> <font color="#000000">(</font> <font color="#800000">expr</font> <font color="#000000">)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">do</font> <font color="#000000">:</font> <font color="#800000">expr</font> <font color="#000000">'=</font> <font color="#008000">""</font> <font color="#800000">aCode</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">WriteLine</font> <font color="#000000">(</font> <font color="#0000ff">$ char</font> <font color="#000000">(9) _</font> <font color="#008000">‚Äúset‚Äû</font> <font color="#000000">_</font> <font color="#800000">varName</font> <font color="#000000">_</font> <font color="#008000">‚Äú=‚Äû</font> <font color="#000000">_</font> <font color="#800000">expr</font> <font color="#000000">)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#800080">}</font></font> <font color="#000000"><font color="#800080"><br></font></font>  <font color="#000000"><font color="#0000ff">continue</font></font> <font color="#000000"><font color="#0000ff"><br><br></font></font>  <font color="#000000"><font color="#800080">}</font> <font color="#0000ff">elseif</font> <font color="#800000">printlnMatcher</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">Match</font> <font color="#000000">(</font> <font color="#800000">tCode</font> <font color="#000000">)</font> <font color="#800080">{</font></font> <font color="#000000"><font color="#800080"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">expr</font> <font color="#000000">=</font> <font color="#800000">printlnMatcher</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">Group</font> <font color="#000000">(1)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">expr</font> <font color="#000000">= ..</font> <font color="#0000ff">Expression</font> <font color="#000000">(</font> <font color="#800000">expr</font> <font color="#000000">)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">do</font> <font color="#000000">:</font> <font color="#800000">expr</font> <font color="#000000">'=</font> <font color="#008000">""</font> <font color="#800000">aCode</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">WriteLine</font> <font color="#000000">(</font> <font color="#0000ff">$ char</font> <font color="#000000">(9) _</font> <font color="#008000">‚ÄúWrite‚Äû</font> <font color="#000000">_</font> <font color="#800000">expr</font> <font color="#000000">_</font> <font color="#008000">‚Äú,!‚Äù</font> <font color="#000000">)</font></font> <font color="#000000"><font color="#000000"><br><br></font></font>  <font color="#000000"><font color="#800080">}</font> <font color="#0000ff">elseif</font> <font color="#800000">readMatcher</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">Match</font> <font color="#000000">(</font> <font color="#800000">tCode</font> <font color="#000000">)</font> <font color="#800080">{</font></font> <font color="#000000"><font color="#800080"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">expr</font> <font color="#000000">=</font> <font color="#800000">readMatcher</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">Group</font> <font color="#000000">(1)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">expr</font> <font color="#000000">= ..</font> <font color="#0000ff">Expression</font> <font color="#000000">(</font> <font color="#800000">expr</font> <font color="#000000">)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">var</font> <font color="#000000">=</font> <font color="#800000">readMatcher</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">Group</font> <font color="#000000">(2)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">do</font> <font color="#000000">:</font> <font color="#800000">expr</font> <font color="#000000">'=</font> <font color="#008000">""</font> <font color="#800000">aCode</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">WriteLine</font> <font color="#000000">(</font> <font color="#0000ff">$ char</font> <font color="#000000">(9) _</font> <font color="#008000">"read‚Äû</font> <font color="#000000">_</font> <font color="#800000">expr</font> <font color="#000000">_</font> <font color="#008000">‚Äú,"</font> <font color="#000000">_</font> <font color="#800000">var</font> <font color="#000000">_</font> <font color="#008000">",!"</font> <font color="#000000">)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#800080">}</font></font> <font color="#000000"><font color="#800080"><br></font></font>  <font color="#000000"><font color="#800080">}</font></font> <font color="#000000"><font color="#800080"><br></font></font>  <font color="#000000"><font color="#800080">}</font></font> <br>  } <br><br>  ClassMethod Expression (tExpr) As% String <br>  { <br>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">matchers</font> <font color="#000000">(</font> <font color="#0000ff">$ increment</font> <font color="#000000">(</font> <font color="#800000">matchers</font> <font color="#000000">),</font> <font color="#008000">"matcher"</font> <font color="#000000">) =</font> <font color="#008000">"(? sm) ([^ \ '\" "] *) \ + [\ t] * (?: \" "([^ \" "] *) \ "" | \ '([^ \'] *) \ ') ([^ \' \ ""] *) "</font></font> <font color="#000000"><font color="#008000"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">matchers</font> <font color="#000000">(</font> <font color="#800000">matchers</font> <font color="#000000">,</font> <font color="#008000">"replacement"</font> <font color="#000000">) =</font> <font color="#008000">"$ 1 _" "$ 2 $ 3" ‚Äã‚Äã"$ 4"</font></font> <font color="#000000"><font color="#008000"><br><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">matchers</font> <font color="#000000">(</font> <font color="#0000ff">$ increment</font> <font color="#000000">(</font> <font color="#800000">matchers</font> <font color="#000000">),</font> <font color="#008000">"matcher"</font> <font color="#000000">) =</font> <font color="#008000">"(? sm) ([^ \ '\" "] *) (?: \" "([^ \" "] *) \" "| \ '([^ \'] *) \ ') [\ t] * \ + ([^ \' \ ""] *) "</font></font> <font color="#000000"><font color="#008000"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">matchers</font> <font color="#000000">(</font> <font color="#800000">matchers</font> <font color="#000000">,</font> <font color="#008000">"replacement"</font> <font color="#000000">) =</font> <font color="#008000">"$ 1" "$ 2 $ 3" ‚Äã‚Äã"_ $ 4"</font></font> <font color="#000000"><font color="#008000"><br><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">matchers</font> <font color="#000000">(</font> <font color="#0000ff">$ increment</font> <font color="#000000">(</font> <font color="#800000">matchers</font> <font color="#000000">),</font> <font color="#008000">"matcher"</font> <font color="#000000">) =</font> <font color="#008000">"(? sm) ([^ \ '\" "] *) (?: \" "([^ \" "] *) \" "| \ '([^ \'] *) \ ') ([^ \' \ ""] *) "</font></font> <font color="#000000"><font color="#008000"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">matchers</font> <font color="#000000">(</font> <font color="#800000">matchers</font> <font color="#000000">,</font> <font color="#008000">"replacement"</font> <font color="#000000">) =</font> <font color="#008000">"$ 1" "$ 2 $ 3" ‚Äã‚Äã"$ 4"</font></font> <font color="#000000"><font color="#008000"><br><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">tResult</font> <font color="#000000">=</font> <font color="#800000">tExpr</font></font> <font color="#000000"><font color="#800000"><br></font></font>  <font color="#000000"><font color="#0000ff">for</font> <font color="#800000">i</font> <font color="#000000">= 1: 1:</font> <font color="#800000">matchers</font> <font color="#800080">{</font></font> <font color="#000000"><font color="#800080"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">matcher</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">% Regex.Matcher</font> <font color="#000000">).</font></font>  <font color="#000000"><font color="#0000ff">% New</font> <font color="#000000">(</font> <font color="#800000">matchers</font> <font color="#000000">(</font> <font color="#800000">i</font> <font color="#000000">,</font> <font color="#008000">"matcher"</font> <font color="#000000">))</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">replacement</font> <font color="#000000">=</font> <font color="#0000ff">$ get</font> <font color="#000000">(</font> <font color="#800000">matchers</font> <font color="#000000">(</font> <font color="#800000">i</font> <font color="#000000">,</font> <font color="#008000">"replacement"</font> <font color="#000000">))</font></font> <font color="#000000"><font color="#000000"><br><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">matcher</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">Text</font> <font color="#000000">=</font> <font color="#800000">tResult</font></font> <font color="#000000"><font color="#800000"><br><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">tResult</font> <font color="#000000">=</font> <font color="#800000">matcher</font> <font color="#000000">.</font></font>  <font color="#000000"><font color="#0000ff">ReplaceAll</font> <font color="#000000">(</font> <font color="#800000">replacement</font> <font color="#000000">)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#800080">}</font></font> <font color="#000000"><font color="#800080"><br><br></font></font>  <font color="#000000"><font color="#0000ff">quit</font> <font color="#800000">tResult</font></font> <br>  } <br></blockquote><br>  For each compiled program or class it is possible to view the generated INT code.  To do this, you must implement the GetOther method.  It's pretty simple - it should return a list of programs, separated by commas, that were generated for the source code. <br><blockquote>  /// Return other document types. <br>  /// Passed a comma <br>  /// or "" if it is not related to anything.  Note <br>  /// for example if your test.XXX your document creates a test.INT <br>  /// with 'test.INT' so you can return 'test.XXX' to complete the cycle. <br>  ClassMethod GetOther (Name As% String) As% String <br>  { <br>  <font color="#000000"><font color="#0000ff">Set</font> <font color="#800000">rtnName</font> <font color="#000000">=</font> <font color="#0000ff">$ piece</font> <font color="#000000">(</font> <font color="#800000">Name</font> <font color="#000000">,</font> <font color="#008000">"."</font> <font color="#000000">, 1,</font> <font color="#0000ff">$ length</font> <font color="#000000">(</font> <font color="#800000">Name</font> <font color="#000000">,</font> <font color="#008000">"."</font> <font color="#000000">) -1) _</font> <font color="#008000">".INT"</font></font> <font color="#000000"><font color="#008000"><br></font></font>  <font color="#000000"><font color="#0000ff">Quit</font> <font color="#000000">:</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">% Routine</font> <font color="#000000">).</font></font>  <font color="#000000"><font color="#0000ff">% ExistsId</font> <font color="#000000">(</font> <font color="#800000">rtnName</font> <font color="#000000">)</font> <font color="#800000">rtnName</font></font> <font color="#000000"><font color="#800000"><br></font></font>  <font color="#000000"><font color="#0000ff">Quit</font> <font color="#008000">""</font></font> <br>  } </blockquote><br><br>  We implement the program blocking method so that at one time only one developer can edit the program or class on the server. <br>  And also do not forget to implement also the program removal method. <br><blockquote>  /// Delete the routine 'name' which includes the routine extension <br>  ClassMethod Delete (name As% String) As% Status <br>  { <br>  <font color="#000000"><font color="#0000ff">Set</font> <font color="#800000">rtnName</font> <font color="#000000">=</font> <font color="#0000ff">$ piece</font> <font color="#000000">(</font> <font color="#800000">name</font> <font color="#000000">,</font> <font color="#008000">"."</font> <font color="#000000">, 1,</font> <font color="#0000ff">$ length</font> <font color="#000000">(</font> <font color="#800000">name</font> <font color="#000000">,</font> <font color="#008000">"."</font> <font color="#000000">) -1)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">Kill</font> <font color="#000000">^ rCJS (</font> <font color="#800000">rtnName</font> <font color="#000000">)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">Quit $$$ OK</font></font> <br>  } <br><br>  /// Lock the current routine; <br>  /// If it fails then return a status code of the error, otherise return $$$ OK <br>  Method Lock (flags As% String) As% Status <br>  { <br>  <font color="#000000"><font color="#0000ff">Lock</font> <font color="#000000">+ ^ rCJS (..</font> <font color="#0000ff">Name</font> <font color="#000000">): 0</font> <font color="#0000ff">Else Quit $$$ ERROR</font> <font color="#000000">(</font> <font color="#0000ff">$$$ CanNotLockRoutine</font> <font color="#000000">, ..</font> <font color="#0000ff">Name</font> <font color="#000000">)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">Quit $$$ OK</font></font> <br>  } <br><br>  /// Unlock the current routine <br>  Method Unlock (flags As% String) As% Status <br>  { <br>  <font color="#000000"><font color="#0000ff">Lock</font> <font color="#000000">- ^ rCJS (..</font> <font color="#0000ff">Name</font> <font color="#000000">)</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">Quit $$$ OK</font></font> <br>  } </blockquote><br>  So, we have implemented a class that allows you to work with our type of program.  But so far there is no possibility to create such a program in the Studio.  Fix it.  To do this, the studio has the ability to define templates.  At the moment, there are 3 ways to define a template: a simple CSP file of a specific format, a CSP class derived from the% CSP.StudioTemplateSuper class, and finally a ZEN page derived from% ZEN.Template.studioTemplate.  In this case, we will use the last option, since  he is easier.  Templates also come in 3 types: to create new objects, just code templates and add-ons (Add Inns), which do not generate any output. <br>  In our case, we need a template for creating new objects.  Create a class% CJS.RoutineWizard: its contents are quite simple, you just need to describe the field for entering the program name, and in the% OnTemplateAction method describe the studio name of the new program and its mandatory content. <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre>  /// Studio Template: &lt;br&gt;
 /// Create a new Cache JavaScript Routine.
 Class% CJS.RoutineWizard Extends% ZEN.Template.studioTemplate [StorageStrategy = ""]
 {

 Parameter TEMPLATENAME = "Cache JavaScript";

 Parameter TEMPLATETITLE = "Cache JavaScript";

 Parameter TEMPLATEDESCRIPTION = "Create a new Cache JavaScript routine.";

 Parameter TEMPLATETYPE = "CJS";

 /// What type of template.
 Parameter TEMPLATEMODE = "new";

 /// If this is a TEMPLATEMODE = "new" then this is
 /// in Studio this template is dispayed on.  If none specified then
 /// it displays on the 'Custom' tab.
 Parameter TEMPLATEGROUP As STRING;

 /// This XML block is the pane of this Studio Template.
 XData templateBody [XMLNamespace = "http://www.intersystems.com/zen"]
 {
 &lt;pane id = "body"&gt;
 &lt;vgroup labelPosition = "left" cellStyle = "padding: 2px; padding-left: 5px; padding-right: 5px;"&gt;
 &lt;html id = "desc" OnDrawContent = "% GetDescHTML" /&gt;
 &lt;text label = "Routine Name:" 
	 id = "ctrlRoutineName"
	 name = "RoutineName"
	 size = "40"
	 required = "true"
	 labelClass = "zenRequired"
	 title = "Cache JavaScript Routine name" 
	 onchange = "zenPage.updateState ();"
 /&gt;
 &lt;/ vgroup&gt;
 &lt;/ pane&gt;
 }

 /// Provide contents of description component.
 Method% GetDescHTML (pSeed As% String) As% Status
 {
	 Quit $$$ OK
 }

 /// This is called when the template is first;
 /// This provides a chance to set focus etc.
 ClientMethod onstartHandler () [Language = javascript]
 {
	 // give focus to name
	 var ctrl = zenPage.getComponentById ('ctrlRoutineName');
	 if (ctrl) {
		 ctrl.focus ();
		 ctrl.select ();
	 }
 }

 /// Validation handler for form built-into template.
 ClientMethod formValidationHandler () [Language = javascript]
 {
	 var rtnName = zenPage.getComponentById ('ctrlRoutineName'). getValue ();

	 if ('' == rtnName) {
		 return false;
	 }
	
	 return true;
 }

 /// This method is when the template is complete.  Any
 /// output to the Studio device.
 Method% OnTemplateAction () As% Status
 {
	 Set tRoutineName = ..% GetValueByName ("RoutineName")
	
	 Set% session.Data ("Template", "NAME") = tRoutineName _ ". CJS"
	 Write "//" _tRoutineName ,!
	 Quit $$$ OK
 }

 }
</pre></div></div><br>  Everything.  Now you can create your first Cach√© JavaScript program in Studio. <br><img src="https://habrastorage.org/getpro/habr/post_images/55d/c66/a1e/55dc66a1eb0140f70a26269322428f13.png"><br>  Let's call it hello.  And the source code in Cach√©JavaScript like this: <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// hello console.log('Hello World!'); var name=''; read('What is your name? ', name); println('Hello ' + name + '!');</span></span></code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/63e/f5a/cab/63ef5acab240785f9e053fa5e56c8ef0.png" alt="image"><br>  Open another source, we will see this code, already on COS. <br><blockquote>  <font color="#000000"><font color="#008000">; generated at 2014-05-18 20:06:36</font></font> <font color="#000000"><font color="#008000"><br></font></font>  <font color="#000000"><font color="#0000ff">Write</font> <font color="#008000">"Hello World!"</font> <font color="#000000">,!</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">new</font> <font color="#800000">name</font></font> <font color="#000000"><font color="#800000"><br></font></font>  <font color="#000000"><font color="#0000ff">set</font> <font color="#800000">name</font> <font color="#000000">=</font> <font color="#008000">""</font></font> <font color="#000000"><font color="#008000"><br></font></font>  <font color="#000000"><font color="#0000ff">read</font> <font color="#008000">"What is your name?</font></font>  <font color="#000000"><font color="#008000">‚Äû</font> <font color="#000000">,</font> <font color="#800000">Name,!</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#0000ff">Write</font> <font color="#008000">‚ÄúHello‚Äû</font> <font color="#000000">_</font> <font color="#800000">name</font> <font color="#000000">_</font> <font color="#008000">‚Äú!‚Äù</font> <font color="#000000">,!</font></font> </blockquote><div class="spoiler">  <b class="spoiler_title">Screenshot with another code</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/3e4/d11/7d9/3e4d117d934dd94a5398f612bc999153.png"></div></div><br>  And now it can be done in the terminal <br><pre>  USER&gt; d ^ hello
 Hello World!
 What is your name?  daimor
 Hello daimor! </pre><br><br>  In this way, you can describe any language (within the limits of the possible, of course) that you like the most and encode the server business logic for the Cach√© DBMS.  It is clear that there will be problems with its illumination, if this language is not supported in the studio.  This example shows how to work with programs, but naturally you can create Cach√© classes in the same way.  So the possibilities are almost endless: it remains only to write a lexical parser, a syntax parser and a full-fledged compiler, and come up with a correspondence to all Cach√© system functions and specific constructions in the new language.  Also, such programs can be exported and imported with compilation, as is done with any other programs in Cach√©. <br><br>  For those who want to "repeat the experience at home," the source code is available <a href="https://gist.github.com/daimor/3923810dcd60126647b7">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/222563/">https://habr.com/ru/post/222563/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../222551/index.html">You have a mistake here ... or about the practice of code inspections in mobile development</a></li>
<li><a href="../222553/index.html">Type construction in Scala</a></li>
<li><a href="../222557/index.html">No binding to the vendor! OpenShift Cartridge Standard support will appear on InfoboxCloud Jelastic platform</a></li>
<li><a href="../222559/index.html">Protection from DDoS attacks as a service by VimpelCom - and the story of the won tenders</a></li>
<li><a href="../222561/index.html">Report from the Silicon Valley Open Doors conference in Silicon Valley - meeting people</a></li>
<li><a href="../222565/index.html">As we query is 100 times faster, or not all hash functions are equally bad</a></li>
<li><a href="../222567/index.html">Visual editing of markup inside an Android application</a></li>
<li><a href="../222569/index.html">Synthesis-2 - domestic clone ZX-Spectrum</a></li>
<li><a href="../222571/index.html">Smart home - cheap and cheerful</a></li>
<li><a href="../222573/index.html">ReactJS in a nutshell. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>