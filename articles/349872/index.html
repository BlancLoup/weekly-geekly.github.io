<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How are the address tips "Dadata"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=""Dadata" from 2014 sawing " Tips ". They help you quickly and without error to enter contact information: addresses, details of banks and companies, e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How are the address tips "Dadata"</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/cz/mx/4p/czmx4pkjaphlw5l-fzbzl7ychfg.jpeg"><br><br><p>  "Dadata" from 2014 sawing " <a href="https://dadata.ru/suggestions/">Tips</a> ".  They help you quickly and without error to enter contact information: addresses, details of banks and companies, emails - that's all. </p><br><p>  Stuck arranged intricately, and we decided to talk about it.  Take clues to addresses, because they are the most complex. </p><br><h2>  Directories and Indexing </h2><br><p>  "Tips" know what to suggest, because they have giant reference books.  Although this article is about tips by addresses, for the good of the case I will also list other Dadata directories. </p><br><a name="habracut"></a><table><tbody><tr><th>  What tips </th><th>  What reference books </th><th>  Where to get reference books </th></tr><tr><td>  Addresses </td><td>  FIAS </td><td>  <a href="http://fias.nalog.ru/Updates.aspx">Download from the official site</a> </td></tr><tr><td>  Legal entity </td><td>  USR and EGRIP </td><td>  <a href="https://www.nalog.ru/rn77/service/egrip2/access_order/">Buy from the FTS annual access</a> - 150 000 ‚ÇΩ for the directory </td></tr><tr><td>  Banks </td><td>  Reference book on credit organizations of the Central Bank of the Russian Federation </td><td>  <a href="http://www.cbr.ru/mcirabis/bic/">Download from the official site</a> </td></tr><tr><td>  Full name </td><td>  Surnames, first names, patronymic names </td><td>  Gather yourself or <a href="https://mydata.biz/ru/catalog/databases/names_db">search for ready</a> </td></tr><tr><td>  Emails </td><td><ul><li>  First level domains; </li><li>  top 40,000 domains of the second level of the Runet; </li><li>  free providers (yandex.ru, mail.ru); </li><li>  popular box names </li></ul><br></td><td><ul><li>  Download the <a href="http://data.iana.org/TLD/tlds-alpha-by-domain.txt">list of first level domains</a> ; </li><li>  select popular second-level domains <a href="">from the Alexa list</a> ; </li><li>  collect free providers and popular do-it-yourself box names </li></ul><br></td></tr></tbody></table><p>  Searching for something in an unprepared reference book is a long and ungrateful business.  Therefore, we take the wonderful <a href="http://lucene.apache.org/">Lucene</a> library and turn the source data into a search index. </p><br><p>  Search index - a format in which to find information can be sooooo fast. </p><br><p>  Physically, an index is a collection of two types of files: </p><br><ul><li>  files with the actual index, for them "tips" are looking for.  We keep the index part in memory so that the service is fresh and fit; </li><li>  data files.  Of these, "Clues" return an answer. </li></ul><br><p>  The index and data on addresses in the total occupy 20 gigabytes.  The companies are about the same, and the rest weigh less. </p><br><p>  From the official reference books for saving we remove the data for which we are not looking for and which we do not return.  We also clean duplicates and obvious mistakes.  For example, the index for addresses is not: </p><br><ul><li>  liter of houses.  The FIAS has a colossal number of letters that actually do not exist; </li><li>  obviously impossible objects of the form "house 21/2, p 21/2". </li></ul><br><h2>  Search for adequate clues </h2><br><p>  "Tips" work quite intricately.  For simplicity, I will divide the process into stages and tell you more about each.  If questions remain, ask in the comments. </p><br><p>  <strong>1. Let's go: a person enters characters in the "Clues" field.</strong> </p><br><img src="https://habrastorage.org/webt/sr/dc/ec/srdcecghagpmqcvbsunm4j4-huu.gif"><br><br>  <sup>Each new character launches a server request with new parameters.</sup>  <sup>The frequency of requests can be tweaked, more on that later.</sup> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>  <strong>2. Tips plugin collects the request.</strong>  A dispatcher is working between a human and a server - jQuery-plugin ‚ÄúTips‚Äù ( <a href="https://github.com/hflabs/suggestions-jquery">source code on GitHub</a> ). </p><br><p>  The plugin accepts data for search, packages it into a request and transmits to the server. </p><br><p>  From itself, the plugin adds how many addresses to return.  The number is set as a parameter in the integration of "tips".  If the number is not specified, "Tips" returns 10 results.  More than 20 is useless to ask - only 20 options will return. </p><br><p>  The plugin also passes filtering parameters, they are also set when integrating the "Tips".  Here are the filters that exist: </p><br><ul><li>  by parent (search only for Moscow highway in Samara); </li><li>  by FIAS level (search only populated areas); </li><li>  by object type (useful, because foreign objects like village councils lie at FIAS at the city level. Village councils will also be returned if you do not specify the type of ‚Äúcity‚Äù, ‚ÄúTips‚Äù). </li></ul><br><p>  And there is such a thing as geoboost.  It is similar to the restriction on the parent, but affects only the ranking of addresses.  Do you want the Omsk streets to stand above Moscow - please. </p><br><img src="https://habrastorage.org/webt/oi/uh/0n/oiuh0n7eli4g9iqug23b1-js0eo.png"><br><br>  <sup>Yandex.Money offers Moscow streets by default.</sup>  <sup>Limit the city set through filtering options "Tips"</sup> <br><br><p>  By default, geolocation is enabled in the plugin: it sends the user's location to the server.  This is also a search parameter. </p><br><p>  With integration, you can adjust the delay in requests to the server.  For example, set the delay to 100 milliseconds.  If a certain virtuoso in four milliseconds hammered in four characters, one request with four new characters will go to the server.  And not four requests one by one. </p><br><p>  The plugin works in IE since version 10 and all normal browsers.  He also needs jQuery 1.10+. </p><br><p>  <strong>3. Check the cache.</strong>  When a request arrives at the server, the ‚ÄúClues‚Äù first look at the cache.  They are looking for a match in all parameters of the query to a single. </p><br><p>  Caching saves from short queries like ‚ÄúM‚Äù, ‚ÄúMo‚Äù, ‚ÄúC‚Äù.  Such a combination of the same type comes a tremendous amount.  Since each letter is a separate request, caching protects the server from millions of hits to the search index. </p><br><p>  The cache is located entirely in RAM, it contains 100,000 results. </p><br><p>  <strong>4. We are looking for suitable hints in the index.</strong>  If there is nothing suitable in the cache, the ‚ÄúHints‚Äù are sent to the search index. </p><br><p>  Clues look for addresses by: </p><br><ul><li>  any part; </li><li>  zip code; </li><li>  obsolete names; </li><li>  synonyms and abbreviations.  For them, we have compiled a dictionary: ‚ÄúMoscow time‚Äù, ‚ÄúSt. Petersburg‚Äù, ‚ÄúEburg‚Äù, ‚ÄúB.‚Äù - ‚Äúlarge‚Äù, etc. </li></ul><br><p>  The algorithm assumes that only the last word in the request is incomplete or erroneous.  If a person wrote ‚ÄúMoscow Turch‚Äù, ‚ÄúClues‚Äù are looking for ‚ÄúMoscow Turch *‚Äù. </p><br><img src="https://habrastorage.org/webt/-2/pw/nz/-2pwnzx-p4dupl8nhe6aki09mze.gif"><br><br>  <sup>Requests like "Moscow turch" will not pass.</sup>  <sup>This does not create problems, because people recruit addresses sequentially, and the Clues consistently suggest the correct spelling of each part of the address.</sup> <br><br><p>  If geolocation is disabled in the plugin, on requests for 1-2 characters, ‚ÄúClues‚Äù only regions, municipal districts and cities are searched.  Home service is looking for the second word in the query. </p><br><p>  Each result "Tips" is assigned a weight.  Weight is needed, because the algorithm sometimes finds thousands of options, especially for short queries.  And you can return a maximum of 20 pieces.  Therefore, the "Tips" sort the results by weight and return top. </p><br><p>  Algorithm for ranking results - know-how "Dadaty".  This is such a serious thing that I cannot describe it in detail: the developers will curse. </p><br><p>  <strong>5. Sort the results.</strong>  If the search results have the same weight, the ‚ÄúTips‚Äù sorts them.  The sorting algorithm is also samopisny, so again remains mysterious. </p><br><p>  <strong>6. Preparing the answer.</strong>  Addresses that return ‚ÄúClues‚Äù differ slightly in format from FIAS: </p><br><ul><li>  city-regions like Moscow are returning in the fields of both region and city.  In FIAS they are only in the region.  Online stores asked for improvement: courier services require them to have a city in the ‚Äúcity‚Äù field without fail (what they are!); </li><li>  The address in one line is written according to the rules of the Russian Post.  Therefore, the center of the region is given without the name of the region, and the center of the region - well, you understand.  For example, Novosibirsk will return without the Novosibirsk region.  The full address is also there, it is returned in the unrestrictabled_value field; </li><li>  type "street", "lane", "highway" are substituted before or after the object, depending on how it sounds better.  The harmonic sound is estimated by the endings: ‚ÄúAviation Lane‚Äù, but ‚ÄúVasnetsov Lane‚Äù; </li><li>  the name of the parent settlement is added to the garden partnerships and everything else from the 65th level of FIAS.  For example, "Snt Giant (p. New)".  According to FIAS, garden associations are included in populated areas, but such a hierarchy is unusual for people.  Therefore, the latter are simply displayed in brackets as a guide to the terrain. </li></ul><br><p>  <strong>7. Cache.</strong>  Before returning the result, "Prompts" cache the request with all parameters and with the answer. </p><br><p>  The cache is limited to 100,000 entries by the LRU algorithm, so the service throws out rare requests from there.  Popular ones like ‚ÄúMo‚Äù are always in the cache. </p><br><p>  <strong>8. Plugin draws hints.</strong>  It receives a response from the server, displays addresses on the screen and highlights the matches.  If you press Enter during input, the plugin will compare the text with the found prompts and substitute the most appropriate one in the field. </p><br><p>  That's how it works.  If you take your tips, the article will help a little.  And better come to us to work, we will come up with cool things together.  Right now we are looking for a <a href="https://hh.ru/employer/15589">javista on ‚ÄúTips‚Äù and 7 more specialists</a> . </p></div><p>Source: <a href="https://habr.com/ru/post/349872/">https://habr.com/ru/post/349872/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../349862/index.html">Application Release Automation: Release Management Automation "Goes to the Cloud"</a></li>
<li><a href="../349864/index.html">Natasha - a library for extracting structured information from texts in Russian</a></li>
<li><a href="../349866/index.html">W3View - straight web UI path</a></li>
<li><a href="../349868/index.html">Changes in the Java 10 Standard Library</a></li>
<li><a href="../349870/index.html">Parsing ICO TenX: scam or not?</a></li>
<li><a href="../349874/index.html">Blue Shift or iOS application launch time optimization. Yandex lecture</a></li>
<li><a href="../349876/index.html">Three ways to update a query in Jira from ScriptRunner using the Jira Java API</a></li>
<li><a href="../349880/index.html">Vue.js + Asp.NETCore + TypeScript application without Webpack</a></li>
<li><a href="../349886/index.html">Quick interactive layout of the hall on canvas</a></li>
<li><a href="../349888/index.html">The digest of interesting materials for the mobile developer # 242 (February 19 - February 25)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>