<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Habrachtets or how I did this summer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 Inspired by the posts that need to start doing and everything will turn out, in this material I would like to share a story about the result...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Habrachtets or how I did this summer</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br><br>  Inspired by the posts that need to start doing and everything will turn out, in this material I would like to share a story about the result of numerous inspirations and my experience in developing an application for the Android OS.  I will try to describe the process from the emergence of the idea to its implementation. <br><br>  Last summer gave me two and a half months of complete freedom, half of which I spent on writing the program.  I‚Äôm not a newcomer - my diploma was a fairly serious first project, but I think that this particular application <s>will bring me fame</s> will be interesting for you. <br>  What I had at the source: <br><ul><li>  Time </li><li>  Galaxy Tab </li><li>  Eclipse IDE with ADT plugin </li></ul><br>  It would seem that.  And then Habr? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  And where.  Your attention - Habrachtets: <br><br><img src="http://imglink.ru/pictures/30-09-11/9ca41f43934f7fa980535fe52d8112fd.jpg" alt="image"><br><br>  As I have already mentioned - at the end of June of this year, I already faced a couple of months free from any kind of employment.  And I made a habit, waking up in the morning, to open on the tablet a couple of three news applications, carefully suggested by the Market, and carefully study them.  And that is very convenient.  A cup of steaming coffee, a view from the balcony, a sandwich and home wireless Wi-Fi now made the start of my day. <br><br>  Only Habraklient‚Äôs absence added his spoon of tar - he had to open the Opera, go to the site, scroll, adjust ... Not that it‚Äôs inconvenient, but still it‚Äôs not so easy to press and punch with one finger, especially with a cup of coffee in hand.  Somewhere in one of those moments, I thought.  And he decided.  Attempt to write a client for a site in the image of applications that I already had. <br><br>  What was the source: <br><ul><li>  Habr's web page with all the consequences </li><li>  The experience of writing a thesis, which is a bundle of the server - the client, where the client (drum roll), yes yes - Android application </li><li>  Eclipse and Plugins </li><li>  Galaxy Tab </li></ul><br>  What was the task: <br><ul><li>  Parsing the page into components: Posts, Questions, Events </li><li>  Each element, whether it be a post or a question, must contain all that the original contains on the site. </li><li>  Ability to add to favorites and store on device </li><li>  Simple interface that preserves the style and structure of the original </li><li>  And finally, the highlight is the ‚ÄúSave for the Future‚Äù mode (I think that the essence is clear, I will explain a bit later) </li></ul><br>  The source material multiplied by four weeks (meaning really working days from those two months - that's how I went to the sea) brought its fruits - now I can enjoy reading Habra in any place where there is internet. <br><br>  Next, some details. <br><br><h5>  Data and processing </h5><br>  Technically, the application is quite simple.  I naturally did not have access to the Habr API.  I had to spin.  So, in stages. <br>  Habrachtets makes a request to the address of the habr and receives the <code>HTML</code> code using <code>HttpUrlConnection</code> .  This operation is, for obvious reasons, asynchronous - it should not and therefore does not block the interface.  The sequence of actions is simple - pressing a button, launching a background task, connecting to Habr, receiving a code and transmitting it to an interested <code>Activity</code> as a <code>String</code> object nested in a special <code>Intent</code> via an alert ( <code>Broadcast</code> ).  Nothing special. <br><br>  <i>Gourmet: However, there was a snag in the sequence described above.</i>  <i>To transmit data within the application (and the system in general), intent objects are used ‚Äî <code>Intent</code> sent in alerts ‚Äî <code>Broadcast</code> .</i>  <i>So here.</i>  <i>A couple of times the internal contents of the posts did not want to load.</i>  <i>Those.</i>  <i>even the logs showed that the application found Habr, loaded the page code, but then ... nothing.</i>  <i>At all.</i>  <i>Silence.</i>  <i>The application did not hang, but nothing happened.</i>  <i>Restarts did not help.</i>  <i>Content did not appear.</i>  <i>The problem was left until better times and was explained almost by accident.</i> <i><br><br></i>  <i>The fact is that all new and fresh posts were loaded easily and naturally.</i>  <i>But to read something older and with more comments was no longer possible.</i>  <i>A careful (!) Reading of the logs revealed a strange line about a system error - <b>!!! FAILED BINDER TRANSACTION !!!</b></i>  <i>It's hard not to notice, right?</i>  <i>So I did not notice.</i>  <i>The only line that is immediately hammered by other "garbage".</i>  <i>There was a problem in it.</i>  <i>Googling showed that this occurs if the data used for transmission exceeds a certain limit.</i>  <i>Began to measure the size of the line - 600 000 characters.</i>  <i>But there were not even 100 comments!</i>  <i>In general, he added cleaning procedures, conducted several tests and found out a limit equal to 250 thousand characters per line.</i>  <i>Now, if even after cleaning the size is exceeded, the line is trimmed and ... not all comments will be available (* crying *).</i> <i><br></i>  <i>Solve the problem can be relatively easy, at least to transfer data in a couple of steps.</i>  <i>I think that it will be solved in the next update.</i> <br><br>  Further, the HTML code of the web pages from the site is processed into the components of interest.  For this, the <a href="http://jsoup.org/">Jsoup</a> library is <a href="http://jsoup.org/">used</a> - a great thing that allows you to extract all the necessary data on the specified tags and attributes.  One <s>row</s> table is enough: <br><pre> <code class="java hljs">Document document = Jsoup.parse(html);</code> </pre> <br>  Well, after that the analysis of the elements. <br><br>  <i>For gourmets: a <code>Document</code> class object obtained after one-line processing provides two options for obtaining the necessary internal elements.</i>  <i>The first with the help of "ordinary" getters:</i> <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//         Elements contentElements = document.getElementsByAttributeValueContaining("class","hentry");</span></span></code> </pre> <br>  The second with the more convenient general <code>select()</code> method <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//  : document.select(".page-navigation .info-text [class*=live] ");</span></span></code> </pre> <br>  <i>As you can see, the second option is much more convenient, allowing you to reduce the amount of code.</i>  <i>One line searches for elements with a class attribute equal to ‚Äúpage-navigation‚Äù and ‚Äúinfo-text‚Äù, as well as containing the word ‚Äúlive‚Äù.</i>  <i>However, there were no significant performance benefits.</i> <br><br>  "Catching" necessary and not very tags and attributes conducted manually.  I took one page of each type and looked with my eyes, which elements I needed, which did not.  Special thanks to the developers - everything was clear and understandable.  Similarly acted with the main links to Habr. <br><br>  After processing HTML, a separate object of the corresponding type is created, be it a post, a question or an event, which are subsequently written into the corresponding table with the key = id.  The tables are made static and are available to the entire application via <code>DataManager</code> , a singleton class.  In memory, they are saved using the <b>java.io</b> package and <b>Context.getDir ()</b> . <br><br>  <i>For gourmets: I think that the Android developers, having read the previous lines, will grind meaningfully and think to themselves, something like "me too ...".</i>  <i>The fact is that it is not necessary (and I already understood it) to use java.io in this case, and naturally the database is better.</i>  <i>I caught a bunch of errors associated with just errors in reading and writing, because in Java objects are passed by reference, which need to be constantly updated, which of course can be trivially forgot to do.</i>  <i>Well, of course, the speed lost to checks and updates is not particularly pleasing and adds speed to the application, and the decrease in this case is linear and depends on the number of memorized elements.</i>  <i>I repent, made both easier and faster.</i>  <i>Not the fact that it became faster and certainly did not become easier.</i> <i><br></i>  <i>In general, will be redone.</i>  <i>100%.</i> <br><br>  With the display of the main text of the post (and any other material) there was a small hitch.  Many applications use <code>WebView</code> for this purpose - a special view for web pages, a very powerful tool capable of loading material from the network, displaying an existing one.  For me, his "lack" was power.  For example, annotations are implemented as drop-down list items ‚Äî using <code>WebView</code> would require more computational resources.  Therefore, the choice fell on the <code>TextView</code> , which received a <code>Html.fromHtml(‚Ä¶)</code> object from the <code>Html.fromHtml(‚Ä¶)</code> method.  It‚Äôs quite an effective way, which allows you to customize the display of the necessary tags (for example, ‚Äúcode‚Äù is my favorite) using <code>ImageGetter</code> and upload images from <code>ImageGetter</code> . <br><br>  <i>For gourmets: About pictures and <code>ImageGetter</code> .</i>  <i>By default, loading in the background is not possible - the interface is blocked.</i>  <i>It is easy and simple to solve - a background task, loading to the cache directory and updating <code>TextView</code> at the end.</i> <i><br></i>  <i>For some reason, it is not without problems.</i>  <i>Some pictures, mostly from external resources, not habrastorage, are loaded through one.</i>  <i>Cause until catch failed.</i>  <i>I'm working on it.</i> <br><br><h5>  Buns </h5><br>  Edit mode allows you to specify materials of interest and download their contents.  The program will record everything in memory, and later you can read them, for example, on the way to work in the subway. <br>  It is possible to clean as a whole all the lists, at once the entire tape, favorites, and it is possible to select several separate ones. <br>  If you do not want to spend money on traffic, and an interesting link is visible in the annotation to the post - a long press will help display a list of all available links.  The same is valid for links in responses and comments. <br>  Optionally, you can send a link to the post to your email.  I do not need, in principle, it may be necessary for people with an account to comment on the post they liked later.  In the future I will finish adding events to the calendar, while in the alpha version. <br>  As for the display of the video - replace it with a regular link.  The only thing that can not be imagined is Podcasts.  Honestly, I haven't even tried yet.  You may still have to go back to the <code>WebView</code> . <br>  And, of course, there is a download without pictures for ‚Äúvery‚Äù mobile networks. <br><br><h5>  Interface </h5><br>  The main type of the program, as can be seen from the first screenshot, is tabs that repeat the three main and most interesting (I wrote for myself) the Habr section.  Toward the end of the development process, the idea was to use a slide effect - switching between sections using a sliding gesture with your finger.  However, the desire to more correspond to the original overpowered.  In addition, the main view and it was by that time already so complex that it would require a decent time for rework. <br>  The colors used in the program, as well as the location of the main elements - the date, the name of the author, the themes are also taken from the habr.  Pictures and icons (except for those in the menu - <s>they stuck them from sdk</s> ) I drew myself.  And yes ... I am not a designer (* sighs sadly *).  But he tried, that really here. <br><br>  <i>For gourmets: Still, you should not make so rich with the details of the elements of lists.</i>  <i>It brakes decently, even though the border is ‚Äúwell, it is impossible to use it‚Äù and was not crossed.</i>  <i>I use.</i>  <i>The solution to this problem may be, for example, a special adapter with caching, loading and deleting elements as they appear on the device screen.</i>  <i><a href="https://github.com/commonsguy/cwac-endless">For example such.</a></i> <br><br>  Next - fewer letters, more screenshots: <br><br><img src="http://imglink.ru/pictures/30-09-11/ba4359055bfd670ab3f6a6e614e5d10b.jpg" alt="image"><br><img src="http://imglink.ru/pictures/30-09-11/e989134d02a2cb1efce44ed96ea450f3.jpg" alt="image"><br><img src="http://imglink.ru/pictures/30-09-11/fb75211bf647a9421ec5bb26dddd2fac.jpg" alt="image"><br><img src="http://imglink.ru/pictures/30-09-11/b2748125c09f0ce92f9d39a9b66c7201.jpg" alt="image"><br><img src="http://imglink.ru/pictures/30-09-11/f961a2882fece65a5dd0d4190dddd91d.jpg" alt="image"><br><br><h5>  Performance </h5><br>  In view of the features of the technology (Galaxy Tab without 3G, model P1010) I worked exclusively with Wi fi.  Home line at 8 Mbit.  In several cafes subjectively less.  I didn't really feel the difference. <br>  The main question is how much traffic is consumed.  The answer is as much as access to Habra through a regular browser. <br>  No less important is how fast everything works.  The answer is fast enough.  As already mentioned, for new posts, questions and events - processing takes place quickly, up to a maximum of 2-3 seconds, as measured.  If a lot of comments, and even the material is voluminous - maybe more.  Record on measurements - 10s.  Well, yes?  In defense I will say that it really was once.  On average - less than 5 seconds. <br>  The numbers are valid for displaying text, the pictures are loaded asynchronously and appear after loading, so I did not take into account the effect on reading. <br>  List scrolling speed - <code>ListView</code> - is worth a special mention.  It slows down, but tolerable.  He worked with lists of up to 70 items, more like there was no need. <br><br><h5>  findings </h5><br>  The process of writing a program is awesome.  Indeed, I liked writing very much, even, probably, more than actually using the application.  Still, programmers are creative people, whatever they say.  This is really euphoria - write a couple of lines and see the result. <br>  I tried myself in the ‚Äútheoretical‚Äù role of a freelancer.  And I tell you, it does not gush.  At home, one with a computer and a TV that creates the background, almost the whole day (I have already learned all the advertising).  In the same office at least some kind of communication happens.  Living, and.  Dine - one, because everything is at work.  And if you also come across an interesting problem, it may not let go of the weekend.  I caught myself thinking about the problem with the number of characters in a line, even in the movies I caught.  What is there - I explained to her father and friend!  About intents, broadkasy.  And he is my metallurgist, she is a biologist ... <br>  I hope I managed to put into practice the knowledge that I gained at the university.  Both practical and theoretical.  And, of course, get new ones.  And most importantly learn about some of their shortcomings.  Like, for example, ‚ÄúI will do it to work‚Äù or write a bunch of useful methods, and then forget everything and still write the code again.  I repent, poddramyvala and the overall organization of the process. <br><br><h5>  the main thing </h5><br>  The main thing that I understood for myself.  Any project (not even the author) needs to be constantly inspired to grow and improve further.  Anything can be a source of inspiration - the prospects are monetary, moral, competitive, it‚Äôs necessary to work, etc.  When a project begins to fulfill its tasks, while satisfying everyone - both authors and users - its development stops.  For Habrachtets, I am the author and only user at the moment, and everything in it suits me.  But I would not want it to stop its development.  That is why I told you about it. <br>  So, you have the floor. </div><p>Source: <a href="https://habr.com/ru/post/129738/">https://habr.com/ru/post/129738/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../129728/index.html">+1 GLONASS-M, total complete set</a></li>
<li><a href="../129730/index.html">Invitation to stream Apple presentation ‚ÄúLet's talk iPhone‚Äù</a></li>
<li><a href="../129733/index.html">Embedding Spring Security in the ZK + Spring Framework + Hibernate: Part Two</a></li>
<li><a href="../129735/index.html">Making HTML5 / Flash games in Java</a></li>
<li><a href="../129737/index.html">Home media server: setup and application aspects</a></li>
<li><a href="../129739/index.html">Assembler for beginners</a></li>
<li><a href="../129742/index.html">Social advertising: is it possible to survive in the USA with a salary of $ 9 / hour</a></li>
<li><a href="../129743/index.html">"Smart Home" with their own hands</a></li>
<li><a href="../129744/index.html">C / C ++. The main thing is to start!</a></li>
<li><a href="../129745/index.html">Rebuild the browser window</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>