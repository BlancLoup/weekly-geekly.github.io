<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>30-hour hakaton Yandex. Weather, or how to predict precipitation on signals from users</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, we conducted a hackathon on the use of signals from users in weather prediction. Today I will tell you why arranging such a competition is a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>30-hour hakaton Yandex. Weather, or how to predict precipitation on signals from users</h1><div class="post__text post__text-html js-mediator-article">  Recently, we conducted a hackathon on the use of signals from users in weather prediction.  Today I will tell you why arranging such a competition is almost a more difficult task than successfully performing it, what participants the participants managed to do in 30 hours and how we use the results of the hackathon. <br><br><img src="https://habrastorage.org/webt/4i/n0/hy/4in0hyat7utvkujz658vcaaq4pw.png"><br><br>  Yandeks.Pogoda today - a large combine for processing indications that are not tied to a specific user.  The service builds a forecast accurate to home due to machine learning from data received from large meteorological organizations.  <a href="https://habrahabr.ru/company/yandex/blog/343518/">Our recent launch of</a> world weather maps is another important step in the development of this system.  But there are other data that can positively affect the accuracy of the forecast. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  Why not use the testimony of home weather stations (of course, anonymized)?  Or you can use the pressure sensor readings in smartphones.  Or start to take into account in real time the error messages that users send from the application.  I gave some of the most obvious examples - add to them a lot of indirect signs of what the weather is around.  Take at least the strength of a cellular signal: when the phone does not catch the network well, one of the reasons is sometimes high humidity.  A couple of weeks ago, one startup even <a href="https://www.xconomy.com/boston/2017/11/27/climacell-bags-15m-to-predict-weather-from-wireless-network-signals/">attracted a</a> round of investment, promoting this idea. <br><br>  We made the first approach to understanding how data from users are able to help us, in early 2017.  For several days we studied the readings of the pressure sensors mentioned, as well as information from the error messages.  It became clear that there are too many possible methods and there are pitfalls everywhere.  The idea to host a hackathon was a logical decision: we were going to offer participants a non-standard task, and at the same time get to know them and use the results to find out which areas of work are the most promising. <br><br>  Any data scientist, including from Yandex (not from the Weather team), could participate in the hackathon, but with the condition that solutions from yandexoids would not fall into the overall ranking. <br><br><h2>  Training </h2><br>  We came up with the concept of the hackathon in the spring, but decided to hold it in the fall: first, to provide the teams with information gathered during the summer months, and second, that all potential participants have time to return from holidays.  Since we did not use user signals on a regular basis until then, we had to get them first.  We, <a href="https://habrahabr.ru/company/yandex/blog/271725/">as always</a> , reached all the suppliers (inside and outside Yandex) - and, as always, we ran into some problems.  The pressure sensor readings were unloaded, but not for the entire required time interval.  We also decided not to provide messages from users to the teams: the data turned out to be too ‚Äúdirty‚Äù.  The unprepared data scientist, as we believed, would not have been able to lay them in the basis of a serious algorithm in 30 hours, but would only spend his time. <br><br>  As a result, we prepared for the participants two sets of data for July and August of the current year.  The first array consisted of testimony from amateur weather stations Netatmo.  The manufacturer sells the testimony of each station, the owner of which has given its consent to this, and Yandex simply acted as one of the buyers.  The second array is an open base of mobile operators.  The database in an impersonal form indicates where the device was located and what was the strength of the signal from a particular cellular tower. <br><br>  For the competition were used figures collected in Moscow, St. Petersburg and Kazan.  In these cities there are radars whose readings have become an excellent target metric of the hackathon. <br><br><h2>  Task </h2><img src="https://habrastorage.org/webt/q_/zg/vk/q_zgvkp-uzg_a4hb7aqujcp2usq.png" align="right" width="300"><blockquote>  Each city is divided into squares.  The task of the team is to determine whether it was raining for each square and each hour.  In the training sample for each square known precipitation - the amount of precipitation in millimeters, fell at the end of an hour.  It is believed that rain fell if precipitation&gt; 0.25. </blockquote>  Note: the task required to predict precipitation, while Netatmo meteorological stations do not know how to register precipitation - they only record temperature, pressure, humidity, etc. <br><br><h2>  Our baseline solution </h2><br>  To simplify the lives of the participants, we have provided them with a basic solution, extracting features from all available data.  In particular, we showed how to add values ‚Äã‚Äãfrom meteorological stations to data from phones and train the model without spending too much memory.  Briefly about the decision itself: <br><blockquote>  In order to save resources, we will build a separate classifier for each of the three cities.  Based on the data from the phones in each square, we calculate simple signs: the number of users, the average value and the signal level dispersion.  Dispersion here acts as the easiest option to estimate the change in signal over time. <br><br>  Add to these signs the average weather data from the ten nearest weather stations.  Since the stations are not in every square, we use a k-dimensional tree (kd tree) to quickly find the nearest neighbors.  On top of all the signs, we will train the classifier on <a href="https://habrahabr.ru/company/yandex/blog/333522/">CatBoost</a> with default parameters and look at the resulting metrics. </blockquote>  Here is a good video about the principle of kd tree: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Y4ZgLlDfKDg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  It took us less than a day to write the baseline, but then we realized that we used extra data: the predicted values ‚Äã‚Äã‚Äúaccidentally‚Äù got into the training sample.  I had to urgently arrange a nightly mini-hackathon before the main hackathon - the final version of the basic solution, where we do not break our own rules, was ready in a matter of hours before the competition.  In total, two employees of Yandex.Pogoda spent about two full working weeks on data preparation and baseline development. <br><br><h2>  Decisions of the participants </h2><br>  The data provided to all teams occupied about 30 gigabytes.  We did not prohibit supplementing them, but demanded that the training sample contain only data from users - simply because it was in them that the whole meaning of the hackathon lay.  In other words, the base of indications of telephone pressure sensors would fit - if someone from the participants could get it.  But as has already been said, it‚Äôs not for nothing that we limited ourselves to figures from amateur weather stations and from operators.  Almost no one managed to find other suitable information on the Internet - and those who succeeded did not benefit from it anyway. <br><br>  30 gigabytes in a very limited time - not so little.  We warned participants that they would either have to use their laptops for machine learning, or rent cloud capacity. <br><br><h4>  Idea Yandex </h4><br>  <a href="https://github.com/gamers5a/YandexMeteumSolution">The solution</a> proposed by my colleagues from the <a href="https://habrahabr.ru/company/yandex/blog/311104/">YT</a> project was reduced to the generation of good features and learning by the classical method (gradient boosting over decisive trees).  The guys used CatBoost - perhaps because of patriotism towards Yandex, but according to them, our library showed ‚Äúmuch more‚Äù successful results than others. <br><br>  The best signs were data from amateur weather stations.  Based on them, various statistics were considered: average, maximum, minimum, variance, etc. It is worth noting that the readings of the nearest stations were used and a few more - distributed around the target square.  This distribution was not truly uniform: in Russia there are not so many Netatmo devices, and those that are always online and with the user's permission broadcast readings to the Internet, even less. <br><br>  Custom signs, such as the average speed of movement of people in the target square, also played a role, although not very large.  A total of about 7 thousand signs turned out - which, of course, could be filtered without losing as a model.  But the team had enough resources to train with so many, so optimization was not really required.  CatBoost itself was trained practically on default parameters: tuning led to absolutely insignificant changes in quality, and took a lot of time. <br><br><h4>  Winner Ideas </h4><br>  <b>Feature set enhancement</b> <br>  Firstly, the search for the nearest meteorological stations in the base solution was, of course, the most naive: the distance was calculated using the Euclidean metric.  It is not entirely correct to compare geographic coordinates in this way; therefore, many immediately suggested a correct calculation of the distance on a sphere. <br><br>  Secondly, as mentioned above, the number of stations is small, and the information from the next few of them does not always give a complete picture.  It so happens that all stations are located in the northeast, where it is now raining, and the weather in the west is completely different.  One of the teams divided each square into six sectors and set up a search for the nearest weather stations in all sectors separately. <br><br><img src="https://habrastorage.org/webt/u6/kn/sd/u6knsdoacwfdppil1rl_8vf_dxe.png"><br><br>  Thirdly, the base model processed data for each next hour, regardless of the values ‚Äã‚Äãobtained earlier.  Members of another team have adjusted the counting of various statistics from time series - which, in turn, were built on the basis of the data we provided. <br><br><img src="https://habrastorage.org/webt/dp/72/po/dp72po-9ya9tjtoz4zc2rboyba0.png"><br><br>  The base of mobile operators was less useful.  Some of the teams added additional features based on the signal strength data, but it turned out that they did not give a significant increase.  On the other hand, during the discussion of the results, the first place holders reported that the current average speed of movement of users provided a good contribution to the model.  And it's true - in case of rain, people tend to move faster to hide somewhere.  And another participant improved the result a bit when he took into account that during the precipitation there are fewer people on the street. <br><br>  <b>Improving the model itself</b> <br>  After some time, all the teams found that a model trained on the general data set for three cities works much better than if trained in each city separately. <br><br>  Then, according to the laws of the genre, you should try several libraries and play with the settings of the hyper parameters.  In addition to the traditional XGBoost team decided to use Microsoft's LightGBM.  Opinion of participants: CatBoost works no worse, but somewhat slower than competitors.  But many noted that the CatBoost based model is less prone to retraining: the result on the hidden test sample was almost the same as the result on the debug sample. <br><br><img src="https://habrastorage.org/webt/al/ru/ix/alruixjtwkjbk44-ewumowkq89c.png"><br><h5>  <sub><sup>Slide from the presentation of participants</sup></sub> </h5><br>  The teams didn‚Äôt have enough time for stacking (i.e., building an ensemble of algorithms) - although the fourth-place owner used the gradient boosting predictions to train a model similar to a convolutional neural network (!). <br><br>  * * * <br><br>  All prize winners did a great job with the factors and especially the readings of amateur weather stations Netatmo.  It was not easy: two neighboring stations, one of which is located under direct sunlight, and the other in the shade, can show the temperature with a difference of 15‚Äì20 degrees.  Once the participants understood such data in a short time, it means that the task could be complicated - and, for example, completely excluded Netatmo readings from the training set. <br><br>  As regards the use of results, the signs received by the teams will be the first candidates for signs in the service itself.  And of course, the experience of preparing a basic solution helped us a lot.  It combined several types of data collected around the desired area, according to the kd tree principle.  This is exactly the way to aggregate different signals that directly or indirectly indicate the development of a weather situation. <br><br>  We enjoyed the data science competition in the weather.  A possible topic for the next competition (not necessarily a hackathon) is long-term forecasts.  We have information about weather conditions around the world over the past 40 years.  In these data it is worth looking for patterns: it seems that very soon the system will be able to tell you that in a month and a half the temperature will fall below the norm and it will snow. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hx/sh/6f/hxsh6fzfukyf6yuudhlv8xufq0w.png" width="100"></div></div><p>Source: <a href="https://habr.com/ru/post/344366/">https://habr.com/ru/post/344366/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../344354/index.html">New vulnerability in Android allows attackers to modify applications without affecting their signatures.</a></li>
<li><a href="../344356/index.html">Why Go Design is Bad for Smart Programmers</a></li>
<li><a href="../344358/index.html">Digital events in Moscow from 11 to 17 December</a></li>
<li><a href="../344360/index.html">PHP Digest number 121 (November 20 - December 10, 2017)</a></li>
<li><a href="../344362/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ292 (December 4 - 10, 2017)</a></li>
<li><a href="../344368/index.html">React, Drag & Drop and performance</a></li>
<li><a href="../344370/index.html">Check Point Instructions and Useful Documentation</a></li>
<li><a href="../344372/index.html">Overview of Fujitsu PRIMERGY TX1330 M3 floor server</a></li>
<li><a href="../344374/index.html">Case SMS working on customer loyalty</a></li>
<li><a href="../344376/index.html">Vulnerability found in all versions of Windows, which does not close any antivirus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>