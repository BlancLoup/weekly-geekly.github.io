<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>As I wrote the MIDI keyboard</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not long ago, I had the idea to write my own MIDI keyboard. Later a guitar neck was bolted to it, she learned to recognize chords and play melodies. A...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>As I wrote the MIDI keyboard</h1><div class="post__text post__text-html js-mediator-article">  Not long ago, I had the idea to write my own MIDI keyboard.  Later a guitar neck was bolted to it, she learned to recognize chords and play melodies.  Actually about this will be this post. <br>  If you are interested in how to programmatically play sound through MIDI synthesizers, guitar chord recognition algorithm, or you just love to play the guitar or keyboard instruments, please use Cat. <br><a name="habracut"></a><br><h4>  One, two or three ... </h4><br>  Before you write the keyboard you need to somehow learn how to play the sound.  The first thing that comes to mind is to use a synthesizer built into the system.  It is on every device, and you do not need to install anything.  In general, it works out of the box. <br>  I decided to write the program on C #.  Searching in Google, I found out that .NET itself cannot work with MIDI, but there are WinAPI functions for that.  A subsequent search eventually led me to the <a href="http://naudio.codeplex.com/">NAudio</a> library.  With it, we will play sounds. <br><br>  To play a note, you need to send a specific message to MidiOut, with the indication of the playback channel, note and force. <br>  For example, you can play the note of the 3rd octave: <br><br><pre><code class="hljs rust">midiOut.<span class="hljs-built_in"><span class="hljs-built_in">Send</span></span>( MidiMessage.StartNote( <span class="hljs-number"><span class="hljs-number">57</span></span>, <span class="hljs-number"><span class="hljs-number">127</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ).RawData ) <span class="hljs-comment"><span class="hljs-comment">//id ,   (0-127),  ;</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But not everything is so simple, you need to stop playing the note, otherwise it will sound like that. <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">midiOut</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Send</span></span>( <span class="hljs-selector-tag"><span class="hljs-selector-tag">MidiMessage</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.StopNote</span></span>( 57, 0, 0 )<span class="hljs-selector-class"><span class="hljs-selector-class">.RawData</span></span> );</code> </pre> <br><br>  Before playing you need to open the desired MIDI device.  This is done by simply creating the MidiOut object.  The device number is transferred to the constructor, because  there may be several of them. <br>  You can find out their number by reading the static property MidiOut.NumberOfDevices, and get information about this device using the MidiOut.DeviceInfo method, passing it the identifier of the synthesizer. <br><br>  Remember that strange number 57?  This is the note ID.  The numbering starts from 0, each following value is an increase in tonality by a semitone. <br>  The dependence of the played note on the ID can be seen on the table: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eec/094/eaf/eec094eaf8f540efd6d7b73caeedd454.png" alt="image"><br><br>  After reviewing all this information, I wrote a class to simplify working with NAudio: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">internal</span></span> struct Note { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Note( byte oct, Tones t ) { octave = oct; tone = t; id = <span class="hljs-number"><span class="hljs-number">12</span></span> + octave * <span class="hljs-number"><span class="hljs-number">12</span></span> + (<span class="hljs-type"><span class="hljs-type">int</span></span>)tone; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> byte octave; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Tones tone; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> id; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> enum Tones { A = <span class="hljs-number"><span class="hljs-number">9</span></span>, Ad = <span class="hljs-number"><span class="hljs-number">10</span></span>, B = <span class="hljs-number"><span class="hljs-number">11</span></span>, C = <span class="hljs-number"><span class="hljs-number">0</span></span>, Cd = <span class="hljs-number"><span class="hljs-number">1</span></span>, D = <span class="hljs-number"><span class="hljs-number">2</span></span>, Dd = <span class="hljs-number"><span class="hljs-number">3</span></span>, E = <span class="hljs-number"><span class="hljs-number">4</span></span>, F = <span class="hljs-number"><span class="hljs-number">5</span></span>, Fd = <span class="hljs-number"><span class="hljs-number">6</span></span>, G = <span class="hljs-number"><span class="hljs-number">7</span></span>, Gd = <span class="hljs-number"><span class="hljs-number">8</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> AudioSintezator : IDisposable { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> PlayTone( byte octave, Tones tone ) { // <span class="hljs-number"><span class="hljs-number">12</span></span>   ,    <span class="hljs-number"><span class="hljs-number">0</span></span>-  (   <span class="hljs-number"><span class="hljs-number">-1</span></span>-) <span class="hljs-type"><span class="hljs-type">int</span></span> note = <span class="hljs-number"><span class="hljs-number">12</span></span> + octave * <span class="hljs-number"><span class="hljs-number">12</span></span> + (<span class="hljs-type"><span class="hljs-type">int</span></span>)tone; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( !playingTones.Contains( note ) ) { //    .     <span class="hljs-number"><span class="hljs-number">0</span></span> midiOut.Send( MidiMessage.StartNote( note, <span class="hljs-number"><span class="hljs-number">127</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ).RawData ); playingTones.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>( note ); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> note; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> StopPlaying( <span class="hljs-type"><span class="hljs-type">int</span></span> id ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( playingTones.Contains( id ) ) { //    midiOut.Send( MidiMessage.StopNote( id, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ).RawData ); playingTones.Remove( id ); } } MidiOut midiOut = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> MidiOut( <span class="hljs-number"><span class="hljs-number">0</span></span> ); List&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt; playingTones = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(); <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> Dispose() { midiOut.<span class="hljs-keyword"><span class="hljs-keyword">Close</span></span>(); midiOut.Dispose(); } }</code> </pre> <br></div></div><br>  And also made a trial version of the MIDI-keyboard <br><br><img src="https://habrastorage.org/getpro/habr/post_images/614/2df/0d5/6142df0d5567e3ba15510cff55c76d53.png" alt="image"><br><br><h4>  Sex, drugs and rock and roll </h4><br>  The next stage is the creation of a guitar neck and binding notes to strings and frets. <br>  Guitar neck is very simple.  Each string in the open position produces a sound with a specific tone.  The same string, clamped on a certain fret, makes a sound several tones above (1 fret - 1 semitone). <br>  If the open string makes an E4 sound, then it is clamped on the second fret and makes the sound F # 4, and on the 12th, E5. <br>  The algorithm is simple: we take the note of an open string, and increase it by a certain number of semitones. <br><br>  To simplify my life, I wrote a class: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Guitar { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Guitar( params Note[] tune ) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">6</span></span>; ++i ) { strs.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> GuitarString( tune[i] ) ); } } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> List&lt;Tuple&lt;byte, byte&gt;&gt; GetFretsForNote( Note note ) { // <span class="hljs-number"><span class="hljs-number">1</span></span>-    ( <span class="hljs-number"><span class="hljs-number">0</span></span>  <span class="hljs-number"><span class="hljs-number">5</span></span>), <span class="hljs-number"><span class="hljs-number">2</span></span>- -   ( <span class="hljs-number"><span class="hljs-number">0</span></span> -  ) List&lt;Tuple&lt;byte, byte&gt;&gt; result = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;Tuple&lt;byte, byte&gt;&gt;(); byte currentString = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>( var str <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> strs ) { var fret = str.GetFretForNote( note ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( fret != <span class="hljs-number"><span class="hljs-number">-1</span></span> ) //         { result.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Tuple&lt;byte, byte&gt;( currentString, (byte)fret ) ); } ++currentString; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Note GetNote( byte str, byte fret ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> strs[str].GetNoteForFret( fret ); } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> SetTuning( params Note[] tune ) //    { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">6</span></span>; ++i ) { strs[i].SetTune( tune[i] ); } } List&lt;GuitarString&gt; strs = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;GuitarString&gt;(); } <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> GuitarString { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> GuitarString( Note note ) { this.<span class="hljs-keyword"><span class="hljs-keyword">open</span></span> = note; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> SetTune( Note note ) { this.<span class="hljs-keyword"><span class="hljs-keyword">open</span></span> = note; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Note GetNoteForFret( byte fret ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> + fret; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> GetFretForNote( Note note ) { <span class="hljs-type"><span class="hljs-type">int</span></span> fret = <span class="hljs-number"><span class="hljs-number">-1</span></span>; // <span class="hljs-number"><span class="hljs-number">-1</span></span> ,        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> &lt;= note ) { <span class="hljs-type"><span class="hljs-type">int</span></span> octDiff = note.octave - <span class="hljs-keyword"><span class="hljs-keyword">open</span></span>.octave; <span class="hljs-type"><span class="hljs-type">int</span></span> noteDiff = note.tone - <span class="hljs-keyword"><span class="hljs-keyword">open</span></span>.tone; fret = octDiff * <span class="hljs-number"><span class="hljs-number">12</span></span> + noteDiff; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fret; } Note <span class="hljs-keyword"><span class="hljs-keyword">open</span></span>; }</code> </pre><br></div></div><br><br>  Here's what I got at this stage: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cd7/fce/fd0/cd7fcefd02e3387edd58a67e9f2c2e24.png" alt="image"><br><br><h4>  Triads, septa chords and other joys of music </h4><br>  This stage is also not particularly difficult except for one moment, which will be described a little later. <br>  It is a little theory: a chord is a set of sounds of certain keys.  These notes are not taken anyhow - they are located at certain intervals.  Intervals are measured in semitones. <br>  Accord in A minor, for example, has intervals of 3.4, i.e.  represents a sequence of notes: A, C, E (For, do, mi) <br>  I can‚Äôt tell you more about this, because  Amateur in music, conservatories did not finish.  And I'm afraid to tell a lot of things too much and far from the truth.  More can be found on <a href="http://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BA%25D0%25BA%25D0%25BE%25D1%2580%25D0%25B4">Wikipedia</a> . <br><br>  Let's go back to the program. <br>  The recognition algorithm is as follows: <ol><li>  Find the lowest sound, it will be the base for the chord (tonic, if not mistaken) </li><li>  We consider the intervals between the "neighboring" notes </li><li>  We are checking with the table of intervals prepared in advance. </li></ol><br>  It would be possible to finish this if it were not for one thing: guitar chords are not as simple as we would like.  They contain many sounds of a certain scale.  For example, the guitar in A minor contains already 5 sounds, even though these are the same la-domi. <br><br>  This complicates recognition: <ul><li>  Create a list of notes, removing from it duplicate sounds (up to different octaves, for example) </li><li>  We move them closer, removing distances in an octave, or even several </li><li>  We check according to the table of intervals.  If you do not find a match, then go ahead </li><li>  We look through all possible combinations (permutations) and check the table. </li><li>  If you still have not found, then we call the chord unknown. </li></ul><br>  As you probably already guessed, I also created a class to simplify working with chords: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">static <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Chords { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static ChordType[] chordTypes = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType[]{ <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType(" ", "", <span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType(" ", "m", <span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType(" ", "5+", <span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType(" ", "m-5", <span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType("  ", "maj7", <span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType("  ", "m+7", <span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType("", "7", <span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType("  ", "m7", <span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType(" ", "maj5+", <span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType(" ", "m7-5", <span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType(" ", "dim", <span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType("   (IV)", "sus2", <span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType("   (II)", "sus4", <span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType("","6", <span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType("", "m6", <span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType(" ", "9", <span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType(" ", "m9", <span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType(" ", "-9", <span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType(" ", "m-9", <span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType("",""), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType(" ", " - 2", <span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType(" ", " - 2", <span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType(" ", " - 3", <span class="hljs-number"><span class="hljs-number">3</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType(" ", " - 3", <span class="hljs-number"><span class="hljs-number">4</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType(" ", " - 4", <span class="hljs-number"><span class="hljs-number">5</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType(" ", " - 4", <span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType(" ", " - 5", <span class="hljs-number"><span class="hljs-number">7</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType(" ", " - 6", <span class="hljs-number"><span class="hljs-number">8</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType(" ", " - 6", <span class="hljs-number"><span class="hljs-number">9</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType(" ", " - 7", <span class="hljs-number"><span class="hljs-number">10</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType(" ", " - 7", <span class="hljs-number"><span class="hljs-number">11</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType("", " - ", <span class="hljs-number"><span class="hljs-number">12</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType(" ", " - 9", <span class="hljs-number"><span class="hljs-number">13</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ChordType(" ", " - 9", <span class="hljs-number"><span class="hljs-number">14</span></span>) }; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static string[] chordsBases = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> string[] { "A","A#","B","C","C#","D","D#","E", "F","F#","G","G#" }; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static string[] chordMods = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> string[] { "","m","5+","m-5","maj7","m+7","7", "m7","maj5+","m7-5","dim","sus2","sus4", "6","m6","9","m9","-9","m-9" }; private static <span class="hljs-type"><span class="hljs-type">int</span></span> GetChordType( List&lt;Note&gt; tmp ) { <span class="hljs-type"><span class="hljs-type">int</span></span>[] intervals = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span>[tmp.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; tmp.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>; ++i ) { intervals[i] = tmp[i] - tmp[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; } <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>( var chordType <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Chords.chordTypes ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( Utils.CompareArrays( intervals, chordType.intervals ) ) break; ++<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static <span class="hljs-type"><span class="hljs-type">void</span></span> GetChord( List&lt;Note&gt; chordNotes, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> Note BaseNote, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> ChordType <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> ) { List&lt;Note&gt; notes = PrepareNotes( chordNotes ); //     <span class="hljs-type"><span class="hljs-type">int</span></span> typeIndex = GetChordType( notes ); //    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( typeIndex &lt; chordTypes.Length ) //  { BaseNote = notes[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = chordTypes[typeIndex]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-type"><span class="hljs-type">bool</span></span> <span class="hljs-type"><span class="hljs-type">unknown</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; var possibleChord = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;Note&gt;( notes ); //    <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>( List&lt;Note&gt; perm <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Utils.GeneratePermutation( possibleChord ) ) { //     ( &gt; <span class="hljs-number"><span class="hljs-number">12</span></span>  ) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-type"><span class="hljs-type">int</span></span> k = <span class="hljs-number"><span class="hljs-number">1</span></span>; k &lt; perm.Count; ++k ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( perm[k].tone &gt; perm[k - <span class="hljs-number"><span class="hljs-number">1</span></span>].tone ) { perm[k] = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Note( perm[k - <span class="hljs-number"><span class="hljs-number">1</span></span>].octave, perm[k].tone ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { perm[k] = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Note( (byte)(perm[k - <span class="hljs-number"><span class="hljs-number">1</span></span>].octave + <span class="hljs-number"><span class="hljs-number">1</span></span>), perm[k].tone ); } } typeIndex = GetChordType( possibleChord ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( typeIndex &lt; Chords.chordTypes.Length ) { <span class="hljs-type"><span class="hljs-type">unknown</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; break; //    ,  } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-type"><span class="hljs-type">unknown</span></span> ) { throw <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>( " " ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { BaseNote = possibleChord[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = chordTypes[typeIndex]; } } } private static List&lt;Note&gt; PrepareNotes( List&lt;Note&gt; notes ) { List&lt;Note&gt; tmp = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;Note&gt;(); <span class="hljs-type"><span class="hljs-type">bool</span></span> finded = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; notes.Count; ++i ) { finded = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; var note = notes[i]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-type"><span class="hljs-type">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; tmp.Count; ++j ) //     { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( note.tone == tmp[j].tone ) { finded = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; break; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( !finded ) //      { tmp.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>( note ); } } //    ,     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( tmp.Count == <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; notes.Count &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> notes; // ""  byte lowest = tmp[<span class="hljs-number"><span class="hljs-number">0</span></span>].octave; var lowesTone = tmp[<span class="hljs-number"><span class="hljs-number">0</span></span>].tone; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; tmp.Count; ++i ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( tmp[i].octave &gt; lowest ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( Utils.CountOfTones( tmp[i].tone, notes ) &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( tmp[i].tone &gt; lowesTone ) { tmp[i] = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Note( lowest, tmp[i].tone ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { tmp[i] = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Note( (byte)(lowest + <span class="hljs-number"><span class="hljs-number">1</span></span>), tmp[i].tone ); } } } } tmp = tmp.OrderBy( x =&gt; x.id ).ToList(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tmp; } }</code> </pre><br></div></div><br><br>  Final result: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6ac/d69/b44/6acd69b44df9b0854491b5db3ab0c66c.png" alt="image"><br><br>  Full project source codes are available on <a href="https://github.com/DrA1ex/GuitarHelper">GitHub</a> . <br>  I also want to thank Comrade <a href="https://habrahabr.ru/users/sadler/" class="user_link">Sadler</a> , author of the post <a href="http://habrahabr.ru/post/148314/">‚ÄúOvation.</a>  Do-it-yourself chord table <a href="http://habrahabr.ru/post/148314/">using JS and HTML5 ‚Äù</a> , in which I spied on the chord table.  It saved me a bit of time. </div><p>Source: <a href="https://habr.com/ru/post/148852/">https://habr.com/ru/post/148852/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../148847/index.html">Get structured data from PostgreSQL</a></li>
<li><a href="../148849/index.html">Summary of the problem of ‚Äútwo or more teachers‚Äù and a subjective opinion about the AI ‚Äã‚Äãcommunity</a></li>
<li><a href="../14885/index.html">do not tell me?</a></li>
<li><a href="../148850/index.html">Qt + OpenCV. New device GigE interface access to network cameras as CvCapture</a></li>
<li><a href="../148851/index.html">VKontakte messenger for Windows Phone, prize pool 2 000 000 rubles!</a></li>
<li><a href="../148853/index.html">Runetology (158): founder of the online hotel booking service Oktogo.ru Marina Kolesnik</a></li>
<li><a href="../148854/index.html">Internet marketing: how to make content relevant</a></li>
<li><a href="../148855/index.html">Steam Subscriber Agreement Update</a></li>
<li><a href="../148856/index.html">Mythology Data Science</a></li>
<li><a href="../148857/index.html">ACACES'12 - HiPEAC Summer School</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>