<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pilot: multifunctional JavaScript router</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Every day the sites are becoming more and more complex. It is not enough just to ‚Äúrevive‚Äù the interface - it is increasingly necessary to create a ful...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pilot: multifunctional JavaScript router</h1><div class="post__text post__text-html js-mediator-article">  Every day the sites are becoming more and more complex.  It is not enough just to ‚Äúrevive‚Äù the interface - it is increasingly necessary to create a full-fledged one-page application.  A striking example of such an application is any web-mail (for example, <a href="https://e.mail.ru/">Mail.Ru</a> ), where links follow not to reload the page, but only to change the presentation.  This means that the task of obtaining data and displaying them, depending on the route, which has always been the prerogative of the server, falls on the client.  Usually, this problem is solved with the help of a simple router, based on regular expressions, and is not further developed, while the back-end of this topic is given much more attention.  In this article I will try to fill this gap. <br><br><a name="habracut"></a><br><br><h2>  What is routing? </h2><br>  This is probably the most underrated part of a javascript application:] 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      On the server, routing is the process of determining the route within the application, depending on the request.  Simply put, it is a search for the controller at the requested URL and the execution of appropriate actions. <br><br>  Consider the following task: you need to create a one-page application "Gallery", which will consist of three screens: <br><ul><li>  Home - choice of direction in painting </li><li>  View gallery - display pictures with page navigation and the ability to change the number of items on the page </li><li>  Detailed view of the selected work </li></ul><br><br>  Schematically, the application will look like this: <br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"app"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"app-index"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display: none"</span></span></span><span class="hljs-tag">&gt;</span></span>...<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"app-gallery"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display: none"</span></span></span><span class="hljs-tag">&gt;</span></span>...<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"app-artwork"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display: none"</span></span></span><span class="hljs-tag">&gt;</span></span>...<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Each screen will have its own URL, and the router describing them may look like this: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Router = { <span class="hljs-attr"><span class="hljs-attr">routes</span></span>: { <span class="hljs-string"><span class="hljs-string">"/"</span></span>: <span class="hljs-string"><span class="hljs-string">"indexPage"</span></span>, <span class="hljs-string"><span class="hljs-string">"/gallery/:tag/"</span></span>: <span class="hljs-string"><span class="hljs-string">"galleryPage"</span></span>, <span class="hljs-string"><span class="hljs-string">"/gallery/:tag/:perPage/"</span></span>: <span class="hljs-string"><span class="hljs-string">"galleryPage"</span></span>, <span class="hljs-string"><span class="hljs-string">"/gallery/:tag/:perPage/page/:page/"</span></span>: <span class="hljs-string"><span class="hljs-string">"galleryPage"</span></span>, <span class="hljs-string"><span class="hljs-string">"/artwork/:id/"</span></span>: <span class="hljs-string"><span class="hljs-string">"artworkPage"</span></span>, } };</code> </pre> <br>  In the `routes` object, the following routes are set: the key is the path template, and the value is the name of the controller function. <br><br>  Next, you need to convert the keys of the object `Router.routes` into regular expressions.  To do this, define the `Router.init` method: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Router = { <span class="hljs-attr"><span class="hljs-attr">routes</span></span>: { <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }, <span class="hljs-attr"><span class="hljs-attr">init</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._routes = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> route <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.routes ){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> methodName = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.routes[route]; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._routes.push({ <span class="hljs-attr"><span class="hljs-attr">pattern</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">RegExp</span></span>(<span class="hljs-string"><span class="hljs-string">'^'</span></span>+route.replace(<span class="hljs-regexp"><span class="hljs-regexp">/:\w+/</span></span>, <span class="hljs-string"><span class="hljs-string">'(\\w+)'</span></span>)+<span class="hljs-string"><span class="hljs-string">'$'</span></span>), <span class="hljs-attr"><span class="hljs-attr">callback</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[methodName] }); } } };</code> </pre> <br><br>  It remains to describe the navigation method that will search for the route and call the controller: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Router = { <span class="hljs-attr"><span class="hljs-attr">routes</span></span>: { <span class="hljs-comment"><span class="hljs-comment">/* ‚Ä¶ */</span></span> }, <span class="hljs-attr"><span class="hljs-attr">init</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ‚Ä¶ */</span></span> }, <span class="hljs-attr"><span class="hljs-attr">nav</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">path</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._routes.length; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>( i-- ){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> args = path.match(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._routes[i].pattern); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( args ){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._routes[i].callback.apply(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, args.slice(<span class="hljs-number"><span class="hljs-number">1</span></span>)); } } } };</code> </pre> <br><br>  When everything is ready, we initialize the router and set the starting point of the navigation.  It is important not to forget to intercept the `click` event from all links and redirect to the router. <br><br><pre> <code class="javascript hljs">Router.init(); Router.nav(<span class="hljs-string"><span class="hljs-string">"/"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   $("body").on("click", "a", function (evt){ Router.nav(evt.currentTarget.href); evt.preventDefault(); });</span></span></code> </pre><br><br>  As you can see, nothing complicated;  I think many people are familiar with this approach.  Typically, all the differences in implementations are reduced to the format of the recording route and its transformation into a regular expression. <br><br>  Let's return to our example.  The only thing that is missing in it is the implementation of the functions responsible for processing the route.  Typically, they are collecting data and drawing, for example, like this: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Router = { <span class="hljs-attr"><span class="hljs-attr">routes</span></span>: { <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> }, <span class="hljs-attr"><span class="hljs-attr">init</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> }, <span class="hljs-attr"><span class="hljs-attr">nav</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> }, <span class="hljs-attr"><span class="hljs-attr">indexPage</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ ManagerView.set(<span class="hljs-string"><span class="hljs-string">"index"</span></span>); }, <span class="hljs-attr"><span class="hljs-attr">galleryPage</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">tag, perPage, page</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> query = { <span class="hljs-attr"><span class="hljs-attr">tag</span></span>: tag, <span class="hljs-attr"><span class="hljs-attr">page</span></span>: page, <span class="hljs-attr"><span class="hljs-attr">perPage</span></span>: perPage }; api.find(query, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">items</span></span></span><span class="hljs-function">)</span></span>{ ManagerView.set(<span class="hljs-string"><span class="hljs-string">"gallery"</span></span>, items); }); }, <span class="hljs-attr"><span class="hljs-attr">artworkPage</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id</span></span></span><span class="hljs-function">)</span></span>{ api.findById(id, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item</span></span></span><span class="hljs-function">)</span></span>{ ManagerView.set(<span class="hljs-string"><span class="hljs-string">"artwork"</span></span>, item); }); } };</code> </pre> <br><br>  At first glance, it looks good, but there are pitfalls.  Data acquisition occurs asynchronously, and with fast movement between routes you can get quite different from what was expected.  For example, consider the following situation: the user clicked on the link of the second page of the gallery, but in the process of loading he became interested in the work from the first page and decided to see it in detail.  As a result, it took two requests.  They can work out in random order, and the user instead of the picture will get the second page of the gallery. <br><br>  This problem can be solved in different ways;  everyone chooses his own way.  For example, you can call `abort` for the previous request, or transfer the logic to` ManagerView.set`. <br><br>  What does `ManagerView` do?  The `set (name, data)` method takes two parameters: the name of the ‚Äúscreen‚Äù and ‚Äúdata‚Äù for its construction.  In our case, the task is greatly simplified, and the `set` method displays the desired element by id.  It uses the view name as a postfix `" app - "+ name`, and the data - to build html.  Also `ManagerView` must remember the name of the previous screen and determine when the route began / changed / ended in order to correctly manipulate the appearance. <br><br>  So we created a one-page application, with our `Router` and` ManagerView`, but it will take time, and we will need to add new functionality.  For example, the section "Articles", where there will be descriptions of "works" and links to them.  When you go to view "work" you need to build a link "Back to the article" or "Back to the gallery", depending on where the user came from.  But how to do that?  Neither `ManagerView`, nor` Router` have similar data. <br><br>  There is also one more important point - these are links.  Page navigation, links to sections, etc., how to "build" them?  "Sew" right into the code?  Create a function that will return the URL by mnemonics and parameters?  The first option is completely bad, the second is better, but not perfect.  From my point of view, the best option is the ability to set the `id` route and method that allows you to get the URL by ID and parameters.  This is good because the route and the rule for the formation of the URL are the same, and this option does not lead to duplication of the logic for obtaining the URL. <br><br>  As you can see, such a router does not solve the tasks, so, in order not to invent a bicycle, I went to a search engine, creating a list of requirements for an ideal (in my understanding) router: <br><ul><li>  the most flexible syntax of the route description (for example, as in Express) </li><li>  work with the query, and not just with individual parameters (as in the example) </li><li>  ‚Äústart‚Äù, ‚Äúchange‚Äù and ‚Äúend‚Äù events of the route (/ gallery / cubism / -&gt; / gallery / cubism / 12 / page / 2 -&gt; / artwork / 123 /) </li><li>  possibility of assigning multiple handlers to one route </li><li>  the possibility of assigning ID routes and navigating them </li><li>  another way of interaction `data ‚Üê ‚Üí view` (if possible) </li></ul><br><br>  As you may have guessed, I did not find what I wanted, although there were some very decent solutions, such as: <br><ul><li>  <a href="http://millermedeiros.github.com/crossroads.js/">Crossroads.js</a> - very powerful work with routes </li><li>  <a href="https://github.com/mtrpcic/pathjs">Path.js</a> - is the implementation of the events of the beginning and end of the route, 1KB (Closure compiler + gzipped) </li><li>  <a href="http://haithembelhaj.github.com/RouterJs/">Router.js</a> - simple and functional, only 443 bytes (Closure compiler + gzipped) </li></ul><br><br><br><h2>  Pilot </h2><br>  And now it's time to do the same thing, but using Pilot.  It consists of three parts: <br><ol><li>  <b>Pilot</b> - the router itself </li><li>  <b>Pilot.Route</b> - route controller </li><li>  <b>Pilot.View</b> - advanced route controller, inherits Pilot.Route </li></ol><br><br>  We define the controllers responsible for the routes.  The HTML structure of the application remains the same as in the example in the first part of the article. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ,     var pages = {}; //     pages.index = Pilot.View.extend({ el: "#app-index" }); //   pages.gallery = Pilot.View.extend({ el: "#app-gallery", template: function (data/**Object*/){ /*    this.getData() */ return html; }, loadData: function (req/**Object*/){ // app.find ‚Äî  $.Deferred(); return app.find(req.params, this.bound(function (items){ this.setData(items); })); }, onRoute: function (evt/**$.Event*/, req/**Object*/){ //    routerstart  routeend this.render(); } }); //   pages.artwork = Pilot.View.extend({ el: "#app-artwork", template: function (data/**Object*/){ /*    this.getData() */ return html; }, loadData: function (req/**Object*/){ return api.findById(req.params.id, this.bound(function (data){ this.setData(data); })); }, onRoute: function (evt/**$.Event*/, req/**Object*/){ this.render(); } });</span></span></code> </pre> <br><br><br>  Switching between routes involves changing screens, so in the example I use Pilot.View.  In addition to working with DOM elements, an instance of its class is initially subscribed to routestart and routeend events.  With these events, Pilot.View controls the display of the DOM element associated with it, exposing it `display: none` or removing it.  The node itself is assigned via the `el` property. <br><br>  There are three types of events: routestart, routechange, and routeend.  They are caused by the router to the controller (s).  Schematically it looks like this: <br><br>  There are three routes and their controllers: <br><br><pre> <code class="javascript hljs"> <span class="hljs-string"><span class="hljs-string">"/"</span></span> -- pages.index <span class="hljs-string"><span class="hljs-string">"/gallery/:page?"</span></span> -- pages.gallery <span class="hljs-string"><span class="hljs-string">"/artwork/:id/"</span></span> -- pages.artwork</code> </pre><br><br>  Each route can have multiple URLs.  If the new URL matches the current route, then the router generates a routechage event.  If the route has changed, then its controller receives the routeend event, and the new controller receives the routestart event. <br><br><pre> <code class="javascript hljs"> <span class="hljs-string"><span class="hljs-string">"/"</span></span> -- pages.index.routestart <span class="hljs-string"><span class="hljs-string">"/gallery/"</span></span> -- pages.index.routeend, pages.gallery.routestart <span class="hljs-string"><span class="hljs-string">"/gallery/2/"</span></span> -- pages.gallery.routechange <span class="hljs-string"><span class="hljs-string">"/gallery/3/"</span></span> -- pages.gallery.routechange <span class="hljs-string"><span class="hljs-string">"/artwork/123/"</span></span> -- pages.artwork.routestart, pages.gallery.routeend</code> </pre><br><br>  In addition to changing the container's visibility (`this.el`), as a rule, you need to update its contents.  To do this, Pilot.View has the following methods that need to be redefined depending on the task: <br><br>  <b>template (data)</b> is a template method within which HTML is generated.  The example uses the data obtained in loadData. <br><br>  <b>loadData (req)</b> is perhaps the most important controller method.  Called every time the URL changes, receives the request object as a parameter.  It has a feature: if you return $ .Deferred, the router will not go to this URL until the data has been collected. <br><div class="spoiler">  <b class="spoiler_title">req - request</b> <div class="spoiler_text"><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">"http://domain.ru/gallery/cubism/20/page/3"</span></span>, <span class="hljs-attr"><span class="hljs-attr">path</span></span>: <span class="hljs-string"><span class="hljs-string">"/gallery/cubism/20/page/123"</span></span>, <span class="hljs-attr"><span class="hljs-attr">search</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">query</span></span>: {}, <span class="hljs-attr"><span class="hljs-attr">params</span></span>: { <span class="hljs-attr"><span class="hljs-attr">tag</span></span>: <span class="hljs-string"><span class="hljs-string">"cubism"</span></span>, <span class="hljs-attr"><span class="hljs-attr">perPage</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-attr"><span class="hljs-attr">page</span></span>: <span class="hljs-number"><span class="hljs-number">123</span></span> }, <span class="hljs-attr"><span class="hljs-attr">referrer</span></span>: <span class="hljs-string"><span class="hljs-string">"http://domain.ru/gallery/cubism/20/page/2"</span></span> }</code> </pre> </div></div><br>  <b>onRoute (evt, req)</b> - auxiliary event.  Called after routestart or routechange.  The example is used to update the contents of the container by calling the render method. <br><br>  <b>render ()</b> is a method for updating the HTML container (`this.el`).  Calls this.template (this.getData ()). <br><br>  It now remains to build the application.  For this we need a router: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> GuideRouter = Pilot.extend({ <span class="hljs-attr"><span class="hljs-attr">init</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     : this .route("index", "/", pages.index) .route("gallery", "/gallery/:tag/:prePage?(/page/:page/)?", pages.gallery) .route("artwork", "/artwork/:id/", pages.artwork) ; } }); var Guide = new GuideRouter({ //  ,       el: "#app", //  HistoryAPI useHistory: true }); //   Guide.start();</span></span></code> </pre> <br><br>  First of all, we create a router and define routes in the `init` method.  The route is set by the `route` method.  It takes three arguments: the route id, pattern, and controller. <br><br>  The syntax of the route, I will not dissemble, borrowed from Express.  He came up on all counts, and those who have already worked with <a href="http://expressjs.com/">Express</a> , will be easier.  The only thing is added groups;  they allow you to more flexibly customize the pattern of the route and help you navigate by id. <br><br>  Consider the route responsible for the gallery: <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//       this.route("gallery", "/gallery/:tag/:prePage?(/page/:page/)?", ‚Ä¶) //     ,    `page`. //    ,     . Guide.getUrl("gallery", { tag: "cubism" }); // "/gallery/cubism/"; Guide.getUrl("gallery", { tag: "cubism", page: 2 }); // "/gallery/cubism/page/2/"; Guide.getUrl("gallery", { tag: "cubism", page: 2, perPage: 20 }); // "/gallery/cubism/20/page/2/";</span></span></code> </pre> <br><br>  It turned out very convenient: the route and the URL is the same.  This avoids explicit URLs in the code and the need to create additional methods for the generated URLs.  Guide.go (id, params) is used to navigate to the desired route. <br><br>  The last action creates a GuideRouter instance with options to intercept links and use the History API.  By default, Pilot works with location.hash, but it is possible to use history.pushState.  To do this, set Pilot.pushState = true.  But, if the browser does not support location.hash or history.pushState, then to fully support the History API, you need to use a polyfill, or any other suitable library.  When implementing, you will have to override two methods - Pilot.getLocation () and Pilot.setLocation (req). <br><br>  Here in general, that's all.  The remaining features can be found in the documentation. <br>  Waiting for your questions, issue and any other returns:] <br><br><br><h6>  useful links </h6>  - <a href="http://rubaxa.github.com/Pilot/">Example</a> ( <a href="">app.js</a> ) <br>  - <a href="http://rubaxa.github.com/Pilot/">Documentation</a> <br>  - <a href="https://github.com/RubaXa/Pilot">Sources</a> <br>  - <a href="https://gist.github.com/RubaXa/5057568">jquery.leaks.js</a> ( <a href="http://ibnrubaxa.blogspot.ru/2013/03/jquery-memory-leaks.html">jQuery.cache</a> monitoring <a href="http://ibnrubaxa.blogspot.ru/2013/03/jquery-memory-leaks.html">utility</a> ) </div><p>Source: <a href="https://habr.com/ru/post/172333/">https://habr.com/ru/post/172333/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../172323/index.html">Google developed smart interactive sneakers (+ video)</a></li>
<li><a href="../172325/index.html">Eye tracking is entering the consumer market</a></li>
<li><a href="../172327/index.html">About candy wrappers, okroshka and investment</a></li>
<li><a href="../172329/index.html">Some questions on .NET and C # (answers with analysis)</a></li>
<li><a href="../172331/index.html">Laboratories with 3D printers or future weapons factories of World War III</a></li>
<li><a href="../172335/index.html">Two months with Nexus 4</a></li>
<li><a href="../172339/index.html">Wrestling ratings</a></li>
<li><a href="../172343/index.html">Keepers: Review of Credit Card Storage Applications</a></li>
<li><a href="../172345/index.html">Making a VoIP GSM gateway from Tp-link mr-3020 and Huawei E-171 - part two - add Siemens Gigaset c470IP and SMS</a></li>
<li><a href="../172351/index.html">Leap Motion. Impressions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>