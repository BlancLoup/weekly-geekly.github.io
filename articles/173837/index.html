<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OpenStreetMap using MkMapKit</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 
 In this article I will try to describe how we (the Maptrix developers) defeated Apple maps and replaced them with maps from OpenStreetMap . 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>OpenStreetMap using MkMapKit</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br>  In this article I will try to describe how we (the Maptrix developers) defeated Apple maps and replaced them with maps from <a href="http://openstreetmap.org/">OpenStreetMap</a> . <br><br><a name="habracut"></a><br><br><h5>  Problem: </h5><br>  It's no secret that, starting with iOS 6.0 firmware in the embedded component MkMapkit, Apple's cards are used.  Finally, Apple became independent and was able to abandon Google.  At the <a href="http://apsoid.ru/news-ios/3524">presentation,</a> everything looked awesome! <br>  But as always one ‚Äúbut‚Äù: all these 3d wonders are available only to US users (well, and some other developed countries).  In particular, according to the ideas of Apple, the inhabitants of Russia live in one big desert. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/2d8/b4c/510/2d8b4c510474077c60f7099e6c72cc8d.jpg" alt="image"><br><br><h5>  Possible solutions: </h5><br>  The first thought was to leave MKMapView. <br>  Unfortunately, from the considered analogues, it was not possible to find a full-fledged copy of this library.  A less similar structure, by the way, is in the Yandex library (http://github.com/yandexmobile/yandexmapkit-ios and <a href="http://github.com/yandexmobile/yandexmapkit-ios">github.com/yandexmobile/yandexmapkit-ios</a> ). <br>  So, we came to the idea that working with a map, pins, etc.  it is necessary to leave it as it is, and in place of pictures of cards from Apple to substitute any more developed ones. <br><br>  As a result, we decided to use Open Street Map and <a href="http://wiki.openstreetmap.org/wiki/OSM_in_MapKit">now this library</a> with some modifications. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/492/a6f/ba3/492a6fba3fbd28fb54f8ff3fed3e4e56.jpg" alt="image"><br><br><h5>  What did not suit: </h5><br>  1. When switching Satelite Map, the map did not switch. <br>  2. If the card is not loaded, Apple first appeared on the map, after which the OSM card blocked it <br><br><h5>  So, the code itself: </h5><br>  1. Add the necessary files <br>  <a href="https://github.com/nutiteq/ldiw-iphone/tree/master/OSM">github.com/nutiteq/ldiw-iphone/tree/master/OSM</a> <br><br>  2.h ViewController file <br><br><pre><code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"TileOverlay.h"</span></span></span><span class="hljs-meta"> @interface MapView : UIViewController </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;MKMapViewDelegate&gt;</span></span></span><span class="hljs-meta"> { IBOutlet MKMapView *mapView; } @property (nonatomic, retain) TileOverlay *overlay;</span></span></code> </pre> <br>  3.m ViewController file <br><pre> <code class="objectivec hljs"> <span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"TileOverlay.h"</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"TileOverlayView.h"</span></span></span><span class="hljs-meta"> @synthesize overlay; - (void)viewDidLoad { [super viewDidLoad]; overlay = [[TileOverlay alloc] initOverlay]; MKMapRect visibleRect = [mapView mapRectThatFits:overlay.boundingMapRect]; visibleRect.size.width /= 2; visibleRect.size.height /= 2; visibleRect.origin.x += visibleRect.size.width / 2; visibleRect.origin.y += visibleRect.size.height / 2; mapView.visibleMapRect = visibleRect; [self SetMapDisplayTypeToSatelite:NO]; } - (void)SetMapDisplayTypeToSatelite:(BOOL)IsSatelite{ mapView.mapType = (IsSatelite == NO) ? MKMapTypeSatellite : MKMapTypeStandard; [self AddRemoveOverlay:IsSatelite]; } - (void)AddRemoveOverlay:(BOOL)show{ //   1:  OSM     6.0 NSString *reqSysVer = @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"6.0"</span></span></span><span class="hljs-meta">; NSString *currSysVer = [[UIDevice currentDevice] systemVersion]; if ([currSysVer compare:reqSysVer options:NSNumericSearch] != NSOrderedAscending){ if (show == YES &amp;&amp; [Maptrix appmodel].SegmentMapPressed == YES) { [mapView addOverlay:overlay]; //  2:  ,      Apple     if ( [mapView.subviews count] &amp;&amp; [((UIView *)[mapView.subviews objectAtIndex:0]).subviews count] ) ((UIView *)[((UIView *)[mapView.subviews objectAtIndex:0]).subviews objectAtIndex:0]).alpha = 0.0; }else if (show == NO &amp;&amp; [Maptrix appmodel].SegmentMapPressed == NO){ [mapView removeOverlay:overlay]; //  3:           Apple if ( [mapView.subviews count] &amp;&amp; [((UIView *)[mapView.subviews objectAtIndex:0]).subviews count] ) ((UIView *)[((UIView *)[mapView.subviews objectAtIndex:0]).subviews objectAtIndex:0]).alpha = 1.0; } } }</span></span></code> </pre><br><br><h5>  Total </h5><br>  For firmware over 6.0, OSM cards are used.  And until the card is loaded, the user will not see the Apple card.  When switching between map / satellite, the map changes between OSM and Apple. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6fd/b09/577/6fdb0957788cb3f3f85483618b77a1a8.jpg" alt="image"><br><br>  I honestly was afraid that Apple would not let us down.  We blocked the Apple cards, made their map transparent (alpha = 0).  And yet we zapruvili.  Here is the <a href="https://itunes.apple.com/ru/app/maptrix/id585192185">link</a> . <br>  Now we plan to connect OSM on android.  But more about that in the next article. </div><p>Source: <a href="https://habr.com/ru/post/173837/">https://habr.com/ru/post/173837/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../173823/index.html">Install the second hard drive in the Samsung 300V laptop</a></li>
<li><a href="../173825/index.html">Bortnik Fund - "easy money" for the benefit or harm</a></li>
<li><a href="../173827/index.html">Apple introduced two-factor verification for Apple ID and iCloud accounts</a></li>
<li><a href="../173833/index.html">Oscillograph cartoon</a></li>
<li><a href="../173835/index.html">Phase Two Calls for Papers of PHDays III Forum Launches</a></li>
<li><a href="../173839/index.html">How to create a new "Education"</a></li>
<li><a href="../173841/index.html">The most detailed relic radiation map of the Universe has been published.</a></li>
<li><a href="../173843/index.html">Increasing the dynamic range when developing an optical reflectometer</a></li>
<li><a href="../173847/index.html">YouTube may enter a subscription fee for the subscription to the channels this spring.</a></li>
<li><a href="../173849/index.html">Free online application development school for Windows 8</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>