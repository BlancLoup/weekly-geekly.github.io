<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Client optimization and development stages</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Usually, the user doesn‚Äôt care what approaches we use in development, how the server is configured, what client and server frameworks we use. It can w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Client optimization and development stages</h1><div class="post__text post__text-html js-mediator-article">  Usually, the user doesn‚Äôt care what approaches we use in development, how the server is configured, what client and server frameworks we use.  It can worry how useful the site is, convenient and fast.  Our task is not to cause inconvenience to the user, to please him, and thereby force him to buy our mega-product or look at our wonderful banners.  This article is about how to create fast sites. <br><a name="habracut"></a><img src="https://habrastorage.org/getpro/habr/post_images/7e6/818/dc0/7e6818dc0a8ef54f6695b8cb7537cbcc.gif"><br><h2>  How to evaluate the performance of the site? </h2><br>  I used only two services to get at least some kind of formalized and reliable assessment: this is a plug-in for FireBug "YSlow" and the website <a href="http://webo.in/">webo.in</a> (I am sure that there are many more such services). <br><blockquote>  Evaluation of the quality of content delivery from the server to the client, which <b>YSlow</b> gives out, is a summary indicator, simple and clear: ‚ÄúPerformance Grade A‚Äù - everything is good, ‚ÄúPerformance Grade F‚Äù - everything is bad.  This score is formed from 13 other sub-parameters, even simpler, described in English on the site <a href="http://developer.yahoo.com/performance/rules.html">developer.yahoo.com</a> <br>  The result of the <b>webo.in</b> service is two estimates, based on an analysis of how the developers follow the advice of the owner of the service and the amount of information presented on the site and a list of recommendations for further optimization.  Plus, the site has a large number of articles on this topic. </blockquote><br>  For a complete picture, I would advise using both methods of assessment.  But keep in mind that user experience and automatically generated assessment can be very different. <br><br><h2>  How does the user understand which site is faster and which is slower? </h2><br>  We visit websites for the sake of information and the sooner we get it in a readable form, the higher will be our opinion about the site.  Thus, one of the primary tasks of the developer is to minimize the time for receiving the <b>completed information</b> and to exclude everything that can postpone this moment. <br><br>  In fact, I have already described the goal of the first stage of development (the server part is included in this first stage =) But before describing it in detail, I would like to stop at one important moment, in my opinion. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote><h3>  Methodology </h3>  On the way to the optimal result, there are a number of problems, mostly organizational ones, and the technical side of the question is <b>always</b> easily formalized, which means it can be <b>solved</b> . <br><br>  Let's select from the entire technological process <i>"from the creative and the TK to the beginning of operation"</i> , in fact, the development process <i>"from the database to the full page load</i> . <i>"</i>  For server development, more than one approach, method or pattern has been developed: take, for example, <b>MVC</b> .  Client development is: HTML - structure ( <b>S</b> tructure), CSS - appearance ( <b>P</b> resentation), JavaScript - behavior ( <b>B</b> ehavior).  In total, there are 6 parts: Model, View, Controller, Structure, Presentation, Behavior, of which two are the same: the server View is the client Structure. <br><br><h3>  M =&gt; C =&gt; <i>[V == S]</i> =&gt; P =&gt; B </h3>  I believe that it is necessary to consider all 5 parts of the process, as a whole.  In this process, all parts are designed for the rest, following them;  and errors in their design and implementation will lead to temporary losses in the following parts and to the <i>slow or incorrect operation of the final result</i> . <br>  To minimize the likelihood of errors, it is necessary that each of the parts of the process to perform <b>only</b> its own tasks.  For example, the document structure should not contain attributes that perform the functions of appearance or behavior: <i>style</i> , <i>onclick</i> , <i>onmouseover</i> ;  All CSS and JavaScript should be rendered to external files. <br><br><h3>  Division of labor </h3>  The following specializations can be distinguished for the implementation of such a scheme: <br>  - <b>M =&gt; C</b> - DB designer, developer of system modules <br>  - <b>C =&gt; <i>[V == S]</i></b> - CMS development, automation of work with templates <br>  - <b><i>[V == S]</i> =&gt; P</b> - layout and layout <br>  - <b><i>[V == S]</i></b> =&gt; B <b>=&gt; P</b> - JavaScript (here I do not know what to call a specialization) <br>  These are about 3 people (I do not consider admins, designers, managers and directors =) </blockquote>  So, <br><br><h2>  Stage 1: Delivery of information and clearance </h2><br>  At this stage, developers should do everything possible not to slow down the page loading speed. <br><br>  <b>Ways to speed up the receipt of information</b> <br>  <a href="&amp;xid=17259,15700022,15700186,15700191,15700253,15700256,15700259&amp;usg=ALkJrhgoTE2COLPqrCrvJDtUQD_38JRJ9A#">Reducing the number of HTTP requests</a> , <a href="http://webo.in/articles/habrahabr/15-yahoo-best-practices/">Compressing HTML and CSS</a> , <a href="http://developer.yahoo.com/performance/rules.html">Placing static components of a page across several domains</a> , <a href="http://developer.yahoo.com/performance/rules.html">Reducing the number of DOM elements</a> , <a href="http://webo.in/articles/habrahabr/15-yahoo-best-practices/">Placing CSS in the HEAD page</a> , Configuring HTTP headers ( <a href="http://webo.in/articles/habrahabr/15-yahoo-best-practices/">Expires</a> , <a href="http://webo.in/articles/habrahabr/15-yahoo-best-practices/">ETag</a> , <a href="http://developer.yahoo.com/performance/rules.html">Set-Cookie</a> ), <a href="http://webo.in/articles/habrahabr/15-yahoo-best-practices/">Reducing the number of DNS requests</a> <br><br>  <b>How can you spoil the first impression of the site</b> <br>  <a href="http://webo.in/articles/habrahabr/15-yahoo-best-practices/">Downloading and / or using JavaScript in the process of downloading information</a> , <a href="http://developer.yahoo.com/performance/rules.html">Using iframes on a page</a> <br><br>  I arranged the items in order of decreasing importance.  All items are very clear.  I want to stop only at one moment (I will write about compression and caching below) <blockquote><h3>  Placing CSS in the HEAD page: there should be only one external CSS file on the page. </h3>  Failure to comply with this requirement will result in a delay in the display of the page, since  CSS files are loaded sequentially + each HTTP request takes additional time.  The importance of this requirement is measured by the response time of the server and the speed of Internet access at the client. <br><br>  The requirement, in fact, is reduced to the consolidation of all CSS files into one.  There are two options for implementation: manual and automatic.  Manual method can be performed only in simple projects, or in projects with the same type of pages.  In all other cases, the human factor will play a role, and people will simply not engage in this nonsense every time after any change.  Dozens of kilobytes of CSS rules can be the result of a mindless merging of all files in general, of which only a small fraction will be used on each individual page. <br><br>  The idea ( <i>but not the implementation !!!</i> ) for an automatic solution can be found <a href="http://rakaz.nl/extra/code/combine">here</a> .  The essence of the idea in the query syntax: for two files <i>/styles/a.css</i> and <i>/styles/b.css</i> a single query of the form <i>/styles/a.css;b.css</i> can be formed.  If such a file is already on the server, it can be given to nginx, otherwise the request must be forwarded further to the backend in order to create this file for the next access to it. <br><br>  With this approach, you can physically divide the CSS rules into general (required on all pages) and private (required only on "non-standard" pages), and, if necessary, combine them. </blockquote>  The result of the first stage is delivered and decorated HTML.  There is no JavaScript (at the stage of delivering the main content, it only hinders).  The time from the beginning to the completion of loading such a page with JS turned on and off will actually be the same.  This will be the gain in download speed! <br><br>  If the ‚ÄúReducing the number of DOM elements‚Äù requirement is more or less close to ideal, then a side effect may be the possibility of implementing the mobile version of the site and the print version with the same HTML code.  It will remain ‚Äúonly‚Äù to implement the CSS rule sets for media = ‚Äúhandheld‚Äù and media = ‚Äúprint‚Äù. <br><br><h2>  Stage 2: Caching Design Files, Compressing HTML, CSS, and JS </h2><br>  At this stage, developers should ensure that other pages of the site are loaded quickly (if the visitor decides to go there).  This stage should be held in parallel with the first. <br><br>  To solve the problems of caching and compression, I recommend using <b>only nginx</b> , and Apache will only generate dynamic pages and build CSS and JS files.  I will give the nginx configuration, which I prepared ‚Äúbased on‚Äù our already working system: <br><br><h3>  Main domain of the project (www.site.org) </h3><blockquote><pre>  server {
   listen 80;
   server_name www.site.org site.org;
   gzip on;
   gzip_min_length 1000;
   gzip_proxied expired no-cache no-store private auth;
   gzip_types text / plain application / xml;
   location / {
     proxy_pass http: // backend;
     proxy_set_header Host $ host;
     proxy_set_header X-Real-IP $ remote_addr;
     proxy_set_header X-Forwarded-For $ proxy_add_x_forwarded_for;
   }
   location /favicon.ico {
     expires max;
     root / home / project / img /;
   }
   location /s.gif { 
     expires max;
     root / home / project / img /;
   }
 } </pre></blockquote>  Here, all requests to <i><a href="http://www.site.com/">www.site.com are</a></i> forwarded further to Apache (http: // backend is defined by the <a href="http_upstream.html">upstream</a> directive. The only exceptions are favicon.ico and transparent s.gif: they are in the same directory with all the other interface images, and for the browser are available like <a href="">www.site.com/favicon.ico</a> and <a href="">www.site.com/s.gif</a> . Such an exception for s.gif is made only to reduce the size of the html-code. <br>  Apache's responses with Content-Type "text / html", "text / plain", "application / xml" are compressed on the fly.  Compression should be disabled in the case when a small amount of resources is allocated for a project. <br>  All HTML pages are considered dynamic, so they are not cached. <br><br><h3>  Domain for interface images (img.site.net) </h3><blockquote><pre>  server {
   listen 80; 
   server_name img.site.net;
   expires max;
   add_header Cache-Control public;
   location / {
     root / home / project / img /;
   }
   location ~ ^ / \ d + \. \ d + \ /.* {
     root / home / project / img /;
     rewrite (\ d + \. \ d +) / (. *) / $ 2 break;
   }
 } </pre></blockquote> All interface images are cached forever.  Example: <a href="">img.nnow.ru/interface/is.png</a> <br>  In order to reset the browser cache, the following rule has been introduced: if an HTTP request begins with ‚Äúslash number dot number slash‚Äù, then the pictures should be taken from the root.  Example: <a href="">img.nnow.ru/2.0/interface/is.png</a> <br>  This is very useful when we need to add another icon inside the image of the CSS sprite. <br><br><h3>  Domain for CSS and JS files (static.site.net) </h3><blockquote><pre>  server {
   listen 80; 
   server_name static.site.net;
   expires max;
   gzip_static on;
   location / {
     return 404;
   }
   location / jas / {
     # javascript-and-stylesheets
     proxy_set_header Host $ host;
     if (! -f $ request_filename) {
       break;
       proxy_pass http: // backend;
     }
     root / home / project / static /;
   }
 } </pre></blockquote>  The principle of the server mechanisms for building CSS and JS was described above.  The only thing worth mentioning is the <b>gzip_static</b> directive.  This directive comes with the <a href="http_gzip_static_module.html">ngx_http_gzip_static_module</a> module.  The module allows you to give a pre-compressed file with the same name and suffix ".gz" instead of the usual file.  By default, the module is not built; you need to allow its assembly when configured with the <i>--with-http_gzip_static_module parameter</i> . <br>  The file collector must additionally be able to write files of the form <i>/jas/a.css;b.css.gz</i> . <br>  CSS and JS files are cached forever.  A cache reset can be implemented by adding a ‚Äúfile version‚Äù to the file name: <i>/jas/ver2.0.css;a.css;b.css</i> <blockquote>  <b>NB!</b>  We implemented the collector in such a way that the a.css and b.css files are included in the final result by the PHP function <b>include</b> , i.e.  are actually executable php files.  This makes it possible to get rid of <a href="http://habrahabr.ru/blogs/css/14579/">CSS hacks</a> or analysis of the User-Agent browser in JS: <br>  When accessing <i>/jas/ver2.0.css;</i> Firefox3.css; <i>a.css;b.css,</i> Firefox3.css stores the name and version of the browser into the PHP variable, and subsequent parts of the compound result file can read this variable and output different content for different browsers.  For example: " <a href="http://s.img.nnow.ru/jas/ver">s.img.nnow.ru/jas/ver</a> , 1.0.js; Firefox3.js; habr, index.js" and " <a href="http://s.img.nnow.ru/jas/ver">s.img.nnow.ru/jas/ver</a> , 1.1.js; IE6.js ; habr, index.js ¬ª <br>  In the same way, the ‚Äúversion of the interface image‚Äù for <a href="">img.nnow.ru/3.0/interface/logo_ni.gif also changes</a> (the corresponding variable is set in the CSS version file). </blockquote><br><h2>  Stage 3: Life After Loading Page </h2><br>  The purpose of this stage is to attach mouse events to various DOM elements and implement other Web-two-bit gadgets, i.e.  page recovery. <br><br>  They say that sometimes ‚Äúthe gram of visibility is more important than a kilogram of essence‚Äù is just about JS.  After all, it is in JavaScript that you can implement mechanisms that simplify user actions;  You can make a lot of different visual effects, emphasizing the design, convenience and usefulness of the site (and in fact all the work that the developers have done in the previous stages). <br><br>  At this point, we should have an HTML page in which all links and forms <b>are required to</b> work without JavaScript.  Server interfaces for Ajax requests should be ready;  The page structure should be such that for similar pieces of HTML you do not have to implement similar, but not identical pieces of JS-code.  Most likely, page templates should be created, where you can see how the page will look after some user action. <br>  In essence, an effective exchange of information between all developers should be organized.  How to organize such a dialogue in a team of dozens of people, I do not know;  but, for a team of three or four people, this is quite realistic (albeit difficult). <br><br>  In order not to reduce the speed of content delivery and design, JS-files (best of course, <i>one JS-file</i> ) must be connected before closing the body tag.  Life begins <a href="http://dean.edwards.name/weblog/2006/06/again/">after loading the HTML code</a> : <blockquote>  The task is to perform the following actions: <ol><li>  find DOM-elements that require "revitalization" (hereinafter - the components); </li><li>  determine what the component is; </li><li>  provide connection of the necessary JavaScipt code; </li><li>  follow the sequence of the connection files; </li><li>  Do not allow multiple downloads of a single file. </li></ol>  If you have read this far;) then you are best to continue reading on the <a href="http://jsx.ru/Texts/ModulesInJS/index.html">Modularity in JavaScript</a> page <a href="http://jsx.ru/Texts/ModulesInJS/index.html">, dynamic loading</a> on the site <a href="http://www.jsx.ru/">www.jsx.ru.</a>  It was there that I borrowed this algorithm.  I would rather not advertise my solution;  in fact, in the process of performing the task, an experiment was made, the final result of which is not 100% clear (for now, everything seems to be working fine =) <br><br>  I will tell about points 3 and 4. <br>  Finding the required DOM elements should give us a list of the names of the JS component.  The names of the components must unambiguously correspond to the names of the files on the server that contain the code for them.  We may also need to load some additional CSS rules for the found components for some visual effects that are not necessary at the first stage of loading the content and design. <br>  The list of component names can be combined into a single request to the server.  As a result, after downloading the content, the files of the form " <i>static.site.net/jas/componentName1.css;componentName2.css</i> " and " <i>static.site.net/jas/componentName1.js;componentName2.js</i> " should load. <br><br>  This approach has two drawbacks: (1) a lot of files can be generated in the / jas / folder after a while, which theoretically can reduce the time to access them on the server;  (2) sometimes there can be a lot of components on the page, and there are so many that the length of the name of the requested merged file will exceed the file system's capabilities (for example, Ext3 has 255 characters) - in this case it will be necessary to split one request into several successive ones. </blockquote><br><h2>  YSlow: Performance Grade: A (100) </h2><br>  At first, this is how I wanted to name the article, but then it grew into something more than just ‚Äúsite performance evaluation‚Äù.  Now I am sure that only pages without advertising banners and counters or default pages of nginx or Apache with a message that the page could not be found can receive such an assessment. <br><br>  The impossibility of achieving excellent performance estimates does not give us a reason to neglect client optimization.  After all, a stepLeft-stepRIGHT from the optimal path can mean an immediate execution: <blockquote>  Home page of my blog on liveinternet.ru: Performance Grade: F (30) <br>  Habr main page: Performace Grade F (38) <br>  Home page of my blog on Ya.ru: Performance Grade: F (42) <br>  Post in the official Google blog: Performance Grade: F (56) <br>  Main page of my blog in LiveJournal: Performance Grade: D (66) </blockquote>  These are not just numbers - this is the probability that someday someone else will implement his idea, promote the project and select your audience, no matter how popular Habr and LiveJournal are. <br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/38299/">https://habr.com/ru/post/38299/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../38290/index.html">Using a bunch of PHP and MySQL with Google Maps</a></li>
<li><a href="../38291/index.html">Yandex.Market - Automatic sorting of goods by category</a></li>
<li><a href="../38295/index.html">UA Webstar 2008</a></li>
<li><a href="../38296/index.html">Silverlight File Upload Progress</a></li>
<li><a href="../38298/index.html">Vimperator</a></li>
<li><a href="../38300/index.html">89 best web studios in the world</a></li>
<li><a href="../38301/index.html">IE8 Beta 2</a></li>
<li><a href="../383011/index.html">Hand-held flamethrowers appeared on sale in the US</a></li>
<li><a href="../38302/index.html">Fiber Optic Light Glove</a></li>
<li><a href="../38306/index.html">Pliz advise how best to store large files?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>